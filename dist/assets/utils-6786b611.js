import{_ as $}from"./preload-helper-3bce6601.js";import{l as a}from"./Color-fb64d77d.js";import{o as p,x as h,w as v}from"./symbols-f8232671.js";import{c as z}from"./asyncUtils-437defc4.js";import{h as x}from"./string-a318751c.js";import{r as s,t as d,e as w,f as L}from"./typedArrayUtil-4d7bb04c.js";import{l as _}from"./vec3f64-2f9cef06.js";import"./Error-ec6249b9.js";import"./parser-498c8be0.js";import"./mat4f32-77b3d8ac.js";import"./mat4-44a0988f.js";import"./assets-8d3e737a.js";import"./request-6fc81c4c.js";import{e as j}from"./ItemCache-fd3aceaf.js";new j(1e3);new a([128,128,128]);const b=/\/resource\/(.*?)\.svg$/,E=new a("white");function tt(t,o){const r=L(o.resource).href;return!x("esri-canvas-svg-support")&&t.styleOrigin&&b.test(r)?r.replace(b,"/resource/png/$1.png"):r}function ot(t,o){if(!t)return null;let r=null;return p(t)?r=S(t):h(t)&&(r=t.color?new a(t.color):null),r?f(r,o):null}function S(t){const o=t.symbolLayers;if(!o)return null;let r=null;return o.forEach(n=>{var i;n.type==="object"&&((i=n.resource)==null?void 0:i.href)!=null||(r=n.type==="water"?w(n.color):s(n.material)?w(n.material.color):null)}),r?new a(r):null}function f(t,o){if(o==null||t==null)return t;const r=t.toRgba();return r[3]=r[3]*o,new a(r)}function O(t,o,r){const n=t.symbolLayers;if(!n)return;const i=l=>{const c=s(l)?l:null;return f(o=o??c??(r!=null?E:null),r)};n.forEach(l=>{var c;if(l.type!=="object"||((c=l.resource)==null?void 0:c.href)==null||o)if(l.type==="water")l.color=i(l.color);else{const m=s(l.material)?l.material.color:null,e=i(m);d(l.material)?l.material=new v({color:e}):l.material.color=e,r!=null&&"outline"in l&&s(l.outline)&&s(l.outline.color)&&(l.outline.color=f(l.outline.color,r))}})}function R(t,o,r){(o=o??t.color)&&(t.color=f(o,r)),r!=null&&"outline"in t&&t.outline&&t.outline.color&&(t.outline.color=f(t.outline.color,r))}function rt(t,o,r){t&&(o||r!=null)&&(o&&(o=new a(o)),p(t)?O(t,o,r):h(t)&&R(t,o,r))}async function A(t,o){const r=t.symbolLayers;r&&await z(r,async n=>D(n,o))}async function D(t,o){switch(t.type){case"extrude":P(t,o);break;case"icon":case"line":case"text":I(t,o);break;case"path":C(t,o);break;case"object":await B(t,o)}}function I(t,o){const r=g(o);s(r)&&(t.size=r)}function g(t){for(const o of t)if(typeof o=="number")return o;return null}function P(t,o){t.size=typeof o[2]=="number"?o[2]:0}async function B(t,o){const{resourceSize:r,symbolSize:n}=await J(t),i=k(o,r,n);t.width=u(o[0],n[0],r[0],i),t.depth=u(o[1],n[1],r[1],i),t.height=u(o[2],n[2],r[2],i)}function C(t,o){const r=k(o,_,[t.width,void 0,t.height]);t.width=u(o[0],t.width,1,r),t.height=u(o[2],t.height,1,r)}function k(t,o,r){for(let n=0;n<3;n++){const i=t[n];switch(i){case"symbol-value":{const l=r[n];return l!=null?l/o[n]:1}case"proportional":break;default:if(i&&o[n])return i/o[n]}}return 1}async function J(t){const o=await $(()=>import("./symbolLayerUtils-1e199a07.js"),["assets/symbolLayerUtils-1e199a07.js","assets/preload-helper-3bce6601.js","assets/request-6fc81c4c.js","assets/Error-ec6249b9.js","assets/string-a318751c.js","assets/typedArrayUtil-4d7bb04c.js","assets/promiseUtils-1e54421e.js","assets/ItemCache-fd3aceaf.js","assets/MemCache-18a255ed.js","assets/cast-fcb46737.js","assets/ArrayPool-a8ee9378.js","assets/nextTick-3ee5a785.js","assets/aaBoundingBox-657a9b82.js","assets/Extent-da876e26.js","assets/Ellipsoid-89682c5e.js","assets/aaBoundingRect-193543b5.js","assets/mathUtils-b4bb77e2.js","assets/vec3-e93e648f.js","assets/vec3f64-2f9cef06.js","assets/common-c186b691.js","assets/vec4-790471c0.js","assets/symbolLayerUtils3D-76acc268.js"]),r=await o.computeObjectLayerResourceSize(t,10),{width:n,height:i,depth:l}=t,c=[n,l,i];let m=1;for(let e=0;e<3;e++){const y=c[e];if(y!=null){m=y/r[e];break}}for(let e=0;e<3;e++)c[e]==null&&(c[e]=r[e]*m);return{resourceSize:r,symbolSize:c}}function u(t,o,r,n){switch(t){case"proportional":return r*n;case"symbol-value":return o??r;default:return t}}function M(t,o){const r=g(o);if(!d(r))switch(t.type){case"simple-marker":t.size=r;break;case"picture-marker":{const n=t.width/t.height;n>1?(t.width=r,t.height=r*n):(t.width=r*n,t.height=r);break}case"simple-line":t.width=r;break;case"text":t.font.size=r}}async function nt(t,o){if(t&&o)return p(t)?A(t,o):void(h(t)&&M(t,o))}function lt(t,o,r){if(t&&o!=null)if(p(t)){const n=t.symbolLayers;n&&n.forEach(i=>{if(i&&i.type==="object")switch(r){case"tilt":i.tilt=o;break;case"roll":i.roll=o;break;default:i.heading=o}})}else h(t)&&(t.type!=="simple-marker"&&t.type!=="picture-marker"&&t.type!=="text"||(t.angle=o))}function it(t){return s(t)&&t.type==="polygon-3d"&&t.symbolLayers.some(o=>o.type==="extrude")}export{it as B,nt as M,lt as N,tt as g,ot as j,rt as x};
