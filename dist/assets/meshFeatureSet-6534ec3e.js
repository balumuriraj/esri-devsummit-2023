import{g as Bt}from"./Graphic-f0e54e86.js";import{r as c,t as Z}from"./typedArrayUtil-4d7bb04c.js";import{w as L,p as Zt,a as it}from"./Extent-da876e26.js";import{_ as Y}from"./preload-helper-3bce6601.js";import{e as A,y as F,n as Vt}from"./cast-fcb46737.js";import{s as x,a as st}from"./Error-ec6249b9.js";import{a as Jt}from"./HandleOwner-9b396af1.js";import{m as Wt}from"./Loadable-268c900a.js";import{m as Xt}from"./Promise-376ab9f6.js";import{y as pt,L as Yt,p as Ht,f as qt}from"./promiseUtils-1e54421e.js";import{l as Kt}from"./reactiveUtils-4dabbb80.js";import"./ArrayPool-a8ee9378.js";import{n as y,f as Pt,r as nt}from"./vec3f64-2f9cef06.js";import{v as Qt}from"./Polyline-ff2d7c6b.js";import{M as ft,j as ut,k as mt,O as ht,h as gt,L as dt,a as V,b as at,g as lt,x as te,c as X}from"./projection-a69d43d0.js";import{g as G,p as H,o as ee}from"./MeshComponent-a43522cc.js";import{r as rt,b as re,x as ne,_ as oe,L as q}from"./georeference-74362e92.js";import{g as _,Z as Et}from"./projection-290b739f.js";import{O as ie,_ as se}from"./request-6fc81c4c.js";import{a as It}from"./mat3-3fc68e72.js";import{e as xt}from"./mat3f64-c6305894.js";import{e as _t}from"./mat4f64-1e28eae0.js";import{u as yt,S as K,z as ae,o as Ct,e as Q,O as le,g as zt}from"./vec3-e93e648f.js";import{a as wt}from"./unitUtils-45d1147c.js";import{g as ce}from"./mat4-44a0988f.js";import pe from"./FeatureSet-d32b0eb8.js";import"./geometry-b7901087.js";import"./typeUtils-35750739.js";import"./jsonMap-7b8332c9.js";import"./string-a318751c.js";import"./PopupTemplate-40f3c9aa.js";import"./Clonable-545593ce.js";import"./Collection-910b6f71.js";import"./Evented-a45c8b0f.js";import"./SimpleObservable-23231131.js";import"./fieldUtils-7f54c4b1.js";import"./arcadeOnDemand-281a01eb.js";import"./enumeration-3a03bd31.js";import"./number-27cf8195.js";import"./locale-30120714.js";import"./Identifiable-bfe1ff30.js";import"./symbols-f8232671.js";import"./CIMSymbol-539bd447.js";import"./Symbol-f93ed9fd.js";import"./Color-fb64d77d.js";import"./colorUtils-639f4d25.js";import"./mathUtils-b4bb77e2.js";import"./vec4-790471c0.js";import"./common-c186b691.js";import"./screenUtils-410d12c0.js";import"./opacityUtils-1f7f5126.js";import"./symbolLayerUtils3D-76acc268.js";import"./aaBoundingBox-657a9b82.js";import"./aaBoundingRect-193543b5.js";import"./persistableUrlUtils-5f719c3b.js";import"./Symbol3DAnchorPosition2D-5726d999.js";import"./collectionUtils-803d9ba8.js";import"./Portal-2bb189b3.js";import"./PortalGroup-8e41557a.js";import"./PortalUser-659cc1d2.js";import"./nextTick-3ee5a785.js";import"./Ellipsoid-89682c5e.js";import"./jsonUtils-229211af.js";import"./quat-3d5eec2d.js";import"./quatf64-7fd38d64.js";import"./BufferView-903d1848.js";import"./vec2-528adfe4.js";import"./vec33-e98769e8.js";import"./earcut-58237617.js";import"./deduplicate-03981d62.js";import"./assets-8d3e737a.js";import"./zscale-89472cba.js";import"./Field-61ec9870.js";import"./fieldType-f31285f7.js";const ct=x.getLogger("esri.geometry.support.meshUtils.centerAt");function fe(t,r,e){if(!t.vertexAttributes||!t.vertexAttributes.position)return;const n=(e==null?void 0:e.origin)??t.origin;c(t.transform)?((e==null?void 0:e.geographic)!=null&&e.geographic!==t.transform.geographic&&ct.warn(`Specifying the 'geographic' parameter (${e.geographic}) different from the Mesh transform setting (${t.transform.geographic}) is not supported`),ue(t.transform,r,n)):rt(t.spatialReference,e)?me(t,r,n):he(t,r,n)}function ue(t,r,e){const n=r.x-e.x,o=r.y-e.y,s=r.hasZ&&e.hasZ?r.z-e.z:0,i=t.origin;t.origin=[i[0]+n,i[1]+o,i[2]+s]}function me(t,r,e){const n=re(t.vertexAttributes,e,{geographic:!0}),{position:o,normal:s,tangent:i}=ne(n,r,{geographic:!0});t.vertexAttributes.position=o,t.vertexAttributes.normal=s,t.vertexAttributes.tangent=i,t.vertexAttributesChanged()}function he(t,r,e){const n=xe,o=de;if(_(r,o,t.spatialReference)){if(!_(e,n,t.spatialReference)){const s=t.origin;n[0]=s.x,n[1]=s.y,n[2]=s.z,ct.error(`Failed to project specified origin (wkid:${e.spatialReference.wkid}) to mesh spatial reference (wkid:${t.spatialReference.wkid}).`)}ge(t.vertexAttributes.position,o,n),t.vertexAttributesChanged()}else ct.error(`Failed to project centerAt location (wkid:${r.spatialReference.wkid}) to mesh spatial reference (wkid:${t.spatialReference.wkid})`)}function ge(t,r,e){if(t)for(let n=0;n<t.length;n+=3)for(let o=0;o<3;o++)t[n+o]+=r[o]-e[o]}const de=y(),xe=y();async function ye(t,r,e){const{loadGLTFMesh:n}=await pt(Y(()=>import("./loadGLTFMesh-14d35214.js"),["assets/loadGLTFMesh-14d35214.js","assets/Color-fb64d77d.js","assets/colorUtils-639f4d25.js","assets/mathUtils-b4bb77e2.js","assets/vec3-e93e648f.js","assets/vec3f64-2f9cef06.js","assets/common-c186b691.js","assets/vec4-790471c0.js","assets/typedArrayUtil-4d7bb04c.js","assets/ArrayPool-a8ee9378.js","assets/string-a318751c.js","assets/Error-ec6249b9.js","assets/request-6fc81c4c.js","assets/preload-helper-3bce6601.js","assets/promiseUtils-1e54421e.js","assets/mat3-3fc68e72.js","assets/mat3f64-c6305894.js","assets/vec4f64-e407da96.js","assets/MeshComponent-a43522cc.js","assets/earcut-58237617.js","assets/Polyline-ff2d7c6b.js","assets/cast-fcb46737.js","assets/nextTick-3ee5a785.js","assets/Extent-da876e26.js","assets/Ellipsoid-89682c5e.js","assets/deduplicate-03981d62.js","assets/persistableUrlUtils-5f719c3b.js","assets/BufferView-903d1848.js","assets/vec2-528adfe4.js","assets/vec33-e98769e8.js","assets/DefaultMaterial_COLOR_GAMMA-fe26fda8.js","assets/types-e1c0a5bf.js","assets/asyncUtils-437defc4.js","assets/mat4f64-1e28eae0.js","assets/enums-64ab819c.js","assets/Version-2946cc03.js","assets/mat4-44a0988f.js","assets/quat-3d5eec2d.js","assets/quatf64-7fd38d64.js","assets/compilerUtils-18d58939.js","assets/georeference-74362e92.js","assets/unitUtils-45d1147c.js","assets/jsonMap-7b8332c9.js","assets/projection-290b739f.js","assets/SimpleObservable-23231131.js","assets/assets-8d3e737a.js","assets/aaBoundingRect-193543b5.js","assets/zscale-89472cba.js","assets/projection-a69d43d0.js"]),e),o=await St(r,e),s=n(new L({x:0,y:0,z:0,spatialReference:t.spatialReference}),o.url,{resolveFile:we(o),useTransform:!0,signal:c(e)?e.signal:null});s.then(()=>o.dispose(),()=>o.dispose());const{vertexAttributes:i,components:a}=await s;t.vertexAttributes=i,t.components=a}function we(t){const r=ie(t.url);return e=>{const n=se(e,r,r),o=n?n.replace(/^ *\.\//,""):null;return(o?t.files.get(o):null)??e}}async function St(t,r){return t instanceof Blob?tt.fromBlob(t):typeof t=="string"?new tt(t):Array.isArray(t)?ve(t,r):be(t,r)}async function ve(t,r){const e=new Map;let n=null;const o=await Yt(t.map(async i=>({name:i.name,source:await St(i instanceof Blob?i:i.source,r)}))),s=[];for(const i of o)i&&(Ht(r)?i.source.dispose():s.push(i));qt(r);for(const{name:i,source:a}of s)(Z(n)||/\.(gltf|glb)/i.test(i))&&(n=a.url),e.set(i,a.url),a.files&&a.files.forEach((l,f)=>e.set(f,l));if(Z(n))throw new st("mesh-load-external:missing-files","Missing files to load external mesh source");return new tt(n,()=>s.forEach(({source:i})=>i.dispose()),e)}async function be(t,r){const{default:e}=await pt(Y(()=>import("./request-6fc81c4c.js").then(o=>o.x),["assets/request-6fc81c4c.js","assets/preload-helper-3bce6601.js","assets/Error-ec6249b9.js","assets/string-a318751c.js","assets/typedArrayUtil-4d7bb04c.js","assets/promiseUtils-1e54421e.js"]),r),n=typeof t.multipart[0]=="string"?await Promise.all(t.multipart.map(async o=>(await e(o,{responseType:"array-buffer"})).data)):t.multipart;return tt.fromBlob(new Blob(n))}let tt=class kt{constructor(r,e=()=>{},n=new Map){this.url=r,this.dispose=e,this.files=n}static fromBlob(r){const e=URL.createObjectURL(r);return new kt(e,()=>URL.revokeObjectURL(e))}};function Ae(t,r,e){t.vertexAttributes&&t.vertexAttributes.position&&(c(t.transform)?((e==null?void 0:e.geographic)!=null&&e.geographic!==t.transform.geographic&&x.getLogger("esri.geometry.support.meshUtils.offset").warn(`Specifying the 'geographic' parameter (${e.geographic}) different from the Mesh transform setting (${t.transform.geographic}) is not supported`),$e(t.transform,r)):rt(t.spatialReference,e)?Re(t,r):Fe(t,r))}function $e(t,r){const e=t.origin;t.origin=yt(y(),e,r)}function Re(t,r){const e=t.spatialReference,n=t.vertexAttributes.position,o=t.vertexAttributes.normal,s=t.vertexAttributes.tangent,i=new Float64Array(n.length),a=c(o)?new Float32Array(o.length):null,l=c(s)?new Float32Array(s.length):null,f=t.extent.center,p=Me;Et(e,[f.x,f.y,f.z],vt,wt(e)),It(bt,vt),K(p,r,bt),ft(n,e,i),c(o)&&c(a)&&ut(o,n,i,e,a),c(s)&&c(l)&&mt(s,n,i,e,l),Dt(i,p),ht(i,n,e),c(o)&&c(a)&&gt(a,n,i,e,o),c(s)&&c(l)&&dt(l,n,i,e,s),t.vertexAttributesChanged()}function Fe(t,r){Dt(t.vertexAttributes.position,r),t.vertexAttributesChanged()}function Dt(t,r){if(t)for(let e=0;e<t.length;e+=3)for(let n=0;n<3;n++)t[e+n]+=r[n]}const Me=y(),vt=_t(),bt=xt();function Le(){const{faceDescriptions:t,faceVertexOffsets:r,uvScales:e}=Se,n=4*t.length,o=new Float64Array(3*n),s=new Float32Array(3*n),i=new Float32Array(2*n),a=new Uint32Array(2*t.length*3);let l=0,f=0,p=0,m=0;for(let h=0;h<t.length;h++){const u=t[h],v=l/3;for(const d of r)a[m++]=v+d;const O=u.corners;for(let d=0;d<4;d++){const $=O[d];let b=0;i[p++]=.25*e[d][0]+u.uvOrigin[0],i[p++]=u.uvOrigin[1]-.25*e[d][1];for(let R=0;R<3;R++)u.axis[R]!==0?(o[l++]=.5*u.axis[R],s[f++]=u.axis[R]):(o[l++]=.5*$[b++],s[f++]=0)}}return{position:o,normal:s,uv:i,faces:a}}function Oe(t,r){const e=t.components[0],n=e.faces,o=ke[r],s=6*o,i=new Array(6),a=new Array(n.length-6);let l=0,f=0;for(let p=0;p<n.length;p++)p>=s&&p<s+6?i[l++]=n[p]:a[f++]=n[p];if(c(t.vertexAttributes.uv)){const p=new Float32Array(t.vertexAttributes.uv),m=4*o*2,h=[0,1,1,1,1,0,0,0];for(let u=0;u<h.length;u++)p[m+u]=h[u];t.vertexAttributes.uv=p}return t.components=[new G({faces:i,material:e.material}),new G({faces:a})],t}function Pe(t=0){const r=Math.round(8*2**t),e=2*r,n=(r-1)*(e+1)+2*e,o=new Float64Array(3*n),s=new Float32Array(3*n),i=new Float32Array(2*n),a=new Uint32Array(3*((r-1)*e*2));let l=0,f=0,p=0,m=0;for(let h=0;h<=r;h++){const u=h/r*Math.PI+.5*Math.PI,v=Math.cos(u),O=Math.sin(u);g[2]=O;const d=h===0||h===r,$=d?e-1:e;for(let b=0;b<=$;b++){const R=b/$*2*Math.PI;g[0]=-Math.sin(R)*v,g[1]=Math.cos(R)*v;for(let P=0;P<3;P++)o[l]=.5*g[P],s[l]=g[P],++l;i[f++]=(b+(d?.5:0))/e,i[f++]=h/r,h!==0&&b!==e&&(h!==r&&(a[p++]=m,a[p++]=m+1,a[p++]=m-e),h!==1&&(a[p++]=m,a[p++]=m-e,a[p++]=m-e-1)),m++}}return{position:o,normal:s,uv:i,faces:a}}function Ee(t=0){const e=Math.round(16*2**t),n=(5-1)*(e+1)+2*e,o=new Float64Array(3*n),s=new Float32Array(3*n),i=new Float32Array(2*n),a=new Uint32Array(3*(4*e));let l=0,f=0,p=0,m=0,h=0;for(let u=0;u<=5;u++){const v=u===0||u===5,O=u<=1||u>=5-1,d=u===2||u===4,$=v?e-1:e;for(let b=0;b<=$;b++){const R=b/$*2*Math.PI,P=v?0:.5;g[0]=P*Math.sin(R),g[1]=P*-Math.cos(R),g[2]=u<=2?.5:-.5;for(let z=0;z<3;z++)o[l++]=g[z],s[f++]=O?z===2?u<=1?1:-1:0:z===2?0:g[z]/P;i[p++]=(b+(v?.5:0))/e,i[p++]=u<=1?1*u/3:u<=3?1*(u-2)/3+1/3:1*(u-4)/3+2/3,d||u===0||b===e||(u!==5&&(a[m++]=h,a[m++]=h+1,a[m++]=h-e),u!==1&&(a[m++]=h,a[m++]=h-e,a[m++]=h-e-1)),h++}}return{position:o,normal:s,uv:i,faces:a}}function Ie(t,r){const e=typeof r=="number"?r:r!=null?r.width:1,n=typeof r=="number"?r:r!=null?r.height:1;switch(t){case"up":case"down":return{width:e,depth:n};case"north":case"south":return{width:e,height:n};case"east":case"west":return{depth:e,height:n}}}function _e(t){const r=B.facingAxisOrderSwap[t],e=B.position,n=B.normal,o=new Float64Array(e.length),s=new Float32Array(n.length);let i=0;for(let a=0;a<4;a++){const l=i;for(let f=0;f<3;f++){const p=r[f],m=Math.abs(p)-1,h=p>=0?1:-1;o[i]=e[l+m]*h,s[i]=n[l+m]*h,i++}}return{position:o,normal:s,uv:new Float32Array(B.uv),faces:new Uint32Array(B.faces),isPlane:!0}}const S=1,k=2,D=3,B={position:[-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0],normal:[0,0,1,0,0,1,0,0,1,0,0,1],uv:[0,1,1,1,1,0,0,0],faces:[0,1,2,0,2,3],facingAxisOrderSwap:{east:[D,S,k],west:[-D,-S,k],north:[-S,D,k],south:[S,-D,k],up:[S,k,D],down:[S,-k,-D]}};function J(t,r,e){t.isPlane||Ce(t),ze(t,e==null?void 0:e.size);const{vertexAttributes:n,transform:o}=oe(t,r,e);return{vertexAttributes:new H({...n,uv:t.uv}),transform:o,components:[new G({faces:t.faces,material:e&&e.material||null})],spatialReference:r.spatialReference}}function Ce(t){for(let r=0;r<t.position.length;r+=3)t.position[r+2]+=.5}function ze(t,r){if(r==null)return;const e=typeof r=="number"?[r,r,r]:[r.width!=null?r.width:1,r.depth!=null?r.depth:1,r.height!=null?r.height:1];E[0]=e[0],E[4]=e[1],E[8]=e[2];for(let n=0;n<t.position.length;n+=3){for(let o=0;o<3;o++)g[o]=t.position[n+o];K(g,g,E);for(let o=0;o<3;o++)t.position[n+o]=g[o]}if(e[0]!==e[1]||e[1]!==e[2]){E[0]=1/e[0],E[4]=1/e[1],E[8]=1/e[2];for(let n=0;n<t.normal.length;n+=3){for(let o=0;o<3;o++)g[o]=t.normal[n+o];K(g,g,E),ae(g,g);for(let o=0;o<3;o++)t.normal[n+o]=g[o]}}}const Se={faceDescriptions:[{axis:[0,-1,0],uvOrigin:[0,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[1,0,0],uvOrigin:[.25,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,1,0],uvOrigin:[.5,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[-1,0,0],uvOrigin:[.75,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[0,0,1],uvOrigin:[0,.375],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,0,-1],uvOrigin:[0,.875],corners:[[-1,1],[1,1],[1,-1],[-1,-1]]}],uvScales:[[0,0],[1,0],[1,1],[0,1]],faceVertexOffsets:[0,1,2,0,2,3]},ke={south:0,east:1,north:2,west:3,up:4,down:5},g=y(),E=xt(),Tt=x.getLogger("esri.geometry.support.meshUtils.rotate");function De(t,r,e){if(!t.vertexAttributes||!t.vertexAttributes.position||r[3]===0)return;const n=t.spatialReference;if(c(t.transform)){(e==null?void 0:e.geographic)!=null&&e.geographic!==t.transform.geographic&&Tt.warn(`Specifying the 'geographic' parameter (${e.geographic}) different from the Mesh transform setting (${t.transform.geographic}) is not supported`);const o=(e==null?void 0:e.origin)??t.transform.getOriginPoint(n);Te(t.transform,r,o)}else{const o=(e==null?void 0:e.origin)??t.origin;rt(t.spatialReference,e)?je(t,r,o):Ne(t,r,o)}}function Te(t,r,e){const n=Ct(j,e.x,e.y,e.z),o=Q(j,n,t.origin);t.applyLocalInverse(o,At),t.rotation=at(t.rotation,r,V()),t.applyLocalInverse(o,o),Q(o,o,At),t.translation=yt(y(),t.translation,o)}function je(t,r,e){const n=t.spatialReference,o=wt(n),s=jt;_(e,s,o)||_(t.origin,s,o);const i=t.vertexAttributes.position,a=t.vertexAttributes.normal,l=t.vertexAttributes.tangent,f=new Float64Array(i.length),p=c(a)?new Float32Array(a.length):null,m=c(l)?new Float32Array(l.length):null;Et(o,s,et,o),It(Rt,et);const h=$t;K(lt($t),lt(r),Rt),h[3]=r[3],ft(i,n,f),c(a)&&c(p)&&ut(a,i,f,n,p),c(l)&&c(m)&&mt(l,i,f,n,m),U(f,h,3,s),ht(f,i,n),c(a)&&c(p)&&(U(p,h,3),gt(p,i,f,n,a)),c(l)&&c(m)&&(U(m,h,4),dt(m,i,f,n,l)),t.vertexAttributesChanged()}function Ne(t,r,e){const n=jt;if(!_(e,n,t.spatialReference)){const o=t.origin;n[0]=o.x,n[1]=o.y,n[2]=o.z,Tt.error(`Failed to project specified origin (wkid:${e.spatialReference.wkid}) to mesh spatial reference (wkid:${t.spatialReference.wkid}).`)}U(t.vertexAttributes.position,r,3,n),U(t.vertexAttributes.normal,r,3),U(t.vertexAttributes.tangent,r,4),t.vertexAttributesChanged()}function U(t,r,e,n=Pt){if(!Z(t)){ce(et,te(r),lt(r));for(let o=0;o<t.length;o+=e){for(let s=0;s<3;s++)j[s]=t[o+s]-n[s];le(j,j,et);for(let s=0;s<3;s++)t[o+s]=j[s]+n[s]}}}const j=y(),At=y(),$t=V(),et=_t(),Rt=xt(),jt=y(),Nt=x.getLogger("esri.geometry.support.meshUtils.scale");function Ue(t,r,e){if(!t.vertexAttributes||!t.vertexAttributes.position)return;const n=t.spatialReference;if(c(t.transform)){(e==null?void 0:e.geographic)!=null&&e.geographic!==t.transform.geographic&&Nt.warn(`Specifying the 'geographic' parameter (${e.geographic}) different from the Mesh transform setting (${t.transform.geographic}) is not supported`);const o=(e==null?void 0:e.origin)??t.transform.getOriginPoint(n);Ge(t.transform,r,o)}else{const o=rt(t.spatialReference,e),s=e&&e.origin||t.origin;o?Be(t,r,s):Ze(t,r,s)}}function Ge(t,r,e){const n=Ct(N,e.x,e.y,e.z),o=Q(N,n,t.origin);t.applyLocalInverse(o,Ft);const s=zt(y(),t.scale,r);t.scale=s,t.applyLocalInverse(o,o),Q(o,o,Ft),t.translation=yt(y(),t.translation,o)}function Be(t,r,e){const n=t.spatialReference,o=wt(n),s=Gt;_(e,s,o)||_(t.origin,s,o);const i=t.vertexAttributes.position,a=t.vertexAttributes.normal,l=t.vertexAttributes.tangent,f=new Float64Array(i.length),p=c(a)?new Float32Array(a.length):null,m=c(l)?new Float32Array(l.length):null;ft(i,n,f),c(a)&&c(p)&&ut(a,i,f,n,p),c(l)&&c(m)&&mt(l,i,f,n,m),Ut(f,r,s),ht(f,i,n),c(a)&&c(p)&&gt(p,i,f,n,a),c(l)&&c(m)&&dt(m,i,f,n,l),t.vertexAttributesChanged()}function Ze(t,r,e){const n=Gt;if(!_(e,n,t.spatialReference)){const o=t.origin;n[0]=o.x,n[1]=o.y,n[2]=o.z,Nt.error(`Failed to project specified origin (wkid:${e.spatialReference.wkid}) to mesh spatial reference (wkid:${t.spatialReference.wkid}).`)}Ut(t.vertexAttributes.position,r,n),t.vertexAttributesChanged()}function Ut(t,r,e=Pt){if(t)for(let n=0;n<t.length;n+=3){for(let o=0;o<3;o++)N[o]=t[n+o]-e[o];zt(N,N,r);for(let o=0;o<3;o++)t[n+o]=N[o]+e[o]}}const N=y(),Ft=y(),Gt=y();var M;const C="esri.geometry.Mesh";let w=M=class extends Jt(Wt.LoadableMixin(Xt(Zt))){constructor(t){super(t),this.components=null,this.transform=null,this.external=null,this.hasZ=!0,this.hasM=!1,this.vertexAttributes=new H,this.type="mesh"}initialize(){(Z(this.external)||this.vertexAttributes.position.length)&&(this.loadStatus="loaded"),this.when(()=>{this.handles.add(Kt(()=>{var t;return{vertexAttributes:this.vertexAttributes,components:(t=this.components)==null?void 0:t.map(r=>r.clone())}},()=>this._set("external",null),{once:!0,sync:!0}))})}get hasExtent(){return!this.loaded&&c(this.external)&&c(this.external.extent)||this.loaded&&this.vertexAttributes.position.length>0&&(!this.components||this.components.length>0)}get _boundingInfo(){const t=this.vertexAttributes.position,r=this.spatialReference;if(t.length===0||this.components&&this.components.length===0)return{extent:new it({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:r}),center:new L({x:0,y:0,z:0,spatialReference:r})};const e=c(this.transform)?this.transform.project(t,r):t;let n=1/0,o=1/0,s=1/0,i=-1/0,a=-1/0,l=-1/0,f=0,p=0,m=0;const h=e.length,u=1/(h/3);let v=0;for(;v<h;){const O=e[v++],d=e[v++],$=e[v++];n=Math.min(n,O),o=Math.min(o,d),s=Math.min(s,$),i=Math.max(i,O),a=Math.max(a,d),l=Math.max(l,$),f+=u*O,p+=u*d,m+=u*$}return{extent:new it({xmin:n,ymin:o,zmin:s,xmax:i,ymax:a,zmax:l,spatialReference:r}),center:new L({x:f,y:p,z:m,spatialReference:r})}}get anchor(){if(c(this.transform))return this.transform.getOriginPoint(this.spatialReference);const t=this._boundingInfo;return new L({x:t.center.x,y:t.center.y,z:t.extent.zmin,spatialReference:this.spatialReference})}get origin(){return c(this.transform)?this.transform.getOriginPoint(this.spatialReference):this._boundingInfo.center}get extent(){return!this.loaded&&c(this.external)&&c(this.external.extent)?this.external.extent.clone():this._boundingInfo.extent}addComponent(t){this.loaded?(this.components||(this.components=[]),this.components.push(G.from(t)),this.notifyChange("components")):x.getLogger(this.declaredClass).error("addComponent()","Mesh must be loaded before applying operations")}removeComponent(t){if(this.loaded){if(this.components){const r=this.components.indexOf(t);if(r!==-1)return this.components.splice(r,1),void this.notifyChange("components")}x.getLogger(this.declaredClass).error("removeComponent()","Provided component is not part of the list of components")}else x.getLogger(this.declaredClass).error("removeComponent()","Mesh must be loaded before applying operations")}rotate(t,r,e,n){return X(ot.x,t,T),X(ot.y,r,Mt),X(ot.z,e,Lt),at(T,Mt,T),at(T,Lt,T),De(this,T,n),this}offset(t,r,e,n){return this.loaded?(W[0]=t,W[1]=r,W[2]=e,Ae(this,W,n),this):(x.getLogger(this.declaredClass).error("offset()","Mesh must be loaded before applying operations"),this)}scale(t,r){return this.loaded?(Ue(this,t,r),this):(x.getLogger(this.declaredClass).error("scale()","Mesh must be loaded before applying operations"),this)}centerAt(t,r){return this.loaded?(fe(this,t,r),this):(x.getLogger(this.declaredClass).error("centerAt()","Mesh must be loaded before applying operations"),this)}load(t){return c(this.external)&&this.addResolvingPromise(ye(this,this.external.source,t)),Promise.resolve(this)}updateExternalSource(t){this._set("external",t)}clone(){let t=null;if(this.components){const e=new Map,n=new Map;t=this.components.map(o=>o.cloneWithDeduplication(e,n))}const r={components:t,spatialReference:this.spatialReference,vertexAttributes:this.vertexAttributes.clone(),transform:c(this.transform)?this.transform.clone():null,external:c(this.external)?{source:this.external.source,extent:c(this.external.extent)?this.external.extent.clone():null}:null};return new M(r)}vertexAttributesChanged(){this.notifyChange("vertexAttributes")}async toBinaryGLTF(t){const r=Y(()=>import("./gltfexport-c663ec54.js"),["assets/gltfexport-c663ec54.js","assets/request-6fc81c4c.js","assets/preload-helper-3bce6601.js","assets/Error-ec6249b9.js","assets/string-a318751c.js","assets/typedArrayUtil-4d7bb04c.js","assets/promiseUtils-1e54421e.js","assets/Extent-da876e26.js","assets/cast-fcb46737.js","assets/ArrayPool-a8ee9378.js","assets/nextTick-3ee5a785.js","assets/Ellipsoid-89682c5e.js","assets/quat-3d5eec2d.js","assets/mat3f64-c6305894.js","assets/quatf64-7fd38d64.js","assets/vec3f64-2f9cef06.js","assets/common-c186b691.js","assets/vec3-e93e648f.js","assets/vec4-790471c0.js","assets/MeshComponent-a43522cc.js","assets/earcut-58237617.js","assets/Polyline-ff2d7c6b.js","assets/deduplicate-03981d62.js","assets/mathUtils-b4bb77e2.js","assets/Color-fb64d77d.js","assets/colorUtils-639f4d25.js","assets/persistableUrlUtils-5f719c3b.js","assets/georeference-74362e92.js","assets/unitUtils-45d1147c.js","assets/jsonMap-7b8332c9.js","assets/mat4-44a0988f.js","assets/mat4f64-1e28eae0.js","assets/mat3-3fc68e72.js","assets/projection-290b739f.js","assets/SimpleObservable-23231131.js","assets/assets-8d3e737a.js","assets/aaBoundingRect-193543b5.js","assets/zscale-89472cba.js","assets/projection-a69d43d0.js","assets/BufferView-903d1848.js","assets/vec2-528adfe4.js","assets/vec33-e98769e8.js","assets/enums-64ab819c.js","assets/imageutils-c0676a73.js"]),e=this.load(),n=await Promise.all([r,e]),{toBinaryGLTF:o}=n[0];return o(this,t)}static createBox(t,r){if(!(t instanceof L))return x.getLogger(C).error(".createBox()","expected location to be a Point instance"),null;const e=new M(J(Le(),t,r));return r&&r.imageFace&&r.imageFace!=="all"?Oe(e,r.imageFace):e}static createSphere(t,r){return t instanceof L?new M(J(Pe(r&&r.densificationFactor||0),t,r)):(x.getLogger(C).error(".createSphere()","expected location to be a Point instance"),null)}static createCylinder(t,r){return t instanceof L?new M(J(Ee(r&&r.densificationFactor||0),t,r)):(x.getLogger(C).error(".createCylinder()","expected location to be a Point instance"),null)}static createPlane(t,r){if(!(t instanceof L))return x.getLogger(C).error(".createPlane()","expected location to be a Point instance"),null;const e=(r==null?void 0:r.facing)??"up",n=Ie(e,r==null?void 0:r.size);return new M(J(_e(e),t,{...r,size:n}))}static createFromPolygon(t,r){if(!(t instanceof Qt))return x.getLogger(C).error(".createFromPolygon()","expected polygon to be a Polygon instance"),null;const e=ee(t);return new M({vertexAttributes:new H({position:e.position}),components:[new G({faces:e.faces,shading:"flat",material:(r==null?void 0:r.material)??null})],spatialReference:t.spatialReference})}static async createFromGLTF(t,r,e){if(!(t instanceof L))throw x.getLogger(C).error(".createfromGLTF()","expected location to be a Point instance"),new st("invalid-input","Expected location to be a Point instance");const{loadGLTFMesh:n}=await pt(Y(()=>import("./loadGLTFMesh-14d35214.js"),["assets/loadGLTFMesh-14d35214.js","assets/Color-fb64d77d.js","assets/colorUtils-639f4d25.js","assets/mathUtils-b4bb77e2.js","assets/vec3-e93e648f.js","assets/vec3f64-2f9cef06.js","assets/common-c186b691.js","assets/vec4-790471c0.js","assets/typedArrayUtil-4d7bb04c.js","assets/ArrayPool-a8ee9378.js","assets/string-a318751c.js","assets/Error-ec6249b9.js","assets/request-6fc81c4c.js","assets/preload-helper-3bce6601.js","assets/promiseUtils-1e54421e.js","assets/mat3-3fc68e72.js","assets/mat3f64-c6305894.js","assets/vec4f64-e407da96.js","assets/MeshComponent-a43522cc.js","assets/earcut-58237617.js","assets/Polyline-ff2d7c6b.js","assets/cast-fcb46737.js","assets/nextTick-3ee5a785.js","assets/Extent-da876e26.js","assets/Ellipsoid-89682c5e.js","assets/deduplicate-03981d62.js","assets/persistableUrlUtils-5f719c3b.js","assets/BufferView-903d1848.js","assets/vec2-528adfe4.js","assets/vec33-e98769e8.js","assets/DefaultMaterial_COLOR_GAMMA-fe26fda8.js","assets/types-e1c0a5bf.js","assets/asyncUtils-437defc4.js","assets/mat4f64-1e28eae0.js","assets/enums-64ab819c.js","assets/Version-2946cc03.js","assets/mat4-44a0988f.js","assets/quat-3d5eec2d.js","assets/quatf64-7fd38d64.js","assets/compilerUtils-18d58939.js","assets/georeference-74362e92.js","assets/unitUtils-45d1147c.js","assets/jsonMap-7b8332c9.js","assets/projection-290b739f.js","assets/SimpleObservable-23231131.js","assets/assets-8d3e737a.js","assets/aaBoundingRect-193543b5.js","assets/zscale-89472cba.js","assets/projection-a69d43d0.js"]),e);return new M(await n(t,r,e))}static createWithExternalSource(t,r,e){var i;const n=(e==null?void 0:e.extent)??null,o=((i=e==null?void 0:e.transform)==null?void 0:i.clone())??new q;o.origin=[t.x,t.y,t.z??0];const s=t.spatialReference;return new M({external:{source:r,extent:n},transform:o,spatialReference:s})}static createIncomplete(t,r){var s;const e=((s=r==null?void 0:r.transform)==null?void 0:s.clone())??new q;e.origin=[t.x,t.y,t.z??0];const n=t.spatialReference,o=new M({transform:e,spatialReference:n});return o.addResolvingPromise(Promise.reject(new st("mesh-incomplete","Mesh resources are not complete"))),o}};A([F({type:[G],json:{write:!0}})],w.prototype,"components",void 0),A([F({type:q,json:{write:!0}})],w.prototype,"transform",void 0),A([F({constructOnly:!0})],w.prototype,"external",void 0),A([F({readOnly:!0})],w.prototype,"hasExtent",null),A([F({readOnly:!0})],w.prototype,"_boundingInfo",null),A([F({readOnly:!0})],w.prototype,"anchor",null),A([F({readOnly:!0})],w.prototype,"origin",null),A([F({readOnly:!0,json:{read:!1}})],w.prototype,"extent",null),A([F({readOnly:!0,json:{read:!1,write:!0,default:!0}})],w.prototype,"hasZ",void 0),A([F({readOnly:!0,json:{read:!1,write:!0,default:!1}})],w.prototype,"hasM",void 0),A([F({type:H,nonNullable:!0,json:{write:!0}})],w.prototype,"vertexAttributes",void 0),w=M=A([Vt(C)],w);const ot={x:nt(1,0,0),y:nt(0,1,0),z:nt(0,0,1)},T=V(),Mt=V(),Lt=V(),W=y(),Ot=w;function yn(t,r,e){const n=e.features;e.features=[],delete e.geometryType;const o=pe.fromJSON(e);if(o.geometryType="mesh",!e.assetMaps)return o;const s=Ye(r,e.assetMaps),i=o.spatialReference,a=e.globalIdFieldName,l=Z(t.outFields)||!t.outFields.length?()=>({}):Ve(t.outFields.includes("*")?null:new Set(t.outFields));for(const f of n){const p=Je(f,a,i,r,s);c(p)&&o.features.push(new Bt({geometry:p,attributes:l(f)}))}return o}function Ve(t){return({attributes:r})=>{if(!r)return{};if(!t)return r;for(const e in r)t.has(e)||delete r[e];return r}}function Je(t,r,e,n,o){const s=t.attributes[r],i=o.get(s);if(i==null||i.status===I.FAILED||i.url==null)return null;const a=We(t,e,n),l=it.fromJSON(t.geometry);l.spatialReference=e;const f=Xe(t.attributes,n,i.geographic);return i.status===I.PENDING?Ot.createIncomplete(a,{extent:l,transform:f}):Ot.createWithExternalSource(a,[{name:i.name,source:i.url}],{extent:l,transform:f})}function We({attributes:t},r,{transformFieldRoles:e}){return new L({x:t[e.originX],y:t[e.originY],z:t[e.originZ],spatialReference:r})}function Xe(t,{transformFieldRoles:r},e){return new q({translation:[t[r.translationX],t[r.translationY],t[r.translationZ]],rotation:X([t[r.rotationX],t[r.rotationY],t[r.rotationZ]],t[r.rotationDeg]),scale:[t[r.scaleX],t[r.scaleY],t[r.scaleZ]],geographic:e})}var I;function Ye(t,r){const e=new Map;for(const n of r){const o=n.parentGlobalId;if(o==null)continue;const s=n.assetName,i=n.assetURL,a=n.conversionStatus;let l=e.get(o);if(l!=null)throw new Error("multiple asset parts not expected.");switch(l={name:s,status:I.FAILED,url:i,geographic:He(n.flags).projectVertices},e.set(o,l),a){case"COMPLETED":case"SUBMITTED":l.status=I.COMPLETED;break;case"INPROGRESS":l.status=I.PENDING;break;default:l.status=I.FAILED}}return e}function He(t){return{projectVertices:t.includes("PROJECT_VERTICES")}}(function(t){t[t.FAILED=0]="FAILED",t[t.PENDING=1]="PENDING",t[t.COMPLETED=2]="COMPLETED"})(I||(I={}));export{yn as meshFeatureSetFromJSON};
