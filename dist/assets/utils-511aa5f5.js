import{_ as N}from"./preload-helper-3bce6601.js";import{s as U}from"./jsonMap-7b8332c9.js";import{t as S,r as E}from"./typedArrayUtil-4d7bb04c.js";import{X as G}from"./unitUtils-45d1147c.js";import{A as b}from"./projection-290b739f.js";import{n as J}from"./Polyline-ff2d7c6b.js";import{v as z,u as $,y as B,f as I}from"./jsonUtils-229211af.js";import{v as Z}from"./normalizeUtils-27e29a72.js";import{E as k,l as q,e as P,F as _}from"./Extent-da876e26.js";import{h as D,a as p,I as V,F as y,$ as j,D as C,O as K}from"./featureConversionUtils-03a03f40.js";import{t as g}from"./OptimizedFeature-4ab8d380.js";import{f as v,g as O}from"./projectionSupport-aa5eaa0d.js";const L=new U({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),x=Object.freeze({}),F=new g,T=new g,R=new g,l={esriGeometryPoint:y,esriGeometryPolyline:j,esriGeometryPolygon:C,esriGeometryMultipoint:K};function ct(t,n,a,r=t.hasZ,e=t.hasM){if(S(n))return null;const s=t.hasZ&&r,o=t.hasM&&e;if(a){const i=p(R,n,t.hasZ,t.hasM,"esriGeometryPoint",a,r,e);return y(i,s,o)}return y(n,s,o)}function pt(t,n,a,r,e,s,o=n,i=a){var h,w,d;const u=n&&o,m=a&&i,f=E(r)?"coords"in r?r:r.geometry:null;if(S(f))return null;if(e){let c=D(T,f,n,a,t,e,o,i);return s&&(c=p(R,c,u,m,t,s)),((h=l[t])==null?void 0:h.call(l,c,u,m))??null}if(s){const c=p(R,f,n,a,t,s,o,i);return((w=l[t])==null?void 0:w.call(l,c,u,m))??null}return V(F,f,n,a,o,i),((d=l[t])==null?void 0:d.call(l,F,u,m))??null}async function yt(t,n,a){const{outFields:r,orderByFields:e,groupByFieldsForStatistics:s,outStatistics:o}=t;if(r)for(let i=0;i<r.length;i++)r[i]=r[i].trim();if(e)for(let i=0;i<e.length;i++)e[i]=e[i].trim();if(s)for(let i=0;i<s.length;i++)s[i]=s[i].trim();if(o)for(let i=0;i<o.length;i++)o[i].onStatisticField&&(o[i].onStatisticField=o[i].onStatisticField.trim());return t.geometry&&!t.outSR&&(t.outSR=t.geometry.spatialReference),X(t,n,a)}async function X(t,n,a){var s;if(!t)return null;let{where:r}=t;if(t.where=r=r&&r.trim(),(!r||/^1 *= *1$/.test(r)||n&&n===r)&&(t.where=null),!t.geometry)return t;let e=await Q(t);if(t.distance=0,t.units=null,t.spatialRel==="esriSpatialRelEnvelopeIntersects"){const{spatialReference:o}=t.geometry;e=J(e),e.spatialReference=o}if(e){await v(e.spatialReference,a),e=H(e,a);const o=(await Z(z(e)))[0];if(S(o))throw x;const i="quantizationParameters"in t&&((s=t.quantizationParameters)==null?void 0:s.tolerance)||"maxAllowableOffset"in t&&t.maxAllowableOffset||0,u=i&&M(e,a)?{densificationStep:8*i}:void 0,m=o.toJSON(),f=await O(m,m.spatialReference,a,u);if(!f)throw x;f.spatialReference=a,t.geometry=f}return t}function M(t,n){if(!t)return!1;const a=t.spatialReference;return($(t)||B(t)||I(t))&&!k(a,n)&&!b(a,n)}function H(t,n){const a=t.spatialReference;return M(t,n)&&$(t)?{spatialReference:a,rings:[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]}:t}async function Q(t){const{distance:n,units:a}=t,r=t.geometry;if(n==null||"vertexAttributes"in r)return r;const e=r.spatialReference,s=a?L.fromJSON(a):G(e),o=e&&(q(e)||P(e))?r:await v(e,_).then(()=>O(r,_));return(await W())(o.spatialReference,o,n,s)}async function W(){return(await N(()=>import("./geometryEngineJSON-a45b7108.js"),["assets/geometryEngineJSON-a45b7108.js","assets/geometryEngineBase-3dd302e0.js","assets/geometryEngineJSON-45c195fe.js","assets/json-48e3ea08.js"])).geodesicBuffer}function Rt(t){return t&&A in t?JSON.parse(JSON.stringify(t,Y)):t}const A="_geVersion",Y=(t,n)=>t!==A?n:void 0;export{Rt as E,x as F,X as J,ct as b,pt as v,yt as z};
