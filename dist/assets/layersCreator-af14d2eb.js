import{j as d}from"./Collection-910b6f71.js";import"./string-a318751c.js";import{E as T}from"./promiseUtils-1e54421e.js";import{a as n}from"./lazyLayerLoader-41b90a4f.js";import f from"./PortalItem-bb7e98a6.js";import{selectLayerClassPath as g}from"./portalLayers-bc22a371.js";import{t as G}from"./styleUtils-a989c0af.js";import"./cast-fcb46737.js";import"./typedArrayUtil-4d7bb04c.js";import"./Error-ec6249b9.js";import"./ArrayPool-a8ee9378.js";import"./nextTick-3ee5a785.js";import"./Evented-a45c8b0f.js";import"./SimpleObservable-23231131.js";import"./preload-helper-3bce6601.js";import"./assets-8d3e737a.js";import"./request-6fc81c4c.js";import"./Loadable-268c900a.js";import"./Promise-376ab9f6.js";import"./Extent-da876e26.js";import"./Ellipsoid-89682c5e.js";import"./Portal-2bb189b3.js";import"./locale-30120714.js";import"./PortalGroup-8e41557a.js";import"./jsonMap-7b8332c9.js";import"./PortalUser-659cc1d2.js";import"./layersLoader-89454f28.js";import"./Layer-5ffe0eda.js";import"./geometry-b7901087.js";import"./Polyline-ff2d7c6b.js";import"./typeUtils-35750739.js";import"./Identifiable-bfe1ff30.js";import"./arcgisLayerUrl-c09f09b4.js";import"./persistableUrlUtils-5f719c3b.js";import"./jsonContext-a007a25f.js";import"./portalItemUtils-2ccd793f.js";import"./projection-290b739f.js";import"./mathUtils-b4bb77e2.js";import"./vec3-e93e648f.js";import"./vec3f64-2f9cef06.js";import"./common-c186b691.js";import"./vec4-790471c0.js";import"./unitUtils-45d1147c.js";import"./mat4-44a0988f.js";import"./aaBoundingRect-193543b5.js";import"./zscale-89472cba.js";import"./asyncUtils-437defc4.js";function M(e){return s(e,"notes")}function A(e){return s(e,"markup")}function v(e){return s(e,"route")}function s(e,r){return!(!e.layerType||e.layerType!=="ArcGISFeatureLayer")&&e.featureCollectionType===r}async function w(e,r,a){if(!r)return;const i=[];for(const t of r){const y=B(t,a);t.layerType==="GroupLayer"?i.push(x(y,t,a)):i.push(y)}const o=await T(i);for(const t of o)!t.value||a.filter&&!a.filter(t.value)||e.add(t.value)}const b={ArcGISDimensionLayer:"DimensionLayer",ArcGISFeatureLayer:"FeatureLayer",ArcGISImageServiceLayer:"ImageryLayer",ArcGISMapServiceLayer:"MapImageLayer",PointCloudLayer:"PointCloudLayer",ArcGISSceneServiceLayer:"SceneLayer",IntegratedMeshLayer:"IntegratedMeshLayer",OGCFeatureLayer:"OGCFeatureLayer",BuildingSceneLayer:"BuildingSceneLayer",ArcGISTiledElevationServiceLayer:"ElevationLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",ArcGISTiledMapServiceLayer:"TileLayer",GroupLayer:"GroupLayer",GeoJSON:"GeoJSONLayer",WebTiledLayer:"WebTileLayer",CSV:"CSVLayer",VectorTileLayer:"VectorTileLayer",WFS:"WFSLayer",WMS:"WMSLayer",DefaultTileLayer:"TileLayer",KML:"KMLLayer",RasterDataLayer:"UnsupportedLayer",Voxel:"VoxelLayer",LineOfSightLayer:"LineOfSightLayer"},W={ArcGISTiledElevationServiceLayer:"ElevationLayer",DefaultTileLayer:"ElevationLayer",RasterDataElevationLayer:"UnsupportedLayer"},F={ArcGISTiledMapServiceLayer:"TileLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",OpenStreetMap:"OpenStreetMapLayer",WebTiledLayer:"WebTileLayer",VectorTileLayer:"VectorTileLayer",ArcGISImageServiceLayer:"UnsupportedLayer",WMS:"UnsupportedLayer",ArcGISMapServiceLayer:"UnsupportedLayer",DefaultTileLayer:"TileLayer"},C={ArcGISAnnotationLayer:"UnsupportedLayer",ArcGISDimensionLayer:"UnsupportedLayer",ArcGISFeatureLayer:"FeatureLayer",ArcGISImageServiceLayer:"ImageryLayer",ArcGISImageServiceVectorLayer:"ImageryLayer",ArcGISMapServiceLayer:"MapImageLayer",ArcGISStreamLayer:"StreamLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",ArcGISTiledMapServiceLayer:"TileLayer",BingMapsAerial:"BingMapsLayer",BingMapsRoad:"BingMapsLayer",BingMapsHybrid:"BingMapsLayer",CSV:"CSVLayer",DefaultTileLayer:"TileLayer",GeoRSS:"GeoRSSLayer",GeoJSON:"GeoJSONLayer",GroupLayer:"GroupLayer",KML:"KMLLayer",OGCFeatureLayer:"OGCFeatureLayer",OrientedImageryLayer:"OrientedImageryLayer",SubtypeGroupLayer:"SubtypeGroupLayer",VectorTileLayer:"VectorTileLayer",WFS:"WFSLayer",WMS:"WMSLayer",WebTiledLayer:"WebTileLayer"},O={ArcGISFeatureLayer:"FeatureLayer"},V={ArcGISImageServiceLayer:"ImageryLayer",ArcGISImageServiceVectorLayer:"ImageryLayer",ArcGISMapServiceLayer:"MapImageLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",ArcGISTiledMapServiceLayer:"TileLayer",OpenStreetMap:"OpenStreetMapLayer",VectorTileLayer:"VectorTileLayer",WebTiledLayer:"WebTileLayer",BingMapsAerial:"BingMapsLayer",BingMapsRoad:"BingMapsLayer",BingMapsHybrid:"BingMapsLayer",WMS:"WMSLayer",DefaultTileLayer:"TileLayer"};async function B(e,r){return h(await D(e,r),e,r)}async function h(e,r,a){const i=new e;return i.read(r,a.context),i.type==="group"&&S(r)&&await k(i,r,a.context),await G(i,a.context),i}async function D(e,r){const a=r.context,i=U(a);let o=e.layerType||e.type;!o&&r&&r.defaultLayerType&&(o=r.defaultLayerType);const t=i[o];let y=t?n[t]:n.UnknownLayer;if(I(e)){const l=a==null?void 0:a.portal;if(e.itemId){const L=new f({id:e.itemId,portal:l});await L.load();const p=(await g(L)).className||"UnknownLayer";y=n[p]}}else o==="ArcGISFeatureLayer"?M(e)||A(e)?y=n.MapNotesLayer:v(e)?y=n.RouteLayer:S(e)&&(y=n.GroupLayer):e.wmtsInfo&&e.wmtsInfo.url&&e.wmtsInfo.layerIdentifier?y=n.WMTSLayer:o==="WFS"&&e.wfsInfo.version!=="2.0.0"&&(y=n.UnsupportedLayer);return y()}function S(e){var r,a;return e.layerType!=="ArcGISFeatureLayer"||I(e)?!1:(((a=(r=e.featureCollection)==null?void 0:r.layers)==null?void 0:a.length)??0)>1}function I(e){return e.type==="Feature Collection"}function U(e){let r;if(e.origin==="web-scene")switch(e.layerContainerType){case"basemap":r=F;break;case"ground":r=W;break;default:r=b}else switch(e.layerContainerType){case"basemap":r=V;break;case"tables":r=O;break;default:r=C}return r}async function x(e,r,a){const i=new d,o=w(i,Array.isArray(r.layers)?r.layers:[],a),t=await e;if(await o,t.type==="group")return t.layers.addMany(i),t}async function k(e,r,a){const i=n.FeatureLayer,o=await i(),t=r.featureCollection,y=t.showLegend,l=t.layers.map((L,p)=>{var m;const c=new o;c.read(L,a);const u={...a,ignoreDefaults:!0};return c.read({id:`${e.id}-sublayer-${p}`,visibility:((m=r.visibleLayers)==null?void 0:m.includes(p))??!0},u),y!=null&&c.read({showLegend:y},u),c});e.layers.addMany(l)}export{w as populateOperationalLayers};
