import{e as h,y as p,n as N,m as ye,t as st,l as Mn,B as Ns,X as Ze,c as Xt}from"./cast-fcb46737.js";import{j as rt}from"./Collection-910b6f71.js";import{s as $n}from"./Error-ec6249b9.js";import{r as f,t as y,i as Qe,s as _t,e as ne,p as yt,h as bn,o as Gs}from"./typedArrayUtil-4d7bb04c.js";import{l as E,w as Y,h as Ut,U as Ke,f as Li,a as Wi}from"./reactiveUtils-4dabbb80.js";import{n as Zs}from"./ArrayPool-a8ee9378.js";import{n as ti,c as Ee,b as Ys,d as qs,a as js}from"./LineVisualElement-bccf172d.js";import{t as $,r as Xs,u as Us}from"./LengthDimension-6eb29622.js";import{a as Ws,I as Bs,p as Js,Z as Qs,v as Ks,N as er,d as tr,E as ir}from"./unitUtils-45d1147c.js";import{m as Bi,b as nr,g as Le}from"./mathUtils-b4bb77e2.js";import{a as sr,v as Cn,l as He,f as ct,c as rr,u as Tn,d as q,g as or,b as ar}from"./Segment-2acc0e69.js";import{g as Ji,r as lr,i as On,x as cr}from"./mat4-44a0988f.js";import{e as Ai}from"./mat4f64-1e28eae0.js";import{x as qt,o as se,r as V,O as Qi,J as C,_ as ee,P as D,G as Rn,z as Ln,q as ce,X as Ki,v as yi,g as bt,F as et,s as Hi,e as ot,j as dr,u as An,p as vt,A as hr,Y as en,Z as vi}from"./vec3-e93e648f.js";import{n as v,f as tt,r as B,t as St}from"./vec3f64-2f9cef06.js";import{c as M,n as ur,d as pr,h as li}from"./sphere-2af0d852.js";import{v as mr}from"./dehydratedFeatures-0557137d.js";import{b3 as Ue,b4 as fr,b5 as it,b6 as mt,aV as Re,aT as De,b7 as gr,as as _r,b8 as yr,x as vr,t as Sr,b9 as wr,ba as Hn,aW as xr,aX as Pr}from"./index-a864af46.js";import{A as Er,j as ci,r as tn,_ as Mr}from"./projection-290b739f.js";import{E as $r,w as ft}from"./Extent-da876e26.js";import{L as br,f as Cr,p as Tr,g as Dn,x as zn,t as Or}from"./promiseUtils-1e54421e.js";import{l as R}from"./Color-fb64d77d.js";import"./geometry-b7901087.js";import{s as Si}from"./Cyclical-151bcc41.js";import{u as le,i as Ct}from"./screenUtils-410d12c0.js";import{_ as wi,p as xi,R as nn,Y as Rr}from"./plane-b575face.js";import{U as Lr,i as Vn,x as In,R as Ar,T as Hr,d as Tt,D as Di,w as zi,z as Dr,G as Pi,v as sn,a as zr,s as Vr,m as Ir,c as Fr}from"./analysisViewUtils-ae3c8eee.js";import{B as kr,C as Fn,z as Vi,o as Nr}from"./Factory-265a09f6.js";import{m as Gr,f as Zr,s as Yr}from"./MarkerSizing.glsl-566261cc.js";import{d as Ii}from"./HandleOwner-9b396af1.js";import{y as qr,w as Ei}from"./string-a318751c.js";import{D as We,a as wt}from"./vec4-790471c0.js";import{r as Wt,i as kn}from"./DefaultVertexAttributeLayouts-2bcf3941.js";import{a as jr,b as Xr,c as Ur,d as Wr,A as Br}from"./Octree-0a267ea2.js";import{v as Jr,b as di,l as Fe}from"./lineSegment-10422ca0.js";import{d as Qr,S as rn}from"./PointVisualElement-b23705fb.js";import{c as b}from"./VisualVariablePassParameters-d460182b.js";import{O as Nn}from"./VertexAttribute-9c5c630d.js";import{v as Kr,o as de,l as hi,r as eo,s as At,p as xt,j as Ot,d as Ae,C as to,k as io,b as on,A as Gn,m as Zn}from"./vec2-528adfe4.js";import{S as no}from"./RightAngleQuadVisualElement-77ea66a2.js";import{x as so,h as Yn,E as O,g as ro}from"./elevationInfoUtils-36e5dd0f.js";import{y as oo,p as ao}from"./colorUtils-0c057879.js";import{e as lo,l as dt}from"./vec4f64-e407da96.js";import{n as an}from"./basicInterfaces-19ed850e.js";import{p as co}from"./ImageMaterial-85877c86.js";import{b as I,L as ui,m as ho,V as uo,g as po,w as mo}from"./EditGeometryOperations-464d8964.js";import{t as fo}from"./nextTick-3ee5a785.js";import{_ as Ht}from"./preload-helper-3bce6601.js";import{q as ln}from"./QueryEngineResult-8f90b8dc.js";import{t as go,n as ze}from"./vec2f64-30dc1443.js";import{n as _o}from"./Evented-a45c8b0f.js";import{i as yo}from"./dehydratedFeatureComparison-59868945.js";import{I as qn,y as jn}from"./Scheduler-540208b6.js";import"./intl-65a3e389.js";import{r as vo}from"./RenderTexture-a15e38d0.js";import{s as So}from"./locale-30120714.js";import{u as wo}from"./messages-2289086c.js";function xo(i){const e=Ws(i),t=e===Bs?Js:e;return Er(i,t)?t:i}var Be;function Po(i,e){const{spatialReference:t}=i;return $r(t,e.spatialReference)?(Dt[0]=i.x,Dt[1]=i.y,Dt[2]=i.hasZ?i.z:0,zt[0]=e.x,zt[1]=e.y,zt[2]=e.hasZ?e.z:0,Xn(Dt,zt,t)):null}function Xn(i,e,t){const n=Eo(i,e,t,Be.Direct);return f(n)?sr(n.direct,n.unit):null}function Eo(i,e,t,n){const s=xo(t),r=Qs(s);if(y(r))return null;const o=e[2]-i[2];if(n===Be.Vertical)return{verticalSigned:o,unit:r};if(!ci(i,t,pi,s)||!ci(e,t,Vt,s))return null;if(n===Be.Direct)return{direct:qt(Vt,pi),unit:r};if(se(It,i[0],i[1],e[2]),!ci(It,t,It,s))return null;const a=qt(It,Vt);return n===Be.Horizontal?{horizontal:a,unit:r}:{direct:qt(Vt,pi),horizontal:a,vertical:Math.abs(o),unit:r}}(function(i){i[i.Direct=0]="Direct",i[i.Horizontal=1]="Horizontal",i[i.Vertical=2]="Vertical"})(Be||(Be={}));const Dt=v(),zt=v(),pi=v(),Vt=v(),It=v();function Mo(i,e,t){if(y(i))return null;const n=i.dimensionSegment.startRenderSpace,s=i.dimensionSegment.endRenderSpace,r=Xn(n,s,i.spatialReference);if(y(r))return null;const o=e===$.Vertical?Ks(r.value,r.unit,t):er(r.value,r.unit,t);return Cn(r,o)}function Bt(i){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t,dimension:{offset:n,measureType:s,orientation:r}}=i;return{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t,offset:n,measureType:s,orientation:r}}function Jt({elevationAlignedStartPoint:i,elevationAlignedEndPoint:e,offset:t,measureType:n,orientation:s},r,o=null){if(y(i)||y(e))return null;const a=Wn(f(o)?o.directSegment:new He,{elevationAlignedStartPoint:i,elevationAlignedEndPoint:e},r),l=f(o)?o.primaryOffsetAxis:v();ii(l,{measureType:n,elevationAlignedStartPoint:i,elevationAlignedEndPoint:e,directSegment:a,orientation:s,renderCoordsHelper:r});const c=f(o)?o.dimensionSegment:new He;return Fi({elevationAlignedStartPoint:i,elevationAlignedEndPoint:e})&&n===$.Vertical?(V(c.startRenderSpace,a.startRenderSpace),V(c.endRenderSpace,a.endRenderSpace)):Bn(c,{offsetAxis:l,offset:t,relativeToSegment:a,renderCoordsHelper:r}),{directSegment:a,dimensionSegment:c,primaryOffsetAxis:l,spatialReference:r.spatialReference}}function cn(i,e,t,n){return e===Pt.Start?(V(i.startRenderSpace,t.startRenderSpace),V(i.endRenderSpace,n.startRenderSpace)):(V(i.startRenderSpace,t.endRenderSpace),V(i.endRenderSpace,n.endRenderSpace)),i}var Pt;function $o(i,e,t,n){ce(i.startRenderSpace,e.startRenderSpace,t,n),ce(i.endRenderSpace,e.endRenderSpace,t,n)}function Un(i,e,t,n){switch(e){case $.Direct:return Wn(i,t,n);case $.Horizontal:case $.Vertical:{const{elevationAlignedStartPoint:s,elevationAlignedEndPoint:r,dimension:o,geometry:a}=t;let l;o.measureType===$.Direct?(l=bo(a,n)===s.z>r.z,e===$.Horizontal&&(l=!l)):l=!Co(a);const[c,d]=l?[s,r]:[r,s],u=Ue(d,To);return e===$.Horizontal?u.z=c.z:(u.x=c.x,u.y=c.y),n.toRenderCoords(c,i.startRenderSpace),n.toRenderCoords(u,i.endRenderSpace),i}}}function Wn(i,e,t){return t.toRenderCoords(e.elevationAlignedStartPoint,i.startRenderSpace),t.toRenderCoords(e.elevationAlignedEndPoint,i.endRenderSpace),i}function bo(i,e){const t=i.directSegment.eval(.5,M.get()),n=e.worldUpAtPosition(t,M.get()),s=i.dimensionSegment.eval(.5,M.get()),r=C(M.get(),s,t);return!Rn(r,tt)&&D(r,n)>0}function Co(i){const{startRenderSpace:e,endRenderSpace:t}=i.dimensionSegment,{startRenderSpace:n,endRenderSpace:s}=i.directSegment;return Ki(n,e)<Ki(s,t)}(function(i){i[i.Start=0]="Start",i[i.End=1]="End"})(Pt||(Pt={}));const To=mr(0,0,0,null);function Oo(i,e,t,n){const{directSegment:s}=t,r=ii(M.get(),{measureType:e,directSegment:s,renderCoordsHelper:n}),o=Bn(Ro,{offsetAxis:r,offset:0,relativeToSegment:s,renderCoordsHelper:n}).eval(.5,M.get()),a=C(M.get(),i,o);return D(a,r)*n.unitInMeters}const Ro=new He;function ii(i,e){const{measureType:t,elevationAlignedStartPoint:n,elevationAlignedEndPoint:s,directSegment:{startRenderSpace:r,endRenderSpace:o},directSegment:a,renderCoordsHelper:l}=e,c=a.eval(.5,M.get()),d=l.worldUpAtPosition(c,M.get()),u=l.worldBasisAtPosition(c,ur.Y,M.get());switch(t){case $.Horizontal:V(i,d);break;case $.Vertical:D(r,d)<D(o,d)?C(i,o,r):C(i,r,o),ee(i,i,d),ee(i,i,d);break;case $.Direct:{const m=Qe(e.orientation,0);if(Fi({elevationAlignedStartPoint:n,elevationAlignedEndPoint:s}))Ji(Ft,-Bi(m),d),Qi(i,u,Ft);else{const _=C(M.get(),o,r),g=ee(M.get(),_,d);ee(g,g,_),Ji(Ft,Bi(m),_),Qi(i,g,Ft)}break}}return Rn(i,tt)?V(i,u):Ln(i,i)}const Ft=Ai();function Fi({elevationAlignedStartPoint:i,elevationAlignedEndPoint:e}){return f(i)&&f(e)&&i.x===e.x&&i.y===e.y}function Bn(i,e){const{offsetAxis:t,offset:n,relativeToSegment:{startRenderSpace:s,endRenderSpace:r},relativeToSegment:o,renderCoordsHelper:a}=e,l=n/a.unitInMeters,[c,d]=Lo(s,r,t,l);return ce(i.startRenderSpace,o.startRenderSpace,t,c),ce(i.endRenderSpace,o.endRenderSpace,t,d),i}function Lo(i,e,t,n=0){const s=D(e,t),r=D(i,t),o=Math.abs(s-r)+n;return s>r?[o,n]:[n,o]}function ni(i,e,t){const n=e.directSegment.eval(.5,M.get());return t.worldUpAtPosition(n,i)}function ki(i,e){const{startRenderSpace:t,endRenderSpace:n}=e.directSegment;return C(i,n,t)}function Ni(i,e,t={invert:!1}){const{startRenderSpace:n,endRenderSpace:s}=e.dimensionSegment;return t.invert?C(i,n,s):C(i,s,n)}function Mi(i,e){const t=i.directSegment.eval(.5,M.get());return e.headingAtPosition(t,i.primaryOffsetAxis)}function Ao(i,e){return yi(Ni(Ho,i))/e**2}const Ho=v();function Jn(i){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t}=i;if(y(e)||y(t))return!1;const n=Po(e,t);return f(n)&&Cn(n,"meters").value>Qn}const Qn=1e5;function Et(i){return f(i.geometry)}let Me=class extends ye{constructor(e){super(e),this._handles=new st}initialize(){const{computations:e}=this.analysisViewData;for(const t of e)this._addComputation(t);this.addHandles(e.on("change",({added:t,removed:n})=>{for(const s of n)this._removeComputation(s);for(const s of t)this._addComputation(s)}))}destroy(){this._handles=_t(this._handles)}get analysis(){return this.analysisViewData.analysis}get _defaultUnit(){return tr(this.view)}_addComputation(e){this._handles.has(e)||this._handles.add(E(()=>Bt(e),t=>{const{measureType:n}=t;if(Jn(t)&&n!==$.Direct){const r=Math.round(ir(Qn,"meters","kilometers"));return $n.getLogger(this.declaredClass).warnOnce(`A ${n} dimension in the analysis (id: '${this.analysis.id}') will not display, because only direct dimensions can measure lengths greater than ${r} km. Update the measureType of the affected dimension to "direct" to display it.`),void(e.geometry=null)}const s=Jt(t,this.view.renderCoordsHelper,e.geometry);e.geometry=s,e.result.length=Mo(s,n,this._defaultUnit)},Y),e)}_removeComputation(e){this._handles.remove(e)}};h([p({constructOnly:!0})],Me.prototype,"analysisViewData",void 0),h([p({constructOnly:!0})],Me.prototype,"view",void 0),h([p()],Me.prototype,"analysis",null),h([p()],Me.prototype,"_defaultUnit",null),Me=h([N("esri.views.3d.analysis.Dimension.support.DimensionController")],Me);const Kn={main:new R([255,127,0])};let Do=class{constructor(){this.color=Kn.main,this.opacity=.5,this.radius=5}},zo=class{constructor(){this.color=new R([127,127,127]),this.opacity=.5,this.radius=5}},Vo=class{constructor(){this.lineSizeFraction=.8}},Io=class{constructor(){this.color=Kn.main,this.opacity=.5,this.linePaddingPx=4,this.focusedLinePaddingPx=6,this.lengthFraction=.5,this.minLengthMeters=.1}},Fo=class{constructor(){this.calloutOffsetPx=18,this.calloutOpacity=.5,this.calloutWidth=2,this.discScale=.3,this.focusMultiplier=2}},ko=class{constructor(){this.lineSizeFraction=.25}},No=class{constructor(){this.marginPx=20,this.minScreenLengthFontSizeFactor=5}},Go=class{constructor(){this.color=new R([255,127,0,.5])}},Zo=class{constructor(){this.pointManipulators=new Do,this.offsetManipulator=new Io,this.orientationManipulator=new Fo,this.markers=new Vo,this.labels=new No,this.offsetLine=new ko,this.constraint=new Go,this.constraintThresholdPx=10,this.initialOffsetPx=50,this.orientationSnapThresholdDegrees=5,this.disabledPointIndicator=new zo,this.smallScreenLengthLineSizeFactor=2,this.pointerMoveTimeoutMs=2500}};const T=new Zo;class Yo{constructor(e){this.start=e.start,this.end=e.end,this.offset=e.offset,this.heading=e.heading,this.rotation=e.rotation,this.direct=e.direct,this.horizontal=e.horizontal,this.vertical=e.vertical}manipulatorName(e){return Object.keys(this).find(t=>this.hasOwnProperty(t)&&e===this[t])}values(){return[this.start,this.end,this.offset,this.heading,this.rotation,this.direct,this.horizontal,this.vertical]}forEachMeasureTypeManipulator(e){for(const t of Xs)e(this.manipulatorForMeasureType(t),t)}manipulatorForMeasureType(e){switch(e){case $.Direct:return this.direct;case $.Horizontal:return this.horizontal;case $.Vertical:return this.vertical}}}function qo(i,e){const t=Lr(i,R.toUnitRGB(T.pointManipulators.color),T.pointManipulators.opacity,me);return t.available=!1,t.grabCursor="crosshair",t.radius=T.pointManipulators.radius,t.metadata=e.metadata,t.collisionPriority=1,t}function jo(i,e){const t=[B(-.5,0,0),B(.5,0,0)],{lengthFraction:n}=T.offsetManipulator,s=it(t.map(r=>bt(v(),r,n)));return new Vn({view:i,renderObjects:[{geometry:s,material:e.unfocusedMaterial,stateMask:mt.Unfocused|mt.Selected|me},{geometry:s,material:e.focusedMaterial,stateMask:mt.Focused|me}],collisionType:{type:"line",paths:[t]},radius:Gi(e.lineSizePt)/2,metadata:e.metadata,available:!1,...In})}function es(i,{lineSizePt:e,material:t}){const{calloutOffsetPx:n,calloutOpacity:s,calloutWidth:r,discScale:o,focusMultiplier:a}=T.orientationManipulator;return{calloutLength:.25*Gr*T.markers.lineSizeFraction*le(e)+n,calloutOpacity:s,calloutWidth:r,customStateMask:me,discScale:o,focusMultiplier:a,material:t,metadata:i}}function dn(i,e){return Ar(i,es(e.metadata,e))}function hn(i,e){Hr(i,es(i.metadata,e))}function Xo(i,e){const t=[B(-.5,0,0),B(.5,0,0)],{lengthFraction:n}=T.offsetManipulator,s=it(t),r=it(t.map(o=>bt(v(),o,n)));return new Vn({view:i,renderObjects:[{geometry:r,material:e.unfocusedMaterial,stateMask:mt.Unfocused|me},{geometry:r,material:e.focusedMaterial,stateMask:mt.Focused|me},{geometry:s,material:e.thinOffsetManipulatorMaterial,stateMask:me}],collisionType:{type:"line",paths:[t]},radius:Gi(e.lineSizePt)/2,available:!1,metadata:e.metadata,...In})}function Uo(i,{isStart:e,createSnappingPipelineStep:t,dimension:n,onUpdate:s,snappingPipeline:r,view:o}){const a=e?"startPoint":"endPoint";return[Tt(i,(c,d,u,m)=>{const _=Vi(c);u=u.next(_).next(zi(n,[a,"measureType","orientation"])),d.next(_).next(kr(o)).next(t(u,m),r.next).next(g=>{const S=Ue(g.mapEnd,new ft);s(a==="startPoint"?{startPoint:S}:{endPoint:S})})})]}function Wo(i,{computation:e,view:t}){return[Tt(i,(n,s,r)=>{if(!Et(e)||!n.selected)return;const{geometry:o,dimension:a}=e,l=Vi(n);s.next(l).next(is(t,a,o.dimensionSegment,o.primaryOffsetAxis)),r.next(l).next(zi(a,["offset"]))})]}function Bo(i,{computation:e,view:t}){return[Tt(i,(n,s,r)=>{ts({cancel:r,computation:e,settingHeading:!0,steps:s,view:t})})]}function Jo(i,{computation:e,view:t}){return[Tt(i,(n,s,r)=>{ts({cancel:r,computation:e,settingHeading:!1,steps:s,view:t})}),i.events.on("immediate-click",n=>{Qo(n,e,t)})]}function Qo(i,e,t){const{dimension:n,geometry:s}=e;if(n.orientation===90||n.orientation===270)return n.orientation=0,void i.stopPropagation();if(y(s))return;const{renderCoordsHelper:r}=t,o=Jt({...Bt(e),orientation:90},r),a=Jt({...Bt(e),orientation:270},r);if(y(o)||y(a))return;const l=Mi(o,r),c=Mi(a,r),d=ns(s,t),u=Si.shortestSignedDiff(d,l),m=Si.shortestSignedDiff(d,c);n.orientation=Math.abs(u)<Math.abs(m)?90:270,i.stopPropagation()}function ts(i){const{cancel:e,computation:t,settingHeading:n,steps:s,view:r}=i;if(!Et(t))return;const{renderCoordsHelper:o}=r,{dimension:a,geometry:l}=t,c=v(),d=rs(v(),l,l.directSegment,o),u=os(M.get(),{forHeading:n,geometry:l,renderCoordsHelper:o}),m=wi(d,u,xi()),_=Qe(a.orientation,n?()=>Mi(l,r.renderCoordsHelper):0);s.next(Fn(r,m)).next(g=>{g.action==="start"&&V(c,g.renderStart);const S=Rr(m),w=Dr(c,g.renderEnd,d,S);let H=_-nr(w);n||(H=Ko(H)),a.orientation=H}),e.next(zi(a,["orientation"]))}function Ko(i){const e=Si.normalize(i)%90;return e<T.orientationSnapThresholdDegrees?i-e:90-e<T.orientationSnapThresholdDegrees?i+(90-e):i}function ea(i,{computation:e,manipulatorMeasureType:t,view:n}){let s=$.Direct,r=0,o=0;return[i.events.on("grab-changed",a=>{if(a.action!=="start"||!Et(e))return;const{dimension:l,geometry:c}=e;s=l.measureType,r=l.offset,o=l.orientation;const d=V(M.get(),i.renderLocation);l.measureType=t,l.offset=Oo(d,t,c,n.renderCoordsHelper),l.orientation=0}),Tt(i,(a,l,c)=>{if(!Et(e))return;const{geometry:d,dimension:u}=e,{renderCoordsHelper:m}=n,_=Un(as,t,e,m),g=ii(M.get(),{measureType:t,directSegment:d.directSegment,renderCoordsHelper:m}),S=Vi(a);l.next(S).next(is(n,u,_,g)),c.next(S).next(w=>(u.measureType=s,u.offset=r,u.orientation=o,w))})]}function is(i,e,t,n){const s=ot(M.get(),t.endRenderSpace,t.startRenderSpace);ee(s,s,n);const r=wi(t.startRenderSpace,s,xi()),o=wi(t.startRenderSpace,n,xi()),a=e.offset;let l,c=0;const d=new Pi;return d.next(Fn(i,r)).next(u=>{u.action==="start"&&(c=nn(o,u.renderStart));const m=(nn(o,u.renderEnd)-c)*i.renderCoordsHelper.unitInMeters;e.offset=a+m,l=u}),u=>(d.execute(u),l)}function ns(i,e){const{directSegment:t}=i,{renderCoordsHelper:n}=e,s=ni(M.get(),i,n),r=ki(M.get(),i),o=ee(M.get(),r,s),{viewForward:a}=e.state.camera;D(o,a)>0&&bt(o,o,-1);const l=t.eval(.5,M.get());return n.headingAtPosition(l,o)}function ta(i,e,t){const{dimensionSegment:n,primaryOffsetAxis:s}=e,r=Ni(gt,e),o=et(r,tt)?lr(Qt):Di(r,s,tt,Qt),a=Math.max(Hi(r),T.offsetManipulator.minLengthMeters/t.unitInMeters);On(o,o,se(gt,a,a,a)),i.modelTransform=o,i.renderLocation=n.eval(.5,gt)}function ia(i,e,t){ss(i,e,t,{forHeading:!0})}function na(i,e,t){ss(i,e,t,{forHeading:!1})}function ss(i,e,t,{forHeading:n}){const{dimension:s,geometry:r}=e,{primaryOffsetAxis:o}=r,a=bt(sa,o,s.offset>=0?1:-1),l=os(ra,{forHeading:n,geometry:r,renderCoordsHelper:t});ee(l,l,a);const c=Di(a,l,tt,Qt);i.modelTransform=c,i.renderLocation=rs(gt,r,r.dimensionSegment,t)}const sa=v(),ra=v();function oa(i,e,t,n){const{geometry:s}=e,r=Un(as,t,e,n),o=ii(gt,{measureType:t,directSegment:s.directSegment,renderCoordsHelper:n}),a=C(mi,r.endRenderSpace,r.startRenderSpace),l=Di(a,o,tt,Qt),c=Hi(a);On(l,l,se(mi,c,c,c)),i.modelTransform=l,i.renderLocation=r.eval(.5,mi)}function rs(i,e,t,n){const{startRenderSpace:s,endRenderSpace:r}=t,o=aa(e,n)?s:r;return V(i,o)}function os(i,{forHeading:e,geometry:t,renderCoordsHelper:n}){return e?ni(i,t,n):Ni(i,t,{invert:!0})}function aa(i,e){const t=ki(la,i),n=ni(ca,i,e);return D(t,n)>0}const la=v(),ca=v();function da(i){return le(i)+T.offsetManipulator.linePaddingPx}function Gi(i){return le(i)+T.offsetManipulator.focusedLinePaddingPx}const me=fr.Custom1,gt=v(),mi=v(),Qt=Ai(),as=new He;var Q;function kt(i,e){if(Jn(i))return Q.Direct;const{geometry:t}=i;if(y(t)||et(t.directSegment.startRenderSpace,t.directSegment.endRenderSpace))return null;const{constraintThresholdPx:n}=T,{camera:s}=e.state,r=ni(M.get(),t,e.renderCoordsHelper),o=ki(M.get(),t),a=bt(M.get(),r,D(o,r)),l=ot(M.get(),o,a),c=yi(l),d=yi(a),{startRenderSpace:u,endRenderSpace:m}=t.directSegment,_=Math.max(s.computeRenderPixelSizeAt(u)*n,s.computeRenderPixelSizeAt(m)*n)**2;return c<_?Q.Vertical:d<_?Q.Horizontal:null}function ha(i,e,t){const{constraint:n,elevationAlignedStartPoint:s,elevationAlignedEndPoint:r,unconstrainedGeometry:o,view:a}=t,{dimension:l,previousConstraint:c,preConstraintProperties:d}=i;if(y(s)||y(r))return;const u=()=>{"startPoint"in e?l.startPoint=e.startPoint:"endPoint"in e&&(l.endPoint=e.endPoint)};if(y(n))u(),f(c)&&f(d)&&(l.measureType=d.measureType,l.orientation=d.orientation);else switch(l.measureType=$.Direct,n){case Q.Horizontal:if(n!==c&&(l.orientation=0),"startPoint"in e){const m=e.startPoint;f(m)&&(m.z=r.z),l.startPoint=m}else if("endPoint"in e){const m=e.endPoint;f(m)&&(m.z=s.z),l.endPoint=m}break;case Q.Vertical:if(n!==c&&(l.orientation=ns(o,a)),"startPoint"in e){const m=e.startPoint;f(m)&&(m.x=r.x,m.y=r.y),l.startPoint=m}else if("endPoint"in e){const m=e.endPoint;f(m)&&(m.x=s.x,m.y=s.y),l.endPoint=m}break;case Q.Direct:n!==c&&f(d)&&(l.orientation=d.orientation),u()}i.previousConstraint=n}(function(i){i[i.Horizontal=0]="Horizontal",i[i.Vertical=1]="Vertical",i[i.Direct=2]="Direct"})(Q||(Q={}));let ua=class extends ti{constructor(e){super(e),this._ray=pr(),this._externalResources=null,this._handles=new st,this._isWorldDown=!1,this._start=v(),this._end=B(1,0,0),this._width=1,this._color=Wt(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=Wt(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=W.LINE,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=b.OccludeAndTransparent,this._fadedExtensions=mn,this.applyProps(e)}createExternalResources(){const e=new Re(this.materialParameters);this._handles.add(E(()=>this.view.state.camera,()=>{this._updateGeometry()}));const t=new Qr({view:this.view,attached:this._laserlineEnabled});this._externalResources={material:e,laserline:t}}destroyExternalResources(){f(this._externalResources)&&this._externalResources.laserline.destroy(),this._externalResources=null,this._handles.removeAll()}forEachExternalMaterial(e){f(this._externalResources)&&e(this._externalResources.material)}createGeometries(e){const t=[v(),v()],n=this.extensionType===W.FADED;n&&t.push(v(),v());const s=n?new Float32Array([1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]):null,r=it(t,null,s);e.addGeometry(r,ne(this._externalResources).material),this._updateVertices(e)}updateVisibility(e){super.updateVisibility(e),f(this._externalResources)&&(this._externalResources.laserline.visible=e)}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,V(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),ot(this._end,e,this._end),li(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,et(this._start,e)||(V(this._start,e),li(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,et(this._end,e)||(V(this._end,e),li(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){We(e,this._color)||(wt(this._color,e),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){We(e,this._innerColor)||(wt(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=f(e)!==f(this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){(y(e)||y(this._stippleOffColor)||!We(e,this._stippleOffColor))&&(this._stippleOffColor=f(e)?kn(e):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this._updateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&f(this._laserlineStyle)}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,f(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached,f(e)&&(this._externalResources.laserline.style=e))}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,f(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached))}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=Qe(e,mn),this.recreateGeometry()}_updateMaterial(){y(this._externalResources)||this._externalResources.material.setParameters(this.materialParameters)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}_updateGeometry(){f(this.object)&&this._updateVertices(this.object)}_updateVertices(e){const t=this._extensionType===W.FADED?this._updateLineSegmentFinite(un):this._updateLineSegmentInfinite(this._extensionType,un);this._updateVertexAttributes(e,t),f(this._externalResources)&&(this._externalResources.laserline.intersectsLine=t)}_updateLineSegmentFinite(e){return di(this._start,this._end,e)}_updateLineSegmentInfinite(e,t){const n=this.view.state.camera;switch(Xr(this._ray,ve),e){case W.LINE:ve.c0=-Number.MAX_VALUE;break;case W.RAY:case W.GROUND_RAY:{const o=this._ray.origin,a=Qe(this.view.elevationProvider.getElevation(o[0],o[1],o[2],this.view.renderCoordsHelper.spatialReference,"ground"),0),l=this.view.renderCoordsHelper.getAltitude(o);this._isWorldDown&&l<a&&dr(ve.ray.direction,ve.ray.direction),this._extensionType===W.GROUND_RAY&&a!=null&&(ve.c1=Math.abs(l-a));break}}if(!Ur(n.frustum,ve))return di(this._start,this._end,t);const s=Wr(ve,Pe),r=Br(ve,pa);return di(s,r,t)}_updateVertexAttributes(e,t){const n=e.geometries[0].getMutableAttribute(Nn.POSITION).data;if(this.extensionType===W.FADED){const s=Fe(t,-this.fadedExtensions.start,Pe);n[0]=s[0],n[1]=s[1],n[2]=s[2];const r=Fe(t,0,Pe);n[3]=r[0],n[4]=r[1],n[5]=r[2];const o=Fe(t,1,Pe);n[6]=o[0],n[7]=o[1],n[8]=o[2];const a=Fe(t,1+this.fadedExtensions.end,Pe);n[9]=a[0],n[10]=a[1],n[11]=a[2]}else{const s=Fe(t,0,Pe);n[0]=s[0],n[1]=s[1],n[2]=s[2];const r=Fe(t,1,Pe);n[3]=r[0],n[4]=r[1],n[5]=r[2]}e.geometryVertexAttrsUpdated(e.geometryRecords[0])}};const ve=jr(),Pe=v(),pa=v(),un=Jr();var W;(function(i){i[i.LINE=0]="LINE",i[i.RAY=1]="RAY",i[i.GROUND_RAY=2]="GROUND_RAY",i[i.FADED=3]="FADED"})(W||(W={}));const pn=1/3,mn={start:pn,end:pn};let ma=class extends ti{constructor(e){super(e),this._handles=new st,this._location=v(),this._direction=B(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=Wt(1,0,1,1),this._renderOccluded=b.OccludeAndTransparent,this.applyProps(e)}get location(){return this._location}set location(e){et(this._location,e)||(V(this._location,e),this._updateGeometry())}get direction(){return this._direction}set direction(e){et(this._direction,e)||(V(this._direction,e),this._updateGeometry())}setDirectionFromPoints(e,t){Ln(this._direction,ot(this._direction,t,e)),this._updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this._updateGeometry())}get color(){return this._color}set color(e){We(e,this._color)||(wt(this._color,e),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}createExternalResources(){const e=new Re(this.materialParameters);this._handles.add(E(()=>this.view.state.camera,()=>{this._updateGeometry()})),this._externalResources={material:e}}destroyExternalResources(){this._handles.removeAll(),this._externalResources=null}createGeometries(e){const t=it([v(),v()]),n=it([v(),v()]),s=ne(this._externalResources).material;e.addGeometry(t,s),e.addGeometry(n,s),this._updateVertices(e)}forEachExternalMaterial(e){f(this._externalResources)&&e(this._externalResources.material)}_updateMaterial(){y(this._externalResources)||this._externalResources.material.setParameters(this.materialParameters)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded}}_updateGeometry(){const e=this.object;y(e)||this._updateVertices(e)}_updateVertices(e){const t=this.view.state.camera;t.projectToScreen(this.location,Nt),An(re,this.location,this.direction),t.projectToScreen(re,ke),Kr(ke,de(ke,ke,Nt)),this._updateVertexAttributes(t,e,0,Nt,ke,1),this._updateVertexAttributes(t,e,1,Nt,ke,-1)}_updateVertexAttributes(e,t,n,s,r,o){const a=t.geometryRecords[n],l=a.geometry.getMutableAttribute(Nn.POSITION).data,c=hi(fn,eo(fn,r[1]*o,r[0]*-o),this.offset+this.width/2),d=At(Gt,At(Gt,At(Gt,s,hi(Gt,r,this.length/2)),c),c),u=At(gn,d,hi(gn,r,-this.length));e.unprojectFromScreen(d,re),l[0]=re[0],l[1]=re[1],l[2]=re[2],e.unprojectFromScreen(u,re),l[3]=re[0],l[4]=re[1],l[5]=re[2],t.geometryVertexAttrsUpdated(a)}};const re=v(),Nt=Ct(),ke=Ct(),fn=Ct(),Gt=Ct(),gn=Ct();let te=class extends Mn{constructor(){super(...arguments),this.enabled=!0}};h([p({type:Boolean})],te.prototype,"enabled",void 0),te=h([N("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],te);let L=class extends Mn{constructor(e){super(e),this.lineSnapper=new te,this.parallelLineSnapper=new te,this.rightAngleSnapper=new te,this.rightAngleTriangleSnapper=new te,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new R([255,127,0]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5}};h([p({type:te,constructOnly:!0,nonNullable:!0,json:{write:!0}})],L.prototype,"lineSnapper",void 0),h([p({type:te,constructOnly:!0,nonNullable:!0,json:{write:!0}})],L.prototype,"parallelLineSnapper",void 0),h([p({type:te,constructOnly:!0,nonNullable:!0,json:{write:!0}})],L.prototype,"rightAngleSnapper",void 0),h([p({type:te,constructOnly:!0,nonNullable:!0,json:{write:!0}})],L.prototype,"rightAngleTriangleSnapper",void 0),h([p({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],L.prototype,"shortLineThreshold",void 0),h([p({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],L.prototype,"distance",void 0),h([p({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],L.prototype,"pointThreshold",void 0),h([p({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],L.prototype,"intersectionParallelLineThreshold",void 0),h([p({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],L.prototype,"parallelLineThreshold",void 0),h([p({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],L.prototype,"touchSensitivityMultiplier",void 0),h([p({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],L.prototype,"pointOnLineThreshold",void 0),h([p({type:R,nonNullable:!0})],L.prototype,"orange",void 0),h([p({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],L.prototype,"lineHintWidthReference",void 0),h([p({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],L.prototype,"lineHintWidthTarget",void 0),h([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],L.prototype,"lineHintFadedExtensions",void 0),h([p({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],L.prototype,"parallelLineHintWidth",void 0),h([p({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],L.prototype,"parallelLineHintLength",void 0),h([p({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],L.prototype,"parallelLineHintOffset",void 0),h([p({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],L.prototype,"rightAngleHintSize",void 0),h([p({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],L.prototype,"rightAngleHintOutlineSize",void 0),L=h([N("esri.views.interactive.snapping.Settings.Defaults")],L);const P=new L;var z;(function(i){i[i.FEATURE=1]="FEATURE",i[i.SELF=2]="SELF",i[i.ALL=3]="ALL"})(z||(z={}));function k(i,e){const t=i.length===e.length&&i[0]===e[0]&&i[1]===e[1];switch(i.length){case 2:return t;case 3:return t&&i[2]===e[2];case 4:return t&&i[2]===e[2]&&i[3]===e[3]}return!1}function Ve(i,e){const t=i.x-e.x,n=i.y-e.y;return t*t+n*n}function fa(i,e){return Math.sqrt(Ve(i,e))}function Zi(i,e,t){const n=t.toXYZ(i,ga);e.sort((s,r)=>{const o=t.toXYZ(s.targetPoint,_n),a=vt(o,n),l=t.toXYZ(r.targetPoint,_n);return a-vt(l,n)})}const ga=v(),_n=v();var j;function Qc(i,e){return{point:i.coordinateHelper.vectorToPoint(i.point).toJSON(),distance:i.distance,types:i.types,query:f(e)?e.toJSON():{where:"1=1"}}}function A(i,e,t,n){const{coordinateHelper:s,elevationInfo:r}=t;if(!s.hasZ()||y(e)||e.type!=="3d"||y(i)||so(r,n))return i;const o=Yn(e,i,s.spatialReference,r,n),a=s.clone(i);return a[2]=o,a}function ae(i,e,t,n=O){return{left:A(i.leftVertex.pos,e,t,n),right:A(i.rightVertex.pos,e,t,n)}}function Kc(i){return i.createQuery()}(function(i){i[i.TARGET=0]="TARGET",i[i.REFERENCE=1]="REFERENCE",i[i.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"})(j||(j={}));let Rt=class{constructor(e,t){this.elevationInfo=e,this.domain=t}},ls=class cs extends Rt{constructor(e,t,n=z.ALL){super(t,n),this.intersectionPoint=e}equals(e){return e instanceof cs&&k(this.intersectionPoint,e.intersectionPoint)}},he=class ds extends Rt{constructor(e,t,n,s,r=z.ALL,o=!0,a=!0){super(s,r),this.type=e,this.lineStart=t,this.lineEnd=n,this.fadeLeft=o,this.fadeRight=a}equals(e){return e instanceof ds&&this.type===e.type&&k(this.lineStart,e.lineStart)&&k(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}},hs=class us extends Rt{constructor(e,t,n,s=z.ALL){super(n,s),this.lineStart=e,this.lineEnd=t}equals(e){return e instanceof us&&k(this.lineStart,e.lineStart)&&k(this.lineEnd,e.lineEnd)}},_a=class ps extends Rt{constructor(e,t,n){super(t,n),this.point=e}equals(e){return e instanceof ps&&k(this.point,e.point)}},Yi=class ms extends Rt{constructor(e,t,n,s,r=z.ALL){super(s,r),this.previousVertex=e,this.centerVertex=t,this.nextVertex=n}equals(e){return e instanceof ms&&k(this.previousVertex,e.previousVertex)&&k(this.centerVertex,e.centerVertex)&&k(this.nextVertex,e.nextVertex)}},ya=class{draw(e,t){const n=this._getUniqueHints(e),s=[];for(const r of n)r instanceof ls&&s.push(this.visualizeIntersectionPoint(r,t)),r instanceof he&&s.push(this.visualizeLine(r,t)),r instanceof hs&&s.push(this.visualizeParallelSign(r,t)),r instanceof Yi&&s.push(this.visualizeRightAngleQuad(r,t)),r instanceof _a&&s.push(this.visualizePoint(r,t));return Ns(s)}_getUniqueHints(e){const t=[];for(const n of e){let s=!0;for(const r of t)if(n.equals(r)){s=!1;break}s&&t.push(n)}return t}},va=class extends ya{visualizeIntersectionPoint(e,t){const{coordinateHelper:n,view:s}=t;return Ze(new rn({view:s,primitive:"circle",geometry:n.vectorToPoint(e.intersectionPoint),elevationInfo:Qe(e.elevationInfo,t.elevationInfo),size:20,outlineSize:2,color:[0,0,0,0],outlineColor:R.toUnitRGBA(P.orange),pixelSnappingEnabled:!1}))}visualizePoint(e,t){const{view:n,coordinateHelper:s}=t,r=this._alignPoint(e.point,e.domain,t);return Ze(new rn({view:n,primitive:"circle",geometry:s.vectorToPoint(r),elevationInfo:this._hintElevationInfo(e,t),size:20,outlineSize:2,color:[0,0,0,0],outlineColor:R.toUnitRGBA(P.orange),pixelSnappingEnabled:!1}))}visualizeLine(e,t){const{view:n,coordinateHelper:s}=t,r=this._alignPoint(e.lineStart,e.domain,t),o=this._alignPoint(e.lineEnd,e.domain,t);return Ze(this._createLineSegmentHintFromMap(e.type,r,o,s,this._hintElevationInfo(e,t),n,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,t){const{view:n,coordinateHelper:s}=t,r=this._hintElevationInfo(e,t),o=this._alignPoint(e.lineStart,e.domain,t),a=this._alignPoint(e.lineEnd,e.domain,t),l=ct(o,s,r,n),c=ct(a,s,r,n),d=hr(c,l,c,.5),u=new ma({view:n,attached:!1,offset:P.parallelLineHintOffset,length:P.parallelLineHintLength,width:P.parallelLineHintWidth,color:R.toUnitRGBA(P.orange),location:d,renderOccluded:b.Opaque});return u.setDirectionFromPoints(l,d),u.attached=!0,Ze(u)}visualizeRightAngleQuad(e,t){const{view:n,coordinateHelper:s}=t,r=this._hintElevationInfo(e,t),o=this._alignPoint(e.previousVertex,e.domain,t),a=this._alignPoint(e.centerVertex,e.domain,t),l=this._alignPoint(e.nextVertex,e.domain,t);return Ze(new no({view:n,attached:!0,color:R.toUnitRGBA(P.orange),renderOccluded:b.Transparent,outlineRenderOccluded:b.Opaque,outlineColor:R.toUnitRGBA(P.orange),outlineSize:P.rightAngleHintOutlineSize,size:P.rightAngleHintSize,geometry:{previous:ct(o,s,r,n),center:ct(a,s,r,n),next:ct(l,s,r,n)}}))}_createLineSegmentHintFromMap(e,t,n,s,r,o,a=!0,l=!0){const c=v(),d=v();return rr(t,n,s,r,o,c,d),this._createLineSegmentHint(e,o,c,d,a,l)}_createLineSegmentHint(e,t,n,s,r=!0,o=!0){const a=new ua({view:t,extensionType:W.FADED,start:n,end:s,color:R.toUnitRGBA(P.orange),renderOccluded:b.Opaque});switch(e){case j.TARGET:a.width=P.lineHintWidthTarget,a.fadedExtensions={start:0,end:P.lineHintFadedExtensions};break;case j.REFERENCE_EXTENSION:a.width=P.lineHintWidthReference,a.fadedExtensions={start:0,end:0};break;case j.REFERENCE:a.width=P.lineHintWidthReference,a.fadedExtensions={start:r?P.lineHintFadedExtensions:0,end:o?P.lineHintFadedExtensions:0}}return a.attached=!0,a}_alignPoint(e,t,n){const s=this._getSelfSnappingZ(t,n);if(y(s))return e;const r=n.coordinateHelper,o=r.vectorToPoint(e,Sa);return o.z=s,r.pointToVector(o)}_hintElevationInfo(e,t){return f(this._getSelfSnappingZ(e.domain,t))?ne(t.selfSnappingZ).elevationInfo:Qe(e.elevationInfo,t.elevationInfo)}_getSelfSnappingZ(e,{selfSnappingZ:t}){return e===z.SELF&&f(t)?t.value:null}};const Sa=new ft,x={main:new R([255,127,0]),selected:new R([255,255,255]),staged:new R([12,207,255]),outline:new R([0,0,0,.5]),selectedOutline:new R([255,255,255])},Je=.3;function Mt(i,e){const t=i.clone();return t.a*=e,t}function wa(i,e){const t=i.clone(),n=oo(t);n.s*=e;const s=ao(n);return t.r=s.r,t.g=s.g,t.b=s.b,t}function K(i,e){if(e)for(const t in e)i[t]=e[t]}let xa=class{constructor(e){this.color=x.main,this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=b.Opaque,K(this,e)}},fi=class{constructor(e){this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=x.main,this.outlineColor=x.outline,this.renderOccluded=b.Opaque,this.hoverOutlineColor=x.selectedOutline,K(this,e)}apply(e,t){const n=this[e];t.setParameters({color:we(n),transparent:e!=="color"||n.a<1,renderOccluded:this.renderOccluded})}},Pa=class{constructor(e){this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.color=Mt(x.main,.5),this.hoverColor=x.main,this.renderOccluded=b.Transparent,this.minSquaredEdgeLength=900,K(this,e)}apply(e,t){const n=this[e];t.setParameters({color:we(n),transparent:n.a<1,renderOccluded:this.renderOccluded})}},Ea=class{constructor(e){this.vertex=new fi({color:x.main,outlineColor:x.outline}),this.edge=new fi({color:wa(Mt(x.main,2/3),.5),outlineColor:Mt(x.outline,.5),size:8,collisionPadding:8}),this.selected=new fi({color:x.selected,outlineColor:x.outline}),this.edgeOffset=new Pa,K(this,e)}},$i=class{constructor(e){this.color=x.selected,this.width=1.5,this.stipplePattern=De(5),this.stippleOffColor=x.outline,this.falloff=0,this.innerWidth=1.5,this.innerColor=x.selected,this.renderOccluded=b.OccludeAndTransparent,K(this,e)}apply(e){e.color=we(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=we(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=we(this.innerColor),e.renderOccluded=this.renderOccluded}},Ma=class{constructor(e){this.color=x.selected,this.size=4,this.outlineSize=1,this.outlineColor=x.outline,this.shape="square",K(this,e)}apply(e){e.color=we(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=we(this.outlineColor),e.primitive=this.shape}},Kt=class{constructor(e){this.innerColor=x.selected,this.innerWidth=1,this.glowColor=x.main,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=Je,this.globalAlphaContrastBoost=1.5,this.radius=3,this.heightFillColor=x.main,K(this,e)}apply(e,t=1){const n={glowColor:R.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:R.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*t,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=n:e.laserlineStyle=n}},$a=class{constructor(e){this.outline=new $i({color:x.outline,renderOccluded:b.OccludeAndTransparentStencil,stippleOffColor:x.selected,stipplePattern:De(5),width:1.5,innerWidth:0}),this.staged=new $i({color:x.selected,renderOccluded:b.OccludeAndTransparentStencil,innerColor:x.staged,stippleOffColor:x.outline,stipplePattern:De(5),width:1.5}),this.shadowStyle=new Kt({globalAlpha:Je,glowColor:x.main,glowFalloff:8,glowWidth:8,innerColor:x.selected,innerWidth:1}),K(this,e)}},ba=class{constructor(e){this.outline=new Ma({color:x.selected,outlineColor:x.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new Kt({globalAlpha:Je,glowColor:x.main,glowFalloff:1.5,glowWidth:6,innerColor:x.selected,innerWidth:1,radius:2}),K(this,e)}};class Ca extends $i{constructor(e){super(),this.extensionType=W.GROUND_RAY,K(this,e)}}let Ta=class{constructor(e){this.lineGraphics=new $a,this.pointGraphics=new ba,this.heightPlane=new Kt({globalAlpha:Je,glowColor:x.main,glowFalloff:8,glowWidth:8,innerColor:x.selected,innerWidth:1}),this.heightBox=new Kt({globalAlpha:Je,glowColor:x.main,glowFalloff:8,glowWidth:8,innerColor:x.selected,innerWidth:0,heightFillColor:x.main}),this.zVerticalLine=new Ca({color:Mt(x.main,5*Je/3),falloff:2,innerColor:Mt(x.selected,0),renderOccluded:b.OccludeAndTransparent,stipplePattern:null,width:5,extensionType:W.GROUND_RAY}),this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,K(this,e)}},Oa=class{constructor(e){this.visualElements=new Ta,this.reshapeManipulators=new Ea,this.zManipulator=new xa,K(this,e)}colorToVec4(e){return we(e)}};function we(i){return lo(R.toUnitRGBA(i))}const Ne=new Oa;function Ra(i,e,t,n,s){const r=new Float64Array(3*i.length),o=new Float64Array(r.length);i.forEach((c,d)=>{r[3*d+0]=c[0],r[3*d+1]=c[1],r[3*d+2]=c.length>2?c[2]:0});const a=gr(r,e,0,o,0,r,0,r.length/3,t,n,s),l=a!=null;return{numVertices:i.length,position:r,mapPosition:o,projectionSuccess:l,sampledElevation:a}}let La=class extends ti{constructor(e){super(e),this.view=null,this._renderOccluded=b.OccludeAndTransparent,this._vertices=null,this._spatialReference=null,this._color=Ne.colorToVec4(Ne.reshapeManipulators.vertex.color),this._size=Ne.reshapeManipulators.vertex.size,this._outlineColor=Ne.colorToVec4(Ne.reshapeManipulators.vertex.outlineColor),this._outlineSize=Ne.reshapeManipulators.vertex.outlineSize,this._elevationInfo=null,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry()}get color(){return this._color}set color(e){We(e,this._color)||(wt(this._color,e),this._updateMaterial())}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){We(e,this._outlineColor)||(wt(this._outlineColor,e),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get _vertexMaterialParameters(){return{color:this._color,transparent:this._color[3]<1,screenSizeScale:this.size,renderOccluded:this._renderOccluded}}get _vertexOutlineMaterialParameters(){return{color:this._outlineColor,transparent:this._outlineColor[3]<1,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded}}_updateMaterial(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}_createRenderGeometries(){const e=this.vertices;if(y(e)||e.length===0)return[];const t=.5,n=.5,s=Ra(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,_r.fromElevationInfo(this.elevationInfo)),r=[],o=s.numVertices,a=s.position;for(let l=0;l<o;++l){const c=se(Aa,a[3*l+0],a[3*l+1],a[3*l+2]),d=yn(t,c),u=yn(n,c);r.push({vertexGeometry:d,vertexOutlineGeometry:u})}return r}createGeometries(e){const t=this._createRenderGeometries();for(const{vertexGeometry:n,vertexOutlineGeometry:s}of t)e.addGeometry(n,this._vertexMaterial),e.addGeometry(s,this._vertexOutlineMaterial)}createExternalResources(){this._vertexMaterial=new sn({...this._vertexMaterialParameters,writeDepth:!0,cullFace:an.Back,screenSizeEnabled:!0}),this._vertexOutlineMaterial=new sn({...this._vertexOutlineMaterialParameters,transparent:!0,writeDepth:!0,cullFace:an.Front,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}forEachExternalMaterial(e){e(this._vertexMaterial),e(this._vertexOutlineMaterial)}};const Aa=v();function yn(i,e){return yr(i,16,16,{offset:e})}let $e=class extends ye{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1}};h([p({constructOnly:!0})],$e.prototype,"layer",void 0),h([p()],$e.prototype,"enabled",void 0),h([p()],$e.prototype,"updating",void 0),h([p()],$e.prototype,"availability",void 0),$e=h([N("esri.views.interactive.snapping.FeatureSnappingLayerSource")],$e);const fs=$e;let X=class extends ye{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.featureSources=new rt,this.distance=P.distance,this.touchSensitivityMultiplier=P.touchSensitivityMultiplier}get effectiveEnabled(){return this.enabledToggled?!this.enabled:this.enabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}};h([p()],X.prototype,"enabled",void 0),h([p()],X.prototype,"enabledToggled",void 0),h([p()],X.prototype,"selfEnabled",void 0),h([p()],X.prototype,"featureEnabled",void 0),h([p({type:rt.ofType(fs)})],X.prototype,"featureSources",void 0),h([p()],X.prototype,"distance",void 0),h([p()],X.prototype,"touchSensitivityMultiplier",void 0),h([p({readOnly:!0})],X.prototype,"effectiveEnabled",null),h([p({readOnly:!0})],X.prototype,"effectiveSelfEnabled",null),h([p({readOnly:!0})],X.prototype,"effectiveFeatureEnabled",null),X=h([N("esri.views.interactive.snapping.SnappingOptions")],X);const gs=X;function Ha(i,e){const t=new gs({enabled:!0,selfEnabled:!1,featureEnabled:!0,distance:(e==null?void 0:e.distance)??P.distance,touchSensitivityMultiplier:(e==null?void 0:e.touchSensitivityMultiplier)??P.touchSensitivityMultiplier});return{...E(()=>{var n,s;return((s=(n=i.map)==null?void 0:n.allLayers)==null?void 0:s.toArray())??[]},n=>{t.featureSources=new rt(n.map(s=>new fs({layer:s,enabled:!0})))},Ut),options:t}}function bi({start:i,end:e,type:t},n,s){const r=[],o=n,a=de(fe,e,i),l=de(ge,i,o),c=xt(a),d=2*Ot(a,l),u=d*d-4*c*(xt(l)-s*s);if(u===0){const m=-d/(2*c);(t===ie.PLANE||m>=0)&&r.push(Ae(B(0,0,n[2]),i,a,m))}else if(u>0){const m=Math.sqrt(u),_=(-d+m)/(2*c);(t===ie.PLANE||_>=0)&&r.push(Ae(B(0,0,n[2]),i,a,_));const g=(-d-m)/(2*c);(t===ie.PLANE||g>=0)&&r.push(Ae(B(0,0,n[2]),i,a,g))}return r}function Ci(i,e){const t=i.start,n=i.end,s=de(fe,n,t),r=se(ge,-s[1],s[0],0),o=e.start,a=e.end,l=C(Lt,a,o),c=D(l,r),d=se(ws,t[0],t[1],0),u=C(xs,d,o),m=D(u,r);if(Math.abs(c)<F)return[];const _=ce(Ps,o,l,m/c);if(e.type===I.RAY){const g=C(ei,_,o);if(D(g,l)<-F)return[]}if(i.type===ie.HALF_PLANE){const g=to(ei,_,t);if(Ot(g,s)<-F)return[]}return[St(_)]}function Ti(i,e){return Oi($t(si,e[2],i),e)}function _s(i,e){const n=Ss($t(si,0,i),$t(Ia,0,e)),s=[];for(const r of n)s.push(go(r));return s}function ys(i,e){return qi(i,$t(si,i[2],e))}function Da(i,e){return vs($t(si,i[2],e),i)}function za(i,e,t){const n=se(fe,i[0],i[1],e[2]),s=ot(ge,n,e),r=t/Hi(s);return ce(v(),e,s,r)}function qi(i,{start:e,end:t,type:n}){const s=C(fe,i,e),r=C(ge,t,e),o=D(s,r)/D(r,r);return ce(v(),e,r,n===I.RAY?Math.max(o,0):o)}function vs({start:i,end:e,type:t},n){const s=C(fe,n,i),r=C(ge,e,i);if(t===I.RAY&&D(r,s)<-F)return qt(i,n);const o=ee(Lt,r,s);return en(o)/en(r)}function vn({start:i,end:e,type:t},n,s){const r=[];if(Le(i[2],n[2],F)&&Le(e[2],n[2],F)){const o=i,a=n,l=de(fe,e,o),c=de(ge,o,a),d=xt(l),u=2*Ot(l,c),m=u*u-4*d*(xt(c)-s*s);if(m===0){const _=-u/(2*d);(t===I.LINE||_>=0)&&r.push(Ae(B(0,0,n[2]),o,l,_))}else if(m>0){const _=Math.sqrt(m),g=(-u+_)/(2*d);(t===I.LINE||g>=0)&&r.push(Ae(B(0,0,n[2]),o,l,g));const S=(-u-_)/(2*d);(t===I.LINE||S>=0)&&r.push(Ae(B(0,0,n[2]),o,l,S))}}else{const o=C(fe,e,i);if(Le(o[2],0,F))return r;const a=(n[2]-i[2])/o[2],l=ce(ge,i,o,a);if(t===I.RAY){const c=C(Lt,l,i);if(D(o,c)<-F)return r}for(const c of Ri(n,s,l))r.push(c)}return r}function Ss(i,e){const t=i.start,n=i.end,s=e.start,r=e.end,o=C(fe,n,t),a=C(ge,r,s),l=C(Lt,s,t),c=ee(ws,o,a),d=D(l,c);if(!Le(d,0,F))return[];const u=vi(c);if(Le(u,0,F))return[];const m=ee(xs,l,a),_=D(m,c)/u,g=ce(Ps,t,o,_);if(i.type===I.RAY){const S=C(ei,g,t);if(D(o,S)<-F)return[]}if(e.type===I.RAY){const S=C(ei,g,s);if(D(a,S)<-F)return[]}return[St(g)]}function Oi({start:i,end:e,type:t},n){const s=C(fe,n,i),r=C(ge,e,i),o=ee(Lt,r,s);if(vi(o)/vi(r)<F)switch(t){case I.LINE:return[St(n)];case I.RAY:return D(r,s)<-F?[]:[St(n)]}return[]}function Ri(i,e,t){return Le(i[2],t[2],F)&&Le(vt(t,i),e*e,F)?[St(t)]:[]}function $t(i,e,{start:t,end:n,type:s}){return se(i.start,t[0],t[1],e),se(i.end,n[0],n[1],e),i.type=Va[s],i}var ie;(function(i){i[i.PLANE=0]="PLANE",i[i.HALF_PLANE=1]="HALF_PLANE"})(ie||(ie={}));const Va={[ie.PLANE]:I.LINE,[ie.HALF_PLANE]:I.RAY},F=1e-6,fe=v(),ge=v(),Lt=v(),ws=v(),xs=v(),Ps=v(),ei=v(),si={start:v(),end:v(),type:I.LINE},Ia={start:v(),end:v(),type:I.LINE};class Ie{constructor(e){this.coordinateHelper=e}intersect(e){return Za(this,e)}}let Fa=class extends Ie{constructor(e,t){super(e),this.point=t,this.pointXYZ=e.toXYZ(t)}equals(e){return qe(e)&&k(this.point,e.point)}check(e){const t=this.coordinateHelper.toXYZ(e,_e);return vt(t,this.pointXYZ)<P.pointThreshold}closestTo(){return this.coordinateHelper.clone(this.point)}},Es=class extends Ie{constructor(e,t,n,s){super(e),this.start=t,this.end=n,this.type=s,this.startXYZ=e.toXYZ(t),this.endXYZ=e.toXYZ(n),this.lineLike={start:this.startXYZ,end:this.endXYZ,type:this.type}}equals(e){return Ce(e)&&this.type===e.type&&k(this.start,e.start)&&k(this.end,e.end)}check(e){const t=this.coordinateHelper.toXYZ(e,_e);return vs(this.lineLike,t)<P.pointOnLineThreshold}closestTo(e){const t=this.coordinateHelper,n=t.toXYZ(e,_e),s=qi(n,this.lineLike);return t.fromXYZ(s)}};class ka extends Es{constructor(e,t,n){super(e,t,n,I.LINE)}}let Ms=class $s extends Ie{constructor(e,t,n,s){super(e),this.intersection=t,this.first=n,this.second=s}equals(e){return e instanceof $s&&this.first.equals(e.first)&&this.second.equals(e.second)}check(){return!1}closestTo(){return this.coordinateHelper.clone(this.intersection)}},Na=class bs extends Ie{constructor(e,t,n,s){super(e),this.basePoint=t,this.first=n,this.second=s}equals(e){return e instanceof bs&&this.first.equals(e.first)&&this.second.equals(e.second)}check(){return!1}closestTo(e){const t=this.basePoint,n=this.coordinateHelper,s=n.toXYZ(e,_e),r=se(qa,t[0],t[1],s[2]);return n.fromXYZ(r)}};class Cs extends Ie{constructor(e,t,n){super(e),this.center=t,this.radius=n,this.centerXYZ=e.toXYZ(t)}equals(e){return je(e)&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}check(){return!1}closestTo(e){const t=this.coordinateHelper,n=t.toXYZ(e,_e),s=za(n,this.centerXYZ,this.radius);return s[2]=t.getZ(e,this.centerXYZ[2]),t.fromXYZ(s)}}let ji=class extends Ie{constructor(e,t,n,s){super(e),this.start=t,this.end=n,this.type=s,this.planeLike={start:t,end:n,type:s}}equals(e){return Te(e)&&this.type===e.type&&k(this.start,e.start)&&k(this.end,e.end)}check(e){const t=this.coordinateHelper.toXYZ(e,_e);return Da(t,this.planeLike)<P.pointOnLineThreshold}closestTo(e){const t=this.coordinateHelper,n=t.toXYZ(e,_e),s=ys(n,this.planeLike);return t.fromXYZ(s)}closestEndTo(e){const{start:t,end:n}=this;return Math.sign(Ot(de(ja,n,t),de(Xa,e,t)))>0?n:t}},Ts=class extends ji{constructor(e,t,n){super(e,t,n,ie.HALF_PLANE)}},Os=class extends ji{constructor(e,t,n){super(e,t,n,ie.PLANE)}};class Ga extends Ie{constructor(e,t,n,s){super(e),this.start=t,this.end=n,this.getZ=s,this.planeLike={start:t,end:n,type:ie.HALF_PLANE}}equals(e){return Oe(e)&&k(this.start,e.start)&&k(this.end,e.end)&&this.getZ===e.getZ}check(e){const t=this.coordinateHelper.toXYZ(e,_e),n=Sn(this,t);return vt(t,n)<P.pointThreshold}closestTo(e){const t=this.coordinateHelper,n=Sn(this,t.toXYZ(e,_e));return t.fromXYZ(n)}addIfOnTheGround(e,t){for(const n of t){const s=this.getZ(n[0],n[1],n[2]);f(s)&&Math.abs(n[2]-s)<F&&(n[2]=s,e.push(n))}}}function Sn(i,e){const t=ys(e,i.planeLike),n=i.getZ(e[0],e[1],e[2]);return f(n)&&(t[2]=n),t}function Za(i,e){let t=[];if(qe(i)){const{pointXYZ:n}=i;Ce(e)?t=Oi(e.lineLike,n):je(e)?t=Ri(e.centerXYZ,e.radius,n):Te(e)?t=Ti(e.planeLike,n):Oe(e)&&(t=ht(e,i))}else if(Ce(i)){const{lineLike:n}=i;qe(e)?t=Oi(n,e.pointXYZ):Ce(e)?t=Ss(n,e.lineLike):je(e)?t=vn(n,e.centerXYZ,e.radius):Te(e)?t=Ci(e.planeLike,n):Oe(e)&&(t=ht(e,i))}else if(je(i)){const{centerXYZ:n,radius:s}=i;Ce(e)?t=vn(e.lineLike,n,s):qe(e)?t=Ri(n,s,e.pointXYZ):Te(e)?t=bi(e.planeLike,n,s):Oe(e)&&(t=ht(e,i))}else if(Te(i)){const{planeLike:n,coordinateHelper:s}=i;if(Te(e))return _s(n,e.planeLike).map(r=>new Na(s,s.fromXYZ(r),i,e));qe(e)?t=Ti(n,e.pointXYZ):Ce(e)?t=Ci(n,e.lineLike):je(e)?t=bi(n,e.centerXYZ,e.radius):Oe(e)&&(t=ht(e,i))}else Oe(i)&&(t=ht(i,e));return Ya(t,i,e)}function ht(i,e){const{planeLike:t,getZ:n}=i,s=[];if(qe(e))i.addIfOnTheGround(s,Ti(t,e.pointXYZ));else if(Ce(e))i.addIfOnTheGround(s,Ci(t,e.lineLike));else if(je(e))i.addIfOnTheGround(s,bi(t,e.centerXYZ,e.radius));else if(Te(e)||Oe(e))for(const[r,o]of _s(t,e.planeLike)){const a=n(r,o,0);f(a)&&s.push(B(r,o,a))}return s}function Ya(i,e,t){const n=e.coordinateHelper;return i.map(s=>new Ms(n,n.fromXYZ(s),e,t))}function qe(i){return i instanceof Fa}function Ce(i){return i instanceof Es}function je(i){return i instanceof Cs}function Te(i){return i instanceof ji}function Oe(i){return i instanceof Ga}const _e=v(),qa=v(),ja=ze(),Xa=ze();let at=class{constructor(e,t,n,s,r){this.coordinateHelper=e,this.targetPoint=t,this.constraint=n,this.elevationInfo=s,this.domain=r}},Rs=class extends at{constructor({coordinateHelper:e,targetPoint:t,objectId:n,constraint:s,elevationInfo:r}){super(e,t,s,r,z.FEATURE),this.objectId=n}},Ua=class extends Rs{constructor(e){super({...e,constraint:new ka(e.coordinateHelper,e.edgeStart,e.edgeEnd)})}get hints(){return[new he(j.REFERENCE,this.constraint.start,this.constraint.end,this.elevationInfo,this.domain)]}};class Ls extends at{constructor({coordinateHelper:e,targetPoint:t,constraint:n,previousVertex:s,otherVertex:r,otherVertexType:o,objectId:a,elevationInfo:l}){super(e,t,n,l,z.SELF),this.previousVertex=s,this.otherVertex=r,this.otherVertexType=o,this.objectId=a}get hints(){const e=this.previousVertex,t=this.otherVertexType===nt.CENTER?this.otherVertex:this.targetPoint,n=this.otherVertexType===nt.CENTER?this.targetPoint:this.otherVertex,s=this.elevationInfo;return[new he(j.TARGET,t,n,s,this.domain),new he(j.REFERENCE,e,t,s,this.domain),new Yi(this.previousVertex,t,n,s,this.domain)]}}var nt;(function(i){i[i.NEXT=0]="NEXT",i[i.CENTER=1]="CENTER"})(nt||(nt={}));let ue=class extends Ii{constructor(e){super(e),this.options=null,this._domain=z.FEATURE,this._sourceModules={featureService:{module:null,loader:null},featureCollection:{module:null,loader:null},graphics:{module:null,loader:null},notes:{module:null,loader:null},scene:{module:null,loader:null}}}get updating(){return Zs(this.snappingSources,({snappingSource:e})=>e.updating)||this.updatingHandles.updating}get snappingSources(){const e=this._get("snappingSources")||new Map,t=new Map;if(f(this.options)&&f(this.options.featureSources))for(const n of this.options.featureSources.items){const s=n.layer.uid,r=e.get(s);if(r){e.delete(s),t.set(s,r);continue}if(!n.layer.loaded){this.updatingHandles.addPromise(n.layer.load());continue}const o=this._createSourceInfo(n);f(o)&&t.set(s,o)}for(const[,n]of e)n.destroy();return t}initialize(){this.updatingHandles.add(()=>this.snappingSources,()=>this.notifyChange("updating"),Ke),f(this.view)&&this.handles.add([this.view.on("layerview-create",e=>this._updateLayerView(e.layer,e.layerView)),this.view.on("layerview-destroy",e=>this._updateLayerView(e.layer,null))])}_updateLayerView(e,t){for(const[,n]of this.snappingSources)n.snappingSource.layerSource.layer===e&&(n.layerView=t)}destroy(){this._set("options",null);for(const[,e]of this.snappingSources)e.destroy()}async fetchCandidates(e,t,n,s){if(!(t&this._domain)||y(this.options)||!this.options.effectiveFeatureEnabled)return[];const r=[],o=this._computeScreeenSizeDistanceParameters(e,n),a={distance:o,point:e,coordinateHelper:n.coordinateHelper,types:this._types};for(const[,{snappingSource:c,layerView:d}]of this.snappingSources)!c.layerSource.enabled||f(d)&&d.suspended||r.push(c.fetchCandidates(a,s).then(u=>u.filter(m=>!this._candidateIsExcluded(c,m,n.excludeFeature))));const l=(await br(r)).flat();return this._addRightAngleCandidates(l,e,o,n),Cr(s),Zi(e,l,n.coordinateHelper),l}_addRightAngleCandidates(e,t,n,s){var u,m,_,g,S,w,H,lt;const r=f(s.vertexHandle)?(m=(u=s.vertexHandle.rightEdge)==null?void 0:u.rightVertex)==null?void 0:m.pos:f(s.editGeometryOperations)&&s.editGeometryOperations.data.type==="polygon"?(g=ne((_=s.editGeometryOperations.data.components[0])==null?void 0:_.getFirstVertex()))==null?void 0:g.pos:null,o=f(s.vertexHandle)?(w=(S=s.vertexHandle.leftEdge)==null?void 0:S.leftVertex)==null?void 0:w.pos:f(s.editGeometryOperations)?(lt=ne((H=s.editGeometryOperations.data.components[0])==null?void 0:H.getLastVertex()))==null?void 0:lt.pos:null,{view:a}=this,l=A(r,a,s),c=A(o,a,s),d=e.length;for(let xe=0;xe<d;xe++)this._addRightAngleCandidate(e[xe],c,t,n,s,e),this._addRightAngleCandidate(e[xe],l,t,n,s,e)}_addRightAngleCandidate(e,t,n,s,r,o){const a=e instanceof Ua,l=a&&io(e.constraint.start,e.constraint.end);if(y(t)||!a||l)return;const c=e.constraint.closestTo(t),d=(c[0]-n[0])/s.x,u=(c[1]-n[1])/s.y;if(d*d+u*u<=1){const m=r.coordinateHelper,_=new Ls({coordinateHelper:m,targetPoint:c,otherVertex:t,otherVertexType:nt.NEXT,previousVertex:e.constraint.start,constraint:new Ts(m,t,c),objectId:e.objectId,elevationInfo:e.elevationInfo});o.push(_)}}_computeScreeenSizeDistanceParameters(e,t){let n=f(this.options)?this.options.distance*(t.pointer==="touch"?this.options.touchSensitivityMultiplier:1):0;return y(this.view)?{x:n,y:n,z:n,distance:n}:this.view.type==="2d"?(n*=this.view.resolution,{x:n,y:n,z:n,distance:n}):this._computeScreenSizeDistanceParameters3D(e,n,this.view,t)}_computeScreenSizeDistanceParameters3D(e,t,n,s){const{coordinateHelper:r,elevationInfo:o}=s,{spatialReference:a}=r,l=r.hasZ()?O:o,c=r.toXYZ(e,Ba);c[2]=Yn(n,c,a,l,O),n.renderCoordsHelper.toRenderCoords(c,a,wn);const d=n.state.camera.computeScreenPixelSizeAt(wn),u=d*n.renderCoordsHelper.unitInMeters/n.mapCoordsHelper.unitInMeters,m=t*u,_=Tn(c,a,O,n),g=gi(_,c,u,0,0,n,s),S=gi(_,c,0,u,0,n,s),w=gi(_,c,0,0,u,n,s);return{x:g===0?0:m/g,y:S===0?0:m/S,z:w===0?0:m/w,distance:d*t}}get _types(){return ln.EDGE|ln.VERTEX}_candidateIsExcluded(e,t,n){if(y(n))return!1;const s=this._getCandidateObjectId(t);if(y(s))return!1;const r=e.layerSource.layer;return r.type==="graphics"?n.uid===s:n.sourceLayer===r&&!(!n.attributes||!("objectIdField"in r))&&n.attributes[r.objectIdField]===s}_getCandidateObjectId(e){return e instanceof Rs?e.objectId:null}_createSourceInfo(e){const t=this._createFeatureSnappingSourceType(e);if(y(t))return null;if("loading"in t)return this.updatingHandles.addPromise(t.loading.then(()=>{this.destroyed||this.notifyChange("snappingSources")})),null;const n=f(this.view)?this.view.allLayerViews.find(s=>s.layer===e.layer):null;return new Wa(t.source,n)}_createFeatureSnappingSourceType(e){switch(e.layer.type){case"feature":case"geojson":case"csv":case"oriented-imagery":case"subtype-group":case"wfs":return this._createFeatureSnappingSourceFeatureLayer(e);case"graphics":return this._createFeatureSnappingSourceGraphicsLayer(e);case"map-notes":return this._createFeatureSnappingSourceMapNotesLayer(e);case"scene":case"building-scene":return this._createFeatureSnappingSourceSceneLayer(e)}return null}_createFeatureSnappingSourceSceneLayer(e){const{view:t}=this;if(y(t)||t.type!=="3d")return null;const n=this._getSourceModule("scene");return f(n.module)?{source:new n.module.SceneLayerSnappingSource({layerSource:e,view:t})}:{loading:n.loader}}_createFeatureSnappingSourceFeatureLayer(e){switch(e.layer.source.type){case"feature-layer":case"oriented-imagery":{const t=this._getSourceModule("featureService");return f(t.module)?{source:new t.module.FeatureServiceSnappingSource({spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:t.loader}}case"memory":case"csv":case"geojson":case"wfs":{if(e.layer.geometryType==="mesh")return null;const t=this._getSourceModule("featureCollection");return f(t.module)?{source:new t.module.FeatureCollectionSnappingSource({layerSource:e,view:this.view})}:{loading:t.loader}}}return null}_createFeatureSnappingSourceGraphicsLayer(e){const t=this._getSourceModule("graphics");return f(t.module)?{source:new t.module.GraphicsSnappingSource({getGraphicsLayers:()=>[e.layer],spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:t.loader}}_createFeatureSnappingSourceMapNotesLayer(e){const t=this._getSourceModule("notes");return f(t.module)?{source:new t.module.GraphicsSnappingSource({getGraphicsLayers:()=>f(e.layer.sublayers)?e.layer.sublayers.toArray():[],spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:t.loader}}_getSourceModule(e){const t=this._sourceModules[e];if(y(t.loader)){const n=this._loadSourceModule(e).then(s=>{t.module=s});return t.loader=n,{module:t.module,loader:n}}return{module:t.module,loader:t.loader}}_loadSourceModule(e){const t=this.updatingHandles;switch(e){case"featureService":return t.addPromise(Ht(()=>import("./FeatureServiceSnappingSource-e3894e3f.js"),["assets/FeatureServiceSnappingSource-e3894e3f.js","assets/cast-fcb46737.js","assets/typedArrayUtil-4d7bb04c.js","assets/string-a318751c.js","assets/Error-ec6249b9.js","assets/ArrayPool-a8ee9378.js","assets/nextTick-3ee5a785.js","assets/promiseUtils-1e54421e.js","assets/HandleOwner-9b396af1.js","assets/reactiveUtils-4dabbb80.js","assets/Scheduler-540208b6.js","assets/SimpleObservable-23231131.js","assets/elevationInfoUtils-36e5dd0f.js","assets/ElevationInfo-215614d8.js","assets/jsonMap-7b8332c9.js","assets/Extent-da876e26.js","assets/Ellipsoid-89682c5e.js","assets/fieldUtils-7f54c4b1.js","assets/preload-helper-3bce6601.js","assets/arcadeOnDemand-281a01eb.js","assets/geometry-b7901087.js","assets/Polyline-ff2d7c6b.js","assets/typeUtils-35750739.js","assets/lengthUtils-fa751420.js","assets/unitUtils-45d1147c.js","assets/TileInfo-b0eb8c90.js","assets/aaBoundingRect-193543b5.js","assets/mathUtils-b4bb77e2.js","assets/vec3-e93e648f.js","assets/vec3f64-2f9cef06.js","assets/common-c186b691.js","assets/vec4-790471c0.js","assets/vec4f64-e407da96.js","assets/index-a864af46.js","assets/Graphic-f0e54e86.js","assets/PopupTemplate-40f3c9aa.js","assets/Clonable-545593ce.js","assets/Collection-910b6f71.js","assets/Evented-a45c8b0f.js","assets/enumeration-3a03bd31.js","assets/number-27cf8195.js","assets/locale-30120714.js","assets/Identifiable-bfe1ff30.js","assets/symbols-f8232671.js","assets/CIMSymbol-539bd447.js","assets/Symbol-f93ed9fd.js","assets/Color-fb64d77d.js","assets/colorUtils-639f4d25.js","assets/screenUtils-410d12c0.js","assets/opacityUtils-1f7f5126.js","assets/symbolLayerUtils3D-76acc268.js","assets/aaBoundingBox-657a9b82.js","assets/request-6fc81c4c.js","assets/persistableUrlUtils-5f719c3b.js","assets/Symbol3DAnchorPosition2D-5726d999.js","assets/collectionUtils-803d9ba8.js","assets/Portal-2bb189b3.js","assets/Loadable-268c900a.js","assets/Promise-376ab9f6.js","assets/PortalGroup-8e41557a.js","assets/PortalUser-659cc1d2.js","assets/jsonUtils-229211af.js","assets/Cyclical-151bcc41.js","assets/CollectionFlattener-8f4d518b.js","assets/workers-6e30d081.js","assets/Connection-9a1cf8da.js","assets/Queue-b7d3cd48.js","assets/assets-8d3e737a.js","assets/intl-65a3e389.js","assets/messages-2289086c.js","assets/projection-290b739f.js","assets/mat4-44a0988f.js","assets/zscale-89472cba.js","assets/widget-fb292a2f.js","assets/uuid-73213768.js","assets/byteSizeEstimations-f0cab514.js","assets/executeQueryJSON-2fe748db.js","assets/normalizeUtils-27e29a72.js","assets/query-694f7287.js","assets/pbfQueryUtils-4adda2cc.js","assets/pbf-0e99a620.js","assets/OptimizedFeature-4ab8d380.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/queryZScale-1481fa99.js","assets/FeatureSet-d32b0eb8.js","assets/Field-61ec9870.js","assets/fieldType-f31285f7.js","assets/Query-b96bcde0.js","assets/TimeExtent-23e282b9.js","assets/RelationshipQuery-0dda77ad.js","assets/LegendOptions-010d0873.js","assets/utils-6786b611.js","assets/asyncUtils-437defc4.js","assets/parser-498c8be0.js","assets/mat4f32-77b3d8ac.js","assets/ItemCache-fd3aceaf.js","assets/MemCache-18a255ed.js","assets/jsonUtils-f5674613.js","assets/UniqueValueRenderer-08f8851c.js","assets/diffUtils-68b89c71.js","assets/colorRamps-9dac42c1.js","assets/sizeVariableUtils-d4870b0d.js","assets/compilerUtils-18d58939.js","assets/jsonUtils-0ff4ff96.js","assets/styleUtils-22b14a8b.js","assets/DictionaryLoader-1cbfea53.js","assets/LRUCache-64ec42ee.js","assets/deprecate-035b199e.js","assets/heatmapUtils-aaea3f32.js","assets/featureConversionUtils-03a03f40.js","assets/TopFeaturesQuery-cad97c37.js","assets/FeatureLayer-041050b6.js","assets/MultiOriginJSONSupport-aae3bc0c.js","assets/LayerFloorInfo-54b916a2.js","assets/FeatureLayerBase-ad5cfa1a.js","assets/HeightModelInfo-5d01231e.js","assets/arcgisLayerUrl-c09f09b4.js","assets/OperationalLayer-97084f13.js","assets/Layer-5ffe0eda.js","assets/editsZScale-6a661299.js","assets/APIKeyMixin-a0a8917a.js","assets/ArcGISService-21dc1d06.js","assets/BlendLayer-20d0571b.js","assets/CustomParametersMixin-47aab0a6.js","assets/EditBusLayer-e750b15b.js","assets/FeatureReductionLayer-d69dae71.js","assets/labelingInfo-607e66b8.js","assets/labelUtils-3108e8d7.js","assets/defaultsJSON-59981e75.js","assets/OrderedLayer-af7a6030.js","assets/PortalLayer-b2643f87.js","assets/PortalItem-bb7e98a6.js","assets/RefreshableLayer-7f154951.js","assets/ScaleRangeLayer-4be07229.js","assets/TemporalLayer-61549309.js","assets/TimeInfo-1d30dc7c.js","assets/FeatureTemplate-c1d0bb70.js","assets/FeatureType-34d71ade.js","assets/fieldProperties-e2eeb1d5.js","assets/FieldsIndex-f104cc5f.js","assets/versionUtils-fd91f55f.js","assets/styleUtils-a989c0af.js","assets/popupUtils-86dc6b94.js","assets/mat2d-2bbb5feb.js","assets/Basemap-af7f62f8.js","assets/loadAll-b5bfa7ab.js","assets/writeUtils-e686bd33.js","assets/layerUtils-f4d08f94.js","assets/TablesMixin-bc97d131.js","assets/GraphicsCollection-c37a9ffd.js","assets/ViewingMode-5d7d590b.js","assets/enums-0fc02184.js","assets/vec2-528adfe4.js","assets/vec2f64-30dc1443.js","assets/mat3-3fc68e72.js","assets/mat3f32-d3d088e8.js","assets/vec2f32-461e65a9.js","assets/TileStrategy-a90cd1af.js","assets/TileStore-00ac650f.js","assets/TileKey-5aef17b6.js","assets/rbush-8e36784a.js","assets/quickselect-322ec8e1.js","assets/capabilities-302cf20d.js","assets/context-util-a4ce3a7b.js","assets/BoundsStore-b9fa27cc.js","assets/PooledRBush-3e149119.js","assets/mat3f64-c6305894.js","assets/sphere-2af0d852.js","assets/mat4f64-1e28eae0.js","assets/quatf64-7fd38d64.js","assets/lineSegment-10422ca0.js","assets/plane-b575face.js","assets/scaleUtils-93ad8d0c.js","assets/ElevationSamplerData-b87e0e50.js","assets/PhysicallyBasedRendering.glsl-d457fff5.js","assets/View.glsl-3ce196d4.js","assets/ShaderBuilder-a7d0da4e.js","assets/FloatPassUniform-68d54f51.js","assets/Float4PassUniform-d7bdbc81.js","assets/RgbaFloatEncoding.glsl-52af7fcf.js","assets/Texture2DPassUniform-753de459.js","assets/vec3f32-c9aa289f.js","assets/VertexAttribute-9c5c630d.js","assets/Texture2DDrawUniform-053796dc.js","assets/basicInterfaces-19ed850e.js","assets/PiUtils.glsl-db6418ee.js","assets/ReadLinearDepth.glsl-9c87a54a.js","assets/WaterSurface.glsl-c64cb8f1.js","assets/ForwardLinearDepth.glsl-56affafd.js","assets/Matrix3PassUniform-ad9f953b.js","assets/Slice.glsl-3b39b1f7.js","assets/Transform.glsl-6d2e2fd9.js","assets/OutputHighlight.glsl-fbac199a.js","assets/MultipassTerrainTest.glsl-bb236672.js","assets/NormalUtils.glsl-c12729bf.js","assets/AlphaCutoff-96178e0d.js","assets/TransparencyPassType-a11868d2.js","assets/EvaluateSceneLighting.glsl-189abc15.js","assets/VisualVariablePassParameters-d460182b.js","assets/enums-64ab819c.js","assets/VertexElementDescriptor-2925c6af.js","assets/FramebufferObject-a3b9c52c.js","assets/Texture-243be4d7.js","assets/Util-a48361c6.js","assets/SSAOBlur.glsl-8bf33b65.js","assets/ScreenSpacePass-d5e48a9b.js","assets/SSAO.glsl-980b3771.js","assets/ShaderTechniqueConfiguration-9f5b4555.js","assets/HUD.glsl-d3a072ad.js","assets/VerticalOffset.glsl-87cbb2e3.js","assets/objectResourceUtils-d556a033.js","assets/devEnvironmentUtils-5002a058.js","assets/BufferView-903d1848.js","assets/vec33-e98769e8.js","assets/DefaultMaterial_COLOR_GAMMA-fe26fda8.js","assets/types-e1c0a5bf.js","assets/Version-2946cc03.js","assets/quat-3d5eec2d.js","assets/Texture-46c8c2cb.js","assets/TextureOnly.glsl-1ec9a9ef.js","assets/InterleavedLayout-984d67b2.js","assets/MixExternalColor.glsl-ab0706f7.js","assets/symbolColorUtils-b2b55883.js","assets/ObjectAndLayerIdColor.glsl-ad468647.js","assets/OutputDepth.glsl-470c8e2a.js","assets/VisualVariables.glsl-2b937327.js","assets/DiscardOrAdjustAlphaBlend.glsl-73258f38.js","assets/Normals.glsl-76f97814.js","assets/DefaultMaterial.glsl-885671b3.js","assets/VertexColor.glsl-8c022fa8.js","assets/DefaultTechniqueConfiguration-588e5ab2.js","assets/RealisticTree.glsl-b6cc03f2.js","assets/edgeProcessing-f733ce76.js","assets/deduplicate-03981d62.js","assets/projection-a69d43d0.js","assets/Octree-0a267ea2.js","assets/HUDMaterial.glsl-32cf019c.js","assets/sdfPrimitives-9858c36d.js","assets/floatRGBA-9ad35d39.js","assets/dehydratedFeatures-0557137d.js","assets/quantizationUtils-4dd81f85.js","assets/labelFormatUtils-d25d1d9e.js","assets/I3SUtil-f31a4571.js","assets/I3SBinaryReader-f4829435.js","assets/LineCallout.glsl-358ef89b.js","assets/earcut-58237617.js","assets/SnappingCandidate-970faec6.js","assets/MeshComponent-a43522cc.js","assets/MarkerSizing.glsl-566261cc.js","assets/RibbonLine.glsl-0f7c2bbc.js","assets/LineStipple.glsl-ed22a88b.js","assets/callExpressionWithFeature-55effb7b.js","assets/LineMarker.glsl-8166d610.js","assets/NativeLine.glsl-742e9e29.js","assets/Path.glsl-9f6bab44.js","assets/ColorMaterial.glsl-3a70e4a7.js","assets/Pattern.glsl-67f4595b.js","assets/DefaultVertexAttributeLayouts-2bcf3941.js","assets/LercDecoder-4c9b29b3.js","assets/config-1337d16e.js","assets/workerHelper-e756ac3a.js","assets/originUtils-1469eeaf.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/portalItemUtils-2ccd793f.js","assets/index-676169e4.css","assets/queryEngineUtils-0726d29f.js","assets/VertexSnappingCandidate-57064a33.js","assets/TileTreeDebugger-36d5c9d2.js","assets/LineVisualElement-bccf172d.js","assets/LengthDimension-6eb29622.js","assets/Segment-2acc0e69.js","assets/analysisViewUtils-ae3c8eee.js","assets/ImageMaterial-85877c86.js","assets/ImageMaterial.glsl-befce2a1.js","assets/Factory-265a09f6.js","assets/PointVisualElement-b23705fb.js","assets/RightAngleQuadVisualElement-77ea66a2.js","assets/colorUtils-0c057879.js","assets/EditGeometryOperations-464d8964.js","assets/QueryEngineResult-8f90b8dc.js","assets/WhereClause-d4b8b019.js","assets/utils-b34fcd9d.js","assets/generateRendererUtils-7252b5e6.js","assets/projectionSupport-aa5eaa0d.js","assets/json-48e3ea08.js","assets/utils-511aa5f5.js","assets/dehydratedFeatureComparison-59868945.js","assets/RenderTexture-a15e38d0.js"]));case"featureCollection":return t.addPromise(Ht(()=>import("./FeatureCollectionSnappingSource-8c307ec2.js"),["assets/FeatureCollectionSnappingSource-8c307ec2.js","assets/cast-fcb46737.js","assets/typedArrayUtil-4d7bb04c.js","assets/string-a318751c.js","assets/Error-ec6249b9.js","assets/ArrayPool-a8ee9378.js","assets/nextTick-3ee5a785.js","assets/promiseUtils-1e54421e.js","assets/reactiveUtils-4dabbb80.js","assets/elevationInfoUtils-36e5dd0f.js","assets/ElevationInfo-215614d8.js","assets/jsonMap-7b8332c9.js","assets/Extent-da876e26.js","assets/Ellipsoid-89682c5e.js","assets/fieldUtils-7f54c4b1.js","assets/preload-helper-3bce6601.js","assets/arcadeOnDemand-281a01eb.js","assets/geometry-b7901087.js","assets/Polyline-ff2d7c6b.js","assets/typeUtils-35750739.js","assets/lengthUtils-fa751420.js","assets/unitUtils-45d1147c.js","assets/queryEngineUtils-0726d29f.js","assets/VertexSnappingCandidate-57064a33.js","assets/symbologySnappingCandidates-4d49a371.js","assets/LRUCache-64ec42ee.js","assets/MemCache-18a255ed.js","assets/Collection-910b6f71.js","assets/Evented-a45c8b0f.js","assets/SimpleObservable-23231131.js","assets/LineVisualElement-bccf172d.js","assets/Promise-376ab9f6.js","assets/projection-290b739f.js","assets/mathUtils-b4bb77e2.js","assets/vec3-e93e648f.js","assets/vec3f64-2f9cef06.js","assets/common-c186b691.js","assets/vec4-790471c0.js","assets/mat4-44a0988f.js","assets/assets-8d3e737a.js","assets/request-6fc81c4c.js","assets/aaBoundingRect-193543b5.js","assets/zscale-89472cba.js","assets/index-a864af46.js","assets/Graphic-f0e54e86.js","assets/PopupTemplate-40f3c9aa.js","assets/Clonable-545593ce.js","assets/enumeration-3a03bd31.js","assets/number-27cf8195.js","assets/locale-30120714.js","assets/Identifiable-bfe1ff30.js","assets/symbols-f8232671.js","assets/CIMSymbol-539bd447.js","assets/Symbol-f93ed9fd.js","assets/Color-fb64d77d.js","assets/colorUtils-639f4d25.js","assets/screenUtils-410d12c0.js","assets/opacityUtils-1f7f5126.js","assets/symbolLayerUtils3D-76acc268.js","assets/aaBoundingBox-657a9b82.js","assets/persistableUrlUtils-5f719c3b.js","assets/Symbol3DAnchorPosition2D-5726d999.js","assets/collectionUtils-803d9ba8.js","assets/Portal-2bb189b3.js","assets/Loadable-268c900a.js","assets/PortalGroup-8e41557a.js","assets/PortalUser-659cc1d2.js","assets/jsonUtils-229211af.js","assets/Cyclical-151bcc41.js","assets/CollectionFlattener-8f4d518b.js","assets/workers-6e30d081.js","assets/Connection-9a1cf8da.js","assets/Queue-b7d3cd48.js","assets/intl-65a3e389.js","assets/messages-2289086c.js","assets/TileInfo-b0eb8c90.js","assets/widget-fb292a2f.js","assets/uuid-73213768.js","assets/HandleOwner-9b396af1.js","assets/byteSizeEstimations-f0cab514.js","assets/executeQueryJSON-2fe748db.js","assets/normalizeUtils-27e29a72.js","assets/query-694f7287.js","assets/pbfQueryUtils-4adda2cc.js","assets/pbf-0e99a620.js","assets/OptimizedFeature-4ab8d380.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/queryZScale-1481fa99.js","assets/FeatureSet-d32b0eb8.js","assets/Field-61ec9870.js","assets/fieldType-f31285f7.js","assets/Query-b96bcde0.js","assets/TimeExtent-23e282b9.js","assets/RelationshipQuery-0dda77ad.js","assets/LegendOptions-010d0873.js","assets/utils-6786b611.js","assets/asyncUtils-437defc4.js","assets/parser-498c8be0.js","assets/mat4f32-77b3d8ac.js","assets/ItemCache-fd3aceaf.js","assets/jsonUtils-f5674613.js","assets/UniqueValueRenderer-08f8851c.js","assets/diffUtils-68b89c71.js","assets/colorRamps-9dac42c1.js","assets/sizeVariableUtils-d4870b0d.js","assets/compilerUtils-18d58939.js","assets/jsonUtils-0ff4ff96.js","assets/styleUtils-22b14a8b.js","assets/DictionaryLoader-1cbfea53.js","assets/deprecate-035b199e.js","assets/heatmapUtils-aaea3f32.js","assets/vec4f64-e407da96.js","assets/featureConversionUtils-03a03f40.js","assets/TopFeaturesQuery-cad97c37.js","assets/FeatureLayer-041050b6.js","assets/MultiOriginJSONSupport-aae3bc0c.js","assets/LayerFloorInfo-54b916a2.js","assets/FeatureLayerBase-ad5cfa1a.js","assets/HeightModelInfo-5d01231e.js","assets/arcgisLayerUrl-c09f09b4.js","assets/OperationalLayer-97084f13.js","assets/Layer-5ffe0eda.js","assets/editsZScale-6a661299.js","assets/APIKeyMixin-a0a8917a.js","assets/ArcGISService-21dc1d06.js","assets/BlendLayer-20d0571b.js","assets/CustomParametersMixin-47aab0a6.js","assets/EditBusLayer-e750b15b.js","assets/FeatureReductionLayer-d69dae71.js","assets/labelingInfo-607e66b8.js","assets/labelUtils-3108e8d7.js","assets/defaultsJSON-59981e75.js","assets/OrderedLayer-af7a6030.js","assets/PortalLayer-b2643f87.js","assets/PortalItem-bb7e98a6.js","assets/RefreshableLayer-7f154951.js","assets/ScaleRangeLayer-4be07229.js","assets/TemporalLayer-61549309.js","assets/TimeInfo-1d30dc7c.js","assets/FeatureTemplate-c1d0bb70.js","assets/FeatureType-34d71ade.js","assets/fieldProperties-e2eeb1d5.js","assets/FieldsIndex-f104cc5f.js","assets/versionUtils-fd91f55f.js","assets/styleUtils-a989c0af.js","assets/popupUtils-86dc6b94.js","assets/mat2d-2bbb5feb.js","assets/Scheduler-540208b6.js","assets/Basemap-af7f62f8.js","assets/loadAll-b5bfa7ab.js","assets/writeUtils-e686bd33.js","assets/layerUtils-f4d08f94.js","assets/TablesMixin-bc97d131.js","assets/GraphicsCollection-c37a9ffd.js","assets/ViewingMode-5d7d590b.js","assets/enums-0fc02184.js","assets/vec2-528adfe4.js","assets/vec2f64-30dc1443.js","assets/mat3-3fc68e72.js","assets/mat3f32-d3d088e8.js","assets/vec2f32-461e65a9.js","assets/TileStrategy-a90cd1af.js","assets/TileStore-00ac650f.js","assets/TileKey-5aef17b6.js","assets/rbush-8e36784a.js","assets/quickselect-322ec8e1.js","assets/capabilities-302cf20d.js","assets/context-util-a4ce3a7b.js","assets/BoundsStore-b9fa27cc.js","assets/PooledRBush-3e149119.js","assets/mat3f64-c6305894.js","assets/sphere-2af0d852.js","assets/mat4f64-1e28eae0.js","assets/quatf64-7fd38d64.js","assets/lineSegment-10422ca0.js","assets/plane-b575face.js","assets/scaleUtils-93ad8d0c.js","assets/ElevationSamplerData-b87e0e50.js","assets/PhysicallyBasedRendering.glsl-d457fff5.js","assets/View.glsl-3ce196d4.js","assets/ShaderBuilder-a7d0da4e.js","assets/FloatPassUniform-68d54f51.js","assets/Float4PassUniform-d7bdbc81.js","assets/RgbaFloatEncoding.glsl-52af7fcf.js","assets/Texture2DPassUniform-753de459.js","assets/vec3f32-c9aa289f.js","assets/VertexAttribute-9c5c630d.js","assets/Texture2DDrawUniform-053796dc.js","assets/basicInterfaces-19ed850e.js","assets/PiUtils.glsl-db6418ee.js","assets/ReadLinearDepth.glsl-9c87a54a.js","assets/WaterSurface.glsl-c64cb8f1.js","assets/ForwardLinearDepth.glsl-56affafd.js","assets/Matrix3PassUniform-ad9f953b.js","assets/Slice.glsl-3b39b1f7.js","assets/Transform.glsl-6d2e2fd9.js","assets/OutputHighlight.glsl-fbac199a.js","assets/MultipassTerrainTest.glsl-bb236672.js","assets/NormalUtils.glsl-c12729bf.js","assets/AlphaCutoff-96178e0d.js","assets/TransparencyPassType-a11868d2.js","assets/EvaluateSceneLighting.glsl-189abc15.js","assets/VisualVariablePassParameters-d460182b.js","assets/enums-64ab819c.js","assets/VertexElementDescriptor-2925c6af.js","assets/FramebufferObject-a3b9c52c.js","assets/Texture-243be4d7.js","assets/Util-a48361c6.js","assets/SSAOBlur.glsl-8bf33b65.js","assets/ScreenSpacePass-d5e48a9b.js","assets/SSAO.glsl-980b3771.js","assets/ShaderTechniqueConfiguration-9f5b4555.js","assets/HUD.glsl-d3a072ad.js","assets/VerticalOffset.glsl-87cbb2e3.js","assets/objectResourceUtils-d556a033.js","assets/devEnvironmentUtils-5002a058.js","assets/BufferView-903d1848.js","assets/vec33-e98769e8.js","assets/DefaultMaterial_COLOR_GAMMA-fe26fda8.js","assets/types-e1c0a5bf.js","assets/Version-2946cc03.js","assets/quat-3d5eec2d.js","assets/Texture-46c8c2cb.js","assets/TextureOnly.glsl-1ec9a9ef.js","assets/InterleavedLayout-984d67b2.js","assets/MixExternalColor.glsl-ab0706f7.js","assets/symbolColorUtils-b2b55883.js","assets/ObjectAndLayerIdColor.glsl-ad468647.js","assets/OutputDepth.glsl-470c8e2a.js","assets/VisualVariables.glsl-2b937327.js","assets/DiscardOrAdjustAlphaBlend.glsl-73258f38.js","assets/Normals.glsl-76f97814.js","assets/DefaultMaterial.glsl-885671b3.js","assets/VertexColor.glsl-8c022fa8.js","assets/DefaultTechniqueConfiguration-588e5ab2.js","assets/RealisticTree.glsl-b6cc03f2.js","assets/edgeProcessing-f733ce76.js","assets/deduplicate-03981d62.js","assets/projection-a69d43d0.js","assets/Octree-0a267ea2.js","assets/HUDMaterial.glsl-32cf019c.js","assets/sdfPrimitives-9858c36d.js","assets/floatRGBA-9ad35d39.js","assets/dehydratedFeatures-0557137d.js","assets/quantizationUtils-4dd81f85.js","assets/labelFormatUtils-d25d1d9e.js","assets/I3SUtil-f31a4571.js","assets/I3SBinaryReader-f4829435.js","assets/LineCallout.glsl-358ef89b.js","assets/earcut-58237617.js","assets/SnappingCandidate-970faec6.js","assets/MeshComponent-a43522cc.js","assets/MarkerSizing.glsl-566261cc.js","assets/RibbonLine.glsl-0f7c2bbc.js","assets/LineStipple.glsl-ed22a88b.js","assets/callExpressionWithFeature-55effb7b.js","assets/LineMarker.glsl-8166d610.js","assets/NativeLine.glsl-742e9e29.js","assets/Path.glsl-9f6bab44.js","assets/ColorMaterial.glsl-3a70e4a7.js","assets/Pattern.glsl-67f4595b.js","assets/DefaultVertexAttributeLayouts-2bcf3941.js","assets/LercDecoder-4c9b29b3.js","assets/config-1337d16e.js","assets/workerHelper-e756ac3a.js","assets/originUtils-1469eeaf.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/portalItemUtils-2ccd793f.js","assets/index-676169e4.css","assets/LengthDimension-6eb29622.js","assets/Segment-2acc0e69.js","assets/analysisViewUtils-ae3c8eee.js","assets/ImageMaterial-85877c86.js","assets/ImageMaterial.glsl-befce2a1.js","assets/Factory-265a09f6.js","assets/PointVisualElement-b23705fb.js","assets/RightAngleQuadVisualElement-77ea66a2.js","assets/colorUtils-0c057879.js","assets/EditGeometryOperations-464d8964.js","assets/QueryEngineResult-8f90b8dc.js","assets/WhereClause-d4b8b019.js","assets/utils-b34fcd9d.js","assets/generateRendererUtils-7252b5e6.js","assets/projectionSupport-aa5eaa0d.js","assets/json-48e3ea08.js","assets/utils-511aa5f5.js","assets/dehydratedFeatureComparison-59868945.js","assets/RenderTexture-a15e38d0.js"]));case"graphics":case"notes":return t.addPromise(Ht(()=>import("./GraphicsSnappingSource-f797e593.js"),["assets/GraphicsSnappingSource-f797e593.js","assets/cast-fcb46737.js","assets/typedArrayUtil-4d7bb04c.js","assets/string-a318751c.js","assets/Error-ec6249b9.js","assets/ArrayPool-a8ee9378.js","assets/nextTick-3ee5a785.js","assets/promiseUtils-1e54421e.js","assets/asyncUtils-437defc4.js","assets/HandleOwner-9b396af1.js","assets/reactiveUtils-4dabbb80.js","assets/Polyline-ff2d7c6b.js","assets/Extent-da876e26.js","assets/Ellipsoid-89682c5e.js","assets/projection-290b739f.js","assets/preload-helper-3bce6601.js","assets/mathUtils-b4bb77e2.js","assets/vec3-e93e648f.js","assets/vec3f64-2f9cef06.js","assets/common-c186b691.js","assets/vec4-790471c0.js","assets/unitUtils-45d1147c.js","assets/jsonMap-7b8332c9.js","assets/SimpleObservable-23231131.js","assets/mat4-44a0988f.js","assets/assets-8d3e737a.js","assets/request-6fc81c4c.js","assets/aaBoundingRect-193543b5.js","assets/zscale-89472cba.js","assets/index-a864af46.js","assets/Graphic-f0e54e86.js","assets/geometry-b7901087.js","assets/typeUtils-35750739.js","assets/PopupTemplate-40f3c9aa.js","assets/Clonable-545593ce.js","assets/Collection-910b6f71.js","assets/Evented-a45c8b0f.js","assets/fieldUtils-7f54c4b1.js","assets/arcadeOnDemand-281a01eb.js","assets/enumeration-3a03bd31.js","assets/number-27cf8195.js","assets/locale-30120714.js","assets/Identifiable-bfe1ff30.js","assets/symbols-f8232671.js","assets/CIMSymbol-539bd447.js","assets/Symbol-f93ed9fd.js","assets/Color-fb64d77d.js","assets/colorUtils-639f4d25.js","assets/screenUtils-410d12c0.js","assets/opacityUtils-1f7f5126.js","assets/symbolLayerUtils3D-76acc268.js","assets/aaBoundingBox-657a9b82.js","assets/persistableUrlUtils-5f719c3b.js","assets/Symbol3DAnchorPosition2D-5726d999.js","assets/collectionUtils-803d9ba8.js","assets/Portal-2bb189b3.js","assets/Loadable-268c900a.js","assets/Promise-376ab9f6.js","assets/PortalGroup-8e41557a.js","assets/PortalUser-659cc1d2.js","assets/jsonUtils-229211af.js","assets/Cyclical-151bcc41.js","assets/CollectionFlattener-8f4d518b.js","assets/workers-6e30d081.js","assets/Connection-9a1cf8da.js","assets/Queue-b7d3cd48.js","assets/intl-65a3e389.js","assets/messages-2289086c.js","assets/TileInfo-b0eb8c90.js","assets/widget-fb292a2f.js","assets/uuid-73213768.js","assets/byteSizeEstimations-f0cab514.js","assets/executeQueryJSON-2fe748db.js","assets/normalizeUtils-27e29a72.js","assets/query-694f7287.js","assets/pbfQueryUtils-4adda2cc.js","assets/pbf-0e99a620.js","assets/OptimizedFeature-4ab8d380.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/queryZScale-1481fa99.js","assets/FeatureSet-d32b0eb8.js","assets/Field-61ec9870.js","assets/fieldType-f31285f7.js","assets/Query-b96bcde0.js","assets/TimeExtent-23e282b9.js","assets/RelationshipQuery-0dda77ad.js","assets/LegendOptions-010d0873.js","assets/utils-6786b611.js","assets/parser-498c8be0.js","assets/mat4f32-77b3d8ac.js","assets/ItemCache-fd3aceaf.js","assets/MemCache-18a255ed.js","assets/jsonUtils-f5674613.js","assets/UniqueValueRenderer-08f8851c.js","assets/diffUtils-68b89c71.js","assets/colorRamps-9dac42c1.js","assets/sizeVariableUtils-d4870b0d.js","assets/compilerUtils-18d58939.js","assets/lengthUtils-fa751420.js","assets/jsonUtils-0ff4ff96.js","assets/styleUtils-22b14a8b.js","assets/DictionaryLoader-1cbfea53.js","assets/LRUCache-64ec42ee.js","assets/deprecate-035b199e.js","assets/heatmapUtils-aaea3f32.js","assets/vec4f64-e407da96.js","assets/featureConversionUtils-03a03f40.js","assets/TopFeaturesQuery-cad97c37.js","assets/FeatureLayer-041050b6.js","assets/MultiOriginJSONSupport-aae3bc0c.js","assets/LayerFloorInfo-54b916a2.js","assets/FeatureLayerBase-ad5cfa1a.js","assets/HeightModelInfo-5d01231e.js","assets/arcgisLayerUrl-c09f09b4.js","assets/OperationalLayer-97084f13.js","assets/ElevationInfo-215614d8.js","assets/Layer-5ffe0eda.js","assets/editsZScale-6a661299.js","assets/APIKeyMixin-a0a8917a.js","assets/ArcGISService-21dc1d06.js","assets/BlendLayer-20d0571b.js","assets/CustomParametersMixin-47aab0a6.js","assets/EditBusLayer-e750b15b.js","assets/FeatureReductionLayer-d69dae71.js","assets/labelingInfo-607e66b8.js","assets/labelUtils-3108e8d7.js","assets/defaultsJSON-59981e75.js","assets/OrderedLayer-af7a6030.js","assets/PortalLayer-b2643f87.js","assets/PortalItem-bb7e98a6.js","assets/RefreshableLayer-7f154951.js","assets/ScaleRangeLayer-4be07229.js","assets/TemporalLayer-61549309.js","assets/TimeInfo-1d30dc7c.js","assets/FeatureTemplate-c1d0bb70.js","assets/FeatureType-34d71ade.js","assets/fieldProperties-e2eeb1d5.js","assets/FieldsIndex-f104cc5f.js","assets/versionUtils-fd91f55f.js","assets/styleUtils-a989c0af.js","assets/popupUtils-86dc6b94.js","assets/mat2d-2bbb5feb.js","assets/Scheduler-540208b6.js","assets/Basemap-af7f62f8.js","assets/loadAll-b5bfa7ab.js","assets/writeUtils-e686bd33.js","assets/layerUtils-f4d08f94.js","assets/TablesMixin-bc97d131.js","assets/GraphicsCollection-c37a9ffd.js","assets/ViewingMode-5d7d590b.js","assets/enums-0fc02184.js","assets/vec2-528adfe4.js","assets/vec2f64-30dc1443.js","assets/mat3-3fc68e72.js","assets/mat3f32-d3d088e8.js","assets/vec2f32-461e65a9.js","assets/TileStrategy-a90cd1af.js","assets/TileStore-00ac650f.js","assets/TileKey-5aef17b6.js","assets/rbush-8e36784a.js","assets/quickselect-322ec8e1.js","assets/capabilities-302cf20d.js","assets/context-util-a4ce3a7b.js","assets/BoundsStore-b9fa27cc.js","assets/PooledRBush-3e149119.js","assets/mat3f64-c6305894.js","assets/sphere-2af0d852.js","assets/mat4f64-1e28eae0.js","assets/quatf64-7fd38d64.js","assets/lineSegment-10422ca0.js","assets/plane-b575face.js","assets/scaleUtils-93ad8d0c.js","assets/ElevationSamplerData-b87e0e50.js","assets/PhysicallyBasedRendering.glsl-d457fff5.js","assets/View.glsl-3ce196d4.js","assets/ShaderBuilder-a7d0da4e.js","assets/FloatPassUniform-68d54f51.js","assets/Float4PassUniform-d7bdbc81.js","assets/RgbaFloatEncoding.glsl-52af7fcf.js","assets/Texture2DPassUniform-753de459.js","assets/vec3f32-c9aa289f.js","assets/VertexAttribute-9c5c630d.js","assets/Texture2DDrawUniform-053796dc.js","assets/basicInterfaces-19ed850e.js","assets/PiUtils.glsl-db6418ee.js","assets/ReadLinearDepth.glsl-9c87a54a.js","assets/WaterSurface.glsl-c64cb8f1.js","assets/ForwardLinearDepth.glsl-56affafd.js","assets/Matrix3PassUniform-ad9f953b.js","assets/Slice.glsl-3b39b1f7.js","assets/Transform.glsl-6d2e2fd9.js","assets/OutputHighlight.glsl-fbac199a.js","assets/MultipassTerrainTest.glsl-bb236672.js","assets/NormalUtils.glsl-c12729bf.js","assets/AlphaCutoff-96178e0d.js","assets/TransparencyPassType-a11868d2.js","assets/EvaluateSceneLighting.glsl-189abc15.js","assets/VisualVariablePassParameters-d460182b.js","assets/enums-64ab819c.js","assets/VertexElementDescriptor-2925c6af.js","assets/FramebufferObject-a3b9c52c.js","assets/Texture-243be4d7.js","assets/Util-a48361c6.js","assets/SSAOBlur.glsl-8bf33b65.js","assets/ScreenSpacePass-d5e48a9b.js","assets/SSAO.glsl-980b3771.js","assets/ShaderTechniqueConfiguration-9f5b4555.js","assets/HUD.glsl-d3a072ad.js","assets/VerticalOffset.glsl-87cbb2e3.js","assets/objectResourceUtils-d556a033.js","assets/devEnvironmentUtils-5002a058.js","assets/BufferView-903d1848.js","assets/vec33-e98769e8.js","assets/DefaultMaterial_COLOR_GAMMA-fe26fda8.js","assets/types-e1c0a5bf.js","assets/Version-2946cc03.js","assets/quat-3d5eec2d.js","assets/Texture-46c8c2cb.js","assets/TextureOnly.glsl-1ec9a9ef.js","assets/InterleavedLayout-984d67b2.js","assets/MixExternalColor.glsl-ab0706f7.js","assets/symbolColorUtils-b2b55883.js","assets/ObjectAndLayerIdColor.glsl-ad468647.js","assets/OutputDepth.glsl-470c8e2a.js","assets/VisualVariables.glsl-2b937327.js","assets/DiscardOrAdjustAlphaBlend.glsl-73258f38.js","assets/Normals.glsl-76f97814.js","assets/DefaultMaterial.glsl-885671b3.js","assets/VertexColor.glsl-8c022fa8.js","assets/DefaultTechniqueConfiguration-588e5ab2.js","assets/RealisticTree.glsl-b6cc03f2.js","assets/edgeProcessing-f733ce76.js","assets/deduplicate-03981d62.js","assets/projection-a69d43d0.js","assets/Octree-0a267ea2.js","assets/HUDMaterial.glsl-32cf019c.js","assets/sdfPrimitives-9858c36d.js","assets/floatRGBA-9ad35d39.js","assets/dehydratedFeatures-0557137d.js","assets/quantizationUtils-4dd81f85.js","assets/labelFormatUtils-d25d1d9e.js","assets/I3SUtil-f31a4571.js","assets/I3SBinaryReader-f4829435.js","assets/LineCallout.glsl-358ef89b.js","assets/earcut-58237617.js","assets/SnappingCandidate-970faec6.js","assets/MeshComponent-a43522cc.js","assets/MarkerSizing.glsl-566261cc.js","assets/RibbonLine.glsl-0f7c2bbc.js","assets/LineStipple.glsl-ed22a88b.js","assets/callExpressionWithFeature-55effb7b.js","assets/LineMarker.glsl-8166d610.js","assets/NativeLine.glsl-742e9e29.js","assets/Path.glsl-9f6bab44.js","assets/ColorMaterial.glsl-3a70e4a7.js","assets/Pattern.glsl-67f4595b.js","assets/DefaultVertexAttributeLayouts-2bcf3941.js","assets/LercDecoder-4c9b29b3.js","assets/config-1337d16e.js","assets/workerHelper-e756ac3a.js","assets/originUtils-1469eeaf.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/portalItemUtils-2ccd793f.js","assets/index-676169e4.css","assets/FeatureStore-3cfbdfa3.js","assets/optimizedFeatureQueryEngineAdapter-d72f082e.js","assets/centroid-5c988df3.js","assets/QueryEngine-cdb0ba2c.js","assets/QueryEngineResult-8f90b8dc.js","assets/WhereClause-d4b8b019.js","assets/utils-b34fcd9d.js","assets/generateRendererUtils-7252b5e6.js","assets/projectionSupport-aa5eaa0d.js","assets/json-48e3ea08.js","assets/utils-511aa5f5.js","assets/QueryEngineCapabilities-42e44ded.js","assets/timeSupport-3de56d7f.js","assets/elevationInfoUtils-36e5dd0f.js","assets/queryEngineUtils-0726d29f.js","assets/VertexSnappingCandidate-57064a33.js","assets/symbologySnappingCandidates-4d49a371.js","assets/LineVisualElement-bccf172d.js","assets/LengthDimension-6eb29622.js","assets/Segment-2acc0e69.js","assets/analysisViewUtils-ae3c8eee.js","assets/ImageMaterial-85877c86.js","assets/ImageMaterial.glsl-befce2a1.js","assets/Factory-265a09f6.js","assets/PointVisualElement-b23705fb.js","assets/RightAngleQuadVisualElement-77ea66a2.js","assets/colorUtils-0c057879.js","assets/EditGeometryOperations-464d8964.js","assets/dehydratedFeatureComparison-59868945.js","assets/RenderTexture-a15e38d0.js"]));case"scene":return t.addPromise(Ht(()=>import("./SceneLayerSnappingSource-7a4f894a.js"),["assets/SceneLayerSnappingSource-7a4f894a.js","assets/cast-fcb46737.js","assets/typedArrayUtil-4d7bb04c.js","assets/string-a318751c.js","assets/Error-ec6249b9.js","assets/ArrayPool-a8ee9378.js","assets/nextTick-3ee5a785.js","assets/promiseUtils-1e54421e.js","assets/HandleOwner-9b396af1.js","assets/reactiveUtils-4dabbb80.js","assets/index-a864af46.js","assets/preload-helper-3bce6601.js","assets/Graphic-f0e54e86.js","assets/geometry-b7901087.js","assets/Extent-da876e26.js","assets/Ellipsoid-89682c5e.js","assets/Polyline-ff2d7c6b.js","assets/typeUtils-35750739.js","assets/jsonMap-7b8332c9.js","assets/PopupTemplate-40f3c9aa.js","assets/Clonable-545593ce.js","assets/Collection-910b6f71.js","assets/Evented-a45c8b0f.js","assets/SimpleObservable-23231131.js","assets/fieldUtils-7f54c4b1.js","assets/arcadeOnDemand-281a01eb.js","assets/enumeration-3a03bd31.js","assets/number-27cf8195.js","assets/locale-30120714.js","assets/Identifiable-bfe1ff30.js","assets/symbols-f8232671.js","assets/CIMSymbol-539bd447.js","assets/Symbol-f93ed9fd.js","assets/Color-fb64d77d.js","assets/colorUtils-639f4d25.js","assets/mathUtils-b4bb77e2.js","assets/vec3-e93e648f.js","assets/vec3f64-2f9cef06.js","assets/common-c186b691.js","assets/vec4-790471c0.js","assets/screenUtils-410d12c0.js","assets/opacityUtils-1f7f5126.js","assets/symbolLayerUtils3D-76acc268.js","assets/aaBoundingBox-657a9b82.js","assets/aaBoundingRect-193543b5.js","assets/request-6fc81c4c.js","assets/persistableUrlUtils-5f719c3b.js","assets/Symbol3DAnchorPosition2D-5726d999.js","assets/collectionUtils-803d9ba8.js","assets/Portal-2bb189b3.js","assets/Loadable-268c900a.js","assets/Promise-376ab9f6.js","assets/PortalGroup-8e41557a.js","assets/PortalUser-659cc1d2.js","assets/jsonUtils-229211af.js","assets/Cyclical-151bcc41.js","assets/CollectionFlattener-8f4d518b.js","assets/workers-6e30d081.js","assets/Connection-9a1cf8da.js","assets/Queue-b7d3cd48.js","assets/assets-8d3e737a.js","assets/intl-65a3e389.js","assets/messages-2289086c.js","assets/projection-290b739f.js","assets/unitUtils-45d1147c.js","assets/mat4-44a0988f.js","assets/zscale-89472cba.js","assets/TileInfo-b0eb8c90.js","assets/widget-fb292a2f.js","assets/uuid-73213768.js","assets/byteSizeEstimations-f0cab514.js","assets/executeQueryJSON-2fe748db.js","assets/normalizeUtils-27e29a72.js","assets/query-694f7287.js","assets/pbfQueryUtils-4adda2cc.js","assets/pbf-0e99a620.js","assets/OptimizedFeature-4ab8d380.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/queryZScale-1481fa99.js","assets/FeatureSet-d32b0eb8.js","assets/Field-61ec9870.js","assets/fieldType-f31285f7.js","assets/Query-b96bcde0.js","assets/TimeExtent-23e282b9.js","assets/RelationshipQuery-0dda77ad.js","assets/LegendOptions-010d0873.js","assets/utils-6786b611.js","assets/asyncUtils-437defc4.js","assets/parser-498c8be0.js","assets/mat4f32-77b3d8ac.js","assets/ItemCache-fd3aceaf.js","assets/MemCache-18a255ed.js","assets/jsonUtils-f5674613.js","assets/UniqueValueRenderer-08f8851c.js","assets/diffUtils-68b89c71.js","assets/colorRamps-9dac42c1.js","assets/sizeVariableUtils-d4870b0d.js","assets/compilerUtils-18d58939.js","assets/lengthUtils-fa751420.js","assets/jsonUtils-0ff4ff96.js","assets/styleUtils-22b14a8b.js","assets/DictionaryLoader-1cbfea53.js","assets/LRUCache-64ec42ee.js","assets/deprecate-035b199e.js","assets/heatmapUtils-aaea3f32.js","assets/vec4f64-e407da96.js","assets/featureConversionUtils-03a03f40.js","assets/TopFeaturesQuery-cad97c37.js","assets/FeatureLayer-041050b6.js","assets/MultiOriginJSONSupport-aae3bc0c.js","assets/LayerFloorInfo-54b916a2.js","assets/FeatureLayerBase-ad5cfa1a.js","assets/HeightModelInfo-5d01231e.js","assets/arcgisLayerUrl-c09f09b4.js","assets/OperationalLayer-97084f13.js","assets/ElevationInfo-215614d8.js","assets/Layer-5ffe0eda.js","assets/editsZScale-6a661299.js","assets/APIKeyMixin-a0a8917a.js","assets/ArcGISService-21dc1d06.js","assets/BlendLayer-20d0571b.js","assets/CustomParametersMixin-47aab0a6.js","assets/EditBusLayer-e750b15b.js","assets/FeatureReductionLayer-d69dae71.js","assets/labelingInfo-607e66b8.js","assets/labelUtils-3108e8d7.js","assets/defaultsJSON-59981e75.js","assets/OrderedLayer-af7a6030.js","assets/PortalLayer-b2643f87.js","assets/PortalItem-bb7e98a6.js","assets/RefreshableLayer-7f154951.js","assets/ScaleRangeLayer-4be07229.js","assets/TemporalLayer-61549309.js","assets/TimeInfo-1d30dc7c.js","assets/FeatureTemplate-c1d0bb70.js","assets/FeatureType-34d71ade.js","assets/fieldProperties-e2eeb1d5.js","assets/FieldsIndex-f104cc5f.js","assets/versionUtils-fd91f55f.js","assets/styleUtils-a989c0af.js","assets/popupUtils-86dc6b94.js","assets/mat2d-2bbb5feb.js","assets/Scheduler-540208b6.js","assets/Basemap-af7f62f8.js","assets/loadAll-b5bfa7ab.js","assets/writeUtils-e686bd33.js","assets/layerUtils-f4d08f94.js","assets/TablesMixin-bc97d131.js","assets/GraphicsCollection-c37a9ffd.js","assets/ViewingMode-5d7d590b.js","assets/enums-0fc02184.js","assets/vec2-528adfe4.js","assets/vec2f64-30dc1443.js","assets/mat3-3fc68e72.js","assets/mat3f32-d3d088e8.js","assets/vec2f32-461e65a9.js","assets/TileStrategy-a90cd1af.js","assets/TileStore-00ac650f.js","assets/TileKey-5aef17b6.js","assets/rbush-8e36784a.js","assets/quickselect-322ec8e1.js","assets/capabilities-302cf20d.js","assets/context-util-a4ce3a7b.js","assets/BoundsStore-b9fa27cc.js","assets/PooledRBush-3e149119.js","assets/mat3f64-c6305894.js","assets/sphere-2af0d852.js","assets/mat4f64-1e28eae0.js","assets/quatf64-7fd38d64.js","assets/lineSegment-10422ca0.js","assets/plane-b575face.js","assets/scaleUtils-93ad8d0c.js","assets/ElevationSamplerData-b87e0e50.js","assets/PhysicallyBasedRendering.glsl-d457fff5.js","assets/View.glsl-3ce196d4.js","assets/ShaderBuilder-a7d0da4e.js","assets/FloatPassUniform-68d54f51.js","assets/Float4PassUniform-d7bdbc81.js","assets/RgbaFloatEncoding.glsl-52af7fcf.js","assets/Texture2DPassUniform-753de459.js","assets/vec3f32-c9aa289f.js","assets/VertexAttribute-9c5c630d.js","assets/Texture2DDrawUniform-053796dc.js","assets/basicInterfaces-19ed850e.js","assets/PiUtils.glsl-db6418ee.js","assets/ReadLinearDepth.glsl-9c87a54a.js","assets/WaterSurface.glsl-c64cb8f1.js","assets/ForwardLinearDepth.glsl-56affafd.js","assets/Matrix3PassUniform-ad9f953b.js","assets/Slice.glsl-3b39b1f7.js","assets/Transform.glsl-6d2e2fd9.js","assets/OutputHighlight.glsl-fbac199a.js","assets/MultipassTerrainTest.glsl-bb236672.js","assets/NormalUtils.glsl-c12729bf.js","assets/AlphaCutoff-96178e0d.js","assets/TransparencyPassType-a11868d2.js","assets/EvaluateSceneLighting.glsl-189abc15.js","assets/VisualVariablePassParameters-d460182b.js","assets/enums-64ab819c.js","assets/VertexElementDescriptor-2925c6af.js","assets/FramebufferObject-a3b9c52c.js","assets/Texture-243be4d7.js","assets/Util-a48361c6.js","assets/SSAOBlur.glsl-8bf33b65.js","assets/ScreenSpacePass-d5e48a9b.js","assets/SSAO.glsl-980b3771.js","assets/ShaderTechniqueConfiguration-9f5b4555.js","assets/HUD.glsl-d3a072ad.js","assets/VerticalOffset.glsl-87cbb2e3.js","assets/objectResourceUtils-d556a033.js","assets/devEnvironmentUtils-5002a058.js","assets/BufferView-903d1848.js","assets/vec33-e98769e8.js","assets/DefaultMaterial_COLOR_GAMMA-fe26fda8.js","assets/types-e1c0a5bf.js","assets/Version-2946cc03.js","assets/quat-3d5eec2d.js","assets/Texture-46c8c2cb.js","assets/TextureOnly.glsl-1ec9a9ef.js","assets/InterleavedLayout-984d67b2.js","assets/MixExternalColor.glsl-ab0706f7.js","assets/symbolColorUtils-b2b55883.js","assets/ObjectAndLayerIdColor.glsl-ad468647.js","assets/OutputDepth.glsl-470c8e2a.js","assets/VisualVariables.glsl-2b937327.js","assets/DiscardOrAdjustAlphaBlend.glsl-73258f38.js","assets/Normals.glsl-76f97814.js","assets/DefaultMaterial.glsl-885671b3.js","assets/VertexColor.glsl-8c022fa8.js","assets/DefaultTechniqueConfiguration-588e5ab2.js","assets/RealisticTree.glsl-b6cc03f2.js","assets/edgeProcessing-f733ce76.js","assets/deduplicate-03981d62.js","assets/projection-a69d43d0.js","assets/Octree-0a267ea2.js","assets/HUDMaterial.glsl-32cf019c.js","assets/sdfPrimitives-9858c36d.js","assets/floatRGBA-9ad35d39.js","assets/dehydratedFeatures-0557137d.js","assets/quantizationUtils-4dd81f85.js","assets/labelFormatUtils-d25d1d9e.js","assets/I3SUtil-f31a4571.js","assets/I3SBinaryReader-f4829435.js","assets/LineCallout.glsl-358ef89b.js","assets/earcut-58237617.js","assets/SnappingCandidate-970faec6.js","assets/MeshComponent-a43522cc.js","assets/MarkerSizing.glsl-566261cc.js","assets/RibbonLine.glsl-0f7c2bbc.js","assets/LineStipple.glsl-ed22a88b.js","assets/callExpressionWithFeature-55effb7b.js","assets/LineMarker.glsl-8166d610.js","assets/NativeLine.glsl-742e9e29.js","assets/Path.glsl-9f6bab44.js","assets/ColorMaterial.glsl-3a70e4a7.js","assets/Pattern.glsl-67f4595b.js","assets/DefaultVertexAttributeLayouts-2bcf3941.js","assets/LercDecoder-4c9b29b3.js","assets/config-1337d16e.js","assets/workerHelper-e756ac3a.js","assets/originUtils-1469eeaf.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/portalItemUtils-2ccd793f.js","assets/index-676169e4.css","assets/elevationInfoUtils-36e5dd0f.js","assets/VertexSnappingCandidate-57064a33.js","assets/LineVisualElement-bccf172d.js","assets/LengthDimension-6eb29622.js","assets/Segment-2acc0e69.js","assets/analysisViewUtils-ae3c8eee.js","assets/ImageMaterial-85877c86.js","assets/ImageMaterial.glsl-befce2a1.js","assets/Factory-265a09f6.js","assets/PointVisualElement-b23705fb.js","assets/RightAngleQuadVisualElement-77ea66a2.js","assets/colorUtils-0c057879.js","assets/EditGeometryOperations-464d8964.js","assets/QueryEngineResult-8f90b8dc.js","assets/WhereClause-d4b8b019.js","assets/utils-b34fcd9d.js","assets/generateRendererUtils-7252b5e6.js","assets/projectionSupport-aa5eaa0d.js","assets/json-48e3ea08.js","assets/utils-511aa5f5.js","assets/dehydratedFeatureComparison-59868945.js","assets/RenderTexture-a15e38d0.js"]))}return null}};h([p({constructOnly:!0})],ue.prototype,"spatialReference",void 0),h([p({constructOnly:!0})],ue.prototype,"view",void 0),h([p()],ue.prototype,"options",void 0),h([p({readOnly:!0})],ue.prototype,"updating",null),h([p({readOnly:!0})],ue.prototype,"snappingSources",null),ue=h([N("esri.views.interactive.snapping.FeatureSnappingEngine")],ue);let Wa=class{constructor(e,t){this.snappingSource=e,this.layerView=t,this.handles=new st;const n=this.snappingSource.layerSource.layer;if("refresh"in n){const s=n;this.handles.add(s.on("refresh",()=>e.refresh()))}this.handles.add([E(()=>e.updating,s=>e.layerSource.updating=s,Y),E(()=>e.availability,s=>e.layerSource.availability=s,Y)])}destroy(){this.snappingSource.destroy(),this.handles.destroy()}};function gi(i,e,t,n,s,r,{coordinateHelper:o}){const a=V(Ja,e);a[0]+=t,a[1]+=n,a[2]+=s;const l=Tn(a,o.spatialReference,O,r);return fa(l,i)}const Ba=v(),wn=v(),Ja=v();let ri=class{constructor(e,t){this.view=e,this.options=t,this.squaredShortLineThreshold=P.shortLineThreshold*P.shortLineThreshold}snap(e,t){return f(t.vertexHandle)?t.vertexHandle.type!=="vertex"?[]:this.snapExistingVertex(e,t):this.snapNewVertex(e,t)}edgeExceedsShortLineThreshold(e,t){return this.exceedsShortLineThreshold(e.leftVertex.pos,e.rightVertex.pos,t)}exceedsShortLineThreshold(e,t,{elevationInfo:n,editGeometryOperations:s}){const r=s.data.coordinateHelper;return this.squaredShortLineThreshold===0||Ve(q(t,r,n,this.view),q(e,r,n,this.view))>this.squaredShortLineThreshold}squaredProximityThreshold(e){return e==="touch"?this._squaredTouchProximityThreshold:this._squaredMouseProximityTreshold}get _squaredMouseProximityTreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,n=e*t;return n*n}},Qa=class extends at{constructor({coordinateHelper:e,lineStart:t,lineEnd:n,targetPoint:s,elevationInfo:r}){super(e,s,new Os(e,t,n),r,z.SELF),this._referenceLineHint=new he(j.REFERENCE_EXTENSION,t,n,r,this.domain)}get hints(){return[this._referenceLineHint,new he(j.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.elevationInfo,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}},Ka=class extends ri{snapNewVertex(e,t){const n=t.editGeometryOperations.data.components[0],s=n.edges.length,r=[];if(s<1)return r;const o=t.coordinateHelper,a=q(e,o,O,this.view),{view:l}=this,c=n.edges[s-1];let d=c;do{if(this.edgeExceedsShortLineThreshold(d,t)){const u=ae(d,l,t);this._processCandidateProposal(u.left,u.right,e,a,t,r)}d=d.leftVertex.leftEdge}while(d&&d!==c);return r}snapExistingVertex(e,t){const n=[],s=ne(t.vertexHandle),r=s.component;if(r.edges.length<2)return n;const{view:o}=this,{coordinateHelper:a}=t,l=q(e,a,O,o),c=s.leftEdge,d=s.rightEdge;c&&d&&this.edgeExceedsShortLineThreshold(c,t)&&this.edgeExceedsShortLineThreshold(d,t)&&this._processCandidateProposal(A(c.leftVertex.pos,o,t),A(d.rightVertex.pos,o,t),e,l,t,n);const u=r.edges[0];let m=u;do{if(m!==s.leftEdge&&m!==s.rightEdge&&this.edgeExceedsShortLineThreshold(m,t)){const _=ae(m,o,t);this._processCandidateProposal(_.left,_.right,e,l,t,n)}m=m.rightVertex.rightEdge}while(m&&m!==u);return n}_processCandidateProposal(e,t,n,s,r,o){const{coordinateHelper:a,pointer:l}=r;a.toXYZ(e,As),a.toXYZ(t,Hs);const c=a.toXYZ(n,tl),d=qi(c,el),u=a.fromXYZ(d);Ve(s,q(u,a,O,this.view))<this.squaredProximityThreshold(l)&&o.push(new Qa({coordinateHelper:a,lineStart:e,lineEnd:t,targetPoint:u,elevationInfo:a.hasZ()?O:null}))}};const As=v(),Hs=v(),el={start:As,end:Hs,type:I.LINE},tl=v();let il=class extends at{constructor({coordinateHelper:e,referenceLine:t,lineStart:n,targetPoint:s,elevationInfo:r}){const o=e.toXYZ(n,nl),a=e.toXYZ(t.left,sl),l=e.toXYZ(t.right,rl);ot(o,An(o,o,l),a),super(e,s,new Os(e,n,e.fromXYZ(o)),r,z.SELF),this._referenceLines=[{edge:t,fadeLeft:!0,fadeRight:!0}]}get hints(){const e=this.elevationInfo;return[new he(j.TARGET,this.constraint.start,this.targetPoint,e,this.domain),new hs(this.constraint.start,this.targetPoint,e,this.domain),...this._referenceLines.map(t=>new he(j.REFERENCE,t.edge.left,t.edge.right,e,this.domain,t.fadeLeft,t.fadeRight))]}addReferenceLine(e){const t={edge:e,fadeLeft:!0,fadeRight:!0},{coordinateHelper:n}=this;this._referenceLines.forEach(s=>{n.equals(e.right,s.edge.left)&&(s.fadeLeft=!1,t.fadeRight=!1),n.equals(e.right,s.edge.right)&&(s.fadeRight=!1,t.fadeRight=!1),n.equals(e.left,s.edge.right)&&(s.fadeRight=!1,t.fadeLeft=!1),n.equals(e.left,s.edge.left)&&(s.fadeLeft=!1,t.fadeLeft=!1)}),this._referenceLines.push(t)}};const nl=v(),sl=v(),rl=v();let ol=class extends ri{snapNewVertex(e,t){const n=t.editGeometryOperations.data.components[0],s=n.edges.length,r=n.vertices.length,o=[];if(s<2)return o;const{view:a}=this,l=q(e,t.coordinateHelper,O,a),c=A(n.vertices[r-1].pos,a,t),d=A(n.vertices[0].pos,a,t),u=n.edges[s-1];let m=u;do{if(this.edgeExceedsShortLineThreshold(m,t)){const _=ae(m,a,t);this._checkEdgeForParalleLines(_,c,e,l,t,o),this._checkEdgeForParalleLines(_,d,e,l,t,o)}m=m.leftVertex.leftEdge}while(m&&m!==u);return o}snapExistingVertex(e,t){const n=[],s=ne(t.vertexHandle),r=s.component;if(r.edges.length<3)return n;const{view:o}=this,a=q(e,t.coordinateHelper,O,o),l=s.leftEdge,c=s.rightEdge,d=r.vertices[0],u=A(d.pos,o,t),m=r.vertices.length,_=r.vertices[m-1],g=A(_.pos,o,t),S=r.edges[0];let w=S;do{if(w!==l&&w!==c&&this.edgeExceedsShortLineThreshold(w,t)){const H=ae(w,o,t);l&&this._checkEdgeForParalleLines(H,A(l.leftVertex.pos,o,t),e,a,t,n),c&&this._checkEdgeForParalleLines(H,A(c.rightVertex.pos,o,t),e,a,t,n),s===d?this._checkEdgeForParalleLines(H,g,e,a,t,n):s===_&&this._checkEdgeForParalleLines(H,u,e,a,t,n)}w=w.rightVertex.rightEdge}while(w&&w!==S);return n}_checkEdgeForParalleLines(e,t,n,s,r,o){const a=e.left,l=e.right;if(ui(Ge,t,a,l),on(Ge,t)<P.parallelLineThreshold)return;ui(Ge,n,a,l,t);const{coordinateHelper:c,pointer:d}=r,u=c.fromXYZ(Ge,c.getZ(n,0));if(Ve(s,q(u,c,O,this.view))<this.squaredProximityThreshold(d)){if(this._parallelToPreviousCandidate(e,o))return;o.push(new il({coordinateHelper:c,referenceLine:e,lineStart:t,targetPoint:u,elevationInfo:c.hasZ()?O:null}))}}_parallelToPreviousCandidate(e,t){const n=e.left,s=e.right;for(const r of t)if(ui(Ge,s,r.constraint.start,r.constraint.end,n),on(Ge,s)<P.parallelLineThreshold)return r.addReferenceLine(e),!0;return!1}};const Ge=ze();class al extends ri{snapNewVertex(e,t){const n=t.editGeometryOperations.data.components[0],s=n.vertices.length,r=[];if(s<2)return r;const{view:o}=this,a=q(e,t.coordinateHelper,O,o),l=n.vertices[s-1];if(this.edgeExceedsShortLineThreshold(l.leftEdge,t)){const d=A(l.pos,o,t),u=ae(l.leftEdge,o,t);this._checkForSnappingCandidate(r,u,d,e,u.left,d,t,e,a)}const c=n.vertices[0];if(this.edgeExceedsShortLineThreshold(c.rightEdge,t)){const d=A(c.pos,o,t),u=ae(c.rightEdge,o,t);this._checkForSnappingCandidate(r,u,d,e,u.right,d,t,e,a)}return r}snapExistingVertex(e,t){const n=[],s=ne(t.vertexHandle),r=s.component,o=r.vertices.length;if(o<3)return n;const{view:a}=this,l=q(e,t.coordinateHelper,O,a),c=s.leftEdge,d=s.rightEdge,u=r.vertices[0],m=r.vertices[o-1];if(!c){const _=u.rightEdge.rightVertex.rightEdge;if(this.edgeExceedsShortLineThreshold(_,t)){const g=ae(_,a,t),S=A(u.rightEdge.rightVertex.pos,a,t);this._checkForSnappingCandidate(n,g,S,e,g.right,S,t,e,l)}return n}if(!d){const _=m.leftEdge.leftVertex.leftEdge;if(this.edgeExceedsShortLineThreshold(_,t)){const g=ae(_,a,t),S=A(m.leftEdge.leftVertex.pos,a,t);this._checkForSnappingCandidate(n,g,S,e,g.left,S,t,e,l)}return n}if(c&&c.leftVertex.leftEdge){const _=c.leftVertex.leftEdge;if(this.edgeExceedsShortLineThreshold(_,t)){const g=ae(_,a,t),S=A(c.leftVertex.pos,a,t);this._checkForSnappingCandidate(n,g,S,e,g.left,S,t,e,l)}}if(d&&d.rightVertex.rightEdge){const _=d.rightVertex.rightEdge;if(this.edgeExceedsShortLineThreshold(_,t)){const g=ae(_,a,t),S=A(d.rightVertex.pos,a,t);this._checkForSnappingCandidate(n,g,S,e,g.right,S,t,e,l)}}return n}_checkForSnappingCandidate(e,t,n,s,r,o,a,l,c){const{coordinateHelper:d,pointer:u}=a;de(ut,t.right,t.left);const m=se(dl,ut[1],-ut[0],0),_=Ot(m,de(ut,s,n))/xt(m),g=d.fromXYZ(Ae(ut,o,m,_),d.getZ(l,0));if(Ve(c,q(g,d,O,this.view))<this.squaredProximityThreshold(u)){const S=d.toXYZ(o,ll),w=ce(cl,S,m,Math.sign(_)),H=d.fromXYZ(w);e.push(new Ls({coordinateHelper:d,targetPoint:g,constraint:new Ts(d,o,H),previousVertex:r,otherVertex:o,otherVertexType:nt.CENTER,elevationInfo:d.hasZ()?O:null}))}}}const ut=ze(),ll=v(),cl=v(),dl=v();let hl=class extends at{constructor({coordinateHelper:e,targetPoint:t,point1:n,point2:s,elevationInfo:r}){super(e,t,new Cs(e,e.arrayToVector(Gn(ul,n,s,.5)),.5*Zn(n,s)),r,z.SELF),this._p1=n,this._p2=s}get hints(){const e=this.elevationInfo;return[new he(j.REFERENCE,this.targetPoint,this._p1,e,this.domain),new he(j.REFERENCE,this.targetPoint,this._p2,e,this.domain),new Yi(this._p1,this.targetPoint,this._p2,e,this.domain)]}};const ul=ze();class pl extends ri{snapNewVertex(e,t){const n=t.editGeometryOperations.data.components[0],s=[],r=n.vertices.length;if(t.editGeometryOperations.data.type!=="polygon"||r<2)return s;const{view:o}=this,a=n.vertices[0],l=n.vertices[r-1],c=A(a.pos,o,t),d=A(l.pos,o,t);return this._processCandidateProposal(c,d,e,t,s),s}snapExistingVertex(e,t){const n=[],s=ne(t.vertexHandle),r=s.component;if(r.edges.length<2||t.editGeometryOperations.data.type==="polyline"&&(s.index===0||s.index===r.vertices.length-1))return n;const{view:o}=this,a=A(s.leftEdge.leftVertex.pos,o,t),l=A(s.rightEdge.rightVertex.pos,o,t);return this._processCandidateProposal(a,l,e,t,n),n}_processCandidateProposal(e,t,n,s,r){if(!this.exceedsShortLineThreshold(e,t,s))return;const o=Gn(ml,e,t,.5),a=.5*Zn(e,t),l=ho(fl,n,o,a),{coordinateHelper:c,pointer:d}=s,u=c.fromXYZ(l,c.getZ(n,0)),m=q(n,c,O,this.view);Ve(m,q(u,c,O,this.view))<this.squaredProximityThreshold(d)&&r.push(new hl({coordinateHelper:c,targetPoint:u,point1:e,point2:t,elevationInfo:c.hasZ()?O:null}))}}const ml=ze(),fl=ze();let Ye=class extends ye{constructor(i){super(i),this.updating=!1,this._snappers=new rt,this._domain=z.SELF}initialize(){this._snappers.push(new ol(this.view,this.options),new Ka(this.view,this.options),new al(this.view,this.options),new pl(this.view,this.options))}set options(i){this._set("options",i);for(const e of this._snappers)e.options=i}async fetchCandidates(i,e,t){if(!(e&this._domain&&this.options.effectiveSelfEnabled))return[];const n=[];for(const s of this._snappers.items)for(const r of s.snap(i,t))n.push(r);return Zi(i,n,t.coordinateHelper),n}};h([p({readOnly:!0})],Ye.prototype,"updating",void 0),h([p({constructOnly:!0})],Ye.prototype,"view",void 0),h([p()],Ye.prototype,"options",null),Ye=h([N("esri.views.interactive.snapping.SelfSnappingEngine")],Ye);function gl(i,e){return[new Ye({view:i,options:e}),new ue({view:i,options:e,spatialReference:i.spatialReference})]}class Zt extends at{constructor(e,t,n,s,r){super(e,t,new Ms(e,t,n.constraint,s.constraint),r,z.ALL),this.first=n,this.second=s}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new ls(this.targetPoint,this.elevationInfo,this.domain)]}}let oe=class extends _o.EventedMixin(Ii){constructor(e){super(e),this.options=new gs,this.snappingEnginesFactory=gl,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=pe.MAIN}initialize(){this.handles.add([E(()=>{const{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:n,distance:s}=this.options;return{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:n,distance:s}},()=>{this.doneSnapping(),this.emit("changed")},Ke),E(()=>this.options,e=>{for(const t of this._engines)t.options=e},Ke),E(()=>({viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,snappingEnginesFactory:this.snappingEnginesFactory}),({viewReady:e,snappingEnginesFactory:t})=>this._recreateEngines(e,t),Y)])}destroy(){this._destroyEngines()}get updating(){return this._engines.some(e=>e.updating)}_recreateEngines(e,t){if(this._destroyEngines(),!e)return;const{view:n,options:s}=this;this._engines=t(n,s)}_destroyEngines(){for(const e of this._engines)e.destroy();this._engines=[]}get _squaredMouseProximityTreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,n=e*t;return n*n}async snap(e){return _l(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){const{point:t,context:n}=e;this._removeVisualization();const s=this._currentMainCandidate;if(y(s))return t;const r=this._selectUpdateInput(e);if(y(r))return t;const{coordinateHelper:{spatialReference:o}}=n,a=tn(this._convertPointElevation(r,n),o);if(y(a))return t;const{view:l}=this,{coordinateHelper:c,elevationInfo:d,visualizer:u}=n,m=[],_=c.pointToVector(a),g=s.constraint.closestTo(_);if(!this._arePointsWithinScreenThreshold(_,g,n))return this._resetSnappingState(),t;s.targetPoint=g,m.push(...s.hints);for(const w of this._currentOtherActiveCandidates)w.targetPoint=g,m.push(...w.hints);f(u)&&this.handles.add(u.draw(m,{coordinateHelper:c,elevationInfo:xn(n),view:l,selfSnappingZ:n.selfSnappingZ}),Yt);const S=c.vectorToDehydratedPoint(g);return this._convertPointElevation(S,n,O,d)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:e,scenePoint:t}){switch(this._currentSnappedType){case pe.MAIN:return e;case pe.SCENE:return t}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=pe.MAIN}_removeVisualization(){this.handles.remove(Yt)}async _snapSinglePoint({point:e,context:t,signal:n}){const{coordinateHelper:s}=t,{view:r}=this,o=this._convertPointElevation(e,t),a=s.pointToVector(o),l=await this._fetchCandidates(a,z.ALL,t,n);return this._createSnapResult(a,pe.MAIN,l,r,t,n)}async _snapMultiPoint({point:e,scenePoint:t,context:n,signal:s}){const{view:r}=this,{coordinateHelper:o}=n,{spatialReference:a}=o;await Mr(t.spatialReference,a);const l=tn(this._convertPointElevation(t,n),a),c=o.pointToVector(l),d=await this._fetchCandidates(c,z.FEATURE,n,s);if(d.length>0){const g=await this._fetchCandidates(c,z.SELF,n,s);return this._createSnapResult(c,pe.SCENE,[...d,...g],r,n,s)}const u=this._convertPointElevation(e,n),m=o.pointToVector(u),_=await this._fetchCandidates(m,z.SELF,n,s);return this._createSnapResult(m,pe.MAIN,_,r,n,s)}async _fetchCandidates(e,t,n,s){return(await Promise.all(this._engines.map(r=>r.fetchCandidates(e,t,n,s)))).flat()}_createSnapResult(e,t,n,s,r,o){return{get valid(){return!Tr(o)},apply:()=>{const{elevationInfo:a,coordinateHelper:l}=r,{snappedPoint:c,hints:d}=this._processCandidates(e,t,n,r);return this._removeVisualization(),f(r.visualizer)&&this.handles.add(r.visualizer.draw(d,{coordinateHelper:l,elevationInfo:xn(r),view:s,selfSnappingZ:r.selfSnappingZ}),Yt),this._convertPointElevation(c,r,O,a)}}}_processCandidates(e,t,n,s){const{coordinateHelper:r}=s;if(n.length<1)return this.doneSnapping(),{snappedPoint:r.vectorToDehydratedPoint(e),hints:[]};this._currentSnappedType!==t&&this._resetSnappingState(),Zi(e,n,r);const o=this._currentMainCandidate;if(f(o)){const a=this._findOldConstraintInNewCandidates(o,n);if(a>=0){if(!(n[a]instanceof Zt))return this._intersectWithOtherCandidates(a,n,e,t,s);if(this._arePointsWithinScreenThreshold(e,o.targetPoint,s))return this._updateSnappingCandidate(o,t,n,s)}}return this._intersectWithOtherCandidates(0,n,e,t,s)}_findOldConstraintInNewCandidates(e,t){return e instanceof Zt?this._findOldCandidateIndex(t,e.first)>=0&&this._findOldCandidateIndex(t,e.second)>=0?0:-1:this._findOldCandidateIndex(t,e)}_intersectWithOtherCandidates(e,t,n,s,r){const{coordinateHelper:o}=r,a=t[e],l=[];for(let c=0;c<t.length;++c){if(c===e)continue;const d=t[c];for(const u of a.constraint.intersect(d.constraint)){const m=o.fromXYZ(u.closestTo(a.targetPoint),a.targetPoint[2]);l.push([new Zt(o,m,a,d,d.elevationInfo),this._squaredScreenDistance(n,m,o)])}}return l.length>0&&(l.sort((c,d)=>c[1]-d[1]),l[0][1]<this._squaredPointProximityThreshold(r.pointer))?this._updateSnappingCandidate(l[0][0],s,t,r):this._updateSnappingCandidate(a,s,t,r)}_updateSnappingCandidate(e,t,n,s){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=t;const r=this._currentMainCandidate.targetPoint,o=[];o.push(...e.hints);for(const a of n){if(e instanceof Zt){if(a.constraint.equals(e.first.constraint)||a.constraint.equals(e.second.constraint))continue}else if(a.constraint.equals(e.constraint))continue;a.constraint.check(r)&&(a.targetPoint=r,this._currentOtherActiveCandidates.push(a),o.push(...a.hints))}return{snappedPoint:s.coordinateHelper.vectorToDehydratedPoint(r),hints:o}}_squaredPointProximityThreshold(e){return e==="touch"?this._squaredTouchProximityThreshold:this._squaredMouseProximityTreshold}_arePointsWithinScreenThreshold(e,t,n){return this._squaredScreenDistance(e,t,n.coordinateHelper)<this._squaredPointProximityThreshold(n.pointer)}_squaredScreenDistance(e,t,n){return Ve(this._toScreen(e,n),this._toScreen(t,n))}_toScreen(e,t){return q(e,t,O,this.view)}_findOldCandidateIndex(e,t){let n=-1;for(let s=0;s<e.length;++s)if(t.constraint.equals(e[s].constraint)){n=s;break}return n}_convertPointElevation(e,t,n=t.elevationInfo,s=O){const{view:r}=this;if(!(f(e)&&t.coordinateHelper.hasZ()&&f(r)&&r.type==="3d"))return e;const o=qr(e);return o.z=ro(r,o,n,s),o}get test(){return{visualizationsActive:this.handles.has(Yt),engines:this._engines}}};var pe;h([p({constructOnly:!0})],oe.prototype,"view",void 0),h([p()],oe.prototype,"options",void 0),h([p({readOnly:!0})],oe.prototype,"updating",null),h([p()],oe.prototype,"snappingEnginesFactory",void 0),h([p()],oe.prototype,"_engines",void 0),h([p()],oe.prototype,"_squaredMouseProximityTreshold",null),h([p()],oe.prototype,"_squaredTouchProximityThreshold",null),oe=h([N("esri.views.interactive.snapping.SnappingManager")],oe),function(i){i[i.MAIN=0]="MAIN",i[i.SCENE=1]="SCENE"}(pe||(pe={}));const Yt="visualization-handle";function _l(i){return f(i.scenePoint)}function xn({coordinateHelper:i,elevationInfo:e}){return i.hasZ()?O:e}const jt=new Map;function yl(i){if(!jt.has(i)){const n=Ha(i,{distance:10}),s=Sl(i,n.options);jt.set(i,{referenceCount:0,snappingManager:s,remove:()=>{n.remove(),s.destroy()}})}const e=jt.get(i);e.referenceCount++;const t=Xt(()=>vl(i,e));return{snappingManager:e.snappingManager,...t}}function vl(i,e){e.referenceCount--,e.referenceCount>0||fo(()=>{e.referenceCount===0&&(e.remove(),jt.delete(i))})}function Sl(i,e){return new oe({view:i,options:e,snappingEnginesFactory:(t,n)=>[new ue({view:i,spatialReference:i.spatialReference,options:n})]})}let Ds=class{constructor(e){this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.selfSnappingZ=null,this.editGeometryOperations=e.editGeometryOperations,this.elevationInfo=e.elevationInfo,this.pointer=e.pointer,this.vertexHandle=e.vertexHandle,this.excludeFeature=e.excludeFeature,this.visualizer=e.visualizer,this.selfSnappingZ=e.selfSnappingZ}get coordinateHelper(){return this.editGeometryOperations.data.coordinateHelper}};class wl{constructor(){this.next=new Pi}createSnapDragEventPipelineStep({predicate:e=()=>!0,cancel:t,snappingManager:n,snappingContext:s,updatingHandles:r,useZ:o=!0}){if(y(n))return g=>g;let a=null,l=null;const c=()=>{a=yt(a),n.doneSnapping(),f(l)&&l.frameTask.remove(),l=null};t.next(g=>(c(),g)),this.next=new Pi;const d=this._createSnapFunction(n,o);let u=null,m=null,_=null;return g=>{if(!e(g))return g;if(g.action==="start"){const S=this._createFrameTask(n.view);if(l=this._createSnappingInfo(s,g,S),l.context.selfSnappingZ=null,!o&&f(g.info)){const w=this._extractSelfSnappingZ(s.coordinateHelper,g.info.handle.component);f(w)&&(l.context.selfSnappingZ={value:w,elevationInfo:s.elevationInfo})}}if(f(l)){const{context:S,originalScenePos:w,originalPos:H}=l,{mapEnd:lt,mapStart:xe,action:zs,scenePoints:Vs}=g,oi=this._updatePosition(H,this._computeMapDelta(lt,xe)),Xi=this._computeMapDelta(xe,H),Is={...g,action:"update"},Fs=l.context,ai=this._updateScenePosition(w,Vs),Ui=n.update({point:oi,scenePoint:ai,context:S});if(_=Ui,this._applySnappedUpdate(lt,Ui,Xi,o),u=oi,m=ai,zs!=="end"){const{frameTask:ks}=l;y(a)&&(a=new AbortController),r.addPromise(Dn(d({frameTask:ks,event:Is,context:Fs,point:oi,scenePoint:ai,delta:Xi,lastPos:u,lastScenePos:m,lastUpdate:_},a.signal)))}}return g.action==="end"&&c(),g}}_createSnapFunction(e,t){return zn(async({frameTask:n,point:s,scenePoint:r,context:o,event:a,delta:l,lastPos:c,lastScenePos:d,lastUpdate:u},m)=>{const _=await n.schedule(()=>e.snap({point:s,scenePoint:r,context:o,signal:m}),m);if(_.valid){let g=await n.schedule(()=>_.apply(),m);s!==c&&f(c)&&(g=e.update({point:c,scenePoint:d,context:o})),yo(g,u)||(this._applySnappedUpdate(a.mapEnd,g,l,t),this.next.execute(a))}})}_createFrameTask(e){return e.type==="3d"?e.resourceController.scheduler.registerTask(qn.SNAPPING):jn}_createSnappingInfo(e,t,n){return{context:new Ds({editGeometryOperations:e.editGeometryOperations,elevationInfo:e.elevationInfo,pointer:e.pointer,vertexHandle:f(t.info)?t.info.handle:null,excludeFeature:e.excludeFeature,visualizer:e.visualizer}),originalPos:f(t.snapOrigin)?e.coordinateHelper.vectorToDehydratedPoint(t.snapOrigin):t.mapStart,originalScenePos:f(t.scenePoints)?t.scenePoints.sceneStart:null,frameTask:n}}_updatePosition(e,[t,n,s]){const r=Ue(e);return r.x+=t,r.y+=n,r.hasZ&&(r.z+=s),r}_updateScenePosition(e,t){return y(e)||y(t)?null:this._updatePosition(e,this._computeMapDelta(t.sceneEnd,t.sceneStart))}_computeMapDelta(e,t){const n=e.hasZ&&t.hasZ?e.z-t.z:0;return[e.x-t.x,e.y-t.y,n]}_applySnappedUpdate(e,t,[n,s,r],o){e.x=t.x+n,e.y=t.y+s,o&&e.hasZ&&t.hasZ&&(e.z=t.z+r)}_extractSelfSnappingZ(e,t){if(!e.hasZ())return null;const n=t.vertices;let s=null;for(const r of n){const o=e.getZ(r.pos);if(f(s)&&Math.abs(o-s)>1e-6)return null;y(s)&&(s=o)}return s}}let be=class extends ye{constructor(i){super(i),this.constrainResult=e=>e,this._snapPoints=null,this._abortController=null,this._stagedPoint=null,this._snap=zn(async(e,t,n,s)=>{const r=await this._frameTask.schedule(()=>t.snap({...e,context:n,signal:s}),s);r.valid&&await this._frameTask.schedule(()=>{this.stagedPoint=r.apply(),e!==this._snapPoints&&f(this._snapPoints)&&(this.stagedPoint=t.update({...this._snapPoints,context:n}))},s)})}get stagedPoint(){return this._stagedPoint}set stagedPoint(i){this._stagedPoint=this.constrainResult(i)}initialize(){var e,t;const i=this.view.type==="3d"?(t=(e=this.view)==null?void 0:e.resourceController)==null?void 0:t.scheduler:null;this._frameTask=f(i)?i.registerTask(qn.SNAPPING):jn}destroy(){this._abortController=yt(this._abortController),this._frameTask=bn(this._frameTask)}async snap(i,e,t){const{point:n,scenePoint:s}=i;return this.stagedPoint=e.update({point:n,scenePoint:s,context:t}),this._snapPoints=i,y(this._abortController)&&(this._abortController=new AbortController),this._snap(i,e,t,this._abortController.signal)}abort(){this._abortController=yt(this._abortController)}};h([p({constructOnly:!0})],be.prototype,"view",void 0),h([p()],be.prototype,"stagedPoint",null),h([p()],be.prototype,"constrainResult",void 0),h([p()],be.prototype,"_stagedPoint",void 0),be=h([N("esri.views.interactive.snapping.SnappingOperation")],be);let G=class extends Ii{constructor(i){super(i),this._stagedDimension=null,this._computationManipulators=new Map,this._computationHandles=new st,this._snappingPipeline=new wl,this._snappingManagerResult=yl(i.view),this.addHandles(this._snappingManagerResult),this._unfocusedOffsetManipulatorMaterial=_i(),this._focusedOffsetManipulatorMaterial=_i(),this._thinOffsetManipulatorMaterial=_i(),this._thinOffsetManipulatorMaterial.setParameters({stipplePattern:De(2)}),this._constraintSnappingIndicator=new Ee({view:i.view,attached:!0,width:1,color:R.toUnitRGBA(T.constraint.color),renderOccluded:b.OccludeAndTransparent,stipplePattern:De(5)});const e=R.toUnitRGBA(T.disabledPointIndicator.color);e[3]*=T.disabledPointIndicator.opacity,this._stagedStartIndicator=new La({view:i.view,attached:!1,color:e,size:2*T.disabledPointIndicator.radius,elevationInfo:{mode:"absolute-height",offset:0},spatialReference:i.view.renderCoordsHelper.spatialReference,outlineSize:0,renderOccluded:b.OccludeAndTransparent})}initialize(){this._snappingOperation=new be({view:this.view}),this._orientationManipulatorTexture=Nr(this.view.toolViewManager.textures),this._orientationManipulatorMaterial=new co({transparent:!0,writeDepth:!1,textureId:this._orientationManipulatorTexture.texture.id,renderOccluded:b.Opaque});const{computations:i}=this.analysisViewData;for(const e of i)this._addComputation(e);this.addHandles([i.on("after-add",e=>this._addComputation(e.item)),i.on("after-remove",e=>this._removeComputation(e.item))]),this.addHandles([E(()=>({stagedPoint:this._snappingOperation.stagedPoint,stagedComputation:this._stagedComputation}),({stagedPoint:e,stagedComputation:t})=>{if(y(t)||y(e))return;const n=Ue(e,new ft);this._applyPointUpdate(t,{endPoint:n})},Ke),E(()=>({stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator}),(e,t)=>{const{stagedDimension:n,selectedComputation:s,firstGrabbedManipulator:r}=e;if(n===t.stagedDimension&&r===t.firstGrabbedManipulator){for(const o of[s,t.selectedComputation])if(f(o)){const a=this._computationManipulators.get(o);this._updateManipulators(o,a,e)}}else for(const[o,a]of this._computationManipulators)this._updateManipulators(o,a,e)},Y),E(()=>this.analysis.style.lineSize,e=>{this._updateManipulatorStyle(e)},Ut),E(()=>this.view.state.camera,()=>{f(this._stagedComputation)&&this._updateStagedDimensionOffset(this._stagedComputation)}),E(()=>Gs(this._stagedComputation,e=>{const t=e.elevationAlignedStartPoint,n=v();return f(t)&&this.view.renderCoordsHelper.toRenderCoords(t,n)?n:null}),e=>{f(e)?(this._stagedStartIndicator.vertices=[e],this._stagedStartIndicator.attached=!0):this._stagedStartIndicator.attached=!1})]),this.addHandles(this._constraintHandles),this.addHandles(this._snappingIndicatorHandles)}destroy(){this._snappingOperation=_t(this._snappingOperation),this._computationHandles.destroy(),this._constraintSnappingIndicator.destroy(),this._stagedStartIndicator.destroy(),this._orientationManipulatorMaterial.dispose(),this._orientationManipulatorTexture.release()}get updating(){return this.updatingHandles.updating||this._snappingManager.updating}get firstGrabbedManipulator(){return this.parentTool.firstGrabbedManipulator}get hasGrabbedManipulators(){return this.parentTool.hasGrabbedManipulators}get _snappingManager(){return this._snappingManagerResult.snappingManager}get _activeComputation(){if(f(this._stagedComputation))return this._stagedComputation;const{selectedComputation:i}=this.analysisViewData;return this.hasGrabbedManipulators&&f(i)?i:null}get _stagedComputation(){const i=this._stagedDimension,e=this.analysisViewData.computations.at(-1);return y(i)||y(e)||e.dimension!==i?null:e}get _constraintHandles(){return[Li(()=>this.analysisViewData.selectedComputation,i=>{i.previousConstraint=kt(i,this.view)},{...Y,equals:Ei}),E(()=>{const i=this._activeComputation;if(y(i))return null;const{measureType:e,orientation:t}=i.dimension;return{measureType:e,orientation:t,computation:i}},(i,e)=>{if(f(i)&&y(e)){const{measureType:t,orientation:n,computation:s}=i;switch(s.previousConstraint){case Q.Horizontal:s.preConstraintProperties={measureType:$.Horizontal,orientation:0};break;case Q.Vertical:s.preConstraintProperties={measureType:$.Vertical,orientation:0};break;case Q.Direct:s.preConstraintProperties={measureType:$.Direct,orientation:n};break;default:s.preConstraintProperties={measureType:t,orientation:n}}}y(i)&&f(e)&&(e.computation.preConstraintProperties=null)},Ke)]}get _snappingIndicatorHandles(){const i="snapping-indicator-event-handles";return[E(()=>({stagedComputation:this._stagedComputation,activeComputation:this._activeComputation}),({stagedComputation:e,activeComputation:t})=>{const n=this._constraintSnappingIndicator;if(this.removeHandles(i),y(t))n.attached=!1;else if(t===e)n.attached=!0;else{const{start:s,end:r}=this._computationManipulators.get(t),o=()=>{n.attached=s.grabbing||r.grabbing};o(),this.addHandles([s.events.on("grab-changed",o),r.events.on("grab-changed",o)],i)}}),E(()=>{const e=this._activeComputation;return f(e)?{geometry:e.geometry,constraint:e.previousConstraint}:{}},({geometry:e,constraint:t})=>{const n=this._constraintSnappingIndicator;f(e)&&f(t)&&t!==Q.Direct?(n.visible=!0,n.setGeometryFromSegment(e.directSegment)):n.visible=!1})]}removeStaged(){return!!f(this._stagedDimension)&&(this.analysis.dimensions.remove(this._stagedDimension),this._stagedDimension=null,!0)}onDeactivate(){this.removeStaged(),this._resetSnappingState()}onClick(i){const{_stagedDimension:e}=this;if(y(e)){const t=this._onUnstagedClick(i);return this.analysis.dimensions.add(t),null}return this._onStagedClick(i),e}onPointerMove({mapPoint:i,pointerType:e}){if(e==="touch")return;const t=this._snappingContext(e);this.updatingHandles.addPromise(Dn(this._snappingOperation.snap({point:i},this._snappingManager,t)))}onManipulatorSelectionChanged(){f(this.analysisViewData.selectedComputation)&&(this._computationManipulators.get(this.analysisViewData.selectedComputation).offset.selected||(this.analysisViewData.selectedDimension=null))}_onUnstagedClick({mapPoint:i,pointerType:e}){let t=i;if(e==="mouse"){const s=this._snappingContext(e);t=this._snappingManager.update({point:i,context:s})}const n=new Us({startPoint:Ue(t,new ft),endPoint:null,measureType:$.Horizontal});return this._stagedDimension=n,this._resetSnappingState(),n}_onStagedClick({mapPoint:i,pointerType:e}){const t=this._stagedComputation;if(y(t))return;let n=i;if(e==="mouse"){const r=this._snappingContext(e);n=this._snappingManager.update({point:i,context:r})}const s=Ue(n,new ft);this._applyPointUpdate(t,{endPoint:s}),this._stagedDimension=null,this._resetSnappingState()}_resetSnappingState(){this._snappingManager.doneSnapping(),this._snappingOperation.abort(),this._snappingOperation.stagedPoint=null}_addComputation(i){if(this._computationManipulators.has(i))return;const e=this._setupPointManipulator(i,{isStart:!0}),t=this._setupPointManipulator(i,{isStart:!1}),n=this._setupOffsetManipulator(i),s=this._setupHeadingManipulator(i),r=this._setupRotationManipulator(i),o=this._setupMeasureTypeManipulator(i,$.Direct),a=this._setupMeasureTypeManipulator(i,$.Horizontal),l=this._setupMeasureTypeManipulator(i,$.Vertical),c=new Yo({start:e,end:t,offset:n,heading:s,rotation:r,direct:o,horizontal:a,vertical:l});this._setupComputationToManipulatorsSync(i,c),this._computationManipulators.set(i,c),this.manipulators.addMany(c.values())}_removeComputation(i){const e=this._computationManipulators.get(i);if(!y(e)){this._computationHandles.remove(i),this._computationManipulators.delete(i);for(const t of e.values())this.manipulators.remove(t)}}_setupComputationToManipulatorsSync(i,e){this._computationHandles.add([E(()=>i.geometry,()=>this._updateManipulators(i,e),{...Y,equals:Ei})],i)}_setupPointManipulator(i,e){const{view:t}=this,{dimension:n}=i,s=qo(t,{metadata:n}),r=Uo(s,{isStart:e.isStart,createSnappingPipelineStep:(o,a)=>this._snappingPipeline.createSnapDragEventPipelineStep({snappingContext:this._snappingContext(a),snappingManager:this._snappingManager,updatingHandles:this.updatingHandles,cancel:o}),dimension:n,onUpdate:o=>{this._applyPointUpdate(i,o)},snappingPipeline:this._snappingPipeline,view:t});return this._computationHandles.add(r,i),s}_setupOffsetManipulator(i){const{view:e}=this,t=jo(e,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,metadata:i.dimension}),n=Wo(t,{computation:i,view:e});return this._computationHandles.add(n,i),t}_setupHeadingManipulator(i){const{view:e}=this,t=dn(e,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:i.dimension}),n=Bo(t,{computation:i,view:e});return this._computationHandles.add(n,i),t}_setupRotationManipulator(i){const{view:e}=this,t=dn(e,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:i.dimension}),n=Jo(t,{computation:i,view:e});return this._computationHandles.add(n,i),t}_setupMeasureTypeManipulator(i,e){const{view:t}=this,n=Xo(t,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,thinOffsetManipulatorMaterial:this._thinOffsetManipulatorMaterial,metadata:i.dimension}),s=ea(n,{computation:i,manipulatorMeasureType:e,view:t});return this._computationHandles.add(s,i),n}_updateManipulators(i,e,t={stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator}){const{stagedDimension:n,selectedComputation:s,firstGrabbedManipulator:r}=t,{start:o,end:a,offset:l,heading:c,rotation:d}=e,u=s===i,m=Et(i),{dimension:_}=i;for(const w of e.values()){const H=m&&y(n)&&(y(r)||w===r);w===l?(w.available=H,w.selected=u):w.available=H&&u}if(!m)return;f(kt(i,this.view))?e.forEachMeasureTypeManipulator(w=>w.available=!1):e.manipulatorForMeasureType(_.measureType).available=!1;for(const w of[c,d])_.measureType===$.Direct&&_.offset!==0||(w.available=!1);Fi(i)?d.available=!1:c.available=!1;const{geometry:g}=i;o.renderLocation=g.directSegment.startRenderSpace,a.renderLocation=g.directSegment.endRenderSpace;const{renderCoordsHelper:S}=this.view;ta(l,g,S),c.available&&ia(c,i,S),d.available&&na(d,i,S),e.forEachMeasureTypeManipulator((w,H)=>{w.available&&oa(w,i,H,S)})}_updateManipulatorStyle(i){const e=da(i),t=Gi(i),n={lineSizePt:i,material:this._orientationManipulatorMaterial};for(const{offset:s,heading:r,rotation:o}of this._computationManipulators.values())s.radius=t/2,hn(r,n),hn(o,n);this._unfocusedOffsetManipulatorMaterial.setParameters({width:e}),this._focusedOffsetManipulatorMaterial.setParameters({width:t})}_snappingContext(i){return new Ds({elevationInfo:{mode:"absolute-height",offset:0},pointer:i,editGeometryOperations:new uo(new po("point",mo(!0,!1,this.view.spatialReference))),visualizer:new va})}_applyPointUpdate(i,e){const{view:t}=this,n=Bt(i);"startPoint"in e&&(n.elevationAlignedStartPoint=e.startPoint),"endPoint"in e&&(n.elevationAlignedEndPoint=e.endPoint);const s=Jt(n,t.renderCoordsHelper);if(y(s))return;const r=kt({...n,geometry:s},t);ha(i,e,{...n,constraint:r,unconstrainedGeometry:s,view:t}),i===this._stagedComputation&&this._updateStagedDimensionOffset(i)}_updateStagedDimensionOffset(i){if(y(i.geometry))return;i.geometry.directSegment.eval(.5,Pn);const e=this.view.state.camera.computeRenderPixelSizeAt(Pn);i.dimension.offset=T.initialOffsetPx*e}get testInfo(){const i=e=>this.analysisViewData.computations.find(t=>t.dimension===e);return{getManipulatorsForDimension:e=>this._computationManipulators.get(i(e)),getComputationForDimension:e=>i(e),getConstraintForDimension:e=>{const t=i(e);return f(t)?kt(t,this.view):null},stagedDimension:this._stagedDimension,stagedStartIndicator:this._stagedStartIndicator,constraintSnappingIndicator:this._constraintSnappingIndicator,snappingManager:this._snappingManager}}};function _i(){const{color:i,opacity:e}=T.offsetManipulator;return new Re({color:[...R.toUnitRGB(i),e],width:1,renderOccluded:b.OccludeAndTransparent,writeDepth:!1,hasPolygonOffset:!0})}h([p({constructOnly:!0})],G.prototype,"analysis",void 0),h([p({constructOnly:!0})],G.prototype,"analysisViewData",void 0),h([p({constructOnly:!0})],G.prototype,"manipulators",void 0),h([p({constructOnly:!0})],G.prototype,"parentTool",void 0),h([p({constructOnly:!0,nonNullable:!0})],G.prototype,"view",void 0),h([p({readOnly:!0})],G.prototype,"updating",null),h([p()],G.prototype,"firstGrabbedManipulator",null),h([p()],G.prototype,"hasGrabbedManipulators",null),h([p()],G.prototype,"_stagedDimension",void 0),h([p()],G.prototype,"_activeComputation",null),h([p()],G.prototype,"_stagedComputation",null),G=h([N("esri.views.3d.analysis.Dimension.LengthDimensionSubTool")],G);const Pn=v(),En={redo:"r",undo:"z",center:"Alt",constraint:"Shift",snappingToggle:"Control",cancel:"Escape",delete:["Backspace","Delete"],complete:"Enter",vertexAdd:"f",pan:" "};var Xe;(function(i){i.Ready="ready",i.Creating="creating",i.Created="created"})(Xe||(Xe={}));let U=class extends zr{constructor(i){super(i),this.automaticManipulatorSelection=!1,this.removeIncompleteOnCancel=!1,this._pointerMoveTimerMs=T.pointerMoveTimeoutMs,this._prevPointerMoveTimeout=null}initialize(){this._intersector=vr(this.view.state.viewingMode),this._intersector.options.store=Sr.MIN,this._lengthDimensionSubTool=new G({analysis:this.analysis,analysisViewData:this.analysisViewData,manipulators:this.manipulators,parentTool:this,view:this.view}),this.addHandles([Ze(this._lengthDimensionSubTool),Xt(()=>this._clearPointerMoveTimeout()),E(()=>this.state,i=>{i===Xe.Created&&this.finishToolCreation()},Y),Li(()=>this.firstGrabbedManipulator,i=>{this.selectedDimension=i.metadata},Y),E(()=>this.selectedDimension,()=>this._resetPointerMoveTimeout(),Y)])}get state(){return this.analysis.dimensions.some(i=>i.type==="length")?f(this._activeSubTool)?Xe.Creating:Xe.Created:Xe.Ready}get updating(){return this._lengthDimensionSubTool.updating}get cursor(){return this.active?"crosshair":null}get selectedDimension(){return this.analysisViewData.selectedDimension}set selectedDimension(i){this.analysisViewData.selectedDimension=i}onInputEvent(i){switch(i.type){case"immediate-click":this._clickHandler(i);break;case"immediate-double-click":this._doubleClickHandler(i);break;case"pointer-move":this._pointerMoveHandler(i);break;case"key-down":if(En.cancel===i.key){if(f(this._activeSubTool)&&this._activeSubTool.removeStaged())return void i.stopPropagation();this.active||(this.selectedDimension=null)}else En.delete.includes(i.key)&&this._deleteKeyHandler()}}onActivate(){this._activeSubTool=this._lengthDimensionSubTool}onDeactivate(){f(this._activeSubTool)&&(this._activeSubTool.onDeactivate(),this._activeSubTool=null)}onShow(){this._resetPointerMoveTimeout()}onManipulatorSelectionChanged(){this._lengthDimensionSubTool.onManipulatorSelectionChanged()}onHide(){this.selectedDimension=null}_clickHandler(i){if(this.hasFocusedManipulators)return void i.stopPropagation();if(y(this._activeSubTool))return;const e=this._intersectScreen(i);y(e)||(this.selectedDimension=this._activeSubTool.onClick({mapPoint:e,pointerType:i.pointerType}),i.stopPropagation())}_doubleClickHandler(i){this.active&&(this.view.activeTool=null,i.stopPropagation())}_pointerMoveHandler(i){if(this._resetPointerMoveTimeout(),y(this._activeSubTool)||this.hasFocusedManipulators)return;const e=this._intersectScreen(i);y(e)||this._activeSubTool.onPointerMove({mapPoint:e,pointerType:i.pointerType})}_deleteKeyHandler(){f(this._activeSubTool)&&this._activeSubTool.removeStaged(),this._removeSelected()}_intersectScreen(i){const e=wr(i);this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(e,this._intersector);const t=this._intersector.results.min,n=M.get();return t.getIntersectionPoint(n)?this.view.renderCoordsHelper.fromRenderCoords(n,this.view.spatialReference):null}_removeSelected(){f(this.selectedDimension)&&(this.analysis.dimensions.remove(this.selectedDimension),this.selectedDimension=null)}_clearPointerMoveTimeout(){this._prevPointerMoveTimeout=bn(this._prevPointerMoveTimeout)}_resetPointerMoveTimeout(){this._clearPointerMoveTimeout(),this.manipulators.forEach(i=>{i.manipulator.state|=me}),this._prevPointerMoveTimeout=Or.setTimeout(()=>{this.manipulators.forEach(i=>{i.manipulator.state&=~me})},this._pointerMoveTimerMs)}get testInfo(){return{...this._lengthDimensionSubTool.testInfo,setManipulatorAutoHideDelay:i=>{this._pointerMoveTimerMs=i,this._resetPointerMoveTimeout()}}}};h([p({constructOnly:!0})],U.prototype,"view",void 0),h([p({constructOnly:!0})],U.prototype,"analysis",void 0),h([p({readOnly:!0})],U.prototype,"state",null),h([p({readOnly:!0})],U.prototype,"updating",null),h([p({readOnly:!0})],U.prototype,"cursor",null),h([p({constructOnly:!0})],U.prototype,"analysisViewData",void 0),h([p()],U.prototype,"selectedDimension",null),h([p()],U.prototype,"automaticManipulatorSelection",void 0),h([p()],U.prototype,"_activeSubTool",void 0),h([p()],U.prototype,"_lengthDimensionSubTool",void 0),U=h([N("esri.views.3d.analysis.Dimension.DimensionTool")],U);let xl=class extends ti{constructor(e,t){super(e),this._hasExternalMaterial=!1,this._renderOccluded=b.OccludeAndTransparent,this._width=1,this._color=Wt(1,0,1,1),this._placement="end",this._textureId=null,this._material=t,this._hasExternalMaterial=f(t),this.applyProps(e)}setGeometryFromSegment(e,t){const n=e.endRenderSpace;this.transform=cr(Pl,n),this._normal=t;const{points:s}=e.createRenderGeometry(n,this.view.renderCoordsHelper);this.geometry=[s]}get renderOccluded(){return f(this._material)?this._material.parameters.renderOccluded:this._renderOccluded}set renderOccluded(e){this._renderOccluded=e,f(this._material)&&this._material.setParameters({renderOccluded:e})}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get normal(){return this._normal}set normal(e){this._normal=e,this.recreateGeometry()}get width(){return f(this._material)?this._material.parameters.width:this._width}set width(e){this._width=e,f(this._material)&&this._material.setParameters({width:e})}get color(){return f(this._material)?this._material.parameters.color:this._color}set color(e){this._color=kn(e),f(this._material)&&this._material.setParameters({color:this._color})}get placement(){return f(this._material)?this._material.parameters.placement:this._placement}set placement(e){this._placement=e,f(this._material)&&this._material.setParameters({placement:this._placement})}get textureId(){return f(this._material)?this._material.parameters.textureId:this._textureId}set textureId(e){this._textureId=e,f(this._material)&&this._material.setParameters({textureId:e})}createExternalResources(){this._hasExternalMaterial||(this._material=new Hn({width:this._width,color:this._color,placement:this._placement,renderOccluded:this._renderOccluded,textureId:this._textureId}))}destroyExternalResources(){this._hasExternalMaterial||(this._material=null)}createGeometries(e){for(const t of xr(this.geometry,this.normal)){const n=Pr(t);e.addGeometry(n,ne(this._material))}}forEachExternalMaterial(e){this._hasExternalMaterial||e(ne(this._material))}};const Pl=Ai();class El{constructor(e){this.destroyed=!1,this._handles=new st,this._messages=null,this._labelSegment=new He;const{analysis:t,computation:n,view:s,messages:r}=e;this.analysis=t,this.computation=n,this.view=s,this._messages=r;const o=e.visible,a={view:s,attached:o},{fontSize:l,textColor:c,textBackgroundColor:d}=t.style;this._visualElements=new Tl({marker:new xl(a,e.markerMaterial),dimension:new Ee(a,e.dimensionLineMaterial),startOffset:new Ee(a,e.offsetLineMaterial),endOffset:new Ee(a,e.offsetLineMaterial),dimensionSmall:new Ee(a,e.smallDimensionLineMaterial),startOffsetSmall:new Ee(a,e.smallOffsetLineMaterial),endOffsetSmall:new Ee(a,e.smallOffsetLineMaterial),label:new or({view:s,attached:o,distance:0,geometry:{type:"segment",sampleLocation:"center",segment:this._labelSegment,callout:!1},fontSize:le(l),textColor:c.clone(),backgroundColor:d.clone()})}),this._handles.add([E(()=>n.geometry,u=>{this.updateCameraDependentElements(s.state.camera,u,t.style),f(n.geometry)&&this._updateLines(n.geometry)},{...Ut,equals:Ei}),E(()=>n.length,u=>this._updateLabelContent(u),Ut)])}set visible(e){for(const t of this._visualElements.values())t.attached=e}destroy(){this.destroyed=!0,this._handles=_t(this._handles);for(const e of this._visualElements.values())e.destroy()}get testInfo(){return{dimensionVisualElement:this._visualElements.dimension,label:this._visualElements.label}}_updateLines(e){const t=cn($l,Pt.Start,e.directSegment,e.dimensionSegment),n=cn(bl,Pt.End,e.directSegment,e.dimensionSegment),s=this._visualElements;s.marker.setGeometryFromSegment(e.dimensionSegment,e.primaryOffsetAxis),s.dimension.setGeometryFromSegment(e.dimensionSegment),s.startOffset.setGeometryFromSegment(t),s.endOffset.setGeometryFromSegment(n),s.dimensionSmall.setGeometryFromSegment(e.dimensionSegment),s.startOffsetSmall.setGeometryFromSegment(t),s.endOffsetSmall.setGeometryFromSegment(n)}updateCameraDependentElements(e,t,n){const s=this._visualElements;if(y(t)){for(const S of s.values())S.visible=!1;return}const r=e.computeScreenPixelSizeAt(t.dimensionSegment.eval(.5,Cl)),o=Ao(t,r),a=o<(le(n.lineSize)*T.smallScreenLengthLineSizeFactor)**2,l=!a;s.marker.visible=l,s.dimension.visible=l,s.startOffset.visible=l,s.endOffset.visible=l,s.dimensionSmall.visible=a,s.startOffsetSmall.visible=a,s.endOffsetSmall.visible=a;const c=le(n.fontSize)*T.labels.minScreenLengthFontSizeFactor,{label:d}=s;if(o<c**2)return void(d.visible=!1);d.visible=!0;const{dimensionSegment:u,primaryOffsetAxis:m}=t,{offset:_}=this.computation.dimension,g=(Math.sign(_)>=0?1:-1)*Ml(n)*r;$o(this._labelSegment,u,m,g),d.updateLabelPosition()}updateLabelStyle(e){const{label:t}=this._visualElements;t.fontSize=le(e.fontSize),t.textColor=e.textColor,t.backgroundColor=e.textBackgroundColor}updateUnitsMessages(e){this._messages=e;const{length:t}=this.computation;this._updateLabelContent(t)}_updateLabelContent(e){const{label:t}=this._visualElements;y(e)||y(this._messages)?t.text="":t.text=ar(this._messages,e,e.unit)}}function Ml(i){return 1.5*le(i.fontSize)+T.labels.marginPx+le(i.lineSize/2)}const $l=new He,bl=new He,Cl=v();class Tl{constructor(e){this.marker=e.marker,this.dimension=e.dimension,this.startOffset=e.startOffset,this.endOffset=e.endOffset,this.dimensionSmall=e.dimensionSmall,this.startOffsetSmall=e.startOffsetSmall,this.endOffsetSmall=e.endOffsetSmall,this.label=e.label}values(){return[this.marker,this.dimension,this.startOffset,this.endOffset,this.dimensionSmall,this.startOffsetSmall,this.endOffsetSmall,this.label]}}let Ol=class{constructor(e,t){this._textures=e,this._textureRepository=t,this._texturesByPrimitive=new Map}acquire(e){if(!this._texturesByPrimitive.has(e)){const t=Zr(this._textures,e),n=new vo(this._textureRepository,t.texture.id);return this._texturesByPrimitive.set(e,{result:t,reference:n}),t.texture}return this._texturesByPrimitive.get(e).result.texture}destroy(){this._texturesByPrimitive.forEach(({result:e,reference:t})=>{t.dispose(),e.release()}),this._texturesByPrimitive.clear()}},Se=class extends ye{constructor(i){super(i),this.loadingMessages=!1,this._messages=null,this._dimensionVisualizations=new Map,this._markerMaterial=new Hn({width:1,anchor:Yr.Tip,color:dt,placement:"begin-end",worldSpace:!0,hideOnShortSegments:!0,hasTip:!0,renderOccluded:b.OccludeAndTransparent}),this._dimensionLineMaterial=new Re({width:1,color:dt,renderOccluded:b.OccludeAndTransparent,markerParameters:this._markerMaterial.parameters}),this._offsetLineMaterial=new Re({width:1,color:dt,renderOccluded:b.OccludeAndTransparent,stipplePattern:De(5),stippleScaleWithLineWidth:!0}),this._smallDimensionLineMaterial=new Re({width:1,color:dt,renderOccluded:b.OccludeAndTransparent}),this._smallOffsetLineMaterial=new Re({width:1,color:dt,renderOccluded:b.OccludeAndTransparent,stipplePattern:De(5),stippleScaleWithLineWidth:!0})}get analysis(){return this.analysisViewData.analysis}get visible(){return this.analysisViewData.visible}initialize(){const{textures:i}=this.view.sharedSymbolResources;if(f(i)){const{textureRepository:t}=this.view._stage.renderView,n=new Ol(i,t),s=n.acquire("triangle");this.addHandles(Xt(()=>n.destroy())),this._markerMaterial.setParameters({textureId:s.id})}for(const t of this._lineMaterials())this.view._stage.add(t),this.addHandles(Xt(()=>{this.view._stage.remove(t),t.dispose()}));const{computations:e}=this.analysisViewData;for(const t of e)this._addComputation(t);this.addHandles([e.on("change",({added:t,removed:n})=>{for(const s of n)this._removeComputation(s);for(const s of t)this._addComputation(s)}),E(()=>R.toUnitRGBA(this.analysis.style.color),t=>{for(const n of this._lineMaterials())n.setParameters({color:t})},Y),E(()=>this.analysis.style.lineSize,t=>{const n=le(t);this._markerMaterial.setParameters({width:n*T.markers.lineSizeFraction}),this._dimensionLineMaterial.setParameters({width:n,markerParameters:this._markerMaterial.parameters});const s=Math.max(n*T.offsetLine.lineSizeFraction,1);this._offsetLineMaterial.setParameters({width:s})},Y),E(()=>({camera:this.view.state.camera,style:Rl(this.analysis)}),({camera:t,style:n})=>{for(const[s,r]of this._dimensionVisualizations)r.updateCameraDependentElements(t,s.geometry,n),r.updateLabelStyle(n)}),E(()=>this.visible,t=>{for(const n of this._dimensionVisualizations.values())n.visible=t})]),this.addHandles([So(()=>this._updateMessageBundle()),Li(()=>!this.loadingMessages,()=>{for(const t of this._dimensionVisualizations.values())t.updateUnitsMessages(this._messages)},Ke)]),this._updateMessageBundle()}destroy(){this._dimensionVisualizations.forEach(i=>{i.destroy()}),this._dimensionVisualizations.clear()}get testInfo(){return{visualizations:Array.from(this._dimensionVisualizations.values()),disablePartialOcclusion:()=>{for(const i of this._lineMaterials())i.setParameters({renderOccluded:b.Occlude})}}}_addComputation(i){this._dimensionVisualizations.has(i)||this._dimensionVisualizations.set(i,new El({analysis:this.analysis,computation:i,view:this.view,visible:this.visible,markerMaterial:this._markerMaterial,dimensionLineMaterial:this._dimensionLineMaterial,offsetLineMaterial:this._offsetLineMaterial,smallDimensionLineMaterial:this._smallDimensionLineMaterial,smallOffsetLineMaterial:this._smallOffsetLineMaterial,messages:this._messages}))}_removeComputation(i){const e=this._dimensionVisualizations.get(i);y(e)||(e.destroy(),this._dimensionVisualizations.delete(i))}_lineMaterials(){return[this._markerMaterial,this._dimensionLineMaterial,this._offsetLineMaterial,this._smallDimensionLineMaterial,this._smallOffsetLineMaterial]}async _updateMessageBundle(){this.loadingMessages=!0;try{this._messages=await wo("esri/core/t9n/Units")}finally{this.loadingMessages=!1}}};function Rl(i){const{fontSize:e,lineSize:t,textColor:n,textBackgroundColor:s}=i.style;return{fontSize:e,lineSize:t,textBackgroundColor:s.clone(),textColor:n.clone()}}h([p({constructOnly:!0})],Se.prototype,"analysisViewData",void 0),h([p({constructOnly:!0,nonNullable:!0})],Se.prototype,"view",void 0),h([p()],Se.prototype,"analysis",null),h([p()],Se.prototype,"visible",null),h([p()],Se.prototype,"loadingMessages",void 0),Se=h([N("esri.views.3d.analysis.Dimension.DimensionVisualization")],Se);let pt=class extends ye{constructor(i){super(i),this.dimension=null,this.length=null}};h([p({constructOnly:!0,nonNullable:!0})],pt.prototype,"dimension",void 0),h([p()],pt.prototype,"length",void 0),pt=h([N("esri.views.3d.analysis.LengthDimensionResult")],pt);const Ll=pt;let J=class extends ye{constructor(i){super(i),this.geometry=null,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null}normalizeCtorArgs(i){const{dimension:e,...t}=i;return{result:new Ll({dimension:e}),...t}}initialize(){this.addHandles([E(()=>this.dimension.startPoint,i=>this.elevationAlignedStartPoint=this.projectAndAlignPoint(i),Y),E(()=>this.dimension.endPoint,i=>this.elevationAlignedEndPoint=this.projectAndAlignPoint(i),Y)])}get dimension(){return this.result.dimension}get length(){return this.result.length}};h([p({constructOnly:!0,nonNullable:!0})],J.prototype,"result",void 0),h([p({constructOnly:!0,nonNullable:!0})],J.prototype,"projectAndAlignPoint",void 0),h([p()],J.prototype,"dimension",null),h([p()],J.prototype,"length",null),h([p()],J.prototype,"geometry",void 0),h([p()],J.prototype,"elevationAlignedStartPoint",void 0),h([p()],J.prototype,"elevationAlignedEndPoint",void 0),h([p()],J.prototype,"preConstraintProperties",void 0),h([p()],J.prototype,"previousConstraint",void 0),J=h([N("esri.views.3d.analysis.LengthDimensionComputation")],J);const Al=i=>{let e=class extends i{constructor(...t){super(...t),this.analysis=null,this.tool=null,this.selectedDimension=null,this.interactive=!1,this.visible=null}get results(){return new rt}createLengthDimensions(t){throw new Error("Method not implemented.")}};return h([p({constructOnly:!0})],e.prototype,"view",void 0),h([p({constructOnly:!0,nonNullable:!0})],e.prototype,"analysis",void 0),h([p()],e.prototype,"tool",void 0),h([p({readOnly:!0})],e.prototype,"results",null),h([p()],e.prototype,"selectedDimension",void 0),h([p()],e.prototype,"interactive",void 0),h([p()],e.prototype,"visible",void 0),e=h([N("esri.views.analysis.DimensionAnalysisView")],e),e};let Z=class extends Al(Ys(ye)){constructor(i){super(i),this.type="dimension-view-3d",this.tool=null,this.computations=new rt,this.selectedDimension=null,this._dimensionsToComputations=new Map,this._placementTask=null,this._projectAndAlignPoint=null}initialize(){this._projectAndAlignPoint=i=>{if(y(i))return null;const{spatialReference:e,elevationProvider:t}=this.view,n=qs(i,e,t);return y(n)&&js(this.analysis,i.spatialReference,$n.getLogger(this.declaredClass)),n},this.addHandles([Vr(this,U),Wi(()=>this.analysis.dimensions,"after-add",i=>this._onDimensionAdd(i.item),{onListenerAdd:i=>{for(const e of i)this._onDimensionAdd(e)},onListenerRemove:()=>{this._onDimensionsClear()}}),Wi(()=>this.analysis.dimensions,"after-remove",i=>this._onDimensionRemove(i.item))]),this._analysisVisualization=new Se({analysisViewData:this,view:this.view}),this._analysisController=new Me({analysisViewData:this,view:this.view})}destroy(){this._placementTask=yt(this._placementTask),this._analysisVisualization=_t(this._analysisVisualization),Ir(this)}get updating(){var i;return((i=this._analysisVisualization)==null?void 0:i.loadingMessages)??!1}get results(){return this.analysis.dimensions.map(i=>this._dimensionsToComputations.get(i).result)}get selectedComputation(){const{selectedDimension:i}=this;return y(i)?null:this._dimensionsToComputations.get(i)}get testInfo(){return{visualization:this._analysisVisualization,controller:this._analysisController}}async createLengthDimensions(i){return this.selectedDimension=null,this._placementTask=yt(this._placementTask),this._placementTask=Fr(this,i),this._placementTask.promise}_onDimensionAdd(i){const{computations:e,_dimensionsToComputations:t}=this;if(t.has(i))return;const n=new J({dimension:i,projectAndAlignPoint:this._projectAndAlignPoint});e.add(n),t.set(i,n)}_onDimensionRemove(i){const{computations:e,_dimensionsToComputations:t}=this,n=e.findIndex(r=>r.dimension===i),s=e.getItemAt(n);s.dimension===this.selectedDimension&&(this.selectedDimension=null),e.removeAt(n),t.delete(i),_t(s)}_onDimensionsClear(){this.computations.drain(i=>i.destroy()),this._dimensionsToComputations.clear()}};h([p({readOnly:!0})],Z.prototype,"type",void 0),h([p()],Z.prototype,"tool",void 0),h([p()],Z.prototype,"updating",null),h([p({readOnly:!0})],Z.prototype,"results",null),h([p({readOnly:!0})],Z.prototype,"computations",void 0),h([p()],Z.prototype,"selectedDimension",void 0),h([p()],Z.prototype,"selectedComputation",null),h([p()],Z.prototype,"_analysisVisualization",void 0),h([p()],Z.prototype,"_analysisController",void 0),h([p()],Z.prototype,"_dimensionsToComputations",void 0),h([p()],Z.prototype,"_placementTask",void 0),Z=h([N("esri.views.3d.analysis.DimensionAnalysisView3D")],Z);const Hl=Z,Vd=Object.freeze(Object.defineProperty({__proto__:null,default:Hl},Symbol.toStringTag,{value:"Module"}));export{Vd as D,Ga as N,_a as a,Zi as b,Ua as e,Qc as h,Fa as j,j as l,Kc as m,Rs as n,he as s};
