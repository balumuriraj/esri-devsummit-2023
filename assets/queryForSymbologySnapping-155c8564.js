import{G as D,cU as $,$ as I,R as C,cT as G}from"./calcite-c5ae4991.js";import{M as q}from"./dehydratedFeatures-ce9ee959.js";import{a as z}from"./elevationInfoUtils-def3e352.js";import{h as F,i as O,a8 as E,Y as P,a9 as T}from"./MediaLayerVideo-b25b4fca.js";async function U(o,d,p,f,r){const{elevationProvider:g,renderCoordsHelper:c,spatialReference:b}=o,{elevationInfo:m}=d,y=F(m,!0),w=await O(y,b,r);$(r);const i=[],u=new Set,l=new Set;for(const{objectId:e,points:t}of f){const n=p(e);if(I(n)){for(const s of t)i.push(s[2]);u.add(e);continue}n.isDraped&&l.add(e);const a=n.graphic.geometry;R.setFromElevationInfo(z(a,m)),R.updateFeatureExpressionInfoContext(w,n.graphic,d),h.spatialReference=o.spatialReference;for(const{x:s,y:j,z:x}of t)h.x=s,h.y=j,h.z=x??0,E(h,g,R,c,S),i.push(S.z)}return{elevations:i,drapedObjectIds:l,failedObjectIds:u}}const R=new P,h=q(0,0,0,D.WGS84),S=new T;async function W(o,d,p){if(I(o)||d.candidates.length===0)return v;const f=o.graphics3DGraphicsByObjectID??o.graphics3DGraphics,r=[],g=[],{renderer:c}=o,b=C(c)&&"arcadeRequired"in c&&c.arcadeRequired?G():null,m=async(e,{graphic:t,graphics3DSymbol:n})=>{const a=await b,s=await o.getRenderingInfoAsync(t,c,a,{signal:p});return I(s)?[]:n.queryForSnapping(e,w,s,p)},{candidates:y,spatialReference:w}=d;for(let e=0;e<y.length;++e){const t=y[e],{objectId:n}=t,a=typeof n=="number"?f==null?void 0:f.get(n):void 0;if(I(a))continue;const{graphics3DSymbol:s}=a;s.symbologySnappingSupported&&(r.push(m(t,a)),g.push(e))}if(r.length===0)return v;const i=await Promise.all(r);$(p);const u=[],l=[];for(let e=0;e<i.length;++e){const t=i[e],n=g[e];for(const a of t)u.push(a),l.push(n)}return{candidates:u,sourceCandidateIndices:l}}const v={candidates:[],sourceCandidateIndices:[]};export{W as a,U as m};
