import{h as i}from"./Matrix3PassUniform-ad9f953b.js";import{n as d}from"./basicInterfaces-19ed850e.js";import{A as P,l as g,i as T,k as A,m as O,n as E,w as y,S,E as u,h as v}from"./objectResourceUtils-d556a033.js";import{E as w,d as $,x as N,j as R}from"./VisualVariablePassParameters-d460182b.js";import{aj as x,ak as D}from"./index-a2d9f93b.js";import{_ as b}from"./preload-helper-3bce6601.js";import{e as s}from"./cast-fcb46737.js";import"./ShaderBuilder-a7d0da4e.js";import{t as I,s as C,e as M,o as L,W as F,h as U,a as W,_ as G}from"./EvaluateSceneLighting.glsl-189abc15.js";import{e as a}from"./ShaderTechniqueConfiguration-9f5b4555.js";import{o as p}from"./TransparencyPassType-a11868d2.js";import{s as H}from"./DefaultTechniqueConfiguration-588e5ab2.js";import{w as B}from"./ImageMaterial.glsl-befce2a1.js";import{R as m}from"./enums-64ab819c.js";class l extends M{initializeProgram(t){return new L(t.rctx,l.shader.get().build(this.configuration),w)}_setPipelineState(t,e){const o=this.configuration,n=t===p.NONE,h=t===p.FrontFace;return F({blending:o.output!==i.Color&&o.output!==i.Alpha||!o.transparent?null:n?j:P(t),culling:U(o.cullFace),depthTest:{func:g(t)},depthWrite:n?o.writeDepth&&W:T(t),colorWrite:G,stencilWrite:o.hasOccludees?A:null,stencilTest:o.hasOccludees?e?O:E:null,polygonOffset:n||h?null:y(o.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(t,e){return e?this._occludeePipelineState:super.getPipelineState(t,e)}}l.shader=new I(B,()=>b(()=>import("./ImageMaterial.glsl-35a5b97a.js"),["assets/ImageMaterial.glsl-35a5b97a.js","assets/vec2f64-30dc1443.js","assets/Matrix3PassUniform-ad9f953b.js","assets/ShaderBuilder-a7d0da4e.js","assets/typedArrayUtil-4d7bb04c.js","assets/Error-ec6249b9.js","assets/string-a318751c.js","assets/mat4-44a0988f.js","assets/vec3f64-2f9cef06.js","assets/common-c186b691.js","assets/mat4f64-1e28eae0.js","assets/vec3-e93e648f.js","assets/mat3f64-c6305894.js","assets/vec3f32-c9aa289f.js","assets/VertexAttribute-9c5c630d.js","assets/vec2-528adfe4.js","assets/Texture2DPassUniform-753de459.js","assets/View.glsl-3ce196d4.js","assets/mat4f32-77b3d8ac.js","assets/TransparencyPassType-a11868d2.js","assets/ImageMaterial.glsl-befce2a1.js","assets/Slice.glsl-3b39b1f7.js","assets/Transform.glsl-6d2e2fd9.js","assets/ForwardLinearDepth.glsl-56affafd.js","assets/MultipassTerrainTest.glsl-bb236672.js","assets/ReadLinearDepth.glsl-9c87a54a.js","assets/RgbaFloatEncoding.glsl-52af7fcf.js","assets/AlphaCutoff-96178e0d.js","assets/FloatPassUniform-68d54f51.js"]));const j=C(m.ONE,m.ONE_MINUS_SRC_ALPHA);class r extends H{constructor(){super(...arguments),this.output=i.Color,this.cullFace=d.None,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=p.NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}s([a({count:i.COUNT})],r.prototype,"output",void 0),s([a({count:d.COUNT})],r.prototype,"cullFace",void 0),s([a()],r.prototype,"hasSlicePlane",void 0),s([a()],r.prototype,"transparent",void 0),s([a()],r.prototype,"enableOffset",void 0),s([a()],r.prototype,"writeDepth",void 0),s([a()],r.prototype,"hasOccludees",void 0),s([a({count:p.COUNT})],r.prototype,"transparencyPassType",void 0),s([a()],r.prototype,"hasMultipassTerrain",void 0),s([a()],r.prototype,"cullAboveGround",void 0);class ot extends ${constructor(t){super(t,new q),this.supportsEdges=!0,this._configuration=new r}getConfiguration(t,e){return this._configuration.output=t,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=e.transparencyPassType,this._configuration.enableOffset=e.camera.relativeElevation<S,this._configuration.hasMultipassTerrain=e.multipassTerrain.enabled,this._configuration.cullAboveGround=e.multipassTerrain.cullAboveGround,this._configuration}intersect(t,e,o,n,h,f,_){N(t,e,n,h,f,void 0,_)}requiresSlot(t,e){return e===i.Color||e===i.Alpha||e===i.Highlight?t===u.DRAPED_MATERIAL?!0:e===i.Highlight?t===u.OPAQUE_MATERIAL:t===(this.parameters.transparent?this.parameters.writeDepth?u.TRANSPARENT_MATERIAL:u.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:u.OPAQUE_MATERIAL):!1}createGLMaterial(t){return new k(t)}createBufferWriter(){return new x(D)}}class k extends v{constructor(t){super({...t,...t.material.parameters})}_updateParameters(t){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(l,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&(this._material.setParameters({hasOccludees:t.hasOccludees}),this._updateParameters(t))}beginSlot(t){return this._output!==i.Color&&this._output!==i.Alpha||this._updateOccludeeState(t),this._updateParameters(t)}}class q extends R{constructor(){super(...arguments),this.transparent=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=d.None,this.hasOccludees=!1,this.opacity=1,this.textureId=null,this.initTextureTransparent=!0}}export{ot as p};
