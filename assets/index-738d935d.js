function uze(t,e){for(var r=0;r<e.length;r++){const i=e[r];if(typeof i!="string"&&!Array.isArray(i)){for(const n in i)if(n!=="default"&&!(n in t)){const s=Object.getOwnPropertyDescriptor(i,n);s&&Object.defineProperty(t,n,s.get?s:{enumerable:!0,get:()=>i[n]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function r(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=r(n);fetch(n.href,s)}})();var Bce=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function hze(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var s8={},dze={get exports(){return s8},set exports(t){s8=t}},r9={},ut={},pze={get exports(){return ut},set exports(t){ut=t}},ui={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ZD=Symbol.for("react.element"),fze=Symbol.for("react.portal"),mze=Symbol.for("react.fragment"),gze=Symbol.for("react.strict_mode"),yze=Symbol.for("react.profiler"),_ze=Symbol.for("react.provider"),vze=Symbol.for("react.context"),bze=Symbol.for("react.forward_ref"),wze=Symbol.for("react.suspense"),xze=Symbol.for("react.memo"),Tze=Symbol.for("react.lazy"),jce=Symbol.iterator;function Sze(t){return t===null||typeof t!="object"?null:(t=jce&&t[jce]||t["@@iterator"],typeof t=="function"?t:null)}var nxe={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},sxe=Object.assign,oxe={};function i3(t,e,r){this.props=t,this.context=e,this.refs=oxe,this.updater=r||nxe}i3.prototype.isReactComponent={};i3.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};i3.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function axe(){}axe.prototype=i3.prototype;function $re(t,e,r){this.props=t,this.context=e,this.refs=oxe,this.updater=r||nxe}var Lre=$re.prototype=new axe;Lre.constructor=$re;sxe(Lre,i3.prototype);Lre.isPureReactComponent=!0;var Gce=Array.isArray,lxe=Object.prototype.hasOwnProperty,Dre={current:null},cxe={key:!0,ref:!0,__self:!0,__source:!0};function uxe(t,e,r){var i,n={},s=null,o=null;if(e!=null)for(i in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)lxe.call(e,i)&&!cxe.hasOwnProperty(i)&&(n[i]=e[i]);var a=arguments.length-2;if(a===1)n.children=r;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];n.children=l}if(t&&t.defaultProps)for(i in a=t.defaultProps,a)n[i]===void 0&&(n[i]=a[i]);return{$$typeof:ZD,type:t,key:s,ref:o,props:n,_owner:Dre.current}}function Eze(t,e){return{$$typeof:ZD,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Nre(t){return typeof t=="object"&&t!==null&&t.$$typeof===ZD}function Cze(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(r){return e[r]})}var Hce=/\/+/g;function X7(t,e){return typeof t=="object"&&t!==null&&t.key!=null?Cze(""+t.key):e.toString(36)}function zk(t,e,r,i,n){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case ZD:case fze:o=!0}}if(o)return o=t,n=n(o),t=i===""?"."+X7(o,0):i,Gce(n)?(r="",t!=null&&(r=t.replace(Hce,"$&/")+"/"),zk(n,e,r,"",function(c){return c})):n!=null&&(Nre(n)&&(n=Eze(n,r+(!n.key||o&&o.key===n.key?"":(""+n.key).replace(Hce,"$&/")+"/")+t)),e.push(n)),1;if(o=0,i=i===""?".":i+":",Gce(t))for(var a=0;a<t.length;a++){s=t[a];var l=i+X7(s,a);o+=zk(s,e,r,l,n)}else if(l=Sze(t),typeof l=="function")for(t=l.call(t),a=0;!(s=t.next()).done;)s=s.value,l=i+X7(s,a++),o+=zk(s,e,r,l,n);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function lF(t,e,r){if(t==null)return t;var i=[],n=0;return zk(t,i,"","",function(s){return e.call(r,s,n++)}),i}function Aze(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(r){(t._status===0||t._status===-1)&&(t._status=1,t._result=r)},function(r){(t._status===0||t._status===-1)&&(t._status=2,t._result=r)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Yc={current:null},Vk={transition:null},Rze={ReactCurrentDispatcher:Yc,ReactCurrentBatchConfig:Vk,ReactCurrentOwner:Dre};ui.Children={map:lF,forEach:function(t,e,r){lF(t,function(){e.apply(this,arguments)},r)},count:function(t){var e=0;return lF(t,function(){e++}),e},toArray:function(t){return lF(t,function(e){return e})||[]},only:function(t){if(!Nre(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};ui.Component=i3;ui.Fragment=mze;ui.Profiler=yze;ui.PureComponent=$re;ui.StrictMode=gze;ui.Suspense=wze;ui.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Rze;ui.cloneElement=function(t,e,r){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=sxe({},t.props),n=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=Dre.current),e.key!==void 0&&(n=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)lxe.call(e,l)&&!cxe.hasOwnProperty(l)&&(i[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)i.children=r;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];i.children=a}return{$$typeof:ZD,type:t.type,key:n,ref:s,props:i,_owner:o}};ui.createContext=function(t){return t={$$typeof:vze,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:_ze,_context:t},t.Consumer=t};ui.createElement=uxe;ui.createFactory=function(t){var e=uxe.bind(null,t);return e.type=t,e};ui.createRef=function(){return{current:null}};ui.forwardRef=function(t){return{$$typeof:bze,render:t}};ui.isValidElement=Nre;ui.lazy=function(t){return{$$typeof:Tze,_payload:{_status:-1,_result:t},_init:Aze}};ui.memo=function(t,e){return{$$typeof:xze,type:t,compare:e===void 0?null:e}};ui.startTransition=function(t){var e=Vk.transition;Vk.transition={};try{t()}finally{Vk.transition=e}};ui.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};ui.useCallback=function(t,e){return Yc.current.useCallback(t,e)};ui.useContext=function(t){return Yc.current.useContext(t)};ui.useDebugValue=function(){};ui.useDeferredValue=function(t){return Yc.current.useDeferredValue(t)};ui.useEffect=function(t,e){return Yc.current.useEffect(t,e)};ui.useId=function(){return Yc.current.useId()};ui.useImperativeHandle=function(t,e,r){return Yc.current.useImperativeHandle(t,e,r)};ui.useInsertionEffect=function(t,e){return Yc.current.useInsertionEffect(t,e)};ui.useLayoutEffect=function(t,e){return Yc.current.useLayoutEffect(t,e)};ui.useMemo=function(t,e){return Yc.current.useMemo(t,e)};ui.useReducer=function(t,e,r){return Yc.current.useReducer(t,e,r)};ui.useRef=function(t){return Yc.current.useRef(t)};ui.useState=function(t){return Yc.current.useState(t)};ui.useSyncExternalStore=function(t,e,r){return Yc.current.useSyncExternalStore(t,e,r)};ui.useTransition=function(){return Yc.current.useTransition()};ui.version="18.2.0";(function(t){t.exports=ui})(pze);const hL=hze(ut),ZW=uze({__proto__:null,default:hL},[ut]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Oze=ut,Mze=Symbol.for("react.element"),Pze=Symbol.for("react.fragment"),Ize=Object.prototype.hasOwnProperty,$ze=Oze.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Lze={key:!0,ref:!0,__self:!0,__source:!0};function hxe(t,e,r){var i,n={},s=null,o=null;r!==void 0&&(s=""+r),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(i in e)Ize.call(e,i)&&!Lze.hasOwnProperty(i)&&(n[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)n[i]===void 0&&(n[i]=e[i]);return{$$typeof:Mze,type:t,key:s,ref:o,props:n,_owner:$ze.current}}r9.Fragment=Pze;r9.jsx=hxe;r9.jsxs=hxe;(function(t){t.exports=r9})(dze);const Qi=s8.jsx,JR=s8.jsxs;var JW={},KW={},Dze={get exports(){return KW},set exports(t){KW=t}},ad={},QW={},Nze={get exports(){return QW},set exports(t){QW=t}},dxe={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(L,F){var G=L.length;L.push(F);e:for(;0<G;){var q=G-1>>>1,Z=L[q];if(0<n(Z,F))L[q]=F,L[G]=Z,G=q;else break e}}function r(L){return L.length===0?null:L[0]}function i(L){if(L.length===0)return null;var F=L[0],G=L.pop();if(G!==F){L[0]=G;e:for(var q=0,Z=L.length,X=Z>>>1;q<X;){var oe=2*(q+1)-1,pe=L[oe],ye=oe+1,Se=L[ye];if(0>n(pe,G))ye<Z&&0>n(Se,pe)?(L[q]=Se,L[ye]=G,q=ye):(L[q]=pe,L[oe]=G,q=oe);else if(ye<Z&&0>n(Se,G))L[q]=Se,L[ye]=G,q=ye;else break e}}return F}function n(L,F){var G=L.sortIndex-F.sortIndex;return G!==0?G:L.id-F.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],c=[],h=1,p=null,f=3,m=!1,g=!1,_=!1,b=typeof setTimeout=="function"?setTimeout:null,w=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function T(L){for(var F=r(c);F!==null;){if(F.callback===null)i(c);else if(F.startTime<=L)i(c),F.sortIndex=F.expirationTime,e(l,F);else break;F=r(c)}}function E(L){if(_=!1,T(L),!g)if(r(l)!==null)g=!0,W(C);else{var F=r(c);F!==null&&N(E,F.startTime-L)}}function C(L,F){g=!1,_&&(_=!1,w(M),M=-1),m=!0;var G=f;try{for(T(F),p=r(l);p!==null&&(!(p.expirationTime>F)||L&&!z());){var q=p.callback;if(typeof q=="function"){p.callback=null,f=p.priorityLevel;var Z=q(p.expirationTime<=F);F=t.unstable_now(),typeof Z=="function"?p.callback=Z:p===r(l)&&i(l),T(F)}else i(l);p=r(l)}if(p!==null)var X=!0;else{var oe=r(c);oe!==null&&N(E,oe.startTime-F),X=!1}return X}finally{p=null,f=G,m=!1}}var A=!1,I=null,M=-1,D=5,U=-1;function z(){return!(t.unstable_now()-U<D)}function B(){if(I!==null){var L=t.unstable_now();U=L;var F=!0;try{F=I(!0,L)}finally{F?ee():(A=!1,I=null)}}else A=!1}var ee;if(typeof x=="function")ee=function(){x(B)};else if(typeof MessageChannel<"u"){var te=new MessageChannel,K=te.port2;te.port1.onmessage=B,ee=function(){K.postMessage(null)}}else ee=function(){b(B,0)};function W(L){I=L,A||(A=!0,ee())}function N(L,F){M=b(function(){L(t.unstable_now())},F)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(L){L.callback=null},t.unstable_continueExecution=function(){g||m||(g=!0,W(C))},t.unstable_forceFrameRate=function(L){0>L||125<L?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<L?Math.floor(1e3/L):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return r(l)},t.unstable_next=function(L){switch(f){case 1:case 2:case 3:var F=3;break;default:F=f}var G=f;f=F;try{return L()}finally{f=G}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(L,F){switch(L){case 1:case 2:case 3:case 4:case 5:break;default:L=3}var G=f;f=L;try{return F()}finally{f=G}},t.unstable_scheduleCallback=function(L,F,G){var q=t.unstable_now();switch(typeof G=="object"&&G!==null?(G=G.delay,G=typeof G=="number"&&0<G?q+G:q):G=q,L){case 1:var Z=-1;break;case 2:Z=250;break;case 5:Z=1073741823;break;case 4:Z=1e4;break;default:Z=5e3}return Z=G+Z,L={id:h++,callback:F,priorityLevel:L,startTime:G,expirationTime:Z,sortIndex:-1},G>q?(L.sortIndex=G,e(c,L),r(l)===null&&L===r(c)&&(_?(w(M),M=-1):_=!0,N(E,G-q))):(L.sortIndex=Z,e(l,L),g||m||(g=!0,W(C))),L},t.unstable_shouldYield=z,t.unstable_wrapCallback=function(L){var F=f;return function(){var G=f;f=F;try{return L.apply(this,arguments)}finally{f=G}}}})(dxe);(function(t){t.exports=dxe})(Nze);/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pxe=ut,ed=QW;function je(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,r=1;r<arguments.length;r++)e+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var fxe=new Set,dL={};function P2(t,e){KR(t,e),KR(t+"Capture",e)}function KR(t,e){for(dL[t]=e,t=0;t<e.length;t++)fxe.add(e[t])}var d_=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),eX=Object.prototype.hasOwnProperty,Fze=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,qce={},Wce={};function kze(t){return eX.call(Wce,t)?!0:eX.call(qce,t)?!1:Fze.test(t)?Wce[t]=!0:(qce[t]=!0,!1)}function Uze(t,e,r,i){if(r!==null&&r.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:r!==null?!r.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function zze(t,e,r,i){if(e===null||typeof e>"u"||Uze(t,e,r,i))return!0;if(i)return!1;if(r!==null)switch(r.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Zc(t,e,r,i,n,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=n,this.mustUseProperty=r,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var hl={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){hl[t]=new Zc(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];hl[e]=new Zc(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){hl[t]=new Zc(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){hl[t]=new Zc(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){hl[t]=new Zc(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){hl[t]=new Zc(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){hl[t]=new Zc(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){hl[t]=new Zc(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){hl[t]=new Zc(t,5,!1,t.toLowerCase(),null,!1,!1)});var Fre=/[\-:]([a-z])/g;function kre(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Fre,kre);hl[e]=new Zc(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Fre,kre);hl[e]=new Zc(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Fre,kre);hl[e]=new Zc(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){hl[t]=new Zc(t,1,!1,t.toLowerCase(),null,!1,!1)});hl.xlinkHref=new Zc("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){hl[t]=new Zc(t,1,!1,t.toLowerCase(),null,!0,!0)});function Ure(t,e,r,i){var n=hl.hasOwnProperty(e)?hl[e]:null;(n!==null?n.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(zze(e,r,n,i)&&(r=null),i||n===null?kze(e)&&(r===null?t.removeAttribute(e):t.setAttribute(e,""+r)):n.mustUseProperty?t[n.propertyName]=r===null?n.type===3?!1:"":r:(e=n.attributeName,i=n.attributeNamespace,r===null?t.removeAttribute(e):(n=n.type,r=n===3||n===4&&r===!0?"":""+r,i?t.setAttributeNS(i,e,r):t.setAttribute(e,r))))}var I_=pxe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,cF=Symbol.for("react.element"),IA=Symbol.for("react.portal"),$A=Symbol.for("react.fragment"),zre=Symbol.for("react.strict_mode"),tX=Symbol.for("react.profiler"),mxe=Symbol.for("react.provider"),gxe=Symbol.for("react.context"),Vre=Symbol.for("react.forward_ref"),rX=Symbol.for("react.suspense"),iX=Symbol.for("react.suspense_list"),Bre=Symbol.for("react.memo"),O1=Symbol.for("react.lazy"),yxe=Symbol.for("react.offscreen"),Xce=Symbol.iterator;function W3(t){return t===null||typeof t!="object"?null:(t=Xce&&t[Xce]||t["@@iterator"],typeof t=="function"?t:null)}var Rs=Object.assign,Y7;function fP(t){if(Y7===void 0)try{throw Error()}catch(r){var e=r.stack.trim().match(/\n( *(at )?)/);Y7=e&&e[1]||""}return`
`+Y7+t}var Z7=!1;function J7(t,e){if(!t||Z7)return"";Z7=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var i=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){i=c}t.call(e.prototype)}else{try{throw Error()}catch(c){i=c}t()}}catch(c){if(c&&i&&typeof c.stack=="string"){for(var n=c.stack.split(`
`),s=i.stack.split(`
`),o=n.length-1,a=s.length-1;1<=o&&0<=a&&n[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(n[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||n[o]!==s[a]){var l=`
`+n[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{Z7=!1,Error.prepareStackTrace=r}return(t=t?t.displayName||t.name:"")?fP(t):""}function Vze(t){switch(t.tag){case 5:return fP(t.type);case 16:return fP("Lazy");case 13:return fP("Suspense");case 19:return fP("SuspenseList");case 0:case 2:case 15:return t=J7(t.type,!1),t;case 11:return t=J7(t.type.render,!1),t;case 1:return t=J7(t.type,!0),t;default:return""}}function nX(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case $A:return"Fragment";case IA:return"Portal";case tX:return"Profiler";case zre:return"StrictMode";case rX:return"Suspense";case iX:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case gxe:return(t.displayName||"Context")+".Consumer";case mxe:return(t._context.displayName||"Context")+".Provider";case Vre:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Bre:return e=t.displayName||null,e!==null?e:nX(t.type)||"Memo";case O1:e=t._payload,t=t._init;try{return nX(t(e))}catch{}}return null}function Bze(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return nX(e);case 8:return e===zre?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Gb(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function _xe(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function jze(t){var e=_xe(t)?"checked":"value",r=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var n=r.get,s=r.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return n.call(this)},set:function(o){i=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:r.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function uF(t){t._valueTracker||(t._valueTracker=jze(t))}function vxe(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var r=e.getValue(),i="";return t&&(i=_xe(t)?t.checked?"true":"false":t.value),t=i,t!==r?(e.setValue(t),!0):!1}function o8(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function sX(t,e){var r=e.checked;return Rs({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??t._wrapperState.initialChecked})}function Yce(t,e){var r=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;r=Gb(e.value!=null?e.value:r),t._wrapperState={initialChecked:i,initialValue:r,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function bxe(t,e){e=e.checked,e!=null&&Ure(t,"checked",e,!1)}function oX(t,e){bxe(t,e);var r=Gb(e.value),i=e.type;if(r!=null)i==="number"?(r===0&&t.value===""||t.value!=r)&&(t.value=""+r):t.value!==""+r&&(t.value=""+r);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?aX(t,e.type,r):e.hasOwnProperty("defaultValue")&&aX(t,e.type,Gb(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Zce(t,e,r){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,r||e===t.value||(t.value=e),t.defaultValue=e}r=t.name,r!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,r!==""&&(t.name=r)}function aX(t,e,r){(e!=="number"||o8(t.ownerDocument)!==t)&&(r==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+r&&(t.defaultValue=""+r))}var mP=Array.isArray;function pR(t,e,r,i){if(t=t.options,e){e={};for(var n=0;n<r.length;n++)e["$"+r[n]]=!0;for(r=0;r<t.length;r++)n=e.hasOwnProperty("$"+t[r].value),t[r].selected!==n&&(t[r].selected=n),n&&i&&(t[r].defaultSelected=!0)}else{for(r=""+Gb(r),e=null,n=0;n<t.length;n++){if(t[n].value===r){t[n].selected=!0,i&&(t[n].defaultSelected=!0);return}e!==null||t[n].disabled||(e=t[n])}e!==null&&(e.selected=!0)}}function lX(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(je(91));return Rs({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Jce(t,e){var r=e.value;if(r==null){if(r=e.children,e=e.defaultValue,r!=null){if(e!=null)throw Error(je(92));if(mP(r)){if(1<r.length)throw Error(je(93));r=r[0]}e=r}e==null&&(e=""),r=e}t._wrapperState={initialValue:Gb(r)}}function wxe(t,e){var r=Gb(e.value),i=Gb(e.defaultValue);r!=null&&(r=""+r,r!==t.value&&(t.value=r),e.defaultValue==null&&t.defaultValue!==r&&(t.defaultValue=r)),i!=null&&(t.defaultValue=""+i)}function Kce(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function xxe(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function cX(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?xxe(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var hF,Txe=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,r,i,n){MSApp.execUnsafeLocalFunction(function(){return t(e,r,i,n)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(hF=hF||document.createElement("div"),hF.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=hF.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function pL(t,e){if(e){var r=t.firstChild;if(r&&r===t.lastChild&&r.nodeType===3){r.nodeValue=e;return}}t.textContent=e}var n$={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Gze=["Webkit","ms","Moz","O"];Object.keys(n$).forEach(function(t){Gze.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),n$[e]=n$[t]})});function Sxe(t,e,r){return e==null||typeof e=="boolean"||e===""?"":r||typeof e!="number"||e===0||n$.hasOwnProperty(t)&&n$[t]?(""+e).trim():e+"px"}function Exe(t,e){t=t.style;for(var r in e)if(e.hasOwnProperty(r)){var i=r.indexOf("--")===0,n=Sxe(r,e[r],i);r==="float"&&(r="cssFloat"),i?t.setProperty(r,n):t[r]=n}}var Hze=Rs({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function uX(t,e){if(e){if(Hze[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(je(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(je(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(je(61))}if(e.style!=null&&typeof e.style!="object")throw Error(je(62))}}function hX(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var dX=null;function jre(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var pX=null,fR=null,mR=null;function Qce(t){if(t=QD(t)){if(typeof pX!="function")throw Error(je(280));var e=t.stateNode;e&&(e=a9(e),pX(t.stateNode,t.type,e))}}function Cxe(t){fR?mR?mR.push(t):mR=[t]:fR=t}function Axe(){if(fR){var t=fR,e=mR;if(mR=fR=null,Qce(t),e)for(t=0;t<e.length;t++)Qce(e[t])}}function Rxe(t,e){return t(e)}function Oxe(){}var K7=!1;function Mxe(t,e,r){if(K7)return t(e,r);K7=!0;try{return Rxe(t,e,r)}finally{K7=!1,(fR!==null||mR!==null)&&(Oxe(),Axe())}}function fL(t,e){var r=t.stateNode;if(r===null)return null;var i=a9(r);if(i===null)return null;r=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(r&&typeof r!="function")throw Error(je(231,e,typeof r));return r}var fX=!1;if(d_)try{var X3={};Object.defineProperty(X3,"passive",{get:function(){fX=!0}}),window.addEventListener("test",X3,X3),window.removeEventListener("test",X3,X3)}catch{fX=!1}function qze(t,e,r,i,n,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(r,c)}catch(h){this.onError(h)}}var s$=!1,a8=null,l8=!1,mX=null,Wze={onError:function(t){s$=!0,a8=t}};function Xze(t,e,r,i,n,s,o,a,l){s$=!1,a8=null,qze.apply(Wze,arguments)}function Yze(t,e,r,i,n,s,o,a,l){if(Xze.apply(this,arguments),s$){if(s$){var c=a8;s$=!1,a8=null}else throw Error(je(198));l8||(l8=!0,mX=c)}}function I2(t){var e=t,r=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(r=e.return),t=e.return;while(t)}return e.tag===3?r:null}function Pxe(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function eue(t){if(I2(t)!==t)throw Error(je(188))}function Zze(t){var e=t.alternate;if(!e){if(e=I2(t),e===null)throw Error(je(188));return e!==t?null:t}for(var r=t,i=e;;){var n=r.return;if(n===null)break;var s=n.alternate;if(s===null){if(i=n.return,i!==null){r=i;continue}break}if(n.child===s.child){for(s=n.child;s;){if(s===r)return eue(n),t;if(s===i)return eue(n),e;s=s.sibling}throw Error(je(188))}if(r.return!==i.return)r=n,i=s;else{for(var o=!1,a=n.child;a;){if(a===r){o=!0,r=n,i=s;break}if(a===i){o=!0,i=n,r=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===r){o=!0,r=s,i=n;break}if(a===i){o=!0,i=s,r=n;break}a=a.sibling}if(!o)throw Error(je(189))}}if(r.alternate!==i)throw Error(je(190))}if(r.tag!==3)throw Error(je(188));return r.stateNode.current===r?t:e}function Ixe(t){return t=Zze(t),t!==null?$xe(t):null}function $xe(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=$xe(t);if(e!==null)return e;t=t.sibling}return null}var Lxe=ed.unstable_scheduleCallback,tue=ed.unstable_cancelCallback,Jze=ed.unstable_shouldYield,Kze=ed.unstable_requestPaint,co=ed.unstable_now,Qze=ed.unstable_getCurrentPriorityLevel,Gre=ed.unstable_ImmediatePriority,Dxe=ed.unstable_UserBlockingPriority,c8=ed.unstable_NormalPriority,eVe=ed.unstable_LowPriority,Nxe=ed.unstable_IdlePriority,i9=null,Vg=null;function tVe(t){if(Vg&&typeof Vg.onCommitFiberRoot=="function")try{Vg.onCommitFiberRoot(i9,t,void 0,(t.current.flags&128)===128)}catch{}}var Jf=Math.clz32?Math.clz32:nVe,rVe=Math.log,iVe=Math.LN2;function nVe(t){return t>>>=0,t===0?32:31-(rVe(t)/iVe|0)|0}var dF=64,pF=4194304;function gP(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function u8(t,e){var r=t.pendingLanes;if(r===0)return 0;var i=0,n=t.suspendedLanes,s=t.pingedLanes,o=r&268435455;if(o!==0){var a=o&~n;a!==0?i=gP(a):(s&=o,s!==0&&(i=gP(s)))}else o=r&~n,o!==0?i=gP(o):s!==0&&(i=gP(s));if(i===0)return 0;if(e!==0&&e!==i&&!(e&n)&&(n=i&-i,s=e&-e,n>=s||n===16&&(s&4194240)!==0))return e;if(i&4&&(i|=r&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)r=31-Jf(e),n=1<<r,i|=t[r],e&=~n;return i}function sVe(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function oVe(t,e){for(var r=t.suspendedLanes,i=t.pingedLanes,n=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-Jf(s),a=1<<o,l=n[o];l===-1?(!(a&r)||a&i)&&(n[o]=sVe(a,e)):l<=e&&(t.expiredLanes|=a),s&=~a}}function gX(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Fxe(){var t=dF;return dF<<=1,!(dF&4194240)&&(dF=64),t}function Q7(t){for(var e=[],r=0;31>r;r++)e.push(t);return e}function JD(t,e,r){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Jf(e),t[e]=r}function aVe(t,e){var r=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<r;){var n=31-Jf(r),s=1<<n;e[n]=0,i[n]=-1,t[n]=-1,r&=~s}}function Hre(t,e){var r=t.entangledLanes|=e;for(t=t.entanglements;r;){var i=31-Jf(r),n=1<<i;n&e|t[i]&e&&(t[i]|=e),r&=~n}}var fn=0;function kxe(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Uxe,qre,zxe,Vxe,Bxe,yX=!1,fF=[],Tb=null,Sb=null,Eb=null,mL=new Map,gL=new Map,B1=[],lVe="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function rue(t,e){switch(t){case"focusin":case"focusout":Tb=null;break;case"dragenter":case"dragleave":Sb=null;break;case"mouseover":case"mouseout":Eb=null;break;case"pointerover":case"pointerout":mL.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":gL.delete(e.pointerId)}}function Y3(t,e,r,i,n,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:r,eventSystemFlags:i,nativeEvent:s,targetContainers:[n]},e!==null&&(e=QD(e),e!==null&&qre(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,n!==null&&e.indexOf(n)===-1&&e.push(n),t)}function cVe(t,e,r,i,n){switch(e){case"focusin":return Tb=Y3(Tb,t,e,r,i,n),!0;case"dragenter":return Sb=Y3(Sb,t,e,r,i,n),!0;case"mouseover":return Eb=Y3(Eb,t,e,r,i,n),!0;case"pointerover":var s=n.pointerId;return mL.set(s,Y3(mL.get(s)||null,t,e,r,i,n)),!0;case"gotpointercapture":return s=n.pointerId,gL.set(s,Y3(gL.get(s)||null,t,e,r,i,n)),!0}return!1}function jxe(t){var e=oS(t.target);if(e!==null){var r=I2(e);if(r!==null){if(e=r.tag,e===13){if(e=Pxe(r),e!==null){t.blockedOn=e,Bxe(t.priority,function(){zxe(r)});return}}else if(e===3&&r.stateNode.current.memoizedState.isDehydrated){t.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Bk(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var r=_X(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(r===null){r=t.nativeEvent;var i=new r.constructor(r.type,r);dX=i,r.target.dispatchEvent(i),dX=null}else return e=QD(r),e!==null&&qre(e),t.blockedOn=r,!1;e.shift()}return!0}function iue(t,e,r){Bk(t)&&r.delete(e)}function uVe(){yX=!1,Tb!==null&&Bk(Tb)&&(Tb=null),Sb!==null&&Bk(Sb)&&(Sb=null),Eb!==null&&Bk(Eb)&&(Eb=null),mL.forEach(iue),gL.forEach(iue)}function Z3(t,e){t.blockedOn===e&&(t.blockedOn=null,yX||(yX=!0,ed.unstable_scheduleCallback(ed.unstable_NormalPriority,uVe)))}function yL(t){function e(n){return Z3(n,t)}if(0<fF.length){Z3(fF[0],t);for(var r=1;r<fF.length;r++){var i=fF[r];i.blockedOn===t&&(i.blockedOn=null)}}for(Tb!==null&&Z3(Tb,t),Sb!==null&&Z3(Sb,t),Eb!==null&&Z3(Eb,t),mL.forEach(e),gL.forEach(e),r=0;r<B1.length;r++)i=B1[r],i.blockedOn===t&&(i.blockedOn=null);for(;0<B1.length&&(r=B1[0],r.blockedOn===null);)jxe(r),r.blockedOn===null&&B1.shift()}var gR=I_.ReactCurrentBatchConfig,h8=!0;function hVe(t,e,r,i){var n=fn,s=gR.transition;gR.transition=null;try{fn=1,Wre(t,e,r,i)}finally{fn=n,gR.transition=s}}function dVe(t,e,r,i){var n=fn,s=gR.transition;gR.transition=null;try{fn=4,Wre(t,e,r,i)}finally{fn=n,gR.transition=s}}function Wre(t,e,r,i){if(h8){var n=_X(t,e,r,i);if(n===null)cj(t,e,i,d8,r),rue(t,i);else if(cVe(n,t,e,r,i))i.stopPropagation();else if(rue(t,i),e&4&&-1<lVe.indexOf(t)){for(;n!==null;){var s=QD(n);if(s!==null&&Uxe(s),s=_X(t,e,r,i),s===null&&cj(t,e,i,d8,r),s===n)break;n=s}n!==null&&i.stopPropagation()}else cj(t,e,i,null,r)}}var d8=null;function _X(t,e,r,i){if(d8=null,t=jre(i),t=oS(t),t!==null)if(e=I2(t),e===null)t=null;else if(r=e.tag,r===13){if(t=Pxe(e),t!==null)return t;t=null}else if(r===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return d8=t,null}function Gxe(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Qze()){case Gre:return 1;case Dxe:return 4;case c8:case eVe:return 16;case Nxe:return 536870912;default:return 16}default:return 16}}var eb=null,Xre=null,jk=null;function Hxe(){if(jk)return jk;var t,e=Xre,r=e.length,i,n="value"in eb?eb.value:eb.textContent,s=n.length;for(t=0;t<r&&e[t]===n[t];t++);var o=r-t;for(i=1;i<=o&&e[r-i]===n[s-i];i++);return jk=n.slice(t,1<i?1-i:void 0)}function Gk(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function mF(){return!0}function nue(){return!1}function ld(t){function e(r,i,n,s,o){this._reactName=r,this._targetInst=n,this.type=i,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(r=t[a],this[a]=r?r(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?mF:nue,this.isPropagationStopped=nue,this}return Rs(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=mF)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=mF)},persist:function(){},isPersistent:mF}),e}var n3={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Yre=ld(n3),KD=Rs({},n3,{view:0,detail:0}),pVe=ld(KD),ej,tj,J3,n9=Rs({},KD,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Zre,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==J3&&(J3&&t.type==="mousemove"?(ej=t.screenX-J3.screenX,tj=t.screenY-J3.screenY):tj=ej=0,J3=t),ej)},movementY:function(t){return"movementY"in t?t.movementY:tj}}),sue=ld(n9),fVe=Rs({},n9,{dataTransfer:0}),mVe=ld(fVe),gVe=Rs({},KD,{relatedTarget:0}),rj=ld(gVe),yVe=Rs({},n3,{animationName:0,elapsedTime:0,pseudoElement:0}),_Ve=ld(yVe),vVe=Rs({},n3,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),bVe=ld(vVe),wVe=Rs({},n3,{data:0}),oue=ld(wVe),xVe={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},TVe={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},SVe={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function EVe(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=SVe[t])?!!e[t]:!1}function Zre(){return EVe}var CVe=Rs({},KD,{key:function(t){if(t.key){var e=xVe[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Gk(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?TVe[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Zre,charCode:function(t){return t.type==="keypress"?Gk(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Gk(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),AVe=ld(CVe),RVe=Rs({},n9,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),aue=ld(RVe),OVe=Rs({},KD,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Zre}),MVe=ld(OVe),PVe=Rs({},n3,{propertyName:0,elapsedTime:0,pseudoElement:0}),IVe=ld(PVe),$Ve=Rs({},n9,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),LVe=ld($Ve),DVe=[9,13,27,32],Jre=d_&&"CompositionEvent"in window,o$=null;d_&&"documentMode"in document&&(o$=document.documentMode);var NVe=d_&&"TextEvent"in window&&!o$,qxe=d_&&(!Jre||o$&&8<o$&&11>=o$),lue=String.fromCharCode(32),cue=!1;function Wxe(t,e){switch(t){case"keyup":return DVe.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Xxe(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var LA=!1;function FVe(t,e){switch(t){case"compositionend":return Xxe(e);case"keypress":return e.which!==32?null:(cue=!0,lue);case"textInput":return t=e.data,t===lue&&cue?null:t;default:return null}}function kVe(t,e){if(LA)return t==="compositionend"||!Jre&&Wxe(t,e)?(t=Hxe(),jk=Xre=eb=null,LA=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return qxe&&e.locale!=="ko"?null:e.data;default:return null}}var UVe={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function uue(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!UVe[t.type]:e==="textarea"}function Yxe(t,e,r,i){Cxe(i),e=p8(e,"onChange"),0<e.length&&(r=new Yre("onChange","change",null,r,i),t.push({event:r,listeners:e}))}var a$=null,_L=null;function zVe(t){oTe(t,0)}function s9(t){var e=FA(t);if(vxe(e))return t}function VVe(t,e){if(t==="change")return e}var Zxe=!1;if(d_){var ij;if(d_){var nj="oninput"in document;if(!nj){var hue=document.createElement("div");hue.setAttribute("oninput","return;"),nj=typeof hue.oninput=="function"}ij=nj}else ij=!1;Zxe=ij&&(!document.documentMode||9<document.documentMode)}function due(){a$&&(a$.detachEvent("onpropertychange",Jxe),_L=a$=null)}function Jxe(t){if(t.propertyName==="value"&&s9(_L)){var e=[];Yxe(e,_L,t,jre(t)),Mxe(zVe,e)}}function BVe(t,e,r){t==="focusin"?(due(),a$=e,_L=r,a$.attachEvent("onpropertychange",Jxe)):t==="focusout"&&due()}function jVe(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return s9(_L)}function GVe(t,e){if(t==="click")return s9(e)}function HVe(t,e){if(t==="input"||t==="change")return s9(e)}function qVe(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var sm=typeof Object.is=="function"?Object.is:qVe;function vL(t,e){if(sm(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(i=0;i<r.length;i++){var n=r[i];if(!eX.call(e,n)||!sm(t[n],e[n]))return!1}return!0}function pue(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function fue(t,e){var r=pue(t);t=0;for(var i;r;){if(r.nodeType===3){if(i=t+r.textContent.length,t<=e&&i>=e)return{node:r,offset:e-t};t=i}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=pue(r)}}function Kxe(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?Kxe(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Qxe(){for(var t=window,e=o8();e instanceof t.HTMLIFrameElement;){try{var r=typeof e.contentWindow.location.href=="string"}catch{r=!1}if(r)t=e.contentWindow;else break;e=o8(t.document)}return e}function Kre(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function WVe(t){var e=Qxe(),r=t.focusedElem,i=t.selectionRange;if(e!==r&&r&&r.ownerDocument&&Kxe(r.ownerDocument.documentElement,r)){if(i!==null&&Kre(r)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in r)r.selectionStart=e,r.selectionEnd=Math.min(t,r.value.length);else if(t=(e=r.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var n=r.textContent.length,s=Math.min(i.start,n);i=i.end===void 0?s:Math.min(i.end,n),!t.extend&&s>i&&(n=i,i=s,s=n),n=fue(r,s);var o=fue(r,i);n&&o&&(t.rangeCount!==1||t.anchorNode!==n.node||t.anchorOffset!==n.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(n.node,n.offset),t.removeAllRanges(),s>i?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=r;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<e.length;r++)t=e[r],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var XVe=d_&&"documentMode"in document&&11>=document.documentMode,DA=null,vX=null,l$=null,bX=!1;function mue(t,e,r){var i=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;bX||DA==null||DA!==o8(i)||(i=DA,"selectionStart"in i&&Kre(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),l$&&vL(l$,i)||(l$=i,i=p8(vX,"onSelect"),0<i.length&&(e=new Yre("onSelect","select",null,e,r),t.push({event:e,listeners:i}),e.target=DA)))}function gF(t,e){var r={};return r[t.toLowerCase()]=e.toLowerCase(),r["Webkit"+t]="webkit"+e,r["Moz"+t]="moz"+e,r}var NA={animationend:gF("Animation","AnimationEnd"),animationiteration:gF("Animation","AnimationIteration"),animationstart:gF("Animation","AnimationStart"),transitionend:gF("Transition","TransitionEnd")},sj={},eTe={};d_&&(eTe=document.createElement("div").style,"AnimationEvent"in window||(delete NA.animationend.animation,delete NA.animationiteration.animation,delete NA.animationstart.animation),"TransitionEvent"in window||delete NA.transitionend.transition);function o9(t){if(sj[t])return sj[t];if(!NA[t])return t;var e=NA[t],r;for(r in e)if(e.hasOwnProperty(r)&&r in eTe)return sj[t]=e[r];return t}var tTe=o9("animationend"),rTe=o9("animationiteration"),iTe=o9("animationstart"),nTe=o9("transitionend"),sTe=new Map,gue="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function xw(t,e){sTe.set(t,e),P2(e,[t])}for(var oj=0;oj<gue.length;oj++){var aj=gue[oj],YVe=aj.toLowerCase(),ZVe=aj[0].toUpperCase()+aj.slice(1);xw(YVe,"on"+ZVe)}xw(tTe,"onAnimationEnd");xw(rTe,"onAnimationIteration");xw(iTe,"onAnimationStart");xw("dblclick","onDoubleClick");xw("focusin","onFocus");xw("focusout","onBlur");xw(nTe,"onTransitionEnd");KR("onMouseEnter",["mouseout","mouseover"]);KR("onMouseLeave",["mouseout","mouseover"]);KR("onPointerEnter",["pointerout","pointerover"]);KR("onPointerLeave",["pointerout","pointerover"]);P2("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));P2("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));P2("onBeforeInput",["compositionend","keypress","textInput","paste"]);P2("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));P2("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));P2("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var yP="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),JVe=new Set("cancel close invalid load scroll toggle".split(" ").concat(yP));function yue(t,e,r){var i=t.type||"unknown-event";t.currentTarget=r,Yze(i,e,void 0,t),t.currentTarget=null}function oTe(t,e){e=(e&4)!==0;for(var r=0;r<t.length;r++){var i=t[r],n=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var o=i.length-1;0<=o;o--){var a=i[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&n.isPropagationStopped())break e;yue(n,a,c),s=l}else for(o=0;o<i.length;o++){if(a=i[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==s&&n.isPropagationStopped())break e;yue(n,a,c),s=l}}}if(l8)throw t=mX,l8=!1,mX=null,t}function es(t,e){var r=e[EX];r===void 0&&(r=e[EX]=new Set);var i=t+"__bubble";r.has(i)||(aTe(e,t,2,!1),r.add(i))}function lj(t,e,r){var i=0;e&&(i|=4),aTe(r,t,i,e)}var yF="_reactListening"+Math.random().toString(36).slice(2);function bL(t){if(!t[yF]){t[yF]=!0,fxe.forEach(function(r){r!=="selectionchange"&&(JVe.has(r)||lj(r,!1,t),lj(r,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[yF]||(e[yF]=!0,lj("selectionchange",!1,e))}}function aTe(t,e,r,i){switch(Gxe(e)){case 1:var n=hVe;break;case 4:n=dVe;break;default:n=Wre}r=n.bind(null,e,r,t),n=void 0,!fX||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(n=!0),i?n!==void 0?t.addEventListener(e,r,{capture:!0,passive:n}):t.addEventListener(e,r,!0):n!==void 0?t.addEventListener(e,r,{passive:n}):t.addEventListener(e,r,!1)}function cj(t,e,r,i,n){var s=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var a=i.stateNode.containerInfo;if(a===n||a.nodeType===8&&a.parentNode===n)break;if(o===4)for(o=i.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===n||l.nodeType===8&&l.parentNode===n))return;o=o.return}for(;a!==null;){if(o=oS(a),o===null)return;if(l=o.tag,l===5||l===6){i=s=o;continue e}a=a.parentNode}}i=i.return}Mxe(function(){var c=s,h=jre(r),p=[];e:{var f=sTe.get(t);if(f!==void 0){var m=Yre,g=t;switch(t){case"keypress":if(Gk(r)===0)break e;case"keydown":case"keyup":m=AVe;break;case"focusin":g="focus",m=rj;break;case"focusout":g="blur",m=rj;break;case"beforeblur":case"afterblur":m=rj;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=sue;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=mVe;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=MVe;break;case tTe:case rTe:case iTe:m=_Ve;break;case nTe:m=IVe;break;case"scroll":m=pVe;break;case"wheel":m=LVe;break;case"copy":case"cut":case"paste":m=bVe;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=aue}var _=(e&4)!==0,b=!_&&t==="scroll",w=_?f!==null?f+"Capture":null:f;_=[];for(var x=c,T;x!==null;){T=x;var E=T.stateNode;if(T.tag===5&&E!==null&&(T=E,w!==null&&(E=fL(x,w),E!=null&&_.push(wL(x,E,T)))),b)break;x=x.return}0<_.length&&(f=new m(f,g,null,r,h),p.push({event:f,listeners:_}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",m=t==="mouseout"||t==="pointerout",f&&r!==dX&&(g=r.relatedTarget||r.fromElement)&&(oS(g)||g[p_]))break e;if((m||f)&&(f=h.window===h?h:(f=h.ownerDocument)?f.defaultView||f.parentWindow:window,m?(g=r.relatedTarget||r.toElement,m=c,g=g?oS(g):null,g!==null&&(b=I2(g),g!==b||g.tag!==5&&g.tag!==6)&&(g=null)):(m=null,g=c),m!==g)){if(_=sue,E="onMouseLeave",w="onMouseEnter",x="mouse",(t==="pointerout"||t==="pointerover")&&(_=aue,E="onPointerLeave",w="onPointerEnter",x="pointer"),b=m==null?f:FA(m),T=g==null?f:FA(g),f=new _(E,x+"leave",m,r,h),f.target=b,f.relatedTarget=T,E=null,oS(h)===c&&(_=new _(w,x+"enter",g,r,h),_.target=T,_.relatedTarget=b,E=_),b=E,m&&g)t:{for(_=m,w=g,x=0,T=_;T;T=J2(T))x++;for(T=0,E=w;E;E=J2(E))T++;for(;0<x-T;)_=J2(_),x--;for(;0<T-x;)w=J2(w),T--;for(;x--;){if(_===w||w!==null&&_===w.alternate)break t;_=J2(_),w=J2(w)}_=null}else _=null;m!==null&&_ue(p,f,m,_,!1),g!==null&&b!==null&&_ue(p,b,g,_,!0)}}e:{if(f=c?FA(c):window,m=f.nodeName&&f.nodeName.toLowerCase(),m==="select"||m==="input"&&f.type==="file")var C=VVe;else if(uue(f))if(Zxe)C=HVe;else{C=jVe;var A=BVe}else(m=f.nodeName)&&m.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(C=GVe);if(C&&(C=C(t,c))){Yxe(p,C,r,h);break e}A&&A(t,f,c),t==="focusout"&&(A=f._wrapperState)&&A.controlled&&f.type==="number"&&aX(f,"number",f.value)}switch(A=c?FA(c):window,t){case"focusin":(uue(A)||A.contentEditable==="true")&&(DA=A,vX=c,l$=null);break;case"focusout":l$=vX=DA=null;break;case"mousedown":bX=!0;break;case"contextmenu":case"mouseup":case"dragend":bX=!1,mue(p,r,h);break;case"selectionchange":if(XVe)break;case"keydown":case"keyup":mue(p,r,h)}var I;if(Jre)e:{switch(t){case"compositionstart":var M="onCompositionStart";break e;case"compositionend":M="onCompositionEnd";break e;case"compositionupdate":M="onCompositionUpdate";break e}M=void 0}else LA?Wxe(t,r)&&(M="onCompositionEnd"):t==="keydown"&&r.keyCode===229&&(M="onCompositionStart");M&&(qxe&&r.locale!=="ko"&&(LA||M!=="onCompositionStart"?M==="onCompositionEnd"&&LA&&(I=Hxe()):(eb=h,Xre="value"in eb?eb.value:eb.textContent,LA=!0)),A=p8(c,M),0<A.length&&(M=new oue(M,t,null,r,h),p.push({event:M,listeners:A}),I?M.data=I:(I=Xxe(r),I!==null&&(M.data=I)))),(I=NVe?FVe(t,r):kVe(t,r))&&(c=p8(c,"onBeforeInput"),0<c.length&&(h=new oue("onBeforeInput","beforeinput",null,r,h),p.push({event:h,listeners:c}),h.data=I))}oTe(p,e)})}function wL(t,e,r){return{instance:t,listener:e,currentTarget:r}}function p8(t,e){for(var r=e+"Capture",i=[];t!==null;){var n=t,s=n.stateNode;n.tag===5&&s!==null&&(n=s,s=fL(t,r),s!=null&&i.unshift(wL(t,s,n)),s=fL(t,e),s!=null&&i.push(wL(t,s,n))),t=t.return}return i}function J2(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function _ue(t,e,r,i,n){for(var s=e._reactName,o=[];r!==null&&r!==i;){var a=r,l=a.alternate,c=a.stateNode;if(l!==null&&l===i)break;a.tag===5&&c!==null&&(a=c,n?(l=fL(r,s),l!=null&&o.unshift(wL(r,l,a))):n||(l=fL(r,s),l!=null&&o.push(wL(r,l,a)))),r=r.return}o.length!==0&&t.push({event:e,listeners:o})}var KVe=/\r\n?/g,QVe=/\u0000|\uFFFD/g;function vue(t){return(typeof t=="string"?t:""+t).replace(KVe,`
`).replace(QVe,"")}function _F(t,e,r){if(e=vue(e),vue(t)!==e&&r)throw Error(je(425))}function f8(){}var wX=null,xX=null;function TX(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var SX=typeof setTimeout=="function"?setTimeout:void 0,e9e=typeof clearTimeout=="function"?clearTimeout:void 0,bue=typeof Promise=="function"?Promise:void 0,t9e=typeof queueMicrotask=="function"?queueMicrotask:typeof bue<"u"?function(t){return bue.resolve(null).then(t).catch(r9e)}:SX;function r9e(t){setTimeout(function(){throw t})}function uj(t,e){var r=e,i=0;do{var n=r.nextSibling;if(t.removeChild(r),n&&n.nodeType===8)if(r=n.data,r==="/$"){if(i===0){t.removeChild(n),yL(e);return}i--}else r!=="$"&&r!=="$?"&&r!=="$!"||i++;r=n}while(r);yL(e)}function Cb(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function wue(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="$"||r==="$!"||r==="$?"){if(e===0)return t;e--}else r==="/$"&&e++}t=t.previousSibling}return null}var s3=Math.random().toString(36).slice(2),Rg="__reactFiber$"+s3,xL="__reactProps$"+s3,p_="__reactContainer$"+s3,EX="__reactEvents$"+s3,i9e="__reactListeners$"+s3,n9e="__reactHandles$"+s3;function oS(t){var e=t[Rg];if(e)return e;for(var r=t.parentNode;r;){if(e=r[p_]||r[Rg]){if(r=e.alternate,e.child!==null||r!==null&&r.child!==null)for(t=wue(t);t!==null;){if(r=t[Rg])return r;t=wue(t)}return e}t=r,r=t.parentNode}return null}function QD(t){return t=t[Rg]||t[p_],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function FA(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(je(33))}function a9(t){return t[xL]||null}var CX=[],kA=-1;function Tw(t){return{current:t}}function ds(t){0>kA||(t.current=CX[kA],CX[kA]=null,kA--)}function qn(t,e){kA++,CX[kA]=t.current,t.current=e}var Hb={},Yl=Tw(Hb),ku=Tw(!1),jS=Hb;function QR(t,e){var r=t.type.contextTypes;if(!r)return Hb;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var n={},s;for(s in r)n[s]=e[s];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=n),n}function Uu(t){return t=t.childContextTypes,t!=null}function m8(){ds(ku),ds(Yl)}function xue(t,e,r){if(Yl.current!==Hb)throw Error(je(168));qn(Yl,e),qn(ku,r)}function lTe(t,e,r){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return r;i=i.getChildContext();for(var n in i)if(!(n in e))throw Error(je(108,Bze(t)||"Unknown",n));return Rs({},r,i)}function g8(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Hb,jS=Yl.current,qn(Yl,t),qn(ku,ku.current),!0}function Tue(t,e,r){var i=t.stateNode;if(!i)throw Error(je(169));r?(t=lTe(t,e,jS),i.__reactInternalMemoizedMergedChildContext=t,ds(ku),ds(Yl),qn(Yl,t)):ds(ku),qn(ku,r)}var M0=null,l9=!1,hj=!1;function cTe(t){M0===null?M0=[t]:M0.push(t)}function s9e(t){l9=!0,cTe(t)}function Sw(){if(!hj&&M0!==null){hj=!0;var t=0,e=fn;try{var r=M0;for(fn=1;t<r.length;t++){var i=r[t];do i=i(!0);while(i!==null)}M0=null,l9=!1}catch(n){throw M0!==null&&(M0=M0.slice(t+1)),Lxe(Gre,Sw),n}finally{fn=e,hj=!1}}return null}var UA=[],zA=0,y8=null,_8=0,Yd=[],Zd=0,GS=null,z0=1,V0="";function Px(t,e){UA[zA++]=_8,UA[zA++]=y8,y8=t,_8=e}function uTe(t,e,r){Yd[Zd++]=z0,Yd[Zd++]=V0,Yd[Zd++]=GS,GS=t;var i=z0;t=V0;var n=32-Jf(i)-1;i&=~(1<<n),r+=1;var s=32-Jf(e)+n;if(30<s){var o=n-n%5;s=(i&(1<<o)-1).toString(32),i>>=o,n-=o,z0=1<<32-Jf(e)+n|r<<n|i,V0=s+t}else z0=1<<s|r<<n|i,V0=t}function Qre(t){t.return!==null&&(Px(t,1),uTe(t,1,0))}function eie(t){for(;t===y8;)y8=UA[--zA],UA[zA]=null,_8=UA[--zA],UA[zA]=null;for(;t===GS;)GS=Yd[--Zd],Yd[Zd]=null,V0=Yd[--Zd],Yd[Zd]=null,z0=Yd[--Zd],Yd[Zd]=null}var Xh=null,Hh=null,vs=!1,Df=null;function hTe(t,e){var r=lp(5,null,null,0);r.elementType="DELETED",r.stateNode=e,r.return=t,e=t.deletions,e===null?(t.deletions=[r],t.flags|=16):e.push(r)}function Sue(t,e){switch(t.tag){case 5:var r=t.type;return e=e.nodeType!==1||r.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Xh=t,Hh=Cb(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Xh=t,Hh=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(r=GS!==null?{id:z0,overflow:V0}:null,t.memoizedState={dehydrated:e,treeContext:r,retryLane:1073741824},r=lp(18,null,null,0),r.stateNode=e,r.return=t,t.child=r,Xh=t,Hh=null,!0):!1;default:return!1}}function AX(t){return(t.mode&1)!==0&&(t.flags&128)===0}function RX(t){if(vs){var e=Hh;if(e){var r=e;if(!Sue(t,e)){if(AX(t))throw Error(je(418));e=Cb(r.nextSibling);var i=Xh;e&&Sue(t,e)?hTe(i,r):(t.flags=t.flags&-4097|2,vs=!1,Xh=t)}}else{if(AX(t))throw Error(je(418));t.flags=t.flags&-4097|2,vs=!1,Xh=t}}}function Eue(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Xh=t}function vF(t){if(t!==Xh)return!1;if(!vs)return Eue(t),vs=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!TX(t.type,t.memoizedProps)),e&&(e=Hh)){if(AX(t))throw dTe(),Error(je(418));for(;e;)hTe(t,e),e=Cb(e.nextSibling)}if(Eue(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(je(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="/$"){if(e===0){Hh=Cb(t.nextSibling);break e}e--}else r!=="$"&&r!=="$!"&&r!=="$?"||e++}t=t.nextSibling}Hh=null}}else Hh=Xh?Cb(t.stateNode.nextSibling):null;return!0}function dTe(){for(var t=Hh;t;)t=Cb(t.nextSibling)}function eO(){Hh=Xh=null,vs=!1}function tie(t){Df===null?Df=[t]:Df.push(t)}var o9e=I_.ReactCurrentBatchConfig;function Af(t,e){if(t&&t.defaultProps){e=Rs({},e),t=t.defaultProps;for(var r in t)e[r]===void 0&&(e[r]=t[r]);return e}return e}var v8=Tw(null),b8=null,VA=null,rie=null;function iie(){rie=VA=b8=null}function nie(t){var e=v8.current;ds(v8),t._currentValue=e}function OX(t,e,r){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===r)break;t=t.return}}function yR(t,e){b8=t,rie=VA=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Lu=!0),t.firstContext=null)}function wp(t){var e=t._currentValue;if(rie!==t)if(t={context:t,memoizedValue:e,next:null},VA===null){if(b8===null)throw Error(je(308));VA=t,b8.dependencies={lanes:0,firstContext:t}}else VA=VA.next=t;return e}var aS=null;function sie(t){aS===null?aS=[t]:aS.push(t)}function pTe(t,e,r,i){var n=e.interleaved;return n===null?(r.next=r,sie(e)):(r.next=n.next,n.next=r),e.interleaved=r,f_(t,i)}function f_(t,e){t.lanes|=e;var r=t.alternate;for(r!==null&&(r.lanes|=e),r=t,t=t.return;t!==null;)t.childLanes|=e,r=t.alternate,r!==null&&(r.childLanes|=e),r=t,t=t.return;return r.tag===3?r.stateNode:null}var M1=!1;function oie(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function fTe(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function J0(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Ab(t,e,r){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,Mi&2){var n=i.pending;return n===null?e.next=e:(e.next=n.next,n.next=e),i.pending=e,f_(t,r)}return n=i.interleaved,n===null?(e.next=e,sie(i)):(e.next=n.next,n.next=e),i.interleaved=e,f_(t,r)}function Hk(t,e,r){if(e=e.updateQueue,e!==null&&(e=e.shared,(r&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,r|=i,e.lanes=r,Hre(t,r)}}function Cue(t,e){var r=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,r===i)){var n=null,s=null;if(r=r.firstBaseUpdate,r!==null){do{var o={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};s===null?n=s=o:s=s.next=o,r=r.next}while(r!==null);s===null?n=s=e:s=s.next=e}else n=s=e;r={baseState:i.baseState,firstBaseUpdate:n,lastBaseUpdate:s,shared:i.shared,effects:i.effects},t.updateQueue=r;return}t=r.lastBaseUpdate,t===null?r.firstBaseUpdate=e:t.next=e,r.lastBaseUpdate=e}function w8(t,e,r,i){var n=t.updateQueue;M1=!1;var s=n.firstBaseUpdate,o=n.lastBaseUpdate,a=n.shared.pending;if(a!==null){n.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?s=c:o.next=c,o=l;var h=t.alternate;h!==null&&(h=h.updateQueue,a=h.lastBaseUpdate,a!==o&&(a===null?h.firstBaseUpdate=c:a.next=c,h.lastBaseUpdate=l))}if(s!==null){var p=n.baseState;o=0,h=c=l=null,a=s;do{var f=a.lane,m=a.eventTime;if((i&f)===f){h!==null&&(h=h.next={eventTime:m,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var g=t,_=a;switch(f=e,m=r,_.tag){case 1:if(g=_.payload,typeof g=="function"){p=g.call(m,p,f);break e}p=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=_.payload,f=typeof g=="function"?g.call(m,p,f):g,f==null)break e;p=Rs({},p,f);break e;case 2:M1=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,f=n.effects,f===null?n.effects=[a]:f.push(a))}else m={eventTime:m,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},h===null?(c=h=m,l=p):h=h.next=m,o|=f;if(a=a.next,a===null){if(a=n.shared.pending,a===null)break;f=a,a=f.next,f.next=null,n.lastBaseUpdate=f,n.shared.pending=null}}while(1);if(h===null&&(l=p),n.baseState=l,n.firstBaseUpdate=c,n.lastBaseUpdate=h,e=n.shared.interleaved,e!==null){n=e;do o|=n.lane,n=n.next;while(n!==e)}else s===null&&(n.shared.lanes=0);qS|=o,t.lanes=o,t.memoizedState=p}}function Aue(t,e,r){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],n=i.callback;if(n!==null){if(i.callback=null,i=r,typeof n!="function")throw Error(je(191,n));n.call(i)}}}var mTe=new pxe.Component().refs;function MX(t,e,r,i){e=t.memoizedState,r=r(i,e),r=r==null?e:Rs({},e,r),t.memoizedState=r,t.lanes===0&&(t.updateQueue.baseState=r)}var c9={isMounted:function(t){return(t=t._reactInternals)?I2(t)===t:!1},enqueueSetState:function(t,e,r){t=t._reactInternals;var i=Vc(),n=Ob(t),s=J0(i,n);s.payload=e,r!=null&&(s.callback=r),e=Ab(t,s,n),e!==null&&(Kf(e,t,n,i),Hk(e,t,n))},enqueueReplaceState:function(t,e,r){t=t._reactInternals;var i=Vc(),n=Ob(t),s=J0(i,n);s.tag=1,s.payload=e,r!=null&&(s.callback=r),e=Ab(t,s,n),e!==null&&(Kf(e,t,n,i),Hk(e,t,n))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var r=Vc(),i=Ob(t),n=J0(r,i);n.tag=2,e!=null&&(n.callback=e),e=Ab(t,n,i),e!==null&&(Kf(e,t,i,r),Hk(e,t,i))}};function Rue(t,e,r,i,n,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,s,o):e.prototype&&e.prototype.isPureReactComponent?!vL(r,i)||!vL(n,s):!0}function gTe(t,e,r){var i=!1,n=Hb,s=e.contextType;return typeof s=="object"&&s!==null?s=wp(s):(n=Uu(e)?jS:Yl.current,i=e.contextTypes,s=(i=i!=null)?QR(t,n):Hb),e=new e(r,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=c9,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=n,t.__reactInternalMemoizedMaskedChildContext=s),e}function Oue(t,e,r,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(r,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(r,i),e.state!==t&&c9.enqueueReplaceState(e,e.state,null)}function PX(t,e,r,i){var n=t.stateNode;n.props=r,n.state=t.memoizedState,n.refs=mTe,oie(t);var s=e.contextType;typeof s=="object"&&s!==null?n.context=wp(s):(s=Uu(e)?jS:Yl.current,n.context=QR(t,s)),n.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(MX(t,e,s,r),n.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof n.getSnapshotBeforeUpdate=="function"||typeof n.UNSAFE_componentWillMount!="function"&&typeof n.componentWillMount!="function"||(e=n.state,typeof n.componentWillMount=="function"&&n.componentWillMount(),typeof n.UNSAFE_componentWillMount=="function"&&n.UNSAFE_componentWillMount(),e!==n.state&&c9.enqueueReplaceState(n,n.state,null),w8(t,r,n,i),n.state=t.memoizedState),typeof n.componentDidMount=="function"&&(t.flags|=4194308)}function K3(t,e,r){if(t=r.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(je(309));var i=r.stateNode}if(!i)throw Error(je(147,t));var n=i,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=n.refs;a===mTe&&(a=n.refs={}),o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(je(284));if(!r._owner)throw Error(je(290,t))}return t}function bF(t,e){throw t=Object.prototype.toString.call(e),Error(je(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Mue(t){var e=t._init;return e(t._payload)}function yTe(t){function e(w,x){if(t){var T=w.deletions;T===null?(w.deletions=[x],w.flags|=16):T.push(x)}}function r(w,x){if(!t)return null;for(;x!==null;)e(w,x),x=x.sibling;return null}function i(w,x){for(w=new Map;x!==null;)x.key!==null?w.set(x.key,x):w.set(x.index,x),x=x.sibling;return w}function n(w,x){return w=Mb(w,x),w.index=0,w.sibling=null,w}function s(w,x,T){return w.index=T,t?(T=w.alternate,T!==null?(T=T.index,T<x?(w.flags|=2,x):T):(w.flags|=2,x)):(w.flags|=1048576,x)}function o(w){return t&&w.alternate===null&&(w.flags|=2),w}function a(w,x,T,E){return x===null||x.tag!==6?(x=_j(T,w.mode,E),x.return=w,x):(x=n(x,T),x.return=w,x)}function l(w,x,T,E){var C=T.type;return C===$A?h(w,x,T.props.children,E,T.key):x!==null&&(x.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===O1&&Mue(C)===x.type)?(E=n(x,T.props),E.ref=K3(w,x,T),E.return=w,E):(E=Jk(T.type,T.key,T.props,null,w.mode,E),E.ref=K3(w,x,T),E.return=w,E)}function c(w,x,T,E){return x===null||x.tag!==4||x.stateNode.containerInfo!==T.containerInfo||x.stateNode.implementation!==T.implementation?(x=vj(T,w.mode,E),x.return=w,x):(x=n(x,T.children||[]),x.return=w,x)}function h(w,x,T,E,C){return x===null||x.tag!==7?(x=ES(T,w.mode,E,C),x.return=w,x):(x=n(x,T),x.return=w,x)}function p(w,x,T){if(typeof x=="string"&&x!==""||typeof x=="number")return x=_j(""+x,w.mode,T),x.return=w,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case cF:return T=Jk(x.type,x.key,x.props,null,w.mode,T),T.ref=K3(w,null,x),T.return=w,T;case IA:return x=vj(x,w.mode,T),x.return=w,x;case O1:var E=x._init;return p(w,E(x._payload),T)}if(mP(x)||W3(x))return x=ES(x,w.mode,T,null),x.return=w,x;bF(w,x)}return null}function f(w,x,T,E){var C=x!==null?x.key:null;if(typeof T=="string"&&T!==""||typeof T=="number")return C!==null?null:a(w,x,""+T,E);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case cF:return T.key===C?l(w,x,T,E):null;case IA:return T.key===C?c(w,x,T,E):null;case O1:return C=T._init,f(w,x,C(T._payload),E)}if(mP(T)||W3(T))return C!==null?null:h(w,x,T,E,null);bF(w,T)}return null}function m(w,x,T,E,C){if(typeof E=="string"&&E!==""||typeof E=="number")return w=w.get(T)||null,a(x,w,""+E,C);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case cF:return w=w.get(E.key===null?T:E.key)||null,l(x,w,E,C);case IA:return w=w.get(E.key===null?T:E.key)||null,c(x,w,E,C);case O1:var A=E._init;return m(w,x,T,A(E._payload),C)}if(mP(E)||W3(E))return w=w.get(T)||null,h(x,w,E,C,null);bF(x,E)}return null}function g(w,x,T,E){for(var C=null,A=null,I=x,M=x=0,D=null;I!==null&&M<T.length;M++){I.index>M?(D=I,I=null):D=I.sibling;var U=f(w,I,T[M],E);if(U===null){I===null&&(I=D);break}t&&I&&U.alternate===null&&e(w,I),x=s(U,x,M),A===null?C=U:A.sibling=U,A=U,I=D}if(M===T.length)return r(w,I),vs&&Px(w,M),C;if(I===null){for(;M<T.length;M++)I=p(w,T[M],E),I!==null&&(x=s(I,x,M),A===null?C=I:A.sibling=I,A=I);return vs&&Px(w,M),C}for(I=i(w,I);M<T.length;M++)D=m(I,w,M,T[M],E),D!==null&&(t&&D.alternate!==null&&I.delete(D.key===null?M:D.key),x=s(D,x,M),A===null?C=D:A.sibling=D,A=D);return t&&I.forEach(function(z){return e(w,z)}),vs&&Px(w,M),C}function _(w,x,T,E){var C=W3(T);if(typeof C!="function")throw Error(je(150));if(T=C.call(T),T==null)throw Error(je(151));for(var A=C=null,I=x,M=x=0,D=null,U=T.next();I!==null&&!U.done;M++,U=T.next()){I.index>M?(D=I,I=null):D=I.sibling;var z=f(w,I,U.value,E);if(z===null){I===null&&(I=D);break}t&&I&&z.alternate===null&&e(w,I),x=s(z,x,M),A===null?C=z:A.sibling=z,A=z,I=D}if(U.done)return r(w,I),vs&&Px(w,M),C;if(I===null){for(;!U.done;M++,U=T.next())U=p(w,U.value,E),U!==null&&(x=s(U,x,M),A===null?C=U:A.sibling=U,A=U);return vs&&Px(w,M),C}for(I=i(w,I);!U.done;M++,U=T.next())U=m(I,w,M,U.value,E),U!==null&&(t&&U.alternate!==null&&I.delete(U.key===null?M:U.key),x=s(U,x,M),A===null?C=U:A.sibling=U,A=U);return t&&I.forEach(function(B){return e(w,B)}),vs&&Px(w,M),C}function b(w,x,T,E){if(typeof T=="object"&&T!==null&&T.type===$A&&T.key===null&&(T=T.props.children),typeof T=="object"&&T!==null){switch(T.$$typeof){case cF:e:{for(var C=T.key,A=x;A!==null;){if(A.key===C){if(C=T.type,C===$A){if(A.tag===7){r(w,A.sibling),x=n(A,T.props.children),x.return=w,w=x;break e}}else if(A.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===O1&&Mue(C)===A.type){r(w,A.sibling),x=n(A,T.props),x.ref=K3(w,A,T),x.return=w,w=x;break e}r(w,A);break}else e(w,A);A=A.sibling}T.type===$A?(x=ES(T.props.children,w.mode,E,T.key),x.return=w,w=x):(E=Jk(T.type,T.key,T.props,null,w.mode,E),E.ref=K3(w,x,T),E.return=w,w=E)}return o(w);case IA:e:{for(A=T.key;x!==null;){if(x.key===A)if(x.tag===4&&x.stateNode.containerInfo===T.containerInfo&&x.stateNode.implementation===T.implementation){r(w,x.sibling),x=n(x,T.children||[]),x.return=w,w=x;break e}else{r(w,x);break}else e(w,x);x=x.sibling}x=vj(T,w.mode,E),x.return=w,w=x}return o(w);case O1:return A=T._init,b(w,x,A(T._payload),E)}if(mP(T))return g(w,x,T,E);if(W3(T))return _(w,x,T,E);bF(w,T)}return typeof T=="string"&&T!==""||typeof T=="number"?(T=""+T,x!==null&&x.tag===6?(r(w,x.sibling),x=n(x,T),x.return=w,w=x):(r(w,x),x=_j(T,w.mode,E),x.return=w,w=x),o(w)):r(w,x)}return b}var tO=yTe(!0),_Te=yTe(!1),eN={},Bg=Tw(eN),TL=Tw(eN),SL=Tw(eN);function lS(t){if(t===eN)throw Error(je(174));return t}function aie(t,e){switch(qn(SL,e),qn(TL,t),qn(Bg,eN),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:cX(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=cX(e,t)}ds(Bg),qn(Bg,e)}function rO(){ds(Bg),ds(TL),ds(SL)}function vTe(t){lS(SL.current);var e=lS(Bg.current),r=cX(e,t.type);e!==r&&(qn(TL,t),qn(Bg,r))}function lie(t){TL.current===t&&(ds(Bg),ds(TL))}var Es=Tw(0);function x8(t){for(var e=t;e!==null;){if(e.tag===13){var r=e.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var dj=[];function cie(){for(var t=0;t<dj.length;t++)dj[t]._workInProgressVersionPrimary=null;dj.length=0}var qk=I_.ReactCurrentDispatcher,pj=I_.ReactCurrentBatchConfig,HS=0,Cs=null,sa=null,Pa=null,T8=!1,c$=!1,EL=0,a9e=0;function bl(){throw Error(je(321))}function uie(t,e){if(e===null)return!1;for(var r=0;r<e.length&&r<t.length;r++)if(!sm(t[r],e[r]))return!1;return!0}function hie(t,e,r,i,n,s){if(HS=s,Cs=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,qk.current=t===null||t.memoizedState===null?h9e:d9e,t=r(i,n),c$){s=0;do{if(c$=!1,EL=0,25<=s)throw Error(je(301));s+=1,Pa=sa=null,e.updateQueue=null,qk.current=p9e,t=r(i,n)}while(c$)}if(qk.current=S8,e=sa!==null&&sa.next!==null,HS=0,Pa=sa=Cs=null,T8=!1,e)throw Error(je(300));return t}function die(){var t=EL!==0;return EL=0,t}function vg(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Pa===null?Cs.memoizedState=Pa=t:Pa=Pa.next=t,Pa}function xp(){if(sa===null){var t=Cs.alternate;t=t!==null?t.memoizedState:null}else t=sa.next;var e=Pa===null?Cs.memoizedState:Pa.next;if(e!==null)Pa=e,sa=t;else{if(t===null)throw Error(je(310));sa=t,t={memoizedState:sa.memoizedState,baseState:sa.baseState,baseQueue:sa.baseQueue,queue:sa.queue,next:null},Pa===null?Cs.memoizedState=Pa=t:Pa=Pa.next=t}return Pa}function CL(t,e){return typeof e=="function"?e(t):e}function fj(t){var e=xp(),r=e.queue;if(r===null)throw Error(je(311));r.lastRenderedReducer=t;var i=sa,n=i.baseQueue,s=r.pending;if(s!==null){if(n!==null){var o=n.next;n.next=s.next,s.next=o}i.baseQueue=n=s,r.pending=null}if(n!==null){s=n.next,i=i.baseState;var a=o=null,l=null,c=s;do{var h=c.lane;if((HS&h)===h)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),i=c.hasEagerState?c.eagerState:t(i,c.action);else{var p={lane:h,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=p,o=i):l=l.next=p,Cs.lanes|=h,qS|=h}c=c.next}while(c!==null&&c!==s);l===null?o=i:l.next=a,sm(i,e.memoizedState)||(Lu=!0),e.memoizedState=i,e.baseState=o,e.baseQueue=l,r.lastRenderedState=i}if(t=r.interleaved,t!==null){n=t;do s=n.lane,Cs.lanes|=s,qS|=s,n=n.next;while(n!==t)}else n===null&&(r.lanes=0);return[e.memoizedState,r.dispatch]}function mj(t){var e=xp(),r=e.queue;if(r===null)throw Error(je(311));r.lastRenderedReducer=t;var i=r.dispatch,n=r.pending,s=e.memoizedState;if(n!==null){r.pending=null;var o=n=n.next;do s=t(s,o.action),o=o.next;while(o!==n);sm(s,e.memoizedState)||(Lu=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),r.lastRenderedState=s}return[s,i]}function bTe(){}function wTe(t,e){var r=Cs,i=xp(),n=e(),s=!sm(i.memoizedState,n);if(s&&(i.memoizedState=n,Lu=!0),i=i.queue,pie(STe.bind(null,r,i,t),[t]),i.getSnapshot!==e||s||Pa!==null&&Pa.memoizedState.tag&1){if(r.flags|=2048,AL(9,TTe.bind(null,r,i,n,e),void 0,null),ka===null)throw Error(je(349));HS&30||xTe(r,e,n)}return n}function xTe(t,e,r){t.flags|=16384,t={getSnapshot:e,value:r},e=Cs.updateQueue,e===null?(e={lastEffect:null,stores:null},Cs.updateQueue=e,e.stores=[t]):(r=e.stores,r===null?e.stores=[t]:r.push(t))}function TTe(t,e,r,i){e.value=r,e.getSnapshot=i,ETe(e)&&CTe(t)}function STe(t,e,r){return r(function(){ETe(e)&&CTe(t)})}function ETe(t){var e=t.getSnapshot;t=t.value;try{var r=e();return!sm(t,r)}catch{return!0}}function CTe(t){var e=f_(t,1);e!==null&&Kf(e,t,1,-1)}function Pue(t){var e=vg();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:CL,lastRenderedState:t},e.queue=t,t=t.dispatch=u9e.bind(null,Cs,t),[e.memoizedState,t]}function AL(t,e,r,i){return t={tag:t,create:e,destroy:r,deps:i,next:null},e=Cs.updateQueue,e===null?(e={lastEffect:null,stores:null},Cs.updateQueue=e,e.lastEffect=t.next=t):(r=e.lastEffect,r===null?e.lastEffect=t.next=t:(i=r.next,r.next=t,t.next=i,e.lastEffect=t)),t}function ATe(){return xp().memoizedState}function Wk(t,e,r,i){var n=vg();Cs.flags|=t,n.memoizedState=AL(1|e,r,void 0,i===void 0?null:i)}function u9(t,e,r,i){var n=xp();i=i===void 0?null:i;var s=void 0;if(sa!==null){var o=sa.memoizedState;if(s=o.destroy,i!==null&&uie(i,o.deps)){n.memoizedState=AL(e,r,s,i);return}}Cs.flags|=t,n.memoizedState=AL(1|e,r,s,i)}function Iue(t,e){return Wk(8390656,8,t,e)}function pie(t,e){return u9(2048,8,t,e)}function RTe(t,e){return u9(4,2,t,e)}function OTe(t,e){return u9(4,4,t,e)}function MTe(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function PTe(t,e,r){return r=r!=null?r.concat([t]):null,u9(4,4,MTe.bind(null,e,t),r)}function fie(){}function ITe(t,e){var r=xp();e=e===void 0?null:e;var i=r.memoizedState;return i!==null&&e!==null&&uie(e,i[1])?i[0]:(r.memoizedState=[t,e],t)}function $Te(t,e){var r=xp();e=e===void 0?null:e;var i=r.memoizedState;return i!==null&&e!==null&&uie(e,i[1])?i[0]:(t=t(),r.memoizedState=[t,e],t)}function LTe(t,e,r){return HS&21?(sm(r,e)||(r=Fxe(),Cs.lanes|=r,qS|=r,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Lu=!0),t.memoizedState=r)}function l9e(t,e){var r=fn;fn=r!==0&&4>r?r:4,t(!0);var i=pj.transition;pj.transition={};try{t(!1),e()}finally{fn=r,pj.transition=i}}function DTe(){return xp().memoizedState}function c9e(t,e,r){var i=Ob(t);if(r={lane:i,action:r,hasEagerState:!1,eagerState:null,next:null},NTe(t))FTe(e,r);else if(r=pTe(t,e,r,i),r!==null){var n=Vc();Kf(r,t,i,n),kTe(r,e,i)}}function u9e(t,e,r){var i=Ob(t),n={lane:i,action:r,hasEagerState:!1,eagerState:null,next:null};if(NTe(t))FTe(e,n);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,r);if(n.hasEagerState=!0,n.eagerState=a,sm(a,o)){var l=e.interleaved;l===null?(n.next=n,sie(e)):(n.next=l.next,l.next=n),e.interleaved=n;return}}catch{}finally{}r=pTe(t,e,n,i),r!==null&&(n=Vc(),Kf(r,t,i,n),kTe(r,e,i))}}function NTe(t){var e=t.alternate;return t===Cs||e!==null&&e===Cs}function FTe(t,e){c$=T8=!0;var r=t.pending;r===null?e.next=e:(e.next=r.next,r.next=e),t.pending=e}function kTe(t,e,r){if(r&4194240){var i=e.lanes;i&=t.pendingLanes,r|=i,e.lanes=r,Hre(t,r)}}var S8={readContext:wp,useCallback:bl,useContext:bl,useEffect:bl,useImperativeHandle:bl,useInsertionEffect:bl,useLayoutEffect:bl,useMemo:bl,useReducer:bl,useRef:bl,useState:bl,useDebugValue:bl,useDeferredValue:bl,useTransition:bl,useMutableSource:bl,useSyncExternalStore:bl,useId:bl,unstable_isNewReconciler:!1},h9e={readContext:wp,useCallback:function(t,e){return vg().memoizedState=[t,e===void 0?null:e],t},useContext:wp,useEffect:Iue,useImperativeHandle:function(t,e,r){return r=r!=null?r.concat([t]):null,Wk(4194308,4,MTe.bind(null,e,t),r)},useLayoutEffect:function(t,e){return Wk(4194308,4,t,e)},useInsertionEffect:function(t,e){return Wk(4,2,t,e)},useMemo:function(t,e){var r=vg();return e=e===void 0?null:e,t=t(),r.memoizedState=[t,e],t},useReducer:function(t,e,r){var i=vg();return e=r!==void 0?r(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=c9e.bind(null,Cs,t),[i.memoizedState,t]},useRef:function(t){var e=vg();return t={current:t},e.memoizedState=t},useState:Pue,useDebugValue:fie,useDeferredValue:function(t){return vg().memoizedState=t},useTransition:function(){var t=Pue(!1),e=t[0];return t=l9e.bind(null,t[1]),vg().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,r){var i=Cs,n=vg();if(vs){if(r===void 0)throw Error(je(407));r=r()}else{if(r=e(),ka===null)throw Error(je(349));HS&30||xTe(i,e,r)}n.memoizedState=r;var s={value:r,getSnapshot:e};return n.queue=s,Iue(STe.bind(null,i,s,t),[t]),i.flags|=2048,AL(9,TTe.bind(null,i,s,r,e),void 0,null),r},useId:function(){var t=vg(),e=ka.identifierPrefix;if(vs){var r=V0,i=z0;r=(i&~(1<<32-Jf(i)-1)).toString(32)+r,e=":"+e+"R"+r,r=EL++,0<r&&(e+="H"+r.toString(32)),e+=":"}else r=a9e++,e=":"+e+"r"+r.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},d9e={readContext:wp,useCallback:ITe,useContext:wp,useEffect:pie,useImperativeHandle:PTe,useInsertionEffect:RTe,useLayoutEffect:OTe,useMemo:$Te,useReducer:fj,useRef:ATe,useState:function(){return fj(CL)},useDebugValue:fie,useDeferredValue:function(t){var e=xp();return LTe(e,sa.memoizedState,t)},useTransition:function(){var t=fj(CL)[0],e=xp().memoizedState;return[t,e]},useMutableSource:bTe,useSyncExternalStore:wTe,useId:DTe,unstable_isNewReconciler:!1},p9e={readContext:wp,useCallback:ITe,useContext:wp,useEffect:pie,useImperativeHandle:PTe,useInsertionEffect:RTe,useLayoutEffect:OTe,useMemo:$Te,useReducer:mj,useRef:ATe,useState:function(){return mj(CL)},useDebugValue:fie,useDeferredValue:function(t){var e=xp();return sa===null?e.memoizedState=t:LTe(e,sa.memoizedState,t)},useTransition:function(){var t=mj(CL)[0],e=xp().memoizedState;return[t,e]},useMutableSource:bTe,useSyncExternalStore:wTe,useId:DTe,unstable_isNewReconciler:!1};function iO(t,e){try{var r="",i=e;do r+=Vze(i),i=i.return;while(i);var n=r}catch(s){n=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:n,digest:null}}function gj(t,e,r){return{value:t,source:null,stack:r??null,digest:e??null}}function IX(t,e){try{console.error(e.value)}catch(r){setTimeout(function(){throw r})}}var f9e=typeof WeakMap=="function"?WeakMap:Map;function UTe(t,e,r){r=J0(-1,r),r.tag=3,r.payload={element:null};var i=e.value;return r.callback=function(){C8||(C8=!0,BX=i),IX(t,e)},r}function zTe(t,e,r){r=J0(-1,r),r.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var n=e.value;r.payload=function(){return i(n)},r.callback=function(){IX(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(r.callback=function(){IX(t,e),typeof i!="function"&&(Rb===null?Rb=new Set([this]):Rb.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),r}function $ue(t,e,r){var i=t.pingCache;if(i===null){i=t.pingCache=new f9e;var n=new Set;i.set(e,n)}else n=i.get(e),n===void 0&&(n=new Set,i.set(e,n));n.has(r)||(n.add(r),t=R9e.bind(null,t,e,r),e.then(t,t))}function Lue(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Due(t,e,r,i,n){return t.mode&1?(t.flags|=65536,t.lanes=n,t):(t===e?t.flags|=65536:(t.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(e=J0(-1,1),e.tag=2,Ab(r,e,1))),r.lanes|=1),t)}var m9e=I_.ReactCurrentOwner,Lu=!1;function Mc(t,e,r,i){e.child=t===null?_Te(e,null,r,i):tO(e,t.child,r,i)}function Nue(t,e,r,i,n){r=r.render;var s=e.ref;return yR(e,n),i=hie(t,e,r,i,s,n),r=die(),t!==null&&!Lu?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~n,m_(t,e,n)):(vs&&r&&Qre(e),e.flags|=1,Mc(t,e,i,n),e.child)}function Fue(t,e,r,i,n){if(t===null){var s=r.type;return typeof s=="function"&&!xie(s)&&s.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(e.tag=15,e.type=s,VTe(t,e,s,i,n)):(t=Jk(r.type,null,i,e,e.mode,n),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&n)){var o=s.memoizedProps;if(r=r.compare,r=r!==null?r:vL,r(o,i)&&t.ref===e.ref)return m_(t,e,n)}return e.flags|=1,t=Mb(s,i),t.ref=e.ref,t.return=e,e.child=t}function VTe(t,e,r,i,n){if(t!==null){var s=t.memoizedProps;if(vL(s,i)&&t.ref===e.ref)if(Lu=!1,e.pendingProps=i=s,(t.lanes&n)!==0)t.flags&131072&&(Lu=!0);else return e.lanes=t.lanes,m_(t,e,n)}return $X(t,e,r,i,n)}function BTe(t,e,r){var i=e.pendingProps,n=i.children,s=t!==null?t.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},qn(jA,Oh),Oh|=r;else{if(!(r&1073741824))return t=s!==null?s.baseLanes|r:r,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,qn(jA,Oh),Oh|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:r,qn(jA,Oh),Oh|=i}else s!==null?(i=s.baseLanes|r,e.memoizedState=null):i=r,qn(jA,Oh),Oh|=i;return Mc(t,e,n,r),e.child}function jTe(t,e){var r=e.ref;(t===null&&r!==null||t!==null&&t.ref!==r)&&(e.flags|=512,e.flags|=2097152)}function $X(t,e,r,i,n){var s=Uu(r)?jS:Yl.current;return s=QR(e,s),yR(e,n),r=hie(t,e,r,i,s,n),i=die(),t!==null&&!Lu?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~n,m_(t,e,n)):(vs&&i&&Qre(e),e.flags|=1,Mc(t,e,r,n),e.child)}function kue(t,e,r,i,n){if(Uu(r)){var s=!0;g8(e)}else s=!1;if(yR(e,n),e.stateNode===null)Xk(t,e),gTe(e,r,i),PX(e,r,i,n),i=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=r.contextType;typeof c=="object"&&c!==null?c=wp(c):(c=Uu(r)?jS:Yl.current,c=QR(e,c));var h=r.getDerivedStateFromProps,p=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function";p||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==i||l!==c)&&Oue(e,o,i,c),M1=!1;var f=e.memoizedState;o.state=f,w8(e,i,o,n),l=e.memoizedState,a!==i||f!==l||ku.current||M1?(typeof h=="function"&&(MX(e,r,h,i),l=e.memoizedState),(a=M1||Rue(e,r,a,i,f,l,c))?(p||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=l),o.props=i,o.state=l,o.context=c,i=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,fTe(t,e),a=e.memoizedProps,c=e.type===e.elementType?a:Af(e.type,a),o.props=c,p=e.pendingProps,f=o.context,l=r.contextType,typeof l=="object"&&l!==null?l=wp(l):(l=Uu(r)?jS:Yl.current,l=QR(e,l));var m=r.getDerivedStateFromProps;(h=typeof m=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==p||f!==l)&&Oue(e,o,i,l),M1=!1,f=e.memoizedState,o.state=f,w8(e,i,o,n);var g=e.memoizedState;a!==p||f!==g||ku.current||M1?(typeof m=="function"&&(MX(e,r,m,i),g=e.memoizedState),(c=M1||Rue(e,r,c,i,f,g,l)||!1)?(h||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,g,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,g,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=g),o.props=i,o.state=g,o.context=l,i=c):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),i=!1)}return LX(t,e,r,i,s,n)}function LX(t,e,r,i,n,s){jTe(t,e);var o=(e.flags&128)!==0;if(!i&&!o)return n&&Tue(e,r,!1),m_(t,e,s);i=e.stateNode,m9e.current=e;var a=o&&typeof r.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&o?(e.child=tO(e,t.child,null,s),e.child=tO(e,null,a,s)):Mc(t,e,a,s),e.memoizedState=i.state,n&&Tue(e,r,!0),e.child}function GTe(t){var e=t.stateNode;e.pendingContext?xue(t,e.pendingContext,e.pendingContext!==e.context):e.context&&xue(t,e.context,!1),aie(t,e.containerInfo)}function Uue(t,e,r,i,n){return eO(),tie(n),e.flags|=256,Mc(t,e,r,i),e.child}var DX={dehydrated:null,treeContext:null,retryLane:0};function NX(t){return{baseLanes:t,cachePool:null,transitions:null}}function HTe(t,e,r){var i=e.pendingProps,n=Es.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(n&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(n|=1),qn(Es,n&1),t===null)return RX(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=i.children,t=i.fallback,s?(i=e.mode,s=e.child,o={mode:"hidden",children:o},!(i&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=p9(o,i,0,null),t=ES(t,i,r,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=NX(r),e.memoizedState=DX,t):mie(e,o));if(n=t.memoizedState,n!==null&&(a=n.dehydrated,a!==null))return g9e(t,e,o,i,a,n,r);if(s){s=i.fallback,o=e.mode,n=t.child,a=n.sibling;var l={mode:"hidden",children:i.children};return!(o&1)&&e.child!==n?(i=e.child,i.childLanes=0,i.pendingProps=l,e.deletions=null):(i=Mb(n,l),i.subtreeFlags=n.subtreeFlags&14680064),a!==null?s=Mb(a,s):(s=ES(s,o,r,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,o=t.child.memoizedState,o=o===null?NX(r):{baseLanes:o.baseLanes|r,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~r,e.memoizedState=DX,i}return s=t.child,t=s.sibling,i=Mb(s,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=r),i.return=e,i.sibling=null,t!==null&&(r=e.deletions,r===null?(e.deletions=[t],e.flags|=16):r.push(t)),e.child=i,e.memoizedState=null,i}function mie(t,e){return e=p9({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function wF(t,e,r,i){return i!==null&&tie(i),tO(e,t.child,null,r),t=mie(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function g9e(t,e,r,i,n,s,o){if(r)return e.flags&256?(e.flags&=-257,i=gj(Error(je(422))),wF(t,e,o,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=i.fallback,n=e.mode,i=p9({mode:"visible",children:i.children},n,0,null),s=ES(s,n,o,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,e.mode&1&&tO(e,t.child,null,o),e.child.memoizedState=NX(o),e.memoizedState=DX,s);if(!(e.mode&1))return wF(t,e,o,null);if(n.data==="$!"){if(i=n.nextSibling&&n.nextSibling.dataset,i)var a=i.dgst;return i=a,s=Error(je(419)),i=gj(s,i,void 0),wF(t,e,o,i)}if(a=(o&t.childLanes)!==0,Lu||a){if(i=ka,i!==null){switch(o&-o){case 4:n=2;break;case 16:n=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:n=32;break;case 536870912:n=268435456;break;default:n=0}n=n&(i.suspendedLanes|o)?0:n,n!==0&&n!==s.retryLane&&(s.retryLane=n,f_(t,n),Kf(i,t,n,-1))}return wie(),i=gj(Error(je(421))),wF(t,e,o,i)}return n.data==="$?"?(e.flags|=128,e.child=t.child,e=O9e.bind(null,t),n._reactRetry=e,null):(t=s.treeContext,Hh=Cb(n.nextSibling),Xh=e,vs=!0,Df=null,t!==null&&(Yd[Zd++]=z0,Yd[Zd++]=V0,Yd[Zd++]=GS,z0=t.id,V0=t.overflow,GS=e),e=mie(e,i.children),e.flags|=4096,e)}function zue(t,e,r){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),OX(t.return,e,r)}function yj(t,e,r,i,n){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:r,tailMode:n}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=r,s.tailMode=n)}function qTe(t,e,r){var i=e.pendingProps,n=i.revealOrder,s=i.tail;if(Mc(t,e,i.children,r),i=Es.current,i&2)i=i&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&zue(t,r,e);else if(t.tag===19)zue(t,r,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(qn(Es,i),!(e.mode&1))e.memoizedState=null;else switch(n){case"forwards":for(r=e.child,n=null;r!==null;)t=r.alternate,t!==null&&x8(t)===null&&(n=r),r=r.sibling;r=n,r===null?(n=e.child,e.child=null):(n=r.sibling,r.sibling=null),yj(e,!1,n,r,s);break;case"backwards":for(r=null,n=e.child,e.child=null;n!==null;){if(t=n.alternate,t!==null&&x8(t)===null){e.child=n;break}t=n.sibling,n.sibling=r,r=n,n=t}yj(e,!0,r,null,s);break;case"together":yj(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Xk(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function m_(t,e,r){if(t!==null&&(e.dependencies=t.dependencies),qS|=e.lanes,!(r&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(je(153));if(e.child!==null){for(t=e.child,r=Mb(t,t.pendingProps),e.child=r,r.return=e;t.sibling!==null;)t=t.sibling,r=r.sibling=Mb(t,t.pendingProps),r.return=e;r.sibling=null}return e.child}function y9e(t,e,r){switch(e.tag){case 3:GTe(e),eO();break;case 5:vTe(e);break;case 1:Uu(e.type)&&g8(e);break;case 4:aie(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,n=e.memoizedProps.value;qn(v8,i._currentValue),i._currentValue=n;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(qn(Es,Es.current&1),e.flags|=128,null):r&e.child.childLanes?HTe(t,e,r):(qn(Es,Es.current&1),t=m_(t,e,r),t!==null?t.sibling:null);qn(Es,Es.current&1);break;case 19:if(i=(r&e.childLanes)!==0,t.flags&128){if(i)return qTe(t,e,r);e.flags|=128}if(n=e.memoizedState,n!==null&&(n.rendering=null,n.tail=null,n.lastEffect=null),qn(Es,Es.current),i)break;return null;case 22:case 23:return e.lanes=0,BTe(t,e,r)}return m_(t,e,r)}var WTe,FX,XTe,YTe;WTe=function(t,e){for(var r=e.child;r!==null;){if(r.tag===5||r.tag===6)t.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};FX=function(){};XTe=function(t,e,r,i){var n=t.memoizedProps;if(n!==i){t=e.stateNode,lS(Bg.current);var s=null;switch(r){case"input":n=sX(t,n),i=sX(t,i),s=[];break;case"select":n=Rs({},n,{value:void 0}),i=Rs({},i,{value:void 0}),s=[];break;case"textarea":n=lX(t,n),i=lX(t,i),s=[];break;default:typeof n.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=f8)}uX(r,i);var o;r=null;for(c in n)if(!i.hasOwnProperty(c)&&n.hasOwnProperty(c)&&n[c]!=null)if(c==="style"){var a=n[c];for(o in a)a.hasOwnProperty(o)&&(r||(r={}),r[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(dL.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in i){var l=i[c];if(a=n!=null?n[c]:void 0,i.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(r||(r={}),r[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(r||(r={}),r[o]=l[o])}else r||(s||(s=[]),s.push(c,r)),r=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(dL.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&es("scroll",t),s||a===l||(s=[])):(s=s||[]).push(c,l))}r&&(s=s||[]).push("style",r);var c=s;(e.updateQueue=c)&&(e.flags|=4)}};YTe=function(t,e,r,i){r!==i&&(e.flags|=4)};function Q3(t,e){if(!vs)switch(t.tailMode){case"hidden":e=t.tail;for(var r=null;e!==null;)e.alternate!==null&&(r=e),e=e.sibling;r===null?t.tail=null:r.sibling=null;break;case"collapsed":r=t.tail;for(var i=null;r!==null;)r.alternate!==null&&(i=r),r=r.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function wl(t){var e=t.alternate!==null&&t.alternate.child===t.child,r=0,i=0;if(e)for(var n=t.child;n!==null;)r|=n.lanes|n.childLanes,i|=n.subtreeFlags&14680064,i|=n.flags&14680064,n.return=t,n=n.sibling;else for(n=t.child;n!==null;)r|=n.lanes|n.childLanes,i|=n.subtreeFlags,i|=n.flags,n.return=t,n=n.sibling;return t.subtreeFlags|=i,t.childLanes=r,e}function _9e(t,e,r){var i=e.pendingProps;switch(eie(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return wl(e),null;case 1:return Uu(e.type)&&m8(),wl(e),null;case 3:return i=e.stateNode,rO(),ds(ku),ds(Yl),cie(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(vF(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Df!==null&&(HX(Df),Df=null))),FX(t,e),wl(e),null;case 5:lie(e);var n=lS(SL.current);if(r=e.type,t!==null&&e.stateNode!=null)XTe(t,e,r,i,n),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(je(166));return wl(e),null}if(t=lS(Bg.current),vF(e)){i=e.stateNode,r=e.type;var s=e.memoizedProps;switch(i[Rg]=e,i[xL]=s,t=(e.mode&1)!==0,r){case"dialog":es("cancel",i),es("close",i);break;case"iframe":case"object":case"embed":es("load",i);break;case"video":case"audio":for(n=0;n<yP.length;n++)es(yP[n],i);break;case"source":es("error",i);break;case"img":case"image":case"link":es("error",i),es("load",i);break;case"details":es("toggle",i);break;case"input":Yce(i,s),es("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},es("invalid",i);break;case"textarea":Jce(i,s),es("invalid",i)}uX(r,s),n=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?i.textContent!==a&&(s.suppressHydrationWarning!==!0&&_F(i.textContent,a,t),n=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&_F(i.textContent,a,t),n=["children",""+a]):dL.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&es("scroll",i)}switch(r){case"input":uF(i),Zce(i,s,!0);break;case"textarea":uF(i),Kce(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=f8)}i=n,e.updateQueue=i,i!==null&&(e.flags|=4)}else{o=n.nodeType===9?n:n.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=xxe(r)),t==="http://www.w3.org/1999/xhtml"?r==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=o.createElement(r,{is:i.is}):(t=o.createElement(r),r==="select"&&(o=t,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):t=o.createElementNS(t,r),t[Rg]=e,t[xL]=i,WTe(t,e,!1,!1),e.stateNode=t;e:{switch(o=hX(r,i),r){case"dialog":es("cancel",t),es("close",t),n=i;break;case"iframe":case"object":case"embed":es("load",t),n=i;break;case"video":case"audio":for(n=0;n<yP.length;n++)es(yP[n],t);n=i;break;case"source":es("error",t),n=i;break;case"img":case"image":case"link":es("error",t),es("load",t),n=i;break;case"details":es("toggle",t),n=i;break;case"input":Yce(t,i),n=sX(t,i),es("invalid",t);break;case"option":n=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},n=Rs({},i,{value:void 0}),es("invalid",t);break;case"textarea":Jce(t,i),n=lX(t,i),es("invalid",t);break;default:n=i}uX(r,n),a=n;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?Exe(t,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&Txe(t,l)):s==="children"?typeof l=="string"?(r!=="textarea"||l!=="")&&pL(t,l):typeof l=="number"&&pL(t,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(dL.hasOwnProperty(s)?l!=null&&s==="onScroll"&&es("scroll",t):l!=null&&Ure(t,s,l,o))}switch(r){case"input":uF(t),Zce(t,i,!1);break;case"textarea":uF(t),Kce(t);break;case"option":i.value!=null&&t.setAttribute("value",""+Gb(i.value));break;case"select":t.multiple=!!i.multiple,s=i.value,s!=null?pR(t,!!i.multiple,s,!1):i.defaultValue!=null&&pR(t,!!i.multiple,i.defaultValue,!0);break;default:typeof n.onClick=="function"&&(t.onclick=f8)}switch(r){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return wl(e),null;case 6:if(t&&e.stateNode!=null)YTe(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(je(166));if(r=lS(SL.current),lS(Bg.current),vF(e)){if(i=e.stateNode,r=e.memoizedProps,i[Rg]=e,(s=i.nodeValue!==r)&&(t=Xh,t!==null))switch(t.tag){case 3:_F(i.nodeValue,r,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&_F(i.nodeValue,r,(t.mode&1)!==0)}s&&(e.flags|=4)}else i=(r.nodeType===9?r:r.ownerDocument).createTextNode(i),i[Rg]=e,e.stateNode=i}return wl(e),null;case 13:if(ds(Es),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(vs&&Hh!==null&&e.mode&1&&!(e.flags&128))dTe(),eO(),e.flags|=98560,s=!1;else if(s=vF(e),i!==null&&i.dehydrated!==null){if(t===null){if(!s)throw Error(je(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(je(317));s[Rg]=e}else eO(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;wl(e),s=!1}else Df!==null&&(HX(Df),Df=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=r,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(t===null||Es.current&1?ua===0&&(ua=3):wie())),e.updateQueue!==null&&(e.flags|=4),wl(e),null);case 4:return rO(),FX(t,e),t===null&&bL(e.stateNode.containerInfo),wl(e),null;case 10:return nie(e.type._context),wl(e),null;case 17:return Uu(e.type)&&m8(),wl(e),null;case 19:if(ds(Es),s=e.memoizedState,s===null)return wl(e),null;if(i=(e.flags&128)!==0,o=s.rendering,o===null)if(i)Q3(s,!1);else{if(ua!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=x8(t),o!==null){for(e.flags|=128,Q3(s,!1),i=o.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=r,r=e.child;r!==null;)s=r,t=i,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),r=r.sibling;return qn(Es,Es.current&1|2),e.child}t=t.sibling}s.tail!==null&&co()>nO&&(e.flags|=128,i=!0,Q3(s,!1),e.lanes=4194304)}else{if(!i)if(t=x8(o),t!==null){if(e.flags|=128,i=!0,r=t.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),Q3(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!vs)return wl(e),null}else 2*co()-s.renderingStartTime>nO&&r!==1073741824&&(e.flags|=128,i=!0,Q3(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(r=s.last,r!==null?r.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=co(),e.sibling=null,r=Es.current,qn(Es,i?r&1|2:r&1),e):(wl(e),null);case 22:case 23:return bie(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?Oh&1073741824&&(wl(e),e.subtreeFlags&6&&(e.flags|=8192)):wl(e),null;case 24:return null;case 25:return null}throw Error(je(156,e.tag))}function v9e(t,e){switch(eie(e),e.tag){case 1:return Uu(e.type)&&m8(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return rO(),ds(ku),ds(Yl),cie(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return lie(e),null;case 13:if(ds(Es),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(je(340));eO()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return ds(Es),null;case 4:return rO(),null;case 10:return nie(e.type._context),null;case 22:case 23:return bie(),null;case 24:return null;default:return null}}var xF=!1,zl=!1,b9e=typeof WeakSet=="function"?WeakSet:Set,xt=null;function BA(t,e){var r=t.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(i){Bs(t,e,i)}else r.current=null}function kX(t,e,r){try{r()}catch(i){Bs(t,e,i)}}var Vue=!1;function w9e(t,e){if(wX=h8,t=Qxe(),Kre(t)){if("selectionStart"in t)var r={start:t.selectionStart,end:t.selectionEnd};else e:{r=(r=t.ownerDocument)&&r.defaultView||window;var i=r.getSelection&&r.getSelection();if(i&&i.rangeCount!==0){r=i.anchorNode;var n=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{r.nodeType,s.nodeType}catch{r=null;break e}var o=0,a=-1,l=-1,c=0,h=0,p=t,f=null;t:for(;;){for(var m;p!==r||n!==0&&p.nodeType!==3||(a=o+n),p!==s||i!==0&&p.nodeType!==3||(l=o+i),p.nodeType===3&&(o+=p.nodeValue.length),(m=p.firstChild)!==null;)f=p,p=m;for(;;){if(p===t)break t;if(f===r&&++c===n&&(a=o),f===s&&++h===i&&(l=o),(m=p.nextSibling)!==null)break;p=f,f=p.parentNode}p=m}r=a===-1||l===-1?null:{start:a,end:l}}else r=null}r=r||{start:0,end:0}}else r=null;for(xX={focusedElem:t,selectionRange:r},h8=!1,xt=e;xt!==null;)if(e=xt,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,xt=t;else for(;xt!==null;){e=xt;try{var g=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var _=g.memoizedProps,b=g.memoizedState,w=e.stateNode,x=w.getSnapshotBeforeUpdate(e.elementType===e.type?_:Af(e.type,_),b);w.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var T=e.stateNode.containerInfo;T.nodeType===1?T.textContent="":T.nodeType===9&&T.documentElement&&T.removeChild(T.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(je(163))}}catch(E){Bs(e,e.return,E)}if(t=e.sibling,t!==null){t.return=e.return,xt=t;break}xt=e.return}return g=Vue,Vue=!1,g}function u$(t,e,r){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var n=i=i.next;do{if((n.tag&t)===t){var s=n.destroy;n.destroy=void 0,s!==void 0&&kX(e,r,s)}n=n.next}while(n!==i)}}function h9(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var r=e=e.next;do{if((r.tag&t)===t){var i=r.create;r.destroy=i()}r=r.next}while(r!==e)}}function UX(t){var e=t.ref;if(e!==null){var r=t.stateNode;switch(t.tag){case 5:t=r;break;default:t=r}typeof e=="function"?e(t):e.current=t}}function ZTe(t){var e=t.alternate;e!==null&&(t.alternate=null,ZTe(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Rg],delete e[xL],delete e[EX],delete e[i9e],delete e[n9e])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function JTe(t){return t.tag===5||t.tag===3||t.tag===4}function Bue(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||JTe(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function zX(t,e,r){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?r.nodeType===8?r.parentNode.insertBefore(t,e):r.insertBefore(t,e):(r.nodeType===8?(e=r.parentNode,e.insertBefore(t,r)):(e=r,e.appendChild(t)),r=r._reactRootContainer,r!=null||e.onclick!==null||(e.onclick=f8));else if(i!==4&&(t=t.child,t!==null))for(zX(t,e,r),t=t.sibling;t!==null;)zX(t,e,r),t=t.sibling}function VX(t,e,r){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?r.insertBefore(t,e):r.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(VX(t,e,r),t=t.sibling;t!==null;)VX(t,e,r),t=t.sibling}var Qa=null,Mf=!1;function rv(t,e,r){for(r=r.child;r!==null;)KTe(t,e,r),r=r.sibling}function KTe(t,e,r){if(Vg&&typeof Vg.onCommitFiberUnmount=="function")try{Vg.onCommitFiberUnmount(i9,r)}catch{}switch(r.tag){case 5:zl||BA(r,e);case 6:var i=Qa,n=Mf;Qa=null,rv(t,e,r),Qa=i,Mf=n,Qa!==null&&(Mf?(t=Qa,r=r.stateNode,t.nodeType===8?t.parentNode.removeChild(r):t.removeChild(r)):Qa.removeChild(r.stateNode));break;case 18:Qa!==null&&(Mf?(t=Qa,r=r.stateNode,t.nodeType===8?uj(t.parentNode,r):t.nodeType===1&&uj(t,r),yL(t)):uj(Qa,r.stateNode));break;case 4:i=Qa,n=Mf,Qa=r.stateNode.containerInfo,Mf=!0,rv(t,e,r),Qa=i,Mf=n;break;case 0:case 11:case 14:case 15:if(!zl&&(i=r.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){n=i=i.next;do{var s=n,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&kX(r,e,o),n=n.next}while(n!==i)}rv(t,e,r);break;case 1:if(!zl&&(BA(r,e),i=r.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=r.memoizedProps,i.state=r.memoizedState,i.componentWillUnmount()}catch(a){Bs(r,e,a)}rv(t,e,r);break;case 21:rv(t,e,r);break;case 22:r.mode&1?(zl=(i=zl)||r.memoizedState!==null,rv(t,e,r),zl=i):rv(t,e,r);break;default:rv(t,e,r)}}function jue(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var r=t.stateNode;r===null&&(r=t.stateNode=new b9e),e.forEach(function(i){var n=M9e.bind(null,t,i);r.has(i)||(r.add(i),i.then(n,n))})}}function zp(t,e){var r=e.deletions;if(r!==null)for(var i=0;i<r.length;i++){var n=r[i];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Qa=a.stateNode,Mf=!1;break e;case 3:Qa=a.stateNode.containerInfo,Mf=!0;break e;case 4:Qa=a.stateNode.containerInfo,Mf=!0;break e}a=a.return}if(Qa===null)throw Error(je(160));KTe(s,o,n),Qa=null,Mf=!1;var l=n.alternate;l!==null&&(l.return=null),n.return=null}catch(c){Bs(n,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)QTe(e,t),e=e.sibling}function QTe(t,e){var r=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(zp(e,t),Em(t),i&4){try{u$(3,t,t.return),h9(3,t)}catch(_){Bs(t,t.return,_)}try{u$(5,t,t.return)}catch(_){Bs(t,t.return,_)}}break;case 1:zp(e,t),Em(t),i&512&&r!==null&&BA(r,r.return);break;case 5:if(zp(e,t),Em(t),i&512&&r!==null&&BA(r,r.return),t.flags&32){var n=t.stateNode;try{pL(n,"")}catch(_){Bs(t,t.return,_)}}if(i&4&&(n=t.stateNode,n!=null)){var s=t.memoizedProps,o=r!==null?r.memoizedProps:s,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&bxe(n,s),hX(a,o);var c=hX(a,s);for(o=0;o<l.length;o+=2){var h=l[o],p=l[o+1];h==="style"?Exe(n,p):h==="dangerouslySetInnerHTML"?Txe(n,p):h==="children"?pL(n,p):Ure(n,h,p,c)}switch(a){case"input":oX(n,s);break;case"textarea":wxe(n,s);break;case"select":var f=n._wrapperState.wasMultiple;n._wrapperState.wasMultiple=!!s.multiple;var m=s.value;m!=null?pR(n,!!s.multiple,m,!1):f!==!!s.multiple&&(s.defaultValue!=null?pR(n,!!s.multiple,s.defaultValue,!0):pR(n,!!s.multiple,s.multiple?[]:"",!1))}n[xL]=s}catch(_){Bs(t,t.return,_)}}break;case 6:if(zp(e,t),Em(t),i&4){if(t.stateNode===null)throw Error(je(162));n=t.stateNode,s=t.memoizedProps;try{n.nodeValue=s}catch(_){Bs(t,t.return,_)}}break;case 3:if(zp(e,t),Em(t),i&4&&r!==null&&r.memoizedState.isDehydrated)try{yL(e.containerInfo)}catch(_){Bs(t,t.return,_)}break;case 4:zp(e,t),Em(t);break;case 13:zp(e,t),Em(t),n=t.child,n.flags&8192&&(s=n.memoizedState!==null,n.stateNode.isHidden=s,!s||n.alternate!==null&&n.alternate.memoizedState!==null||(_ie=co())),i&4&&jue(t);break;case 22:if(h=r!==null&&r.memoizedState!==null,t.mode&1?(zl=(c=zl)||h,zp(e,t),zl=c):zp(e,t),Em(t),i&8192){if(c=t.memoizedState!==null,(t.stateNode.isHidden=c)&&!h&&t.mode&1)for(xt=t,h=t.child;h!==null;){for(p=xt=h;xt!==null;){switch(f=xt,m=f.child,f.tag){case 0:case 11:case 14:case 15:u$(4,f,f.return);break;case 1:BA(f,f.return);var g=f.stateNode;if(typeof g.componentWillUnmount=="function"){i=f,r=f.return;try{e=i,g.props=e.memoizedProps,g.state=e.memoizedState,g.componentWillUnmount()}catch(_){Bs(i,r,_)}}break;case 5:BA(f,f.return);break;case 22:if(f.memoizedState!==null){Hue(p);continue}}m!==null?(m.return=f,xt=m):Hue(p)}h=h.sibling}e:for(h=null,p=t;;){if(p.tag===5){if(h===null){h=p;try{n=p.stateNode,c?(s=n.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=p.stateNode,l=p.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=Sxe("display",o))}catch(_){Bs(t,t.return,_)}}}else if(p.tag===6){if(h===null)try{p.stateNode.nodeValue=c?"":p.memoizedProps}catch(_){Bs(t,t.return,_)}}else if((p.tag!==22&&p.tag!==23||p.memoizedState===null||p===t)&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===t)break e;for(;p.sibling===null;){if(p.return===null||p.return===t)break e;h===p&&(h=null),p=p.return}h===p&&(h=null),p.sibling.return=p.return,p=p.sibling}}break;case 19:zp(e,t),Em(t),i&4&&jue(t);break;case 21:break;default:zp(e,t),Em(t)}}function Em(t){var e=t.flags;if(e&2){try{e:{for(var r=t.return;r!==null;){if(JTe(r)){var i=r;break e}r=r.return}throw Error(je(160))}switch(i.tag){case 5:var n=i.stateNode;i.flags&32&&(pL(n,""),i.flags&=-33);var s=Bue(t);VX(t,s,n);break;case 3:case 4:var o=i.stateNode.containerInfo,a=Bue(t);zX(t,a,o);break;default:throw Error(je(161))}}catch(l){Bs(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function x9e(t,e,r){xt=t,eSe(t)}function eSe(t,e,r){for(var i=(t.mode&1)!==0;xt!==null;){var n=xt,s=n.child;if(n.tag===22&&i){var o=n.memoizedState!==null||xF;if(!o){var a=n.alternate,l=a!==null&&a.memoizedState!==null||zl;a=xF;var c=zl;if(xF=o,(zl=l)&&!c)for(xt=n;xt!==null;)o=xt,l=o.child,o.tag===22&&o.memoizedState!==null?que(n):l!==null?(l.return=o,xt=l):que(n);for(;s!==null;)xt=s,eSe(s),s=s.sibling;xt=n,xF=a,zl=c}Gue(t)}else n.subtreeFlags&8772&&s!==null?(s.return=n,xt=s):Gue(t)}}function Gue(t){for(;xt!==null;){var e=xt;if(e.flags&8772){var r=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:zl||h9(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!zl)if(r===null)i.componentDidMount();else{var n=e.elementType===e.type?r.memoizedProps:Af(e.type,r.memoizedProps);i.componentDidUpdate(n,r.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&Aue(e,s,i);break;case 3:var o=e.updateQueue;if(o!==null){if(r=null,e.child!==null)switch(e.child.tag){case 5:r=e.child.stateNode;break;case 1:r=e.child.stateNode}Aue(e,o,r)}break;case 5:var a=e.stateNode;if(r===null&&e.flags&4){r=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&r.focus();break;case"img":l.src&&(r.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var h=c.memoizedState;if(h!==null){var p=h.dehydrated;p!==null&&yL(p)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(je(163))}zl||e.flags&512&&UX(e)}catch(f){Bs(e,e.return,f)}}if(e===t){xt=null;break}if(r=e.sibling,r!==null){r.return=e.return,xt=r;break}xt=e.return}}function Hue(t){for(;xt!==null;){var e=xt;if(e===t){xt=null;break}var r=e.sibling;if(r!==null){r.return=e.return,xt=r;break}xt=e.return}}function que(t){for(;xt!==null;){var e=xt;try{switch(e.tag){case 0:case 11:case 15:var r=e.return;try{h9(4,e)}catch(l){Bs(e,r,l)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var n=e.return;try{i.componentDidMount()}catch(l){Bs(e,n,l)}}var s=e.return;try{UX(e)}catch(l){Bs(e,s,l)}break;case 5:var o=e.return;try{UX(e)}catch(l){Bs(e,o,l)}}}catch(l){Bs(e,e.return,l)}if(e===t){xt=null;break}var a=e.sibling;if(a!==null){a.return=e.return,xt=a;break}xt=e.return}}var T9e=Math.ceil,E8=I_.ReactCurrentDispatcher,gie=I_.ReactCurrentOwner,pp=I_.ReactCurrentBatchConfig,Mi=0,ka=null,$o=null,ll=0,Oh=0,jA=Tw(0),ua=0,RL=null,qS=0,d9=0,yie=0,h$=null,Ou=null,_ie=0,nO=1/0,E0=null,C8=!1,BX=null,Rb=null,TF=!1,tb=null,A8=0,d$=0,jX=null,Yk=-1,Zk=0;function Vc(){return Mi&6?co():Yk!==-1?Yk:Yk=co()}function Ob(t){return t.mode&1?Mi&2&&ll!==0?ll&-ll:o9e.transition!==null?(Zk===0&&(Zk=Fxe()),Zk):(t=fn,t!==0||(t=window.event,t=t===void 0?16:Gxe(t.type)),t):1}function Kf(t,e,r,i){if(50<d$)throw d$=0,jX=null,Error(je(185));JD(t,r,i),(!(Mi&2)||t!==ka)&&(t===ka&&(!(Mi&2)&&(d9|=r),ua===4&&j1(t,ll)),zu(t,i),r===1&&Mi===0&&!(e.mode&1)&&(nO=co()+500,l9&&Sw()))}function zu(t,e){var r=t.callbackNode;oVe(t,e);var i=u8(t,t===ka?ll:0);if(i===0)r!==null&&tue(r),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(r!=null&&tue(r),e===1)t.tag===0?s9e(Wue.bind(null,t)):cTe(Wue.bind(null,t)),t9e(function(){!(Mi&6)&&Sw()}),r=null;else{switch(kxe(i)){case 1:r=Gre;break;case 4:r=Dxe;break;case 16:r=c8;break;case 536870912:r=Nxe;break;default:r=c8}r=lSe(r,tSe.bind(null,t))}t.callbackPriority=e,t.callbackNode=r}}function tSe(t,e){if(Yk=-1,Zk=0,Mi&6)throw Error(je(327));var r=t.callbackNode;if(_R()&&t.callbackNode!==r)return null;var i=u8(t,t===ka?ll:0);if(i===0)return null;if(i&30||i&t.expiredLanes||e)e=R8(t,i);else{e=i;var n=Mi;Mi|=2;var s=iSe();(ka!==t||ll!==e)&&(E0=null,nO=co()+500,SS(t,e));do try{C9e();break}catch(a){rSe(t,a)}while(1);iie(),E8.current=s,Mi=n,$o!==null?e=0:(ka=null,ll=0,e=ua)}if(e!==0){if(e===2&&(n=gX(t),n!==0&&(i=n,e=GX(t,n))),e===1)throw r=RL,SS(t,0),j1(t,i),zu(t,co()),r;if(e===6)j1(t,i);else{if(n=t.current.alternate,!(i&30)&&!S9e(n)&&(e=R8(t,i),e===2&&(s=gX(t),s!==0&&(i=s,e=GX(t,s))),e===1))throw r=RL,SS(t,0),j1(t,i),zu(t,co()),r;switch(t.finishedWork=n,t.finishedLanes=i,e){case 0:case 1:throw Error(je(345));case 2:Ix(t,Ou,E0);break;case 3:if(j1(t,i),(i&130023424)===i&&(e=_ie+500-co(),10<e)){if(u8(t,0)!==0)break;if(n=t.suspendedLanes,(n&i)!==i){Vc(),t.pingedLanes|=t.suspendedLanes&n;break}t.timeoutHandle=SX(Ix.bind(null,t,Ou,E0),e);break}Ix(t,Ou,E0);break;case 4:if(j1(t,i),(i&4194240)===i)break;for(e=t.eventTimes,n=-1;0<i;){var o=31-Jf(i);s=1<<o,o=e[o],o>n&&(n=o),i&=~s}if(i=n,i=co()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*T9e(i/1960))-i,10<i){t.timeoutHandle=SX(Ix.bind(null,t,Ou,E0),i);break}Ix(t,Ou,E0);break;case 5:Ix(t,Ou,E0);break;default:throw Error(je(329))}}}return zu(t,co()),t.callbackNode===r?tSe.bind(null,t):null}function GX(t,e){var r=h$;return t.current.memoizedState.isDehydrated&&(SS(t,e).flags|=256),t=R8(t,e),t!==2&&(e=Ou,Ou=r,e!==null&&HX(e)),t}function HX(t){Ou===null?Ou=t:Ou.push.apply(Ou,t)}function S9e(t){for(var e=t;;){if(e.flags&16384){var r=e.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var i=0;i<r.length;i++){var n=r[i],s=n.getSnapshot;n=n.value;try{if(!sm(s(),n))return!1}catch{return!1}}}if(r=e.child,e.subtreeFlags&16384&&r!==null)r.return=e,e=r;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function j1(t,e){for(e&=~yie,e&=~d9,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var r=31-Jf(e),i=1<<r;t[r]=-1,e&=~i}}function Wue(t){if(Mi&6)throw Error(je(327));_R();var e=u8(t,0);if(!(e&1))return zu(t,co()),null;var r=R8(t,e);if(t.tag!==0&&r===2){var i=gX(t);i!==0&&(e=i,r=GX(t,i))}if(r===1)throw r=RL,SS(t,0),j1(t,e),zu(t,co()),r;if(r===6)throw Error(je(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Ix(t,Ou,E0),zu(t,co()),null}function vie(t,e){var r=Mi;Mi|=1;try{return t(e)}finally{Mi=r,Mi===0&&(nO=co()+500,l9&&Sw())}}function WS(t){tb!==null&&tb.tag===0&&!(Mi&6)&&_R();var e=Mi;Mi|=1;var r=pp.transition,i=fn;try{if(pp.transition=null,fn=1,t)return t()}finally{fn=i,pp.transition=r,Mi=e,!(Mi&6)&&Sw()}}function bie(){Oh=jA.current,ds(jA)}function SS(t,e){t.finishedWork=null,t.finishedLanes=0;var r=t.timeoutHandle;if(r!==-1&&(t.timeoutHandle=-1,e9e(r)),$o!==null)for(r=$o.return;r!==null;){var i=r;switch(eie(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&m8();break;case 3:rO(),ds(ku),ds(Yl),cie();break;case 5:lie(i);break;case 4:rO();break;case 13:ds(Es);break;case 19:ds(Es);break;case 10:nie(i.type._context);break;case 22:case 23:bie()}r=r.return}if(ka=t,$o=t=Mb(t.current,null),ll=Oh=e,ua=0,RL=null,yie=d9=qS=0,Ou=h$=null,aS!==null){for(e=0;e<aS.length;e++)if(r=aS[e],i=r.interleaved,i!==null){r.interleaved=null;var n=i.next,s=r.pending;if(s!==null){var o=s.next;s.next=n,i.next=o}r.pending=i}aS=null}return t}function rSe(t,e){do{var r=$o;try{if(iie(),qk.current=S8,T8){for(var i=Cs.memoizedState;i!==null;){var n=i.queue;n!==null&&(n.pending=null),i=i.next}T8=!1}if(HS=0,Pa=sa=Cs=null,c$=!1,EL=0,gie.current=null,r===null||r.return===null){ua=1,RL=e,$o=null;break}e:{var s=t,o=r.return,a=r,l=e;if(e=ll,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,h=a,p=h.tag;if(!(h.mode&1)&&(p===0||p===11||p===15)){var f=h.alternate;f?(h.updateQueue=f.updateQueue,h.memoizedState=f.memoizedState,h.lanes=f.lanes):(h.updateQueue=null,h.memoizedState=null)}var m=Lue(o);if(m!==null){m.flags&=-257,Due(m,o,a,s,e),m.mode&1&&$ue(s,c,e),e=m,l=c;var g=e.updateQueue;if(g===null){var _=new Set;_.add(l),e.updateQueue=_}else g.add(l);break e}else{if(!(e&1)){$ue(s,c,e),wie();break e}l=Error(je(426))}}else if(vs&&a.mode&1){var b=Lue(o);if(b!==null){!(b.flags&65536)&&(b.flags|=256),Due(b,o,a,s,e),tie(iO(l,a));break e}}s=l=iO(l,a),ua!==4&&(ua=2),h$===null?h$=[s]:h$.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var w=UTe(s,l,e);Cue(s,w);break e;case 1:a=l;var x=s.type,T=s.stateNode;if(!(s.flags&128)&&(typeof x.getDerivedStateFromError=="function"||T!==null&&typeof T.componentDidCatch=="function"&&(Rb===null||!Rb.has(T)))){s.flags|=65536,e&=-e,s.lanes|=e;var E=zTe(s,a,e);Cue(s,E);break e}}s=s.return}while(s!==null)}sSe(r)}catch(C){e=C,$o===r&&r!==null&&($o=r=r.return);continue}break}while(1)}function iSe(){var t=E8.current;return E8.current=S8,t===null?S8:t}function wie(){(ua===0||ua===3||ua===2)&&(ua=4),ka===null||!(qS&268435455)&&!(d9&268435455)||j1(ka,ll)}function R8(t,e){var r=Mi;Mi|=2;var i=iSe();(ka!==t||ll!==e)&&(E0=null,SS(t,e));do try{E9e();break}catch(n){rSe(t,n)}while(1);if(iie(),Mi=r,E8.current=i,$o!==null)throw Error(je(261));return ka=null,ll=0,ua}function E9e(){for(;$o!==null;)nSe($o)}function C9e(){for(;$o!==null&&!Jze();)nSe($o)}function nSe(t){var e=aSe(t.alternate,t,Oh);t.memoizedProps=t.pendingProps,e===null?sSe(t):$o=e,gie.current=null}function sSe(t){var e=t;do{var r=e.alternate;if(t=e.return,e.flags&32768){if(r=v9e(r,e),r!==null){r.flags&=32767,$o=r;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{ua=6,$o=null;return}}else if(r=_9e(r,e,Oh),r!==null){$o=r;return}if(e=e.sibling,e!==null){$o=e;return}$o=e=t}while(e!==null);ua===0&&(ua=5)}function Ix(t,e,r){var i=fn,n=pp.transition;try{pp.transition=null,fn=1,A9e(t,e,r,i)}finally{pp.transition=n,fn=i}return null}function A9e(t,e,r,i){do _R();while(tb!==null);if(Mi&6)throw Error(je(327));r=t.finishedWork;var n=t.finishedLanes;if(r===null)return null;if(t.finishedWork=null,t.finishedLanes=0,r===t.current)throw Error(je(177));t.callbackNode=null,t.callbackPriority=0;var s=r.lanes|r.childLanes;if(aVe(t,s),t===ka&&($o=ka=null,ll=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||TF||(TF=!0,lSe(c8,function(){return _R(),null})),s=(r.flags&15990)!==0,r.subtreeFlags&15990||s){s=pp.transition,pp.transition=null;var o=fn;fn=1;var a=Mi;Mi|=4,gie.current=null,w9e(t,r),QTe(r,t),WVe(xX),h8=!!wX,xX=wX=null,t.current=r,x9e(r),Kze(),Mi=a,fn=o,pp.transition=s}else t.current=r;if(TF&&(TF=!1,tb=t,A8=n),s=t.pendingLanes,s===0&&(Rb=null),tVe(r.stateNode),zu(t,co()),e!==null)for(i=t.onRecoverableError,r=0;r<e.length;r++)n=e[r],i(n.value,{componentStack:n.stack,digest:n.digest});if(C8)throw C8=!1,t=BX,BX=null,t;return A8&1&&t.tag!==0&&_R(),s=t.pendingLanes,s&1?t===jX?d$++:(d$=0,jX=t):d$=0,Sw(),null}function _R(){if(tb!==null){var t=kxe(A8),e=pp.transition,r=fn;try{if(pp.transition=null,fn=16>t?16:t,tb===null)var i=!1;else{if(t=tb,tb=null,A8=0,Mi&6)throw Error(je(331));var n=Mi;for(Mi|=4,xt=t.current;xt!==null;){var s=xt,o=s.child;if(xt.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(xt=c;xt!==null;){var h=xt;switch(h.tag){case 0:case 11:case 15:u$(8,h,s)}var p=h.child;if(p!==null)p.return=h,xt=p;else for(;xt!==null;){h=xt;var f=h.sibling,m=h.return;if(ZTe(h),h===c){xt=null;break}if(f!==null){f.return=m,xt=f;break}xt=m}}}var g=s.alternate;if(g!==null){var _=g.child;if(_!==null){g.child=null;do{var b=_.sibling;_.sibling=null,_=b}while(_!==null)}}xt=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,xt=o;else e:for(;xt!==null;){if(s=xt,s.flags&2048)switch(s.tag){case 0:case 11:case 15:u$(9,s,s.return)}var w=s.sibling;if(w!==null){w.return=s.return,xt=w;break e}xt=s.return}}var x=t.current;for(xt=x;xt!==null;){o=xt;var T=o.child;if(o.subtreeFlags&2064&&T!==null)T.return=o,xt=T;else e:for(o=x;xt!==null;){if(a=xt,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:h9(9,a)}}catch(C){Bs(a,a.return,C)}if(a===o){xt=null;break e}var E=a.sibling;if(E!==null){E.return=a.return,xt=E;break e}xt=a.return}}if(Mi=n,Sw(),Vg&&typeof Vg.onPostCommitFiberRoot=="function")try{Vg.onPostCommitFiberRoot(i9,t)}catch{}i=!0}return i}finally{fn=r,pp.transition=e}}return!1}function Xue(t,e,r){e=iO(r,e),e=UTe(t,e,1),t=Ab(t,e,1),e=Vc(),t!==null&&(JD(t,1,e),zu(t,e))}function Bs(t,e,r){if(t.tag===3)Xue(t,t,r);else for(;e!==null;){if(e.tag===3){Xue(e,t,r);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(Rb===null||!Rb.has(i))){t=iO(r,t),t=zTe(e,t,1),e=Ab(e,t,1),t=Vc(),e!==null&&(JD(e,1,t),zu(e,t));break}}e=e.return}}function R9e(t,e,r){var i=t.pingCache;i!==null&&i.delete(e),e=Vc(),t.pingedLanes|=t.suspendedLanes&r,ka===t&&(ll&r)===r&&(ua===4||ua===3&&(ll&130023424)===ll&&500>co()-_ie?SS(t,0):yie|=r),zu(t,e)}function oSe(t,e){e===0&&(t.mode&1?(e=pF,pF<<=1,!(pF&130023424)&&(pF=4194304)):e=1);var r=Vc();t=f_(t,e),t!==null&&(JD(t,e,r),zu(t,r))}function O9e(t){var e=t.memoizedState,r=0;e!==null&&(r=e.retryLane),oSe(t,r)}function M9e(t,e){var r=0;switch(t.tag){case 13:var i=t.stateNode,n=t.memoizedState;n!==null&&(r=n.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(je(314))}i!==null&&i.delete(e),oSe(t,r)}var aSe;aSe=function(t,e,r){if(t!==null)if(t.memoizedProps!==e.pendingProps||ku.current)Lu=!0;else{if(!(t.lanes&r)&&!(e.flags&128))return Lu=!1,y9e(t,e,r);Lu=!!(t.flags&131072)}else Lu=!1,vs&&e.flags&1048576&&uTe(e,_8,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;Xk(t,e),t=e.pendingProps;var n=QR(e,Yl.current);yR(e,r),n=hie(null,e,i,t,n,r);var s=die();return e.flags|=1,typeof n=="object"&&n!==null&&typeof n.render=="function"&&n.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Uu(i)?(s=!0,g8(e)):s=!1,e.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,oie(e),n.updater=c9,e.stateNode=n,n._reactInternals=e,PX(e,i,t,r),e=LX(null,e,i,!0,s,r)):(e.tag=0,vs&&s&&Qre(e),Mc(null,e,n,r),e=e.child),e;case 16:i=e.elementType;e:{switch(Xk(t,e),t=e.pendingProps,n=i._init,i=n(i._payload),e.type=i,n=e.tag=I9e(i),t=Af(i,t),n){case 0:e=$X(null,e,i,t,r);break e;case 1:e=kue(null,e,i,t,r);break e;case 11:e=Nue(null,e,i,t,r);break e;case 14:e=Fue(null,e,i,Af(i.type,t),r);break e}throw Error(je(306,i,""))}return e;case 0:return i=e.type,n=e.pendingProps,n=e.elementType===i?n:Af(i,n),$X(t,e,i,n,r);case 1:return i=e.type,n=e.pendingProps,n=e.elementType===i?n:Af(i,n),kue(t,e,i,n,r);case 3:e:{if(GTe(e),t===null)throw Error(je(387));i=e.pendingProps,s=e.memoizedState,n=s.element,fTe(t,e),w8(e,i,null,r);var o=e.memoizedState;if(i=o.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){n=iO(Error(je(423)),e),e=Uue(t,e,i,r,n);break e}else if(i!==n){n=iO(Error(je(424)),e),e=Uue(t,e,i,r,n);break e}else for(Hh=Cb(e.stateNode.containerInfo.firstChild),Xh=e,vs=!0,Df=null,r=_Te(e,null,i,r),e.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(eO(),i===n){e=m_(t,e,r);break e}Mc(t,e,i,r)}e=e.child}return e;case 5:return vTe(e),t===null&&RX(e),i=e.type,n=e.pendingProps,s=t!==null?t.memoizedProps:null,o=n.children,TX(i,n)?o=null:s!==null&&TX(i,s)&&(e.flags|=32),jTe(t,e),Mc(t,e,o,r),e.child;case 6:return t===null&&RX(e),null;case 13:return HTe(t,e,r);case 4:return aie(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=tO(e,null,i,r):Mc(t,e,i,r),e.child;case 11:return i=e.type,n=e.pendingProps,n=e.elementType===i?n:Af(i,n),Nue(t,e,i,n,r);case 7:return Mc(t,e,e.pendingProps,r),e.child;case 8:return Mc(t,e,e.pendingProps.children,r),e.child;case 12:return Mc(t,e,e.pendingProps.children,r),e.child;case 10:e:{if(i=e.type._context,n=e.pendingProps,s=e.memoizedProps,o=n.value,qn(v8,i._currentValue),i._currentValue=o,s!==null)if(sm(s.value,o)){if(s.children===n.children&&!ku.current){e=m_(t,e,r);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===i){if(s.tag===1){l=J0(-1,r&-r),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var h=c.pending;h===null?l.next=l:(l.next=h.next,h.next=l),c.pending=l}}s.lanes|=r,l=s.alternate,l!==null&&(l.lanes|=r),OX(s.return,r,e),a.lanes|=r;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(je(341));o.lanes|=r,a=o.alternate,a!==null&&(a.lanes|=r),OX(o,r,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Mc(t,e,n.children,r),e=e.child}return e;case 9:return n=e.type,i=e.pendingProps.children,yR(e,r),n=wp(n),i=i(n),e.flags|=1,Mc(t,e,i,r),e.child;case 14:return i=e.type,n=Af(i,e.pendingProps),n=Af(i.type,n),Fue(t,e,i,n,r);case 15:return VTe(t,e,e.type,e.pendingProps,r);case 17:return i=e.type,n=e.pendingProps,n=e.elementType===i?n:Af(i,n),Xk(t,e),e.tag=1,Uu(i)?(t=!0,g8(e)):t=!1,yR(e,r),gTe(e,i,n),PX(e,i,n,r),LX(null,e,i,!0,t,r);case 19:return qTe(t,e,r);case 22:return BTe(t,e,r)}throw Error(je(156,e.tag))};function lSe(t,e){return Lxe(t,e)}function P9e(t,e,r,i){this.tag=t,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function lp(t,e,r,i){return new P9e(t,e,r,i)}function xie(t){return t=t.prototype,!(!t||!t.isReactComponent)}function I9e(t){if(typeof t=="function")return xie(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Vre)return 11;if(t===Bre)return 14}return 2}function Mb(t,e){var r=t.alternate;return r===null?(r=lp(t.tag,e,t.key,t.mode),r.elementType=t.elementType,r.type=t.type,r.stateNode=t.stateNode,r.alternate=t,t.alternate=r):(r.pendingProps=e,r.type=t.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=t.flags&14680064,r.childLanes=t.childLanes,r.lanes=t.lanes,r.child=t.child,r.memoizedProps=t.memoizedProps,r.memoizedState=t.memoizedState,r.updateQueue=t.updateQueue,e=t.dependencies,r.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},r.sibling=t.sibling,r.index=t.index,r.ref=t.ref,r}function Jk(t,e,r,i,n,s){var o=2;if(i=t,typeof t=="function")xie(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case $A:return ES(r.children,n,s,e);case zre:o=8,n|=8;break;case tX:return t=lp(12,r,e,n|2),t.elementType=tX,t.lanes=s,t;case rX:return t=lp(13,r,e,n),t.elementType=rX,t.lanes=s,t;case iX:return t=lp(19,r,e,n),t.elementType=iX,t.lanes=s,t;case yxe:return p9(r,n,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case mxe:o=10;break e;case gxe:o=9;break e;case Vre:o=11;break e;case Bre:o=14;break e;case O1:o=16,i=null;break e}throw Error(je(130,t==null?t:typeof t,""))}return e=lp(o,r,e,n),e.elementType=t,e.type=i,e.lanes=s,e}function ES(t,e,r,i){return t=lp(7,t,i,e),t.lanes=r,t}function p9(t,e,r,i){return t=lp(22,t,i,e),t.elementType=yxe,t.lanes=r,t.stateNode={isHidden:!1},t}function _j(t,e,r){return t=lp(6,t,null,e),t.lanes=r,t}function vj(t,e,r){return e=lp(4,t.children!==null?t.children:[],t.key,e),e.lanes=r,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function $9e(t,e,r,i,n){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Q7(0),this.expirationTimes=Q7(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Q7(0),this.identifierPrefix=i,this.onRecoverableError=n,this.mutableSourceEagerHydrationData=null}function Tie(t,e,r,i,n,s,o,a,l){return t=new $9e(t,e,r,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=lp(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:i,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},oie(s),t}function L9e(t,e,r){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:IA,key:i==null?null:""+i,children:t,containerInfo:e,implementation:r}}function cSe(t){if(!t)return Hb;t=t._reactInternals;e:{if(I2(t)!==t||t.tag!==1)throw Error(je(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Uu(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(je(171))}if(t.tag===1){var r=t.type;if(Uu(r))return lTe(t,r,e)}return e}function uSe(t,e,r,i,n,s,o,a,l){return t=Tie(r,i,!0,t,n,s,o,a,l),t.context=cSe(null),r=t.current,i=Vc(),n=Ob(r),s=J0(i,n),s.callback=e??null,Ab(r,s,n),t.current.lanes=n,JD(t,n,i),zu(t,i),t}function f9(t,e,r,i){var n=e.current,s=Vc(),o=Ob(n);return r=cSe(r),e.context===null?e.context=r:e.pendingContext=r,e=J0(s,o),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=Ab(n,e,o),t!==null&&(Kf(t,n,o,s),Hk(t,n,o)),o}function O8(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Yue(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var r=t.retryLane;t.retryLane=r!==0&&r<e?r:e}}function Sie(t,e){Yue(t,e),(t=t.alternate)&&Yue(t,e)}function D9e(){return null}var hSe=typeof reportError=="function"?reportError:function(t){console.error(t)};function Eie(t){this._internalRoot=t}m9.prototype.render=Eie.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(je(409));f9(t,e,null,null)};m9.prototype.unmount=Eie.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;WS(function(){f9(null,t,null,null)}),e[p_]=null}};function m9(t){this._internalRoot=t}m9.prototype.unstable_scheduleHydration=function(t){if(t){var e=Vxe();t={blockedOn:null,target:t,priority:e};for(var r=0;r<B1.length&&e!==0&&e<B1[r].priority;r++);B1.splice(r,0,t),r===0&&jxe(t)}};function Cie(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function g9(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Zue(){}function N9e(t,e,r,i,n){if(n){if(typeof i=="function"){var s=i;i=function(){var c=O8(o);s.call(c)}}var o=uSe(e,i,t,0,null,!1,!1,"",Zue);return t._reactRootContainer=o,t[p_]=o.current,bL(t.nodeType===8?t.parentNode:t),WS(),o}for(;n=t.lastChild;)t.removeChild(n);if(typeof i=="function"){var a=i;i=function(){var c=O8(l);a.call(c)}}var l=Tie(t,0,!1,null,null,!1,!1,"",Zue);return t._reactRootContainer=l,t[p_]=l.current,bL(t.nodeType===8?t.parentNode:t),WS(function(){f9(e,l,r,i)}),l}function y9(t,e,r,i,n){var s=r._reactRootContainer;if(s){var o=s;if(typeof n=="function"){var a=n;n=function(){var l=O8(o);a.call(l)}}f9(e,o,t,n)}else o=N9e(r,e,t,n,i);return O8(o)}Uxe=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var r=gP(e.pendingLanes);r!==0&&(Hre(e,r|1),zu(e,co()),!(Mi&6)&&(nO=co()+500,Sw()))}break;case 13:WS(function(){var i=f_(t,1);if(i!==null){var n=Vc();Kf(i,t,1,n)}}),Sie(t,1)}};qre=function(t){if(t.tag===13){var e=f_(t,134217728);if(e!==null){var r=Vc();Kf(e,t,134217728,r)}Sie(t,134217728)}};zxe=function(t){if(t.tag===13){var e=Ob(t),r=f_(t,e);if(r!==null){var i=Vc();Kf(r,t,e,i)}Sie(t,e)}};Vxe=function(){return fn};Bxe=function(t,e){var r=fn;try{return fn=t,e()}finally{fn=r}};pX=function(t,e,r){switch(e){case"input":if(oX(t,r),e=r.name,r.type==="radio"&&e!=null){for(r=t;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<r.length;e++){var i=r[e];if(i!==t&&i.form===t.form){var n=a9(i);if(!n)throw Error(je(90));vxe(i),oX(i,n)}}}break;case"textarea":wxe(t,r);break;case"select":e=r.value,e!=null&&pR(t,!!r.multiple,e,!1)}};Rxe=vie;Oxe=WS;var F9e={usingClientEntryPoint:!1,Events:[QD,FA,a9,Cxe,Axe,vie]},eM={findFiberByHostInstance:oS,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},k9e={bundleType:eM.bundleType,version:eM.version,rendererPackageName:eM.rendererPackageName,rendererConfig:eM.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:I_.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Ixe(t),t===null?null:t.stateNode},findFiberByHostInstance:eM.findFiberByHostInstance||D9e,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var SF=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!SF.isDisabled&&SF.supportsFiber)try{i9=SF.inject(k9e),Vg=SF}catch{}}ad.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=F9e;ad.createPortal=function(t,e){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Cie(e))throw Error(je(200));return L9e(t,e,null,r)};ad.createRoot=function(t,e){if(!Cie(t))throw Error(je(299));var r=!1,i="",n=hSe;return e!=null&&(e.unstable_strictMode===!0&&(r=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(n=e.onRecoverableError)),e=Tie(t,1,!1,null,null,r,!1,i,n),t[p_]=e.current,bL(t.nodeType===8?t.parentNode:t),new Eie(e)};ad.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(je(188)):(t=Object.keys(t).join(","),Error(je(268,t)));return t=Ixe(e),t=t===null?null:t.stateNode,t};ad.flushSync=function(t){return WS(t)};ad.hydrate=function(t,e,r){if(!g9(e))throw Error(je(200));return y9(null,t,e,!0,r)};ad.hydrateRoot=function(t,e,r){if(!Cie(t))throw Error(je(405));var i=r!=null&&r.hydratedSources||null,n=!1,s="",o=hSe;if(r!=null&&(r.unstable_strictMode===!0&&(n=!0),r.identifierPrefix!==void 0&&(s=r.identifierPrefix),r.onRecoverableError!==void 0&&(o=r.onRecoverableError)),e=uSe(e,null,t,1,r??null,n,!1,s,o),t[p_]=e.current,bL(t),i)for(t=0;t<i.length;t++)r=i[t],n=r._getVersion,n=n(r._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[r,n]:e.mutableSourceEagerHydrationData.push(r,n);return new m9(e)};ad.render=function(t,e,r){if(!g9(e))throw Error(je(200));return y9(null,t,e,!1,r)};ad.unmountComponentAtNode=function(t){if(!g9(t))throw Error(je(40));return t._reactRootContainer?(WS(function(){y9(null,null,t,!1,function(){t._reactRootContainer=null,t[p_]=null})}),!0):!1};ad.unstable_batchedUpdates=vie;ad.unstable_renderSubtreeIntoContainer=function(t,e,r,i){if(!g9(r))throw Error(je(200));if(t==null||t._reactInternals===void 0)throw Error(je(38));return y9(t,e,r,!1,i)};ad.version="18.2.0-next-9e3b772b8-20220608";(function(t){function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(r){console.error(r)}}e(),t.exports=ad})(Dze);var Jue=KW;JW.createRoot=Jue.createRoot,JW.hydrateRoot=Jue.hydrateRoot;/**
 * @remix-run/router v1.3.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function OL(){return OL=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},OL.apply(this,arguments)}var rb;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(rb||(rb={}));const Kue="popstate";function U9e(t){t===void 0&&(t={});function e(n,s){let{pathname:o="/",search:a="",hash:l=""}=$2(n.location.hash.substr(1));return qX("",{pathname:o,search:a,hash:l},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function r(n,s){let o=n.document.querySelector("base"),a="";if(o&&o.getAttribute("href")){let l=n.location.href,c=l.indexOf("#");a=c===-1?l:l.slice(0,c)}return a+"#"+(typeof s=="string"?s:M8(s))}function i(n,s){z9e(n.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(s)+")")}return B9e(e,r,i,t)}function fa(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function z9e(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function V9e(){return Math.random().toString(36).substr(2,8)}function Que(t,e){return{usr:t.state,key:t.key,idx:e}}function qX(t,e,r,i){return r===void 0&&(r=null),OL({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?$2(e):e,{state:r,key:e&&e.key||i||V9e()})}function M8(t){let{pathname:e="/",search:r="",hash:i=""}=t;return r&&r!=="?"&&(e+=r.charAt(0)==="?"?r:"?"+r),i&&i!=="#"&&(e+=i.charAt(0)==="#"?i:"#"+i),e}function $2(t){let e={};if(t){let r=t.indexOf("#");r>=0&&(e.hash=t.substr(r),t=t.substr(0,r));let i=t.indexOf("?");i>=0&&(e.search=t.substr(i),t=t.substr(0,i)),t&&(e.pathname=t)}return e}function B9e(t,e,r,i){i===void 0&&(i={});let{window:n=document.defaultView,v5Compat:s=!1}=i,o=n.history,a=rb.Pop,l=null,c=h();c==null&&(c=0,o.replaceState(OL({},o.state,{idx:c}),""));function h(){return(o.state||{idx:null}).idx}function p(){a=rb.Pop;let b=h(),w=b==null?null:b-c;c=b,l&&l({action:a,location:_.location,delta:w})}function f(b,w){a=rb.Push;let x=qX(_.location,b,w);r&&r(x,b),c=h()+1;let T=Que(x,c),E=_.createHref(x);try{o.pushState(T,"",E)}catch{n.location.assign(E)}s&&l&&l({action:a,location:_.location,delta:1})}function m(b,w){a=rb.Replace;let x=qX(_.location,b,w);r&&r(x,b),c=h();let T=Que(x,c),E=_.createHref(x);o.replaceState(T,"",E),s&&l&&l({action:a,location:_.location,delta:0})}function g(b){let w=n.location.origin!=="null"?n.location.origin:n.location.href,x=typeof b=="string"?b:M8(b);return fa(w,"No window.location.(origin|href) available to create URL for href: "+x),new URL(x,w)}let _={get action(){return a},get location(){return t(n,o)},listen(b){if(l)throw new Error("A history only accepts one active listener");return n.addEventListener(Kue,p),l=b,()=>{n.removeEventListener(Kue,p),l=null}},createHref(b){return e(n,b)},createURL:g,encodeLocation(b){let w=g(b);return{pathname:w.pathname,search:w.search,hash:w.hash}},push:f,replace:m,go(b){return o.go(b)}};return _}var ehe;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(ehe||(ehe={}));function j9e(t,e,r){r===void 0&&(r="/");let i=typeof e=="string"?$2(e):e,n=Aie(i.pathname||"/",r);if(n==null)return null;let s=dSe(t);G9e(s);let o=null;for(let a=0;o==null&&a<s.length;++a)o=Q9e(s[a],rBe(n));return o}function dSe(t,e,r,i){e===void 0&&(e=[]),r===void 0&&(r=[]),i===void 0&&(i="");let n=(s,o,a)=>{let l={relativePath:a===void 0?s.path||"":a,caseSensitive:s.caseSensitive===!0,childrenIndex:o,route:s};l.relativePath.startsWith("/")&&(fa(l.relativePath.startsWith(i),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+i+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(i.length));let c=Pb([i,l.relativePath]),h=r.concat(l);s.children&&s.children.length>0&&(fa(s.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+c+'".')),dSe(s.children,e,h,c)),!(s.path==null&&!s.index)&&e.push({path:c,score:J9e(c,s.index),routesMeta:h})};return t.forEach((s,o)=>{var a;if(s.path===""||!((a=s.path)!=null&&a.includes("?")))n(s,o);else for(let l of pSe(s.path))n(s,o,l)}),e}function pSe(t){let e=t.split("/");if(e.length===0)return[];let[r,...i]=e,n=r.endsWith("?"),s=r.replace(/\?$/,"");if(i.length===0)return n?[s,""]:[s];let o=pSe(i.join("/")),a=[];return a.push(...o.map(l=>l===""?s:[s,l].join("/"))),n&&a.push(...o),a.map(l=>t.startsWith("/")&&l===""?"/":l)}function G9e(t){t.sort((e,r)=>e.score!==r.score?r.score-e.score:K9e(e.routesMeta.map(i=>i.childrenIndex),r.routesMeta.map(i=>i.childrenIndex)))}const H9e=/^:\w+$/,q9e=3,W9e=2,X9e=1,Y9e=10,Z9e=-2,the=t=>t==="*";function J9e(t,e){let r=t.split("/"),i=r.length;return r.some(the)&&(i+=Z9e),e&&(i+=W9e),r.filter(n=>!the(n)).reduce((n,s)=>n+(H9e.test(s)?q9e:s===""?X9e:Y9e),i)}function K9e(t,e){return t.length===e.length&&t.slice(0,-1).every((i,n)=>i===e[n])?t[t.length-1]-e[e.length-1]:0}function Q9e(t,e){let{routesMeta:r}=t,i={},n="/",s=[];for(let o=0;o<r.length;++o){let a=r[o],l=o===r.length-1,c=n==="/"?e:e.slice(n.length)||"/",h=eBe({path:a.relativePath,caseSensitive:a.caseSensitive,end:l},c);if(!h)return null;Object.assign(i,h.params);let p=a.route;s.push({params:i,pathname:Pb([n,h.pathname]),pathnameBase:oBe(Pb([n,h.pathnameBase])),route:p}),h.pathnameBase!=="/"&&(n=Pb([n,h.pathnameBase]))}return s}function eBe(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[r,i]=tBe(t.path,t.caseSensitive,t.end),n=e.match(r);if(!n)return null;let s=n[0],o=s.replace(/(.)\/+$/,"$1"),a=n.slice(1);return{params:i.reduce((c,h,p)=>{if(h==="*"){let f=a[p]||"";o=s.slice(0,s.length-f.length).replace(/(.)\/+$/,"$1")}return c[h]=iBe(a[p]||"",h),c},{}),pathname:s,pathnameBase:o,pattern:t}}function tBe(t,e,r){e===void 0&&(e=!1),r===void 0&&(r=!0),Rie(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let i=[],n="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^$?{}|()[\]]/g,"\\$&").replace(/\/:(\w+)/g,(o,a)=>(i.push(a),"/([^\\/]+)"));return t.endsWith("*")?(i.push("*"),n+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?n+="\\/*$":t!==""&&t!=="/"&&(n+="(?:(?=\\/|$))"),[new RegExp(n,e?void 0:"i"),i]}function rBe(t){try{return decodeURI(t)}catch(e){return Rie(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function iBe(t,e){try{return decodeURIComponent(t)}catch(r){return Rie(!1,'The value for the URL param "'+e+'" will not be decoded because'+(' the string "'+t+'" is a malformed URL segment. This is probably')+(" due to a bad percent encoding ("+r+").")),t}}function Aie(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let r=e.endsWith("/")?e.length-1:e.length,i=t.charAt(r);return i&&i!=="/"?null:t.slice(r)||"/"}function Rie(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function nBe(t,e){e===void 0&&(e="/");let{pathname:r,search:i="",hash:n=""}=typeof t=="string"?$2(t):t;return{pathname:r?r.startsWith("/")?r:sBe(r,e):e,search:aBe(i),hash:lBe(n)}}function sBe(t,e){let r=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(n=>{n===".."?r.length>1&&r.pop():n!=="."&&r.push(n)}),r.length>1?r.join("/"):"/"}function bj(t,e,r,i){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(i)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function fSe(t){return t.filter((e,r)=>r===0||e.route.path&&e.route.path.length>0)}function mSe(t,e,r,i){i===void 0&&(i=!1);let n;typeof t=="string"?n=$2(t):(n=OL({},t),fa(!n.pathname||!n.pathname.includes("?"),bj("?","pathname","search",n)),fa(!n.pathname||!n.pathname.includes("#"),bj("#","pathname","hash",n)),fa(!n.search||!n.search.includes("#"),bj("#","search","hash",n)));let s=t===""||n.pathname==="",o=s?"/":n.pathname,a;if(i||o==null)a=r;else{let p=e.length-1;if(o.startsWith("..")){let f=o.split("/");for(;f[0]==="..";)f.shift(),p-=1;n.pathname=f.join("/")}a=p>=0?e[p]:"/"}let l=nBe(n,a),c=o&&o!=="/"&&o.endsWith("/"),h=(s||o===".")&&r.endsWith("/");return!l.pathname.endsWith("/")&&(c||h)&&(l.pathname+="/"),l}const Pb=t=>t.join("/").replace(/\/\/+/g,"/"),oBe=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),aBe=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,lBe=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function cBe(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const uBe=["post","put","patch","delete"];[...uBe];/**
 * React Router v6.8.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function WX(){return WX=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},WX.apply(this,arguments)}function hBe(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}const dBe=typeof Object.is=="function"?Object.is:hBe,{useState:pBe,useEffect:fBe,useLayoutEffect:mBe,useDebugValue:gBe}=ZW;function yBe(t,e,r){const i=e(),[{inst:n},s]=pBe({inst:{value:i,getSnapshot:e}});return mBe(()=>{n.value=i,n.getSnapshot=e,wj(n)&&s({inst:n})},[t,i,e]),fBe(()=>(wj(n)&&s({inst:n}),t(()=>{wj(n)&&s({inst:n})})),[t]),gBe(i),i}function wj(t){const e=t.getSnapshot,r=t.value;try{const i=e();return!dBe(r,i)}catch{return!0}}function _Be(t,e,r){return e()}const vBe=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",bBe=!vBe,wBe=bBe?_Be:yBe;"useSyncExternalStore"in ZW&&(t=>t.useSyncExternalStore)(ZW);const gSe=ut.createContext(null),ySe=ut.createContext(null),tN=ut.createContext(null),_9=ut.createContext(null),o3=ut.createContext({outlet:null,matches:[]}),_Se=ut.createContext(null);function xBe(t,e){let{relative:r}=e===void 0?{}:e;rN()||fa(!1);let{basename:i,navigator:n}=ut.useContext(tN),{hash:s,pathname:o,search:a}=vSe(t,{relative:r}),l=o;return i!=="/"&&(l=o==="/"?i:Pb([i,o])),n.createHref({pathname:l,search:a,hash:s})}function rN(){return ut.useContext(_9)!=null}function v9(){return rN()||fa(!1),ut.useContext(_9).location}function TBe(){rN()||fa(!1);let{basename:t,navigator:e}=ut.useContext(tN),{matches:r}=ut.useContext(o3),{pathname:i}=v9(),n=JSON.stringify(fSe(r).map(a=>a.pathnameBase)),s=ut.useRef(!1);return ut.useEffect(()=>{s.current=!0}),ut.useCallback(function(a,l){if(l===void 0&&(l={}),!s.current)return;if(typeof a=="number"){e.go(a);return}let c=mSe(a,JSON.parse(n),i,l.relative==="path");t!=="/"&&(c.pathname=c.pathname==="/"?t:Pb([t,c.pathname])),(l.replace?e.replace:e.push)(c,l.state,l)},[t,e,n,i])}function vSe(t,e){let{relative:r}=e===void 0?{}:e,{matches:i}=ut.useContext(o3),{pathname:n}=v9(),s=JSON.stringify(fSe(i).map(o=>o.pathnameBase));return ut.useMemo(()=>mSe(t,JSON.parse(s),n,r==="path"),[t,s,n,r])}function SBe(t,e){rN()||fa(!1);let{navigator:r}=ut.useContext(tN),i=ut.useContext(ySe),{matches:n}=ut.useContext(o3),s=n[n.length-1],o=s?s.params:{};s&&s.pathname;let a=s?s.pathnameBase:"/";s&&s.route;let l=v9(),c;if(e){var h;let _=typeof e=="string"?$2(e):e;a==="/"||(h=_.pathname)!=null&&h.startsWith(a)||fa(!1),c=_}else c=l;let p=c.pathname||"/",f=a==="/"?p:p.slice(a.length)||"/",m=j9e(t,{pathname:f}),g=RBe(m&&m.map(_=>Object.assign({},_,{params:Object.assign({},o,_.params),pathname:Pb([a,r.encodeLocation?r.encodeLocation(_.pathname).pathname:_.pathname]),pathnameBase:_.pathnameBase==="/"?a:Pb([a,r.encodeLocation?r.encodeLocation(_.pathnameBase).pathname:_.pathnameBase])})),n,i||void 0);return e&&g?ut.createElement(_9.Provider,{value:{location:WX({pathname:"/",search:"",hash:"",state:null,key:"default"},c),navigationType:rb.Pop}},g):g}function EBe(){let t=IBe(),e=cBe(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),r=t instanceof Error?t.stack:null,n={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},s=null;return ut.createElement(ut.Fragment,null,ut.createElement("h2",null,"Unexpected Application Error!"),ut.createElement("h3",{style:{fontStyle:"italic"}},e),r?ut.createElement("pre",{style:n},r):null,s)}class CBe extends ut.Component{constructor(e){super(e),this.state={location:e.location,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,r){return r.location!==e.location?{error:e.error,location:e.location}:{error:e.error||r.error,location:r.location}}componentDidCatch(e,r){console.error("React Router caught the following error during render",e,r)}render(){return this.state.error?ut.createElement(o3.Provider,{value:this.props.routeContext},ut.createElement(_Se.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function ABe(t){let{routeContext:e,match:r,children:i}=t,n=ut.useContext(gSe);return n&&n.static&&n.staticContext&&r.route.errorElement&&(n.staticContext._deepestRenderedBoundaryId=r.route.id),ut.createElement(o3.Provider,{value:e},i)}function RBe(t,e,r){if(e===void 0&&(e=[]),t==null)if(r!=null&&r.errors)t=r.matches;else return null;let i=t,n=r==null?void 0:r.errors;if(n!=null){let s=i.findIndex(o=>o.route.id&&(n==null?void 0:n[o.route.id]));s>=0||fa(!1),i=i.slice(0,Math.min(i.length,s+1))}return i.reduceRight((s,o,a)=>{let l=o.route.id?n==null?void 0:n[o.route.id]:null,c=r?o.route.errorElement||ut.createElement(EBe,null):null,h=e.concat(i.slice(0,a+1)),p=()=>ut.createElement(ABe,{match:o,routeContext:{outlet:s,matches:h}},l?c:o.route.element!==void 0?o.route.element:s);return r&&(o.route.errorElement||a===0)?ut.createElement(CBe,{location:r.location,component:c,error:l,children:p(),routeContext:{outlet:null,matches:h}}):p()},null)}var rhe;(function(t){t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator"})(rhe||(rhe={}));var P8;(function(t){t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator"})(P8||(P8={}));function OBe(t){let e=ut.useContext(ySe);return e||fa(!1),e}function MBe(t){let e=ut.useContext(o3);return e||fa(!1),e}function PBe(t){let e=MBe(),r=e.matches[e.matches.length-1];return r.route.id||fa(!1),r.route.id}function IBe(){var t;let e=ut.useContext(_Se),r=OBe(P8.UseRouteError),i=PBe(P8.UseRouteError);return e||((t=r.errors)==null?void 0:t[i])}function _P(t){fa(!1)}function $Be(t){let{basename:e="/",children:r=null,location:i,navigationType:n=rb.Pop,navigator:s,static:o=!1}=t;rN()&&fa(!1);let a=e.replace(/^\/*/,"/"),l=ut.useMemo(()=>({basename:a,navigator:s,static:o}),[a,s,o]);typeof i=="string"&&(i=$2(i));let{pathname:c="/",search:h="",hash:p="",state:f=null,key:m="default"}=i,g=ut.useMemo(()=>{let _=Aie(c,a);return _==null?null:{pathname:_,search:h,hash:p,state:f,key:m}},[a,c,h,p,f,m]);return g==null?null:ut.createElement(tN.Provider,{value:l},ut.createElement(_9.Provider,{children:r,value:{location:g,navigationType:n}}))}function LBe(t){let{children:e,location:r}=t,i=ut.useContext(gSe),n=i&&!e?i.router.routes:XX(e);return SBe(n,r)}var ihe;(function(t){t[t.pending=0]="pending",t[t.success=1]="success",t[t.error=2]="error"})(ihe||(ihe={}));new Promise(()=>{});function XX(t,e){e===void 0&&(e=[]);let r=[];return ut.Children.forEach(t,(i,n)=>{if(!ut.isValidElement(i))return;if(i.type===ut.Fragment){r.push.apply(r,XX(i.props.children,e));return}i.type!==_P&&fa(!1),!i.props.index||!i.props.children||fa(!1);let s=[...e,n],o={id:i.props.id||s.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,index:i.props.index,path:i.props.path,loader:i.props.loader,action:i.props.action,errorElement:i.props.errorElement,hasErrorBoundary:i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle};i.props.children&&(o.children=XX(i.props.children,s)),r.push(o)}),r}/**
 * React Router DOM v6.8.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function YX(){return YX=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},YX.apply(this,arguments)}function DBe(t,e){if(t==null)return{};var r={},i=Object.keys(t),n,s;for(s=0;s<i.length;s++)n=i[s],!(e.indexOf(n)>=0)&&(r[n]=t[n]);return r}function NBe(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function FBe(t,e){return t.button===0&&(!e||e==="_self")&&!NBe(t)}const kBe=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset"];function UBe(t){let{basename:e,children:r,window:i}=t,n=ut.useRef();n.current==null&&(n.current=U9e({window:i,v5Compat:!0}));let s=n.current,[o,a]=ut.useState({action:s.action,location:s.location});return ut.useLayoutEffect(()=>s.listen(a),[s]),ut.createElement($Be,{basename:e,children:r,location:o.location,navigationType:o.action,navigator:s})}const zBe=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",VBe=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,xj=ut.forwardRef(function(e,r){let{onClick:i,relative:n,reloadDocument:s,replace:o,state:a,target:l,to:c,preventScrollReset:h}=e,p=DBe(e,kBe),{basename:f}=ut.useContext(tN),m,g=!1;if(typeof c=="string"&&VBe.test(c)&&(m=c,zBe)){let x=new URL(window.location.href),T=c.startsWith("//")?new URL(x.protocol+c):new URL(c),E=Aie(T.pathname,f);T.origin===x.origin&&E!=null?c=E+T.search+T.hash:g=!0}let _=xBe(c,{relative:n}),b=BBe(c,{replace:o,state:a,target:l,preventScrollReset:h,relative:n});function w(x){i&&i(x),x.defaultPrevented||b(x)}return ut.createElement("a",YX({},p,{href:m||_,onClick:g||s?i:w,ref:r,target:l}))});var nhe;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmitImpl="useSubmitImpl",t.UseFetcher="useFetcher"})(nhe||(nhe={}));var she;(function(t){t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(she||(she={}));function BBe(t,e){let{target:r,replace:i,state:n,preventScrollReset:s,relative:o}=e===void 0?{}:e,a=TBe(),l=v9(),c=vSe(t,{relative:o});return ut.useCallback(h=>{if(FBe(h,r)){h.preventDefault();let p=i!==void 0?i:M8(l)===M8(c);a(t,{replace:p,state:n,preventScrollReset:s,relative:o})}},[l,a,c,i,n,r,t,s,o])}function jBe(){return JR("div",{className:"home",children:[Qi("div",{className:"link",children:Qi(xj,{to:"/media-layer-image",children:"MediaLayerImages"})}),Qi("div",{className:"link",children:Qi(xj,{to:"/media-layer-video",children:"MediaLayerVideo"})}),Qi("div",{className:"link",children:Qi(xj,{to:"/media-layer-webmap",children:"MediaLayerWebmap"})})]})}const GBe="modulepreload",HBe=function(t){return"/esri-devsummit-2023/"+t},ohe={},Q=function(e,r,i){if(!r||r.length===0)return e();const n=document.getElementsByTagName("link");return Promise.all(r.map(s=>{if(s=HBe(s),s in ohe)return;ohe[s]=!0;const o=s.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!i)for(let h=n.length-1;h>=0;h--){const p=n[h];if(p.href===s&&(!o||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":GBe,o||(c.as="script",c.crossOrigin=""),c.href=s,document.head.appendChild(c),o)return new Promise((h,p)=>{c.addEventListener("load",h),c.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e())};function u(t,e,r,i){var n,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(s<3?n(o):s>3?n(e,r,o):n(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o}let ib;function ue(t){return typeof ib[t]=="function"?ib[t]=ib[t](globalThis):ib[t]}var Zwe,Jwe,Kwe,Qwe;ib=(Zwe=globalThis.dojoConfig)!=null&&Zwe.has||(Jwe=globalThis.esriConfig)!=null&&Jwe.has?{...(Kwe=globalThis.dojoConfig)==null?void 0:Kwe.has,...(Qwe=globalThis.esriConfig)==null?void 0:Qwe.has}:{},ue.add=(t,e,r,i)=>((i||ib[t]===void 0)&&(ib[t]=e),r&&ue(t)),ue.cache=ib,ue.add("esri-deprecation-warnings",!0),(()=>{var e;ue.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const t=typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;if(ue.add("host-browser",t),ue.add("host-node",typeof globalThis.process=="object"&&((e=globalThis.process.versions)==null?void 0:e.node)&&globalThis.process.versions.v8),ue.add("dom",t),ue("host-browser")){const r=navigator,i=r.userAgent,n=r.appVersion,s=parseFloat(n);if(ue.add("wp",parseFloat(i.split("Windows Phone")[1])||void 0),ue.add("msapp",parseFloat(i.split("MSAppHost/")[1])||void 0),ue.add("khtml",n.includes("Konqueror")?s:void 0),ue.add("edge",parseFloat(i.split("Edge/")[1])||void 0),ue.add("opr",parseFloat(i.split("OPR/")[1])||void 0),ue.add("webkit",!ue("wp")&&!ue("edge")&&parseFloat(i.split("WebKit/")[1])||void 0),ue.add("chrome",!ue("edge")&&!ue("opr")&&parseFloat(i.split("Chrome/")[1])||void 0),ue.add("android",!ue("wp")&&parseFloat(i.split("Android ")[1])||void 0),ue.add("safari",!n.includes("Safari")||ue("wp")||ue("chrome")||ue("android")||ue("edge")||ue("opr")?void 0:parseFloat(n.split("Version/")[1])),ue.add("mac",n.includes("Macintosh")),!ue("wp")&&i.match(/(iPhone|iPod|iPad)/)){const o=RegExp.$1.replace(/P/,"p"),a=i.match(/OS ([\d_]+)/)?RegExp.$1:"1",l=parseFloat(a.replace(/_/,".").replace(/_/g,""));ue.add(o,l),ue.add("ios",l)}ue("webkit")||(!i.includes("Gecko")||ue("wp")||ue("khtml")||ue("edge")||ue.add("mozilla",s),ue("mozilla")&&ue.add("ff",parseFloat(i.split("Firefox/")[1]||i.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const t=navigator.userAgent,e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(t),r=/iPhone/i.test(t);e&&ue.add("esri-mobile",e),r&&ue.add("esri-iPhone",r),ue.add("esri-geolocation",!!navigator.geolocation)}ue.add("esri-wasm","WebAssembly"in globalThis),ue.add("esri-shared-array-buffer",()=>{const t="SharedArrayBuffer"in globalThis,e=globalThis.crossOriginIsolated===!1;return t&&!e}),ue.add("wasm-simd",()=>{const t=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(t))}),ue.add("esri-atomics","Atomics"in globalThis),ue.add("esri-workers","Worker"in globalThis),ue.add("web-feat:cache","caches"in globalThis),ue.add("esri-workers-arraybuffer-transfer",!ue("safari")||Number(ue("safari"))>=12),ue.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),ue.add("featurelayer-simplify-payload-size-factors",[1,1,4]),ue.add("featurelayer-snapshot-enabled",!0),ue.add("featurelayer-snapshot-point-min-threshold",8e4),ue.add("featurelayer-snapshot-point-max-threshold",4e5),ue.add("featurelayer-snapshot-point-coverage",.1),ue.add("featurelayer-advanced-symbols",!1),ue.add("featurelayer-pbf",!0),ue.add("featurelayer-pbf-statistics",!1),ue.add("feature-layers-workers",!0),ue.add("feature-polyline-generalization-factor",1),ue.add("mapview-transitions-duration",200),ue.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),ue.add("mapserver-pbf-version-support",10.81),ue.add("mapservice-popup-identify-max-tolerance",20),ue.add("heatmap-allow-raster-fallback",!0),ue.add("heatmap-force-raster",!1),ue("host-webworker")||ue("host-browser")&&(ue.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),ue.add("esri-image-decode",()=>{if("decode"in new Image){const t=new Image;return t.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void t.decode().then(()=>{ue.add("esri-image-decode",!0,!0,!0)}).catch(()=>{ue.add("esri-image-decode",!1,!0,!0)})}return!1}),ue.add("esri-url-encodes-apostrophe",()=>{const t=window.document.createElement("a");return t.href="?'",t.href.includes("?%27")}))})();const $x=null;function v(t){return t!=null}function R(t){return t==null}function Fo(t,e){return v(t)?e(t):$x}function XUt(t){return t}function YUt(t){return t}function Ic(t,e){return b9(t,e),t}function b9(t,e){if(R(t))throw new Error(e??"value is None")}function Nt(t,e){return v(t)?t:typeof e=="function"?e():e}function ahe(t,e){return v(t)?t:e}function ze(t){return v(t)&&t.destroy(),null}function rt(t){return v(t)&&t.dispose(),null}function $i(t){return v(t)&&t.remove(),null}function Tp(t){return v(t)&&t.abort(),null}function en(t){return v(t)&&t.release(),null}function qBe(t,e,r){return v(t)&&v(e)?v(r)?r(t,e):t.equals(e):t===e}function XS(t){return null}function ZUt(t,e){const r=new Array;return t.forEach(i=>{const n=e(i);v(n)&&r.push(n)}),r}function JUt(t,e){const r=new Array;for(const i of t)r.push(kh(i,null,e));return r}function KUt(t,e){for(const r of t)Fo(r,e)}function kh(t,e,r){return v(t)?r(t):e}function QUt(t){return t.filter(e=>v(e))}function Xs(t,...e){let r=t;for(let i=0;i<e.length&&r;++i)r=r[e[i]];return r}let p$=class Lx{constructor(e=1){this._seed=e}set seed(e){this._seed=e??Math.random()*Lx._m}getInt(){return this._seed=(Lx._a*this._seed+Lx._c)%Lx._m,this._seed}getFloat(){return this.getInt()/(Lx._m-1)}getIntRange(e,r){return Math.round(this.getFloatRange(e,r))}getFloatRange(e,r){const i=r-e;return e+this.getInt()/Lx._m*i}};p$._m=2147483647,p$._a=48271,p$._c=0;function iN(t,e){return e?t.filter((r,i,n)=>n.findIndex(e.bind(null,r))===i):t.filter((r,i,n)=>n.indexOf(r)===i)}function g_(t,e,r){if(R(t)&&R(e))return!0;if(R(t)||R(e)||t.length!==e.length)return!1;if(r){for(let i=0;i<t.length;i++)if(!r(t[i],e[i]))return!1}else for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function Oie(t,e){let r=t.length!==e.length;r&&(t.length=e.length);for(let i=0;i<e.length;++i)t[i]!==e[i]&&(t[i]=e[i],r=!0);return r}function WBe(t,e,r){let i,n;return r?(i=e.filter(s=>!t.some(o=>r(o,s))),n=t.filter(s=>!e.some(o=>r(o,s)))):(i=e.filter(s=>!t.includes(s)),n=t.filter(s=>!e.includes(s))),{added:i,removed:n}}function XBe(t){return t&&typeof t.length=="number"}function e8t(t,e){const r=t.length;if(r===0)return[];const i=[];for(let n=0;n<r;n+=e)i.push(t.slice(n,n+e));return i}const YBe=!!Array.prototype.fill;function t8t(t,e){if(YBe)return new Array(t).fill(e);const r=new Array(t);for(let i=0;i<t;i++)r[i]=e;return r}function ZBe(t,e){e===void 0&&(e=t,t=0);const r=new Array(e-t);for(let i=t;i<e;i++)r[i-t]=i;return r}function JBe(t,e,r){const i=t.length;let n=0,s=i-1;for(;n<s;){const a=n+Math.floor((s-n)/2);e>t[a]?n=a+1:s=a}const o=t[n];return r?e>=t[i-1]?-1:o===e?n:n-1:o===e?n:-1}let Mie=class{constructor(){this.last=0}};const bSe=new Mie;function ML(t,e,r,i){i=i||bSe;const n=Math.max(0,i.last-10);for(let o=n;o<r;++o)if(t[o]===e)return i.last=o,o;const s=Math.min(n,r);for(let o=0;o<s;++o)if(t[o]===e)return i.last=o,o;return-1}function PL(t,e,r,i){const n=r??t.length,s=ML(t,e,n,i);if(s!==-1)return t[s]=t[n-1],r==null&&t.pop(),e}const Vp=new Set;function KBe(t,e,r=t.length,i=e.length,n,s){if(i===0||r===0)return r;Vp.clear();for(let a=0;a<i;++a)Vp.add(e[a]);n=n||bSe;const o=Math.max(0,n.last-10);for(let a=o;a<r;++a)if(Vp.has(t[a])&&(s&&s.push(t[a]),Vp.delete(t[a]),t[a]=t[r-1],--r,--a,Vp.size===0||r===0))return Vp.clear(),r;for(let a=0;a<o;++a)if(Vp.has(t[a])&&(s&&s.push(t[a]),Vp.delete(t[a]),t[a]=t[r-1],--r,--a,Vp.size===0||r===0))return Vp.clear(),r;return Vp.clear(),r}function QBe(t,e){let r=0;for(let i=0;i<t.length;++i){const n=t[i];e(n,i)&&(t[r]=n,r++)}t.length=r}function e7e(t){return t?(lhe.seed=t,()=>lhe.getFloat()):Math.random}function i8t(t,e){const r=e7e(e);for(let i=t.length-1;i>0;i--){const n=Math.floor(r()*(i+1)),s=t[i];t[i]=t[n],t[n]=s}return t}const lhe=new p$;function Pie(t,e){const r=t.indexOf(e);return r!==-1?(t.splice(r,1),e):null}function n8t(t,e){const r=new Map,i=t.length;for(let n=0;n<i;n++){const s=t[n],o=e(s,n,t),a=r.get(o);a?a.push(s):r.set(o,[s])}return r}function tM(t){return t instanceof ArrayBuffer}function t7e(t){return t&&t.constructor&&t.constructor.name==="Int8Array"}function VT(t){return t&&t.constructor&&t.constructor.name==="Uint8Array"}function r7e(t){return t&&t.constructor&&t.constructor.name==="Uint8ClampedArray"}function i7e(t){return t&&t.constructor&&t.constructor.name==="Int16Array"}function Iie(t){return t&&t.constructor&&t.constructor.name==="Uint16Array"}function n7e(t){return t&&t.constructor&&t.constructor.name==="Int32Array"}function $ie(t){return t&&t.constructor&&t.constructor.name==="Uint32Array"}function Lie(t){return t&&t.constructor&&t.constructor.name==="Float32Array"}function Die(t){return t&&t.constructor&&t.constructor.name==="Float64Array"}function EF(t){return v(t)?128+t.buffer.byteLength+64:0}const ey=1024;function wSe(t,e){let r;if(e)for(r in t)t.hasOwnProperty(r)&&(t[r]===void 0?delete t[r]:t[r]instanceof Object&&wSe(t[r],!0));else for(r in t)t.hasOwnProperty(r)&&t[r]===void 0&&delete t[r];return t}function se(t){if(!t||typeof t!="object"||typeof t=="function")return t;const e=ESe(t);if(v(e))return e;if(xSe(t))return t.clone();if(TSe(t))return t.map(se);if(SSe(t))return t.clone();const r={};for(const i of Object.getOwnPropertyNames(t))r[i]=se(t[i]);return r}function ZX(t){if(!t||typeof t!="object"||typeof t=="function"||"HTMLElement"in globalThis&&t instanceof HTMLElement)return t;const e=ESe(t);if(v(e))return e;if(TSe(t)){let r=!0;const i=t.map(n=>{const s=ZX(n);return n!=null&&s==null&&(r=!1),s});return r?i:null}if(xSe(t))return t.clone();if(!SSe(t)){const r=new(Object.getPrototypeOf(t)).constructor;for(const i of Object.getOwnPropertyNames(t)){const n=t[i],s=ZX(n);if(n!=null&&s==null)return null;r[i]=s}return r}return null}function xSe(t){return typeof t.clone=="function"}function TSe(t){return typeof t.map=="function"&&typeof t.forEach=="function"}function SSe(t){return typeof t.notifyChange=="function"&&typeof t.watch=="function"}function che(t){if(Object.prototype.toString.call(t)!=="[object Object]")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}function ESe(t){if(t7e(t)||VT(t)||r7e(t)||i7e(t)||Iie(t)||n7e(t)||$ie(t)||Lie(t)||Die(t))return t.slice();if(t instanceof Date)return new Date(t.getTime());if(t instanceof ArrayBuffer)return t.slice(0,t.byteLength);if(t instanceof Map){const e=new Map;for(const[r,i]of t)e.set(r,se(i));return e}if(t instanceof Set){const e=new Set;for(const r of t)e.add(se(r));return e}return null}function Nie(t,e){return t===e||typeof t=="number"&&isNaN(t)&&typeof e=="number"&&isNaN(e)||typeof(t||{}).getTime=="function"&&typeof(e||{}).getTime=="function"&&t.getTime()===e.getTime()||!1}function s7e(t,e){return t===e||(t==null||typeof t=="string"?t===e:typeof t=="number"?t===e||typeof e=="number"&&isNaN(t)&&isNaN(e):t instanceof Date?e instanceof Date&&t.getTime()===e.getTime():Array.isArray(t)?Array.isArray(e)&&g_(t,e):t instanceof Set?e instanceof Set&&a7e(t,e):t instanceof Map?e instanceof Map&&l7e(t,e):!!che(t)&&che(e)&&o7e(t,e))}function o7e(t,e){if(t===null||e===null)return!1;const r=Object.keys(t);if(e===null||Object.keys(e).length!==r.length)return!1;for(const i of r)if(t[i]!==e[i]||!Object.prototype.hasOwnProperty.call(e,i))return!1;return!0}function a7e(t,e){if(t.size!==e.size)return!1;for(const r of t)if(!e.has(r))return!1;return!0}function l7e(t,e){if(t.size!==e.size)return!1;for(const[r,i]of t){const n=e.get(r);if(n!==i||n===void 0&&!e.has(r))return!1}return!0}function CSe(t,e,r=!1){return RSe(t,e,r)}function nN(t,e){if(e!=null)return e[t]||ASe(t.split("."),!1,e)}function ma(t,e,r){const i=t.split("."),n=i.pop(),s=ASe(i,!0,r);s&&n&&(s[n]=e)}function ASe(t,e,r){let i=r;for(const n of t){if(i==null)return;if(!(n in i)){if(!e)return;i[n]={}}i=i[n]}return i}function RSe(t,e,r){return e?Object.keys(e).reduce((i,n)=>{let s=i[n],o=e[n];return s===o?i:s===void 0?(i[n]=se(o),i):(Array.isArray(o)||Array.isArray(i)?(s=s?Array.isArray(s)?i[n]=s.concat():i[n]=[s]:i[n]=[],o&&(Array.isArray(o)||(o=[o]),r?o.forEach(a=>{s.includes(a)||s.push(a)}):i[n]=o.concat())):o&&typeof o=="object"?i[n]=RSe(s,o,r):i.hasOwnProperty(n)&&!e.hasOwnProperty(n)||(i[n]=o),i)},t||{}):t}var exe;const ri={analysisTheme:{accentColor:[255,128,0],textColor:"white"},apiKey:void 0,applicationUrl:(exe=globalThis.location)==null?void 0:exe.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",userPrivilegesApplied:!1,portalUrl:"https://www.arcgis.com",routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(CSe(ri,globalThis.esriConfig,!0),delete ri.has),!ri.assetsPath){{const t="4.26.4";ri.assetsPath=`https://js.arcgis.com/${t.slice(0,-2)}/@arcgis/core/assets`}ri.defaultAssetsPath=ri.assetsPath}const c7e=/\{([^\}]+)\}/g;function uhe(t){return t??""}function ty(t,e){return t.replace(c7e,typeof e=="object"?(r,i)=>uhe(nN(i,e)):(r,i)=>uhe(e(i)))}function s8t(t,e){return t.replace(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,r=>e&&e.includes(r)?r:`\\${r}`)}function Fie(t){let e=0;for(let r=0;r<t.length;r++)e=(e<<5)-e+t.charCodeAt(r),e|=0;return e}function o8t(t){return new DOMParser().parseFromString(t||"","text/html").body.innerText||""}const hhe={info:0,warn:1,error:2,none:3};let re=class Rl{constructor(e){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},e.level!=null&&(this.level=e.level),e.writer!=null&&(this.writer=e.writer),this._module=e.module,Rl._loggers[this.module]=this;const r=this.module.lastIndexOf(".");r!==-1&&(this._parent=Rl.getLogger(this.module.slice(0,r)))}get module(){return this._module}get parent(){return this._parent}error(...e){this._log("error","always",...e)}warn(...e){this._log("warn","always",...e)}info(...e){this._log("info","always",...e)}errorOnce(...e){this._log("error","once",...e)}warnOnce(...e){this._log("warn","once",...e)}infoOnce(...e){this._log("info","once",...e)}errorOncePerTick(...e){this._log("error","oncePerTick",...e)}warnOncePerTick(...e){this._log("warn","oncePerTick",...e)}infoOncePerTick(...e){this._log("info","oncePerTick",...e)}get test(){const e=this;return{loggedMessages:e._loggedMessages,clearLoggedWarnings:()=>e._loggedMessages.warn.clear()}}static get testSingleton(){return{resetLoggers(e={}){const r=Rl._loggers;return Rl._loggers=e,r},set throttlingDisabled(e){Rl._throttlingDisabled=e}}}static getLogger(e){let r=Rl._loggers[e];return r||(r=new Rl({module:e})),r}_log(e,r,...i){if(this._matchLevel(e)){if(r!=="always"&&!Rl._throttlingDisabled){const n=this._argsToKey(i),s=this._loggedMessages[e].get(n);if(r==="once"&&s!=null||r==="oncePerTick"&&s&&s>=Rl._tickCounter)return;this._loggedMessages[e].set(n,Rl._tickCounter),Rl._scheduleTickCounterIncrement()}for(const n of ri.log.interceptors)if(n(e,this.module,...i))return;this._inheritedWriter()(e,this.module,...i)}}_parentWithMember(e,r){let i=this;for(;v(i);){const n=i[e];if(v(n))return n;i=i.parent}return r}_inheritedWriter(){return this._parentWithMember("writer",this._consoleWriter)}_consoleWriter(e,r,...i){console[e](`[${r}]`,...i)}_matchLevel(e){const r=ri.log.level?ri.log.level:"warn";return hhe[this._parentWithMember("level",r)]<=hhe[e]}_argsToKey(...e){return Fie(JSON.stringify(e,(i,n)=>typeof n!="object"||Array.isArray(n)?n:"[Object]"))}static _scheduleTickCounterIncrement(){Rl._tickCounterScheduled||(Rl._tickCounterScheduled=!0,Promise.resolve().then(()=>{Rl._tickCounter++,Rl._tickCounterScheduled=!1}))}};re._loggers={},re._tickCounter=0,re._tickCounterScheduled=!1,re._throttlingDisabled=!1;function ca(t,e){for(const[r,i]of t)if(e(i,r))return!0;return!1}function a8t(t,e){for(const[r,i]of t)if(e(i,r))return i;return null}function kie(t,e,r){const i=t.get(e);if(i!==void 0)return i;const n=r();return t.set(e,n),n}const vR=re.getLogger("esri.core.accessorSupport.ensureTypes");function u7e(t){return t==null?t:new Date(t)}function h7e(t){return t==null?t:!!t}function sN(t){return t==null?t:t.toString()}function Jd(t){return t==null?t:(t=parseFloat(t),isNaN(t)?0:t)}function Uie(t){return t==null?t:Math.round(parseFloat(t))}function OSe(t){return t&&t.constructor&&t.constructor.__accessorMetadata__!==void 0}function I8(t,e){return e!=null&&t&&!(e instanceof t)}function MSe(t){return t&&"isCollection"in t}function dhe(t){return t&&t.Type?typeof t.Type=="function"?t.Type:t.Type.base:null}function d7e(t,e){if(!e||!e.constructor||!MSe(e.constructor))return JX(t,e)?e:new t(e);const r=dhe(t.prototype.itemType),i=dhe(e.constructor.prototype.itemType);return r?i?r===i?e:r.prototype.isPrototypeOf(i.prototype)?new t(e):(JX(t,e),e):new t(e):e}function JX(t,e){return!!OSe(e)&&(vR.error("Accessor#set","Assigning an instance of '"+(e.declaredClass||"unknown")+"' which is not a subclass of '"+w9(t)+"'"),!0)}function sO(t,e){return e==null?e:MSe(t)?d7e(t,e):I8(t,e)?JX(t,e)?e:new t(e):e}function w9(t){return t&&t.prototype&&t.prototype.declaredClass||"unknown"}const p7e=new WeakMap;function f7e(t){switch(t){case Number:return Jd;case Xi:return Uie;case Boolean:return h7e;case String:return sN;case Date:return u7e;default:return kie(p7e,t,()=>sO.bind(null,t))}}function bs(t,e){const r=f7e(t);return arguments.length===1?r:r(e)}function IL(t,e,r){return arguments.length===1?IL.bind(null,t):e&&(Array.isArray(e)?e.map(i=>t(i,r)):[t(e,r)])}function m7e(t,e){return arguments.length===1?IL(bs.bind(null,t)):IL(bs.bind(null,t),e)}function PSe(t,e,r){return e!==0&&Array.isArray(r)?r.map(i=>PSe(t,e-1,i)):t(r)}function $8(t,e,r){if(arguments.length===2)return $8.bind(null,t,e);if(!r)return r;let i=e,n=r=PSe(t,e,r);for(;i>0&&Array.isArray(n);)i--,n=n[0];if(n!==void 0)for(let s=0;s<i;s++)r=[r];return r}function g7e(t,e,r){return arguments.length===2?$8(bs.bind(null,t),e):$8(bs.bind(null,t),e,r)}function ISe(t){return!!Array.isArray(t)&&!t.some(e=>{const r=typeof e;return!(r==="string"||r==="number"||r==="function"&&t.length>1)})}function KX(t,e){if(arguments.length===2)return KX(t).call(null,e);const r=new Set,i=t.filter(a=>typeof a!="function"),n=t.filter(a=>typeof a=="function");for(const a of t)typeof a!="string"&&typeof a!="number"||r.add(a);let s=null,o=null;return(a,l)=>{if(a==null)return a;const c=typeof a,h=c==="string"||c==="number";return h&&(r.has(a)||n.some(p=>c==="string"&&p===String||c==="number"&&p===Number))||c==="object"&&n.some(p=>!I8(a,p))?a:(h&&i.length?(s||(s=i.map(p=>typeof p=="string"?`'${p}'`:`${p}`).join(", ")),vR.error("Accessor#set",`'${a}' is not a valid value for this property, only the following values are valid: ${s}`)):typeof a=="object"&&n.length?(o||(o=n.map(p=>w9(p)).join(", ")),vR.error("Accessor#set",`'${a}' is not a valid value for this property, value must be one of ${o}`)):vR.error("Accessor#set",`'${a}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function om(t,e){if(arguments.length===2)return om(t).call(null,e);const r={},i=[],n=[];for(const l in t.typeMap){const c=t.typeMap[l];r[l]=bs(c),i.push(w9(c)),n.push(l)}const s=()=>`'${i.join("', '")}'`,o=()=>`'${n.join("', '")}'`,a=typeof t.key=="string"?l=>l[t.key]:t.key;return l=>{if(t.base&&!I8(t.base,l)||l==null)return l;const c=a(l)||t.defaultKeyValue,h=r[c];if(!h)return vR.error("Accessor#set",`Invalid property value, value needs to be one of ${s()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!I8(t.typeMap[c],l))return l;if(typeof t.key=="string"&&!OSe(l)){const p={};for(const f in l)f!==t.key&&(p[f]=l[f]);return h(p)}return h(l)}}let Xi=class{};const c8t={native:t=>({type:"native",value:t}),array:t=>({type:"array",value:t}),oneOf:t=>({type:"one-of",values:t})};function y7e(t){if(!t||!("type"in t))return!1;switch(t.type){case"native":case"array":case"one-of":return!0}return!1}function $Se(t){switch(t.type){case"native":return bs(t.value);case"array":return IL($Se(t.value));case"one-of":return _7e(t);default:return null}}function _7e(t){let e=null;return(r,i)=>eY(r,t)?r:(e==null&&(e=QX(t)),vR.error("Accessor#set",`Invalid property value, value needs to be of type ${e}`),i&&(i.valid=!1),null)}function QX(t){switch(t.type){case"native":switch(t.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case Xi:return"integer";case Date:return"date";default:return w9(t.value)}case"array":return`array of ${QX(t.value)}`;case"one-of":{const e=t.values.map(r=>QX(r));return`one of ${e.slice(0,e.length-1)} or ${e[e.length-1]}`}}return"unknown"}function eY(t,e){if(t==null)return!0;switch(e.type){case"native":switch(e.value){case Number:case Xi:return typeof t=="number";case Boolean:return typeof t=="boolean";case String:return typeof t=="string"}return t instanceof e.value;case"array":return!!Array.isArray(t)&&!t.some(r=>!eY(r,e.value));case"one-of":return e.values.some(r=>eY(t,r))}}function oO(t){return am(()=>t.forEach(e=>v(e)&&e.remove()))}function am(t){return{remove:()=>{t&&(t(),t=void 0)}}}function u8t(t){return am(v(t)?()=>t.destroy():void 0)}function Zl(t){return t?t.__accessor__?t.__accessor__:t.propertyInvalidated?t:null:null}function v7e(t,e){return t!=null&&t.metadatas&&t.metadatas[e]!=null}function Kk(t,e,r){return r?L8(t,e,{policy:r,path:""}):L8(t,e,null)}function L8(t,e,r){return e?Object.keys(e).reduce((i,n)=>{let s=null,o="merge";if(r&&(s=r.path?`${r.path}.${n}`:n,o=r.policy(s)),o==="replace"||o==="replace-arrays"&&Array.isArray(i[n]))return i[n]=e[n],i;if(i[n]===void 0)return i[n]=se(e[n]),i;let a=i[n],l=e[n];if(a===l)return i;if(Array.isArray(l)||Array.isArray(i))a=a?Array.isArray(a)?i[n]=a.concat():i[n]=[a]:i[n]=[],l&&(Array.isArray(l)||(l=[l]),l.forEach(c=>{a.includes(c)||a.push(c)}));else if(l&&typeof l=="object")if(r){const c=r.path;r.path=s,i[n]=L8(a,l,r),r.path=c}else i[n]=L8(a,l,null);else i.hasOwnProperty(n)&&!e.hasOwnProperty(n)||(i[n]=l);return i},t||{}):t}function LSe(t){return Array.isArray(t)?t:t.split(".")}function phe(t){return t.includes(",")?t.split(",").map(e=>e.trim()):[t.trim()]}function b7e(t){if(Array.isArray(t)){const e=[];for(const r of t)e.push(...phe(r));return e}return phe(t)}function DSe(t,e,r,i){const n=b7e(e);if(n.length!==1){const s=n.map(o=>i(t,o,r));return oO(s)}return i(t,n[0],r)}function zie(t){let e=!1;return()=>{e||(e=!0,t())}}function NSe(t,e){const r=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const n=parseInt(r,10);if(!isNaN(n))return Array.isArray(e)?e[n]:e.getItemAt(n)}const i=Zl(e);return v7e(i,r)?i.get(r):e[r]}function FSe(t,e,r){if(t==null)return t;const i=NSe(e[r],t);return!i&&r<e.length-1?void 0:r===e.length-1?i:FSe(i,e,r+1)}function oN(t,e,r=0){return typeof e!="string"||e.includes(".")?FSe(t,LSe(e),r):NSe(e,t)}function D8(t,e){return oN(t,e)}function fhe(t,e){return oN(e,t)!==void 0}function aN(t){let e=t.constructor.__accessorMetadata__;const r=Object.prototype.hasOwnProperty.call(t.constructor,"__accessorMetadata__");if(e){if(!r){e=Object.create(e);for(const i in e)e[i]=se(e[i]);Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0})}}else e={},Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0});return t.constructor.__accessorMetadata__}function x9(t,e){const r=aN(t);let i=r[e];return i||(i=r[e]={}),i}function w7e(t,e){return Kk(t,e,T7e)}const x7e=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function T7e(t){return x7e.test(t)?"replace":"merge"}function S7e(t,e){return t.replace(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,(r,i)=>{if(i==="")return"$";const n=nN(i,e),s=n??"";if(s===void 0)throw new Error(`could not find key "${i}" in template`);return s.toString()})}let kSe=class USe{constructor(e,r,i){this.name=e,this.details=i,this instanceof USe&&(this.message=(r&&S7e(r,i))??"")}toString(){return"["+this.name+"]: "+this.message}},H=class Qk extends kSe{constructor(e,r,i){if(super(e,r,i),!(this instanceof Qk))return new Qk(e,r,i)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(e,r)=>{if(r&&typeof r=="object"&&typeof r.toJSON=="function")return r;try{return se(r)}catch{return"[object]"}}))}}catch(e){throw re.getLogger("esri.core.Error").error(e),e}return{name:this.name,message:this.message,details:this.details}}static fromJSON(e){return new Qk(e.name,e.message,e.details)}};H.prototype.type="error";function N8(t,e,r){if(t&&e)if(typeof e=="object")for(const i of Object.getOwnPropertyNames(e))N8(t,i,e[i]);else{if(e.includes(".")){const n=e.split("."),s=n.splice(n.length-1,1)[0];return void N8(D8(t,n),s,r)}const i=t.__accessor__;i!=null&&E7e(e,i),t[e]=r}}function E7e(t,e){if(ue("esri-unknown-property-errors")&&!C7e(t,e))throw new H("set:unknown-property",A7e(t,e))}function C7e(t,e){return e.metadatas[t]!=null}function A7e(t,e){return"setting unknown property '"+t+"' on instance of "+e.host.declaredClass}function d(t={}){return(e,r)=>{if(e===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${e.name}.${r}. Accessor does not support static properties.`);const i=Object.getOwnPropertyDescriptor(e,r),n=x9(e,r);i&&(i.get||i.set?(n.get=i.get||n.get,n.set=i.set||n.set):"value"in i&&("value"in t&&re.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${r}" on "${e.constructor.name}" already defined in the metadata`,t),n.value=t.value=i.value)),t.readOnly!=null&&(n.readOnly=t.readOnly);const s=t.aliasOf;if(s){const l=typeof s=="string"?s:s.source,c=typeof s=="string"?null:s.overridable===!0;let h;n.dependsOn=[l],n.get=function(){let p=D8(this,l);if(typeof p=="function"){h||(h=l.split(".").slice(0,-1).join("."));const f=D8(this,h);f&&(p=p.bind(f))}return p},n.readOnly||(n.set=c?function(p){this._override(r,p)}:function(p){N8(this,l,p)})}const o=t.type,a=t.types;n.cast||(o?n.cast=R7e(o):a&&(Array.isArray(a)?n.cast=IL(om(a[0])):n.cast=om(a))),w7e(n,t),t.range&&(n.cast=O7e(n.cast,t.range))}}function zSe(t,e,r){const i=x9(t,r);i.json||(i.json={});let n=i.json;return e!==void 0&&(n.origins||(n.origins={}),n.origins[e]||(n.origins[e]={}),n=n.origins[e]),n}function R7e(t){let e=0,r=t;if(y7e(t))return $Se(t);for(;Array.isArray(r)&&r.length===1&&typeof r[0]!="string"&&typeof r[0]!="number";)r=r[0],e++;const i=r;if(ISe(i))return e===0?KX(i):$8(KX(i),e);if(e===1)return m7e(i);if(e>1)return g7e(i,e);const n=t;return n.from?n.from:bs(n)}function O7e(t,e){return r=>{let i=+t(r);return e.step!=null&&(i=Math.round(i/e.step)*e.step),e.min!=null&&(i=Math.max(e.min,i)),e.max!=null&&(i=Math.min(e.max,i)),i}}const VSe=Symbol("Accessor-beforeDestroy");var D0;(function(t){t[t.INITIALIZING=0]="INITIALIZING",t[t.CONSTRUCTING=1]="CONSTRUCTING",t[t.CONSTRUCTED=2]="CONSTRUCTED"})(D0||(D0={}));var Gi;(function(t){t[t.Dirty=1]="Dirty",t[t.Overriden=2]="Overriden",t[t.Computing=4]="Computing",t[t.NonNullable=8]="NonNullable",t[t.HasDefaultValue=16]="HasDefaultValue",t[t.DepTrackingInitialized=32]="DepTrackingInitialized",t[t.AutoTracked=64]="AutoTracked",t[t.ExplicitlyTracking=128]="ExplicitlyTracking"})(Gi||(Gi={}));const F8={onObservableAccessed:()=>{},onTrackingEnd:()=>{}},vP=[];let f$=F8;function Er(t){f$.onObservableAccessed(t)}let e6=!1,t6=!1;function y_(t,e,r){if(e6)return Vie(t,e,r);BSe(t);const i=e.call(r);return jSe(),i}function M7e(t,e){return y_(F8,t,e)}function Vie(t,e,r){const i=e6;e6=!0,BSe(t);let n=null;try{n=e.call(r)}catch(s){t6&&re.getLogger("esri.core.accessorSupport.tracking").error(s)}return jSe(),e6=i,n}function BSe(t){f$=t,vP.push(t)}function jSe(){const t=vP.length;if(t>1){const e=vP.pop();f$=vP[t-2],e.onTrackingEnd()}else if(t===1){const e=vP.pop();f$=F8,e.onTrackingEnd()}else f$=F8}function GSe(t,e){const r=e.observerObject;if(r.flags&Gi.DepTrackingInitialized)return;const i=t6;t6=!1,r.flags&Gi.AutoTracked?Vie(e,e.metadata.get,t):HSe(t,e),t6=i}const P7e=[];function HSe(t,e){const r=e.observerObject;r.flags&Gi.ExplicitlyTracking||(r.flags|=Gi.ExplicitlyTracking,Vie(e,()=>{const i=e.metadata.dependsOn||P7e;for(const n of i)if(typeof n!="string"||n.includes(".")){const s=LSe(n);for(let o=0,a=t;o<s.length&&a!=null&&typeof a=="object";++o)a=mhe(a,s[o],o!==s.length-1)}else mhe(t,n,!1)}),r.flags&=~Gi.ExplicitlyTracking)}function mhe(t,e,r){var s;const i=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const o=parseInt(i,10);if(!isNaN(o))return Array.isArray(t)?t[o]:t.getItemAt(o)}const n=(s=Zl(t))==null?void 0:s.properties.get(i);return n&&(Er(n.observerObject),GSe(t,n)),r?t[i]:void 0}function I7e(t){if(t.json&&t.json.origins){const e=t.json.origins,r={"web-document":["web-scene","web-map"]};for(const i in r)if(e[i]){const n=e[i];r[i].forEach(s=>{e[s]=n}),delete e[i]}}}let Sp=class tY extends kSe{constructor(e,r,i){if(super(e,r,i),!(this instanceof tY))return new tY(e,r,i)}};Sp.prototype.type="warning";function qSe(t){return!!t&&t.prototype&&t.prototype.declaredClass&&t.prototype.declaredClass.indexOf("esri.core.Collection")===0}const rY=re.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function ghe(t,e,r){var i,n;t&&(!r&&!e.read||(i=e.read)!=null&&i.reader||((n=e.read)==null?void 0:n.enabled)===!1||D7e(t)&&ma("read.reader",Ew(t),e))}function Ew(t){var r,i;const e=t.ndimArray??0;if(e>1)return L7e(t);if(e===1)return yhe(t);if("type"in t&&XSe(t.type)){const n=(i=(r=t.type.prototype)==null?void 0:r.itemType)==null?void 0:i.Type,s=yhe(typeof n=="function"?{type:n}:{types:n});return(o,a,l)=>{const c=s(o,a,l);return c&&new t.type(c)}}return Bie(t)}function Bie(t){return"type"in t?$7e(t.type):N7e(t.types)}function $7e(t){return t.prototype.read?(e,r,i)=>{if(e==null)return e;const n=typeof e;if(n!=="object")return void rY.error(`Expected JSON value of type 'object' to deserialize type '${t.prototype.declaredClass}', but got '${n}'`);const s=new t;return s.read(e,i),s}:t.fromJSON}function WSe(t,e,r,i){return i!==0&&Array.isArray(e)?e.map(n=>WSe(t,n,r,i-1)):t(e,void 0,r)}function L7e(t){const e=Bie(t),r=WSe.bind(null,e),i=t.ndimArray??0;return(n,s,o)=>{if(n==null)return n;n=r(n,o,i);let a=i,l=n;for(;a>0&&Array.isArray(l);)a--,l=l[0];if(l!==void 0)for(let c=0;c<a;c++)n=[n];return n}}function yhe(t){const e=Bie(t);return(r,i,n)=>{if(r==null)return r;if(Array.isArray(r)){const o=[];for(const a of r){const l=e(a,void 0,n);l!==void 0&&o.push(l)}return o}const s=e(r,void 0,n);return s!==void 0?[s]:void 0}}function XSe(t){if(!qSe(t))return!1;const e=t.prototype.itemType;return!(!e||!e.Type)&&(typeof e.Type=="function"?jie(e.Type):YSe(e.Type))}function D7e(t){return"types"in t?YSe(t.types):jie(t.type)}function jie(t){return!Array.isArray(t)&&!!t&&t.prototype&&("read"in t.prototype||"fromJSON"in t||XSe(t))}function YSe(t){for(const e in t.typeMap)if(!jie(t.typeMap[e]))return!1;return!0}function N7e(t){let e=null;const r=t.errorContext??"type";return(i,n,s)=>{if(i==null)return i;const o=typeof i;if(o!=="object")return void rY.error(`Expected JSON value of type 'object' to deserialize, but got '${o}'`);e||(e=F7e(t));const a=t.key;if(typeof a!="string")return;const l=i[a],c=l?e[l]:t.defaultKeyValue?t.typeMap[t.defaultKeyValue]:void 0;if(!c){const p=`Type '${l||"unknown"}' is not supported`;return s&&s.messages&&i&&s.messages.push(new Sp(`${r}:unsupported`,p,{definition:i,context:s})),void rY.error(p)}const h=new c;return h.read(i,s),h}}function F7e(t){var r,i;const e={};for(const n in t.typeMap){const s=t.typeMap[n],o=aN(s.prototype);if(typeof t.key=="function")continue;const a=o[t.key];if(!a)continue;(r=a.json)!=null&&r.type&&Array.isArray(a.json.type)&&a.json.type.length===1&&typeof a.json.type[0]=="string"&&(e[a.json.type[0]]=s);const l=(i=a.json)==null?void 0:i.write;if(!l||!l.writer){e[n]=s;continue}const c=l.target,h=typeof c=="string"?c:t.key,p={};l.writer(n,p,h),p[h]&&(e[p[h]]=s)}return e}function k7e(t){if(t.json||(t.json={}),vhe(t.json),bhe(t.json),_he(t.json),t.json.origins)for(const e in t.json.origins)vhe(t.json.origins[e]),bhe(t.json.origins[e]),_he(t.json.origins[e]);return!0}function _he(t){t.name&&(t.read&&typeof t.read=="object"?t.read.source===void 0&&(t.read.source=t.name):t.read={source:t.name},t.write&&typeof t.write=="object"?t.write.target===void 0&&(t.write.target=t.name):t.write={target:t.name})}function vhe(t){typeof t.read=="boolean"?t.read={enabled:t.read}:typeof t.read=="function"?t.read={enabled:!0,reader:t.read}:t.read&&typeof t.read=="object"&&t.read.enabled===void 0&&(t.read.enabled=!0)}function bhe(t){typeof t.write=="boolean"?t.write={enabled:t.write}:typeof t.write=="function"?t.write={enabled:!0,writer:t.write}:t.write&&typeof t.write=="object"&&t.write.enabled===void 0&&(t.write.enabled=!0)}function whe(t,e){if(!e.write||e.write.writer||e.write.enabled===!1&&!e.write.overridePolicy)return;const r=(t==null?void 0:t.ndimArray)??0;t&&(r===1||"type"in t&&qSe(t.type))?e.write.writer=V7e:r>1?e.write.writer=B7e(r):e.types?Array.isArray(e.types)?e.write.writer=z7e(e.types[0]):e.write.writer=U7e(e.types):e.write.writer=$L}function U7e(t){return(e,r,i,n)=>e?ZSe(e,t,n)?$L(e,r,i,n):void 0:$L(e,r,i,n)}function ZSe(t,e,r){for(const i in e.typeMap)if(t instanceof e.typeMap[i])return!0;if(r!=null&&r.messages){const i=e.errorContext??"type",n=`Values of type '${(typeof e.key!="function"?t[e.key]:t.declaredClass)??"Unknown"}' cannot be written`;r&&r.messages&&t&&r.messages.push(new H(`${i}:unsupported`,n,{definition:t,context:r})),re.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(n)}return!1}function z7e(t){return(e,r,i,n)=>!e||!Array.isArray(e)?$L(e,r,i,n):$L(e.filter(s=>ZSe(s,t,n)),r,i,n)}function $L(t,e,r,i){ma(r,k8(t,i),e)}function k8(t,e){return t&&typeof t.write=="function"?t.write({},e):t&&typeof t.toJSON=="function"?t.toJSON():typeof t=="number"?U8(t):t}function U8(t){return t===-1/0?-Number.MAX_VALUE:t===1/0?Number.MAX_VALUE:isNaN(t)?null:t}function V7e(t,e,r,i){let n;t===null?n=null:t&&typeof t.map=="function"?(n=t.map(s=>k8(s,i)),typeof n.toArray=="function"&&(n=n.toArray())):n=[k8(t,i)],ma(r,n,e)}function JSe(t,e,r){return r!==0&&Array.isArray(t)?t.map(i=>JSe(i,e,r-1)):k8(t,e)}function B7e(t){return(e,r,i,n)=>{let s;if(e===null)s=null;else{s=JSe(e,n,t);let o=t,a=s;for(;o>0&&Array.isArray(a);)o--,a=a[0];if(a!==void 0)for(let l=0;l<o;l++)s=[s]}ma(i,s,r)}}function iY(t,e){return Gie(t,"read",e)}function KSe(t,e){return Gie(t,"write",e)}function Gie(t,e,r){let i=t&&t.json;if(t&&t.json&&t.json.origins&&r){const n=r.origin&&t.json.origins[r.origin];n&&(e==="any"||e in n)&&(i=n)}return i}function j7e(t){const e=G7e(t);if(t.json.origins)for(const r in t.json.origins){const i=t.json.origins[r],n=i.types?H7e(i):e;ghe(n,i,!1),i.types&&!i.write&&t.json.write&&t.json.write.enabled&&(i.write={...t.json.write}),whe(n,i)}ghe(e,t.json,!0),whe(e,t.json)}function G7e(t){return t.json.types?nY(t.json):t.type?QSe(t):nY(t)}function H7e(t){return t.type?QSe(t):nY(t)}function QSe(t){if(!t.type)return;let e=0,r=t.type;for(;Array.isArray(r)&&!ISe(r);)r=r[0],e++;return{type:r,ndimArray:e}}function nY(t){if(!t.types)return;let e=0,r=t.types;for(;Array.isArray(r);)r=r[0],e++;return{types:r,ndimArray:e}}function q7e(t){k7e(t)&&(I7e(t),j7e(t))}const Tj=new Set,Sj=new Set;function $(t){return e=>{e.prototype.declaredClass=t,X7e(e);const r=[],i=[];let n=e.prototype;for(;n;)n.hasOwnProperty("initialize")&&!Tj.has(n.initialize)&&(Tj.add(n.initialize),r.push(n.initialize)),n.hasOwnProperty("destroy")&&!Sj.has(n.destroy)&&(Sj.add(n.destroy),i.push(n.destroy)),n=Object.getPrototypeOf(n);Tj.clear(),Sj.clear();class s extends e{constructor(...a){if(super(...a),this.constructor===s&&typeof this.postscript=="function"){if(r.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=r.length-1;l>=0;l--)r[l].call(this)}}),i.length){let l=!1;const c=this[VSe];Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){l=!0,c.call(this);for(let h=0;h<i.length;h++)i[h].call(this)}}})}this.postscript(...a)}}}return s.__accessorMetadata__=aN(e.prototype),s.prototype.declaredClass=t,s}}function W7e(t,e){return e.get==null?function(){const r=this.__accessor__.properties.get(t);if(r===void 0)return;Er(r.observerObject);const i=this.__accessor__.store;return i.has(t)?i.get(t):r.metadata.value}:function(){const r=this.__accessor__.properties.get(t);if(r!==void 0)return r.getComputed()}}function X7e(t){const e=t.prototype,r=aN(e),i={};for(const n of Object.getOwnPropertyNames(r)){const s=r[n];q7e(s),i[n]={enumerable:!0,configurable:!0,get:W7e(n,s),set(o){const a=this.__accessor__;if(a!==void 0){if(!Object.isFrozen(this)){if(a.initialized&&s.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${n}' of ${this.declaredClass}`);if(a.lifecycle===D0.CONSTRUCTED&&s.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${n}' of ${this.declaredClass}`);a.set(n,o)}}else Object.defineProperty(this,n,{enumerable:!0,configurable:!0,writable:!0,value:o})}}}Object.defineProperties(t.prototype,i)}function h8t(t){const e=[];return function*(){yield*e;for(const r of t)e.push(r),yield r}}function Y7e(t,e){for(const r of t)if(r!=null&&e(r))return r}function LL(t){return t!=null&&typeof t[Symbol.iterator]=="function"}let qr=class{constructor(){this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(r=>{e+=r.length}),e}add(e,r){if(LL(e)){const i=this._getOrCreateGroup(r);for(const n of e)this._isHandle(n)&&i.push(n)}else this._isHandle(e)&&this._getOrCreateGroup(r).push(e);return this}forEach(e,r){if(typeof e=="function")this._groups.forEach(i=>i.forEach(e));else{const i=this._getGroup(e);i&&r&&i.forEach(r)}}has(e){return this._groups.has(this._ensureGroupKey(e))}remove(e){if(typeof e!="string"&&LL(e)){for(const r of e)this.remove(r);return this}return this.has(e)?(this._removeAllFromGroup(this._getGroup(e)),this._groups.delete(this._ensureGroupKey(e)),this):this}removeAll(){return this._groups.forEach(e=>this._removeAllFromGroup(e)),this._groups.clear(),this}_isHandle(e){return e&&!!e.remove}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const r=[];return this._groups.set(this._ensureGroupKey(e),r),r}_getGroup(e){return this._groups.get(this._ensureGroupKey(e))}_ensureGroupKey(e){return e||"_default_"}_removeAllFromGroup(e){e.forEach(r=>r.remove())}};function Z7e(t){return t&&t.release&&typeof t.release=="function"}function J7e(t){return t&&t.acquire&&typeof t.acquire=="function"}let ko=class sY{constructor(e,r,i,n=1,s=0){if(this._ctor=e,this._acquireFunction=r,this._releaseFunction=i,this.allocationSize=n,this._pool=new Array(s),this._initialSize=s,this._ctor)for(let o=0;o<s;o++)this._pool[o]=new this._ctor;this.allocationSize=Math.max(n,1)}destroy(){this.prune(0)}acquire(...e){let r;if(sY.test.disabled)r=new this._ctor;else{if(this._pool.length===0){const i=this.allocationSize;for(let n=0;n<i;n++)this._pool[n]=new this._ctor}r=this._pool.pop()}return this._acquireFunction?this._acquireFunction(r,...e):J7e(r)&&r.acquire(...e),r}release(e){e&&!sY.test.disabled&&(this._releaseFunction?this._releaseFunction(e):Z7e(e)&&e.release(),this._pool.push(e))}prune(e=this._initialSize){if(!(e>=this._pool.length)){for(let r=e;r<this._pool.length;++r){const i=this._pool[r];this._dispose(i)}this._pool.length=e}}_dispose(e){e.dispose&&typeof e.dispose=="function"&&e.dispose()}};ko.test={disabled:!1};let K7e=class{constructor(e,r){this._observers=e,this._observer=r}remove(){Pie(this._observers,this._observer)}},e2e=class{constructor(){this._observers=null,this.destroyed=!1}observe(e){if(this.destroyed||e.destroyed)return Q7e;this._observers==null&&(this._observers=[]);const r=this._observers;let i=!1,n=!1;const s=r.length;for(let o=0;o<s;++o){const a=r[o];if(a.destroyed)n=!0;else if(a===e){i=!0;break}}return i||(r.push(e),n&&this._removeDestroyedObservers()),new K7e(r,e)}_removeDestroyedObservers(){const e=this._observers;if(!e||e.length===0)return;const r=e.length;let i=0;for(let n=0;n<r;++n){for(;n+i<r&&e[n+i].destroyed;)++i;if(i>0){if(!(n+i<r))break;e[n]=e[n+i]}}e.length=r-i}destroy(){if(this.destroyed)return;this.destroyed=!0;const e=this._observers;if(e!=null){for(const r of e)r.onCommitted();this._observers=null}}};const Q7e={remove:()=>{}};var Jr;(function(t){t[t.DEFAULTS=0]="DEFAULTS",t[t.COMPUTED=1]="COMPUTED",t[t.SERVICE=2]="SERVICE",t[t.PORTAL_ITEM=3]="PORTAL_ITEM",t[t.WEB_SCENE=4]="WEB_SCENE",t[t.WEB_MAP=5]="WEB_MAP",t[t.USER=6]="USER"})(Jr||(Jr={}));const oY=Jr.USER+1;function nb(t){switch(t){case"defaults":return Jr.DEFAULTS;case"service":return Jr.SERVICE;case"portal-item":return Jr.PORTAL_ITEM;case"web-scene":return Jr.WEB_SCENE;case"web-map":return Jr.WEB_MAP;case"user":return Jr.USER;default:return null}}function z8(t){switch(t){case Jr.DEFAULTS:return"defaults";case Jr.SERVICE:return"service";case Jr.PORTAL_ITEM:return"portal-item";case Jr.WEB_SCENE:return"web-scene";case Jr.WEB_MAP:return"web-map";case Jr.USER:return"user"}return void 0}function eje(t){return z8(t)}let xhe=class{constructor(e,r,i){this.properties=e,this.propertyName=r,this.metadata=i,this.observerObject=new tje,this._accessed=null,this._handles=null,this.observerObject.flags=Gi.Dirty|(i.nonNullable?Gi.NonNullable:0)|(i.hasOwnProperty("value")?Gi.HasDefaultValue:0)|(i.get===void 0?Gi.DepTrackingInitialized:0)|(i.dependsOn===void 0?Gi.AutoTracked:0),The.register(this,this.observerObject)}destroy(){this.observerObject.destroy(),this._accessed=null,this._clearObservationHandles(),The.unregister(this)}getComputed(){const e=this.observerObject;Er(e);const r=this.properties.store,i=this.propertyName,n=e.flags,s=r.get(i);if(n&Gi.Computing||~n&Gi.Dirty&&r.has(i))return s;e.flags|=Gi.Computing;const o=this.properties.host;let a;n&Gi.AutoTracked?a=y_(this,this.metadata.get,o):(HSe(o,this),a=this.metadata.get.call(o)),r.set(i,a,Jr.COMPUTED);const l=r.get(i);return l===s?e.flags&=~Gi.Dirty:M7e(this.commit,this),e.flags&=~Gi.Computing,l}onObservableAccessed(e){e!==this.observerObject&&(this._accessed===null&&(this._accessed=[]),this._accessed.includes(e)||this._accessed.push(e))}onTrackingEnd(){this._clearObservationHandles();const e=this.observerObject;e.flags|=Gi.DepTrackingInitialized;const r=this._accessed;if(r===null)return;let i=this._handles;i===null&&(i=this._handles=[]);for(let n=0;n<r.length;++n)i.push(r[n].observe(e));r.length=0}notifyChange(){const e=this.observerObject;e.onInvalidated(),e.onCommitted()}invalidate(){this.observerObject.onInvalidated()}commit(){const e=this.observerObject;e.flags&=~Gi.Dirty,e.onCommitted()}_clearObservationHandles(){const e=this._handles;if(e!==null){for(let r=0;r<e.length;++r)e[r].remove();e.length=0}}},tje=class extends e2e{constructor(){super(...arguments),this.flags=0}onInvalidated(){~this.flags&Gi.Overriden&&(this.flags|=Gi.Dirty);const e=this._observers;if(e&&e.length>0)for(const r of e)r.onInvalidated()}onCommitted(){const e=this._observers;if(e&&e.length>0){const r=e.slice();for(const i of r)i.onCommitted()}}destroy(){this.flags&Gi.Dirty&&this.onCommitted(),super.destroy()}};const The=new FinalizationRegistry(t=>{t.destroy()});let rje=class t2e{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const r=new t2e;return this._values.forEach((i,n)=>{e&&e.has(n)||r.set(n,se(i))}),r}get(e){return this._values.get(e)}originOf(){return Jr.USER}keys(){return[...this._values.keys()]}set(e,r){this._values.set(e,r)}delete(e){this._values.delete(e)}has(e){return this._values.has(e)}forEach(e){this._values.forEach(e)}};function CF(t,e,r){return t!==void 0}function She(t,e,r,i){return t!==void 0&&(!(r==null&&t.observerObject.flags&Gi.NonNullable)||(i.lifecycle,D0.INITIALIZING,!1))}function ije(t){return t&&typeof t.destroy=="function"}re.getLogger("esri.core.accessorSupport.Properties");let nje=class{constructor(e){this.host=e,this.properties=new Map,this.ctorArgs=null,this.destroyed=!1,this.lifecycle=D0.INITIALIZING,this.store=new rje,this._origin=Jr.USER;const r=this.host.constructor.__accessorMetadata__;for(const i in r){const n=new xhe(this,i,r[i]);this.properties.set(i,n)}this.metadatas=r}initialize(){this.lifecycle=D0.CONSTRUCTING}constructed(){this.lifecycle=D0.CONSTRUCTED}destroy(){this.destroyed=!0;for(const[e,r]of this.properties){if(r.metadata.autoDestroy){const i=this.internalGet(e);i&&ije(i)&&(i.destroy(),~r.observerObject.flags&Gi.NonNullable&&this._internalSet(r,null))}r.destroy()}}get initialized(){return this.lifecycle!==D0.INITIALIZING}get(e){const r=this.properties.get(e);if(r.metadata.get)return r.getComputed();Er(r.observerObject);const i=this.store;return i.has(e)?i.get(e):r.metadata.value}originOf(e){const r=this.store.originOf(e);if(r===void 0){const i=this.properties.get(e);if(i!==void 0&&i.observerObject.flags&Gi.HasDefaultValue)return"defaults"}return z8(r)}has(e){return!!this.properties.has(e)&&this.store.has(e)}keys(){return[...this.properties.keys()]}internalGet(e){const r=this.properties.get(e);if(CF(r))return this.store.has(e)?this.store.get(e):r.metadata.value}internalSet(e,r){const i=this.properties.get(e);CF(i)&&this._internalSet(i,r)}getDependsInfo(e,r,i){const n=this.properties.get(r);if(!CF(n))return"";const s=new Set,o=y_({onObservableAccessed:l=>s.add(l),onTrackingEnd:()=>{}},()=>{var l;return(l=n.metadata.get)==null?void 0:l.call(e)});let a=`${i}${e.declaredClass.split(".").pop()}.${r}: ${o}
`;if(s.size===0)return a;i+="  ";for(const l of s){if(!(l instanceof xhe))continue;const c=l.properties.host,h=l.propertyName,p=Zl(c);a+=p?p.getDependsInfo(c,h,i):`${i}${h}: undefined
`}return a}setAtOrigin(e,r,i){const n=this.properties.get(e);if(CF(n))return this._setAtOrigin(n,r,i)}isOverridden(e){const r=this.properties.get(e);return r!==void 0&&!!(r.observerObject.flags&Gi.Overriden)}clearOverride(e){const r=this.properties.get(e),i=r==null?void 0:r.observerObject;i&&i.flags&Gi.Overriden&&(i.flags&=~Gi.Overriden,r.notifyChange())}override(e,r){const i=this.properties.get(e);if(!She(i,e,r,this))return;const n=i.metadata.cast;if(n){const s=this._cast(n,r),{valid:o,value:a}=s;if(Ej.release(s),!o)return;r=a}i.observerObject.flags|=Gi.Overriden,this._internalSet(i,r)}set(e,r){const i=this.properties.get(e);if(!She(i,e,r,this))return;const n=i.metadata.cast;if(n){const o=this._cast(n,r),{valid:a,value:l}=o;if(Ej.release(o),!a)return;r=l}const s=i.metadata.set;s?s.call(this.host,r):this._internalSet(i,r)}setDefaultOrigin(e){this._origin=nb(e)}getDefaultOrigin(){return z8(this._origin)}notifyChange(e){const r=this.properties.get(e);r!==void 0&&r.notifyChange()}invalidate(e){const r=this.properties.get(e);r!==void 0&&r.invalidate()}commit(e){const r=this.properties.get(e);r!==void 0&&r.commit()}_internalSet(e,r){const i=this.lifecycle!==D0.INITIALIZING?this._origin:Jr.DEFAULTS;this._setAtOrigin(e,r,i)}_setAtOrigin(e,r,i){const n=this.store,s=e.propertyName;n.has(s,i)&&Nie(r,n.get(s))&&~e.observerObject.flags&Gi.Overriden&&i===n.originOf(s)||(e.invalidate(),n.set(s,r,i),e.commit(),GSe(this.host,e))}_cast(e,r){const i=Ej.acquire();return i.valid=!0,i.value=r,e&&(i.value=e.call(this.host,r,i)),i}},sje=class{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}};const Ej=new ko(sje);function oje(t){t.length=0}let Nc=class{constructor(e=50,r=50){this._pool=new ko(Array,void 0,oje,r,e)}acquire(){return this._pool.acquire()}release(e){this._pool.release(e)}prune(){this._pool.prune(0)}static acquire(){return Cj.acquire()}static release(e){return Cj.release(e)}static prune(){Cj.prune()}};const Cj=new Nc(100);let r2e=class extends ko{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=XS(this._set)}acquire(...e){const r=super.acquire(...e);return this._set.delete(r),r}release(e){e&&!this._set.has(e)&&(super.release(e),this._set.add(e))}_dispose(e){this._set.delete(e),super._dispose(e)}};const AF=[];function aO(t){AF.push(t),AF.length===1&&queueMicrotask(()=>{const e=AF.slice();AF.length=0;for(const r of e)r()})}let B0=class{constructor(e,r=30){this.name=e,this._counter=0,this._samples=new Array(r)}record(e){v(e)&&(this._samples[++this._counter%this._samples.length]=e)}get median(){return this._samples.slice().sort((e,r)=>e-r)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((e,r)=>e+r,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}};var aY;(function(t){const e=(s,o,a,l)=>{let c=o,h=o;const p=a>>>1,f=s[c-1];for(;h<=p;){h=c<<1,h<a&&l(s[h-1],s[h])<0&&++h;const m=s[h-1];if(l(m,f)<=0)break;s[c-1]=m,c=h}s[c-1]=f},r=(s,o)=>s<o?-1:s>o?1:0;function i(s,o,a,l){o===void 0&&(o=0),a===void 0&&(a=s.length),l===void 0&&(l=r);for(let h=a>>>1;h>o;h--)e(s,h,a,l);const c=o+1;for(let h=a-1;h>o;h--){const p=s[o];s[o]=s[h],s[h]=p,e(s,c,h,l)}}function*n(s,o,a,l){o===void 0&&(o=0),a===void 0&&(a=s.length),l===void 0&&(l=r);for(let h=a>>>1;h>o;h--)e(s,h,a,l),yield;const c=o+1;for(let h=a-1;h>o;h--){const p=s[o];s[o]=s[h],s[h]=p,e(s,c,h,l),yield}}t.sort=i,t.iterableSort=n})(aY||(aY={}));const Ehe=aY,aje=1.5,lje=1.1;let Wt=class{constructor(e){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new Mie,e&&(e.initialSize&&(this.data=new Array(e.initialSize)),e.allocator&&(this._allocator=e.allocator),e.deallocator!==void 0&&(this._deallocator=e.deallocator),e.shrink&&(this._shrink=()=>Che(this)))}toArray(){return this.data.slice(0,this.length)}filter(e){const r=new Array;for(let i=0;i<this._length;i++){const n=this.data[i];e(n)&&r.push(n)}return r}getItemAt(e){if(!(e<0||e>=this._length))return this.data[e]}includes(e,r){const i=this.data.indexOf(e,r);return i!==-1&&i<this.length}get length(){return this._length}set length(e){if(e>this._length){if(this._allocator){for(;this._length<e;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=e}else{if(this._deallocator)for(let r=e;r<this._length;++r)this.data[r]=this._deallocator(this.data[r]);this._length=e,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(e){this.data[this._length++]=e}pushArray(e,r=e.length){for(let i=0;i<r;i++)this.data[this._length++]=e[i]}fill(e,r){for(let i=0;i<r;i++)this.data[this._length++]=e}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const e=this.data[this._length];return++this._length,e}unshift(e){this.data.unshift(e),this._length++,Che(this)}pop(){if(this.length===0)return;const e=this.data[this.length-1];return this.length=this.length-1,this._shrink(),e}remove(e){const r=ML(this.data,e,this.length,this._hint);if(r!==-1)return this.data.splice(r,1),this.length=this.length-1,e}removeUnordered(e){return this.removeUnorderedIndex(ML(this.data,e,this.length,this._hint))}removeUnorderedIndex(e){if(!(e>=this.length||e<0))return this.swapElements(e,this.length-1),this.pop()}removeUnorderedMany(e,r=e.length,i){this.length=KBe(this.data,e,this.length,r,this._hint,i),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(e,r){if(e>=this.length||r>=this.length||e===r)return;const i=this.data[e];this.data[e]=this.data[r],this.data[r]=i}sort(e){Ehe.sort(this.data,0,this.length,e)}iterableSort(e){return Ehe.iterableSort(this.data,0,this.length,e)}some(e,r){for(let i=0;i<this.length;++i)if(e.call(r,this.data[i],i,this.data))return!0;return!1}find(e,r){for(let i=0;i<this.length;++i){const n=this.data[i];if(e.call(r,n,i))return n}}filterInPlace(e,r){let i=0;for(let n=0;n<this._length;++n){const s=this.data[n];e.call(r,s,n,this.data)&&(this.data[n]=this.data[i],this.data[i]=s,i++)}if(this._deallocator)for(let n=i;n<this._length;n++)this.data[n]=this._deallocator(this.data[n]);return this._length=i,this._shrink(),this}forAll(e,r){const i=this.length,n=this.data;for(let s=0;s<i;++s)e.call(r,n[s],s,n)}forEach(e,r){for(let i=0;i<this.length;++i)e.call(r,this.data[i],i,this.data)}map(e,r){const i=new Array(this.length);for(let n=0;n<this.length;++n)i[n]=e.call(r,this.data[n],n,this.data);return i}reduce(e,r){let i=r;for(let n=0;n<this.length;++n)i=e(i,this.data[n],n,this.data);return i}has(e){const r=this.length,i=this.data;for(let n=0;n<r;++n)if(i[n]===e)return!0;return!1}};function Che(t){t.data.length>aje*t.length&&(t.data.length=Math.floor(t.length*lje))}function cje(t){return{setTimeout:(e,r)=>{const i=t.setTimeout(e,r);return{remove:()=>t.clearTimeout(i)}}}}const lN=cje(globalThis),Ahe=new Set;function uje(t,e,r=!1){r&&Ahe.has(e)||(r&&Ahe.add(e),t.warn(`🛑 DEPRECATED - ${e}`))}function cS(t,e,r={}){if(ue("esri-deprecation-warnings")){const{moduleName:i}=r;i2e(t,`Property: ${(i?i+"::":"")+e}`,r)}}function i2e(t,e,r={}){if(ue("esri-deprecation-warnings")){const{replacement:i,version:n,see:s,warnOnce:o}=r;let a=e;i&&(a+=`
	🛠️ Replacement: ${i}`),n&&(a+=`
	⚙️ Version: ${n}`),s&&(a+=`
	🔗 See ${s} for more details.`),uje(t,a,o)}}function T9(t){return t&&(typeof t.on=="function"||typeof t.addEventListener=="function")}function cN(t,e,r){if(!T9(t))throw new TypeError("target is not a Evented or EventTarget object");if("on"in t)return t.on(e,r);if(Array.isArray(e)){const i=e.slice();for(const n of i)t.addEventListener(n,r);return{remove(){for(const n of i)t.removeEventListener(n,r)}}}return t.addEventListener(e,r),{remove(){t.removeEventListener(e,r)}}}function n2e(t,e,r){if(!T9(t))throw new TypeError("target is not a Evented or EventTarget object");if("once"in t)return t.once(e,r);const i=cN(t,e,n=>{i.remove(),r.call(t,n)});return{remove(){i.remove()}}}const hje={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"};function G1({key:t}){return hje[t]||t}function Vr(t="Aborted"){return new H("AbortError",t)}function lr(t,e="Aborted"){if(uo(t))throw Vr(e)}function S9(t){return v(t)?"aborted"in t?t:t.signal:t}function uo(t){const e=S9(t);return v(e)&&e.aborted}function Mu(t){if(ps(t))throw t}function lY(t){if(!ps(t))throw t}function Ua(t,e){const r=S9(t);if(!R(r)){if(!r.aborted)return n2e(r,"abort",()=>e());e()}}function E9(t,e){const r=S9(t);if(!R(r))return lr(r),n2e(r,"abort",()=>e(Vr()))}function Hie(t,e){const r=S9(e);return R(r)?t:new Promise((i,n)=>{let s=Ua(e,()=>n(Vr()));const o=()=>s=$i(s);t.then(o,o),t.then(i,n)})}function ps(t){return(t==null?void 0:t.name)==="AbortError"}async function bR(t){try{return await t}catch(e){if(!ps(e))throw e;return}}async function T8t(t,e=re.getLogger("esri")){try{return await t}catch(r){ps(r)||e.error(r)}}function __(){let t=null;const e=new Promise((r,i)=>{t={promise:void 0,resolve:r,reject:i}});return t.promise=e,t}async function ha(t){if(!t)return;if(typeof t.forEach!="function"){const r=Object.keys(t),i=r.map(o=>t[o]),n=await ha(i),s={};return r.map((o,a)=>s[o]=n[a]),s}const e=t;return new Promise(r=>{const i=[];let n=e.length;n===0&&r(i),e.forEach(s=>{const o={promise:s||Promise.resolve(s)};i.push(o),o.promise.then(a=>{o.value=a}).catch(a=>{o.error=a}).then(()=>{--n,n===0&&r(i)})})})}async function cY(t){return(await ha(t)).filter(e=>!!e.value).map(e=>e.value)}function YS(t,e,r){const i=new AbortController;return Ua(r,()=>i.abort()),new Promise((n,s)=>{let o=setTimeout(()=>{o=0,n(e)},t);Ua(i,()=>{o&&(clearTimeout(o),s(Vr()))})})}function Ju(t){return t&&typeof t.then=="function"}function uY(t){return Ju(t)?t:Promise.resolve(t)}function s2e(t,e=-1){let r,i,n,s,o=null;const a=(...l)=>{if(r){i=l,s&&s.reject(Vr()),s=__();const f=s.promise;if(o){const m=o;o=null,m.abort()}return f}if(n=s||__(),s=null,e>0){const f=new AbortController;r=uY(t(...l,f.signal));const m=r;YS(e).then(()=>{r===m&&(s?f.abort():o=f)})}else r=1,r=uY(t(...l));const c=()=>{const f=i;i=n=r=o=null,f!=null&&a(...f)},h=r,p=n;return h.then(c,c),h.then(p.resolve,p.reject),p.promise};return a}function qb(){let t,e;const r=new Promise((n,s)=>{t=n,e=s}),i=n=>{t(n)};return i.resolve=n=>t(n),i.reject=n=>e(n),i.timeout=(n,s)=>lN.setTimeout(()=>i.reject(s),n),i.promise=r,i}function S8t(t,e){return t.then(e,e)}async function Rhe(t){await Promise.resolve(),lr(t)}function E8t(t){return t}function o2e(t){return 1e3*t}function qie(t){return .001*t}let dje=class{constructor(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1}},pje=class{constructor(e){this.callback=e,this.isActive=!0}remove(){this.isActive=!1}},hY=0,dY=0;const rM={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},pY=["prepare","preRender","render","postRender","update","finish"],fY=[],ZS=new Wt;let fje=class{constructor(e){this._task=e}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}};const V8={frameTasks:ZS,willDispatch:!1,clearFrameTasks:mje,dispatch:c2e,executeFrameTasks:yje};function L2(t){const e=new pje(t);return fY.push(e),V8.willDispatch||(V8.willDispatch=!0,aO(c2e)),e}function v_(t){const e=new dje(t);return ZS.push(e),B8==null&&(hY=performance.now(),B8=requestAnimationFrame(a2e)),new fje(e)}let B8=null;function mje(t=!1){ZS.forAll(e=>{e.removed=!0}),t&&l2e()}function gje(t){dY=Math.max(0,t)}function a2e(){const t=performance.now();B8=null,B8=ZS.length>0?requestAnimationFrame(a2e):null,V8.executeFrameTasks(t)}function yje(t){const e=t-hY;hY=t;const r=dY>0?dY:1e3/60,i=Math.max(0,e-r);rM.time=t,rM.frameDuration=r-i;for(let n=0;n<pY.length;n++){const s=performance.now(),o=pY[n];ZS.forAll(a=>{var l;a.paused||a.removed||(n===0&&a.ticks++,a.phases[o]&&(rM.elapsedFrameTime=performance.now()-t,rM.deltaTime=a.ticks===0?0:e,(l=a.phases[o])==null||l.call(a,rM)))}),_je[n].record(performance.now()-s)}l2e(),vje.record(performance.now()-t)}const RF=new Wt;function l2e(){ZS.forAll(t=>{t.removed&&RF.push(t)}),ZS.removeUnorderedMany(RF.data,RF.length),RF.clear()}function c2e(){for(;fY.length;){const t=fY.shift();t.isActive&&t.callback()}V8.willDispatch=!1}function O8t(t=1,e){const r=qb(),i=()=>{uo(e)?r.reject(Vr()):t===0?r():(--t,aO(()=>i()))};return i(),r.promise}const _je=pY.map(t=>new B0(t)),vje=new B0("total");function r6(t,e){for(const r of t.entries())if(e(r[0]))return!0;return!1}let bje=0;const wje=0;function Vu(){return++bje}let C9=class{constructor(e){this._notify=e,this._accessed=[],this._handles=[],this._observerObject=new xje(this._notify),Ohe.register(this,this._observerObject)}destroy(){var e;this._accessed.length=0,(e=this._observerObject)==null||e.destroy(),this.clear(),Ohe.unregister(this)}onObservableAccessed(e){const r=this._accessed;r.includes(e)||r.push(e)}onTrackingEnd(){const e=this._handles,r=this._accessed,i=this._observerObject;for(let n=0;n<r.length;++n)e.push(r[n].observe(i));r.length=0}clear(){const e=this._handles;for(let r=0;r<e.length;++r)e[r].remove();e.length=0}},xje=class{constructor(e){this._notify=e,this._invalidCount=0,this.destroyed=!1}onInvalidated(){this._invalidCount++}onCommitted(){if(this.destroyed)return;const e=this._invalidCount;if(e===1)return this._invalidCount=0,void this._notify();this._invalidCount=e>0?e-1:0}destroy(){this.destroyed=!0,this._notify=Tje}};const Ohe=new FinalizationRegistry(t=>{t.destroy()});function Tje(){}let wR=!1;const j8=[];function u2e(t,e){let r=new C9(s),i=null,n=!1;function s(){if(!r||n)return;if(wR)return void p2e(s);const a=i;r.clear(),wR=!0,n=!0,i=y_(r,t),n=!1,wR=!1,e(i,a),f2e()}function o(){r&&(r.destroy(),r=null,i=null)}return n=!0,i=y_(r,t),n=!1,{remove:o}}function h2e(t,e){let r=new C9(n),i=null;function n(){e(i,o)}function s(){r&&(r.destroy(),r=null),i=null}function o(){return r?(r.clear(),i=y_(r,t),i):null}return o(),{remove:s}}function d2e(t){let e=new C9(i),r=!1;function i(){e&&!r&&(wR?p2e(i):(e.clear(),wR=!0,r=!0,y_(e,t),r=!1,wR=!1,f2e()))}function n(){e&&(e.destroy(),e=null)}return r=!0,y_(e,t),r=!1,{remove:n}}function p2e(t){j8.includes(t)||j8.unshift(t)}function f2e(){for(;j8.length;)j8.pop()()}var m$;(function(t){t[t.Untracked=0]="Untracked",t[t.Tracked=1]="Tracked"})(m$||(m$={}));let DL=class{constructor(){this.uid=Vu(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(e,r,i,n,s){return this.pool.acquire(m$.Untracked,e,r,i,n,s,Nie)}static acquireTracked(e,r,i,n){return this.pool.acquire(m$.Tracked,e,r,i,null,null,n)}notify(e,r){this.type===m$.Untracked?this.callback.call(this.target,e,r,this.path,this.target):this.callback.call(null,e,r)}acquire(e,r,i,n,s,o,a){this.uid=Vu(),this.removed=!1,this.type=e,this.oldValue=r,this.callback=i,this.getValue=n,this.target=s,this.path=o,this.equals=a}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=Vu(),this.removed=!0}};DL.pool=new r2e(DL);const i6=new Nc,K0=new Set;let G8;function H8(t){K0.delete(t),K0.add(t),G8||(G8=L2(Cje))}function Sje(t){if(t.removed)return;const e=t.oldValue,r=t.getValue();t.equals(e,r)||(t.oldValue=r,t.notify(r,e))}function Eje(t){for(const e of K0.values())e.target===t&&(e.removed=!0)}function Cje(){let t=10;for(;G8&&t--;){G8=null;const e=Aje(),r=i6.acquire();for(const i of e){const n=i.uid;Sje(i),n===i.uid&&i.removed&&r.push(i)}for(const i of K0)i.removed&&(r.push(i),K0.delete(i));for(const i of r)DL.pool.release(i);i6.release(r),i6.release(e),mY.forEach(i=>i())}}function Aje(){const t=i6.acquire();t.length=K0.size;let e=0;for(const r of K0)t[e]=r,++e;return K0.clear(),t}const mY=new Set;function m2e(t){return mY.add(t),{remove(){mY.delete(t)}}}function Rje(t,e,r){let i=DSe(t,e,r,(n,s,o)=>{let a,l,c=h2e(()=>oN(n,s),(h,p)=>{n.__accessor__.destroyed||a&&a.uid!==l?i.remove():(a||(a=DL.acquireUntracked(h,o,p,n,s),l=a.uid),H8(a))});return{remove:zie(()=>{c.remove(),a&&(a.uid!==l||a.removed||(a.removed=!0,H8(a)),a=null),i=c=null})}});return i}function Oje(t,e,r){const i=DSe(t,e,r,(n,s,o)=>{let a=!1;return u2e(()=>oN(n,s),(l,c)=>{n.__accessor__.destroyed?i.remove():a||(a=!0,Nie(c,l)||o.call(n,l,c,s,n),a=!1)})});return i}function Mje(t,e,r,i=!1){return!t.__accessor__||t.__accessor__.destroyed?{remove(){}}:i?Oje(t,e,r):Rje(t,e,r)}function Pje(t,e,r){let i,n,s=h2e(t,(o,a)=>{i&&i.uid!==n?s.remove():(i||(i=DL.acquireTracked(o,e,a,r),n=i.uid),H8(i))});return{remove:zie(()=>{s.remove(),i&&(i.uid!==n||i.removed||(i.removed=!0,H8(i)),i=null),s=null})}}function Ije(t,e,r){let i=!1;return u2e(t,(n,s)=>{i||(i=!0,r(s,n)||e(n,s),i=!1)})}function $je(t,e,r=!1,i=s7e){return r?Ije(t,e,i):Pje(t,e,i)}function Mhe(t){return r6(K0,e=>e.oldValue===t)}var g2e,y2e;function Lje(t){var e;if(t==null)return{value:t};if(Array.isArray(t))return{type:[t[0]],value:null};switch(typeof t){case"object":return(e=t.constructor)!=null&&e.__accessorMetadata__||t instanceof Date?{type:t.constructor,value:t}:t;case"boolean":return{type:Boolean,value:t};case"string":return{type:String,value:t};case"number":return{type:Number,value:t};case"function":return{type:t,value:null};default:return}}const Dx=Symbol("Accessor-Handles"),gY=Symbol("Accessor-Initialized");let be=class _2e{static createSubclass(e={}){if(Array.isArray(e))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:r,declaredClass:i,constructor:n}=e;delete e.declaredClass,delete e.properties,delete e.constructor;const s=this;class o extends s{constructor(...l){super(...l),this.inherited=null,n&&n.apply(this,l)}}aN(o.prototype);for(const a in e){const l=e[a];o.prototype[a]=typeof l=="function"?function(...c){const h=this.inherited;let p;this.inherited=function(...f){if(s.prototype[a])return s.prototype[a].apply(this,f)};try{p=l.apply(this,c)}catch(f){throw this.inherited=h,f}return this.inherited=h,p}:e[a]}for(const a in r){const l=Lje(r[a]);d(l)(o.prototype,a)}return $(i)(o)}constructor(...e){if(this[g2e]=null,this[y2e]=!1,this.constructor===_2e)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");Object.defineProperty(this,"__accessor__",{enumerable:!1,value:new nje(this)}),e.length>0&&this.normalizeCtorArgs&&(this.__accessor__.ctorArgs=this.normalizeCtorArgs.apply(this,e))}postscript(e){const r=this.__accessor__,i=r.ctorArgs||e;r.initialize(),i&&(this.set(i),r.ctorArgs=null),r.constructed(),this.initialize(),this[gY]=!0}initialize(){}[VSe](){this[Dx]=ze(this[Dx])}destroy(){this.destroyed||(Eje(this),this.__accessor__.destroy())}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[gY]}get destroyed(){return this.__accessor__&&this.__accessor__.destroyed||!1}commitProperty(e){this.get(e)}get(e){return D8(this,e)}hasOwnProperty(e){return this.__accessor__?this.__accessor__.has(e):Object.prototype.hasOwnProperty.call(this,e)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(e,r){return N8(this,e,r),this}watch(e,r,i){return Mje(this,e,r,i)}own(e){this.addHandles(e)}addHandles(e,r){let i=this[Dx];R(i)&&(i=this[Dx]=new qr),i.add(e,r)}removeHandles(e){const r=this[Dx];R(r)||r.remove(e)}hasHandles(e){const r=this[Dx];return!!v(r)&&r.has(e)}_override(e,r){r===void 0?this.__accessor__.clearOverride(e):this.__accessor__.override(e,r)}_clearOverride(e){return this.__accessor__.clearOverride(e)}_overrideIfSome(e,r){r==null?this.__accessor__.clearOverride(e):this.__accessor__.override(e,r)}_isOverridden(e){return this.__accessor__.isOverridden(e)}notifyChange(e){this.__accessor__.notifyChange(e)}_get(e){return this.__accessor__.internalGet(e)}_set(e,r){return this.__accessor__.internalSet(e,r),this}};g2e=Dx,y2e=gY;let Dje=class v2e{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const r=new v2e;return this._values.forEach((i,n)=>{e&&e.has(n)||r.set(n,se(i.value),i.origin)}),r}get(e,r){r=this._normalizeOrigin(r);const i=this._values.get(e);return r==null||(i==null?void 0:i.origin)===r?i==null?void 0:i.value:void 0}originOf(e){var r;return((r=this._values.get(e))==null?void 0:r.origin)??Jr.USER}keys(e){e=this._normalizeOrigin(e);const r=[...this._values.keys()];return e==null?r:r.filter(i=>{var n;return((n=this._values.get(i))==null?void 0:n.origin)===e})}set(e,r,i){if((i=this._normalizeOrigin(i))===Jr.DEFAULTS){const n=this._values.get(e);if(n&&n.origin!=null&&n.origin>i)return}this._values.set(e,new Nje(r,i))}delete(e,r){var i;(r=this._normalizeOrigin(r))!=null&&((i=this._values.get(e))==null?void 0:i.origin)!==r||this._values.delete(e)}has(e,r){var i;return(r=this._normalizeOrigin(r))!=null?((i=this._values.get(e))==null?void 0:i.origin)===r:this._values.has(e)}forEach(e){this._values.forEach(({value:r},i)=>e(r,i))}_normalizeOrigin(e){if(e!=null)return e===Jr.DEFAULTS?e:Jr.USER}},Nje=class{constructor(e,r){this.value=e,this.origin=r}};function b2e(t,e,r){e.keys().forEach(n=>{r.set(n,e.get(n),Jr.DEFAULTS)});const i=t.metadatas;Object.keys(i).forEach(n=>{t.internalGet(n)&&r.set(n,t.internalGet(n),Jr.DEFAULTS)})}function Fje(t,e,r){if(!t||!t.read||t.read.enabled===!1||!t.read.source)return!1;const i=t.read.source;if(typeof i=="string"){if(i===e||i.includes(".")&&i.indexOf(e)===0&&fhe(i,r))return!0}else for(const n of i)if(n===e||n.includes(".")&&n.indexOf(e)===0&&fhe(n,r))return!0;return!1}function kje(t){return t&&(!t.read||t.read.enabled!==!1&&!t.read.source)}function Uje(t,e,r,i,n){let s=iY(e[r],n);kje(s)&&(t[r]=!0);for(const o of Object.getOwnPropertyNames(e))s=iY(e[o],n),Fje(s,r,i)&&(t[o]=!0)}function zje(t,e,r,i){const n=r.metadatas,s=Gie(n[e],"any",i),o=s&&s.default;if(o===void 0)return;const a=typeof o=="function"?o.call(t,e,i):o;a!==void 0&&r.set(e,a)}const w2e={origin:"service"};function x2e(t,e,r=w2e){if(!e||typeof e!="object")return;const i=Zl(t),n=i.metadatas,s={};for(const o of Object.getOwnPropertyNames(e))Uje(s,n,o,e,r);i.setDefaultOrigin(r.origin);for(const o of Object.getOwnPropertyNames(s)){const a=iY(n[o],r).read,l=a&&a.source;let c;c=l&&typeof l=="string"?oN(e,l):e[o],a&&a.reader&&(c=a.reader.call(t,c,e,r)),c!==void 0&&i.set(o,c)}if(!r||!r.ignoreDefaults){i.setDefaultOrigin("defaults");for(const o of Object.getOwnPropertyNames(n))s[o]||zje(t,o,i,r)}i.setDefaultOrigin("user")}function T2e(t,e,r,i=w2e){var s;const n={...i,messages:[]};r(n),(s=n.messages)==null||s.forEach(o=>{o.type!=="warning"||t.loaded?i&&i.messages&&i.messages.push(o):t.loadWarnings.push(o)})}function Vje(t,e,r,i,n){var o,a;const s={};return(a=(o=e.write)==null?void 0:o.writer)==null||a.call(t,i,s,r,n),s}function S2e(t,e,r,i,n,s){if(!i||!i.write)return!1;const o=t.get(r);if(!n&&i.write.overridePolicy){const a=i.write.overridePolicy.call(t,o,r,s);a!==void 0&&(n=a)}if(n||(n=i.write),!n||n.enabled===!1)return!1;if((o===null&&!n.allowNull&&!n.writerEnsuresNonNull||o===void 0)&&n.isRequired){const a=new H("web-document-write:property-required",`Missing value for required property '${r}' on '${t.declaredClass}'`,{propertyName:r,target:t});return a&&s&&s.messages?s.messages.push(a):a&&!s&&re.getLogger("esri.core.accessorSupport.write").error(a.name,a.message),!1}return!(o===void 0||o===null&&!n.allowNull&&!n.writerEnsuresNonNull||(!e.store.multipleOriginsSupported||e.store.originOf(r)===Jr.DEFAULTS)&&Bje(t,r,s,i,o)||!n.ignoreOrigin&&s&&s.origin&&e.store.multipleOriginsSupported&&e.store.originOf(r)<nb(s.origin))}function Bje(t,e,r,i,n){const s=i.default;if(s===void 0)return!1;if(i.defaultEquals!=null)return i.defaultEquals(n);if(typeof s=="function"){if(Array.isArray(n)){const o=s.call(t,e,r);return g_(o,n)}return!1}return s===n}function jje(t,e,r,i){const n=Zl(t),s=n.metadatas,o=KSe(s[e],i);return!!o&&S2e(t,n,e,o,r,i)}function E2e(t,e,r){var s,o;if(t&&typeof t.toJSON=="function"&&(!t.toJSON.isDefaultToJSON||!t.write))return Kk(e,t.toJSON(r));const i=Zl(t),n=i.metadatas;for(const a in n){const l=KSe(n[a],r);if(!S2e(t,i,a,l,void 0,r))continue;const c=t.get(a),h=Vje(t,l,l.write&&typeof l.write.target=="string"?l.write.target:a,c,r);Object.keys(h).length>0&&(e=Kk(e,h),(o=(s=r==null?void 0:r.resources)==null?void 0:s.pendingOperations)!=null&&o.length&&r.resources.pendingOperations.push(Promise.all(r.resources.pendingOperations).then(()=>Kk(e,h,()=>"replace-arrays"))),r&&r.writtenProperties&&r.writtenProperties.push({target:t,propName:a,oldOrigin:eje(i.store.originOf(a)),newOrigin:r.origin}))}return e}const Cw=t=>{let e=class extends t{constructor(...r){super(...r);const i=Zl(this),n=i.store,s=new Dje;i.store=s,b2e(i,n,s)}read(r,i){x2e(this,r,i)}write(r={},i){return E2e(this,r,i)}toJSON(r){return this.write({},r)}static fromJSON(r,i){return Gje.call(this,r,i)}};return e=u([$("esri.core.JSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function Gje(t,e){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const r=new this;return r.read(t,e),r}let fe=class extends Cw(be){};fe=u([$("esri.core.JSONSupport")],fe);function Me(t,e,r){let i,n;return e===void 0||Array.isArray(e)?(n=t,r=e,i=[void 0]):(n=e,i=Array.isArray(t)?t:[t]),(s,o)=>{const a=s.constructor.prototype;i.forEach(l=>{const c=zSe(s,l,n);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=a[o],r&&(c.read.source=(c.read.source||[]).concat(r))})}}let mr=class{constructor(e,r={ignoreUnknown:!1,useNumericKeys:!1}){this._jsonToAPI=e,this._options=r,this.apiValues=[],this.jsonValues=[],this._apiToJSON=this._invertMap(e),this.apiValues=this._getKeysSorted(this._apiToJSON),this.jsonValues=this._getKeysSorted(this._jsonToAPI),this.read=i=>this.fromJSON(i),this.write=(i,n,s)=>{const o=this.toJSON(i);o!==void 0&&ma(s,o,n)},this.write.isJSONMapWriter=!0}toJSON(e){if(e==null)return null;if(this._apiToJSON.hasOwnProperty(e)){const r=this._apiToJSON[e];return this._options.useNumericKeys?+r:r}return this._options.ignoreUnknown?void 0:e}fromJSON(e){return e!=null&&this._jsonToAPI.hasOwnProperty(e)?this._jsonToAPI[e]:this._options.ignoreUnknown?void 0:e}_invertMap(e){const r={};for(const i in e)r[e[i]]=i;return r}_getKeysSorted(e){const r=[];for(const i in e)r.push(i);return r.sort(),r}};function ja(){return function(t,e){return new mr(t,{ignoreUnknown:!0,...e})}}let Wie=class{constructor(e,r,i,n){this.semiMajorAxis=e,this.flattening=r,this.outerAtmosphereRimWidth=i;const s=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*s,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=n||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}};const Cr=new Wie(6378137,1/298.257223563,3e5,.006694379990137799),jg=new Wie(3396190,1/169.8944472236118,23e4),b_=new Wie(1737400,0,0);var sp;(function(t){t[t.CGCS2000=4490]="CGCS2000",t[t.GCSMARS2000=104971]="GCSMARS2000",t[t.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",t[t.GCSMOON2000=104903]="GCSMOON2000"})(sp||(sp={}));let y;const k={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5041:0,5042:0,5048:0,5167:0,5168:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,9793:0,9794:0,9869:0,9874:0,9875:0,9880:0,9943:0,9945:0,9947:0,9967:0,9972:0,9977:0,20042:0,20050:1,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22239:0,22240:0,22332:0,22337:0,22338:0,22391:0,22392:0,22639:0,22700:0,22739:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102731:0,102732:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2};for(y=2e3;y<=2045;y++)k[y]=0;for(y=2056;y<=2065;y++)k[y]=0;for(y=2067;y<=2135;y++)k[y]=0;for(y=2137;y<=2154;y++)k[y]=0;for(y=2161;y<=2170;y++)k[y]=0;for(y=2172;y<=2193;y++)k[y]=0;for(y=2195;y<=2198;y++)k[y]=0;for(y=2200;y<=2203;y++)k[y]=0;for(y=2205;y<=2217;y++)k[y]=0;for(y=2222;y<=2224;y++)k[y]=1;for(y=2225;y<=2250;y++)k[y]=2;for(y=2251;y<=2253;y++)k[y]=1;for(y=2257;y<=2264;y++)k[y]=2;for(y=2274;y<=2279;y++)k[y]=2;for(y=2280;y<=2282;y++)k[y]=1;for(y=2283;y<=2289;y++)k[y]=2;for(y=2290;y<=2292;y++)k[y]=0;for(y=2308;y<=2313;y++)k[y]=0;for(y=2315;y<=2491;y++)k[y]=0;for(y=2494;y<=2866;y++)k[y]=0;for(y=2867;y<=2869;y++)k[y]=1;for(y=2870;y<=2888;y++)k[y]=2;for(y=2891;y<=2895;y++)k[y]=2;for(y=2896;y<=2898;y++)k[y]=1;for(y=2902;y<=2908;y++)k[y]=2;for(y=2915;y<=2920;y++)k[y]=2;for(y=2921;y<=2923;y++)k[y]=1;for(y=2924;y<=2930;y++)k[y]=2;for(y=2931;y<=2962;y++)k[y]=0;for(y=2964;y<=2968;y++)k[y]=2;for(y=2969;y<=2973;y++)k[y]=0;for(y=2975;y<=2991;y++)k[y]=0;for(y=2995;y<=3051;y++)k[y]=0;for(y=3054;y<=3079;y++)k[y]=0;for(y=3081;y<=3088;y++)k[y]=0;for(y=3092;y<=3101;y++)k[y]=0;for(y=3106;y<=3138;y++)k[y]=0;for(y=3146;y<=3151;y++)k[y]=0;for(y=3153;y<=3166;y++)k[y]=0;for(y=3168;y<=3172;y++)k[y]=0;for(y=3174;y<=3203;y++)k[y]=0;for(y=3294;y<=3358;y++)k[y]=0;for(y=3367;y<=3403;y++)k[y]=0;for(y=3408;y<=3416;y++)k[y]=0;for(y=3417;y<=3438;y++)k[y]=2;for(y=3441;y<=3446;y++)k[y]=2;for(y=3447;y<=3450;y++)k[y]=0;for(y=3451;y<=3459;y++)k[y]=2;for(y=3460;y<=3478;y++)k[y]=0;for(y=3554;y<=3559;y++)k[y]=0;for(y=3560;y<=3570;y++)k[y]=2;for(y=3571;y<=3581;y++)k[y]=0;for(y=3594;y<=3597;y++)k[y]=0;for(y=3601;y<=3604;y++)k[y]=0;for(y=3637;y<=3639;y++)k[y]=0;for(y=3665;y<=3667;y++)k[y]=0;for(y=3693;y<=3695;y++)k[y]=0;for(y=3701;y<=3727;y++)k[y]=0;for(y=3728;y<=3739;y++)k[y]=2;for(y=3740;y<=3751;y++)k[y]=0;for(y=3753;y<=3760;y++)k[y]=2;for(y=3761;y<=3773;y++)k[y]=0;for(y=3775;y<=3777;y++)k[y]=0;for(y=3779;y<=3781;y++)k[y]=0;for(y=3783;y<=3785;y++)k[y]=0;for(y=3788;y<=3791;y++)k[y]=0;for(y=3797;y<=3802;y++)k[y]=0;for(y=3814;y<=3816;y++)k[y]=0;for(y=3825;y<=3829;y++)k[y]=0;for(y=3832;y<=3841;y++)k[y]=0;for(y=3844;y<=3852;y++)k[y]=0;for(y=3873;y<=3885;y++)k[y]=0;for(y=3890;y<=3893;y++)k[y]=0;for(y=3907;y<=3912;y++)k[y]=0;for(y=3942;y<=3950;y++)k[y]=0;for(y=3968;y<=3970;y++)k[y]=0;for(y=3973;y<=3976;y++)k[y]=0;for(y=3986;y<=3989;y++)k[y]=0;for(y=3994;y<=3997;y++)k[y]=0;for(y=4048;y<=4051;y++)k[y]=0;for(y=4056;y<=4063;y++)k[y]=0;for(y=4093;y<=4096;y++)k[y]=0;for(y=4390;y<=4398;y++)k[y]=0;for(y=4399;y<=4413;y++)k[y]=2;for(y=4418;y<=4433;y++)k[y]=2;for(y=4455;y<=4457;y++)k[y]=2;for(y=4484;y<=4489;y++)k[y]=0;for(y=4491;y<=4554;y++)k[y]=0;for(y=4568;y<=4589;y++)k[y]=0;for(y=4652;y<=4656;y++)k[y]=0;for(y=4766;y<=4800;y++)k[y]=0;for(y=5014;y<=5016;y++)k[y]=0;for(y=5069;y<=5072;y++)k[y]=0;for(y=5105;y<=5130;y++)k[y]=0;for(y=5173;y<=5188;y++)k[y]=0;for(y=5253;y<=5259;y++)k[y]=0;for(y=5269;y<=5275;y++)k[y]=0;for(y=5292;y<=5311;y++)k[y]=0;for(y=5329;y<=5331;y++)k[y]=0;for(y=5343;y<=5349;y++)k[y]=0;for(y=5355;y<=5357;y++)k[y]=0;for(y=5387;y<=5389;y++)k[y]=0;for(y=5459;y<=5463;y++)k[y]=0;for(y=5479;y<=5482;y++)k[y]=0;for(y=5518;y<=5520;y++)k[y]=0;for(y=5530;y<=5539;y++)k[y]=0;for(y=5550;y<=5552;y++)k[y]=0;for(y=5562;y<=5583;y++)k[y]=0;for(y=5623;y<=5625;y++)k[y]=2;for(y=5631;y<=5639;y++)k[y]=0;for(y=5649;y<=5653;y++)k[y]=0;for(y=5663;y<=5680;y++)k[y]=0;for(y=5682;y<=5685;y++)k[y]=0;for(y=5875;y<=5877;y++)k[y]=0;for(y=5896;y<=5899;y++)k[y]=0;for(y=5921;y<=5940;y++)k[y]=0;for(y=6050;y<=6125;y++)k[y]=0;for(y=6244;y<=6275;y++)k[y]=0;for(y=6328;y<=6348;y++)k[y]=0;for(y=6350;y<=6356;y++)k[y]=0;for(y=6366;y<=6372;y++)k[y]=0;for(y=6381;y<=6387;y++)k[y]=0;for(y=6393;y<=6404;y++)k[y]=0;for(y=6480;y<=6483;y++)k[y]=0;for(y=6511;y<=6514;y++)k[y]=0;for(y=6579;y<=6581;y++)k[y]=0;for(y=6619;y<=6624;y++)k[y]=0;for(y=6625;y<=6627;y++)k[y]=2;for(y=6628;y<=6632;y++)k[y]=0;for(y=6634;y<=6637;y++)k[y]=0;for(y=6669;y<=6692;y++)k[y]=0;for(y=6707;y<=6709;y++)k[y]=0;for(y=6720;y<=6723;y++)k[y]=0;for(y=6732;y<=6738;y++)k[y]=0;for(y=6931;y<=6933;y++)k[y]=0;for(y=6956;y<=6959;y++)k[y]=0;for(y=7005;y<=7007;y++)k[y]=0;for(y=7057;y<=7070;y++)k[y]=2;for(y=7074;y<=7082;y++)k[y]=0;for(y=7109;y<=7118;y++)k[y]=0;for(y=7119;y<=7127;y++)k[y]=1;for(y=7374;y<=7376;y++)k[y]=0;for(y=7528;y<=7586;y++)k[y]=0;for(y=7587;y<=7645;y++)k[y]=2;for(y=7692;y<=7696;y++)k[y]=0;for(y=7755;y<=7787;y++)k[y]=0;for(y=7791;y<=7795;y++)k[y]=0;for(y=7799;y<=7801;y++)k[y]=0;for(y=7803;y<=7805;y++)k[y]=0;for(y=7825;y<=7831;y++)k[y]=0;for(y=7845;y<=7859;y++)k[y]=0;for(y=8013;y<=8032;y++)k[y]=0;for(y=8065;y<=8068;y++)k[y]=1;for(y=8518;y<=8529;y++)k[y]=2;for(y=8533;y<=8536;y++)k[y]=2;for(y=8538;y<=8540;y++)k[y]=2;for(y=8677;y<=8679;y++)k[y]=0;for(y=8836;y<=8840;y++)k[y]=0;for(y=8857;y<=8859;y++)k[y]=0;for(y=8908;y<=8910;y++)k[y]=0;for(y=9154;y<=9159;y++)k[y]=0;for(y=9205;y<=9218;y++)k[y]=0;for(y=9271;y<=9273;y++)k[y]=0;for(y=9295;y<=9297;y++)k[y]=0;for(y=9356;y<=9360;y++)k[y]=0;for(y=9404;y<=9407;y++)k[y]=0;for(y=9476;y<=9482;y++)k[y]=0;for(y=9487;y<=9494;y++)k[y]=0;for(y=9697;y<=9699;y++)k[y]=0;for(y=9821;y<=9865;y++)k[y]=0;for(y=20002;y<=20032;y++)k[y]=0;for(y=20047;y<=20049;y++)k[y]=0;for(y=20062;y<=20092;y++)k[y]=0;for(y=20135;y<=20138;y++)k[y]=0;for(y=20248;y<=20258;y++)k[y]=0;for(y=20348;y<=20358;y++)k[y]=0;for(y=20436;y<=20440;y++)k[y]=0;for(y=20822;y<=20824;y++)k[y]=0;for(y=20904;y<=20932;y++)k[y]=0;for(y=20934;y<=20936;y++)k[y]=0;for(y=21004;y<=21032;y++)k[y]=0;for(y=21035;y<=21037;y++)k[y]=0;for(y=21095;y<=21097;y++)k[y]=0;for(y=21148;y<=21150;y++)k[y]=0;for(y=21207;y<=21264;y++)k[y]=0;for(y=21307;y<=21364;y++)k[y]=0;for(y=21413;y<=21423;y++)k[y]=0;for(y=21453;y<=21463;y++)k[y]=0;for(y=21473;y<=21483;y++)k[y]=0;for(y=21780;y<=21782;y++)k[y]=0;for(y=21891;y<=21894;y++)k[y]=0;for(y=21896;y<=21899;y++)k[y]=0;for(y=22171;y<=22177;y++)k[y]=0;for(y=22181;y<=22187;y++)k[y]=0;for(y=22191;y<=22197;y++)k[y]=0;for(y=22207;y<=22222;y++)k[y]=0;for(y=22234;y<=22236;y++)k[y]=0;for(y=22243;y<=22250;y++)k[y]=0;for(y=22262;y<=22265;y++)k[y]=0;for(y=22307;y<=22322;y++)k[y]=0;for(y=22348;y<=22357;y++)k[y]=0;for(y=22407;y<=22422;y++)k[y]=0;for(y=22462;y<=22465;y++)k[y]=0;for(y=22521;y<=22525;y++)k[y]=0;for(y=22607;y<=22622;y++)k[y]=0;for(y=22641;y<=22646;y++)k[y]=0;for(y=22648;y<=22657;y++)k[y]=0;for(y=22707;y<=22722;y++)k[y]=0;for(y=22762;y<=22765;y++)k[y]=0;for(y=22991;y<=22994;y++)k[y]=0;for(y=23028;y<=23038;y++)k[y]=0;for(y=23830;y<=23853;y++)k[y]=0;for(y=23866;y<=23872;y++)k[y]=0;for(y=23877;y<=23884;y++)k[y]=0;for(y=23886;y<=23894;y++)k[y]=0;for(y=23946;y<=23948;y++)k[y]=0;for(y=24311;y<=24313;y++)k[y]=0;for(y=24342;y<=24347;y++)k[y]=0;for(y=24370;y<=24374;y++)k[y]=10;for(y=24375;y<=24381;y++)k[y]=0;for(y=24718;y<=24721;y++)k[y]=0;for(y=24817;y<=24821;y++)k[y]=0;for(y=24877;y<=24882;y++)k[y]=0;for(y=24891;y<=24893;y++)k[y]=0;for(y=25391;y<=25395;y++)k[y]=0;for(y=25828;y<=25838;y++)k[y]=0;for(y=26191;y<=26195;y++)k[y]=0;for(y=26391;y<=26393;y++)k[y]=0;for(y=26701;y<=26722;y++)k[y]=0;for(y=26729;y<=26799;y++)k[y]=2;for(y=26801;y<=26803;y++)k[y]=2;for(y=26811;y<=26813;y++)k[y]=2;for(y=26847;y<=26870;y++)k[y]=2;for(y=26891;y<=26899;y++)k[y]=0;for(y=26901;y<=26923;y++)k[y]=0;for(y=26929;y<=26946;y++)k[y]=0;for(y=26948;y<=26998;y++)k[y]=0;for(y=27037;y<=27040;y++)k[y]=0;for(y=27205;y<=27232;y++)k[y]=0;for(y=27258;y<=27260;y++)k[y]=0;for(y=27391;y<=27398;y++)k[y]=0;for(y=27561;y<=27564;y++)k[y]=0;for(y=27571;y<=27574;y++)k[y]=0;for(y=27581;y<=27584;y++)k[y]=0;for(y=27591;y<=27594;y++)k[y]=0;for(y=28191;y<=28193;y++)k[y]=0;for(y=28348;y<=28358;y++)k[y]=0;for(y=28402;y<=28432;y++)k[y]=0;for(y=28462;y<=28492;y++)k[y]=0;for(y=29118;y<=29122;y++)k[y]=0;for(y=29168;y<=29172;y++)k[y]=0;for(y=29177;y<=29185;y++)k[y]=0;for(y=29187;y<=29195;y++)k[y]=0;for(y=29900;y<=29903;y++)k[y]=0;for(y=30161;y<=30179;y++)k[y]=0;for(y=30491;y<=30494;y++)k[y]=0;for(y=30729;y<=30732;y++)k[y]=0;for(y=31251;y<=31259;y++)k[y]=0;for(y=31265;y<=31268;y++)k[y]=0;for(y=31275;y<=31279;y++)k[y]=0;for(y=31281;y<=31297;y++)k[y]=0;for(y=31461;y<=31469;y++)k[y]=0;for(y=31491;y<=31495;y++)k[y]=0;for(y=31917;y<=31922;y++)k[y]=0;for(y=31965;y<=32e3;y++)k[y]=0;for(y=32001;y<=32003;y++)k[y]=2;for(y=32005;y<=32031;y++)k[y]=2;for(y=32033;y<=32060;y++)k[y]=2;for(y=32064;y<=32067;y++)k[y]=2;for(y=32074;y<=32077;y++)k[y]=2;for(y=32081;y<=32086;y++)k[y]=0;for(y=32107;y<=32130;y++)k[y]=0;for(y=32133;y<=32159;y++)k[y]=0;for(y=32164;y<=32167;y++)k[y]=2;for(y=32180;y<=32199;y++)k[y]=0;for(y=32201;y<=32260;y++)k[y]=0;for(y=32301;y<=32360;y++)k[y]=0;for(y=32601;y<=32662;y++)k[y]=0;for(y=32664;y<=32667;y++)k[y]=2;for(y=32701;y<=32761;y++)k[y]=0;for(y=53001;y<=53004;y++)k[y]=0;for(y=53008;y<=53019;y++)k[y]=0;for(y=53021;y<=53032;y++)k[y]=0;for(y=53034;y<=53037;y++)k[y]=0;for(y=53042;y<=53046;y++)k[y]=0;for(y=53074;y<=53080;y++)k[y]=0;for(y=54001;y<=54004;y++)k[y]=0;for(y=54008;y<=54019;y++)k[y]=0;for(y=54021;y<=54032;y++)k[y]=0;for(y=54034;y<=54037;y++)k[y]=0;for(y=54042;y<=54046;y++)k[y]=0;for(y=54048;y<=54053;y++)k[y]=0;for(y=54074;y<=54080;y++)k[y]=0;for(y=54098;y<=54101;y++)k[y]=0;for(y=102001;y<=102040;y++)k[y]=0;for(y=102042;y<=102063;y++)k[y]=0;for(y=102065;y<=102067;y++)k[y]=0;for(y=102070;y<=102117;y++)k[y]=0;for(y=102122;y<=102216;y++)k[y]=0;for(y=102221;y<=102377;y++)k[y]=0;for(y=102382;y<=102388;y++)k[y]=0;for(y=102389;y<=102398;y++)k[y]=2;for(y=102399;y<=102444;y++)k[y]=0;for(y=102445;y<=102447;y++)k[y]=2;for(y=102448;y<=102458;y++)k[y]=0;for(y=102459;y<=102468;y++)k[y]=2;for(y=102469;y<=102499;y++)k[y]=0;for(y=102500;y<=102519;y++)k[y]=1;for(y=102520;y<=102524;y++)k[y]=0;for(y=102525;y<=102529;y++)k[y]=2;for(y=102530;y<=102588;y++)k[y]=0;for(y=102590;y<=102598;y++)k[y]=0;for(y=102601;y<=102603;y++)k[y]=0;for(y=102605;y<=102628;y++)k[y]=0;for(y=102629;y<=102646;y++)k[y]=2;for(y=102648;y<=102700;y++)k[y]=2;for(y=102701;y<=102703;y++)k[y]=0;for(y=102707;y<=102730;y++)k[y]=2;for(y=102733;y<=102758;y++)k[y]=2;for(y=102767;y<=102900;y++)k[y]=0;for(y=102901;y<=102933;y++)k[y]=2;for(y=102934;y<=102950;y++)k[y]=13;for(y=102951;y<=102955;y++)k[y]=0;for(y=102961;y<=102963;y++)k[y]=0;for(y=102965;y<=102969;y++)k[y]=0;for(y=102971;y<=102973;y++)k[y]=0;for(y=102975;y<=102989;y++)k[y]=0;for(y=102990;y<=102992;y++)k[y]=1;for(y=102997;y<=103002;y++)k[y]=0;for(y=103003;y<=103008;y++)k[y]=2;for(y=103009;y<=103011;y++)k[y]=0;for(y=103012;y<=103014;y++)k[y]=2;for(y=103019;y<=103021;y++)k[y]=0;for(y=103022;y<=103024;y++)k[y]=2;for(y=103029;y<=103031;y++)k[y]=0;for(y=103032;y<=103034;y++)k[y]=2;for(y=103065;y<=103068;y++)k[y]=0;for(y=103074;y<=103076;y++)k[y]=0;for(y=103077;y<=103079;y++)k[y]=1;for(y=103080;y<=103082;y++)k[y]=0;for(y=103083;y<=103085;y++)k[y]=2;for(y=103090;y<=103093;y++)k[y]=0;for(y=103097;y<=103099;y++)k[y]=0;for(y=103100;y<=103102;y++)k[y]=2;for(y=103107;y<=103109;y++)k[y]=0;for(y=103110;y<=103112;y++)k[y]=2;for(y=103113;y<=103116;y++)k[y]=0;for(y=103117;y<=103120;y++)k[y]=2;for(y=103153;y<=103157;y++)k[y]=0;for(y=103158;y<=103162;y++)k[y]=2;for(y=103163;y<=103165;y++)k[y]=0;for(y=103166;y<=103168;y++)k[y]=1;for(y=103169;y<=103171;y++)k[y]=2;for(y=103186;y<=103188;y++)k[y]=0;for(y=103189;y<=103191;y++)k[y]=2;for(y=103192;y<=103195;y++)k[y]=0;for(y=103196;y<=103199;y++)k[y]=2;for(y=103200;y<=103224;y++)k[y]=0;for(y=103225;y<=103227;y++)k[y]=1;for(y=103232;y<=103237;y++)k[y]=0;for(y=103238;y<=103243;y++)k[y]=2;for(y=103244;y<=103246;y++)k[y]=0;for(y=103247;y<=103249;y++)k[y]=2;for(y=103254;y<=103256;y++)k[y]=0;for(y=103257;y<=103259;y++)k[y]=2;for(y=103264;y<=103266;y++)k[y]=0;for(y=103267;y<=103269;y++)k[y]=2;for(y=103300;y<=103375;y++)k[y]=0;for(y=103381;y<=103383;y++)k[y]=0;for(y=103384;y<=103386;y++)k[y]=1;for(y=103387;y<=103389;y++)k[y]=0;for(y=103390;y<=103392;y++)k[y]=2;for(y=103397;y<=103399;y++)k[y]=0;for(y=103400;y<=103471;y++)k[y]=2;for(y=103476;y<=103478;y++)k[y]=0;for(y=103479;y<=103481;y++)k[y]=2;for(y=103486;y<=103488;y++)k[y]=0;for(y=103489;y<=103491;y++)k[y]=2;for(y=103492;y<=103495;y++)k[y]=0;for(y=103496;y<=103499;y++)k[y]=2;for(y=103528;y<=103543;y++)k[y]=0;for(y=103544;y<=103548;y++)k[y]=2;for(y=103549;y<=103551;y++)k[y]=0;for(y=103552;y<=103554;y++)k[y]=1;for(y=103555;y<=103557;y++)k[y]=2;for(y=103558;y<=103560;y++)k[y]=0;for(y=103571;y<=103573;y++)k[y]=0;for(y=103574;y<=103576;y++)k[y]=2;for(y=103577;y<=103580;y++)k[y]=0;for(y=103581;y<=103583;y++)k[y]=2;for(y=103595;y<=103694;y++)k[y]=0;for(y=103696;y<=103699;y++)k[y]=0;for(y=103700;y<=103793;y++)k[y]=2;for(y=103794;y<=103890;y++)k[y]=0;for(y=103891;y<=103896;y++)k[y]=2;for(y=103900;y<=103971;y++)k[y]=2;for(y=103972;y<=103977;y++)k[y]=0;for(y=112e3;y<=112101;y++)k[y]=0;const Hje={102113:!0,102100:!0,3857:!0,3785:!0},qje={4326:!0,3785:!0,3857:!0,102113:!0,102100:!0,104905:!0,104971:!0},Phe='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',OF=[-20037508342788905e-9,20037508342788905e-9],MF=[-20037508342787e-6,20037508342787e-6],C2e={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:OF,origin:MF,dx:1e-5},102100:{wkTemplate:Phe,valid:OF,origin:MF,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:OF,origin:MF,dx:1e-5},3857:{wkTemplate:Phe,valid:OF,origin:MF,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function In(t,e){return t===e||!R(t)&&!R(e)&&(t.wkid!=null||e.wkid!=null?t.wkid===e.wkid||Wb(t)&&Wb(e)||e.latestWkid!=null&&t.wkid===e.latestWkid||t.latestWkid!=null&&e.wkid===t.latestWkid:!(!t.wkt||!e.wkt)&&t.wkt.toUpperCase()===e.wkt.toUpperCase())}function fp(t){return $a(t)&&t.wkid&&C2e[t.wkid]||null}function A2e(t){return!!$a(t)&&(t.wkid?k[t.wkid]==null:!!t.wkt&&!!/^\s*GEOGCS/i.test(t.wkt))}function NL(t){return!(my(t)||gy(t))}function FL(t){return $a(t)&&t.wkid===4326}function R2e(t){return $a(t)&&t.wkid===sp.CGCS2000}function Wb(t){return $a(t)&&t.wkid!=null&&Hje[t.wkid]===!0}function Xie(t){return $a(t)&&t.wkid===32662}function Yie(t){return t===sp.GCSMARS2000||t===sp.GCSMARS2000_SPHERE}function my(t){return $a(t)&&t.wkid!=null&&Yie(t.wkid)}function Zie(t){return t===sp.GCSMOON2000}function gy(t){return $a(t)&&t.wkid!=null&&Zie(t.wkid)}function Wje(t){return $a(t)&&t.wkid!=null&&qje[t.wkid]===!0}function $a(t){return v(t)&&(t.wkid!=null&&t.wkid>=2e3||t.wkt!=null)}const Xje={wkid:4326,wkt:ty(C2e[4326].wkTemplate,{Central_Meridian:"0.0"})},Yje={wkid:102100,latestWkid:3857},Zje={wkid:32662};function Jie(t){return{wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${t.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`}}const O2e=Jie(Cr),Kie=Jie(jg),Qie=Jie(b_),M2e={wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${Cr.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`};function ii(t){return v(t)&&(my(t)||In(t,Kie))?jg:v(t)&&(gy(t)||In(t,Qie))?b_:Cr}function F8t(t){return Yie(t)?jg:Zie(t)?b_:Cr}const ene=39.37,Jje=Cr.radius*Math.PI/200,P2e=/UNIT\[([^\]]+)\]\]$/i,CS=k,I2e=/UNIT\[([^\]]+)\]/i,Kje=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),Qje=ja()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),Cm=t=>t*t,iv=t=>t*t*t,kL={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:Cm(.001)},"square-centimeters":{inBaseUnits:Cm(.01)},"square-decimeters":{inBaseUnits:Cm(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:Cm(1e3)},"square-inches":{inBaseUnits:Cm(.0254)},"square-feet":{inBaseUnits:Cm(.3048)},"square-yards":{inBaseUnits:Cm(.9144)},"square-miles":{inBaseUnits:Cm(1609.344)},"square-us-feet":{inBaseUnits:Cm(1200/3937)},acres:{inBaseUnits:.0015625*Cm(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*iv(.001)},"cubic-centimeters":{inBaseUnits:1e3*iv(.01)},"cubic-decimeters":{inBaseUnits:1e3*iv(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*iv(1e3)},"cubic-inches":{inBaseUnits:1e3*iv(.0254)},"cubic-feet":{inBaseUnits:1e3*iv(.3048)},"cubic-yards":{inBaseUnits:1e3*iv(.9144)},"cubic-miles":{inBaseUnits:1e3*iv(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},eGe=(()=>{const t={};for(const e in kL)for(const r in kL[e].units)t[r]=e;return t})();function tGe(t,e,r){return t*kL[r].units[e].inBaseUnits}function rGe(t,e,r){return t/kL[r].units[e].inBaseUnits}const iGe=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"];function yY(t){const e=eGe[t];if(!e)throw new Error("unknown type");return e}function Ihe(t,e=null){return e=e||yY(t),kL[e].baseUnit===t}function Vs(t,e,r){if(e===r)return t;const i=yY(e);if(i!==yY(r))throw new Error("incompatible units");const n=Ihe(e,i)?t:tGe(t,e,i);return Ihe(r,i)?n:rGe(n,r,i)}function k8t(t,e,r){switch(r){case"metric":return $2e(t,e);case"imperial":return D2e(t,e);default:return r}}function U8t(t,e,r){switch(r){case"metric":return L2e(t,e);case"imperial":return N2e(t,e);default:return r}}function $2e(t,e){const r=Vs(t,e,"meters");return Math.abs(r)<3e3?"meters":"kilometers"}function L2e(t,e){const r=Vs(t,e,"meters");return Math.abs(r)<1e5?"meters":"kilometers"}function D2e(t,e){const r=Vs(t,e,"feet");return Math.abs(r)<1e3?"feet":"miles"}function N2e(t,e){const r=Vs(t,e,"feet");return Math.abs(r)<1e5?"feet":"miles"}function z8t(t,e){const r=Vs(t,e,"square-meters");return Math.abs(r)<3e6?"square-meters":"square-kilometers"}function V8t(t,e){const r=Vs(t,e,"square-feet");return Math.abs(r)<1e6?"square-feet":"square-miles"}function nGe(t,e,r){return Vs(t,e,"meters")/(r*Math.PI/180)}function F2e(t){return Qje.fromJSON(t.toLowerCase())||null}function JS(t){if(v(t)&&!NL(t))return 1;const e=Kl(t);return e>1e5?1:e}function sGe(t){return Kl(t)>=ii(t).metersPerDegree?"meters":A9(t)}function Kl(t,e=Cr.metersPerDegree){return Nt(oGe(t,!0),e)}function oGe(t,e=!1){const r=v(t)?t.wkid:null,i=v(t)?t.wkt:null;let n=null;if(r){if(Yie(r))return jg.metersPerDegree;if(Zie(r))return b_.metersPerDegree;n=CS.values[CS[r]],!n&&e&&Kje.has(r)&&(n=Jje)}else i&&(z2e(i)?n=$he(P2e.exec(i),n):U2e(i)&&(n=$he(I2e.exec(i),n)));return n}function $he(t,e){return t&&t[1]?k2e(t[1]):e}function k2e(t){return parseFloat(t.split(",")[1])}function A9(t){const e=v(t)?t.wkid:null,r=v(t)?t.wkt:null;let i=null;if(e)i=CS.units[CS[e]];else if(r){const n=z2e(r)?P2e:U2e(r)?I2e:null;if(n){const s=n.exec(r);s&&s[1]&&(i=lGe(s[1]))}}return v(i)?F2e(i):null}function B8t(t){const e=A9(t);return R(e)||!iGe.includes(e)?null:e}function U2e(t){return/^GEOCCS/i.test(t)}function z2e(t){return/^PROJCS/i.test(t)}const aGe=1e-7;function lGe(t){const e=/[\\"\\']{1}([^\\"\\']+)/.exec(t);let r=e&&e[1];if(!r||!CS.units.includes(r)){const i=k2e(t);r=null;const n=CS.values;for(let s=0;s<n.length;++s)if(Math.abs(i-n[s])<aGe){r=CS.units[s];break}}return r}function j8t(t){const e=A9(t);if(R(e))return null;switch(e){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}const cGe={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},uGe={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},hGe={esriDUDecimalDegrees:"degrees",esriDURadians:"radians"},dGe=ja()(cGe),pGe=ja()(uGe),G8t=ja()(hGe);function De(t,e,r){let i,n;return e===void 0?(n=t,i=[void 0]):typeof e!="string"?(n=t,i=[void 0],r=e):(n=e,i=Array.isArray(t)?t:[t]),(s,o)=>{const a=s.constructor.prototype;for(const l of i){const c=zSe(s,l,n);c.write&&typeof c.write=="object"||(c.write={}),r&&(c.write.target=r),c.write.writer=a[o]}}}var Hm;let Ni=Hm=class extends fe{static fromJSON(t){if(!t)return null;if(t.wkid){if(t.wkid===102100)return Hm.WebMercator;if(t.wkid===4326)return Hm.WGS84}const e=new Hm;return e.read(t),e}constructor(t){super(t),this.latestWkid=null,this.wkid=null,this.wkt=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}normalizeCtorArgs(t){return t&&typeof t=="object"?t:{[typeof t=="string"?"wkt":"wkid"]:t}}get isWGS84(){return FL(this)}get isWebMercator(){return Wb(this)}get isGeographic(){return A2e(this)}get isWrappable(){return Wje(this)}get metersPerUnit(){return Kl(this)}get unit(){return A9(this)||(this.isGeographic?"degrees":null)}writeWkt(t,e){this.wkid||(e.wkt=t)}clone(){if(this===Hm.WGS84)return Hm.WGS84;if(this===Hm.WebMercator)return Hm.WebMercator;const t=new Hm;return this.wkid!=null?(t.wkid=this.wkid,this.latestWkid!=null&&(t.latestWkid=this.latestWkid),this.vcsWkid!=null&&(t.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(t.latestVcsWkid=this.latestVcsWkid)):this.wkt!=null&&(t.wkt=this.wkt),this.imageCoordinateSystem&&(t.imageCoordinateSystem=se(this.imageCoordinateSystem)),t}equals(t){if(t==null)return!1;if(this.imageCoordinateSystem||t.imageCoordinateSystem){if(this.imageCoordinateSystem==null||t.imageCoordinateSystem==null)return!1;const{id:e,referenceServiceName:r}=t.imageCoordinateSystem,{geodataXform:i}=t.imageCoordinateSystem,n=this.imageCoordinateSystem;return e==null||i?JSON.stringify(n)===JSON.stringify(t.imageCoordinateSystem):r?n.id===e&&n.referenceServiceName===r:n.id===e}return In(this,t)}toJSON(t){return this.write(void 0,t)}};Ni.GCS_NAD_1927=null,Ni.WGS84=null,Ni.WebMercator=null,Ni.PlateCarree=null,u([d({readOnly:!0})],Ni.prototype,"isWGS84",null),u([d({readOnly:!0})],Ni.prototype,"isWebMercator",null),u([d({readOnly:!0})],Ni.prototype,"isGeographic",null),u([d({readOnly:!0})],Ni.prototype,"isWrappable",null),u([d({type:Xi,json:{write:!0}})],Ni.prototype,"latestWkid",void 0),u([d({readOnly:!0})],Ni.prototype,"metersPerUnit",null),u([d({readOnly:!0})],Ni.prototype,"unit",null),u([d({type:Xi,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt===null}}}}}}})],Ni.prototype,"wkid",void 0),u([d({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid===null}}}}}}})],Ni.prototype,"wkt",void 0),u([De("wkt"),De("web-scene","wkt")],Ni.prototype,"writeWkt",null),u([d({type:Xi,json:{write:!0}})],Ni.prototype,"vcsWkid",void 0),u([d({type:Xi,json:{write:!0}})],Ni.prototype,"latestVcsWkid",void 0),u([d()],Ni.prototype,"imageCoordinateSystem",void 0),Ni=Hm=u([$("esri.geometry.SpatialReference")],Ni),Ni.prototype.toJSON.isDefaultToJSON=!0,Ni.GCS_NAD_1927=new Ni({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),Ni.WGS84=new Ni(Xje),Ni.WebMercator=new Ni(Yje),Ni.PlateCarree=new Ni(Zje),Object.freeze&&(Object.freeze(Ni.GCS_NAD_1927),Object.freeze(Ni.WGS84),Object.freeze(Ni.WebMercator));const Je=Ni;let qm=class extends fe{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=Je.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,r){if(e instanceof Je)return e;if(e!=null){const i=new Je;return i.read(e,r),i}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,r){this.cache[e]=r}};u([d()],qm.prototype,"type",void 0),u([d({readOnly:!0})],qm.prototype,"cache",null),u([d({readOnly:!0})],qm.prototype,"extent",null),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],qm.prototype,"hasM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],qm.prototype,"hasZ",void 0),u([d({type:Je,json:{write:!0},value:Je.WGS84})],qm.prototype,"spatialReference",void 0),u([Me("spatialReference")],qm.prototype,"readSpatialReference",null),qm=u([$("esri.geometry.Geometry")],qm);const $_=qm,fGe=Object.prototype.toString;function mGe(t){const e="__accessorMetadata__"in t?bs(t):t;return function(...r){if(r.push(e),typeof r[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return gGe.apply(this,r)}}function gGe(t,e,r,i){x9(t,e).cast=i}function yGe(t){return(e,r)=>{x9(e,t).cast=e[r]}}function cr(...t){if(t.length!==3||typeof t[1]!="string")return t.length===1&&fGe.call(t[0])==="[object Function]"?mGe(t[0]):t.length===1&&typeof t[0]=="string"?yGe(t[0]):void 0}function _Ge(t,e){const r=t.x-e.x,i=t.y-e.y,n=t.hasZ&&e.hasZ?t.z-e.z:0;return Math.sqrt(r*r+i*i+n*n)}const vGe=57.29577951308232,bGe=.017453292519943;function Lhe(t){return t*vGe}function Dhe(t){return t*bGe}function Nhe(t){return t/Cr.radius}function q8(t){return Math.PI/2-2*Math.atan(Math.exp(-t/Cr.radius))}function _Y(t){return t.wkid!=null||t.wkt!=null}const Aj=[0,0];function W8(t,e,r,i,n){const s=t,o=n;if(o.spatialReference=r,"x"in s&&"x"in o)[o.x,o.y]=e(s.x,s.y,Aj,i);else if("xmin"in s&&"xmin"in o)[o.xmin,o.ymin]=e(s.xmin,s.ymin,Aj,i),[o.xmax,o.ymax]=e(s.xmax,s.ymax,Aj,i);else if("paths"in s&&"paths"in o||"rings"in s&&"rings"in o){const a="paths"in s?s.paths:s.rings,l=[];let c;for(let h=0;h<a.length;h++){const p=a[h];c=[],l.push(c);for(let f=0;f<p.length;f++)c.push(e(p[f][0],p[f][1],[0,0],i)),p[f].length>2&&c[f].push(p[f][2]),p[f].length>3&&c[f].push(p[f][3])}"paths"in o?o.paths=l:o.rings=l}else if("points"in s&&"points"in o){const a=s.points,l=[];for(let c=0;c<a.length;c++)l[c]=e(a[c][0],a[c][1],[0,0],i),a[c].length>2&&l[c].push(a[c][2]),a[c].length>3&&l[c].push(a[c][3]);o.points=l}return n}function Ib(t,e){const r=t&&(_Y(t)?t:t.spatialReference),i=e&&(_Y(e)?e:e.spatialReference);return!(t&&"type"in t&&t.type==="mesh"||e&&"type"in e&&e.type==="mesh"||!r||!i)&&(!!In(i,r)||Wb(i)&&FL(r)||Wb(r)&&FL(i))}function D2(t,e){if(R(t))return null;const r=t.spatialReference,i=e&&(_Y(e)?e:e.spatialReference);return Ib(r,i)?In(r,i)?se(t):Wb(i)?W8(t,GA,Je.WebMercator,!1,se(t)):FL(i)?W8(t,g$,Je.WGS84,!1,se(t)):null:null}function GA(t,e,r=[0,0]){e>89.99999?e=89.99999:e<-89.99999&&(e=-89.99999);const i=Dhe(e);return r[0]=Dhe(t)*Cr.radius,r[1]=Cr.halfSemiMajorAxis*Math.log((1+Math.sin(i))/(1-Math.sin(i))),r}function g$(t,e,r=[0,0],i=!1){const n=Lhe(t/Cr.radius);return r[0]=i?n:n-360*Math.floor((n+180)/360),r[1]=Lhe(Math.PI/2-2*Math.atan(Math.exp(-e/Cr.radius))),r}function Gg(t,e=!1,r=se(t)){return W8(t,GA,Je.WebMercator,e,r)}function uS(t,e=!1,r=se(t)){return W8(t,g$,Je.WGS84,e,r)}var n6;const iM=[0,0];function Fhe(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let mc=n6=class extends $_{static copy(t,e){e._set("x",t._get("x")),e._set("y",t._get("y")),e._set("z",t._get("z")),e._set("m",t._get("m"));const r=t._get("spatialReference");e._set("spatialReference",Object.isFrozen(r)?r:r.clone())}constructor(...t){super(...t),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}normalizeCtorArgs(t,e,r,i,n){let s;if(Array.isArray(t))s=t,n=e,t=s[0],e=s[1],r=s[2],i=s[3];else if(t&&typeof t=="object"){if(s=t,t=s.x!=null?s.x:s.longitude,e=s.y!=null?s.y:s.latitude,r=s.z,i=s.m,(n=s.spatialReference)&&n.declaredClass!=="esri.geometry.SpatialReference"&&(n=new Je(n)),s.longitude!=null||s.latitude!=null){if(s.longitude==null)re.getLogger(this.declaredClass).warn(".longitude=","Latitude was defined without longitude");else if(s.latitude==null)re.getLogger(this.declaredClass).warn(".latitude=","Longitude was defined without latitude");else if(!s.declaredClass&&n&&n.isWebMercator){const a=GA(s.longitude,s.latitude,iM);t=a[0],e=a[1]}}}else Fhe(r)?(n=r,r=null):Fhe(i)&&(n=i,i=null);const o={x:t,y:e};return o.x==null&&o.y!=null?re.getLogger(this.declaredClass).warn(".y=","Y coordinate was defined without an X coordinate"):o.y==null&&o.x!=null&&re.getLogger(this.declaredClass).warn(".x=","X coordinate was defined without a Y coordinate"),n!=null&&(o.spatialReference=n),r!=null&&(o.z=r),i!=null&&(o.m=i),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(t){t!==(this._get("m")!==void 0)&&(this._set("m",t?0:void 0),this._set("hasM",t))}get hasZ(){return this.z!==void 0}set hasZ(t){t!==(this._get("z")!==void 0)&&(this._set("z",t?0:void 0),this._set("hasZ",t))}get latitude(){const{spatialReference:t,x:e,y:r}=this;if(t){if(t.isWebMercator)return g$(e,r,iM)[1];if(t.isGeographic)return r}return null}set latitude(t){const{spatialReference:e,x:r}=this;t!=null&&e&&(e.isWebMercator?this._set("y",GA(r,t,iM)[1]):e.isGeographic&&this._set("y",t),this._set("latitude",t))}get longitude(){const{x:t,y:e,spatialReference:r}=this;if(r){if(r.isWebMercator)return g$(t,e,iM)[0];if(r.isGeographic)return t}return null}set longitude(t){const{y:e,spatialReference:r}=this;t!=null&&r&&(r.isWebMercator?this._set("x",GA(t,e,iM)[0]):r.isGeographic&&this._set("x",t),this._set("longitude",t))}writeX(t,e,r){e[r]=isNaN(t)?"NaN":t}readX(t){return typeof t=="string"?NaN:t}clone(){const t=new n6;return t.x=this.x,t.y=this.y,t.z=this.z,t.m=this.m,t.spatialReference=this.spatialReference,t}copy(t){return n6.copy(t,this),this}equals(t){if(R(t))return!1;const{x:e,y:r,z:i,m:n,spatialReference:s}=this,{z:o,m:a}=t;let{x:l,y:c,spatialReference:h}=t;if(!s.equals(h))if(s.isWebMercator&&h.isWGS84)[l,c]=GA(l,c),h=s;else{if(!s.isWGS84||!h.isWebMercator)return!1;[l,c]=g$(l,c),h=s}return e===l&&r===c&&i===o&&n===a&&s.wkid===h.wkid}offset(t,e,r){return this.x+=t,this.y+=e,r!=null&&(this.z=(this.z??0)+r),this}normalize(){if(!this.spatialReference)return this;const t=fp(this.spatialReference);if(!t)return this;let e=this.x;const[r,i]=t.valid,n=2*i;let s;return e>i?(s=Math.ceil(Math.abs(e-i)/n),e-=s*n):e<r&&(s=Math.ceil(Math.abs(e-r)/n),e+=s*n),this._set("x",e),this}distance(t){return _Ge(this,t)}toArray(){const t=this.hasZ,e=this.hasM;return t&&e?[this.x,this.y,this.z,this.m]:t?[this.x,this.y,this.z]:e?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(t){return this.write({},t)}};u([d({readOnly:!0})],mc.prototype,"cache",null),u([d({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],mc.prototype,"hasM",null),u([d({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],mc.prototype,"hasZ",null),u([d({type:Number})],mc.prototype,"latitude",null),u([d({type:Number})],mc.prototype,"longitude",null),u([d({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),cr(t=>isNaN(t)?t:Jd(t))],mc.prototype,"x",void 0),u([De("x")],mc.prototype,"writeX",null),u([Me("x")],mc.prototype,"readX",null),u([d({type:Number,json:{write:!0}})],mc.prototype,"y",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],mc.prototype,"z",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],mc.prototype,"m",void 0),mc=n6=u([$("esri.geometry.Point")],mc),mc.prototype.toJSON.isDefaultToJSON=!0;const Ue=mc,Rj=[0,0];function R9(t,e){return!!v(e)&&kl(t,e.x,e.y,e.z)}function q8t(t,e){if(!e.points||e.points.length)return!1;for(const r of e.points)if(!lO(t,r))return!1;return!0}function wGe(t,e){const{xmin:r,ymin:i,zmin:n,xmax:s,ymax:o,zmax:a}=e;return t.hasZ&&e.hasZ?kl(t,r,i,n)&&kl(t,r,o,n)&&kl(t,s,o,n)&&kl(t,s,i,n)&&kl(t,r,i,a)&&kl(t,r,o,a)&&kl(t,s,o,a)&&kl(t,s,i,a):kl(t,r,i)&&kl(t,r,o)&&kl(t,s,o)&&kl(t,s,i)}function lO(t,e){return kl(t,e[0],e[1])}function xGe(t,e){return kl(t,e[0],e[1],e[2])}function kl(t,e,r,i){return e>=t.xmin&&e<=t.xmax&&r>=t.ymin&&r<=t.ymax&&(i==null||!t.hasZ||i>=t.zmin&&i<=t.zmax)}function V2e(t,e){return Rj[1]=e.y,Rj[0]=e.x,TGe(t,Rj)}function TGe(t,e){return B2e(t.rings,e)}function B2e(t,e){if(!t)return!1;if(SGe(t))return khe(!1,t,e);let r=!1;for(let i=0,n=t.length;i<n;i++)r=khe(r,t[i],e);return r}function SGe(t){return!Array.isArray(t[0][0])}function khe(t,e,r){const[i,n]=r;let s=t,o=0;for(let a=0,l=e.length;a<l;a++){o++,o===l&&(o=0);const[c,h]=e[a],[p,f]=e[o];(h<n&&f>=n||f<n&&h>=n)&&c+(n-h)/(f-h)*(p-c)<i&&(s=!s)}return s}function EGe(t,e){return R9(t,e)}function CGe(t,e){const r=t.hasZ&&e.hasZ;let i,n,s;if(t.xmin<=e.xmin){if(i=e.xmin,t.xmax<i)return!1}else if(i=t.xmin,e.xmax<i)return!1;if(t.ymin<=e.ymin){if(n=e.ymin,t.ymax<n)return!1}else if(n=t.ymin,e.ymax<n)return!1;if(r&&e.hasZ){if(t.zmin<=e.zmin){if(s=e.zmin,t.zmax<s)return!1}else if(s=t.zmin,e.zmax<s)return!1}return!0}function AGe(t,e){const{points:r,hasZ:i}=e,n=i?xGe:lO;for(const s of r)if(n(t,s))return!0;return!1}const KS=[0,0],QS=[0,0],e2=[0,0],t2=[0,0],RGe=[KS,QS,e2,t2],j2e=[[e2,KS],[KS,QS],[QS,t2],[t2,e2]];function G2e(t,e){return OGe(t,e.rings)}function OGe(t,e){KS[0]=t.xmin,KS[1]=t.ymax,QS[0]=t.xmax,QS[1]=t.ymax,e2[0]=t.xmin,e2[1]=t.ymin,t2[0]=t.xmax,t2[1]=t.ymin;for(const r of RGe)if(B2e(e,r))return!0;for(const r of e){if(!r.length)continue;let i=r[0];if(lO(t,i))return!0;for(let n=1;n<r.length;n++){const s=r[n];if(lO(t,s)||H2e(i,s,j2e))return!0;i=s}}return!1}function MGe(t,e){KS[0]=t.xmin,KS[1]=t.ymax,QS[0]=t.xmax,QS[1]=t.ymax,e2[0]=t.xmin,e2[1]=t.ymin,t2[0]=t.xmax,t2[1]=t.ymin;const r=e.paths;for(const i of r){if(!r.length)continue;let n=i[0];if(lO(t,n))return!0;for(let s=1;s<i.length;s++){const o=i[s];if(lO(t,o)||H2e(n,o,j2e))return!0;n=o}}return!1}const Ta=[0,0];function PGe(t){for(let e=0;e<t.length;e++){const r=t[e];for(let n=0;n<r.length-1;n++){const s=r[n],o=r[n+1];for(let a=e+1;a<t.length;a++)for(let l=0;l<t[a].length-1;l++){const c=t[a][l],h=t[a][l+1];if(vY(s,o,c,h,Ta)&&!(Ta[0]===s[0]&&Ta[1]===s[1]||Ta[0]===c[0]&&Ta[1]===c[1]||Ta[0]===o[0]&&Ta[1]===o[1]||Ta[0]===h[0]&&Ta[1]===h[1]))return!0}}const i=r.length;if(!(i<=4))for(let n=0;n<i-3;n++){let s=i-1;n===0&&(s=i-2);const o=r[n],a=r[n+1];for(let l=n+2;l<s;l++){const c=r[l],h=r[l+1];if(vY(o,a,c,h,Ta)&&!(Ta[0]===o[0]&&Ta[1]===o[1]||Ta[0]===c[0]&&Ta[1]===c[1]||Ta[0]===a[0]&&Ta[1]===a[1]||Ta[0]===h[0]&&Ta[1]===h[1]))return!0}}}return!1}function H2e(t,e,r){for(let i=0;i<r.length;i++)if(vY(t,e,r[i][0],r[i][1]))return!0;return!1}function vY(t,e,r,i,n){const[s,o]=t,[a,l]=e,[c,h]=r,[p,f]=i,m=p-c,g=s-c,_=a-s,b=f-h,w=o-h,x=l-o,T=b*_-m*x;if(T===0)return!1;const E=(m*w-b*g)/T,C=(_*w-x*g)/T;return E>=0&&E<=1&&C>=0&&C<=1&&(n&&(n[0]=s+E*(a-s),n[1]=o+E*(l-o)),!0)}function IGe(t){switch(t){case"esriGeometryEnvelope":case"extent":return CGe;case"esriGeometryMultipoint":case"multipoint":return AGe;case"esriGeometryPoint":case"point":return EGe;case"esriGeometryPolygon":case"polygon":return G2e;case"esriGeometryPolyline":case"polyline":return MGe}}var Cd;function $Ge(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}function nv(t,e,r){return e==null?r:r==null?e:t(e,r)}let Ho=Cd=class extends $_{constructor(...t){super(...t),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(t,e,r,i,n){return $Ge(t)?{spatialReference:t,xmin:0,ymin:0,xmax:0,ymax:0}:typeof t=="object"?(t.spatialReference=t.spatialReference==null?Je.WGS84:t.spatialReference,t):{xmin:t,ymin:e,xmax:r,ymax:i,spatialReference:n??Je.WGS84}}static fromBounds(t,e){return new Cd({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}static fromPoint(t){return new Cd({xmin:t.x,ymin:t.y,zmin:t.z,xmax:t.x,ymax:t.y,zmax:t.z,spatialReference:t.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const t=new Ue({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(t.z=.5*(this.zmin+this.zmax)),this.hasM&&(t.m=.5*(this.mmin+this.mmax)),t}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(t){const e=this.center;return t.z!=null&&this.hasZ?this.offset(t.x-e.x,t.y-e.y,t.z-e.z):this.offset(t.x-e.x,t.y-e.y)}clone(){const t=new Cd;return t.xmin=this.xmin,t.ymin=this.ymin,t.xmax=this.xmax,t.ymax=this.ymax,t.spatialReference=this.spatialReference,this.zmin!=null&&(t.zmin=this.zmin,t.zmax=this.zmax),this.mmin!=null&&(t.mmin=this.mmin,t.mmax=this.mmax),t}contains(t){if(!t)return!1;const e=this.spatialReference,r=t.spatialReference;return e&&r&&!e.equals(r)&&Ib(e,r)&&(t=e.isWebMercator?Gg(t):uS(t,!0)),t.type==="point"?R9(this,t):t.type==="extent"&&wGe(this,t)}equals(t){if(this===t)return!0;if(R(t))return!1;const e=this.spatialReference,r=t.spatialReference;return e&&r&&!e.equals(r)&&Ib(e,r)&&(t=e.isWebMercator?Gg(t):uS(t,!0)),this.xmin===t.xmin&&this.ymin===t.ymin&&this.zmin===t.zmin&&this.mmin===t.mmin&&this.xmax===t.xmax&&this.ymax===t.ymax&&this.zmax===t.zmax&&this.mmax===t.mmax}expand(t){const e=.5*(1-t),r=this.width*e,i=this.height*e;if(this.xmin+=r,this.ymin+=i,this.xmax-=r,this.ymax-=i,this.hasZ){const n=(this.zmax-this.zmin)*e;this.zmin+=n,this.zmax-=n}if(this.hasM){const n=(this.mmax-this.mmin)*e;this.mmin+=n,this.mmax-=n}return this}intersects(t){if(R(t))return!1;t.type==="mesh"&&(t=t.extent);const e=this.spatialReference,r=t.spatialReference;return e&&r&&!In(e,r)&&Ib(e,r)&&(t=e.isWebMercator?Gg(t):uS(t,!0)),IGe(t.type)(this,t)}normalize(){const t=this._normalize(!1,!0);return Array.isArray(t)?t:[t]}offset(t,e,r){return this.xmin+=t,this.ymin+=e,this.xmax+=t,this.ymax+=e,r!=null&&(this.zmin+=r,this.zmax+=r),this}shiftCentralMeridian(){return this._normalize(!0)}union(t){return this===t||(this.xmin=Math.min(this.xmin,t.xmin),this.ymin=Math.min(this.ymin,t.ymin),this.xmax=Math.max(this.xmax,t.xmax),this.ymax=Math.max(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=nv(Math.min,this.zmin,t.zmin),this.zmax=nv(Math.max,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=nv(Math.min,this.mmin,t.mmin),this.mmax=nv(Math.max,this.mmax,t.mmax))),this}intersection(t){return this===t?this:R(t)||!this.intersects(t)?null:(this.xmin=Math.max(this.xmin,t.xmin),this.ymin=Math.max(this.ymin,t.ymin),this.xmax=Math.min(this.xmax,t.xmax),this.ymax=Math.min(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=nv(Math.max,this.zmin,t.zmin),this.zmax=nv(Math.min,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=nv(Math.max,this.mmin,t.mmin),this.mmax=nv(Math.min,this.mmax,t.mmax)),this)}toJSON(t){return this.write({},t)}_shiftCM(t=fp(this.spatialReference)){if(!t||!this.spatialReference)return this;const e=this.spatialReference,r=this._getCM(t);if(r){const i=e.isWebMercator?uS(r):r;this.xmin-=r.x,this.xmax-=r.x,e.isWebMercator||(i.x=this._normalizeX(i.x,t).x),this.spatialReference=new Je(ty((e.isWGS84?t.altTemplate:null)??t.wkTemplate,{Central_Meridian:i.x}))}return this}_getCM(t){let e=null;const[r,i]=t.valid,n=this.xmin,s=this.xmax;return n>=r&&n<=i&&s>=r&&s<=i||(e=this.center),e}_normalize(t,e,r){const i=this.spatialReference;if(!i)return this;const n=r??fp(i);if(n==null)return this;const s=this._getParts(n).map(l=>l.extent);if(s.length<2)return s[0]||this;if(s.length>2)return t?this._shiftCM(n):this.set({xmin:n.valid[0],xmax:n.valid[1]});if(t)return this._shiftCM(n);if(e)return s;let o=!0,a=!0;return s.forEach(l=>{l.hasZ||(o=!1),l.hasM||(a=!1)}),{rings:s.map(l=>{const c=[[l.xmin,l.ymin],[l.xmin,l.ymax],[l.xmax,l.ymax],[l.xmax,l.ymin],[l.xmin,l.ymin]];if(o){const h=(l.zmax-l.zmin)/2;for(let p=0;p<c.length;p++)c[p].push(h)}if(a){const h=(l.mmax-l.mmin)/2;for(let p=0;p<c.length;p++)c[p].push(h)}return c}),hasZ:o,hasM:a,spatialReference:i}}_getParts(t){let e=this.cache._parts;if(!e){e=[];const{ymin:n,ymax:s,spatialReference:o}=this,a=this.width,l=this.xmin,c=this.xmax;let h;t=t||fp(o);const[p,f]=t.valid;h=this._normalizeX(this.xmin,t);const m=h.x,g=h.frameId;h=this._normalizeX(this.xmax,t);const _=h.x,b=h.frameId,w=m===_&&a>0;if(a>2*f){const x=new Cd(l<c?m:_,n,f,s,o),T=new Cd(p,n,l<c?_:m,s,o),E=new Cd(0,n,f,s,o),C=new Cd(p,n,0,s,o),A=[],I=[];x.contains(E)&&A.push(g),x.contains(C)&&I.push(g),T.contains(E)&&A.push(b),T.contains(C)&&I.push(b);for(let M=g+1;M<b;M++)A.push(M),I.push(M);e.push({extent:x,frameIds:[g]},{extent:T,frameIds:[b]},{extent:E,frameIds:A},{extent:C,frameIds:I})}else m>_||w?e.push({extent:new Cd(m,n,f,s,o),frameIds:[g]},{extent:new Cd(p,n,_,s,o),frameIds:[b]}):e.push({extent:new Cd(m,n,_,s,o),frameIds:[g]});this.cache._parts=e}const r=this.hasZ,i=this.hasM;if(r||i){const n={};r&&(n.zmin=this.zmin,n.zmax=this.zmax),i&&(n.mmin=this.mmin,n.mmax=this.mmax);for(let s=0;s<e.length;s++)e[s].extent.set(n)}return e}_normalizeX(t,e){const[r,i]=e.valid,n=2*i;let s,o=0;return t>i?(s=Math.ceil(Math.abs(t-i)/n),t-=s*n,o=s):t<r&&(s=Math.ceil(Math.abs(t-r)/n),t+=s*n,o=-s),{x:t,frameId:o}}};u([d({readOnly:!0})],Ho.prototype,"cache",null),u([d({readOnly:!0})],Ho.prototype,"center",null),u([d({readOnly:!0})],Ho.prototype,"extent",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Ho.prototype,"hasM",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Ho.prototype,"hasZ",null),u([d({readOnly:!0})],Ho.prototype,"height",null),u([d({readOnly:!0})],Ho.prototype,"width",null),u([d({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],Ho.prototype,"xmin",void 0),u([d({type:Number,json:{write:!0}})],Ho.prototype,"ymin",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Ho.prototype,"mmin",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Ho.prototype,"zmin",void 0),u([d({type:Number,json:{write:!0}})],Ho.prototype,"xmax",void 0),u([d({type:Number,json:{write:!0}})],Ho.prototype,"ymax",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Ho.prototype,"mmax",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Ho.prototype,"zmax",void 0),Ho=Cd=u([$("esri.geometry.Extent")],Ho),Ho.prototype.toJSON.isDefaultToJSON=!0;const ur=Ho;function cO(t,e,r=!1){let{hasM:i,hasZ:n}=t;Array.isArray(e)?e.length!==4||i||n?e.length===3&&r&&!i?(n=!0,i=!1):e.length===3&&i&&n&&(i=!1,n=!1):(i=!0,n=!0):(n=!n&&e.hasZ&&(!i||e.hasM),i=!i&&e.hasM&&(!n||e.hasZ)),t.hasZ=n,t.hasM=i}var bY;function Uhe(t){return(e,r)=>e==null?r:r==null?e:t(e,r)}function LGe(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let Hv=bY=class extends $_{constructor(...t){super(...t),this.points=[],this.type="multipoint"}normalizeCtorArgs(t,e){if(!t&&!e)return{};const r={};Array.isArray(t)?(r.points=t,r.spatialReference=e):LGe(t)?r.spatialReference=t:(t.points&&(r.points=t.points),t.spatialReference&&(r.spatialReference=t.spatialReference),t.hasZ&&(r.hasZ=t.hasZ),t.hasM&&(r.hasM=t.hasM));const i=r.points&&r.points[0];return i&&(r.hasZ===void 0&&r.hasM===void 0?(r.hasZ=i.length>2,r.hasM=!1):r.hasZ===void 0?r.hasZ=i.length>3:r.hasM===void 0&&(r.hasM=i.length>3)),r}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const t=this.points;if(!t.length)return null;const e=new ur,r=this.hasZ,i=this.hasM,n=r?3:2,s=t[0],o=Uhe(Math.min),a=Uhe(Math.max);let l,c,h,p,[f,m]=s,[g,_]=s;for(let b=0,w=t.length;b<w;b++){const x=t[b],[T,E]=x;if(f=o(f,T),m=o(m,E),g=a(g,T),_=a(_,E),r&&x.length>2){const C=x[2];l=o(l,C),h=a(h,C)}if(i&&x.length>n){const C=x[n];c=o(c,C),p=a(p,C)}}return e.xmin=f,e.ymin=m,e.xmax=g,e.ymax=_,e.spatialReference=this.spatialReference,r?(e.zmin=l,e.zmax=h):(e.zmin=void 0,e.zmax=void 0),i?(e.mmin=c,e.mmax=p):(e.mmin=void 0,e.mmax=void 0),e}writePoints(t,e){e.points=se(this.points)}addPoint(t){return cO(this,t),Array.isArray(t)?this.points.push(t):this.points.push(t.toArray()),this.notifyChange("points"),this}clone(){const t={points:se(this.points),spatialReference:this.spatialReference};return this.hasZ&&(t.hasZ=!0),this.hasM&&(t.hasM=!0),new bY(t)}getPoint(t){if(!this._validateInputs(t))return null;const e=this.points[t],r={x:e[0],y:e[1],spatialReference:this.spatialReference};let i=2;return this.hasZ&&(r.z=e[2],i=3),this.hasM&&(r.m=e[i]),new Ue(r)}removePoint(t){if(!this._validateInputs(t))return null;const e=new Ue(this.points.splice(t,1)[0],this.spatialReference);return this.notifyChange("points"),e}setPoint(t,e){return this._validateInputs(t)?(cO(this,e),Array.isArray(e)||(e=e.toArray()),this.points[t]=e,this.notifyChange("points"),this):this}toJSON(t){return this.write({},t)}_validateInputs(t){return t!=null&&t>=0&&t<this.points.length}};u([d({readOnly:!0})],Hv.prototype,"cache",null),u([d()],Hv.prototype,"extent",null),u([d({type:[[Number]],json:{write:{isRequired:!0}}})],Hv.prototype,"points",void 0),u([De("points")],Hv.prototype,"writePoints",null),Hv=bY=u([$("esri.geometry.Multipoint")],Hv),Hv.prototype.toJSON.isDefaultToJSON=!0;const uN=Hv;function tne(t,e){const r=e[0]-t[0],i=e[1]-t[1];if(t.length>2&&e.length>2){const n=t[2]-e[2];return Math.sqrt(r*r+i*i+n*n)}return Math.sqrt(r*r+i*i)}function q2e(t,e,r){const i=t[0]+r*(e[0]-t[0]),n=t[1]+r*(e[1]-t[1]);return t.length>2&&e.length>2?[i,n,t[2]+r*(e[2]-t[2])]:[i,n]}function DGe(t,e,r,i){const[n,s]=e,[o,a]=r[i],[l,c]=r[i+1],h=l-o,p=c-a,f=h*h+p*p,m=(n-o)*h+(s-a)*p,g=Math.min(1,Math.max(0,m/f));return t[0]=o+h*g,t[1]=a+p*g,t}function W8t(t,e,r){const i=r.rings;let n,s,o=!1,a=1/0;for(let l=0;l<i.length;l++){const c=i[l];for(let h=0,p=c.length-1;h<c.length;p=h++)n=c[h],s=c[p],n[1]>e!=s[1]>e&&t<(s[0]-n[0])*(e-n[1])/(s[1]-n[1])+n[0]&&(o=!o),a=Math.min(a,NGe(t,e,n,s))}return a===0?0:(o?1:-1)*Math.sqrt(a)}function NGe(t,e,r,i){let n=r[0],s=r[1],o=i[0]-n,a=i[1]-s;if(o!==0||a!==0){const l=((t-n)*o+(e-s)*a)/(o*o+a*a);l>1?(n=i[0],s=i[1]):l>0&&(n+=o*l,s+=a*l)}return o=t-n,a=e-s,o*o+a*a}function FGe(t,e){return q2e(t,e,.5)}function W2e(t){const e=t.length;let r=0;for(let i=0;i<e-1;++i)r+=tne(t[i],t[i+1]);return r}function X2e(t,e){if(e<=0)return t[0];const r=t.length;let i=0;for(let n=0;n<r-1;++n){const s=tne(t[n],t[n+1]);if(e-i<s){const o=(e-i)/s;return q2e(t[n],t[n+1],o)}i+=s}return t[r-1]}function rne(t,e,r){const i=t.length;let n=0,s=0,o=0;for(let a=0;a<i;a++){const l=t[a],c=t[(a+1)%i];let h=2;n+=l[0]*c[1]-c[0]*l[1],l.length>2&&c.length>2&&r&&(s+=l[0]*c[2]-c[0]*l[2],h=3),l.length>h&&c.length>h&&e&&(o+=l[0]*c[h]-c[0]*l[h])}return n<=0&&s<=0&&o<=0}function kGe(t){const e=t.length;return e>2&&g_(t[0],t[e-1])}function X8t(t){if("rings"in t&&(Y2e(t),t.rings.length>0&&!rne(t.rings[0],t.hasM??!1,t.hasZ??!1)))for(const e of t.rings)e.reverse()}function Y2e(t){if("rings"in t)for(const e of t.rings)kGe(e)||e.push(e[0].slice())}function Z2e(t){if(!t||t.length<3)return 0;let e=0;const r=t.length-1;for(let i=0;i<r;i++)e+=(t[i][0]-t[i+1][0])*(t[i][1]+t[i+1][1]);return e+=(t[r][0]-t[0][0])*(t[r][1]+t[0][1]),-.5*e}function Y8t(t){return t?t.hasZ?[t.xmax-t.xmin/2,t.ymax-t.ymin/2,t.zmax-t.zmin/2]:[t.xmax-t.xmin/2,t.ymax-t.ymin/2]:null}function UGe(t){return t?ine(t.rings,t.hasZ??!1):null}function ine(t,e){if(!t||!t.length)return null;const r=[],i=[],n=e?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let s=0,o=t.length;s<o;s++){const a=zGe(t[s],e,n);a&&i.push(a)}if(i.sort((s,o)=>{let a=s[2]-o[2];return a===0&&e&&(a=s[4]-o[4]),a}),i.length&&(r[0]=i[0][0],r[1]=i[0][1],e&&(r[2]=i[0][3]),(r[0]<n[0]||r[0]>n[1]||r[1]<n[2]||r[1]>n[3]||e&&(r[2]<n[4]||r[2]>n[5]))&&(r.length=0)),!r.length){const s=t[0]&&t[0].length?VGe(t[0],e):null;if(!s)return null;r[0]=s[0],r[1]=s[1],e&&s.length>2&&(r[2]=s[2])}return r}function zGe(t,e,r){let i=0,n=0,s=0,o=0,a=0;const l=t.length?t[0][0]:0,c=t.length?t[0][1]:0,h=t.length&&e?t[0][2]:0;for(let f=0;f<t.length;f++){const m=t[f],g=t[(f+1)%t.length],[_,b,w]=m,x=_-l,T=b-c,[E,C,A]=g,I=E-l,M=C-c,D=x*M-I*T;if(o+=D,i+=(x+I)*D,n+=(T+M)*D,e&&m.length>2&&g.length>2){const U=w-h,z=A-h,B=x*z-I*U;s+=(U+z)*B,a+=B}_<r[0]&&(r[0]=_),_>r[1]&&(r[1]=_),b<r[2]&&(r[2]=b),b>r[3]&&(r[3]=b),e&&(w<r[4]&&(r[4]=w),w>r[5]&&(r[5]=w))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const p=[i/(6*o)+l,n/(6*o)+c,o];return e&&(r[4]===r[5]||a===0?(p[3]=(r[4]+r[5])/2,p[4]=0):(p[3]=s/(6*a)+h,p[4]=a)),p}function VGe(t,e){const r=e?[0,0,0]:[0,0],i=e?[0,0,0]:[0,0];let n=0,s=0,o=0,a=0;for(let l=0,c=t.length;l<c-1;l++){const h=t[l],p=t[l+1];if(h&&p){r[0]=h[0],r[1]=h[1],i[0]=p[0],i[1]=p[1],e&&h.length>2&&p.length>2&&(r[2]=h[2],i[2]=p[2]);const f=tne(r,i);if(f){n+=f;const m=FGe(h,p);s+=f*m[0],o+=f*m[1],e&&m.length>2&&(a+=f*m[2])}}}return n>0?e?[s/n,o/n,a/n]:[s/n,o/n]:t.length?t[0]:null}const BGe=1e-6;function Z8t(t){if(!t||!t.rings)return null;const{rings:e}=t;let r=0;for(let s=0;s<e.length;s++)r+=Z2e(e[s]);if(r<BGe)return ine(e,!1);const i=[0,0],n=e[0][0];for(let s=0;s<e.length;s++)GGe(i,n,e[s]);return i[0]*=1/r,i[1]*=1/r,i[0]+=n[0],i[1]+=n[1],i}const jGe=1/3;function GGe(t,e,r){if(!t||!r||r.length<3)return null;const i=r[0],n=[0,0],s=[r[1][0]-i[0],r[1][1]-i[1]];let o;for(let c=2;c<r.length;c++)n[0]=r[c][0]-i[0],n[1]=r[c][1]-i[1],o=.5*jGe*(n[0]*s[1]-n[1]*s[0]),t[0]+=o*(s[0]+n[0]),t[1]+=o*(s[1]+n[1]),s[0]=n[0],s[1]=n[1];const a=Z2e(r),l=[i[0],i[1]];return l[0]-=e[0],l[1]-=e[1],l[0]*=a,l[1]*=a,t[0]+=l[0],t[1]+=l[1],t}function J2e(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function K2e(t){return t.points!==void 0}function Q2e(t){return t.x!==void 0&&t.y!==void 0}function eEe(t){return t.paths!==void 0}function tEe(t){return t.rings!==void 0}function rEe(t){function e(r,i){return r==null?i:i==null?r:t(r,i)}return e}const sb=rEe(Math.min),ob=rEe(Math.max);function HGe(t,e){return eEe(e)?uO(t,e.paths,!1,!1):tEe(e)?uO(t,e.rings,!1,!1):K2e(e)?nne(t,e.points,!1,!1,!1,!1):J2e(e)?iEe(t,e):(Q2e(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.x,t[3]=e.y),t)}function J8t(t,e){return eEe(e)?uO(t,e.paths,!0,!1):tEe(e)?uO(t,e.rings,!0,!1):K2e(e)?nne(t,e.points,!0,!1,!0,!1):J2e(e)?iEe(t,e,!0,!1,!0,!1):(Q2e(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.x,t[4]=e.y,t[5]=e.z),t)}function uO(t,e,r,i){const n=r?3:2;if(!e.length||!e[0].length)return null;let s,o,a,l,[c,h]=e[0][0],[p,f]=e[0][0];for(let m=0;m<e.length;m++){const g=e[m];for(let _=0;_<g.length;_++){const b=g[_],[w,x]=b;if(c=sb(c,w),h=sb(h,x),p=ob(p,w),f=ob(f,x),r&&b.length>2){const T=b[2];s=sb(s,T),o=ob(o,T)}if(i&&b.length>n){const T=b[n];a=sb(s,T),l=ob(o,T)}}}return r?i?(t[0]=c,t[1]=h,t[2]=s,t[3]=a,t[4]=p,t[5]=f,t[6]=o,t[7]=l,t.length=8,t):(t[0]=c,t[1]=h,t[2]=s,t[3]=p,t[4]=f,t[5]=o,t.length=6,t):i?(t[0]=c,t[1]=h,t[2]=a,t[3]=p,t[4]=f,t[5]=l,t.length=6,t):(t[0]=c,t[1]=h,t[2]=p,t[3]=f,t.length=4,t)}function iEe(t,e,r,i,n,s){const o=e.xmin,a=e.xmax,l=e.ymin,c=e.ymax;let h=e.zmin,p=e.zmax,f=e.mmin,m=e.mmax;return n?(h=h||0,p=p||0,s?(f=f||0,m=m||0,t[0]=o,t[1]=l,t[2]=h,t[3]=f,t[4]=a,t[5]=c,t[6]=p,t[7]=m,t):(t[0]=o,t[1]=l,t[2]=h,t[3]=a,t[4]=c,t[5]=p,t)):s?(f=f||0,m=m||0,t[0]=o,t[1]=l,t[2]=f,t[3]=a,t[4]=c,t[5]=m,t):(t[0]=o,t[1]=l,t[2]=a,t[3]=c,t)}function nne(t,e,r,i,n,s){const o=r?3:2,a=i&&s,l=r&&n;if(!e.length||!e[0].length)return null;let c,h,p,f,[m,g]=e[0],[_,b]=e[0];for(let w=0;w<e.length;w++){const x=e[w],[T,E]=x;if(m=sb(m,T),g=sb(g,E),_=ob(_,T),b=ob(b,E),l&&x.length>2){const C=x[2];c=sb(c,C),h=ob(h,C)}if(a&&x.length>o){const C=x[o];p=sb(c,C),f=ob(h,C)}}return n?(c=c||0,h=h||0,s?(p=p||0,f=f||0,t[0]=m,t[1]=g,t[2]=c,t[3]=p,t[4]=_,t[5]=b,t[6]=h,t[7]=f,t):(t[0]=m,t[1]=g,t[2]=c,t[3]=_,t[4]=b,t[5]=h,t)):s?(p=p||0,f=f||0,t[0]=m,t[1]=g,t[2]=p,t[3]=_,t[4]=b,t[5]=f,t):(t[0]=m,t[1]=g,t[2]=_,t[3]=b,t)}function qGe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function WGe(t){return t.points!==void 0}function XGe(t){return t.x!==void 0&&t.y!==void 0}function YGe(t){return t.paths!==void 0}function ZGe(t){return t.rings!==void 0}const sne=[];function nEe(t,e,r,i){return{xmin:t,ymin:e,xmax:r,ymax:i}}function sEe(t,e,r,i,n,s){return{xmin:t,ymin:e,zmin:r,xmax:i,ymax:n,zmax:s}}function oEe(t,e,r,i,n,s){return{xmin:t,ymin:e,mmin:r,xmax:i,ymax:n,mmax:s}}function aEe(t,e,r,i,n,s,o,a){return{xmin:t,ymin:e,zmin:r,mmin:i,xmax:n,ymax:s,zmax:o,mmax:a}}function one(t,e=!1,r=!1){return e?r?aEe(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]):sEe(t[0],t[1],t[2],t[3],t[4],t[5]):r?oEe(t[0],t[1],t[2],t[3],t[4],t[5]):nEe(t[0],t[1],t[2],t[3])}function K8t(t){return t?qGe(t)?t:XGe(t)?KGe(t):ZGe(t)?lEe(t):YGe(t)?cEe(t):WGe(t)?JGe(t):null:null}function JGe(t){const{hasZ:e,hasM:r,points:i}=t;return one(nne(sne,i,e??!1,r??!1),e,r)}function KGe(t){const{x:e,y:r,z:i,m:n}=t,s=n!=null;return i!=null?s?aEe(e,r,i,n,e,r,i,n):sEe(e,r,i,e,r,i):s?oEe(e,r,n,e,r,n):nEe(e,r,e,r)}function lEe(t){const{hasZ:e,hasM:r,rings:i}=t,n=uO(sne,i,e??!1,r??!1);return n?one(n,e,r):null}function cEe(t){const{hasZ:e,hasM:r,paths:i}=t,n=uO(sne,i,e??!1,r??!1);return n?one(n,e,r):null}var s6;function zhe(t){return!Array.isArray(t[0])}let Wm=s6=class extends $_{static fromExtent(t){const e=t.clone().normalize(),r=t.spatialReference;let i=!1,n=!1;for(const o of e)o.hasZ&&(i=!0),o.hasM&&(n=!0);const s={rings:e.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(i&&o.hasZ){const l=o.zmin+.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(n&&o.hasM){const l=o.mmin+.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a}),spatialReference:r};return i&&(s.hasZ=!0),n&&(s.hasM=!0),new s6(s)}constructor(...t){super(...t),this.rings=[],this.type="polygon"}normalizeCtorArgs(t,e){let r,i,n=null,s=null;return t&&!Array.isArray(t)?(n=t.rings?t.rings:null,e||(t.spatialReference?e=t.spatialReference:t.rings||(e=t)),r=t.hasZ,i=t.hasM):n=t,n=n||[],e=e||Je.WGS84,n.length&&n[0]&&n[0][0]!=null&&typeof n[0][0]=="number"&&(n=[n]),s=n[0]&&n[0][0],s&&(r===void 0&&i===void 0?(r=s.length>2,i=s.length>3):r===void 0?r=i?s.length>3:s.length>2:i===void 0&&(i=r?s.length>3:s.length>2)),{rings:n,spatialReference:e,hasZ:r,hasM:i}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const t=UGe(this);if(!t||isNaN(t[0])||isNaN(t[1])||this.hasZ&&isNaN(t[2]))return null;const e=new Ue;return e.x=t[0],e.y=t[1],e.spatialReference=this.spatialReference,this.hasZ&&(e.z=t[2]),e}get extent(){const{spatialReference:t}=this,e=lEe(this);if(!e)return null;const r=new ur(e);return r.spatialReference=t,r}get isSelfIntersecting(){return PGe(this.rings)}writeRings(t,e){e.rings=se(this.rings)}addRing(t){if(!t)return;const e=this.rings,r=e.length;if(zhe(t)){const i=[];for(let n=0,s=t.length;n<s;n++)i[n]=t[n].toArray();e[r]=i}else e[r]=t.concat();return this.notifyChange("rings"),this}clone(){const t=new s6;return t.spatialReference=this.spatialReference,t.rings=se(this.rings),t.hasZ=this.hasZ,t.hasM=this.hasM,t}equals(t){if(this===t)return!0;if(R(t))return!1;const e=this.spatialReference,r=t.spatialReference;if(v(e)!==v(r)||v(e)&&v(r)&&!e.equals(r)||this.rings.length!==t.rings.length)return!1;const i=([n,s,o,a],[l,c,h,p])=>n===l&&s===c&&(o==null&&h==null||o===h)&&(a==null&&p==null||a===p);for(let n=0;n<this.rings.length;n++){const s=this.rings[n],o=t.rings[n];if(!g_(s,o,i))return!1}return!0}contains(t){if(!t)return!1;const e=D2(t,this.spatialReference);return V2e(this,v(e)?e:t)}isClockwise(t){let e;return e=zhe(t)?t.map(r=>this.hasZ?this.hasM?[r.x,r.y,r.z,r.m]:[r.x,r.y,r.z]:[r.x,r.y]):t,rne(e,this.hasM,this.hasZ)}getPoint(t,e){if(!this._validateInputs(t,e))return null;const r=this.rings[t][e],i=this.hasZ,n=this.hasM;return i&&!n?new Ue(r[0],r[1],r[2],void 0,this.spatialReference):n&&!i?new Ue(r[0],r[1],void 0,r[2],this.spatialReference):i&&n?new Ue(r[0],r[1],r[2],r[3],this.spatialReference):new Ue(r[0],r[1],this.spatialReference)}insertPoint(t,e,r){return this._validateInputs(t,e,!0)?(cO(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[t].splice(e,0,r),this.notifyChange("rings"),this):this}removePoint(t,e){if(!this._validateInputs(t,e))return null;const r=new Ue(this.rings[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("rings"),r}removeRing(t){if(!this._validateInputs(t,null))return null;const e=this.rings.splice(t,1)[0],r=this.spatialReference,i=e.map(n=>new Ue(n,r));return this.notifyChange("rings"),i}setPoint(t,e,r){return this._validateInputs(t,e)?(cO(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[t][e]=r,this.notifyChange("rings"),this):this}_validateInputs(t,e,r=!1){if(t==null||t<0||t>=this.rings.length)return!1;if(e!=null){const i=this.rings[t];if(r&&(e<0||e>i.length)||!r&&(e<0||e>=i.length))return!1}return!0}toJSON(t){return this.write({},t)}};u([d({readOnly:!0})],Wm.prototype,"cache",null),u([d({readOnly:!0})],Wm.prototype,"centroid",null),u([d({readOnly:!0})],Wm.prototype,"extent",null),u([d({readOnly:!0})],Wm.prototype,"isSelfIntersecting",null),u([d({type:[[[Number]]],json:{write:{isRequired:!0}}})],Wm.prototype,"rings",void 0),u([De("rings")],Wm.prototype,"writeRings",null),Wm=s6=u([$("esri.geometry.Polygon")],Wm),Wm.prototype.toJSON.isDefaultToJSON=!0;const Jl=Wm;var wY;function QGe(t){return!Array.isArray(t[0])}let qv=wY=class extends $_{constructor(...t){super(...t),this.paths=[],this.type="polyline"}normalizeCtorArgs(t,e){let r,i,n=null,s=null;return t&&!Array.isArray(t)?(n=t.paths?t.paths:null,e||(t.spatialReference?e=t.spatialReference:t.paths||(e=t)),r=t.hasZ,i=t.hasM):n=t,n=n||[],e=e||Je.WGS84,n.length&&n[0]&&n[0][0]!=null&&typeof n[0][0]=="number"&&(n=[n]),s=n[0]&&n[0][0],s&&(r===void 0&&i===void 0?(r=s.length>2,i=!1):r===void 0?r=!i&&s.length>3:i===void 0&&(i=!r&&s.length>3)),{paths:n,spatialReference:e,hasZ:r,hasM:i}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:t}=this,e=cEe(this);if(!e)return null;const r=new ur(e);return r.spatialReference=t,r}writePaths(t,e){e.paths=se(this.paths)}addPath(t){if(!t)return;const e=this.paths,r=e.length;if(QGe(t)){const i=[];for(let n=0,s=t.length;n<s;n++)i[n]=t[n].toArray();e[r]=i}else e[r]=t.concat();return this.notifyChange("paths"),this}clone(){const t=new wY;return t.spatialReference=this.spatialReference,t.paths=se(this.paths),t.hasZ=this.hasZ,t.hasM=this.hasM,t}getPoint(t,e){if(!this._validateInputs(t,e))return null;const r=this.paths[t][e],i=this.hasZ,n=this.hasM;return i&&!n?new Ue(r[0],r[1],r[2],void 0,this.spatialReference):n&&!i?new Ue(r[0],r[1],void 0,r[2],this.spatialReference):i&&n?new Ue(r[0],r[1],r[2],r[3],this.spatialReference):new Ue(r[0],r[1],this.spatialReference)}insertPoint(t,e,r){return this._validateInputs(t,e,!0)?(cO(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[t].splice(e,0,r),this.notifyChange("paths"),this):this}removePath(t){if(!this._validateInputs(t,null))return null;const e=this.paths.splice(t,1)[0],r=this.spatialReference,i=e.map(n=>new Ue(n,r));return this.notifyChange("paths"),i}removePoint(t,e){if(!this._validateInputs(t,e))return null;const r=new Ue(this.paths[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("paths"),r}setPoint(t,e,r){return this._validateInputs(t,e)?(cO(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[t][e]=r,this.notifyChange("paths"),this):this}_validateInputs(t,e,r=!1){if(t==null||t<0||t>=this.paths.length)return!1;if(e!=null){const i=this.paths[t];if(r&&(e<0||e>i.length)||!r&&(e<0||e>=i.length))return!1}return!0}toJSON(t){return this.write({},t)}};u([d({readOnly:!0})],qv.prototype,"cache",null),u([d({readOnly:!0})],qv.prototype,"extent",null),u([d({type:[[[Number]]],json:{write:{isRequired:!0}}})],qv.prototype,"paths",void 0),u([De("paths")],qv.prototype,"writePaths",null),qv=wY=u([$("esri.geometry.Polyline")],qv),qv.prototype.toJSON.isDefaultToJSON=!0;const zf=qv,uEe=ja()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),Vhe=ja()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function O9(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function hN(t){return t.points!==void 0}function dN(t){return t.x!==void 0&&t.y!==void 0}function a3(t){return t.paths!==void 0}function Q0(t){return t.rings!==void 0}function ry(t){return R(t)?null:t instanceof $_?t:dN(t)?Ue.fromJSON(t):a3(t)?zf.fromJSON(t):Q0(t)?Jl.fromJSON(t):hN(t)?uN.fromJSON(t):O9(t)?ur.fromJSON(t):null}function l3(t){return t?dN(t)?"esriGeometryPoint":a3(t)?"esriGeometryPolyline":Q0(t)?"esriGeometryPolygon":O9(t)?"esriGeometryEnvelope":hN(t)?"esriGeometryMultipoint":null:null}const eHe={esriGeometryPoint:Ue,esriGeometryPolyline:zf,esriGeometryPolygon:Jl,esriGeometryEnvelope:ur,esriGeometryMultipoint:uN};function tHe(t){return t&&eHe[t]||null}const Aw={base:$_,key:"type",typeMap:{extent:ur,multipoint:uN,point:Ue,polyline:zf,polygon:Jl}};om(Aw);const bi=t=>{let e=class extends t{clone(){var l;const r=Ic(Zl(this),"unable to clone instance of non-accessor class"),i=r.metadatas,n=r.store,s={},o=new Map;for(const c in i){const h=i[c],p=n==null?void 0:n.originOf(c),f=h.clonable;if(h.readOnly||f===!1||p!==Jr.USER&&p!==Jr.DEFAULTS&&p!==Jr.WEB_MAP&&p!==Jr.WEB_SCENE)continue;const m=this[c];let g=null;g=typeof f=="function"?f(m):f==="reference"?m:ZX(m),m!=null&&g==null||(p===Jr.DEFAULTS?o.set(c,g):s[c]=g)}const a=new(Object.getPrototypeOf(this)).constructor(s);if(o.size){const c=(l=Zl(a))==null?void 0:l.store;if(c)for(const[h,p]of o)c.set(h,p,Jr.DEFAULTS)}return a}};return e=u([$("esri.core.Clonable")],e),e};let xY=class extends bi(be){};xY=u([$("esri.core.Clonable")],xY);let o6=class hEe{constructor(){this._emitter=new hEe.EventEmitter(this)}emit(e,r){return this._emitter.emit(e,r)}on(e,r){return this._emitter.on(e,r)}once(e,r){return this._emitter.once(e,r)}hasEventListener(e){return this._emitter.hasEventListener(e)}};(function(t){class e{constructor(n=null){this._target=n,this._listenersMap=null}clear(){this._listenersMap&&this._listenersMap.clear(),this._listenersMap=null}emit(n,s){const o=this._listenersMap&&this._listenersMap.get(n);if(!o)return!1;const a=this._target||this;return[...o].forEach(l=>{l.call(a,s)}),o.length>0}on(n,s){if(Array.isArray(n)){const a=n.map(l=>this.on(l,s));return oO(a)}if(n.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap||(this._listenersMap=new Map);const o=this._listenersMap.get(n)||[];return o.push(s),this._listenersMap.set(n,o),{remove:()=>{const a=this._listenersMap&&this._listenersMap.get(n)||[],l=a.indexOf(s);l>=0&&a.splice(l,1)}}}once(n,s){const o=this.on(n,a=>{o.remove(),s.call(null,a)});return o}hasEventListener(n){const s=this._listenersMap&&this._listenersMap.get(n);return s!=null&&s.length>0}}t.EventEmitter=e,t.EventedMixin=i=>{let n=class extends i{constructor(){super(...arguments),this._emitter=new e}destroy(){this._emitter.clear()}emit(s,o){return this._emitter.emit(s,o)}on(s,o){return this._emitter.on(s,o)}once(s,o){return this._emitter.once(s,o)}hasEventListener(s){return this._emitter.hasEventListener(s)}};return n=u([$("esri.core.Evented")],n),n};let r=class extends be{constructor(){super(...arguments),this._emitter=new o6.EventEmitter(this)}destroy(){this._emitter.clear()}emit(i,n){return this._emitter.emit(i,n)}on(i,n){return this._emitter.on(i,n)}once(i,n){return this._emitter.once(i,n)}hasEventListener(i){return this._emitter.hasEventListener(i)}};r=u([$("esri.core.Evented")],r),t.EventedAccessor=r})(o6||(o6={}));const Sn=o6;var xi;(function(t){t[t.ADD=1]="ADD",t[t.REMOVE=2]="REMOVE",t[t.MOVE=4]="MOVE"})(xi||(xi={}));function ane(t){return(e,r)=>{e[r]=t}}let lne=class extends e2e{notify(){const e=this._observers;if(e&&e.length>0){const r=e.slice();for(const i of r)i.onInvalidated(),i.onCommitted()}}};var P0;let rHe=class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}};const dd=new ko(rHe,void 0,t=>{t.item=null,t.target=null,t.defaultPrevented=!1,t.cancellable=!1}),iHe=()=>{};function Oj(t){return t?t instanceof BT?t.toArray():t.length?Array.prototype.slice.apply(t):[]:[]}function Mj(t){if(t&&t.length)return t[0]}function nHe(t,e,r,i){const n=Math.min(t.length-r,e.length-i);let s=0;for(;s<n&&t[r+s]===e[i+s];)s++;return s}function dEe(t,e,r,i){e&&e.forEach((n,s,o)=>{t.push(n),dEe(t,r.call(i,n,s,o),r,i)})}const sv=new Set,ov=new Set,av=new Set,Pj=new Map;let sHe=0,BT=P0=class extends Sn.EventedAccessor{static isCollection(t){return t!=null&&t instanceof P0}constructor(t){super(t),this._chgListeners=[],this._notifications=null,this._timer=null,this._observable=new lne,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:sHe++})}normalizeCtorArgs(t){return t?Array.isArray(t)||t instanceof P0?{items:t}:t:{}}destroy(){this.removeAll()}*[Symbol.iterator](){yield*this.items}get items(){return Er(this._observable),this._items}set items(t){this._emitBeforeChanges(xi.ADD)||(this._splice(0,this.length,Oj(t)),this._emitAfterChanges(xi.ADD))}hasEventListener(t){return t==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(t)}on(t,e){if(t==="change"){const r=this._chgListeners,i={removed:!1,callback:e};return r.push(i),this._notifications&&this._notifications.push({listeners:r.slice(),items:this._items.slice(),changes:[]}),{remove(){this.remove=iHe,i.removed=!0,r.splice(r.indexOf(i),1)}}}return this._emitter.on(t,e)}once(t,e){const r=this.on(t,e);return{remove(){r.remove()}}}add(t,e){if(Er(this._observable),this._emitBeforeChanges(xi.ADD))return this;const r=this.getNextIndex(e??null);return this._splice(r,0,[t]),this._emitAfterChanges(xi.ADD),this}addMany(t,e=this._items.length){if(Er(this._observable),!t||!t.length)return this;if(this._emitBeforeChanges(xi.ADD))return this;const r=this.getNextIndex(e);return this._splice(r,0,Oj(t)),this._emitAfterChanges(xi.ADD),this}at(t){if(Er(this._observable),(t=Math.trunc(t)||0)<0&&(t+=this.length),!(t<0||t>=this.length))return this._items[t]}removeAll(){if(Er(this._observable),!this.length||this._emitBeforeChanges(xi.REMOVE))return[];const t=this._splice(0,this.length)||[];return this._emitAfterChanges(xi.REMOVE),t}clone(){return Er(this._observable),this._createNewInstance({items:this._items.map(se)})}concat(...t){Er(this._observable);const e=t.map(Oj);return this._createNewInstance({items:this._items.concat(...e)})}drain(t,e){if(Er(this._observable),!this.length||this._emitBeforeChanges(xi.REMOVE))return;const r=this._splice(0,this.length),i=r.length;for(let n=0;n<i;n++)t.call(e,r[n],n,r);this._emitAfterChanges(xi.REMOVE)}every(t,e){return Er(this._observable),this._items.every(t,e)}filter(t,e){let r;return Er(this._observable),r=arguments.length===2?this._items.filter(t,e):this._items.filter(t),this._createNewInstance({items:r})}find(t,e){return Er(this._observable),this._items.find(t,e)}findIndex(t,e){return Er(this._observable),this._items.findIndex(t,e)}flatten(t,e){Er(this._observable);const r=[];return dEe(r,this,t,e),new P0(r)}forEach(t,e){return Er(this._observable),this._items.forEach(t,e)}getItemAt(t){return Er(this._observable),this._items[t]}getNextIndex(t){Er(this._observable);const e=this.length;return(t=t??e)<0?t=0:t>e&&(t=e),t}includes(t,e=0){return Er(this._observable),this._items.includes(t,e)}indexOf(t,e=0){return Er(this._observable),this._items.indexOf(t,e)}join(t=","){return Er(this._observable),this._items.join(t)}lastIndexOf(t,e=this.length-1){return Er(this._observable),this._items.lastIndexOf(t,e)}map(t,e){Er(this._observable);const r=this._items.map(t,e);return new P0({items:r})}reorder(t,e=this.length-1){Er(this._observable);const r=this.indexOf(t);if(r!==-1){if(e<0?e=0:e>=this.length&&(e=this.length-1),r!==e){if(this._emitBeforeChanges(xi.MOVE))return t;this._splice(r,1),this._splice(e,0,[t]),this._emitAfterChanges(xi.MOVE)}return t}}pop(){if(Er(this._observable),!this.length||this._emitBeforeChanges(xi.REMOVE))return;const t=Mj(this._splice(this.length-1,1));return this._emitAfterChanges(xi.REMOVE),t}push(...t){return Er(this._observable),this._emitBeforeChanges(xi.ADD)||(this._splice(this.length,0,t),this._emitAfterChanges(xi.ADD)),this.length}reduce(t,e){Er(this._observable);const r=this._items;return arguments.length===2?r.reduce(t,e):r.reduce(t)}reduceRight(t,e){Er(this._observable);const r=this._items;return arguments.length===2?r.reduceRight(t,e):r.reduceRight(t)}remove(t){return Er(this._observable),this.removeAt(this.indexOf(t))}removeAt(t){if(Er(this._observable),t<0||t>=this.length||this._emitBeforeChanges(xi.REMOVE))return;const e=Mj(this._splice(t,1));return this._emitAfterChanges(xi.REMOVE),e}removeMany(t){if(Er(this._observable),!t||!t.length||this._emitBeforeChanges(xi.REMOVE))return[];const e=t instanceof P0?t.toArray():t,r=this._items,i=[],n=e.length;for(let s=0;s<n;s++){const o=e[s],a=r.indexOf(o);if(a>-1){const l=1+nHe(e,r,s+1,a+1),c=this._splice(a,l);c&&c.length>0&&i.push.apply(i,c),s+=l-1}}return this._emitAfterChanges(xi.REMOVE),i}reverse(){if(Er(this._observable),this._emitBeforeChanges(xi.MOVE))return this;const t=this._splice(0,this.length);return t&&(t.reverse(),this._splice(0,0,t)),this._emitAfterChanges(xi.MOVE),this}shift(){if(Er(this._observable),!this.length||this._emitBeforeChanges(xi.REMOVE))return;const t=Mj(this._splice(0,1));return this._emitAfterChanges(xi.REMOVE),t}slice(t=0,e=this.length){return Er(this._observable),this._createNewInstance({items:this._items.slice(t,e)})}some(t,e){return Er(this._observable),this._items.some(t,e)}sort(t){if(Er(this._observable),!this.length||this._emitBeforeChanges(xi.MOVE))return this;const e=this._splice(0,this.length);return arguments.length?e.sort(t):e.sort(),this._splice(0,0,e),this._emitAfterChanges(xi.MOVE),this}splice(t,e,...r){Er(this._observable);const i=(e?xi.REMOVE:0)|(r.length?xi.ADD:0);if(this._emitBeforeChanges(i))return[];const n=this._splice(t,e,r)||[];return this._emitAfterChanges(i),n}toArray(){return Er(this._observable),this._items.slice()}toJSON(){return Er(this._observable),this.toArray()}toLocaleString(){return Er(this._observable),this._items.toLocaleString()}toString(){return Er(this._observable),this._items.toString()}unshift(...t){return Er(this._observable),!t.length||this._emitBeforeChanges(xi.ADD)||(this._splice(0,0,t),this._emitAfterChanges(xi.ADD)),this.length}_createNewInstance(t){return new this.constructor(t)}_splice(t,e,r){const i=this._items,n=this.itemType;let s,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=L2(()=>this._dispatchChange())),e){if(o=i.splice(t,e),this.hasEventListener("before-remove")){const a=dd.acquire();a.target=this,a.cancellable=!0;for(let l=0,c=o.length;l<c;l++)s=o[l],a.reset(s),this.emit("before-remove",a),a.defaultPrevented&&(o.splice(l,1),i.splice(t,0,s),t+=1,l-=1,c-=1);dd.release(a)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const a=dd.acquire();a.target=this,a.cancellable=!1;const l=o.length;for(let c=0;c<l;c++)a.reset(o[c]),this.emit("after-remove",a);dd.release(a)}}if(r&&r.length){if(n){const h=[];for(const p of r){const f=n.ensureType(p);f==null&&p!=null||h.push(f)}r=h}const a=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=t===this.length;if(a||l){const h=dd.acquire();h.target=this,h.cancellable=!0;const p=dd.acquire();p.target=this,p.cancellable=!1;for(const f of r)a?(h.reset(f),this.emit("before-add",h),h.defaultPrevented||(c?i.push(f):i.splice(t++,0,f),this._set("length",i.length),l&&(p.reset(f),this.emit("after-add",p)))):(c?i.push(f):i.splice(t++,0,f),this._set("length",i.length),p.reset(f),this.emit("after-add",p));dd.release(p),dd.release(h)}else{if(c)for(const h of r)i.push(h);else i.splice(t,0,...r);this._set("length",i.length)}}return(r&&r.length||o&&o.length)&&this._notifyChangeEvent(r,o),o}_emitBeforeChanges(t){let e=!1;if(this.hasEventListener("before-changes")){const r=dd.acquire();r.target=this,r.cancellable=!0,r.type=t,this.emit("before-changes",r),e=r.defaultPrevented,dd.release(r)}return e}_emitAfterChanges(t){if(this.hasEventListener("after-changes")){const e=dd.acquire();e.target=this,e.cancellable=!1,e.type=t,this.emit("after-changes",e),dd.release(e)}this._observable.notify()}_notifyChangeEvent(t,e){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:t,removed:e})}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),!this._notifications)return;const t=this._notifications;this._notifications=null;for(const e of t){const r=e.changes;sv.clear(),ov.clear(),av.clear();for(const{added:l,removed:c}of r){if(l)if(av.size===0&&ov.size===0)for(const h of l)sv.add(h);else for(const h of l)ov.has(h)?(av.add(h),ov.delete(h)):av.has(h)||sv.add(h);if(c)if(av.size===0&&sv.size===0)for(const h of c)ov.add(h);else for(const h of c)sv.has(h)?sv.delete(h):(av.delete(h),ov.add(h))}const i=Nc.acquire();sv.forEach(l=>{i.push(l)});const n=Nc.acquire();ov.forEach(l=>{n.push(l)});const s=this._items,o=e.items,a=Nc.acquire();if(av.forEach(l=>{o.indexOf(l)!==s.indexOf(l)&&a.push(l)}),e.listeners&&(i.length||n.length||a.length)){const l={target:this,added:i,removed:n,moved:a},c=e.listeners.length;for(let h=0;h<c;h++){const p=e.listeners[h];p.removed||p.callback.call(this,l)}}Nc.release(i),Nc.release(n),Nc.release(a)}sv.clear(),ov.clear(),av.clear()}};BT.ofType=t=>{if(!t)return P0;if(Pj.has(t))return Pj.get(t);let e=null;if(typeof t=="function")e=t.prototype.declaredClass;else if(t.base)e=t.base.prototype.declaredClass;else for(const i in t.typeMap){const n=t.typeMap[i].prototype.declaredClass;e?e+=` | ${n}`:e=n}let r=class extends P0{};return u([ane({Type:t,ensureType:typeof t=="function"?bs(t):om(t)})],r.prototype,"itemType",void 0),r=u([$(`esri.core.Collection<${e}>`)],r),Pj.set(t,r),r},u([d()],BT.prototype,"length",void 0),u([d()],BT.prototype,"items",null),BT=P0=u([$("esri.core.Collection")],BT);const ct=BT;var hO;function oHe(t,e){switch(t.type){case"range":{const r="range"in t?t.range[0]:t.minValue,i="range"in t?t.range[1]:t.maxValue;if(r!=null&&+e<r||i!=null&&+e>i)return hO.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(t.codedValues==null||t.codedValues.every(r=>r==null||r.code!==e))return hO.INVALID_CODED_VALUE}return null}(function(t){t.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",t.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(hO||(hO={}));const aHe=re.getLogger("esri.support.arcadeOnDemand");let Ij;function iy(){return Ij||(Ij=(async()=>{const t=await Q(()=>import("./arcadeUtils-ee7c6660.js").then(e=>e.ax),["assets/arcadeUtils-ee7c6660.js","assets/arcadeTimeUtils-f06505ea.js","assets/executionError-fb3f283a.js","assets/number-b0a0df5c.js","assets/hash-0ddfbf4b.js"]);return{arcade:t.arcade,arcadeUtils:t,Dictionary:t.Dictionary,Feature:t.arcadeFeature}})()),Ij}const lHe=(t,e,r)=>cne.create(t,e,r,null,["$feature"]),cHe=(t,e,r)=>cne.create(t,e,r,null,["$feature","$view"]),uHe=(t,e,r,i)=>cne.create(t,e,r,i,["$feature","$view"]);let cne=class pEe{constructor(e,r,i,n,s,o,a){this.script=e,this.evaluate=n;const l=Array.isArray(o)?o:o.fields;this.fields=l,this._syntaxTree=i,this._arcade=r,this._arcadeFeature=s,this._spatialReference=a,this._referencesGeometry=r.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(e,r,i,n,s,o){const{arcade:a,Feature:l,Dictionary:c}=await iy(),h=Je.fromJSON(r);let p;try{p=a.parseScript(e,o)}catch(M){return aHe.error(new H("arcade-bad-expression","Failed to parse arcade script",{script:e,error:M})),null}const f=s.reduce((M,D)=>({...M,[D]:null}),{});let m=null;v(n)&&(m=new c(n),m.immutable=!0,f.$config=null);const g=a.scriptUsesGeometryEngine(p),_=g&&a.enableGeometrySupport(),b=a.scriptUsesFeatureSet(p)&&a.enableFeatureSetSupport(),w=a.scriptIsAsync(p),x=w&&a.enableAsyncSupport(),T={vars:f,spatialReference:h,useAsync:!!x};await Promise.all([_,b,x]);const E=new Set;await a.loadDependentModules(E,p,null,w,g);const C=new c;C.immutable=!1,C.setField("scale",0);const A=a.compileScript(p,T),I=M=>("$view"in M&&M.$view&&(C.setField("scale",typeof M.$view=="object"?M.$view.scale:void 0),M.$view=C),m&&(M.$config=m),A({vars:M,spatialReference:h}));return new pEe(e,a,p,I,new l,i,h)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}};const hHe=/^([0-9])/,dHe=/[^a-z0-9_\u0080-\uffff]/gi,pHe=/_{2,}/g,fHe=/^_/,mHe=/_$/;function gHe(t){return t==null?null:t.trim().replace(dHe,"_").replace(pHe,"_").replace(fHe,"").replace(mHe,"").replace(hHe,"F$1")||null}const yHe=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],_He=["field","normalizationField"];function Bhe(t,e){if(t!=null&&e!=null){for(const r of Array.isArray(t)?t:[t])if(jhe(yHe,r,e),"visualVariables"in r&&r.visualVariables)for(const i of r.visualVariables)jhe(_He,i,e)}}function jhe(t,e,r){if(t)for(const i of t){const n=nN(i,e),s=n&&typeof n!="function"&&r.get(n);s&&ma(i,s.name,e)}}function fEe(t,e){var r;if(t!=null&&((r=e==null?void 0:e.fields)!=null&&r.length))if("startField"in t){const i=e.get(t.startField),n=e.get(t.endField);t.startField=(i==null?void 0:i.name)??null,t.endField=(n==null?void 0:n.name)??null}else{const i=e.get(t.startTimeField),n=e.get(t.endTimeField);t.startTimeField=(i==null?void 0:i.name)??null,t.endTimeField=(n==null?void 0:n.name)??null}}const $j=new Set;function mEe(t,e){return t&&e?($j.clear(),UL($j,t,e),Array.from($j).sort()):[]}function UL(t,e,r){var i;if(r)if((i=e==null?void 0:e.fields)!=null&&i.length)if(r.includes("*"))for(const{name:n}of e.fields)t.add(n);else for(const n of r)Yh(t,e,n);else{if(r.includes("*"))return t.clear(),void t.add("*");for(const n of r)n!=null&&t.add(n)}}function Yh(t,e,r){if(typeof r=="string")if(e){const i=e.get(r);i&&t.add(i.name)}else t.add(r)}function rzt(t,e){return R(e)||R(t)?[]:e.includes("*")?(t.fields??[]).map(r=>r.name):e}async function Gc(t,e,r){var s;if(!r)return;const{arcadeUtils:i}=await iy(),n=i.extractFieldNames(r,(s=e==null?void 0:e.fields)==null?void 0:s.map(o=>o.name));for(const o of n)Yh(t,e,o)}async function gEe(t,e,r){if(r&&r!=="1=1"){const i=(await Q(()=>import("./WhereClause-f6ddfb88.js").then(n=>n.W),["assets/WhereClause-f6ddfb88.js","assets/executionError-fb3f283a.js"])).WhereClause.create(r,e);if(!i.isStandardized)throw new H("fieldUtils:collectFilterFields","Where clause is not standardized",{where:r});UL(t,e,i.fieldNames)}}function vHe({displayField:t,fields:e}){return t||(e&&e.length?Lj(e,"name-or-title")||Lj(e,"unique-identifier")||Lj(e,"type-or-category")||bHe(e):null)}function bHe(t){for(const e of t){if(!e||!e.name)continue;const r=e.name.toLowerCase();if(r.includes("name")||r.includes("title"))return e.name}return null}function Lj(t,e){for(const r of t)if(r&&r.valueType&&r.valueType===e)return r.name;return null}async function izt(t,e){var i;if(!e)return;const r=(i=e.elevationInfo)==null?void 0:i.featureExpressionInfo;return r?r.collectRequiredFields(t,e.fieldsIndex):void 0}function wHe(t,e,r){r.onStatisticExpression?Gc(t,e,r.onStatisticExpression.expression):t.add(r.onStatisticField)}async function nzt(t,e,r){if(!e||!r||!("fields"in r))return;const i=[],n=r.popupTemplate;i.push(xHe(t,e,n)),r.fields&&i.push(...r.fields.map(async s=>wHe(t,e.fieldsIndex,s))),await Promise.all(i)}async function xHe(t,e,r){const i=[];r!=null&&r.expressionInfos&&i.push(...r.expressionInfos.map(s=>Gc(t,e.fieldsIndex,s.expression)));const n=r==null?void 0:r.content;if(Array.isArray(n))for(const s of n)s.type==="expression"&&s.expressionInfo&&i.push(Gc(t,e.fieldsIndex,s.expressionInfo.expression));await Promise.all(i)}async function szt(t,e,r){e&&(e.timeInfo&&v(r)&&r.timeExtent&&UL(t,e.fieldsIndex,[e.timeInfo.startField,e.timeInfo.endField]),e.floorInfo&&UL(t,e.fieldsIndex,[e.floorInfo.floorField]),v(r)&&v(r.where)&&await gEe(t,e.fieldsIndex,r.where))}async function ozt(t,e,r){e&&r&&await Promise.all(r.map(i=>THe(t,e,i)))}async function THe(t,e,r){e&&r&&(r.valueExpression?await Gc(t,e.fieldsIndex,r.valueExpression):r.field&&Yh(t,e.fieldsIndex,r.field))}function azt(t){if(!t)return[];const e="editFieldsInfo"in t&&t.editFieldsInfo;return e?mEe(t.fieldsIndex,[e&&e.creatorField,e&&e.creationDateField,e&&e.editorField,e&&e.editDateField]):[]}async function lzt(t,e){const{labelingInfo:r,fieldsIndex:i}=e;r&&r.length&&await Promise.all(r.map(n=>SHe(t,i,n)))}async function SHe(t,e,r){if(!r)return;const i=r.getLabelExpression(),n=r.where;if(i.type==="arcade")await Gc(t,e,i.expression);else{const s=i.expression.match(/{[^}]*}/g);s&&s.forEach(o=>{Yh(t,e,o.slice(1,-1))})}await gEe(t,e,n)}function EHe(t){const e=t.defaultValue;return e!==void 0&&vEe(t,e)?e:t.nullable?null:void 0}function yEe(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}function CHe(t){return t===null||yEe(t)}const une="isInteger"in Number?Number.isInteger:t=>typeof t=="number"&&isFinite(t)&&Math.floor(t)===t;function AHe(t){return t===null||une(t)}function _Ee(t){return t!=null&&typeof t=="string"}function RHe(t){return t===null||_Ee(t)}function OHe(){return!0}function vEe(t,e){let r;switch(t.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":r=t.nullable?AHe:une;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":r=t.nullable?CHe:yEe;break;case"string":case"esriFieldTypeString":r=t.nullable?RHe:_Ee;break;default:r=OHe}return arguments.length===1?r:r(e)}const MHe=["integer","small-integer","single","double"],PHe=new Set([...MHe,"esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]);function M9(t){return t!=null&&PHe.has(t.type)}function czt(t){return t!=null&&(t.type==="string"||t.type==="esriFieldTypeString")}var X8,Y8;function uzt(t){return t==null||typeof t=="number"&&isNaN(t)?null:t}function hzt(t,e){return t==null||t.nullable&&e===null?null:M9(t)&&!IHe(t.type,Number(e))?X8.OUT_OF_RANGE:vEe(t,e)?t.domain?oHe(t.domain,e):null:Y8.INVALID_TYPE}function IHe(t,e){const r=typeof t=="string"?bEe(t):t;if(!r)return!1;const i=r.min,n=r.max;return r.isInteger?une(e)&&e>=i&&e<=n:e>=i&&e<=n}function bEe(t){switch(t){case"esriFieldTypeSmallInteger":case"small-integer":return $He;case"esriFieldTypeInteger":case"integer":return LHe;case"esriFieldTypeSingle":case"single":return DHe;case"esriFieldTypeDouble":case"double":return NHe}}(function(t){t.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(X8||(X8={})),function(t){t.INVALID_TYPE="type-validation-error::invalid-type"}(Y8||(Y8={}));const $He={min:-32768,max:32767,isInteger:!0},LHe={min:-2147483648,max:2147483647,isInteger:!0},DHe={min:-34e37,max:12e37,isInteger:!1},NHe={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1};function dzt(t,e,r){switch(t){case hO.INVALID_CODED_VALUE:return`Value ${r} is not in the coded domain - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case hO.VALUE_OUT_OF_RANGE:return`Value ${r} is out of the range of valid values - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case Y8.INVALID_TYPE:return`Value ${r} is not a valid value for the field type - field: ${e.name}, type: ${e.type}, nullable: ${e.nullable}`;case X8.OUT_OF_RANGE:{const{min:i,max:n}=bEe(e.type);return`Value ${r} is out of range for the number type - field: ${e.name}, type: ${e.type}, value range is ${i} to ${n}`}}}function FHe(t,e){return!kHe(t,e,null)}function kHe(t,e,r){if(!e||!e.attributes||!t){if(v(r))for(const s of t??[])r.add(s);return!0}const i=e.attributes;let n=!1;for(const s of t)if(!(s in i)){if(n=!0,!v(r))break;r.add(s)}return n}function wEe(t){return!!t&&["raster.itempixelvalue","raster.servicepixelvalue"].some(e=>t.toLowerCase().startsWith(e))}let a6=class extends fe{constructor(e){super(e),this.type=null}};u([d({type:["attachments","custom","fields","media","text","expression","relationship"],readOnly:!0,json:{read:!1,write:!0}})],a6.prototype,"type",void 0),a6=u([$("esri.popup.content.Content")],a6);const Rw=a6;var TY;let Nx=TY=class extends Rw{constructor(t){super(t),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new TY({description:this.description,displayType:this.displayType,title:this.title})}};u([d({type:String,json:{write:!0}})],Nx.prototype,"description",void 0),u([d({type:["auto","preview","list"],json:{write:!0}})],Nx.prototype,"displayType",void 0),u([d({type:String,json:{write:!0}})],Nx.prototype,"title",void 0),u([d({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],Nx.prototype,"type",void 0),Nx=TY=u([$("esri.popup.content.AttachmentsContent")],Nx);const zL=Nx;var SY;let Fx=SY=class extends Rw{constructor(t){super(t),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new SY({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?se(this.outFields):null})}};u([d()],Fx.prototype,"creator",void 0),u([d()],Fx.prototype,"destroyer",void 0),u([d()],Fx.prototype,"outFields",void 0),u([d({type:["custom"],readOnly:!0})],Fx.prototype,"type",void 0),Fx=SY=u([$("esri.popup.content.CustomContent")],Fx);const UHe=Fx;var EY;let mC=EY=class extends fe{constructor(t){super(t),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new EY({title:this.title,expression:this.expression})}};u([d({type:String,json:{write:!0}})],mC.prototype,"title",void 0),u([d({type:String,json:{write:!0}})],mC.prototype,"expression",void 0),u([d({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],mC.prototype,"returnType",void 0),mC=EY=u([$("esri.popup.ElementExpressionInfo")],mC);const xEe=mC;var CY;let bP=CY=class extends Rw{constructor(t){super(t),this.expressionInfo=null,this.type="expression"}clone(){var t;return new CY({expressionInfo:(t=this.expressionInfo)==null?void 0:t.clone()})}};u([d({type:xEe,json:{write:!0}})],bP.prototype,"expressionInfo",void 0),u([d({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],bP.prototype,"type",void 0),bP=CY=u([$("esri.popup.content.ExpressionContent")],bP);const hne=bP;function st(t,e={}){const r=t instanceof mr?t:new mr(t,e),i={type:(e==null?void 0:e.ignoreUnknown)??1?r.apiValues:String,json:{type:r.jsonValues,read:!(e!=null&&e.readOnly)&&{reader:r.read},write:{writer:r.write}}};return(e==null?void 0:e.readOnly)!==void 0&&(i.readOnly=!!e.readOnly),(e==null?void 0:e.default)!==void 0&&(i.json.default=e.default),(e==null?void 0:e.name)!==void 0&&(i.json.name=e.name),(e==null?void 0:e.nonNullable)!==void 0&&(i.nonNullable=e.nonNullable),d(i)}const VL=ja()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});VL.toJSON.bind(VL);VL.fromJSON.bind(VL);let y$;var txe,rxe;const zHe=((txe=globalThis.esriConfig)==null?void 0:txe.locale)??((rxe=globalThis.dojoConfig)==null?void 0:rxe.locale);function TEe(){var t;return zHe??((t=globalThis.navigator)==null?void 0:t.language)??"en"}function mp(){return y$===void 0&&(y$=TEe()),y$}const _$=[];function SEe(t){return _$.push(t),{remove(){_$.splice(_$.indexOf(t),1)}}}const AY=[];function dne(t){return AY.push(t),{remove(){_$.splice(AY.indexOf(t),1)}}}function VHe(){const t=TEe();y$!==t&&(y$=t,[...AY].forEach(e=>{e.call(null,t)}),[..._$].forEach(e=>{e.call(null,t)}))}var ixe;(ixe=globalThis.addEventListener)==null||ixe.call(globalThis,"languagechange",VHe);const Am={year:"numeric",month:"numeric",day:"numeric"},nM={year:"numeric",month:"long",day:"numeric"},sM={year:"numeric",month:"short",day:"numeric"},oM={year:"numeric",month:"long",weekday:"long",day:"numeric"},Ad={hour:"numeric",minute:"numeric"},Bp={...Ad,second:"numeric"},pne={"short-date":Am,"short-date-short-time":{...Am,...Ad},"short-date-short-time-24":{...Am,...Ad,hour12:!1},"short-date-long-time":{...Am,...Bp},"short-date-long-time-24":{...Am,...Bp,hour12:!1},"short-date-le":Am,"short-date-le-short-time":{...Am,...Ad},"short-date-le-short-time-24":{...Am,...Ad,hour12:!1},"short-date-le-long-time":{...Am,...Bp},"short-date-le-long-time-24":{...Am,...Bp,hour12:!1},"long-month-day-year":nM,"long-month-day-year-short-time":{...nM,...Ad},"long-month-day-year-short-time-24":{...nM,...Ad,hour12:!1},"long-month-day-year-long-time":{...nM,...Bp},"long-month-day-year-long-time-24":{...nM,...Bp,hour12:!1},"day-short-month-year":sM,"day-short-month-year-short-time":{...sM,...Ad},"day-short-month-year-short-time-24":{...sM,...Ad,hour12:!1},"day-short-month-year-long-time":{...sM,...Bp},"day-short-month-year-long-time-24":{...sM,...Bp,hour12:!1},"long-date":oM,"long-date-short-time":{...oM,...Ad},"long-date-short-time-24":{...oM,...Ad,hour12:!1},"long-date-long-time":{...oM,...Bp},"long-date-long-time-24":{...oM,...Bp,hour12:!1},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":Ad,"long-time":Bp},BL=ja()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});BL.apiValues;BL.toJSON.bind(BL);BL.fromJSON.bind(BL);const BHe={ar:"ar-u-nu-latn-ca-gregory"};let RY=new WeakMap,EEe=pne["short-date-short-time"];function jHe(t){const e=t||EEe;let r=RY.get(e);if(!r){const i=mp(),n=BHe[mp()]||i;r=new Intl.DateTimeFormat(n,e),RY.set(e,r)}return r}function P9(t){return t?pne[t]:null}function ny(t,e){return jHe(e).format(t)}dne(()=>{RY=new WeakMap,EEe=pne["short-date-short-time"]});const GHe={ar:"ar-u-nu-latn"};let l6=new WeakMap,CEe={};function HHe(t){const e=t||CEe;if(!l6.has(e)){const r=mp(),i=GHe[mp()]||r;l6.set(e,new Intl.NumberFormat(i,t))}return l6.get(e)}function AEe(t={}){const e={};return t.digitSeparator!=null&&(e.useGrouping=t.digitSeparator),t.places!=null&&(e.minimumFractionDigits=e.maximumFractionDigits=t.places),e}function sy(t,e){return t===-0&&(t=0),HHe(e).format(t)}dne(()=>{l6=new WeakMap,CEe={}});var OY;let kx=OY=class extends fe{constructor(t){super(t),this.dateFormat=null,this.dateTimeFormatOptions=null,this.digitSeparator=!1,this.places=null}clone(){return new OY({dateFormat:this.dateFormat,digitSeparator:this.digitSeparator,places:this.places})}format(t){return this.dateFormat?ny(t,{...P9(this.dateFormat),...this.dateTimeFormatOptions}):sy(t,AEe(this))}formatRasterPixelValue(t){if(t.includes("-"))return t;let e,r;return t.trim().includes(",")?(e=",",r=e+" ",this._formatDelimitedString(t,e,r,this)):t.trim().includes(";")?(e=";",r=e+" ",this._formatDelimitedString(t,e,r,this)):t.trim().includes(" ")?(e=r=" ",this._formatDelimitedString(t,e,r,this)):this.format(Number(t))}_formatDelimitedString(t,e,r,i){return t&&e&&r&&i?t.trim().split(e).map(n=>this.format(Number(n))).join(r):t}};u([st(VL)],kx.prototype,"dateFormat",void 0),u([d({type:Object,json:{read:!1}})],kx.prototype,"dateTimeFormatOptions",void 0),u([d({type:Boolean,json:{write:!0}})],kx.prototype,"digitSeparator",void 0),u([d({type:Xi,json:{write:!0}})],kx.prototype,"places",void 0),kx=OY=u([$("esri.popup.support.FieldInfoFormat")],kx);const HA=kx;var MY;let ef=MY=class extends fe{constructor(t){super(t),this.fieldName=null,this.format=null,this.isEditable=!1,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new MY({fieldName:this.fieldName,format:this.format?se(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};u([d({type:String,json:{write:!0}})],ef.prototype,"fieldName",void 0),u([d({type:HA,json:{write:!0}})],ef.prototype,"format",void 0),u([d({type:Boolean,json:{write:!0,default:!1}})],ef.prototype,"isEditable",void 0),u([d({type:String,json:{write:!0}})],ef.prototype,"label",void 0),u([st(new mr({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],ef.prototype,"stringFieldOption",void 0),u([d({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],ef.prototype,"statisticType",void 0),u([d({type:String,json:{write:!0}})],ef.prototype,"tooltip",void 0),u([d({type:Boolean,json:{write:!0}})],ef.prototype,"visible",void 0),ef=MY=u([$("esri.popup.FieldInfo")],ef);const pN=ef;var PY;let Zy=PY=class extends Rw{constructor(t){super(t),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(t,e){e.fieldInfos=t&&t.map(r=>r.toJSON())}clone(){return new PY(se({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};u([d({type:Object,json:{write:!0}})],Zy.prototype,"attributes",void 0),u([d({type:String,json:{write:!0}})],Zy.prototype,"description",void 0),u([d({type:[pN]})],Zy.prototype,"fieldInfos",void 0),u([De("fieldInfos")],Zy.prototype,"writeFieldInfos",null),u([d({type:String,json:{write:!0}})],Zy.prototype,"title",void 0),u([d({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],Zy.prototype,"type",void 0),Zy=PY=u([$("esri.popup.content.FieldsContent")],Zy);const dO=Zy;let Ux=class extends fe{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};u([d({type:String,json:{write:!0}})],Ux.prototype,"altText",void 0),u([d({type:String,json:{write:!0}})],Ux.prototype,"caption",void 0),u([d({type:String,json:{write:!0}})],Ux.prototype,"title",void 0),u([d({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],Ux.prototype,"type",void 0),Ux=u([$("esri.popup.content.mixins.MediaInfo")],Ux);const fne=Ux;var IY;let gC=IY=class extends be{constructor(t){super(t),this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new IY({fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};u([d()],gC.prototype,"fieldName",void 0),u([d()],gC.prototype,"tooltip",void 0),u([d()],gC.prototype,"value",void 0),gC=IY=u([$("esri.popup.content.support.ChartMediaInfoValueSeries")],gC);const REe=gC;var $Y;let zx=$Y=class extends fe{constructor(t){super(t),this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new $Y({fields:se(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};u([d({type:[String],json:{write:!0}})],zx.prototype,"fields",void 0),u([d({type:String,json:{write:!0}})],zx.prototype,"normalizeField",void 0),u([d({type:[REe],json:{read:!1}})],zx.prototype,"series",void 0),u([d({type:String,json:{write:!0}})],zx.prototype,"tooltipField",void 0),zx=$Y=u([$("esri.popup.content.support.ChartMediaInfoValue")],zx);const qHe=zx;let wP=class extends fne{constructor(e){super(e),this.type=null,this.value=null}};u([d({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],wP.prototype,"type",void 0),u([d({type:qHe,json:{write:!0}})],wP.prototype,"value",void 0),wP=u([$("esri.popup.content.mixins.ChartMediaInfo")],wP);const I9=wP,$9=ja()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var LY;let c6=LY=class extends I9{constructor(t){super(t),this.type="bar-chart"}clone(){return new LY({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:$9.write}})],c6.prototype,"type",void 0),c6=LY=u([$("esri.popup.content.BarChartMediaInfo")],c6);const OEe=c6;var DY;let u6=DY=class extends I9{constructor(t){super(t),this.type="column-chart"}clone(){return new DY({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:$9.write}})],u6.prototype,"type",void 0),u6=DY=u([$("esri.popup.content.ColumnChartMediaInfo")],u6);const MEe=u6;var NY;let xP=NY=class extends fe{constructor(t){super(t),this.linkURL=null,this.sourceURL=null}clone(){return new NY({linkURL:this.linkURL,sourceURL:this.sourceURL})}};u([d({type:String,json:{write:!0}})],xP.prototype,"linkURL",void 0),u([d({type:String,json:{write:!0}})],xP.prototype,"sourceURL",void 0),xP=NY=u([$("esri.popup.content.support.ImageMediaInfoValue")],xP);const WHe=xP;var FY;let yC=FY=class extends fne{constructor(t){super(t),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new FY({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};u([d({type:Number,json:{write:!0}})],yC.prototype,"refreshInterval",void 0),u([d({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],yC.prototype,"type",void 0),u([d({type:WHe,json:{write:!0}})],yC.prototype,"value",void 0),yC=FY=u([$("esri.popup.content.ImageMediaInfo")],yC);const PEe=yC;var kY;let h6=kY=class extends I9{constructor(t){super(t),this.type="line-chart"}clone(){return new kY({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:$9.write}})],h6.prototype,"type",void 0),h6=kY=u([$("esri.popup.content.LineChartMediaInfo")],h6);const IEe=h6;var UY;let d6=UY=class extends I9{constructor(t){super(t),this.type="pie-chart"}clone(){return new UY({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:$9.write}})],d6.prototype,"type",void 0),d6=UY=u([$("esri.popup.content.PieChartMediaInfo")],d6);const $Ee=d6,LEe={base:fne,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":OEe,"column-chart":MEe,"line-chart":IEe,"pie-chart":$Ee,image:PEe}};var zY;let tf=zY=class extends Rw{constructor(t){super(t),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(t){return t&&t.map(e=>e.type==="image"?PEe.fromJSON(e):e.type==="barchart"?OEe.fromJSON(e):e.type==="columnchart"?MEe.fromJSON(e):e.type==="linechart"?IEe.fromJSON(e):e.type==="piechart"?$Ee.fromJSON(e):void 0).filter(Boolean)}writeMediaInfos(t,e){e.mediaInfos=t&&t.map(r=>r.toJSON())}clone(){return new zY(se({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};u([d()],tf.prototype,"activeMediaInfoIndex",void 0),u([d({type:Object,json:{write:!0}})],tf.prototype,"attributes",void 0),u([d({type:String,json:{write:!0}})],tf.prototype,"description",void 0),u([d({types:[LEe]})],tf.prototype,"mediaInfos",void 0),u([Me("mediaInfos")],tf.prototype,"readMediaInfos",null),u([De("mediaInfos")],tf.prototype,"writeMediaInfos",null),u([d({type:String,json:{write:!0}})],tf.prototype,"title",void 0),u([d({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],tf.prototype,"type",void 0),tf=zY=u([$("esri.popup.content.MediaContent")],tf);const jL=tf;var VY;let TP=VY=class extends fe{constructor(t){super(t),this.field=null,this.order=null}clone(){return new VY({field:this.field,order:this.order})}};u([d({type:String,json:{write:!0}})],TP.prototype,"field",void 0),u([d({type:["asc","desc"],json:{write:!0}})],TP.prototype,"order",void 0),TP=VY=u([$("esri.popup.support.RelatedRecordsInfoFieldOrder")],TP);const mne=TP;let Xm=class extends bi(Rw){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};u([d({type:String,json:{write:!0}})],Xm.prototype,"description",void 0),u([d({type:Number,json:{type:Xi,write:!0}})],Xm.prototype,"displayCount",void 0),u([d({type:["list"],json:{write:!0}})],Xm.prototype,"displayType",void 0),u([d({type:[mne],json:{write:!0}})],Xm.prototype,"orderByFields",void 0),u([d({type:Number,json:{type:Xi,write:!0}})],Xm.prototype,"relationshipId",void 0),u([d({type:String,json:{write:!0}})],Xm.prototype,"title",void 0),u([d({type:["relationship"],readOnly:!0,json:{read:!1,write:!0}})],Xm.prototype,"type",void 0),Xm=u([$("esri.popup.content.RelationshipContent")],Xm);const Z8=Xm;var BY;let SP=BY=class extends Rw{constructor(t){super(t),this.text=null,this.type="text"}clone(){return new BY({text:this.text})}};u([d({type:String,json:{write:!0}})],SP.prototype,"text",void 0),u([d({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],SP.prototype,"type",void 0),SP=BY=u([$("esri.popup.content.TextContent")],SP);const pO=SP,XHe={base:null,key:"type",typeMap:{attachment:zL,media:jL,text:pO,expression:hne,field:dO,relationship:Z8}};var jY;let Vx=jY=class extends fe{constructor(t){super(t),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new jY({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([d({type:String,json:{write:!0}})],Vx.prototype,"name",void 0),u([d({type:String,json:{write:!0}})],Vx.prototype,"title",void 0),u([d({type:String,json:{write:!0}})],Vx.prototype,"expression",void 0),u([d({type:["string","number"],json:{write:!0}})],Vx.prototype,"returnType",void 0),Vx=jY=u([$("esri.popup.ExpressionInfo")],Vx);const DEe=Vx;var GY;let EP=GY=class extends fe{constructor(t){super(t),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new GY({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};u([d({type:Boolean,json:{write:!0}})],EP.prototype,"returnTopmostRaster",void 0),u([d({type:Boolean,json:{write:!0}})],EP.prototype,"showNoDataRecords",void 0),EP=GY=u([$("esri.popup.LayerOptions")],EP);const YHe=EP;var HY;let CP=HY=class extends fe{constructor(t){super(t),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new HY({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?se(this.orderByFields):null})}};u([d({type:Boolean,json:{write:!0}})],CP.prototype,"showRelatedRecords",void 0),u([d({type:[mne],json:{write:!0}})],CP.prototype,"orderByFields",void 0),CP=HY=u([$("esri.popup.RelatedRecordsInfo")],CP);const ZHe=CP;let NEe=0;const c3=t=>{let e=class extends t{constructor(...r){super(...r),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+NEe++})}};return e=u([$("esri.core.Identifiable")],e),e},L9=t=>{let e=class extends t{constructor(...r){super(...r),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:NEe++})}};return e=u([$("esri.core.NumericIdentifiable")],e),e};let Ghe=class extends c3(class{}){};Ghe=u([$("esri.core.Identifiable")],Ghe);var qY;let rf=qY=class extends c3(be){constructor(t){super(t),this.active=!1,this.className=null,this.disabled=!1,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new qY({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};u([d()],rf.prototype,"active",void 0),u([d()],rf.prototype,"className",void 0),u([d()],rf.prototype,"disabled",void 0),u([d()],rf.prototype,"id",void 0),u([d()],rf.prototype,"indicator",void 0),u([d()],rf.prototype,"title",void 0),u([d()],rf.prototype,"type",void 0),u([d()],rf.prototype,"visible",void 0),rf=qY=u([$("esri.support.actions.ActionBase")],rf);const D9=rf;var WY;let p6=WY=class extends D9{constructor(t){super(t),this.image=null,this.type="button"}clone(){return new WY({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};u([d()],p6.prototype,"image",void 0),p6=WY=u([$("esri.support.Action.ActionButton")],p6);const u3=p6;var XY;let AP=XY=class extends D9{constructor(t){super(t),this.image=null,this.type="toggle",this.value=!1}clone(){return new XY({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};u([d()],AP.prototype,"image",void 0),u([d()],AP.prototype,"value",void 0),AP=XY=u([$("esri.support.Action.ActionToggle")],AP);const FEe=AP,JHe="esri.PopupTemplate",KHe=re.getLogger(JHe),aM="relationships/",Hhe="expression/",QHe=ct.ofType({key:"type",defaultKeyValue:"button",base:D9,typeMap:{button:u3,toggle:FEe}}),eqe={base:Rw,key:"type",typeMap:{media:jL,custom:UHe,text:pO,attachments:zL,fields:dO,expression:hne,relationship:Z8}},tqe=["attachments","fields","media","text","expression","relationship"];let qo=class extends bi(fe){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map(r=>om(eqe,r)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||Ju(e)?e:(KHe.error("content error","unsupported content value",{value:e}),null)}readContent(e,r){const{popupElements:i}=r;return Array.isArray(i)&&i.length>0?this._readPopupInfoElements(r.description,r.mediaInfos,i):this._readPopupInfo(r)}writeContent(e,r,i,n){typeof e!="string"?Array.isArray(e)&&(r.popupElements=e.filter(s=>tqe.includes(s.type)).map(s=>s&&s.toJSON(n)),r.popupElements.forEach(s=>{s.type==="attachments"?this._writeAttachmentContent(r):s.type==="media"?this._writeMediaContent(s,r):s.type==="text"?this._writeTextContent(s,r):s.type==="relationship"&&this._writeRelationshipContent(s,r)})):r.description=e}writeFieldInfos(e,r,i,n){const{content:s}=this,o=Array.isArray(s)?s:null;if(e){const a=o?o.filter(c=>c.type==="fields"):[],l=a.length&&a.every(c=>{var h;return(h=c.fieldInfos)==null?void 0:h.length});r.fieldInfos=e.filter(Boolean).map(c=>{const h=c.toJSON(n);return l&&(h.visible=!1),h})}if(o)for(const a of o)a.type==="fields"&&this._writeFieldsContent(a,r)}writeLayerOptions(e,r,i,n){r[i]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(n)}writeTitle(e,r){r.title=e||""}async collectRequiredFields(e,r){const i=this.expressionInfos||[];await this._collectExpressionInfoFields(e,r,[...i,...this._getContentExpressionInfos(this.content,i)]),UL(e,r,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const r=new Set;return await this.collectRequiredFields(r,e),[...r].sort()}_writeFieldsContent(e,r){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const i=se(e.fieldInfos);Array.isArray(r.fieldInfos)?i.forEach(n=>{const s=r.fieldInfos.find(o=>o.fieldName.toLowerCase()===n.fieldName.toLowerCase());s?s.visible=!0:r.fieldInfos.push(n)}):r.fieldInfos=i}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,r){var s,o;const i=((s=e.orderByFields)==null?void 0:s.map(a=>this._toFieldOrderJSON(a,e.relationshipId)))||[],n=[...((o=r.relatedRecordsInfo)==null?void 0:o.orderByFields)||[],...i];r.relatedRecordsInfo={showRelatedRecords:!0,...(n==null?void 0:n.length)&&{orderByFields:n}}}_writeTextContent(e,r){!r.description&&e.text&&(r.description=e.text)}_writeMediaContent(e,r){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const i=se(e.mediaInfos);Array.isArray(r.mediaInfos)?r.mediaInfos=[...r.mediaInfos,...i]:r.mediaInfos=i}_readPopupInfoElements(e,r,i){const n={description:!1,mediaInfos:!1};return i.map(s=>s.type==="media"?(s.mediaInfos||!r||n.mediaInfos||(s.mediaInfos=r,n.mediaInfos=!0),jL.fromJSON(s)):s.type==="text"?(s.text||!e||n.description||(s.text=e,n.description=!0),pO.fromJSON(s)):s.type==="attachments"?zL.fromJSON(s):s.type==="fields"?dO.fromJSON(s):s.type==="expression"?hne.fromJSON(s):s.type==="relationship"?Z8.fromJSON(s):void 0).filter(Boolean)}_toRelationshipContent(e){const{field:r,order:i}=e;if(!(r!=null&&r.startsWith(aM)))return null;const n=r.replace(aM,"").split("/");if(n.length!==2)return null;const s=parseInt(n[0],10),o=n[1];return typeof s=="number"&&o?Z8.fromJSON({relationshipId:s,orderByFields:[{field:o,order:i}]}):null}_toFieldOrderJSON(e,r){const{order:i,field:n}=e;return{field:`${aM}${r}/${n}`,order:i}}_readPopupInfo({description:e,mediaInfos:r,showAttachments:i,relatedRecordsInfo:n={showRelatedRecords:!1}}){const s=[];e?s.push(new pO({text:e})):s.push(new dO),Array.isArray(r)&&r.length&&s.push(jL.fromJSON({mediaInfos:r})),i&&s.push(zL.fromJSON({displayType:"auto"}));const{showRelatedRecords:o,orderByFields:a}=n;return o&&(a!=null&&a.length)&&a.forEach(l=>{const c=this._toRelationshipContent(l);c&&s.push(c)}),s.length?s:e}_getContentElementFields(e){const r=e==null?void 0:e.type;if(r==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(r==="custom")return e.outFields||[];if(r==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos??this.fieldInfos)];if(r==="media"){const i=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...i.reduce((n,s)=>[...n,...this._getMediaInfoFields(s)],[])]}return r==="text"?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:r,title:i,value:n}=e,s=n||{},{fields:o,normalizeField:a,tooltipField:l,sourceURL:c,linkURL:h}=s,p=[...this._extractFieldNames(i),...this._extractFieldNames(r),...this._extractFieldNames(c),...this._extractFieldNames(h),...o??[]];return a&&p.push(a),l&&p.push(l),p}_getContentExpressionInfos(e,r){return Array.isArray(e)?e.reduce((i,n)=>[...i,...n.type==="expression"&&n.expressionInfo?[n.expressionInfo]:[]],r):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((r,i)=>[...r,...this._getContentElementFields(i)],[]):[]}async _collectExpressionInfoFields(e,r,i){i&&await Promise.all(i.map(n=>Gc(e,r,n.expression)))}_getFieldInfoFields(e){return e?e.filter(r=>r.visible===void 0||!!r.visible).map(r=>r.fieldName).filter(r=>!r.startsWith(aM)&&!r.startsWith(Hhe)):[]}_getActionsFields(e){return e?e.toArray().reduce((r,i)=>[...r,...this._getActionFields(i)],[]):[]}_getActionFields(e){const{className:r,title:i,type:n}=e,s=n==="button"||n==="toggle"?e.image:"";return[...this._extractFieldNames(i),...this._extractFieldNames(r),...this._extractFieldNames(s)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){if(!e||typeof e!="string")return[];const r=/{[^}]*}/g,i=e.match(r);if(!i)return[];const n=/\{(\w+):.+\}/,s=i.filter(o=>!(o.indexOf(`{${aM}`)===0||o.indexOf(`{${Hhe}`)===0)).map(o=>o.replace(n,"{$1}"));return s?s.map(o=>o.slice(1,-1)):[]}};u([d({type:QHe})],qo.prototype,"actions",void 0),u([d()],qo.prototype,"content",void 0),u([cr("content")],qo.prototype,"castContent",null),u([Me("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],qo.prototype,"readContent",null),u([De("content",{popupElements:{type:ct.ofType(XHe)},showAttachments:{type:Boolean},mediaInfos:{type:ct.ofType(LEe)},description:{type:String},relatedRecordsInfo:{type:ZHe}})],qo.prototype,"writeContent",null),u([d({type:[DEe],json:{write:!0}})],qo.prototype,"expressionInfos",void 0),u([d({type:[pN]})],qo.prototype,"fieldInfos",void 0),u([De("fieldInfos")],qo.prototype,"writeFieldInfos",null),u([d({type:YHe})],qo.prototype,"layerOptions",void 0),u([De("layerOptions")],qo.prototype,"writeLayerOptions",null),u([d({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],qo.prototype,"lastEditInfoEnabled",void 0),u([d()],qo.prototype,"outFields",void 0),u([d()],qo.prototype,"overwriteActions",void 0),u([d()],qo.prototype,"returnGeometry",void 0),u([d({json:{type:String}})],qo.prototype,"title",void 0),u([De("title")],qo.prototype,"writeTitle",null),qo=u([$("esri.PopupTemplate")],qo);const fN=qo,J8={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function kEe(t){return J8[t]||J8[t.toLowerCase()]}function gne(t){return J8[t]??J8[t.toLowerCase()]}function rqe(t){return[...gne(t)]}function Dj(t,e,r){r<0&&++r,r>1&&--r;const i=6*r;return i<1?t+(e-t)*i:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}function UEe(t,e,r,i=1){const n=(t%360+360)%360/360,s=r<=.5?r*(e+1):r+e-r*e,o=2*r-s;return[Math.round(255*Dj(o,s,n+1/3)),Math.round(255*Dj(o,s,n)),Math.round(255*Dj(o,s,n-1/3)),i]}function iqe(t){const e=t.length>5,r=e?8:4,i=(1<<r)-1,n=e?1:17,s=e?t.length===9:t.length===5;let o=Number("0x"+t.substr(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return s&&(l=o&i,o>>=r,a[3]=n*l/255),l=o&i,o>>=r,a[2]=n*l,l=o&i,o>>=r,a[1]=n*l,l=o&i,o>>=r,a[0]=n*l,a}function P(){return[0,0,0]}function On(t){return[t[0],t[1],t[2]]}function ke(t,e,r){return[t,e,r]}function $c(t){const e=P(),r=Math.min(3,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function yne(t,e){return new Float64Array(t,e,3)}function zEe(){return P()}function VEe(){return ke(1,1,1)}function BEe(){return ke(1,0,0)}function jEe(){return ke(0,1,0)}function _ne(){return ke(0,0,1)}const cl=zEe(),Lg=VEe(),nqe=BEe(),sqe=jEe(),GEe=_ne();Object.freeze(Object.defineProperty({__proto__:null,ONES:Lg,UNIT_X:nqe,UNIT_Y:sqe,UNIT_Z:GEe,ZEROS:cl,clone:On,create:P,createView:yne,fromArray:$c,fromValues:ke,ones:VEe,unitX:BEe,unitY:jEe,unitZ:_ne,zeros:zEe},Symbol.toStringTag,{value:"Module"}));let vne=1e-6;function yl(){return vne}function oqe(t){vne=t}const mN=Math.random,aqe=Math.PI/180,lqe=180/Math.PI;function gN(t){return t*aqe}function cqe(t){return t*lqe}function uqe(t,e){return Math.abs(t-e)<=vne*Math.max(1,Math.abs(t),Math.abs(e))}Object.freeze(Object.defineProperty({__proto__:null,RANDOM:mN,equals:uqe,getEpsilon:yl,setEpsilon:oqe,toDegree:cqe,toRadian:gN},Symbol.toStringTag,{value:"Module"}));function Pe(t){const e=t[0],r=t[1],i=t[2];return Math.sqrt(e*e+r*r+i*i)}function ce(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function he(t,e,r,i){return t[0]=e,t[1]=r,t[2]=i,t}function me(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function ge(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function N9(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function K8(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function hqe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function HEe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function YY(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t}function qEe(t,e){return t[0]=Math.sign(e[0]),t[1]=Math.sign(e[1]),t[2]=Math.sign(e[2]),t}function WEe(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function dqe(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function pqe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function le(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function hS(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t}function Pi(t,e){const r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(r*r+i*i+n*n)}function ga(t,e){const r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return r*r+i*i+n*n}function nl(t){const e=t[0],r=t[1],i=t[2];return e*e+r*r+i*i}function ul(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function fqe(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function we(t,e){const r=e[0],i=e[1],n=e[2];let s=r*r+i*i+n*n;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s),t}function ve(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function vt(t,e,r){const i=e[0],n=e[1],s=e[2],o=r[0],a=r[1],l=r[2];return t[0]=n*l-s*a,t[1]=s*o-i*l,t[2]=i*a-n*o,t}function fs(t,e,r,i){const n=e[0],s=e[1],o=e[2];return t[0]=n+i*(r[0]-n),t[1]=s+i*(r[1]-s),t[2]=o+i*(r[2]-o),t}function mqe(t,e,r,i,n,s){const o=s*s,a=o*(2*s-3)+1,l=o*(s-2)+s,c=o*(s-1),h=o*(3-2*s);return t[0]=e[0]*a+r[0]*l+i[0]*c+n[0]*h,t[1]=e[1]*a+r[1]*l+i[1]*c+n[1]*h,t[2]=e[2]*a+r[2]*l+i[2]*c+n[2]*h,t}function gqe(t,e,r,i,n,s){const o=1-s,a=o*o,l=s*s,c=a*o,h=3*s*a,p=3*l*o,f=l*s;return t[0]=e[0]*c+r[0]*h+i[0]*p+n[0]*f,t[1]=e[1]*c+r[1]*h+i[1]*p+n[1]*f,t[2]=e[2]*c+r[2]*h+i[2]*p+n[2]*f,t}function yqe(t,e){e=e||1;const r=mN,i=2*r()*Math.PI,n=2*r()-1,s=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(i)*s,t[1]=Math.sin(i)*s,t[2]=n*e,t}function Ke(t,e,r){const i=e[0],n=e[1],s=e[2];return t[0]=r[0]*i+r[4]*n+r[8]*s+r[12],t[1]=r[1]*i+r[5]*n+r[9]*s+r[13],t[2]=r[2]*i+r[6]*n+r[10]*s+r[14],t}function Gl(t,e,r){const i=e[0],n=e[1],s=e[2];return t[0]=i*r[0]+n*r[3]+s*r[6],t[1]=i*r[1]+n*r[4]+s*r[7],t[2]=i*r[2]+n*r[5]+s*r[8],t}function Qf(t,e,r){const i=r[0],n=r[1],s=r[2],o=r[3],a=e[0],l=e[1],c=e[2];let h=n*c-s*l,p=s*a-i*c,f=i*l-n*a,m=n*f-s*p,g=s*h-i*f,_=i*p-n*h;const b=2*o;return h*=b,p*=b,f*=b,m*=2,g*=2,_*=2,t[0]=a+h+m,t[1]=l+p+g,t[2]=c+f+_,t}function _qe(t,e,r,i){const n=[],s=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],s[0]=n[0],s[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),s[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function vqe(t,e,r,i){const n=[],s=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],s[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),s[1]=n[1],s[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function bqe(t,e,r,i){const n=[],s=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],s[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),s[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),s[2]=n[2],t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function XEe(t,e){ce(PF,t),ce(IF,e),we(PF,PF),we(IF,IF);const r=ve(PF,IF);return r>1?0:r<-1?Math.PI:Math.acos(r)}const PF=P(),IF=P();function wqe(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function Hl(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Xb(t,e){if(t===e)return!0;const r=t[0],i=t[1],n=t[2],s=e[0],o=e[1],a=e[2],l=yl();return Math.abs(r-s)<=l*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-o)<=l*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-a)<=l*Math.max(1,Math.abs(n),Math.abs(a))}function L_(t,e,r){const i=r[0]-e[0],n=r[1]-e[1],s=r[2]-e[2];let o=i*i+n*n+s*s;return o>0?(o=1/Math.sqrt(o),t[0]=i*o,t[1]=n*o,t[2]=s*o,t):(t[0]=0,t[1]=0,t[2]=0,t)}const Lo=ge,xqe=N9,Tqe=K8,yN=Pi,bne=ga,Tu=Pe,ZY=nl,qhe=Object.freeze(Object.defineProperty({__proto__:null,abs:YY,add:me,angle:XEe,bezier:gqe,ceil:hqe,copy:ce,cross:vt,direction:L_,dist:yN,distance:Pi,div:Tqe,divide:K8,dot:ve,equals:Xb,exactEquals:Hl,floor:HEe,hermite:mqe,inverse:fqe,len:Tu,length:Pe,lerp:fs,max:dqe,min:WEe,mul:xqe,multiply:N9,negate:ul,normalize:we,random:yqe,rotateX:_qe,rotateY:vqe,rotateZ:bqe,round:pqe,scale:le,scaleAndAdd:hS,set:he,sign:qEe,sqrDist:bne,sqrLen:ZY,squaredDistance:ga,squaredLength:nl,str:wqe,sub:Lo,subtract:ge,transformMat3:Gl,transformMat4:Ke,transformQuat:Qf},Symbol.toStringTag,{value:"Module"}));function Vf(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function ai(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t}function wne(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function YEe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function ZEe(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function JEe(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function Sqe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function Eqe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function Cqe(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}function Aqe(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}function Rqe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function h3(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function Oqe(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t}function KEe(t,e){const r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2],s=e[3]-t[3];return Math.sqrt(r*r+i*i+n*n+s*s)}function Q8(t,e){const r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2],s=e[3]-t[3];return r*r+i*i+n*n+s*s}function xne(t){const e=t[0],r=t[1],i=t[2],n=t[3];return Math.sqrt(e*e+r*r+i*i+n*n)}function Tne(t){const e=t[0],r=t[1],i=t[2],n=t[3];return e*e+r*r+i*i+n*n}function Mqe(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function Pqe(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function QEe(t,e){const r=e[0],i=e[1],n=e[2],s=e[3];let o=r*r+i*i+n*n+s*s;return o>0&&(o=1/Math.sqrt(o),t[0]=r*o,t[1]=i*o,t[2]=n*o,t[3]=s*o),t}function eCe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function F9(t,e,r,i){const n=e[0],s=e[1],o=e[2],a=e[3];return t[0]=n+i*(r[0]-n),t[1]=s+i*(r[1]-s),t[2]=o+i*(r[2]-o),t[3]=a+i*(r[3]-a),t}function Iqe(t,e){const r=mN;let i,n,s,o,a,l;e=e||1;do i=2*r()-1,n=2*r()-1,a=i*i+n*n;while(a>=1);do s=2*r()-1,o=2*r()-1,l=s*s+o*o;while(l>=1);const c=Math.sqrt((1-a)/l);return t[0]=e*i,t[1]=e*n,t[2]=e*s*c,t[3]=e*o*c,t}function qh(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3];return t[0]=r[0]*i+r[4]*n+r[8]*s+r[12]*o,t[1]=r[1]*i+r[5]*n+r[9]*s+r[13]*o,t[2]=r[2]*i+r[6]*n+r[10]*s+r[14]*o,t[3]=r[3]*i+r[7]*n+r[11]*s+r[15]*o,t}function $qe(t,e,r){const i=e[0],n=e[1],s=e[2],o=r[0],a=r[1],l=r[2],c=r[3],h=c*i+a*s-l*n,p=c*n+l*i-o*s,f=c*s+o*n-a*i,m=-o*i-a*n-l*s;return t[0]=h*c+m*-o+p*-l-f*-a,t[1]=p*c+m*-a+f*-o-h*-l,t[2]=f*c+m*-l+h*-a-p*-o,t[3]=e[3],t}function Lqe(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function xR(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Sne(t,e){const r=t[0],i=t[1],n=t[2],s=t[3],o=e[0],a=e[1],l=e[2],c=e[3],h=yl();return Math.abs(r-o)<=h*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=h*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-l)<=h*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-c)<=h*Math.max(1,Math.abs(s),Math.abs(c))}const Dqe=YEe,Nqe=ZEe,Fqe=JEe,kqe=KEe,Uqe=Q8,zqe=xne,Vqe=Tne,tCe=Object.freeze(Object.defineProperty({__proto__:null,add:wne,ceil:Sqe,copy:Vf,dist:kqe,distance:KEe,div:Fqe,divide:JEe,dot:eCe,equals:Sne,exactEquals:xR,floor:Eqe,inverse:Pqe,len:zqe,length:xne,lerp:F9,max:Aqe,min:Cqe,mul:Nqe,multiply:ZEe,negate:Mqe,normalize:QEe,random:Iqe,round:Rqe,scale:h3,scaleAndAdd:Oqe,set:ai,sqrDist:Uqe,sqrLen:Vqe,squaredDistance:Q8,squaredLength:Tne,str:Lqe,sub:Dqe,subtract:YEe,transformMat4:qh,transformQuat:$qe},Symbol.toStringTag,{value:"Module"})),Whe=new Float32Array(1);function fO(t){--t;for(let e=1;e<32;e<<=1)t|=t>>e;return t+1}function _e(t,e,r){return Math.min(Math.max(t,e),r)}function lm(t){return(t&t-1)==0}function vzt(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function bzt(t){return 10**Math.ceil(Math.LOG10E*Math.log(t))}function Bt(t,e,r){return t+(e-t)*r}function Xt(t){return t*Math.PI/180}function dl(t){return 180*t/Math.PI}function Nj(t,e=1e-6){return(t<0?-1:1)/Math.max(Math.abs(t),e)}function Js(t){return Math.acos(_e(t,-1,1))}function Ep(t){return Math.asin(_e(t,-1,1))}function TR(t,e,r=1e-6){return t===e?!0:!Number.isFinite(t)||!Number.isFinite(e)?!1:(t>e?t-e:e-t)<=r}const ez=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT));function Bqe(t){return ez.setFloat64(0,t),ez.getBigInt64(0)}function jqe(t){return ez.setBigInt64(0,t),ez.getFloat64(0)}const Fj=BigInt("1000000");Gqe(1);function Gqe(t){const e=Bqe(t=Math.abs(t)),r=jqe(e<=Fj?Fj:e-Fj);return Math.abs(t-r)}function Hqe(t,e,r=1e-6){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;const i=Math.abs(t-e),n=Math.abs(t),s=Math.abs(e);if(t===0||e===0||n<1e-12&&s<1e-12){if(i>.01*r)return!1}else if(i/(n+s)>r)return!1;return!0}function qqe(t){return rCe(Math.max(-JY,Math.min(t,JY)))}function rCe(t){return Whe[0]=t,Whe[0]}function mO(t,e,r){const i=_e((r-t)/(e-t),0,1);return i*i*(3-2*i)}function Xhe(t,e){const r=Pe(t),i=Ep(t[2]/r),n=Math.atan2(t[1]/r,t[0]/r);return he(e,r,i,n),e}function wzt(t,e,r){return ai(t,e[0],e[1],e[2],e[3]*r)}function xzt(t){const e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[3]*t[3]+t[4]*t[4]+t[5]*t[5],i=t[6]*t[6]+t[7]*t[7]+t[8]*t[8];return!(TR(e,1)&&TR(r,1)&&TR(i,1))}const JY=rCe(34028234663852886e22);function $F(t){return _e(Uie(t),0,255)}function LF(t,e,r){return t=Number(t),isNaN(t)?r:t<e?e:t>r?r:t}let f6=class Ja{static blendColors(e,r,i,n=new Ja){return n.r=Math.round(e.r+(r.r-e.r)*i),n.g=Math.round(e.g+(r.g-e.g)*i),n.b=Math.round(e.b+(r.b-e.b)*i),n.a=e.a+(r.a-e.a)*i,n._sanitize()}static fromRgb(e,r){const i=e.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(i){const n=i[2].split(/\s*,\s*/),s=i[1];if(s==="rgb"&&n.length===3||s==="rgba"&&n.length===4){const o=n[0];if(o.charAt(o.length-1)==="%"){const a=n.map(l=>2.56*parseFloat(l));return n.length===4&&(a[3]=parseFloat(n[3])),Ja.fromArray(a,r)}return Ja.fromArray(n.map(a=>parseFloat(a)),r)}if(s==="hsl"&&n.length===3||s==="hsla"&&n.length===4)return Ja.fromArray(UEe(parseFloat(n[0]),parseFloat(n[1])/100,parseFloat(n[2])/100,parseFloat(n[3])),r)}return null}static fromHex(e,r=new Ja){if(e.length!==4&&e.length!==7||e[0]!=="#")return null;const i=e.length===4?4:8,n=(1<<i)-1;let s=Number("0x"+e.substr(1));return isNaN(s)?null:(["b","g","r"].forEach(o=>{const a=s&n;s>>=i,r[o]=i===4?17*a:a}),r.a=1,r)}static fromArray(e,r=new Ja){return r._set(Number(e[0]),Number(e[1]),Number(e[2]),Number(e[3])),isNaN(r.a)&&(r.a=1),r._sanitize()}static fromString(e,r){const i=kEe(e)?gne(e):null;return i&&Ja.fromArray(i,r)||Ja.fromRgb(e,r)||Ja.fromHex(e,r)}static fromJSON(e){return e&&new Ja([e[0],e[1],e[2],e[3]/255])}static toUnitRGB(e){return v(e)?[e.r/255,e.g/255,e.b/255]:null}static toUnitRGBA(e){return v(e)?[e.r/255,e.g/255,e.b/255,e.a!=null?e.a:1]:null}constructor(e){this.r=255,this.g=255,this.b=255,this.a=1,e&&this.setColor(e)}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(e){return typeof e=="string"?Ja.fromString(e,this):Array.isArray(e)?Ja.fromArray(e,this):(this._set(e.r??0,e.g??0,e.b??0,e.a??1),e instanceof Ja||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(){const e=this.r.toString(16),r=this.g.toString(16),i=this.b.toString(16);return`#${e.length<2?"0"+e:e}${r.length<2?"0"+r:r}${i.length<2?"0"+i:i}`}toCss(e=!1){const r=this.r+", "+this.g+", "+this.b;return e?`rgba(${r}, ${this.a})`:`rgb(${r})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(e=Ja.AlphaMode.ALWAYS){const r=$F(this.r),i=$F(this.g),n=$F(this.b);return e===Ja.AlphaMode.ALWAYS||this.a!==1?[r,i,n,$F(255*this.a)]:[r,i,n]}clone(){return new Ja(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(e){return v(e)&&e.r===this.r&&e.g===this.g&&e.b===this.b&&e.a===this.a}_sanitize(){return this.r=Math.round(LF(this.r,0,255)),this.g=Math.round(LF(this.g,0,255)),this.b=Math.round(LF(this.b,0,255)),this.a=LF(this.a,0,1),this}_set(e,r,i,n){this.r=e,this.g=r,this.b=i,this.a=n}};f6.prototype.declaredClass="esri.Color",function(t){var e;(e=t.AlphaMode||(t.AlphaMode={}))[e.ALWAYS=0]="ALWAYS",e[e.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(f6||(f6={}));const Xe=f6,Yhe=new mr({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let Wqe=0,_C=class extends fe{constructor(e){super(e),this.id="sym"+Wqe++,this.type=null,this.color=new Xe([0,0,0,1])}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,r){}hash(){return JSON.stringify(this.toJSON())}clone(){}};u([d({type:Yhe.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:Yhe.write}}})],_C.prototype,"type",void 0),u([d({type:Xe,json:{write:{allowNull:!0}}})],_C.prototype,"color",void 0),u([Me("color")],_C.prototype,"readColor",null),_C=u([$("esri.symbols.Symbol")],_C);const Ku=_C;var KY;let Wv=KY=class extends Ku{constructor(t){super(t),this.data=null,this.type="cim"}readData(t,e){return e}writeData(t,e){if(t)for(const r in t)e[r]=t[r]}async collectRequiredFields(t,e){var r;if(((r=this.data)==null?void 0:r.type)==="CIMSymbolReference"){const i=this.data.primitiveOverrides;if(i){const n=i.map(s=>{const o=s.valueExpressionInfo;return Gc(t,e,o.expression)});await Promise.all(n)}}}clone(){return new KY({data:se(this.data)})}hash(){return Fie(JSON.stringify(this.data)).toString()}};u([d({json:{write:!1}})],Wv.prototype,"color",void 0),u([d({json:{write:!0}})],Wv.prototype,"data",void 0),u([Me("data",["symbol"])],Wv.prototype,"readData",null),u([De("data",{})],Wv.prototype,"writeData",null),u([st({CIMSymbolReference:"cim"},{readOnly:!0})],Wv.prototype,"type",void 0),Wv=KY=u([$("esri.symbols.CIMSymbol")],Wv);const d3=Wv;let vC=class extends fe{constructor(e){super(e),this.enabled=!0,this.type=null}writeEnabled(e,r,i){e||(r[i]=e)}};u([d({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],vC.prototype,"enabled",void 0),u([De("enabled")],vC.prototype,"writeEnabled",null),u([d({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],vC.prototype,"type",void 0),vC=u([$("esri.symbols.Symbol3DLayer")],vC);const yy=vC,Xqe=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,Yqe="screenUtils.toPt: input not recognized!",iCe=96;function da(t){return t?t/72*iCe:0}function Cp(t){return t?72*t/iCe:0}function yi(t){if(typeof t=="string"){const e=t.match(Xqe);if(e){const r=Number(e[1]),i=e[3]&&e[3].toLowerCase(),n=t.charAt(0)==="-",s=i==="px"?Cp(r):r;return n?-s:s}return console.warn(Yqe),null}return t}function Gs(t=0,e=0){return{x:t,y:e}}function wn(t=0,e=0){return[t,e]}function nCe(t=0,e=0){return[t,e]}function La(t=0,e=0,r=0){return[t,e,r]}function Ezt(t){return t}function Czt(t){return t}function Azt(t){return t}function Og(t,e){return e?(e[0]=t.x,e[1]=t.y,e.length>2&&(e[2]=0),e):[t.x,t.y]}function k9(t){const e=Uie(100*(1-t));return Math.max(0,Math.min(e,100))}function GL(t){const e=1-t/100;return Math.max(0,Math.min(e,1))}function Zqe(t,e){const r=e.transparency!=null?GL(e.transparency):1,i=e.color;return i&&Array.isArray(i)?new Xe([i[0]||0,i[1]||0,i[2]||0,r]):null}function Jqe(t,e){e.color=t.toJSON().slice(0,3);const r=k9(t.a);r!==0&&(e.transparency=r)}const D_={type:Xe,json:{type:[Xi],default:null,read:{source:["color","transparency"],reader:Zqe},write:{target:{color:{type:[Xi]},transparency:{type:Xi}},writer:Jqe}}},oy={type:Number,cast:yi,json:{write:!0}};let Bx=class extends fe{constructor(e){super(e),this.color=new Xe([0,0,0,1]),this.extensionLength=0,this.size=Cp(1)}clone(){}cloneProperties(){return{color:se(this.color),size:this.size,extensionLength:this.extensionLength}}};u([d({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],Bx.prototype,"type",void 0),u([d(D_)],Bx.prototype,"color",void 0),u([d({...oy,json:{write:{overridePolicy:t=>({enabled:!!t})}}})],Bx.prototype,"extensionLength",void 0),u([d(oy)],Bx.prototype,"size",void 0),Bx=u([$("esri.symbols.edges.Edges3D")],Bx);const Ene=Bx;var QY;let m6=QY=class extends Ene{constructor(t){super(t),this.type="sketch"}clone(){return new QY(this.cloneProperties())}};u([st({sketch:"sketch"},{readOnly:!0})],m6.prototype,"type",void 0),m6=QY=u([$("esri.symbols.edges.SketchEdges3D")],m6);const Kqe=m6;var eZ;let g6=eZ=class extends Ene{constructor(t){super(t),this.type="solid"}clone(){return new eZ(this.cloneProperties())}};u([st({solid:"solid"},{readOnly:!0})],g6.prototype,"type",void 0),g6=eZ=u([$("esri.symbols.support.SolidEdges3D")],g6);const Qqe=g6,sCe={types:{key:"type",base:Ene,typeMap:{solid:Qqe,sketch:Kqe}},json:{write:!0}};var tZ;let Zh=tZ=class extends fe{constructor(t){super(t),this.color=null}clone(){const t={color:v(this.color)?this.color.clone():null};return new tZ(t)}};u([d(D_)],Zh.prototype,"color",void 0),Zh=tZ=u([$("esri.symbols.support.Symbol3DMaterial")],Zh);var rZ;let Xv=rZ=class extends yy{constructor(t){super(t),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new rZ({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:v(this.material)?this.material.clone():null,castShadows:this.castShadows,size:this.size})}};u([st({Extrude:"extrude"},{readOnly:!0})],Xv.prototype,"type",void 0),u([d({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],Xv.prototype,"size",void 0),u([d({type:Zh,json:{write:!0}})],Xv.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Xv.prototype,"castShadows",void 0),u([d(sCe)],Xv.prototype,"edges",void 0),Xv=rZ=u([$("esri.symbols.ExtrudeSymbol3DLayer")],Xv);const oCe=Xv;let RP=class extends Ku{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};u([st({esriSLS:"simple-line"},{readOnly:!0})],RP.prototype,"type",void 0),u([d({type:Number,cast:yi,json:{write:!0}})],RP.prototype,"width",void 0),RP=u([$("esri.symbols.LineSymbol")],RP);const eWe=RP,tWe=["begin","end","begin-end"],aCe=["arrow","circle","square","diamond","cross","x"];var iZ;let Ym=iZ=class extends fe{constructor(t){super(t),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(t,e,r,i){e[r]=(i==null?void 0:i.origin)==="web-map"?"arrow":t}set color(t){this._set("color",t)}readColor(t){return t&&t[0]!=null?[t[0],t[1],t[2],t[3]/255]:t}writeColor(t,e,r,i){(i==null?void 0:i.origin)==="web-map"||(e[r]=t)}clone(){return new iZ({color:se(this.color),placement:this.placement,style:this.style})}hash(){var t;return`${this.placement}.${(t=this.color)==null?void 0:t.hash()}.${this.style}`}};u([d({type:["begin","end","begin-end"],json:{write:!0}})],Ym.prototype,"placement",void 0),u([st({"line-marker":"line-marker"},{readOnly:!0}),d({json:{origins:{"web-map":{write:!1}}}})],Ym.prototype,"type",void 0),u([d({type:aCe})],Ym.prototype,"style",void 0),u([De("style")],Ym.prototype,"writeStyle",null),u([d({type:Xe,value:null,json:{write:{allowNull:!0}}})],Ym.prototype,"color",null),u([Me("color")],Ym.prototype,"readColor",null),u([De("color")],Ym.prototype,"writeColor",null),Ym=iZ=u([$("esri.symbols.LineSymbolMarker")],Ym);const rWe=Ym;var nZ;const kj=new mr({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let Jy=nZ=class extends eWe{constructor(...t){super(...t),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(t,e,r,i,n,s){if(t&&typeof t!="string")return t;const o={};return t!=null&&(o.style=t),e!=null&&(o.color=e),r!=null&&(o.width=yi(r)),i!=null&&(o.cap=i),n!=null&&(o.join=n),s!=null&&(o.miterLimit=yi(s)),o}clone(){var t;return new nZ({color:se(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:(t=this.marker)==null?void 0:t.clone()})}hash(){var t,e;return`${super.hash()}.${(t=this.color)==null?void 0:t.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${(e=this.marker)==null?void 0:e.hash()}`}};u([st({esriSLS:"simple-line"},{readOnly:!0})],Jy.prototype,"type",void 0),u([d({type:kj.apiValues,json:{read:kj.read,write:kj.write}})],Jy.prototype,"style",void 0),u([d({type:["butt","round","square"],json:{write:{overridePolicy:(t,e,r)=>({enabled:t!=="round"&&(r==null||r.origin==null)})}}})],Jy.prototype,"cap",void 0),u([d({type:["miter","round","bevel"],json:{write:{overridePolicy:(t,e,r)=>({enabled:t!=="round"&&(r==null||r.origin==null)})}}})],Jy.prototype,"join",void 0),u([d({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":rWe}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],Jy.prototype,"marker",void 0),u([d({type:Number,json:{read:!1,write:!1}})],Jy.prototype,"miterLimit",void 0),Jy=nZ=u([$("esri.symbols.SimpleLineSymbol")],Jy);const Lp=Jy;let OP=class extends Ku{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};u([d({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Lp}},json:{default:null,write:!0}})],OP.prototype,"outline",void 0),u([d({type:["simple-fill","picture-fill"],readOnly:!0})],OP.prototype,"type",void 0),OP=u([$("esri.symbols.FillSymbol")],OP);const lCe=OP;let y6=class extends fe{constructor(e){super(e)}clone(){}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],y6.prototype,"type",void 0),y6=u([$("esri.symbols.patterns.LinePattern3D")],y6);const cCe=y6,iWe=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var sZ;const nWe=ja()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let MP=sZ=class extends cCe{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new sZ(t)}};u([d({type:["style"]})],MP.prototype,"type",void 0),u([st(nWe),d({type:iWe})],MP.prototype,"style",void 0),MP=sZ=u([$("esri.symbols.patterns.LineStylePattern3D")],MP);const Cne=MP;let _6=class extends fe{constructor(e){super(e)}clone(){}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],_6.prototype,"type",void 0),_6=u([$("esri.symbols.patterns.Pattern3D")],_6);const uCe=_6,sWe=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var oZ;let PP=oZ=class extends uCe{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new oZ(t)}};u([d({type:["style"]})],PP.prototype,"type",void 0),u([d({type:sWe,json:{read:!0,write:!0}})],PP.prototype,"style",void 0),PP=oZ=u([$("esri.symbols.patterns.StylePattern3D")],PP);const hCe=PP,oWe={types:{key:"type",base:uCe,typeMap:{style:hCe}},json:{write:!0}},dCe={types:{key:"type",base:cCe,typeMap:{style:Cne}},json:{write:!0}},v$=new Xe("white");new Xe("black");const aWe=new Xe([255,255,255,0]);function lWe(t){return t.r===0&&t.g===0&&t.b===0}var aZ;let b$=aZ=class extends Zh{constructor(t){super(t),this.colorMixMode=null}clone(){const t={color:v(this.color)?this.color.clone():null,colorMixMode:this.colorMixMode};return new aZ(t)}};u([st({multiply:"multiply",replace:"replace",tint:"tint"})],b$.prototype,"colorMixMode",void 0),b$=aZ=u([$("esri.symbols.support.Symbol3DFillMaterial")],b$);function Kt(t=dWe){return[t[0],t[1],t[2],t[3]]}function $zt(t){return[t[0],t[1],t[2],t[3]]}function w_(t,e){return t!==e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]),t}function Ane(t,e,r,i,n=Kt()){return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n}function HL(t,e=Kt()){return e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax,e}function U9(t,e){return new ur({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}function Rne(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function $b(t,e,r){if(R(e))w_(r,t);else if("length"in e)hZ(e)?(r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.max(t[2],e[2]),r[3]=Math.max(t[3],e[3])):e.length!==2&&e.length!==3||(r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.max(t[2],e[0]),r[3]=Math.max(t[3],e[1]));else switch(e.type){case"extent":r[0]=Math.min(t[0],e.xmin),r[1]=Math.min(t[1],e.ymin),r[2]=Math.max(t[2],e.xmax),r[3]=Math.max(t[3],e.ymax);break;case"point":r[0]=Math.min(t[0],e.x),r[1]=Math.min(t[1],e.y),r[2]=Math.max(t[2],e.x),r[3]=Math.max(t[3],e.y)}}function Uj(t,e,r=t){const i=e.length;let n=t[0],s=t[1],o=t[2],a=t[3];for(let l=0;l<i;l++){const c=e[l];n=Math.min(n,c[0]),s=Math.min(s,c[1]),o=Math.max(o,c[0]),a=Math.max(a,c[1])}return r[0]=n,r[1]=s,r[2]=o,r[3]=a,r}function lZ(t){for(let e=0;e<4;e++)if(!isFinite(t[e]))return!1;return!0}function Bh(t){return R(t)||t[0]>=t[2]?0:t[2]-t[0]}function cm(t){return t[1]>=t[3]?0:t[3]-t[1]}function pCe(t){return Bh(t)*cm(t)}function One(t,e=[0,0]){return e[0]=(t[0]+t[2])/2,e[1]=(t[1]+t[3])/2,e}function fCe(t,e){return z9(t,e[0],e[1])}function Zhe(t,e){const r=e[3],i=.5*(t[0]+t[2]),n=Math.abs(e[0]-i),s=.5*(t[2]-t[0]);if(n>r+s)return!1;const o=.5*(t[1]+t[3]),a=.5*(t[3]-t[1]),l=Math.abs(e[1]-o);if(l>r+a)return!1;if(n<s||l<a)return!0;const c=n-s,h=l-a;return c*c+h*h<=r*r}function Lzt(t,e,r){const i=t[0],n=t[1],s=t[2],o=t[3],{x:a,y:l}=e,{x:c,y:h}=r,p=(b,w)=>(h-l)*b+(a-c)*w+(c*l-a*h)<0,f=p(i,o),m=p(s,o),g=p(s,n),_=p(i,n);return!(f===m&&m===g&&g===_&&_===f||a<i&&c<i||a>s&&c>s||l>o&&h>o||l<n&&h<n)}function Dzt(t,e){return z9(t,e.x,e.y)}function z9(t,e,r){return e>=t[0]&&r>=t[1]&&e<=t[2]&&r<=t[3]}function cWe(t,e,r){return e[0]>=t[0]-r&&e[1]>=t[1]-r&&e[0]<=t[2]+r&&e[1]<=t[3]+r}function V9(t,e){return Math.max(e[0],t[0])<=Math.min(e[2],t[2])&&Math.max(e[1],t[1])<=Math.min(e[3],t[3])}function cZ(t,e){return e[0]>=t[0]&&e[2]<=t[2]&&e[1]>=t[1]&&e[3]<=t[3]}function uZ(t,e,r){if(R(e))return w_(r,t);const i=e[0],n=e[1],s=e[2],o=e[3];return r[0]=_e(t[0],i,s),r[1]=_e(t[1],n,o),r[2]=_e(t[2],i,s),r[3]=_e(t[3],n,o),r}function uWe(t,e){const r=(t[0]+t[2])/2,i=(t[1]+t[3])/2,n=Math.max(Math.abs(e[0]-r)-Bh(t)/2,0),s=Math.max(Math.abs(e[1]-i)-cm(t)/2,0);return Math.sqrt(n*n+s*s)}function tz(t,e,r,i=t){return i[0]=t[0]+e,i[1]=t[1]+r,i[2]=t[2]+e,i[3]=t[3]+r,i}function td(t){return t?w_(t,dZ):Kt(dZ)}function hZ(t){return t!=null&&t.length===4}function hWe(t){return!(Bh(t)!==0&&isFinite(t[0])||cm(t)!==0&&isFinite(t[1]))}function AS(t,e){return hZ(t)&&hZ(e)?t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]:t===e}const Nzt=[-1/0,-1/0,1/0,1/0],dZ=[1/0,1/0,-1/0,-1/0],dWe=[0,0,0,0];function Ks(t=vCe){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function r2(t,e,r,i,n,s,o=Ks()){return o[0]=t,o[1]=e,o[2]=r,o[3]=i,o[4]=n,o[5]=s,o}function Fzt(t,e){const r=isFinite(t[2])||isFinite(t[5]);return new ur(r?{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],zmin:t[2],zmax:t[5],spatialReference:e}:{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],spatialReference:e})}function gO(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[3]),t[4]=Math.max(t[4],e[4]),t[5]=Math.max(t[5],e[5])}function pWe(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[3]=Math.max(t[3],e[2]),t[4]=Math.max(t[4],e[3])}function ay(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[0]),t[4]=Math.max(t[4],e[1]),t[5]=Math.max(t[5],e[2])}function Wh(t,e,r=0,i=e.length/3){let n=t[0],s=t[1],o=t[2],a=t[3],l=t[4],c=t[5];for(let h=0;h<i;h++)n=Math.min(n,e[r+3*h]),s=Math.min(s,e[r+3*h+1]),o=Math.min(o,e[r+3*h+2]),a=Math.max(a,e[r+3*h]),l=Math.max(l,e[r+3*h+1]),c=Math.max(c,e[r+3*h+2]);t[0]=n,t[1]=s,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function zj(t,e,r){const i=e.length;let n=t[0],s=t[1],o=t[2],a=t[3],l=t[4],c=t[5];if(r)for(let h=0;h<i;h++){const p=e[h];n=Math.min(n,p[0]),s=Math.min(s,p[1]),o=Math.min(o,p[2]),a=Math.max(a,p[0]),l=Math.max(l,p[1]),c=Math.max(c,p[2])}else for(let h=0;h<i;h++){const p=e[h];n=Math.min(n,p[0]),s=Math.min(s,p[1]),a=Math.max(a,p[0]),l=Math.max(l,p[1])}t[0]=n,t[1]=s,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function fWe(t){for(let e=0;e<6;e++)if(!isFinite(t[e]))return!1;return!0}function N2(t){return t[0]>=t[3]?0:t[3]-t[0]}function F2(t){return t[1]>=t[4]?0:t[4]-t[1]}function Ow(t){return t[2]>=t[5]?0:t[5]-t[2]}function mCe(t){const e=N2(t),r=Ow(t),i=F2(t);return Math.sqrt(e*e+r*r+i*i)}function Bf(t,e=[0,0,0]){return e[0]=t[0]+N2(t)/2,e[1]=t[1]+F2(t)/2,e[2]=t[2]+Ow(t)/2,e}function DF(t,e=[0,0,0]){return e[0]=N2(t),e[1]=F2(t),e[2]=Ow(t),e}function Mne(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[0]<=t[3]&&e[1]<=t[4]&&e[2]<=t[5]}function kzt(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[3]<=t[3]&&e[4]<=t[4]&&e[5]<=t[5]}function mWe(t,e){return Math.max(e[0],t[0])<=Math.min(e[3],t[3])&&Math.max(e[1],t[1])<=Math.min(e[4],t[4])&&Math.max(e[2],t[2])<=Math.min(e[5],t[5])}function jf(t,e){return!!R(e)||mWe(t,e)}function gCe(t,e,r,i,n=t){return n[0]=t[0]+e,n[1]=t[1]+r,n[2]=t[2]+i,n[3]=t[3]+e,n[4]=t[4]+r,n[5]=t[5]+i,n}function Uzt(t,e,r=t){const i=t[0]+N2(t)/2,n=t[1]+F2(t)/2,s=t[2]+Ow(t)/2;return r[0]=i+(t[0]-i)*e,r[1]=n+(t[1]-n)*e,r[2]=s+(t[2]-s)*e,r[3]=i+(t[3]-i)*e,r[4]=n+(t[4]-n)*e,r[5]=s+(t[5]-s)*e,r}function yCe(t,e,r=t){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r!==t&&(r[3]=t[3],r[4]=t[4],r[5]=t[5]),r}function _Ce(t,e,r=t){return r[3]=e[0],r[4]=e[1],r[5]=e[2],r!==t&&(r[0]=t[0],r[1]=t[1],r[2]=t[2]),t}function B9(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function ki(t){return t?B9(t,Jhe):Ks(Jhe)}function Pne(t,e){return e||(e=Kt()),e[0]=t[0],e[1]=t[1],e[2]=t[3],e[3]=t[4],e}function zzt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=Number.NEGATIVE_INFINITY,t[3]=e[2],t[4]=e[3],t[5]=Number.POSITIVE_INFINITY,t}function gWe(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=Number.NEGATIVE_INFINITY,t[3]=i,t[4]=n,t[5]=Number.POSITIVE_INFINITY,t}function pZ(t){return t.length===6}function Ine(t){return N2(t)===0&&F2(t)===0&&Ow(t)===0}function Vzt(t,e,r){if(R(t)||R(e))return t===e;if(!pZ(t)||!pZ(e))return!1;if(r){for(let i=0;i<t.length;i++)if(!r(t[i],e[i]))return!1}else for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function yWe(t,e,r,i,n,s){return r2(t,e,r,i,n,s,_We)}const Bzt=[-1/0,-1/0,-1/0,1/0,1/0,1/0],Jhe=[1/0,1/0,1/0,-1/0,-1/0,-1/0],vCe=[0,0,0,0,0,0],_We=Ks();function Vj(t,{isPrimitive:e,width:r,depth:i,height:n}){const s=e?10:1;if(r==null&&n==null&&i==null)return[s*t[0],s*t[1],s*t[2]];const o=ke(r,i,n);let a;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/t[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=t[l]*a);return o}const vWe=r2(-.5,-.5,-.5,.5,.5,.5),bWe=r2(-.5,-.5,0,.5,.5,1),wWe=r2(-.5,-.5,0,.5,.5,.5);function xWe(t){switch(t){case"sphere":case"cube":case"diamond":return vWe;case"cylinder":case"cone":case"inverted-cone":return bWe;case"tetrahedron":return wWe;default:return}}const $ne=["butt","square","round"],TWe=[...$ne,"none"],bCe=["miter","bevel","round"];var fZ;let jx=fZ=class extends fe{constructor(t){super(t),this.color=new Xe([0,0,0,1]),this.size=Cp(1),this.pattern=null,this.patternCap="butt"}clone(){const t={color:v(this.color)?this.color.clone():null,size:this.size,pattern:v(this.pattern)?this.pattern.clone():null,patternCap:this.patternCap};return new fZ(t)}};u([d(D_)],jx.prototype,"color",void 0),u([d(oy)],jx.prototype,"size",void 0),u([d(dCe)],jx.prototype,"pattern",void 0),u([d({type:$ne,json:{default:"butt",write:{overridePolicy(){return{enabled:v(this.pattern)}}}}})],jx.prototype,"patternCap",void 0),jx=fZ=u([$("esri.symbols.support.Symbol3DOutline")],jx);var v6;let Ky=v6=class extends yy{constructor(t){super(t),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const t={edges:v(this.edges)?this.edges.clone():null,enabled:this.enabled,material:v(this.material)?this.material.clone():null,pattern:v(this.pattern)?this.pattern.clone():null,castShadows:this.castShadows,outline:v(this.outline)?this.outline.clone():null};return new v6(t)}static fromSimpleFillSymbol(t){var i,n,s;const e=t.outline&&t.outline.style&&t.outline.style!=="inside-frame"&&t.outline.style!=="solid"?new Cne({style:t.outline.style}):null,r={size:((i=t.outline)==null?void 0:i.width)??0,color:(((n=t.outline)==null?void 0:n.color)??v$).clone(),pattern:e};return e&&((s=t.outline)!=null&&s.cap)&&(r.patternCap=t.outline.cap),new v6({material:new b$({color:(t.color??aWe).clone()}),pattern:t.style&&t.style!=="solid"?new hCe({style:t.style}):null,outline:r})}};u([st({Fill:"fill"},{readOnly:!0})],Ky.prototype,"type",void 0),u([d({type:b$,json:{write:!0}})],Ky.prototype,"material",void 0),u([d(oWe)],Ky.prototype,"pattern",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Ky.prototype,"castShadows",void 0),u([d({type:jx,json:{write:!0}})],Ky.prototype,"outline",void 0),u([d(sCe)],Ky.prototype,"edges",void 0),Ky=v6=u([$("esri.symbols.FillSymbol3DLayer")],Ky);const _N=Ky,SWe=["none","underline","line-through"],EWe=["normal","italic","oblique"],CWe=["normal","lighter","bold","bolder"],wCe={type:Number,cast:t=>{const e=Jd(t);return e===0?1:_e(e,.1,4)},nonNullable:!0},AWe=["left","right","center"],RWe=["baseline","top","middle","bottom"],xCe={type:AWe,nonNullable:!0},TCe={type:RWe,nonNullable:!0};var mZ;let Qy=mZ=class extends fe{constructor(t){super(t),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(t){return yi(t)}clone(){return new mZ({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};u([d({type:SWe,json:{default:"none",write:!0}})],Qy.prototype,"decoration",void 0),u([d({type:String,json:{write:!0}})],Qy.prototype,"family",void 0),u([d({type:Number,json:{write:{overridePolicy:(t,e,r)=>({enabled:!r||!r.textSymbol3D})}}})],Qy.prototype,"size",void 0),u([cr("size")],Qy.prototype,"castSize",null),u([d({type:EWe,json:{default:"normal",write:!0}})],Qy.prototype,"style",void 0),u([d({type:CWe,json:{default:"normal",write:!0}})],Qy.prototype,"weight",void 0),Qy=mZ=u([$("esri.symbols.Font")],Qy);const j9=Qy,OWe=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,MWe={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function rz(t){const e=t==null?void 0:t.match(OWe);if(!e)return null;const[,r,i,n]=e;if(!r)return null;let s=null,o=null,a=null;const{devext:l,qaext:c,www:h}=MWe;if(i)if(s=r,n)switch(n.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qa":({customBaseUrl:o,portalHostname:a}=c);break;default:return null}else({customBaseUrl:o,portalHostname:a}=h);else switch(r.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qaext":({customBaseUrl:o,portalHostname:a}=c);break;case"www":({customBaseUrl:o,portalHostname:a}=h);break;default:return null}return{customBaseUrl:o,isPortal:!1,portalHostname:a,urlKey:s}}function PWe(t){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(t)}const IWe=re.getLogger("esri.core.urlUtils"),p3=ri.request,Khe="esri/config: esriConfig.request.proxyUrl is not set.",SCe=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,ECe=/^\s*http:/i,$We=/^\s*https:/i,LWe=/^\s*file:/i,DWe=/:\d+$/,NWe=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,FWe=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),kWe=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");let Lb=class{constructor(e=""){this.uri=e,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let r=this.uri.match(FWe);this.scheme=r[2]||(r[1]?"":null),this.authority=r[4]||(r[3]?"":null),this.path=r[5],this.query=r[7]||(r[6]?"":null),this.fragment=r[9]||(r[8]?"":null),this.authority!=null&&(r=this.authority.match(kWe),this.user=r[3]||null,this.password=r[4]||null,this.host=r[6]||r[7],this.port=r[9]||null)}toString(){return this.uri}};const NF={},UWe=new Lb(ri.applicationUrl);let Vl=UWe;const zWe=VWe();let Lne=zWe;const Dne=()=>Vl,Gzt=()=>Lne;function VWe(){const t=Vl.path,e=t.substring(0,t.lastIndexOf(t.split("/")[t.split("/").length-1]));return`${`${Vl.scheme}://${Vl.host}${Vl.port!=null?`:${Vl.port}`:""}`}${e}`}function Uo(t){if(!t)return null;const e={path:null,query:null},r=new Lb(t),i=t.indexOf("?");return r.query===null?e.path=t:(e.path=t.substring(0,i),e.query=CCe(r.query)),r.fragment&&(e.hash=r.fragment,r.query===null&&(e.path=e.path.substring(0,e.path.length-(r.fragment.length+1)))),e}function CCe(t){const e=t.split("&"),r={};for(const i of e){if(!i)continue;const n=i.indexOf("=");let s,o;n<0?(s=decodeURIComponent(i),o=""):(s=decodeURIComponent(i.slice(0,n)),o=decodeURIComponent(i.slice(n+1)));let a=r[s];typeof a=="string"&&(a=r[s]=[a]),Array.isArray(a)?a.push(o):r[s]=o}return r}function Qhe(t){return t&&typeof t=="object"&&"toJSON"in t&&typeof t.toJSON=="function"}function qL(t,e){return t?e&&typeof e=="function"?Object.keys(t).map(r=>encodeURIComponent(r)+"="+encodeURIComponent(e(r,t[r]))).join("&"):Object.keys(t).map(r=>{const i=t[r];if(i==null)return"";const n=encodeURIComponent(r)+"=",s=e&&e[r];return s?n+encodeURIComponent(s(i)):Array.isArray(i)?i.map(o=>Qhe(o)?n+encodeURIComponent(JSON.stringify(o)):n+encodeURIComponent(o)).join("&"):Qhe(i)?n+encodeURIComponent(JSON.stringify(i)):n+encodeURIComponent(i)}).filter(r=>r).join("&"):""}function BWe(t=!1){let e,r=p3.proxyUrl;if(typeof t=="string"){e=JWe(t);const i=G9(t);i&&(r=i.proxyUrl)}else e=!!t;if(!r)throw IWe.warn(Khe),new H("urlutils:proxy-not-set",Khe);return e&&gZ()&&(r=Vne(r)),Uo(r)}function Hzt(t){const e=G9(t);let r,i;if(e){const n=Nne(e.proxyUrl);r=n.path,i=n.query?CCe(n.query):null}if(r){const n=Uo(t);t=r+"?"+n.path;const s=qL({...i,...n.query});s&&(t=`${t}?${s}`)}return t}const lM={path:"",query:""};function Nne(t){const e=t.indexOf("?");return e!==-1?(lM.path=t.slice(0,e),lM.query=t.slice(e+1)):(lM.path=t,lM.query=null),lM}function ACe(t){return t=(t=iz(t=iXe(t=Nne(t).path),!0)).toLowerCase()}function jWe(t){const e={proxyUrl:t.proxyUrl,urlPrefix:ACe(t.urlPrefix)},r=p3.proxyRules,i=e.urlPrefix;let n=r.length;for(let s=0;s<r.length;s++){const o=r[s].urlPrefix;if(i.indexOf(o)===0){if(i.length===o.length)return-1;n=s;break}o.indexOf(i)===0&&(n=s+1)}return r.splice(n,0,e),n}function G9(t){const e=p3.proxyRules,r=ACe(t);for(let i=0;i<e.length;i++)if(r.indexOf(e[i].urlPrefix)===0)return e[i]}function GWe(t,e){if(!t||!e)return!1;t=yO(t),e=yO(e);const r=rz(t),i=rz(e);return v(r)&&v(i)?r.portalHostname===i.portalHostname:!v(r)&&!v(i)&&_O(t,e,!0)}function HWe(t,e){if(!t||!e)return!1;t=yO(t),e=yO(e);const r=rz(t),i=rz(e);return!(!v(r)||!v(i))&&r.portalHostname===i.portalHostname}function RCe(t,e){return t=yO(t),e=yO(e),iz(t)===iz(e)}function yO(t){const e=(t=em(t)).indexOf("/sharing");return e>0?t.substring(0,e):t.replace(/\/+$/,"")}function OCe(t){const e=i=>i==null||i instanceof RegExp&&i.test(t)||typeof i=="string"&&t.startsWith(i),r=p3.interceptors;if(r){for(const i of r)if(Array.isArray(i.urls)){if(i.urls.some(e))return i}else if(e(i.urls))return i}return null}function _O(t,e,r=!1){if(!t||!e)return!1;const i=_Z(t),n=_Z(e);return!(!r&&i.scheme!==n.scheme)&&i.host!=null&&n.host!=null&&i.host.toLowerCase()===n.host.toLowerCase()&&i.port===n.port}function Fne(t){if(typeof t=="string"){if(!Bu(t))return!0;t=_Z(t)}if(_O(t,Vl))return!0;const e=p3.trustedServers||[];for(let r=0;r<e.length;r++){const i=qWe(e[r]);for(let n=0;n<i.length;n++)if(_O(t,i[n]))return!0}return!1}function qWe(t){return NF[t]||(zne(t)||ly(t)?NF[t]=[new Lb(Fc(t))]:NF[t]=[new Lb(`http://${t}`),new Lb(`https://${t}`)]),NF[t]}function Fc(t,e=Lne,r){return ly(t)?r&&r.preserveProtocolRelative?t:Vl.scheme==="http"&&Vl.authority===tm(t).slice(2)?`http:${t}`:`https:${t}`:zne(t)?t:Yb(t[0]==="/"?tXe(e):e,t)}function kne(t,e=Lne,r){if(t==null||!Bu(t))return t;const i=em(t),n=i.toLowerCase(),s=em(e).toLowerCase().replace(/\/+$/,""),o=r?em(r).toLowerCase().replace(/\/+$/,""):null;if(o&&s.indexOf(o)!==0)return t;const a=(p,f,m)=>(m=p.indexOf(f,m))===-1?p.length:m;let l=a(n,"/",n.indexOf("//")+2),c=-1;for(;n.slice(0,l+1)===s.slice(0,l)+"/"&&(c=l+1,l!==n.length);)l=a(n,"/",l+1);if(c===-1||o&&c<o.length)return t;t=i.slice(c);const h=s.slice(c-1).replace(/[^/]+/g,"").length;if(h>0)for(let p=0;p<h;p++)t=`../${t}`;else t=`./${t}`;return t}function em(t){return t=oXe(t=sXe(t=nXe(t=Fc(t=t.trim()))))}function Yb(...t){const e=t.filter(v);if(!e||!e.length)return;const r=[];if(Bu(e[0])){const n=e[0],s=n.indexOf("//");s!==-1&&(r.push(n.slice(0,s+1)),QWe(e[0])&&(r[0]+="/"),e[0]=n.slice(s+2))}else e[0][0]==="/"&&r.push("");const i=e.reduce((n,s)=>s?n.concat(s.split("/")):n,[]);for(let n=0;n<i.length;n++){const s=i[n];s===".."&&r.length>0&&r[r.length-1]!==".."?r.pop():(!s&&n===i.length-1||s&&(s!=="."||r.length===0))&&r.push(s)}return r.join("/")}function tm(t,e=!1){if(t==null||Zb(t)||cd(t))return null;let r=t.indexOf("://");if(r===-1&&ly(t))r=2;else{if(r===-1)return null;r+=3}const i=t.indexOf("/",r);return i!==-1&&(t=t.slice(0,i)),e&&(t=iz(t,!0)),t}function Bu(t){return ly(t)||zne(t)}function Zb(t){return t!=null&&t.slice(0,5)==="blob:"}function cd(t){return t!=null&&t.slice(0,5)==="data:"}function Une(t){const e=f3(t);if(!e||!e.isBase64)return null;const r=atob(e.data),i=new Uint8Array(r.length);for(let n=0;n<r.length;n++)i[n]=r.charCodeAt(n);return i.buffer}function qzt(t){return btoa(String.fromCharCode.apply(null,t)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}const WWe=/^data:(.*?)(;base64)?,(.*)$/;function f3(t){const e=t.match(WWe);if(!e)return null;const[,r,i,n]=e;return{mediaType:r,isBase64:!!i,data:n}}function MCe(t){return t.isBase64?`data:${t.mediaType};base64,${t.data}`:`data:${t.mediaType},${t.data}`}function XWe(t){const e=Une(t);if(!e)return null;const r=f3(t);return new Blob([e],{type:r.mediaType})}function Wzt(t,e){YWe(t,e)||ZWe(t,e)}function YWe(t,e){if(!t)return!1;const r=document.createElement("a");if(!("download"in r))return!1;const i=URL.createObjectURL(t);return r.download=e,r.href=i,r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i),!0}function ZWe(t,e){return!!window.navigator.msSaveOrOpenBlob&&window.navigator.msSaveOrOpenBlob(t,e)}function ly(t){return t!=null&&t[0]==="/"&&t[1]==="/"}function zne(t){return t!=null&&SCe.test(t)}function JWe(t){return t!=null&&$We.test(t)||Vl.scheme==="https"&&ly(t)}function KWe(t){return t!=null&&ECe.test(t)||Vl.scheme==="http"&&ly(t)}function QWe(t){return t!=null&&LWe.test(t)}function Vne(t){return ly(t)?`https:${t}`:t.replace(ECe,"https:")}function eXe(){return Vl.scheme==="http"}function gZ(){return Vl.scheme==="https"}function iz(t,e=!1){return ly(t)?t.slice(2):(t=t.replace(SCe,""),e&&t.length>1&&t[0]==="/"&&t[1]==="/"&&(t=t.slice(2)),t)}function tXe(t){const e=t.indexOf("//"),r=t.indexOf("/",e+2);return r===-1?t:t.slice(0,r)}function rXe(t){let e=0;if(Bu(t)){const i=t.indexOf("//");i!==-1&&(e=i+2)}const r=t.lastIndexOf("/");return r<e?t:t.slice(0,r+1)}function Xzt(t,e){if(!t)return"";const r=Uo(t).path.replace(/\/+$/,""),i=r.substring(r.lastIndexOf("/")+1);if(!(e!=null&&e.length))return i;const n=new RegExp(`.(${e.join("|")})$`,"ig");return i.replace(n,"")}function iXe(t){return t&&t[t.length-1]==="/"?t:`${t}/`}function PCe(t){return t.replace(/\/+$/,"")}function nXe(t){if(/^https?:\/\//i.test(t)){const e=Nne(t);t=(t=e.path.replace(/\/{2,}/g,"/")).replace("/","//"),e.query&&(t+=`?${e.query}`)}return t}function sXe(t){return t.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function oXe(t){const e=p3.httpsDomains;if(!KWe(t))return t;const r=t.indexOf("/",7);let i;if(i=r===-1?t:t.slice(0,r),i=i.toLowerCase().slice(7),DWe.test(i)){if(!i.endsWith(":80"))return t;i=i.slice(0,-3),t=t.replace(":80","")}return eXe()&&i===Vl.authority&&!NWe.test(t)||(gZ()&&i===Vl.authority||e&&e.some(n=>i===n||i.endsWith(`.${n}`))||gZ()&&!G9(t))&&(t=Vne(t)),t}function yZ(t,e,r){if(!(e&&r&&t&&Bu(t)))return t;const i=t.indexOf("//"),n=t.indexOf("/",i+2),s=t.indexOf(":",i+2),o=Math.min(n<0?t.length:n,s<0?t.length:s);return t.slice(i+2,o).toLowerCase()!==e.toLowerCase()?t:`${t.slice(0,i+2)}${r}${t.slice(o)}`}function _Z(t){return typeof t=="string"?new Lb(Fc(t)):(t.scheme||(t.scheme=Vl.scheme),t)}function ICe(t){return lXe.test(t)}function $Ce(t,e){const r=Uo(t),i=Object.keys(r.query||{});return i.length>0&&e&&e.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${i.join(", ")}.`),r.path}function Bne(t,e,r){const i=Uo(t),n=i.query||{};return n[e]=String(r),`${i.path}?${qL(n)}`}function Bj(t,e){const r=Uo(t),i=r.query||{};for(const s in e)i[s]=e[s];const n=qL(i);return n?`${r.path}?${n}`:r.path}function aXe(t){if(R(t))return null;const e=t.match(LCe);return e?e[2]:null}function ede(t){if(R(t))return null;const e=t.match(LCe);return e?{path:e[1],extension:e[2]}:{path:t,extension:null}}const LCe=/([^.]*)\.([^\/]*)$/,lXe=/(^data:image\/svg|\.svg$)/i;function k2(t,e){const r=e&&e.url&&e.url.path;if(t&&r&&(t=Fc(t,r,{preserveProtocolRelative:!0}),e.portalItem&&e.readResourcePaths)){const i=kne(t,e.portalItem.itemUrl);i!=null&&cXe.test(i)&&e.readResourcePaths.push(e.portalItem.resourceFromPath(i).path)}return vZ(t,e&&e.portal)}function x_(t,e,r=vO.YES){if(t==null)return t;!Bu(t)&&e&&e.blockedRelativeUrls&&e.blockedRelativeUrls.push(t);let i=Fc(t);if(e){const n=e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.rootPath||e.url&&e.url.path;if(n){const s=vZ(n,e.portal),o=vZ(i,e.portal);i=kne(o,s,s),i!=null&&i!==o&&i!==t&&e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.writtenUrls.push(i)}}return i=FCe(i,e==null?void 0:e.portal),Bu(i)&&(i=em(i)),e!=null&&e.resources&&(e!=null&&e.portalItem)&&!Bu(i)&&!cd(i)&&r===vO.YES&&e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(i),compress:!1}),i}function jne(t,e,r){return k2(t,r)}function Jb(t,e,r,i){const n=x_(t,i);n!==void 0&&(e[r]=n)}const DCe=/\/items\/([^\/]+)\/resources\/(.*)/,cXe=/^\.\/resources\//;function NCe(t){var e;return((e=(t==null?void 0:t.match(DCe))??null)==null?void 0:e[1])??null}function uXe(t){const e=(t==null?void 0:t.match(DCe))??null;if(e==null)return null;const r=e[2],i=r.lastIndexOf("/");if(i===-1){const{path:o,extension:a}=ede(r);return{prefix:null,filename:o,extension:a}}const{path:n,extension:s}=ede(r.slice(i+1));return{prefix:r.slice(0,i),filename:n,extension:s}}function FCe(t,e){return e&&!e.isPortal&&e.urlKey&&e.customBaseUrl?yZ(t,`${e.urlKey}.${e.customBaseUrl}`,e.portalHostname):t}function vZ(t,e){if(!e||e.isPortal||!e.urlKey||!e.customBaseUrl)return t;const r=`${e.urlKey}.${e.customBaseUrl}`,i=Dne();return _O(i,`${i.scheme}://${r}`)?yZ(t,e.portalHostname,r):yZ(t,r,e.portalHostname)}var vO;(function(t){t[t.YES=0]="YES",t[t.NO=1]="NO"})(vO||(vO={}));const Yzt=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return vO},ensureMainOnlineDomain:FCe,fromJSON:k2,itemIdFromResourceUrl:NCe,prefixAndFilenameFromResourceUrl:uXe,read:jne,toJSON:x_,write:Jb},Symbol.toStringTag,{value:"Module"}));var bZ;const hXe=ja()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let Gx=bZ=class extends fe{constructor(t){super(t)}readHref(t,e,r){return t?k2(t,r):e.dataURI}writeHref(t,e,r,i){t&&(cd(t)?e.dataURI=t:(e.href=x_(t,i),Bu(e.href)&&(e.href=em(e.href))))}clone(){return new bZ({href:this.href,primitive:this.primitive})}};u([d({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],Gx.prototype,"href",void 0),u([Me("href")],Gx.prototype,"readHref",null),u([De("href",{href:{type:String},dataURI:{type:String}})],Gx.prototype,"writeHref",null),u([st(hXe)],Gx.prototype,"primitive",void 0),Gx=bZ=u([$("esri.symbols.support.IconSymbol3DLayerResource")],Gx);const dXe="circle";var wZ;let qA=wZ=class extends be{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new wZ({x:this.x,y:this.y})}};u([d({type:Number})],qA.prototype,"x",void 0),u([d({type:Number})],qA.prototype,"y",void 0),qA=wZ=u([$("esri.symbols.support.Symbol3DAnchorPosition2D")],qA);var xZ;let IP=xZ=class extends fe{constructor(t){super(t),this.color=new Xe([0,0,0,1]),this.size=Cp(1)}clone(){const t={color:v(this.color)?this.color.clone():null,size:this.size};return new xZ(t)}};u([d(D_)],IP.prototype,"color",void 0),u([d(oy)],IP.prototype,"size",void 0),IP=xZ=u([$("esri.symbols.support.Symbol3DIconOutline")],IP);var bC;const kCe="esri.symbols.IconSymbol3DLayer";let Zm=bC=class extends yy{constructor(t){super(t),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null}clone(){return new bC({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:v(this.material)?this.material.clone():null,outline:v(this.outline)?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})}static fromSimpleMarkerSymbol(t){const e=t.color||v$,r=tde(t),i=t.outline&&t.outline.width>0?{size:t.outline.width,color:(t.outline.color||v$).clone()}:null;return new bC({size:t.size,resource:{primitive:fXe(t.style)},material:{color:e},outline:i,anchor:r?"relative":void 0,anchorPosition:r})}static fromPictureMarkerSymbol(t){const e=!t.color||lWe(t.color)?v$:t.color,r=tde(t);return new bC({size:t.width<=t.height?t.height:t.width,resource:{href:t.url},material:{color:e.clone()},anchor:r?"relative":void 0,anchorPosition:r})}static fromCIMSymbol(t){return new bC({resource:{href:MCe({mediaType:"application/json",data:JSON.stringify(t.data)})}})}};function tde(t){const e="width"in t?t.width:t.size,r="height"in t?t.height:t.size,i=rde(t.xoffset),n=rde(t.yoffset);return(i||n)&&e&&r?{x:-i/e,y:n/r}:null}function rde(t){return isFinite(t)?t:0}u([d({type:Zh,json:{write:!0}})],Zm.prototype,"material",void 0),u([d({type:Gx,json:{write:!0}})],Zm.prototype,"resource",void 0),u([st({Icon:"icon"},{readOnly:!0})],Zm.prototype,"type",void 0),u([d(oy)],Zm.prototype,"size",void 0),u([st({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),d({json:{default:"center"}})],Zm.prototype,"anchor",void 0),u([d({type:qA,json:{type:[Number],read:{reader:t=>new qA({x:t[0],y:t[1]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Zm.prototype,"anchorPosition",void 0),u([d({type:IP,json:{write:!0}})],Zm.prototype,"outline",void 0),Zm=bC=u([$(kCe)],Zm);const pXe={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function fXe(t){return pXe[t]||(re.getLogger(kCe).warn(`${t} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const ab=Zm;function Kb(t,e,r=ct){return e||(e=new r),e===t||(e.removeAll(),mXe(t)?e.addMany(t):t&&e.add(t)),e}function UCe(t){return t}function mXe(t){return t&&(Array.isArray(t)||"items"in t&&Array.isArray(t.items))}const zCe="20230228",VCe="82c504e7a258618693fa8f46717811c9d421bd0d",Gne="4.26",gXe={async request(t,e){var a,l;const{default:r}=await Q(()=>Promise.resolve().then(()=>IXe),void 0),i=t.options,n=i.responseType;i.signal=e==null?void 0:e.signal,i.responseType=n==="native"||n==="native-request-init"?"native-request-init":n&&["blob","json","text"].includes(n)&&((a=OCe(t.url))!=null&&a.after)?n:"array-buffer";const s=await r(t.url,i),o={data:s.data,httpStatus:s.httpStatus,ssl:s.ssl};switch((l=s.requestOptions)==null?void 0:l.responseType){case"native-request-init":return delete o.data.signal,o;case"blob":o.data=await o.data.arrayBuffer();break;case"json":o.data=new TextEncoder().encode(JSON.stringify(o.data)).buffer;break;case"text":o.data=new TextEncoder().encode(o.data).buffer}return{result:o,transferList:[o.data]}}};let Oi;function Zzt(t){Oi=t}function Jzt(t){const e=Oi&&Oi.findCredential(t);return e&&e.token?Bne(t,"token",e.token):t}ue("host-webworker");const yXe=["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"];function BCe(t){const e=tm(t,!0);return!!e&&e.endsWith(".arcgis.com")&&!yXe.includes(e)&&!t.endsWith("/sharing/rest/generateToken")}function jCe(t,e,r=!1,i){return new Promise((n,s)=>{if(uo(i))return void s(ide());let o=()=>{c(),s(new Error(`Unable to load ${e}`))},a=()=>{const h=t;c(),n(h)},l=()=>{if(!t)return;const h=t;c(),h.src="",s(ide())};const c=()=>{ue("esri-image-decode")||(t.removeEventListener("error",o),t.removeEventListener("load",a)),o=null,a=null,t=null,v(i)&&i.removeEventListener("abort",l),l=null,r&&URL.revokeObjectURL(e)};v(i)&&i.addEventListener("abort",l),ue("esri-image-decode")?t.decode().then(a,o):(t.addEventListener("error",o),t.addEventListener("load",a))})}function ide(){try{return new DOMException("Aborted","AbortError")}catch{const t=new Error;return t.name="AbortError",t}}function _Xe(t){ri.request.crossOriginNoCorsDomains||(ri.request.crossOriginNoCorsDomains={});const e=ri.request.crossOriginNoCorsDomains;for(let r of t)r=r.toLowerCase(),/^https?:\/\//.test(r)?e[tm(r)??""]=0:(e[tm("http://"+r)??""]=0,e[tm("https://"+r)??""]=0)}function vXe(t){const e=ri.request.crossOriginNoCorsDomains;if(e){let r=tm(t);if(r)return r=r.toLowerCase(),!_O(r,Dne())&&e[r]<Date.now()-36e5}return!1}async function bXe(t){var n;const e=ri.request.crossOriginNoCorsDomains,r=tm(t);e&&r&&(e[r.toLowerCase()]=Date.now());const i=Uo(t);t=i.path,((n=i.query)==null?void 0:n.f)==="json"&&(t+="?f=json");try{await fetch(t,{mode:"no-cors",credentials:"include"})}catch{}}async function ei(t,e){var c;const r=cd(t),i=Zb(t);i||r||(t=em(t));const n={url:t,requestOptions:{...e}};let s=OCe(t);if(s){const h=await RXe(s,n);if(h!=null)return{data:h,getHeader:Hne,httpStatus:200,requestOptions:n.requestOptions,url:n.url};s.after||s.error||(s=null)}if(t=n.url,(e=n.requestOptions).responseType==="image"){if(ue("host-webworker")||ue("host-node"))throw Gf("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),n)}else if(r)throw Gf("request:invalid-parameters",new Error("Data URLs are not supported for responseType = "+e.responseType),n);if(e.method==="head"){if(e.body)throw Gf("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),n);if(r||i)throw Gf("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),n)}if(await EXe(),nz)return nz.execute(t,e);const o=new AbortController;Ua(e,()=>o.abort());const a={controller:o,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:s,params:n,redoRequest:!1,useIdentity:Pf.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},l=await MXe(a);return(c=s==null?void 0:s.after)==null||c.call(s,l),l}let nz;const Pf=ri.request,GCe="FormData"in globalThis,wXe=[499,498,403,401],xXe=["COM_0056","COM_0057","SB_0008"],TXe=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],Hne=()=>null,sz=Symbol();function SXe(t){const e=tm(t);e&&!ei._corsServers.includes(e)&&ei._corsServers.push(e)}function nde(t){const e=tm(t);return!e||e.endsWith(".arcgis.com")||ei._corsServers.includes(e)||Fne(e)}function Gf(t,e,r,i){let n="Error";const s={url:r.url,requestOptions:r.requestOptions,getHeader:Hne,ssl:!1};if(e instanceof H)return e.details?(e.details=se(e.details),e.details.url=r.url,e.details.requestOptions=r.requestOptions):e.details=s,e;if(e){const o=i&&(c=>i.headers.get(c)),a=i&&i.status,l=e.message;l&&(n=l),o&&(s.getHeader=o),s.httpStatus=(e.httpCode!=null?e.httpCode:e.code)||a||0,s.subCode=e.subcode,s.messageCode=e.messageCode,typeof e.details=="string"?s.messages=[e.details]:s.messages=e.details,s.raw=sz in e?e[sz]:e}return ps(e)?Vr():new H(t,n,s)}async function EXe(){ue("host-webworker")?nz||(nz=await Q(()=>import("./request-fd97cee4.js"),[])):ei._abortableFetch||(ei._abortableFetch=globalThis.fetch.bind(globalThis))}async function TZ(){Oi||await Q(()=>import("./IdentityManager-308fc474.js"),[])}async function CXe(t){var a;const e=t.params.url,r=t.params.requestOptions,i=t.controller.signal,n=r.body;let s=null,o=null;if(GCe&&"HTMLFormElement"in globalThis&&(n instanceof FormData?s=n:n instanceof HTMLFormElement&&(s=new FormData(n))),typeof n=="string"&&(o=n),t.fetchOptions={cache:r.cacheBust&&!ei._abortableFetch.polyfill?"no-cache":"default",credentials:"same-origin",headers:r.headers||{},method:r.method==="head"?"HEAD":"GET",mode:"cors",priority:Pf.priority,redirect:"follow",signal:i},(s||o)&&(t.fetchOptions.body=s||o),r.authMode==="anonymous"&&(t.useIdentity=!1),t.hasToken=!!(/token=/i.test(e)||(a=r.query)!=null&&a.token||s!=null&&s.get("token")),!t.hasToken&&ri.apiKey&&BCe(e)&&(r.query||(r.query={}),r.query.token=ri.apiKey,t.hasToken=!0),t.useIdentity&&!t.hasToken&&!t.credentialToken&&!HCe(e)&&!uo(i)){let l;r.authMode==="immediate"?(await TZ(),l=await Oi.getCredential(e,{signal:i}),t.credential=l):r.authMode==="no-prompt"?(await TZ(),l=await Oi.getCredential(e,{prompt:!1,signal:i}).catch(()=>{}),t.credential=l):Oi&&(l=Oi.findCredential(e)),l&&(t.credentialToken=l.token,t.useSSL=!!l.ssl)}}function HCe(t){return TXe.some(e=>e.test(t))}async function AXe(t){let e=t.params.url;const r=t.params.requestOptions,i=t.fetchOptions??{},n=Zb(e)||cd(e),s=r.responseType||"json",o=n?0:r.timeout!=null?r.timeout:Pf.timeout;let a=!1;if(!n){t.useSSL&&(e=Vne(e)),r.cacheBust&&i.cache==="default"&&(e=Bne(e,"request.preventCache",Date.now()));let f={...r.query};t.credentialToken&&(f.token=t.credentialToken);let m=qL(f);ue("esri-url-encodes-apostrophe")&&(m=m.replace(/'/g,"%27"));const g=e.length+1+m.length;let _;a=r.method==="delete"||r.method==="post"||r.method==="put"||!!r.body||g>Pf.maxUrlLength;const b=r.useProxy||!!G9(e);if(b){const w=BWe(e);_=w.path,!a&&_.length+1+g>Pf.maxUrlLength&&(a=!0),w.query&&(f={...w.query,...f})}if(i.method==="HEAD"&&(a||b)){if(a)throw g>Pf.maxUrlLength?Gf("request:invalid-parameters",new Error("URL exceeds maximum length"),t.params):Gf("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),t.params);if(b)throw Gf("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),t.params)}if(a?(i.method=r.method==="delete"?"DELETE":r.method==="put"?"PUT":"POST",r.body?e=Bj(e,f):(i.body=qL(f),i.headers||(i.headers={}),i.headers["Content-Type"]="application/x-www-form-urlencoded")):e=Bj(e,f),b&&(t.useProxy=!0,e=`${_}?${e}`),f.token&&GCe&&i.body instanceof FormData&&!PWe(e)&&i.body.set("token",f.token),r.hasOwnProperty("withCredentials"))t.withCredentials=r.withCredentials;else if(!_O(e,Dne())){if(Fne(e))t.withCredentials=!0;else if(Oi){const w=Oi.findServerInfo(e);w&&w.webTierAuth&&(t.withCredentials=!0)}}t.withCredentials&&(i.credentials="include",vXe(e)&&await bXe(a?Bj(e,f):e))}let l,c,h=0,p=!1;o>0&&(h=setTimeout(()=>{p=!0,t.controller.abort()},o));try{if(r.responseType==="native-request-init")c=i,c.url=e;else if(r.responseType!=="image"||i.cache!=="default"||i.method!=="GET"||a||OXe(r.headers)||!n&&!t.useProxy&&Pf.proxyUrl&&!nde(e)){if(l=await ei._abortableFetch(e,i),t.useProxy||SXe(e),r.responseType==="native")c=l;else if(i.method!=="HEAD")if(l.ok){switch(s){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(h&&(clearTimeout(h),h=0),s==="json"||s==="xml"||s==="document")if(c)switch(s){case"json":c=JSON.parse(c);break;case"xml":c=sde(c,"application/xml");break;case"document":c=sde(c,"text/html")}else c=null;if(c){if(s==="array-buffer"||s==="blob"){const f=l.headers.get("Content-Type");if(f&&/application\/json|text\/plain/i.test(f)&&c[s==="blob"?"size":"byteLength"]<=750)try{const m=await new Response(c).json();m.error&&(c=m)}catch{}}s==="image"&&c instanceof Blob&&(c=await ode(URL.createObjectURL(c),t,!0))}}else c=await l.text()}else c=await ode(e,t)}catch(f){if(f.name==="AbortError")throw p?new Error("Timeout exceeded"):Vr("Request canceled");if(!(!l&&f instanceof TypeError&&Pf.proxyUrl)||r.body||r.method==="delete"||r.method==="head"||r.method==="post"||r.method==="put"||t.useProxy||nde(e))throw f;t.redoRequest=!0,jWe({proxyUrl:Pf.proxyUrl,urlPrefix:tm(e)??""})}finally{h&&clearTimeout(h)}return[l,c]}async function RXe(t,e){if(t.responseData!=null)return t.responseData;if(t.headers&&(e.requestOptions.headers={...e.requestOptions.headers,...t.headers}),t.query&&(e.requestOptions.query={...e.requestOptions.query,...t.query}),t.before){let r,i;try{i=await t.before(e)}catch(n){r=Gf("request:interceptor",n,e)}if((i instanceof Error||i instanceof H)&&(r=Gf("request:interceptor",i,e)),r)throw t.error&&t.error(r),r;return i}}function OXe(t){if(t){for(const e of Object.getOwnPropertyNames(t))if(t[e])return!0}return!1}function sde(t,e){let r;try{r=new DOMParser().parseFromString(t,e)}catch{}if(!r||r.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return r}async function MXe(t){var s;let e,r;await CXe(t);try{do[e,r]=await AXe(t);while(!await PXe(t,e,r))}catch(o){const a=Gf("request:server",o,t.params,e);throw a.details.ssl=t.useSSL,t.interceptor&&t.interceptor.error&&t.interceptor.error(a),a}const i=t.params.url;if(r&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(i)){if(!t.hasToken&&!t.credentialToken&&((s=r.user)!=null&&s.username)&&!Fne(i)){const o=tm(i,!0);o&&Pf.trustedServers.push(o)}Array.isArray(r.authorizedCrossOriginNoCorsDomains)&&_Xe(r.authorizedCrossOriginNoCorsDomains)}const n=t.credential;if(n&&Oi){const o=Oi.findServerInfo(n.server);let a=o&&o.owningSystemUrl;if(a){a=a.replace(/\/?$/,"/sharing");const l=Oi.findCredential(a,n.userId);l&&Oi._getIdenticalSvcIdx(a,l)===-1&&l.resources.unshift(a)}}return{data:r,getHeader:e?o=>e==null?void 0:e.headers.get(o):Hne,httpStatus:(e==null?void 0:e.status)??200,requestOptions:t.params.requestOptions,ssl:t.useSSL,url:t.params.url}}async function PXe(t,e,r){if(t.redoRequest)return t.redoRequest=!1,!1;const i=t.params.requestOptions;if(!e||i.responseType==="native"||i.responseType==="native-request-init")return!0;let n,s;if(!e.ok)throw n=new Error(`Unable to load ${e.url} status: ${e.status}`),n[sz]=r,n;r&&(r.error?n=r.error:r.status==="error"&&Array.isArray(r.messages)&&(n={...r},n[sz]=r,n.details=r.messages));let o,a=null;n&&(s=Number(n.code),a=n.hasOwnProperty("subcode")?Number(n.subcode):null,o=n.messageCode,o=o&&o.toUpperCase());const l=i.authMode;if(s===403&&(a===4||n.message&&n.message.toLowerCase().includes("ssl")&&!n.message.toLowerCase().includes("permission"))){if(!t.useSSL)return t.useSSL=!0,!1}else if(!t.hasToken&&t.useIdentity&&(l!=="no-prompt"||s===498)&&s!==void 0&&wXe.includes(s)&&!HCe(t.params.url)&&(s!==403||o&&!xXe.includes(o)&&(a==null||a===2&&t.credentialToken))){await TZ();try{const c=await Oi.getCredential(t.params.url,{error:Gf("request:server",n,t.params),prompt:l!=="no-prompt",signal:t.controller.signal,token:t.credentialToken});return t.credential=c,t.credentialToken=c.token,t.useSSL=t.useSSL||c.ssl,!1}catch(c){if(l==="no-prompt")return t.credential=void 0,t.credentialToken=void 0,!1;n=c}}if(n)throw n;return!0}function ode(t,e,r=!1){const i=e.controller.signal,n=new Image;return e.withCredentials?n.crossOrigin="use-credentials":n.crossOrigin="anonymous",n.alt="",n.fetchPriority=Pf.priority,n.src=t,jCe(n,t,r,i)}ei._abortableFetch=null,ei._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"];const IXe=Object.freeze(Object.defineProperty({__proto__:null,default:ei},Symbol.toStringTag,{value:"Module"}));var P1;(function(t){t[t.PENDING=0]="PENDING",t[t.RESOLVED=1]="RESOLVED",t[t.REJECTED=2]="REJECTED"})(P1||(P1={}));let $Xe=class{constructor(e){this.instance=e,this._resolver=__(),this._status=P1.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=P1.RESOLVED,this._cleanUp()},()=>{this._status=P1.REJECTED,this._cleanUp()})}addResolvingPromise(e){this._resolvingPromises.push(e),this._tryResolve()}isResolved(){return this._status===P1.RESOLVED}isRejected(){return this._status===P1.REJECTED}isFulfilled(){return this._status!==P1.PENDING}abort(){this._resolver.reject(Vr())}when(e,r){return this._resolver.promise.then(e,r)}_cleanUp(){this._allPromise=this._resolvingPromises=this._allPromise=null}_tryResolve(){if(this.isFulfilled())return;const e=__(),r=[...this._resolvingPromises,e.promise],i=this._allPromise=Promise.all(r);i.then(()=>{this.isFulfilled()||this._allPromise!==i||this._resolver.resolve(this.instance)},n=>{this.isFulfilled()||this._allPromise!==i||ps(n)||this._resolver.reject(n)}),e.resolve()}};const m3=t=>{let e=class extends t{constructor(...r){super(...r),this._promiseProps=new $Xe(this),this.addResolvingPromise(Promise.resolve())}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(r,i){return new Promise((n,s)=>{this._promiseProps.when(n,s)}).then(r,i)}catch(r){return this.when(null,r)}addResolvingPromise(r){r&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in r?r.when():r)}};return e=u([$("esri.core.Promise")],e),e};let oz=class extends m3(be){};oz=u([$("esri.core.Promise")],oz);const LXe="not-loaded",DXe="loading",NXe="failed",ade="loaded",qCe=t=>{let e=class extends t{constructor(...r){super(...r),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(i=>{const n=this.load.bind(this);this.load=s=>{const o=new Promise((a,l)=>{const c=E9(s,l);this.destroyed&&l(new H("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this._promiseProps.when(a,l).finally(()=>{c&&c.remove()})});if(this.loadStatus===LXe){this._set("loadStatus",DXe);const a=this._loadController=new AbortController;n({signal:a.signal}),Ua(a.signal,()=>{this._promiseProps.abort()})}return i(),o}})),this.when(()=>{this._set("loadStatus",ade),this._loadController=null},i=>{this._set("loadStatus",NXe),this._set("loadError",i),this._loadController=null})}get loaded(){return this.loadStatus===ade}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){var r;return this.isFulfilled()||(this._set("loadError",new H("load:cancelled","Cancelled")),(r=this._loadController)==null||r.abort()),this}};return u([d({readOnly:!0})],e.prototype,"loaded",null),u([d({readOnly:!0})],e.prototype,"loadError",void 0),u([d({clonable:!1})],e.prototype,"loadStatus",void 0),u([d({type:[Sp],readOnly:!0})],e.prototype,"loadWarnings",null),e=u([$("esri.core.Loadable")],e),e};let $P=class extends qCe(oz){};$P=u([$("esri.core.Loadable")],$P),function(t){function e(r){return!(!r||!r.load)}t.LoadableMixin=qCe,t.isLoadable=e}($P||($P={}));const qu=$P;var SZ;const FXe=new mr({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let Rd=SZ=class extends be{constructor(t){super(t),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(t){t!=="asc"&&t!=="desc"||this._set("sortOrder",t)}clone(){return new SZ({categories:this.categories?se(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(t,e){let r=[];this.categories&&(r=this.categories.map(o=>Array.isArray(o)?JSON.stringify(o):o));let i="";if(this.extent){const o=D2(this.extent,Je.WGS84);v(o)&&(i=`${o.xmin},${o.ymin},${o.xmax},${o.ymax}`)}let n=this.query;!this.disableExtraQuery&&t.extraQuery&&(n="("+n+")"+t.extraQuery);const s={categories:r,bbox:i,q:n,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(s.sortField=this.sortField.split(",").map(o=>FXe.toJSON(o.trim())).join(","),s.sortOrder=this.sortOrder),{query:{...e,...s}}}};u([d()],Rd.prototype,"categories",void 0),u([d()],Rd.prototype,"disableExtraQuery",void 0),u([d({type:ur})],Rd.prototype,"extent",void 0),u([d()],Rd.prototype,"filter",void 0),u([d()],Rd.prototype,"num",void 0),u([d()],Rd.prototype,"query",void 0),u([d()],Rd.prototype,"sortField",void 0),u([d()],Rd.prototype,"sortOrder",null),u([d()],Rd.prototype,"start",void 0),Rd=SZ=u([$("esri.portal.PortalQueryParams")],Rd);const N0=Rd;let Hx=class extends be{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};u([d()],Hx.prototype,"nextQueryParams",void 0),u([d()],Hx.prototype,"queryParams",void 0),u([d()],Hx.prototype,"results",void 0),u([d()],Hx.prototype,"total",void 0),Hx=u([$("esri.portal.PortalQueryResult")],Hx);const kXe=Hx;let e0=class extends fe{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new H("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};u([d({type:Date})],e0.prototype,"created",void 0),u([d()],e0.prototype,"id",void 0),u([d()],e0.prototype,"portal",void 0),u([d()],e0.prototype,"title",void 0),u([d({readOnly:!0})],e0.prototype,"url",null),u([d()],e0.prototype,"username",void 0),e0=u([$("esri.portal.PortalFolder")],e0);const UXe=e0;let Wo=class extends fe{constructor(e){super(e),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.tags=null,this.title=null}get thumbnailUrl(){var i;const e=this.url,r=this.thumbnail;return e&&r&&this.portal?(i=this.portal)==null?void 0:i.normalizeUrl(`${e}/info/${r}?f=json`):null}get url(){const e=this.get("portal.restUrl");return e?e+"/community/groups/"+this.id:null}fetchCategorySchema(e){return Ic(this.portal).request(this.url+"/categorySchema",e).then(r=>{const i=r.categorySchema||[];return i.some(n=>n.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",e):i})}fetchMembers(e){return Ic(this.portal).request(this.url+"/users",e)}getThumbnailUrl(e){let r=this.thumbnailUrl;return r&&e&&(r+=`&w=${e}`),r}toJSON(){throw new H("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}queryItems(e,r){let i=bs(N0,e);const n=Ic(this.portal);return parseFloat(n.currentVersion)>5?(i=i||new N0,n.queryPortal(`/content/groups/${this.id}/search`,i,"PortalItem",r)):(i=i?i.clone():new N0,i.query="group:"+this.id+(i.query?" "+i.query:""),n.queryItems(i,r))}_fetchCategorySchemaSet(e,r){const i=Ic(this.portal);return i.fetchSelf(i.authMode,!0,r).then(n=>{const s=n.contentCategorySetsGroupQuery;if(s){const o=new N0;return o.disableExtraQuery=!0,o.num=1,o.query=s,i.queryGroups(o,r)}throw new H("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(n=>{if(n.total){const s=n.results[0],o=new N0;return o.num=1,o.query=`typekeywords:"${e}"`,s.queryItems(o,r)}throw new H("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(n=>n.total?n.results[0].fetchData("json",r).then(s=>{const o=s&&s.categorySchema;return o&&o.length?o:[]}):[])}};u([d()],Wo.prototype,"access",void 0),u([d({type:Date})],Wo.prototype,"created",void 0),u([d()],Wo.prototype,"description",void 0),u([d()],Wo.prototype,"id",void 0),u([d()],Wo.prototype,"isInvitationOnly",void 0),u([d({type:Date})],Wo.prototype,"modified",void 0),u([d()],Wo.prototype,"owner",void 0),u([d()],Wo.prototype,"portal",void 0),u([d()],Wo.prototype,"snippet",void 0),u([d()],Wo.prototype,"sortField",void 0),u([d()],Wo.prototype,"sortOrder",void 0),u([d()],Wo.prototype,"tags",void 0),u([d()],Wo.prototype,"thumbnail",void 0),u([d({readOnly:!0})],Wo.prototype,"thumbnailUrl",null),u([d()],Wo.prototype,"title",void 0),u([d({readOnly:!0})],Wo.prototype,"url",null),Wo=u([$("esri.portal.PortalGroup")],Wo);const EZ=Wo,zXe=Object.freeze(Object.defineProperty({__proto__:null,default:EZ},Symbol.toStringTag,{value:"Module"}));var CZ;let Un=CZ=class extends fe{constructor(...t){super(...t),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const t=this.url,e=this.thumbnail;return t&&e?this.portal.normalizeUrl(`${t}/info/${e}?f=json`):null}get userContentUrl(){const t=this.get("portal.restUrl");return t?`${t}/content/users/${this.username}`:null}get url(){const t=this.get("portal.restUrl");return t?`${t}/community/users/${this.username}`:null}addItem(t){const e=t&&t.item,r=t&&t.data,i=t&&t.folder,n={method:"post"};e&&(n.query=e.createPostQuery(),r!=null&&(typeof r=="string"?n.query.text=r:typeof r=="object"&&(n.query.text=JSON.stringify(r))));let s=this.userContentUrl;return i&&(s+="/"+(typeof i=="string"?i:i.id)),this.portal.request(s+"/addItem",n).then(o=>(e.id=o.id,e.portal=this.portal,e.loaded?e.reload():e.load()))}deleteItem(t){let e=this.userContentUrl;return t.ownerFolder&&(e+="/"+t.ownerFolder),this.portal.request(e+`/items/${t.id}/delete`,{method:"post"}).then(()=>{t.id=null,t.portal=null})}deleteItems(t){const e=this.userContentUrl+"/deleteItems",r=t.map(i=>i.id);if(r.length){const i={method:"post",query:{items:r.join(",")}};return this.portal.request(e,i).then(()=>{t.forEach(n=>{n.id=null,n.portal=null})})}return Promise.resolve(void 0)}fetchFolders(){const t={query:{num:1}};return this.portal.request(this.userContentUrl??"",t).then(e=>{let r;return r=e&&e.folders?e.folders.map(i=>{const n=UXe.fromJSON(i);return n.portal=this.portal,n}):[],r})}fetchGroups(){return this.portal.request(this.url??"").then(t=>{let e;return e=t&&t.groups?t.groups.map(r=>{const i=EZ.fromJSON(r);return i.portal=this.portal,i}):[],e})}fetchItems(t){const e=t??{};let r,i=this.userContentUrl??"";return e.folder&&(i+="/"+e.folder.id),Q(()=>Promise.resolve().then(()=>PPe),void 0).then(({default:n})=>{r=n;const s={folders:!1,num:e.num||10,start:e.start||1,sortField:e.sortField||"created",sortOrder:e.sortOrder||"asc"};return this.portal.request(i,{query:s})}).then(n=>{let s;return n&&n.items?(s=n.items.map(o=>{const a=r.fromJSON(o);return a.portal=this.portal,a}),Promise.all(s.map(o=>o.load())).catch(o=>o).then(()=>({items:s,nextStart:n.nextStart,total:n.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal.request(this.url+"/tags").then(t=>t.tags)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}queryFavorites(t){return this.favGroupId?(this._favGroup||(this._favGroup=new EZ({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(t)):Promise.reject(new H("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new H("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new CZ;return e.sourceJSON=t,e.read(t),e}};u([d()],Un.prototype,"access",void 0),u([d({type:Date})],Un.prototype,"created",void 0),u([d()],Un.prototype,"culture",void 0),u([d()],Un.prototype,"description",void 0),u([d()],Un.prototype,"email",void 0),u([d()],Un.prototype,"favGroupId",void 0),u([d()],Un.prototype,"fullName",void 0),u([d({type:Date})],Un.prototype,"modified",void 0),u([d()],Un.prototype,"orgId",void 0),u([d()],Un.prototype,"portal",void 0),u([d()],Un.prototype,"preferredView",void 0),u([d()],Un.prototype,"privileges",void 0),u([d()],Un.prototype,"region",void 0),u([d()],Un.prototype,"role",void 0),u([d()],Un.prototype,"roleId",void 0),u([d()],Un.prototype,"sourceJSON",void 0),u([d()],Un.prototype,"thumbnail",void 0),u([d({readOnly:!0})],Un.prototype,"thumbnailUrl",null),u([d()],Un.prototype,"units",void 0),u([d({readOnly:!0})],Un.prototype,"userContentUrl",null),u([d({readOnly:!0})],Un.prototype,"url",null),u([d()],Un.prototype,"username",void 0),u([d()],Un.prototype,"userType",void 0),Un=CZ=u([$("esri.portal.PortalUser")],Un);const qne=Un,VXe=Object.freeze(Object.defineProperty({__proto__:null,default:qne},Symbol.toStringTag,{value:"Module"}));var fh;let jj;const lde={PortalGroup:()=>Q(()=>Promise.resolve().then(()=>zXe),void 0),PortalItem:()=>Q(()=>Promise.resolve().then(()=>PPe),void 0),PortalUser:()=>Q(()=>Promise.resolve().then(()=>VXe),void 0)};let We=fh=class extends Cw(qu){constructor(t){super(t),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=ri.portalUrl,this.urlKey=null,this.user=null,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(t){return typeof t=="string"?{url:t}:t}destroy(){this._esriIdCredentialCreateHandle=$i(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(t){if(t)for(const e of t)ri.request.trustedServers.includes(e)||ri.request.trustedServers.push(e);return t}readDefaultBasemap(t){return this._readBasemap(t)}readDefaultDevBasemap(t){return this._readBasemap(t)}readDefaultVectorBasemap(t){return this._readBasemap(t)}get extraQuery(){const t=!(this.user&&this.user.orgId)||this.canSearchPublic;return this.id&&!t?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let t=this.url;if(t){const e=t.indexOf("/sharing");t=e>0?t.substring(0,e):this.url.replace(/\/+$/,""),t+="/sharing/rest"}return t}get thumbnailUrl(){const t=this.restUrl,e=this.thumbnail;return t&&e?this._normalizeSSL(t+"/portals/self/resources/"+e):null}readUrlKey(t){return t&&t.toLowerCase()}readUser(t){let e=null;return t&&(e=qne.fromJSON(t),e.portal=this),e}load(t){const e=Q(()=>Promise.resolve().then(()=>cht),void 0).then(({default:r})=>{lr(t),jj=r}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,t)).then(r=>{if(Oi){const i=Oi;this.credential=i.findCredential(this.restUrl),this.credential||this.authMode!==fh.AUTH_MODE_AUTO||(this._esriIdCredentialCreateHandle=i.on("credential-create",()=>{i.findCredential(this.restUrl)&&this.signIn().catch(()=>{})}))}this.sourceJSON=r,this.read(r)});return this.addResolvingPromise(e),Promise.resolve(this)}async createElevationLayers(){await this.load();const t=this._getHelperService("defaultElevationLayers"),e=(await Q(()=>import("./ElevationLayer-518667f4.js"),["assets/ElevationLayer-518667f4.js","assets/ArcGISCachedService-fa5524d7.js","assets/TilemapCache-f1be1a2a.js"])).default;return t?t.map(r=>new e({id:r.id,url:r.url})):[]}fetchBasemaps(t,e){const r=new N0;return r.query=t||(ri.apiKey&&BCe(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),r.disableExtraQuery=!0,this.queryGroups(r,e).then(i=>{if(r.num=100,r.query='type:"Web Map" -type:"Web Application"',i.total){const n=i.results[0];return r.sortField=n.sortField||"name",r.sortOrder=n.sortOrder||"desc",n.queryItems(r,e)}return null}).then(i=>{let n;return n=i&&i.total?i.results.filter(s=>s.type==="Web Map").map(s=>new jj({portalItem:s})):[],n})}fetchCategorySchema(t){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",t).then(e=>e.categorySchema):uo(t)?Promise.reject(Vr()):Promise.resolve([])}fetchFeaturedGroups(t){const e=this.featuredGroups,r=new N0;if(r.num=100,r.sortField="title",e&&e.length){const i=[];for(const n of e)i.push(`(title:"${n.title}" AND owner:${n.owner})`);return r.query=i.join(" OR "),this.queryGroups(r,t).then(n=>n.results)}return uo(t)?Promise.reject(Vr()):Promise.resolve([])}fetchRegions(t){var r;const e=((r=this.user)==null?void 0:r.culture)||this.culture||mp();return this.request(this.restUrl+"/portals/regions",{...t,query:{culture:e}})}fetchSettings(t){var r;const e=((r=this.user)==null?void 0:r.culture)||this.culture||mp();return this.request(this.restUrl+"/portals/self/settings",{...t,query:{culture:e}})}static getDefault(){return fh._default&&!fh._default.destroyed||(fh._default=new fh),fh._default}queryGroups(t,e){return this.queryPortal("/community/groups",t,"PortalGroup",e)}queryItems(t,e){return this.queryPortal("/search",t,"PortalItem",e)}queryUsers(t,e){return t.sortField||(t.sortField="username"),this.queryPortal("/community/users",t,"PortalUser",e)}fetchSelf(t=this.authMode,e=!1,r){const i=this.restUrl+"/portals/self",n={authMode:t,query:{culture:mp().toLowerCase()},...r};return n.authMode==="auto"&&(n.authMode="no-prompt"),e&&(n.query.default=!0),this.request(i,n)}queryPortal(t,e,r,i){const n=bs(N0,e),s=o=>this.request(this.restUrl+t,{...n.toRequestOptions(this),...i}).then(a=>{const l=n.clone();return l.start=a.nextStart,new kXe({nextQueryParams:l,queryParams:n,total:a.total,results:fh._resultsToTypedArray(o,{portal:this},a,i)})}).then(a=>Promise.all(a.results.map(l=>typeof l.when=="function"?l.when():a)).then(()=>a,l=>(Mu(l),a)));return r&&lde[r]?lde[r]().then(({default:o})=>(lr(i),s(o))):s()}signIn(){if(this.authMode===fh.AUTH_MODE_ANONYMOUS)return Promise.reject(new H("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const t=e=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(e||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=e,this.fetchSelf("immediate"))):this.user&&this.credential===e?null:(this.credential=e,this.fetchSelf("immediate"))).then(r=>{r&&(this.sourceJSON=r,this.read(r))});return Oi?Oi.getCredential(this.restUrl).then(e=>t(e)):t(this.credential)}normalizeUrl(t){const e=this.credential&&this.credential.token;return this._normalizeSSL(e?t+(t.includes("?")?"&":"?")+"token="+e:t)}requestToTypedArray(t,e,r){return this.request(t,e).then(i=>{const n=fh._resultsToTypedArray(r,{portal:this},i);return Promise.all(n.map(s=>typeof s.when=="function"?s.when():i)).then(()=>n,()=>n)})}request(t,e={}){const r={f:"json",...e.query},{authMode:i=this.authMode===fh.AUTH_MODE_ANONYMOUS?"anonymous":"auto",body:n=null,cacheBust:s=!1,method:o="auto",responseType:a="json",signal:l}=e,c={authMode:i,body:n,cacheBust:s,method:o,query:r,responseType:a,timeout:0,signal:l};return ei(this._normalizeSSL(t),c).then(h=>h.data)}toJSON(){throw new H("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new fh({sourceJSON:t})}_getHelperService(t){const e=this.helperServices&&this.helperServices[t];if(!e)throw new H("portal:service-not-found",`The \`helperServices\` do not include an entry named "${t}"`);return e}_normalizeSSL(t){return t.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(t){if(t){const e=jj.fromJSON(t);return e.portalItem={portal:this},e}return null}static _resultsToTypedArray(t,e,r,i){let n=[];if(r){const s=v(i)?i.signal:null;n=r.listings||r.notifications||r.userInvitations||r.tags||r.items||r.groups||r.comments||r.provisions||r.results||r.relatedItems||r,(t||e)&&(n=n.map(o=>{const a=Object.assign(t?t.fromJSON(o):o,e);return typeof a.load=="function"&&a.load(s),a}))}else n=[];return n}};We.AUTH_MODE_ANONYMOUS="anonymous",We.AUTH_MODE_AUTO="auto",We.AUTH_MODE_IMMEDIATE="immediate",u([d()],We.prototype,"access",void 0),u([d()],We.prototype,"allSSL",void 0),u([d()],We.prototype,"authMode",void 0),u([d()],We.prototype,"authorizedCrossOriginDomains",void 0),u([Me("authorizedCrossOriginDomains")],We.prototype,"readAuthorizedCrossOriginDomains",null),u([d()],We.prototype,"basemapGalleryGroupQuery",void 0),u([d()],We.prototype,"bingKey",void 0),u([d()],We.prototype,"canListApps",void 0),u([d()],We.prototype,"canListData",void 0),u([d()],We.prototype,"canListPreProvisionedItems",void 0),u([d()],We.prototype,"canProvisionDirectPurchase",void 0),u([d()],We.prototype,"canSearchPublic",void 0),u([d()],We.prototype,"canShareBingPublic",void 0),u([d()],We.prototype,"canSharePublic",void 0),u([d()],We.prototype,"canSignInArcGIS",void 0),u([d()],We.prototype,"canSignInIDP",void 0),u([d()],We.prototype,"colorSetsGroupQuery",void 0),u([d()],We.prototype,"commentsEnabled",void 0),u([d({type:Date})],We.prototype,"created",void 0),u([d()],We.prototype,"credential",void 0),u([d()],We.prototype,"culture",void 0),u([d()],We.prototype,"currentVersion",void 0),u([d()],We.prototype,"customBaseUrl",void 0),u([d()],We.prototype,"defaultBasemap",void 0),u([Me("defaultBasemap")],We.prototype,"readDefaultBasemap",null),u([d()],We.prototype,"defaultDevBasemap",void 0),u([Me("defaultDevBasemap")],We.prototype,"readDefaultDevBasemap",null),u([d({type:ur})],We.prototype,"defaultExtent",void 0),u([d()],We.prototype,"defaultVectorBasemap",void 0),u([Me("defaultVectorBasemap")],We.prototype,"readDefaultVectorBasemap",null),u([d()],We.prototype,"description",void 0),u([d()],We.prototype,"devBasemapGalleryGroupQuery",void 0),u([d()],We.prototype,"eueiEnabled",void 0),u([d({readOnly:!0})],We.prototype,"extraQuery",null),u([d()],We.prototype,"featuredGroups",void 0),u([d()],We.prototype,"featuredItemsGroupQuery",void 0),u([d()],We.prototype,"galleryTemplatesGroupQuery",void 0),u([d()],We.prototype,"livingAtlasGroupQuery",void 0),u([d()],We.prototype,"hasCategorySchema",void 0),u([d()],We.prototype,"helpBase",void 0),u([d()],We.prototype,"helperServices",void 0),u([d()],We.prototype,"helpMap",void 0),u([d()],We.prototype,"homePageFeaturedContent",void 0),u([d()],We.prototype,"homePageFeaturedContentCount",void 0),u([d()],We.prototype,"httpPort",void 0),u([d()],We.prototype,"httpsPort",void 0),u([d()],We.prototype,"id",void 0),u([d()],We.prototype,"ipCntryCode",void 0),u([d({readOnly:!0})],We.prototype,"isOrganization",null),u([d()],We.prototype,"isPortal",void 0),u([d()],We.prototype,"isReadOnly",void 0),u([d({readOnly:!0})],We.prototype,"itemPageUrl",null),u([d()],We.prototype,"layerTemplatesGroupQuery",void 0),u([d()],We.prototype,"maxTokenExpirationMinutes",void 0),u([d({type:Date})],We.prototype,"modified",void 0),u([d()],We.prototype,"name",void 0),u([d()],We.prototype,"portalHostname",void 0),u([d()],We.prototype,"portalMode",void 0),u([d()],We.prototype,"portalProperties",void 0),u([d()],We.prototype,"region",void 0),u([d({readOnly:!0})],We.prototype,"restUrl",null),u([d()],We.prototype,"rotatorPanels",void 0),u([d()],We.prototype,"showHomePageDescription",void 0),u([d()],We.prototype,"sourceJSON",void 0),u([d()],We.prototype,"staticImagesUrl",void 0),u([d({json:{name:"2DStylesGroupQuery"}})],We.prototype,"stylesGroupQuery2d",void 0),u([d({json:{name:"stylesGroupQuery"}})],We.prototype,"stylesGroupQuery3d",void 0),u([d()],We.prototype,"supportsHostedServices",void 0),u([d()],We.prototype,"symbolSetsGroupQuery",void 0),u([d()],We.prototype,"templatesGroupQuery",void 0),u([d()],We.prototype,"thumbnail",void 0),u([d({readOnly:!0})],We.prototype,"thumbnailUrl",null),u([d()],We.prototype,"units",void 0),u([d()],We.prototype,"url",void 0),u([d()],We.prototype,"urlKey",void 0),u([Me("urlKey")],We.prototype,"readUrlKey",null),u([d()],We.prototype,"user",void 0),u([Me("user")],We.prototype,"readUser",null),u([d()],We.prototype,"useStandardizedQuery",void 0),u([d()],We.prototype,"useVectorBasemaps",void 0),u([d()],We.prototype,"vectorBasemapGalleryGroupQuery",void 0),We=fh=u([$("esri.portal.Portal")],We);const pa=We;let qx=class extends bi(fe){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return v(e)&&e.placement===this.placement&&e.style===this.style&&(R(this.color)&&R(e.color)||v(this.color)&&v(e.color)&&this.color.toJSON()===e.color.toJSON())}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],qx.prototype,"type",void 0),u([d({type:tWe,json:{default:"begin-end",write:!0}})],qx.prototype,"placement",void 0),u([d({type:aCe,json:{default:"arrow",write:!0}})],qx.prototype,"style",void 0),u([d({type:Xe,json:{type:[Xi],default:null,write:!0}})],qx.prototype,"color",void 0),qx=u([$("esri.symbols.LineStyleMarker3D")],qx);const AZ=qx;var b6;let Jm=b6=class extends yy{constructor(t){super(t),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=Cp(1),this.pattern=null,this.marker=null}clone(){const t={enabled:this.enabled,material:v(this.material)?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:v(this.pattern)?this.pattern.clone():null,marker:v(this.marker)?this.marker.clone():null};return new b6(t)}static fromSimpleLineSymbol(t){var r;const e={enabled:!0,size:t.width??Cp(1),cap:t.cap||"butt",join:t.join||"miter",pattern:t.style&&t.style!=="inside-frame"?new Cne({style:t.style}):null,material:new Zh({color:(t.color||v$).clone()}),marker:t.marker?new AZ({placement:t.marker.placement,style:t.marker.style,color:((r=t.marker.color)==null?void 0:r.clone())??null}):null};return new b6(e)}};u([d({type:Zh,json:{write:!0}})],Jm.prototype,"material",void 0),u([st({Line:"line"},{readOnly:!0})],Jm.prototype,"type",void 0),u([d({type:bCe,json:{write:!0,default:"miter"}})],Jm.prototype,"join",void 0),u([d({type:$ne,json:{write:!0,default:"butt"}})],Jm.prototype,"cap",void 0),u([d(oy)],Jm.prototype,"size",void 0),u([d(dCe)],Jm.prototype,"pattern",void 0),u([d({types:{key:"type",base:AZ,typeMap:{style:AZ}},json:{write:!0}})],Jm.prototype,"marker",void 0),Jm=b6=u([$("esri.symbols.LineSymbol3DLayer")],Jm);const vN=Jm;var RZ;const BXe=ja()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let LP=RZ=class extends fe{clone(){return new RZ({href:this.href,primitive:this.primitive})}};u([d({type:String,json:{read:jne,write:Jb}})],LP.prototype,"href",void 0),u([st(BXe)],LP.prototype,"primitive",void 0),LP=RZ=u([$("esri.symbols.support.ObjectSymbol3DLayerResource")],LP);const WCe="sphere";var OZ;let jT=OZ=class extends be{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new OZ({x:this.x,y:this.y,z:this.z})}};u([d({type:Number})],jT.prototype,"x",void 0),u([d({type:Number})],jT.prototype,"y",void 0),u([d({type:Number})],jT.prototype,"z",void 0),jT=OZ=u([$("esri.symbols.support.Symbol3DAnchorPosition3D")],jT);var MZ;let Ol=MZ=class extends yy{constructor(t){super(t),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new MZ({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:v(this.material)?this.material.clone():null,castShadows:this.castShadows,resource:this.resource&&this.resource.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};u([d({type:Zh,json:{write:!0}})],Ol.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Ol.prototype,"castShadows",void 0),u([d({type:LP,json:{write:!0}})],Ol.prototype,"resource",void 0),u([st({Object:"object"},{readOnly:!0})],Ol.prototype,"type",void 0),u([d({type:Number,json:{write:!0}})],Ol.prototype,"width",void 0),u([d({type:Number,json:{write:!0}})],Ol.prototype,"height",void 0),u([d({type:Number,json:{write:!0}})],Ol.prototype,"depth",void 0),u([st({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),d({json:{default:"origin"}})],Ol.prototype,"anchor",void 0),u([d({type:jT,json:{type:[Number],read:{reader:t=>new jT({x:t[0],y:t[1],z:t[2]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y,t.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Ol.prototype,"anchorPosition",void 0),u([d({type:Number,json:{write:!0}})],Ol.prototype,"heading",void 0),u([d({type:Number,json:{write:!0}})],Ol.prototype,"tilt",void 0),u([d({type:Number,json:{write:!0}})],Ol.prototype,"roll",void 0),u([d({readOnly:!0})],Ol.prototype,"isPrimitive",null),Ol=MZ=u([$("esri.symbols.ObjectSymbol3DLayer")],Ol);const Wne=Ol;var PZ;let gc=PZ=class extends yy{constructor(t){super(t),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(t,e){return t??(e.height==null&&e.size!=null?e.size:void 0)}readHeight(t,e){return t??(e.width==null&&e.size!=null?e.size:void 0)}clone(){return new PZ({enabled:this.enabled,material:v(this.material)?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};u([d({type:Zh,json:{write:!0}})],gc.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],gc.prototype,"castShadows",void 0),u([st({Path:"path"},{readOnly:!0})],gc.prototype,"type",void 0),u([d({type:["circle","quad"],json:{write:!0,default:"circle"}})],gc.prototype,"profile",void 0),u([d({type:bCe,json:{write:!0,default:"miter"}})],gc.prototype,"join",void 0),u([d({type:TWe,json:{write:!0,default:"butt"}})],gc.prototype,"cap",void 0),u([d({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],gc.prototype,"width",void 0),u([Me("width",["width","size","height"])],gc.prototype,"readWidth",null),u([d({type:Number,json:{write:!0}})],gc.prototype,"height",void 0),u([Me("height",["height","size","width"])],gc.prototype,"readHeight",null),u([d({type:["center","bottom","top"],json:{write:!0,default:"center"}})],gc.prototype,"anchor",void 0),u([d({type:["heading","all"],json:{write:!0,default:"all"}})],gc.prototype,"profileRotation",void 0),gc=PZ=u([$("esri.symbols.PathSymbol3DLayer")],gc);const Xne=gc;var IZ;let WA=IZ=class extends fe{constructor(){super(...arguments),this.color=new Xe([0,0,0,1]),this.size=0}clone(){const t={color:se(this.color),size:this.size};return new IZ(t)}};u([d(D_)],WA.prototype,"color",void 0),u([d(oy)],WA.prototype,"size",void 0),WA=IZ=u([$("esri.symbols.support.Symbol3DHalo")],WA);let w$=class extends bi(fe){constructor(e){super(e),this.color=null}};u([d(D_)],w$.prototype,"color",void 0),w$=u([$("esri.symbols.support.Symbol3DTextBackground")],w$);var w6;let ou=w6=class extends yy{constructor(t){super(t),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(t){v(t)&&v(this._userSize)&&(t.size=this._userSize),this._set("font",t)}writeFont(t,e,r,i){const n={...i,textSymbol3D:!0};e.font=t.write({},n),delete e.font.size}get size(){return v(this._userSize)?this._userSize:v(this.font)&&this.font.size!=null?this.font.size:9}set size(t){this._userSize=t,v(this.font)&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const t=new w6({enabled:this.enabled,font:this.font&&se(this.font),halo:this.halo&&se(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:v(this.material)?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:se(this.background)});return t._userSize=this._userSize,t}static fromTextSymbol(t){return new w6({font:v(t.font)?t.font.clone():new j9,halo:jXe(t.haloColor,t.haloSize),horizontalAlignment:t.horizontalAlignment,lineHeight:t.lineHeight,material:t.color?new Zh({color:t.color.clone()}):null,text:t.text,verticalAlignment:t.verticalAlignment,background:t.backgroundColor?new w$({color:t.backgroundColor.clone()}):null})}};function jXe(t,e){return t&&e!=null&&e>0?new WA({color:se(t),size:e}):null}u([d({type:j9,json:{write:!0}})],ou.prototype,"font",null),u([De("font")],ou.prototype,"writeFont",null),u([d({type:WA,json:{write:!0}})],ou.prototype,"halo",void 0),u([d({...xCe,json:{default:"center",write:!0}})],ou.prototype,"horizontalAlignment",void 0),u([d({...wCe,json:{default:1,write:!0}})],ou.prototype,"lineHeight",void 0),u([d({type:Zh,json:{write:!0}})],ou.prototype,"material",void 0),u([d({type:w$,json:{write:!0}})],ou.prototype,"background",void 0),u([d(oy)],ou.prototype,"size",null),u([d({type:String,json:{write:!0}})],ou.prototype,"text",void 0),u([st({Text:"text"},{readOnly:!0})],ou.prototype,"type",void 0),u([d({...TCe,json:{default:"baseline",write:!0}})],ou.prototype,"verticalAlignment",void 0),ou=w6=u([$("esri.symbols.TextSymbol3DLayer")],ou);const U2=ou;var $Z;let Yv=$Z=class extends yy{constructor(t){super(t),this.color=LZ.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new $Z({color:se(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};u([d({type:Xe,nonNullable:!0,json:{type:[Xi],write:(t,e,r)=>e[r]=t.toArray(Xe.AlphaMode.UNLESS_OPAQUE),default:()=>LZ.clone(),defaultEquals:t=>t.toCss(!0)===LZ.toCss(!0)}})],Yv.prototype,"color",void 0),u([st({Water:"water"},{readOnly:!0})],Yv.prototype,"type",void 0),u([d({type:["small","medium","large"],json:{write:!0,default:"medium"}})],Yv.prototype,"waterbodySize",void 0),u([d({type:Number,json:{write:!0,default:null}})],Yv.prototype,"waveDirection",void 0),u([d({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],Yv.prototype,"waveStrength",void 0),Yv=$Z=u([$("esri.symbols.WaterSymbol3DLayer")],Yv);const LZ=new Xe([0,119,190]),XCe=Yv;var DZ;let Wx=DZ=class extends be{constructor(t){super(t),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new DZ({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};u([d({type:String})],Wx.prototype,"name",void 0),u([d({type:String})],Wx.prototype,"styleUrl",void 0),u([d({type:String})],Wx.prototype,"styleName",void 0),u([d({type:pa})],Wx.prototype,"portal",void 0),Wx=DZ=u([$("esri.symbols.support.StyleOrigin")],Wx);const NZ=Wx;var FZ;let x$=FZ=class extends be{constructor(){super(...arguments),this.url=""}clone(){return new FZ({url:this.url})}};u([d({type:String})],x$.prototype,"url",void 0),x$=FZ=u([$("esri.symbols.support.Thumbnail")],x$);const YCe={icon:ab,object:Wne,line:vN,path:Xne,fill:_N,extrude:oCe,text:U2,water:XCe},GXe=ct.ofType({base:yy,key:"type",typeMap:YCe,errorContext:"symbol-layer"});let Km=class extends Ku{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const r=this.__accessor__&&this.__accessor__.metadatas&&this.__accessor__.metadatas.symbolLayers,i=r&&r.type||ct;this._set("symbolLayers",new i)}get color(){return null}set color(e){this.constructed&&re.getLogger(this.declaredClass).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){Kb(e,this._get("symbolLayers"))}readStyleOrigin(e,r,i){if(e.styleUrl&&e.name){const n=k2(e.styleUrl,i);return new NZ({styleUrl:n,name:e.name})}if(e.styleName&&e.name)return new NZ({portal:i&&i.portal||pa.getDefault(),styleName:e.styleName,name:e.name});i&&i.messages&&i.messages.push(new Sp("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:i,definition:e}))}writeStyleOrigin(e,r,i,n){if(e.styleUrl&&e.name){let s=x_(e.styleUrl,n);Bu(s)&&(s=em(s)),r.styleOrigin={styleUrl:s,name:e.name}}else e.styleName&&e.name&&(e.portal&&n&&n.portal&&!RCe(e.portal.restUrl,n.portal.restUrl)?n&&n.messages&&n.messages.push(new Sp("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):r.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof yy||e&&YCe[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};u([d({json:{read:!1,write:!1}})],Km.prototype,"color",null),u([d({type:GXe,nonNullable:!0,json:{write:!0}}),cr(UCe)],Km.prototype,"symbolLayers",null),u([d({type:NZ})],Km.prototype,"styleOrigin",void 0),u([Me("styleOrigin")],Km.prototype,"readStyleOrigin",null),u([De("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],Km.prototype,"writeStyleOrigin",null),u([d({type:x$,json:{read:!1}})],Km.prototype,"thumbnail",void 0),u([d({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],Km.prototype,"type",void 0),Km=u([$("esri.symbols.Symbol3D")],Km);const g3=Km;let DP=class extends fe{constructor(e){super(e),this.visible=!0}clone(){}};u([d({type:["line"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],DP.prototype,"type",void 0),u([d({readOnly:!0})],DP.prototype,"visible",void 0),DP=u([$("esri.symbols.callouts.Callout3D")],DP);const ZCe=DP;var kZ;let x6=kZ=class extends fe{constructor(){super(...arguments),this.color=new Xe("white")}clone(){return new kZ({color:se(this.color)})}};u([d(D_)],x6.prototype,"color",void 0),x6=kZ=u([$("esri.symbols.callouts.LineCallout3DBorder")],x6);const JCe=x6;Object.freeze(Object.defineProperty({__proto__:null,default:JCe},Symbol.toStringTag,{value:"Module"}));var UZ;let Zv=UZ=class extends ZCe{constructor(t){super(t),this.type="line",this.color=new Xe([0,0,0,1]),this.size=Cp(1),this.border=null}get visible(){return this.size>0&&v(this.color)&&this.color.a>0}clone(){return new UZ({color:se(this.color),size:this.size,border:se(this.border)})}};u([st({line:"line"},{readOnly:!0})],Zv.prototype,"type",void 0),u([d(D_)],Zv.prototype,"color",void 0),u([d(oy)],Zv.prototype,"size",void 0),u([d({type:JCe,json:{write:!0}})],Zv.prototype,"border",void 0),u([d({readOnly:!0})],Zv.prototype,"visible",null),Zv=UZ=u([$("esri.symbols.callouts.LineCallout3D")],Zv);const HXe=Zv;function Yne(t){if(!t)return!1;const e=t.verticalOffset;return!!e&&!(e.screenLength<=0||v(e.maxWorldLength)&&e.maxWorldLength<=0)}function KCe(t){if(!t||!t.supportsCallout||!t.supportsCallout())return!1;const e=t.callout;return!!e&&!!e.visible&&!!Yne(t)}function Zne(t){return t.type==="point-3d"||t.type==="label-3d"}function QCe(t){return t.horizontalAlignment==="center"}const eAe={types:{key:"type",base:ZCe,typeMap:{line:HXe}},json:{write:!0}};var zZ;let wC=zZ=class extends fe{constructor(t){super(t),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new zZ({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};u([d(oy)],wC.prototype,"screenLength",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0,default:0}})],wC.prototype,"minWorldLength",void 0),u([d({type:Number,json:{write:!0}})],wC.prototype,"maxWorldLength",void 0),wC=zZ=u([$("esri.symbols.support.Symbol3DVerticalOffset")],wC);const tAe=wC;var T6;const rAe=ct.ofType({base:null,key:"type",typeMap:{text:U2}});let Jv=T6=class extends g3{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new rAe,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return KCe(this)}hasVisibleVerticalOffset(){return Yne(this)}clone(){return new T6({styleOrigin:se(this.styleOrigin),symbolLayers:se(this.symbolLayers),thumbnail:se(this.thumbnail),callout:se(this.callout),verticalOffset:se(this.verticalOffset)})}static fromTextSymbol(t){return new T6({symbolLayers:[U2.fromTextSymbol(t)]})}};u([d({type:tAe,json:{write:!0}})],Jv.prototype,"verticalOffset",void 0),u([d(eAe)],Jv.prototype,"callout",void 0),u([d({json:{read:!1,write:!1}})],Jv.prototype,"styleOrigin",void 0),u([d({type:rAe})],Jv.prototype,"symbolLayers",void 0),u([st({LabelSymbol3D:"label-3d"},{readOnly:!0})],Jv.prototype,"type",void 0),Jv=T6=u([$("esri.symbols.LabelSymbol3D")],Jv);const H9=Jv;var S6;const iAe=ct.ofType({base:null,key:"type",typeMap:{line:vN,path:Xne}}),qXe=ct.ofType({base:null,key:"type",typeMap:{line:vN,path:Xne}});let NP=S6=class extends g3{constructor(t){super(t),this.symbolLayers=new iAe,this.type="line-3d"}clone(){return new S6({styleOrigin:se(this.styleOrigin),symbolLayers:se(this.symbolLayers),thumbnail:se(this.thumbnail)})}static fromSimpleLineSymbol(t){return new S6({symbolLayers:[vN.fromSimpleLineSymbol(t)]})}};u([d({type:iAe,json:{type:qXe}})],NP.prototype,"symbolLayers",void 0),u([st({LineSymbol3D:"line-3d"},{readOnly:!0})],NP.prototype,"type",void 0),NP=S6=u([$("esri.symbols.LineSymbol3D")],NP);const q9=NP;let Kv=class extends Ku{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};u([d({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],Kv.prototype,"angle",void 0),u([d({type:["simple-marker","picture-marker"],readOnly:!0})],Kv.prototype,"type",void 0),u([d({type:Number,cast:yi,json:{write:!0}})],Kv.prototype,"xoffset",void 0),u([d({type:Number,cast:yi,json:{write:!0}})],Kv.prototype,"yoffset",void 0),u([d({type:Number,cast:t=>t==="auto"?t:yi(t),json:{write:!0}})],Kv.prototype,"size",void 0),Kv=u([$("esri.symbols.MarkerSymbol")],Kv);const nAe=Kv;var E6;const sAe=ct.ofType({base:null,key:"type",typeMap:{fill:_N}});let FP=E6=class extends g3{constructor(t){super(t),this.symbolLayers=new sAe,this.type="mesh-3d"}clone(){return new E6({styleOrigin:se(this.styleOrigin),symbolLayers:se(this.symbolLayers),thumbnail:se(this.thumbnail)})}static fromSimpleFillSymbol(t){return new E6({symbolLayers:[_N.fromSimpleFillSymbol(t)]})}};u([d({type:sAe})],FP.prototype,"symbolLayers",void 0),u([st({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],FP.prototype,"type",void 0),FP=E6=u([$("esri.symbols.MeshSymbol3D")],FP);const W9=FP;function WXe(t,e,r){return e.imageData?MCe({mediaType:e.contentType||"image/png",isBase64:!0,data:e.imageData}):oAe(e.url,r)}function oAe(t,e){var r;return YXe(e)&&!Bu(t)&&((r=e==null?void 0:e.layer)!=null&&r.parsedUrl)?Yb(e.layer.parsedUrl.path,"images",t):k2(t,e)}function XXe(t,e,r,i){if(cd(t)){const n=f3(t);if(!n)return;e.contentType=n.mediaType,e.imageData=n.data,r&&r.imageData===e.imageData&&r.url&&Jb(r.url,e,"url",i)}else Jb(t,e,"url",i)}const aAe={json:{read:{source:["imageData","url"],reader:WXe},write:{writer(t,e,r,i){XXe(t,e,this.source,i)}}}},lAe={readOnly:!0,json:{read:{source:["imageData","url"],reader(t,e,r){const i={};return e.imageData&&(i.imageData=e.imageData),e.contentType&&(i.contentType=e.contentType),e.url&&(i.url=oAe(e.url,r)),i}}}};function YXe(t){var e,r;return!(t==null||t.origin!=="service"&&t.origin!=="portal-item"||((e=t.layer)==null?void 0:e.type)!=="feature"&&((r=t.layer)==null?void 0:r.type)!=="stream")}var VZ;let Od=VZ=class extends lCe{constructor(...t){super(...t),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(t,e,r,i){if(t&&typeof t!="string"&&t.imageData==null)return t;const n={};return t&&(n.url=t),e&&(n.outline=e),r!=null&&(n.width=yi(r)),i!=null&&(n.height=yi(i)),n}clone(){const t=new VZ({color:se(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return t._set("source",se(this.source)),t}hash(){var t;return`${super.hash()}.${(t=this.color)==null?void 0:t.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};u([st({esriPFS:"picture-fill"},{readOnly:!0})],Od.prototype,"type",void 0),u([d(aAe)],Od.prototype,"url",void 0),u([d({type:Number,json:{write:!0}})],Od.prototype,"xscale",void 0),u([d({type:Number,json:{write:!0}})],Od.prototype,"yscale",void 0),u([d({type:Number,cast:yi,json:{write:!0}})],Od.prototype,"width",void 0),u([d({type:Number,cast:yi,json:{write:!0}})],Od.prototype,"height",void 0),u([d({type:Number,cast:yi,json:{write:!0}})],Od.prototype,"xoffset",void 0),u([d({type:Number,cast:yi,json:{write:!0}})],Od.prototype,"yoffset",void 0),u([d(lAe)],Od.prototype,"source",void 0),Od=VZ=u([$("esri.symbols.PictureFillSymbol")],Od);const cAe=Od;var BZ;let nf=BZ=class extends nAe{constructor(...t){super(...t),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string"&&t.imageData==null)return t;const i={};return t&&(i.url=t),e!=null&&(i.width=yi(e)),r!=null&&(i.height=yi(r)),i}readHeight(t,e){return e.size||t}readWidth(t,e){return e.size||t}clone(){const t=new BZ({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return t._set("source",se(this.source)),t}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};u([d({json:{write:!1}})],nf.prototype,"color",void 0),u([st({esriPMS:"picture-marker"},{readOnly:!0})],nf.prototype,"type",void 0),u([d(aAe)],nf.prototype,"url",void 0),u([d(lAe)],nf.prototype,"source",void 0),u([d({type:Number,cast:yi,json:{write:!0}})],nf.prototype,"height",void 0),u([Me("height",["height","size"])],nf.prototype,"readHeight",null),u([d({type:Number,cast:yi,json:{write:!0}})],nf.prototype,"width",void 0),u([d({json:{write:!1}})],nf.prototype,"size",void 0),nf=BZ=u([$("esri.symbols.PictureMarkerSymbol")],nf);const X9=nf;var Xx;const uAe=ct.ofType({base:null,key:"type",typeMap:{icon:ab,object:Wne,text:U2}});let Yx=Xx=class extends g3{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.symbolLayers=new uAe,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const t of this.symbolLayers.items)switch(t.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return KCe(this)}hasVisibleVerticalOffset(){return Yne(this)}clone(){return new Xx({verticalOffset:se(this.verticalOffset),callout:se(this.callout),styleOrigin:se(this.styleOrigin),symbolLayers:se(this.symbolLayers),thumbnail:se(this.thumbnail)})}static fromSimpleMarkerSymbol(t){return new Xx({symbolLayers:[ab.fromSimpleMarkerSymbol(t)]})}static fromPictureMarkerSymbol(t){return new Xx({symbolLayers:[ab.fromPictureMarkerSymbol(t)]})}static fromCIMSymbol(t){var i,n;if(((n=(i=t.data)==null?void 0:i.symbol)==null?void 0:n.type)!=="CIMPointSymbol")return null;const r=t.data.symbol;return new Xx(r!=null&&r.callout?{symbolLayers:[ab.fromCIMSymbol(t)],callout:{type:"line",size:.5,color:[0,0,0]},verticalOffset:{screenLength:40}}:{symbolLayers:[ab.fromCIMSymbol(t)]})}static fromTextSymbol(t){return new Xx({symbolLayers:[U2.fromTextSymbol(t)]})}};u([d({type:tAe,json:{write:!0}})],Yx.prototype,"verticalOffset",void 0),u([d(eAe)],Yx.prototype,"callout",void 0),u([d({type:uAe,json:{origins:{"web-scene":{write:!0}}}})],Yx.prototype,"symbolLayers",void 0),u([st({PointSymbol3D:"point-3d"},{readOnly:!0})],Yx.prototype,"type",void 0),Yx=Xx=u([$("esri.symbols.PointSymbol3D")],Yx);const lb=Yx;var kP;const hAe=ct.ofType({base:null,key:"type",typeMap:{extrude:oCe,fill:_N,icon:ab,line:vN,object:Wne,text:U2,water:XCe}});let UP=kP=class extends g3{constructor(t){super(t),this.symbolLayers=new hAe,this.type="polygon-3d"}clone(){return new kP({styleOrigin:se(this.styleOrigin),symbolLayers:se(this.symbolLayers),thumbnail:se(this.thumbnail)})}static fromJSON(t){const e=new kP;if(e.read(t),e.symbolLayers.length===2&&e.symbolLayers.getItemAt(0).type==="fill"&&e.symbolLayers.getItemAt(1).type==="line"){const r=e.symbolLayers.getItemAt(0),i=e.symbolLayers.getItemAt(1);!i.enabled||t.symbolLayers&&t.symbolLayers[1]&&t.symbolLayers[1].enable===!1||(r.outline={size:i.size,color:v(i.material)?i.material.color:null}),e.symbolLayers.removeAt(1)}return e}static fromSimpleFillSymbol(t){return new kP({symbolLayers:[_N.fromSimpleFillSymbol(t)]})}};u([d({type:hAe,json:{write:!0}})],UP.prototype,"symbolLayers",void 0),u([st({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],UP.prototype,"type",void 0),UP=kP=u([$("esri.symbols.PolygonSymbol3D")],UP);const bN=UP;var jZ;const Gj=new mr({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let Zx=jZ=class extends lCe{constructor(...t){super(...t),this.color=new Xe([0,0,0,.25]),this.outline=new Lp,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string")return t;const i={};return t&&(i.style=t),e&&(i.outline=e),r&&(i.color=r),i}clone(){return new jZ({color:se(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};u([d()],Zx.prototype,"color",void 0),u([d()],Zx.prototype,"outline",void 0),u([st({esriSFS:"simple-fill"},{readOnly:!0})],Zx.prototype,"type",void 0),u([d({type:Gj.apiValues,json:{read:Gj.read,write:Gj.write}})],Zx.prototype,"style",void 0),Zx=jZ=u([$("esri.symbols.SimpleFillSymbol")],Zx);const Mw=Zx;var GZ;const Hj=new mr({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let Qm=GZ=class extends nAe{constructor(...t){super(...t),this.color=new Xe([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new Lp}normalizeCtorArgs(t,e,r,i){if(t&&typeof t!="string")return t;const n={};return t&&(n.style=t),e!=null&&(n.size=yi(e)),r&&(n.outline=r),i&&(n.color=i),n}writeColor(t,e){t&&this.style!=="x"&&this.style!=="cross"&&(e.color=t.toJSON()),t===null&&(e.color=null)}set path(t){this.style="path",this._set("path",t)}clone(){return new GZ({angle:this.angle,color:se(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var t;return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${(t=this.outline)==null?void 0:t.hash()}`}};u([d()],Qm.prototype,"color",void 0),u([De("color")],Qm.prototype,"writeColor",null),u([st({esriSMS:"simple-marker"},{readOnly:!0})],Qm.prototype,"type",void 0),u([d()],Qm.prototype,"size",void 0),u([d({type:Hj.apiValues,json:{read:Hj.read,write:Hj.write}})],Qm.prototype,"style",void 0),u([d({type:String,json:{write:!0}})],Qm.prototype,"path",null),u([d({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Lp}},json:{default:null,write:!0}})],Qm.prototype,"outline",void 0),Qm=GZ=u([$("esri.symbols.SimpleMarkerSymbol")],Qm);const Pw=Qm;var HZ;let ts=HZ=class extends Ku{constructor(...t){super(...t),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new j9,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string")return t;const i={};return t&&(i.text=t),e&&(i.font=e),r&&(i.color=r),i}writeLineWidth(t,e,r,i){i&&typeof i!="string"?i.origin:e[r]=t}castLineWidth(t){return yi(t)}writeLineHeight(t,e,r,i){i&&typeof i!="string"?i.origin:e[r]=t}clone(){return new HZ({angle:this.angle,backgroundColor:se(this.backgroundColor),borderLineColor:se(this.borderLineColor),borderLineSize:this.borderLineSize,color:se(this.color),font:this.font&&this.font.clone(),haloColor:se(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var t;return`${this.backgroundColor&&this.backgroundColor.hash()}.${this.borderLineColor}.${this.borderLineSize}.${(t=this.color)==null?void 0:t.hash()}.${this.font&&this.font.hash()}.${this.haloColor&&this.haloColor.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};u([d({type:Xe,json:{write:!0}})],ts.prototype,"backgroundColor",void 0),u([d({type:Xe,json:{write:!0}})],ts.prototype,"borderLineColor",void 0),u([d({type:Number,json:{write:!0},cast:yi})],ts.prototype,"borderLineSize",void 0),u([d({type:j9,json:{write:!0}})],ts.prototype,"font",void 0),u([d({...xCe,json:{write:!0}})],ts.prototype,"horizontalAlignment",void 0),u([d({type:Boolean,json:{write:!0}})],ts.prototype,"kerning",void 0),u([d({type:Xe,json:{write:!0}})],ts.prototype,"haloColor",void 0),u([d({type:Number,cast:yi,json:{write:!0}})],ts.prototype,"haloSize",void 0),u([d({type:Boolean,json:{write:!0}})],ts.prototype,"rightToLeft",void 0),u([d({type:Boolean,json:{write:!0}})],ts.prototype,"rotated",void 0),u([d({type:String,json:{write:!0}})],ts.prototype,"text",void 0),u([st({esriTS:"text"},{readOnly:!0})],ts.prototype,"type",void 0),u([d({...TCe,json:{write:!0}})],ts.prototype,"verticalAlignment",void 0),u([d({type:Number,cast:yi,json:{write:!0}})],ts.prototype,"xoffset",void 0),u([d({type:Number,cast:yi,json:{write:!0}})],ts.prototype,"yoffset",void 0),u([d({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],ts.prototype,"angle",void 0),u([d({type:Number,json:{write:!0}})],ts.prototype,"width",void 0),u([d({type:Number})],ts.prototype,"lineWidth",void 0),u([De("lineWidth")],ts.prototype,"writeLineWidth",null),u([cr("lineWidth")],ts.prototype,"castLineWidth",null),u([d(wCe)],ts.prototype,"lineHeight",void 0),u([De("lineHeight")],ts.prototype,"writeLineHeight",null),ts=HZ=u([$("esri.symbols.TextSymbol")],ts);const y3=ts;var qZ;let sf=qZ=class extends Ku{constructor(t){super(t),this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const t=v(this.portal)?this.portal:pa.getDefault(),e=t.user?t.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${e}:${t.url}`}read(t,e){this.portal=e==null?void 0:e.portal,super.read(t,e)}clone(){return new qZ({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(t){return this._fetchSymbol("webRef",t)}fetchCIMSymbol(t){return this._fetchSymbol("cimRef",t)}async _fetchSymbol(t,e){const r=v(e)?e.cache:null,i=r?this._fetchCacheKey:null;if(v(r)){const a=i&&r.get(i);if(a)return a.clone()}const n=await ZXe();lr(e);const s=n.resolveWebStyleSymbol(this,{portal:this.portal},t,e);s.catch(a=>{re.getLogger(this.declaredClass).error("#fetchSymbol()","Failed to create symbol from style",a)});const o=await s;return t==="webRef"&&o.type==="point-3d"||t==="cimRef"&&o.type==="cim"?(v(r)&&r.set(i,o.clone()),o):null}};function ZXe(){return Q(()=>import("./webStyleSymbolUtils-b5a38a87.js"),[])}u([d({json:{write:!1}})],sf.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],sf.prototype,"styleName",void 0),u([d({type:pa,json:{write:!1}})],sf.prototype,"portal",void 0),u([d({type:String,json:{read:jne,write:Jb}})],sf.prototype,"styleUrl",void 0),u([d({type:x$,json:{read:!1}})],sf.prototype,"thumbnail",void 0),u([d({type:String,json:{write:!0}})],sf.prototype,"name",void 0),u([st({styleSymbolReference:"web-style"},{readOnly:!0})],sf.prototype,"type",void 0),u([d()],sf.prototype,"_fetchCacheKey",null),sf=qZ=u([$("esri.symbols.WebStyleSymbol")],sf);const z2=sf;function Y9(t){if(!t)return!1;switch(t.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function bO(t){if(!t)return!1;switch(t.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const RS={base:Ku,key:"type",typeMap:{"simple-fill":Mw,"picture-fill":cAe,"picture-marker":X9,"simple-line":Lp,"simple-marker":Pw,text:y3,"label-3d":H9,"line-3d":q9,"mesh-3d":W9,"point-3d":lb,"polygon-3d":bN,"web-style":z2,cim:d3},errorContext:"symbol"},JXe={base:Ku,key:"type",typeMap:{"picture-marker":X9,"simple-marker":Pw,text:y3,"web-style":z2,cim:d3},errorContext:"symbol"},KXe=Ew({types:RS}),Z9={base:Ku,key:"type",typeMap:{"simple-fill":Mw,"picture-fill":cAe,"picture-marker":X9,"simple-line":Lp,"simple-marker":Pw,text:y3,"line-3d":q9,"mesh-3d":W9,"point-3d":lb,"polygon-3d":bN,"web-style":z2,cim:d3},errorContext:"symbol"},QXe={base:Ku,key:"type",typeMap:{text:y3,"label-3d":H9},errorContext:"symbol"},cde={base:Ku,key:"type",typeMap:{"line-3d":q9,"mesh-3d":W9,"point-3d":lb,"polygon-3d":bN,"web-style":z2,cim:d3},errorContext:"symbol"},eYe={base:Ku,key:"type",typeMap:{"label-3d":H9},errorContext:"symbol"},dAe=om(RS);function tYe(t){if(!t)return null;const e={};for(const r in t){const i=ry(t[r]);i&&(e[r]=i)}return Object.keys(e).length!==0?e:null}function rYe(t){if(!v(t))return null;const e={};for(const r in t){const i=t[r];i&&(e[r]=i.toJSON())}return Object.keys(e).length!==0?e:null}let au=class extends bi(fe){constructor(...e){super(...e),this.isAggregate=!1,this.layer=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:Vu(),configurable:!0})}normalizeCtorArgs(e,r,i,n){return e&&!e.declaredClass?e:{geometry:e,symbol:r,attributes:i,popupTemplate:n}}set aggregateGeometries(e){const r=this._get("aggregateGeometries");JSON.stringify(r)!==JSON.stringify(e)&&this._set("aggregateGeometries",e)}set attributes(e){const r=this._get("attributes");r!==e&&(this._set("attributes",e),this._notifyLayer("attributes",r,e))}set geometry(e){const r=this._get("geometry");r!==e&&(this._set("geometry",e),this._notifyLayer("geometry",r,e))}set symbol(e){const r=this._get("symbol");r!==e&&(this._set("symbol",e),this._notifyLayer("symbol",r,e))}set visible(e){const r=this._get("visible");r!==e&&(this._set("visible",e),this._notifyLayer("visible",r,e))}getEffectivePopupTemplate(e=!1){if(this.popupTemplate)return this.popupTemplate;for(const r of[this.sourceLayer,this.layer])if(r){if("popupTemplate"in r&&r.popupTemplate)return r.popupTemplate;if(e&&"defaultPopupTemplate"in r&&v(r.defaultPopupTemplate))return r.defaultPopupTemplate}return null}getAttribute(e){var r;return(r=this.attributes)==null?void 0:r[e]}setAttribute(e,r){if(this.attributes){const i=this.getAttribute(e);this.attributes[e]=r,this._notifyLayer("attributes",i,r,e)}else this.attributes={[e]:r},this._notifyLayer("attributes",void 0,r,e)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{aggregateGeometries:rYe(this.aggregateGeometries),geometry:v(this.geometry)?this.geometry.toJSON():null,symbol:v(this.symbol)?this.symbol.toJSON():null,attributes:{...this.attributes},popupTemplate:this.popupTemplate&&this.popupTemplate.toJSON()}}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}notifyMeshTransformChanged(){v(this.geometry)&&this.geometry.type==="mesh"&&this._notifyLayer("transform",this.geometry.transform,this.geometry.transform)}_notifyLayer(e,r,i,n){if(!this.layer||!("graphicChanged"in this.layer))return;const s={graphic:this,property:e,oldValue:r,newValue:i};e==="attributes"&&(s.attributeName=n),this.layer.graphicChanged(s)}};u([d({value:null,json:{read:tYe}})],au.prototype,"aggregateGeometries",null),u([d({value:null})],au.prototype,"attributes",null),u([d({value:null,types:Aw,json:{read:ry}})],au.prototype,"geometry",null),u([d({type:Boolean})],au.prototype,"isAggregate",void 0),u([d({clonable:"reference"})],au.prototype,"layer",void 0),u([d({type:fN})],au.prototype,"popupTemplate",void 0),u([d({clonable:"reference"})],au.prototype,"sourceLayer",void 0),u([d({value:null,types:RS})],au.prototype,"symbol",null),u([d({type:Boolean,value:!0})],au.prototype,"visible",null),au=u([$("esri.Graphic")],au),function(t){t.generateUID=Vu}(au||(au={}));const Va=au;let Qb=class{constructor(e,r){this.min=e,this.max=r,this.range=r-e}ndiff(e,r=0){return Math.ceil((e-r)/this.range)*this.range+r}_normalize(e,r,i,n=0,s=!1){return(i-=n)<e?i+=this.ndiff(e-i):i>r&&(i-=this.ndiff(i-r)),s&&i===r&&(i=e),i+n}normalize(e,r=0,i=!1){return this._normalize(this.min,this.max,e,r,i)}clamp(e,r=0){return _e(e-r,this.min,this.max)+r}monotonic(e,r,i){return e<r?r:r+this.ndiff(e-r,i)}minimalMonotonic(e,r,i){return this._normalize(e,e+this.range,r,i)}center(e,r,i){return r=this.monotonic(e,r,i),this.normalize((e+r)/2,i)}diff(e,r,i){return this.monotonic(e,r,i)-e}shortestSignedDiff(e,r){e=this.normalize(e);const i=(r=this.normalize(r))-e,n=r<e?this.minimalMonotonic(e,r)-e:r-this.minimalMonotonic(r,e);return Math.abs(i)<Math.abs(n)?i:n}contains(e,r,i){return r=this.minimalMonotonic(e,r),(i=this.minimalMonotonic(e,i))>e&&i<r}};function Jne(t){for(const e in t){const r=t[e];r instanceof Function&&(t[e]=r.bind(t))}return t}const iYe=Jne(new Qb(0,2*Math.PI)),ew=Jne(new Qb(-Math.PI,Math.PI)),Kne=Jne(new Qb(0,360));let t0=class extends bi(fe){constructor(...e){super(...e),this.position=new Ue([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(e,r,i,n){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const s={position:e};return r!=null&&(s.heading=r),i!=null&&(s.tilt=i),n!=null&&(s.fov=n),s}return e}writePosition(e,r,i,n){const s=e.clone();s.x=Jd(e.x||0),s.y=Jd(e.y||0),s.z=e.hasZ?Jd(e.z||0):e.z,r[i]=s.write({},n)}readPosition(e,r){const i=new Ue;return i.read(e,r),i.x=Jd(i.x||0),i.y=Jd(i.y||0),i.z=i.hasZ?Jd(i.z||0):i.z,i}equals(e){return!R(e)&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}};u([d({type:Ue,json:{write:{isRequired:!0}}})],t0.prototype,"position",void 0),u([De("position")],t0.prototype,"writePosition",null),u([Me("position")],t0.prototype,"readPosition",null),u([d({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),cr(t=>Kne.normalize(Jd(t)))],t0.prototype,"heading",void 0),u([d({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),cr(t=>_e(Jd(t),-180,180))],t0.prototype,"tilt",void 0),u([d({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],t0.prototype,"fov",void 0),t0=u([$("esri.Camera")],t0);const Ap=t0;var WZ;let Qv=WZ=class extends fe{constructor(t){super(t),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(t){return(t%=360)<0&&(t+=360),t}clone(){return new WZ({rotation:this.rotation,scale:this.scale,targetGeometry:v(this.targetGeometry)?this.targetGeometry.clone():null,camera:v(this.camera)?this.camera.clone():null})}};function qj(){return{enabled:!this.camera}}u([d({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:qj}}}}})],Qv.prototype,"rotation",void 0),u([cr("rotation")],Qv.prototype,"castRotation",null),u([d({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:qj}}}}})],Qv.prototype,"scale",void 0),u([d({types:Aw,json:{read:ry,write:!0,origins:{"web-scene":{read:ry,write:{overridePolicy:qj}}}}})],Qv.prototype,"targetGeometry",void 0),u([d({type:Ap,json:{write:!0}})],Qv.prototype,"camera",void 0),Qv=WZ=u([$("esri.Viewpoint")],Qv);const Xn=Qv;let xC=class extends ct{constructor(e){super(e),this.getCollections=null}initialize(){this.own(d2e(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const e=v(this.getCollections)?this.getCollections():null;if(R(e))return void this.removeAll();let r=0;for(const i of e)v(i)&&(r=this._processCollection(r,i));this.splice(r,this.length)}_createNewInstance(e){return new ct(e)}_processCollection(e,r){if(!r)return e;const i=this.itemFilterFunction?this.itemFilterFunction:n=>!!n;for(const n of r)if(n){if(i(n)){const s=this.indexOf(n,e);s>=0?s!==e&&this.reorder(n,e):this.add(n,e),++e}if(this.getChildrenFunction){const s=this.getChildrenFunction(n);if(Array.isArray(s))for(const o of s)e=this._processCollection(e,o);else e=this._processCollection(e,s)}}return e}};u([d()],xC.prototype,"getCollections",void 0),u([d()],xC.prototype,"getChildrenFunction",void 0),u([d()],xC.prototype,"itemFilterFunction",void 0),xC=u([$("esri.core.CollectionFlattener")],xC);const wO=xC;function ne(t,e,r={}){return Qne(t,e,r,pAe)}function fo(t,e,r={}){return Qne(t,e,r,fAe)}function Qne(t,e,r={},i){let n=null;const s=r.once?(o,a)=>{i(o)&&($i(n),e(o,a))}:(o,a)=>{i(o)&&e(o,a)};if(n=$je(t,s,r.sync,r.equals),r.initial){const o=t();s(o,o)}return n}function Yn(t,e,r,i={}){let n=null,s=null,o=null;function a(){var h;n&&s&&(s.remove(),(h=i.onListenerRemove)==null||h.call(i,n),n=null,s=null)}function l(h){i.once&&i.once&&$i(o),r(h)}const c=ne(t,(h,p)=>{var f;a(),T9(h)&&(n=h,s=cN(h,e,l),(f=i.onListenerAdd)==null||f.call(i,h))},{sync:i.sync,initial:!0});return o=am(()=>{c.remove(),a()}),o}function tw(t,e){return nYe(t,fAe,e)}function nYe(t,e,r){if(uo(r))return Promise.reject(Vr());const i=t();if(e!=null&&e(i))return Promise.resolve(i);let n=null;function s(){n=$i(n)}return new Promise((o,a)=>{n=oO([Ua(r,()=>{s(),a(Vr())}),Qne(t,l=>{s(),o(l)},{sync:!1,once:!0},e??pAe)])})}function pAe(t){return!0}function fAe(t){return!!t}function sYe(t,e,r={}){let i=!1;const n=ne(t,(s,o)=>{i||e(s,o)},r);return{remove(){n.remove()},pause(){i=!0},resume(){i=!1}}}const Zr={sync:!0},Vt={initial:!0},Wi={sync:!0,initial:!0};let az=class{constructor(e=r=>r.values().next().value){this._peeker=e,this._items=new Set}get length(){return this._items.size}clear(){this._items.clear()}last(){if(this._items.size===0)return;let e;for(e of this._items);return e}peek(){if(this._items.size!==0)return this._peeker(this._items)}push(e){this.contains(e)||this._items.add(e)}contains(e){return this._items.has(e)}pop(){if(this.length===0)return;const e=this.peek();return this._items.delete(e),e}popLast(){if(this.length===0)return;const e=this.last();return this._items.delete(e),e}remove(e){this._items.delete(e)}filter(e){return this._items.forEach(r=>{e(r)||this._items.delete(r)}),this}};var Ia;(function(t){t[t.HANDSHAKE=0]="HANDSHAKE",t[t.OPEN=1]="OPEN",t[t.OPENED=2]="OPENED",t[t.RESPONSE=3]="RESPONSE",t[t.INVOKE=4]="INVOKE",t[t.ABORT=5]="ABORT",t[t.CLOSE=6]="CLOSE",t[t.OPEN_PORT=7]="OPEN_PORT",t[t.ON=8]="ON"})(Ia||(Ia={}));let oYe=0;function mAe(){return oYe++}function aYe(t){return t&&typeof t=="object"&&("result"in t||"transferList"in t)}function WL(t){return t?typeof t=="string"?JSON.stringify({name:"message",message:t}):t.toJSON?JSON.stringify(t):JSON.stringify({name:t.name,message:t.message,details:t.details||{stack:t.stack}}):null}function ese(t,e,r,i){if(e.type===Ia.OPEN_PORT)return void t.postMessage(e,[e.port]);if(e.type!==Ia.INVOKE&&e.type!==Ia.RESPONSE)return void t.postMessage(e);let n;if(aYe(r)?(n=ude(r.transferList),e.data=r.result):(n=ude(i),e.data=r),n){if(ue("ff")){for(const s of n)if("byteLength"in s&&s.byteLength>267386880){const o="Worker call with large ArrayBuffer would crash Firefox";switch(e.type){case Ia.INVOKE:throw o;case Ia.RESPONSE:return void ese(t,{type:Ia.RESPONSE,jobId:e.jobId,error:WL(o)})}}}t.postMessage(e,n)}else t.postMessage(e)}function XL(t){if(!t)return null;const e=t.data;return e?typeof e=="string"?JSON.parse(e):e:null}function ude(t){if(!t||!t.length)return null;if(ue("esri-workers-arraybuffer-transfer"))return t;const e=t.filter(r=>!lYe(r));return e.length?e:null}function lYe(t){return t instanceof ArrayBuffer||t&&t.constructor&&t.constructor.name==="ArrayBuffer"}const cYe={statsWorker:()=>Q(()=>import("./statsWorker-9530a305.js"),["assets/statsWorker-9530a305.js","assets/utils-ebf21391.js","assets/generateRendererUtils-bf5214e6.js"]),geometryEngineWorker:()=>Q(()=>import("./geometryEngineWorker-8a57eda3.js"),["assets/geometryEngineWorker-8a57eda3.js","assets/geometryEngineJSON-3f330436.js","assets/geometryEngineBase-e1a33b0a.js","assets/json-48e3ea08.js"]),CSVSourceWorker:()=>Q(()=>import("./CSVSourceWorker-84017a67.js"),["assets/CSVSourceWorker-84017a67.js","assets/json-48e3ea08.js","assets/FeatureStore-42c9ec6f.js","assets/optimizedFeatureQueryEngineAdapter-4dc0036f.js","assets/centroid-f5daa837.js","assets/utils-61f08010.js","assets/projectionSupport-d70ac199.js","assets/QueryEngine-b565a77e.js","assets/QueryEngineResult-2c28eebf.js","assets/WhereClause-f6ddfb88.js","assets/executionError-fb3f283a.js","assets/utils-ebf21391.js","assets/generateRendererUtils-bf5214e6.js","assets/QueryEngineCapabilities-42e44ded.js","assets/timeSupport-d6519503.js","assets/number-b0a0df5c.js","assets/clientSideDefaults-ffbb400d.js"]),EdgeProcessingWorker:()=>Q(()=>import("./EdgeProcessingWorker-73e19d0d.js"),[]),ElevationSamplerWorker:()=>Q(()=>import("./ElevationSamplerWorker-9f7bb1cc.js"),["assets/ElevationSamplerWorker-9f7bb1cc.js","assets/georeference-5c032c38.js"]),FeatureServiceSnappingSourceWorker:()=>Q(()=>import("./FeatureServiceSnappingSourceWorker-e6d544e1.js"),["assets/FeatureServiceSnappingSourceWorker-e6d544e1.js","assets/FeatureStore-42c9ec6f.js","assets/optimizedFeatureQueryEngineAdapter-4dc0036f.js","assets/centroid-f5daa837.js","assets/utils-61f08010.js","assets/projectionSupport-d70ac199.js","assets/json-48e3ea08.js","assets/QueryEngine-b565a77e.js","assets/QueryEngineResult-2c28eebf.js","assets/WhereClause-f6ddfb88.js","assets/executionError-fb3f283a.js","assets/utils-ebf21391.js","assets/generateRendererUtils-bf5214e6.js","assets/QueryEngineCapabilities-42e44ded.js","assets/timeSupport-d6519503.js","assets/symbologySnappingCandidates-41134696.js"]),GeoJSONSourceWorker:()=>Q(()=>import("./GeoJSONSourceWorker-3fdca817.js"),["assets/GeoJSONSourceWorker-3fdca817.js","assets/FeatureStore-42c9ec6f.js","assets/optimizedFeatureQueryEngineAdapter-4dc0036f.js","assets/centroid-f5daa837.js","assets/utils-61f08010.js","assets/projectionSupport-d70ac199.js","assets/json-48e3ea08.js","assets/QueryEngine-b565a77e.js","assets/QueryEngineResult-2c28eebf.js","assets/WhereClause-f6ddfb88.js","assets/executionError-fb3f283a.js","assets/utils-ebf21391.js","assets/generateRendererUtils-bf5214e6.js","assets/QueryEngineCapabilities-42e44ded.js","assets/timeSupport-d6519503.js","assets/geojson-ee739c37.js","assets/clientSideDefaults-ffbb400d.js","assets/sourceUtils-54fbd0ff.js"]),LercWorker:()=>Q(()=>import("./LercWorker-0954eeb5.js"),[]),MemorySourceWorker:()=>Q(()=>import("./MemorySourceWorker-e0b9254f.js"),["assets/MemorySourceWorker-e0b9254f.js","assets/objectIdUtils-789e911a.js","assets/FeatureStore-42c9ec6f.js","assets/optimizedFeatureQueryEngineAdapter-4dc0036f.js","assets/centroid-f5daa837.js","assets/utils-61f08010.js","assets/projectionSupport-d70ac199.js","assets/json-48e3ea08.js","assets/QueryEngine-b565a77e.js","assets/QueryEngineResult-2c28eebf.js","assets/WhereClause-f6ddfb88.js","assets/executionError-fb3f283a.js","assets/utils-ebf21391.js","assets/generateRendererUtils-bf5214e6.js","assets/QueryEngineCapabilities-42e44ded.js","assets/timeSupport-d6519503.js","assets/clientSideDefaults-ffbb400d.js","assets/sourceUtils-54fbd0ff.js"]),PBFDecoderWorker:()=>Q(()=>import("./PBFDecoderWorker-df2599d9.js"),[]),Pipeline:()=>Q(()=>import("./Pipeline-7e2931ef.js"),["assets/Pipeline-7e2931ef.js","assets/QueryEngine-b565a77e.js","assets/QueryEngineResult-2c28eebf.js","assets/WhereClause-f6ddfb88.js","assets/executionError-fb3f283a.js","assets/utils-ebf21391.js","assets/generateRendererUtils-bf5214e6.js","assets/projectionSupport-d70ac199.js","assets/json-48e3ea08.js","assets/utils-61f08010.js","assets/QueryEngineCapabilities-42e44ded.js","assets/timeSupport-d6519503.js","assets/FeatureStore2D-c34cfd43.js","assets/CircularArray-f03cccc5.js","assets/ComputedAttributeStorage-eff52a13.js","assets/arcadeTimeUtils-f06505ea.js","assets/centroid-f5daa837.js","assets/definitions-3ddd14a8.js","assets/visualVariablesUtils-f04c4def.js","assets/color-9f576cea.js","assets/enums-4b2a86a0.js","assets/enums-b1d611e3.js","assets/number-b10bd8f5.js","assets/visualVariablesUtils-fbbca9e0.js","assets/ogcFeatureUtils-3991229d.js","assets/geojson-ee739c37.js","assets/clientSideDefaults-ffbb400d.js","assets/StreamFeatureManager-dbbd1c4d.js","assets/createConnection-4bc173a6.js"]),PointCloudWorker:()=>Q(()=>import("./PointCloudWorker-95c8c8df.js"),["assets/PointCloudWorker-95c8c8df.js","assets/PointCloudWorkerUtil-d62d0e0a.js","assets/PointCloudUniqueValueRenderer-17a1fdde.js","assets/I3SBinaryReader-525534dc.js"]),RasterWorker:()=>Q(()=>import("./RasterWorker-aa1183fd.js"),["assets/RasterWorker-aa1183fd.js","assets/dataUtils-b1b85b0c.js","assets/RasterSymbolizer-b3b7e27a.js","assets/colorUtils-c0f43caf.js","assets/utils-e4bbe24c.js","assets/rasterProjectionHelper-a7c6d8c6.js"]),SceneLayerSnappingSourceWorker:()=>Q(()=>import("./SceneLayerSnappingSourceWorker-330de06d.js"),["assets/SceneLayerSnappingSourceWorker-330de06d.js","assets/QueryEngineResult-2c28eebf.js","assets/WhereClause-f6ddfb88.js","assets/executionError-fb3f283a.js","assets/utils-ebf21391.js","assets/generateRendererUtils-bf5214e6.js","assets/projectionSupport-d70ac199.js","assets/json-48e3ea08.js","assets/utils-61f08010.js"]),SceneLayerWorker:()=>Q(()=>import("./SceneLayerWorker-bd417782.js").then(t=>t.S),["assets/SceneLayerWorker-bd417782.js","assets/I3SNode-ce0e22bc.js"]),WFSSourceWorker:()=>Q(()=>import("./WFSSourceWorker-7099f53b.js"),["assets/WFSSourceWorker-7099f53b.js","assets/FeatureStore-42c9ec6f.js","assets/optimizedFeatureQueryEngineAdapter-4dc0036f.js","assets/centroid-f5daa837.js","assets/utils-61f08010.js","assets/projectionSupport-d70ac199.js","assets/json-48e3ea08.js","assets/QueryEngine-b565a77e.js","assets/QueryEngineResult-2c28eebf.js","assets/WhereClause-f6ddfb88.js","assets/executionError-fb3f283a.js","assets/utils-ebf21391.js","assets/generateRendererUtils-bf5214e6.js","assets/QueryEngineCapabilities-42e44ded.js","assets/timeSupport-d6519503.js","assets/geojson-ee739c37.js","assets/sourceUtils-54fbd0ff.js","assets/wfsUtils-d299e39f.js","assets/xmlUtils-444cb4c0.js"]),WorkerTileHandler:()=>Q(()=>import("./WorkerTileHandler-ab496ea3.js"),["assets/WorkerTileHandler-ab496ea3.js","assets/GeometryUtils-53652037.js","assets/Rect-ea14f53a.js","assets/StyleDefinition-7d58136b.js","assets/enums-4b2a86a0.js","assets/TurboLine-8bc5ef2e.js","assets/definitions-3ddd14a8.js","assets/StyleRepository-f0609e85.js","assets/colorUtils-c0f43caf.js","assets/BidiEngine-836b7ef6.js"])},{CLOSE:hde,ABORT:dde,INVOKE:pde,RESPONSE:cM,OPEN_PORT:fde,ON:uYe}=Ia,hYe=2;let dYe=class{constructor(e){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=e,this._timer=null,this._process=this._process.bind(this)}push(e){e.type===Ia.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}},rw=class TC{static connect(e){const r=new MessageChannel;let i;i=typeof e=="function"?new e:"default"in e&&typeof e.default=="function"?new e.default:e;const n=new TC(r.port1,{channel:r,client:i},()=>null);return typeof i=="object"&&"remoteClient"in i&&(i.remoteClient=n),TC.clients.set(n,i),r.port2}static loadWorker(e){const r=cYe[e];return r?r():Promise.resolve(null)}constructor(e,r,i){this._port=e,this._getNextJob=i,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new dYe(n=>this._onInvokeMessage(n)),this._client=r.client,this._onMessage=this._onMessage.bind(this),this._channel=r.channel,this._schedule=r.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:hde}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,r,i){const n=i&&i.signal,s=i&&i.transferList;if(!this._port)return Promise.reject(new H("worker:port-closed",`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:r}));const o=mAe();return new Promise((a,l)=>{if(uo(n))return this._processWork(),void l(Vr());const c=Ua(n,()=>{const p=this._outJobs.get(o);p&&(this._outJobs.delete(o),this._processWork(),$i(p.abortHandle),this._post({type:dde,jobId:o}),l(Vr()))}),h={resolve:a,reject:l,abortHandle:c,debugInfo:e};this._outJobs.set(o,h),this._post({type:pde,jobId:o,methodName:e,abortable:n!=null},r,s)})}on(e,r){const i=new MessageChannel;function n(s){r(s.data)}return this._port.postMessage({type:Ia.ON,eventType:e,port:i.port2},[i.port2]),i.port1.addEventListener("message",n),i.port1.start(),{remove(){i.port1.postMessage({type:Ia.CLOSE}),i.port1.close(),i.port1.removeEventListener("message",n)}}}jobAdded(){this._processWork()}openPort(){const e=new MessageChannel;return this._post({type:fde,port:e.port2}),e.port1}_processWork(){if(this._outJobs.size>=hYe)return;const e=this._getNextJob();if(!e)return;const{methodName:r,data:i,invokeOptions:n,deferred:s}=e;this.invoke(r,i,n).then(o=>s.resolve(o)).catch(o=>s.reject(o))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(e=>{$i(e.abortHandle),e.reject(Vr(`Worker closing, aborting job calling '${e.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=this._client=this._schedule=null}_onMessage(e){v(this._schedule)?this._schedule(()=>this._processMessage(e)):this._processMessage(e)}_processMessage(e){const r=XL(e);if(r)switch(r.type){case cM:this._onResponseMessage(r);break;case pde:this._invokeQueue.push(r);break;case dde:this._onAbortMessage(r);break;case hde:this._onCloseMessage();break;case fde:this._onOpenPortMessage(r);break;case uYe:this._onOnMessage(r)}}_onAbortMessage(e){const r=this._inJobs,i=e.jobId,n=r.get(i);this._invokeQueue.push(e),n&&(n.controller&&n.controller.abort(),r.delete(i))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&TC.clients.get(this)===e&&e.destroy(),TC.clients.delete(this),e&&e.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:r,jobId:i,data:n,abortable:s}=e,o=s?new AbortController:null,a=this._inJobs;let l,c=this._client,h=c[r];try{if(!h&&r&&r.includes(".")){const p=r.split(".");for(let f=0;f<p.length-1;f++)c=c[p[f]],h=c[p[f+1]]}if(typeof h!="function")throw new TypeError(`${r} is not a function`);l=h.call(c,n,{client:this,signal:o?o.signal:null})}catch(p){return void this._post({type:cM,jobId:i,error:WL(p)})}Ju(l)?(a.set(i,{controller:o,promise:l}),l.then(p=>{a.has(i)&&(a.delete(i),this._post({type:cM,jobId:i},p))},p=>{a.has(i)&&(a.delete(i),ps(p)||this._post({type:cM,jobId:i,error:WL(p||{message:`Error encountered at method ${r}`})}))})):this._post({type:cM,jobId:i},l)}_onOpenPortMessage(e){new TC(e.port,{client:this._client},()=>null)}_onOnMessage(e){const{port:r}=e,i=this._client.on(e.eventType,s=>{r.postMessage(s)}),n=cN(e.port,"message",s=>{var o;((o=XL(s))==null?void 0:o.type)===Ia.CLOSE&&(n.remove(),i.remove(),r.close())})}_onResponseMessage(e){const{jobId:r,error:i,data:n}=e,s=this._outJobs;if(!s.has(r))return;const o=s.get(r);s.delete(r),this._processWork(),$i(o.abortHandle),i?o.reject(H.fromJSON(JSON.parse(i))):o.resolve(n)}_post(e,r,i){return ese(this._port,e,r,i)}};rw.kernelInfo={revision:VCe,version:Gne,buildDate:zCe},rw.clients=new Map;let pYe=class{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new az}destroy(){this.close()}get closed(){return!this._clients||!this._clients.length}open(e,r){return new Promise((i,n)=>{let s=!0;const o=a=>{lr(r.signal),s&&(s=!1,a())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let a=0;a<e.length;++a){const l=e[a];Ju(l)?this._clientPromises[a]=l.then(c=>(this._clients[a]=new rw(c,r,()=>this._ongoingJobsQueue.pop()??null),o(i),this._clients[a]),()=>(o(n),null)):(this._clients[a]=new rw(l,r,()=>this._ongoingJobsQueue.pop()??null),this._clientPromises[a]=Promise.resolve(this._clients[a]),o(i))}})}broadcast(e,r,i){const n=new Array(this._clientPromises.length);for(let s=0;s<this._clientPromises.length;++s){const o=this._clientPromises[s];n[s]=o.then(a=>a==null?void 0:a.invoke(e,r,i))}return n}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.deferred.reject(Vr(`Worker closing, aborting job calling '${e.methodName}'`));for(const r of this._clientPromises)r.then(i=>i==null?void 0:i.close());this._clients.length=0,this._clientPromises.length=0}invoke(e,r,i){let n;Array.isArray(i)?(re.getLogger("esri.core.workers.Connection").warn("invoke()","The transferList parameter is deprecated, use the options object instead"),n={transferList:i}):n=i;const s=__();this._ongoingJobsQueue.push({methodName:e,data:r,invokeOptions:n,deferred:s});for(let o=0;o<this._clientPromises.length;o++){const a=this._clients[o];a?a.jobAdded():this._clientPromises[o].then(l=>l==null?void 0:l.jobAdded())}return s.promise}on(e,r){return Promise.all(this._clientPromises).then(()=>oO(this._clients.map(i=>i.on(e,r))))}openPorts(){return new Promise(e=>{const r=new Array(this._clientPromises.length);let i=r.length;for(let n=0;n<this._clientPromises.length;++n)this._clientPromises[n].then(s=>{s&&(r[n]=s.openPort()),--i==0&&e(r)})})}get test(){return{numClients:this._clients.length}}};const fYe=re.getLogger("esri.assets");function mYe(t,e){return ei(si(t),e)}function si(t){if(!ri.assetsPath)throw fYe.errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new H("assets:path-not-set","config.assetsPath is not set");return Yb(ri.assetsPath,t)}const gAe=re.getLogger("esri.intl.substitute");function bg(t,e,r={}){const{format:i={}}=r;return ty(t,n=>gYe(n,e,i))}function gYe(t,e,r){let i,n;const s=t.indexOf(":");if(s===-1?i=t.trim():(i=t.slice(0,s).trim(),n=t.slice(s+1).trim()),!i)return"";const o=nN(i,e);if(o==null)return"";const a=(n?r==null?void 0:r[n]:null)??(r==null?void 0:r[i]);return a?yYe(o,a):n?_Ye(o,n):tse(o)}function yYe(t,e){switch(e.type){case"date":return ny(t,e.intlOptions);case"number":return sy(t,e.intlOptions);default:return gAe.warn("missing format descriptor for key {key}"),tse(t)}}function _Ye(t,e){switch(e.toLowerCase()){case"dateformat":return ny(t);case"numberformat":return sy(t);default:return gAe.warn(`inline format is unsupported since 4.12: ${e}`),/^(dateformat|datestring)/i.test(e)?ny(t):/^numberformat/i.test(e)?sy(t):tse(t)}}function tse(t){switch(typeof t){case"string":return t;case"number":return sy(t);case"boolean":return""+t;default:return t instanceof Date?ny(t):""}}const mde=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,vYe={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function gde(t){return vYe[t]??!1}const zP=[],SR=new Map;function yde(t){for(const e of SR.keys())_Ae(t.pattern,e)&&SR.delete(e)}function bYe(t){return zP.includes(t)||(yde(t),zP.unshift(t)),{remove(){const e=zP.indexOf(t);e>-1&&(zP.splice(e,1),yde(t))}}}async function yAe(t){const e=mp();SR.has(t)||SR.set(t,xYe(t,e));const r=SR.get(t);return r&&await TYe.add(r),r}function wYe(t){if(!mde.test(t))return null;const e=mde.exec(t);if(e===null)return null;const[,r,i]=e,n=r+(i?"-"+i.toUpperCase():"");return gde(n)?n:gde(r)?r:null}async function xYe(t,e){const r=[];for(const i of zP)if(_Ae(i.pattern,t))try{return await i.fetchMessageBundle(t,e)}catch(n){r.push(n)}throw r.length?new H("intl:message-bundle-error",`Errors occurred while loading "${t}"`,{errors:r}):new H("intl:no-message-bundle-loader",`No loader found for message bundle "${t}"`)}function _Ae(t,e){return typeof t=="string"?e.startsWith(t):t.test(e)}dne(()=>{SR.clear()});const TYe=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(t){return this._increase(),t.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=__())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}};async function SYe(t,e,r,i){const n=e.exec(r);if(!n)throw new H("esri-intl:invalid-bundle",`Bundle id "${r}" is not compatible with the pattern "${e}"`);const s=n[1]?`${n[1]}/`:"",o=n[2],a=wYe(i),l=`${s}${o}.json`,c=a?`${s}${o}_${a}.json`:l;let h;try{h=await _de(t(c))}catch(p){if(c===l)throw new H("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:p});try{h=await _de(t(l))}catch(f){throw new H("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:f})}}return h}async function _de(t){if(v(vde.fetchBundleAsset))return vde.fetchBundleAsset(t);const e=await ei(t,{responseType:"text"});return JSON.parse(e.data)}let EYe=class{constructor({base:e="",pattern:r,location:i=new URL(window.location.href)}){let n;n=typeof i=="string"?s=>new URL(s,new URL(i,window.location.href)).href:i instanceof URL?s=>new URL(s,i).href:i,this.pattern=typeof r=="string"?new RegExp(`^${r}`):r,this.getAssetUrl=n,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)/)?(.*)$`)}fetchMessageBundle(e,r){return SYe(this.getAssetUrl,this.matcher,e,r)}};function CYe(t){return new EYe(t)}const vde={};bYe(CYe({pattern:"esri/",location:si}));const AYe={};function RYe(t){const e={async:t.async,isDebug:t.isDebug,locale:t.locale,baseUrl:t.baseUrl,has:{...t.has},map:{...t.map},packages:t.packages&&t.packages.concat()||[],paths:{...t.paths}};return t.hasOwnProperty("async")||(e.async=!0),t.hasOwnProperty("isDebug")||(e.isDebug=!1),t.baseUrl||(e.baseUrl=AYe.baseUrl),e}let OYe=class{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(r=>{this[r]=(...i)=>e[r](...i)})}},C6=class{constructor(){this._dispatcher=new OYe,this._workerPostMessage({type:Ia.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){aO(()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))})}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,r,i){this._dispatcher.addEventListener(e,r,i)}removeEventListener(e,r,i){this._dispatcher.removeEventListener(e,r,i)}_workerPostMessage(e){aO(()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))})}async _workerMessageHandler(e){const r=XL(e);if(r&&r.type===Ia.OPEN){const{modulePath:i,jobId:n}=r;let s=await rw.loadWorker(i);s||(s=await Q(()=>import(i),[]));const o=rw.connect(s);this._workerPostMessage({type:Ia.OPENED,jobId:n,data:o})}}};const XZ=re.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:MYe}=Ia,PYe='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,version:r}=configuration.kernelInfo,{revision:t,version:n}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS API for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\\nModules version: ${r}\\nAssets version: ${n}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let n;function t(e){const o=n.connect(e);self.postMessage({type:2,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const i=outgoing.get(r);outgoing.delete(r),o.error?i.reject(JSON.parse(o.error)):i.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let FF,kF;const bde="Failed to create Worker. Fallback to execute module in main thread";async function IYe(){if(!ue("esri-workers")||(ue("mozilla"),0))return wde(new C6);if(!FF&&!kF)try{const e=PYe.split('"{CONFIGURATION}"').join(`'${$Ye()}'`);FF=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){kF=e||{}}let t;if(FF)try{t=new Worker(FF,{name:"esri-worker-"+LYe++})}catch{XZ.warn(bde,kF),t=new C6}else XZ.warn(bde,kF),t=new C6;return wde(t)}async function wde(t){return new Promise(e=>{function r(n){const s=XL(n);s&&s.type===MYe&&(t.removeEventListener("message",r),t.removeEventListener("error",i),e(t))}function i(n){n.preventDefault(),t.removeEventListener("message",r),t.removeEventListener("error",i),XZ.warn("Failed to create Worker. Fallback to execute module in main thread",n),(t=new C6).addEventListener("message",r),t.addEventListener("error",i)}t.addEventListener("message",r),t.addEventListener("error",i)})}function $Ye(){let t;if(ri.default!=null){const n={...ri};delete n.default,t=JSON.parse(JSON.stringify(n))}else t=JSON.parse(JSON.stringify(ri));t.assetsPath=Fc(t.assetsPath),t.defaultAssetsPath=t.defaultAssetsPath?Fc(t.defaultAssetsPath):void 0,t.request.interceptors=[],t.log.interceptors=[],t.locale=mp(),t.has={"esri-csp-restrictions":ue("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":ue("esri-2d-update-debug"),"featurelayer-pbf":ue("featurelayer-pbf"),"featurelayer-simplify-thresholds":ue("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":ue("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":ue("featurelayer-simplify-mobile-factor"),"esri-atomics":ue("esri-atomics"),"esri-shared-array-buffer":ue("esri-shared-array-buffer"),"esri-tiles-debug":ue("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":ue("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":ue("feature-polyline-generalization-factor"),"host-webworker":1,"polylabel-placement-enabled":ue("polylabel-placement-enabled")},t.workers.loaderUrl&&(t.workers.loaderUrl=Fc(t.workers.loaderUrl)),t.workers.workerPath?t.workers.workerPath=Fc(t.workers.workerPath):t.workers.workerPath=Fc(si("esri/core/workers/RemoteClient.js")),t.workers.useDynamicImport=!1;const e=ri.workers.loaderConfig,r=RYe({baseUrl:e==null?void 0:e.baseUrl,locale:mp(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...e==null?void 0:e.has},map:{...e==null?void 0:e.map},paths:{...e==null?void 0:e.paths},packages:(e==null?void 0:e.packages)||[]});return JSON.stringify({esriConfig:t,loaderConfig:r,kernelInfo:{version:Gne,buildDate:zCe,revision:VCe}})}let LYe=0;const{ABORT:xde,INVOKE:DYe,OPEN:NYe,OPENED:FYe,RESPONSE:uM}=Ia;let kYe=class vAe{static async create(e){const r=await IYe();return new vAe(r,e)}constructor(e,r){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=r,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",i=>{i.preventDefault(),re.getLogger("esri.core.workers.WorkerOwner").error(i)})}terminate(){this.worker.terminate()}async open(e,r={}){const{signal:i}=r,n=mAe();return new Promise((s,o)=>{const a={resolve:s,reject:o,abortHandle:E9(i,()=>{this._outJobs.delete(n),this._post({type:xde,jobId:n})})};this._outJobs.set(n,a),this._post({type:NYe,jobId:n,modulePath:e})})}_onMessage(e){const r=XL(e);if(r)switch(r.type){case FYe:this._onOpenedMessage(r);break;case uM:this._onResponseMessage(r);break;case xde:this._onAbortMessage(r);break;case DYe:this._onInvokeMessage(r)}}_onAbortMessage(e){const r=this._inJobs,i=e.jobId,n=r.get(i);n&&(n.controller&&n.controller.abort(),r.delete(i))}_onInvokeMessage(e){const{methodName:r,jobId:i,data:n,abortable:s}=e,o=s?new AbortController:null,a=this._inJobs,l=gXe[r];let c;try{if(typeof l!="function")throw new TypeError(`${r} is not a function`);c=l.call(null,n,{signal:o?o.signal:null})}catch(h){return void this._post({type:uM,jobId:i,error:WL(h)})}Ju(c)?(a.set(i,{controller:o,promise:c}),c.then(h=>{a.has(i)&&(a.delete(i),this._post({type:uM,jobId:i},h))},h=>{a.has(i)&&(a.delete(i),h||(h={message:"Error encountered at method"+r}),ps(h)||this._post({type:uM,jobId:i,error:WL(h||{message:`Error encountered at method ${r}`})}))})):this._post({type:uM,jobId:i},c)}_onOpenedMessage(e){const{jobId:r,data:i}=e,n=this._outJobs.get(r);n&&(this._outJobs.delete(r),$i(n.abortHandle),n.resolve(i))}_onResponseMessage(e){const{jobId:r,error:i,data:n}=e,s=this._outJobs.get(r);s&&(this._outJobs.delete(r),$i(s.abortHandle),i?s.reject(H.fromJSON(JSON.parse(i))):s.resolve(n))}_post(e,r,i){return ese(this.worker,e,r,i)}},dS=ue("esri-workers-debug")?1:ue("esri-mobile")?Math.min(navigator.hardwareConcurrency-1,3):ue("host-browser")?navigator.hardwareConcurrency-1:0;dS||(dS=ue("safari")&&ue("mac")?7:2);let Tde=0;const A6=[];function bAe(){xAe()}async function UF(t,e){const r=new pYe;return await r.open(t,e),r}async function wAe(t,e={}){if(typeof t!="string")throw new H("workers:undefined-module","modulePath is missing");let r=e.strategy||"distributed";if(ue("host-webworker")&&!ue("esri-workers")&&(r="local"),r==="local"){let i=await rw.loadWorker(t);i||(i=await Q(()=>import(t),[])),lr(e.signal);const n=e.client||i;return UF([rw.connect(i)],{...e,client:n})}if(await xAe(),lr(e.signal),r==="dedicated"){const i=Tde++%dS;return UF([await A6[i].open(t,e)],e)}if(e.maxNumWorkers&&e.maxNumWorkers>0){const i=Math.min(e.maxNumWorkers,dS);if(i<dS){const n=new Array(i);for(let s=0;s<i;++s){const o=Tde++%dS;n[s]=A6[o].open(t,e)}return UF(n,e)}}return UF(A6.map(i=>i.open(t,e)),e)}let zF=null;async function xAe(){if(zF)return zF;new AbortController;const t=[];for(let e=0;e<dS;e++){const r=kYe.create(e).then(i=>(A6[e]=i,i));t.push(r)}return zF=Promise.all(t),zF}function po(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function _y(t,e,r,i,n,s,o,a,l,c,h,p,f,m,g,_,b){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=s,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t[9]=h,t[10]=p,t[11]=f,t[12]=m,t[13]=g,t[14]=_,t[15]=b,t}function Rp(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Wu(t,e){if(t===e){const r=e[1],i=e[2],n=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=s,t[11]=e[14],t[12]=n,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function _3(t,e){return ya(t,e)||Rp(t),t}function ya(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],m=e[11],g=e[12],_=e[13],b=e[14],w=e[15],x=r*a-i*o,T=r*l-n*o,E=r*c-s*o,C=i*l-n*a,A=i*c-s*a,I=n*c-s*l,M=h*_-p*g,D=h*b-f*g,U=h*w-m*g,z=p*b-f*_,B=p*w-m*_,ee=f*w-m*b;let te=x*ee-T*B+E*z+C*U-A*D+I*M;return te?(te=1/te,t[0]=(a*ee-l*B+c*z)*te,t[1]=(n*B-i*ee-s*z)*te,t[2]=(_*I-b*A+w*C)*te,t[3]=(f*A-p*I-m*C)*te,t[4]=(l*U-o*ee-c*D)*te,t[5]=(r*ee-n*U+s*D)*te,t[6]=(b*E-g*I-w*T)*te,t[7]=(h*I-f*E+m*T)*te,t[8]=(o*B-a*U+c*M)*te,t[9]=(i*U-r*B-s*M)*te,t[10]=(g*A-_*E+w*x)*te,t[11]=(p*E-h*A-m*x)*te,t[12]=(a*D-o*z-l*M)*te,t[13]=(r*z-i*D+n*M)*te,t[14]=(_*T-g*C-b*x)*te,t[15]=(h*C-p*T+f*x)*te,t):null}function UYe(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],m=e[11],g=e[12],_=e[13],b=e[14],w=e[15];return t[0]=a*(f*w-m*b)-p*(l*w-c*b)+_*(l*m-c*f),t[1]=-(i*(f*w-m*b)-p*(n*w-s*b)+_*(n*m-s*f)),t[2]=i*(l*w-c*b)-a*(n*w-s*b)+_*(n*c-s*l),t[3]=-(i*(l*m-c*f)-a*(n*m-s*f)+p*(n*c-s*l)),t[4]=-(o*(f*w-m*b)-h*(l*w-c*b)+g*(l*m-c*f)),t[5]=r*(f*w-m*b)-h*(n*w-s*b)+g*(n*m-s*f),t[6]=-(r*(l*w-c*b)-o*(n*w-s*b)+g*(n*c-s*l)),t[7]=r*(l*m-c*f)-o*(n*m-s*f)+h*(n*c-s*l),t[8]=o*(p*w-m*_)-h*(a*w-c*_)+g*(a*m-c*p),t[9]=-(r*(p*w-m*_)-h*(i*w-s*_)+g*(i*m-s*p)),t[10]=r*(a*w-c*_)-o*(i*w-s*_)+g*(i*c-s*a),t[11]=-(r*(a*m-c*p)-o*(i*m-s*p)+h*(i*c-s*a)),t[12]=-(o*(p*b-f*_)-h*(a*b-l*_)+g*(a*f-l*p)),t[13]=r*(p*b-f*_)-h*(i*b-n*_)+g*(i*f-n*p),t[14]=-(r*(a*b-l*_)-o*(i*b-n*_)+g*(i*l-n*a)),t[15]=r*(a*f-l*p)-o*(i*f-n*p)+h*(i*l-n*a),t}function zYe(t){const e=t[0],r=t[1],i=t[2],n=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=t[9],p=t[10],f=t[11],m=t[12],g=t[13],_=t[14],b=t[15];return(e*o-r*s)*(p*b-f*_)-(e*a-i*s)*(h*b-f*g)+(e*l-n*s)*(h*_-p*g)+(r*a-i*o)*(c*b-f*m)-(r*l-n*o)*(c*_-p*m)+(i*l-n*a)*(c*g-h*m)}function Mn(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],p=e[8],f=e[9],m=e[10],g=e[11],_=e[12],b=e[13],w=e[14],x=e[15];let T=r[0],E=r[1],C=r[2],A=r[3];return t[0]=T*i+E*a+C*p+A*_,t[1]=T*n+E*l+C*f+A*b,t[2]=T*s+E*c+C*m+A*w,t[3]=T*o+E*h+C*g+A*x,T=r[4],E=r[5],C=r[6],A=r[7],t[4]=T*i+E*a+C*p+A*_,t[5]=T*n+E*l+C*f+A*b,t[6]=T*s+E*c+C*m+A*w,t[7]=T*o+E*h+C*g+A*x,T=r[8],E=r[9],C=r[10],A=r[11],t[8]=T*i+E*a+C*p+A*_,t[9]=T*n+E*l+C*f+A*b,t[10]=T*s+E*c+C*m+A*w,t[11]=T*o+E*h+C*g+A*x,T=r[12],E=r[13],C=r[14],A=r[15],t[12]=T*i+E*a+C*p+A*_,t[13]=T*n+E*l+C*f+A*b,t[14]=T*s+E*c+C*m+A*w,t[15]=T*o+E*h+C*g+A*x,t}function Hc(t,e,r){const i=r[0],n=r[1],s=r[2];if(e===t)t[12]=e[0]*i+e[4]*n+e[8]*s+e[12],t[13]=e[1]*i+e[5]*n+e[9]*s+e[13],t[14]=e[2]*i+e[6]*n+e[10]*s+e[14],t[15]=e[3]*i+e[7]*n+e[11]*s+e[15];else{const o=e[0],a=e[1],l=e[2],c=e[3],h=e[4],p=e[5],f=e[6],m=e[7],g=e[8],_=e[9],b=e[10],w=e[11];t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=h,t[5]=p,t[6]=f,t[7]=m,t[8]=g,t[9]=_,t[10]=b,t[11]=w,t[12]=o*i+h*n+g*s+e[12],t[13]=a*i+p*n+_*s+e[13],t[14]=l*i+f*n+b*s+e[14],t[15]=c*i+m*n+w*s+e[15]}return t}function J9(t,e,r){const i=r[0],n=r[1],s=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Du(t,e,r,i){let n,s,o,a,l,c,h,p,f,m,g,_,b,w,x,T,E,C,A,I,M,D,U,z,B=i[0],ee=i[1],te=i[2],K=Math.sqrt(B*B+ee*ee+te*te);return K<yl()?null:(K=1/K,B*=K,ee*=K,te*=K,n=Math.sin(r),s=Math.cos(r),o=1-s,a=e[0],l=e[1],c=e[2],h=e[3],p=e[4],f=e[5],m=e[6],g=e[7],_=e[8],b=e[9],w=e[10],x=e[11],T=B*B*o+s,E=ee*B*o+te*n,C=te*B*o-ee*n,A=B*ee*o-te*n,I=ee*ee*o+s,M=te*ee*o+B*n,D=B*te*o+ee*n,U=ee*te*o-B*n,z=te*te*o+s,t[0]=a*T+p*E+_*C,t[1]=l*T+f*E+b*C,t[2]=c*T+m*E+w*C,t[3]=h*T+g*E+x*C,t[4]=a*A+p*I+_*M,t[5]=l*A+f*I+b*M,t[6]=c*A+m*I+w*M,t[7]=h*A+g*I+x*M,t[8]=a*D+p*U+_*z,t[9]=l*D+f*U+b*z,t[10]=c*D+m*U+w*z,t[11]=h*D+g*U+x*z,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function xO(t,e,r){const i=Math.sin(r),n=Math.cos(r),s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=e[9],p=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*n+c*i,t[5]=o*n+h*i,t[6]=a*n+p*i,t[7]=l*n+f*i,t[8]=c*n-s*i,t[9]=h*n-o*i,t[10]=p*n-a*i,t[11]=f*n-l*i,t}function K9(t,e,r){const i=Math.sin(r),n=Math.cos(r),s=e[0],o=e[1],a=e[2],l=e[3],c=e[8],h=e[9],p=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n-c*i,t[1]=o*n-h*i,t[2]=a*n-p*i,t[3]=l*n-f*i,t[8]=s*i+c*n,t[9]=o*i+h*n,t[10]=a*i+p*n,t[11]=l*i+f*n,t}function TO(t,e,r){const i=Math.sin(r),n=Math.cos(r),s=e[0],o=e[1],a=e[2],l=e[3],c=e[4],h=e[5],p=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n+c*i,t[1]=o*n+h*i,t[2]=a*n+p*i,t[3]=l*n+f*i,t[4]=c*n-s*i,t[5]=h*n-o*i,t[6]=p*n-a*i,t[7]=f*n-l*i,t}function Q9(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function VYe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function rd(t,e,r){if(e===0)return Rp(t);let i,n,s,o=r[0],a=r[1],l=r[2],c=Math.sqrt(o*o+a*a+l*l);return c<yl()?null:(c=1/c,o*=c,a*=c,l*=c,i=Math.sin(e),n=Math.cos(e),s=1-n,t[0]=o*o*s+n,t[1]=a*o*s+l*i,t[2]=l*o*s-a*i,t[3]=0,t[4]=o*a*s-l*i,t[5]=a*a*s+n,t[6]=l*a*s+o*i,t[7]=0,t[8]=o*l*s+a*i,t[9]=a*l*s-o*i,t[10]=l*l*s+n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function TAe(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function BYe(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function SAe(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function EAe(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=i+i,l=n+n,c=s+s,h=i*a,p=i*l,f=i*c,m=n*l,g=n*c,_=s*c,b=o*a,w=o*l,x=o*c;return t[0]=1-(m+_),t[1]=p+x,t[2]=f-w,t[3]=0,t[4]=p-x,t[5]=1-(h+_),t[6]=g+b,t[7]=0,t[8]=f+w,t[9]=g-b,t[10]=1-(h+m),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function jYe(t,e){const r=GYe,i=-e[0],n=-e[1],s=-e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],p=i*i+n*n+s*s+o*o;return p>0?(r[0]=2*(a*o+h*i+l*s-c*n)/p,r[1]=2*(l*o+h*n+c*i-a*s)/p,r[2]=2*(c*o+h*s+a*n-l*i)/p):(r[0]=2*(a*o+h*i+l*s-c*n),r[1]=2*(l*o+h*n+c*i-a*s),r[2]=2*(c*o+h*s+a*n-l*i)),EAe(t,e,r),t}const GYe=P();function HYe(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function CAe(t,e){const r=e[0],i=e[1],n=e[2],s=e[4],o=e[5],a=e[6],l=e[8],c=e[9],h=e[10];return t[0]=Math.sqrt(r*r+i*i+n*n),t[1]=Math.sqrt(s*s+o*o+a*a),t[2]=Math.sqrt(l*l+c*c+h*h),t}function qYe(t,e){const r=e[0]+e[5]+e[10];let i=0;return r>0?(i=2*Math.sqrt(r+1),t[3]=.25*i,t[0]=(e[6]-e[9])/i,t[1]=(e[8]-e[2])/i,t[2]=(e[1]-e[4])/i):e[0]>e[5]&&e[0]>e[10]?(i=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/i,t[0]=.25*i,t[1]=(e[1]+e[4])/i,t[2]=(e[8]+e[2])/i):e[5]>e[10]?(i=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/i,t[0]=(e[1]+e[4])/i,t[1]=.25*i,t[2]=(e[6]+e[9])/i):(i=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/i,t[0]=(e[8]+e[2])/i,t[1]=(e[6]+e[9])/i,t[2]=.25*i),t}function WYe(t,e,r,i){const n=e[0],s=e[1],o=e[2],a=e[3],l=n+n,c=s+s,h=o+o,p=n*l,f=n*c,m=n*h,g=s*c,_=s*h,b=o*h,w=a*l,x=a*c,T=a*h,E=i[0],C=i[1],A=i[2];return t[0]=(1-(g+b))*E,t[1]=(f+T)*E,t[2]=(m-x)*E,t[3]=0,t[4]=(f-T)*C,t[5]=(1-(p+b))*C,t[6]=(_+w)*C,t[7]=0,t[8]=(m+x)*A,t[9]=(_-w)*A,t[10]=(1-(p+g))*A,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function XYe(t,e,r,i,n){const s=e[0],o=e[1],a=e[2],l=e[3],c=s+s,h=o+o,p=a+a,f=s*c,m=s*h,g=s*p,_=o*h,b=o*p,w=a*p,x=l*c,T=l*h,E=l*p,C=i[0],A=i[1],I=i[2],M=n[0],D=n[1],U=n[2],z=(1-(_+w))*C,B=(m+E)*C,ee=(g-T)*C,te=(m-E)*A,K=(1-(f+w))*A,W=(b+x)*A,N=(g+T)*I,L=(b-x)*I,F=(1-(f+_))*I;return t[0]=z,t[1]=B,t[2]=ee,t[3]=0,t[4]=te,t[5]=K,t[6]=W,t[7]=0,t[8]=N,t[9]=L,t[10]=F,t[11]=0,t[12]=r[0]+M-(z*M+te*D+N*U),t[13]=r[1]+D-(B*M+K*D+L*U),t[14]=r[2]+U-(ee*M+W*D+F*U),t[15]=1,t}function YYe(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=r+r,a=i+i,l=n+n,c=r*o,h=i*o,p=i*a,f=n*o,m=n*a,g=n*l,_=s*o,b=s*a,w=s*l;return t[0]=1-p-g,t[1]=h+w,t[2]=f-b,t[3]=0,t[4]=h-w,t[5]=1-c-g,t[6]=m+_,t[7]=0,t[8]=f+b,t[9]=m-_,t[10]=1-c-p,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function AAe(t,e,r,i,n,s,o){const a=1/(r-e),l=1/(n-i),c=1/(s-o);return t[0]=2*s*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*s*l,t[6]=0,t[7]=0,t[8]=(r+e)*a,t[9]=(n+i)*l,t[10]=(o+s)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*c,t[15]=0,t}function ZYe(t,e,r,i,n){const s=1/Math.tan(e/2);let o;return t[0]=s/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,n!=null&&n!==1/0?(o=1/(i-n),t[10]=(n+i)*o,t[14]=2*n*i*o):(t[10]=-1,t[14]=-2*i),t}function JYe(t,e,r,i){const n=Math.tan(e.upDegrees*Math.PI/180),s=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(n+s);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(o-a)*l*.5,t[9]=(n-s)*c*.5,t[10]=i/(r-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*r/(r-i),t[15]=0,t}function RAe(t,e,r,i,n,s,o){const a=1/(e-r),l=1/(i-n),c=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+r)*a,t[13]=(n+i)*l,t[14]=(o+s)*c,t[15]=1,t}function eB(t,e,r,i){let n,s,o,a,l,c,h,p,f,m;const g=e[0],_=e[1],b=e[2],w=i[0],x=i[1],T=i[2],E=r[0],C=r[1],A=r[2],I=yl();return Math.abs(g-E)<I&&Math.abs(_-C)<I&&Math.abs(b-A)<I?Rp(t):(h=g-E,p=_-C,f=b-A,m=1/Math.sqrt(h*h+p*p+f*f),h*=m,p*=m,f*=m,n=x*f-T*p,s=T*h-w*f,o=w*p-x*h,m=Math.sqrt(n*n+s*s+o*o),m?(m=1/m,n*=m,s*=m,o*=m):(n=0,s=0,o=0),a=p*o-f*s,l=f*n-h*o,c=h*s-p*n,m=Math.sqrt(a*a+l*l+c*c),m?(m=1/m,a*=m,l*=m,c*=m):(a=0,l=0,c=0),t[0]=n,t[1]=a,t[2]=h,t[3]=0,t[4]=s,t[5]=l,t[6]=p,t[7]=0,t[8]=o,t[9]=c,t[10]=f,t[11]=0,t[12]=-(n*g+s*_+o*b),t[13]=-(a*g+l*_+c*b),t[14]=-(h*g+p*_+f*b),t[15]=1,t)}function OAe(t,e,r,i){const n=e[0],s=e[1],o=e[2],a=i[0],l=i[1],c=i[2];let h=n-r[0],p=s-r[1],f=o-r[2],m=h*h+p*p+f*f;m>0&&(m=1/Math.sqrt(m),h*=m,p*=m,f*=m);let g=l*f-c*p,_=c*h-a*f,b=a*p-l*h;return m=g*g+_*_+b*b,m>0&&(m=1/Math.sqrt(m),g*=m,_*=m,b*=m),t[0]=g,t[1]=_,t[2]=b,t[3]=0,t[4]=p*b-f*_,t[5]=f*g-h*b,t[6]=h*_-p*g,t[7]=0,t[8]=h,t[9]=p,t[10]=f,t[11]=0,t[12]=n,t[13]=s,t[14]=o,t[15]=1,t}function KYe(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function QYe(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2+t[9]**2+t[10]**2+t[11]**2+t[12]**2+t[13]**2+t[14]**2+t[15]**2)}function eZe(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function MAe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function tZe(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function rZe(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t[9]=e[9]+r[9]*i,t[10]=e[10]+r[10]*i,t[11]=e[11]+r[11]*i,t[12]=e[12]+r[12]*i,t[13]=e[13]+r[13]*i,t[14]=e[14]+r[14]*i,t[15]=e[15]+r[15]*i,t}function PAe(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function rse(t,e){if(t===e)return!0;const r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=t[9],f=t[10],m=t[11],g=t[12],_=t[13],b=t[14],w=t[15],x=e[0],T=e[1],E=e[2],C=e[3],A=e[4],I=e[5],M=e[6],D=e[7],U=e[8],z=e[9],B=e[10],ee=e[11],te=e[12],K=e[13],W=e[14],N=e[15],L=yl();return Math.abs(r-x)<=L*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(i-T)<=L*Math.max(1,Math.abs(i),Math.abs(T))&&Math.abs(n-E)<=L*Math.max(1,Math.abs(n),Math.abs(E))&&Math.abs(s-C)<=L*Math.max(1,Math.abs(s),Math.abs(C))&&Math.abs(o-A)<=L*Math.max(1,Math.abs(o),Math.abs(A))&&Math.abs(a-I)<=L*Math.max(1,Math.abs(a),Math.abs(I))&&Math.abs(l-M)<=L*Math.max(1,Math.abs(l),Math.abs(M))&&Math.abs(c-D)<=L*Math.max(1,Math.abs(c),Math.abs(D))&&Math.abs(h-U)<=L*Math.max(1,Math.abs(h),Math.abs(U))&&Math.abs(p-z)<=L*Math.max(1,Math.abs(p),Math.abs(z))&&Math.abs(f-B)<=L*Math.max(1,Math.abs(f),Math.abs(B))&&Math.abs(m-ee)<=L*Math.max(1,Math.abs(m),Math.abs(ee))&&Math.abs(g-te)<=L*Math.max(1,Math.abs(g),Math.abs(te))&&Math.abs(_-K)<=L*Math.max(1,Math.abs(_),Math.abs(K))&&Math.abs(b-W)<=L*Math.max(1,Math.abs(b),Math.abs(W))&&Math.abs(w-N)<=L*Math.max(1,Math.abs(w),Math.abs(N))}function ise(t){const e=yl(),r=t[0],i=t[1],n=t[2],s=t[4],o=t[5],a=t[6],l=t[8],c=t[9],h=t[10];return Math.abs(1-(r*r+s*s+l*l))<=e&&Math.abs(1-(i*i+o*o+c*c))<=e&&Math.abs(1-(n*n+a*a+h*h))<=e}function tB(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[8]===0&&t[9]===0&&t[10]===1}const iZe=Mn,nZe=MAe;Object.freeze(Object.defineProperty({__proto__:null,add:eZe,adjoint:UYe,copy:po,determinant:zYe,equals:rse,exactEquals:PAe,frob:QYe,fromQuat:YYe,fromQuat2:jYe,fromRotation:rd,fromRotationTranslation:EAe,fromRotationTranslationScale:WYe,fromRotationTranslationScaleOrigin:XYe,fromScaling:VYe,fromTranslation:Q9,fromXRotation:TAe,fromYRotation:BYe,fromZRotation:SAe,frustum:AAe,getRotation:qYe,getScaling:CAe,getTranslation:HYe,hasIdentityRotation:tB,identity:Rp,invert:ya,invertOrIdentity:_3,isOrthoNormal:ise,lookAt:eB,mul:iZe,multiply:Mn,multiplyScalar:tZe,multiplyScalarAndAdd:rZe,ortho:RAe,perspective:ZYe,perspectiveFromFieldOfView:JYe,rotate:Du,rotateX:xO,rotateY:K9,rotateZ:TO,scale:J9,set:_y,str:KYe,sub:nZe,subtract:MAe,targetTo:OAe,translate:Hc,transpose:Wu},Symbol.toStringTag,{value:"Module"}));let Wj,ae=null;function IAe(){return!!ae}function sZe(){return!!ue("esri-wasm")}function $Ae(){return Wj||(Wj=Q(()=>import("./pe-wasm-815c1904.js"),[]).then(t=>t.p).then(({default:t})=>t({locateFile:e=>si(`esri/geometry/support/${e}`)})).then(t=>{DAe(t)}),Wj)}var YZ,ns,ZZ;(function(t){function e(s,o,a){ae.ensureCache.prepare();const l=GT(a),c=a===l,h=ae.ensureFloat64(l),p=ae._pe_geog_to_proj(ae.getPointer(s),o,h);return p&&H1(a,o,h,c),p}function r(s,o,a,l){switch(l){case ns.PE_TRANSFORM_P_TO_G:return i(s,o,a);case ns.PE_TRANSFORM_G_TO_P:return e(s,o,a)}return 0}function i(s,o,a){return n(s,o,a,0)}function n(s,o,a,l){ae.ensureCache.prepare();const c=GT(a),h=a===c,p=ae.ensureFloat64(c),f=ae._pe_proj_to_geog_center(ae.getPointer(s),o,p,l);return f&&H1(a,o,p,h),f}t.geogToProj=e,t.projGeog=r,t.projToGeog=i,t.projToGeogCenter=n})(YZ||(YZ={})),function(t){function e(){t.PE_BUFFER_MAX=ae.PeDefs.prototype.PE_BUFFER_MAX,t.PE_NAME_MAX=ae.PeDefs.prototype.PE_NAME_MAX,t.PE_MGRS_MAX=ae.PeDefs.prototype.PE_MGRS_MAX,t.PE_USNG_MAX=ae.PeDefs.prototype.PE_USNG_MAX,t.PE_DD_MAX=ae.PeDefs.prototype.PE_DD_MAX,t.PE_DDM_MAX=ae.PeDefs.prototype.PE_DDM_MAX,t.PE_DMS_MAX=ae.PeDefs.prototype.PE_DMS_MAX,t.PE_UTM_MAX=ae.PeDefs.prototype.PE_UTM_MAX,t.PE_PARM_MAX=ae.PeDefs.prototype.PE_PARM_MAX,t.PE_TYPE_NONE=ae.PeDefs.prototype.PE_TYPE_NONE,t.PE_TYPE_GEOGCS=ae.PeDefs.prototype.PE_TYPE_GEOGCS,t.PE_TYPE_PROJCS=ae.PeDefs.prototype.PE_TYPE_PROJCS,t.PE_TYPE_GEOGTRAN=ae.PeDefs.prototype.PE_TYPE_GEOGTRAN,t.PE_TYPE_COORDSYS=ae.PeDefs.prototype.PE_TYPE_COORDSYS,t.PE_TYPE_UNIT=ae.PeDefs.prototype.PE_TYPE_UNIT,t.PE_TYPE_LINUNIT=ae.PeDefs.prototype.PE_TYPE_LINUNIT,t.PE_STR_OPTS_NONE=ae.PeDefs.prototype.PE_STR_OPTS_NONE,t.PE_STR_AUTH_NONE=ae.PeDefs.prototype.PE_STR_AUTH_NONE,t.PE_STR_AUTH_TOP=ae.PeDefs.prototype.PE_STR_AUTH_TOP,t.PE_STR_NAME_CANON=ae.PeDefs.prototype.PE_STR_NAME_CANON,t.PE_PARM_X0=ae.PeDefs.prototype.PE_PARM_X0,t.PE_PARM_ND=ae.PeDefs.prototype.PE_PARM_ND,t.PE_TRANSFORM_1_TO_2=ae.PeDefs.prototype.PE_TRANSFORM_1_TO_2,t.PE_TRANSFORM_2_TO_1=ae.PeDefs.prototype.PE_TRANSFORM_2_TO_1,t.PE_TRANSFORM_P_TO_G=ae.PeDefs.prototype.PE_TRANSFORM_P_TO_G,t.PE_TRANSFORM_G_TO_P=ae.PeDefs.prototype.PE_TRANSFORM_G_TO_P,t.PE_HORIZON_RECT=ae.PeDefs.prototype.PE_HORIZON_RECT,t.PE_HORIZON_POLY=ae.PeDefs.prototype.PE_HORIZON_POLY,t.PE_HORIZON_LINE=ae.PeDefs.prototype.PE_HORIZON_LINE,t.PE_HORIZON_DELTA=ae.PeDefs.prototype.PE_HORIZON_DELTA}t.init=e}(ns||(ns={})),function(t){const e={},r={},i=m=>{if(m){const g=m.getType();switch(g){case ns.PE_TYPE_GEOGCS:m=ae.castObject(m,ae.PeGeogcs);break;case ns.PE_TYPE_PROJCS:m=ae.castObject(m,ae.PeProjcs);break;case ns.PE_TYPE_GEOGTRAN:m=ae.castObject(m,ae.PeGeogtran);break;default:g&ns.PE_TYPE_UNIT&&(m=ae.castObject(m,ae.PeUnit))}}return m};function n(){ae.PeFactory.prototype.initialize(null)}function s(m){return o(ns.PE_TYPE_COORDSYS,m)}function o(m,g){let _=null,b=e[m];if(b||(b={},e[m]=b),b.hasOwnProperty(String(g)))_=b[g];else{const w=ae.PeFactory.prototype.factoryByType(m,g);ae.compare(w,ae.NULL)||(_=w,b[g]=_)}return _=i(_),_}function a(m,g){let _=null,b=r[m];if(b||(b={},r[m]=b),b.hasOwnProperty(g))_=b[g];else{const w=ae.PeFactory.prototype.fromString(m,g);ae.compare(w,ae.NULL)||(_=w,b[g]=_)}return _=i(_),_}function l(m){return o(ns.PE_TYPE_GEOGCS,m)}function c(m){return o(ns.PE_TYPE_GEOGTRAN,m)}function h(m){return ae.PeFactory.prototype.getCode(m)}function p(m){return o(ns.PE_TYPE_PROJCS,m)}function f(m){return o(ns.PE_TYPE_UNIT,m)}t.initialize=n,t.coordsys=s,t.factoryByType=o,t.fromString=a,t.geogcs=l,t.geogtran=c,t.getCode=h,t.projcs=p,t.unit=f}(ZZ||(ZZ={}));let LAe=null;var lz,JZ,KZ,QZ,cz,eJ,uz,hz,tJ;function DAe(t){function e(s,o,a){s[o]=a(s[o])}ae=t,ns.init(),lz.init(),cz.init(),uz.init(),hz.init(),LAe=class extends ae.PeGCSExtent{destroy(){ae.destroy(this)}};const r=[ae.PeDatum,ae.PeGeogcs,ae.PeGeogtran,ae.PeObject,ae.PeParameter,ae.PePrimem,ae.PeProjcs,ae.PeSpheroid,ae.PeUnit];for(const s of r)e(s.prototype,"getName",o=>function(){return o.call(this,new Array(ns.PE_NAME_MAX))});for(const s of[ae.PeGeogtran,ae.PeProjcs])e(s.prototype,"getParameters",o=>function(){const a=new Array(ns.PE_PARM_MAX);let l=o.call(this);for(let c=0;c<a.length;c++){const h=ae.getValue(l,"*");a[c]=h?ae.wrapPointer(h,ae.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return a});e(ae.PeHorizon.prototype,"getCoord",s=>function(){const o=this.getSize();if(!o)return null;const a=[];return H1(a,o,s.call(this)),a}),e(ae.PeGTlistExtendedEntry.prototype,"getEntries",s=>{const o=ae._pe_getPeGTlistExtendedGTsSize();return function(){let a=null;const l=s.call(this);if(!ae.compare(l,ae.NULL)){a=[l];const c=this.getSteps();if(c>1){const h=ae.getPointer(l);for(let p=1;p<c;p++)a.push(ae.wrapPointer(h+o*p,ae.PeGTlistExtendedGTs))}}return a}});const i=ae._pe_getPeHorizonSize(),n=s=>function(){let o=this._cache;if(o||(o=new Map,this._cache=o),o.has(s))return o.get(s);let a=null;const l=s.call(this);if(!ae.compare(l,ae.NULL)){a=[l];const c=l.getNump();if(c>1){const h=ae.getPointer(l);for(let p=1;p<c;p++)a.push(ae.wrapPointer(h+i*p,ae.PeHorizon))}}return o.set(s,a),a};e(ae.PeProjcs.prototype,"horizonGcsGenerate",n),e(ae.PeProjcs.prototype,"horizonPcsGenerate",n),ae.PeObject.prototype.toString=function(s=ns.PE_STR_OPTS_NONE){ae.ensureCache.prepare();const o=ae.getPointer(this),a=ae.ensureInt8(new Array(ns.PE_BUFFER_MAX));return ae.UTF8ToString(ae._pe_object_to_string_ext(o,s,a))}}function Ry(t){if(!t)return;const e=ae.getClass(t);if(!e)return;const r=ae.getCache(e);if(!r)return;const i=ae.getPointer(t);i&&delete r[i]}function VF(t,e){const r=[],i=new Array(e);for(let n=0;n<t;n++)r.push(ae.ensureInt8(i));return r}function GT(t){let e;return Array.isArray(t[0])?(e=[],t.forEach(r=>{e.push(r[0],r[1])})):e=t,e}function H1(t,e,r,i=!1){if(i)for(let n=0;n<2*e;n++)t[n]=ae.getValue(r+n*Float64Array.BYTES_PER_ELEMENT,"double");else{const n=t.length===0;for(let s=0;s<e;s++)n&&(t[s]=new Array(2)),t[s][0]=ae.getValue(r,"double"),t[s][1]=ae.getValue(r+Float64Array.BYTES_PER_ELEMENT,"double"),r+=2*Float64Array.BYTES_PER_ELEMENT}}(function(t){let e;function r(){t.PE_GTLIST_OPTS_COMMON=ae.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,e=ae._pe_getPeGTlistExtendedEntrySize()}function i(n,s,o,a,l,c){let h=null;const p=new ae.PeInteger(c);try{const f=ae.PeGTlistExtended.prototype.getGTlist(n,s,o,a,l,p);if((c=p.val)&&(h=[f],c>1)){const m=ae.getPointer(f);for(let g=1;g<c;g++)h.push(ae.wrapPointer(m+e*g,ae.PeGTlistExtendedEntry))}}finally{ae.destroy(p)}return h}t.init=r,t.getGTlist=i})(lz||(lz={})),function(t){function e(r){if(r&&r.length){for(const i of r)Ry(i),i.getEntries().forEach(n=>{Ry(n);const s=n.getGeogtran();Ry(s),s.getParameters().forEach(Ry),[s.getGeogcs1(),s.getGeogcs2()].forEach(o=>{Ry(o);const a=o.getDatum();Ry(a),Ry(a.getSpheroid()),Ry(o.getPrimem()),Ry(o.getUnit())})});ae.PeGTlistExtendedEntry.prototype.Delete(r[0])}}t.destroy=e}(JZ||(JZ={})),function(t){function e(r,i,n,s,o){ae.ensureCache.prepare();const a=GT(n),l=n===a,c=ae.ensureFloat64(a);let h=0;s&&(h=ae.ensureFloat64(s));const p=ae._pe_geog_to_geog(ae.getPointer(r),i,c,h,o);return p&&H1(n,i,c,l),p}t.geogToGeog=e}(KZ||(KZ={})),function(t){const e=(c,h,p,f,m,g)=>{let _,b;switch(ae.ensureCache.prepare(),c){case"dd":_=ae._pe_geog_to_dd,b=ns.PE_DD_MAX;break;case"ddm":_=ae._pe_geog_to_ddm,b=ns.PE_DDM_MAX;break;case"dms":_=ae._pe_geog_to_dms,b=ns.PE_DMS_MAX}let w=0;h&&(w=ae.getPointer(h));const x=GT(f),T=ae.ensureFloat64(x),E=VF(p,b),C=_(w,p,T,m,ae.ensureInt32(E));if(C)for(let A=0;A<p;A++)g[A]=ae.UTF8ToString(E[A]);return C},r=(c,h,p,f,m)=>{let g;switch(ae.ensureCache.prepare(),c){case"dd":g=ae._pe_dd_to_geog;break;case"ddm":g=ae._pe_ddm_to_geog;break;case"dms":g=ae._pe_dms_to_geog}let _=0;h&&(_=ae.getPointer(h));const b=f.map(E=>ae.ensureString(E)),w=ae.ensureInt32(b),x=ae.ensureFloat64(new Array(2*p)),T=g(_,p,w,x);return T&&H1(m,p,x),T};function i(c,h,p,f,m){return e("dms",c,h,p,f,m)}function n(c,h,p,f){return r("dms",c,h,p,f)}function s(c,h,p,f,m){return e("ddm",c,h,p,f,m)}function o(c,h,p,f){return r("ddm",c,h,p,f)}function a(c,h,p,f,m){return e("dd",c,h,p,f,m)}function l(c,h,p,f){return r("dd",c,h,p,f)}t.geogToDms=i,t.dmsToGeog=n,t.geogToDdm=s,t.ddmToGeog=o,t.geogToDd=a,t.ddToGeog=l}(QZ||(QZ={})),function(t){function e(){t.PE_MGRS_STYLE_NEW=ae.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,t.PE_MGRS_STYLE_OLD=ae.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,t.PE_MGRS_STYLE_AUTO=ae.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,t.PE_MGRS_180_ZONE_1_PLUS=ae.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,t.PE_MGRS_ADD_SPACES=ae.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function r(n,s,o,a,l,c,h){ae.ensureCache.prepare();let p=0;n&&(p=ae.getPointer(n));const f=GT(o),m=ae.ensureFloat64(f),g=VF(s,ns.PE_MGRS_MAX),_=ae.ensureInt32(g),b=ae._pe_geog_to_mgrs_extended(p,s,m,a,l,c,_);if(b)for(let w=0;w<s;w++)h[w]=ae.UTF8ToString(g[w]);return b}function i(n,s,o,a,l){ae.ensureCache.prepare();let c=0;n&&(c=ae.getPointer(n));const h=o.map(g=>ae.ensureString(g)),p=ae.ensureInt32(h),f=ae.ensureFloat64(new Array(2*s)),m=ae._pe_mgrs_to_geog_extended(c,s,p,a,f);return m&&H1(l,s,f),m}t.init=e,t.geogToMgrsExtended=r,t.mgrsToGeogExtended=i}(cz||(cz={})),function(t){function e(i,n,s,o,a,l,c){ae.ensureCache.prepare();let h=0;i&&(h=ae.getPointer(i));const p=GT(s),f=ae.ensureFloat64(p),m=VF(n,ns.PE_MGRS_MAX),g=ae.ensureInt32(m),_=ae._pe_geog_to_usng(h,n,f,o,a,l,g);if(_)for(let b=0;b<n;b++)c[b]=ae.UTF8ToString(m[b]);return _}function r(i,n,s,o){ae.ensureCache.prepare();let a=0;i&&(a=ae.getPointer(i));const l=s.map(f=>ae.ensureString(f)),c=ae.ensureInt32(l),h=ae.ensureFloat64(new Array(2*n)),p=ae._pe_usng_to_geog(a,n,c,h);return p&&H1(o,n,h),p}t.geogToUsng=e,t.usngToGeog=r}(eJ||(eJ={})),function(t){function e(){t.PE_UTM_OPTS_NONE=ae.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,t.PE_UTM_OPTS_ADD_SPACES=ae.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,t.PE_UTM_OPTS_NS=ae.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function r(n,s,o,a,l){ae.ensureCache.prepare();let c=0;n&&(c=ae.getPointer(n));const h=GT(o),p=ae.ensureFloat64(h),f=VF(s,ns.PE_UTM_MAX),m=ae.ensureInt32(f),g=ae._pe_geog_to_utm(c,s,p,a,m);if(g)for(let _=0;_<s;_++)l[_]=ae.UTF8ToString(f[_]);return g}function i(n,s,o,a,l){ae.ensureCache.prepare();let c=0;n&&(c=ae.getPointer(n));const h=o.map(g=>ae.ensureString(g)),p=ae.ensureInt32(h),f=ae.ensureFloat64(new Array(2*s)),m=ae._pe_utm_to_geog(c,s,p,a,f);return m&&H1(l,s,f),m}t.init=e,t.geogToUtm=r,t.utmToGeog=i}(uz||(uz={})),function(t){const e=new Map;function r(){t.PE_PCSINFO_OPTION_NONE=ae.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,t.PE_PCSINFO_OPTION_DOMAIN=ae.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,t.PE_POLE_OUTSIDE_BOUNDARY=ae.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,t.PE_POLE_POINT=ae.PePCSInfo.prototype.PE_POLE_POINT}function i(n,s=t.PE_PCSINFO_OPTION_DOMAIN){let o=null,a=null;return e.has(n)&&(a=e.get(n),a[s]&&(o=a[s])),o||(o=ae.PePCSInfo.prototype.generate(n,s),a||(a=[],e.set(n,a)),a[s]=o),o}t.init=r,t.generate=i}(hz||(hz={})),function(t){function e(){return ae.PeVersion.prototype.version_string()}t.versionString=e}(tJ||(tJ={}));const oZe=Object.freeze(Object.defineProperty({__proto__:null,get PeCSTransformations(){return YZ},get PeDefs(){return ns},get PeFactory(){return ZZ},get PeGCSExtent(){return LAe},get PeGTTransformations(){return KZ},get PeGTlistExtended(){return lz},get PeGTlistExtendedEntry(){return JZ},get PeNotationDms(){return QZ},get PeNotationMgrs(){return cz},get PeNotationUsng(){return eJ},get PeNotationUtm(){return uz},get PePCSInfo(){return hz},get PeVersion(){return tJ},_init:DAe,get _pe(){return ae},isLoaded:IAe,isSupported:sZe,load:$Ae},Symbol.toStringTag,{value:"Module"})),vVt=Math.PI/180,bVt=/SPHEROID\[([^\]]+)]/i,lv=Cr.radius,jp=Cr.eccentricitySquared,aZe={a1:lv*jp,a2:lv*jp*lv*jp,a3:lv*jp*jp/2,a4:lv*jp*lv*jp*2.5,a5:lv*jp+lv*jp*jp/2,a6:1-jp},wVt={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:Cr.radius,f:Cr.flattening},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:b_.radius,f:b_.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:jg.radius,f:jg.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:jg.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};let BF=0,Xj=class rJ{static fromGE(e){const r=new rJ;return r._wkt=e.wkt,r._wkid=e.wkid,r._isInverse=e.isInverse,r}constructor(e){this.uid=BF++,e?(this._wkt=e.wkt!=null?e.wkt:null,this._wkid=e.wkid!=null?e.wkid:-1,this._isInverse=e.isInverse!=null&&e.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}get wkt(){return this._wkt}set wkt(e){this._wkt=e,this.uid=BF++}get wkid(){return this._wkid}set wkid(e){this._wkid=e,this.uid=BF++}get isInverse(){return this._isInverse}set isInverse(e){this._isInverse=e,this.uid=BF++}getInverse(){const e=new rJ;return e._wkt=this.wkt,e._wkid=this._wkid,e._isInverse=!this.isInverse,e}},iJ=class VP{static cacheKey(e,r){return[e.wkid!==void 0&&e.wkid!==null?e.wkid.toString():"-1",e.wkt!==void 0&&e.wkt!==null?e.wkt.toString():"",r.wkid!==void 0&&r.wkid!==null?r.wkid.toString():"-1",r.wkt!==void 0&&r.wkt!==null?r.wkt.toString():""].join(",")}static fromGE(e){const r=new VP;let i="";for(const n of e.steps){const s=Xj.fromGE(n);r.steps.push(s),i+=s.uid.toString()+","}return r._cachedProjection={},r._gtlistentry=null,r._chain=i,r}constructor(e){if(this.steps=[],this._cachedProjection={},this._chain="",this._gtlistentry=null,e&&e.steps)for(const r of e.steps)r instanceof Xj?this.steps.push(r):this.steps.push(new Xj({wkid:r.wkid,wkt:r.wkt,isInverse:r.isInverse}))}getInverse(){const e=new VP;e.steps=[];for(let r=this.steps.length-1;r>=0;r--){const i=this.steps[r];e.steps.push(i.getInverse())}return e}getGTListEntry(){let e="";for(const r of this.steps)e+=r.uid.toString()+",";return e!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=e),this._gtlistentry}assignCachedGe(e,r,i){this._cachedProjection[VP.cacheKey(e,r)]=i}getCachedGeTransformation(e,r){let i="";for(const s of this.steps)i+=s.uid.toString()+",";i!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=i);const n=this._cachedProjection[VP.cacheKey(e,r)];return n===void 0?null:n}};function NAe(t,e,r){if(R(e)||R(r)||r.vcsWkid||In(e,r))return null;const i=JS(e)/JS(r);if(i===1)return null;switch(t){case"point":case"esriGeometryPoint":return n=>lZe(n,i);case"polyline":case"esriGeometryPolyline":return n=>uZe(n,i);case"polygon":case"esriGeometryPolygon":return n=>cZe(n,i);case"multipoint":case"esriGeometryMultipoint":return n=>hZe(n,i);case"extent":case"esriGeometryExtent":return n=>dZe(n,i);default:return null}}function lZe(t,e){t&&t.z!=null&&(t.z*=e)}function cZe(t,e){if(t)for(const r of t.rings)for(const i of r)i.length>2&&(i[2]*=e)}function uZe(t,e){if(t)for(const r of t.paths)for(const i of r)i.length>2&&(i[2]*=e)}function hZe(t,e){if(t)for(const r of t.points)r.length>2&&(r[2]*=e)}function dZe(t,e){t&&t.zmin!=null&&t.zmax!=null&&(t.zmin*=e,t.zmax*=e)}let Db=null,YL=null,Yj=null,Zj={};const FAe=new lne;function i2(){return!!Db&&IAe()}function n2(t){return R(Yj)&&(Yj=Promise.all([$Ae(),Q(()=>import("./geometryEngineBase-e1a33b0a.js"),[]).then(e=>e.g),Q(()=>import("./hydrated-e133b6f4.js"),[])])),Yj.then(([,e,{hydratedAdapter:r}])=>{lr(t),YL=r,Db=e.default,Db._enableProjection(oZe),FAe.notify()})}function ym(t,e,r=null,i=null){return Array.isArray(t)?t.length===0?[]:Sde(YL,t,t[0].spatialReference,e,r,i):Sde(YL,[t],t.spatialReference,e,r,i)[0]}function Sde(t,e,r,i,n=null,s=null){if(R(r)||R(i))return e;if(cy(r,i,n))return e.map(o=>UAe(o,r,i));if(R(n)){const o=iJ.cacheKey(r,i);Zj[o]!==void 0?n=Zj[o]:(n=fZe(r,i,void 0),R(n)&&(n=new iJ),Zj[o]=n)}if(R(Db)||R(t))throw new nse;return v(s)?Db._project(t,e,r,i,n,s):Db._project(t,e,r,i,n)}function dz(t,e){const r=pZe([t],e);return v(r.pending)?{pending:r.pending,geometry:null}:v(r.geometries)?{pending:null,geometry:r.geometries[0]}:{pending:null,geometry:null}}function pZe(t,e){if(!i2()){for(const r of t)if(v(r)&&!In(r.spatialReference,e)&&$a(r.spatialReference)&&$a(e)&&!cy(r.spatialReference,e))return Er(FAe),{pending:n2(),geometries:null}}return{pending:null,geometries:t.map(r=>R(r)?null:In(r.spatialReference,e)?r:$a(r.spatialReference)&&$a(e)?mZe(r,e):null)}}function fZe(t,e,r=null){if(R(t)||R(e))return null;if(R(Db)||R(YL))throw new nse;const i=Db._getTransformation(YL,t,e,r,r==null?void 0:r.spatialReference);return i!==null?iJ.fromGE(i):null}class nse extends H{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}var J;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",t[t.WGS84=2]="WGS84",t[t.WEB_MERCATOR=3]="WEB_MERCATOR",t[t.WGS84_ECEF=4]="WGS84_ECEF",t[t.CGCS2000=5]="CGCS2000",t[t.WGS84_COMPARABLE_LON_LAT=6]="WGS84_COMPARABLE_LON_LAT",t[t.SPHERICAL_MARS_PCPF=7]="SPHERICAL_MARS_PCPF",t[t.GCSMARS2000=8]="GCSMARS2000",t[t.SPHERICAL_MOON_PCPF=9]="SPHERICAL_MOON_PCPF",t[t.GCSMOON2000=10]="GCSMOON2000",t[t.LON_LAT=11]="LON_LAT",t[t.PLATE_CARREE=12]="PLATE_CARREE"})(J||(J={}));function mZe(t,e){try{const r=ym(t,e);if(r==null)return null;"xmin"in t&&"xmin"in r&&(r.zmin=t.zmin,r.zmax=t.zmax);const i=NAe(r.type,t.spatialReference,e);return v(i)&&i(r),r}catch(r){if(!(r instanceof nse))throw r;return null}}function cy(t,e,r){return!r&&(!!In(t,e)||$a(t)&&$a(e)&&!!lse(t,e,use))}async function kAe(t,e,r,i){if(i2())return Rhe(i);if(Array.isArray(t)){for(const{source:n,dest:s,geographicTransformation:o}of t)if(!cy(n,s,o))return n2(i)}else if(!cy(t,e,r))return n2(i);return Rhe(i)}function xVt(t,e){switch(lse(t,e,use)){case Bi:return"copy3";case ub:return"wgs84ToSphericalECEF";case s2:return"wgs84ToWebMercator";case cb:return"wgs84ToPlateCarree";case db:return"wgs84ToWGS84ECEF";case OS:return"webMercatorToWGS84";case HAe:return"webMercatorToSphericalECEF";case qAe:return"webMercatorToWGS84ECEF";case WAe:return"webMercatorToPlateCarree";case pb:return"wgs84ECEFToWGS84";case ZAe:return"wgs84ECEFToSphericalECEF";case JAe:return"wgs84ECEFToWebMercator";case hb:return"sphericalECEFToWGS84";case XAe:return"sphericalECEFToWebMercator";case aJ:return"sphericalMarsPCPFToMars2000";case oJ:return"sphericalMoonPCPFToMoon2000";case YAe:return"sphericalECEFToWGS84ECEF";case sJ:return"mars2000ToSphericalPCPF";case nJ:return"moon2000ToSphericalPCPF";default:return null}}function UAe(t,e,r){return t?"x"in t?zAe(t,e,new Ue,r,0):"xmin"in t?vZe(t,e,new ur,r,0):"rings"in t?VAe(t,e,new Jl,r,0):"paths"in t?_Ze(t,e,new zf,r,0):"points"in t?yZe(t,e,new uN,r,0):null:null}function gZe(t,e,r=e.spatialReference,i=0){return v(r)&&v(t.spatialReference)&&v(zAe(t,t.spatialReference,e,r,i))}function zAe(t,e,r,i,n){li[0]=t.x,li[1]=t.y;const s=t.z;return li[2]=s!==void 0?s:n,$n(li,e,0,li,i,0,1)?(r.x=li[0],r.y=li[1],r.spatialReference=i,s===void 0?(r.z=void 0,r.hasZ=!1):(r.z=li[2],r.hasZ=!0),t.m===void 0?(r.m=void 0,r.hasM=!1):(r.m=t.m,r.hasM=!0),r):null}function yZe(t,e,r,i,n){const{points:s,hasZ:o,hasM:a}=t,l=[],c=s.length,h=[];for(const p of s)h.push(p[0],p[1],o?p[2]:n);if(!$n(h,e,0,h,i,0,c))return null;for(let p=0;p<c;++p){const f=3*p,m=h[f],g=h[f+1];o&&a?l.push([m,g,h[f+2],s[p][3]]):o?l.push([m,g,h[f+2]]):a?l.push([m,g,s[p][2]]):l.push([m,g])}return r.points=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r}function _Ze(t,e,r,i,n){const{paths:s,hasZ:o,hasM:a}=t,l=[];return jAe(s,o??!1,a??!1,e,l,i,n)?(r.paths=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r):null}function TVt(t,e,r=e.spatialReference,i=0){return v(t.spatialReference)&&v(r)&&v(VAe(t,t.spatialReference,e,r,i))}function VAe(t,e,r,i,n){const{rings:s,hasZ:o,hasM:a}=t,l=[];return jAe(s,o??!1,a??!1,e,l,i,n)?(r.rings=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r):null}function vZe(t,e,r,i,n){const{xmin:s,ymin:o,xmax:a,ymax:l,hasZ:c,hasM:h}=t;return Ede(s,o,c?t.zmin:n,e,li,i)?(r.xmin=li[0],r.ymin=li[1],c&&(r.zmin=li[2]),Ede(a,l,c?t.zmax:n,e,li,i)?(r.xmax=li[0],r.ymax=li[1],c&&(r.zmax=li[2]),h&&(r.mmin=t.mmin,r.mmax=t.mmax),r.spatialReference=i,r):null):null}function iw(t,e,r){if(R(e)||R(r))return null;const i=new Ue({spatialReference:r});return $n(t,e,0,li,r,0,1)?(i.x=li[0],i.y=li[1],i.z=li[2],i):null}function BAe(t,e,r){return $n(t,e,0,li,r.spatialReference,0,1)?(r.x=li[0],r.y=li[1],r.z=li[2],r):null}function Ba(t,e,r,i=0){li[0]=t.x,li[1]=t.y;const n=t.z;return li[2]=n!==void 0?n:i,$n(li,t.spatialReference,0,e,r,0,1)}function Ede(t,e,r,i,n,s){return An[0]=t,An[1]=e,An[2]=r,$n(An,i,0,n,s,0,1)}function zo(t,e,r,i){return!(R(e)||R(i)||t.length<2)&&(t.length===2&&(An[0]=t[0],An[1]=t[1],An[2]=0,t=An),$n(t,e,0,r,i,0,1))}function bZe(t,e){li[0]=t.x,li[1]=t.y;const r=t.z;return li[2]=r!==void 0?r:0,wZe(li,t.spatialReference,e)}function wZe(t,e,r){return xZe(t,e,r)}function xZe(t,e,r){if(R(e))return!1;const i=nw(e,iB),n=Dg[i][J.WGS84_COMPARABLE_LON_LAT];return!R(n)&&(n(t,0,An,0),r!==An&&(r[0]=An[0],r[1]=An[1],r.length>2&&(r[2]=An[2])),!0)}function $n(t,e,r,i,n,s,o=1){const a=lse(e,n,use);if(R(a))return!1;if(a===Bi){if(t===i&&r===s)return!0;const c=r+3*o;for(let h=r,p=s;h<c;h++,p++)i[p]=t[h];return!0}const l=r+3*o;for(let c=r,h=s;c<l;c+=3,h+=3)a(t,c,i,h);return!0}function SVt(t,e,r,i,n){ce(li,t),me(jF,t,e),zo(li,r,li,n),zo(jF,r,jF,n),ge(i,jF,li),we(i,i)}function jAe(t,e,r,i,n,s,o=0){const a=new Array;for(const c of t)for(const h of c)a.push(h[0],h[1],e?h[2]:o);if(!$n(a,i,0,a,s,0,a.length/3))return!1;let l=0;n.length=0;for(const c of t){const h=new Array;for(const p of c)e&&r?h.push([a[l++],a[l++],a[l++],p[3]]):e?h.push([a[l++],a[l++],a[l++]]):r?(h.push([a[l++],a[l++],p[2]]),l++):(h.push([a[l++],a[l++]]),l++);n.push(h)}return!0}function EVt(t,e,r,i){if(R(e)||R(i))return!1;const n=KAe(e,i,PZe);if(n.projector===Bi)return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],!0;if(R(n.projector))return!1;const{source:s,dest:o}=n;if(o.spatialReferenceId===J.WEB_MERCATOR){const a=Dg[s.spatialReferenceId][J.WGS84];return!R(a)&&(a(t,0,Rf,0),s2(Rf,0,r,0),r[3]=Cde(Rf[1],t[2],t[3],Cr.radius),!0)}if(s.spatialReferenceId!==J.WGS84&&s.spatialReferenceId!==J.CGCS2000||o.spatialReferenceId!==J.PLATE_CARREE){n.projector(t,0,r,0);const a=s.metersPerUnit??1,l=o.metersPerUnit??1;r[3]=t[3]*a/l}else{const a=Dg[s.spatialReferenceId][J.SPHERICAL_ECEF],l=Dg[J.SPHERICAL_ECEF][J.PLATE_CARREE];let c=t[3];v(a)&&v(l)&&(c=Cde(t[1],t[2],t[3],Cr.radius)),n.projector(t,0,r,0),r[3]=c}return!0}function Cde(t,e,r,i){const n=i+e;if(n<i/2||r>n)return Number.MAX_VALUE;const s=Math.abs(Hf*t)+Math.asin(r/n);return s>=Math.PI/2?Number.MAX_VALUE:r/Math.cos(s)}function rB(t,e,r,i){return t!=null&&(In(e,i)?(w_(r,t),!0):(An[0]=t[0],An[1]=t[1],An[2]=0,!!$n(An,e,0,An,i,0,1)&&(r[0]=An[0],r[1]=An[1],An[0]=t[2],An[1]=t[3],An[2]=0,!!$n(An,e,0,An,i,0,1)&&(r[2]=An[0],r[3]=An[1],!0))))}function CVt(t,e,r,i){if(R(e)||R(i))return!1;const n=nw(e,iB),s=nw(i,QAe);if(n===s&&n!==J.UNKNOWN||In(e,i))return r[0]=1,r[1]=1,r[2]=1,!0;if(n===J.SPHERICAL_ECEF){const o=Pe(t),a=o/Math.sqrt(t[0]*t[0]+t[1]*t[1]),l=o/Cr.radius;if(s===J.WEB_MERCATOR)return r[0]=a*l,r[1]=a*l,r[2]=1,!0;if(s===J.WGS84||s===J.CGCS2000){const c=T$;return r[0]=c*a*l,r[1]=c*l,r[2]=1,!0}}else if(n===J.PLATE_CARREE){if(s===J.WGS84||s===J.CGCS2000)return r[0]=T$,r[1]=T$,r[2]=1,!0;if(s===J.WEB_MERCATOR){const o=t[1]/Cr.radius;return r[0]=1,r[1]=1/Math.cos(o),r[2]=1,!0}}return!1}function um(t,e,r,i){if(R(t)||R(i))return!1;const n=nw(t,iB),s=nw(i,QAe);if(n===s&&!Ade(s)&&(n!==J.UNKNOWN||In(t,i)))return Q9(r,e),!0;if(Ade(s)){const o=Dg[n][J.LON_LAT],a=Dg[J.LON_LAT][s];return!R(o)&&!R(a)&&(o(e,0,Rf,0),a(Rf,0,cv,0),GAe(Hf*Rf[0],Hf*Rf[1],r),r[12]=cv[0],r[13]=cv[1],r[14]=cv[2],!0)}if((s===J.WEB_MERCATOR||s===J.PLATE_CARREE)&&(n===J.WGS84||n===J.CGCS2000&&s===J.PLATE_CARREE||n===J.SPHERICAL_ECEF||n===J.WEB_MERCATOR)){const o=Dg[n][J.LON_LAT],a=Dg[J.LON_LAT][s];return!R(o)&&!R(a)&&(o(e,0,Rf,0),a(Rf,0,cv,0),n===J.SPHERICAL_ECEF?TZe(Hf*Rf[0],Hf*Rf[1],r):Rp(r),r[12]=cv[0],r[13]=cv[1],r[14]=cv[2],!0)}return!1}function Ade(t){return t===J.SPHERICAL_ECEF||t===J.SPHERICAL_MARS_PCPF||t===J.SPHERICAL_MOON_PCPF}function GAe(t,e,r){const i=Math.sin(t),n=Math.cos(t),s=Math.sin(e),o=Math.cos(e),a=r;return a[0]=-i,a[4]=-s*n,a[8]=o*n,a[12]=0,a[1]=n,a[5]=-s*i,a[9]=o*i,a[13]=0,a[2]=0,a[6]=o,a[10]=s,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function TZe(t,e,r){return GAe(t,e,r),Wu(r,r),r}function nw(t,e){return t?e.spatialReference===t?e.spatialReferenceId:(e.spatialReference=t,"metersPerUnit"in e&&(e.metersPerUnit=Kl(t,1)),t.wkt===O2e.wkt?e.spatialReferenceId=J.SPHERICAL_ECEF:FL(t)?e.spatialReferenceId=J.WGS84:Wb(t)?e.spatialReferenceId=J.WEB_MERCATOR:Xie(t)?e.spatialReferenceId=J.PLATE_CARREE:t.wkt===M2e.wkt?e.spatialReferenceId=J.WGS84_ECEF:t.wkid===sp.CGCS2000?e.spatialReferenceId=J.CGCS2000:t.wkt===Kie.wkt?e.spatialReferenceId=J.SPHERICAL_MARS_PCPF:t.wkt===Qie.wkt?e.spatialReferenceId=J.SPHERICAL_MOON_PCPF:my(t)?e.spatialReferenceId=J.GCSMARS2000:gy(t)?e.spatialReferenceId=J.GCSMOON2000:e.spatialReferenceId=J.UNKNOWN):J.UNKNOWN}function Bi(t,e,r,i){t!==r&&(r[i++]=t[e++],r[i++]=t[e++],r[i]=t[e])}function OS(t,e,r,i){r[i++]=SO*(t[e++]/Cr.radius),r[i++]=SO*(Math.PI/2-2*Math.atan(Math.exp(-t[e++]/Cr.radius))),r[i]=t[e]}function HAe(t,e,r,i){OS(t,e,r,i),ub(r,i,r,i)}function qAe(t,e,r,i){OS(t,e,r,i),db(r,i,r,i)}function sse(t,e,r,i,n){const s=.4999999*Math.PI,o=_e(Hf*t[e+1],-s,s),a=Math.sin(o);r[i++]=Hf*t[e]*n.radius,r[i++]=n.halfSemiMajorAxis*Math.log((1+a)/(1-a)),r[i]=t[e+2]}function s2(t,e,r,i){sse(t,e,r,i,Cr)}const Rde=Cr.radius*Math.PI/180,T$=180/(Cr.radius*Math.PI);function cb(t,e,r,i){r[i]=t[e]*Rde,r[i+1]=t[e+1]*Rde,r[i+2]=t[e+2]}function pS(t,e,r,i){r[i]=t[e]*T$,r[i+1]=t[e+1]*T$,r[i+2]=t[e+2]}function WAe(t,e,r,i){OS(t,e,r,i),cb(r,i,r,i)}function SZe(t,e,r,i){pb(t,e,r,i),cb(r,i,r,i)}function EZe(t,e,r,i){hb(t,e,r,i),cb(r,i,r,i)}function CZe(t,e,r,i){pS(t,e,r,i),ub(r,i,r,i)}function AZe(t,e,r,i){pS(t,e,r,i),s2(r,i,r,i)}function RZe(t,e,r,i){pS(t,e,r,i),db(r,i,r,i)}function o2(t){if(R(t))return!1;const e=nw(t,iB);return!!Dg[e][J.WGS84_COMPARABLE_LON_LAT]}function OZe(t,e,r,i){const n=Math.cos(r);t[0]=Math.cos(e)*n*i,t[1]=Math.sin(e)*n*i,t[2]=Math.sin(r)*i}function ose(t,e,r,i,n){const s=n+t[e+2],o=Hf*t[e+1],a=Hf*t[e],l=Math.cos(o);r[i++]=Math.cos(a)*l*s,r[i++]=Math.sin(a)*l*s,r[i]=Math.sin(o)*s}function nJ(t,e,r,i){ose(t,e,r,i,b_.radius)}function sJ(t,e,r,i){ose(t,e,r,i,jg.radius)}function ub(t,e,r,i){ose(t,e,r,i,Cr.radius)}function ase(t,e,r,i,n){const s=t[e],o=t[e+1],a=t[e+2],l=Math.sqrt(s*s+o*o+a*a),c=Ep(a/(l===0?1:l)),h=Math.atan2(o,s);r[i++]=SO*h,r[i++]=SO*c,r[i]=l-n}function oJ(t,e,r,i){ase(t,e,r,i,b_.radius)}function aJ(t,e,r,i){ase(t,e,r,i,jg.radius)}function hb(t,e,r,i){ase(t,e,r,i,Cr.radius)}function XAe(t,e,r,i){hb(t,e,r,i),s2(r,i,r,i)}function YAe(t,e,r,i){hb(t,e,r,i),db(r,i,r,i)}function MZe(t,e,r,i,n){const s=Hf*t[e],o=Hf*t[e+1],a=t[e+2],l=Math.sin(o),c=Math.cos(o),h=n.radius/Math.sqrt(1-n.eccentricitySquared*l*l);r[i++]=(h+a)*c*Math.cos(s),r[i++]=(h+a)*c*Math.sin(s),r[i++]=(h*(1-n.eccentricitySquared)+a)*l}function db(t,e,r,i){MZe(t,e,r,i,Cr)}function pb(t,e,r,i){const n=aZe,s=t[e],o=t[e+1],a=t[e+2];let l,c,h,p,f,m,g,_,b,w,x,T,E,C,A,I,M,D,U,z,B;l=Math.abs(a),c=s*s+o*o,h=Math.sqrt(c),p=c+a*a,f=Math.sqrt(p),z=Math.atan2(o,s),m=a*a/p,g=c/p,C=n.a2/f,A=n.a3-n.a4/f,g>.3?(_=l/f*(1+g*(n.a1+C+m*A)/f),U=Math.asin(_),w=_*_,b=Math.sqrt(1-w)):(b=h/f*(1-m*(n.a5-C-g*A)/f),U=Math.acos(b),w=1-b*b,_=Math.sqrt(w)),x=1-Cr.eccentricitySquared*w,T=Cr.radius/Math.sqrt(x),E=n.a6*T,C=h-T*b,A=l-E*_,M=b*C+_*A,I=b*A-_*C,D=I/(E/x+M),U+=D,B=M+I*D/2,a<0&&(U=-U),r[i++]=SO*z,r[i++]=SO*U,r[i]=B}function ZAe(t,e,r,i){pb(t,e,r,i),ub(r,i,r,i)}function JAe(t,e,r,i){pb(t,e,r,i),s2(r,i,r,i)}const Dg={[J.WGS84]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:Bi,[J.WGS84_COMPARABLE_LON_LAT]:Bi,[J.SPHERICAL_ECEF]:ub,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:s2,[J.PLATE_CARREE]:cb,[J.WGS84]:Bi,[J.WGS84_ECEF]:db},[J.CGCS2000]:{[J.CGCS2000]:Bi,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:Bi,[J.WGS84_COMPARABLE_LON_LAT]:Bi,[J.SPHERICAL_ECEF]:ub,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:cb,[J.WGS84]:null,[J.WGS84_ECEF]:db},[J.GCSMARS2000]:{[J.CGCS2000]:null,[J.GCSMARS2000]:Bi,[J.GCSMOON2000]:null,[J.LON_LAT]:Bi,[J.WGS84_COMPARABLE_LON_LAT]:null,[J.SPHERICAL_ECEF]:null,[J.SPHERICAL_MARS_PCPF]:sJ,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:null,[J.WGS84]:null,[J.WGS84_ECEF]:null},[J.GCSMOON2000]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:Bi,[J.LON_LAT]:Bi,[J.WGS84_COMPARABLE_LON_LAT]:null,[J.SPHERICAL_ECEF]:null,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:nJ,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:null,[J.WGS84]:null,[J.WGS84_ECEF]:null},[J.WEB_MERCATOR]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:OS,[J.WGS84_COMPARABLE_LON_LAT]:OS,[J.SPHERICAL_ECEF]:HAe,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:Bi,[J.PLATE_CARREE]:WAe,[J.WGS84]:OS,[J.WGS84_ECEF]:qAe},[J.WGS84_ECEF]:{[J.CGCS2000]:pb,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:pb,[J.WGS84_COMPARABLE_LON_LAT]:pb,[J.SPHERICAL_ECEF]:ZAe,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:JAe,[J.PLATE_CARREE]:SZe,[J.WGS84]:pb,[J.WGS84_ECEF]:Bi},[J.SPHERICAL_ECEF]:{[J.CGCS2000]:hb,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:hb,[J.WGS84_COMPARABLE_LON_LAT]:hb,[J.SPHERICAL_ECEF]:Bi,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:XAe,[J.PLATE_CARREE]:EZe,[J.WGS84]:hb,[J.WGS84_ECEF]:YAe},[J.SPHERICAL_MARS_PCPF]:{[J.CGCS2000]:null,[J.GCSMARS2000]:aJ,[J.GCSMOON2000]:null,[J.LON_LAT]:aJ,[J.WGS84_COMPARABLE_LON_LAT]:null,[J.SPHERICAL_ECEF]:null,[J.SPHERICAL_MARS_PCPF]:Bi,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:null,[J.WGS84]:null,[J.WGS84_ECEF]:null},[J.SPHERICAL_MOON_PCPF]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:oJ,[J.LON_LAT]:oJ,[J.WGS84_COMPARABLE_LON_LAT]:null,[J.SPHERICAL_ECEF]:null,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:Bi,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:null,[J.WGS84]:null,[J.WGS84_ECEF]:null},[J.UNKNOWN]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:null,[J.WGS84_COMPARABLE_LON_LAT]:null,[J.SPHERICAL_ECEF]:null,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:Bi,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:null,[J.WGS84]:null,[J.WGS84_ECEF]:null},[J.LON_LAT]:{[J.CGCS2000]:Bi,[J.GCSMARS2000]:Bi,[J.GCSMOON2000]:Bi,[J.LON_LAT]:Bi,[J.WGS84_COMPARABLE_LON_LAT]:Bi,[J.SPHERICAL_ECEF]:ub,[J.SPHERICAL_MARS_PCPF]:sJ,[J.SPHERICAL_MOON_PCPF]:nJ,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:s2,[J.PLATE_CARREE]:cb,[J.WGS84]:Bi,[J.WGS84_ECEF]:db},[J.WGS84_COMPARABLE_LON_LAT]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:Bi,[J.WGS84_COMPARABLE_LON_LAT]:Bi,[J.SPHERICAL_ECEF]:ub,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:cb,[J.WGS84]:Bi,[J.WGS84_ECEF]:db},[J.PLATE_CARREE]:{[J.CGCS2000]:pS,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:pS,[J.WGS84_COMPARABLE_LON_LAT]:pS,[J.SPHERICAL_ECEF]:CZe,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:AZe,[J.PLATE_CARREE]:Bi,[J.WGS84]:pS,[J.WGS84_ECEF]:RZe}};function lse(t,e,r=cse()){return R(t)||R(e)?null:KAe(t,e,r).projector}function KAe(t,e,r){if(R(t)||R(e)||r.source.spatialReference===t&&r.dest.spatialReference===e)return r;const i=nw(t,r.source),n=nw(e,r.dest);return i===J.UNKNOWN&&n===J.UNKNOWN?In(t,e)?r.projector=Bi:r.projector=null:r.projector=Dg[i][n],r}function cse(){return{source:{spatialReference:null,spatialReferenceId:J.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:J.UNKNOWN,metersPerUnit:1},projector:Bi}}const iB={spatialReference:null,spatialReferenceId:J.UNKNOWN},QAe={spatialReference:null,spatialReferenceId:J.UNKNOWN},use=cse(),PZe=cse(),Hf=Xt(1),SO=dl(1),An=P(),Rf=P(),cv=P(),li=P(),jF=P();var lJ;let eg=lJ=class extends fe{constructor(t){super(t),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new lJ({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],eg.prototype,"cols",void 0),u([d({type:Xi,json:{write:!0}})],eg.prototype,"level",void 0),u([d({type:String,json:{write:!0}})],eg.prototype,"levelValue",void 0),u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],eg.prototype,"origin",void 0),u([d({type:Number,json:{write:!0}})],eg.prototype,"resolution",void 0),u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],eg.prototype,"rows",void 0),u([d({type:Number,json:{write:!0}})],eg.prototype,"scale",void 0),eg=lJ=u([$("esri.layers.support.LOD")],eg);const Kd=eg;let IZe=class{constructor(e,r,i,n,s){this.id=e,this.level=r,this.row=i,this.col=n,this.extent=s}};var e1;const Ode=new mr({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let Xo=e1=class extends fe{static create(t={}){const{resolutionFactor:e=1,scales:r,size:i=256,spatialReference:n=Je.WebMercator,numLODs:s=24}=t;if(!$a(n)){const p=[];if(r)for(let f=0;f<r.length;f++){const m=r[f];p.push(new Kd({level:f,scale:m,resolution:m}))}else{let f=5e-4;for(let m=s-1;m>=0;m--)p.unshift(new Kd({level:m,scale:f,resolution:f})),f*=2}return new e1({dpi:96,lods:p,origin:new Ue(0,0,n),size:[i,i],spatialReference:n})}const o=fp(n),a=t.origin?new Ue({x:t.origin.x,y:t.origin.y,spatialReference:n}):new Ue(o?{x:o.origin[0],y:o.origin[1],spatialReference:n}:{x:0,y:0,spatialReference:n}),l=96,c=1/(Kl(n)*39.37*l),h=[];if(r)for(let p=0;p<r.length;p++){const f=r[p],m=f*c;h.push(new Kd({level:p,scale:f,resolution:m}))}else{let p=A2e(n)?512/i*5916575275917094e-7:256/i*591657527591555e-6;const f=Math.ceil(s/e);h.push(new Kd({level:0,scale:p,resolution:p*c}));for(let m=1;m<f;m++){const g=p/2**e,_=g*c;h.push(new Kd({level:m,scale:g,resolution:_})),p=g}}return new e1({dpi:l,lods:h,origin:a,size:[i,i],spatialReference:n})}constructor(t){super(t),this.dpi=96,this.format=null,this.origin=null,this.minScale=0,this.maxScale=0,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:t,origin:e}=this;if(t&&e){const r=fp(t);return t.isWrappable&&!!r&&Math.abs(r.origin[0]-e.x)<=r.dx}return!1}readOrigin(t,e){return Ue.fromJSON({spatialReference:e.spatialReference,...t})}set lods(t){let e=0,r=0;const i=[],n=this._levelToLOD={};t&&(e=-1/0,r=1/0,t.forEach(s=>{i.push(s.scale),e=s.scale>e?s.scale:e,r=s.scale<r?s.scale:r,n[s.level]=s})),this._set("scales",i),this._set("minScale",e),this._set("maxScale",r),this._set("lods",t),this._initializeUpsampleLevels()}readSize(t,e){return[e.cols,e.rows]}writeSize(t,e){e.cols=t[0],e.rows=t[1]}zoomToScale(t){const e=this.scales;if(t<=0)return e[0];if(t>=e.length-1)return e[e.length-1];const r=Math.floor(t),i=r+1;return e[r]/(e[r]/e[i])**(t-r)}scaleToZoom(t){const e=this.scales,r=e.length-1;let i=0;for(;i<r;i++){const n=e[i],s=e[i+1];if(n<=t)return i;if(s===t)return i+1;if(n>t&&s<t)return i+Math.log(n/t)/Math.log(n/s)}return i}snapScale(t,e=.95){const r=this.scaleToZoom(t);return r%Math.floor(r)>=e?this.zoomToScale(Math.ceil(r)):this.zoomToScale(Math.floor(r))}tileAt(t,e,r,i){const n=this.lodAt(t);if(!n)return null;let s,o;if(typeof e=="number")s=e,o=r;else if(In(e.spatialReference,this.spatialReference))s=e.x,o=e.y,i=r;else{const c=D2(e,this.spatialReference);if(R(c))return null;s=c.x,o=c.y,i=r}const a=n.resolution*this.size[0],l=n.resolution*this.size[1];return i||(i=new IZe(null,0,0,0,Kt())),i.level=t,i.row=Math.floor((this.origin.y-o)/l+.001),i.col=Math.floor((s-this.origin.x)/a+.001),this.updateTileInfo(i),i}updateTileInfo(t,e=e1.ExtrapolateOptions.NONE){let r=this.lodAt(t.level);if(!r&&e===e1.ExtrapolateOptions.POWER_OF_TWO){const o=this.lods[this.lods.length-1];o.level<t.level&&(r=o)}if(!r)return;const i=t.level-r.level,n=r.resolution*this.size[0]/2**i,s=r.resolution*this.size[1]/2**i;t.id=`${t.level}/${t.row}/${t.col}`,t.extent||(t.extent=Kt()),t.extent[0]=this.origin.x+t.col*n,t.extent[1]=this.origin.y-(t.row+1)*s,t.extent[2]=t.extent[0]+n,t.extent[3]=t.extent[1]+s}upsampleTile(t){const e=this._upsampleLevels[t.level];return!(!e||e.parentLevel===-1)&&(t.level=e.parentLevel,t.row=Math.floor(t.row/e.factor+.001),t.col=Math.floor(t.col/e.factor+.001),this.updateTileInfo(t),!0)}getTileBounds(t,e){const r=this.lodAt(e.level);if(r==null)return null;const{resolution:i}=r,n=i*this.size[0],s=i*this.size[1];return t[0]=this.origin.x+e.col*n,t[1]=this.origin.y-(e.row+1)*s,t[2]=t[0]+n,t[3]=t[1]+s,t}lodAt(t){var e;return((e=this._levelToLOD)==null?void 0:e[t])??null}clone(){return e1.fromJSON(this.write({}))}getOrCreateCompatible(t,e){if(this.size[0]===256&&this.size[1]===256)return t===256?this:null;const r=[],i=this.lods.length;for(let n=0;n<i;n++){const s=this.lods[n],o=s.resolution*e;r.push(new Kd({level:s.level,scale:s.scale,resolution:o}))}return new e1({size:[t,t],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:r})}_initializeUpsampleLevels(){const t=this.lods;this._upsampleLevels=[];let e=null;for(let r=0;r<t.length;r++){const i=t[r];this._upsampleLevels[i.level]={parentLevel:e?e.level:-1,factor:e?e.resolution/i.resolution:0},e=i}}};u([d({type:Number,json:{write:!0}})],Xo.prototype,"compressionQuality",void 0),u([d({type:Number,json:{write:!0}})],Xo.prototype,"dpi",void 0),u([d({type:String,json:{read:Ode.read,write:Ode.write,origins:{"web-scene":{read:!1,write:!1}}}})],Xo.prototype,"format",void 0),u([d({readOnly:!0})],Xo.prototype,"isWrappable",null),u([d({type:Ue,json:{write:!0}})],Xo.prototype,"origin",void 0),u([Me("origin")],Xo.prototype,"readOrigin",null),u([d({type:[Kd],value:null,json:{write:!0}})],Xo.prototype,"lods",null),u([d({readOnly:!0})],Xo.prototype,"minScale",void 0),u([d({readOnly:!0})],Xo.prototype,"maxScale",void 0),u([d({readOnly:!0})],Xo.prototype,"scales",void 0),u([d({cast:t=>Array.isArray(t)?t:typeof t=="number"?[t,t]:[256,256]})],Xo.prototype,"size",void 0),u([Me("size",["rows","cols"])],Xo.prototype,"readSize",null),u([De("size",{cols:{type:Xi},rows:{type:Xi}})],Xo.prototype,"writeSize",null),u([d({type:Je,json:{write:!0}})],Xo.prototype,"spatialReference",void 0),Xo=e1=u([$("esri.layers.support.TileInfo")],Xo),function(t){var e;(e=t.ExtrapolateOptions||(t.ExtrapolateOptions={}))[e.NONE=0]="NONE",e[e.POWER_OF_TWO=1]="POWER_OF_TWO"}(Xo||(Xo={}));const S$=Xo,R6={widthBreakpoint:{getValue(t){const e=t.viewSize[0],r=t.breakpoints,i=this.values;return e<=r.xsmall?i.xsmall:e<=r.small?i.small:e<=r.medium?i.medium:e<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(t){const e=t.viewSize[1],r=t.breakpoints,i=this.values;return e<=r.xsmall?i.xsmall:e<=r.small?i.small:e<=r.medium?i.medium:e<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(t){const e=t.viewSize,r=e[0],i=e[1],n=this.values;return i>=r?n.portrait:n.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},Jj={xsmall:544,small:768,medium:992,large:1200};function $Ze(t){const e=t;return e&&e.xsmall<e.small&&e.small<e.medium&&e.medium<e.large}function Kj(t,e){return e?R6[t].valueToClassName[e].split(" "):[]}const eRe=t=>{let e=class extends t{constructor(...r){super(...r),this._breakpointsHandles=new qr,this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=Jj}initialize(){this._breakpointsHandles.add(ne(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),Vt))}destroy(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=ze(this._breakpointsHandles))}set breakpoints(r){if(r===this._get("breakpoints"))return;const i=$Ze(r);if(!i){const n=JSON.stringify(Jj,null,2);console.warn("provided breakpoints are not valid, using defaults:"+n)}r=i?r:Jj,this._set("breakpoints",{...r})}_updateClassNames(){if(!this.container)return;const r=Nc.acquire(),i=Nc.acquire();let n,s=!1;for(n in R6){const o=this[n],a=R6[n].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(s=!0,this[n]=a,Kj(n,o).forEach(l=>i.push(l)),Kj(n,a).forEach(l=>r.push(l)))}s&&(this._applyClassNameChanges(r,i),Nc.release(r),Nc.release(i))}_applyClassNameChanges(r,i){const n=this.container;n&&(i.forEach(s=>n.classList.remove(s)),r.forEach(s=>n.classList.add(s)))}_removeActiveClassNames(){const r=this.container;if(!r)return;let i;for(i in R6)Kj(i,this[i]).forEach(n=>r.classList.remove(n))}};return u([d()],e.prototype,"breakpoints",null),u([d()],e.prototype,"orientation",void 0),u([d()],e.prototype,"widthBreakpoint",void 0),u([d()],e.prototype,"heightBreakpoint",void 0),e=u([$("esri.views.BreakpointsOwner")],e),e};function nB(t){return typeof t=="string"?document.getElementById(t):t??null}function tRe(t){for(;t.hasChildNodes();)t.removeChild(t.firstChild)}function Mde(t,e){const r=e.parentNode;r&&r.insertBefore(t,e)}function Pde(t,e){for(;;){const r=t.firstChild;if(!r)break;e.appendChild(r)}}let Hg=class extends be{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._handles=new qr,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll(),this._handles.destroy()}add(e,r,i={}){return this._installWatch(e,r,i,ne)}addWhen(e,r,i={}){return this._installWatch(e,r,i,fo)}addOnCollectionChange(e,r,{initial:i=!1,final:n=!1}={}){const s=++this._handleId;return this._handles.add([Yn(e,"after-changes",this._createSyncUpdatingCallback(),Zr),Yn(e,"change",r,{onListenerAdd:i?o=>r({added:o.toArray(),removed:[]}):void 0,onListenerRemove:n?o=>r({added:[],removed:o.toArray()}):void 0})],s),{remove:()=>this._handles.remove(s)}}addPromise(e){if(R(e))return e;const r=++this._handleId;this._handles.add({remove:()=>{this._pendingPromises.delete(e)&&(this._pendingPromises.size!==0||this._handles.has(GF)||this._set("updating",!1))}},r),this._pendingPromises.add(e),this._set("updating",!0);const i=()=>this._handles.remove(r);return e.then(i,i),e}removeAll(){this._pendingPromises.clear(),this._handles.removeAll(),this._set("updating",!1)}_installWatch(e,r,i={},n){const s=++this._handleId;i.sync||this._installSyncUpdatingWatch(e,s);const o=n(e,r,i);return this._handles.add(o,s),{remove:()=>this._handles.remove(s)}}_installSyncUpdatingWatch(e,r){const i=this._createSyncUpdatingCallback(),n=ne(e,i,{sync:!0,equals:()=>!1});return this._handles.add(n,r),n}_createSyncUpdatingCallback(){return()=>{this._handles.remove(GF),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this._handles.add(L2(()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this._handles.remove(GF))}),GF)}}};u([d({readOnly:!0})],Hg.prototype,"updating",void 0),Hg=u([$("esri.core.support.WatchUpdatingTracking")],Hg);const GF=-42;/*!
 * @esri/arcgis-html-sanitizer - v3.0.1 - Tue Nov 15 2022 09:46:54 GMT-0800 (Pacific Standard Time)
 * Copyright (c) 2022 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2018 Zongmin Lei(雷宗民) <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 */var LZe=function(t){if(typeof t!="object"||t===null||Object.prototype.toString.call(t)!=="[object Object]")return!1;var e=Object.getPrototypeOf(t);if(e===null)return!0;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},HT={exports:{}},Ms={},ZL={exports:{}},V2={};function rRe(){var t={};return t["align-content"]=!1,t["align-items"]=!1,t["align-self"]=!1,t["alignment-adjust"]=!1,t["alignment-baseline"]=!1,t.all=!1,t["anchor-point"]=!1,t.animation=!1,t["animation-delay"]=!1,t["animation-direction"]=!1,t["animation-duration"]=!1,t["animation-fill-mode"]=!1,t["animation-iteration-count"]=!1,t["animation-name"]=!1,t["animation-play-state"]=!1,t["animation-timing-function"]=!1,t.azimuth=!1,t["backface-visibility"]=!1,t.background=!0,t["background-attachment"]=!0,t["background-clip"]=!0,t["background-color"]=!0,t["background-image"]=!0,t["background-origin"]=!0,t["background-position"]=!0,t["background-repeat"]=!0,t["background-size"]=!0,t["baseline-shift"]=!1,t.binding=!1,t.bleed=!1,t["bookmark-label"]=!1,t["bookmark-level"]=!1,t["bookmark-state"]=!1,t.border=!0,t["border-bottom"]=!0,t["border-bottom-color"]=!0,t["border-bottom-left-radius"]=!0,t["border-bottom-right-radius"]=!0,t["border-bottom-style"]=!0,t["border-bottom-width"]=!0,t["border-collapse"]=!0,t["border-color"]=!0,t["border-image"]=!0,t["border-image-outset"]=!0,t["border-image-repeat"]=!0,t["border-image-slice"]=!0,t["border-image-source"]=!0,t["border-image-width"]=!0,t["border-left"]=!0,t["border-left-color"]=!0,t["border-left-style"]=!0,t["border-left-width"]=!0,t["border-radius"]=!0,t["border-right"]=!0,t["border-right-color"]=!0,t["border-right-style"]=!0,t["border-right-width"]=!0,t["border-spacing"]=!0,t["border-style"]=!0,t["border-top"]=!0,t["border-top-color"]=!0,t["border-top-left-radius"]=!0,t["border-top-right-radius"]=!0,t["border-top-style"]=!0,t["border-top-width"]=!0,t["border-width"]=!0,t.bottom=!1,t["box-decoration-break"]=!0,t["box-shadow"]=!0,t["box-sizing"]=!0,t["box-snap"]=!0,t["box-suppress"]=!0,t["break-after"]=!0,t["break-before"]=!0,t["break-inside"]=!0,t["caption-side"]=!1,t.chains=!1,t.clear=!0,t.clip=!1,t["clip-path"]=!1,t["clip-rule"]=!1,t.color=!0,t["color-interpolation-filters"]=!0,t["column-count"]=!1,t["column-fill"]=!1,t["column-gap"]=!1,t["column-rule"]=!1,t["column-rule-color"]=!1,t["column-rule-style"]=!1,t["column-rule-width"]=!1,t["column-span"]=!1,t["column-width"]=!1,t.columns=!1,t.contain=!1,t.content=!1,t["counter-increment"]=!1,t["counter-reset"]=!1,t["counter-set"]=!1,t.crop=!1,t.cue=!1,t["cue-after"]=!1,t["cue-before"]=!1,t.cursor=!1,t.direction=!1,t.display=!0,t["display-inside"]=!0,t["display-list"]=!0,t["display-outside"]=!0,t["dominant-baseline"]=!1,t.elevation=!1,t["empty-cells"]=!1,t.filter=!1,t.flex=!1,t["flex-basis"]=!1,t["flex-direction"]=!1,t["flex-flow"]=!1,t["flex-grow"]=!1,t["flex-shrink"]=!1,t["flex-wrap"]=!1,t.float=!1,t["float-offset"]=!1,t["flood-color"]=!1,t["flood-opacity"]=!1,t["flow-from"]=!1,t["flow-into"]=!1,t.font=!0,t["font-family"]=!0,t["font-feature-settings"]=!0,t["font-kerning"]=!0,t["font-language-override"]=!0,t["font-size"]=!0,t["font-size-adjust"]=!0,t["font-stretch"]=!0,t["font-style"]=!0,t["font-synthesis"]=!0,t["font-variant"]=!0,t["font-variant-alternates"]=!0,t["font-variant-caps"]=!0,t["font-variant-east-asian"]=!0,t["font-variant-ligatures"]=!0,t["font-variant-numeric"]=!0,t["font-variant-position"]=!0,t["font-weight"]=!0,t.grid=!1,t["grid-area"]=!1,t["grid-auto-columns"]=!1,t["grid-auto-flow"]=!1,t["grid-auto-rows"]=!1,t["grid-column"]=!1,t["grid-column-end"]=!1,t["grid-column-start"]=!1,t["grid-row"]=!1,t["grid-row-end"]=!1,t["grid-row-start"]=!1,t["grid-template"]=!1,t["grid-template-areas"]=!1,t["grid-template-columns"]=!1,t["grid-template-rows"]=!1,t["hanging-punctuation"]=!1,t.height=!0,t.hyphens=!1,t.icon=!1,t["image-orientation"]=!1,t["image-resolution"]=!1,t["ime-mode"]=!1,t["initial-letters"]=!1,t["inline-box-align"]=!1,t["justify-content"]=!1,t["justify-items"]=!1,t["justify-self"]=!1,t.left=!1,t["letter-spacing"]=!0,t["lighting-color"]=!0,t["line-box-contain"]=!1,t["line-break"]=!1,t["line-grid"]=!1,t["line-height"]=!1,t["line-snap"]=!1,t["line-stacking"]=!1,t["line-stacking-ruby"]=!1,t["line-stacking-shift"]=!1,t["line-stacking-strategy"]=!1,t["list-style"]=!0,t["list-style-image"]=!0,t["list-style-position"]=!0,t["list-style-type"]=!0,t.margin=!0,t["margin-bottom"]=!0,t["margin-left"]=!0,t["margin-right"]=!0,t["margin-top"]=!0,t["marker-offset"]=!1,t["marker-side"]=!1,t.marks=!1,t.mask=!1,t["mask-box"]=!1,t["mask-box-outset"]=!1,t["mask-box-repeat"]=!1,t["mask-box-slice"]=!1,t["mask-box-source"]=!1,t["mask-box-width"]=!1,t["mask-clip"]=!1,t["mask-image"]=!1,t["mask-origin"]=!1,t["mask-position"]=!1,t["mask-repeat"]=!1,t["mask-size"]=!1,t["mask-source-type"]=!1,t["mask-type"]=!1,t["max-height"]=!0,t["max-lines"]=!1,t["max-width"]=!0,t["min-height"]=!0,t["min-width"]=!0,t["move-to"]=!1,t["nav-down"]=!1,t["nav-index"]=!1,t["nav-left"]=!1,t["nav-right"]=!1,t["nav-up"]=!1,t["object-fit"]=!1,t["object-position"]=!1,t.opacity=!1,t.order=!1,t.orphans=!1,t.outline=!1,t["outline-color"]=!1,t["outline-offset"]=!1,t["outline-style"]=!1,t["outline-width"]=!1,t.overflow=!1,t["overflow-wrap"]=!1,t["overflow-x"]=!1,t["overflow-y"]=!1,t.padding=!0,t["padding-bottom"]=!0,t["padding-left"]=!0,t["padding-right"]=!0,t["padding-top"]=!0,t.page=!1,t["page-break-after"]=!1,t["page-break-before"]=!1,t["page-break-inside"]=!1,t["page-policy"]=!1,t.pause=!1,t["pause-after"]=!1,t["pause-before"]=!1,t.perspective=!1,t["perspective-origin"]=!1,t.pitch=!1,t["pitch-range"]=!1,t["play-during"]=!1,t.position=!1,t["presentation-level"]=!1,t.quotes=!1,t["region-fragment"]=!1,t.resize=!1,t.rest=!1,t["rest-after"]=!1,t["rest-before"]=!1,t.richness=!1,t.right=!1,t.rotation=!1,t["rotation-point"]=!1,t["ruby-align"]=!1,t["ruby-merge"]=!1,t["ruby-position"]=!1,t["shape-image-threshold"]=!1,t["shape-outside"]=!1,t["shape-margin"]=!1,t.size=!1,t.speak=!1,t["speak-as"]=!1,t["speak-header"]=!1,t["speak-numeral"]=!1,t["speak-punctuation"]=!1,t["speech-rate"]=!1,t.stress=!1,t["string-set"]=!1,t["tab-size"]=!1,t["table-layout"]=!1,t["text-align"]=!0,t["text-align-last"]=!0,t["text-combine-upright"]=!0,t["text-decoration"]=!0,t["text-decoration-color"]=!0,t["text-decoration-line"]=!0,t["text-decoration-skip"]=!0,t["text-decoration-style"]=!0,t["text-emphasis"]=!0,t["text-emphasis-color"]=!0,t["text-emphasis-position"]=!0,t["text-emphasis-style"]=!0,t["text-height"]=!0,t["text-indent"]=!0,t["text-justify"]=!0,t["text-orientation"]=!0,t["text-overflow"]=!0,t["text-shadow"]=!0,t["text-space-collapse"]=!0,t["text-transform"]=!0,t["text-underline-position"]=!0,t["text-wrap"]=!0,t.top=!1,t.transform=!1,t["transform-origin"]=!1,t["transform-style"]=!1,t.transition=!1,t["transition-delay"]=!1,t["transition-duration"]=!1,t["transition-property"]=!1,t["transition-timing-function"]=!1,t["unicode-bidi"]=!1,t["vertical-align"]=!1,t.visibility=!1,t["voice-balance"]=!1,t["voice-duration"]=!1,t["voice-family"]=!1,t["voice-pitch"]=!1,t["voice-range"]=!1,t["voice-rate"]=!1,t["voice-stress"]=!1,t["voice-volume"]=!1,t.volume=!1,t["white-space"]=!1,t.widows=!1,t.width=!0,t["will-change"]=!1,t["word-break"]=!0,t["word-spacing"]=!0,t["word-wrap"]=!0,t["wrap-flow"]=!1,t["wrap-through"]=!1,t["writing-mode"]=!1,t["z-index"]=!1,t}function DZe(t,e,r){}function NZe(t,e,r){}var FZe=/javascript\s*\:/img;function kZe(t,e){return FZe.test(e)?"":e}V2.whiteList=rRe();V2.getDefaultWhiteList=rRe;V2.onAttr=DZe;V2.onIgnoreAttr=NZe;V2.safeAttrValue=kZe;var UZe={indexOf:function(t,e){var r,i;if(Array.prototype.indexOf)return t.indexOf(e);for(r=0,i=t.length;r<i;r++)if(t[r]===e)return r;return-1},forEach:function(t,e,r){var i,n;if(Array.prototype.forEach)return t.forEach(e,r);for(i=0,n=t.length;i<n;i++)e.call(r,t[i],i,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(t){return String.prototype.trimRight?t.trimRight():t.replace(/(\s*$)/g,"")}},hM=UZe;function zZe(t,e){t=hM.trimRight(t),t[t.length-1]!==";"&&(t+=";");var r=t.length,i=!1,n=0,s=0,o="";function a(){if(!i){var h=hM.trim(t.slice(n,s)),p=h.indexOf(":");if(p!==-1){var f=hM.trim(h.slice(0,p)),m=hM.trim(h.slice(p+1));if(f){var g=e(n,o.length,f,m,h);g&&(o+=g+"; ")}}}n=s+1}for(;s<r;s++){var l=t[s];if(l==="/"&&t[s+1]==="*"){var c=t.indexOf("*/",s+2);if(c===-1)break;s=c+1,n=s+1,i=!1}else l==="("?i=!0:l===")"?i=!1:l===";"?i||a():l===`
`&&a()}return hM.trim(o)}var VZe=zZe,HF=V2,BZe=VZe;function Ide(t){return t==null}function jZe(t){var e={};for(var r in t)e[r]=t[r];return e}function iRe(t){t=jZe(t||{}),t.whiteList=t.whiteList||HF.whiteList,t.onAttr=t.onAttr||HF.onAttr,t.onIgnoreAttr=t.onIgnoreAttr||HF.onIgnoreAttr,t.safeAttrValue=t.safeAttrValue||HF.safeAttrValue,this.options=t}iRe.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,r=e.options,i=r.whiteList,n=r.onAttr,s=r.onIgnoreAttr,o=r.safeAttrValue,a=BZe(t,function(l,c,h,p,f){var m=i[h],g=!1;if(m===!0?g=m:typeof m=="function"?g=m(p):m instanceof RegExp&&(g=m.test(p)),g!==!0&&(g=!1),p=o(h,p),!!p){var _={position:c,sourcePosition:l,source:f,isWhite:g};if(g){var b=n(h,p,_);return Ide(b)?h+":"+p:b}else{var b=s(h,p,_);if(!Ide(b))return b}}});return a};var GZe=iRe;(function(t,e){var r=V2,i=GZe;function n(o,a){var l=new i(a);return l.process(o)}e=t.exports=n,e.FilterCSS=i;for(var s in r)e[s]=r[s]})(ZL,ZL.exports);var hse={indexOf:function(t,e){var r,i;if(Array.prototype.indexOf)return t.indexOf(e);for(r=0,i=t.length;r<i;r++)if(t[r]===e)return r;return-1},forEach:function(t,e,r){var i,n;if(Array.prototype.forEach)return t.forEach(e,r);for(i=0,n=t.length;i<n;i++)e.call(r,t[i],i,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(t){var e=/\s|\n|\t/,r=e.exec(t);return r?r.index:-1}},HZe=ZL.exports.FilterCSS,qZe=ZL.exports.getDefaultWhiteList,pz=hse;function nRe(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var sRe=new HZe;function WZe(t,e,r){}function XZe(t,e,r){}function YZe(t,e,r){}function ZZe(t,e,r){}function oRe(t){return t.replace(KZe,"&lt;").replace(QZe,"&gt;")}function JZe(t,e,r,i){if(r=dRe(r),e==="href"||e==="src"){if(r=pz.trim(r),r==="#")return"#";if(!(r.substr(0,7)==="http://"||r.substr(0,8)==="https://"||r.substr(0,7)==="mailto:"||r.substr(0,4)==="tel:"||r.substr(0,11)==="data:image/"||r.substr(0,6)==="ftp://"||r.substr(0,2)==="./"||r.substr(0,3)==="../"||r[0]==="#"||r[0]==="/"))return""}else if(e==="background"){if(qF.lastIndex=0,qF.test(r))return""}else if(e==="style"){if($de.lastIndex=0,$de.test(r)||(Lde.lastIndex=0,Lde.test(r)&&(qF.lastIndex=0,qF.test(r))))return"";i!==!1&&(i=i||sRe,r=i.process(r))}return r=pRe(r),r}var KZe=/</g,QZe=/>/g,eJe=/"/g,tJe=/&quot;/g,rJe=/&#([a-zA-Z0-9]*);?/gim,iJe=/&colon;?/gim,nJe=/&newline;?/gim,qF=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,$de=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,Lde=/u\s*r\s*l\s*\(.*/gi;function aRe(t){return t.replace(eJe,"&quot;")}function lRe(t){return t.replace(tJe,'"')}function cRe(t){return t.replace(rJe,function(r,i){return i[0]==="x"||i[0]==="X"?String.fromCharCode(parseInt(i.substr(1),16)):String.fromCharCode(parseInt(i,10))})}function uRe(t){return t.replace(iJe,":").replace(nJe," ")}function hRe(t){for(var e="",r=0,i=t.length;r<i;r++)e+=t.charCodeAt(r)<32?" ":t.charAt(r);return pz.trim(e)}function dRe(t){return t=lRe(t),t=cRe(t),t=uRe(t),t=hRe(t),t}function pRe(t){return t=aRe(t),t=oRe(t),t}function sJe(){return""}function oJe(t,e){typeof e!="function"&&(e=function(){});var r=!Array.isArray(t);function i(o){return r?!0:pz.indexOf(t,o)!==-1}var n=[],s=!1;return{onIgnoreTag:function(o,a,l){if(i(o))if(l.isClosing){var c="[/removed]",h=l.position+c.length;return n.push([s!==!1?s:l.position,h]),s=!1,c}else return s||(s=l.position),"[removed]";else return e(o,a,l)},remove:function(o){var a="",l=0;return pz.forEach(n,function(c){a+=o.slice(l,c[0]),l=c[1]}),a+=o.slice(l),a}}}function aJe(t){for(var e="",r=0;r<t.length;){var i=t.indexOf("<!--",r);if(i===-1){e+=t.slice(r);break}e+=t.slice(r,i);var n=t.indexOf("-->",i);if(n===-1)break;r=n+3}return e}function lJe(t){var e=t.split("");return e=e.filter(function(r){var i=r.charCodeAt(0);return i===127?!1:i<=31?i===10||i===13:!0}),e.join("")}Ms.whiteList=nRe();Ms.getDefaultWhiteList=nRe;Ms.onTag=WZe;Ms.onIgnoreTag=XZe;Ms.onTagAttr=YZe;Ms.onIgnoreTagAttr=ZZe;Ms.safeAttrValue=JZe;Ms.escapeHtml=oRe;Ms.escapeQuote=aRe;Ms.unescapeQuote=lRe;Ms.escapeHtmlEntities=cRe;Ms.escapeDangerHtml5Entities=uRe;Ms.clearNonPrintableCharacter=hRe;Ms.friendlyAttrValue=dRe;Ms.escapeAttrValue=pRe;Ms.onIgnoreTagStripAll=sJe;Ms.StripTagBody=oJe;Ms.stripCommentTag=aJe;Ms.stripBlankChar=lJe;Ms.cssFilter=sRe;Ms.getDefaultCSSWhiteList=qZe;var sB={},I1=hse;function cJe(t){var e=I1.spaceIndex(t),r;return e===-1?r=t.slice(1,-1):r=t.slice(1,e+1),r=I1.trim(r).toLowerCase(),r.slice(0,1)==="/"&&(r=r.slice(1)),r.slice(-1)==="/"&&(r=r.slice(0,-1)),r}function uJe(t){return t.slice(0,2)==="</"}function hJe(t,e,r){var i="",n=0,s=!1,o=!1,a=0,l=t.length,c="",h="";e:for(a=0;a<l;a++){var p=t.charAt(a);if(s===!1){if(p==="<"){s=a;continue}}else if(o===!1){if(p==="<"){i+=r(t.slice(n,a)),s=a,n=a;continue}if(p===">"){i+=r(t.slice(n,s)),h=t.slice(s,a+1),c=cJe(h),i+=e(s,i.length,c,h,uJe(h)),n=a+1,s=!1;continue}if(p==='"'||p==="'")for(var f=1,m=t.charAt(a-f);m.trim()===""||m==="=";){if(m==="="){o=p;continue e}m=t.charAt(a-++f)}}else if(p===o){o=!1;continue}}return n<t.length&&(i+=r(t.substr(n))),i}var dJe=/[^a-zA-Z0-9\\_:.-]/gim;function pJe(t,e){var r=0,i=0,n=[],s=!1,o=t.length;function a(f,m){if(f=I1.trim(f),f=f.replace(dJe,"").toLowerCase(),!(f.length<1)){var g=e(f,m||"");g&&n.push(g)}}for(var l=0;l<o;l++){var c=t.charAt(l),h,p;if(s===!1&&c==="="){s=t.slice(r,l),r=l+1,i=t.charAt(r)==='"'||t.charAt(r)==="'"?r:mJe(t,l+1);continue}if(s!==!1&&l===i){if(p=t.indexOf(c,l+1),p===-1)break;h=I1.trim(t.slice(i+1,p)),a(s,h),s=!1,l=p,r=l+1;continue}if(/\s|\n|\t/.test(c))if(t=t.replace(/\s|\n|\t/g," "),s===!1)if(p=fJe(t,l),p===-1){h=I1.trim(t.slice(r,l)),a(h),s=!1,r=l+1;continue}else{l=p-1;continue}else if(p=gJe(t,l-1),p===-1){h=I1.trim(t.slice(r,l)),h=Dde(h),a(s,h),s=!1,r=l+1;continue}else continue}return r<t.length&&(s===!1?a(t.slice(r)):a(s,Dde(I1.trim(t.slice(r))))),I1.trim(n.join(" "))}function fJe(t,e){for(;e<t.length;e++){var r=t[e];if(r!==" ")return r==="="?e:-1}}function mJe(t,e){for(;e<t.length;e++){var r=t[e];if(r!==" ")return r==="'"||r==='"'?e:-1}}function gJe(t,e){for(;e>0;e--){var r=t[e];if(r!==" ")return r==="="?e:-1}}function yJe(t){return t[0]==='"'&&t[t.length-1]==='"'||t[0]==="'"&&t[t.length-1]==="'"}function Dde(t){return yJe(t)?t.substr(1,t.length-2):t}sB.parseTag=hJe;sB.parseAttr=pJe;var _Je=ZL.exports.FilterCSS,Of=Ms,fRe=sB,vJe=fRe.parseTag,bJe=fRe.parseAttr,O6=hse;function WF(t){return t==null}function wJe(t){var e=O6.spaceIndex(t);if(e===-1)return{html:"",closing:t[t.length-2]==="/"};t=O6.trim(t.slice(e+1,-1));var r=t[t.length-1]==="/";return r&&(t=O6.trim(t.slice(0,-1))),{html:t,closing:r}}function xJe(t){var e={};for(var r in t)e[r]=t[r];return e}function TJe(t){var e={};for(var r in t)Array.isArray(t[r])?e[r.toLowerCase()]=t[r].map(function(i){return i.toLowerCase()}):e[r.toLowerCase()]=t[r];return e}function mRe(t){t=xJe(t||{}),t.stripIgnoreTag&&(t.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),t.onIgnoreTag=Of.onIgnoreTagStripAll),t.whiteList||t.allowList?t.whiteList=TJe(t.whiteList||t.allowList):t.whiteList=Of.whiteList,t.onTag=t.onTag||Of.onTag,t.onTagAttr=t.onTagAttr||Of.onTagAttr,t.onIgnoreTag=t.onIgnoreTag||Of.onIgnoreTag,t.onIgnoreTagAttr=t.onIgnoreTagAttr||Of.onIgnoreTagAttr,t.safeAttrValue=t.safeAttrValue||Of.safeAttrValue,t.escapeHtml=t.escapeHtml||Of.escapeHtml,this.options=t,t.css===!1?this.cssFilter=!1:(t.css=t.css||{},this.cssFilter=new _Je(t.css))}mRe.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,r=e.options,i=r.whiteList,n=r.onTag,s=r.onIgnoreTag,o=r.onTagAttr,a=r.onIgnoreTagAttr,l=r.safeAttrValue,c=r.escapeHtml,h=e.cssFilter;r.stripBlankChar&&(t=Of.stripBlankChar(t)),r.allowCommentTag||(t=Of.stripCommentTag(t));var p=!1;r.stripIgnoreTagBody&&(p=Of.StripTagBody(r.stripIgnoreTagBody,s),s=p.onIgnoreTag);var f=vJe(t,function(m,g,_,b,w){var x={sourcePosition:m,position:g,isClosing:w,isWhite:Object.prototype.hasOwnProperty.call(i,_)},T=n(_,b,x);if(!WF(T))return T;if(x.isWhite){if(x.isClosing)return"</"+_+">";var E=wJe(b),C=i[_],A=bJe(E.html,function(I,M){var D=O6.indexOf(C,I)!==-1,U=o(_,I,M,D);return WF(U)?D?(M=l(_,I,M,h),M?I+'="'+M+'"':I):(U=a(_,I,M,D),WF(U)?void 0:U):U});return b="<"+_,A&&(b+=" "+A),E.closing&&(b+=" /"),b+=">",b}else return T=s(_,b,x),WF(T)?c(b):T},c);return p&&(f=p.remove(f)),f};var SJe=mRe;(function(t,e){var r=Ms,i=sB,n=SJe;function s(a,l){var c=new n(l);return c.process(a)}e=t.exports=s,e.filterXSS=s,e.FilterXSS=n,function(){for(var a in r)e[a]=r[a];for(var l in i)e[l]=i[l]}();function o(){return typeof self<"u"&&typeof DedicatedWorkerGlobalScope<"u"&&self instanceof DedicatedWorkerGlobalScope}o()&&(self.filterXSS=t.exports)})(HT,HT.exports);var EJe=function(){function t(e,r){var i=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(s,o,a,l){return s==="a"&&o==="href"||(s==="img"||s==="source")&&o==="src"?i.sanitizeUrl(a):HT.exports.safeAttrValue(s,o,a,l)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"};var n;e&&!r?n=e:e&&r?(n=Object.create(this.arcgisFilterOptions),Object.keys(e).forEach(function(s){s==="whiteList"?n.whiteList=i._extendObjectOfArrays([i.arcgisWhiteList,e.whiteList||{}]):n[s]=e[s]})):(n=Object.create(this.arcgisFilterOptions),n.whiteList=this.arcgisWhiteList),this.xssFilterOptions=n,this._xssFilter=new HT.exports.FilterXSS(n)}return t.prototype.sanitize=function(e,r){switch(r===void 0&&(r={}),typeof e){case"number":return isNaN(e)||!isFinite(e)?null:e;case"boolean":return e;case"string":return this._xssFilter.process(e);case"object":return this._iterateOverObject(e,r);default:return r.allowUndefined&&typeof e>"u"?void 0:null}},t.prototype.sanitizeUrl=function(e,r){var i=(r??{}).isProtocolRequired,n=i===void 0?!0:i,s=this._trim(e.substring(0,e.indexOf(":"))),o=e==="/",a=/^#/.test(e),l=s&&this.allowedProtocols.indexOf(s.toLowerCase())>-1;return o||a||l?HT.exports.escapeAttrValue(e):!s&&!n?HT.exports.escapeAttrValue("https://".concat(e)):""},t.prototype.sanitizeHTMLAttribute=function(e,r,i,n){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(e,r,i,n):HT.exports.safeAttrValue(e,r,i,n)},t.prototype.validate=function(e,r){r===void 0&&(r={});var i=this.sanitize(e,r);return{isValid:e===i,sanitized:i}},t.prototype.encodeHTML=function(e){var r=this;return String(e).replace(/[&<>"'\/]/g,function(i){return r._entityMap[i]})},t.prototype.encodeAttrValue=function(e){var r=/^[a-zA-Z0-9]$/;return String(e).replace(/[\x00-\xFF]/g,function(i,n){return r.test(i)?i:"&#x".concat(Number(e.charCodeAt(n)).toString(16),";")})},t.prototype._extendObjectOfArrays=function(e){var r={};return e.forEach(function(i){Object.keys(i).forEach(function(n){Array.isArray(i[n])&&Array.isArray(r[n])?r[n]=r[n].concat(i[n]):r[n]=i[n]})}),r},t.prototype._iterateOverObject=function(e,r){var i=this;r===void 0&&(r={});try{var n=!1,s=void 0;if(Array.isArray(e))s=e.reduce(function(a,l){var c=i.validate(l,r);return c.isValid?a.concat([l]):(n=!0,a.concat([c.sanitized]))},[]);else if(LZe(e)){var o=Object.keys(e);s=o.reduce(function(a,l){var c=e[l],h=i.validate(c,r);return h.isValid?a[l]=c:(n=!0,a[l]=h.sanitized),a},{})}else return r.allowUndefined&&typeof e>"u"?void 0:null;return n?s:e}catch{return null}},t.prototype._trim=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},t}();const oB=new Map;function gRe(){oB.clear()}function CJe(t){return oB.get(t)}function AJe(t,e){oB.set(t,e)}function Qj(t){oB.delete(t)}var a2,EO,RJe=function(t){if("WebkitTransition"in t.style)a2="webkitTransitionEnd",EO="webkitAnimationEnd";else{if(!("transition"in t.style))throw new Error("Your browser is not supported!");a2="transitionend",EO="animationend"}},yRe=function(t){a2||RJe(t)},OJe=function(t,e){return e===void 0&&(e=t+"-active"),function(r){yRe(r);var i=!1,n=function(s){i||(i=!0,r.removeEventListener(a2,n),r.removeEventListener(EO,n),r.classList.remove(t),r.classList.remove(e))};r.classList.add(t),r.addEventListener(a2,n),r.addEventListener(EO,n),requestAnimationFrame(function(){r.classList.add(e)})}},MJe=function(t,e){return e===void 0&&(e=t+"-active"),function(r,i){yRe(r);var n=!1,s=function(o){n||(n=!0,r.removeEventListener(a2,s),r.removeEventListener(EO,s),i())};r.classList.add(t),r.addEventListener(a2,s),r.addEventListener(EO,s),requestAnimationFrame(function(){r.classList.add(e)})}};const PJe=re.getLogger("esri.widgets.support.widgetUtils");function _Re(t){const e=Nc.acquire();for(let i=0;i<arguments.length;i++){const n=arguments[i],s=typeof n;if(s==="string")e.push(n);else if(Array.isArray(n))e.push.apply(e,n);else if(s==="object")for(const o in n)n[o]&&e.push(o)}const r=e.join(" ");return Nc.release(e),r}(()=>{const t=new Map,e=new ResizeObserver(r=>{var i;gRe();for(const n of r)(i=t.get(n.target))==null||i(n)});return(r,i,n)=>(t.has(r)&&PJe.error("Already observing element",r),t.set(r,i),e.observe(r,n),am(()=>{e.unobserve(r),t.delete(r)}))})();function Ng(t){const e=t==null?void 0:t.closest("[dir]");return e!==null&&e instanceof HTMLElement&&e.dir==="rtl"||document.dir==="rtl"}function Nde(t){const e="data-node-ref";this[t.getAttribute(e)]=null}function fz(t){const e="data-node-ref";this[t.getAttribute(e)]=t}function IJe(t,e){return(t==="enter"?OJe:MJe)(e)}const $Je=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],LJe=$Je.reduce((t,e)=>(t[e]=[],t),{}),DJe=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],vRe=new EJe({whiteList:LJe,onTagAttr:(t,e,r)=>{const i=`${e}="${r}"`;if(DJe.includes(e))return i},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function NJe(t){return t==="Enter"||t===" "}const bRe="http://www.w3.org/",aB=`${bRe}2000/svg`,wRe=`${bRe}1999/xlink`;let Fde=[],dse=(t,e)=>{let r={};return Object.keys(t).forEach(i=>{r[i]=t[i]}),e&&Object.keys(e).forEach(i=>{r[i]=e[i]}),r},pse=(t,e)=>t.vnodeSelector===e.vnodeSelector&&(t.properties&&e.properties?t.properties.key===e.properties.key&&t.properties.bind===e.properties.bind:!t.properties&&!e.properties),xRe=t=>{if(typeof t!="string")throw new Error("Style values must be strings")},FJe=(t,e,r)=>{if(e.vnodeSelector!==""){for(let i=r;i<t.length;i++)if(pse(t[i],e))return i}return-1},eG=(t,e,r,i)=>{let n=t[e];if(n.vnodeSelector==="")return;let s=n.properties;if(!(s&&(s.key===void 0?s.bind:s.key))){for(let o=0;o<t.length;o++)if(o!==e){let a=t[o];if(pse(a,n))throw new Error(`${r.vnodeSelector} had a ${n.vnodeSelector} child ${i==="added"?i:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},kJe=t=>{if(t.properties){let e=t.properties.enterAnimation;e&&e(t.domNode,t.properties)}},cJ=[],uJ=!1,TRe=t=>{(t.children||[]).forEach(TRe),t.properties&&t.properties.afterRemoved&&t.properties.afterRemoved.apply(t.properties.bind||t.properties,[t.domNode])},kde=()=>{uJ=!1,cJ.forEach(TRe),cJ.length=0},Ude=t=>{cJ.push(t),uJ||(uJ=!0,typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(kde,{timeout:16}):setTimeout(kde,16))},zde=t=>{let e=t.domNode;if(t.properties){let r=t.properties.exitAnimation;if(r)return e.style.pointerEvents="none",void r(e,()=>{e.parentNode&&(e.parentNode.removeChild(e),Ude(t))},t.properties)}e.parentNode&&(e.parentNode.removeChild(e),Ude(t))},UJe=(t,e,r)=>{if(!e)return;let i=r.eventHandlerInterceptor,n=Object.keys(e),s=n.length;for(let o=0;o<s;o++){let a=n[o],l=e[a];if(a==="className")throw new Error('Property "className" is not supported, use "class".');if(a==="class")hJ(t,l,!0);else if(a==="classes"){let c=Object.keys(l),h=c.length;for(let p=0;p<h;p++){let f=c[p];l[f]&&t.classList.add(f)}}else if(a==="styles"){let c=Object.keys(l),h=c.length;for(let p=0;p<h;p++){let f=c[p],m=l[f];m&&(xRe(m),r.styleApplyer(t,f,m))}}else if(a!=="key"&&l!=null){let c=typeof l;c==="function"?(a.lastIndexOf("on",0)===0&&(i&&(l=i(a,l,t,e)),a==="oninput"&&function(){let h=l;l=function(p){h.apply(this,[p]),p.target["oninput-value"]=p.target.value}}()),t[a]=l):r.namespace===aB?a==="href"?t.setAttributeNS(wRe,a,l):t.setAttribute(a,l):c==="string"&&a!=="value"?a==="innerHTML"?t[a]=vRe.sanitize(l):SRe(t)&&a in t?t[a]=l:t.setAttribute(a,l):t[a]=l}}};function SRe(t){if(!(t instanceof Element&&t.tagName.includes("-")))return!1;const e=window.customElements.get(t.tagName.toLowerCase());return!!e&&t instanceof e}let mz,zJe=(t,e,r)=>{if(e)for(let i of e)XA(i,t,void 0,r)},ERe=(t,e,r)=>{zJe(t,e.children,r),e.text&&(t.textContent=e.text),UJe(t,e.properties,r),e.properties&&e.properties.afterCreate&&e.properties.afterCreate.apply(e.properties.bind||e.properties,[t,r,e.vnodeSelector,e.properties,e.children])},XA=(t,e,r,i)=>{let n,s=0,o=t.vnodeSelector,a=e.ownerDocument;if(o==="")n=t.domNode=a.createTextNode(t.text),r!==void 0?e.insertBefore(n,r):e.appendChild(n);else{for(let l=0;l<=o.length;++l){let c=o.charAt(l);if(l===o.length||c==="."||c==="#"){let h=o.charAt(s-1),p=o.slice(s,l);h==="."?n.classList.add(p):h==="#"?n.id=p:(p==="svg"&&(i=dse(i,{namespace:aB})),i.namespace!==void 0?n=t.domNode=a.createElementNS(i.namespace,p):(n=t.domNode=t.domNode||a.createElement(p),p==="input"&&t.properties&&t.properties.type!==void 0&&n.setAttribute("type",t.properties.type)),r!==void 0?e.insertBefore(n,r):n.parentNode!==e&&e.appendChild(n)),s=l+1}}ERe(n,t,i)}},hJ=(t,e,r)=>{e&&e.split(" ").forEach(i=>{i&&t.classList.toggle(i,r)})},VJe=(t,e,r,i)=>{if(!r)return;let n=!1,s=Object.keys(r),o=s.length;for(let a=0;a<o;a++){let l=s[a],c=r[l],h=e[l];if(l==="class")h!==c&&(hJ(t,h,!1),hJ(t,c,!0));else if(l==="classes"){let p=t.classList,f=Object.keys(c),m=f.length;for(let g=0;g<m;g++){let _=f[g],b=!!c[_];b!==!!h[_]&&(n=!0,b?p.add(_):p.remove(_))}}else if(l==="styles"){let p=Object.keys(c),f=p.length;for(let m=0;m<f;m++){let g=p[m],_=c[g];_!==h[g]&&(n=!0,_?(xRe(_),i.styleApplyer(t,g,_)):i.styleApplyer(t,g,""))}}else if(c||typeof h!="string"||(c=""),l==="value"){let p=t[l];p!==c&&(t["oninput-value"]?p===t["oninput-value"]:c!==h)&&(t[l]=c,t["oninput-value"]=void 0),c!==h&&(n=!0)}else if(c!==h){let p=typeof c;p==="function"&&i.eventHandlerInterceptor||(i.namespace===aB?l==="href"?t.setAttributeNS(wRe,l,c):t.setAttribute(l,c):p==="string"?l==="innerHTML"?t[l]=vRe.sanitize(c):l==="role"&&c===""?t.removeAttribute(l):SRe(t)&&l in t?t[l]=c:t.setAttribute(l,c):t[l]!==c&&(t[l]=c),n=!0)}}return n},BJe=(t,e,r,i,n)=>{if(r===i)return!1;i=i||Fde;let s,o=(r=r||Fde).length,a=i.length,l=0,c=0,h=!1;for(;c<a;){let p=l<o?r[l]:void 0,f=i[c];if(p!==void 0&&pse(p,f))h=mz(p,f,n)||h,l++;else{let m=FJe(r,f,l+1);if(m>=0){for(s=l;s<m;s++)zde(r[s]),eG(r,s,t,"removed");h=mz(r[m],f,n)||h,l=m+1}else XA(f,e,l<o?r[l].domNode:void 0,n),kJe(f),eG(i,c,t,"added")}c++}if(o>l)for(s=l;s<o;s++)zde(r[s]),eG(r,s,t,"removed");return h};mz=(t,e,r)=>{let i=t.domNode,n=!1;if(t===e)return!1;let s=!1;if(e.vnodeSelector===""){if(e.text!==t.text){let o=i.ownerDocument.createTextNode(e.text);return i.parentNode.replaceChild(o,i),e.domNode=o,n=!0,n}e.domNode=i}else e.vnodeSelector.lastIndexOf("svg",0)===0&&(r=dse(r,{namespace:aB})),t.text!==e.text&&(s=!0,e.text===void 0?i.removeChild(i.firstChild):i.textContent=e.text),e.domNode=i,s=BJe(e,i,t.children,e.children,r)||s,s=VJe(i,t.properties,e.properties,r)||s,e.properties&&e.properties.afterUpdate&&e.properties.afterUpdate.apply(e.properties.bind||e.properties,[i,r,e.vnodeSelector,e.properties,e.children]);return s&&e.properties&&e.properties.updateAnimation&&e.properties.updateAnimation(i,e.properties,t.properties),n};let dM=(t,e)=>({getLastRender:()=>t,update:r=>{if(t.vnodeSelector!==r.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let i=t;t=r,mz(i,r,e)},domNode:t.domNode});const jJe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,r)=>{e.charAt(0)==="-"?t.style.setProperty(e,r):t.style[e]=r}};let SC=t=>dse(jJe,t),fb={create:(t,e)=>(e=SC(e),XA(t,document.createElement("div"),void 0,e),dM(t,e)),append:(t,e,r)=>(r=SC(r),XA(e,t,void 0,r),dM(e,r)),insertBefore:(t,e,r)=>(r=SC(r),XA(e,t.parentNode,t,r),dM(e,r)),merge:(t,e,r)=>(r=SC(r),e.domNode=t,ERe(t,e,r),dM(e,r)),replace:(t,e,r)=>(r=SC(r),XA(e,t.parentNode,t,r),t.parentNode.removeChild(t),dM(e,r))},CRe,GJe=(t,e)=>{let r=[];for(;t&&t!==e;)r.push(t),t=t.parentNode;return r};CRe=Array.prototype.find?(t,e)=>t.find(e):(t,e)=>t.filter(e)[0];let HJe=(t,e)=>{let r=t;return e.forEach(i=>{r=r&&r.children?CRe(r.children,n=>n.domNode===i):void 0}),r},qJe=(t,e,r)=>{let i=function(n){r("domEvent",n);let s=e(),o=GJe(n.currentTarget,s.domNode);o.reverse();let a,l=HJe(s.getLastRender(),o);return t.scheduleRender(),l&&(a=l.properties[`on${n.type}`].apply(l.properties.bind||this,arguments)),r("domEventProcessed",n),a};return(n,s,o,a)=>i},dJ=t=>{let e,r,i=SC(t),n=i.performanceLogger,s=!0,o=!1,a=[],l=[],c=(p,f,m)=>{let g,_=()=>g;i.eventHandlerInterceptor=qJe(e,_,n),g=p(f,m(),i),a.push(g),l.push(m)},h=()=>{if(r=void 0,s){s=!1,n("renderStart",void 0);for(let p=0;p<a.length;p++){let f=l[p]();n("rendered",void 0),a[p].update(f),n("patched",void 0)}n("renderDone",void 0),s=!0}};return e={renderNow:h,scheduleRender:()=>{r||o||(r=requestAnimationFrame(h))},stop:()=>{r&&(cancelAnimationFrame(r),r=void 0),o=!0},resume:()=>{o=!1,s=!0,e.scheduleRender()},append:(p,f)=>{c(fb.append,p,f)},insertBefore:(p,f)=>{c(fb.insertBefore,p,f)},merge:(p,f)=>{c(fb.merge,p,f)},replace:(p,f)=>{c(fb.replace,p,f)},detach:p=>{for(let f=0;f<l.length;f++)if(l[f]===p)return l.splice(f,1),a.splice(f,1)[0];throw new Error("renderFunction was not found")}},e},t1=class extends be{constructor(){super(...arguments),this.items=new ct,this._watchUpdatingTracking=new Hg,this._callbacks=new Map,this._projector=dJ(),this._hiddenProjector=dJ()}get needsRender(){return this.items.length>0}get updating(){var e;return((e=this._watchUpdatingTracking)==null?void 0:e.updating)??!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,r=>{for(const i of r.added){const n=()=>i.render();this._callbacks.set(i,n),this._projector.append(this.surface,n)}for(const i of r.removed){const n=this._projector.detach(this._callbacks.get(i));this.surface.removeChild(n.domNode),this._callbacks.delete(i)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const r=this._hiddenSurface,i=this._hiddenProjector;let n;const s=()=>(n=e.render(),n);i.append(r,s),i.renderNow();const o={left:0,top:0,right:0,bottom:0};if(n&&n.domNode){const a=n.domNode.getBoundingClientRect();o.left=a.left,o.top=a.top,o.right=a.right,o.bottom=a.bottom}for(i.detach(s);r.firstChild;)r.removeChild(r.firstChild);return o}overlaps(e,r){const i=this.computeBoundingRect(e),n=this.computeBoundingRect(r);return Math.max(i.left,n.left)<=Math.min(i.right,n.right)&&Math.max(i.top,n.top)<=Math.min(i.bottom,n.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e){if(!this.items.some(i=>i.visible))return;const r=e.getContext("2d");r.save(),r.font=this._fontString(),this.items.forEach(i=>{r.save(),i.renderCanvas(r),r.restore()}),r.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};u([d({readOnly:!0})],t1.prototype,"surface",void 0),u([d({readOnly:!0})],t1.prototype,"items",void 0),u([d({readOnly:!0})],t1.prototype,"needsRender",null),u([d({readOnly:!0})],t1.prototype,"_watchUpdatingTracking",void 0),u([d({readOnly:!0})],t1.prototype,"updating",null),t1=u([$("esri.views.overlay.ViewOverlay")],t1);const Vde=t1;function ER(t,e,r,i){let n=null,s=1e3;typeof e=="number"?(s=e,i=r):(n=e??null,s=r);let o,a=0;const l=()=>{a=0,t.apply(i,o)},c=(...h)=>{n&&n.apply(i,h),o=h,s?a||(a=setTimeout(l,s)):l()};return c.remove=()=>{a&&(clearTimeout(a),a=0)},c.forceUpdate=()=>{a&&(clearTimeout(a),l())},c.hasPendingUpdates=()=>!!a,c}const WJe="randomUUID"in crypto;function ARe(){if(WJe)return crypto.randomUUID();const t=crypto.getRandomValues(new Uint16Array(8));t[3]=4095&t[3]|16384,t[4]=16383&t[4]|32768;const e=r=>t[r].toString(16).padStart(4,"0");return e(0)+e(1)+"-"+e(2)+"-"+e(3)+"-"+e(4)+"-"+e(5)+e(6)+e(7)}const XJe={handleInterceptedEvent:(t,e,r,i)=>(t.scheduleRender(),e.properties[`on${i.type}`].apply(e.properties.bind||r,[i]))},YJe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,r)=>{t.style[e]=r}},ZJe=t=>({...YJe,...t}),JJe=(t,e)=>{const r=[];for(;t&&t!==e;)r.push(t),t=t.parentNode;return r},KJe=(t,e)=>t.find(e),Bde=(t,e,r=!1)=>{let i=t;return e.forEach((n,s)=>{const o=i!=null&&i.children?KJe(i.children,a=>a.domNode===n):void 0;r&&!o&&s!==e.length-1||(i=o)}),i},QJe=t=>{let e;const r={...XJe,...t},i=ZJe(r),n=i.performanceLogger;let s,o=!0,a=!1;const l=[],c=[],h=(f,m,g)=>{var w;let _;i.eventHandlerInterceptor=(x,T,E,C)=>function(A){let I;n("domEvent",A);const M=JJe(A.currentTarget,_.domNode),D=M.some(z=>{var B;return customElements.get((B=z==null?void 0:z.tagName)==null?void 0:B.toLowerCase())});if(A.eventPhase===Event.CAPTURING_PHASE||!D)M.reverse(),I=Bde(_.getLastRender(),M);else{const z=A.composedPath(),B=z.slice(z.indexOf(A.currentTarget),z.indexOf(_.domNode)).filter(ee=>ee.getRootNode()===ee.ownerDocument).reverse();I=Bde(_.getLastRender(),B,!0)}let U;return I&&(U=r.handleInterceptedEvent(e,I,this,A)),n("domEventProcessed",A),U},(w=r.postProcessProjectionOptions)==null||w.call(r,i);const b=g();_=f(m,b,i),l.push(_),c.push(g),r.afterFirstVNodeRendered&&r.afterFirstVNodeRendered(_,b)};let p=()=>{if(s=void 0,o){o=!1,n("renderStart",void 0);for(let f=0;f<l.length;f++){const m=c[f]();n("rendered",void 0),l[f].update(m),n("patched",void 0)}n("renderDone",void 0),o=!0}};return r.modifyDoRenderImplementation&&(p=r.modifyDoRenderImplementation(p,l,c)),e={renderNow:p,scheduleRender:()=>{s||a||(s=requestAnimationFrame(p))},stop:()=>{s&&(cancelAnimationFrame(s),s=void 0),a=!0},resume:()=>{a=!1,o=!0,e.scheduleRender()},append:(f,m)=>{h(fb.append,f,m)},insertBefore:(f,m)=>{h(fb.insertBefore,f,m)},merge:(f,m)=>{h(fb.merge,f,m)},replace:(f,m)=>{h(fb.replace,f,m)},detach:f=>{for(let m=0;m<c.length;m++)if(c[m]===f)return c.splice(m,1),l.splice(m,1)[0];throw new Error("renderFunction was not found")}},e},EC={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,safari10:!1,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,cssVarShim:!1,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,dynamicImportShim:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0};let CC,RRe,lB,ORe=!1,gz=!1,fse=!1,Mh=!1,jde=null,pJ=!1;const MRe=t=>{const e=new URL(t,pl.$resourcesUrl$);return e.origin!==TN.location.origin?e.href:e.pathname},PRe=t=>pl.$resourcesUrl$=t,l2=(t,e="")=>()=>{},Gde="http://www.w3.org/1999/xlink",Hde={},eKe="http://www.w3.org/2000/svg",tKe="http://www.w3.org/1999/xhtml",rKe=t=>t!=null,mse=t=>(t=typeof t,t==="object"||t==="function"),_s=(t,e,...r)=>{let i=null,n=null,s=null,o=!1,a=!1;const l=[],c=p=>{for(let f=0;f<p.length;f++)i=p[f],Array.isArray(i)?c(i):i!=null&&typeof i!="boolean"&&((o=typeof t!="function"&&!mse(i))&&(i=String(i)),o&&a?l[l.length-1].$text$+=i:l.push(o?yz(null,i):i),a=o)};if(c(r),e){e.key&&(n=e.key),e.name&&(s=e.name);{const p=e.className||e.class;p&&(e.class=typeof p!="object"?p:Object.keys(p).filter(f=>p[f]).join(" "))}}if(typeof t=="function")return t(e===null?{}:e,l,nKe);const h=yz(t,null);return h.$attrs$=e,l.length>0&&(h.$children$=l),h.$key$=n,h.$name$=s,h},yz=(t,e)=>{const r={$flags$:0,$tag$:t,$text$:e,$elm$:null,$children$:null};return r.$attrs$=null,r.$key$=null,r.$name$=null,r},gse={},iKe=t=>t&&t.$tag$===gse,nKe={forEach:(t,e)=>t.map(qde).forEach(e),map:(t,e)=>t.map(qde).map(e).map(sKe)},qde=t=>({vattrs:t.$attrs$,vchildren:t.$children$,vkey:t.$key$,vname:t.$name$,vtag:t.$tag$,vtext:t.$text$}),sKe=t=>{if(typeof t.vtag=="function"){const r=Object.assign({},t.vattrs);return t.vkey&&(r.key=t.vkey),t.vname&&(r.name=t.vname),_s(t.vtag,r,...t.vchildren||[])}const e=yz(t.vtag,t.vtext);return e.$attrs$=t.vattrs,e.$children$=t.vchildren,e.$key$=t.vkey,e.$name$=t.vname,e},oKe=t=>$Ke.map(e=>e(t)).find(e=>!!e),aKe=(t,e)=>t!=null&&!mse(t)?e&4?t==="false"?!1:t===""||!!t:e&2?parseFloat(t):e&1?String(t):t:t,lKe=t=>t,MVt=(t,e,r)=>{const i=lKe(t);return{emit:n=>cKe(i,e,{bubbles:!!(r&4),composed:!!(r&2),cancelable:!!(r&1),detail:n})}},cKe=(t,e,r)=>{const i=pl.ce(e,r);return t.dispatchEvent(i),i},Wde=new WeakMap,uKe=(t,e,r)=>{let i=vz.get(t);NKe&&r?(i=i||new CSSStyleSheet,typeof i=="string"?i=e:i.replaceSync(e)):i=e,vz.set(t,i)},hKe=(t,e,r,i)=>{let n=IRe(e,r);const s=vz.get(n);if(t=t.nodeType===11?t:qg,s)if(typeof s=="string"){t=t.head||t;let o=Wde.get(t),a;o||Wde.set(t,o=new Set),o.has(n)||(a=qg.createElement("style"),a.innerHTML=s,t.insertBefore(a,t.querySelector("link")),o&&o.add(n))}else t.adoptedStyleSheets.includes(s)||(t.adoptedStyleSheets=[...t.adoptedStyleSheets,s]);return n},dKe=t=>{const e=t.$cmpMeta$,r=t.$hostElement$,i=e.$flags$,n=l2("attachStyles",e.$tagName$),s=hKe(r.shadowRoot?r.shadowRoot:r.getRootNode(),e,t.$modeName$);i&10&&(r["s-sc"]=s,r.classList.add(s+"-h"),i&2&&r.classList.add(s+"-s")),n()},IRe=(t,e)=>"sc-"+(e&&t.$flags$&32?t.$tagName$+"-"+e:t.$tagName$),Xde=(t,e,r,i,n,s)=>{if(r!==i){let o=Kde(t,e),a=e.toLowerCase();if(e==="class"){const l=t.classList,c=Yde(r),h=Yde(i);l.remove(...c.filter(p=>p&&!h.includes(p))),l.add(...h.filter(p=>p&&!c.includes(p)))}else if(e==="style"){for(const l in r)(!i||i[l]==null)&&(l.includes("-")?t.style.removeProperty(l):t.style[l]="");for(const l in i)(!r||i[l]!==r[l])&&(l.includes("-")?t.style.setProperty(l,i[l]):t.style[l]=i[l])}else if(e!=="key")if(e==="ref")i&&i(t);else if(!t.__lookupSetter__(e)&&e[0]==="o"&&e[1]==="n")e[2]==="-"?e=e.slice(3):Kde(TN,a)?e=a.slice(2):e=a[2]+e.slice(3),r&&pl.rel(t,e,r,!1),i&&pl.ael(t,e,i,!1);else{const l=mse(i);if((o||l&&i!==null)&&!n)try{if(t.tagName.includes("-"))t[e]=i;else{const h=i??"";e==="list"?o=!1:(r==null||t[e]!=h)&&(t[e]=h)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(e=a,c=!0),i==null||i===!1?(i!==!1||t.getAttribute(e)==="")&&(c?t.removeAttributeNS(Gde,e):t.removeAttribute(e)):(!o||s&4||n)&&!l&&(i=i===!0?"":i,c?t.setAttributeNS(Gde,e,i):t.setAttribute(e,i))}}},pKe=/\s/,Yde=t=>t?t.split(pKe):[],$Re=(t,e,r,i)=>{const n=e.$elm$.nodeType===11&&e.$elm$.host?e.$elm$.host:e.$elm$,s=t&&t.$attrs$||Hde,o=e.$attrs$||Hde;for(i in s)i in o||Xde(n,i,s[i],void 0,r,e.$flags$);for(i in o)Xde(n,i,s[i],o[i],r,e.$flags$)},_z=(t,e,r,i)=>{const n=e.$children$[r];let s=0,o,a,l;if(ORe||(fse=!0,n.$tag$==="slot"&&(CC&&i.classList.add(CC+"-s"),n.$flags$|=n.$children$?2:1)),n.$text$!==null)o=n.$elm$=qg.createTextNode(n.$text$);else if(n.$flags$&1)o=n.$elm$=qg.createTextNode("");else{if(Mh||(Mh=n.$tag$==="svg"),o=n.$elm$=qg.createElementNS(Mh?eKe:tKe,n.$flags$&2?"slot-fb":n.$tag$),Mh&&n.$tag$==="foreignObject"&&(Mh=!1),$Re(null,n,Mh),rKe(CC)&&o["s-si"]!==CC&&o.classList.add(o["s-si"]=CC),n.$children$)for(s=0;s<n.$children$.length;++s)a=_z(t,n,s,o),a&&o.appendChild(a);n.$tag$==="svg"?Mh=!1:o.tagName==="foreignObject"&&(Mh=!0)}return o["s-hn"]=lB,n.$flags$&3&&(o["s-sr"]=!0,o["s-cr"]=RRe,o["s-sn"]=n.$name$||"",l=t&&t.$children$&&t.$children$[r],l&&l.$tag$===n.$tag$&&t.$elm$&&JL(t.$elm$,!1)),o},JL=(t,e)=>{pl.$flags$|=1;const r=t.childNodes;for(let i=r.length-1;i>=0;i--){const n=r[i];n["s-hn"]!==lB&&n["s-ol"]&&(NRe(n).insertBefore(n,yse(n)),n["s-ol"].remove(),n["s-ol"]=void 0,fse=!0),e&&JL(n,e)}pl.$flags$&=-2},LRe=(t,e,r,i,n,s)=>{let o=t["s-cr"]&&t["s-cr"].parentNode||t,a;for(o.shadowRoot&&o.tagName===lB&&(o=o.shadowRoot);n<=s;++n)i[n]&&(a=_z(null,r,n,t),a&&(i[n].$elm$=a,o.insertBefore(a,yse(e))))},DRe=(t,e,r,i,n)=>{for(;e<=r;++e)(i=t[e])&&(n=i.$elm$,URe(i),gz=!0,n["s-ol"]?n["s-ol"].remove():JL(n,!0),n.remove())},fKe=(t,e,r,i)=>{let n=0,s=0,o=0,a=0,l=e.length-1,c=e[0],h=e[l],p=i.length-1,f=i[0],m=i[p],g,_;for(;n<=l&&s<=p;)if(c==null)c=e[++n];else if(h==null)h=e[--l];else if(f==null)f=i[++s];else if(m==null)m=i[--p];else if(XF(c,f))AC(c,f),c=e[++n],f=i[++s];else if(XF(h,m))AC(h,m),h=e[--l],m=i[--p];else if(XF(c,m))(c.$tag$==="slot"||m.$tag$==="slot")&&JL(c.$elm$.parentNode,!1),AC(c,m),t.insertBefore(c.$elm$,h.$elm$.nextSibling),c=e[++n],m=i[--p];else if(XF(h,f))(c.$tag$==="slot"||m.$tag$==="slot")&&JL(h.$elm$.parentNode,!1),AC(h,f),t.insertBefore(h.$elm$,c.$elm$),h=e[--l],f=i[++s];else{for(o=-1,a=n;a<=l;++a)if(e[a]&&e[a].$key$!==null&&e[a].$key$===f.$key$){o=a;break}o>=0?(_=e[o],_.$tag$!==f.$tag$?g=_z(e&&e[s],r,o,t):(AC(_,f),e[o]=void 0,g=_.$elm$),f=i[++s]):(g=_z(e&&e[s],r,s,t),f=i[++s]),g&&NRe(c.$elm$).insertBefore(g,yse(c.$elm$))}n>l?LRe(t,i[p+1]==null?null:i[p+1].$elm$,r,i,s,p):s>p&&DRe(e,n,l)},XF=(t,e)=>t.$tag$===e.$tag$?t.$tag$==="slot"?t.$name$===e.$name$:t.$key$===e.$key$:!1,yse=t=>t&&t["s-ol"]||t,NRe=t=>(t["s-ol"]?t["s-ol"]:t).parentNode,AC=(t,e)=>{const r=e.$elm$=t.$elm$,i=t.$children$,n=e.$children$,s=e.$tag$,o=e.$text$;let a;o===null?(Mh=s==="svg"?!0:s==="foreignObject"?!1:Mh,s==="slot"||$Re(t,e,Mh),i!==null&&n!==null?fKe(r,i,e,n):n!==null?(t.$text$!==null&&(r.textContent=""),LRe(r,null,e,n,0,n.length-1)):i!==null&&DRe(i,0,i.length-1),Mh&&s==="svg"&&(Mh=!1)):(a=r["s-cr"])?a.parentNode.textContent=o:t.$text$!==o&&(r.data=o)},FRe=t=>{const e=t.childNodes;let r,i,n,s,o,a;for(i=0,n=e.length;i<n;i++)if(r=e[i],r.nodeType===1){if(r["s-sr"]){for(o=r["s-sn"],r.hidden=!1,s=0;s<n;s++)if(a=e[s].nodeType,e[s]["s-hn"]!==r["s-hn"]||o!==""){if(a===1&&o===e[s].getAttribute("slot")){r.hidden=!0;break}}else if(a===1||a===3&&e[s].textContent.trim()!==""){r.hidden=!0;break}}FRe(r)}},Nf=[],kRe=t=>{let e,r,i,n,s,o,a=0;const l=t.childNodes,c=l.length;for(;a<c;a++){if(e=l[a],e["s-sr"]&&(r=e["s-cr"])&&r.parentNode)for(i=r.parentNode.childNodes,n=e["s-sn"],o=i.length-1;o>=0;o--)r=i[o],!r["s-cn"]&&!r["s-nr"]&&r["s-hn"]!==e["s-hn"]&&(Zde(r,n)?(s=Nf.find(h=>h.$nodeToRelocate$===r),gz=!0,r["s-sn"]=r["s-sn"]||n,s?s.$slotRefNode$=e:Nf.push({$slotRefNode$:e,$nodeToRelocate$:r}),r["s-sr"]&&Nf.map(h=>{Zde(h.$nodeToRelocate$,r["s-sn"])&&(s=Nf.find(p=>p.$nodeToRelocate$===r),s&&!h.$slotRefNode$&&(h.$slotRefNode$=s.$slotRefNode$))})):Nf.some(h=>h.$nodeToRelocate$===r)||Nf.push({$nodeToRelocate$:r}));e.nodeType===1&&kRe(e)}},Zde=(t,e)=>t.nodeType===1?t.getAttribute("slot")===null&&e===""||t.getAttribute("slot")===e:t["s-sn"]===e?!0:e==="",URe=t=>{t.$attrs$&&t.$attrs$.ref&&t.$attrs$.ref(null),t.$children$&&t.$children$.map(URe)},mKe=(t,e)=>{const r=t.$hostElement$,i=t.$cmpMeta$,n=t.$vnode$||yz(null,null),s=iKe(e)?e:_s(null,null,e);lB=r.tagName,i.$attrsToReflect$&&(s.$attrs$=s.$attrs$||{},i.$attrsToReflect$.map(([o,a])=>s.$attrs$[a]=r[o])),s.$tag$=null,s.$flags$|=4,t.$vnode$=s,s.$elm$=n.$elm$=r.shadowRoot||r,CC=r["s-sc"],RRe=r["s-cr"],ORe=(i.$flags$&1)!==0,gz=!1,AC(n,s);{if(pl.$flags$|=1,fse){kRe(s.$elm$);let o,a,l,c,h,p,f=0;for(;f<Nf.length;f++)o=Nf[f],a=o.$nodeToRelocate$,a["s-ol"]||(l=qg.createTextNode(""),l["s-nr"]=a,a.parentNode.insertBefore(a["s-ol"]=l,a));for(f=0;f<Nf.length;f++)if(o=Nf[f],a=o.$nodeToRelocate$,o.$slotRefNode$){for(c=o.$slotRefNode$.parentNode,h=o.$slotRefNode$.nextSibling,l=a["s-ol"];l=l.previousSibling;)if(p=l["s-nr"],p&&p["s-sn"]===a["s-sn"]&&c===p.parentNode&&(p=p.nextSibling,!p||!p["s-nr"])){h=p;break}(!h&&c!==a.parentNode||a.nextSibling!==h)&&a!==h&&(!a["s-hn"]&&a["s-ol"]&&(a["s-hn"]=a["s-ol"].parentNode.nodeName),c.insertBefore(a,h))}else a.nodeType===1&&(a.hidden=!0)}gz&&FRe(s.$elm$),pl.$flags$&=-2,Nf.length=0}},gKe=(t,e)=>{},_se=(t,e)=>(t.$flags$|=16,gKe(t,t.$ancestorComponent$),UKe(()=>yKe(t,e))),yKe=(t,e)=>{const r=t.$hostElement$,i=l2("scheduleUpdate",t.$cmpMeta$.$tagName$),n=r;let s;return e?s=CR(n,"componentWillLoad"):s=CR(n,"componentWillUpdate"),s=Jde(s,()=>CR(n,"componentWillRender")),i(),Jde(s,()=>_Ke(t,n,e))},_Ke=async(t,e,r)=>{const i=t.$hostElement$,n=l2("update",t.$cmpMeta$.$tagName$);i["s-rc"],r&&dKe(t);const s=l2("render",t.$cmpMeta$.$tagName$);vKe(t,e,i),s(),n(),bKe(t)},vKe=(t,e,r)=>{try{jde=e,e=e.render&&e.render(),t.$flags$&=-17,t.$flags$|=2,(EC.hasRenderFn||EC.reflect)&&(EC.vdomRender||EC.reflect)&&(EC.hydrateServerSide||mKe(t,e))}catch(a){xN(a,t.$hostElement$)}return jde=null,null},bKe=t=>{const e=t.$cmpMeta$.$tagName$,r=t.$hostElement$,i=l2("postUpdate",e),n=r;t.$ancestorComponent$,CR(n,"componentDidRender"),t.$flags$&64?(CR(n,"componentDidUpdate"),i()):(t.$flags$|=64,CR(n,"componentDidLoad"),i())},PVt=t=>{{const e=wN(t),r=e.$hostElement$.isConnected;return r&&(e.$flags$&18)===2&&_se(e,!1),r}},CR=(t,e,r)=>{if(t&&t[e])try{return t[e](r)}catch(i){xN(i)}},Jde=(t,e)=>t&&t.then?t.then(e):e(),wKe=(t,e)=>wN(t).$instanceValues$.get(e),xKe=(t,e,r,i)=>{const n=wN(t),s=t,o=n.$instanceValues$.get(e),a=n.$flags$,l=s;r=aKe(r,i.$members$[e][0]);const c=Number.isNaN(o)&&Number.isNaN(r);if(r!==o&&!c){n.$instanceValues$.set(e,r);{if(i.$watchers$&&a&128){const p=i.$watchers$[e];p&&p.map(f=>{try{l[f](r,o,e)}catch(m){xN(m,s)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(r,o,e)===!1)return;_se(n,!1)}}}},TKe=(t,e,r)=>{if(e.$members$){t.watchers&&(e.$watchers$=t.watchers);const i=Object.entries(e.$members$),n=t.prototype;i.map(([s,[o]])=>{(o&31||o&32)&&Object.defineProperty(n,s,{get(){return wKe(this,s)},set(a){xKe(this,s,a,e)},configurable:!0,enumerable:!0})});{const s=new Map;n.attributeChangedCallback=function(o,a,l){pl.jmp(()=>{const c=s.get(o);if(this.hasOwnProperty(c))l=this[c],delete this[c];else if(n.hasOwnProperty(c)&&typeof this[c]=="number"&&this[c]==l)return;this[c]=l===null&&typeof this[c]=="boolean"?!1:l})},t.observedAttributes=i.filter(([o,a])=>a[0]&15).map(([o,a])=>{const l=a[1]||o;return s.set(l,o),a[0]&512&&e.$attrsToReflect$.push([o,l]),l})}}return t},SKe=async(t,e,r,i,n)=>{if(!(e.$flags$&32)&&(n=t.constructor,e.$flags$|=32,customElements.whenDefined(r.$tagName$).then(()=>e.$flags$|=128),n.style)){let o=n.style;typeof o!="string"&&(o=o[e.$modeName$=oKe(t)]);const a=IRe(r,e.$modeName$);if(!vz.has(a)){const l=l2("registerStyles",r.$tagName$);uKe(a,o,!!(r.$flags$&1)),l()}}e.$ancestorComponent$,(()=>_se(e,!0))()},EKe=t=>{},CKe=t=>{if(!(pl.$flags$&1)){const e=wN(t),r=e.$cmpMeta$,i=l2("connectedCallback",r.$tagName$);e.$flags$&1?(zRe(t,e,r.$listeners$),EKe(e.$lazyInstance$)):(e.$flags$|=1,r.$flags$&12&&AKe(t),r.$members$&&Object.entries(r.$members$).map(([n,[s]])=>{if(s&31&&t.hasOwnProperty(n)){const o=t[n];delete t[n],t[n]=o}}),SKe(t,e,r)),i()}},AKe=t=>{const e=t["s-cr"]=qg.createComment("");e["s-cn"]=!0,t.insertBefore(e,t.firstChild)},RKe=t=>{if(!(pl.$flags$&1)){const e=wN(t);e.$rmListeners$&&(e.$rmListeners$.map(r=>r()),e.$rmListeners$=void 0)}},vse=(t,e)=>{const r={$flags$:e[0],$tagName$:e[1]};r.$members$=e[2],r.$listeners$=e[3],r.$watchers$=t.$watchers$,r.$attrsToReflect$=[];const i=t.prototype.connectedCallback,n=t.prototype.disconnectedCallback;return Object.assign(t.prototype,{__registerHost(){IKe(this,r)},connectedCallback(){CKe(this),i&&i.call(this)},disconnectedCallback(){RKe(this),n&&n.call(this)},__attachShadow(){this.attachShadow({mode:"open",delegatesFocus:!!(r.$flags$&16)})}}),t.is=r.$tagName$,TKe(t,r)},IVt=(t,e)=>e,zRe=(t,e,r,i)=>{r&&r.map(([n,s,o])=>{const a=MKe(t,n),l=OKe(e,o),c=PKe(n);pl.ael(a,s,l,c),(e.$rmListeners$=e.$rmListeners$||[]).push(()=>pl.rel(a,s,l,c))})},OKe=(t,e)=>r=>{try{EC.lazyLoad||t.$hostElement$[e](r)}catch(i){xN(i)}},MKe=(t,e)=>e&4?qg:e&8?TN:e&16?qg.body:t,PKe=t=>LKe?{passive:(t&1)!==0,capture:(t&2)!==0}:(t&2)!==0,VRe=new WeakMap,wN=t=>VRe.get(t),IKe=(t,e)=>{const r={$flags$:0,$hostElement$:t,$cmpMeta$:e,$instanceValues$:new Map};return zRe(t,r,e.$listeners$),VRe.set(t,r)},Kde=(t,e)=>e in t,xN=(t,e)=>(0,console.error)(t,e),vz=new Map,$Ke=[],TN=typeof window<"u"?window:{},qg=TN.document||{head:{}},bse=TN.HTMLElement||class{},pl={$flags$:0,$resourcesUrl$:"",jmp:t=>t(),raf:t=>requestAnimationFrame(t),ael:(t,e,r,i)=>t.addEventListener(e,r,i),rel:(t,e,r,i)=>t.removeEventListener(e,r,i),ce:(t,e)=>new CustomEvent(t,e)},LKe=(()=>{let t=!1;try{qg.addEventListener("e",null,Object.defineProperty({},"passive",{get(){t=!0}}))}catch{}return t})(),DKe=t=>Promise.resolve(t),NKe=(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replaceSync=="function"}catch{}return!1})(),Qde=[],BRe=[],FKe=(t,e)=>r=>{t.push(r),pJ||(pJ=!0,e&&pl.$flags$&4?kKe(fJ):pl.raf(fJ))},epe=t=>{for(let e=0;e<t.length;e++)try{t[e](performance.now())}catch(r){xN(r)}t.length=0},fJ=()=>{epe(Qde),epe(BRe),(pJ=Qde.length>0)&&pl.raf(fJ)},kKe=t=>DKe().then(t),UKe=FKe(BRe,!0);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.7
 */function zKe(t){return t.map(e=>{let r="";for(let i=0;i<e;i++)r+=((1+Math.random())*65536|0).toString(16).substring(1);return r}).join("-")}const VKe=()=>zKe([2,1,1,1,3]);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.7
 */const jRe="calcite-mode-auto",GRe="calcite-mode-dark",BKe="calcite-mode-light",$Vt={autoMode:jRe,darkMode:GRe,lightMode:BKe,rtl:"calcite--rtl"};/*!
* tabbable 6.0.1
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var HRe=["input","select","textarea","a[href]","button","[tabindex]:not(slot)","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])',"details>summary:first-of-type","details"],bz=HRe.join(","),qRe=typeof Element>"u",c2=qRe?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,wz=!qRe&&Element.prototype.getRootNode?function(t){return t.getRootNode()}:function(t){return t.ownerDocument},WRe=function(e,r,i){var n=Array.prototype.slice.apply(e.querySelectorAll(bz));return r&&c2.call(e,bz)&&n.unshift(e),n=n.filter(i),n},XRe=function t(e,r,i){for(var n=[],s=Array.from(e);s.length;){var o=s.shift();if(o.tagName==="SLOT"){var a=o.assignedElements(),l=a.length?a:o.children,c=t(l,!0,i);i.flatten?n.push.apply(n,c):n.push({scopeParent:o,candidates:c})}else{var h=c2.call(o,bz);h&&i.filter(o)&&(r||!e.includes(o))&&n.push(o);var p=o.shadowRoot||typeof i.getShadowRoot=="function"&&i.getShadowRoot(o),f=!i.shadowRootFilter||i.shadowRootFilter(o);if(p&&f){var m=t(p===!0?o.children:p.children,!0,i);i.flatten?n.push.apply(n,m):n.push({scopeParent:o,candidates:m})}else s.unshift.apply(s,o.children)}}return n},YRe=function(e,r){return e.tabIndex<0&&(r||/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||e.isContentEditable)&&isNaN(parseInt(e.getAttribute("tabindex"),10))?0:e.tabIndex},jKe=function(e,r){return e.tabIndex===r.tabIndex?e.documentOrder-r.documentOrder:e.tabIndex-r.tabIndex},ZRe=function(e){return e.tagName==="INPUT"},GKe=function(e){return ZRe(e)&&e.type==="hidden"},HKe=function(e){var r=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(i){return i.tagName==="SUMMARY"});return r},qKe=function(e,r){for(var i=0;i<e.length;i++)if(e[i].checked&&e[i].form===r)return e[i]},WKe=function(e){if(!e.name)return!0;var r=e.form||wz(e),i=function(a){return r.querySelectorAll('input[type="radio"][name="'+a+'"]')},n;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")n=i(window.CSS.escape(e.name));else try{n=i(e.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var s=qKe(n,e.form);return!s||s===e},XKe=function(e){return ZRe(e)&&e.type==="radio"},YKe=function(e){return XKe(e)&&!WKe(e)},ZKe=function(e){for(var r,i=wz(e).host,n=!!((r=i)!==null&&r!==void 0&&r.ownerDocument.contains(i)||e.ownerDocument.contains(e));!n&&i;){var s;i=wz(i).host,n=!!((s=i)!==null&&s!==void 0&&s.ownerDocument.contains(i))}return n},tpe=function(e){var r=e.getBoundingClientRect(),i=r.width,n=r.height;return i===0&&n===0},JKe=function(e,r){var i=r.displayCheck,n=r.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var s=c2.call(e,"details>summary:first-of-type"),o=s?e.parentElement:e;if(c2.call(o,"details:not([open]) *"))return!0;if(!i||i==="full"||i==="legacy-full"){if(typeof n=="function"){for(var a=e;e;){var l=e.parentElement,c=wz(e);if(l&&!l.shadowRoot&&n(l)===!0)return tpe(e);e.assignedSlot?e=e.assignedSlot:!l&&c!==e.ownerDocument?e=c.host:e=l}e=a}if(ZKe(e))return!e.getClientRects().length;if(i!=="legacy-full")return!0}else if(i==="non-zero-area")return tpe(e);return!1},KKe=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var r=e.parentElement;r;){if(r.tagName==="FIELDSET"&&r.disabled){for(var i=0;i<r.children.length;i++){var n=r.children.item(i);if(n.tagName==="LEGEND")return c2.call(r,"fieldset[disabled] *")?!0:!n.contains(e)}return!0}r=r.parentElement}return!1},xz=function(e,r){return!(r.disabled||GKe(r)||JKe(r,e)||HKe(r)||KKe(r))},mJ=function(e,r){return!(YKe(r)||YRe(r)<0||!xz(e,r))},QKe=function(e){var r=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(r)||r>=0)},eQe=function t(e){var r=[],i=[];return e.forEach(function(n,s){var o=!!n.scopeParent,a=o?n.scopeParent:n,l=YRe(a,o),c=o?t(n.candidates):a;l===0?o?r.push.apply(r,c):r.push(a):i.push({documentOrder:s,tabIndex:l,item:n,isScope:o,content:c})}),i.sort(jKe).reduce(function(n,s){return s.isScope?n.push.apply(n,s.content):n.push(s.content),n},[]).concat(r)},tQe=function(e,r){r=r||{};var i;return r.getShadowRoot?i=XRe([e],r.includeContainer,{filter:mJ.bind(null,r),flatten:!1,getShadowRoot:r.getShadowRoot,shadowRootFilter:QKe}):i=WRe(e,r.includeContainer,mJ.bind(null,r)),eQe(i)},LVt=function(e,r){r=r||{};var i;return r.getShadowRoot?i=XRe([e],r.includeContainer,{filter:xz.bind(null,r),flatten:!0,getShadowRoot:r.getShadowRoot}):i=WRe(e,r.includeContainer,xz.bind(null,r)),i},DVt=function(e,r){if(r=r||{},!e)throw new Error("No node provided");return c2.call(e,bz)===!1?!1:mJ(r,e)},rQe=HRe.concat("iframe").join(","),NVt=function(e,r){if(r=r||{},!e)throw new Error("No node provided");return c2.call(e,rQe)===!1?!1:xz(r,e)};const iQe={getShadowRoot:!0};function nQe(t){const e="dir",r=`[${e}]`,i=v3(t,r);return i?i.getAttribute(e):"ltr"}function FVt(t,e,r){const i=`[${e}]`,n=t.closest(i);return n?n.getAttribute(e):r}function JRe(t){return t.getRootNode()}function KRe(t){return t.host||null}function sQe(t,{selector:e,id:r}){function i(n){if(!n)return null;n.assignedSlot&&(n=n.assignedSlot);const s=JRe(n),o=r?"getElementById"in s?s.getElementById(r):null:e?s.querySelector(e):null,a=KRe(s);return o||(a?i(a):null)}return i(t)}function v3(t,e){function r(i){return i?i.closest(e)||r(KRe(JRe(i))):null}return r(t)}function oQe(t,e){return QRe(t,e)}function QRe(t,e){if(!t)return;const r=e(t);if(r!==void 0)return r;const{parentNode:i}=t;return QRe(i instanceof ShadowRoot?i.host:i,e)}function aQe(t,e){return!!oQe(e,r=>r===t?!0:void 0)}function lQe(t){return typeof(t==null?void 0:t.setFocus)=="function"}async function kVt(t){if(t)return lQe(t)?t.setFocus():t.focus()}function UVt(t){(tQe(t,iQe)[0]||t).focus()}const KL=":not([slot])";function zVt(t,e,r){e&&!Array.isArray(e)&&typeof e!="string"&&(r=e,e=null);const i=e?Array.isArray(e)?e.map(n=>`[slot="${n}"]`).join(","):`[slot="${e}"]`:KL;return r!=null&&r.all?cQe(t,i,r):uQe(t,i,r)}function eOe(t,e){return t?Array.from(t.children||[]).filter(r=>r==null?void 0:r.matches(e)):[]}function cQe(t,e,r){let i=e===KL?eOe(t,KL):Array.from(t.querySelectorAll(e));i=r&&r.direct===!1?i:i.filter(s=>s.parentElement===t),i=r!=null&&r.matches?i.filter(s=>s==null?void 0:s.matches(r.matches)):i;const n=r==null?void 0:r.selector;return n?i.map(s=>Array.from(s.querySelectorAll(n))).reduce((s,o)=>[...s,...o],[]).filter(s=>!!s):i}function uQe(t,e,r){let i=e===KL?eOe(t,KL)[0]||null:t.querySelector(e);i=r&&r.direct===!1||(i==null?void 0:i.parentElement)===t?i:null,i=r!=null&&r.matches?i!=null&&i.matches(r.matches)?i:null:i;const n=r==null?void 0:r.selector;return n?i==null?void 0:i.querySelector(n):i}function VVt(t,e,r){if(typeof e=="string"&&e!=="")return e;if(e==="")return t[r]}function hQe(t){return Boolean(t).toString()}function BVt(t){return!!dQe(t).length}function dQe(t){return t.target.assignedElements({flatten:!0})}function jVt(t){return!!(t.isPrimary&&t.button===0)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.7
 */function rpe(){const{classList:t}=document.body,e=window.matchMedia("(prefers-color-scheme: dark)").matches,r=()=>t.contains(GRe)||t.contains(jRe)&&e?"dark":"light",i=o=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:o}})),n=o=>{s!==o&&i(o),s=o};let s=r();i(s),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",o=>n(o.matches?"dark":"light")),new MutationObserver(()=>n(r())).observe(document.body,{attributes:!0,attributeFilter:["class"]})}function pQe(){typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document&&(document.readyState==="interactive"?rpe():document.addEventListener("DOMContentLoaded",()=>rpe(),{once:!0}))}const fQe=pQe;fQe();let tOe;function mQe(){PRe(Fc(si(tOe)))}tOe="components/assets";const rOe=Symbol("widget"),gQe=Symbol("widget-test-data"),yQe=[],_Qe={},Tz=new WeakMap;function iOe(t,e){let r=e.children;if(r&&r.length)for(let n=0;n<r.length;++n)r[n]=iOe(t,r[n]);else r=yQe;const i=e.vnodeSelector;if(wse(i)){const n=e.properties||_Qe,s=n.key||i;return{vnodeSelector:"div",properties:{key:s,afterCreate:vQe,afterUpdate:bQe,afterRemoved:nOe,parentWidget:t,widgetConstructor:i,widgetProperties:{...n,key:s,children:r}},children:void 0,text:void 0,domNode:null}}return e}function vQe(t,e,r,{parentWidget:i,widgetConstructor:n,widgetProperties:s}){var a;const o=new n(s);o.container=t,Tz.set(t,o),(a=o.afterCreate)==null||a.call(o,o,t),i._internalHandles.add(am(()=>nOe(t)))}function bQe(t,e,r,{widgetProperties:i}){var s;const n=Tz.get(t);n&&(n.set(i),(s=n.afterUpdate)==null||s.call(n,n,t))}function nOe(t){var r;const e=Tz.get(t);e&&((r=e.afterRemoved)==null||r.call(e,e,t),e.destroy(),Tz.delete(t))}function wse(t){return typeof t=="function"&&t[rOe]}const ipe=new Set;function wQe(t){ipe.add(t),t.finally(()=>ipe.delete(t))}var sOe;const xQe="esri.widgets.Widget";let TQe=0;const SQe={widgetIcon:"esri-icon-checkbox-unchecked"};function oOe(t,e){for(const r in e)t[r]!=null&&(typeof t[r]=="object"&&typeof e[r]=="object"?oOe(t[r],e==null?void 0:e[r]):t[r]=e[r]);return t}const EQe=QJe({postProcessProjectionOptions(t){const e=t.eventHandlerInterceptor,r=/capture$/i;t.eventHandlerInterceptor=(i,n,s,o)=>{const a=e==null?void 0:e(i,n,s,o),l=r.test(i);if(!((i=i.replace(r,"")).toLowerCase()in s)||l){const c=i[2].toLowerCase()+i.slice(3),h=m=>a==null?void 0:a.call(s,m);s.addEventListener(c,h,l);const p=()=>s.removeEventListener(c,h,l),f=o.afterRemoved;o.afterRemoved=m=>{f==null||f(m),p()}}return a}},handleInterceptedEvent(t,e,r,i){const{eventPhase:n,type:s}=i,o=n===Event.CAPTURING_PHASE;let a=`on${s}${o?"capture":""}`;const l=e.properties;(l&&a in l||(a=`on${s[0].toUpperCase()}${s.slice(1)}${o?"Capture":""}`,l&&a in l))&&(gRe(),t.scheduleRender(),l[a].call(l.bind||r,i))}});let tG=!1,Yo=class extends m3(Sn.EventedAccessor){constructor(e,r){super(e,r),this._attached=!1,this._internalHandles=new qr,this._projector=EQe,this._readyForTrueRender=!1,this.iconClass=SQe.widgetIcon,this.key=this,this._loadLocale=s2e(async()=>{if(this._messageBundleProps&&this._messageBundleProps.length){const o=await ha(this._messageBundleProps.map(async({bundlePath:a,propertyName:l})=>{let c=await yAe(a);this.uiStrings&&Object.keys(this.uiStrings)&&(c=oOe(se(c),this.uiStrings)),this[l]=c}));for(const a of o)a.error&&re.getLogger(this.declaredClass).error("widget-intl:locale-error",this.declaredClass,a.error)}await this.loadLocale()}),mQe();const i="esri-widget-uid-"+ARe(),n=this.render.bind(this);this._trackingTarget=new C9(()=>this.scheduleRender());const s=()=>{var p;if(!this._readyForTrueRender||this.destroyed)return null;if(!this.visible)return{vnodeSelector:"div",properties:{key:i,class:"",styles:{display:"none"}},domNode:null,children:void 0,text:void 0};const o=n();let{properties:a}=o;a||(o.properties=a={});let{key:l,styles:c}=a;l||(a.key=i),c||(a.styles=c={}),c.display||(c.display="");let h=0;return(p=o.children)==null||p.forEach(f=>{if(wse(f.vnodeSelector))return;let{properties:m}=f;m||(f.properties=m={}),m.key||(m.key=`${this.id}--${h++}`)}),iOe(this,o)};this.render=()=>{if(tG)return s();let o=CJe(this)??null;if(o)return o;this._trackingTarget.clear(),tG=!0;try{o=y_(this._trackingTarget,s)}catch(a){throw console.error(a),a}finally{tG=!1}return o&&AJe(this,o),o},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then(()=>{this._readyForTrueRender=!0,this._postInitialize()})),wQe(this._resourcesFetch)}normalizeCtorArgs(e,r){const i={...e};return r&&(i.container=r),i}postInitialize(){}beforeFirstRender(){return Promise.all([this.loadDependencies(),this._loadLocale()]).then(()=>{}).catch(lY)}async loadDependencies(){}async loadLocale(){}destroy(){this.destroyed||(ze(this._trackingTarget),ze(this.viewModel),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null,Qj(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return nB(e)}get domNode(){return this.container}set domNode(e){this.container=e}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+TQe++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(sOe=rOe,gQe)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(Qj(this),this._projector.scheduleRender())}classes(...e){return _Re.apply(this,e)}renderNow(){Qj(this),this._projector.renderNow()}_postInitialize(){var r;if(this.destroyed)return;this.scheduleRender(),(r=this._delegatedEventNames)!=null&&r.length&&this._internalHandles.add(ne(()=>this.viewModel,(i,n)=>{n&&this._internalHandles.remove("delegated-events"),i&&T9(i)&&this._internalHandles.add(this._delegatedEventNames.map(s=>cN(i,s,o=>{this.emit(s,o)})),"delegated-events")},Vt)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(lY),this.scheduleRender()};this._internalHandles.add([SEe(e),ne(()=>this.uiStrings,e),fo(()=>this.container,i=>{this.destroyed||this._attach(i)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){var r;this._attached&&(this._projector.detach(this.render),this._attached=!1),(r=e==null?void 0:e.parentNode)==null||r.removeChild(e)}};Yo[sOe]=!0,u([d()],Yo.prototype,"_readyForTrueRender",void 0),u([d({value:null})],Yo.prototype,"container",null),u([cr("container")],Yo.prototype,"castContainer",null),u([d()],Yo.prototype,"iconClass",void 0),u([d()],Yo.prototype,"id",null),u([d()],Yo.prototype,"label",null),u([d()],Yo.prototype,"renderable",null),u([d()],Yo.prototype,"uiStrings",void 0),u([d()],Yo.prototype,"viewModel",void 0),u([d({value:!0})],Yo.prototype,"visible",null),u([d()],Yo.prototype,"key",void 0),u([d()],Yo.prototype,"children",void 0),u([d()],Yo.prototype,"afterCreate",void 0),u([d()],Yo.prototype,"afterUpdate",void 0),u([d()],Yo.prototype,"afterRemoved",void 0),Yo=u([$(xQe)],Yo);const Ga=Yo;function aOe(t){return 32+t.length}function lOe(t){return 16}function cOe(t){if(!t)return 0;let e=dOe;for(const r in t)if(t.hasOwnProperty(r)){const i=t[r];switch(typeof i){case"string":e+=aOe(i);break;case"number":e+=lOe();break;case"boolean":e+=4}}return e}function uOe(t){if(!t)return 0;if(Array.isArray(t))return CQe(t);let e=dOe;for(const r in t)t.hasOwnProperty(r)&&(e+=hOe(t[r]));return e}function CQe(t){const e=t.length;if(e===0||typeof t[0]=="number")return 32+8*e;let r=pOe;for(let i=0;i<e;i++)r+=hOe(t[i]);return r}function hOe(t){switch(typeof t){case"object":return uOe(t);case"string":return aOe(t);case"number":return lOe();case"boolean":return 4;default:return 8}}function HVt(t,e){return pOe+t.length*e}const dOe=32,pOe=32;var CO;(function(t){t[t.KILOBYTES=1024]="KILOBYTES",t[t.MEGABYTES=1048576]="MEGABYTES",t[t.GIGABYTES=1073741824]="GIGABYTES"})(CO||(CO={}));function AQe(t,e,r){return t.units[e][r]}function cB(t,e,r,i=2,n="abbr"){return`${sy(e,{minimumFractionDigits:i,maximumFractionDigits:i,signDisplay:e>0?"never":"exceptZero"})} ${AQe(t,r,n)}`}function qVt(t,e,r,i=2,n="abbr"){const s=$2e(e,r);return cB(t,Vs(e,r,s),s,i,n)}function WVt(t,e,r,i=2,n="abbr"){const s=L2e(e,r);return cB(t,Vs(e,r,s),s,i,n)}function XVt(t,e,r,i=2,n="abbr"){const s=D2e(e,r);return cB(t,Vs(e,r,s),s,i,n)}function YVt(t,e,r,i=2,n="abbr"){const s=N2e(e,r);return cB(t,Vs(e,r,s),s,i,n)}const npe=["B","kB","MB","GB","TB"];function RQe(t,e){let r=e===0?0:Math.floor(Math.log(e)/Math.log(CO.KILOBYTES));r=_e(r,0,npe.length-1);const i=sy(e/CO.KILOBYTES**r,{maximumFractionDigits:2});return ty(t.units.bytes[npe[r]],{fileSize:i})}function OQe(t){const{exifInfo:e,exifName:r,tagName:i}=t;if(!e||!r||!i)return null;const n=e.find(s=>s.name===r);return n?MQe({tagName:i,tags:n.tags}):null}function MQe(t){const{tagName:e,tags:r}=t;if(!r||!e)return null;const i=r.find(n=>n.name===e);return i&&i.value||null}var gJ;const PQe={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let lu=gJ=class extends fe{constructor(t){super(t),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:t}=this,e=OQe({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:t});return PQe[e]||null}clone(){return new gJ({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};u([d({type:String})],lu.prototype,"contentType",void 0),u([d()],lu.prototype,"exifInfo",void 0),u([d({readOnly:!0})],lu.prototype,"orientationInfo",null),u([d({type:Xi})],lu.prototype,"id",void 0),u([d({type:String})],lu.prototype,"globalId",void 0),u([d({type:String})],lu.prototype,"keywords",void 0),u([d({type:String})],lu.prototype,"name",void 0),u([d({json:{read:!1}})],lu.prototype,"parentGlobalId",void 0),u([d({json:{read:!1}})],lu.prototype,"parentObjectId",void 0),u([d({type:Xi})],lu.prototype,"size",void 0),u([d({json:{read:!1}})],lu.prototype,"url",void 0),lu=gJ=u([$("esri.layers.support.AttachmentInfo")],lu);const IQe=lu;var yJ;let Ca=yJ=class extends fe{constructor(t){super(t),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new yJ(se({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};u([d({type:[String],json:{write:!0}})],Ca.prototype,"attachmentTypes",void 0),u([d({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],Ca.prototype,"attachmentsWhere",void 0),u([d({type:Boolean,json:{write:!0}})],Ca.prototype,"cacheHint",void 0),u([d({type:[String],json:{write:!0}})],Ca.prototype,"keywords",void 0),u([d({type:[Number],json:{write:!0}})],Ca.prototype,"globalIds",void 0),u([d({json:{write:!0}})],Ca.prototype,"name",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],Ca.prototype,"num",void 0),u([d({type:[Number],json:{write:!0}})],Ca.prototype,"objectIds",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Ca.prototype,"returnMetadata",void 0),u([d({type:[Number],json:{write:!0}})],Ca.prototype,"size",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],Ca.prototype,"start",void 0),u([De("start"),De("num")],Ca.prototype,"writeStart",null),u([d({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],Ca.prototype,"where",void 0),Ca=yJ=u([$("esri.rest.support.AttachmentQuery")],Ca),Ca.from=bs(Ca);const _J=Ca;function E$(t){const e=t==null?void 0:t.type;return e==="base-tile"||e==="tile"||e==="elevation"||e==="imagery-tile"||e==="base-elevation"||e==="open-street-map"||e==="wcs"||e==="web-tile"||e==="wmts"||e==="vector-tile"}function AO(t){return t!=null&&"type"in t&&t.type==="group"}const ZVt={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};function fOe(t){const e=t==null?void 0:t.type;return e==="building-scene"||e==="integrated-mesh"||e==="point-cloud"||e==="scene"}function spe(t){return(t==null?void 0:t.type)==="voxel"}function ope(t){return(t==null?void 0:t.type)==="imagery-tile"}function mOe(t){return t!=null&&t.parent!=null&&"declaredClass"in t.parent&&t.parent.declaredClass==="esri.Basemap"&&t.parent.baseLayers.includes(t)}function uB(t){var e;return(t==null?void 0:t.type)==="feature"&&!t.url&&((e=t.source)==null?void 0:e.type)==="memory"}function ape(t){var e;return(t==null?void 0:t.type)==="feature"&&((e=t.source)==null?void 0:e.type)==="feature-layer"}function $Qe(t){if(t.activeLayer){const e=t.activeLayer.tileMatrixSet;if(e)return e;const r=t.activeLayer.tileMatrixSets;if(r)return r}return null}async function gOe(t,e){const r=Oi==null?void 0:Oi.findServerInfo(t);if((r==null?void 0:r.currentVersion)!=null)return r.owningSystemUrl||null;const i=t.toLowerCase().indexOf("/rest/services");if(i===-1)return null;const n=`${t.substring(0,i)}/rest/info`,s=v(e)?e.signal:null,{data:o}=await ei(n,{query:{f:"json"},responseType:"json",signal:s});return(o==null?void 0:o.owningSystemUrl)||null}function LQe(t){if(!("capabilities"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function yOe(t){return LQe(t)?"effectiveCapabilities"in t?t.effectiveCapabilities:t.capabilities:null}function DQe(t){if(!("editingEnabled"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":return!0;default:return!1}}function NQe(t){return!!DQe(t)&&("effectiveEditingEnabled"in t?t.effectiveEditingEnabled:t.editingEnabled)}const FQe="esri.widgets.Feature.support.featureUtils",lpe=re.getLogger(FQe),kQe=/href=(""|'')/gi,UQe=/(\{([^\{\r\n]+)\})/g,zQe=/\'/g,_Oe=/^\s*expression\//i,VQe=/(\n)/gi,BQe=/[\u00A0-\u9999<>\&]/gim,jQe=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,GQe=/^(?:mailto:|tel:)/,vOe="relationships/",vJ=P9("short-date-short-time");function bOe(t){if(!R(t))return t.get("sourceLayer")||t.get("layer")}async function Sz(t,e){return typeof t=="function"?t.call(null,e):t}function wOe(t=""){if(t)return!GQe.test(t.trim().toLowerCase())}function xse(t){return!!t&&_Oe.test(t)}function HQe(t,e){if(!xse(e)||!t)return null;const r=e.replace(_Oe,"").toLowerCase();let i=null;return t.some(n=>n.name.toLowerCase()===r&&(i=n,!0)),i}function xOe(t,e){const r=HQe(e,t==null?void 0:t.fieldName);return r?r.title||null:t?t.label||t.fieldName:null}function qQe(t,e){const r=e.get(t.toLowerCase());return`{${r&&r.fieldName||t}}`}function WQe(t){return t.replace(kQe,"")}function QL(t,e){const r=Tse(e,t);return r?r.name:t}function XQe(t,e){return t&&t.map(r=>QL(r,e))}function Tse(t,e){return t&&typeof t.getField=="function"&&e?t.getField(e)??null:null}function TOe(t){return`${t}`.trim()}function fS({attributes:t,globalAttributes:e,layer:r,text:i,expressionAttributes:n,fieldInfoMap:s}){return i?bJ({formattedAttributes:e,template:KQe(i,{...e,...n,...t},r),fieldInfoMap:s}):""}function bJ({formattedAttributes:t,template:e,fieldInfoMap:r}){return TOe(WQe(ty(ty(e,i=>qQe(i,r)),t)))}function YQe(t,e,r=!1){const i=e[t];if(typeof i=="string"){const n="%27",s=(r?encodeURIComponent(i):i).replace(zQe,n);e[t]=s}}function ZQe(t,e=!1){const r={...t};return Object.keys(r).forEach(i=>YQe(i,r,e)),r}function JQe(t,e,r){const i=(e=TOe(e))&&e[0]!=="{";return ty(t,ZQe(r,i||!1))}function wJ(t,e){return t.replace(UQe,(r,i,n)=>{const s=Tse(e,n);return s?`{${s.name}}`:i})}function KQe(t,e,r){const i=wJ(t,r);return i&&i.replace(jQe,(n,s,o)=>JQe(n,s||o,e))}function QQe(t,e){if(typeof t=="string"&&e&&e.dateFormat==null&&(e.places!=null||e.digitSeparator!=null)){const r=Number(t);if(!isNaN(r))return r}return t}function eet(t){return(t==null?void 0:t.type)==="feature"}function cpe(t){return!!(t!=null&&t.layer)}function tet(t){return(t==null?void 0:t.type)==="map-image"}function ret(t,e){var c;const r=e.fieldInfos,i=e.fieldName,n=(c=SOe(r,i))==null?void 0:c.clone(),s=e.preventPlacesFormatting,o=e.layer,a=Tse(o,i);if(n&&(a==null?void 0:a.type)==="date"){const h=n.format||new HA;h.dateFormat=h.dateFormat||"short-date-short-time",h.dateTimeFormatOptions=!cpe(o)&&eet(o)&&o.datesInUnknownTimezone||cpe(o)&&tet(o.layer)&&o.layer.datesInUnknownTimezone?{timeZone:"UTC"}:null,n.format=h}const l=n&&n.format;return typeof t=="string"&&wEe(i)&&l?l.formatRasterPixelValue(t):typeof(t=QQe(t,l))=="string"||t==null||l==null?SN(t):s?sy(t,{...AEe(l),minimumFractionDigits:0,maximumFractionDigits:20}):l.format(t)}function SOe(t,e){if(!t||!t.length||!e)return;const r=e.toLowerCase();let i;return t.some(n=>!(!n.fieldName||n.fieldName.toLowerCase()!==r)&&(i=n,!0)),i}function iet({fieldName:t,graphic:e,layer:r}){if(j0(t)||!r||typeof r.getFeatureType!="function")return null;const{typeIdField:i}=r;if(!i||t!==i)return null;const n=r.getFeatureType(e);return n?n.name:null}function net({fieldName:t,value:e,graphic:r,layer:i}){if(j0(t)||!i||typeof i.getFieldDomain!="function")return null;const n=r&&i.getFieldDomain(t,{feature:r});return n&&n.type==="coded-value"?n.getName(e):null}function set(t,e){const{creatorField:r,creationDateField:i,editorField:n,editDateField:s}=t;if(!e)return;const o=e[s];if(typeof o=="number"){const l=e[n];return{type:"edit",date:ny(o,vJ),user:l}}const a=e[i];if(typeof a=="number"){const l=e[r];return{type:"create",date:ny(a,vJ),user:l}}return null}function oet(t,e){const r=new Map;return t&&t.forEach(i=>{const n=QL(i.fieldName,e);i.fieldName=n,r.set(n.toLowerCase(),i)}),r}function upe(t){const e=[];if(!t)return e;const{fieldInfos:r,content:i}=t;return r&&e.push(...r),i&&Array.isArray(i)&&i.forEach(n=>{if(n.type==="fields"){const s=n&&n.fieldInfos;s&&e.push(...s)}}),e}function Sse(t){return t.replace(BQe,e=>`&#${e.charCodeAt(0)};`)}function SN(t){return typeof t=="string"?t.replace(VQe,'<br class="esri-text-new-line" />'):t}function EOe(t){const{value:e,fieldName:r,fieldInfos:i,fieldInfoMap:n,layer:s,graphic:o}=t;if(e==null)return"";const a=net({fieldName:r,value:e,graphic:o,layer:s});if(a)return a;const l=iet({fieldName:r,graphic:o,layer:s});if(l)return l;if(n.get(r.toLowerCase()))return ret(e,{fieldInfos:i||Array.from(n.values()),fieldName:r,layer:s});const c=s&&s.fieldsIndex;return c&&c.isDateField(r)?ny(e,vJ):SN(e)}function rG({fieldInfos:t,attributes:e,layer:r,graphic:i,fieldInfoMap:n,relatedInfos:s}){const o={};return s==null||s.forEach(a=>het({attributes:o,relatedInfo:a,fieldInfoMap:n,fieldInfos:t,layer:r})),e&&Object.keys(e).forEach(a=>{const l=e[a];o[a]=EOe({fieldName:a,fieldInfos:t,fieldInfoMap:n,layer:r,value:l,graphic:i})}),o}async function COe(t,e){var h,p;const{layer:r,graphic:i,outFields:n,objectIds:s,returnGeometry:o,spatialReference:a}=t,l=s[0];if(typeof l!="number"&&typeof l!="string"){const f="Could not query required fields for the specified feature. The feature's ID is invalid.",m={layer:r,graphic:i,objectId:l,requiredFields:n};return lpe.warn(f,m),null}if(!((p=(h=yOe(r))==null?void 0:h.operations)!=null&&p.supportsQuery)){const f="The specified layer cannot be queried. The following fields will not be available.",m={layer:r,graphic:i,requiredFields:n,returnGeometry:o};return lpe.warn(f,m),null}const c=r.createQuery();return c.objectIds=s,c.outFields=n!=null&&n.length?n:[r.objectIdField],c.returnGeometry=!!o,c.returnZ=!!o,c.returnM=!!o,c.outSpatialReference=a,(await r.queryFeatures(c,e)).features[0]}async function aet(t){var i;if(!((i=t.expressionInfos)!=null&&i.length))return!1;const e=await iy(),{arcadeUtils:{hasGeometryFunctions:r}}=e;return r(t)}async function cet({graphic:t,popupTemplate:e,layer:r,spatialReference:i},n){if(!r||!e||(typeof r.load=="function"&&await r.load(n),!t.attributes))return;const s=t.attributes[r.objectIdField];if(s==null)return;const o=[s],a=await e.getRequiredFields(r.fieldsIndex),l=FHe(a,t),c=l?[]:a,h=e.returnGeometry||await aet(e);if(l&&!h)return;const p=await COe({layer:r,graphic:t,outFields:c,objectIds:o,returnGeometry:h,spatialReference:i},n);p&&(p.geometry&&(t.geometry=p.geometry),p.attributes&&(t.attributes={...t.attributes,...p.attributes}))}function j0(t=""){return!!t&&t.includes(vOe)}function uet(t){return t?`${vOe}${t.layerId}/${t.fieldName}`:""}function hpe({attributes:t,graphic:e,relatedInfo:r,fieldInfos:i,fieldInfoMap:n,layer:s}){t&&e&&r&&Object.keys(e.attributes).forEach(o=>{const a=uet({layerId:r.relation.id.toString(),fieldName:o}),l=e.attributes[o];t[a]=EOe({fieldName:a,fieldInfos:i,fieldInfoMap:n,layer:s,value:l,graphic:e})})}function het({attributes:t,relatedInfo:e,fieldInfoMap:r,fieldInfos:i,layer:n}){t&&e&&(e.relatedFeatures&&e.relatedFeatures&&e.relatedFeatures.forEach(s=>hpe({attributes:t,graphic:s,relatedInfo:e,fieldInfoMap:r,fieldInfos:i,layer:n})),e.relatedStatsFeatures&&e.relatedStatsFeatures&&e.relatedStatsFeatures.forEach(s=>hpe({attributes:t,graphic:s,relatedInfo:e,fieldInfoMap:r,fieldInfos:i,layer:n})))}const dpe=t=>{if(!t)return!1;const e=t.toUpperCase();return e.includes("CURRENT_TIMESTAMP")||e.includes("CURRENT_DATE")||e.includes("CURRENT_TIME")},AOe=({layer:t,method:e,query:r,definitionExpression:i})=>{var o,a;if(!((a=(o=t.capabilities)==null?void 0:o.query)!=null&&a.supportsCacheHint)||e==="attachments")return;const n=v(r.where)?r.where:null,s=v(r.geometry)?r.geometry:null;dpe(i)||dpe(n)||(s==null?void 0:s.type)==="extent"||r.resultType==="tile"||(r.cacheHint=!0)},det=({query:t,layer:e,method:r})=>{AOe({layer:e,method:r,query:t,definitionExpression:`${e.definitionExpression} ${e.serviceDefinitionExpression}`})},pet=({queryPayload:t,layer:e,method:r})=>{AOe({layer:e,method:r,query:t,definitionExpression:`${e.definitionExpression} ${e.serviceDefinitionExpression}`})};function fet(t,e,r){return t&&e&&r?ppe(t.allLayers,e,r)||ppe(t.allTables,e,r):null}function ppe(t,e,r){return t.find(i=>i!==e&&i.type==="feature"&&i.url===e.url&&i.layerId===r.relatedTableId)}const fpe={editing:!1,operations:{add:!0,update:!0,delete:!0}},ROe=ct.ofType(IQe);let cu=class extends be{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.abilities={...fpe},this.activeAttachmentInfo=null,this.activeFileInfo=null,this.attachmentInfos=new ROe,this.fileInfos=new ct,this.graphic=null,this.mode="view",this.filesEnabled=!1,this.addHandles(ne(()=>this.graphic,()=>this._graphicChanged(),Vt))}destroy(){this._attachmentLayer=null,this.graphic=null}castAbilities(e){return{...fpe,...e}}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){const{graphic:e}=this;if(!e)return!1;const r=e.layer||e.sourceLayer;return(r==null?void 0:r.loaded)&&"capabilities"in r&&r.capabilities&&"operations"in r.capabilities&&"supportsResizeAttachments"in r.capabilities.operations&&r.capabilities.operations.supportsResizeAttachments||!1}async getAttachments(){const{_attachmentLayer:e,attachmentInfos:r}=this;if(!e||typeof e.queryAttachments!="function")throw new H("invalid-layer","getAttachments(): A valid layer is required.");const i=this._getObjectId(),n=new _J({objectIds:[i],returnMetadata:!0}),s=[],o=e.queryAttachments(n).then(l=>l[i]||s).catch(()=>s);this._getAttachmentsPromise=o,this.notifyChange("state");const a=await o;return r.removeAll(),a.length&&r.addMany(a),this._getAttachmentsPromise=null,this.notifyChange("state"),a}async addAttachment(e,r=this.graphic){var l;const{_attachmentLayer:i,attachmentInfos:n,abilities:s}=this;if(!r)throw new H("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:r});if(!e)throw new H("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!((l=s.operations)!=null&&l.add))throw new H("invalid-abilities","addAttachment(): add abilities are required.");if(!i||typeof i.addAttachment!="function")throw new H("invalid-layer","addAttachment(): A valid layer is required.");const o=i.addAttachment(r,e).then(c=>this._queryAttachment(c.objectId,r)),a=await o;return n.add(a),a}async deleteAttachment(e){var l;const{_attachmentLayer:r,attachmentInfos:i,graphic:n,abilities:s}=this;if(!e)throw new H("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!((l=s.operations)!=null&&l.delete))throw new H("invalid-abilities","deleteAttachment(): delete abilities are required.");if(!r||typeof r.deleteAttachments!="function")throw new H("invalid-layer","deleteAttachment(): A valid layer is required.");if(!n)throw new H("invalid-graphic","deleteAttachment(): A graphic is required.");const o=r.deleteAttachments(n,[e.id]).then(()=>e),a=await o;return i.remove(a),a}async updateAttachment(e,r=this.activeAttachmentInfo){var h;const{_attachmentLayer:i,attachmentInfos:n,graphic:s,abilities:o}=this;if(!e)throw new H("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!r)throw new H("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:r});if(!((h=o.operations)!=null&&h.update))throw new H("invalid-abilities","updateAttachment(): Update abilities are required.");const a=n.findIndex(p=>p===r);if(!i||typeof i.updateAttachment!="function")throw new H("invalid-layer","updateAttachment(): A valid layer is required.");if(!s)throw new H("invalid-graphic","updateAttachment(): A graphic is required.");const l=i.updateAttachment(s,r.id,e).then(p=>this._queryAttachment(p.objectId)),c=await l;return n.splice(a,1,c),c}async commitFiles(){return await Promise.all(this.fileInfos.items.map(e=>this.addAttachment(e.form))),this.fileInfos.removeAll(),this.getAttachments()}addFile(e,r){if(!e||!r)return null;const i={file:e,form:r};return this.fileInfos.add(i),i}updateFile(e,r,i=this.activeFileInfo){if(!e||!r||!i)return null;const n=this.fileInfos.findIndex(s=>i===s);return n>-1&&this.fileInfos.splice(n,1,{file:e,form:r}),this.fileInfos.items[n]}deleteFile(e){const r=this.fileInfos.find(i=>i.file===e);return r?(this.fileInfos.remove(r),r):null}async _queryAttachment(e,r){const{_attachmentLayer:i}=this;if(!e||!(i!=null&&i.queryAttachments))throw new H("invalid-attachment-id","Could not query attachment.");const n=this._getObjectId(r),s=new _J({objectIds:[n],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return i.queryAttachments(s).then(o=>o[n][0])}_getObjectId(e=this.graphic){return(e==null?void 0:e.getObjectId())??null}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))}_setAttachmentLayer(){const{graphic:e}=this,r=bOe(e);this._attachmentLayer=r?r.type==="scene"&&v(r.associatedLayer)?r.associatedLayer:r:null}};u([d()],cu.prototype,"abilities",void 0),u([cr("abilities")],cu.prototype,"castAbilities",null),u([d()],cu.prototype,"activeAttachmentInfo",void 0),u([d()],cu.prototype,"activeFileInfo",void 0),u([d({readOnly:!0,type:ROe})],cu.prototype,"attachmentInfos",void 0),u([d()],cu.prototype,"fileInfos",void 0),u([d({type:Va})],cu.prototype,"graphic",void 0),u([d()],cu.prototype,"mode",void 0),u([d({readOnly:!0})],cu.prototype,"state",null),u([d()],cu.prototype,"filesEnabled",void 0),u([d({readOnly:!0})],cu.prototype,"supportsResizeAttachments",null),cu=u([$("esri.widgets.Attachments.AttachmentsViewModel")],cu);const Ese=cu;function mpe(t){const e=t.toLowerCase();return e==="image/bmp"||e==="image/emf"||e==="image/exif"||e==="image/gif"||e==="image/x-icon"||e==="image/jpeg"||e==="image/png"||e==="image/tiff"||e==="image/x-wmf"}function met(t){const e=si("esri/themes/base/images/files/");return t?t==="text/plain"?`${e}text-32.svg`:t==="application/pdf"?`${e}pdf-32.svg`:t==="text/csv"?`${e}csv-32.svg`:t==="application/gpx+xml"?`${e}gpx-32.svg`:t==="application/x-dwf"?`${e}cad-32.svg`:t==="application/postscript"||t==="application/json"||t==="text/xml"||t==="model/vrml"?`${e}code-32.svg`:t==="application/x-zip-compressed"||t==="application/x-7z-compressed"||t==="application/x-gzip"||t==="application/x-tar"||t==="application/x-gtar"||t==="application/x-bzip2"||t==="application/gzip"||t==="application/x-compress"||t==="application/x-apple-diskimage"||t==="application/x-rar-compressed"||t==="application/zip"?`${e}zip-32.svg`:t.includes("image/")?`${e}image-32.svg`:t.includes("audio/")?`${e}sound-32.svg`:t.includes("video/")?`${e}video-32.svg`:t.includes("msexcel")||t.includes("ms-excel")||t.includes("spreadsheetml")?`${e}excel-32.svg`:t.includes("msword")||t.includes("ms-word")||t.includes("wordprocessingml")?`${e}word-32.svg`:t.includes("powerpoint")||t.includes("presentationml")?`${e}report-32.svg`:`${e}generic-32.svg`:`${e}generic-32.svg`}function _a(t){return(e,r)=>{e.hasOwnProperty("_messageBundleProps")||(e._messageBundleProps=e._messageBundleProps?e._messageBundleProps.slice():[]),e._messageBundleProps.push({bundlePath:t,propertyName:r})}}var get=function(t){return{vnodeSelector:"",properties:void 0,children:void 0,text:t.toString(),domNode:null}},OOe=function(t,e){for(var r=0,i=t.length;r<i;r++){var n=t[r];Array.isArray(n)?OOe(n,e):n!=null&&n!==!1&&(n.hasOwnProperty("vnodeSelector")||(n=get(n)),e.push(n))}},yet=function(t,e){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(r.length===1&&typeof r[0]=="string")return{vnodeSelector:t,properties:e||void 0,children:void 0,text:r[0],domNode:null};var n=[];return OOe(r,n),{vnodeSelector:t,properties:e||void 0,children:n,text:void 0,domNode:null}};function ie(t,e,...r){return typeof t!="function"||wse(t)?yet(t,e,...r):t(e,...r)}const gpe={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},fi="esri-attachments",jw="esri-button",Ze={base:fi,loaderContainer:`${fi}__loader-container`,loader:`${fi}__loader`,fadeIn:`${fi}--fade-in`,container:`${fi}__container`,containerList:`${fi}__container--list`,containerPreview:`${fi}__container--preview`,actions:`${fi}__actions`,deleteButton:`${fi}__delete-button`,addAttachmentButton:`${fi}__add-attachment-button`,errorMessage:`${fi}__error-message`,items:`${fi}__items`,item:`${fi}__item`,itemButton:`${fi}__item-button`,itemMask:`${fi}__item-mask`,itemMaskIcon:`${fi}__item-mask--icon`,itemImage:`${fi}__image`,itemImageResizable:`${fi}__image--resizable`,itemLabel:`${fi}__label`,itemFilename:`${fi}__filename`,itemChevronIcon:`${fi}__item-chevron-icon`,itemLink:`${fi}__item-link`,itemLinkOverlay:`${fi}__item-link-overlay`,itemLinkOverlayIcon:`${fi}__item-link-overlay-icon`,itemEditIcon:`${fi}__item-edit-icon`,itemAddIcon:`${fi}__item-add-icon`,itemAddButton:`${fi}__item-add-button`,formNode:`${fi}__form-node`,fileFieldset:`${fi}__file-fieldset`,fileLabel:`${fi}__file-label`,fileName:`${fi}__file-name`,fileInput:`${fi}__file-input`,metadata:`${fi}__metadata`,metadataFieldset:`${fi}__metadata-fieldset`,progressBar:`${fi}__progress-bar`,esriWidget:"esri-widget",esriButton:jw,buttonDisabled:`${jw}--disabled`,esriButtonSecondary:`${jw}--secondary`,esriButtonTertiary:`${jw}--tertiary`,esriButtonThird:`${jw}--third`,esriButtonSmall:`${jw}--small`,esriButtonHalf:`${jw}--half`,empty:"esri-widget__content--empty",iconExternalLink:"esri-icon-link-external",iconEdit:"esri-icon-edit",iconRight:"esri-icon-right",iconLeft:"esri-icon-left",iconPlus:"esri-icon-plus"},iG=window.CSS;let Ml=class extends Ga{constructor(e,r){super(e,r),this.displayType="auto",this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=null,this.visibleElements={...gpe},this._supportsImageOrientation=iG&&iG.supports&&iG.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}initialize(){this.viewModel||(this.viewModel=new Ese),this.addHandles([Yn(()=>{var e;return(e=this.viewModel)==null?void 0:e.attachmentInfos},"change",()=>this.scheduleRender()),Yn(()=>{var e;return(e=this.viewModel)==null?void 0:e.fileInfos},"change",()=>this.scheduleRender()),ne(()=>{var e;return(e=this.viewModel)==null?void 0:e.mode},()=>this._modeChanged(),Vt)])}loadDependencies(){return Promise.all([Q(()=>import("./calcite-icon-e09f1c1a.js"),[])])}get abilities(){return this.viewModel.abilities}set abilities(e){this.viewModel.abilities=e}get effectiveDisplayType(){const{displayType:e}=this;return e&&e!=="auto"?e:this.viewModel.supportsResizeAttachments?"preview":"list"}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}castVisibleElements(e){return{...gpe,...e}}addAttachment(){const{_addAttachmentForm:e,viewModel:r}=this;return this._set("submitting",!0),this._set("error",null),r.addAttachment(e).then(i=>(this._set("submitting",!1),this._set("error",null),r.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new H("attachments:add-attachment",this.messages.addErrorMessage,i)),i})}deleteAttachment(e){const{viewModel:r}=this;return this._set("submitting",!0),this._set("error",null),r.deleteAttachment(e).then(i=>(this._set("submitting",!1),this._set("error",null),r.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new H("attachments:delete-attachment",this.messages.deleteErrorMessage,i)),i})}updateAttachment(){const{viewModel:e}=this,{_updateAttachmentForm:r}=this;return this._set("submitting",!0),this._set("error",null),e.updateAttachment(r).then(i=>(this._set("submitting",!1),this._set("error",null),e.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new H("attachments:update-attachment",this.messages.updateErrorMessage,i)),i})}addFile(){const e=this.viewModel.addFile(this.selectedFile,this._addAttachmentForm);return this.viewModel.mode="view",e}updateFile(){const{viewModel:e}=this,r=e.updateFile(this.selectedFile,this._updateAttachmentForm,e.activeFileInfo);return e.mode="view",r}deleteFile(e){var i;const r=this.viewModel.deleteFile(e||((i=this.viewModel.activeFileInfo)==null?void 0:i.file));return this.viewModel.mode="view",r}render(){const{submitting:e,viewModel:r}=this,{state:i}=r;return ie("div",{class:this.classes(Ze.base,Ze.esriWidget)},e?this.renderProgressBar():null,i==="loading"?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())}renderErrorMessage(){const{error:e,visibleElements:r}=this;return e&&r.errorMessage?ie("div",{key:"error-message",class:Ze.errorMessage},e.message):null}renderAttachments(){const{activeFileInfo:e,mode:r,activeAttachmentInfo:i}=this.viewModel;return r==="add"?this.renderAddForm():r==="edit"?this.renderDetailsForm(i||e):this.renderAttachmentContainer()}renderLoading(){return ie("div",{class:Ze.loaderContainer,key:"loader"},ie("div",{class:Ze.loader}))}renderProgressBar(){return this.visibleElements.progressBar?ie("div",{class:Ze.progressBar,key:"progress-bar"}):null}renderAddForm(){const{submitting:e,selectedFile:r}=this,i=e||!r,n=this.visibleElements.cancelAddButton?ie("button",{type:"button",bind:this,disabled:e,onclick:this._cancelForm,class:this.classes(Ze.esriButton,Ze.esriButtonTertiary,Ze.esriButtonSmall,Ze.esriButtonHalf,e&&Ze.buttonDisabled)},this.messages.cancel):null,s=this.visibleElements.addSubmitButton?ie("button",{type:"submit",disabled:i,class:this.classes(Ze.esriButton,Ze.esriButtonSecondary,Ze.esriButtonSmall,Ze.esriButtonHalf,{[Ze.buttonDisabled]:i})},this.messages.add):null,o=r?ie("span",{key:"file-name",class:Ze.fileName},r.name):null,a=ie("form",{bind:this,afterCreate:fz,afterRemoved:Nde,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},ie("fieldset",{class:Ze.fileFieldset},o,ie("label",{class:this.classes(Ze.fileLabel,Ze.esriButton,Ze.esriButtonSecondary)},r?this.messages.changeFile:this.messages.selectFile,ie("input",{class:Ze.fileInput,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),s,n);return ie("div",{key:"add-form-container",class:Ze.formNode},a)}renderDetailsForm(e){var E,C,A;const{visibleElements:r,viewModel:i,selectedFile:n,submitting:s}=this,{abilities:o}=i,a=s||!n;let l,c,h,p;n?(l=n.type,c=n.name,h=n.size):e&&"file"in e?(l=e.file.type,c=e.file.name,h=e.file.size):e&&"contentType"in e&&(l=e.contentType,c=e.name,h=e.size,p=e.url);const f=o.editing&&((E=o.operations)!=null&&E.delete)&&r.deleteButton?ie("button",{key:"delete-button",type:"button",disabled:s,bind:this,onclick:I=>this._submitDeleteAttachment(I,e),class:this.classes(Ze.esriButton,Ze.esriButtonSmall,Ze.esriButtonTertiary,Ze.deleteButton,{[Ze.buttonDisabled]:s})},this.messages.delete):void 0,m=o.editing&&((C=o.operations)!=null&&C.update)&&r.updateButton?ie("button",{disabled:a,key:"update-button",type:"submit",class:this.classes(Ze.esriButton,Ze.esriButtonSmall,Ze.esriButtonThird,{[Ze.buttonDisabled]:a})},this.messages.update):void 0,g=this.visibleElements.cancelUpdateButton?ie("button",{disabled:s,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes(Ze.esriButton,Ze.esriButtonSmall,Ze.esriButtonTertiary,Ze.esriButtonThird,{[Ze.buttonDisabled]:s})},this.messages.cancel):void 0,_=o.editing&&((A=o.operations)!=null&&A.update)?ie("fieldset",{key:"file",class:Ze.fileFieldset},ie("span",{key:"file-name",class:Ze.fileName},c),ie("label",{class:this.classes(Ze.fileLabel,Ze.esriButton,Ze.esriButtonSecondary)},this.messages.changeFile,ie("input",{class:Ze.fileInput,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):void 0,b=ie("fieldset",{key:"size",class:Ze.metadataFieldset},ie("label",null,RQe(this.messagesUnits,h??0))),w=ie("fieldset",{key:"content-type",class:Ze.metadataFieldset},ie("label",null,l)),x=v(p)?ie("a",{class:Ze.itemLink,href:p,rel:"noreferrer",target:"_blank"},this.renderImageMask(e,400),ie("div",{class:Ze.itemLinkOverlay},ie("span",{class:Ze.itemLinkOverlayIcon},ie("calcite-icon",{icon:"launch"})))):this.renderImageMask(e,400),T=ie("form",{bind:this,afterCreate:fz,afterRemoved:Nde,"data-node-ref":"_updateAttachmentForm",onsubmit:I=>this._submitUpdateAttachment(I,e)},ie("div",{class:Ze.metadata},b,w),_,ie("div",{class:Ze.actions},f,g,m));return ie("div",{key:"edit-form-container",class:Ze.formNode},x,T)}renderImageMask(e,r){return e?"file"in e?this.renderGenericImageMask(e.file.name,e.file.type):this.renderImageMaskForAttachment(e,r):null}renderGenericImageMask(e,r){const{supportsResizeAttachments:i}=this.viewModel,n=met(r),s={[Ze.itemImageResizable]:i};return ie("div",{class:this.classes(Ze.itemMaskIcon,Ze.itemMask)},ie("img",{title:e,alt:e,src:n,class:this.classes(s,Ze.itemImage)}))}renderImageMaskForAttachment(e,r){const{supportsResizeAttachments:i}=this.viewModel;if(!e)return null;const{contentType:n,name:s,url:o}=e;if(!i||!mpe(n))return this.renderGenericImageMask(s,n);const a=this._getCSSTransform(e),l=a?{transform:a,"image-orientation":"none"}:{},c=`${o}${o!=null&&o.includes("?")?"&":"?"}w=${r}`,h={[Ze.itemImageResizable]:i};return ie("div",{class:this.classes(Ze.itemMask)},ie("img",{styles:l,alt:s,title:s,src:c,class:this.classes(h,Ze.itemImage)}))}renderFile(e){const{file:r}=e;return ie("li",{class:Ze.item,key:r},ie("button",{key:"details-button",bind:this,class:Ze.itemButton,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,onclick:()=>this._startEditFile(e),type:"button"},this.renderImageMask(e),ie("label",{class:Ze.itemLabel},ie("span",{class:Ze.itemFilename},r.name||this.messages.noTitle),ie("span",{"aria-hidden":"true",class:this.classes(Ze.itemChevronIcon,Ng(this.container)?Ze.iconLeft:Ze.iconRight)}))))}renderAttachmentInfo({attachmentInfo:e,displayType:r}){const{viewModel:i,effectiveDisplayType:n}=this,{abilities:s,supportsResizeAttachments:o}=i,{contentType:a,name:l,url:c}=e,h=this.renderImageMask(e,r==="list"?48:400),p=s.editing?ie("span",{"aria-hidden":"true",class:this.classes(Ze.itemChevronIcon,Ng(this.container)?Ze.iconLeft:Ze.iconRight)}):null,f=[h,n==="preview"&&o&&mpe(a)?null:ie("label",{class:Ze.itemLabel},ie("span",{class:Ze.itemFilename},l||this.messages.noTitle),p)],m=s.editing?ie("button",{key:"details-button",bind:this,class:Ze.itemButton,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":e.id,onclick:()=>this._startEditAttachment(e),type:"button"},f):ie("a",{key:"details-link",class:Ze.itemButton,href:c??void 0,target:"_blank"},f);return ie("li",{class:Ze.item,key:e},m)}renderAttachmentContainer(){var g;const{effectiveDisplayType:e,viewModel:r,visibleElements:i}=this,{attachmentInfos:n,abilities:s,fileInfos:o}=r,a=!!(n!=null&&n.length),l=!!(o!=null&&o.length),c={[Ze.containerList]:e!=="preview",[Ze.containerPreview]:e==="preview"},h=s.editing&&((g=s.operations)!=null&&g.add)&&i.addButton?ie("button",{bind:this,onclick:()=>this._startAddAttachment(),class:this.classes(Ze.esriButton,Ze.esriButtonTertiary,Ze.addAttachmentButton),type:"button"},ie("span",{"aria-hidden":"true",class:this.classes(Ze.itemAddIcon,Ze.iconPlus)}),this.messages.add):void 0,p=a?ie("ul",{key:"attachments-list",class:Ze.items},n.toArray().map(_=>this.renderAttachmentInfo({attachmentInfo:_,displayType:e}))):void 0,f=l?ie("ul",{key:"file-list",class:Ze.items},o.toArray().map(_=>this.renderFile(_))):void 0,m=l||a?void 0:ie("div",{class:Ze.empty},this.messages.noAttachments);return ie("div",{key:"attachments-container",class:this.classes(Ze.container,c)},p,f,m,h)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(e){const r=e.target,i=r&&r.files&&r.files.item(0);this._set("selectedFile",i)}_submitDeleteAttachment(e,r){e.preventDefault(),r&&("file"in r?this.deleteFile(r.file):r&&this.deleteAttachment(r))}_submitAddAttachment(e){e.preventDefault(),this.viewModel.filesEnabled?this.addFile():this.addAttachment()}_submitUpdateAttachment(e,r){e.preventDefault(),r&&"file"in r?this.updateFile():this.updateAttachment()}_startEditAttachment(e){const{viewModel:r}=this;r.activeFileInfo=null,r.activeAttachmentInfo=e,r.mode="edit"}_startEditFile(e){const{viewModel:r}=this;r.activeAttachmentInfo=null,r.activeFileInfo=e,r.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(e){e.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(e){const{orientationInfo:r}=e;return!this._supportsImageOrientation&&r?[r.rotation?`rotate(${r.rotation}deg)`:"",r.mirrored?"scaleX(-1)":""].join(" "):""}};u([d()],Ml.prototype,"abilities",null),u([d()],Ml.prototype,"displayType",void 0),u([d({readOnly:!0})],Ml.prototype,"effectiveDisplayType",null),u([d()],Ml.prototype,"graphic",null),u([d()],Ml.prototype,"label",null),u([d(),_a("esri/widgets/Attachments/t9n/Attachments")],Ml.prototype,"messages",void 0),u([d(),_a("esri/core/t9n/Units")],Ml.prototype,"messagesUnits",void 0),u([d({readOnly:!0})],Ml.prototype,"selectedFile",void 0),u([d({readOnly:!0})],Ml.prototype,"submitting",void 0),u([d({readOnly:!0})],Ml.prototype,"error",void 0),u([d({type:Ese})],Ml.prototype,"viewModel",void 0),u([d()],Ml.prototype,"visibleElements",void 0),u([cr("visibleElements")],Ml.prototype,"castVisibleElements",null),Ml=u([$("esri.widgets.Attachments")],Ml);const _et=Ml;let BP=class extends Ese{constructor(e){super(e),this.description=null,this.title=null}};u([d()],BP.prototype,"description",void 0),u([d()],BP.prototype,"title",void 0),BP=u([$("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],BP);const Cse=BP,vet={heading:"esri-widget__heading"};function Ase({level:t,class:e,...r},i){const n=bet(t);return ie(`h${n}`,{...r,class:_Re(vet.heading,e),role:"heading","aria-level":String(n)},i)}function bet(t){return _e(Math.ceil(t),1,6)}const nG="esri-feature-element-info",sG={base:nG,title:`${nG}__title`,description:`${nG}__description`};let RC=class extends Ga{constructor(e,r){super(e,r),this.description=null,this.headingLevel=2,this.title=null}render(){return ie("div",{class:sG.base},this.renderTitle(),this.renderDescription())}renderTitle(){const{title:e}=this;return e?ie(Ase,{level:this.headingLevel,class:sG.title},e):null}renderDescription(){const{description:e}=this;return e?ie("div",{key:"description",class:sG.description},e):null}};u([d()],RC.prototype,"description",void 0),u([d()],RC.prototype,"headingLevel",void 0),u([d()],RC.prototype,"title",void 0),RC=u([$("esri.widgets.Feature.support.FeatureElementInfo")],RC);const hB=RC,wet={base:"esri-feature-attachments"};let tg=class extends Ga{constructor(e,r){super(e,r),this._featureElementInfo=null,this.attachmentsWidget=new _et,this.headingLevel=2,this.viewModel=new Cse}initialize(){this._featureElementInfo=new hB,this.addHandles([ne(()=>{var e,r;return[(e=this.viewModel)==null?void 0:e.description,(r=this.viewModel)==null?void 0:r.title,this.headingLevel]},()=>this._setupFeatureElementInfo(),Vt),ne(()=>this.viewModel,e=>this.attachmentsWidget.viewModel=e,Vt)])}destroy(){var e;this.attachmentsWidget.destroy(),(e=this._featureElementInfo)==null||e.destroy()}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get displayType(){return this.attachmentsWidget.displayType}set displayType(e){this.attachmentsWidget.displayType=e}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){var r;const{attachmentsWidget:e}=this;return ie("div",{class:wet.base},(r=this._featureElementInfo)==null?void 0:r.render(),e==null?void 0:e.render())}_setupFeatureElementInfo(){var n;const{description:e,title:r,headingLevel:i}=this;(n=this._featureElementInfo)==null||n.set({description:e,title:r,headingLevel:i})}};u([d({readOnly:!0})],tg.prototype,"attachmentsWidget",void 0),u([d()],tg.prototype,"description",null),u([d()],tg.prototype,"displayType",null),u([d()],tg.prototype,"graphic",null),u([d()],tg.prototype,"headingLevel",void 0),u([d()],tg.prototype,"title",null),u([d({type:Cse})],tg.prototype,"viewModel",void 0),tg=u([$("esri.widgets.Feature.FeatureAttachments")],tg);const xet=tg,Iw=t=>{let e=class extends t{destroy(){var r,i;this.destroyed||((r=this._get("handles"))==null||r.destroy(),(i=this._get("updatingHandles"))==null||i.destroy())}get handles(){return this._get("handles")||new qr}get updatingHandles(){return this._get("updatingHandles")||new Hg}};return u([d({readOnly:!0})],e.prototype,"handles",null),u([d({readOnly:!0})],e.prototype,"updatingHandles",null),e=u([$("esri.core.HandleOwner")],e),e};let eD=class extends Iw(be){};eD=u([$("esri.core.HandleOwner")],eD);let r1=class extends Iw(be){constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.handles.add(ne(()=>this.creator,r=>{this._destroyContent(),this._createContent(r)},Vt))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:e,graphic:r,destroyer:i}=this;e&&r&&(Sz(i,{graphic:r}).catch(()=>null),this._set("created",null))}async _createContent(e){const r=this.graphic;if(!r||!e)return;const i=Sz(e,{graphic:r}).catch(()=>null);this._loadingPromise=i,this.notifyChange("state");const n=await i;i===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",n))}};u([d({readOnly:!0})],r1.prototype,"created",void 0),u([d()],r1.prototype,"creator",void 0),u([d()],r1.prototype,"destroyer",void 0),u([d({type:Va})],r1.prototype,"graphic",void 0),u([d({readOnly:!0})],r1.prototype,"state",null),r1=u([$("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],r1);const Ez=r1;function Ph(){return function(t,e){if(!t[e])throw new TypeError(`Cannot auto bind undefined function '${e}'`);return{value:Eet(t[e])}}}function Tet(t){const e=t==null?void 0:t.type;return t instanceof KeyboardEvent||e==="keyup"||e==="keydown"||e==="keypress"}function Eet(t){return function(e,...r){Tet(e)?NJe(e.key)&&(e.preventDefault(),e.stopPropagation(),e.target.click()):t.call(this,e,...r)}}function Cet(t){return e=>{e.hasOwnProperty("_delegatedEventNames")||(e._delegatedEventNames=e._delegatedEventNames?e._delegatedEventNames.slice():[]);const r=e._delegatedEventNames,i=Array.isArray(t)?t:Aet(t);r.push(...i)}}function Aet(t){return t.split(",").map(e=>e.trim())}const MOe="calcite-mode-";function Ret(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-mode-name").replace(/\s|'|"/g,"")}function Cz(){return Ret().startsWith("dark")}function Oet(){return`${MOe}${Cz()?"dark":"light"}`}function Met(t){Pet(t),t.classList.add(Oet())}function Pet(t){Array.from(t.classList).forEach(e=>{e.startsWith(MOe)&&t.classList.remove(e)})}function Az(t){return t&&typeof t.render=="function"}function POe(t){return t&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}const oG="esri-feature-content",aG={base:oG,loaderContainer:`${oG}__loader-container`,loader:`${oG}__loader`};let OC=class extends Ga{constructor(e,r){super(e,r),this.viewModel=null,this._addTargetToAnchors=i=>{Array.from(i.querySelectorAll("a")).forEach(n=>{wOe(n.href)&&!n.hasAttribute("target")&&n.setAttribute("target","_blank")})}}get creator(){var e;return(e=this.viewModel)==null?void 0:e.creator}set creator(e){this.viewModel&&(this.viewModel.creator=e)}get graphic(){var e;return(e=this.viewModel)==null?void 0:e.graphic}set graphic(e){this.viewModel&&(this.viewModel.graphic=e)}renderLoading(){return ie("div",{class:aG.loaderContainer,key:"loader"},ie("div",{class:aG.loader}))}renderCreated(){var r;const e=(r=this.viewModel)==null?void 0:r.created;return e?e instanceof HTMLElement?ie("div",{key:e,bind:e,afterCreate:this._attachToNode}):Az(e)?ie("div",{key:e},!e.destroyed&&e.render()):ie("div",{key:e,innerHTML:e,afterCreate:this._addTargetToAnchors}):null}render(){var r;const e=(r=this.viewModel)==null?void 0:r.state;return ie("div",{class:aG.base},e==="loading"?this.renderLoading():this.renderCreated())}_attachToNode(e){const r=this;e.appendChild(r)}};u([d()],OC.prototype,"creator",null),u([d()],OC.prototype,"graphic",null),u([d({type:Ez})],OC.prototype,"viewModel",void 0),OC=u([$("esri.widgets.Feature.FeatureContent")],OC);const M6=OC;let r0=class extends be{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:e,fieldInfos:r}=this,i=[];return r==null||r.forEach(n=>{if(!(!n.hasOwnProperty("visible")||n.visible))return;const s=n.clone();s.label=xOe(s,e),i.push(s)}),i}};u([d()],r0.prototype,"attributes",void 0),u([d({type:[DEe]})],r0.prototype,"expressionInfos",void 0),u([d()],r0.prototype,"description",void 0),u([d({type:[pN]})],r0.prototype,"fieldInfos",void 0),u([d({readOnly:!0})],r0.prototype,"formattedFieldInfos",null),u([d()],r0.prototype,"title",void 0),r0=u([$("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],r0);const dB=r0,Iet=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];function $et(t){let e=null;return Iet.some(r=>(r.pattern.test(t)&&(e=r),!!e)),e}function Let(t,e){if(typeof e!="string"||!e)return e;const r=$et(e);if(!r)return e;const i=e.match(r.pattern),n=i&&i[2],s=ty(ty(r.label,{messages:t,hierPart:n}),{appName:r.appName}),o=r.target?` target="${r.target}"`:"",a=r.target==="_blank"?' rel="noreferrer"':"";return e.replace(r.pattern,`<a${o} href="$1"${a}>${s}</a>`)}const YF="esri-feature-fields",pM={base:YF,fieldHeader:`${YF}__field-header`,fieldData:`${YF}__field-data`,fieldDataDate:`${YF}__field-data--date`,esriTable:"esri-widget__table"};let of=class extends Ga{constructor(e,r){super(e,r),this._featureElementInfo=null,this.viewModel=new dB,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new hB,this.addHandles(ne(()=>{var e,r;return[(e=this.viewModel)==null?void 0:e.description,(r=this.viewModel)==null?void 0:r.title]},()=>this._setupFeatureElementInfo(),Vt))}destroy(){var e;(e=this._featureElementInfo)==null||e.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get expressionInfos(){return this.viewModel.expressionInfos}set expressionInfos(e){this.viewModel.expressionInfos=e}get fieldInfos(){return this.viewModel.fieldInfos}set fieldInfos(e){this.viewModel.fieldInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}renderFieldInfo(e,r){const{attributes:i}=this.viewModel,n=e.fieldName,s=e.label||n,o=i?i[n]==null?"":i[n]:"",a=!(!e.format||!e.format.dateFormat),l=typeof o=="number"&&!a?this._forceLTR(o):Let(this.messagesURIUtils,o),c={[pM.fieldDataDate]:a};return ie("tr",{key:`fields-element-info-row-${n}-${r}`},ie("th",{key:`fields-element-info-row-header-${n}-${r}`,class:pM.fieldHeader,innerHTML:s}),ie("td",{key:`fields-element-info-row-data-${n}-${r}`,class:this.classes(pM.fieldData,c),innerHTML:l}))}renderFields(){const{formattedFieldInfos:e}=this.viewModel;return e!=null&&e.length?ie("table",{class:pM.esriTable,summary:this.messages.fieldsSummary},ie("tbody",null,e.map((r,i)=>this.renderFieldInfo(r,i)))):null}render(){var e;return ie("div",{class:pM.base},(e=this._featureElementInfo)==null?void 0:e.render(),this.renderFields())}_setupFeatureElementInfo(){var i;const{description:e,title:r}=this;(i=this._featureElementInfo)==null||i.set({description:e,title:r})}_forceLTR(e){return`&lrm;${e}`}};u([d()],of.prototype,"attributes",null),u([d()],of.prototype,"description",null),u([d()],of.prototype,"expressionInfos",null),u([d()],of.prototype,"fieldInfos",null),u([d()],of.prototype,"title",null),u([d({type:dB,nonNullable:!0})],of.prototype,"viewModel",void 0),u([d(),_a("esri/widgets/Feature/t9n/Feature")],of.prototype,"messages",void 0),u([d(),_a("esri/widgets/support/t9n/uriUtils")],of.prototype,"messagesURIUtils",void 0),of=u([$("esri.widgets.Feature.FeatureFields")],of);const IOe=of,Det={maximumFractionDigits:20};function Net(t){return sy(t,Det)}var xJ;let Jx=xJ=class extends fe{constructor(t){super(t),this.color=null,this.label=null,this.value=null}writeValue(t,e,r){e[r]=t??0}clone(){return new xJ({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};u([d({type:Xe,json:{type:[Xi],write:!0}})],Jx.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],Jx.prototype,"label",void 0),u([d({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],Jx.prototype,"value",void 0),u([De("value")],Jx.prototype,"writeValue",null),Jx=xJ=u([$("esri.renderers.visualVariables.support.ColorStop")],Jx);const Fet=Jx;function pB(t,e,r){return ha(t.map((i,n)=>e.apply(r,[i,n])))}async function ket(t,e,r){return(await ha(t.map((i,n)=>e.apply(r,[i,n])))).map(i=>i.value)}function Rse(t){return{ok:!0,value:t}}function Ose(t){return{ok:!1,error:t}}function Uet(t){return v(t)&&t.ok===!0?t.value:null}function zet(t){return v(t)&&t.ok===!1?t.error:null}async function hm(t){if(R(t))return{ok:!1,error:new Error("no promise provided")};try{return Rse(await t)}catch(e){return Ose(e)}}async function a9t(t){try{return Rse(await t)}catch(e){return Mu(e),Ose(e)}}function l9t(t){if(t.ok===!0)return t.value;throw t.error}function EN(t,e){return new i1(t,e)}let i1=class extends be{get value(){return Uet(this._result)}get error(){return zet(this._result)}get finished(){return v(this._result)}constructor(e,r){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=Tp(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:i}=this._abortController;this.promise=e(i),this.promise.then(n=>{this._result=Rse(n),this._cleanup()},n=>{this._result=Ose(n),this._cleanup()}),this._abortHandle=Ua(r,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=$i(this._abortHandle),this._abortController=null}};u([d()],i1.prototype,"value",null),u([d()],i1.prototype,"error",null),u([d()],i1.prototype,"finished",null),u([d()],i1.prototype,"promise",void 0),u([d()],i1.prototype,"_result",void 0),i1=u([$("esri.core.asyncUtils.ReactiveTask")],i1);function CN(){const t=new Float32Array(16);return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Vet(t){const e=new Float32Array(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Bet(t,e,r,i,n,s,o,a,l,c,h,p,f,m,g,_){const b=new Float32Array(16);return b[0]=t,b[1]=e,b[2]=r,b[3]=i,b[4]=n,b[5]=s,b[6]=o,b[7]=a,b[8]=l,b[9]=c,b[10]=h,b[11]=p,b[12]=f,b[13]=m,b[14]=g,b[15]=_,b}function jet(t,e){return new Float32Array(t,e,16)}const Get=CN();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:Get,clone:Vet,create:CN,createView:jet,fromValues:Bet},Symbol.toStringTag,{value:"Module"}));const Het=(t,e)=>{const r=_y(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1);return Wu(r,r)},qet=(t,e)=>{const r=_y(t,e,0,0,.5-.5*e,0,e,0,.5-.5*e,0,0,e,.5-.5*e,0,0,0,1);return Wu(r,r)},Wet=(t,e)=>{const r=1-e,i=_y(t,.2126+.7874*r,.7152-.7152*r,.0722-.0722*r,0,.2126-.2126*r,.7152+.2848*r,.0722-.0722*r,0,.2126-.2126*r,.7152-.7152*r,.0722+.9278*r,0,0,0,0,1);return Wu(i,i)},Xet=(t,e)=>{const r=Math.sin(e*Math.PI/180),i=Math.cos(e*Math.PI/180),n=_y(t,.213+.787*i-.213*r,.715-.715*i-.715*r,.072-.072*i+.928*r,0,.213-.213*i+.143*r,.715+.285*i+.14*r,.072-.072*i-.283*r,0,.213-.213*i-.787*r,.715-.715*i+.715*r,.072+.928*i+.072*r,0,0,0,0,1);return Wu(n,n)},Yet=(t,e)=>{const r=1-2*e,i=_y(t,r,0,0,e,0,r,0,e,0,0,r,e,0,0,0,1);return Wu(i,i)},Zet=(t,e)=>{const r=_y(t,.213+.787*e,.715-.715*e,.072-.072*e,0,.213-.213*e,.715+.285*e,.072-.072*e,0,.213-.213*e,.715-.715*e,.072+.928*e,0,0,0,0,1);return Wu(r,r)},Jet=(t,e)=>{const r=1-e,i=_y(t,.393+.607*r,.769-.769*r,.189-.189*r,0,.349-.349*r,.686+.314*r,.168-.168*r,0,.272-.272*r,.534-.534*r,.131+.869*r,0,0,0,0,1);return Wu(i,i)};let $Oe=class LOe{constructor(e,r,i){this.strength=e,this.radius=r,this.threshold=i,this.type="bloom"}interpolate(e,r,i){this.strength=Cu(e.strength,r.strength,i),this.radius=Cu(e.radius,r.radius,i),this.threshold=Cu(e.threshold,r.threshold,i)}clone(){return new LOe(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:C$(this.radius),strength:this.strength,threshold:this.threshold}}},DOe=class NOe{constructor(e){this.radius=e,this.type="blur"}interpolate(e,r,i){this.radius=Math.round(Cu(e.radius,r.radius,i))}clone(){return new NOe(this.radius)}toJSON(){return{type:"blur",radius:C$(this.radius)}}},TJ=class FOe{constructor(e,r){this.type=e,this.amount=r,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,r,i){this.amount=Cu(e.amount,r.amount,i),this._updateMatrix()}clone(){return new FOe(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const e=this._colorMatrix||CN();switch(this.type){case"brightness":this._colorMatrix=Het(e,this.amount);break;case"contrast":this._colorMatrix=qet(e,this.amount);break;case"grayscale":this._colorMatrix=Wet(e,this.amount);break;case"invert":this._colorMatrix=Yet(e,this.amount);break;case"saturate":this._colorMatrix=Zet(e,this.amount);break;case"sepia":this._colorMatrix=Jet(e,this.amount)}}},kOe=class UOe{constructor(e,r,i,n){this.offsetX=e,this.offsetY=r,this.blurRadius=i,this.color=n,this.type="drop-shadow"}interpolate(e,r,i){this.offsetX=Cu(e.offsetX,r.offsetX,i),this.offsetY=Cu(e.offsetY,r.offsetY,i),this.blurRadius=Cu(e.blurRadius,r.blurRadius,i),this.color[0]=Math.round(Cu(e.color[0],r.color[0],i)),this.color[1]=Math.round(Cu(e.color[1],r.color[1],i)),this.color[2]=Math.round(Cu(e.color[2],r.color[2],i)),this.color[3]=Cu(e.color[3],r.color[3],i)}clone(){return new UOe(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const e=[...this.color];return e[3]*=255,{type:"drop-shadow",xoffset:C$(this.offsetX),yoffset:C$(this.offsetY),blurRadius:C$(this.blurRadius),color:e}}},zOe=class VOe{constructor(e){this.angle=e,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,r,i){this.angle=Cu(e.angle,r.angle,i),this._updateMatrix()}clone(){return new VOe(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const e=this._colorMatrix||CN();this._colorMatrix=Xet(e,this.angle)}},BOe=class jOe{constructor(e){this.amount=e,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(e,r,i){this.amount=Cu(e.amount,r.amount,i)}clone(){return new jOe(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}};function Cu(t,e,r){return t+(e-t)*r}function C$(t){return Math.round(1e3*Cp(t))/1e3}function Ket(t){switch(t.type){case"grayscale":case"sepia":case"invert":return new TJ(t.type,0);case"saturate":case"brightness":case"contrast":return new TJ(t.type,1);case"opacity":return new BOe(1);case"hue-rotate":return new zOe(0);case"blur":return new DOe(0);case"drop-shadow":return new kOe(0,0,0,[...gne("transparent")]);case"bloom":return new $Oe(0,0,1)}}function Qet(t,e){const r=t.length>e.length?t:e;return(t.length>e.length?e:t).every((i,n)=>i.type===r[n].type)}function ett(t,e){const r=t.length>e.length?t:e,i=t.length>e.length?e:t;for(let n=i.length;n<r.length;n++)i.push(Ket(r[n]))}function ttt(t){const e=t[0];return!!e&&"type"in e}var ype,_pe,SJ={};function GOe(t){if(!t||t.length===0)return null;if(typeof t=="string"){const r=vpe(t);return r&&r.length!==0?r:null}const e=t.map(r=>{if(!Number.isFinite(r.scale)||r.scale<=0)throw new H("effect:invalid-scale","scale must be finite and greater than 0",{stop:r});return{scale:r.scale,effects:vpe(r.value)}});e.sort((r,i)=>i.effects.length-r.effects.length);for(let r=0;r<e.length-1;r++){if(!Qet(e[r].effects,e[r+1].effects))throw new H("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:e[r].effects,b:e[r+1].effects});ett(e[r].effects,e[r+1].effects)}return e.sort((r,i)=>i.scale-r.scale),e}function vpe(t){let e;if(!t)return[];try{e=SJ.parse(t)}catch(r){throw new H("effect:invalid-syntax","Invalid effect syntax",{value:t,error:r})}return e.map(r=>rtt(r))}function rtt(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return itt(t);case"opacity":return ntt(t);case"hue-rotate":return stt(t);case"blur":return ott(t);case"drop-shadow":return att(t);case"bloom":return ltt(t)}}catch(e){throw e.details.filter=t,e}throw new H("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}function itt(t){let e=1;return b3(t.parameters,1),t.parameters.length===1&&(e=If(t.parameters[0])),new TJ(t.name,e)}function ntt(t){let e=1;return b3(t.parameters,1),t.parameters.length===1&&(e=If(t.parameters[0])),new BOe(e)}function stt(t){let e=0;return b3(t.parameters,1),t.parameters.length===1&&(e=ftt(t.parameters[0])),new zOe(e)}function ott(t){let e=0;return b3(t.parameters,1),t.parameters.length===1&&(e=Ise(t.parameters[0]),AN(e,t.parameters[0])),new DOe(e)}function att(t){const e=[];let r=null;for(const i of t.parameters)if(i.type==="color"){if(e.length&&Object.freeze(e),r)throw new H("effect:type-error","Accepts only one color",{});r=mtt(i)}else{const n=Ise(i);if(Object.isFrozen(e))throw new H("effect:type-error","<length> parameters not consecutive",{lengths:e});e.push(n),e.length===3&&AN(n,i)}if(e.length<2||e.length>3)throw new H("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${e.length}}`,{lengths:e});return new kOe(e[0],e[1],e[2]||0,r||HOe("black"))}function ltt(t){let e=1,r=0,i=0;return b3(t.parameters,3),t.parameters[0]&&(e=If(t.parameters[0])),t.parameters[1]&&(r=Ise(t.parameters[1]),AN(r,t.parameters[1])),t.parameters[2]&&(i=If(t.parameters[2])),new $Oe(e,r,i)}function b3(t,e){if(t.length>e)throw new H("effect:type-error",`Function supports up to ${e} parameters, Actual: ${t.length}`,{parameters:t})}function fB(t){if(t.type==="color")return"<color>";if(t.unit){if(Pse[t.unit])return"<length>";if(Mse[t.unit])return"<angle>";if(t.unit==="%")return"<percentage>"}return"<double>"}function AN(t,e){if(t<0)throw new H("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:e})}function ctt(t){if(t.type!=="quantity"||t.unit!==null)throw new H("effect:type-error",`Expected <double>, Actual: ${fB(t)}`,{term:t})}function utt(t){if(t.type!=="quantity"||t.unit!==null&&t.unit!=="%")throw new H("effect:type-error",`Expected <double> or <percentage>, Actual: ${fB(t)}`,{term:t})}_pe=function(){function t(n,s){function o(){this.constructor=n}o.prototype=s.prototype,n.prototype=new o}function e(n,s,o,a){var l=Error.call(this,n);return Object.setPrototypeOf&&Object.setPrototypeOf(l,e.prototype),l.expected=s,l.found=o,l.location=a,l.name="SyntaxError",l}function r(n,s,o){return o=o||" ",n.length>s?n:(s-=n.length,n+(o+=o.repeat(s)).slice(0,s))}function i(n,s){var o,a={},l=(s=s!==void 0?s:{}).grammarSource,c={start:Cy},h=Cy,p="none",f=")",m=",",g="(",_="%",b="px",w="cm",x="mm",T="in",E="pt",C="pc",A="deg",I="rad",M="grad",D="turn",U="#",z=".",B="e",ee=/^[ \t\n\r]/,te=/^[a-z\-]/,K=/^[0-9a-fA-F]/,W=/^[+\-]/,N=/^[0-9]/,L=ec("none"),F=gn("none",!1),G=gn(")",!1),q=gn(",",!1),Z=ec("whitespace"),X=zw([" ","	",`
`,"\r"],!1,!1),oe=ec("function"),pe=gn("(",!1),ye=ec("identifier"),Se=zw([["a","z"],"-"],!1,!1),He=ec("percentage"),Le=gn("%",!1),Te=ec("length"),Fe=gn("px",!1),Ve=gn("cm",!1),bt=gn("mm",!1),tt=gn("in",!1),jt=gn("pt",!1),Qt=gn("pc",!1),nr=ec("angle"),er=gn("deg",!1),wr=gn("rad",!1),ni=gn("grad",!1),Pr=gn("turn",!1),Or=ec("number"),ot=ec("color"),et=gn("#",!1),pt=zw([["0","9"],["a","f"],["A","F"]],!1,!1),gt=zw(["+","-"],!1,!1),Rt=zw([["0","9"]],!1,!1),Yt=gn(".",!1),Dr=gn("e",!1),Nr=function(){return[]},Fr=function(Y,xe){return{type:"function",name:Y,parameters:xe||[]}},kr=function(Y,xe){return xe.length>0?q3(Y,xe,3):[Y]},Li=function(Y){return{type:"quantity",value:Y.value,unit:Y.unit}},hr=function(Y){return{type:"color",colorType:Y.type,value:Y.value}},Ar=function(Y){return Y},xr=function(){return Jc()},Dn=function(Y){return{value:Y,unit:"%"}},hi=function(Y){return{value:Y,unit:"px"}},sn=function(Y){return{value:Y,unit:"cm"}},Di=function(Y){return{value:Y,unit:"mm"}},Yi=function(Y){return{value:Y,unit:"in"}},En=function(Y){return{value:Y,unit:"pt"}},Kn=function(Y){return{value:Y,unit:"pc"}},Bo=function(Y){return{value:Y,unit:"deg"}},go=function(Y){return{value:Y,unit:"rad"}},Nn=function(Y){return{value:Y,unit:"grad"}},on=function(Y){return{value:Y,unit:"turn"}},an=function(Y){return{value:Y,unit:null}},Fn=function(){return{type:"hex",value:Jc()}},di=function(Y){return{type:"function",value:Y}},wa=function(){return{type:"named",value:Jc()}},Ql=function(){return parseFloat(Jc())},de=0,Si=0,Up=[{line:1,column:1}],Ha=0,th=[],yt=0;if("startRule"in s){if(!(s.startRule in c))throw new Error(`Can't start parsing from rule "`+s.startRule+'".');h=c[s.startRule]}function Jc(){return n.substring(Si,de)}function gn(Y,xe){return{type:"literal",text:Y,ignoreCase:xe}}function zw(Y,xe,Oe){return{type:"class",parts:Y,inverted:xe,ignoreCase:Oe}}function q7(){return{type:"end"}}function ec(Y){return{type:"other",description:Y}}function J_(Y){var xe,Oe=Up[Y];if(Oe)return Oe;for(xe=Y-1;!Up[xe];)xe--;for(Oe={line:(Oe=Up[xe]).line,column:Oe.column};xe<Y;)n.charCodeAt(xe)===10?(Oe.line++,Oe.column=1):Oe.column++,xe++;return Up[Y]=Oe,Oe}function Ey(Y,xe){var Oe=J_(Y),_r=J_(xe);return{source:l,start:{offset:Y,line:Oe.line,column:Oe.column},end:{offset:xe,line:_r.line,column:_r.column}}}function sr(Y){de<Ha||(de>Ha&&(Ha=de,th=[]),th.push(Y))}function oF(Y,xe,Oe){return new e(e.buildMessage(Y,xe),Y,xe,Oe)}function Cy(){var Y;return(Y=K_())===a&&(Y=Q_()),Y}function K_(){var Y,xe;return yt++,Y=de,pi(),n.substr(de,4)===p?(xe=p,de+=4):(xe=a,yt===0&&sr(F)),xe!==a?(pi(),Si=Y,Y=Nr()):(de=Y,Y=a),yt--,Y===a&&yt===0&&sr(L),Y}function Q_(){var Y,xe;if(Y=[],(xe=xa())!==a)for(;xe!==a;)Y.push(xe),xe=xa();else Y=a;return Y}function xa(){var Y,xe,Oe,_r;return Y=de,pi(),(xe=Sm())!==a?(pi(),(Oe=ud())===a&&(Oe=null),pi(),n.charCodeAt(de)===41?(_r=f,de++):(_r=a,yt===0&&sr(G)),_r!==a?(pi(),Si=Y,Y=Fr(xe,Oe)):(de=Y,Y=a)):(de=Y,Y=a),Y}function ud(){var Y,xe,Oe,_r,yo,kn,rc,tv;if(Y=de,(xe=hd())!==a){for(Oe=[],_r=de,yo=pi(),n.charCodeAt(de)===44?(kn=m,de++):(kn=a,yt===0&&sr(q)),kn===a&&(kn=null),rc=pi(),(tv=hd())!==a?_r=yo=[yo,kn,rc,tv]:(de=_r,_r=a);_r!==a;)Oe.push(_r),_r=de,yo=pi(),n.charCodeAt(de)===44?(kn=m,de++):(kn=a,yt===0&&sr(q)),kn===a&&(kn=null),rc=pi(),(tv=hd())!==a?_r=yo=[yo,kn,rc,tv]:(de=_r,_r=a);Si=Y,Y=kr(xe,Oe)}else de=Y,Y=a;return Y}function hd(){var Y,xe;return Y=de,(xe=Y2())===a&&(xe=Vw())===a&&(xe=Z2())===a&&(xe=Bw()),xe!==a&&(Si=Y,xe=Li(xe)),(Y=xe)===a&&(Y=de,(xe=ev())!==a&&(Si=Y,xe=hr(xe)),Y=xe),Y}function pi(){var Y,xe;for(yt++,Y=[],ee.test(n.charAt(de))?(xe=n.charAt(de),de++):(xe=a,yt===0&&sr(X));xe!==a;)Y.push(xe),ee.test(n.charAt(de))?(xe=n.charAt(de),de++):(xe=a,yt===0&&sr(X));return yt--,xe=a,yt===0&&sr(Z),Y}function Sm(){var Y,xe,Oe;return yt++,Y=de,(xe=Ay())!==a?(n.charCodeAt(de)===40?(Oe=g,de++):(Oe=a,yt===0&&sr(pe)),Oe!==a?(Si=Y,Y=Ar(xe)):(de=Y,Y=a)):(de=Y,Y=a),yt--,Y===a&&(xe=a,yt===0&&sr(oe)),Y}function Ay(){var Y,xe,Oe;if(yt++,Y=de,xe=[],te.test(n.charAt(de))?(Oe=n.charAt(de),de++):(Oe=a,yt===0&&sr(Se)),Oe!==a)for(;Oe!==a;)xe.push(Oe),te.test(n.charAt(de))?(Oe=n.charAt(de),de++):(Oe=a,yt===0&&sr(Se));else xe=a;return xe!==a&&(Si=Y,xe=xr()),yt--,(Y=xe)===a&&(xe=a,yt===0&&sr(ye)),Y}function Y2(){var Y,xe,Oe;return yt++,Y=de,pi(),(xe=tc())!==a?(n.charCodeAt(de)===37?(Oe=_,de++):(Oe=a,yt===0&&sr(Le)),Oe!==a?(Si=Y,Y=Dn(xe)):(de=Y,Y=a)):(de=Y,Y=a),yt--,Y===a&&yt===0&&sr(He),Y}function Vw(){var Y,xe,Oe;return yt++,Y=de,pi(),(xe=tc())!==a?(n.substr(de,2)===b?(Oe=b,de+=2):(Oe=a,yt===0&&sr(Fe)),Oe!==a?(Si=Y,Y=hi(xe)):(de=Y,Y=a)):(de=Y,Y=a),Y===a&&(Y=de,pi(),(xe=tc())!==a?(n.substr(de,2)===w?(Oe=w,de+=2):(Oe=a,yt===0&&sr(Ve)),Oe!==a?(Si=Y,Y=sn(xe)):(de=Y,Y=a)):(de=Y,Y=a),Y===a&&(Y=de,pi(),(xe=tc())!==a?(n.substr(de,2)===x?(Oe=x,de+=2):(Oe=a,yt===0&&sr(bt)),Oe!==a?(Si=Y,Y=Di(xe)):(de=Y,Y=a)):(de=Y,Y=a),Y===a&&(Y=de,pi(),(xe=tc())!==a?(n.substr(de,2)===T?(Oe=T,de+=2):(Oe=a,yt===0&&sr(tt)),Oe!==a?(Si=Y,Y=Yi(xe)):(de=Y,Y=a)):(de=Y,Y=a),Y===a&&(Y=de,pi(),(xe=tc())!==a?(n.substr(de,2)===E?(Oe=E,de+=2):(Oe=a,yt===0&&sr(jt)),Oe!==a?(Si=Y,Y=En(xe)):(de=Y,Y=a)):(de=Y,Y=a),Y===a&&(Y=de,pi(),(xe=tc())!==a?(n.substr(de,2)===C?(Oe=C,de+=2):(Oe=a,yt===0&&sr(Qt)),Oe!==a?(Si=Y,Y=Kn(xe)):(de=Y,Y=a)):(de=Y,Y=a)))))),yt--,Y===a&&yt===0&&sr(Te),Y}function Z2(){var Y,xe,Oe;return yt++,Y=de,(xe=tc())!==a?(n.substr(de,3)===A?(Oe=A,de+=3):(Oe=a,yt===0&&sr(er)),Oe!==a?(Si=Y,Y=Bo(xe)):(de=Y,Y=a)):(de=Y,Y=a),Y===a&&(Y=de,(xe=tc())!==a?(n.substr(de,3)===I?(Oe=I,de+=3):(Oe=a,yt===0&&sr(wr)),Oe!==a?(Si=Y,Y=go(xe)):(de=Y,Y=a)):(de=Y,Y=a),Y===a&&(Y=de,(xe=tc())!==a?(n.substr(de,4)===M?(Oe=M,de+=4):(Oe=a,yt===0&&sr(ni)),Oe!==a?(Si=Y,Y=Nn(xe)):(de=Y,Y=a)):(de=Y,Y=a),Y===a&&(Y=de,(xe=tc())!==a?(n.substr(de,4)===D?(Oe=D,de+=4):(Oe=a,yt===0&&sr(Pr)),Oe!==a?(Si=Y,Y=on(xe)):(de=Y,Y=a)):(de=Y,Y=a)))),yt--,Y===a&&(xe=a,yt===0&&sr(nr)),Y}function Bw(){var Y,xe;return yt++,Y=de,pi(),(xe=tc())!==a?(Si=Y,Y=an(xe)):(de=Y,Y=a),yt--,Y===a&&yt===0&&sr(Or),Y}function ev(){var Y,xe,Oe,_r;if(yt++,Y=de,n.charCodeAt(de)===35?(xe=U,de++):(xe=a,yt===0&&sr(et)),xe!==a){if(Oe=[],K.test(n.charAt(de))?(_r=n.charAt(de),de++):(_r=a,yt===0&&sr(pt)),_r!==a)for(;_r!==a;)Oe.push(_r),K.test(n.charAt(de))?(_r=n.charAt(de),de++):(_r=a,yt===0&&sr(pt));else Oe=a;Oe!==a?(Si=Y,Y=Fn()):(de=Y,Y=a)}else de=Y,Y=a;return Y===a&&(Y=de,(xe=xa())!==a&&(Si=Y,xe=di(xe)),(Y=xe)===a&&(Y=de,(xe=Ay())!==a&&(Si=Y,xe=wa()),Y=xe)),yt--,Y===a&&(xe=a,yt===0&&sr(ot)),Y}function tc(){var Y,xe,Oe,_r,yo,kn,rc;for(Y=de,W.test(n.charAt(de))?(n.charAt(de),de++):yt===0&&sr(gt),xe=de,Oe=[],N.test(n.charAt(de))?(_r=n.charAt(de),de++):(_r=a,yt===0&&sr(Rt));_r!==a;)Oe.push(_r),N.test(n.charAt(de))?(_r=n.charAt(de),de++):(_r=a,yt===0&&sr(Rt));if(n.charCodeAt(de)===46?(_r=z,de++):(_r=a,yt===0&&sr(Yt)),_r!==a){if(yo=[],N.test(n.charAt(de))?(kn=n.charAt(de),de++):(kn=a,yt===0&&sr(Rt)),kn!==a)for(;kn!==a;)yo.push(kn),N.test(n.charAt(de))?(kn=n.charAt(de),de++):(kn=a,yt===0&&sr(Rt));else yo=a;yo!==a?xe=Oe=[Oe,_r,yo]:(de=xe,xe=a)}else de=xe,xe=a;if(xe===a)if(xe=[],N.test(n.charAt(de))?(Oe=n.charAt(de),de++):(Oe=a,yt===0&&sr(Rt)),Oe!==a)for(;Oe!==a;)xe.push(Oe),N.test(n.charAt(de))?(Oe=n.charAt(de),de++):(Oe=a,yt===0&&sr(Rt));else xe=a;if(xe!==a){if(Oe=de,n.charCodeAt(de)===101?(_r=B,de++):(_r=a,yt===0&&sr(Dr)),_r!==a){if(W.test(n.charAt(de))?(yo=n.charAt(de),de++):(yo=a,yt===0&&sr(gt)),yo===a&&(yo=null),kn=[],N.test(n.charAt(de))?(rc=n.charAt(de),de++):(rc=a,yt===0&&sr(Rt)),rc!==a)for(;rc!==a;)kn.push(rc),N.test(n.charAt(de))?(rc=n.charAt(de),de++):(rc=a,yt===0&&sr(Rt));else kn=a;kn!==a?Oe=_r=[_r,yo,kn]:(de=Oe,Oe=a)}else de=Oe,Oe=a;Oe===a&&(Oe=null),Si=Y,Y=Ql()}else de=Y,Y=a;return Y}function aF(Y,xe){return Y.map(function(Oe){return Oe[xe]})}function q3(Y,xe,Oe){return[Y].concat(aF(xe,Oe))}if((o=h())!==a&&de===n.length)return o;throw o!==a&&de<n.length&&sr(q7()),oF(th,Ha<n.length?n.charAt(Ha):null,Ha<n.length?Ey(Ha,Ha+1):Ey(Ha,Ha))}return t(e,Error),e.prototype.format=function(n){var s="Error: "+this.message;if(this.location){var o,a=null;for(o=0;o<n.length;o++)if(n[o].source===this.location.source){a=n[o].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,c=this.location.source+":"+l.line+":"+l.column;if(a){var h=this.location.end,p=r("",l.line.toString().length," "),f=a[l.line-1],m=(l.line===h.line?h.column:f.length+1)-l.column||1;s+=`
 --> `+c+`
`+p+` |
`+l.line+" | "+f+`
`+p+" | "+r("",l.column-1," ")+r("",m,"^")}else s+=`
 at `+c}return s},e.buildMessage=function(n,s){var o={literal:function(m){return'"'+l(m.text)+'"'},class:function(m){var g=m.parts.map(function(_){return Array.isArray(_)?c(_[0])+"-"+c(_[1]):c(_)});return"["+(m.inverted?"^":"")+g.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(m){return m.description}};function a(m){return m.charCodeAt(0).toString(16).toUpperCase()}function l(m){return m.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+a(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+a(g)})}function c(m){return m.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+a(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+a(g)})}function h(m){return o[m.type](m)}function p(m){var g,_,b=m.map(h);if(b.sort(),b.length>0){for(g=1,_=1;g<b.length;g++)b[g-1]!==b[g]&&(b[_]=b[g],_++);b.length=_}switch(b.length){case 1:return b[0];case 2:return b[0]+" or "+b[1];default:return b.slice(0,-1).join(", ")+", or "+b[b.length-1]}}function f(m){return m?'"'+l(m)+'"':"end of input"}return"Expected "+p(n)+" but "+f(s)+" found."},{SyntaxError:e,parse:i}},(ype={get exports(){return SJ},set exports(t){SJ=t}}).exports&&(ype.exports=_pe());const Mse={deg:1,grad:.9,rad:180/Math.PI,turn:360};function htt(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&Mse[t.unit]!=null))throw new H("effect:type-error",`Expected <angle>, Actual: ${fB(t)}`,{term:t})}const Pse={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function dtt(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&Pse[t.unit]!=null))throw new H("effect:type-error",`Expected <length>, Actual: ${fB(t)}`,{term:t})}function If(t){utt(t);const e=t.value;return AN(e,t),t.unit==="%"?.01*e:e}function ptt(t){return ctt(t),AN(t.value,t),t.value}function ftt(t){return htt(t),t.value*Mse[t.unit]||0}function Ise(t){return dtt(t),t.value*Pse[t.unit]||0}function mtt(t){switch(t.colorType){case"hex":return iqe(t.value);case"named":return HOe(t.value);case"function":return _tt(t.value)}}function HOe(t){if(!kEe(t))throw new H("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return rqe(t)}const gtt=/^rgba?/i,ytt=/^hsla?/i;function _tt(t){if(b3(t.parameters,4),gtt.test(t.name))return[If(t.parameters[0]),If(t.parameters[1]),If(t.parameters[2]),t.parameters[3]?If(t.parameters[3]):1];if(ytt.test(t.name))return UEe(ptt(t.parameters[0]),If(t.parameters[1]),If(t.parameters[2]),t.parameters[3]?If(t.parameters[3]):1);throw new H("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}function $se(t,e,r){var i;try{return btt(t)}catch(n){(i=r==null?void 0:r.messages)==null||i.push(n)}return null}function Lse(t,e,r,i){try{const n=vtt(t);ma(r,n,e)}catch(n){i.messages&&i.messages.push(n)}}function vtt(t){const e=GOe(t);return e?ttt(e)?e.map(r=>r.toJSON()):e.map(({scale:r,effects:i})=>({scale:r,value:i.map(n=>n.toJSON())})):null}function btt(t){if(!t||t.length===0)return null;if(wtt(t)){const e=[];for(const r of t)e.push({scale:r.scale,value:bpe(r.value)});return e}return bpe(t)}function wtt(t){const e=t[0];return!!e&&"scale"in e}function bpe(t){if(!t||!t.length)return"";const e=[];for(const r of t){let i=[];switch(r.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":i=[Oy(r,"amount")];break;case"blur":i=[Oy(r,"radius","pt")];break;case"hue-rotate":i=[Oy(r,"angle","deg")];break;case"drop-shadow":i=[Oy(r,"xoffset","pt"),Oy(r,"yoffset","pt"),Oy(r,"blurRadius","pt"),xtt(r,"color")];break;case"bloom":i=[Oy(r,"strength"),Oy(r,"radius","pt"),Oy(r,"threshold")]}const n=`${r.type}(${i.filter(Boolean).join(" ")})`;GOe(n),e.push(n)}return e.join(" ")}function Oy(t,e,r){if(t[e]==null)throw new H("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});return r?t[e]+r:""+t[e]}function xtt(t,e){if(t[e]==null)throw new H("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});const r=t[e];return`rgba(${r[0]||0}, ${r[1]||0}, ${r[2]||0}, ${r[3]/255||0})`}const P6=-3;var I0;(function(t){t[t.ALL=0]="ALL",t[t.SOME=1]="SOME"})(I0||(I0={}));let Ttt=class{constructor(e,r,i){this._namespace=e,this._storage=r,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),this._namespace+=":",i&&(this._storage.registerRemoveFunc(this._namespace,i),this._removeFunc=!0)}destroy(){this._storage.clear(this._namespace),this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace),this._storage.deregister(this),this._storage=null}get namespace(){return this._namespace.slice(0,-1)}get hitRate(){return this._hit/(this._hit+this._miss)}get size(){return this._storage.size}get maxSize(){return this._storage.maxSize}resetHitRate(){this._hit=this._miss=0}put(e,r,i,n=0){this._storage.put(this._namespace+e,r,i,n)}get(e){const r=this._storage.get(this._namespace+e);return r===void 0?++this._miss:++this._hit,r}pop(e){const r=this._storage.pop(this._namespace+e);return r===void 0?++this._miss:++this._hit,r}updateSize(e,r,i){this._storage.updateSize(this._namespace+e,r,i)}clear(){this._storage.clear(this._namespace)}clearAll(){this._storage.clearAll()}getStats(){return this._storage.getStats()}resetStats(){this._storage.resetStats()}},Dse=class{constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new Wt,this._users=new Wt}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,r){this._removeFuncs.push([e,r])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace(r=>r[0]!==e)}get size(){return this._size}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,0),this._checkSizeLimit()}put(e,r,i,n){const s=this._db.get(e);if(s&&(this._size-=s.size,this._db.delete(e),s.entry!==r&&this._notifyRemove(e,s.entry,I0.ALL)),i>this._maxSize)return void this._notifyRemove(e,r,I0.ALL);if(r===void 0)return void console.warn("Refusing to cache undefined entry ");if(!i||i<0)return void console.warn("Refusing to cache entry with invalid size "+i);const o=1+Math.max(n,P6)-P6;this._db.set(e,{entry:r,size:i,lifetime:o,lives:o}),this._size+=i,this._checkSizeLimit()}updateSize(e,r,i){const n=this._db.get(e);if(n&&n.entry===r){for(this._size-=n.size;i>this._maxSize;){const s=this._notifyRemove(e,r,I0.SOME);if(!(v(s)&&s>0))return void this._db.delete(e);i=s}n.size=i,this._size+=i,this._checkSizeLimit()}}pop(e){const r=this._db.get(e);if(r)return this._size-=r.size,this._db.delete(e),++this._hit,r.entry;++this._miss}get(e){const r=this._db.get(e);if(r!==void 0)return this._db.delete(e),r.lives=r.lifetime,this._db.set(e,r),++this._hit,r.entry;++this._miss}getStats(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},r={},i=new Array;this._db.forEach((o,a)=>{const l=o.lifetime;i[l]=(i[l]||0)+o.size,this._users.forAll(c=>{const h=c.namespace;if(a.startsWith(h)){const p=r[h]||0;r[h]=p+o.size}})});const n={};this._users.forAll(o=>{const a=o.namespace;if(!isNaN(o.hitRate)&&o.hitRate>0){const l=r[a]||0;r[a]=l,n[a]=Math.round(100*o.hitRate)+"%"}else n[a]="0%"});const s=Object.keys(r);s.sort((o,a)=>r[a]-r[o]),s.forEach(o=>e[o]=Math.round(r[o]/2**20)+"MB / "+n[o]);for(let o=i.length-1;o>=0;--o){const a=i[o];a&&(e["Priority "+(o+P6-1)]=Math.round(a/this.size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll(e=>e.resetHitRate())}clear(e){this._db.forEach((r,i)=>{i.startsWith(e)&&(this._size-=r.size,this._db.delete(i),this._notifyRemove(i,r.entry,I0.ALL))})}clearAll(){this._db.forEach((e,r)=>this._notifyRemove(r,e.entry,I0.ALL)),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,r,i){let n;return this._removeFuncs.some(s=>{if(e.startsWith(s[0])){const o=s[1](r,i);return typeof o=="number"&&(n=o),!0}return!1}),n}_checkSizeLimit(){if(!(this._size<=this._maxSize))for(const[e,r]of this._db){if(this._db.delete(e),r.lives<=1){this._size-=r.size;const i=this._notifyRemove(e,r.entry,I0.SOME);v(i)&&i>0&&(this._size+=i,r.lives=r.lifetime,r.size=i,this._db.set(e,r))}else--r.lives,this._db.set(e,r);if(this._size<=.9*this.maxSize)return}}},Stt=class{constructor(e,r){this._storage=new Dse,this._storage.maxSize=e,r&&this._storage.registerRemoveFunc("",r)}put(e,r){this._storage.put(e,r,1,1)}pop(e){return this._storage.pop(e)}get(e){return this._storage.get(e)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}};new Stt(1e3);new Xe([128,128,128]);const Ett=new Xe("white");function Ctt(t){return Ic(t.resource).href}function K2(t,e){if(!t)return null;let r=null;return bO(t)?r=Att(t):Y9(t)&&(r=t.color?new Xe(t.color):null),r?tD(r,e):null}function Att(t){const e=t.symbolLayers;if(!e)return null;let r=null;return e.forEach(i=>{var n;i.type==="object"&&((n=i.resource)==null?void 0:n.href)!=null||(r=i.type==="water"?i.color:v(i.material)?i.material.color:null)}),r?new Xe(r):null}function tD(t,e){if(e==null||t==null)return t;const r=t.toRgba();return r[3]=r[3]*e,new Xe(r)}function Rtt(t,e,r){const i=t.symbolLayers;if(!i)return;const n=s=>{const o=v(s)?s:null;return tD(e=e??o??(r!=null?Ett:null),r)};i.forEach(s=>{var o;if(s.type!=="object"||((o=s.resource)==null?void 0:o.href)==null||e)if(s.type==="water")s.color=n(s.color);else{const a=v(s.material)?s.material.color:null,l=n(a);R(s.material)?s.material=new Zh({color:l}):s.material.color=l,r!=null&&"outline"in s&&v(s.outline)&&v(s.outline.color)&&(s.outline.color=tD(s.outline.color,r))}})}function Ott(t,e,r){(e=e??t.color)&&(t.color=tD(e,r)),r!=null&&"outline"in t&&t.outline&&t.outline.color&&(t.outline.color=tD(t.outline.color,r))}function lG(t,e,r){t&&(e||r!=null)&&(e&&(e=new Xe(e)),bO(t)?Rtt(t,e,r):Y9(t)&&Ott(t,e,r))}async function Mtt(t,e){const r=t.symbolLayers;r&&await pB(r,async i=>Ptt(i,e))}async function Ptt(t,e){switch(t.type){case"extrude":$tt(t,e);break;case"icon":case"line":case"text":Itt(t,e);break;case"path":Dtt(t,e);break;case"object":await Ltt(t,e)}}function Itt(t,e){const r=qOe(e);v(r)&&(t.size=r)}function qOe(t){for(const e of t)if(typeof e=="number")return e;return null}function $tt(t,e){t.size=typeof e[2]=="number"?e[2]:0}async function Ltt(t,e){const{resourceSize:r,symbolSize:i}=await Ntt(t),n=WOe(e,r,i);t.width=A$(e[0],i[0],r[0],n),t.depth=A$(e[1],i[1],r[1],n),t.height=A$(e[2],i[2],r[2],n)}function Dtt(t,e){const r=WOe(e,Lg,[t.width,void 0,t.height]);t.width=A$(e[0],t.width,1,r),t.height=A$(e[2],t.height,1,r)}function WOe(t,e,r){for(let i=0;i<3;i++){const n=t[i];switch(n){case"symbol-value":{const s=r[i];return s!=null?s/e[i]:1}case"proportional":break;default:if(n&&e[i])return n/e[i]}}return 1}async function Ntt(t){const e=await Q(()=>import("./symbolLayerUtils-fe5736ca.js"),[]),r=await e.computeObjectLayerResourceSize(t,10),{width:i,height:n,depth:s}=t,o=[i,s,n];let a=1;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/r[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=r[l]*a);return{resourceSize:r,symbolSize:o}}function A$(t,e,r,i){switch(t){case"proportional":return r*i;case"symbol-value":return e??r;default:return t}}function Ftt(t,e){const r=qOe(e);if(!R(r))switch(t.type){case"simple-marker":t.size=r;break;case"picture-marker":{const i=t.width/t.height;i>1?(t.width=r,t.height=r*i):(t.width=r*i,t.height=r);break}case"simple-line":t.width=r;break;case"text":t.font.size=r}}async function ktt(t,e){if(t&&e)return bO(t)?Mtt(t,e):void(Y9(t)&&Ftt(t,e))}function Utt(t,e,r){if(t&&e!=null)if(bO(t)){const i=t.symbolLayers;i&&i.forEach(n=>{if(n&&n.type==="object")switch(r){case"tilt":n.tilt=e;break;case"roll":n.roll=e;break;default:n.heading=e}})}else Y9(t)&&(t.type!=="simple-marker"&&t.type!=="picture-marker"&&t.type!=="text"||(t.angle=e))}function p9t(t){return v(t)&&t.type==="polygon-3d"&&t.symbolLayers.some(e=>e.type==="extrude")}async function ztt(t,e){return await t.fetchSymbol(e)||t.fetchCIMSymbol(e)}const Vtt="<",Btt=">",jtt=P9("short-date");function Gtt(t,e,r,i){let n="";e===0?n=`${Vtt} `:e===r&&(n=`${Btt} `);let s=null;return s=i?ny(t,jtt):Net(t),n+s}const Htt=new Xe([64,64,64]);function qtt(t,e){const r=[],i=t.length-1;return t.length===5?r.push(0,2,4):r.push(0,i),t.map((n,s)=>r.includes(s)?Gtt(n,s,i,e):null)}async function Wtt(t,e,r){let i=!1,n=[],s=[];if(t.stops){const c=t.stops;n=c.map(h=>h.value),i=c.some(h=>!!h.label),i&&(s=c.map(h=>h.label))}const o=n[0],a=n[n.length-1];if(o==null&&a==null)return null;const l=i?null:qtt(n,r??!1);return(await Promise.all(n.map(async(c,h)=>({value:c,color:t.type==="opacity"?await Xtt(c,t,e):(await Q(()=>Promise.resolve().then(()=>Kse),void 0)).getColor(t,c),label:i?s[h]:(l==null?void 0:l[h])??""})))).reverse()}async function Xtt(t,e,r=Htt){const i=new Xe(r),n=(await Q(()=>Promise.resolve().then(()=>Kse),void 0)).getOpacity(e,t);return n!=null&&(i.a=n),i}var EJ;let jP=EJ=class extends fe{constructor(t){super(t),this.color=null,this.ratio=null}clone(){return new EJ({color:this.color,ratio:this.ratio})}};u([d({type:Xe,json:{type:[Xi],default:null,write:!0}})],jP.prototype,"color",void 0),u([d({type:Number,json:{write:!0}})],jP.prototype,"ratio",void 0),jP=EJ=u([$("esri.renderers.support.HeatmapColorStop")],jP);const R$=jP;function Ytt(t){if(!t.colorStops)return[];const e=[...t.colorStops].filter(i=>{var n;return((n=i.color)==null?void 0:n.a)>0});let r=e.length-1;if(e&&e[0]){const i=e[r];i&&i.ratio!==1&&(e.push(new R$({ratio:1,color:i.color})),r++)}return e.map((i,n)=>{var o,a;let s="";return n===0?s=((o=t.legendOptions)==null?void 0:o.minLabel)||"low":n===r&&(s=((a=t.legendOptions)==null?void 0:a.maxLabel)||"high"),{color:i.color,label:s,ratio:i.ratio}}).reverse()}re.getLogger("esri.renderers.support.utils");async function rh(t,e,r){kie(t,e,()=>[]).push(...r)}async function Ztt(t){var r,i;const e=new Map;if(!t)return e;if("visualVariables"in t&&t.visualVariables){const n=t.visualVariables.filter(s=>s.type==="color");for(const s of n){const o=(await Wtt(s)??[]).map(a=>a.color);await rh(e,s.field||s.valueExpression,o)}}if(t.type==="heatmap"){const n=Ytt(t).map(s=>s.color);await rh(e,t.field||t.valueExpression,n)}else if(t.type==="pie-chart"){for(const n of t.attributes)await rh(e,n.field||n.valueExpression,[n.color]);await rh(e,"default",[(r=t==null?void 0:t.othersCategory)==null?void 0:r.color,K2(t.backgroundFillSymbol,null)])}else if(t.type==="dot-density"){for(const n of t.attributes)await rh(e,n.field||n.valueExpression,[n.color]);await rh(e,"default",[t.backgroundColor])}else if(t.type==="unique-value")if(((i=t.authoringInfo)==null?void 0:i.type)==="predominance")for(const n of t.uniqueValueInfos??[])await rh(e,n.value.toString(),[K2(n.symbol,null)]);else{const n=(t.uniqueValueInfos??[]).map(c=>K2(c.symbol,null)),{field:s,field2:o,field3:a,valueExpression:l}=t;(s||l)&&await rh(e,s||l,n),o&&await rh(e,o,n),a&&await rh(e,a,n)}else if(t.type==="class-breaks"){const n=t.classBreakInfos.map(a=>K2(a.symbol,null)),{field:s,valueExpression:o}=t;await rh(e,s??o,n)}else t.type==="simple"&&await rh(e,"default",[K2(t.symbol,null)]);return"defaultSymbol"in t&&t.defaultSymbol&&await rh(e,"default",[K2(t.defaultSymbol,null)]),e.forEach((n,s)=>{const o=iN(n.filter(Boolean),(a,l)=>JSON.stringify(a)===JSON.stringify(l));e.set(s,o)}),e}var CJ;let GP=CJ=class extends fe{constructor(t){super(t),this.name=null,this.code=null}clone(){return new CJ({name:this.name,code:this.code})}};u([d({type:String,json:{write:!0}})],GP.prototype,"name",void 0),u([d({type:[String,Number],json:{write:!0}})],GP.prototype,"code",void 0),GP=CJ=u([$("esri.layers.support.CodedValue")],GP);const Jtt=new mr({inherited:"inherited",codedValue:"coded-value",range:"range"});let HP=class extends fe{constructor(e){super(e),this.name=null,this.type=null}};u([d({type:String,json:{write:!0}})],HP.prototype,"name",void 0),u([st(Jtt)],HP.prototype,"type",void 0),HP=u([$("esri.layers.support.Domain")],HP);const mB=HP;var AJ;let qP=AJ=class extends mB{constructor(t){super(t),this.codedValues=null,this.type="coded-value"}getName(t){let e=null;if(this.codedValues){const r=String(t);this.codedValues.some(i=>(String(i.code)===r&&(e=i.name),!!e))}return e}clone(){return new AJ({codedValues:se(this.codedValues),name:this.name})}};u([d({type:[GP],json:{write:!0}})],qP.prototype,"codedValues",void 0),u([st({codedValue:"coded-value"})],qP.prototype,"type",void 0),qP=AJ=u([$("esri.layers.support.CodedValueDomain")],qP);const XOe=qP;var RJ;let I6=RJ=class extends mB{constructor(t){super(t),this.type="inherited"}clone(){return new RJ}};u([st({inherited:"inherited"})],I6.prototype,"type",void 0),I6=RJ=u([$("esri.layers.support.InheritedDomain")],I6);const YOe=I6;var OJ;let MC=OJ=class extends mB{constructor(t){super(t),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new OJ({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};u([d({type:Number,json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range&&e.range[1]},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(t,e,r){e[r]=[this.minValue||0,t]}}}})],MC.prototype,"maxValue",void 0),u([d({type:Number,json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range&&e.range[0]},write:{target:"range",writer(t,e,r){e[r]=[t,this.maxValue||0]}}}})],MC.prototype,"minValue",void 0),u([st({range:"range"})],MC.prototype,"type",void 0),MC=OJ=u([$("esri.layers.support.RangeDomain")],MC);const ZOe=MC,JOe={key:"type",base:mB,typeMap:{range:ZOe,"coded-value":XOe,inherited:YOe}};function Nse(t){if(!t||!t.type)return null;switch(t.type){case"range":return ZOe.fromJSON(t);case"codedValue":return XOe.fromJSON(t);case"inherited":return YOe.fromJSON(t)}return null}const Fse=new mr({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml"});var MJ;const Ktt=new mr({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let Pl=MJ=class extends fe{constructor(t){super(t),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=-1,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(t,{description:e}){let r=null;try{r=e?JSON.parse(e):null}catch{}return(r==null?void 0:r.value)??null}readValueType(t,{description:e}){let r=null;try{r=e?JSON.parse(e):null}catch{}return r?Ktt.fromJSON(r.fieldValueType):null}clone(){return new MJ({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};u([d({type:String,json:{write:!0}})],Pl.prototype,"alias",void 0),u([d({type:[String,Number],json:{write:{allowNull:!0}}})],Pl.prototype,"defaultValue",void 0),u([d()],Pl.prototype,"description",void 0),u([Me("description")],Pl.prototype,"readDescription",null),u([d({types:JOe,json:{read:{reader:Nse},write:!0}})],Pl.prototype,"domain",void 0),u([d({type:Boolean,json:{write:!0}})],Pl.prototype,"editable",void 0),u([d({type:Xi,json:{write:!0}})],Pl.prototype,"length",void 0),u([d({type:String,json:{write:!0}})],Pl.prototype,"name",void 0),u([d({type:Boolean,json:{write:!0}})],Pl.prototype,"nullable",void 0),u([st(Fse)],Pl.prototype,"type",void 0),u([d()],Pl.prototype,"valueType",void 0),u([Me("valueType",["description"])],Pl.prototype,"readValueType",null),u([d({type:Boolean,json:{read:!1}})],Pl.prototype,"visible",void 0),Pl=MJ=u([$("esri.layers.support.Field")],Pl);const gB=Pl;var PJ;let PC=PJ=class extends fe{constructor(t){super(t),this.type="map-layer"}clone(){const{mapLayerId:t,gdbVersion:e}=this;return new PJ({mapLayerId:t,gdbVersion:e})}};u([st({mapLayer:"map-layer"})],PC.prototype,"type",void 0),u([d({type:Xi,json:{write:!0}})],PC.prototype,"mapLayerId",void 0),u([d({type:String,json:{write:!0}})],PC.prototype,"gdbVersion",void 0),PC=PJ=u([$("esri.layers.support.source.MapLayerSource")],PC);var IJ;let i0=IJ=class extends fe{constructor(t){super(t),this.type="query-table"}clone(){const{workspaceId:t,query:e,oidFields:r,spatialReference:i,geometryType:n}=this,s={workspaceId:t,query:e,oidFields:r,spatialReference:(i==null?void 0:i.clone())??void 0,geometryType:n};return new IJ(s)}};u([st({queryTable:"query-table"})],i0.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],i0.prototype,"workspaceId",void 0),u([d({type:String,json:{write:!0}})],i0.prototype,"query",void 0),u([d({type:String,json:{write:!0}})],i0.prototype,"oidFields",void 0),u([d({type:Je,json:{write:!0}})],i0.prototype,"spatialReference",void 0),u([st(uEe)],i0.prototype,"geometryType",void 0),i0=IJ=u([$("esri.layers.support.source.QueryTableDataSource")],i0);var $J;let IC=$J=class extends fe{constructor(t){super(t),this.type="raster"}clone(){const{workspaceId:t,dataSourceName:e}=this;return new $J({workspaceId:t,dataSourceName:e})}};u([st({raster:"raster"})],IC.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],IC.prototype,"dataSourceName",void 0),u([d({type:String,json:{write:!0}})],IC.prototype,"workspaceId",void 0),IC=$J=u([$("esri.layers.support.source.RasterDataSource")],IC);var LJ;let Kx=LJ=class extends fe{constructor(t){super(t),this.type="table"}clone(){const{workspaceId:t,gdbVersion:e,dataSourceName:r}=this;return new LJ({workspaceId:t,gdbVersion:e,dataSourceName:r})}};u([st({table:"table"})],Kx.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Kx.prototype,"workspaceId",void 0),u([d({type:String,json:{write:!0}})],Kx.prototype,"gdbVersion",void 0),u([d({type:String,json:{write:!0}})],Kx.prototype,"dataSourceName",void 0),Kx=LJ=u([$("esri.layers.support.source.TableDataSource")],Kx);var DJ,NJ;const Qtt=ja()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let mh=DJ=class extends fe{constructor(t){super(t),this.type="join-table"}readLeftTableSource(t,e,r){return wpe()(t,e,r)}castLeftTableSource(t){return om(FJ(),t)}readRightTableSource(t,e,r){return wpe()(t,e,r)}castRightTableSource(t){return om(FJ(),t)}clone(){const{leftTableKey:t,rightTableKey:e,leftTableSource:r,rightTableSource:i,joinType:n}=this,s={leftTableKey:t,rightTableKey:e,leftTableSource:(r==null?void 0:r.clone())??void 0,rightTableSource:(i==null?void 0:i.clone())??void 0,joinType:n};return new DJ(s)}};u([st({joinTable:"join-table"})],mh.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],mh.prototype,"leftTableKey",void 0),u([d({type:String,json:{write:!0}})],mh.prototype,"rightTableKey",void 0),u([d({json:{write:!0}})],mh.prototype,"leftTableSource",void 0),u([Me("leftTableSource")],mh.prototype,"readLeftTableSource",null),u([cr("leftTableSource")],mh.prototype,"castLeftTableSource",null),u([d({json:{write:!0}})],mh.prototype,"rightTableSource",void 0),u([Me("rightTableSource")],mh.prototype,"readRightTableSource",null),u([cr("rightTableSource")],mh.prototype,"castRightTableSource",null),u([st(Qtt)],mh.prototype,"joinType",void 0),mh=DJ=u([$("esri.layers.support.source.JoinTableDataSource")],mh);let cG=null;function wpe(){return cG||(cG=Ew({types:FJ()})),cG}let uG=null;function FJ(){return uG||(uG={key:"type",base:null,typeMap:{"data-layer":$f,"map-layer":PC}}),uG}const ert={key:"type",base:null,typeMap:{"join-table":mh,"query-table":i0,raster:IC,table:Kx}};let $f=NJ=class extends fe{constructor(t){super(t),this.type="data-layer"}clone(){const{fields:t,dataSource:e}=this;return new NJ({fields:t,dataSource:e})}};u([st({dataLayer:"data-layer"})],$f.prototype,"type",void 0),u([d({type:[gB],json:{write:!0}})],$f.prototype,"fields",void 0),u([d({types:ert,json:{write:!0}})],$f.prototype,"dataSource",void 0),$f=NJ=u([$("esri.layers.support.source.DataLayerSource")],$f),$f.from=bs($f);function trt(t,e){return e?{...e,query:{...t??{},...e.query}}:{query:t}}function kse(t){return typeof t=="string"?Uo(t):se(t)}function rrt(t,e,r){const i={};for(const n in t){if(n==="declaredClass")continue;const s=t[n];if(s!=null&&typeof s!="function")if(Array.isArray(s)){i[n]=[];for(let o=0;o<s.length;o++)i[n][o]=rrt(s[o])}else if(typeof s=="object")if(s.toJSON){const o=s.toJSON(r&&r[n]);i[n]=e?o:JSON.stringify(o)}else i[n]=e?s:JSON.stringify(s);else i[n]=s}return i}const YA={102100:{maxX:20037508342788905e-9,minX:-20037508342788905e-9,plus180Line:new zf({paths:[[[20037508342788905e-9,-20037508342788905e-9],[20037508342788905e-9,20037508342788905e-9]]],spatialReference:Je.WebMercator}),minus180Line:new zf({paths:[[[-20037508342788905e-9,-20037508342788905e-9],[-20037508342788905e-9,20037508342788905e-9]]],spatialReference:Je.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new zf({paths:[[[180,-180],[180,180]]],spatialReference:Je.WGS84}),minus180Line:new zf({paths:[[[-180,-180],[-180,180]]],spatialReference:Je.WGS84})}};function cp(t,e){return Math.ceil((t-e)/(2*e))}function Use(t,e){const r=O$(t);for(const i of r)for(const n of i)n[0]+=e;return t}function O$(t){return Q0(t)?t.rings:t.paths}async function irt(t,e,r,i){const n=kse(t),s=e[0].spatialReference,o={...i,query:{...n.query,f:"json",sr:JSON.stringify(s),target:JSON.stringify({geometryType:l3(e[0]),geometries:e}),cutter:JSON.stringify(r)}},a=await ei(n.path+"/cut",o),{cutIndexes:l,geometries:c=[]}=a.data;return{cutIndexes:l,geometries:c.map(h=>{const p=ry(h);return p.spatialReference=s,p})}}function nrt(t){return{geometryType:l3(t[0]),geometries:t.map(e=>e.toJSON())}}function KOe(t,e,r){const i=tHe(e);return t.map(n=>{const s=i.fromJSON(n);return s.spatialReference=r,s})}async function srt(t,e,r){const i=typeof t=="string"?Uo(t):t,n=e[0].spatialReference,s=l3(e[0]),o={...r,query:{...i.query,f:"json",sr:n.wkid?n.wkid:JSON.stringify(n),geometries:JSON.stringify(nrt(e))}},{data:a}=await ei(i.path+"/simplify",o);return KOe(a.geometries,s,n)}const QOe=re.getLogger("esri.geometry.support.normalizeUtils");function ort(t){return t.type==="polygon"}function art(t){return t[0].type==="polygon"}function lrt(t){return t[0].type==="polyline"}function crt(t,e){if(!(t instanceof zf||t instanceof Jl)){const n="straightLineDensify: the input geometry is neither polyline nor polygon";throw QOe.error(n),new H(n)}const r=O$(t),i=[];for(const n of r){const s=[];i.push(s),s.push([n[0][0],n[0][1]]);for(let o=0;o<n.length-1;o++){const a=n[o][0],l=n[o][1],c=n[o+1][0],h=n[o+1][1],p=Math.sqrt((c-a)*(c-a)+(h-l)*(h-l)),f=(h-l)/p,m=(c-a)/p,g=p/e;if(g>1){for(let x=1;x<=g-1;x++){const T=x*e,E=m*T+a,C=f*T+l;s.push([E,C])}const _=(p+Math.floor(g-1)*e)/2,b=m*_+a,w=f*_+l;s.push([b,w])}s.push([c,h])}}return ort(t)?new Jl({rings:i,spatialReference:t.spatialReference}):new zf({paths:i,spatialReference:t.spatialReference})}function xpe(t,e,r){if(e){const i=crt(t,1e6);t=uS(i,!0)}return r&&(t=Use(t,r)),t}function Tpe(t,e,r){if(Array.isArray(t)){const i=t[0];if(i>e){const n=cp(i,e);t[0]=i+n*(-2*e)}else if(i<r){const n=cp(i,r);t[0]=i+n*(-2*r)}}else{const i=t.x;if(i>e){const n=cp(i,e);t=t.clone().offset(n*(-2*e),0)}else if(i<r){const n=cp(i,r);t=t.clone().offset(n*(-2*r),0)}}return t}function urt(t,e){let r=-1;for(let i=0;i<e.cutIndexes.length;i++){const n=e.cutIndexes[i],s=e.geometries[i],o=O$(s);for(let a=0;a<o.length;a++){const l=o[a];l.some(c=>{if(c[0]<180)return!0;{let h=0;for(let f=0;f<l.length;f++){const m=l[f][0];h=m>h?m:h}h=Number(h.toFixed(9));const p=-360*cp(h,180);for(let f=0;f<l.length;f++){const m=s.getPoint(a,f);s.setPoint(a,f,m.clone().offset(p,0))}return!0}})}if(n===r){if(art(t))for(const a of O$(s))t[n]=t[n].addRing(a);else if(lrt(t))for(const a of O$(s))t[n]=t[n].addPath(a)}else r=n,t[n]=s}return t}async function e3e(t,e,r){if(!Array.isArray(t))return e3e([t],e);e&&typeof e!="string"&&QOe.warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const i=typeof e=="string"?e:(e==null?void 0:e.url)??ri.geometryServiceUrl;let n,s,o,a,l,c,h,p,f=0;const m=[],g=[];for(const E of t)if(R(E))g.push(E);else if(n||(n=E.spatialReference,s=fp(n),o=n.isWebMercator,c=o?102100:4326,a=YA[c].maxX,l=YA[c].minX,h=YA[c].plus180Line,p=YA[c].minus180Line),s)if(E.type==="mesh")g.push(E);else if(E.type==="point")g.push(Tpe(E.clone(),a,l));else if(E.type==="multipoint"){const C=E.clone();C.points=C.points.map(A=>Tpe(A,a,l)),g.push(C)}else if(E.type==="extent"){const C=E.clone()._normalize(!1,!1,s);g.push(C.rings?new Jl(C):C)}else if(E.extent){const C=E.extent,A=cp(C.xmin,l)*(2*a);let I=A===0?E.clone():Use(E.clone(),A);C.offset(A,0),C.intersects(h)&&C.xmax!==a?(f=C.xmax>f?C.xmax:f,I=xpe(I,o),m.push(I),g.push("cut")):C.intersects(p)&&C.xmin!==l?(f=C.xmax*(2*a)>f?C.xmax*(2*a):f,I=xpe(I,o,360),m.push(I),g.push("cut")):g.push(I)}else g.push(E.clone());else g.push(E);let _=cp(f,a),b=-90;const w=_,x=new zf;for(;_>0;){const E=360*_-180;x.addPath([[E,b],[E,-1*b]]),b*=-1,_--}if(m.length>0&&w>0){const E=urt(m,await irt(i,m,x,r)),C=[],A=[];for(let D=0;D<g.length;D++){const U=g[D];if(U!=="cut")A.push(U);else{const z=E.shift(),B=t[D];v(B)&&B.type==="polygon"&&B.rings&&B.rings.length>1&&z.rings.length>=B.rings.length?(C.push(z),A.push("simplify")):A.push(o?Gg(z):z)}}if(!C.length)return A;const I=await srt(i,C,r),M=[];for(let D=0;D<A.length;D++){const U=A[D];U!=="simplify"?M.push(U):M.push(o?Gg(I.shift()):I.shift())}return M}const T=[];for(let E=0;E<g.length;E++){const C=g[E];if(C!=="cut")T.push(C);else{const A=m.shift();T.push(o===!0?Gg(A):A)}}return T}function m9t(t,e){const r=fp(e);if(r){const[i,n]=r.valid,s=n-i;if(t<i)for(;t<i;)t+=s;if(t>n)for(;t>n;)t-=s}return t}function t3e(t){const e={};for(const r in t){if(r==="declaredClass")continue;const i=t[r];if(i!=null&&typeof i!="function")if(Array.isArray(i)){e[r]=[];for(let n=0;n<i.length;n++)e[r][n]=t3e(i[n])}else typeof i=="object"?i.toJSON&&(e[r]=JSON.stringify(i)):e[r]=i}return e}var $1;(function(t){t[t.varint=0]="varint",t[t.fixed64=1]="fixed64",t[t.delimited=2]="delimited",t[t.fixed32=5]="fixed32",t[t.unknown=99]="unknown"})($1||($1={}));const Spe=4294967296,hrt=new TextDecoder("utf-8"),drt=ue("safari")||ue("ios")?6:ue("ff")?12:32;let kJ=class $6{constructor(e,r,i=0,n=e?e.byteLength:0){this._tag=0,this._dataType=$1.unknown,this._init(e,r,i,n)}_init(e,r,i,n){this._data=e,this._dataView=r,this._pos=i,this._end=n}asUnsafe(){return this}clone(){return new $6(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(e){this._pos=e}nextTag(e){for(;;){if(this._pos===this._end)return!1;const r=this._decodeVarint();if(this._tag=r>>3,this._dataType=7&r,!e||e===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const e=this._decodeVarint();return this._tag=e>>3,this._dataType=7&e,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let e=4294967295;return e=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?e:(e=(e|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?e:void 0))))}getUInt64(){return this._decodeVarint()}getSInt32(){const e=this.getUInt32();if(e!==void 0)return e>>>1^-(1&e)|0}getSInt64(){return this._decodeSVarint()}getBool(){const e=this._data[this._pos]!==0;return this._skip(1),e}getEnum(){return this._decodeVarint()}getFixed64(){const e=this._dataView,r=this._pos,i=e.getUint32(r,!0)+e.getUint32(r+4,!0)*Spe;return this._skip(8),i}getSFixed64(){const e=this._dataView,r=this._pos,i=e.getUint32(r,!0)+e.getInt32(r+4,!0)*Spe;return this._skip(8),i}getDouble(){const e=this._dataView.getFloat64(this._pos,!0);return this._skip(8),e}getFixed32(){const e=this._dataView.getUint32(this._pos,!0);return this._skip(4),e}getSFixed32(){const e=this._dataView.getInt32(this._pos,!0);return this._skip(4),e}getFloat(){const e=this._dataView.getFloat32(this._pos,!0);return this._skip(4),e}getString(){const e=this._getLength(),r=this._pos,i=this._toString(this._data,r,r+e);return this._skip(e),i}getBytes(){const e=this._getLength(),r=this._pos,i=this._toBytes(this._data,r,r+e);return this._skip(e),i}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(e,r,i,n){const s=this.getMessage(),o=e(s,r,i,n);return s.release(),o}processMessage(e){const r=this.getMessage(),i=e(r);return r.release(),i}getMessage(){const e=this._getLength(),r=$6.pool.acquire();return r._init(this._data,this._dataView,this._pos,this._pos+e),this._skip(e),r}release(){$6.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case $1.varint:this._decodeVarint();break;case $1.fixed64:this._skip(8);break;case $1.delimited:this._skip(this._getLength());break;case $1.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(e){this._skip(e)}_skip(e){if(this._pos+e>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=e}_decodeVarint(){const e=this._data;let r=this._pos,i=0,n=0;if(this._end-r>=10)do{if(n=e[r++],i|=127&n,(128&n)==0||(n=e[r++],i|=(127&n)<<7,(128&n)==0)||(n=e[r++],i|=(127&n)<<14,(128&n)==0)||(n=e[r++],i|=(127&n)<<21,(128&n)==0)||(n=e[r++],i+=268435456*(127&n),(128&n)==0)||(n=e[r++],i+=34359738368*(127&n),(128&n)==0)||(n=e[r++],i+=4398046511104*(127&n),(128&n)==0)||(n=e[r++],i+=562949953421312*(127&n),(128&n)==0)||(n=e[r++],i+=72057594037927940*(127&n),(128&n)==0)||(n=e[r++],i+=9223372036854776e3*(127&n),(128&n)==0))break;throw new Error("Varint too long!")}while(0);else{let s=1;for(;r!==this._end&&(n=e[r],(128&n)!=0);)++r,i+=(127&n)*s,s*=128;if(r===this._end)throw new Error("Varint overrun!");++r,i+=n*s}return this._pos=r,i}_decodeSVarint(){const e=this._data;let r=this._pos,i=0,n=0;const s=1&e[r];if(this._end-r>=10)do{if(n=e[r++],i|=127&n,(128&n)==0||(n=e[r++],i|=(127&n)<<7,(128&n)==0)||(n=e[r++],i|=(127&n)<<14,(128&n)==0)||(n=e[r++],i|=(127&n)<<21,(128&n)==0)||(n=e[r++],i+=268435456*(127&n),(128&n)==0)||(n=e[r++],i+=34359738368*(127&n),(128&n)==0)||(n=e[r++],i+=4398046511104*(127&n),(128&n)==0)||(n=e[r++],i+=562949953421312*(127&n),(128&n)==0)||(n=e[r++],i+=72057594037927940*(127&n),(128&n)==0)||(n=e[r++],i+=9223372036854776e3*(127&n),(128&n)==0))break;throw new Error("Varint too long!")}while(0);else{let o=1;for(;r!==this._end&&(n=e[r],(128&n)!=0);)++r,i+=(127&n)*o,o*=128;if(r===this._end)throw new Error("Varint overrun!");++r,i+=n*o}return this._pos=r,s?-(i+1)/2:i/2}_getLength(){if(this._dataType!==$1.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(e,r,i){if((i=Math.min(this._end,i))-r>drt){const o=e.subarray(r,i);return hrt.decode(o)}let n="",s="";for(let o=r;o<i;++o){const a=e[o];128&a?s+="%"+a.toString(16):(n+=decodeURIComponent(s)+String.fromCharCode(a),s="")}return s.length&&(n+=decodeURIComponent(s)),n}_toBytes(e,r,i){return i=Math.min(this._end,i),new Uint8Array(e.buffer,r,i-r)}};kJ.pool=new ko(kJ,void 0,t=>{t._data=null,t._dataView=null});let dm=class L6{constructor(e=[],r=[],i=!1){this.lengths=e??[],this.coords=r??[],this.hasIndeterminateRingOrder=i}static fromRect(e){const[r,i,n,s]=e,o=n-r,a=s-i;return new L6([5],[r,i,o,0,0,a,-o,0,0,-a])}get isPoint(){return this.lengths.length===0}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((e,r)=>e+r)}forEachVertex(e){let r=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let i=0;i<this.lengths.length;i++){const n=this.lengths[i];for(let s=0;s<n;s++)e(this.coords[2*(s+r)],this.coords[2*(s+r)+1]);r+=n}}clone(e){return e?(e.set(this.coords),new L6(this.lengths.slice(),e,this.hasIndeterminateRingOrder)):new L6(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}},sw=class r3e{constructor(e=null,r={},i,n){this.geometry=e,this.attributes=r,this.centroid=i,this.objectId=n,this.displayId=0,this.geohashX=0,this.geohashY=0}weakClone(){const e=new r3e(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}};function prt(t){return!(R(t.geometry)||!t.geometry.coords||!t.geometry.coords.length)}let g9t=class extends sw{},i3e=class n3e{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new n3e;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}};const s3e=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];let _9t=class{constructor(e){this._options=e,this.geometryTypes=s3e,this._coordinatePtr=0,this._vertexDimension=0}createFeatureResult(){return new i3e}prepareFeatures(e){this._vertexDimension=2,e.hasZ&&this._vertexDimension++,e.hasM&&this._vertexDimension++}finishFeatureResult(e){if(!e||!e.features||!e.hasZ||!this._options.sourceSpatialReference||!e.spatialReference||In(e.spatialReference,this._options.sourceSpatialReference)||e.spatialReference.vcsWkid)return;const r=JS(this._options.sourceSpatialReference)/JS(e.spatialReference);if(r!==1)for(const i of e.features){if(!prt(i))continue;const n=i.geometry.coords;for(let s=2;s<n.length;s+=3)n[s]*=r}}addFeature(e,r){e.features.push(r)}createFeature(){return new sw}createSpatialReference(){return{wkid:0}}createGeometry(){return new dm}addField(e,r){e.fields.push(r)}allocateCoordinates(e){e.coords.length=e.lengths.reduce((r,i)=>r+i,0)*this._vertexDimension,this._coordinatePtr=0}addCoordinate(e,r){e.coords[this._coordinatePtr++]=r}addCoordinatePoint(e,r){e.coords.push(r)}addLength(e,r){e.lengths.push(r)}addQueryGeometry(e,r){e.queryGeometry=r.queryGeometry,e.queryGeometryType=r.queryGeometryType}createPointGeometry(){return new dm}};const Epe=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],Cpe=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],Ape=["upperLeft","lowerLeft"];function Rpe(t){return t>=Epe.length?null:Epe[t]}function frt(t){return t>=Cpe.length?null:Cpe[t]}function Ope(t){return t>=Ape.length?null:Ape[t]}function Mpe(t,e){return e>=t.geometryTypes.length?null:t.geometryTypes[e]}function mrt(t,e,r){const n=t.asUnsafe(),s=e.createPointGeometry(r);for(;n.next();)switch(n.tag()){case 3:{const o=n.getUInt32(),a=n.pos()+o;let l=0;for(;n.pos()<a;)e.addCoordinatePoint(s,n.getSInt64(),l++);break}default:n.skip()}return s}function grt(t,e,r){const s=t.asUnsafe(),o=e.createGeometry(r),a=2+(r.hasZ?1:0)+(r.hasM?1:0);for(;s.next();)switch(s.tag()){case 2:{const l=s.getUInt32(),c=s.pos()+l;let h=0;for(;s.pos()<c;)e.addLength(o,s.getUInt32(),h++);break}case 3:{const l=s.getUInt32(),c=s.pos()+l;let h=0;for(e.allocateCoordinates(o);s.pos()<c;)e.addCoordinate(o,s.getSInt64(),h),h++,h===a&&(h=0);break}default:s.skip()}return o}function yrt(t){const n=t.asUnsafe(),s=new dm;let o="esriGeometryPoint";for(;n.next();)switch(n.tag()){case 2:{const a=n.getUInt32(),l=n.pos()+a;for(;n.pos()<l;)s.lengths.push(n.getUInt32());break}case 3:{const a=n.getUInt32(),l=n.pos()+a;for(;n.pos()<l;)s.coords.push(n.getSInt64());break}case 1:o=s3e[n.getEnum()];break;default:n.skip()}return{queryGeometry:s,queryGeometryType:o}}function _rt(t){const h=t.asUnsafe();for(;h.next();)switch(h.tag()){case 1:return h.getString();case 2:return h.getFloat();case 3:return h.getDouble();case 4:return h.getSInt32();case 5:return h.getUInt32();case 6:return h.getInt64();case 7:return h.getUInt64();case 8:return h.getSInt64();case 9:return h.getBool();default:return h.skip(),null}return null}function vrt(t){const a=t.asUnsafe(),l={type:Rpe(0)};for(;a.next();)switch(a.tag()){case 1:l.name=a.getString();break;case 2:l.type=Rpe(a.getEnum());break;case 3:l.alias=a.getString();break;case 4:l.sqlType=frt(a.getEnum());break;case 5:a.skip();break;case 6:l.defaultValue=a.getString();break;default:a.skip()}return l}function brt(t){const i={},n=t.asUnsafe();for(;n.next();)switch(n.tag()){case 1:i.name=n.getString();break;case 2:i.isSystemMaintained=n.getBool();break;default:n.skip()}return i}function wrt(t,e,r,i){const a=e.createFeature(r);let l=0;for(;t.next();)switch(t.tag()){case 1:{const c=i[l++].name;a.attributes[c]=t.processMessage(_rt);break}case 2:a.geometry=t.processMessageWithArgs(grt,e,r);break;case 4:a.centroid=t.processMessageWithArgs(mrt,e,r);break;default:t.skip()}return a}function xrt(t){const s=[1,1,1,1],o=t.asUnsafe();for(;o.next();)switch(o.tag()){case 1:s[0]=o.getDouble();break;case 2:s[1]=o.getDouble();break;case 4:s[2]=o.getDouble();break;case 3:s[3]=o.getDouble();break;default:o.skip()}return s}function Trt(t){const s=[0,0,0,0],o=t.asUnsafe();for(;o.next();)switch(o.tag()){case 1:s[0]=o.getDouble();break;case 2:s[1]=o.getDouble();break;case 4:s[2]=o.getDouble();break;case 3:s[3]=o.getDouble();break;default:o.skip()}return s}function Srt(t){const n={originPosition:Ope(0)},s=t.asUnsafe();for(;s.next();)switch(s.tag()){case 1:n.originPosition=Ope(s.getEnum());break;case 2:n.scale=s.processMessage(xrt);break;case 3:n.translate=s.processMessage(Trt);break;default:s.skip()}return n}function Ert(t){const n={},s=t.asUnsafe();for(;s.next();)switch(s.tag()){case 1:n.shapeAreaFieldName=s.getString();break;case 2:n.shapeLengthFieldName=s.getString();break;case 3:n.units=s.getString();break;default:s.skip()}return n}function Crt(t,e){const a=e.createSpatialReference();for(;t.next();)switch(t.tag()){case 1:a.wkid=t.getUInt32();break;case 5:a.wkt=t.getString();break;case 2:a.latestWkid=t.getUInt32();break;case 3:a.vcsWkid=t.getUInt32();break;case 4:a.latestVcsWkid=t.getUInt32();break;default:t.skip()}return a}function Art(t,e){const _=e.createFeatureResult(),b=t.asUnsafe();_.geometryType=Mpe(e,0);let w=!1;for(;b.next();)switch(b.tag()){case 1:_.objectIdFieldName=b.getString();break;case 3:_.globalIdFieldName=b.getString();break;case 4:_.geohashFieldName=b.getString();break;case 5:_.geometryProperties=b.processMessage(Ert);break;case 7:_.geometryType=Mpe(e,b.getEnum());break;case 8:_.spatialReference=b.processMessageWithArgs(Crt,e);break;case 10:_.hasZ=b.getBool();break;case 11:_.hasM=b.getBool();break;case 12:_.transform=b.processMessage(Srt);break;case 9:{const x=b.getBool();_.exceededTransferLimit=x;break}case 13:e.addField(_,b.processMessage(vrt));break;case 15:w||(e.prepareFeatures(_),w=!0),e.addFeature(_,b.processMessageWithArgs(wrt,e,_,_.fields));break;case 2:_.uniqueIdField=b.processMessage(brt);break;default:b.skip()}return e.finishFeatureResult(_),_}function Rrt(t,e){const n={};let s=null;for(;t.next();)switch(t.tag()){case 4:s=t.processMessageWithArgs(yrt);break;case 1:n.featureResult=t.processMessageWithArgs(Art,e);break;default:t.skip()}return v(s)&&n.featureResult&&e.addQueryGeometry(n,s),n}function Ort(t,e){try{const i=new kJ(new Uint8Array(t),new DataView(t)),n={};for(;i.next();)i.tag()===2?n.queryResult=i.processMessageWithArgs(Rrt,e):i.skip();return n}catch(r){throw new H("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:r})}}function Mrt(t,e){const r=Ort(t,e),i=r.queryResult.featureResult,n=r.queryResult.queryGeometry,s=r.queryResult.queryGeometryType;if(i&&i.features&&i.features.length&&i.objectIdFieldName){const o=i.objectIdFieldName;for(const a of i.features)a.attributes&&(a.objectId=a.attributes[o])}return i&&(i.queryGeometry=n,i.queryGeometryType=s),i}function UJ(t,e,r){if(!r||!r.features||!r.hasZ)return;const i=NAe(r.geometryType,e,t.outSpatialReference);if(!R(i))for(const n of r.features)i(n.geometry)}const Ppe="Layer does not support extent calculation.";function Prt(t,e){if(e&&t.type==="extent")return`${t.xmin},${t.ymin},${t.xmax},${t.ymax}`;if(e&&t.type==="point")return`${t.x},${t.y}`;const r=t.toJSON();return delete r.spatialReference,JSON.stringify(r)}function Irt(t,e){const r=t.geometry,i=t.toJSON();delete i.compactGeometryEnabled,delete i.defaultSpatialReferenceEnabled;const n=i;let s,o,a;if(v(r)&&(o=r.spatialReference,a=r.spatialReference.wkid||JSON.stringify(r.spatialReference),n.geometryType=l3(r),n.geometry=Prt(r,t.compactGeometryEnabled),n.inSR=a),i.groupByFieldsForStatistics&&(n.groupByFieldsForStatistics=i.groupByFieldsForStatistics.join(",")),i.objectIds&&(n.objectIds=i.objectIds.join(",")),i.orderByFields&&(n.orderByFields=i.orderByFields.join(",")),!i.outFields||!i.returnDistinctValues&&(e!=null&&e.returnCountOnly||e!=null&&e.returnExtentOnly||e!=null&&e.returnIdsOnly)?delete n.outFields:i.outFields.includes("*")?n.outFields="*":n.outFields=i.outFields.join(","),i.outSR?(n.outSR=i.outSR.wkid||JSON.stringify(i.outSR),s=t.outSpatialReference):r&&(i.returnGeometry||i.returnCentroid)&&(n.outSR=n.inSR,s=o),i.returnGeometry&&delete i.returnGeometry,i.outStatistics&&(n.outStatistics=JSON.stringify(i.outStatistics)),i.fullText&&(n.fullText=JSON.stringify(i.fullText)),i.pixelSize&&(n.pixelSize=JSON.stringify(i.pixelSize)),i.quantizationParameters&&(t.defaultSpatialReferenceEnabled&&v(o)&&v(t.quantizationParameters)&&v(t.quantizationParameters.extent)&&o.equals(t.quantizationParameters.extent.spatialReference)&&delete i.quantizationParameters.extent.spatialReference,n.quantizationParameters=JSON.stringify(i.quantizationParameters)),i.parameterValues&&(n.parameterValues=JSON.stringify(i.parameterValues)),i.rangeValues&&(n.rangeValues=JSON.stringify(i.rangeValues)),i.dynamicDataSource&&(n.layer=JSON.stringify({source:i.dynamicDataSource}),delete i.dynamicDataSource),i.timeExtent){const l=i.timeExtent,{start:c,end:h}=l;c==null&&h==null||(n.time=c===h?c:`${c??"null"},${h??"null"}`),delete i.timeExtent}return t.defaultSpatialReferenceEnabled&&v(o)&&v(s)&&o.equals(s)&&(n.defaultSR=n.inSR,delete n.inSR,delete n.outSR),n}async function $rt(t,e,r,i){const n=v(e.timeExtent)&&e.timeExtent.isEmpty?{data:{features:[]}}:await RN(t,e,"json",i);return UJ(e,r,n.data),n}async function b9t(t,e,r,i){if(v(e.timeExtent)&&e.timeExtent.isEmpty)return{data:r.createFeatureResult()};const n=await Lrt(t,e,i),s=n;return s.data=Mrt(n.data,r),s}function Lrt(t,e,r){return RN(t,e,"pbf",r)}function w9t(t,e,r){return v(e.timeExtent)&&e.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):RN(t,e,"json",r,{returnIdsOnly:!0})}function x9t(t,e,r){return v(e.timeExtent)&&e.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):RN(t,e,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})}function T9t(t,e,r){return v(e.timeExtent)&&e.timeExtent.isEmpty?Promise.resolve({data:{count:0,extent:null}}):RN(t,e,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}).then(i=>{const n=i.data;if(n.hasOwnProperty("extent"))return i;if(n.features)throw new Error(Ppe);if(n.hasOwnProperty("count"))throw new Error(Ppe);return i})}function RN(t,e,r,i={},n={}){const s=typeof t=="string"?Uo(t):t,o=e.geometry?[e.geometry]:[];return i.responseType=r==="pbf"?"array-buffer":"json",e3e(o,null,i).then(a=>{const l=a&&a[0];v(l)&&((e=e.clone()).geometry=l);const c=t3e({...s.query,f:r,...n,...Irt(e,n)});return ei(Yb(s.path,"query"),{...i,query:{...c,...i.query}})})}var zJ;const VJ=new mr({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let Aa=zJ=class extends fe{constructor(t){super(t),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(t,e){var n;const r=Je.fromJSON(e.spatialReference),i=[];for(let s=0;s<t.length;s++){const o=t[s],a=Va.fromJSON(o),l=o.geometry&&o.geometry.spatialReference;v(a.geometry)&&!l&&(a.geometry.spatialReference=r);const c=o.aggregateGeometries,h=a.aggregateGeometries;if(c&&v(h))for(const p in h){const f=h[p],m=(n=c[p])==null?void 0:n.spatialReference;v(f)&&!m&&(f.spatialReference=r)}i.push(a)}return i}writeGeometryType(t,e,r,i){if(t)return void VJ.write(t,e,r,i);const{features:n}=this;if(n){for(const s of n)if(s&&v(s.geometry))return void VJ.write(s.geometry.type,e,r,i)}}readQueryGeometry(t,e){if(!t)return null;const r=!!t.spatialReference,i=ry(t);return i&&!r&&e.spatialReference&&(i.spatialReference=Je.fromJSON(e.spatialReference)),i}writeSpatialReference(t,e){if(t)return void(e.spatialReference=t.toJSON());const{features:r}=this;if(r){for(const i of r)if(i&&v(i.geometry)&&i.geometry.spatialReference)return void(e.spatialReference=i.geometry.spatialReference.toJSON())}}clone(){return new zJ(this.cloneProperties())}cloneProperties(){return se({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(t){const e=this.write();if(e.features&&Array.isArray(t)&&t.length>0)for(let r=0;r<e.features.length;r++){const i=e.features[r];if(i.geometry){const n=t&&t[r];i.geometry=n&&n.toJSON()||i.geometry}}return e}quantize(t){const{scale:[e,r],translate:[i,n]}=t,s=c=>Math.round((c-i)/e),o=c=>Math.round((n-c)/r),a=this.features,l=this._getQuantizationFunction(this.geometryType,s,o);for(let c=0,h=a.length;c<h;c++)l!=null&&l(a[c].geometry)||(a.splice(c,1),c--,h--);return this.transform=t,this}unquantize(){const{geometryType:t,features:e,transform:r}=this;if(!r)return this;const{translate:[i,n],scale:[s,o]}=r,a=h=>h*s+i,l=h=>n-h*o,c=this._getHydrationFunction(t,a,l);for(const{geometry:h}of e)v(h)&&c&&c(h);return this.transform=null,this}_quantizePoints(t,e,r){let i,n;const s=[];for(let o=0,a=t.length;o<a;o++){const l=t[o];if(o>0){const c=e(l[0]),h=r(l[1]);c===i&&h===n||(s.push([c-i,h-n]),i=c,n=h)}else i=e(l[0]),n=r(l[1]),s.push([i,n])}return s.length>0?s:null}_getQuantizationFunction(t,e,r){return t==="point"?i=>(i.x=e(i.x),i.y=r(i.y),i):t==="polyline"||t==="polygon"?i=>{const n=Q0(i)?i.rings:i.paths,s=[];for(let o=0,a=n.length;o<a;o++){const l=n[o],c=this._quantizePoints(l,e,r);c&&s.push(c)}return s.length>0?(Q0(i)?i.rings=s:i.paths=s,i):null}:t==="multipoint"?i=>{const n=this._quantizePoints(i.points,e,r);return n&&n.length>0?(i.points=n,i):null}:t==="extent"?i=>i:null}_getHydrationFunction(t,e,r){return t==="point"?i=>{i.x=e(i.x),i.y=r(i.y)}:t==="polyline"||t==="polygon"?i=>{const n=Q0(i)?i.rings:i.paths;let s,o;for(let a=0,l=n.length;a<l;a++){const c=n[a];for(let h=0,p=c.length;h<p;h++){const f=c[h];h>0?(s+=f[0],o+=f[1]):(s=f[0],o=f[1]),f[0]=e(s),f[1]=r(o)}}}:t==="extent"?i=>{i.xmin=e(i.xmin),i.ymin=r(i.ymin),i.xmax=e(i.xmax),i.ymax=r(i.ymax)}:t==="multipoint"?i=>{const n=i.points;let s,o;for(let a=0,l=n.length;a<l;a++){const c=n[a];a>0?(s+=c[0],o+=c[1]):(s=c[0],o=c[1]),c[0]=e(s),c[1]=r(o)}}:null}};u([d({type:String,json:{write:!0}})],Aa.prototype,"displayFieldName",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Aa.prototype,"exceededTransferLimit",void 0),u([d({type:[Va],json:{write:!0}})],Aa.prototype,"features",void 0),u([Me("features")],Aa.prototype,"readFeatures",null),u([d({type:[gB],json:{write:!0}})],Aa.prototype,"fields",void 0),u([d({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:VJ.read}}})],Aa.prototype,"geometryType",void 0),u([De("geometryType")],Aa.prototype,"writeGeometryType",null),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Aa.prototype,"hasM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Aa.prototype,"hasZ",void 0),u([d({types:Aw,json:{write:!0}})],Aa.prototype,"queryGeometry",void 0),u([Me("queryGeometry")],Aa.prototype,"readQueryGeometry",null),u([d({type:Je,json:{write:!0}})],Aa.prototype,"spatialReference",void 0),u([De("spatialReference")],Aa.prototype,"writeSpatialReference",null),u([d({json:{write:!0}})],Aa.prototype,"transform",void 0),Aa=zJ=u([$("esri.rest.support.FeatureSet")],Aa),Aa.prototype.toJSON.isDefaultToJSON=!0;const zse=Aa,Ipe={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8},Drt={milliseconds:{getter:"getMilliseconds",setter:"setMilliseconds",multiplier:1},seconds:{getter:"getSeconds",setter:"setSeconds",multiplier:1},minutes:{getter:"getMinutes",setter:"setMinutes",multiplier:1},hours:{getter:"getHours",setter:"setHours",multiplier:1},days:{getter:"getDate",setter:"setDate",multiplier:1},weeks:{getter:"getDate",setter:"setDate",multiplier:7},months:{getter:"getMonth",setter:"setMonth",multiplier:1},years:{getter:"getFullYear",setter:"setFullYear",multiplier:1},decades:{getter:"getFullYear",setter:"setFullYear",multiplier:10},centuries:{getter:"getFullYear",setter:"setFullYear",multiplier:100}};function Nrt(t,e){const r=new Date(t,e+1,1);return r.setDate(0),r.getDate()}function MS(t,e,r){const i=new Date(t.getTime());if(e&&r){const n=Drt[r],{getter:s,setter:o,multiplier:a}=n;if(r==="months"){const l=Nrt(i.getFullYear(),i.getMonth()+e);i.getDate()>l&&i.setDate(l)}i[o](i[s]()+e*a)}return i}function $pe(t,e){switch(e){case"milliseconds":return new Date(t.getTime());case"seconds":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds());case"minutes":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes());case"hours":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours());case"days":return new Date(t.getFullYear(),t.getMonth(),t.getDate());case"weeks":return new Date(t.getFullYear(),t.getMonth(),t.getDate()-t.getDay());case"months":return new Date(t.getFullYear(),t.getMonth(),1);case"years":return new Date(t.getFullYear(),0,1);case"decades":return new Date(t.getFullYear()-t.getFullYear()%10,0,1);case"centuries":return new Date(t.getFullYear()-t.getFullYear()%100,0,1);default:return new Date}}function Frt(t,e,r){return t===0?0:t*Ipe[e]/Ipe[r]}var af;let Eh=af=class extends fe{static get allTime(){return Lpe}static get empty(){return krt}constructor(t){super(t),this.end=null,this.start=null}readEnd(t,e){return e.end!=null?new Date(e.end):null}writeEnd(t,e){e.end=t?t.getTime():null}get isAllTime(){return this.equals(af.allTime)}get isEmpty(){return this.equals(af.empty)}readStart(t,e){return e.start!=null?new Date(e.start):null}writeStart(t,e){e.start=t?t.getTime():null}clone(){return new af({end:this.end,start:this.start})}equals(t){if(!t)return!1;const e=v(this.start)?this.start.getTime():this.start,r=v(this.end)?this.end.getTime():this.end,i=v(t.start)?t.start.getTime():t.start,n=v(t.end)?t.end.getTime():t.end;return e===i&&r===n}expandTo(t){if(this.isEmpty||this.isAllTime)return this.clone();const e=Fo(this.start,i=>$pe(i,t)),r=Fo(this.end,i=>{const n=$pe(i,t);return i.getTime()===n.getTime()?n:MS(n,1,t)});return new af({start:e,end:r})}intersection(t){if(!t)return this.clone();if(this.isEmpty||t.isEmpty)return af.empty;if(this.isAllTime)return t.clone();if(t.isAllTime)return this.clone();const e=kh(this.start,-1/0,a=>a.getTime()),r=kh(this.end,1/0,a=>a.getTime()),i=kh(t.start,-1/0,a=>a.getTime()),n=kh(t.end,1/0,a=>a.getTime());let s,o;if(i>=e&&i<=r?s=i:e>=i&&e<=n&&(s=e),r>=i&&r<=n?o=r:n>=e&&n<=r&&(o=n),s!=null&&o!=null&&!isNaN(s)&&!isNaN(o)){const a=new af;return a.start=s===-1/0?null:new Date(s),a.end=o===1/0?null:new Date(o),a}return af.empty}offset(t,e){if(this.isEmpty||this.isAllTime)return this.clone();const r=new af,{start:i,end:n}=this;return v(i)&&(r.start=MS(i,t,e)),v(n)&&(r.end=MS(n,t,e)),r}union(t){if(!t||t.isEmpty)return this.clone();if(this.isEmpty)return t.clone();if(this.isAllTime||t.isAllTime)return Lpe.clone();const e=v(this.start)&&v(t.start)?new Date(Math.min(this.start.getTime(),t.start.getTime())):null,r=v(this.end)&&v(t.end)?new Date(Math.max(this.end.getTime(),t.end.getTime())):null;return new af({start:e,end:r})}};u([d({type:Date,json:{write:{allowNull:!0}}})],Eh.prototype,"end",void 0),u([Me("end")],Eh.prototype,"readEnd",null),u([De("end")],Eh.prototype,"writeEnd",null),u([d({readOnly:!0,json:{read:!1}})],Eh.prototype,"isAllTime",null),u([d({readOnly:!0,json:{read:!1}})],Eh.prototype,"isEmpty",null),u([d({type:Date,json:{write:{allowNull:!0}}})],Eh.prototype,"start",void 0),u([Me("start")],Eh.prototype,"readStart",null),u([De("start")],Eh.prototype,"writeStart",null),Eh=af=u([$("esri.TimeExtent")],Eh);const Lpe=new Eh,krt=new Eh({start:void 0,end:void 0}),qc=Eh;let Qx=class extends bi(fe){constructor(e){super(e),this.onFields=null,this.operator=null,this.searchTerm=null,this.searchType=null}};u([d({type:[String],json:{write:{enabled:!0,overridePolicy(){return{enabled:v(this.onFields)&&this.onFields.length>0}}}}})],Qx.prototype,"onFields",void 0),u([d({type:String,json:{write:!0}})],Qx.prototype,"operator",void 0),u([d({type:String,json:{write:!0}})],Qx.prototype,"searchTerm",void 0),u([d({type:String,json:{write:!0}})],Qx.prototype,"searchType",void 0),Qx=u([$("esri.rest.support.FullTextSearch")],Qx);const Urt=Qx;var BJ;const Dpe=new mr({upperLeft:"upper-left",lowerLeft:"lower-left"});let eT=BJ=class extends fe{constructor(t){super(t),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new BJ(se({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};u([d({type:ur,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],eT.prototype,"extent",void 0),u([d({type:["view","edit"],json:{write:!0}})],eT.prototype,"mode",void 0),u([d({type:String,json:{read:Dpe.read,write:Dpe.write}})],eT.prototype,"originPosition",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],eT.prototype,"tolerance",void 0),eT=BJ=u([$("esri.rest.support.QuantizationParameters")],eT);const o3e=eT;var jJ;const Npe=new mr({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let lf=jJ=class extends fe{constructor(t){super(t),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(t,e){this.statisticType!=="percentile-continuous"&&this.statisticType!=="percentile-discrete"||(e.statisticParameters=se(t))}clone(){return new jJ({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:se(this.statisticParameters)})}};u([d({type:Number,json:{write:!0}})],lf.prototype,"maxPointCount",void 0),u([d({type:Number,json:{write:!0}})],lf.prototype,"maxRecordCount",void 0),u([d({type:Number,json:{write:!0}})],lf.prototype,"maxVertexCount",void 0),u([d({type:String,json:{write:!0}})],lf.prototype,"onStatisticField",void 0),u([d({type:String,json:{write:!0}})],lf.prototype,"outStatisticFieldName",void 0),u([d({type:String,json:{read:{source:"statisticType",reader:Npe.read},write:{target:"statisticType",writer:Npe.write}}})],lf.prototype,"statisticType",void 0),u([d({type:Object})],lf.prototype,"statisticParameters",void 0),u([De("statisticParameters")],lf.prototype,"writeStatisticParameters",null),lf=jJ=u([$("esri.rest.support.StatisticDefinition")],lf);const a3e=lf;var AR;const zrt=new mr({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),Vrt=new mr({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let qt=AR=class extends fe{static from(t){return sO(AR,t)}constructor(t){super(t),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.fullText=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}castDatumTransformation(t){return typeof t=="number"||typeof t=="object"?t:null}writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeParameterValues(t,e){if(t){const r={};for(const i in t){const n=t[i];Array.isArray(n)?r[i]=n.map(s=>s instanceof Date?s.getTime():s):n instanceof Date?r[i]=n.getTime():r[i]=n}e.parameterValues=r}}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,e.where="1=1"}writeWhere(t,e){e.where=t||"1=1"}clone(){return new AR(se({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,fullText:this.fullText,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:v(this.historicMoment)?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};qt.MAX_MAX_RECORD_COUNT_FACTOR=5,u([d({json:{write:!0}})],qt.prototype,"aggregateIds",void 0),u([d({type:Boolean,json:{write:!0}})],qt.prototype,"cacheHint",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],qt.prototype,"compactGeometryEnabled",void 0),u([d({json:{write:!0}})],qt.prototype,"datumTransformation",void 0),u([cr("datumTransformation")],qt.prototype,"castDatumTransformation",null),u([d({type:Boolean,json:{default:!1,write:!0}})],qt.prototype,"defaultSpatialReferenceEnabled",void 0),u([d({type:Number,json:{write:{overridePolicy:t=>({enabled:t>0})}}})],qt.prototype,"distance",void 0),u([d({type:$f,json:{write:!0}})],qt.prototype,"dynamicDataSource",void 0),u([d({type:String,json:{write:!0}})],qt.prototype,"formatOf3DObjects",void 0),u([d({type:[Urt],json:{write:{enabled:!0,overridePolicy(){return{enabled:v(this.fullText)&&this.fullText.length>0}}}}})],qt.prototype,"fullText",void 0),u([d({type:String,json:{write:!0}})],qt.prototype,"gdbVersion",void 0),u([d({types:Aw,json:{read:ry,write:!0}})],qt.prototype,"geometry",void 0),u([d({type:Number,json:{write:!0}})],qt.prototype,"geometryPrecision",void 0),u([d({type:[String],json:{write:!0}})],qt.prototype,"groupByFieldsForStatistics",void 0),u([d({type:String,json:{write:!0}})],qt.prototype,"having",void 0),u([d({type:Date})],qt.prototype,"historicMoment",void 0),u([De("historicMoment")],qt.prototype,"writeHistoricMoment",null),u([d({type:Number,json:{write:!0}})],qt.prototype,"maxAllowableOffset",void 0),u([d({type:Number,cast:t=>t<1?1:t>AR.MAX_MAX_RECORD_COUNT_FACTOR?AR.MAX_MAX_RECORD_COUNT_FACTOR:t,json:{write:{overridePolicy:t=>({enabled:t>1})}}})],qt.prototype,"maxRecordCountFactor",void 0),u([d({type:["xyFootprint"],json:{write:!0}})],qt.prototype,"multipatchOption",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],qt.prototype,"num",void 0),u([d({json:{write:!0}})],qt.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],qt.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],qt.prototype,"outFields",void 0),u([d({type:Je,json:{name:"outSR",write:!0}})],qt.prototype,"outSpatialReference",void 0),u([d({type:[a3e],json:{write:{enabled:!0,overridePolicy(){return{enabled:v(this.outStatistics)&&this.outStatistics.length>0}}}}})],qt.prototype,"outStatistics",void 0),u([d({json:{write:!0}})],qt.prototype,"parameterValues",void 0),u([De("parameterValues")],qt.prototype,"writeParameterValues",null),u([d({type:Ue,json:{write:!0}})],qt.prototype,"pixelSize",void 0),u([d({type:o3e,json:{write:!0}})],qt.prototype,"quantizationParameters",void 0),u([d({type:[Object],json:{write:!0}})],qt.prototype,"rangeValues",void 0),u([d({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:this.spatialRelationship==="relation"}}}}})],qt.prototype,"relationParameter",void 0),u([d({type:String,json:{write:!0}})],qt.prototype,"resultType",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],qt.prototype,"returnCentroid",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],qt.prototype,"returnDistinctValues",void 0),u([d({type:Boolean,json:{default:!0,write:!0}})],qt.prototype,"returnExceededLimitFeatures",void 0),u([d({type:Boolean,json:{write:!0}})],qt.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],qt.prototype,"returnQueryGeometry",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],qt.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],qt.prototype,"returnZ",void 0),u([d({type:Je,json:{write:!0}})],qt.prototype,"sourceSpatialReference",void 0),u([st(zrt,{ignoreUnknown:!1,name:"spatialRel"})],qt.prototype,"spatialRelationship",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],qt.prototype,"start",void 0),u([De("start"),De("num")],qt.prototype,"writeStart",null),u([d({type:String,json:{write:!0}})],qt.prototype,"sqlFormat",void 0),u([d({type:String,json:{write:!0}})],qt.prototype,"text",void 0),u([d({type:qc,json:{write:!0}})],qt.prototype,"timeExtent",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],qt.prototype,"timeReferenceUnknownClient",void 0),u([st(Vrt,{ignoreUnknown:!1}),d({json:{write:{overridePolicy(t){return{enabled:!!t&&this.distance!=null&&this.distance>0}}}}})],qt.prototype,"units",void 0),u([d({type:String,json:{write:{overridePolicy(t){return{enabled:t!=null||this.start!=null&&this.start>0}}}}})],qt.prototype,"where",void 0),u([De("where")],qt.prototype,"writeWhere",null),qt=AR=u([$("esri.rest.support.Query")],qt);const gp=qt;async function hG(t,e,r){const i=await Brt(t,e,r);return zse.fromJSON(i)}async function Brt(t,e,r){const i=kse(t),n={...r},s=gp.from(e),{data:o}=await $rt(i,s,s.sourceSpatialReference,n);return o}function fl(t,e){return t?e?4:3:e?3:2}const w3=re.getLogger("esri.layers.graphics.featureConversionUtils"),l3e={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0},jrt=(t,e,r,i,n,s)=>{t[r]=n,t[r+1]=s},Fpe=(t,e,r,i,n,s)=>{t[r]=n,t[r+1]=s,t[r+2]=e[i+2]},Grt=(t,e,r,i,n,s)=>{t[r]=n,t[r+1]=s,t[r+2]=e[i+3]},Hrt=(t,e,r,i,n,s)=>{t[r]=n,t[r+1]=s,t[r+2]=e[i+2],t[r+3]=e[i+3]};function Vse(t,e,r,i){if(t){if(r)return e&&i?Hrt:Fpe;if(e&&i)return Grt}else if(e&&i)return Fpe;return jrt}function dG({scale:t,translate:e},r){return Math.round((r-e[0])/t[0])}function pG({scale:t,translate:e},r){return Math.round((e[1]-r)/t[1])}function fG({scale:t,translate:e},r,i){return r*t[i]+e[i]}function E9t(t,e,r){return t?e?r?Gse(t):Bse(t):r?jse(t):yB(t):null}function yB(t){const e=t.coords;return{x:e[0],y:e[1]}}function c3e(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t}function Bse(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2]}}function qrt(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t}function jse(t){const e=t.coords;return{x:e[0],y:e[1],m:e[2]}}function Wrt(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.m,t}function Gse(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2],m:e[3]}}function Xrt(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t.coords[3]=e.m,t}function Yrt(t,e,r,i){let n=yB;r&&i?n=Gse:r?n=Bse:i&&(n=jse);for(const s of e){const{geometry:o,attributes:a}=s,l=v(o)?n(o):null;t.push({attributes:a,geometry:l})}return t}function Hse(t,e){return t&&e?Xrt:t?qrt:e?Wrt:c3e}function u3e(t,e,r,i,n){const s=Hse(r,i);for(const{geometry:o,attributes:a}of e){const l=v(o)?s(new dm,o):null;t.push(new sw(l,a,null,n?a[n]:void 0))}return t}function C9t(t,e,r=Hse(e.z!=null,e.m!=null)){return r(t,e)}function Zrt(t,e,r,i){for(const{geometry:n,attributes:s}of e)t.push({attributes:s,geometry:v(n)?h3e(n,r,i):null});return t}function h3e(t,e,r){if(R(t))return null;const i=fl(e,r),n=[];for(let s=0;s<t.coords.length;s+=i){const o=[];for(let a=0;a<i;a++)o.push(t.coords[s+a]);n.push(o)}return e?r?{points:n,hasZ:e,hasM:r}:{points:n,hasZ:e}:r?{points:n,hasM:r}:{points:n}}function d3e(t,e,r,i,n){const s=fl(r,i);for(const{geometry:o,attributes:a}of e){const l=v(o)?p3e(new dm,o,s):null;t.push(new sw(l,a,null,n?a[n]:void 0))}return t}function p3e(t,e,r=fl(e.hasZ,e.hasM)){t.lengths[0]=e.points.length;const i=t.coords;let n=0;for(const s of e.points)for(let o=0;o<r;o++)i[n++]=s[o];return t}function Jrt(t,e,r,i){for(const{geometry:n,attributes:s}of e)t.push({attributes:s,geometry:v(n)?f3e(n,r,i):null});return t}function f3e(t,e,r){if(!t)return null;const i=fl(e,r),{coords:n,lengths:s}=t,o=[];let a=0;for(const l of s){const c=[];for(let h=0;h<l;h++){const p=[];for(let f=0;f<i;f++)p.push(n[a++]);c.push(p)}o.push(c)}return e?r?{paths:o,hasZ:e,hasM:r}:{paths:o,hasZ:e}:r?{paths:o,hasM:r}:{paths:o}}function m3e(t,e,r,i,n){const s=fl(r,i);for(const{geometry:o,attributes:a}of e){const l=v(o)?g3e(new dm,o,s):null;t.push(new sw(l,a,null,n?a[n]:void 0))}return t}function g3e(t,e,r=fl(e.hasZ,e.hasM)){const{lengths:i,coords:n}=t;let s=0;for(const o of e.paths){for(const a of o)for(let l=0;l<r;l++)n[s++]=a[l];i.push(o.length)}return t}function Krt(t,e,r,i){for(const{geometry:n,attributes:s,centroid:o}of e){const a=v(n)?y3e(n,r,i):null;if(v(o)){const l=yB(o);t.push({attributes:s,centroid:l,geometry:a})}else t.push({attributes:s,geometry:a})}return t}function y3e(t,e,r){if(!t)return null;const i=fl(e,r),{coords:n,lengths:s}=t,o=[];let a=0;for(const l of s){const c=[];for(let h=0;h<l;h++){const p=[];for(let f=0;f<i;f++)p.push(n[a++]);c.push(p)}o.push(c)}return e?r?{rings:o,hasZ:e,hasM:r}:{rings:o,hasZ:e}:r?{rings:o,hasM:r}:{rings:o}}function _3e(t,e,r,i,n){for(const{geometry:s,centroid:o,attributes:a}of e){const l=v(s)?v3e(new dm,s,r,i):null,c=n?a[n]:void 0;v(o)?t.push(new sw(l,a,c3e(new dm,o),c)):t.push(new sw(l,a,null,c))}return t}function v3e(t,e,r=e.hasZ,i=e.hasM){return Qrt(t,e.rings,r,i),t}function Qrt(t,e,r,i){const n=fl(r,i),{lengths:s,coords:o}=t;let a=0;e_(t);for(const l of e){for(const c of l)for(let h=0;h<n;h++)o[a++]=c[h];s.push(l.length)}return t}const RR=[],M$=[];function A9t(t,e,r,i,n){RR[0]=t;const[s]=b3e(M$,RR,e,r,i,n);return pm(RR),pm(M$),s}function b3e(t,e,r,i,n,s){if(pm(t),!r){for(const o of e){const a=s?o.attributes[s]:void 0;t.push(new sw(null,o.attributes,null,a))}return t}switch(r){case"esriGeometryPoint":return u3e(t,e,i,n,s);case"esriGeometryMultipoint":return d3e(t,e,i,n,s);case"esriGeometryPolyline":return m3e(t,e,i,n,s);case"esriGeometryPolygon":return _3e(t,e,i,n,s);default:w3.error("convertToFeatureSet:unknown-geometry",new H(`Unable to parse unknown geometry type '${r}'`)),pm(t)}return t}function R9t(t,e,r,i,n,s){const o=t.length;switch(r){case"esriGeometryPoint":u3e(t,e,i,n,s);break;case"esriGeometryMultipoint":d3e(t,e,i,n,s);break;case"esriGeometryPolyline":m3e(t,e,i,n,s);break;case"esriGeometryPolygon":_3e(t,e,i,n,s);break;default:w3.error("convertToFeatureSet:unknown-geometry",new H(`Unable to parse unknown geometry type '${r}'`))}for(let a=0;a<e.length;a++)t[a+o].geometryType=r,t[a+o].insertAfter=e[a].insertAfter,t[a+o].groupId=e[a].groupId;return t}function O9t(t,e,r,i){M$[0]=t,w3e(RR,M$,e,r,i);const n=RR[0];return pm(RR),pm(M$),n}function eit(t,e,r){if(R(t))return null;const i=new dm;return"hasZ"in t&&e==null&&(e=t.hasZ),"hasM"in t&&r==null&&(r=t.hasM),dN(t)?Hse(e??t.z!=null,r??t.m!=null)(i,t):Q0(t)?v3e(i,t,e,r):a3(t)?g3e(i,t,fl(e,r)):hN(t)?p3e(i,t,fl(e,r)):void w3.error("convertFromGeometry:unknown-geometry",new H(`Unable to parse unknown geometry type '${t}'`))}function tit(t,e,r,i){const n=t&&("coords"in t?t:t.geometry);if(R(n))return null;switch(e){case"esriGeometryPoint":{let s=yB;return r&&i?s=Gse:r?s=Bse:i&&(s=jse),s(n)}case"esriGeometryMultipoint":return h3e(n,r,i);case"esriGeometryPolyline":return f3e(n,r,i);case"esriGeometryPolygon":return y3e(n,r,i);default:return w3.error("convertToGeometry:unknown-geometry",new H(`Unable to parse unknown geometry type '${e}'`)),null}}function rit(t,e){for(const r of e)t.push({attributes:r.attributes});return t}function w3e(t,e,r,i,n){if(pm(t),R(r))return rit(t,e);switch(r){case"esriGeometryPoint":return Yrt(t,e,i,n);case"esriGeometryMultipoint":return Zrt(t,e,i,n);case"esriGeometryPolyline":return Jrt(t,e,i,n);case"esriGeometryPolygon":return Krt(t,e,i,n);default:w3.error("convertToFeatureSet:unknown-geometry",new H(`Unable to parse unknown geometry type '${r}'`))}return t}function M9t(t){const{objectIdFieldName:e,spatialReference:r,transform:i,fields:n,hasM:s,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:h,queryGeometry:p,queryGeometryType:f}=t,m={features:w3e([],a,l,o,s),fields:n,geometryType:l,objectIdFieldName:e,spatialReference:r,uniqueIdField:h,queryGeometry:tit(p,f,!1,!1)};return i&&(m.transform=i),c&&(m.exceededTransferLimit=c),s&&(m.hasM=s),o&&(m.hasZ=o),m}function P9t(t,e){const r=new i3e,{hasM:i,hasZ:n,features:s,objectIdFieldName:o,spatialReference:a,geometryType:l,exceededTransferLimit:c,transform:h,fields:p}=t;return p&&(r.fields=p),r.geometryType=l??null,r.objectIdFieldName=o??e??null,r.spatialReference=a??null,r.objectIdFieldName?(s&&b3e(r.features,s,l,n,i,r.objectIdFieldName),c&&(r.exceededTransferLimit=c),i&&(r.hasM=i),n&&(r.hasZ=n),h&&(r.transform=h),r):(w3.error(new H("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),r)}function I9t(t){const{transform:e,features:r,hasM:i,hasZ:n}=t;if(!e)return t;for(const s of r)v(s.geometry)&&Upe(s.geometry,s.geometry,i,n,e),v(s.centroid)&&Upe(s.centroid,s.centroid,i,n,e);return t.transform=null,t}function $9t(t,e){const{geometryType:r,features:i,hasM:n,hasZ:s}=e;if(!t)return e;for(let o=0;o<i.length;o++){const a=i[o],l=a.weakClone();l.geometry=new dm,kpe(l.geometry,a.geometry,n,s,r,t),a.centroid&&(l.centroid=new dm,kpe(l.centroid,a.centroid,n,s,"esriGeometryPoint",t)),i[o]=l}return e.transform=t,e}function kpe(t,e,r,i,n,s,o=r,a=i){if(e_(t),R(e)||!e.coords.length)return null;const l=l3e[n],{coords:c,lengths:h}=e,p=fl(r,i),f=fl(r&&o,i&&a),m=Vse(r,i,o,a);if(!h.length)return m(t.coords,c,0,0,dG(s,c[0]),pG(s,c[1])),e_(t,p,0),t;let g,_,b,w,x=0,T=0,E=T;for(const C of h){if(C<l)continue;let A=0;T=E,b=g=dG(s,c[x]),w=_=pG(s,c[x+1]),m(t.coords,c,T,x,b,w),A++,x+=p,T+=f;for(let I=1;I<C;I++,x+=p)b=dG(s,c[x]),w=pG(s,c[x+1]),b===g&&w===_||(m(t.coords,c,T,x,b-g,w-_),T+=f,A++,g=b,_=w);A>=l&&(t.lengths.push(A),E=T)}return pm(t.coords,E),t.coords.length?t:null}function L9t(t,e,r,i,n,s,o=r,a=i){if(e_(t),!e||!e.coords.length)return null;const l=l3e[n],{coords:c,lengths:h}=e,p=fl(r,i),f=fl(r&&o,i&&a),m=Vse(r,i,o,a);if(!h.length)return m(t.coords,c,0,0,c[0],c[1]),e_(t,p,0),t;let g=0;const _=s*s;for(const b of h){if(b<l){g+=b*p;continue}const w=t.coords.length/f,x=g,T=g+(b-1)*p;m(t.coords,c,t.coords.length,x,c[x],c[x+1]),GJ(t.coords,c,p,_,m,x,T),m(t.coords,c,t.coords.length,T,c[T],c[T+1]);const E=t.coords.length/f-w;E>=l?t.lengths.push(E):pm(t.coords,w*f),g+=b*p}return t.coords.length?t:null}function iit(t,e,r,i){const n=t[e],s=t[e+1],o=t[r],a=t[r+1],l=t[i],c=t[i+1];let h=o,p=a,f=l-h,m=c-p;if(f!==0||m!==0){const g=((n-h)*f+(s-p)*m)/(f*f+m*m);g>1?(h=l,p=c):g>0&&(h+=f*g,p+=m*g)}return f=n-h,m=s-p,f*f+m*m}function GJ(t,e,r,i,n,s,o){let a,l=i,c=0;for(let h=s+r;h<o;h+=r)a=iit(e,h,s,o),a>l&&(c=h,l=a);l>i&&(c-s>r&&GJ(t,e,r,i,n,s,c),n(t,e,t.length,c,e[c],e[c+1]),o-c>r&&GJ(t,e,r,i,n,c,o))}function D9t(t,e,r,i){if(R(e)||!e.coords||!e.coords.length)return null;const n=fl(r,i);let s=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(e&&e.coords){const c=e.coords;for(let h=0;h<c.length;h+=n){const p=c[h],f=c[h+1];s=Math.min(s,p),a=Math.max(a,p),o=Math.min(o,f),l=Math.max(l,f)}}return pZ(t)?gWe(t,s,o,a,l):Ane(s,o,a,l,t),t}function Upe(t,e,r,i,n){const{coords:s,lengths:o}=e,a=fl(r,i);if(!s.length)return t!==e&&e_(t),t;b9(n);const{originPosition:l,scale:c,translate:h}=n,p=sit;p.originPosition=l;const f=p.scale;f[0]=c[0]??1,f[1]=-(c[1]??1),f[2]=c[2]??1,f[3]=c[3]??1;const m=p.translate;if(m[0]=h[0]??0,m[1]=h[1]??0,m[2]=h[2]??0,m[3]=h[3]??0,!o.length){for(let _=0;_<a;++_)t.coords[_]=fG(p,s[_],_);return t!==e&&e_(t,a,0),t}let g=0;for(let _=0;_<o.length;_++){const b=o[_];t.lengths[_]=b;for(let T=0;T<a;++T)t.coords[g+T]=fG(p,s[g+T],T);let w=t.coords[g],x=t.coords[g+1];g+=a;for(let T=1;T<b;T++,g+=a){w+=s[g]*f[0],x+=s[g+1]*f[1],t.coords[g]=w,t.coords[g+1]=x;for(let E=2;E<a;++E)t.coords[g+E]=fG(p,s[g+E],E)}}return t!==e&&e_(t,s.length,o.length),t}function N9t(t,e,r,i,n,s){if(e_(t),t.lengths.push(...e.lengths),r===n&&i===s)for(let o=0;o<e.coords.length;o++)t.coords.push(e.coords[o]);else{const o=fl(r,i),a=Vse(r,i,n,s),l=e.coords;for(let c=0;c<l.length;c+=o)a(t.coords,l,t.coords.length,c,l[c],l[c+1])}return t}function nit(t,e,r,i){let n=0,s=t[i*e],o=t[i*(e+1)];for(let a=1;a<r;a++){const l=s+t[i*(e+a)],c=o+t[i*(e+a)+1],h=(l-s)*(c+o);s=l,o=c,n+=h}return .5*n}function F9t(t,e){const{coords:r,lengths:i}=t;let n=0,s=0;for(let o=0;o<i.length;o++){const a=i[o];s+=nit(r,n,a,e),n+=a}return Math.abs(s)}function k9t(t,e){if(R(t))return null;const r=t.clone(),i=t.coords,n=t.lengths;let s=0;for(let o=0;o<n.length;o++){const a=n[o];let l=i[e*s],c=i[e*s+1];for(let h=1;h<a;h++){const p=l+i[e*(s+h)],f=c+i[e*(s+h)+1];r.coords[e*(s+h)]=p,r.coords[e*(s+h)+1]=f,l=p,c=f}s+=a}return r}function e_(t,e=0,r=0){pm(t.lengths,r),pm(t.coords,e)}function pm(t,e=0){t.length!==e&&(t.length=e)}const sit={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]};var HJ;let ms=HJ=class extends fe{constructor(t){super(t),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,this.start>0&&this.where==null&&(e.definitionExpression="1=1")}clone(){return new HJ(se({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};u([d({type:Boolean,json:{write:!0}})],ms.prototype,"cacheHint",void 0),u([d({type:$f,json:{write:!0}})],ms.prototype,"dynamicDataSource",void 0),u([d({type:String,json:{write:!0}})],ms.prototype,"gdbVersion",void 0),u([d({type:Number,json:{write:!0}})],ms.prototype,"geometryPrecision",void 0),u([d({type:Date})],ms.prototype,"historicMoment",void 0),u([De("historicMoment")],ms.prototype,"_writeHistoricMoment",null),u([d({type:Number,json:{write:!0}})],ms.prototype,"maxAllowableOffset",void 0),u([d({type:[Number],json:{write:!0}})],ms.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],ms.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],ms.prototype,"outFields",void 0),u([d({type:Je,json:{read:{source:"outSR"},write:{target:"outSR"}}})],ms.prototype,"outSpatialReference",void 0),u([d({json:{write:!0}})],ms.prototype,"relationshipId",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],ms.prototype,"start",void 0),u([De("start"),De("num")],ms.prototype,"writeStart",null),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],ms.prototype,"num",void 0),u([d({json:{write:!0}})],ms.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],ms.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],ms.prototype,"returnZ",void 0),u([d({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],ms.prototype,"where",void 0),ms=HJ=u([$("esri.rest.support.RelationshipQuery")],ms),ms.from=bs(ms);const RO=ms,U9t=Object.freeze(Object.defineProperty({__proto__:null,default:RO},Symbol.toStringTag,{value:"Module"}));var qJ;let $C=qJ=class extends fe{constructor(t){super(t),this.groupByFields=void 0,this.topCount=void 0,this.orderByFields=void 0}clone(){return new qJ({groupByFields:this.groupByFields,topCount:this.topCount,orderByFields:this.orderByFields})}};u([d({type:[String],json:{write:!0}})],$C.prototype,"groupByFields",void 0),u([d({type:Number,json:{write:!0}})],$C.prototype,"topCount",void 0),u([d({type:[String],json:{write:!0}})],$C.prototype,"orderByFields",void 0),$C=qJ=u([$("esri.rest.support.TopFilter")],$C);const oit=$C;var WJ;const zpe=new mr({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),Vpe=new mr({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let zn=WJ=class extends fe{constructor(t){super(t),this.cacheHint=void 0,this.distance=void 0,this.geometry=null,this.geometryPrecision=void 0,this.maxAllowableOffset=void 0,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.resultType=null,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.start=void 0,this.spatialRelationship="intersects",this.timeExtent=null,this.topFilter=void 0,this.units=null,this.where="1=1"}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new WJ(se({cacheHint:this.cacheHint,distance:this.distance,geometry:this.geometry,geometryPrecision:this.geometryPrecision,maxAllowableOffset:this.maxAllowableOffset,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,resultType:this.resultType,returnGeometry:this.returnGeometry,returnZ:this.returnZ,returnM:this.returnM,start:this.start,spatialRelationship:this.spatialRelationship,timeExtent:this.timeExtent,topFilter:this.topFilter,units:this.units,where:this.where}))}};u([d({type:Boolean,json:{write:!0}})],zn.prototype,"cacheHint",void 0),u([d({type:Number,json:{write:{overridePolicy:t=>({enabled:t>0})}}})],zn.prototype,"distance",void 0),u([d({types:Aw,json:{read:ry,write:!0}})],zn.prototype,"geometry",void 0),u([d({type:Number,json:{write:!0}})],zn.prototype,"geometryPrecision",void 0),u([d({type:Number,json:{write:!0}})],zn.prototype,"maxAllowableOffset",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],zn.prototype,"num",void 0),u([d({json:{write:!0}})],zn.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],zn.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],zn.prototype,"outFields",void 0),u([d({type:Je,json:{read:{source:"outSR"},write:{target:"outSR"}}})],zn.prototype,"outSpatialReference",void 0),u([d({type:String,json:{write:!0}})],zn.prototype,"resultType",void 0),u([d({json:{write:!0}})],zn.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],zn.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],zn.prototype,"returnZ",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],zn.prototype,"start",void 0),u([De("start"),De("num")],zn.prototype,"writeStart",null),u([d({type:String,json:{read:{source:"spatialRel",reader:zpe.read},write:{target:"spatialRel",writer:zpe.write}}})],zn.prototype,"spatialRelationship",void 0),u([d({type:qc,json:{write:!0}})],zn.prototype,"timeExtent",void 0),u([d({type:oit,json:{write:!0}})],zn.prototype,"topFilter",void 0),u([d({type:String,json:{read:Vpe.read,write:{writer:Vpe.write,overridePolicy(t){return{enabled:v(t)&&v(this.distance)&&this.distance>0}}}}})],zn.prototype,"units",void 0),u([d({type:String,json:{write:!0}})],zn.prototype,"where",void 0),zn=WJ=u([$("esri.rest.support.TopFeaturesQuery")],zn),zn.from=bs(zn);const ZF=zn,ait="esri.widgets.Feature.support.relatedFeatureUtils",Bpe=re.getLogger(ait),jpe=new Map;function D6(t){if(!j0(t))return null;const[e,r]=t.split("/").slice(1);return{layerId:e,fieldName:r}}function lit(t,e){if(!e.relationships)return null;let r=null;const{relationships:i}=e;return i.some(n=>n.id===parseInt(t,10)&&(r=n,!0)),r}function cit({originRelationship:t,relationships:e,layerId:r}){let i=null;return e&&e.some(n=>(`${n.relatedTableId}`===r&&n.id===(t==null?void 0:t.id)&&(i=n),!!i)),i}function uit(t,e){const r=e.toLowerCase();for(const i in t)if(i.toLowerCase()===r)return t[i];return null}function hit(t,e){const r=lit(t,e);if(r)return{url:`${e.url}/${r.relatedTableId}`,sourceSpatialReference:e.spatialReference,relation:r,relatedFields:[],outStatistics:[]}}function dit(t,e){if(!e||!t)return;const{features:r,statsFeatures:i}=t,n=r&&r.value;e.relatedFeatures=n?n.features:[];const s=i&&i.value;e.relatedStatsFeatures=s?s.features:[]}function pit(t,e,r,i){var s;const n=new RO;return n.outFields=["*"],n.relationshipId=typeof e.id=="number"?e.id:parseInt(e.id,10),n.objectIds=[t.attributes[r.objectIdField]],((s=r.queryRelatedFeatures)==null?void 0:s.call(r,n,i))??Promise.resolve({})}function fit(t,e,r){let i=0;const n=[];for(;i<e.length;)n.push(`${t} IN (${e.slice(i,r+i)})`),i+=r;return n.join(" OR ")}async function mit(t,e,r,i){const n=r.layerId.toString(),{layerInfo:s,relation:o,relatedFields:a,outStatistics:l,url:c,sourceSpatialReference:h}=e;if(!s||!o)return null;const p=cit({originRelationship:o,relationships:s.relationships,layerId:n});if(p!=null&&p.relationshipTableId&&p.keyFieldInRelationshipTable){const m=(await pit(t,p,r,i))[t.attributes[r.objectIdField]];if(!m)return null;const g=m.features.map(_=>_.attributes[s.objectIdField]);if(l!=null&&l.length&&s.supportsStatistics){const _=new gp;_.where=fit(s.objectIdField,g,1e3),_.outFields=a,_.outStatistics=l,_.sourceSpatialReference=h;const b={features:Promise.resolve(m),statsFeatures:hG(c,_)};return ha(b)}}const f=p==null?void 0:p.keyField;if(f){const m=M9(bit(s.fields,f)),g=uit(t.attributes,o.keyField),_=m?`${f}=${g}`:`${f}='${g}'`,b=hG(c,new gp({where:_,outFields:e.relatedFields,sourceSpatialReference:h}),i),w=e.outStatistics&&e.outStatistics.length>0&&s.supportsStatistics?hG(c,new gp({where:_,outFields:e.relatedFields,outStatistics:e.outStatistics,sourceSpatialReference:h}),i):null,x={features:b};return w&&(x.statsFeatures=w),ha(x)}return null}function git(t,e){return ei(t,{query:{f:"json"},signal:e&&e.signal})}function yit({relatedInfos:t,layer:e},r){const i={};return t.forEach((n,s)=>{const{relation:o}=n;if(!o){const p=new H("relation-required","A relation is required on a layer to retrieve related records.");throw Bpe.error(p),p}const{relatedTableId:a}=o;if(typeof a!="number"){const p=new H("A related table ID is required on a layer to retrieve related records.");throw Bpe.error(p),p}const l=`${e.url}/${a}`,c=jpe.get(l),h=c||git(l);c||jpe.set(l,h),i[s]=h}),Hie(ha(i),r)}function _it({graphic:t,relatedInfos:e,layer:r},i){const n={};return e.forEach((s,o)=>{s.layerInfo&&(n[o]=mit(t,s,r,i))}),ha(n)}function vit({relatedInfo:t,fieldName:e,fieldInfo:r}){var i,n;if((i=t.relatedFields)==null||i.push(e),r.statisticType){const s=new a3e({statisticType:r.statisticType,onStatisticField:e,outStatisticFieldName:e});(n=t.outStatistics)==null||n.push(s)}}function bit(t,e){if(t!=null){e=e.toLowerCase();for(const r of t)if(r&&r.name.toLowerCase()===e)return r}return null}const Gpe={chartAnimation:!0};let bo=class extends be{constructor(e){super(e),this.abilities={...Gpe},this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.isAggregate=!1,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(e){return{...Gpe,...e}}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){const{formattedMediaInfoCount:r}=this,i=(e+r)%r;this.activeMediaInfoIndex=i}_pageContentElementMedia(e){const{activeMediaInfoIndex:r}=this,i=r+e;this._setContentElementMedia(i)}_formatMediaInfos(){const{mediaInfos:e,layer:r}=this,i=this.attributes??{},n=this.formattedAttributes??{},s=this.expressionAttributes??{},o=this.fieldInfoMap??new Map;return(e==null?void 0:e.map(a=>{const l=a==null?void 0:a.clone();if(!l)return null;if(l.title=fS({attributes:i,fieldInfoMap:o,globalAttributes:n,expressionAttributes:s,layer:r,text:l.title}),l.caption=fS({attributes:i,fieldInfoMap:o,globalAttributes:n,expressionAttributes:s,layer:r,text:l.caption}),l.altText=fS({attributes:i,fieldInfoMap:o,globalAttributes:n,expressionAttributes:s,layer:r,text:l.altText}),l.type==="image"){const{value:c}=l;return this._setImageValue({value:c,formattedAttributes:n,layer:r}),l.value.sourceURL?l:void 0}if(l.type==="pie-chart"||l.type==="line-chart"||l.type==="column-chart"||l.type==="bar-chart"){const{value:c}=l;return this._setChartValue({value:c,chartType:l.type,attributes:i,formattedAttributes:n,layer:r,expressionAttributes:s}),l}return null}).filter(v))??[]}_setImageValue(e){const r=this.fieldInfoMap??new Map,{value:i,formattedAttributes:n,layer:s}=e,{linkURL:o,sourceURL:a}=i;if(a){const l=wJ(a,s);i.sourceURL=bJ({formattedAttributes:n,template:l,fieldInfoMap:r})}if(o){const l=wJ(o,s);i.linkURL=bJ({formattedAttributes:n,template:l,fieldInfoMap:r})}}_setChartValue(e){const{value:r,attributes:i,formattedAttributes:n,chartType:s,layer:o,expressionAttributes:a}=e,{popupTemplate:l,relatedInfos:c}=this,{fields:h,normalizeField:p}=r,f=o;if(r.fields=XQe(h,f),p&&(r.normalizeField=QL(p,f)),!h.some(g=>!!(n[g]!=null||j0(g)&&(c!=null&&c.size))))return;const m=(l==null?void 0:l.fieldInfos)??[];h.forEach(g=>{if(j0(g))return void(r.series=[...r.series,...this._getRelatedChartInfos({fieldInfos:m,fieldName:g,formattedAttributes:n,chartType:s,value:r})]);const _=this._getChartOption({value:r,attributes:i,chartType:s,formattedAttributes:n,expressionAttributes:a,fieldName:g,fieldInfos:m});r.series.push(_)})}_getRelatedChartInfos(e){var m;const{fieldInfos:r,fieldName:i,formattedAttributes:n,chartType:s,value:o}=e,a=[],l=D6(i),c=l&&((m=this.relatedInfos)==null?void 0:m.get(l.layerId.toString()));if(!c)return a;const{relatedFeatures:h,relation:p}=c;if(!p||!h)return a;const{cardinality:f}=p;return h.forEach(g=>{const{attributes:_}=g;_&&Object.keys(_).forEach(b=>{b===l.fieldName&&a.push(this._getChartOption({value:o,attributes:_,formattedAttributes:n,fieldName:i,chartType:s,relatedFieldName:b,hasMultipleRelatedFeatures:(h==null?void 0:h.length)>1,fieldInfos:r}))})}),f==="one-to-many"||f==="many-to-many"?a:[a[0]]}_getTooltip({label:e,value:r,chartType:i}){return i==="pie-chart"?`${e}`:`${e}: ${r}`}_getChartOption(e){var A;const{value:r,attributes:i,formattedAttributes:n,expressionAttributes:s,fieldName:o,relatedFieldName:a,fieldInfos:l,chartType:c,hasMultipleRelatedFeatures:h}=e,p=this.layer,f=this.fieldInfoMap??new Map,{normalizeField:m,tooltipField:g}=r,_=m?j0(m)?i[D6(m).fieldName]:i[m]:null,b=xse(o)&&s&&s[o]!==void 0?s[o]:a&&i[a]!==void 0?i[a]:i[o]!==void 0?i[o]:n[o],w=new REe({fieldName:o,value:b===void 0?null:b&&_?b/_:b});if(j0(o)){const I=f.get(o.toLowerCase()),M=g&&f.get(g.toLowerCase()),D=(I==null?void 0:I.fieldName)??o,U=h&&g?D6(g).fieldName:(M==null?void 0:M.fieldName)??g,z=h&&U?i[U]:n[U]??(I==null?void 0:I.label)??(I==null?void 0:I.fieldName)??a,B=h&&a?i[a]:n[D];return w.tooltip=this._getTooltip({label:z,value:B,chartType:c}),w}const x=SOe(l,o),T=QL(o,p),E=g&&n[g]!==void 0?n[g]:xOe(x||new pN({fieldName:T}),(A=this.popupTemplate)==null?void 0:A.expressionInfos),C=n[T];return w.tooltip=this._getTooltip({label:E,value:C,chartType:c}),w}};u([d()],bo.prototype,"abilities",void 0),u([cr("abilities")],bo.prototype,"castAbilities",null),u([d()],bo.prototype,"activeMediaInfoIndex",void 0),u([d({readOnly:!0})],bo.prototype,"activeMediaInfo",null),u([d()],bo.prototype,"attributes",void 0),u([d()],bo.prototype,"description",void 0),u([d()],bo.prototype,"fieldInfoMap",void 0),u([d()],bo.prototype,"formattedAttributes",void 0),u([d()],bo.prototype,"expressionAttributes",void 0),u([d({readOnly:!0})],bo.prototype,"formattedMediaInfos",null),u([d()],bo.prototype,"isAggregate",void 0),u([d()],bo.prototype,"layer",void 0),u([d({readOnly:!0})],bo.prototype,"formattedMediaInfoCount",null),u([d()],bo.prototype,"mediaInfos",void 0),u([d()],bo.prototype,"popupTemplate",void 0),u([d()],bo.prototype,"relatedInfos",void 0),u([d()],bo.prototype,"title",void 0),bo=u([$("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],bo);const mS=bo;var Hpe=["#ffffff","#858585","#ffbebe","#ffebbe","#ffebaf","#ffffbe","#e9ffbe","#d3ffbe","#beffe8","#bee8ff","#bed2ff","#e8beff","#ffbee8","#ebebeb","#707070","#ff7f7f","#ffa77f","#ffd37f","#ffff73","#d1ff73","#a3ff73","#73ffdf","#73dfff","#73b2ff","#df73ff","#ff73df","#d6d6d6","#5c5c5c","#ff0000","#ff5500","#ffaa00","#ffff00","#aaff00","#55ff00","#00ffc5","#00c5ff","#0070ff","#c500ff","#ff00c5","#c2c2c2","#474747","#e60000","#e64c00","#e69800","#e6e600","#98e600","#4ce600","#00e6a9","#00a9e6","#005ce6","#a900e6","#e600a9","#adadad","#242424","#a80000","#a83800","#a87000","#a8a800","#70a800","#38a800","#00a884","#0084a8","#004da8","#8400a8","#a80084","#999999","#1a1a1a","#730000","#732600","#734c00","#737300","#4c7300","#267300","#00734c","#004c73","#002673","#4c0073","#73004"],wit=[].concat(Hpe.slice(30,39),Hpe.slice(28,30).reverse()),xit=[{name:"default",colors:wit},{name:"cat-dark",colors:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99","#6b6bd6","#b54779","#7f7f7f"]},{name:"tropical-bliss",colors:["#fce138","#ff9399","#fcd27e","#f1983c","#a553b7","#b1a9d0","#6ecffc","#4c81cd","#fc6f84","#fc3e5a","#6af689","#48885c"]},{name:"desert-blooms",colors:["#102432","#144d59","#ffc730","#ed9310","#a64f1b","#661510","#d9351a","#b31515","#4a0932","#8c213f","#18382e","#2c6954"]},{name:"under-the-sea",colors:["#bf9727","#607100","#00734c","#704489","#01acca","#024e76","#f09100","#ea311f","#c6004b","#7570b3","#666666","#333333"]},{name:"vibrant-rainbow",colors:["#fffb00","#f5cb11","#9fd40c","#46e39c","#32b8a6","#7ff2fa","#ac08cc","#dd33ff","#eb7200","#e8a784","#bf2e2e","#6c7000"]},{name:"ocean-bay",colors:["#191921","#11495c","#78b1c2","#454f4b","#8f8f82","#9be0c0","#87b051","#f7ec88","#ebdcc1","#dbb658","#c43541","#75351e"]},{name:"prairie-summer",colors:["#332424","#751555","#d47013","#d68989","#211173","#82aad6","#7bfaeb","#6ec9a8","#6b6408","#eada40","#ccc54a","#1fc235"]},{name:"pastel-chalk",colors:["#fffd99","#f5e6a4","#c1d48c","#b8e3d0","#a0b8b5","#cbf7fa","#d791f2","#dfc1eb","#f2b983","#e8c4b2","#bf8e8e","#94995c"]},{name:"seq-yellow-orange-red-bright",colors:["#910000","#b1260b","#c0370f","#e05919","#ef6a1d","#ff7b22","#ffa143","#ffb454","#ffda74","#ffed85"]},{name:"seq-reds-bright",colors:["#57453b","#7b4238","#9f4036","#c23d33","#d7483c","#ec5244","#f3696c","#f9816c","#ffc4ae","#fff0dc"]},{name:"seq-purples-bright",colors:["#4e465c","#5a4a78","#695291","#775baa","#8663c3","#946bdc","#aa89e8","#c1a6f3","#d7c4ff","#e6e1ff"]},{name:"seq-blues-bright",colors:["#404d54","#435c6c","#48799d","#4b88b6","#4d96ce","#50a5e7","#74bbed","#98d0f3","#bce6f9","#e6faff"]},{name:"seq-greens-bright",colors:["#39544c","#386757","#368165","#359b73","#33b581","#4bc392","#64d2a2","#7ce0b3","#cbf6d9","#f4ffea"]},{name:"seq-browns-bright",colors:["#524834","#715b38","#8f6e3c","#ae8140","#cc9444","#eba748","#eeb664","#f0c47f","#f9e0b7","#fff8eb"]}];const qpe="en-us",qse=new Map([["ar",()=>Q(()=>import("./ar-bb1fe5ab.js"),["assets/ar-bb1fe5ab.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.a)],["bg-bg",()=>Q(()=>import("./bg_BG-184a2bfa.js"),["assets/bg_BG-184a2bfa.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.b)],["bs-ba",()=>Q(()=>import("./bs_BA-f32cc344.js"),["assets/bs_BA-f32cc344.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.b)],["ca-es",()=>Q(()=>import("./ca_ES-d17ee95b.js"),["assets/ca_ES-d17ee95b.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.c)],["cs-cz",()=>Q(()=>import("./cs_CZ-bcd1e782.js"),["assets/cs_CZ-bcd1e782.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.c)],["da-dk",()=>Q(()=>import("./da_DK-27b1b06e.js"),["assets/da_DK-27b1b06e.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.d)],["de-de",()=>Q(()=>import("./de_DE-c0a1d8dd.js"),["assets/de_DE-c0a1d8dd.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.d)],["de-ch",()=>Q(()=>import("./de_CH-be7b4255.js"),["assets/de_CH-be7b4255.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.d)],["el-gr",()=>Q(()=>import("./el_GR-05fb9ec0.js"),["assets/el_GR-05fb9ec0.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.e)],["en-us",()=>Q(()=>import("./en_US-170979d8.js"),["assets/en_US-170979d8.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.e)],["en-ca",()=>Q(()=>import("./en_CA-170979d8.js"),["assets/en_CA-170979d8.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.e)],["es-es",()=>Q(()=>import("./es_ES-d0b66640.js"),["assets/es_ES-d0b66640.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.e)],["et-ee",()=>Q(()=>import("./et_EE-56dd74d3.js"),["assets/et_EE-56dd74d3.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.e)],["fi-fi",()=>Q(()=>import("./fi_FI-91d58cb9.js"),["assets/fi_FI-91d58cb9.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.f)],["fr-fr",()=>Q(()=>import("./fr_FR-a11503e0.js"),["assets/fr_FR-a11503e0.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.f)],["he-il",()=>Q(()=>import("./he_IL-90db98c4.js"),["assets/he_IL-90db98c4.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.h)],["hr-hr",()=>Q(()=>import("./hr_HR-fac8bb29.js"),["assets/hr_HR-fac8bb29.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.h)],["hu-hu",()=>Q(()=>import("./hu_HU-e8803856.js"),["assets/hu_HU-e8803856.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.h)],["id-id",()=>Q(()=>import("./id_ID-86e57d06.js"),["assets/id_ID-86e57d06.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.i)],["it-it",()=>Q(()=>import("./it_IT-2d4485ba.js"),["assets/it_IT-2d4485ba.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.i)],["ja-jp",()=>Q(()=>import("./ja_JP-77c6c16d.js"),["assets/ja_JP-77c6c16d.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.j)],["ko-kr",()=>Q(()=>import("./ko_KR-e155b9ab.js"),["assets/ko_KR-e155b9ab.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.k)],["lt-lt",()=>Q(()=>import("./lt_LT-fde47ae9.js"),["assets/lt_LT-fde47ae9.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.l)],["lv-lv",()=>Q(()=>import("./lv_LV-359be050.js"),["assets/lv_LV-359be050.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.l)],["nb-no",()=>Q(()=>import("./nb_NO-30d57c1a.js"),["assets/nb_NO-30d57c1a.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.n)],["nl-nl",()=>Q(()=>import("./nl_NL-cb904b48.js"),["assets/nl_NL-cb904b48.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.n)],["pl-pl",()=>Q(()=>import("./pl_PL-58c54c9f.js"),["assets/pl_PL-58c54c9f.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.p)],["pt-br",()=>Q(()=>import("./pt_BR-d2e10248.js"),["assets/pt_BR-d2e10248.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.p)],["pt-pt",()=>Q(()=>import("./pt_PT-65a41842.js"),["assets/pt_PT-65a41842.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.p)],["ro-ro",()=>Q(()=>import("./ro_RO-15e90e9f.js"),["assets/ro_RO-15e90e9f.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.r)],["ru-ru",()=>Q(()=>import("./ru_RU-a74d21e5.js"),["assets/ru_RU-a74d21e5.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.r)],["sk-sk",()=>Q(()=>import("./sk_SK-a928dbd1.js"),["assets/sk_SK-a928dbd1.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.s)],["sl-sl",()=>Q(()=>import("./sl_SL-1a3c3078.js"),["assets/sl_SL-1a3c3078.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.s)],["sr-rs",()=>Q(()=>import("./sr_RS-0b18b911.js"),["assets/sr_RS-0b18b911.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.s)],["sv-se",()=>Q(()=>import("./sv_SE-ce7e3f84.js"),["assets/sv_SE-ce7e3f84.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.s)],["th-th",()=>Q(()=>import("./th_TH-1448f333.js"),["assets/th_TH-1448f333.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.t)],["tr-tr",()=>Q(()=>import("./tr_TR-dd92f630.js"),["assets/tr_TR-dd92f630.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.t)],["uk-ua",()=>Q(()=>import("./uk_UA-fe4434ed.js"),["assets/uk_UA-fe4434ed.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.u)],["vi-vn",()=>Q(()=>import("./vi_VN-41938633.js"),["assets/vi_VN-41938633.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.v)],["zh-cn",()=>Q(()=>import("./zh_Hans-524a1291.js"),["assets/zh_Hans-524a1291.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.z)],["zh-hk",()=>Q(()=>import("./zh_Hant-0e1f08e5.js"),["assets/zh_Hant-0e1f08e5.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.z)],["zh-tw",()=>Q(()=>import("./zh_Hant-0e1f08e5.js"),["assets/zh_Hant-0e1f08e5.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.z)]]);function Tit(t){const e=t.split("-")[0].toLowerCase();let r=null;for(const i of qse.keys())if(i.startsWith(e)){r=i;break}return r}function Sit(t){return t?qse.has(t.toLowerCase())?t.toLowerCase():Tit(t)||qpe:qpe}let Q2=null,fM=null;async function Eit(t=mp()){if(t=Sit(t),Q2&&t===fM)return Q2;Q2=Q(()=>import("./index-a70dd312.js"),["assets/index-a70dd312.js","assets/_commonjsHelpers-2f3e7994.js"]).then(e=>e.i),fM=t;try{const[e,r]=await Promise.all([Q2,qse.get(fM)()]);fM===t&&(e.am4core.options.defaultLocale=r.default),e.am4core.options.suppressWarnings=!0,e.am4core.options.autoDispose=!0}catch{return Q2=null,fM=null,null}return Q2}function Cit(t,e="default"){const r=xit.find(i=>i.name===e);return r?r.colors.map(i=>t.color(i)):null}const ic="esri-feature-media",ws={base:ic,mediaContainer:`${ic}__container`,mediaItemContainer:`${ic}__item-container`,mediaItem:`${ic}__item`,mediaItemTitle:`${ic}__item-title`,mediaItemCaption:`${ic}__item-caption`,mediaPrevious:`${ic}__previous`,mediaPreviousIconLTR:`${ic}__previous-icon`,mediaPreviousIconRTL:`${ic}__previous-icon--rtl`,mediaNext:`${ic}__next`,mediaNextIconLTR:`${ic}__next-icon`,mediaNextIconRTL:`${ic}__next-icon--rtl`,mediaChart:`${ic}__chart`,mediaButton:`${ic}__button`,mediaIcon:`${ic}__icon`,iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow"},mG=.05,gG=.95,yG=15,My="color",uv="tooltip",mM="value",Wpe="default-line-value";let uu=class extends Ga{constructor(e,r){super(e,r),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this.viewModel=new mS,this.messages=null,this._getChartDependencies=async i=>{const n=await Eit(),{destroyed:s,viewModel:o}=this;if(s||!o||!i)return;const{activeMediaInfo:a}=o,l=await this._getRendererColors(n);this._renderChart({chartDiv:i,mediaInfo:a,chartsModule:n,colorMap:l})}}initialize(){this._featureElementInfo=new hB,this.addHandles([ne(()=>{var e,r;return[(e=this.viewModel)==null?void 0:e.activeMediaInfo,(r=this.viewModel)==null?void 0:r.activeMediaInfoIndex]},()=>this._setupMediaRefreshTimer(),Vt),ne(()=>{var e,r;return[(e=this.viewModel)==null?void 0:e.description,(r=this.viewModel)==null?void 0:r.title]},()=>this._setupFeatureElementInfo(),Vt)])}destroy(){var e;this._clearMediaRefreshTimer(),(e=this._featureElementInfo)==null||e.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get activeMediaInfoIndex(){return this.viewModel.activeMediaInfoIndex}set activeMediaInfoIndex(e){this.viewModel.activeMediaInfoIndex=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get fieldInfoMap(){return this.viewModel.fieldInfoMap}set fieldInfoMap(e){this.viewModel.fieldInfoMap=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get mediaInfos(){return this.viewModel.mediaInfos}set mediaInfos(e){this.viewModel.mediaInfos=e}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(e){this.viewModel.popupTemplate=e}get relatedInfos(){return this.viewModel.relatedInfos}set relatedInfos(e){this.viewModel.relatedInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){var e;return ie("div",{bind:this,class:ws.base,onkeyup:this._handleMediaKeyup},(e=this._featureElementInfo)==null?void 0:e.render(),this.renderMedia())}renderMedia(){const{formattedMediaInfoCount:e}=this.viewModel;return e?ie("div",{key:"media-element-container",class:ws.mediaContainer},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null}renderImageMediaInfo(e){const{_refreshIntervalInfo:r}=this,{activeMediaInfoIndex:i,formattedMediaInfoCount:n}=this.viewModel,{value:s,refreshInterval:o,altText:a,title:l,type:c}=e,{sourceURL:h,linkURL:p}=s,f=wOe(p??void 0)?"_blank":"_self",m=f==="_blank"?"noreferrer":"",g=o?r:null,_=g?g.timestamp:0,b=g?g.sourceURL:h,w=ie("img",{alt:a||l,key:`media-${c}-${i}-${n}-${_}`,src:b??void 0});return(p?ie("a",{title:l,href:p,rel:m,target:f},w):null)||w}renderChartMediaInfo(e){const{activeMediaInfoIndex:r,formattedMediaInfoCount:i}=this.viewModel;return ie("div",{key:`media-${e.type}-${r}-${i}`,bind:this,class:ws.mediaChart,afterCreate:this._getChartDependencies})}renderMediaInfoType(){const{activeMediaInfo:e}=this.viewModel;return e?e.type==="image"?this.renderImageMediaInfo(e):e.type.includes("chart")?this.renderChartMediaInfo(e):null:null}renderMediaInfo(){const{activeMediaInfo:e}=this.viewModel;if(!e)return null;const r=e.title?ie("div",{key:"media-title",class:ws.mediaItemTitle,innerHTML:e.title}):null,i=e.caption?ie("div",{key:"media-caption",class:ws.mediaItemCaption,innerHTML:e.caption}):null;return ie("div",{key:"media-container",class:ws.mediaItemContainer},ie("div",{key:"media-item-container",class:ws.mediaItem},this.renderMediaInfoType()),r,i)}renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;const r=e==="previous",i=r?this.messages.previous:this.messages.next,n=r?this.classes(ws.mediaButton,ws.mediaPrevious):this.classes(ws.mediaButton,ws.mediaNext),s=r?this.classes(ws.mediaIcon,ws.mediaPreviousIconLTR,ws.iconLeftTriangleArrow):this.classes(ws.mediaIcon,ws.mediaNextIconLTR,ws.iconRightTriangleArrow),o=r?this.classes(ws.mediaIcon,ws.mediaPreviousIconRTL,ws.iconRightTriangleArrow):this.classes(ws.mediaIcon,ws.mediaNextIconRTL,ws.iconLeftTriangleArrow),a=r?"media-previous":"media-next",l=r?this._previous:this._next;return ie("button",{type:"button",key:a,title:i,"aria-label":i,tabIndex:0,class:n,bind:this,onclick:l},ie("span",{"aria-hidden":"true",class:s}),ie("span",{"aria-hidden":"true",class:o}))}_setupFeatureElementInfo(){var i;const{description:e,title:r}=this;(i=this._featureElementInfo)==null||i.set({description:e,title:r})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_getRenderer(){const{isAggregate:e,layer:r}=this.viewModel;return e&&(r!=null&&r.featureReduction)&&"renderer"in r.featureReduction?r.featureReduction.renderer:r==null?void 0:r.renderer}async _getRendererColors(e){const{am4core:r}=e,i=new Map,n=this._getRenderer(),s="default";if(!n)return i;const o=await Ztt(n);return o.delete(s),Array.from(o.values()).every(a=>(a==null?void 0:a.length)===1)&&(i.set(Wpe,r.color({r:50,g:50,b:50,a:1})),Array.from(o.keys()).forEach(a=>{var l;a&&i.set(a,r.color((l=o.get(a))==null?void 0:l[0].toCss(!0)))})),i}_handleMediaKeyup(e){const r=G1(e);r==="ArrowLeft"&&(e.stopPropagation(),this.viewModel.previous()),r==="ArrowRight"&&(e.stopPropagation(),this.viewModel.next())}_renderChart(e){const{abilities:r}=this.viewModel,{chartsModule:i,chartDiv:n,mediaInfo:s,colorMap:o}=e,{value:a,type:l}=s,{am4core:c}=i,h=Cit(c);function p(g){g instanceof c.ColorSet&&h&&(g.list=h)}Cz()&&c.useTheme(i.am4themes_dark);const f=window.matchMedia("(prefers-reduced-motion: reduce)");r.chartAnimation&&!f.matches?c.useTheme(i.am4themes_animated):c.unuseTheme(i.am4themes_animated),c.useTheme(p);const m=l==="pie-chart"?this._createPieChart(e):this._createXYChart(e);n.setAttribute("aria-label",s.altText||s.title),m.data=a.series.map(g=>({[uv]:g.tooltip,[mM]:g.value,[My]:o.get(g.fieldName)})).filter(g=>l!=="pie-chart"||g.value!=null&&g.value>0)}_customizeChartTooltip(e,r){e&&(e.label.wrap=!0,e.label.maxWidth=200,e.autoTextColor=!1,e.getFillFromObject=!1,e.label.fill=r.color("#ffffff"),e.background.fill=r.color({r:0,g:0,b:0,a:.7}))}_createPieChart(e){const{chartDiv:r,chartsModule:i}=e,{am4core:n,am4charts:s}=i,o=n.create(r,s.PieChart);o.rtl=Ng(this.container);const a=o.series.push(new s.PieSeries);return a.labels.template.disabled=!0,a.ticks.template.disabled=!0,a.dataFields.value=mM,a.dataFields.category=uv,this._customizeChartTooltip(a.tooltip,n),a.slices.template.propertyFields.fill=My,a.slices.template.propertyFields.stroke=My,o}_getMinSeriesValue(e){let r=0;return e.forEach(i=>r=Math.min(i.value,r)),r}_createColumnChart(e,r){const{chartsModule:i,mediaInfo:n}=r,{value:s}=n,{am4core:o,am4charts:a}=i,l=e.xAxes.push(new a.CategoryAxis);l.dataFields.category=uv,l.renderer.labels.template.disabled=!0;const c=l.tooltip;this._customizeChartTooltip(c,o),c.events.on("sizechanged",()=>{c.dy=-c.contentHeight});const h=e.yAxes.push(new a.ValueAxis),p=h.renderer.labels.template;h.renderer.minLabelPosition=mG,h.renderer.maxLabelPosition=gG,h.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(h.tooltip,o),p.wrap=!0;const f=e.series.push(new a.ColumnSeries);f.dataFields.valueY=mM,f.dataFields.categoryX=uv,f.columns.template.propertyFields.fill=My,f.columns.template.propertyFields.stroke=My,e.cursor=new a.XYCursor,s.series.length>yG&&(e.scrollbarX=new o.Scrollbar)}_createBarChart(e,r){const{chartsModule:i,mediaInfo:n}=r,{value:s}=n,{am4core:o,am4charts:a}=i,l=e.yAxes.push(new a.CategoryAxis);l.dataFields.category=uv,l.renderer.inversed=!0,l.renderer.labels.template.disabled=!0;const c=l.tooltip;this._customizeChartTooltip(c,o),c.events.on("sizechanged",()=>{c.dx=c.contentWidth});const h=e.xAxes.push(new a.ValueAxis),p=h.renderer.labels.template;h.renderer.minLabelPosition=mG,h.renderer.maxLabelPosition=gG,h.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(h.tooltip,o),p.wrap=!0;const f=e.series.push(new a.ColumnSeries);f.dataFields.valueX=mM,f.dataFields.categoryY=uv,f.columns.template.propertyFields.fill=My,f.columns.template.propertyFields.stroke=My,e.cursor=new a.XYCursor,s.series.length>yG&&(e.scrollbarY=new o.Scrollbar)}_createLineChart(e,r){const{chartsModule:i,mediaInfo:n,colorMap:s}=r,{value:o}=n,{am4core:a,am4charts:l}=i,c=e.xAxes.push(new l.CategoryAxis);c.dataFields.category=uv,c.renderer.labels.template.disabled=!0;const h=c.tooltip;this._customizeChartTooltip(h,a),h.events.on("sizechanged",()=>{h.dy=-h.contentHeight});const p=e.yAxes.push(new l.ValueAxis),f=p.renderer.labels.template;p.renderer.minLabelPosition=mG,p.renderer.maxLabelPosition=gG,p.min=this._getMinSeriesValue(o.series),this._customizeChartTooltip(p.tooltip,a),f.wrap=!0;const m=e.series.push(new l.LineSeries);m.dataFields.categoryX=uv,m.dataFields.valueY=mM,m.strokeWidth=1;const g=s.get(Wpe);g&&(m.stroke=g);const _=m.bullets.push(new l.CircleBullet);_.propertyFields.fill=My,_.propertyFields.stroke=My,e.cursor=new l.XYCursor,o.series.length>yG&&(e.scrollbarX=new a.Scrollbar)}_createXYChart(e){const{chartDiv:r,chartsModule:i,mediaInfo:n}=e,{type:s}=n,{am4core:o,am4charts:a}=i,l=o.create(r,a.XYChart);return l.rtl=Ng(this.container),s==="column-chart"&&this._createColumnChart(l,e),s==="bar-chart"&&this._createBarChart(l,e),s==="line-chart"&&this._createLineChart(l,e),l}_clearMediaRefreshTimer(){const{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){const r=Date.now();this._refreshIntervalInfo={timestamp:r,sourceURL:e&&this._getImageSource(e,r)},this.scheduleRender()}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:e}=this.viewModel;e&&e.type==="image"&&e.refreshInterval&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){const{refreshInterval:r,value:i}=e;if(!r)return;const n=6e4*r;this._updateMediaInfoTimestamp(i.sourceURL);const s=setInterval(()=>{this._updateMediaInfoTimestamp(i.sourceURL)},n);this._refreshTimer=s}_getImageSource(e,r){const i=e.includes("?")?"&":"?",[n,s=""]=e.split("#");return`${n}${i}timestamp=${r}${s?"#":""}${s}`}};u([d()],uu.prototype,"attributes",null),u([d()],uu.prototype,"activeMediaInfoIndex",null),u([d()],uu.prototype,"description",null),u([d()],uu.prototype,"fieldInfoMap",null),u([d()],uu.prototype,"layer",null),u([d()],uu.prototype,"mediaInfos",null),u([d()],uu.prototype,"popupTemplate",null),u([d()],uu.prototype,"relatedInfos",null),u([d()],uu.prototype,"title",null),u([d({type:mS})],uu.prototype,"viewModel",void 0),u([d(),_a("esri/widgets/Feature/t9n/Feature")],uu.prototype,"messages",void 0),uu=u([$("esri.widgets.Feature.FeatureMedia")],uu);const x3e=uu;var XJ;let WP=XJ=class extends fe{constructor(t){super(t),this.minValue=0,this.maxValue=0}clone(){return new XJ({minValue:this.minValue,maxValue:this.maxValue})}};u([d({type:Number,json:{write:!0}})],WP.prototype,"minValue",void 0),u([d({type:Number,json:{write:!0}})],WP.prototype,"maxValue",void 0),WP=XJ=u([$("esri.renderer.support.AuthoringInfoClassBreakInfo")],WP);var YJ;let L1=YJ=class extends fe{constructor(t){super(t),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=[]}clone(){return new YJ({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:se(this.classBreakInfos)})}};u([d({type:String,json:{write:!0}})],L1.prototype,"field",void 0),u([d({type:String,json:{write:!0}})],L1.prototype,"normalizationField",void 0),u([d({type:String,json:{write:!0}})],L1.prototype,"label",void 0),u([d({type:[WP],json:{write:!0}})],L1.prototype,"classBreakInfos",void 0),L1=YJ=u([$("esri.renderers.support.AuthoringInfoFieldInfo")],L1);var ZJ;const JF=new mr({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),KF=new mr({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),Xpe={key:t=>typeof t=="number"?"number":"string",typeMap:{number:Number,string:String},base:null},Ype=["high-to-low","above-and-below","centered-on","extremes"],Zpe=[...new Set(["high-to-low","above-and-below","centered-on","extremes","90-10","above","below","high-to-low","above-and-below","90-10","above","below"])],Jpe=["seconds","minutes","hours","days","months","years"];let hu=ZJ=class extends fe{constructor(t){super(t),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(t){return typeof t=="string"||typeof t=="number"?t:null}castStartTime(t){return typeof t=="string"||typeof t=="number"?t:null}get style(){return this.type==="color"?this._get("style"):null}set style(t){this._set("style",t)}get theme(){return this.type==="color"||this.type==="size"?this._get("theme")||"high-to-low":null}set theme(t){this._set("theme",t)}clone(){return new ZJ({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};u([d({types:Xpe,json:{write:!0}})],hu.prototype,"endTime",void 0),u([cr("endTime")],hu.prototype,"castEndTime",null),u([d({type:String,json:{write:!0}})],hu.prototype,"field",void 0),u([d({type:Number,json:{write:!0}})],hu.prototype,"maxSliderValue",void 0),u([d({type:Number,json:{write:!0}})],hu.prototype,"minSliderValue",void 0),u([d({types:Xpe,json:{write:!0}})],hu.prototype,"startTime",void 0),u([cr("startTime")],hu.prototype,"castStartTime",null),u([d({type:JF.apiValues,value:null,json:{type:JF.jsonValues,read:JF.read,write:JF.write}})],hu.prototype,"style",null),u([d({type:Zpe,value:null,json:{type:Zpe,origins:{"web-scene":{type:Ype,write:{writer:(t,e)=>{Ype.includes(t)&&(e.theme=t)}}}},write:!0}})],hu.prototype,"theme",null),u([d({type:KF.apiValues,json:{type:KF.jsonValues,read:KF.read,write:KF.write}})],hu.prototype,"type",void 0),u([d({type:Jpe,json:{type:Jpe,write:!0}})],hu.prototype,"units",void 0),hu=ZJ=u([$("esri.renderers.support.AuthoringInfoVisualVariable")],hu);const Ait=hu;let N6=class extends fe{constructor(e){super(e),this.type=null}};u([d({readOnly:!0,json:{read:!1,write:!0}})],N6.prototype,"type",void 0),N6=u([$("esri.rest.support.ColorRamp")],N6);const Wse=N6;var JJ;let tT=JJ=class extends Wse{constructor(t){super(t),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new JJ({fromColor:se(this.fromColor),toColor:se(this.toColor),algorithm:this.algorithm})}};u([st({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],tT.prototype,"algorithm",void 0),u([d({type:Xe,json:{type:[Xi],write:!0}})],tT.prototype,"fromColor",void 0),u([d({type:Xe,json:{type:[Xi],write:!0}})],tT.prototype,"toColor",void 0),u([d({type:["algorithmic"]})],tT.prototype,"type",void 0),tT=JJ=u([$("esri.rest.support.AlgorithmicColorRamp")],tT);const Xse=tT;var KJ;let XP=KJ=class extends Wse{constructor(t){super(t),this.colorRamps=null,this.type="multipart"}clone(){return new KJ({colorRamps:se(this.colorRamps)})}};u([d({type:[Xse],json:{write:!0}})],XP.prototype,"colorRamps",void 0),u([d({type:["multipart"]})],XP.prototype,"type",void 0),XP=KJ=u([$("esri.rest.support.MultipartColorRamp")],XP);const T3e=XP,Rit={key:"type",base:Wse,typeMap:{algorithmic:Xse,multipart:T3e}};function Oit(t){return t&&t.type?t.type==="algorithmic"?Xse.fromJSON(t):t.type==="multipart"?T3e.fromJSON(t):null:null}var QJ;const Gw=new mr({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),QF=new mr({pieChart:"pie-chart",classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),Kpe=new mr({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),Qpe=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"],Mit=["high-to-low","above-and-below","above","below","90-10"],Pit=["flow-line","wave-front"],Iit=["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"];let xs=QJ=class extends fe{constructor(t){super(t),this.colorRamp=null,this.fadeRatio=null,this.isAutoGenerated=!1,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const t=this._get("classificationMethod"),e=this.type;return e&&e!=="relationship"?e==="class-breaks-size"||e==="class-breaks-color"?t||"manual":null:t}set classificationMethod(t){this._set("classificationMethod",t)}readColorRamp(t){return t?Oit(t):void 0}get fields(){return this.type&&this.type!=="predominance"?null:this._get("fields")}set fields(t){this._set("fields",t)}get field1(){return this.type&&this.type!=="relationship"?null:this._get("field1")}set field1(t){this._set("field1",t)}get field2(){return this.type&&this.type!=="relationship"?null:this._get("field2")}set field2(t){this._set("field2",t)}get flowTheme(){return this.type==="flow"?this._get("flowTheme"):null}set flowTheme(t){this._set("flowTheme",t)}get focus(){return this.type&&this.type!=="relationship"?null:this._get("focus")}set focus(t){this._set("focus",t)}get numClasses(){return this.type&&this.type!=="relationship"?null:this._get("numClasses")}set numClasses(t){this._set("numClasses",t)}get statistics(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("statistics"):null}set statistics(t){this._set("statistics",t)}get standardDeviationInterval(){const t=this.type;return t&&t!=="relationship"&&t!=="class-breaks-size"&&t!=="class-breaks-color"||this.classificationMethod&&this.classificationMethod!=="standard-deviation"?null:this._get("standardDeviationInterval")}set standardDeviationInterval(t){this._set("standardDeviationInterval",t)}get type(){return this._get("type")}set type(t){let e=t;t==="classed-size"?e="class-breaks-size":t==="classed-color"&&(e="class-breaks-color"),this._set("type",e)}get univariateSymbolStyle(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(t){this._set("univariateSymbolStyle",t)}get univariateTheme(){return this.type==="univariate-color-size"?this._get("univariateTheme"):null}set univariateTheme(t){this._set("univariateTheme",t)}clone(){return new QJ({classificationMethod:this.classificationMethod,colorRamp:se(this.colorRamp),fadeRatio:se(this.fadeRatio),fields:this.fields&&this.fields.slice(0),field1:se(this.field1),field2:se(this.field2),isAutoGenerated:this.isAutoGenerated,focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(t=>t.clone()),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};u([d({type:Gw.apiValues,value:null,json:{type:Gw.jsonValues,read:Gw.read,write:Gw.write,origins:{"web-document":{default:"manual",type:Gw.jsonValues,read:Gw.read,write:Gw.write}}}})],xs.prototype,"classificationMethod",null),u([d({types:Rit,json:{write:!0}})],xs.prototype,"colorRamp",void 0),u([Me("colorRamp")],xs.prototype,"readColorRamp",null),u([d({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],xs.prototype,"fadeRatio",void 0),u([d({type:[String],value:null,json:{write:!0}})],xs.prototype,"fields",null),u([d({type:L1,value:null,json:{write:!0}})],xs.prototype,"field1",null),u([d({type:L1,value:null,json:{write:!0}})],xs.prototype,"field2",null),u([d({type:Pit,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],xs.prototype,"flowTheme",null),u([d({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],xs.prototype,"focus",null),u([d({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],xs.prototype,"isAutoGenerated",void 0),u([d({type:Number,value:null,json:{type:Xi,write:!0}})],xs.prototype,"numClasses",null),u([d({type:Qpe,json:{type:Qpe,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],xs.prototype,"lengthUnit",void 0),u([d({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],xs.prototype,"maxSliderValue",void 0),u([d({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],xs.prototype,"minSliderValue",void 0),u([d({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],xs.prototype,"statistics",null),u([d({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],xs.prototype,"standardDeviationInterval",null),u([d({type:QF.apiValues,value:null,json:{type:QF.jsonValues,read:QF.read,write:QF.write,origins:{"web-scene":{type:Kpe.jsonValues,write:{writer:Kpe.write,overridePolicy:t=>({enabled:t!=="flow"})}}}}})],xs.prototype,"type",null),u([d({type:[Ait],json:{write:!0}})],xs.prototype,"visualVariables",void 0),u([d({type:Iit,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],xs.prototype,"univariateSymbolStyle",null),u([d({type:Mit,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],xs.prototype,"univariateTheme",null),xs=QJ=u([$("esri.renderers.support.AuthoringInfo")],xs);const Yse=xs,_G=new mr({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let YP=class extends fe{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const r=new Set;return await this.collectRequiredFields(r,e),Array.from(r).sort()}getSymbol(e,r){}async getSymbolAsync(e,r){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};u([d({type:Yse,json:{write:!0}})],YP.prototype,"authoringInfo",void 0),u([d({type:_G.apiValues,readOnly:!0,json:{type:_G.jsonValues,read:!1,write:{writer:_G.write,ignoreOrigin:!0}}})],YP.prototype,"type",void 0),YP=u([$("esri.renderers.Renderer")],YP);const N_=YP;function $it(t){var e,r;return((r=(e=t.match(Lit))==null?void 0:e[1])==null?void 0:r.replace(/\\'/g,"'"))??null}const Lit=/^hash\(\$feature\['((\\'|[^'])+)'\]\) \* 8\.381e-8$/;var eK;let OR=eK=class extends fe{constructor(){super(...arguments),this.title=null}clone(){return new eK({title:this.title})}};u([d({type:String,json:{write:!0}})],OR.prototype,"title",void 0),OR=eK=u([$("esri.renderers.support.LegendOptions")],OR);var tK;let F6=tK=class extends OR{constructor(){super(...arguments),this.showLegend=null}clone(){return new tK({title:this.title,showLegend:this.showLegend})}};u([d({type:Boolean,json:{write:!0}})],F6.prototype,"showLegend",void 0),F6=tK=u([$("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],F6);const S3e=F6,vG=new mr({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let cf=class extends fe{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return e==null?e:typeof e=="function"?(re.getLogger(this.declaredClass).error(".field: field must be a string value"),null):sN(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};u([d()],cf.prototype,"index",void 0),u([d({type:vG.apiValues,readOnly:!0,json:{read:vG.read,write:vG.write}})],cf.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],cf.prototype,"field",void 0),u([cr("field")],cf.prototype,"castField",null),u([d({type:String,json:{write:!0}})],cf.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],cf.prototype,"valueExpressionTitle",void 0),u([d({readOnly:!0})],cf.prototype,"arcadeRequired",null),u([d({type:S3e,json:{write:!0}})],cf.prototype,"legendOptions",void 0),cf=u([$("esri.renderers.visualVariables.VisualVariable")],cf);const ON=cf;var rK;let rT=rK=class extends ON{constructor(t){super(t),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,r)=>e.value-r.value),this._set("stops",t)}clone(){return new rK({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(t=>t.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};u([d({readOnly:!0})],rT.prototype,"cache",null),u([d({type:["color"],json:{type:["colorInfo"]}})],rT.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],rT.prototype,"normalizationField",void 0),u([d({type:[Fet],json:{write:!0}})],rT.prototype,"stops",null),rT=rK=u([$("esri.renderers.visualVariables.ColorVariable")],rT);const E3e=rT;var iK;let n1=iK=class extends fe{constructor(t){super(t),this.label=null,this.opacity=null,this.value=null}readOpacity(t,e){return GL(e.transparency)}writeOpacity(t,e,r){e[r]=k9(t)}clone(){return new iK({label:this.label,opacity:this.opacity,value:this.value})}};u([d({type:String,json:{write:!0}})],n1.prototype,"label",void 0),u([d({type:Number,json:{type:Xi,write:{target:"transparency"}}})],n1.prototype,"opacity",void 0),u([Me("opacity",["transparency"])],n1.prototype,"readOpacity",null),u([De("opacity")],n1.prototype,"writeOpacity",null),u([d({type:Number,json:{write:!0}})],n1.prototype,"value",void 0),n1=iK=u([$("esri.renderers.visualVariables.support.OpacityStop")],n1);const Dit=n1;var nK;let iT=nK=class extends ON{constructor(t){super(t),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,r)=>e.value-r.value),this._set("stops",t)}clone(){return new nK({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(t=>t.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};u([d({readOnly:!0})],iT.prototype,"cache",null),u([d({type:["opacity"],json:{type:["transparencyInfo"]}})],iT.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],iT.prototype,"normalizationField",void 0),u([d({type:[Dit],json:{write:!0}})],iT.prototype,"stops",null),iT=nK=u([$("esri.renderers.visualVariables.OpacityVariable")],iT);const C3e=iT;var sK;let n0=sK=class extends ON{constructor(t){super(t),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(t,e,r,i){if(i&&i.messages){const n=`visualVariables[${this.index}]`;i.messages.push(new H("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:n+".valueExpressionTitle",context:i}))}}clone(){return new sK({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions&&this.legendOptions.clone()})}};u([d({readOnly:!0})],n0.prototype,"cache",null),u([d({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],n0.prototype,"axis",void 0),u([d({type:["rotation"],json:{type:["rotationInfo"]}})],n0.prototype,"type",void 0),u([d({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],n0.prototype,"rotationType",void 0),u([d({type:String,json:{write:!0}})],n0.prototype,"valueExpressionTitle",void 0),u([De("web-scene","valueExpressionTitle")],n0.prototype,"writeValueExpressionTitleWebScene",null),n0=sK=u([$("esri.renderers.visualVariables.RotationVariable")],n0);const A3e=n0;var oK;let LC=oK=class extends fe{constructor(t){super(t),this.label=null,this.size=null,this.value=null}clone(){return new oK({label:this.label,size:this.size,value:this.value})}};u([d({type:String,json:{write:!0}})],LC.prototype,"label",void 0),u([d({type:Number,cast:yi,json:{write:!0}})],LC.prototype,"size",void 0),u([d({type:Number,json:{write:!0}})],LC.prototype,"value",void 0),LC=oK=u([$("esri.renderers.visualVariables.support.SizeStop")],LC);const DC=LC;var aK;let k6=aK=class extends S3e{constructor(){super(...arguments),this.customValues=null}clone(){return new aK({title:this.title,showLegend:this.showLegend,customValues:this.customValues&&this.customValues.slice(0)})}};u([d({type:[Number],json:{write:!0}})],k6.prototype,"customValues",void 0),k6=aK=u([$("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],k6);const Nit=k6;var t_,oa;function mb(t){return t&&t.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function rD(t){return t!=null&&!isNaN(t)&&isFinite(t)}function R3e(t){return t.valueExpression?t_.Expression:t.field&&typeof t.field=="string"?t_.Field:t_.Unknown}function Fit(t,e){const r=e||R3e(t),i=t.valueUnit||"unknown";return r===t_.Unknown?oa.Constant:t.stops?oa.Stops:t.minSize!=null&&t.maxSize!=null&&t.minDataValue!=null&&t.maxDataValue!=null?oa.ClampedLinear:i==="unknown"?t.minSize!=null&&t.minDataValue!=null?t.minSize&&t.minDataValue?oa.Proportional:oa.Additive:oa.Identity:oa.RealWorldSize}(function(t){t.Unknown="unknown",t.Expression="expression",t.Field="field"})(t_||(t_={})),function(t){t.Unknown="unknown",t.Stops="stops",t.ClampedLinear="clamped-linear",t.Proportional="proportional",t.Additive="additive",t.Constant="constant",t.Identity="identity",t.RealWorldSize="real-world-size"}(oa||(oa={}));function H9t(t){}function kit(t){return()=>t}const OO={inches:Vs(1,"meters","inches"),feet:Vs(1,"meters","feet"),"us-feet":Vs(1,"meters","us-feet"),yards:Vs(1,"meters","yards"),miles:Vs(1,"meters","miles"),"nautical-miles":Vs(1,"meters","nautical-miles"),millimeters:Vs(1,"meters","millimeters"),centimeters:Vs(1,"meters","centimeters"),decimeters:Vs(1,"meters","decimeters"),meters:Vs(1,"meters","meters"),kilometers:Vs(1,"meters","kilometers"),"decimal-degrees":1/nGe(1,"meters",Cr.radius)},ow=re.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),efe=new Va,U6=Math.PI,O3e=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function M3e(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(g=>g.type==="color"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void ow.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const n=typeof e=="number",s=n?null:e,o=s&&s.attributes;let a=n?e:null;const l=i.field,{ipData:c,hasExpression:h}=i.cache;let p=i.cache.compiledFunc;if(!l&&!h){const g=i.stops;return g&&g[0]&&g[0].color}if(typeof a!="number")if(h){if(R(r)||R(r.arcade))return void ow.error("Use of arcade expressions requires an arcade context");const g={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},_=r.arcade.arcadeUtils,b=_.getViewInfo(g),w=_.createExecContext(s,b);if(!p){const x=_.createSyntaxTree(i.valueExpression);p=_.createFunction(x),i.cache.compiledFunc=p}a=_.executeFunction(p,w)}else o&&(a=o[l]);const f=i.normalizationField,m=o!=null&&f!=null?parseFloat(o[f]):void 0;if(a!=null&&(!f||n||!isNaN(m)&&m!==0)){isNaN(m)||n||(a/=m);const g=Jse(a,c);if(g){const _=g[0],b=g[1],w=_===b?i.stops[_].color:Xe.blendColors(i.stops[_].color,i.stops[b].color,g[2],v(r)?r.color:void 0);return new Xe(w)}}}function P3e(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(g=>g.type==="opacity"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void ow.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const n=typeof e=="number",s=n?null:e,o=s&&s.attributes;let a=n?e:null;const l=i.field,{ipData:c,hasExpression:h}=i.cache;let p=i.cache.compiledFunc;if(!l&&!h){const g=i.stops;return g&&g[0]&&g[0].opacity}if(typeof a!="number")if(h){if(R(r)||R(r.arcade))return void ow.error("Use of arcade expressions requires an arcade context");const g={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},_=r.arcade.arcadeUtils,b=_.getViewInfo(g),w=_.createExecContext(s,b);if(!p){const x=_.createSyntaxTree(i.valueExpression);p=_.createFunction(x),i.cache.compiledFunc=p}a=_.executeFunction(p,w)}else o&&(a=o[l]);const f=i.normalizationField,m=o!=null&&f!=null?parseFloat(o[f]):void 0;if(a!=null&&(!f||n||!isNaN(m)&&m!==0)){isNaN(m)||n||(a/=m);const g=Jse(a,c);if(g){const _=g[0],b=g[1];if(_===b)return i.stops[_].opacity;{const w=i.stops[_].opacity;return w+(i.stops[b].opacity-w)*g[2]}}}}function I3e(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(m=>m.type==="rotation"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void ow.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const n=i.axis||"heading",s=n==="heading"&&i.rotationType==="arithmetic"?90:0,o=n==="heading"&&i.rotationType==="arithmetic"?-1:1,a=typeof e=="number"?null:e,l=a&&a.attributes,c=i.field,{hasExpression:h}=i.cache;let p=i.cache.compiledFunc,f=0;if(!c&&!h)return f;if(h){if(R(r)||R(r.arcade))return void ow.error("Use of arcade expressions requires an arcade context");const m={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},g=r.arcade.arcadeUtils,_=g.getViewInfo(m),b=g.createExecContext(a,_);if(!p){const w=g.createSyntaxTree(i.valueExpression);p=g.createFunction(w),i.cache.compiledFunc=p}f=g.executeFunction(p,b)}else l&&(f=l[c]||0);return f=typeof f!="number"||isNaN(f)?null:s+o*f,f}function Uit(t,e,r){const i=typeof e=="number",n=i?null:e,s=n&&n.attributes;let o=i?e:null;const{isScaleDriven:a}=t.cache;let l=t.cache.compiledFunc;if(a){const h=v(r)?r.scale:void 0,p=v(r)?r.view:void 0;o=h==null||p==="3d"?zit(t):h}else if(!i)switch(t.inputValueType){case t_.Expression:{if(R(r)||R(r.arcade))return void ow.error("Use of arcade expressions requires an arcade context");const h={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},p=r.arcade.arcadeUtils,f=p.getViewInfo(h),m=p.createExecContext(n,f);if(!l){const g=p.createSyntaxTree(t.valueExpression);l=p.createFunction(g),t.cache.compiledFunc=l}o=p.executeFunction(l,m);break}case t_.Field:s&&(o=s[t.field]);break;case t_.Unknown:o=null}if(!rD(o))return null;if(i||!t.normalizationField)return o;const c=s?parseFloat(s[t.normalizationField]):null;return rD(c)&&c!==0?o/c:null}function zit(t){let e=null,r=null;const i=t.stops;return i?(e=i[0].value,r=i[i.length-1].value):(e=t.minDataValue||0,r=t.maxDataValue||0),(e+r)/2}function _B(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(s=>s.type==="size"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void ow.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const n=L3e(Uit(i,e,r),i,e,r,i.cache.ipData);return n==null||isNaN(n)?0:n}function ju(t,e,r){return t==null?null:mb(t)?_B(t,e,r):rD(t)?t:null}function $3e(t,e,r){return rD(r)&&t>r?r:rD(e)&&t<e?e:t}function Vit(t,e,r,i){return t+((ju(e.minSize,r,i)||e.minDataValue)??0)}function Bit(t,e,r){const i=t.stops;let n=i&&i.length&&i[0].size;return n==null&&(n=t.minSize),ju(n,e,r)}function jit(t,e,r,i){const n=(t-e.minDataValue)/(e.maxDataValue-e.minDataValue),s=ju(e.minSize,r,i),o=ju(e.maxSize,r,i),a=v(i)?i.shape:void 0;if(t<=e.minDataValue)return s;if(t>=e.maxDataValue)return o;if(s==null||o==null)return null;if(e.scaleBy==="area"&&a){const l=a==="circle",c=l?U6*(s/2)**2:s*s,h=c+n*((l?U6*(o/2)**2:o*o)-c);return l?2*Math.sqrt(h/U6):Math.sqrt(h)}return s+n*(o-s)}function Git(t,e,r,i){const n=v(i)?i.shape:void 0,s=t/e.minDataValue,o=ju(e.minSize,r,i),a=ju(e.maxSize,r,i);let l=null;return l=n==="circle"?2*Math.sqrt(s*(o/2)**2):n==="square"||n==="diamond"||n==="image"?Math.sqrt(s*o**2):s*o,$3e(l,o,a)}function Hit(t,e,r,i,n){var l,c,h;const[s,o,a]=Jse(t,n);if(s===o)return ju((l=e.stops)==null?void 0:l[s].size,r,i);{const p=ju((c=e.stops)==null?void 0:c[s].size,r,i);return p+(ju((h=e.stops)==null?void 0:h[o].size,r,i)-p)*a}}function qit(t,e,r,i){const n=(v(i)&&i.resolution?i.resolution:1)*OO[e.valueUnit],s=ju(e.minSize,r,i),o=ju(e.maxSize,r,i),{valueRepresentation:a}=e;let l=null;return l=a==="area"?2*Math.sqrt(t/U6)/n:a==="radius"||a==="distance"?2*t/n:t/n,$3e(l,s,o)}function L3e(t,e,r,i,n){switch(e.transformationType){case oa.Additive:return Vit(t,e,r,i);case oa.Constant:return Bit(e,r,i);case oa.ClampedLinear:return jit(t,e,r,i);case oa.Proportional:return Git(t,e,r,i);case oa.Stops:return Hit(t,e,r,i,n);case oa.RealWorldSize:return qit(t,e,r,i);case oa.Identity:return t;case oa.Unknown:return null}}function Wit(t,e,r){const{isScaleDriven:i}=t.cache;if(!(i&&r==="3d"||e))return null;const n={scale:e,view:r};let s=ju(t.minSize,efe,n),o=ju(t.maxSize,efe,n);if(s!=null||o!=null){if(s>o){const a=o;o=s,s=a}return{minSize:s,maxSize:o}}}function Zse(t,e,r){if(!t.visualVariables)return;const i=[],n=[],s=[],o=[],a=[];for(const l of t.visualVariables)switch(l.type){case"color":n.push(l);break;case"opacity":s.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return n.forEach(l=>{const c=M3e(l,e,r);i.push({variable:l,value:c})}),s.forEach(l=>{const c=P3e(l,e,r);i.push({variable:l,value:c})}),a.forEach(l=>{const c=I3e(l,e,r);i.push({variable:l,value:c})}),o.forEach(l=>{const c=_B(l,e,r);i.push({variable:l,value:c})}),i.filter(l=>l.value!=null)}function Jse(t,e){if(!e)return;let r=0,i=e.length-1;return e.some((n,s)=>t<n?(i=s,!0):(r=s,!1)),[r,i,(t-e[r])/(e[i]-e[r])]}function Xit(t,e,r){const i=["proportional","proportional","proportional"];for(const n of t){const s=n.useSymbolValue?"symbol-value":_B(n,e,r);switch(n.axis){case"width":i[0]=s;break;case"depth":i[1]=s;break;case"height":i[2]=s;break;case"width-and-depth":i[0]=s,i[1]=s;break;case"all":case void 0:case null:i[0]=s,i[1]=s,i[2]=s;break;default:n.axis}}return i}const Kse=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:Xit,getColor:M3e,getOpacity:P3e,getRotationAngle:I3e,getSize:_B,getSizeForValue:L3e,getSizeFromNumberOrVariable:ju,getSizeRangeAtScale:Wit,getVisualVariableValues:Zse,viewScaleRE:O3e},Symbol.toStringTag,{value:"Module"}));var lK;const e4=new mr({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),cK=new mr({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function tfe(t){if(t!=null)return typeof t=="string"||typeof t=="number"?yi(t):t.type==="size"?mb(t)?t:(delete(t={...t}).type,new Ei(t)):void 0}function rfe(t,e,r){if(typeof t!="object")return t;const i=new Ei;return i.read(t,r),i}let Ei=lK=class extends ON{constructor(t){super(t),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:this.valueExpression!=null&&O3e.test(this.valueExpression)}}set expression(t){re.getLogger(this.declaredClass).warn("'expression' is deprecated since version 4.2. Use 'valueExpression' instead. The only supported expression is 'view.scale'."),t==="view.scale"?(this.valueExpression="$view.scale",this._set("expression",t)):this._set("expression",null)}set index(t){mb(this.maxSize)&&(this.maxSize.index=`visualVariables[${t}].maxSize`),mb(this.minSize)&&(this.minSize.index=`visualVariables[${t}].minSize`),this._set("index",t)}get inputValueType(){return R3e(this)}set maxDataValue(t){t&&this.stops&&(re.getLogger(this.declaredClass).warn("cannot set maxDataValue when stops is not null."),t=null),this._set("maxDataValue",t)}set maxSize(t){t&&this.stops&&(re.getLogger(this.declaredClass).warn("cannot set maxSize when stops is not null."),t=null),this._set("maxSize",t)}castMaxSize(t){return tfe(t)}readMaxSize(t,e,r){return rfe(t,e,r)}set minDataValue(t){t&&this.stops&&(re.getLogger(this.declaredClass).warn("cannot set minDataValue when stops is not null."),t=null),this._set("minDataValue",t)}set minSize(t){t&&this.stops&&(re.getLogger(this.declaredClass).warn("cannot set minSize when stops is not null."),t=null),this._set("minSize",t)}castMinSize(t){return tfe(t)}readMinSize(t,e,r){return rfe(t,e,r)}get arcadeRequired(){return!!this.valueExpression||this.minSize!=null&&typeof this.minSize=="object"&&this.minSize.arcadeRequired||this.maxSize!=null&&typeof this.maxSize=="object"&&this.maxSize.arcadeRequired}set stops(t){this.minDataValue==null&&this.maxDataValue==null&&this.minSize==null&&this.maxSize==null?t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,r)=>e.value-r.value):t&&(re.getLogger(this.declaredClass).warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),t=null),this._set("stops",t)}get transformationType(){return Fit(this,this.inputValueType)}readValueExpression(t,e){return t||e.expression&&"$view.scale"}writeValueExpressionWebScene(t,e,r,i){if(t==="$view.scale"){if(i&&i.messages){const n=this.index,s=typeof n=="string"?n:`visualVariables[${n}]`;i.messages.push(new H("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:s+".valueExpression",context:i}))}}else e[r]=t}readValueUnit(t){return t?cK.read(t):null}clone(){return new lK({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:mb(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:mb(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(t=>t.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone()})}flipSizes(){if(this.transformationType===oa.ClampedLinear){const{minSize:t,maxSize:e}=this;return this.minSize=e,this.maxSize=t,this}if(this.transformationType===oa.Stops){const t=this.stops;if(!t)return this;const e=t.map(i=>i.size).reverse(),r=t.length;for(let i=0;i<r;i++)t[i].size=e[i];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};u([d({readOnly:!0})],Ei.prototype,"cache",null),u([d({type:e4.apiValues,json:{type:e4.jsonValues,origins:{"web-map":{read:!1}},read:e4.read,write:e4.write}})],Ei.prototype,"axis",void 0),u([d({type:String,value:null,json:{read:!1}})],Ei.prototype,"expression",null),u([d()],Ei.prototype,"index",null),u([d({type:String,readOnly:!0})],Ei.prototype,"inputValueType",null),u([d({type:Nit,json:{write:!0}})],Ei.prototype,"legendOptions",void 0),u([d({type:Number,value:null,json:{write:!0}})],Ei.prototype,"maxDataValue",null),u([d({type:Number,value:null,json:{write:!0}})],Ei.prototype,"maxSize",null),u([cr("maxSize")],Ei.prototype,"castMaxSize",null),u([Me("maxSize")],Ei.prototype,"readMaxSize",null),u([d({type:Number,value:null,json:{write:!0}})],Ei.prototype,"minDataValue",null),u([d({type:Number,value:null,json:{write:!0}})],Ei.prototype,"minSize",null),u([cr("minSize")],Ei.prototype,"castMinSize",null),u([Me("minSize")],Ei.prototype,"readMinSize",null),u([d({type:String,json:{write:!0}})],Ei.prototype,"normalizationField",void 0),u([d({readOnly:!0})],Ei.prototype,"arcadeRequired",null),u([d({type:String})],Ei.prototype,"scaleBy",void 0),u([d({type:[DC],value:null,json:{write:!0}})],Ei.prototype,"stops",null),u([d({type:["outline"],json:{write:!0}})],Ei.prototype,"target",void 0),u([d({type:String,readOnly:!0})],Ei.prototype,"transformationType",null),u([d({type:["size"],json:{type:["sizeInfo"]}})],Ei.prototype,"type",void 0),u([d({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],Ei.prototype,"useSymbolValue",void 0),u([d({type:String,json:{write:!0}})],Ei.prototype,"valueExpression",void 0),u([Me("valueExpression",["valueExpression","expression"])],Ei.prototype,"readValueExpression",null),u([De("web-scene","valueExpression")],Ei.prototype,"writeValueExpressionWebScene",null),u([d({type:["radius","diameter","area","width","distance"],json:{write:!0}})],Ei.prototype,"valueRepresentation",void 0),u([d({type:cK.apiValues,json:{write:cK.write,origins:{"web-map":{read:!1},"web-scene":{write:!0},"portal-item":{write:!0}}}})],Ei.prototype,"valueUnit",void 0),u([Me("valueUnit")],Ei.prototype,"readValueUnit",null),Ei=lK=u([$("esri.renderers.visualVariables.SizeVariable")],Ei);const vB=Ei,Yit={color:E3e,size:vB,opacity:C3e,rotation:A3e},Zit=new mr({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),Jit=/^\[([^\]]+)\]$/i;let z6=class extends be{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),(e=e&&e.filter(r=>!!r))&&e.length){for(const r of e)switch(r.type){case"color":this.colorVariables.push(r);break;case"opacity":this.opacityVariables.push(r);break;case"rotation":this.rotationVariables.push(r);break;case"size":this.sizeVariables.push(r)}this.sizeVariables.length&&this.sizeVariables.some(r=>!!r.target)&&e.sort((r,i)=>{let n=null;return n=r.target===i.target?0:r.target?1:-1,n});for(let r=0;r<e.length;r++)e[r].index=r;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,r,i){const{rotationExpression:n,rotationType:s}=r,o=n&&n.match(Jit),a=o&&o[1];if(a&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:s,field:a})),e)return e.map(l=>{const c=Zit.read(l.type),h=Yit[c];h||(re.getLogger(this.declaredClass).warn(`Unknown variable type: ${c}`),i&&i.messages&&i.messages.push(new Sp("visual-variable:unsupported",`visualVariable of type '${c}' is not supported`,{definition:l,context:i})));const p=new h;return p.read(l,i),p})}writeVariables(e,r){const i=[];for(const n of e){const s=n.toJSON(r);s&&i.push(s)}return i}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};u([d()],z6.prototype,"visualVariables",null),z6=u([$("esri.renderers.visualVariables.VisualVariableFactory")],z6);const Kit=z6,Qit={base:ON,key:"type",typeMap:{opacity:C3e,color:E3e,rotation:A3e,size:vB}},x3=t=>{let e=class extends t{constructor(){super(...arguments),this._vvFactory=new Kit}set visualVariables(r){this._vvFactory.visualVariables=r,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(r,i,n){return this._vvFactory.readVariables(r,i,n)}writeVisualVariables(r,i,n,s){i[n]=this._vvFactory.writeVariables(r,s)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const r of this.visualVariables)if(r.arcadeRequired)return!0;return!1}hasVisualVariables(r,i){return r?this.getVisualVariablesForType(r,i).length>0:this.getVisualVariablesForType("size",i).length>0||this.getVisualVariablesForType("color",i).length>0||this.getVisualVariablesForType("opacity",i).length>0||this.getVisualVariablesForType("rotation",i).length>0}getVisualVariablesForType(r,i){const n=this.visualVariables;return n?n.filter(s=>s.type===r&&(typeof i=="string"?s.target===i:i!==!1||!s.target)):[]}async collectVVRequiredFields(r,i){let n=[];this.visualVariables&&(n=n.concat(this.visualVariables));for(const s of n)s&&(s.field&&Yh(r,i,s.field),s.normalizationField&&Yh(r,i,s.normalizationField),s.valueExpression&&(ent(s.valueExpression,r,i)||await Gc(r,i,s.valueExpression)))}};return u([d({types:[Qit],value:null,json:{write:!0}})],e.prototype,"visualVariables",null),u([Me("visualVariables",["visualVariables","rotationType","rotationExpression"])],e.prototype,"readVisualVariables",null),u([De("visualVariables")],e.prototype,"writeVisualVariables",null),e=u([$("esri.renderers.mixins.VisualVariablesMixin")],e),e};function ent(t,e,r){const i=$it(t);return!!v(i)&&(Yh(e,r,i),!0)}const gM={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function tnt(t,e=gM){var a,l;if(!t)return{symbol:null};const{retainId:r=gM.retainId,ignoreDrivers:i=gM.ignoreDrivers,hasLabelingContext:n=gM.hasLabelingContext,retainCIM:s=gM.retainCIM}=e;let o=null;if(bO(t)||t instanceof z2)o=t.clone();else if(t.type==="cim"){const c=(l=(a=t.data)==null?void 0:a.symbol)==null?void 0:l.type;if(c!=="CIMPointSymbol")return{error:new H("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${c||"unknown"}' is unsupported in 3D`,{symbol:t})};o=s?t.clone():lb.fromCIMSymbol(t)}else if(t instanceof Lp)o=q9.fromSimpleLineSymbol(t);else if(t instanceof Pw)o=lb.fromSimpleMarkerSymbol(t);else if(t instanceof X9)o=lb.fromPictureMarkerSymbol(t);else if(t instanceof Mw)o=e.geometryType&&e.geometryType==="mesh"?W9.fromSimpleFillSymbol(t):bN.fromSimpleFillSymbol(t);else{if(!(t instanceof y3))return{error:new H("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${t.type||t.declaredClass}' is unsupported in 3D`,{symbol:t})};o=n?H9.fromTextSymbol(t):lb.fromTextSymbol(t)}if(r&&o&&o.type!=="cim"&&(o.id=t.id),i&&bO(o))for(let c=0;c<o.symbolLayers.length;++c)o.symbolLayers.getItemAt(c)._ignoreDrivers=!0;return{symbol:o}}function Rz(t,e,r,i){const n=D3e(t,{},{context:i,isLabelSymbol:!1});v(n)&&(e[r]=n)}function ife(t,e,r,i){const n=D3e(t,{},{context:i,isLabelSymbol:!0});v(n)&&(e[r]=n)}function nfe(t){return t instanceof g3||t instanceof z2}function D3e(t,e,r){if(R(t))return null;const{context:i,isLabelSymbol:n}=r,s=i==null?void 0:i.origin,o=i==null?void 0:i.messages;if(s==="web-scene"&&!nfe(t)){const a=tnt(t,{retainCIM:!0,hasLabelingContext:n});return v(a.symbol)?a.symbol.write(e,i):(o==null||o.push(new H("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:t,context:i,error:a.error})),null)}return(s==="web-map"||s==="portal-item"&&!fOe(i==null?void 0:i.layer))&&nfe(t)?(o==null||o.push(new H("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:t,context:i})),null):t.write(e,i)}function W9t(t,e){return KXe(t,null,e)}const T3={types:Z9,json:{write:{writer:Rz},origins:{"web-scene":{types:cde,write:{writer:Rz},read:{reader:Ew({types:cde})}}}}},N3e={types:{base:Ku,key:"type",typeMap:{"simple-fill":RS.typeMap["simple-fill"],"picture-fill":RS.typeMap["picture-fill"],"polygon-3d":RS.typeMap["polygon-3d"]}},json:{write:{writer:Rz},origins:{"web-scene":{type:bN,write:{writer:Rz}}}}},V6={cast:t=>t==null||typeof t=="string"||typeof t=="number"?t:`${t}`,json:{type:String,write:{writer:(t,e)=>{e.value=t==null?void 0:t.toString()}}}};var uK;let s1=uK=class extends fe{constructor(t){super(t),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new uK({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const t=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${t}`}};u([d({type:String,json:{write:!0}})],s1.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],s1.prototype,"label",void 0),u([d({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],s1.prototype,"minValue",void 0),u([d({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],s1.prototype,"maxValue",void 0),u([d(T3)],s1.prototype,"symbol",void 0),s1=uK=u([$("esri.renderers.support.ClassBreakInfo")],s1);const Oz=s1;var hK;const F3e="log",B6="percent-of-total",j6="field",t4=new mr({esriNormalizeByLog:F3e,esriNormalizeByPercentOfTotal:B6,esriNormalizeByField:j6}),rnt=bs(Oz);let wo=hK=class extends x3(N_){constructor(t){super(t),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(t,e,r){if(!Array.isArray(t))return;let i=e.minValue;return t.map(n=>{const s=new Oz;return s.read(n,r),s.minValue==null&&(s.minValue=i),s.maxValue==null&&(s.maxValue=s.minValue),i=s.maxValue,s})}writeClassBreakInfos(t,e,r,i){const n=t.map(s=>s.write({},i));this._areClassBreaksConsecutive()&&n.forEach(s=>delete s.classMinValue),e[r]=n}castField(t){return t==null?t:typeof t=="function"?(re.getLogger(this.declaredClass).error(".field: field must be a string value"),null):sN(t)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let t=this._get("normalizationType");const e=!!this.normalizationField,r=this.normalizationTotal!=null;return e||r?(t=e&&j6||r&&B6||null,e&&r&&re.getLogger(this.declaredClass).warn("warning: both normalizationField and normalizationTotal are set!")):t!==j6&&t!==B6||(t=null),t}set normalizationType(t){this._set("normalizationType",t)}addClassBreakInfo(t,e,r){let i=null;i=typeof t=="number"?new Oz({minValue:t,maxValue:e,symbol:dAe(r)}):rnt(se(t)),this.classBreakInfos.push(i),this.classBreakInfos.length===1&&this.notifyChange("minValue")}removeClassBreakInfo(t,e){const r=this.classBreakInfos.length;for(let i=0;i<r;i++){const n=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(n[0]===t&&n[1]===e){this.classBreakInfos.splice(i,1);break}}}getBreakIndex(t,e){return this.valueExpression&&(R(e)||R(e.arcade))&&re.getLogger(this.declaredClass).warn(""),this.valueExpression?this._getBreakIndexForExpression(t,e):this._getBreakIndexForField(t)}async getClassBreakInfo(t,e){let r=e;this.valueExpression&&(R(e)||R(e.arcade))&&(r={...r,arcade:await iy()});const i=this.getBreakIndex(t,r);return i!==-1?this.classBreakInfos[i]:null}getSymbol(t,e){if(this.valueExpression&&(R(e)||R(e.arcade)))return void re.getLogger(this.declaredClass).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const r=this.getBreakIndex(t,e);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}async getSymbolAsync(t,e){let r=e;if(this.valueExpression&&(R(e)||R(e.arcade))){const n=await iy(),{arcadeUtils:s}=n;s.hasGeometryOperations(this.valueExpression)&&await s.enableGeometryOperations(),r={...r,arcade:n}}const i=this.getBreakIndex(t,r);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}getSymbols(){const t=[];return this.classBreakInfos.forEach(e=>{e.symbol&&t.push(e.symbol)}),this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),r=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${t}.${e}.${this.classBreakInfos.reduce((i,n)=>i+n.getMeshHash(),"")}.${r}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new hK({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol&&this.backgroundFillSymbol.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:se(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:se(this.visualVariables),legendOptions:se(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}async collectRequiredFields(t,e){const r=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(r)}async collectSymbolFields(t,e){const r=[...this.getSymbols().map(i=>i.collectRequiredFields(t,e)),Gc(t,e,this.valueExpression)];Yh(t,e,this.field),Yh(t,e,this.normalizationField),await Promise.all(r)}_getBreakIndexForExpression(t,e){const{viewingMode:r,scale:i,spatialReference:n,arcade:s}=Nt(e,{}),{valueExpression:o}=this;let a=this._compiledValueExpression.valueExpression===o?this._compiledValueExpression.compiledFunction:null;const l=s.arcadeUtils;if(!a){const h=l.createSyntaxTree(o);a=l.createFunction(h),this._compiledValueExpression.compiledFunction=a}this._compiledValueExpression.valueExpression=o;const c=l.executeFunction(a,l.createExecContext(t,l.getViewInfo({viewingMode:r,scale:i,spatialReference:n})));return this._getBreakIndexfromInfos(c)}_getBreakIndexForField(t){const e=this.field,r=t.attributes,i=this.normalizationType;let n=parseFloat(r[e]);if(i){const s=this.normalizationTotal,o=parseFloat(this.normalizationField?r[this.normalizationField]:void 0);if(i===F3e)n=Math.log(n)*Math.LOG10E;else if(i!==B6||s==null||isNaN(s)){if(i===j6&&!isNaN(o)){if(isNaN(n)||isNaN(o))return-1;n/=o}}else n=n/s*100}return this._getBreakIndexfromInfos(n)}_getBreakIndexfromInfos(t){const e=this.isMaxInclusive;if(t!=null&&typeof t=="number"&&!isNaN(t))for(let r=0;r<this.classBreakInfos.length;r++){const i=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(i[0]<=t&&(e?t<=i[1]:t<i[1]))return r}return-1}_areClassBreaksConsecutive(){const t=this.classBreakInfos,e=t.length;for(let r=1;r<e;r++)if(t[r-1].maxValue!==t[r].minValue)return!1;return!0}};u([d(N3e)],wo.prototype,"backgroundFillSymbol",void 0),u([d({type:[Oz]})],wo.prototype,"classBreakInfos",void 0),u([Me("classBreakInfos")],wo.prototype,"readClassBreakInfos",null),u([De("classBreakInfos")],wo.prototype,"writeClassBreakInfos",null),u([d({type:String,json:{write:!0}})],wo.prototype,"defaultLabel",void 0),u([d(T3)],wo.prototype,"defaultSymbol",void 0),u([d({type:String,json:{write:!0}})],wo.prototype,"field",void 0),u([cr("field")],wo.prototype,"castField",null),u([d({type:Boolean})],wo.prototype,"isMaxInclusive",void 0),u([d({type:OR,json:{write:!0}})],wo.prototype,"legendOptions",void 0),u([d({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return this.classBreakInfos.length!==0&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],wo.prototype,"minValue",null),u([d({type:String,json:{write:!0}})],wo.prototype,"normalizationField",void 0),u([d({type:Number,cast:t=>Jd(t),json:{write:!0}})],wo.prototype,"normalizationTotal",void 0),u([d({type:t4.apiValues,value:null,json:{type:t4.jsonValues,read:t4.read,write:t4.write}})],wo.prototype,"normalizationType",null),u([st({classBreaks:"class-breaks"})],wo.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],wo.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],wo.prototype,"valueExpressionTitle",void 0),wo=hK=u([$("esri.renderers.ClassBreaksRenderer")],wo);const k3e=wo;let int=class{constructor(e,r){this._storage=new Dse,this._storage.maxSize=e,r&&this._storage.registerRemoveFunc("",r)}put(e,r,i){this._storage.put(e,r,i,1)}pop(e){return this._storage.pop(e)}get(e){return this._storage.get(e)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}};const sfe="esri.renderers.support.DictionaryLoader",nnt={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};let Qse=class{constructor(e,r,i){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new int(100),this._dictionaryPromise=null,this.url=e,this.config=r,this.fieldMap=i}getSymbolFields(){return this._symbolFields}async getSymbolAsync(e,r){let i;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(r));try{i=await this._dictionaryPromise}catch(m){if(ps(m))return this._dictionaryPromise=null,null}const n={};if(this.fieldMap)for(const m of this._symbolFields){const g=this.fieldMap[m];if(g&&e.attributes[g]!=null){const _=""+e.attributes[g];n[m]=_}else n[m]=""}const s=i==null?void 0:i(n,r);if(!s||typeof s!="string")return null;const o=Fie(s).toString(),a=this._symbolCache.get(o);if(a)return a.catch(()=>{this._symbolCache.pop(o)}),a;const l=s.split(";"),c=[],h=[];for(const m of l)if(m)if(m.includes("po:")){const g=m.substr(3).split("|");if(g.length===3){const _=g[0],b=g[1];let w=g[2];if(b==="DashTemplate")w=w.split(" ").map(x=>Number(x));else if(b==="Color"){const x=new Xe(w).toRgba();w=[x[0],x[1],x[2],255*x[3]]}else w=Number(w);h.push({primitiveName:_,propertyName:b,value:w})}}else if(m.includes("|")){for(const g of m.split("|"))if(this._itemNames.has(g)){c.push(g);break}}else this._itemNames.has(m)&&c.push(m);const p=!v(e.geometry)||!e.geometry.hasZ&&e.geometry.type==="point",f=this._cimPartsToCIMSymbol(c,h,p,r);return this._symbolCache.put(o,f,1),f}async fetchResources(e){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void re.getLogger(sfe).error("no valid URL!");const r=ei(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:v(e)?e.signal:null}),[{data:i}]=await Promise.all([r,iy()]);if(!i)throw this._dictionaryPromise=null,new H("esri.renderers.DictionaryRenderer","Bad dictionary data!");const n=i.expression,s=i.authoringInfo;this._refSymbolUrlTemplate=this.url+"/"+i.cimRefTemplateUrl,this._itemNames=new Set(i.itemsNames),this._symbolFields=s.symbol;const o={};if(this.config){const c=this.config;for(const h in c)o[h]=c[h]}if(s.configuration)for(const c of s.configuration)o.hasOwnProperty(c.name)||(o[c.name]=c.value);const a=[];if(v(e)&&e.fields&&this.fieldMap)for(const c of this._symbolFields){const h=this.fieldMap[c],p=e.fields.filter(f=>f.name===h);p.length>0&&a.push({...p[0],name:c})}const l=uHe(n,v(e)?e.spatialReference:null,a,o).then(c=>{const h={scale:0};return(p,f)=>{if(R(c))return null;const m=c.repurposeFeature({geometry:null,attributes:p});return h.scale=v(f)?f.scale??void 0:void 0,c.evaluate({$feature:m,$view:h})}}).catch(c=>(re.getLogger(sfe).error("Creating dictinoary expression failed:",c),null));return this._dictionaryPromise=l,l}async _cimPartsToCIMSymbol(e,r,i,n){const s=new Array(e.length);for(let l=0;l<e.length;l++)s[l]=this._getSymbolPart(e[l],n);const o=await Promise.all(s),a=this.fieldMap;if(a)for(const l of o)U3e(l,a);return new d3({data:this._combineSymbolParts(o,r,i)})}async _getSymbolPart(e,r){if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then(s=>s.data);const i=this._refSymbolUrlTemplate.replace(/\{itemName\}/gi,e),n=ei(i,{responseType:"json",query:{f:"json"},...r});this._ongoingRequests.set(e,n);try{return(await n).data}catch(s){throw this._ongoingRequests.delete(e),s}}_combineSymbolParts(e,r,i){if(!e||e.length===0)return null;const n={...e[0]};if(e.length>1){n.symbolLayers=[];for(const s of e){const o=s;n.symbolLayers.unshift(...o.symbolLayers)}}return i&&(n.callout=nnt),{type:"CIMSymbolReference",symbol:n,primitiveOverrides:r}}};function U3e(t,e){if(!t)return;const r=t.symbolLayers;if(!r)return;let i=r.length;for(;i--;){const n=r[i];n&&n.enable!==!1&&n.type==="CIMVectorMarker"&&snt(n,e)}}function snt(t,e){const r=t.markerGraphics;if(r)for(const i of r){if(!i)continue;const n=i.symbol;if(n)switch(n.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":U3e(n,e);break;case"CIMTextSymbol":n.fieldMap=e}}}const Z9t=Object.freeze(Object.defineProperty({__proto__:null,DictionaryLoader:Qse},Symbol.toStringTag,{value:"Module"}));var dK;let uf=dK=class extends x3(N_){constructor(t){super(t),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new Qse(this.url,this.config,this.fieldMap)}writeData(t,e){t&&(e.scalingExpressionInfo={expression:t,returnType:"number"})}writeVisualVariables(t,e,r,i){i!=null&&i.origin||super.writeVisualVariables(t,e,r,i)}clone(){return new dK({config:se(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:se(this.fieldMap),url:se(this.url),visualVariables:se(this.visualVariables)})}async getSymbolAsync(t,e){return this._loader.getSymbolAsync(t,e)}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e),this.scaleExpression&&await Gc(t,e,this.scaleExpression);for(const r in this.fieldMap){const i=this.fieldMap[r];e.has(i)&&t.add(i)}}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};u([d({type:Qse})],uf.prototype,"_loader",null),u([d({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],uf.prototype,"config",void 0),u([d({type:Object,json:{write:!0}})],uf.prototype,"fieldMap",void 0),u([d({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],uf.prototype,"scaleExpression",void 0),u([De("scaleExpression")],uf.prototype,"writeData",null),u([d({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(t){return{enabled:!!t&&!!this.scaleExpression}}}}})],uf.prototype,"scaleExpressionTitle",void 0),u([d({type:String,json:{write:!0}})],uf.prototype,"url",void 0),u([De("visualVariables")],uf.prototype,"writeVisualVariables",null),uf=dK=u([$("esri.renderers.DictionaryRenderer")],uf);const ont=uf;var pK;let s0=pK=class extends fe{constructor(t){super(t),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(t){return t==null?t:typeof t=="function"?(re.getLogger(this.declaredClass).error(".field: field must be a string value"),null):sN(t)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new pK({color:this.color&&this.color.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([d({type:Xe,json:{type:[Number],write:!0}})],s0.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],s0.prototype,"field",void 0),u([cr("field")],s0.prototype,"castField",null),u([d({type:String,json:{write:!0}})],s0.prototype,"label",void 0),u([d({type:String,json:{write:!0}})],s0.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],s0.prototype,"valueExpressionTitle",void 0),s0=pK=u([$("esri.renderers.support.AttributeColorInfo")],s0);const z3e=s0;var fK;let G6=fK=class extends fe{constructor(){super(...arguments),this.unit=null}clone(){return new fK({unit:this.unit})}};u([d({type:String,json:{write:!0}})],G6.prototype,"unit",void 0),G6=fK=u([$("esri.renderers.support.DotDensityLegendOptions")],G6);const ant=G6;var mK;let du=mK=class extends x3(N_){constructor(t){super(t),this.attributes=null,this.backgroundColor=new Xe([0,0,0,0]),this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new Lp,this.dotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(t){if(this.referenceScale==null)return this.dotValue;const e=t/this.referenceScale*this.dotValue;return e<1?1:e}getSymbol(){return new Mw({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){var t;return((t=this.attributes)==null?void 0:t.reduce((e,r)=>e+r.getAttributeHash(),""))??""}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new mK({attributes:se(this.attributes),backgroundColor:se(this.backgroundColor),dotBlendingEnabled:se(this.dotBlendingEnabled),dotShape:se(this.dotShape),dotSize:se(this.dotSize),dotValue:se(this.dotValue),legendOptions:se(this.legendOptions),outline:se(this.outline),referenceScale:se(this.referenceScale),visualVariables:se(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}getControllerHash(){var e;return`${(e=this.attributes)==null?void 0:e.map(r=>r.field||r.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e);for(const r of this.attributes??[])r.valueExpression&&await Gc(t,e,r.valueExpression),r.field&&t.add(r.field)}};u([d({type:[z3e],json:{write:!0}})],du.prototype,"attributes",void 0),u([d({type:Xe,json:{write:!0}})],du.prototype,"backgroundColor",void 0),u([d({type:Boolean,json:{write:!0}})],du.prototype,"dotBlendingEnabled",void 0),u([d({type:String,json:{write:!1}})],du.prototype,"dotShape",void 0),u([d({type:Number,json:{write:!0}})],du.prototype,"dotSize",void 0),u([d({type:ant,json:{write:!0}})],du.prototype,"legendOptions",void 0),u([d({type:Lp,json:{default:null,write:!0}})],du.prototype,"outline",void 0),u([d({type:Number,json:{write:!0}})],du.prototype,"dotValue",void 0),u([d({type:Number,json:{write:!0}})],du.prototype,"referenceScale",void 0),u([d({type:Number,json:{write:!0}})],du.prototype,"seed",void 0),u([st({dotDensity:"dot-density"})],du.prototype,"type",void 0),du=mK=u([$("esri.renderers.DotDensityRenderer")],du);const lnt=du;let NC=class extends bi(fe){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};u([d({type:String,json:{write:!0}})],NC.prototype,"minLabel",void 0),u([d({type:String,json:{write:!0}})],NC.prototype,"maxLabel",void 0),u([d({type:String,json:{write:!0}})],NC.prototype,"title",void 0),NC=u([$("esri.renderers.support.HeatmapLegendOptions")],NC);function pr(){return[0,0,0,0]}function MN(t){return[t[0],t[1],t[2],t[3]]}function Zt(t,e,r,i){return[t,e,r,i]}function eoe(t){const e=pr(),r=Math.min(4,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function V3e(t,e){return new Float64Array(t,e,4)}function B3e(){return pr()}function j3e(){return Zt(1,1,1,1)}function G3e(){return Zt(1,0,0,0)}function H3e(){return Zt(0,1,0,0)}function q3e(){return Zt(0,0,1,0)}function W3e(){return Zt(0,0,0,1)}const Wg=B3e(),op=j3e(),cnt=G3e(),unt=H3e(),hnt=q3e(),dnt=W3e();Object.freeze(Object.defineProperty({__proto__:null,ONES:op,UNIT_W:dnt,UNIT_X:cnt,UNIT_Y:unt,UNIT_Z:hnt,ZEROS:Wg,clone:MN,create:pr,createView:V3e,fromArray:eoe,fromValues:Zt,ones:j3e,unitW:W3e,unitX:G3e,unitY:H3e,unitZ:q3e,zeros:B3e},Symbol.toStringTag,{value:"Module"}));const toe=2.4;function pnt(t){return Cp(t*toe)}function fnt(t){return da(t)/toe}function mnt(t,e,r,i){let{color:n,ratio:s}=e,{color:o,ratio:a}=r;a===s&&(a===1?s-=1e-6:a+=1e-6);const l=_e((i-s)/(a-s),0,1);F9(t,n.toArray(),o.toArray(),l)}function K9t(t){const r=new Uint8ClampedArray(2048);if(t=t.filter(({ratio:a})=>a>=0&&a<=1).sort((a,l)=>a.ratio-l.ratio).map(({color:a,ratio:l})=>({color:a,ratio:Math.max(l,.001)})),t.length<1)return r;let i=t[0],n=t[0],s=1;const o=pr();for(let a=0;a<512;a++){const l=(a+.5)/512;for(;l>n.ratio&&s<t.length;)i=n,n=t[s++];mnt(o,i,n,l),r.set(o,4*a)}return r}function Q9t(t,e,r,i){const{radius:n,fieldOffset:s,field:o}=e,a=Math.round(da(n)),l=new Float64Array(r*i);let c,h=Number.NEGATIVE_INFINITY;const p=_nt(o,s),f=new Set;for(const m of t){const g=m.getCursor();for(;g.next();){const _=g.getObjectId();if(f.has(_))continue;f.add(_);const b=g.readLegacyPointGeometry(),w=128;if(b.x<-w||b.x>=r+w||b.y<-w||b.y>i+w)continue;const x=+p(g),T=Math.max(0,Math.round(b.x)-a),E=Math.max(0,Math.round(b.y)-a),C=Math.min(i,Math.round(b.y)+a),A=Math.min(r,Math.round(b.x)+a);for(let I=E;I<C;I++)for(let M=T;M<A;M++){const D=I*r+M,U=ynt(b.x-M,b.y-I,a);c=l[D]+=U*x,c>h&&(h=c)}}}return{matrix:l.buffer,max:h}}function eBt(t,e,r,i,n,s){t.canvas.width=t.canvas.height=e,t.clearRect(0,0,e,e);const o=t.getImageData(0,0,e,e);r&&i&&o.data.set(new Uint8ClampedArray(gnt(e,r,i,n,s))),t.putImageData(o,0,0)}function gnt(t,e,r,i,n){const s=new Uint32Array(t*t),o="buffer"in e?e:new Float64Array(e),a="buffer"in r?new Uint32Array(r.buffer):new Uint32Array(new Uint8Array(r).buffer),l=a.length/(n-i);for(let c=0;c<o.length;c++){const h=o[c],p=Math.floor((h-i)*l);s[c]=a[_e(p,0,a.length-1)]}return s.buffer}function ynt(t,e,r){const i=Math.sqrt(t**2+e**2)/r;return i>1?0:3/(Math.PI*r**2)*(1-i**2)**2}function tBt(t,e){return typeof t=="function"?t:t?typeof e=="string"?r=>-1*+r[t]:r=>+r[t]+e:()=>1}function _nt(t,e){return t!=null?typeof e=="string"?r=>-1*+r.readAttribute(t):r=>+r.readAttribute(t)+e:r=>1}var gK;const X3e="esri.renderers.HeatmapRenderer",vnt=re.getLogger(X3e);function ofe(t){if(t!=null){const{maxDensity:e,minDensity:r,radius:i}=t;if(e!=null||r!=null||i!=null){const{blurRadius:n,maxPixelIntensity:s,minPixelIntensity:o,...a}=t;return a}}return t}let Zo=gK=class extends N_{constructor(t){super(t),this.authoringInfo=null,this.colorStops=[new R$({ratio:0,color:new Xe("rgba(255, 140, 0, 0)")}),new R$({ratio:.75,color:new Xe("rgba(255, 140, 0, 1)")}),new R$({ratio:.9,color:new Xe("rgba(255, 0,   0, 1)")})],this.field=null,this.fieldOffset=0,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null,this._warnedProps={blurRadius:!1,maxPixelIntensity:!1,minPixelIntensity:!1}}normalizeCtorArgs(t){return ofe(t)}get blurRadius(){return fnt(this.radius)}set blurRadius(t){const e=this.maxPixelIntensity,r=this.minPixelIntensity;this._set("radius",pnt(t)),this._warnAboutDeprecatedGaussianBlurProp("blurRadius","radius"),this._set("maxDensity",e*this._pixelIntensityToDensity),this._set("minDensity",r*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(t){this._set("maxDensity",t*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("maxPixelIntensity","maxDensity")}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(t){this._set("minDensity",t*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("minPixelIntensity","minDensity")}get _pixelIntensityToDensity(){return 24/(toe**2*this.blurRadius**4)}_warnAboutDeprecatedGaussianBlurProp(t,e){this._warnedProps[t]||Zl(this).getDefaultOrigin()==="user"&&(this._warnedProps[t]=!0,L2(()=>{cS(vnt,t,{replacement:`${String(e)} (suggested value: ${this._get(e)})`,version:"4.24"})}))}read(t,e){t=ofe(t),super.read(t,e)}getSymbol(){return new Pw}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}async collectRequiredFields(t,e){const r=this.field,i=this.valueExpression;r&&typeof r=="string"&&await Yh(t,e,r),i&&typeof i=="string"&&await Gc(t,e,i)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new gK({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:se(this.colorStops),field:this.field,legendOptions:se(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([d({type:Yse,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Zo.prototype,"authoringInfo",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Zo.prototype,"blurRadius",null),u([d({type:[R$],json:{write:!0}})],Zo.prototype,"colorStops",void 0),u([d({type:String,json:{write:!0}})],Zo.prototype,"field",void 0),u([d({type:Number,json:{write:{overridePolicy:(t,e,r)=>({enabled:r==null})},origins:{"web-scene":{write:!1}}}})],Zo.prototype,"fieldOffset",void 0),u([d({type:NC,json:{write:!0}})],Zo.prototype,"legendOptions",void 0),u([d({type:Number,json:{write:!0}})],Zo.prototype,"maxDensity",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Zo.prototype,"maxPixelIntensity",null),u([d({type:Number,json:{write:!0}})],Zo.prototype,"minDensity",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Zo.prototype,"minPixelIntensity",null),u([d({type:Number,cast:yi,json:{write:!0}})],Zo.prototype,"radius",void 0),u([d({type:Number,range:{min:0},json:{default:0,write:!0}})],Zo.prototype,"referenceScale",void 0),u([st({heatmap:"heatmap"})],Zo.prototype,"type",void 0),u([d({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],Zo.prototype,"valueExpression",void 0),u([d({type:String})],Zo.prototype,"valueExpressionTitle",void 0),u([d({readOnly:!0})],Zo.prototype,"_pixelIntensityToDensity",null),Zo=gK=u([$(X3e)],Zo);const Y3e=Zo;let qT=class extends bi(fe){constructor(){super(...arguments),this.color=new Xe([0,0,0,0]),this.label=null,this.threshold=0}};u([d({type:Xe,json:{write:!0}})],qT.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],qT.prototype,"label",void 0),u([d({type:Number,range:{min:0,max:1},json:{write:!0}})],qT.prototype,"threshold",void 0),qT=u([$("esri.renderers.support.OthersCategory")],qT);let H6=class extends bi(fe){constructor(){super(...arguments),this.title=null}};u([d({type:String,json:{write:!0}})],H6.prototype,"title",void 0),H6=u([$("esri.renderers.support.PieChartLegendOptions")],H6);let gh=class extends x3(bi(N_)){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new Xe([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new qT,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart"}getSymbol(){var e;return new Pw({size:this.size?this.size/2+(((e=this.outline)==null?void 0:e.width)||0):0})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol(),this.backgroundFillSymbol].filter(v)}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,r)=>e+r.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,r)=>e+JSON.stringify(r),"")}async collectRequiredFields(e,r){await this.collectVVRequiredFields(e,r);for(const i of this.attributes)i.valueExpression&&await Gc(e,r,i.valueExpression),i.field&&e.add(i.field)}};u([d({type:[z3e],json:{write:!0}})],gh.prototype,"attributes",void 0),u([d({type:Mw,json:{default:null,write:!0}})],gh.prototype,"backgroundFillSymbol",void 0),u([d({type:Xe,json:{write:!0}})],gh.prototype,"defaultColor",void 0),u([d({type:String,json:{write:!0}})],gh.prototype,"defaultLabel",void 0),u([d({type:Number,range:{min:0,max:1},json:{write:!0}})],gh.prototype,"holePercentage",void 0),u([d({type:qT,json:{write:!0}})],gh.prototype,"othersCategory",void 0),u([d({type:H6,json:{write:!0}})],gh.prototype,"legendOptions",void 0),u([d({type:Lp,json:{default:null,write:!0}})],gh.prototype,"outline",void 0),u([d({type:Number,cast:yi,json:{write:!0}})],gh.prototype,"size",void 0),u([st({pieChart:"pie-chart"})],gh.prototype,"type",void 0),gh=u([$("esri.renderers.PieChartRenderer")],gh);const bnt=gh;var yK;let nT=yK=class extends x3(N_){constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(t,e){await Promise.all([this.collectSymbolFields(t,e),this.collectVVRequiredFields(t,e)])}async collectSymbolFields(t,e){await Promise.all(this.getSymbols().map(r=>r.collectRequiredFields(t,e)))}getSymbol(t,e){return this.symbol}async getSymbolAsync(t,e){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((t,e)=>t+JSON.stringify(e),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new yK({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:se(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}};u([d({type:String,json:{write:!0}})],nT.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],nT.prototype,"label",void 0),u([d(T3)],nT.prototype,"symbol",void 0),u([st({simple:"simple"})],nT.prototype,"type",void 0),nT=yK=u([$("esri.renderers.SimpleRenderer")],nT);const MO=nT,wnt=["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"];function _K(t){return t instanceof be}function afe(t){return t instanceof ct?Object.keys(t.items):_K(t)?Zl(t).keys():t?Object.keys(t):[]}function r4(t,e){return t instanceof ct?t.items[e]:t[e]}function xnt(t,e){return!(!Array.isArray(t)||!Array.isArray(e))&&t.length!==e.length}function P$(t){return t?t.declaredClass:null}function Z3e(t,e){const r=t.diff;if(r&&typeof r=="function")return r(t,e);const i=afe(t),n=afe(e);if(i.length===0&&n.length===0)return;if(!i.length||!n.length||xnt(t,e))return{type:"complete",oldValue:t,newValue:e};const s=n.filter(p=>!i.includes(p)),o=i.filter(p=>!n.includes(p)),a=i.filter(p=>n.includes(p)&&r4(t,p)!==r4(e,p)).concat(s,o).sort(),l=P$(t);if(l&&wnt.includes(l)&&a.length)return{type:"complete",oldValue:t,newValue:e};let c;const h=_K(t)&&_K(e);for(const p of a){const f=r4(t,p),m=r4(e,p);let g;if((h||typeof f!="function"&&typeof m!="function")&&f!==m&&(f!=null||m!=null)){if(r&&r[p]&&typeof r[p]=="function")g=r[p](f,m);else if(f instanceof Date&&m instanceof Date){if(f.getTime()===m.getTime())continue;g={type:"complete",oldValue:f,newValue:m}}else g=typeof f=="object"&&typeof m=="object"&&P$(f)===P$(m)?Z3e(f,m):{type:"complete",oldValue:f,newValue:m};v(g)&&(v(c)?c.diff[p]=g:c={type:"partial",diff:{[p]:g}})}}return c}function Tnt(t,e){if(R(t))return!1;const r=e.split(".");let i=t;for(const n of r){if(i.type==="complete")return!0;if(i.type!=="partial")return!1;{const s=i.diff[n];if(!s)return!1;i=s}}return!0}function sBt(t,e){for(const r of e)if(Tnt(t,r))return!0;return!1}function Snt(t,e){if(!(typeof t=="function"||typeof e=="function"||R(t)&&R(e)))return R(t)||R(e)||typeof t=="object"&&typeof e=="object"&&P$(t)!==P$(e)?{type:"complete",oldValue:t,newValue:e}:Z3e(t,e)}function i4(t){if(R(t))return!0;switch(t.type){case"complete":return!1;case"collection":{const e=t;for(const r of e.added)if(!i4(r))return!1;for(const r of e.removed)if(!i4(r))return!1;for(const r of e.changed)if(!i4(r))return!1;return!0}case"partial":for(const e in t.diff)if(!i4(t.diff[e]))return!1;return!0}}let FC=class extends bi(fe){constructor(e){super(e),this.value=null,this.value2=null,this.value3=null}};u([d(V6)],FC.prototype,"value",void 0),u([d(V6)],FC.prototype,"value2",void 0),u([d(V6)],FC.prototype,"value3",void 0),FC=u([$("esri.renderers.support.UniqueValue")],FC);const MR=FC;let o1=class extends bi(fe){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.values=null}castValues(e){if(e==null)return null;const r=typeof(e=Array.isArray(e)?e:[e])[0];return r==="string"||r==="number"?e.map(i=>new MR({value:i})):r==="object"?e[0]instanceof MR?e:e.map(i=>new MR(i)):null}};u([d({type:String,json:{write:!0}})],o1.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],o1.prototype,"label",void 0),u([d(T3)],o1.prototype,"symbol",void 0),u([d({type:[MR],json:{type:[[String]],read:{reader:t=>t?t.map(e=>new MR({value:e[0],value2:e[1],value3:e[2]})):null},write:{writer:(t,e)=>{const r=[];for(const i of t){const n=[i.value,i.value2,i.value3].filter(v).map(s=>s.toString());r.push(n)}e.values=r}}}})],o1.prototype,"values",void 0),u([cr("values")],o1.prototype,"castValues",null),o1=u([$("esri.renderers.support.UniqueValueClass")],o1);const J3e=o1;let ZP=class extends bi(fe){constructor(e){super(e),this.heading=null,this.classes=null}};u([d({type:String,json:{write:!0}})],ZP.prototype,"heading",void 0),u([d({type:[J3e],json:{write:!0}})],ZP.prototype,"classes",void 0),ZP=u([$("esri.renderers.support.UniqueValueGroup")],ZP);const vK=ZP;var bK;let sT=bK=class extends fe{constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new bK({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const t=JSON.stringify(this.symbol&&this.symbol.toJSON());return`${this.value}.${t}`}};u([d({type:String,json:{write:!0}})],sT.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],sT.prototype,"label",void 0),u([d(T3)],sT.prototype,"symbol",void 0),u([d(V6)],sT.prototype,"value",void 0),sT=bK=u([$("esri.renderers.support.UniqueValueInfo")],sT);const I$=sT,Ent=()=>!!ue("enable-feature:force-wosr"),cBt=()=>!!ue("enable-feature:direct-3d-object-feature-layer-display"),uBt=()=>!!ue("enable-feature:SceneLayer-editing");let bG={};async function Cnt(t,e){try{return{data:(await Mnt(t,e)).data,baseUrl:rXe(t),styleUrl:t}}catch(r){return Mu(r),null}}function Ant(t,e,r){const i=v(e.portal)?e.portal:pa.getDefault();let n;const s=`${i.url} - ${i.user&&i.user.username} - ${t}`;return bG[s]||(bG[s]=Rnt(t,i,r).then(o=>(n=o,o.fetchData())).then(o=>({data:o,baseUrl:n.itemUrl??"",styleName:t}))),bG[s]}function Rnt(t,e,r){return e.load(r).then(()=>{const i=new N0({disableExtraQuery:!0,query:`owner:${lfe} AND type:${cfe} AND typekeywords:"${t}"`});return e.queryItems(i,r)}).then(({results:i})=>{var o;let n=null;const s=t.toLowerCase();if(i&&Array.isArray(i)){for(const a of i)if(((o=a.typeKeywords)==null?void 0:o.some(c=>c.toLowerCase()===s))&&a.type===cfe&&a.owner===lfe){n=a;break}}if(!n)throw new H("symbolstyleutils:style-not-found",`The style '${t}' could not be found`,{styleName:t});return n.load(r)})}function Ont(t,e,r){return t&&v(t.styleUrl)?Cnt(t.styleUrl,r):t&&v(t.styleName)?Ant(t.styleName,e,r):Promise.reject(new H("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function hBt(t){return t===null||t.type==="CIMSymbolReference"?t:{type:"CIMSymbolReference",symbol:t}}function dBt(t,e){if(e==="cimRef")return t.cimRef;if(t.formatInfos&&!Ent()){for(const r of t.formatInfos)if(r.type==="gltf")return r.href}return t.webRef}function Mnt(t,e){const r={responseType:"json",query:{f:"json"},...e};return ei(em(t),r)}const lfe="esri_en",cfe="Style",pBt="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json";var JP;const K3e="esri.renderers.UniqueValueRenderer",hv=re.getLogger(K3e),ufe="uvInfos-watcher",hfe="uvGroups-watcher",Pnt=",",Int=bs(I$);function $nt(t){const{field1:e,field2:r,field3:i,fieldDelimiter:n,uniqueValueInfos:s,valueExpression:o}=t,a=!(!e||!r);return[{classes:(s??[]).map(l=>{var w;const{symbol:c,label:h,value:p,description:f}=l,[m,g,_]=a?((w=p==null?void 0:p.toString())==null?void 0:w.split(n||""))||[]:[p],b=[];return(e||o)&&b.push(m),r&&b.push(g),i&&b.push(_),{symbol:c,label:h,values:[b],description:f}})}]}let rs=JP=class extends x3(N_){constructor(t){super(t),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this._isInfosSource=null,this.type="unique-value",this.backgroundFillSymbol=null,this.orderByClassesEnabled=!1,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(e,r){if(!e&&!r)return;if(!e||!r)return{type:"complete",oldValue:e,newValue:r};let i=!1;const n={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let s=0;s<r.length;s++){const o=e.find(a=>a.value===r[s].value);o?Snt(o,r[s])?(n.changed.push({type:"complete",oldValue:o,newValue:r[s]}),i=!0):n.unchanged.push({oldValue:o,newValue:r[s]}):(n.added.push(r[s]),i=!0)}for(let s=0;s<e.length;s++)r.find(o=>o.value===e[s].value)||(n.removed.push(e[s]),i=!0);return i?n:void 0}},this._set("uniqueValueInfos",[]),this._set("uniqueValueGroups",[])}get _cache(){return{compiledFunc:null}}set field(t){this._set("field",t),this._updateFieldDelimiter(),this._updateUniqueValues()}castField(t){return t==null||typeof t=="function"?t:sN(t)}writeField(t,e,r,i){typeof t=="string"?e[r]=t:i&&i.messages?i.messages.push(new H("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):hv.error(".field: cannot write field to JSON since it's not a string value")}set field2(t){this._set("field2",t),this._updateFieldDelimiter(),this._updateUniqueValues()}set field3(t){this._set("field3",t),this._updateUniqueValues()}set valueExpression(t){this._set("valueExpression",t),this._updateUniqueValues()}set defaultSymbol(t){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",t)}set fieldDelimiter(t){this._set("fieldDelimiter",t),this._updateUniqueValues()}readPortal(t,e,r){return r.portal||pa.getDefault()}readStyleOrigin(t,e,r){if(e.styleName)return Object.freeze({styleName:e.styleName});if(e.styleUrl){const i=k2(e.styleUrl,r);return Object.freeze({styleUrl:i})}}writeStyleOrigin(t,e,r,i){t.styleName?e.styleName=t.styleName:t.styleUrl&&(e.styleUrl=x_(t.styleUrl,i))}set uniqueValueGroups(t){this.styleOrigin?hv.error("#uniqueValueGroups=","Cannot modify unique value groups of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueGroups",t),this._updateInfosFromGroups(),this._isInfosSource=!1,this._watchUniqueValueGroups())}set uniqueValueInfos(t){this.styleOrigin?hv.error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos())}addUniqueValueInfo(t,e){var i;if(this.styleOrigin)return void hv.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let r;r=typeof t=="object"?Int(t):new I$({value:t,symbol:dAe(e)}),(i=this.uniqueValueInfos)==null||i.push(r),this._valueInfoMap[r.value]=r,this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}removeUniqueValueInfo(t){if(this.styleOrigin)return void hv.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");const e=this.uniqueValueInfos;if(e){for(let r=0;r<e.length;r++)if(e[r].value===t+""){delete this._valueInfoMap[t],e.splice(r,1);break}}this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}async getUniqueValueInfo(t,e){let r=e;return this.valueExpression&&(R(e)||R(e.arcade))&&(r={...r,arcade:await iy()}),this._getUniqueValueInfo(t,r)}getSymbol(t,e){if(this.valueExpression&&(R(e)||R(e.arcade)))return void hv.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const r=this._getUniqueValueInfo(t,e);return r&&r.symbol||this.defaultSymbol}async getSymbolAsync(t,e){let r=e;if(this.valueExpression&&(R(r)||R(r.arcade))){const n=await iy(),{arcadeUtils:s}=n;s.hasGeometryOperations(this.valueExpression)&&await s.enableGeometryOperations(),r={...r,arcade:n}}const i=this._getUniqueValueInfo(t,r);return i&&i.symbol||this.defaultSymbol}getSymbols(){const t=[];for(const e of this.uniqueValueInfos??[])e.symbol&&t.push(e.symbol);return this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){var i;const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),r=(i=this.uniqueValueInfos)==null?void 0:i.reduce((n,s)=>n+s.getMeshHash(),"");return`${t}.${e}.${r}.${`${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}`}.${this.valueExpression}`}clone(){const t=new JP({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:se(this.defaultSymbol),orderByClassesEnabled:this.orderByClassesEnabled,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:se(this.visualVariables),legendOptions:se(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),backgroundFillSymbol:se(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(t._isDefaultSymbolDerived=!0),t._set("portal",this.portal);const e=se(this.uniqueValueInfos),r=se(this.uniqueValueGroups);return this.styleOrigin&&(t._set("styleOrigin",Object.freeze(se(this.styleOrigin))),Object.freeze(e),Object.freeze(r)),t._set("uniqueValueInfos",e),t._updateValueInfoMap(),t._set("uniqueValueGroups",r),t._isInfosSource=this._isInfosSource,t._watchUniqueValueInfosAndGroups(),t}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(t,e){const r=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(r)}async collectSymbolFields(t,e){const r=[...this.getSymbols().map(i=>i.collectRequiredFields(t,e)),Gc(t,e,this.valueExpression)];Yh(t,e,this.field),Yh(t,e,this.field2),Yh(t,e,this.field3),await Promise.all(r)}populateFromStyle(){return Ont(this.styleOrigin,{portal:this.portal}).then(t=>{var r;const e=[];return this._valueInfoMap={},t&&t.data&&Array.isArray(t.data.items)&&t.data.items.forEach(i=>{const n=new z2({styleUrl:t.styleUrl,styleName:t.styleName,portal:this.portal,name:i.name});this.defaultSymbol||i.name!==t.data.defaultItem||(this.defaultSymbol=n,this._isDefaultSymbolDerived=!0);const s=new I$({value:i.name,symbol:n});e.push(s),this._valueInfoMap[i.name]=s}),this._set("uniqueValueInfos",Object.freeze(e)),this._updateGroupsFromInfos(!0),this._isInfosSource=null,this._watchUniqueValueInfos(),!this.defaultSymbol&&((r=this.uniqueValueInfos)!=null&&r.length)&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateFieldDelimiter(){this.field&&this.field2&&!this.fieldDelimiter&&this._set("fieldDelimiter",Pnt)}_updateUniqueValues(){this._isInfosSource!=null&&(this._isInfosSource?this._updateGroupsFromInfos():this._updateInfosFromGroups())}_updateValueInfoMap(){this._valueInfoMap={};const{uniqueValueInfos:t}=this;if(t)for(const e of t)this._valueInfoMap[e.value+""]=e}_watchUniqueValueInfosAndGroups(){this._watchUniqueValueInfos(),this._watchUniqueValueGroups()}_watchUniqueValueInfos(){this.removeHandles(ufe);const{uniqueValueInfos:t}=this;if(t){const e=[];for(const r of t)e.push(ne(()=>({symbol:r.symbol,value:r.value,label:r.label,description:r.description}),(i,n)=>{i!==n&&(this._updateGroupsFromInfos(),this._isInfosSource=!0)},{sync:!0}));this.addHandles(e,ufe)}}_watchUniqueValueGroups(){this.removeHandles(hfe);const{uniqueValueGroups:t}=this;if(t){const e=[];for(const r of t){e.push(ne(()=>({classes:r.classes}),(i,n)=>{i!==n&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}));for(const i of r.classes??[])e.push(ne(()=>({symbol:i.symbol,values:i.values,label:i.label,description:i.description}),(n,s)=>{n!==s&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}))}this.addHandles(e,hfe)}}_updateInfosFromGroups(){if(!this.uniqueValueGroups)return this._set("uniqueValueInfos",null),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const t=[],{field:e,field2:r,field3:i,fieldDelimiter:n,uniqueValueGroups:s,valueExpression:o}=this;if(!e&&!o)return this._set("uniqueValueInfos",t),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const a=!(!e||!r);for(const l of s)for(const c of l.classes??[]){const{symbol:h,label:p,values:f,description:m}=c;for(const g of f??[]){const{value:_,value2:b,value3:w}=g,x=[_];r&&x.push(b),i&&x.push(w);const T=a?x.join(n||""):x[0];t.push(new I$({symbol:h,label:p,value:T,description:m}))}}this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._watchUniqueValueInfos()}_updateGroupsFromInfos(t=!1){if(!this.uniqueValueInfos)return this._set("uniqueValueGroups",null),void this._watchUniqueValueGroups();const{field:e,field2:r,valueExpression:i,fieldDelimiter:n,uniqueValueInfos:s}=this;if(!e&&!i||!s.length)return this._set("uniqueValueGroups",[]),void this._watchUniqueValueGroups();const o=!(!e||!r),a=s.map(c=>{var w;const{symbol:h,label:p,value:f,description:m}=c,[g,_,b]=o?((w=f==null?void 0:f.toString())==null?void 0:w.split(n||""))||[]:[f];return new J3e({symbol:h,label:p,description:m,values:[new MR({value:g,value2:_,value3:b})]})}),l=[new vK({classes:a})];t&&Object.freeze(l),this._set("uniqueValueGroups",l),this._watchUniqueValueGroups()}_getUniqueValueInfo(t,e){return this.valueExpression?this._getUnqiueValueInfoForExpression(t,e):this._getUnqiueValueInfoForFields(t)}_getUnqiueValueInfoForExpression(t,e){const{viewingMode:r,scale:i,spatialReference:n,arcade:s}=Nt(e,{});let o=this._cache.compiledFunc;const a=s.arcadeUtils;if(!o){const c=a.createSyntaxTree(this.valueExpression);o=a.createFunction(c),this._cache.compiledFunc=o}const l=a.executeFunction(o,a.createExecContext(t,a.getViewInfo({viewingMode:r,scale:i,spatialReference:n})));return this._valueInfoMap[l+""]}_getUnqiueValueInfoForFields(t){const e=this.field,r=t.attributes;let i;if(typeof e!="function"&&this.field2){const n=this.field2,s=this.field3,o=[];e&&o.push(r[e]),n&&o.push(r[n]),s&&o.push(r[s]),i=o.join(this.fieldDelimiter||"")}else typeof e=="function"?i=e(t):e&&(i=r[e]);return this._valueInfoMap[i+""]}static fromPortalStyle(t,e){const r=new JP(e&&e.properties);r._set("styleOrigin",Object.freeze({styleName:t})),r._set("portal",e&&e.portal||pa.getDefault());const i=r.populateFromStyle();return i.catch(n=>{hv.error(`#fromPortalStyle('${t}'[, ...])`,"Failed to create unique value renderer from style name",n)}),i}static fromStyleUrl(t,e){const r=new JP(e&&e.properties);r._set("styleOrigin",Object.freeze({styleUrl:t}));const i=r.populateFromStyle();return i.catch(n=>{hv.error(`#fromStyleUrl('${t}'[, ...])`,"Failed to create unique value renderer from style URL",n)}),i}};u([d({readOnly:!0})],rs.prototype,"_cache",null),u([st({uniqueValue:"unique-value"})],rs.prototype,"type",void 0),u([d(N3e)],rs.prototype,"backgroundFillSymbol",void 0),u([d({value:null,json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],rs.prototype,"field",null),u([cr("field")],rs.prototype,"castField",null),u([De("field")],rs.prototype,"writeField",null),u([d({type:String,value:null,json:{write:!0}})],rs.prototype,"field2",null),u([d({type:String,value:null,json:{write:!0}})],rs.prototype,"field3",null),u([d({type:Boolean,json:{name:"drawInClassOrder",default:!1,write:!0,origins:{"web-scene":{write:!1}}}})],rs.prototype,"orderByClassesEnabled",void 0),u([d({type:String,value:null,json:{write:!0}})],rs.prototype,"valueExpression",null),u([d({type:String,json:{write:!0}})],rs.prototype,"valueExpressionTitle",void 0),u([d({type:OR,json:{write:!0}})],rs.prototype,"legendOptions",void 0),u([d({type:String,json:{write:!0}})],rs.prototype,"defaultLabel",void 0),u([d(CSe({...T3},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],rs.prototype,"defaultSymbol",null),u([d({type:String,value:null,json:{write:!0}})],rs.prototype,"fieldDelimiter",null),u([d({type:pa,readOnly:!0})],rs.prototype,"portal",void 0),u([Me("portal",["styleName"])],rs.prototype,"readPortal",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],rs.prototype,"styleOrigin",void 0),u([Me("styleOrigin",["styleName","styleUrl"])],rs.prototype,"readStyleOrigin",null),u([De("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],rs.prototype,"writeStyleOrigin",null),u([d({type:[vK],json:{read:{source:["uniqueValueGroups","uniqueValueInfos"],reader:(t,e,r)=>(e.uniqueValueGroups||$nt(e)).map(i=>vK.fromJSON(i,r))},write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],rs.prototype,"uniqueValueGroups",null),u([d({type:[I$],json:{read:!1,write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],rs.prototype,"uniqueValueInfos",null),rs=JP=u([$(K3e)],rs);const PN=rs,bB={key:"type",base:N_,typeMap:{heatmap:Y3e,simple:MO,"unique-value":PN,"class-breaks":k3e,"dot-density":lnt,dictionary:ont,"pie-chart":bnt},errorContext:"renderer"},Lnt={key:"type",base:N_,typeMap:{simple:MO,"unique-value":PN,"class-breaks":k3e,heatmap:Y3e},errorContext:"renderer"};function fBt(t,e){return iD(t,null,e)}const Dnt=Ew({types:bB});function iD(t,e,r){return t?t&&(t.styleName||t.styleUrl)&&t.type!=="uniqueValue"?(r&&r.messages&&r.messages.push(new Sp("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+t.type+"'",{definition:t,context:r})),null):Dnt(t,e,r):null}let Nnt=class Q3e{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(oY),this._values=new Map,this.multipleOriginsSupported=!0}clone(e){const r=new Q3e,i=this._originStores[Jr.DEFAULTS];i&&i.forEach((n,s)=>{r.set(s,se(n),Jr.DEFAULTS)});for(let n=Jr.SERVICE;n<oY;n++){const s=this._originStores[n];s&&s.forEach((o,a)=>{e&&e.has(a)||r.set(a,se(o),n)})}return r}get(e,r){const i=r===void 0?this._values:this._originStores[r];return i?i.get(e):void 0}keys(e){const r=e==null?this._values:this._originStores[e];return r?[...r.keys()]:[]}set(e,r,i=Jr.USER){let n=this._originStores[i];if(n||(n=new Map,this._originStores[i]=n),n.set(e,r),!this._values.has(e)||this._propertyOriginMap.get(e)<=i){const s=this._values.get(e);return this._values.set(e,r),this._propertyOriginMap.set(e,i),s!==r}return!1}delete(e,r=Jr.USER){const i=this._originStores[r];if(!i)return;const n=i.get(e);if(i.delete(e),this._values.has(e)&&this._propertyOriginMap.get(e)===r){this._values.delete(e);for(let s=r-1;s>=0;s--){const o=this._originStores[s];if(o&&o.has(e)){this._values.set(e,o.get(e)),this._propertyOriginMap.set(e,s);break}}}return n}has(e,r){const i=r===void 0?this._values:this._originStores[r];return!!i&&i.has(e)}revert(e,r){for(;r>0&&!this.has(e,r);)--r;const i=this._originStores[r],n=i&&i.get(e),s=this._values.get(e);return this._values.set(e,n),this._propertyOriginMap.set(e,r),s!==n}originOf(e){return this._propertyOriginMap.get(e)||Jr.DEFAULTS}forEach(e){this._values.forEach(e)}};const eMe=t=>{let e=class extends t{constructor(...r){super(...r);const i=Zl(this),n=i.store,s=new Nnt;i.store=s,b2e(i,n,s)}read(r,i){x2e(this,r,i)}getAtOrigin(r,i){const n=wG(this),s=nb(i);if(typeof r=="string")return n.get(r,s);const o={};return r.forEach(a=>{o[a]=n.get(a,s)}),o}originOf(r){return z8(this.originIdOf(r))}originIdOf(r){return wG(this).originOf(r)}revert(r,i){const n=wG(this),s=nb(i),o=Zl(this);let a;a=typeof r=="string"?r==="*"?n.keys(s):[r]:r,a.forEach(l=>{o.invalidate(l),n.revert(l,s),o.commit(l)})}};return e=u([$("esri.core.ReadOnlyMultiOriginJSONSupport")],e),e};function wG(t){return Zl(t).store}let dfe=class extends eMe(be){};dfe=u([$("esri.core.ReadOnlyMultiOriginJSONSupport")],dfe);const Fnt=t=>{let e=class extends t{constructor(...r){super(...r)}clear(r,i="user"){return xG(this).delete(r,nb(i))}write(r={},i){return E2e(this,r=r||{},i),r}setAtOrigin(r,i,n){Zl(this).setAtOrigin(r,i,nb(n))}removeOrigin(r){const i=xG(this),n=nb(r),s=i.keys(n);for(const o of s)i.originOf(o)===n&&i.set(o,i.get(o,n),Jr.USER)}updateOrigin(r,i){const n=xG(this),s=nb(i),o=this.get(r);for(let a=s+1;a<oY;++a)n.delete(r,a);n.set(r,o,s)}toJSON(r){return this.write({},r)}};return e=u([$("esri.core.WriteableMultiOriginJSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function xG(t){return Zl(t).store}const IN=t=>{let e=class extends Fnt(eMe(t)){constructor(...r){super(...r)}};return e=u([$("esri.core.MultiOriginJSONSupport")],e),e};let Mz=class extends IN(be){};Mz=u([$("esri.core.MultiOriginJSONSupport")],Mz);async function knt(t,e){const{WhereClause:r}=await Q(()=>import("./WhereClause-f6ddfb88.js").then(i=>i.W),["assets/WhereClause-f6ddfb88.js","assets/executionError-fb3f283a.js"]);return r.create(t,e)}function Unt(t,e){return v(t)?v(e)?`(${t}) AND (${e})`:t:e}var wK;let oT=wK=class extends fe{constructor(t){super(t),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new wK({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([d({type:String,json:{write:!0}})],oT.prototype,"expression",void 0),u([d({type:String,json:{write:!0}})],oT.prototype,"name",void 0),u([d({type:["boolean","date","number","string"],json:{write:!0}})],oT.prototype,"returnType",void 0),u([d({type:String,json:{write:!0}})],oT.prototype,"title",void 0),oT=wK=u([$("esri.form.ExpressionInfo")],oT);const znt=oT;let aT=class extends fe{constructor(e){super(e),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};u([d({type:String,json:{write:!0}})],aT.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],aT.prototype,"label",void 0),u([d()],aT.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],aT.prototype,"visibilityExpression",void 0),aT=u([$("esri.form.elements.Element")],aT);const PO=aT;var xK;let q6=xK=class extends fe{constructor(t){super(t),this.type=null}clone(){return new xK({type:this.type})}};u([d({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],q6.prototype,"type",void 0),q6=xK=u([$("esri.form.elements.inputs.AttachmentInput")],q6);const Vnt=q6;var TK;let lT=TK=class extends PO{constructor(t){super(t),this.attachmentKeyword=null,this.editable=!0,this.input=null,this.type="attachment"}clone(){return new TK({attachmentKeyword:this.attachmentKeyword,description:this.description,editable:this.editable,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}};u([d({type:String,json:{write:!0}})],lT.prototype,"attachmentKeyword",void 0),u([d({type:Boolean,json:{write:!0}})],lT.prototype,"editable",void 0),u([d({type:Vnt,json:{read:{source:"inputType"},write:{target:"inputType"}}})],lT.prototype,"input",void 0),u([d({type:["attachment"],json:{read:!1,write:!0}})],lT.prototype,"type",void 0),lT=TK=u([$("esri.form.elements.AttachmentElement")],lT);const pfe=lT;let W6=class extends fe{constructor(e){super(e),this.type=null}};u([d()],W6.prototype,"type",void 0),W6=u([$("esri.form.elements.inputs.Input")],W6);const S3=W6;let KP=class extends S3{constructor(e){super(e),this.maxLength=null,this.minLength=0}};u([d({type:Number,json:{write:!0}})],KP.prototype,"maxLength",void 0),u([d({type:Number,json:{write:!0}})],KP.prototype,"minLength",void 0),KP=u([$("esri.form.elements.inputs.TextInput")],KP);const roe=KP;var SK;let X6=SK=class extends roe{constructor(t){super(t),this.type="barcode-scanner"}clone(){return new SK({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["barcode-scanner"],json:{read:!1,write:!0}})],X6.prototype,"type",void 0),X6=SK=u([$("esri.form.elements.inputs.BarcodeScannerInput")],X6);const Bnt=X6;var EK;let kC=EK=class extends S3{constructor(t){super(t),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="combo-box"}clone(){return new EK({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}};u([d({type:String,json:{write:!0}})],kC.prototype,"noValueOptionLabel",void 0),u([d({type:Boolean,json:{write:!0}})],kC.prototype,"showNoValueOption",void 0),u([d({type:["combo-box"],json:{read:!1,write:!0}})],kC.prototype,"type",void 0),kC=EK=u([$("esri.form.elements.inputs.ComboBoxInput")],kC);const jnt=kC;var CK;function ffe(t){return t!=null?new Date(t):null}function mfe(t){return t?t.getTime():null}let hf=CK=class extends S3{constructor(t){super(t),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(t,e){return ffe(e.max)}writeMax(t,e){e.max=mfe(t)}readMin(t,e){return ffe(e.min)}writeMin(t,e){e.min=mfe(t)}clone(){return new CK({includeTime:this.includeTime,max:this.max,min:this.min})}};u([d({type:Boolean,json:{write:!0}})],hf.prototype,"includeTime",void 0),u([d({type:Date,json:{type:Number,write:!0}})],hf.prototype,"max",void 0),u([Me("max")],hf.prototype,"readMax",null),u([De("max")],hf.prototype,"writeMax",null),u([d({type:Date,json:{type:Number,write:!0}})],hf.prototype,"min",void 0),u([Me("min")],hf.prototype,"readMin",null),u([De("min")],hf.prototype,"writeMin",null),u([d({type:["datetime-picker"],json:{read:!1,write:!0}})],hf.prototype,"type",void 0),hf=CK=u([$("esri.form.elements.inputs.DateTimePickerInput")],hf);const Gnt=hf;var AK;let UC=AK=class extends S3{constructor(t){super(t),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="radio-buttons"}clone(){return new AK({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}};u([d({type:String,json:{write:!0}})],UC.prototype,"noValueOptionLabel",void 0),u([d({type:Boolean,json:{write:!0}})],UC.prototype,"showNoValueOption",void 0),u([d({type:["radio-buttons"],json:{read:!1,write:!0}})],UC.prototype,"type",void 0),UC=AK=u([$("esri.form.elements.inputs.RadioButtonsInput")],UC);const Hnt=UC;var RK;let zC=RK=class extends S3{constructor(t){super(t),this.offValue=null,this.onValue=null,this.type="switch"}clone(){return new RK({offValue:this.offValue,onValue:this.onValue})}};u([d({type:[String,Number],json:{write:!0}})],zC.prototype,"offValue",void 0),u([d({type:[String,Number],json:{write:!0}})],zC.prototype,"onValue",void 0),u([d({type:["switch"],json:{read:!1,write:!0}})],zC.prototype,"type",void 0),zC=RK=u([$("esri.form.elements.inputs.SwitchInput")],zC);const qnt=zC;var OK;let Y6=OK=class extends roe{constructor(t){super(t),this.type="text-area"}clone(){return new OK({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["text-area"],json:{read:!1,write:!0}})],Y6.prototype,"type",void 0),Y6=OK=u([$("esri.form.elements.inputs.TextAreaInput")],Y6);const Wnt=Y6;var MK;let Z6=MK=class extends roe{constructor(t){super(t),this.type="text-box"}clone(){return new MK({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["text-box"],json:{read:!1,write:!0}})],Z6.prototype,"type",void 0),Z6=MK=u([$("esri.form.elements.inputs.TextBoxInput")],Z6);const Xnt=Z6,Ynt={base:S3,key:"type",typeMap:{"barcode-scanner":Bnt,"combo-box":jnt,"datetime-picker":Gnt,"radio-buttons":Hnt,switch:qnt,"text-area":Wnt,"text-box":Xnt}};var PK;const tMe="esri.form.elements.FieldElement",gfe=re.getLogger(tMe);let Md=PK=class extends PO{constructor(t){super(t),this.domain=null,this.editableExpression=null,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field",this.valueExpression=null}get editable(){return cS(gfe,"editable",{replacement:"editableExpression",version:"4.26",warnOnce:!0}),this._get("editable")??!0}set editable(t){cS(gfe,"editable",{replacement:"editableExpression",version:"4.26",warnOnce:!0}),this._set("editable",t)}clone(){return new PK({description:this.description,domain:this.domain,editable:this.editable,editableExpression:this.editableExpression,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,valueExpression:this.valueExpression,visibilityExpression:this.visibilityExpression})}};u([d({types:JOe,json:{read:{reader:Nse},write:!0}})],Md.prototype,"domain",void 0),u([d({type:Boolean,json:{write:!0}})],Md.prototype,"editable",null),u([d({type:String,json:{write:!0}})],Md.prototype,"editableExpression",void 0),u([d({type:String,json:{write:!0}})],Md.prototype,"fieldName",void 0),u([d({type:String,json:{write:!0}})],Md.prototype,"hint",void 0),u([d({types:Ynt,json:{read:{source:"inputType"},write:{target:"inputType"}}})],Md.prototype,"input",void 0),u([d({type:String,json:{write:!0}})],Md.prototype,"requiredExpression",void 0),u([d({type:String,json:{read:!1,write:!0}})],Md.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Md.prototype,"valueExpression",void 0),Md=PK=u([$(tMe)],Md);const yfe=Md;var IK;let o0=IK=class extends PO{constructor(t){super(t),this.displayCount=null,this.displayType="list",this.editable=!0,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new IK({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editable:this.editable,label:this.label,orderByFields:se(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};u([d({type:Number,json:{write:!0}})],o0.prototype,"displayCount",void 0),u([d({type:["list"],json:{write:!0}})],o0.prototype,"displayType",void 0),u([d({type:Boolean,json:{write:!0}})],o0.prototype,"editable",void 0),u([d({type:[mne],json:{write:!0}})],o0.prototype,"orderByFields",void 0),u([d({type:Number,json:{write:!0}})],o0.prototype,"relationshipId",void 0),u([d({type:["relationship"],json:{read:!1,write:!0}})],o0.prototype,"type",void 0),o0=IK=u([$("esri.form.elements.RelationshipElement")],o0);const _fe=o0;function rMe(t){return{typesWithGroup:{base:PO,key:"type",typeMap:{attachment:pfe,field:yfe,group:t,relationship:_fe}},typesWithoutGroup:{base:PO,key:"type",typeMap:{attachment:pfe,field:yfe,relationship:_fe}}}}function iMe(t,e,r=!0){if(!t)return null;const i=r?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(n=>i[n.type]).map(n=>i[n.type].fromJSON(n))}function nMe(t,e,r=!0){if(!t)return null;const i=r?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(n=>i[n.type]).map(n=>n.toJSON())}function sMe(t,e,r=!0){return t?t.map(i=>om(r?e.typesWithGroup:e.typesWithoutGroup,i)):null}var $K;let wg=$K=class extends PO{constructor(t){super(t),this.elements=null,this.initialState="expanded",this.type="group"}castElements(t){return sMe(t,TG,!1)}readElements(t,e){return iMe(e.formElements,TG,!1)}writeElements(t,e){e.formElements=nMe(t,TG,!1)}clone(){return new $K({description:this.description,elements:se(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};u([d({json:{write:!0}})],wg.prototype,"elements",void 0),u([cr("elements")],wg.prototype,"castElements",null),u([Me("elements",["formElements"])],wg.prototype,"readElements",null),u([De("elements")],wg.prototype,"writeElements",null),u([d({type:["collapsed","expanded"],json:{write:!0}})],wg.prototype,"initialState",void 0),u([d({type:String,json:{read:!1,write:!0}})],wg.prototype,"type",void 0),wg=$K=u([$("esri.form.elements.GroupElement")],wg);const TG=rMe(wg),Znt=wg;var LK;const SG=rMe(Znt);let df=LK=class extends fe{constructor(t){super(t),this.description=null,this.elements=null,this.expressionInfos=null,this.preserveFieldValuesWhenHidden=!1,this.title=null}castElements(t){return sMe(t,SG)}readElements(t,e){return iMe(e.formElements,SG)}writeElements(t,e){e.formElements=nMe(t,SG)}clone(){return new LK({description:this.description,expressionInfos:se(this.expressionInfos),elements:se(this.elements),title:this.title,preserveFieldValuesWhenHidden:this.preserveFieldValuesWhenHidden})}};u([d({type:String,json:{write:!0}})],df.prototype,"description",void 0),u([d({json:{write:!0}})],df.prototype,"elements",void 0),u([cr("elements")],df.prototype,"castElements",null),u([Me("elements",["formElements"])],df.prototype,"readElements",null),u([De("elements")],df.prototype,"writeElements",null),u([d({type:[znt],json:{write:!0}})],df.prototype,"expressionInfos",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],df.prototype,"preserveFieldValuesWhenHidden",void 0),u([d({type:String,json:{write:!0}})],df.prototype,"title",void 0),df=LK=u([$("esri.form.FormTemplate")],df);const Jnt=df;async function Knt(t){const e="portalItem"in t?t:{portalItem:t},r=await Q(()=>import("./portalLayers-f443c7e1.js"),["assets/portalLayers-f443c7e1.js","assets/lazyLayerLoader-60b48c6f.js","assets/layersLoader-aabc4951.js","assets/fetchService-65c9e60a.js","assets/jsonContext-b7261aa0.js"]);try{return await r.fromItem(e)}catch(i){const n=e&&e.portalItem,s=n&&n.id||"unset",o=n&&n.portal&&n.portal.url||ri.portalUrl;throw re.getLogger("esri.layers.support.fromPortalItem").error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+o+"', id: '"+s+"')",i),i}}let Qnt=0,Jo=class extends Sn.EventedMixin(c3(qu)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new ur(-180,-90,180,90,Je.WGS84),this.id=Date.now().toString(16)+"-layer-"+Qnt++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=Je.WGS84,this.title=null,this.type=null,this.url=null,this.visible=!0}static async fromArcGISServerUrl(e){const r=typeof e=="string"?{url:e}:e;return(await Q(()=>import("./arcgisLayers-ecfe9450.js"),["assets/arcgisLayers-ecfe9450.js","assets/fetchService-65c9e60a.js","assets/lazyLayerLoader-60b48c6f.js"])).fromUrl(r)}static fromPortalItem(e){return Knt(e)}initialize(){this.when().catch(e=>{ps(e)||re.getLogger(this.declaredClass).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})})}destroy(){if(this.parent){const e=this,r=this.parent;"layers"in r&&r.layers.includes(e)?r.layers.remove(e):"tables"in r&&r.tables.includes(e)?r.tables.remove(e):"baseLayers"in r&&r.baseLayers.includes(e)?r.baseLayers.remove(e):"baseLayers"in r&&r.referenceLayers.includes(e)&&r.referenceLayers.remove(e)}}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){return Uo(this.url)}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await ei(e,{query:{f:"json"},responseType:"json"})).data;throw new H("layer:no-attribution-data","Layer does not have attribution data")}};u([d({type:String})],Jo.prototype,"attributionDataUrl",void 0),u([d({type:ur})],Jo.prototype,"fullExtent",void 0),u([d({readOnly:!0})],Jo.prototype,"hasAttributionData",null),u([d({type:String,clonable:!1})],Jo.prototype,"id",void 0),u([d({type:Boolean,nonNullable:!0})],Jo.prototype,"legendEnabled",void 0),u([d({type:["show","hide","hide-children"]})],Jo.prototype,"listMode",void 0),u([d({type:Number,range:{min:0,max:1},nonNullable:!0})],Jo.prototype,"opacity",void 0),u([d({clonable:!1})],Jo.prototype,"parent",void 0),u([d({readOnly:!0})],Jo.prototype,"parsedUrl",null),u([d({type:Boolean})],Jo.prototype,"popupEnabled",void 0),u([d({type:Boolean})],Jo.prototype,"attributionVisible",void 0),u([d({type:Je})],Jo.prototype,"spatialReference",void 0),u([d({type:String})],Jo.prototype,"title",void 0),u([d({readOnly:!0,json:{read:!1}})],Jo.prototype,"type",void 0),u([d()],Jo.prototype,"url",void 0),u([d({type:Boolean,nonNullable:!0})],Jo.prototype,"visible",void 0),Jo=u([$("esri.layers.Layer")],Jo);const nD=Jo;function vfe(t,e,r){if(t.hasM==null||t.hasZ)for(const i of e)for(const n of i)n.length>2&&(n[2]*=r)}function est(t,e,r){if(!t&&!e||!r)return;const i=JS(r);bfe(t,r,i),bfe(e,r,i)}function bfe(t,e,r){if(t)for(const i of t)tst(i.geometry,e,r)}function tst(t,e,r){if(R(t)||!t.spatialReference||In(t.spatialReference,e))return;const i=JS(t.spatialReference)/r;if(i!==1){if("x"in t)t.z!=null&&(t.z*=i);else if("rings"in t)vfe(t,t.rings,i);else if("paths"in t)vfe(t,t.paths,i);else if("points"in t&&(t.hasM==null||t.hasZ))for(const n of t.points)n.length>2&&(n[2]*=i)}}let rst=0;const oMe="esri.layers.graphics.sources.MemorySource",EG=re.getLogger(oMe);let C0=class extends qu.LoadableMixin(m3(Iw(ct))){constructor(e){super(e),this._idToClientGraphic=null,this.type="memory"}load(e){const r=v(e)?e.signal:null;return this.addResolvingPromise(this._startWorker(r)),Promise.resolve(this)}destroy(){var e;(e=this._connection)==null||e.close(),this._connection=null}get _workerGeometryType(){var r;const e=(r=this.layer)==null?void 0:r.geometryType;return e?this._geometryTypeRequiresClientGraphicMapping(e)?"polygon":e:null}applyEdits(e){return this.load().then(()=>this._applyEdits(e))}openPorts(){return this.load().then(()=>this._connection.openPorts())}async queryFeatures(e,r={}){await this.load(r);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,r);UJ(e,this.layer.spatialReference,i);const n=zse.fromJSON(i);if(!this._requiresClientGraphicMapping())return n;const s=this.layer.objectIdField;for(const o of n.features){const a=o.attributes[s],l=this._idToClientGraphic.get(a);l&&(o.geometry=l.geometry)}return n.geometryType=this.layer.geometryType,n}async queryFeaturesJSON(e,r={}){if(this._requiresClientGraphicMapping())throw new H("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");await this.load(r);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,r);return UJ(e,this.layer.spatialReference,i),i}queryFeatureCount(e,r={}){return this.load(r).then(()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,r))}queryObjectIds(e,r={}){return this.load(r).then(()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,r))}queryExtent(e,r={}){return this.load(r).then(()=>this._connection.invoke("queryExtent",e?e.toJSON():null,r)).then(i=>({count:i.count,extent:ur.fromJSON(i.extent)}))}querySnapping(e,r={}){return this.load(r).then(()=>this._connection.invoke("querySnapping",e,r))}async _applyEdits(e){if(!this._connection)throw new H("feature-layer-source:edit-failure","Memory source not loaded");const r=this.layer.objectIdField;let i=null;const n=[],s=[];await Promise.all([this._prepareClientMapping(e.addFeatures,null),this._prepareClientMapping(e.updateFeatures,null)]);const o=h=>"objectId"in h&&h.objectId!=null?h.objectId:"attributes"in h&&h.attributes[r]!=null?h.attributes[r]:null;if(e.addFeatures&&(i=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(const h of e.deleteFeatures){const p=o(h);p!=null&&n.push(p)}const a=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures){for(const h of e.updateFeatures)if(s.push(this._serializeFeature(h)),a){const p=o(h);p!=null&&a.set(p,h)}}est(i?i.features:null,s,this.layer.spatialReference);const{fullExtent:l,featureEditResults:c}=await this._connection.invoke("applyEdits",{adds:i?i.features:[],updates:s,deletes:n});return this.fullExtent=l,i&&i.finish(c.uidToObjectId),this._updateClientGraphicIds(a,c),this._createEditsResult(c)}async _prepareClientMapping(e,r){if(this._layerOrSourceGeometryType!=="mesh"||R(e))return;const i=[];for(const{geometry:n}of e)!v(n)||n.type!=="mesh"||n.hasExtent||n.loaded||i.push(n.load({signal:r}));i.length&&await Promise.all(i)}_updateClientGraphicIds(e,r){if(this._idToClientGraphic){if(e)for(const i of r.updateResults){if(!i.success)continue;const n=e.get(i.objectId);n!=null&&this._addIdToClientGraphic(n)}for(const i of r.deleteResults)i.success&&this._idToClientGraphic.delete(i.objectId)}}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const r=e.success===!0?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:r?new H("feature-layer-source:edit-failure",r.description,{code:r.code}):null}}_prepareAddFeatures(e){const r=new Map,i=new Array(e.length);let n=null;for(let o=0;o<e.length;o++){const a=e[o],l=this._serializeFeature(a);!n&&v(a.geometry)&&(n=a.geometry.type),i[o]=l,r.set(`${l.uid}`,a)}const s=this;return{features:i,inferredGeometryType:n,finish(o){const a=s.sourceJSON.objectIdField;for(const l in o){const c=o[l],h=r.get(l);h&&(h.attributes||(h.attributes={}),c===-1?delete h.attributes[a]:h.attributes[a]=c,s._addIdToClientGraphic(h))}}}}_addIdToClientGraphic(e){if(!this._idToClientGraphic)return;const r=this.sourceJSON.objectIdField,i=e.attributes&&e.attributes[r];i!=null&&this._idToClientGraphic.set(i,e)}get _layerOrSourceGeometryType(){var e,r;return((e=this.layer)==null?void 0:e.geometryType)??((r=this.sourceJSON)==null?void 0:r.geometryType)}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this._layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}_geometryTypeRequiresClientGraphicMapping(e){return e==="mesh"||e==="multipatch"||e==="extent"}_serializeFeature(e){const{attributes:r}=e,i=this._geometryForSerialization(e),n=(rst++).toString();return i?{uid:n,geometry:i.toJSON(),attributes:r}:{uid:n,attributes:r}}_geometryForSerialization(e){const{geometry:r}=e;return R(r)?null:this._geometryRequiresClientGraphicMapping(r)?r.extent?Jl.fromExtent(r.extent):null:r}async _startWorker(e){this._connection=await wAe("MemorySourceWorker",{strategy:ue("feature-layers-workers")?"dedicated":"local",signal:e});const{fields:r,spatialReference:i,objectIdField:n,hasM:s,hasZ:o,timeInfo:a}=this.layer,l=this.layer.originOf("spatialReference")==="defaults";await this._prepareClientMapping(this.items,e);const c=this._prepareAddFeatures(this.items);this.handles.add(this.on("before-changes",m=>{EG.error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),m.preventDefault()}));const h={features:c.features,fields:r&&r.map(m=>m.toJSON()),geometryType:Vhe.toJSON(this._workerGeometryType),hasM:this._layerOrSourceGeometryType!=="mesh"&&s,hasZ:this._layerOrSourceGeometryType==="mesh"||o,objectIdField:n,spatialReference:l?null:i&&i.toJSON(),timeInfo:a?a.toJSON():null},p=await this._connection.invoke("load",h,{signal:e});for(const m of p.warnings)EG.warn(m.message,{layer:this.layer,warning:m});p.featureErrors.length&&EG.warn(`Encountered ${p.featureErrors.length} validation errors while loading features`,p.featureErrors);const f=p.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(c.inferredGeometryType)&&(f.geometryType=Vhe.toJSON(c.inferredGeometryType)),this.sourceJSON=f,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),c.finish(p.assignedObjectIds)}};u([ane({Type:Va,ensureType:bs(Va)})],C0.prototype,"itemType",void 0),u([d()],C0.prototype,"type",void 0),u([d({constructOnly:!0})],C0.prototype,"layer",void 0),u([d({readOnly:!0})],C0.prototype,"_workerGeometryType",null),u([d()],C0.prototype,"sourceJSON",void 0),C0=u([$(oMe)],C0);function ist(t){return"portalItem"in t}const nst=t=>{let e=class extends t{get apiKey(){var r;return this._isOverridden("apiKey")?this._get("apiKey"):ist(this)?(r=this.portalItem)==null?void 0:r.apiKey:null}set apiKey(r){r!=null?this._override("apiKey",r):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return u([d({type:String})],e.prototype,"apiKey",null),e=u([$("esri.layers.mixins.APIKeyMixin")],e),e},aMe={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},lMe=Object.values(aMe),cMe=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${lMe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),sst=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${lMe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),ost=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function xBt(t){return!!cMe.test(t)}function aw(t){if(R(t))return null;const e=Uo(t),r=e.path.match(cMe)||e.path.match(sst);if(!r)return null;const[,i,n,s,o]=r,a=n.indexOf("/");return{title:ioe(a!==-1?n.slice(a+1):n),serverType:aMe[s.toLowerCase()],sublayer:o!=null&&o!==""?parseInt(o,10):null,url:{path:i}}}function ast(t){const e=Uo(t).path.match(ost);return e?{serviceUrl:e[1],sublayerId:Number(e[2])}:null}function ioe(t){return(t=t.replace(/\s*[/_]+\s*/g," "))[0].toUpperCase()+t.slice(1)}function lst(t,e){const r=[];if(t){const i=aw(t);v(i)&&i.title&&r.push(i.title)}if(e){const i=ioe(e);r.push(i)}if(r.length===2){if(r[0].toLowerCase().includes(r[1].toLowerCase()))return r[0];if(r[1].toLowerCase().includes(r[0].toLowerCase()))return r[1]}return r.join(" - ")}function uMe(t){if(!t)return!1;const e=".arcgis.com/",r="//services",i="//tiles",n="//features",s=(t=t.toLowerCase()).includes(e),o=t.includes(r)||t.includes(i)||t.includes(n);return s&&o}function cst(t,e){return t&&PCe($Ce(t,e))}function ust(t){let{url:e}=t;if(!e)return{url:e};e=$Ce(e,t.logger);const r=Uo(e),i=aw(r.path);let n;if(v(i))i.sublayer!=null&&t.layer.layerId==null&&(n=i.sublayer),e=i.url.path;else if(t.nonStandardUrlAllowed){const s=ast(r.path);v(s)&&(e=s.serviceUrl,n=s.sublayerId)}return{url:PCe(e),layerId:n}}function hst(t,e,r,i,n){Jb(e,i,"url",n),i.url&&t.layerId!=null&&(i.url=Yb(i.url,r,t.layerId.toString()))}function TBt(t){if(!t)return!1;const e=t.toLowerCase(),r=e.includes("/services/"),i=e.includes("/mapserver/wmsserver"),n=e.includes("/imageserver/wmsserver"),s=e.includes("/wmsserver");return r&&(i||n||s)}function dst(t){var r;if(!t)return!1;const e=(r=new Lb(Fc(t)).authority)==null?void 0:r.toLowerCase();return e==="server.arcgisonline.com"||e==="services.arcgisonline.com"}const pst=t=>{let e=class extends t{get title(){if(this._get("title")&&this.originOf("title")!=="defaults")return this._get("title");if(this.url){const r=aw(this.url);if(v(r)&&r.title)return r.title}return this._get("title")||""}set title(r){this._set("title",r)}set url(r){this._set("url",cst(r,re.getLogger(this.declaredClass)))}};return u([d()],e.prototype,"title",null),u([d({type:String})],e.prototype,"url",null),e=u([$("esri.layers.mixins.ArcGISService")],e),e},wfe={read:{reader:$se},write:{allowNull:!0,writer:Lse}},hMe=t=>{let e=class extends t{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return u([d({type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}})],e.prototype,"blendMode",void 0),u([d({json:{read:!1,write:!1,origins:{"web-map":wfe,"portal-item":wfe}}})],e.prototype,"effect",void 0),e=u([$("esri.layers.mixins.BlendLayer")],e),e},fst=t=>{let e=class extends t{constructor(){super(...arguments),this.customParameters=null}};return u([d({type:Object,json:{write:{overridePolicy:r=>({enabled:!!(r&&Object.keys(r).length>0)})}}})],e.prototype,"customParameters",void 0),e=u([$("esri.layers.mixins.CustomParametersMixin")],e),e},noe=new Sn.EventEmitter,dMe="esri.layers.mixins.EditBusLayer",pMe=Symbol(dMe);function SBt(t){return t!=null&&typeof t=="object"&&pMe in t}const mst=t=>{var e;let r=class extends t{constructor(...i){super(...i),this[e]=!0,this.when().then(()=>{this.own([noe.on("edits",n=>{var h,p,f;const s="layer"in n?n.layer:null,o="layer"in n?(h=n.layer)==null?void 0:h.url:n.serviceUrl,a="layer"in n?(p=n.layer)==null?void 0:p.layerId:n.layerId,l=n.event;if(s===this||o!==this.url)return;if(a!=null&&this.layerId!=null&&a===this.layerId)return void this.emit("edits",se(l));const c=(f=l.editedFeatures)==null?void 0:f.find(({layerId:m})=>m===this.layerId);if(c){const{adds:m,updates:g,deletes:_}=c.editedFeatures,b={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:m?m.map(({attributes:w})=>({objectId:this.objectIdField&&w[this.objectIdField],globalId:this.globalIdField&&w[this.globalIdField]})):[],deletedFeatures:_?_.map(({attributes:w})=>({objectId:this.objectIdField&&w[this.objectIdField],globalId:this.globalIdField&&w[this.globalIdField]})):[],updatedFeatures:g?g.map(({current:{attributes:w}})=>({objectId:this.objectIdField&&w[this.objectIdField],globalId:this.globalIdField&&w[this.globalIdField]})):[],editedFeatures:se(l.editedFeatures),exceededTransferLimit:!1};this.emit("edits",b)}})])},()=>{})}};return e=pMe,r=u([$(dMe)],r),r};var DK;const CG=new mr({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),AG=new mr({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let rg=DK=class extends fe{constructor(t){super(t),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(t={}){const{where:e,geometry:r,spatialRelationship:i,timeExtent:n,objectIds:s,units:o,distance:a}=this;return new gp({geometry:se(r),objectIds:se(s),spatialRelationship:i,timeExtent:se(n),where:e,units:o,distance:a,...t})}clone(){const{where:t,geometry:e,spatialRelationship:r,timeExtent:i,objectIds:n,units:s,distance:o}=this;return new DK({geometry:se(e),objectIds:se(n),spatialRelationship:r,timeExtent:se(i),where:t,units:s,distance:o})}};u([d({type:String,json:{write:!0}})],rg.prototype,"where",void 0),u([d({types:Aw,json:{write:!0}})],rg.prototype,"geometry",void 0),u([d({type:CG.apiValues,json:{name:"spatialRel",read:{reader:CG.read},write:{allowNull:!1,writer:CG.write,overridePolicy(){return{enabled:v(this.geometry)}}}}})],rg.prototype,"spatialRelationship",void 0),u([d({type:Number,json:{write:{overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],rg.prototype,"distance",void 0),u([d({type:[Number],json:{write:!0}})],rg.prototype,"objectIds",void 0),u([d({type:AG.apiValues,json:{read:AG.read,write:{writer:AG.write,overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],rg.prototype,"units",void 0),u([d({type:qc,json:{write:!0}})],rg.prototype,"timeExtent",void 0),rg=DK=u([$("esri.layers.support.FeatureFilter")],rg);const gst=rg;var NK;const xfe={read:{reader:$se},write:{writer:Lse,overridePolicy(){return{allowNull:this.excludedEffect!=null,isRequired:this.excludedEffect==null}}}},Tfe={read:{reader:$se},write:{writer:Lse,overridePolicy(){return{allowNull:this.includedEffect!=null,isRequired:this.includedEffect==null}}}},Sfe={name:"showExcludedLabels",default:!0};let cT=NK=class extends fe{constructor(t){super(t),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(t,e){var i,n;const r=super.write(t,e);if(e!=null&&e.origin){if(r.filter){const s=Object.keys(r.filter);if(s.length>1||s[0]!=="where")return(i=e.messages)==null||i.push(new H("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:e.layer,effect:this})),null}if("showExcludedLabels"in r)return(n=e.messages)==null||n.push(new H("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:e.layer,effect:this})),null}return r}clone(){return new NK({filter:v(this.filter)?this.filter.clone():null,includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};u([d({type:gst,json:{write:{allowNull:!0,writer(t,e,r,i){const n=t==null?void 0:t.write({},i);n&&Object.keys(n).length!==0?ma(r,n,e):ma(r,null,e)}}}})],cT.prototype,"filter",void 0),u([d({json:{write:!0,origins:{"web-map":xfe,"portal-item":xfe}}})],cT.prototype,"includedEffect",void 0),u([d({json:{write:!0,origins:{"web-map":Tfe,"portal-item":Tfe}}})],cT.prototype,"excludedEffect",void 0),u([d({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":Sfe,"portal-item":Sfe}}})],cT.prototype,"excludedLabelsVisible",void 0),cT=NK=u([$("esri.layers.support.FeatureEffect")],cT);const yst=cT,Efe={write:{allowNull:!0}},_st=t=>{let e=class extends t{constructor(){super(...arguments),this.featureEffect=null}};return u([d({type:yst,json:{origins:{"web-map":Efe,"portal-item":Efe}}})],e.prototype,"featureEffect",void 0),e=u([$("esri.layers.mixins.FeatureEffectLayer")],e),e};var QP;const Pz=ja()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),fMe=Pz.jsonValues.slice();PL(fMe,"orthometric");const $$=ja()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let pf=QP=class extends fe{constructor(t){super(t),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(t,e,r){return Pz.write(t,e,r)}readHeightModel(t,e,r){return Pz.read(t)||(r&&r.messages&&r.messages.push(vst(t,{context:r})),null)}readHeightUnit(t,e,r){return $$.read(t)||(r&&r.messages&&r.messages.push(Cfe(t,{context:r})),null)}readHeightUnitService(t,e,r){return F2e(t)||$$.read(t)||(r&&r.messages&&r.messages.push(Cfe(t,{context:r})),null)}readVertCRS(t,e){return e.vertCRS||e.ellipsoid||e.geoid}clone(){return new QP({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(t){return!!t&&(this===t||this.heightModel===t.heightModel&&this.heightUnit===t.heightUnit&&this.vertCRS===t.vertCRS)}static deriveUnitFromSR(t,e){const r=sGe(e);return new QP({heightModel:t.heightModel,heightUnit:r,vertCRS:t.vertCRS})}write(t,e){return e={origin:"web-scene",...e},super.write(t,e)}static fromJSON(t){if(!t)return null;const e=new QP;return e.read(t,{origin:"web-scene"}),e}};function Cfe(t,e){return new Sp("height-unit:unsupported",`Height unit of value '${t}' is not supported`,e)}function vst(t,e){return new Sp("height-model:unsupported",`Height model of value '${t}' is not supported`,e)}u([d({type:Pz.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:fMe,default:"ellipsoidal"}}}})],pf.prototype,"heightModel",void 0),u([De("web-scene","heightModel")],pf.prototype,"writeHeightModel",null),u([Me(["web-scene","service"],"heightModel")],pf.prototype,"readHeightModel",null),u([d({type:$$.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:$$.jsonValues,write:$$.write}}}})],pf.prototype,"heightUnit",void 0),u([Me("web-scene","heightUnit")],pf.prototype,"readHeightUnit",null),u([Me("service","heightUnit")],pf.prototype,"readHeightUnitService",null),u([d({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],pf.prototype,"vertCRS",void 0),u([Me("service","vertCRS",["vertCRS","ellipsoid","geoid"])],pf.prototype,"readVertCRS",null),pf=QP=u([$("esri.geometry.HeightModelInfo")],pf);const E3=pf;function bst(t){if(!t)return t;const{start:e,end:r}=t;return new qc({start:v(e)?MS(e,-e.getTimezoneOffset(),"minutes"):e,end:v(r)?MS(r,-r.getTimezoneOffset(),"minutes"):r})}function wst(t){if(!t)return t;const{start:e,end:r}=t;return new qc({start:v(e)?MS(e,e.getTimezoneOffset(),"minutes"):e,end:v(r)?MS(r,r.getTimezoneOffset(),"minutes"):r})}var FK;let eI=FK=class extends fe{constructor(t){super(t)}async collectRequiredFields(t,e){return Gc(t,e,this.expression)}clone(){return new FK({expression:this.expression,title:this.title})}equals(t){return this.expression===t.expression&&this.title===t.title}};u([d({type:String,json:{write:!0}})],eI.prototype,"expression",void 0),u([d({type:String,json:{write:!0}})],eI.prototype,"title",void 0),eI=FK=u([$("esri.layers.support.FeatureExpressionInfo")],eI);const Afe=eI;function xst(t){return!!t&&OO[t]!=null}function Tst(t){return 1/(OO[t]||1)}function Sst(){const t=Object.keys(OO);return t.sort(),t}const Est=Sst();var kK;const n4=ja()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),Rfe=new mr({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let a0=kK=class extends fe{constructor(t){super(t),this.offset=null}readFeatureExpressionInfo(t,e){return t??(e.featureExpression&&e.featureExpression.value===0?{expression:"0"}:void 0)}writeFeatureExpressionInfo(t,e,r,i){e[r]=t.write({},i),t.expression==="0"&&(e.featureExpression={value:0})}get mode(){const{offset:t,featureExpressionInfo:e}=this;return this._isOverridden("mode")?this._get("mode"):v(t)||e?"relative-to-ground":"on-the-ground"}set mode(t){this._override("mode",t)}set unit(t){this._set("unit",t)}write(t,e){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(t,e):null}clone(){return new kK({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(t){return this.mode===t.mode&&this.offset===t.offset&&this.unit===t.unit&&qBe(this.featureExpressionInfo,t.featureExpressionInfo)}};u([d({type:Afe,json:{write:!0}})],a0.prototype,"featureExpressionInfo",void 0),u([Me("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],a0.prototype,"readFeatureExpressionInfo",null),u([De("featureExpressionInfo",{featureExpressionInfo:{type:Afe},"featureExpression.value":{type:[0]}})],a0.prototype,"writeFeatureExpressionInfo",null),u([d({type:n4.apiValues,nonNullable:!0,json:{type:n4.jsonValues,read:n4.read,write:{writer:n4.write,isRequired:!0}}})],a0.prototype,"mode",null),u([d({type:Number,json:{write:!0}})],a0.prototype,"offset",void 0),u([d({type:Est,json:{type:String,read:Rfe.read,write:Rfe.write}})],a0.prototype,"unit",null),a0=kK=u([$("esri.layers.support.ElevationInfo")],a0);const Cst=a0,Ast={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:!0}},soe={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(t,e)=>!e.disablePopup},write:{enabled:!0,writer(t,e,r){e[r]=!t}}}},ooe={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:!0}},Rst={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:Jb}}},Ost={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:!0}},Mst={value:null,type:Cst,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:!0}};function EBt(t){return{type:t,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const mMe={write:!0,read:!0},UK={type:Number,json:{origins:{"web-document":mMe,"portal-item":{write:!0}}}},Pst={...UK,json:{...UK.json,origins:{"web-document":{...mMe,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(t,e,r)=>r&&r.origin!=="service"||!e.drawingInfo||e.drawingInfo.transparency===void 0?e.layerDefinition&&e.layerDefinition.drawingInfo&&e.layerDefinition.drawingInfo.transparency!==void 0?GL(e.layerDefinition.drawingInfo.transparency):void 0:GL(e.drawingInfo.transparency)}}},CBt={type:qc,readOnly:!0,get(){var a,l;if(!((a=this.layer)!=null&&a.timeInfo))return null;const{datesInUnknownTimezone:t,timeOffset:e,useViewTime:r}=this.layer,i=(l=this.view)==null?void 0:l.timeExtent;let n=this.layer.timeExtent;t&&(n=wst(n));let s=r?i&&n?i.intersection(n):i||n:n;if(!s||s.isEmpty||s.isAllTime)return s;e&&(s=s.offset(-e.value,e.unit)),t&&(s=bst(s));const o=this._get("timeExtent");return s.equals(o)?o:s}},ABt={type:ur,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(t,e)=>{const r=ur.fromJSON(t);return e.spatialReference!=null&&typeof e.spatialReference=="object"&&(r.spatialReference=Je.fromJSON(e.spatialReference)),r}}}},read:!1}},Ist={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},$st={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}},Lst={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}},gMe={json:{write:{ignoreOrigin:!0},origins:{"web-map":{read:!1,write:!1}}}},Ofe=new Map([["AUS Central Standard Time","Australia/Darwin"],["AUS Eastern Standard Time","Australia/Sydney"],["Afghanistan Standard Time","Asia/Kabul"],["Alaskan Standard Time","America/Anchorage"],["Aleutian Standard Time","America/Adak"],["Altai Standard Time","Asia/Barnaul"],["Arab Standard Time","Asia/Riyadh"],["Arabian Standard Time","Asia/Dubai"],["Arabic Standard Time","Asia/Baghdad"],["Argentina Standard Time","America/Buenos_Aires"],["Astrakhan Standard Time","Europe/Astrakhan"],["Atlantic Standard Time","America/Halifax"],["Aus Central W. Standard Time","Australia/Eucla"],["Azerbaijan Standard Time","Asia/Baku"],["Azores Standard Time","Atlantic/Azores"],["Bahia Standard Time","America/Bahia"],["Bangladesh Standard Time","Asia/Dhaka"],["Belarus Standard Time","Europe/Minsk"],["Bougainville Standard Time","Pacific/Bougainville"],["Canada Central Standard Time","America/Regina"],["Cape Verde Standard Time","Atlantic/Cape_Verde"],["Caucasus Standard Time","Asia/Yerevan"],["Cen. Australia Standard Time","Australia/Adelaide"],["Central America Standard Time","America/Guatemala"],["Central Asia Standard Time","Asia/Almaty"],["Central Brazilian Standard Time","America/Cuiaba"],["Central Europe Standard Time","Europe/Budapest"],["Central European Standard Time","Europe/Warsaw"],["Central Pacific Standard Time","Pacific/Guadalcanal"],["Central Standard Time","America/Chicago"],["Central Standard Time (Mexico)","America/Mexico_City"],["Chatham Islands Standard Time","Pacific/Chatham"],["China Standard Time","Asia/Shanghai"],["Cuba Standard Time","America/Havana"],["Dateline Standard Time","Etc/GMT+12"],["E. Africa Standard Time","Africa/Nairobi"],["E. Australia Standard Time","Australia/Brisbane"],["E. Europe Standard Time","Europe/Chisinau"],["E. South America Standard Time","America/Sao_Paulo"],["Easter Island Standard Time","Pacific/Easter"],["Eastern Standard Time","America/New_York"],["Eastern Standard Time (Mexico)","America/Cancun"],["Egypt Standard Time","Africa/Cairo"],["Ekaterinburg Standard Time","Asia/Yekaterinburg"],["FLE Standard Time","Europe/Kiev"],["Fiji Standard Time","Pacific/Fiji"],["GMT Standard Time","Europe/London"],["GTB Standard Time","Europe/Bucharest"],["Georgian Standard Time","Asia/Tbilisi"],["Greenland Standard Time","America/Godthab"],["Greenwich Standard Time","Atlantic/Reykjavik"],["Haiti Standard Time","America/Port-au-Prince"],["Hawaiian Standard Time","Pacific/Honolulu"],["India Standard Time","Asia/Calcutta"],["Iran Standard Time","Asia/Tehran"],["Israel Standard Time","Asia/Jerusalem"],["Jordan Standard Time","Asia/Amman"],["Kaliningrad Standard Time","Europe/Kaliningrad"],["Korea Standard Time","Asia/Seoul"],["Libya Standard Time","Africa/Tripoli"],["Line Islands Standard Time","Pacific/Kiritimati"],["Lord Howe Standard Time","Australia/Lord_Howe"],["Magadan Standard Time","Asia/Magadan"],["Magallanes Standard Time","America/Punta_Arenas"],["Marquesas Standard Time","Pacific/Marquesas"],["Mauritius Standard Time","Indian/Mauritius"],["Middle East Standard Time","Asia/Beirut"],["Montevideo Standard Time","America/Montevideo"],["Morocco Standard Time","Africa/Casablanca"],["Mountain Standard Time","America/Denver"],["Mountain Standard Time (Mexico)","America/Chihuahua"],["Myanmar Standard Time","Asia/Rangoon"],["N. Central Asia Standard Time","Asia/Novosibirsk"],["Namibia Standard Time","Africa/Windhoek"],["Nepal Standard Time","Asia/Katmandu"],["New Zealand Standard Time","Pacific/Auckland"],["Newfoundland Standard Time","America/St_Johns"],["Norfolk Standard Time","Pacific/Norfolk"],["North Asia East Standard Time","Asia/Irkutsk"],["North Asia Standard Time","Asia/Krasnoyarsk"],["North Korea Standard Time","Asia/Pyongyang"],["Omsk Standard Time","Asia/Omsk"],["Pacific SA Standard Time","America/Santiago"],["Pacific Standard Time","America/Los_Angeles"],["Pacific Standard Time (Mexico)","America/Tijuana"],["Pakistan Standard Time","Asia/Karachi"],["Paraguay Standard Time","America/Asuncion"],["Qyzylorda Standard Time","Asia/Qyzylorda"],["Romance Standard Time","Europe/Paris"],["Russia Time Zone 10","Asia/Srednekolymsk"],["Russia Time Zone 11","Asia/Kamchatka"],["Russia Time Zone 3","Europe/Samara"],["Russian Standard Time","Europe/Moscow"],["SA Eastern Standard Time","America/Cayenne"],["SA Pacific Standard Time","America/Bogota"],["SA Western Standard Time","America/La_Paz"],["SE Asia Standard Time","Asia/Bangkok"],["Saint Pierre Standard Time","America/Miquelon"],["Sakhalin Standard Time","Asia/Sakhalin"],["Samoa Standard Time","Pacific/Apia"],["Sao Tome Standard Time","Africa/Sao_Tome"],["Saratov Standard Time","Europe/Saratov"],["Singapore Standard Time","Asia/Singapore"],["South Africa Standard Time","Africa/Johannesburg"],["South Sudan Standard Time","Africa/Juba"],["Sri Lanka Standard Time","Asia/Colombo"],["Sudan Standard Time","Africa/Khartoum"],["Syria Standard Time","Asia/Damascus"],["Taipei Standard Time","Asia/Taipei"],["Tasmania Standard Time","Australia/Hobart"],["Tocantins Standard Time","America/Araguaina"],["Tokyo Standard Time","Asia/Tokyo"],["Tomsk Standard Time","Asia/Tomsk"],["Tonga Standard Time","Pacific/Tongatapu"],["Transbaikal Standard Time","Asia/Chita"],["Turkey Standard Time","Europe/Istanbul"],["Turks And Caicos Standard Time","America/Grand_Turk"],["US Eastern Standard Time","America/Indianapolis"],["US Mountain Standard Time","America/Phoenix"],["UTC","Etc/GMT"],["UTC+01","Etc/GMT-1"],["UTC+02","Etc/GMT-2"],["UTC+03","Etc/GMT-3"],["UTC+04","Etc/GMT-4"],["UTC+05","Etc/GMT-5"],["UTC+06","Etc/GMT-6"],["UTC+07","Etc/GMT-7"],["UTC+08","Etc/GMT-8"],["UTC+09","Etc/GMT-9"],["UTC+10","Etc/GMT-10"],["UTC+11","Etc/GMT-11"],["UTC+12","Etc/GMT-12"],["UTC+13","Etc/GMT-13"],["UTC+14","Etc/GMT-14"],["UTC-01","Etc/GMT+1"],["UTC-02","Etc/GMT+2"],["UTC-03","Etc/GMT+3"],["UTC-04","Etc/GMT+4"],["UTC-05","Etc/GMT+5"],["UTC-06","Etc/GMT+6"],["UTC-07","Etc/GMT+7"],["UTC-08","Etc/GMT+8"],["UTC-09","Etc/GMT+9"],["UTC-10","Etc/GMT+10"],["UTC-11","Etc/GMT+11"],["UTC-12","Etc/GMT+12"],["Ulaanbaatar Standard Time","Asia/Ulaanbaatar"],["Venezuela Standard Time","America/Caracas"],["Vladivostok Standard Time","Asia/Vladivostok"],["Volgograd Standard Time","Europe/Volgograd"],["W. Australia Standard Time","Australia/Perth"],["W. Central Africa Standard Time","Africa/Lagos"],["W. Europe Standard Time","Europe/Berlin"],["W. Mongolia Standard Time","Asia/Hovd"],["West Asia Standard Time","Asia/Tashkent"],["West Bank Standard Time","Asia/Hebron"],["West Pacific Standard Time","Pacific/Port_Moresby"],["Yakutsk Standard Time","Asia/Yakutsk"],["Yukon Standard Time","America/Whitehorse"]]);class B2 extends Error{}class Dst extends B2{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class Nst extends B2{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class Fst extends B2{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class tI extends B2{}class yMe extends B2{constructor(e){super(`Invalid unit ${e}`)}}class Qd extends B2{}class dv extends B2{constructor(){super("Zone is an abstract class")}}const nt="numeric",fm="short",Jh="long",Iz={year:nt,month:nt,day:nt},_Me={year:nt,month:fm,day:nt},kst={year:nt,month:fm,day:nt,weekday:fm},vMe={year:nt,month:Jh,day:nt},bMe={year:nt,month:Jh,day:nt,weekday:Jh},wMe={hour:nt,minute:nt},xMe={hour:nt,minute:nt,second:nt},TMe={hour:nt,minute:nt,second:nt,timeZoneName:fm},SMe={hour:nt,minute:nt,second:nt,timeZoneName:Jh},EMe={hour:nt,minute:nt,hourCycle:"h23"},CMe={hour:nt,minute:nt,second:nt,hourCycle:"h23"},AMe={hour:nt,minute:nt,second:nt,hourCycle:"h23",timeZoneName:fm},RMe={hour:nt,minute:nt,second:nt,hourCycle:"h23",timeZoneName:Jh},OMe={year:nt,month:nt,day:nt,hour:nt,minute:nt},MMe={year:nt,month:nt,day:nt,hour:nt,minute:nt,second:nt},PMe={year:nt,month:fm,day:nt,hour:nt,minute:nt},IMe={year:nt,month:fm,day:nt,hour:nt,minute:nt,second:nt},Ust={year:nt,month:fm,day:nt,weekday:fm,hour:nt,minute:nt},$Me={year:nt,month:Jh,day:nt,hour:nt,minute:nt,timeZoneName:fm},LMe={year:nt,month:Jh,day:nt,hour:nt,minute:nt,second:nt,timeZoneName:fm},DMe={year:nt,month:Jh,day:nt,weekday:Jh,hour:nt,minute:nt,timeZoneName:Jh},NMe={year:nt,month:Jh,day:nt,weekday:Jh,hour:nt,minute:nt,second:nt,timeZoneName:Jh};class $N{get type(){throw new dv}get name(){throw new dv}get ianaName(){return this.name}get isUniversal(){throw new dv}offsetName(e,r){throw new dv}formatOffset(e,r){throw new dv}offset(e){throw new dv}equals(e){throw new dv}get isValid(){throw new dv}}let RG=null;class wB extends $N{static get instance(){return RG===null&&(RG=new wB),RG}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:r,locale:i}){return kMe(e,r,i)}formatOffset(e,r){return D$(this.offset(e),r)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}}let J6={};function zst(t){return J6[t]||(J6[t]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),J6[t]}const Vst={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function Bst(t,e){const r=t.format(e).replace(/\u200E/g,""),i=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(r),[,n,s,o,a,l,c,h]=i;return[o,n,s,a,l,c,h]}function jst(t,e){const r=t.formatToParts(e),i=[];for(let n=0;n<r.length;n++){const{type:s,value:o}=r[n],a=Vst[s];s==="era"?i[a]=o:Ti(a)||(i[a]=parseInt(o,10))}return i}let s4={};class T_ extends $N{static create(e){return s4[e]||(s4[e]=new T_(e)),s4[e]}static resetCache(){s4={},J6={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch{return!1}}constructor(e){super(),this.zoneName=e,this.valid=T_.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:r,locale:i}){return kMe(e,r,i,this.name)}formatOffset(e,r){return D$(this.offset(e),r)}offset(e){const r=new Date(e);if(isNaN(r))return NaN;const i=zst(this.name);let[n,s,o,a,l,c,h]=i.formatToParts?jst(i,r):Bst(i,r);a==="BC"&&(n=-Math.abs(n)+1);const f=coe({year:n,month:s,day:o,hour:l===24?0:l,minute:c,second:h,millisecond:0});let m=+r;const g=m%1e3;return m-=g>=0?g:1e3+g,(f-m)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}}let Mfe={};function Gst(t,e={}){const r=JSON.stringify([t,e]);let i=Mfe[r];return i||(i=new Intl.ListFormat(t,e),Mfe[r]=i),i}let zK={};function VK(t,e={}){const r=JSON.stringify([t,e]);let i=zK[r];return i||(i=new Intl.DateTimeFormat(t,e),zK[r]=i),i}let BK={};function Hst(t,e={}){const r=JSON.stringify([t,e]);let i=BK[r];return i||(i=new Intl.NumberFormat(t,e),BK[r]=i),i}let jK={};function qst(t,e={}){const{base:r,...i}=e,n=JSON.stringify([t,i]);let s=jK[n];return s||(s=new Intl.RelativeTimeFormat(t,e),jK[n]=s),s}let rI=null;function Wst(){return rI||(rI=new Intl.DateTimeFormat().resolvedOptions().locale,rI)}function Xst(t){const e=t.indexOf("-x-");e!==-1&&(t=t.substring(0,e));const r=t.indexOf("-u-");if(r===-1)return[t];{let i,n;try{i=VK(t).resolvedOptions(),n=t}catch{const l=t.substring(0,r);i=VK(l).resolvedOptions(),n=l}const{numberingSystem:s,calendar:o}=i;return[n,s,o]}}function Yst(t,e,r){return(r||e)&&(t.includes("-u-")||(t+="-u"),r&&(t+=`-ca-${r}`),e&&(t+=`-nu-${e}`)),t}function Zst(t){const e=[];for(let r=1;r<=12;r++){const i=$r.utc(2016,r,1);e.push(t(i))}return e}function Jst(t){const e=[];for(let r=1;r<=7;r++){const i=$r.utc(2016,11,13+r);e.push(t(i))}return e}function o4(t,e,r,i,n){const s=t.listingMode(r);return s==="error"?null:s==="en"?i(e):n(e)}function Kst(t){return t.numberingSystem&&t.numberingSystem!=="latn"?!1:t.numberingSystem==="latn"||!t.locale||t.locale.startsWith("en")||new Intl.DateTimeFormat(t.intl).resolvedOptions().numberingSystem==="latn"}class Qst{constructor(e,r,i){this.padTo=i.padTo||0,this.floor=i.floor||!1;const{padTo:n,floor:s,...o}=i;if(!r||Object.keys(o).length>0){const a={useGrouping:!1,...i};i.padTo>0&&(a.minimumIntegerDigits=i.padTo),this.inf=Hst(e,a)}}format(e){if(this.inf){const r=this.floor?Math.floor(e):e;return this.inf.format(r)}else{const r=this.floor?Math.floor(e):loe(e,3);return Po(r,this.padTo)}}}class eot{constructor(e,r,i){this.opts=i;let n;if(e.zone.isUniversal){const o=-1*(e.offset/60),a=o>=0?`Etc/GMT+${o}`:`Etc/GMT${o}`;e.offset!==0&&T_.create(a).valid?(n=a,this.dt=e):(n="UTC",i.timeZoneName?this.dt=e:this.dt=e.offset===0?e:$r.fromMillis(e.ts+e.offset*60*1e3))}else e.zone.type==="system"?this.dt=e:(this.dt=e,n=e.zone.name);const s={...this.opts};s.timeZone=s.timeZone||n,this.dtf=VK(r,s)}format(){return this.dtf.format(this.dt.toJSDate())}formatToParts(){return this.dtf.formatToParts(this.dt.toJSDate())}resolvedOptions(){return this.dtf.resolvedOptions()}}class tot{constructor(e,r,i){this.opts={style:"long",...i},!r&&FMe()&&(this.rtf=qst(e,i))}format(e,r){return this.rtf?this.rtf.format(e,r):_ot(r,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,r){return this.rtf?this.rtf.formatToParts(e,r):[]}}class os{static fromOpts(e){return os.create(e.locale,e.numberingSystem,e.outputCalendar,e.defaultToEN)}static create(e,r,i,n=!1){const s=e||Oo.defaultLocale,o=s||(n?"en-US":Wst()),a=r||Oo.defaultNumberingSystem,l=i||Oo.defaultOutputCalendar;return new os(o,a,l,s)}static resetCache(){rI=null,zK={},BK={},jK={}}static fromObject({locale:e,numberingSystem:r,outputCalendar:i}={}){return os.create(e,r,i)}constructor(e,r,i,n){const[s,o,a]=Xst(e);this.locale=s,this.numberingSystem=r||o||null,this.outputCalendar=i||a||null,this.intl=Yst(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=n,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=Kst(this)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),r=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&r?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:os.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,r=!1,i=!0){return o4(this,e,i,VMe,()=>{const n=r?{month:e,day:"numeric"}:{month:e},s=r?"format":"standalone";return this.monthsCache[s][e]||(this.monthsCache[s][e]=Zst(o=>this.extract(o,n,"month"))),this.monthsCache[s][e]})}weekdays(e,r=!1,i=!0){return o4(this,e,i,GMe,()=>{const n=r?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},s=r?"format":"standalone";return this.weekdaysCache[s][e]||(this.weekdaysCache[s][e]=Jst(o=>this.extract(o,n,"weekday"))),this.weekdaysCache[s][e]})}meridiems(e=!0){return o4(this,void 0,e,()=>HMe,()=>{if(!this.meridiemCache){const r={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[$r.utc(2016,11,13,9),$r.utc(2016,11,13,19)].map(i=>this.extract(i,r,"dayperiod"))}return this.meridiemCache})}eras(e,r=!0){return o4(this,e,r,qMe,()=>{const i={era:e};return this.eraCache[e]||(this.eraCache[e]=[$r.utc(-40,1,1),$r.utc(2017,1,1)].map(n=>this.extract(n,i,"era"))),this.eraCache[e]})}extract(e,r,i){const n=this.dtFormatter(e,r),s=n.formatToParts(),o=s.find(a=>a.type.toLowerCase()===i);return o?o.value:null}numberFormatter(e={}){return new Qst(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,r={}){return new eot(e,this.intl,r)}relFormatter(e={}){return new tot(this.intl,this.isEnglish(),e)}listFormatter(e={}){return Gst(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}}let OG=null;class ql extends $N{static get utcInstance(){return OG===null&&(OG=new ql(0)),OG}static instance(e){return e===0?ql.utcInstance:new ql(e)}static parseSpecifier(e){if(e){const r=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(r)return new ql(TB(r[1],r[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${D$(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${D$(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,r){return D$(this.fixed,r)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}}class rot extends $N{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function q1(t,e){if(Ti(t)||t===null)return e;if(t instanceof $N)return t;if(iot(t)){const r=t.toLowerCase();return r==="default"?e:r==="local"||r==="system"?wB.instance:r==="utc"||r==="gmt"?ql.utcInstance:ql.parseSpecifier(r)||T_.create(t)}else return PS(t)?ql.instance(t):typeof t=="object"&&t.offset&&typeof t.offset=="number"?t:new rot(t)}let Pfe=()=>Date.now(),Ife="system",$fe=null,Lfe=null,Dfe=null,Nfe=60,Ffe;class Oo{static get now(){return Pfe}static set now(e){Pfe=e}static set defaultZone(e){Ife=e}static get defaultZone(){return q1(Ife,wB.instance)}static get defaultLocale(){return $fe}static set defaultLocale(e){$fe=e}static get defaultNumberingSystem(){return Lfe}static set defaultNumberingSystem(e){Lfe=e}static get defaultOutputCalendar(){return Dfe}static set defaultOutputCalendar(e){Dfe=e}static get twoDigitCutoffYear(){return Nfe}static set twoDigitCutoffYear(e){Nfe=e%100}static get throwOnInvalid(){return Ffe}static set throwOnInvalid(e){Ffe=e}static resetCaches(){os.resetCache(),T_.resetCache()}}function Ti(t){return typeof t>"u"}function PS(t){return typeof t=="number"}function xB(t){return typeof t=="number"&&t%1===0}function iot(t){return typeof t=="string"}function not(t){return Object.prototype.toString.call(t)==="[object Date]"}function FMe(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function sot(t){return Array.isArray(t)?t:[t]}function kfe(t,e,r){if(t.length!==0)return t.reduce((i,n)=>{const s=[e(n),n];return i&&r(i[0],s[0])===i[0]?i:s},null)[1]}function oot(t,e){return e.reduce((r,i)=>(r[i]=t[i],r),{})}function IO(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function G0(t,e,r){return xB(t)&&t>=e&&t<=r}function aot(t,e){return t-e*Math.floor(t/e)}function Po(t,e=2){const r=t<0;let i;return r?i="-"+(""+-t).padStart(e,"0"):i=(""+t).padStart(e,"0"),i}function D1(t){if(!(Ti(t)||t===null||t===""))return parseInt(t,10)}function Hw(t){if(!(Ti(t)||t===null||t===""))return parseFloat(t)}function aoe(t){if(!(Ti(t)||t===null||t==="")){const e=parseFloat("0."+t)*1e3;return Math.floor(e)}}function loe(t,e,r=!1){const i=10**e;return(r?Math.trunc:Math.round)(t*i)/i}function LN(t){return t%4===0&&(t%100!==0||t%400===0)}function L$(t){return LN(t)?366:365}function $z(t,e){const r=aot(e-1,12)+1,i=t+(e-r)/12;return r===2?LN(i)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][r-1]}function coe(t){let e=Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,t.second,t.millisecond);return t.year<100&&t.year>=0&&(e=new Date(e),e.setUTCFullYear(e.getUTCFullYear()-1900)),+e}function Lz(t){const e=(t+Math.floor(t/4)-Math.floor(t/100)+Math.floor(t/400))%7,r=t-1,i=(r+Math.floor(r/4)-Math.floor(r/100)+Math.floor(r/400))%7;return e===4||i===3?53:52}function GK(t){return t>99?t:t>Oo.twoDigitCutoffYear?1900+t:2e3+t}function kMe(t,e,r,i=null){const n=new Date(t),s={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};i&&(s.timeZone=i);const o={timeZoneName:e,...s},a=new Intl.DateTimeFormat(r,o).formatToParts(n).find(l=>l.type.toLowerCase()==="timezonename");return a?a.value:null}function TB(t,e){let r=parseInt(t,10);Number.isNaN(r)&&(r=0);const i=parseInt(e,10)||0,n=r<0||Object.is(r,-0)?-i:i;return r*60+n}function UMe(t){const e=Number(t);if(typeof t=="boolean"||t===""||Number.isNaN(e))throw new Qd(`Invalid unit value ${t}`);return e}function Dz(t,e){const r={};for(const i in t)if(IO(t,i)){const n=t[i];if(n==null)continue;r[e(i)]=UMe(n)}return r}function D$(t,e){const r=Math.trunc(Math.abs(t/60)),i=Math.trunc(Math.abs(t%60)),n=t>=0?"+":"-";switch(e){case"short":return`${n}${Po(r,2)}:${Po(i,2)}`;case"narrow":return`${n}${r}${i>0?`:${i}`:""}`;case"techie":return`${n}${Po(r,2)}${Po(i,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function SB(t){return oot(t,["hour","minute","second","millisecond"])}const lot=["January","February","March","April","May","June","July","August","September","October","November","December"],zMe=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],cot=["J","F","M","A","M","J","J","A","S","O","N","D"];function VMe(t){switch(t){case"narrow":return[...cot];case"short":return[...zMe];case"long":return[...lot];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const BMe=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],jMe=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],uot=["M","T","W","T","F","S","S"];function GMe(t){switch(t){case"narrow":return[...uot];case"short":return[...jMe];case"long":return[...BMe];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const HMe=["AM","PM"],hot=["Before Christ","Anno Domini"],dot=["BC","AD"],pot=["B","A"];function qMe(t){switch(t){case"narrow":return[...pot];case"short":return[...dot];case"long":return[...hot];default:return null}}function fot(t){return HMe[t.hour<12?0:1]}function mot(t,e){return GMe(e)[t.weekday-1]}function got(t,e){return VMe(e)[t.month-1]}function yot(t,e){return qMe(e)[t.year<0?0:1]}function _ot(t,e,r="always",i=!1){const n={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},s=["hours","minutes","seconds"].indexOf(t)===-1;if(r==="auto"&&s){const p=t==="days";switch(e){case 1:return p?"tomorrow":`next ${n[t][0]}`;case-1:return p?"yesterday":`last ${n[t][0]}`;case 0:return p?"today":`this ${n[t][0]}`}}const o=Object.is(e,-0)||e<0,a=Math.abs(e),l=a===1,c=n[t],h=i?l?c[1]:c[2]||c[1]:l?n[t][0]:t;return o?`${a} ${h} ago`:`in ${a} ${h}`}function Ufe(t,e){let r="";for(const i of t)i.literal?r+=i.val:r+=e(i.val);return r}const vot={D:Iz,DD:_Me,DDD:vMe,DDDD:bMe,t:wMe,tt:xMe,ttt:TMe,tttt:SMe,T:EMe,TT:CMe,TTT:AMe,TTTT:RMe,f:OMe,ff:PMe,fff:$Me,ffff:DMe,F:MMe,FF:IMe,FFF:LMe,FFFF:NMe};class Bl{static create(e,r={}){return new Bl(e,r)}static parseFormat(e){let r=null,i="",n=!1;const s=[];for(let o=0;o<e.length;o++){const a=e.charAt(o);a==="'"?(i.length>0&&s.push({literal:n,val:i}),r=null,i="",n=!n):n||a===r?i+=a:(i.length>0&&s.push({literal:!1,val:i}),i=a,r=a)}return i.length>0&&s.push({literal:n,val:i}),s}static macroTokenToFormatOpts(e){return vot[e]}constructor(e,r){this.opts=r,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,r){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...r}).format()}formatDateTime(e,r={}){return this.loc.dtFormatter(e,{...this.opts,...r}).format()}formatDateTimeParts(e,r={}){return this.loc.dtFormatter(e,{...this.opts,...r}).formatToParts()}formatInterval(e,r={}){return this.loc.dtFormatter(e.start,{...this.opts,...r}).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,r={}){return this.loc.dtFormatter(e,{...this.opts,...r}).resolvedOptions()}num(e,r=0){if(this.opts.forceSimple)return Po(e,r);const i={...this.opts};return r>0&&(i.padTo=r),this.loc.numberFormatter(i).format(e)}formatDateTimeFromString(e,r){const i=this.loc.listingMode()==="en",n=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",s=(m,g)=>this.loc.extract(e,m,g),o=m=>e.isOffsetFixed&&e.offset===0&&m.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,m.format):"",a=()=>i?fot(e):s({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(m,g)=>i?got(e,m):s(g?{month:m}:{month:m,day:"numeric"},"month"),c=(m,g)=>i?mot(e,m):s(g?{weekday:m}:{weekday:m,month:"long",day:"numeric"},"weekday"),h=m=>{const g=Bl.macroTokenToFormatOpts(m);return g?this.formatWithSystemDefault(e,g):m},p=m=>i?yot(e,m):s({era:m},"era"),f=m=>{switch(m){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return o({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return o({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return o({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return a();case"d":return n?s({day:"numeric"},"day"):this.num(e.day);case"dd":return n?s({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return n?s({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return n?s({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return n?s({month:"numeric"},"month"):this.num(e.month);case"MM":return n?s({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return n?s({year:"numeric"},"year"):this.num(e.year);case"yy":return n?s({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return n?s({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return n?s({year:"numeric"},"year"):this.num(e.year,6);case"G":return p("short");case"GG":return p("long");case"GGGGG":return p("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return h(m)}};return Ufe(Bl.parseFormat(r),f)}formatDurationFromString(e,r){const i=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},n=l=>c=>{const h=i(c);return h?this.num(l.get(h),c.length):c},s=Bl.parseFormat(r),o=s.reduce((l,{literal:c,val:h})=>c?l:l.concat(h),[]),a=e.shiftTo(...o.map(i).filter(l=>l));return Ufe(s,n(a))}}class qf{constructor(e,r){this.reason=e,this.explanation=r}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const WMe=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function C3(...t){const e=t.reduce((r,i)=>r+i.source,"");return RegExp(`^${e}$`)}function A3(...t){return e=>t.reduce(([r,i,n],s)=>{const[o,a,l]=s(e,n);return[{...r,...o},a||i,l]},[{},null,1]).slice(0,2)}function R3(t,...e){if(t==null)return[null,null];for(const[r,i]of e){const n=r.exec(t);if(n)return i(n)}return[null,null]}function XMe(...t){return(e,r)=>{const i={};let n;for(n=0;n<t.length;n++)i[t[n]]=D1(e[r+n]);return[i,null,r+n]}}const YMe=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,bot=`(?:${YMe.source}?(?:\\[(${WMe.source})\\])?)?`,uoe=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,ZMe=RegExp(`${uoe.source}${bot}`),hoe=RegExp(`(?:T${ZMe.source})?`),wot=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,xot=/(\d{4})-?W(\d\d)(?:-?(\d))?/,Tot=/(\d{4})-?(\d{3})/,Sot=XMe("weekYear","weekNumber","weekDay"),Eot=XMe("year","ordinal"),Cot=/(\d{4})-(\d\d)-(\d\d)/,JMe=RegExp(`${uoe.source} ?(?:${YMe.source}|(${WMe.source}))?`),Aot=RegExp(`(?: ${JMe.source})?`);function PR(t,e,r){const i=t[e];return Ti(i)?r:D1(i)}function Rot(t,e){return[{year:PR(t,e),month:PR(t,e+1,1),day:PR(t,e+2,1)},null,e+3]}function O3(t,e){return[{hours:PR(t,e,0),minutes:PR(t,e+1,0),seconds:PR(t,e+2,0),milliseconds:aoe(t[e+3])},null,e+4]}function DN(t,e){const r=!t[e]&&!t[e+1],i=TB(t[e+1],t[e+2]),n=r?null:ql.instance(i);return[{},n,e+3]}function NN(t,e){const r=t[e]?T_.create(t[e]):null;return[{},r,e+1]}const Oot=RegExp(`^T?${uoe.source}$`),Mot=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function Pot(t){const[e,r,i,n,s,o,a,l,c]=t,h=e[0]==="-",p=l&&l[0]==="-",f=(m,g=!1)=>m!==void 0&&(g||m&&h)?-m:m;return[{years:f(Hw(r)),months:f(Hw(i)),weeks:f(Hw(n)),days:f(Hw(s)),hours:f(Hw(o)),minutes:f(Hw(a)),seconds:f(Hw(l),l==="-0"),milliseconds:f(aoe(c),p)}]}const Iot={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function doe(t,e,r,i,n,s,o){const a={year:e.length===2?GK(D1(e)):D1(e),month:zMe.indexOf(r)+1,day:D1(i),hour:D1(n),minute:D1(s)};return o&&(a.second=D1(o)),t&&(a.weekday=t.length>3?BMe.indexOf(t)+1:jMe.indexOf(t)+1),a}const $ot=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function Lot(t){const[,e,r,i,n,s,o,a,l,c,h,p]=t,f=doe(e,n,i,r,s,o,a);let m;return l?m=Iot[l]:c?m=0:m=TB(h,p),[f,new ql(m)]}function Dot(t){return t.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const Not=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,Fot=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,kot=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function zfe(t){const[,e,r,i,n,s,o,a]=t;return[doe(e,n,i,r,s,o,a),ql.utcInstance]}function Uot(t){const[,e,r,i,n,s,o,a]=t;return[doe(e,a,r,i,n,s,o),ql.utcInstance]}const zot=C3(wot,hoe),Vot=C3(xot,hoe),Bot=C3(Tot,hoe),jot=C3(ZMe),KMe=A3(Rot,O3,DN,NN),Got=A3(Sot,O3,DN,NN),Hot=A3(Eot,O3,DN,NN),qot=A3(O3,DN,NN);function Wot(t){return R3(t,[zot,KMe],[Vot,Got],[Bot,Hot],[jot,qot])}function Xot(t){return R3(Dot(t),[$ot,Lot])}function Yot(t){return R3(t,[Not,zfe],[Fot,zfe],[kot,Uot])}function Zot(t){return R3(t,[Mot,Pot])}const Jot=A3(O3);function Kot(t){return R3(t,[Oot,Jot])}const Qot=C3(Cot,Aot),eat=C3(JMe),tat=A3(O3,DN,NN);function rat(t){return R3(t,[Qot,KMe],[eat,tat])}const iat="Invalid Duration",QMe={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},nat={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...QMe},pd=146097/400,eE=146097/4800,sat={years:{quarters:4,months:12,weeks:pd/7,days:pd,hours:pd*24,minutes:pd*24*60,seconds:pd*24*60*60,milliseconds:pd*24*60*60*1e3},quarters:{months:3,weeks:pd/28,days:pd/4,hours:pd*24/4,minutes:pd*24*60/4,seconds:pd*24*60*60/4,milliseconds:pd*24*60*60*1e3/4},months:{weeks:eE/7,days:eE,hours:eE*24,minutes:eE*24*60,seconds:eE*24*60*60,milliseconds:eE*24*60*60*1e3},...QMe},uT=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],oat=uT.slice(0).reverse();function pv(t,e,r=!1){const i={values:r?e.values:{...t.values,...e.values||{}},loc:t.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||t.conversionAccuracy,matrix:e.matrix||t.matrix};return new Ci(i)}function aat(t){return t<0?Math.floor(t):Math.ceil(t)}function ePe(t,e,r,i,n){const s=t[n][r],o=e[r]/s,a=Math.sign(o)===Math.sign(i[n]),l=!a&&i[n]!==0&&Math.abs(o)<=1?aat(o):Math.trunc(o);i[n]+=l,e[r]-=l*s}function lat(t,e){oat.reduce((r,i)=>Ti(e[i])?r:(r&&ePe(t,e,r,e,i),i),null)}function cat(t){const e={};for(const[r,i]of Object.entries(t))i!==0&&(e[r]=i);return e}class Ci{constructor(e){const r=e.conversionAccuracy==="longterm"||!1;let i=r?sat:nat;e.matrix&&(i=e.matrix),this.values=e.values,this.loc=e.loc||os.create(),this.conversionAccuracy=r?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=i,this.isLuxonDuration=!0}static fromMillis(e,r){return Ci.fromObject({milliseconds:e},r)}static fromObject(e,r={}){if(e==null||typeof e!="object")throw new Qd(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new Ci({values:Dz(e,Ci.normalizeUnit),loc:os.fromObject(r),conversionAccuracy:r.conversionAccuracy,matrix:r.matrix})}static fromDurationLike(e){if(PS(e))return Ci.fromMillis(e);if(Ci.isDuration(e))return e;if(typeof e=="object")return Ci.fromObject(e);throw new Qd(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,r){const[i]=Zot(e);return i?Ci.fromObject(i,r):Ci.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,r){const[i]=Kot(e);return i?Ci.fromObject(i,r):Ci.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,r=null){if(!e)throw new Qd("need to specify a reason the Duration is invalid");const i=e instanceof qf?e:new qf(e,r);if(Oo.throwOnInvalid)throw new Fst(i);return new Ci({invalid:i})}static normalizeUnit(e){const r={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!r)throw new yMe(e);return r}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,r={}){const i={...r,floor:r.round!==!1&&r.floor!==!1};return this.isValid?Bl.create(this.loc,i).formatDurationFromString(this,e):iat}toHuman(e={}){const r=uT.map(i=>{const n=this.values[i];return Ti(n)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:i.slice(0,-1)}).format(n)}).filter(i=>i);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(r)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=loe(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const r=this.toMillis();if(r<0||r>=864e5)return null;e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e};const i=this.shiftTo("hours","minutes","seconds","milliseconds");let n=e.format==="basic"?"hhmm":"hh:mm";(!e.suppressSeconds||i.seconds!==0||i.milliseconds!==0)&&(n+=e.format==="basic"?"ss":":ss",(!e.suppressMilliseconds||i.milliseconds!==0)&&(n+=".SSS"));let s=i.toFormat(n);return e.includePrefix&&(s="T"+s),s}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.as("milliseconds")}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const r=Ci.fromDurationLike(e),i={};for(const n of uT)(IO(r.values,n)||IO(this.values,n))&&(i[n]=r.get(n)+this.get(n));return pv(this,{values:i},!0)}minus(e){if(!this.isValid)return this;const r=Ci.fromDurationLike(e);return this.plus(r.negate())}mapUnits(e){if(!this.isValid)return this;const r={};for(const i of Object.keys(this.values))r[i]=UMe(e(this.values[i],i));return pv(this,{values:r},!0)}get(e){return this[Ci.normalizeUnit(e)]}set(e){if(!this.isValid)return this;const r={...this.values,...Dz(e,Ci.normalizeUnit)};return pv(this,{values:r})}reconfigure({locale:e,numberingSystem:r,conversionAccuracy:i,matrix:n}={}){const o={loc:this.loc.clone({locale:e,numberingSystem:r}),matrix:n,conversionAccuracy:i};return pv(this,o)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return lat(this.matrix,e),pv(this,{values:e},!0)}rescale(){if(!this.isValid)return this;const e=cat(this.normalize().shiftToAll().toObject());return pv(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(o=>Ci.normalizeUnit(o));const r={},i={},n=this.toObject();let s;for(const o of uT)if(e.indexOf(o)>=0){s=o;let a=0;for(const c in i)a+=this.matrix[c][o]*i[c],i[c]=0;PS(n[o])&&(a+=n[o]);const l=Math.trunc(a);r[o]=l,i[o]=(a*1e3-l*1e3)/1e3;for(const c in n)uT.indexOf(c)>uT.indexOf(o)&&ePe(this.matrix,n,c,r,o)}else PS(n[o])&&(i[o]=n[o]);for(const o in i)i[o]!==0&&(r[s]+=o===s?i[o]:i[o]/this.matrix[s][o]);return pv(this,{values:r},!0).normalize()}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const r of Object.keys(this.values))e[r]=this.values[r]===0?0:-this.values[r];return pv(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function r(i,n){return i===void 0||i===0?n===void 0||n===0:i===n}for(const i of uT)if(!r(this.values[i],e.values[i]))return!1;return!0}}const tE="Invalid Interval";function uat(t,e){return!t||!t.isValid?ks.invalid("missing or invalid start"):!e||!e.isValid?ks.invalid("missing or invalid end"):e<t?ks.invalid("end before start",`The end of an interval must be after its start, but you had start=${t.toISO()} and end=${e.toISO()}`):null}class ks{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,r=null){if(!e)throw new Qd("need to specify a reason the Interval is invalid");const i=e instanceof qf?e:new qf(e,r);if(Oo.throwOnInvalid)throw new Nst(i);return new ks({invalid:i})}static fromDateTimes(e,r){const i=vM(e),n=vM(r),s=uat(i,n);return s??new ks({start:i,end:n})}static after(e,r){const i=Ci.fromDurationLike(r),n=vM(e);return ks.fromDateTimes(n,n.plus(i))}static before(e,r){const i=Ci.fromDurationLike(r),n=vM(e);return ks.fromDateTimes(n.minus(i),n)}static fromISO(e,r){const[i,n]=(e||"").split("/",2);if(i&&n){let s,o;try{s=$r.fromISO(i,r),o=s.isValid}catch{o=!1}let a,l;try{a=$r.fromISO(n,r),l=a.isValid}catch{l=!1}if(o&&l)return ks.fromDateTimes(s,a);if(o){const c=Ci.fromISO(n,r);if(c.isValid)return ks.after(s,c)}else if(l){const c=Ci.fromISO(i,r);if(c.isValid)return ks.before(a,c)}}return ks.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds"){if(!this.isValid)return NaN;const r=this.start.startOf(e),i=this.end.startOf(e);return Math.floor(i.diff(r,e).get(e))+1}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:r}={}){return this.isValid?ks.fromDateTimes(e||this.s,r||this.e):this}splitAt(...e){if(!this.isValid)return[];const r=e.map(vM).filter(o=>this.contains(o)).sort(),i=[];let{s:n}=this,s=0;for(;n<this.e;){const o=r[s]||this.e,a=+o>+this.e?this.e:o;i.push(ks.fromDateTimes(n,a)),n=a,s+=1}return i}splitBy(e){const r=Ci.fromDurationLike(e);if(!this.isValid||!r.isValid||r.as("milliseconds")===0)return[];let{s:i}=this,n=1,s;const o=[];for(;i<this.e;){const a=this.start.plus(r.mapUnits(l=>l*n));s=+a>+this.e?this.e:a,o.push(ks.fromDateTimes(i,s)),i=s,n+=1}return o}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const r=this.s>e.s?this.s:e.s,i=this.e<e.e?this.e:e.e;return r>=i?null:ks.fromDateTimes(r,i)}union(e){if(!this.isValid)return this;const r=this.s<e.s?this.s:e.s,i=this.e>e.e?this.e:e.e;return ks.fromDateTimes(r,i)}static merge(e){const[r,i]=e.sort((n,s)=>n.s-s.s).reduce(([n,s],o)=>s?s.overlaps(o)||s.abutsStart(o)?[n,s.union(o)]:[n.concat([s]),o]:[n,o],[[],null]);return i&&r.push(i),r}static xor(e){let r=null,i=0;const n=[],s=e.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),o=Array.prototype.concat(...s),a=o.sort((l,c)=>l.time-c.time);for(const l of a)i+=l.type==="s"?1:-1,i===1?r=l.time:(r&&+r!=+l.time&&n.push(ks.fromDateTimes(r,l.time)),r=null);return ks.merge(n)}difference(...e){return ks.xor([this].concat(e)).map(r=>this.intersection(r)).filter(r=>r&&!r.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} – ${this.e.toISO()})`:tE}toLocaleString(e=Iz,r={}){return this.isValid?Bl.create(this.s.loc.clone(r),e).formatInterval(this):tE}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:tE}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:tE}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:tE}toFormat(e,{separator:r=" – "}={}){return this.isValid?`${this.s.toFormat(e)}${r}${this.e.toFormat(e)}`:tE}toDuration(e,r){return this.isValid?this.e.diff(this.s,e,r):Ci.invalid(this.invalidReason)}mapEndpoints(e){return ks.fromDateTimes(e(this.s),e(this.e))}}class a4{static hasDST(e=Oo.defaultZone){const r=$r.now().setZone(e).set({month:12});return!e.isUniversal&&r.offset!==r.set({month:6}).offset}static isValidIANAZone(e){return T_.isValidZone(e)}static normalizeZone(e){return q1(e,Oo.defaultZone)}static months(e="long",{locale:r=null,numberingSystem:i=null,locObj:n=null,outputCalendar:s="gregory"}={}){return(n||os.create(r,i,s)).months(e)}static monthsFormat(e="long",{locale:r=null,numberingSystem:i=null,locObj:n=null,outputCalendar:s="gregory"}={}){return(n||os.create(r,i,s)).months(e,!0)}static weekdays(e="long",{locale:r=null,numberingSystem:i=null,locObj:n=null}={}){return(n||os.create(r,i,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:r=null,numberingSystem:i=null,locObj:n=null}={}){return(n||os.create(r,i,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return os.create(e).meridiems()}static eras(e="short",{locale:r=null}={}){return os.create(r,null,"gregory").eras(e)}static features(){return{relative:FMe()}}}function Vfe(t,e){const r=n=>n.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),i=r(e)-r(t);return Math.floor(Ci.fromMillis(i).as("days"))}function hat(t,e,r){const i=[["years",(l,c)=>c.year-l.year],["quarters",(l,c)=>c.quarter-l.quarter+(c.year-l.year)*4],["months",(l,c)=>c.month-l.month+(c.year-l.year)*12],["weeks",(l,c)=>{const h=Vfe(l,c);return(h-h%7)/7}],["days",Vfe]],n={},s=t;let o,a;for(const[l,c]of i)r.indexOf(l)>=0&&(o=l,n[l]=c(t,e),a=s.plus(n),a>e?(n[l]--,t=s.plus(n)):t=a);return[t,n,a,o]}function dat(t,e,r,i){let[n,s,o,a]=hat(t,e,r);const l=e-n,c=r.filter(p=>["hours","minutes","seconds","milliseconds"].indexOf(p)>=0);c.length===0&&(o<e&&(o=n.plus({[a]:1})),o!==n&&(s[a]=(s[a]||0)+l/(o-n)));const h=Ci.fromObject(s,i);return c.length>0?Ci.fromMillis(l,i).shiftTo(...c).plus(h):h}const poe={arab:"[٠-٩]",arabext:"[۰-۹]",bali:"[᭐-᭙]",beng:"[০-৯]",deva:"[०-९]",fullwide:"[０-９]",gujr:"[૦-૯]",hanidec:"[〇|一|二|三|四|五|六|七|八|九]",khmr:"[០-៩]",knda:"[೦-೯]",laoo:"[໐-໙]",limb:"[᥆-᥏]",mlym:"[൦-൯]",mong:"[᠐-᠙]",mymr:"[၀-၉]",orya:"[୦-୯]",tamldec:"[௦-௯]",telu:"[౦-౯]",thai:"[๐-๙]",tibt:"[༠-༩]",latn:"\\d"},Bfe={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},pat=poe.hanidec.replace(/[\[|\]]/g,"").split("");function fat(t){let e=parseInt(t,10);if(isNaN(e)){e="";for(let r=0;r<t.length;r++){const i=t.charCodeAt(r);if(t[r].search(poe.hanidec)!==-1)e+=pat.indexOf(t[r]);else for(const n in Bfe){const[s,o]=Bfe[n];i>=s&&i<=o&&(e+=i-s)}}return parseInt(e,10)}else return e}function Gp({numberingSystem:t},e=""){return new RegExp(`${poe[t||"latn"]}${e}`)}const mat="missing Intl.DateTimeFormat.formatToParts support";function Vi(t,e=r=>r){return{regex:t,deser:([r])=>e(fat(r))}}const gat=String.fromCharCode(160),tPe=`[ ${gat}]`,rPe=new RegExp(tPe,"g");function yat(t){return t.replace(/\./g,"\\.?").replace(rPe,tPe)}function jfe(t){return t.replace(/\./g,"").replace(rPe," ").toLowerCase()}function Hp(t,e){return t===null?null:{regex:RegExp(t.map(yat).join("|")),deser:([r])=>t.findIndex(i=>jfe(r)===jfe(i))+e}}function Gfe(t,e){return{regex:t,deser:([,r,i])=>TB(r,i),groups:e}}function MG(t){return{regex:t,deser:([e])=>e}}function _at(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function vat(t,e){const r=Gp(e),i=Gp(e,"{2}"),n=Gp(e,"{3}"),s=Gp(e,"{4}"),o=Gp(e,"{6}"),a=Gp(e,"{1,2}"),l=Gp(e,"{1,3}"),c=Gp(e,"{1,6}"),h=Gp(e,"{1,9}"),p=Gp(e,"{2,4}"),f=Gp(e,"{4,6}"),m=b=>({regex:RegExp(_at(b.val)),deser:([w])=>w,literal:!0}),_=(b=>{if(t.literal)return m(b);switch(b.val){case"G":return Hp(e.eras("short",!1),0);case"GG":return Hp(e.eras("long",!1),0);case"y":return Vi(c);case"yy":return Vi(p,GK);case"yyyy":return Vi(s);case"yyyyy":return Vi(f);case"yyyyyy":return Vi(o);case"M":return Vi(a);case"MM":return Vi(i);case"MMM":return Hp(e.months("short",!0,!1),1);case"MMMM":return Hp(e.months("long",!0,!1),1);case"L":return Vi(a);case"LL":return Vi(i);case"LLL":return Hp(e.months("short",!1,!1),1);case"LLLL":return Hp(e.months("long",!1,!1),1);case"d":return Vi(a);case"dd":return Vi(i);case"o":return Vi(l);case"ooo":return Vi(n);case"HH":return Vi(i);case"H":return Vi(a);case"hh":return Vi(i);case"h":return Vi(a);case"mm":return Vi(i);case"m":return Vi(a);case"q":return Vi(a);case"qq":return Vi(i);case"s":return Vi(a);case"ss":return Vi(i);case"S":return Vi(l);case"SSS":return Vi(n);case"u":return MG(h);case"uu":return MG(a);case"uuu":return Vi(r);case"a":return Hp(e.meridiems(),0);case"kkkk":return Vi(s);case"kk":return Vi(p,GK);case"W":return Vi(a);case"WW":return Vi(i);case"E":case"c":return Vi(r);case"EEE":return Hp(e.weekdays("short",!1,!1),1);case"EEEE":return Hp(e.weekdays("long",!1,!1),1);case"ccc":return Hp(e.weekdays("short",!0,!1),1);case"cccc":return Hp(e.weekdays("long",!0,!1),1);case"Z":case"ZZ":return Gfe(new RegExp(`([+-]${a.source})(?::(${i.source}))?`),2);case"ZZZ":return Gfe(new RegExp(`([+-]${a.source})(${i.source})?`),2);case"z":return MG(/[a-z_+-/]{1,256}?/i);default:return m(b)}})(t)||{invalidReason:mat};return _.token=t,_}const bat={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function wat(t,e){const{type:r,value:i}=t;if(r==="literal")return{literal:!0,val:i};const n=e[r];let s=bat[r];if(typeof s=="object"&&(s=s[n]),s)return{literal:!1,val:s}}function xat(t){return[`^${t.map(r=>r.regex).reduce((r,i)=>`${r}(${i.source})`,"")}$`,t]}function Tat(t,e,r){const i=t.match(e);if(i){const n={};let s=1;for(const o in r)if(IO(r,o)){const a=r[o],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(n[a.token.val[0]]=a.deser(i.slice(s,s+l))),s+=l}return[i,n]}else return[i,{}]}function Sat(t){const e=s=>{switch(s){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let r=null,i;return Ti(t.z)||(r=T_.create(t.z)),Ti(t.Z)||(r||(r=new ql(t.Z)),i=t.Z),Ti(t.q)||(t.M=(t.q-1)*3+1),Ti(t.h)||(t.h<12&&t.a===1?t.h+=12:t.h===12&&t.a===0&&(t.h=0)),t.G===0&&t.y&&(t.y=-t.y),Ti(t.u)||(t.S=aoe(t.u)),[Object.keys(t).reduce((s,o)=>{const a=e(o);return a&&(s[a]=t[o]),s},{}),r,i]}let PG=null;function Eat(){return PG||(PG=$r.fromMillis(1555555555555)),PG}function Cat(t,e){if(t.literal)return t;const r=Bl.macroTokenToFormatOpts(t.val),i=sPe(r,e);return i==null||i.includes(void 0)?t:i}function iPe(t,e){return Array.prototype.concat(...t.map(r=>Cat(r,e)))}function nPe(t,e,r){const i=iPe(Bl.parseFormat(r),t),n=i.map(o=>vat(o,t)),s=n.find(o=>o.invalidReason);if(s)return{input:e,tokens:i,invalidReason:s.invalidReason};{const[o,a]=xat(n),l=RegExp(o,"i"),[c,h]=Tat(e,l,a),[p,f,m]=h?Sat(h):[null,null,void 0];if(IO(h,"a")&&IO(h,"H"))throw new tI("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:i,regex:l,rawMatches:c,matches:h,result:p,zone:f,specificOffset:m}}}function Aat(t,e,r){const{result:i,zone:n,specificOffset:s,invalidReason:o}=nPe(t,e,r);return[i,n,s,o]}function sPe(t,e){return t?Bl.create(e,t).formatDateTimeParts(Eat()).map(n=>wat(n,t)):null}const oPe=[0,31,59,90,120,151,181,212,243,273,304,334],aPe=[0,31,60,91,121,152,182,213,244,274,305,335];function up(t,e){return new qf("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${t}, which is invalid`)}function lPe(t,e,r){const i=new Date(Date.UTC(t,e-1,r));t<100&&t>=0&&i.setUTCFullYear(i.getUTCFullYear()-1900);const n=i.getUTCDay();return n===0?7:n}function cPe(t,e,r){return r+(LN(t)?aPe:oPe)[e-1]}function uPe(t,e){const r=LN(t)?aPe:oPe,i=r.findIndex(s=>s<e),n=e-r[i];return{month:i+1,day:n}}function HK(t){const{year:e,month:r,day:i}=t,n=cPe(e,r,i),s=lPe(e,r,i);let o=Math.floor((n-s+10)/7),a;return o<1?(a=e-1,o=Lz(a)):o>Lz(e)?(a=e+1,o=1):a=e,{weekYear:a,weekNumber:o,weekday:s,...SB(t)}}function Hfe(t){const{weekYear:e,weekNumber:r,weekday:i}=t,n=lPe(e,1,4),s=L$(e);let o=r*7+i-n-3,a;o<1?(a=e-1,o+=L$(a)):o>s?(a=e+1,o-=L$(e)):a=e;const{month:l,day:c}=uPe(a,o);return{year:a,month:l,day:c,...SB(t)}}function IG(t){const{year:e,month:r,day:i}=t,n=cPe(e,r,i);return{year:e,ordinal:n,...SB(t)}}function qfe(t){const{year:e,ordinal:r}=t,{month:i,day:n}=uPe(e,r);return{year:e,month:i,day:n,...SB(t)}}function Rat(t){const e=xB(t.weekYear),r=G0(t.weekNumber,1,Lz(t.weekYear)),i=G0(t.weekday,1,7);return e?r?i?!1:up("weekday",t.weekday):up("week",t.week):up("weekYear",t.weekYear)}function Oat(t){const e=xB(t.year),r=G0(t.ordinal,1,L$(t.year));return e?r?!1:up("ordinal",t.ordinal):up("year",t.year)}function hPe(t){const e=xB(t.year),r=G0(t.month,1,12),i=G0(t.day,1,$z(t.year,t.month));return e?r?i?!1:up("day",t.day):up("month",t.month):up("year",t.year)}function dPe(t){const{hour:e,minute:r,second:i,millisecond:n}=t,s=G0(e,0,23)||e===24&&r===0&&i===0&&n===0,o=G0(r,0,59),a=G0(i,0,59),l=G0(n,0,999);return s?o?a?l?!1:up("millisecond",n):up("second",i):up("minute",r):up("hour",e)}const $G="Invalid DateTime",Wfe=864e13;function l4(t){return new qf("unsupported zone",`the zone "${t.name}" is not supported`)}function LG(t){return t.weekData===null&&(t.weekData=HK(t.c)),t.weekData}function yM(t,e){const r={ts:t.ts,zone:t.zone,c:t.c,o:t.o,loc:t.loc,invalid:t.invalid};return new $r({...r,...e,old:r})}function pPe(t,e,r){let i=t-e*60*1e3;const n=r.offset(i);if(e===n)return[i,e];i-=(n-e)*60*1e3;const s=r.offset(i);return n===s?[i,n]:[t-Math.min(n,s)*60*1e3,Math.max(n,s)]}function Xfe(t,e){t+=e*60*1e3;const r=new Date(t);return{year:r.getUTCFullYear(),month:r.getUTCMonth()+1,day:r.getUTCDate(),hour:r.getUTCHours(),minute:r.getUTCMinutes(),second:r.getUTCSeconds(),millisecond:r.getUTCMilliseconds()}}function K6(t,e,r){return pPe(coe(t),e,r)}function Yfe(t,e){const r=t.o,i=t.c.year+Math.trunc(e.years),n=t.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,s={...t.c,year:i,month:n,day:Math.min(t.c.day,$z(i,n))+Math.trunc(e.days)+Math.trunc(e.weeks)*7},o=Ci.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),a=coe(s);let[l,c]=pPe(a,r,t.zone);return o!==0&&(l+=o,c=t.zone.offset(l)),{ts:l,o:c}}function _M(t,e,r,i,n,s){const{setZone:o,zone:a}=r;if(t&&Object.keys(t).length!==0){const l=e||a,c=$r.fromObject(t,{...r,zone:l,specificOffset:s});return o?c:c.setZone(a)}else return $r.invalid(new qf("unparsable",`the input "${n}" can't be parsed as ${i}`))}function c4(t,e,r=!0){return t.isValid?Bl.create(os.create("en-US"),{allowZ:r,forceSimple:!0}).formatDateTimeFromString(t,e):null}function DG(t,e){const r=t.c.year>9999||t.c.year<0;let i="";return r&&t.c.year>=0&&(i+="+"),i+=Po(t.c.year,r?6:4),e?(i+="-",i+=Po(t.c.month),i+="-",i+=Po(t.c.day)):(i+=Po(t.c.month),i+=Po(t.c.day)),i}function Zfe(t,e,r,i,n,s){let o=Po(t.c.hour);return e?(o+=":",o+=Po(t.c.minute),(t.c.second!==0||!r)&&(o+=":")):o+=Po(t.c.minute),(t.c.second!==0||!r)&&(o+=Po(t.c.second),(t.c.millisecond!==0||!i)&&(o+=".",o+=Po(t.c.millisecond,3))),n&&(t.isOffsetFixed&&t.offset===0&&!s?o+="Z":t.o<0?(o+="-",o+=Po(Math.trunc(-t.o/60)),o+=":",o+=Po(Math.trunc(-t.o%60))):(o+="+",o+=Po(Math.trunc(t.o/60)),o+=":",o+=Po(Math.trunc(t.o%60)))),s&&(o+="["+t.zone.ianaName+"]"),o}const fPe={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},Mat={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},Pat={ordinal:1,hour:0,minute:0,second:0,millisecond:0},mPe=["year","month","day","hour","minute","second","millisecond"],Iat=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],$at=["year","ordinal","hour","minute","second","millisecond"];function Jfe(t){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[t.toLowerCase()];if(!e)throw new yMe(t);return e}function Kfe(t,e){const r=q1(e.zone,Oo.defaultZone),i=os.fromObject(e),n=Oo.now();let s,o;if(Ti(t.year))s=n;else{for(const c of mPe)Ti(t[c])&&(t[c]=fPe[c]);const a=hPe(t)||dPe(t);if(a)return $r.invalid(a);const l=r.offset(n);[s,o]=K6(t,l,r)}return new $r({ts:s,zone:r,loc:i,o})}function Qfe(t,e,r){const i=Ti(r.round)?!0:r.round,n=(o,a)=>(o=loe(o,i||r.calendary?0:2,!0),e.loc.clone(r).relFormatter(r).format(o,a)),s=o=>r.calendary?e.hasSame(t,o)?0:e.startOf(o).diff(t.startOf(o),o).get(o):e.diff(t,o).get(o);if(r.unit)return n(s(r.unit),r.unit);for(const o of r.units){const a=s(o);if(Math.abs(a)>=1)return n(a,o)}return n(t>e?-0:0,r.units[r.units.length-1])}function eme(t){let e={},r;return t.length>0&&typeof t[t.length-1]=="object"?(e=t[t.length-1],r=Array.from(t).slice(0,t.length-1)):r=Array.from(t),[e,r]}class $r{constructor(e){const r=e.zone||Oo.defaultZone;let i=e.invalid||(Number.isNaN(e.ts)?new qf("invalid input"):null)||(r.isValid?null:l4(r));this.ts=Ti(e.ts)?Oo.now():e.ts;let n=null,s=null;if(!i)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(r))[n,s]=[e.old.c,e.old.o];else{const a=r.offset(this.ts);n=Xfe(this.ts,a),i=Number.isNaN(n.year)?new qf("invalid input"):null,n=i?null:n,s=i?null:a}this._zone=r,this.loc=e.loc||os.create(),this.invalid=i,this.weekData=null,this.c=n,this.o=s,this.isLuxonDateTime=!0}static now(){return new $r({})}static local(){const[e,r]=eme(arguments),[i,n,s,o,a,l,c]=r;return Kfe({year:i,month:n,day:s,hour:o,minute:a,second:l,millisecond:c},e)}static utc(){const[e,r]=eme(arguments),[i,n,s,o,a,l,c]=r;return e.zone=ql.utcInstance,Kfe({year:i,month:n,day:s,hour:o,minute:a,second:l,millisecond:c},e)}static fromJSDate(e,r={}){const i=not(e)?e.valueOf():NaN;if(Number.isNaN(i))return $r.invalid("invalid input");const n=q1(r.zone,Oo.defaultZone);return n.isValid?new $r({ts:i,zone:n,loc:os.fromObject(r)}):$r.invalid(l4(n))}static fromMillis(e,r={}){if(PS(e))return e<-Wfe||e>Wfe?$r.invalid("Timestamp out of range"):new $r({ts:e,zone:q1(r.zone,Oo.defaultZone),loc:os.fromObject(r)});throw new Qd(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,r={}){if(PS(e))return new $r({ts:e*1e3,zone:q1(r.zone,Oo.defaultZone),loc:os.fromObject(r)});throw new Qd("fromSeconds requires a numerical input")}static fromObject(e,r={}){e=e||{};const i=q1(r.zone,Oo.defaultZone);if(!i.isValid)return $r.invalid(l4(i));const n=Oo.now(),s=Ti(r.specificOffset)?i.offset(n):r.specificOffset,o=Dz(e,Jfe),a=!Ti(o.ordinal),l=!Ti(o.year),c=!Ti(o.month)||!Ti(o.day),h=l||c,p=o.weekYear||o.weekNumber,f=os.fromObject(r);if((h||a)&&p)throw new tI("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(c&&a)throw new tI("Can't mix ordinal dates with month/day");const m=p||o.weekday&&!h;let g,_,b=Xfe(n,s);m?(g=Iat,_=Mat,b=HK(b)):a?(g=$at,_=Pat,b=IG(b)):(g=mPe,_=fPe);let w=!1;for(const M of g){const D=o[M];Ti(D)?w?o[M]=_[M]:o[M]=b[M]:w=!0}const x=m?Rat(o):a?Oat(o):hPe(o),T=x||dPe(o);if(T)return $r.invalid(T);const E=m?Hfe(o):a?qfe(o):o,[C,A]=K6(E,s,i),I=new $r({ts:C,zone:i,o:A,loc:f});return o.weekday&&h&&e.weekday!==I.weekday?$r.invalid("mismatched weekday",`you can't specify both a weekday of ${o.weekday} and a date of ${I.toISO()}`):I}static fromISO(e,r={}){const[i,n]=Wot(e);return _M(i,n,r,"ISO 8601",e)}static fromRFC2822(e,r={}){const[i,n]=Xot(e);return _M(i,n,r,"RFC 2822",e)}static fromHTTP(e,r={}){const[i,n]=Yot(e);return _M(i,n,r,"HTTP",r)}static fromFormat(e,r,i={}){if(Ti(e)||Ti(r))throw new Qd("fromFormat requires an input string and a format");const{locale:n=null,numberingSystem:s=null}=i,o=os.fromOpts({locale:n,numberingSystem:s,defaultToEN:!0}),[a,l,c,h]=Aat(o,e,r);return h?$r.invalid(h):_M(a,l,i,`format ${r}`,e,c)}static fromString(e,r,i={}){return $r.fromFormat(e,r,i)}static fromSQL(e,r={}){const[i,n]=rat(e);return _M(i,n,r,"SQL",e)}static invalid(e,r=null){if(!e)throw new Qd("need to specify a reason the DateTime is invalid");const i=e instanceof qf?e:new qf(e,r);if(Oo.throwOnInvalid)throw new Dst(i);return new $r({invalid:i})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,r={}){const i=sPe(e,os.fromObject(r));return i?i.map(n=>n?n.val:null).join(""):null}static expandFormat(e,r={}){return iPe(Bl.parseFormat(e),os.fromObject(r)).map(n=>n.val).join("")}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?LG(this).weekYear:NaN}get weekNumber(){return this.isValid?LG(this).weekNumber:NaN}get weekday(){return this.isValid?LG(this).weekday:NaN}get ordinal(){return this.isValid?IG(this.c).ordinal:NaN}get monthShort(){return this.isValid?a4.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?a4.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?a4.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?a4.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}get isInLeapYear(){return LN(this.year)}get daysInMonth(){return $z(this.year,this.month)}get daysInYear(){return this.isValid?L$(this.year):NaN}get weeksInWeekYear(){return this.isValid?Lz(this.weekYear):NaN}resolvedLocaleOptions(e={}){const{locale:r,numberingSystem:i,calendar:n}=Bl.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:r,numberingSystem:i,outputCalendar:n}}toUTC(e=0,r={}){return this.setZone(ql.instance(e),r)}toLocal(){return this.setZone(Oo.defaultZone)}setZone(e,{keepLocalTime:r=!1,keepCalendarTime:i=!1}={}){if(e=q1(e,Oo.defaultZone),e.equals(this.zone))return this;if(e.isValid){let n=this.ts;if(r||i){const s=e.offset(this.ts),o=this.toObject();[n]=K6(o,s,e)}return yM(this,{ts:n,zone:e})}else return $r.invalid(l4(e))}reconfigure({locale:e,numberingSystem:r,outputCalendar:i}={}){const n=this.loc.clone({locale:e,numberingSystem:r,outputCalendar:i});return yM(this,{loc:n})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const r=Dz(e,Jfe),i=!Ti(r.weekYear)||!Ti(r.weekNumber)||!Ti(r.weekday),n=!Ti(r.ordinal),s=!Ti(r.year),o=!Ti(r.month)||!Ti(r.day),a=s||o,l=r.weekYear||r.weekNumber;if((a||n)&&l)throw new tI("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(o&&n)throw new tI("Can't mix ordinal dates with month/day");let c;i?c=Hfe({...HK(this.c),...r}):Ti(r.ordinal)?(c={...this.toObject(),...r},Ti(r.day)&&(c.day=Math.min($z(c.year,c.month),c.day))):c=qfe({...IG(this.c),...r});const[h,p]=K6(c,this.o,this.zone);return yM(this,{ts:h,o:p})}plus(e){if(!this.isValid)return this;const r=Ci.fromDurationLike(e);return yM(this,Yfe(this,r))}minus(e){if(!this.isValid)return this;const r=Ci.fromDurationLike(e).negate();return yM(this,Yfe(this,r))}startOf(e){if(!this.isValid)return this;const r={},i=Ci.normalizeUnit(e);switch(i){case"years":r.month=1;case"quarters":case"months":r.day=1;case"weeks":case"days":r.hour=0;case"hours":r.minute=0;case"minutes":r.second=0;case"seconds":r.millisecond=0;break}if(i==="weeks"&&(r.weekday=1),i==="quarters"){const n=Math.ceil(this.month/3);r.month=(n-1)*3+1}return this.set(r)}endOf(e){return this.isValid?this.plus({[e]:1}).startOf(e).minus(1):this}toFormat(e,r={}){return this.isValid?Bl.create(this.loc.redefaultToEN(r)).formatDateTimeFromString(this,e):$G}toLocaleString(e=Iz,r={}){return this.isValid?Bl.create(this.loc.clone(r),e).formatDateTime(this):$G}toLocaleParts(e={}){return this.isValid?Bl.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:r=!1,suppressMilliseconds:i=!1,includeOffset:n=!0,extendedZone:s=!1}={}){if(!this.isValid)return null;const o=e==="extended";let a=DG(this,o);return a+="T",a+=Zfe(this,o,r,i,n,s),a}toISODate({format:e="extended"}={}){return this.isValid?DG(this,e==="extended"):null}toISOWeekDate(){return c4(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:r=!1,includeOffset:i=!0,includePrefix:n=!1,extendedZone:s=!1,format:o="extended"}={}){return this.isValid?(n?"T":"")+Zfe(this,o==="extended",r,e,i,s):null}toRFC2822(){return c4(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return c4(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?DG(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:r=!1,includeOffsetSpace:i=!0}={}){let n="HH:mm:ss.SSS";return(r||e)&&(i&&(n+=" "),r?n+="z":e&&(n+="ZZ")),c4(this,n,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():$G}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const r={...this.c};return e.includeConfig&&(r.outputCalendar=this.outputCalendar,r.numberingSystem=this.loc.numberingSystem,r.locale=this.loc.locale),r}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,r="milliseconds",i={}){if(!this.isValid||!e.isValid)return Ci.invalid("created by diffing an invalid DateTime");const n={locale:this.locale,numberingSystem:this.numberingSystem,...i},s=sot(r).map(Ci.normalizeUnit),o=e.valueOf()>this.valueOf(),a=o?this:e,l=o?e:this,c=dat(a,l,s,n);return o?c.negate():c}diffNow(e="milliseconds",r={}){return this.diff($r.now(),e,r)}until(e){return this.isValid?ks.fromDateTimes(this,e):this}hasSame(e,r){if(!this.isValid)return!1;const i=e.valueOf(),n=this.setZone(e.zone,{keepLocalTime:!0});return n.startOf(r)<=i&&i<=n.endOf(r)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const r=e.base||$r.fromObject({},{zone:this.zone}),i=e.padding?this<r?-e.padding:e.padding:0;let n=["years","months","days","hours","minutes","seconds"],s=e.unit;return Array.isArray(e.unit)&&(n=e.unit,s=void 0),Qfe(r,this.plus(i),{...e,numeric:"always",units:n,unit:s})}toRelativeCalendar(e={}){return this.isValid?Qfe(e.base||$r.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every($r.isDateTime))throw new Qd("min requires all arguments be DateTimes");return kfe(e,r=>r.valueOf(),Math.min)}static max(...e){if(!e.every($r.isDateTime))throw new Qd("max requires all arguments be DateTimes");return kfe(e,r=>r.valueOf(),Math.max)}static fromFormatExplain(e,r,i={}){const{locale:n=null,numberingSystem:s=null}=i,o=os.fromOpts({locale:n,numberingSystem:s,defaultToEN:!0});return nPe(o,e,r)}static fromStringExplain(e,r,i={}){return $r.fromFormatExplain(e,r,i)}static get DATE_SHORT(){return Iz}static get DATE_MED(){return _Me}static get DATE_MED_WITH_WEEKDAY(){return kst}static get DATE_FULL(){return vMe}static get DATE_HUGE(){return bMe}static get TIME_SIMPLE(){return wMe}static get TIME_WITH_SECONDS(){return xMe}static get TIME_WITH_SHORT_OFFSET(){return TMe}static get TIME_WITH_LONG_OFFSET(){return SMe}static get TIME_24_SIMPLE(){return EMe}static get TIME_24_WITH_SECONDS(){return CMe}static get TIME_24_WITH_SHORT_OFFSET(){return AMe}static get TIME_24_WITH_LONG_OFFSET(){return RMe}static get DATETIME_SHORT(){return OMe}static get DATETIME_SHORT_WITH_SECONDS(){return MMe}static get DATETIME_MED(){return PMe}static get DATETIME_MED_WITH_SECONDS(){return IMe}static get DATETIME_MED_WITH_WEEKDAY(){return Ust}static get DATETIME_FULL(){return $Me}static get DATETIME_FULL_WITH_SECONDS(){return LMe}static get DATETIME_HUGE(){return DMe}static get DATETIME_HUGE_WITH_SECONDS(){return NMe}}function vM(t){if($r.isDateTime(t))return t;if(t&&t.valueOf&&PS(t.valueOf()))return $r.fromJSDate(t);if(t&&typeof t=="object")return $r.fromObject(t);throw new Qd(`Unknown datetime argument: ${t}, of type ${typeof t}`)}function Lat(t,e="system"){if(!t||!Ofe.has(t.timeZone))return e;const r=Ofe.get(t.timeZone);return Nat(t.timeZone)||t.respectsDaylightSaving?r:Dat(r)}function Dat(t){const e=$r.local().setZone(t),r=Math.min(e.set({month:1,day:1}).offset,e.set({month:5}).offset);return r===0?"Etc/UTC":`Etc/GMT${ql.instance(-r).formatOffset(0,"narrow")}`}function Nat(t){return t.startsWith("UTC")}let a1=class extends bi(fe){constructor(e){super(e),this.legacy=null,this.timeZone="system"}readLegacy(e,r){const{timeZone:i,respectsDaylightSaving:n}=r;return{timeZone:i,respectsDaylightSaving:n}}readTimeZone(e,r){return"timeZoneIANA"in r?r.timeZoneIANA:Lat(r)}writeTimeZone(e,r){r.timeZoneIANA=e}equals(e){return!(R(e)||R(this.timeZone)||R(e.timeZone))&&this.timeZone===e.timeZone}};u([d()],a1.prototype,"legacy",void 0),u([Me("legacy",["timeZone"])],a1.prototype,"readLegacy",null),u([d({type:String,nonNullable:!0})],a1.prototype,"timeZone",void 0),u([Me("timeZone",["timeZone","timeZoneIANA","respectsDaylightSaving"])],a1.prototype,"readTimeZone",null),u([De("timeZone")],a1.prototype,"writeTimeZone",null),a1=u([$("esri.time.TimeReference")],a1);const $O=a1;let l0=class extends bi(fe){constructor(e){super(e),this.creatorField=null,this.creationDateField=null,this.editorField=null,this.editDateField=null,this.realm=null,this.dateFieldsTimeReference=null}};u([d()],l0.prototype,"creatorField",void 0),u([d()],l0.prototype,"creationDateField",void 0),u([d()],l0.prototype,"editorField",void 0),u([d()],l0.prototype,"editDateField",void 0),u([d()],l0.prototype,"realm",void 0),u([d({type:$O})],l0.prototype,"dateFieldsTimeReference",void 0),l0=u([$("esri.layers.support.EditFieldsInfo")],l0);const Fat=l0;let xg=class extends bi(fe){constructor(e){super(e)}};u([d({constructOnly:!0,json:{write:!0}})],xg.prototype,"name",void 0),u([d({constructOnly:!0,json:{write:!0}})],xg.prototype,"fields",void 0),u([d({constructOnly:!0,json:{write:!0}})],xg.prototype,"isAscending",void 0),u([d({constructOnly:!0,json:{write:!0}})],xg.prototype,"indexType",void 0),u([d({constructOnly:!0,json:{write:!0}})],xg.prototype,"isUnique",void 0),u([d({constructOnly:!0,json:{write:!0}})],xg.prototype,"description",void 0),xg=u([$("esri.layers.support.FeatureIndex")],xg);const qK=new mr({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function kat(t,e,r,i){const n=await $w(t);if(await foe(t,e,i),!n.addAttachment)throw new H(i,"Layer source does not support addAttachment capability");return n.addAttachment(e,r)}function foe(t,e,r){const{attributes:i}=e,{objectIdField:n}=t;return t.get("capabilities.data.supportsAttachment")?e?i?n&&i[n]?Promise.resolve():Promise.reject(new H(r,`feature is missing the identifying attribute ${n}`)):Promise.reject(new H(r,"'attributes' are required on a feature to query attachments")):Promise.reject(new H(r,"A feature is required to add/delete/update attachments")):Promise.reject(new H(r,"this layer doesn't support attachments"))}async function Uat(t,e,r,i,n){const s=await $w(t);if(await foe(t,e,n),!s.updateAttachment)throw new H(n,"Layer source does not support updateAttachment capability");return s.updateAttachment(e,r,i)}async function zat(t,e,r){const i=await Q(()=>import("./editingSupport-032631ea.js"),["assets/editingSupport-032631ea.js","assets/assetEditingSupport-2cebf928.js"]),n=await t.load();return i.applyEdits(n,n.source,e,r)}async function Vat(t,e,r,i){const n=await $w(t);if(await foe(t,e,i),!n.deleteAttachments)throw new H(i,"Layer source does not support deleteAttachments capability");return n.deleteAttachments(e,r)}async function Bat(t,e,r){const i=(await t.load({signal:e==null?void 0:e.signal})).source;if(!i.fetchRecomputedExtents)throw new H(r,"Layer source does not support fetchUpdates capability");return i.fetchRecomputedExtents(e)}async function jat(t,e,r,i){var m,g;e=_J.from(e),await t.load();const n=t.source,s=t.capabilities;if(!((m=s==null?void 0:s.data)!=null&&m.supportsAttachment))throw new H(i,"this layer doesn't support attachments");const{attachmentTypes:o,objectIds:a,globalIds:l,num:c,size:h,start:p,where:f}=e;if(!((g=s==null?void 0:s.operations)!=null&&g.supportsQueryAttachments)&&((o==null?void 0:o.length)>0||(l==null?void 0:l.length)>0||(h==null?void 0:h.length)>0||c||p||f))throw new H(i,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",e);if(!(a!=null&&a.length||l!=null&&l.length||f))throw new H(i,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",e);if(!n.queryAttachments)throw new H(i,"Layer source does not support queryAttachments capability",e);return n.queryAttachments(e)}async function Gat(t,e,r,i){const n=await $w(t);if(!n.queryObjectIds)throw new H(i,"Layer source does not support queryObjectIds capability");return n.queryObjectIds(gp.from(e)??t.createQuery(),r)}async function Hat(t,e,r,i){const n=await $w(t);if(!n.queryFeatureCount)throw new H(i,"Layer source does not support queryFeatureCount capability");return n.queryFeatureCount(gp.from(e)??t.createQuery(),r)}async function qat(t,e,r,i){const n=await $w(t);if(!n.queryExtent)throw new H(i,"Layer source does not support queryExtent capability");return n.queryExtent(gp.from(e)??t.createQuery(),r)}async function Wat(t,e,r,i){const n=await $w(t);if(!n.queryRelatedFeatures)throw new H(i,"Layer source does not support queryRelatedFeatures capability");return n.queryRelatedFeatures(RO.from(e),r)}async function Xat(t,e,r,i){const n=await $w(t);if(!n.queryRelatedFeaturesCount)throw new H(i,"Layer source does not support queryRelatedFeaturesCount capability");return n.queryRelatedFeaturesCount(RO.from(e),r)}async function Yat(t){const e=t.source;if(e!=null&&e.refresh)try{const{dataChanged:r,updates:i}=await e.refresh();if(v(i)&&(t.sourceJSON={...t.sourceJSON,...i},t.read(i,{origin:"service",url:t.parsedUrl})),r)return!0}catch{}if(t.definitionExpression)try{return(await knt(t.definitionExpression,t.fieldsIndex)).hasDateFunctions}catch{}return!1}function Zat(t){const e=new gp,r=t.get("capabilities.data"),i=t.get("capabilities.query");e.historicMoment=t.historicMoment,e.gdbVersion=t.gdbVersion,e.returnGeometry=!0,i&&(e.compactGeometryEnabled=i.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=i.supportsDefaultSpatialReference),r&&(r.supportsZ&&t.returnZ!=null&&(e.returnZ=t.returnZ),r.supportsM&&t.returnM!=null&&(e.returnM=t.returnM)),e.outFields=["*"];const{timeOffset:n,timeExtent:s}=t;return e.timeExtent=n!=null&&s!=null?s.offset(-n.value,n.unit):s||null,e.multipatchOption=t.geometryType==="multipatch"?"xyFootprint":null,e}function gPe(t){const{globalIdField:e,fields:r}=t;if(e)return e;if(r){for(const i of r)if(i.type==="esriFieldTypeGlobalID")return i.name}}function yPe(t){const{objectIdField:e,fields:r}=t;if(e)return e;if(r){for(const i of r)if(i.type==="esriFieldTypeOID")return i.name}}function Jat(t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}async function $w(t){return(await t.load()).source}async function Kat(t,e){if(!Oi||Oi.findCredential(t))return;let r;try{const i=await gOe(t,e);i&&(r=await Oi.checkSignInStatus(`${i}/sharing`))}catch{}if(r)try{const i=v(e)?e.signal:null;await Oi.getCredential(t,{signal:i})}catch{}}async function Qat(t,e){var n;const r=(n=t.parsedUrl)==null?void 0:n.path;if(!r)return;const i=t.editFieldsInfo;(t.userHasUpdateItemPrivileges||t.userHasFullEditingPrivileges&&t.capabilities.operations.supportsEditing||i!=null&&i.creatorField||i!=null&&i.editorField)&&await Kat(r,e)}function elt(t){var e;return!((e=t.sourceJSON)!=null&&e.isMultiServicesView)&&(t.userHasUpdateItemPrivileges||t.editingEnabled)}let VC=class extends bi(fe){constructor(e){super(e),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};u([d({type:String,json:{read:{source:"shapeAreaFieldName"}}})],VC.prototype,"shapeAreaField",void 0),u([d({type:String,json:{read:{source:"shapeLengthFieldName"}}})],VC.prototype,"shapeLengthField",void 0),u([d({type:String,json:{read:t=>dGe.read(t)||pGe.read(t)}})],VC.prototype,"units",void 0),VC=u([$("esri.layers.support.GeometryFieldsInfo")],VC);const tlt=VC;var WK;let BC=WK=class extends fe{constructor(t){super(t),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new ct}clone(){return new WK({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};u([d({type:String,json:{write:!0}})],BC.prototype,"floorField",void 0),u([d({json:{read:!1,write:!1}})],BC.prototype,"viewAllMode",void 0),u([d({json:{read:!1,write:!1}})],BC.prototype,"viewAllLevelIds",void 0),BC=WK=u([$("esri.layers.support.LayerFloorInfo")],BC);const rlt=BC,tme=new mr({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),rme=new mr({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let Pd=class extends bi(fe){constructor(e){super(e),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};u([d({json:{read:tme.read,write:tme.write}})],Pd.prototype,"cardinality",void 0),u([d({json:{read:!0,write:!0}})],Pd.prototype,"composite",void 0),u([d({json:{read:!0,write:!0}})],Pd.prototype,"id",void 0),u([d({json:{read:!0,write:!0}})],Pd.prototype,"keyField",void 0),u([d({json:{read:!0,write:!0}})],Pd.prototype,"keyFieldInRelationshipTable",void 0),u([d({json:{read:!0,write:!0}})],Pd.prototype,"name",void 0),u([d({json:{read:!0,write:!0}})],Pd.prototype,"relatedTableId",void 0),u([d({json:{read:!0,write:!0}})],Pd.prototype,"relationshipTableId",void 0),u([d({json:{read:rme.read,write:rme.write}})],Pd.prototype,"role",void 0),Pd=u([$("esri.layers.support.Relationship")],Pd);const ilt=Pd,nlt={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"};function rr(t,e,r){return!!(t&&t.hasOwnProperty(e)?t[e]:r)}function u4(t,e,r){return t&&t.hasOwnProperty(e)?t[e]:r}function slt(t){var r;const e=(r=t==null?void 0:t.supportedSpatialAggregationStatistics)==null?void 0:r.map(i=>i.toLowerCase());return{envelope:!!(e!=null&&e.includes("envelopeaggregate")),centroid:!!(e!=null&&e.includes("centroidaggregate")),convexHull:!!(e!=null&&e.includes("convexhullaggregate"))}}function FN(t,e){var i;const r=(i=t==null?void 0:t.supportedOperationsWithCacheHint)==null?void 0:i.map(n=>n.toLowerCase());return!!(r!=null&&r.includes(e.toLowerCase()))}function _Pe(t,e){return{analytics:olt(t),attachment:alt(t),data:llt(t),metadata:clt(t),operations:ult(t.capabilities,t,e),query:hlt(t,e),queryRelated:dlt(t),queryTopFeatures:plt(t),editing:flt(t)}}function olt(t){return{supportsCacheHint:FN(t.advancedQueryCapabilities,"queryAnalytics")}}function alt(t){const e=t.attachmentProperties,r={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:FN(t.advancedQueryCapabilities,"queryAttachments"),supportsResize:rr(t,"supportsAttachmentsResizing",!1)};return e&&Array.isArray(e)&&e.forEach(i=>{const n=nlt[i.name];n&&(r[n]=!!i.isEnabled)}),r}function llt(t){return{isVersioned:rr(t,"isDataVersioned",!1),supportsAttachment:rr(t,"hasAttachments",!1),supportsM:rr(t,"hasM",!1),supportsZ:rr(t,"hasZ",!1)}}function clt(t){return{supportsAdvancedFieldProperties:rr(t,"supportsFieldDescriptionProperty",!1)}}function ult(t,e,r){const i=t?t.toLowerCase().split(",").map(f=>f.trim()):[],n=r?aw(r):null,s=i.includes(v(n)&&n.serverType==="MapServer"?"data":"query"),o=i.includes("editing")&&!e.datesInUnknownTimezone;let a=o&&i.includes("create"),l=o&&i.includes("delete"),c=o&&i.includes("update");const h=i.includes("changetracking"),p=e.advancedQueryCapabilities;return o&&!(a||l||c)&&(a=l=c=!0),{supportsCalculate:rr(e,"supportsCalculate",!1),supportsTruncate:rr(e,"supportsTruncate",!1),supportsValidateSql:rr(e,"supportsValidateSql",!1),supportsAdd:a,supportsDelete:l,supportsEditing:o,supportsChangeTracking:h,supportsQuery:s,supportsQueryAnalytics:rr(p,"supportsQueryAnalytic",!1),supportsQueryAttachments:rr(p,"supportsQueryAttachments",!1),supportsQueryTopFeatures:rr(p,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:rr(e,"supportsAttachmentsResizing",!1),supportsSync:i.includes("sync"),supportsUpdate:c,supportsExceedsLimitStatistics:rr(e,"supportsExceedsLimitStatistics",!1)}}function hlt(t,e){const r=t.advancedQueryCapabilities,i=t.ownershipBasedAccessControlForFeatures,n=t.archivingInfo,s=t.currentVersion,o=e==null?void 0:e.includes("MapServer"),a=!o||s>=ue("mapserver-pbf-version-support"),l=uMe(e),c=new Set((t.supportedQueryFormats??"").split(",").map(h=>h.toLowerCase().trim()));return{supportsStatistics:rr(r,"supportsStatistics",t.supportsStatistics),supportsPercentileStatistics:rr(r,"supportsPercentileStatistics",!1),supportsSpatialAggregationStatistics:rr(r,"supportsSpatialAggregationStatistics",!1),supportedSpatialAggregationStatistics:slt(r),supportsCentroid:rr(r,"supportsReturningGeometryCentroid",!1),supportsDistance:rr(r,"supportsQueryWithDistance",!1),supportsDistinct:rr(r,"supportsDistinct",t.supportsAdvancedQueries),supportsExtent:rr(r,"supportsReturningQueryExtent",!1),supportsGeometryProperties:rr(r,"supportsReturningGeometryProperties",!1),supportsHavingClause:rr(r,"supportsHavingClause",!1),supportsOrderBy:rr(r,"supportsOrderBy",t.supportsAdvancedQueries),supportsPagination:rr(r,"supportsPagination",!1),supportsQuantization:rr(t,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:rr(t,"supportsQuantizationEditMode",!1),supportsQueryGeometry:rr(t,"supportsReturningQueryGeometry",!1),supportsResultType:rr(r,"supportsQueryWithResultType",!1),supportsMaxRecordCountFactor:rr(r,"supportsMaxRecordCountFactor",!1),supportsSqlExpression:rr(r,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:rr(t,"useStandardizedQueries",!1),supportsTopFeaturesQuery:rr(r,"supportsTopFeaturesQuery",!1),supportsQueryByOthers:rr(i,"allowOthersToQuery",!0),supportsHistoricMoment:rr(n,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:a&&c.has("pbf"),supportsDisjointSpatialRelationship:rr(r,"supportsDisjointSpatialRel",!1),supportsCacheHint:rr(r,"supportsQueryWithCacheHint",!1)||FN(r,"query"),supportsDefaultSpatialReference:rr(r,"supportsDefaultSR",!1),supportsCompactGeometry:l,supportsFullTextSearch:rr(r,"supportsFullTextSearch",!1),maxRecordCountFactor:u4(t,"maxRecordCountFactor",void 0),maxRecordCount:u4(t,"maxRecordCount",void 0),standardMaxRecordCount:u4(t,"standardMaxRecordCount",void 0),tileMaxRecordCount:u4(t,"tileMaxRecordCount",void 0)}}function dlt(t){const e=t.advancedQueryCapabilities,r=rr(e,"supportsAdvancedQueryRelated",!1);return{supportsPagination:rr(e,"supportsQueryRelatedPagination",!1),supportsCount:r,supportsOrderBy:r,supportsCacheHint:FN(e,"queryRelated")}}function plt(t){return{supportsCacheHint:FN(t.advancedQueryCapabilities,"queryTopFilter")}}function flt(t){const e=t.ownershipBasedAccessControlForFeatures;return{supportsGeometryUpdate:rr(t,"allowGeometryUpdates",!0),supportsGlobalId:rr(t,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:rr(t,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:rr(t,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:rr(t,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:rr(t,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:rr(e,"allowAnonymousToDelete",!0),supportsDeleteByOthers:rr(e,"allowOthersToDelete",!0),supportsUpdateByAnonymous:rr(e,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:rr(e,"allowOthersToUpdate",!0)}}const mlt=t=>{let e=class extends t{constructor(){super(...arguments),this.capabilities=null,this.copyright=null,this.dateFieldsTimeReference=null,this.datesInUnknownTimezone=!1,this.displayField=null,this.definitionExpression=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.floorInfo=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.isTable=!1,this.layerId=void 0,this.minScale=0,this.maxScale=0,this.globalIdField=null,this.objectIdField=null,this.preferredTimeReference=null,this.relationships=null,this.sourceJSON=null,this.returnM=void 0,this.returnZ=void 0,this.serviceDefinitionExpression=null,this.serviceItemId=null,this.spatialReference=Je.WGS84,this.subtypeField=null,this.trackIdField=null,this.indexes=new(ct.ofType(xg)),this.version=void 0}readCapabilitiesFromService(r,i){return _Pe(i,this.url)}get effectiveCapabilities(){var o;const r=this.capabilities;if(!r)return null;const i=se(r),{operations:n,editing:s}=i;return(o=this.sourceJSON)!=null&&o.isMultiServicesView?(this.userHasUpdateItemPrivileges&&(n.supportsQuery=!0),i):this.userHasUpdateItemPrivileges?(n.supportsAdd=n.supportsDelete=n.supportsEditing=n.supportsQuery=n.supportsUpdate=s.supportsDeleteByOthers=s.supportsGeometryUpdate=s.supportsUpdateByOthers=!0,i):(this.userHasFullEditingPrivileges&&n.supportsEditing&&(n.supportsAdd=n.supportsDelete=n.supportsUpdate=s.supportsGeometryUpdate=!0),i)}readEditingInfo(r,i){const{editingInfo:n}=i;return n?{lastEditDate:n.lastEditDate!=null?new Date(n.lastEditDate):null}:null}readIsTableFromService(r,i){return i.type==="Table"}readMinScale(r,i){return i.effectiveMinScale||r||0}readMaxScale(r,i){return i.effectiveMaxScale||r||0}readGlobalIdFieldFromService(r,i){return gPe(i)}readObjectIdFieldFromService(r,i){return yPe(i)}readServiceDefinitionExpression(r,i){return i.definitionQuery||i.definitionExpression}set url(r){const i=ust({layer:this,url:r,nonStandardUrlAllowed:!0,logger:re.getLogger(this.declaredClass)});this._set("url",i.url),i.layerId!=null&&this._set("layerId",i.layerId)}writeUrl(r,i,n,s){hst(this,r,null,i,s)}readVersion(r,i){return Jat(i)}};return u([d({readOnly:!0,json:{read:!1,origins:{service:{read:{source:["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"]}}}}})],e.prototype,"capabilities",void 0),u([Me("service","capabilities")],e.prototype,"readCapabilitiesFromService",null),u([d({readOnly:!0})],e.prototype,"effectiveCapabilities",null),u([d({type:String,json:{origins:{service:{read:{source:"copyrightText"}}}}})],e.prototype,"copyright",void 0),u([d({type:$O})],e.prototype,"dateFieldsTimeReference",void 0),u([d({type:Boolean})],e.prototype,"datesInUnknownTimezone",void 0),u([d({type:String,json:{origins:{service:{read:{source:"displayField"}}}}})],e.prototype,"displayField",void 0),u([d({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],e.prototype,"definitionExpression",void 0),u([d({readOnly:!0,type:Fat})],e.prototype,"editFieldsInfo",void 0),u([d({readOnly:!0})],e.prototype,"editingInfo",void 0),u([Me("editingInfo")],e.prototype,"readEditingInfo",null),u([d((()=>{const r=se(Mst),i=r.json.origins;return i["web-map"]={read:!1,write:!1},i["portal-item"]={read:!1,write:!1},r})())],e.prototype,"elevationInfo",void 0),u([d({type:rlt,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],e.prototype,"floorInfo",void 0),u([d({type:ur,json:{origins:{service:{read:{source:"extent"}}}}})],e.prototype,"fullExtent",void 0),u([d()],e.prototype,"gdbVersion",void 0),u([d({readOnly:!0,type:tlt,json:{read:{source:"geometryProperties"}}})],e.prototype,"geometryFieldsInfo",void 0),u([d({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:qK.read}}}})],e.prototype,"geometryType",void 0),u([d({type:Boolean,json:{origins:{service:{read:!0}}}})],e.prototype,"hasM",void 0),u([d({type:Boolean,json:{origins:{service:{read:!0}}}})],e.prototype,"hasZ",void 0),u([d({readOnly:!0,type:E3})],e.prototype,"heightModelInfo",void 0),u([d({type:Date})],e.prototype,"historicMoment",void 0),u([d({readOnly:!0})],e.prototype,"isTable",void 0),u([Me("service","isTable",["type"])],e.prototype,"readIsTableFromService",null),u([d({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],e.prototype,"layerId",void 0),u([d($st)],e.prototype,"minScale",void 0),u([Me("service","minScale",["minScale","effectiveMinScale"])],e.prototype,"readMinScale",null),u([d(Lst)],e.prototype,"maxScale",void 0),u([Me("service","maxScale",["maxScale","effectiveMaxScale"])],e.prototype,"readMaxScale",null),u([d({type:String})],e.prototype,"globalIdField",void 0),u([Me("service","globalIdField",["globalIdField","fields"])],e.prototype,"readGlobalIdFieldFromService",null),u([d({type:String})],e.prototype,"objectIdField",void 0),u([Me("service","objectIdField",["objectIdField","fields"])],e.prototype,"readObjectIdFieldFromService",null),u([d({type:$O})],e.prototype,"preferredTimeReference",void 0),u([d({type:[ilt],readOnly:!0})],e.prototype,"relationships",void 0),u([d()],e.prototype,"sourceJSON",void 0),u([d({type:Boolean})],e.prototype,"returnM",void 0),u([d({type:Boolean})],e.prototype,"returnZ",void 0),u([d({readOnly:!0})],e.prototype,"serviceDefinitionExpression",void 0),u([Me("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],e.prototype,"readServiceDefinitionExpression",null),u([d({type:String,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],e.prototype,"serviceItemId",void 0),u([d({type:Je,json:{origins:{service:{read:{source:"extent.spatialReference"}}}}})],e.prototype,"spatialReference",void 0),u([d({type:String,readOnly:!0,json:{origins:{service:{read:!0}}}})],e.prototype,"subtypeField",void 0),u([d({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],e.prototype,"trackIdField",void 0),u([d({readOnly:!0,json:{write:!1}})],e.prototype,"serverGens",void 0),u([d({type:ct.ofType(xg),readOnly:!0})],e.prototype,"indexes",void 0),u([d(Rst)],e.prototype,"url",null),u([De("url")],e.prototype,"writeUrl",null),u([d({json:{origins:{service:{read:!0}},read:!1}})],e.prototype,"version",void 0),u([Me("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],e.prototype,"readVersion",null),e=u([$("esri.layers.mixins.FeatureLayerBase")],e),e};let jC=class extends bi(fe){constructor(e){super(e),this.expression=null,this.title=null,this.returnType=null}};u([d({type:String,json:{write:!0}})],jC.prototype,"expression",void 0),u([d({type:String,json:{write:!0}})],jC.prototype,"title",void 0),u([d({type:String,json:{write:!0}})],jC.prototype,"returnType",void 0),jC=u([$("esri.layers.support.ExpressionInfo")],jC);const moe=jC;var XK;let c0=XK=class extends fe{constructor(t){super(t),this.isAutoGenerated=!1,this.name=null,this.alias=null,this.onStatisticField=null,this.onStatisticExpression=null,this.statisticType=null}clone(){return new XK({name:this.name,alias:this.alias,isAutoGenerated:this.isAutoGenerated,onStatisticExpression:se(this.onStatisticExpression),onStatisticField:this.onStatisticField,statisticType:this.statisticType})}};u([d({type:Boolean,json:{write:!0}})],c0.prototype,"isAutoGenerated",void 0),u([d({type:String,json:{write:!0}})],c0.prototype,"name",void 0),u([d({type:String,json:{write:!0}})],c0.prototype,"alias",void 0),u([d({type:String,json:{write:!0}})],c0.prototype,"onStatisticField",void 0),u([d({type:moe,json:{write:!0}})],c0.prototype,"onStatisticExpression",void 0),u([d({type:String,json:{write:!0}})],c0.prototype,"statisticType",void 0),c0=XK=u([$("esri.layers.support.AggregateField")],c0);const u2=c0;let Nb=class extends fe{constructor(){super(...arguments),this.type=null}};u([d({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],Nb.prototype,"type",void 0),Nb=u([$("esri.layers.support.FeatureReduction")],Nb);const goe="__begin__",yoe="__end__",glt=new RegExp(goe,"ig"),ylt=new RegExp(yoe,"ig"),ime=new RegExp("^"+goe,"i"),nme=new RegExp(yoe+"$","i"),Nz='"',_lt=Nz+" + ",vlt=" + "+Nz;function blt(t){return t.replace(new RegExp("\\[","g"),"{").replace(new RegExp("\\]","g"),"}")}function wlt(t){return t.replace(new RegExp("\\{","g"),"[").replace(new RegExp("\\}","g"),"]")}function EB(t){const e={expression:"",type:"none"};return t.labelExpressionInfo?t.labelExpressionInfo.value?(e.expression=t.labelExpressionInfo.value,e.type="conventional"):t.labelExpressionInfo.expression&&(e.expression=t.labelExpressionInfo.expression,e.type="arcade"):t.labelExpression!=null&&(e.expression=blt(t.labelExpression),e.type="conventional"),e}function xlt(t){const e=EB(t);if(!e)return null;switch(e.type){case"conventional":return YK(e.expression);case"arcade":return e.expression}return null}function Tlt(t){const e=EB(t);if(!e)return null;switch(e.type){case"conventional":return Elt(e.expression);case"arcade":return _oe(e.expression)}return null}function YK(t){let e;return t?(e=ty(t,r=>goe+'$feature["'+r+'"]'+yoe),e=ime.test(e)?e.replace(ime,""):Nz+e,e=nme.test(e)?e.replace(nme,""):e+Nz,e=e.replace(glt,_lt).replace(ylt,vlt)):e='""',e}const Slt=/^\s*\{([^}]+)\}\s*$/i;function Elt(t){const e=t==null?void 0:t.match(Slt);return e&&e[1].trim()||null}const Clt=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,Alt=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,Rlt=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function _oe(t){if(!t)return null;let e=Clt.exec(t)||Alt.exec(t);return e?e[1]||e[3]:(e=Rlt.exec(t),e?e[2]:null)}var ZK;let l1=ZK=class extends fe{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(t,e){return e.value?YK(e.value):t}writeExpression(t,e,r){this.value!=null&&(t=YK(this.value)),t!=null&&(e[r]=t)}clone(){return new ZK({expression:this.expression,title:this.title,value:this.value})}};u([d({type:String,json:{write:{writerEnsuresNonNull:!0}}})],l1.prototype,"expression",void 0),u([Me("expression",["expression","value"])],l1.prototype,"readExpression",null),u([De("expression")],l1.prototype,"writeExpression",null),u([d({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],l1.prototype,"title",void 0),u([d({json:{read:!1,write:!1}})],l1.prototype,"value",void 0),l1=ZK=u([$("esri.layers.support.LabelExpressionInfo")],l1);const vPe=l1,bPe=[252,146,31,255],DBt=[153,153,153,255],Olt={type:"esriSMS",style:"esriSMSCircle",size:6,color:bPe,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},Mlt={type:"esriSLS",style:"esriSLSSolid",width:.75,color:bPe},Plt={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},Ilt={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},$lt={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},Llt={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},Dlt={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null},NBt=Pw.fromJSON(Olt),FBt=Lp.fromJSON(Mlt),kBt=Mw.fromJSON(Plt),Nlt=y3.fromJSON(Ilt),UBt=Pw.fromJSON($lt),zBt=Lp.fromJSON(Llt),VBt=Mw.fromJSON(Dlt);var JK;const h4=new mr({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function d4(t,e,r){return{enabled:!fOe(r==null?void 0:r.layer)}}function wPe(t){var e;return!t||t.origin!=="service"&&((e=t.layer)==null?void 0:e.type)!=="map-image"}function Flt(t){return(t==null?void 0:t.type)==="map-image"}function xPe(t){var e,r;return!!Flt(t)&&!!((r=(e=t.capabilities)==null?void 0:e.exportMap)!=null&&r.supportsArcadeExpressionForLabeling)}function klt(t){return wPe(t)||xPe(t==null?void 0:t.layer)}let Ps=JK=class extends fe{static evaluateWhere(t,e){const r=(i,n,s)=>{switch(n){case"=":return i==s;case"<>":return i!=s;case">":return i>s;case">=":return i>=s;case"<":return i<s;case"<=":return i<=s}return!1};try{if(t==null)return!0;const i=t.split(" ");if(i.length===3)return r(e[i[0]],i[1],i[2]);if(i.length===7){const n=r(e[i[0]],i[1],i[2]),s=i[3],o=r(e[i[4]],i[5],i[6]);switch(s){case"AND":return n&&o;case"OR":return n||o}}return!1}catch{console.log("Error.: can't parse = "+t)}}constructor(t){super(t),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=Nlt,this.useCodedValues=void 0,this.where=null}readLabelExpression(t,e){const r=e.labelExpressionInfo;if(!r||!r.value&&!r.expression)return t}writeLabelExpression(t,e,r){if(this.labelExpressionInfo){if(this.labelExpressionInfo.value!=null)t=wlt(this.labelExpressionInfo.value);else if(this.labelExpressionInfo.expression!=null){const i=_oe(this.labelExpressionInfo.expression);i&&(t="["+i+"]")}}t!=null&&(e[r]=t)}writeLabelExpressionInfo(t,e,r,i){if(t==null&&this.labelExpression!=null&&wPe(i))t=new vPe({expression:this.getLabelExpressionArcade()});else if(!t)return;const n=t.toJSON(i);n.expression&&(e[r]=n)}writeMaxScale(t,e){(t||this.minScale)&&(e.maxScale=t)}writeMinScale(t,e){(t||this.maxScale)&&(e.minScale=t)}getLabelExpression(){return EB(this)}getLabelExpressionArcade(){return xlt(this)}getLabelExpressionSingleField(){return Tlt(this)}hash(){return JSON.stringify(this)}clone(){return new JK({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:se(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:se(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};u([d({type:String,json:{write:!0}})],Ps.prototype,"name",void 0),u([d({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1},"portal-item":{default:!1,write:{overridePolicy:d4}}}}})],Ps.prototype,"allowOverrun",void 0),u([d({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1},"portal-item":{default:"static",write:{overridePolicy:d4}}}}})],Ps.prototype,"deconflictionStrategy",void 0),u([d({type:String,json:{write:{overridePolicy(t,e,r){return this.labelExpressionInfo&&(r==null?void 0:r.origin)==="service"&&xPe(r.layer)?{enabled:!1}:{allowNull:!0}}}}})],Ps.prototype,"labelExpression",void 0),u([Me("labelExpression")],Ps.prototype,"readLabelExpression",null),u([De("labelExpression")],Ps.prototype,"writeLabelExpression",null),u([d({type:vPe,json:{write:{overridePolicy:(t,e,r)=>klt(r)?{allowNull:!0}:{enabled:!1}}}})],Ps.prototype,"labelExpressionInfo",void 0),u([De("labelExpressionInfo")],Ps.prototype,"writeLabelExpressionInfo",null),u([d({type:h4.apiValues,json:{type:h4.jsonValues,read:h4.read,write:h4.write}})],Ps.prototype,"labelPlacement",void 0),u([d({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],Ps.prototype,"labelPosition",void 0),u([d({type:Number})],Ps.prototype,"maxScale",void 0),u([De("maxScale")],Ps.prototype,"writeMaxScale",null),u([d({type:Number})],Ps.prototype,"minScale",void 0),u([De("minScale")],Ps.prototype,"writeMinScale",null),u([d({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:d4}}}}})],Ps.prototype,"repeatLabel",void 0),u([d({type:Number,cast:yi,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:d4}}}}})],Ps.prototype,"repeatLabelDistance",void 0),u([d({types:QXe,json:{origins:{"web-scene":{types:eYe,write:ife,default:null}},write:ife,default:null}})],Ps.prototype,"symbol",void 0),u([d({type:Boolean,json:{write:!0}})],Ps.prototype,"useCodedValues",void 0),u([d({type:String,json:{write:!0}})],Ps.prototype,"where",void 0),Ps=JK=u([$("esri.layers.support.LabelClass")],Ps);const CB=Ps;var KK;const NG=Ew({types:Z9}),Ult="esri.layers.support.FeatureReductionBinning";let yc=KK=class extends Nb{constructor(t){super(t),this.type="binning",this.binType="geohash",this.fixedBinLevel=3,this.labelingInfo=null,this.labelsVisible=!0,this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.fields=[],this.renderer=null}writeFields(t,e,r){const i=t.filter(n=>n.statisticType!=="avg_angle").map(n=>n.toJSON());ma(r,i,e)}readRenderer(t,e,r){var n;const i=(n=e.drawingInfo)==null?void 0:n.renderer;return i?iD(i,e,r)??void 0:e.defaultSymbol?e.types&&e.types.length?new PN({defaultSymbol:NG(e.defaultSymbol,e,r),field:e.typeIdField,uniqueValueInfos:e.types.map(s=>({id:s.id,symbol:NG(s.symbol,s,r)}))}):new MO({symbol:NG(e.defaultSymbol,e,r)}):null}clone(){return new KK({fields:se(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:se(this.labelingInfo),labelsVisible:this.labelsVisible,maxScale:this.maxScale,popupEnabled:this.popupEnabled,popupTemplate:se(this.popupTemplate),renderer:se(this.renderer)})}};u([st({binning:"binning"})],yc.prototype,"type",void 0),u([st({geohash:"geohash"})],yc.prototype,"binType",void 0),u([d({type:Number,range:{min:1,max:9},json:{write:!0}})],yc.prototype,"fixedBinLevel",void 0),u([d({type:[CB],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],yc.prototype,"labelingInfo",void 0),u([d(ooe)],yc.prototype,"labelsVisible",void 0),u([d({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],yc.prototype,"maxScale",void 0),u([d(soe)],yc.prototype,"popupEnabled",void 0),u([d({type:fN,json:{name:"popupInfo",write:!0}})],yc.prototype,"popupTemplate",void 0),u([d({type:[u2],json:{write:!0}})],yc.prototype,"fields",void 0),u([De("fields")],yc.prototype,"writeFields",null),u([d({types:bB,json:{write:{target:"drawingInfo.renderer"}}})],yc.prototype,"renderer",void 0),u([Me("renderer",["drawingInfo.renderer"])],yc.prototype,"readRenderer",null),yc=KK=u([$(Ult)],yc);const TPe=yc;var QK;const FG=Ew({types:Z9}),zlt="esri.layers.support.FeatureReductionCluster";function sme(t){var e;return t.type==="simple"&&!((e=t.visualVariables)!=null&&e.length)}let xo=QK=class extends fe{constructor(t){super(t),this.type="cluster",this.clusterRadius=yi("80px"),this.clusterMinSize=yi("12px"),this.clusterMaxSize=yi("50px"),this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=null}readRenderer(t,e,r){var n,s;const i=(n=e.drawingInfo)==null?void 0:n.renderer;return(s=i==null?void 0:i.authoringInfo)!=null&&s.isAutoGenerated?null:i?sme(i)?null:iD(i,e,r)??void 0:e.defaultSymbol?e.types&&e.types.length?new PN({defaultSymbol:FG(e.defaultSymbol,e,r),field:e.typeIdField,uniqueValueInfos:e.types.map(o=>({id:o.id,symbol:FG(o.symbol,o,r)}))}):new MO({symbol:FG(e.defaultSymbol,e,r)}):null}readSymbol(t,e,r){var n,s,o;const i=(n=e.drawingInfo)==null?void 0:n.renderer;return(s=i==null?void 0:i.authoringInfo)!=null&&s.isAutoGenerated?null:i&&sme(i)?(o=iD(i,e,r))==null?void 0:o.symbol:null}writeSymbol(t,e,r,i){var s,o;const n=(o=(s=this.renderer)==null?void 0:s.authoringInfo)==null?void 0:o.isAutoGenerated;if(!this.renderer||n){const a=new MO({symbol:t});e.drawingInfo={renderer:a.write({},i)}}}writeFields(t,e,r){const i=t.filter(n=>n.statisticType!=="avg_angle").map(n=>n.toJSON());ma(r,i,e)}readFields(t,e,r){return t.filter(i=>!i.isAutoGenerated).map(i=>u2.fromJSON(i))}clone(){return new QK({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:se(this.labelingInfo),labelsVisible:this.labelsVisible,fields:se(this.fields),maxScale:this.maxScale,renderer:se(this.renderer),symbol:se(this.symbol),popupEnabled:this.popupEnabled,popupTemplate:se(this.popupTemplate)})}};u([d({type:["cluster"],readOnly:!0,json:{write:!0}})],xo.prototype,"type",void 0),u([d({type:Number,cast:t=>t==="auto"?t:yi(t),json:{write:!0}})],xo.prototype,"clusterRadius",void 0),u([d({type:Number,cast:yi,json:{write:!0}})],xo.prototype,"clusterMinSize",void 0),u([d({type:Number,cast:yi,json:{write:!0}})],xo.prototype,"clusterMaxSize",void 0),u([d({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],xo.prototype,"maxScale",void 0),u([d(soe)],xo.prototype,"popupEnabled",void 0),u([d({type:fN,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],xo.prototype,"popupTemplate",void 0),u([d({types:bB,json:{write:{target:"drawingInfo.renderer"}}})],xo.prototype,"renderer",void 0),u([Me("renderer",["drawingInfo.renderer"])],xo.prototype,"readRenderer",null),u([d({types:JXe})],xo.prototype,"symbol",void 0),u([Me("symbol",["drawingInfo.renderer"])],xo.prototype,"readSymbol",null),u([De("symbol")],xo.prototype,"writeSymbol",null),u([d({type:[CB],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],xo.prototype,"labelingInfo",void 0),u([d(ooe)],xo.prototype,"labelsVisible",void 0),u([d({type:[u2],json:{write:!0}})],xo.prototype,"fields",void 0),u([De("fields")],xo.prototype,"writeFields",null),u([Me("fields")],xo.prototype,"readFields",null),xo=QK=u([$(zlt)],xo);const SPe=xo;var eQ;let Q6=eQ=class extends Nb{constructor(t){super(t),this.type="selection"}clone(){return new eQ}};u([d({type:["selection"]})],Q6.prototype,"type",void 0),Q6=eQ=u([$("esri.layers.support.FeatureReductionSelection")],Q6);const ome=Q6,ame={key:"type",base:Nb,typeMap:{cluster:SPe,binning:TPe}},Vlt={types:{key:"type",base:Nb,typeMap:{selection:ome,cluster:SPe,binning:TPe}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:ame},"portal-item":{types:ame},"web-scene":{types:{key:"type",base:Nb,typeMap:{selection:ome}}}}}},rE={Base64:0,Hex:1,String:2,Raw:3},IR=8,EPe=(1<<IR)-1;function gb(t,e){const r=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(r>>16)<<16|65535&r}function Blt(t){const e=[];for(let r=0,i=t.length*IR;r<i;r+=IR)e[r>>5]|=(t.charCodeAt(r/IR)&EPe)<<r%32;return e}function jlt(t){const e=[];for(let r=0,i=32*t.length;r<i;r+=IR)e.push(String.fromCharCode(t[r>>5]>>>r%32&EPe));return e.join("")}function Glt(t){const e="0123456789abcdef",r=[];for(let i=0,n=4*t.length;i<n;i++)r.push(e.charAt(t[i>>2]>>i%4*8+4&15)+e.charAt(t[i>>2]>>i%4*8&15));return r.join("")}function Hlt(t){const e="=",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=[];for(let n=0,s=4*t.length;n<s;n+=3){const o=(t[n>>2]>>n%4*8&255)<<16|(t[n+1>>2]>>(n+1)%4*8&255)<<8|t[n+2>>2]>>(n+2)%4*8&255;for(let a=0;a<4;a++)8*n+6*a>32*t.length?i.push(e):i.push(r.charAt(o>>6*(3-a)&63))}return i.join("")}function qlt(t,e){return t<<e|t>>>32-e}function AB(t,e,r,i,n,s){return gb(qlt(gb(gb(e,t),gb(i,s)),n),r)}function xl(t,e,r,i,n,s,o){return AB(e&r|~e&i,t,e,n,s,o)}function Tl(t,e,r,i,n,s,o){return AB(e&i|r&~i,t,e,n,s,o)}function Sl(t,e,r,i,n,s,o){return AB(e^r^i,t,e,n,s,o)}function El(t,e,r,i,n,s,o){return AB(r^(e|~i),t,e,n,s,o)}function Wlt(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;let r=1732584193,i=-271733879,n=-1732584194,s=271733878;for(let o=0;o<t.length;o+=16){const a=r,l=i,c=n,h=s;r=xl(r,i,n,s,t[o+0],7,-680876936),s=xl(s,r,i,n,t[o+1],12,-389564586),n=xl(n,s,r,i,t[o+2],17,606105819),i=xl(i,n,s,r,t[o+3],22,-1044525330),r=xl(r,i,n,s,t[o+4],7,-176418897),s=xl(s,r,i,n,t[o+5],12,1200080426),n=xl(n,s,r,i,t[o+6],17,-1473231341),i=xl(i,n,s,r,t[o+7],22,-45705983),r=xl(r,i,n,s,t[o+8],7,1770035416),s=xl(s,r,i,n,t[o+9],12,-1958414417),n=xl(n,s,r,i,t[o+10],17,-42063),i=xl(i,n,s,r,t[o+11],22,-1990404162),r=xl(r,i,n,s,t[o+12],7,1804603682),s=xl(s,r,i,n,t[o+13],12,-40341101),n=xl(n,s,r,i,t[o+14],17,-1502002290),i=xl(i,n,s,r,t[o+15],22,1236535329),r=Tl(r,i,n,s,t[o+1],5,-165796510),s=Tl(s,r,i,n,t[o+6],9,-1069501632),n=Tl(n,s,r,i,t[o+11],14,643717713),i=Tl(i,n,s,r,t[o+0],20,-373897302),r=Tl(r,i,n,s,t[o+5],5,-701558691),s=Tl(s,r,i,n,t[o+10],9,38016083),n=Tl(n,s,r,i,t[o+15],14,-660478335),i=Tl(i,n,s,r,t[o+4],20,-405537848),r=Tl(r,i,n,s,t[o+9],5,568446438),s=Tl(s,r,i,n,t[o+14],9,-1019803690),n=Tl(n,s,r,i,t[o+3],14,-187363961),i=Tl(i,n,s,r,t[o+8],20,1163531501),r=Tl(r,i,n,s,t[o+13],5,-1444681467),s=Tl(s,r,i,n,t[o+2],9,-51403784),n=Tl(n,s,r,i,t[o+7],14,1735328473),i=Tl(i,n,s,r,t[o+12],20,-1926607734),r=Sl(r,i,n,s,t[o+5],4,-378558),s=Sl(s,r,i,n,t[o+8],11,-2022574463),n=Sl(n,s,r,i,t[o+11],16,1839030562),i=Sl(i,n,s,r,t[o+14],23,-35309556),r=Sl(r,i,n,s,t[o+1],4,-1530992060),s=Sl(s,r,i,n,t[o+4],11,1272893353),n=Sl(n,s,r,i,t[o+7],16,-155497632),i=Sl(i,n,s,r,t[o+10],23,-1094730640),r=Sl(r,i,n,s,t[o+13],4,681279174),s=Sl(s,r,i,n,t[o+0],11,-358537222),n=Sl(n,s,r,i,t[o+3],16,-722521979),i=Sl(i,n,s,r,t[o+6],23,76029189),r=Sl(r,i,n,s,t[o+9],4,-640364487),s=Sl(s,r,i,n,t[o+12],11,-421815835),n=Sl(n,s,r,i,t[o+15],16,530742520),i=Sl(i,n,s,r,t[o+2],23,-995338651),r=El(r,i,n,s,t[o+0],6,-198630844),s=El(s,r,i,n,t[o+7],10,1126891415),n=El(n,s,r,i,t[o+14],15,-1416354905),i=El(i,n,s,r,t[o+5],21,-57434055),r=El(r,i,n,s,t[o+12],6,1700485571),s=El(s,r,i,n,t[o+3],10,-1894986606),n=El(n,s,r,i,t[o+10],15,-1051523),i=El(i,n,s,r,t[o+1],21,-2054922799),r=El(r,i,n,s,t[o+8],6,1873313359),s=El(s,r,i,n,t[o+15],10,-30611744),n=El(n,s,r,i,t[o+6],15,-1560198380),i=El(i,n,s,r,t[o+13],21,1309151649),r=El(r,i,n,s,t[o+4],6,-145523070),s=El(s,r,i,n,t[o+11],10,-1120210379),n=El(n,s,r,i,t[o+2],15,718787259),i=El(i,n,s,r,t[o+9],21,-343485551),r=gb(r,a),i=gb(i,l),n=gb(n,c),s=gb(s,h)}return[r,i,n,s]}function CPe(t,e=rE.Hex){const r=e||rE.Base64,i=Wlt(Blt(t),t.length*IR);switch(r){case rE.Raw:return i;case rE.Hex:return Glt(i);case rE.String:return jlt(i);case rE.Base64:return Hlt(i)}}var tQ;let iI=tQ=class extends vB{writeLevels(t,e,r){for(const i in t){const n=this.levels[i];return void(e.stops=n)}}clone(){return new tQ({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:mb(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:mb(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(t=>t.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone(),levels:se(this.levels)})}};u([d()],iI.prototype,"levels",void 0),u([De("levels")],iI.prototype,"writeLevels",null),iI=tQ=u([$("esri.views.2d.engine.LevelDependentSizeVariable")],iI);const Xlt=re.getLogger("esri.views.2d.layers.support.clusterUtils");ue.add("esri-cluster-arcade-enabled",!0);const Ylt=ue("esri-cluster-arcade-enabled"),Zlt=(t,e,r,i,n)=>{const s=e.clone();if(!Klt(s))return s;if(s.authoringInfo||(s.authoringInfo=new Yse),s.authoringInfo.isAutoGenerated=!0,"visualVariables"in s){const o=(s.visualVariables||[]).filter(l=>l.valueExpression!=="$view.scale"),a=APe(o);o.forEach(l=>{l.type==="rotation"?l.field?l.field=qw(t,l.field,"avg_angle","number"):l.valueExpression&&(l.field=bM(t,l.valueExpression,"avg_angle","number"),l.valueExpression=null):l.normalizationField?(l.field=qw(t,l.field,"avg_norm","number",l.normalizationField),l.normalizationField=null):l.field?l.field=qw(t,l.field,"avg","number"):l.valueExpression&&(l.field=bM(t,l.valueExpression,"avg","number"),l.valueExpression=null)}),R(a)&&!Jlt(o)&&n&&(o.push(RPe(r,i)),s.dynamicClusterSize=!0),s.visualVariables=o}switch(s.type){case"simple":break;case"pie-chart":for(const o of s.attributes)o.field?o.field=qw(t,o.field,"sum","number"):o.valueExpression&&(o.field=bM(t,o.valueExpression,"sum","number"),o.valueExpression=null);break;case"unique-value":s.field?s.field=qw(t,s.field,"mode","string"):s.valueExpression&&(s.field=bM(t,s.valueExpression,"mode","string"),s.valueExpression=null);break;case"class-breaks":s.normalizationField?(s.field=qw(t,s.field,"avg_norm","number",s.normalizationField),s.normalizationField=null):s.field?s.field=qw(t,s.field,"avg","number"):s.valueExpression&&(s.field=bM(t,s.valueExpression,"avg","number"),s.valueExpression=null)}return s},APe=t=>{for(const e of t)if(e.type==="size")return e;return null};function BBt(t,e,r){const i=t.clone();let n=!1;if("visualVariables"in i){const s=(i.visualVariables||[]).filter(a=>a.valueExpression!=="$view.scale"),o=APe(s);R(o)&&(i.visualVariables||(i.visualVariables=[]),i.visualVariables.push(RPe(e,r)),i.dynamicClusterSize=!0,n=!0)}return{renderer:i,didInject:n}}const Jlt=t=>{for(const e of t)if(e.field==="cluster_count")return!0;return!1},RPe=(t,e)=>{const r=[new DC({value:0,size:0}),new DC({value:1})];if(R(e))return new vB({field:"cluster_count",stops:[...r,new DC({value:2,size:0})]});const i=Object.keys(e).reduce((n,s)=>({...n,[s]:[...r,new DC({value:Math.max(2,e[s].minValue),size:t.clusterMinSize}),new DC({value:Math.max(3,e[s].maxValue),size:t.clusterMaxSize})]}),{});return new iI({field:"cluster_count",levels:i})},Klt=t=>{const e=r=>Xlt.error(new H("Unsupported-renderer",r,{renderer:t}));switch(t.type){case"unique-value":if(t.field2||t.field3)return e("FeatureReductionCluster does not support multi-field UniqueValueRenderers"),!1;break;case"class-breaks":if(t.normalizationField){const r=t.normalizationType;if(r!=="field")return e(`FeatureReductionCluster does not support a normalizationType of ${r}`),!1}break;case"simple":case"pie-chart":break;default:return e(`FeatureReductionCluster does not support renderers of type ${t.type}`),!1}if(!Ylt){if("valueExpression"in t&&t.valueExpression)return e("FeatureReductionCluster does not currently support renderer.valueExpression. Support will be added in a future release"),!1;if(("visualVariables"in t&&t.visualVariables||[]).some(r=>!(!("valueExpression"in r)||!r.valueExpression)))return e("FeatureReductionCluster does not currently support visualVariables with a valueExpression. Support will be added in a future release"),!1}return!0};function Qlt(t,e,r){switch(t){case"sum":return`cluster_sum_${e}`;case"avg":case"avg_angle":return`cluster_avg_${e}`;case"mode":return`cluster_type_${e}`;case"avg_norm":{const i=r,n="field",s=e.toLowerCase()+",norm:"+n+","+i.toLowerCase();return"cluster_avg_"+CPe(s)}}}function bM(t,e,r,i){const n=CPe(e),s=r==="mode"?`cluster_type_${n}`:r==="sum"?`cluster_sum_${n}`:`cluster_avg_${n}`;return t.some(o=>o.name===s)||t.push(new u2({name:s,isAutoGenerated:!0,onStatisticExpression:new moe({expression:e,returnType:i}),statisticType:r})),s}function qw(t,e,r,i,n){if(e==="cluster_count"||t.some(o=>o.name===e))return e;const s=Qlt(r,e,n);return t.some(o=>o.name===s)||(r==="avg_norm"?t.push(new u2({name:s,isAutoGenerated:!0,onStatisticExpression:new moe({expression:`$feature.${e} / $feature.${n}`,returnType:i}),statisticType:"avg"})):t.push(new u2({name:s,isAutoGenerated:!0,onStatisticField:e,statisticType:r}))),s}const ect=t=>{let e=class extends t{constructor(...r){super(...r),this.own(this.watch("renderer",()=>{if(this.featureReduction){const i=this._normalizeFeatureReduction(this.featureReduction);this._set("featureReduction",i)}},!0))}set featureReduction(r){const i=this._normalizeFeatureReduction(r);this._set("featureReduction",i)}set renderer(r){}_normalizeFeatureReduction(r){var a;if((r==null?void 0:r.type)!=="cluster")return r;const i=r.clone(),n=[new u2({name:"cluster_count",isAutoGenerated:!0,statisticType:"count"})],s=(i.fields??[]).filter(l=>!l.isAutoGenerated);if(r.renderer&&!((a=r.renderer.authoringInfo)!=null&&a.isAutoGenerated))return i.fields=[...n,...s],i;if(r.symbol)return i.fields=[...n,...s],i.renderer=null,i;if(!this.renderer)return r;const o=Zlt(n,this.renderer,r,null,!1);return i.fields=[...n,...s],i.renderer=o,i}};return u([d(Vlt)],e.prototype,"featureReduction",null),e=u([$("esri.layers.mixins.FeatureReductionLayer")],e),e},tct={"web-scene/operational-layers":{ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,GroupLayer:!0,IntegratedMeshLayer:!0,OGCFeatureLayer:!0,PointCloudLayer:!0,WebTiledLayer:!0,CSV:!0,GeoJSON:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,KML:!0,RasterDataLayer:!0,Voxel:!0,LineOfSightLayer:!0},"web-scene/basemap":{ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,WebTiledLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,ArcGISImageServiceLayer:!0,WMS:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-map/operational-layers":{ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CSV:!0,GeoRSS:!0,GeoJSON:!0,GroupLayer:!0,KML:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},"web-map/basemap":{ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0,BingMapsAerial:!0,BingMapsRoad:!0,BingMapsHybrid:!0},"web-map/tables":{ArcGISFeatureLayer:!0},"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISSceneServiceLayer:!0,PointCloudLayer:!0,BuildingSceneLayer:!0,IntegratedMeshLayer:!0,OrientedImageryLayer:!0}},OPe=t=>{let e=class extends t{constructor(){super(...arguments),this.title=null}writeListMode(r,i,n,s){(s&&s.layerContainerType==="ground"||r&&jje(this,n,{},s))&&(i[n]=r)}writeOperationalLayerType(r,i,n,s){!r||s&&s.layerContainerType==="tables"||(i.layerType=r)}writeTitle(r,i){i.title=r??"Layer"}read(r,i){i&&(i.layer=this),T2e(this,r,n=>super.read(r,n),i)}write(r,i){var o,a;if(i!=null&&i.origin){const l=`${i.origin}/${i.layerContainerType||"operational-layers"}`,c=tct[l];let h=c&&c[this.operationalLayerType];if(this.operationalLayerType==="ArcGISTiledElevationServiceLayer"&&l==="web-scene/operational-layers"&&(h=!1),this.operationalLayerType==="ArcGISDimensionLayer"&&l==="web-map/operational-layers"&&(h=!1),!h)return(o=i.messages)==null||o.push(new H("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${l}'`,{layer:this})),null}const n=super.write(r,{...i,layer:this}),s=!!i&&!!i.messages&&!!i.messages.filter(l=>l instanceof H&&l.name==="web-document-write:property-required").length;return Zb(n==null?void 0:n.url)?((a=i==null?void 0:i.messages)==null||a.push(new H("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&s?null:n}beforeSave(){}};return u([d({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],e.prototype,"id",void 0),u([d(gMe)],e.prototype,"listMode",void 0),u([De("listMode")],e.prototype,"writeListMode",null),u([d({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1}}}})],e.prototype,"operationalLayerType",void 0),u([De("operationalLayerType")],e.prototype,"writeOperationalLayerType",null),u([d(UK)],e.prototype,"opacity",void 0),u([d({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],e.prototype,"title",void 0),u([De("title"),De(["web-scene"],"title")],e.prototype,"writeTitle",null),u([d({type:Boolean,json:{name:"visibility"}})],e.prototype,"visible",void 0),e=u([$("esri.layers.mixins.OperationalLayer")],e),e};var rQ;const kG=new mr({asc:"ascending",desc:"descending"});let GC=rQ=class extends fe{constructor(t){super(t),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new rQ({field:this.field,valueExpression:this.valueExpression,order:this.order})}};u([d({type:String,json:{write:!0}})],GC.prototype,"field",void 0),u([d({type:String,json:{write:!0}})],GC.prototype,"valueExpression",void 0),u([d({type:kG.apiValues,json:{read:kG.read,write:kG.write}})],GC.prototype,"order",void 0),GC=rQ=u([$("esri.layers.support.OrderByInfo")],GC);const MPe=GC;function rct(t,e,r){if(!t)return null;const i=t.find(s=>!!s.field);if(!i)return null;const n=new MPe;return n.read(i,r),[n]}function ict(t,e,r,i){const n=t.find(s=>!!s.field);n&&ma(r,[n.toJSON()],e)}const nct=t=>{let e=class extends t{constructor(){super(...arguments),this.orderBy=null}};return u([d({type:[MPe],json:{origins:{"web-scene":{write:!1,read:!1}},read:{source:"layerDefinition.orderBy",reader:rct},write:{target:"layerDefinition.orderBy",writer:ict}}})],e.prototype,"orderBy",void 0),e=u([$("esri.layers.mixins.OrderedLayer")],e),e};let c1=class extends be{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e&&e.portalItem&&e.path?{...e,path:this._normalizePath(e.path,e.portalItem)}:e}set path(e){v(e)&&Bu(e)?re.getLogger(this.declaredClass).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return this._normalizePath(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",r){const i=this.url;if(R(i))throw new H("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(i,{responseType:e,query:{token:this.portalItem.apiKey},signal:Xs(r,"signal")})}async update(e,r){return(await Q(()=>import("./resourceUtils-49972048.js"),[])).addOrUpdateResource(this,"update",e,r)}hasPath(){return v(this.path)}_normalizePath(e,r){return R(e)?e:(e=e.replace(/^\/+/,""),v(r)&&Bu(e)&&(e=kne(e,r.itemUrl)),e==null?void 0:e.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}};u([d()],c1.prototype,"portalItem",void 0),u([d({type:String,value:null})],c1.prototype,"path",null),u([cr("path")],c1.prototype,"_castPath",null),u([d({type:String,readOnly:!0})],c1.prototype,"url",null),u([d({type:String,readOnly:!0})],c1.prototype,"itemRelativeUrl",null),c1=u([$("esri.portal.PortalItemResource")],c1);const sct=c1;let nI=class extends be{constructor(e){super(e),this.created=null,this.rating=null}};u([d()],nI.prototype,"created",void 0),u([d()],nI.prototype,"rating",void 0),nI=u([$("esri.portal.PortalRating")],nI);const UG=nI;var hT;const oct=new Set(["Map Service","Feature Service","Feature Collection","Scene Service","Image Service","Stream Service","Vector Tile Service","GeoJson","CSV","KML","WFS","WMTS","WMS","Feed"]),act=new Set(["KML","GeoJson","CSV"]);let Tr=hT=class extends Cw(qu){static from(t){return sO(hT,t)}constructor(t){super(t),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const t=this.type,e=this.typeKeywords||[];let r=t;return t==="Feature Service"||t==="Feature Collection"?r=e.includes("Table")?"Table":e.includes("Route Layer")?"Route Layer":e.includes("Markup")?"Markup":"Feature Layer":t==="Image Service"?r=e.includes("Elevation 3D Layer")?"Elevation Layer":e.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":t==="Scene Service"?r="Scene Layer":t==="Video Service"?r="Video Layer":t==="Scene Package"?r="Scene Layer Package":t==="Stream Service"?r="Feature Layer":t==="Geoprocessing Service"&&this.portal&&this.portal.isPortal?r=e.includes("Web Tool")?"Tool":"Geoprocessing Service":t==="Geocoding Service"?r="Locator":t==="Geoenrichment Service"?r="GeoEnrichment Service":t==="Microsoft Powerpoint"?r="Microsoft PowerPoint":t==="GeoJson"?r="GeoJSON":t==="Globe Service"?r="Globe Layer":t==="Vector Tile Service"?r="Tile Layer":t==="netCDF"?r="NetCDF":t==="Map Service"?r=e.includes("Spatiotemporal")||!e.includes("Hosted Service")&&!e.includes("Tiled")||e.includes("Relational")?"Map Image Layer":"Tile Layer":t&&t.toLowerCase().includes("add in")?r=t.replace(/(add in)/gi,"Add-In"):t==="datastore catalog service"?r="Big Data File Share":t==="Compact Tile Package"?r="Tile Package (tpkx)":t==="OGCFeatureServer"?r="OGC Feature Layer":t==="web mapping application"&&e.includes("configurableApp")?r="Instant App":t==="Insights Page"&&(r="Insights Report"),r}readExtent(t){return t&&t.length?new ur(t[0][0],t[0][1],t[1][0],t[1][1]):null}get iconUrl(){const t=this.type&&this.type.toLowerCase()||"",e=this.typeKeywords||[],r="esri/images/portal/",i="16";let n,s=!1,o=!1,a=!1,l=!1,c=!1,h=!1;return t.indexOf("service")>0||t==="feature collection"||t==="kml"||t==="wms"||t==="wmts"||t==="wfs"?(s=e.includes("Hosted Service"),t==="feature service"||t==="feature collection"||t==="kml"||t==="wfs"?(o=e.includes("Table"),a=e.includes("Route Layer"),l=e.includes("Markup"),c=e.includes("Spatiotemporal"),h=e.includes("UtilityNetwork"),n=c&&o?"spatiotemporaltable":o?"table":a?"routelayer":l?"markup":c?"spatiotemporal":s?"featureshosted":h?"utilitynetwork":"features"):n=t==="map service"||t==="wms"||t==="wmts"?s||e.includes("Tiled")||t==="wmts"?"maptiles":"mapimages":t==="scene service"?e.includes("Line")?"sceneweblayerline":e.includes("3DObject")?"sceneweblayermultipatch":e.includes("Point")?"sceneweblayerpoint":e.includes("IntegratedMesh")?"sceneweblayermesh":e.includes("PointCloud")?"sceneweblayerpointcloud":e.includes("Polygon")?"sceneweblayerpolygon":e.includes("Building")?"sceneweblayerbuilding":e.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":t==="image service"?e.includes("Elevation 3D Layer")?"elevationlayer":e.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":t==="stream service"?"streamlayer":t==="video service"?"mediaservice":t==="vector tile service"?"vectortile":t==="datastore catalog service"?"datastorecollection":t==="geocoding service"?"geocodeservice":t==="geoprocessing service"?e.includes("Web Tool")&&this.portal&&this.portal.isPortal?"tool":"layers":t==="geodata service"?"geodataservice":"layers"):n=t==="web map"||t==="cityengine web scene"?"maps":t==="web scene"?e.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":t==="web mapping application"&&e.includes("configurableApp")?"instantapps":t==="web mapping application"||t==="mobile application"||t==="application"||t==="operation view"||t==="desktop application"?"apps":t==="map document"||t==="map package"||t==="published map"||t==="scene document"||t==="globe document"||t==="basemap package"||t==="mobile basemap package"||t==="mobile map package"||t==="project package"||t==="project template"||t==="pro map"||t==="layout"||t==="layer"&&e.includes("ArcGIS Pro")||t==="explorer map"&&e.indexOf("Explorer Document")?"mapsgray":t==="service definition"||t==="csv"||t==="shapefile"||t==="cad drawing"||t==="geojson"||t==="360 vr experience"||t==="netcdf"||t==="administrative report"?"datafiles":t==="explorer add in"||t==="desktop add in"||t==="windows viewer add in"||t==="windows viewer configuration"?"appsgray":t==="arcgis pro add in"||t==="arcgis pro configuration"?"addindesktop":t==="rule package"||t==="file geodatabase"||t==="sqlite geodatabase"||t==="csv collection"||t==="kml collection"||t==="windows mobile package"||t==="map template"||t==="desktop application template"||t==="gml"||t==="arcpad package"||t==="code sample"||t==="form"||t==="document link"||t==="earth configuration"||t==="operations dashboard add in"||t==="rules package"||t==="image"||t==="workflow manager package"||t==="explorer map"&&e.includes("Explorer Mapping Application")||e.includes("Document")?"datafilesgray":t==="network analysis service"||t==="geoprocessing service"||t==="geodata service"||t==="geometry service"||t==="geoprocessing package"||t==="locator package"||t==="geoprocessing sample"||t==="workflow manager service"?"toolsgray":t==="layer"||t==="layer package"||t==="explorer layer"?"layersgray":t==="scene package"?"scenepackage":t==="mobile scene package"?"mobilescenepackage":t==="tile package"||t==="compact tile package"?"tilepackage":t==="task file"?"taskfile":t==="report template"?"report-template":t==="statistical data collection"?"statisticaldatacollection":t==="insights workbook"?"workbook":t==="insights model"?"insightsmodel":t==="insights page"?"insightspage":t==="insights theme"?"insightstheme":t==="hub initiative"?"hubinitiative":t==="hubpage"?"hubpage":t==="hub event"?"hubevent":t==="hub site application"?"hubsite":t==="hub project"?"hubproject":t==="relational database connection"?"relationaldatabaseconnection":t==="big data file share"?"datastorecollection":t==="image collection"?"imagecollection":t==="style"?"style":t==="desktop style"?"desktopstyle":t==="dashboard"?"dashboard":t==="raster function template"?"rasterprocessingtemplate":t==="vector tile package"?"vectortilepackage":t==="ortho mapping project"?"orthomappingproject":t==="ortho mapping template"?"orthomappingtemplate":t==="solution"?"solutions":t==="geopackage"?"geopackage":t==="deep learning package"?"deeplearningpackage":t==="real time analytic"?"realtimeanalytics":t==="big data analytic"?"bigdataanalytics":t==="feed"?"feed":t==="excalibur imagery project"?"excaliburimageryproject":t==="notebook"?"notebook":t==="storymap"?"storymap":t==="survey123 add in"?"survey123addin":t==="mission"?"mission":t==="mission report"?"missionreport":t==="quickcapture project"?"quickcaptureproject":t==="pro report"?"proreport":t==="pro report template"?"proreporttemplate":t==="urban model"?"urbanmodel":t==="web experience"?"experiencebuilder":t==="web experience template"?"webexperiencetemplate":t==="experience builder widget"?"experiencebuilderwidget":t==="experience builder widget package"?"experiencebuilderwidgetpackage":t==="workflow"?"workflow":t==="insights script"?"insightsscript":t==="kernel gateway connection"?"kernelgatewayconnection":t==="hub initiative template"?"hubinitiativetemplate":t==="storymap theme"?"storymaptheme":t==="knowledge graph"?"knowledgegraph":t==="native application"?"nativeapp":t==="native application installer"?"nativeappinstaller":t==="link chart"?"linkchart":t==="investigation"?"investigation":t==="ogcfeatureserver"?"features":t==="pro project"?"proproject":t==="insights workbook package"?"insightsworkbookpackage":t==="apache parquet"?"apacheparquet":t==="notebook code snippets"||t==="notebook code snippet library"?"notebookcodesnippets":t==="suitability model"?"suitabilitymodel":t==="esri classifier definition"?"classifierdefinition":t==="esri classification schema"?"classificationschema":t==="insights data engineering workbook"?"dataengineeringworkbook":t==="insights data engineering model"?"dataengineeringmodel":t==="deep learning studio project"?"deeplearningproject":t==="discussion"?"discussion":t==="allsource project"?"allsourceproject":t==="api key"?"apikey":"maps",n?si(r+n+i+".png"):null}get isLayer(){return this.type!=null&&oct.has(this.type)}get itemPageUrl(){var e;const t=(e=this.portal)==null?void 0:e.itemPageUrl;return t&&this.id?`${t}?id=${this.id}`:null}get itemUrl(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t&&this.id?`${t}/content/items/${this.id}`:null}get thumbnailUrl(){var r;const t=this.itemUrl,e=this.thumbnail;return t&&e?((r=this.portal)==null?void 0:r.normalizeUrl(`${t}/info/${e}?f=json`))??null:null}get userItemUrl(){const t=this.get("portal.restUrl");if(!t)return null;const e=this.owner||this.get("portal.user.username");return e?`${t}/content/users/${this.ownerFolder?`${e}/${this.ownerFolder}`:e}/items/${this.id}`:null}load(t){const e=this.portal??(this.portal=pa.getDefault()),r=e.load(t).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?e.request(this.itemUrl,{signal:v(t)?t.signal:null,query:{token:this.apiKey}}):{}).then(i=>{this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(r),Promise.resolve(this)}async addRating(t){const e={method:"post",query:{}};return t instanceof UG&&(t=t.rating),t==null||isNaN(t)||typeof t!="number"||(e.query.rating=t),this.portal?(await this.portal.request(this.itemUrl+"/addRating",e),new UG({rating:t,created:new Date})):null}clone(){const t={access:this.access,accessInformation:this.accessInformation,applicationProxies:se(this.applicationProxies),avgRating:this.avgRating,categories:se(this.categories),created:se(this.created),culture:this.culture,description:this.description,extent:se(this.extent),groupCategories:se(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:se(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:se(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:se(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:se(this.typeKeywords),url:this.url};this.loaded&&(t.loadStatus="loaded");const e=new hT({sourceJSON:this.sourceJSON}).set(t);return e._set("isOrgItem",this.isOrgItem),e}createPostQuery(){const t=this.toJSON();for(const r of["tags","typeKeywords","categories"])t[r]&&(t[r]=t[r].join(", "));const{extent:e}=t;return e&&(t.extent=JSON.stringify(e)),t}async deleteRating(){await Ic(this.portal).request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(t="json",e){return Ic(this.portal).request(this.itemUrl+"/data",{responseType:t,...e,query:{token:this.apiKey}})}async fetchRating(t){const e=await Ic(this.portal).request(this.itemUrl+"/rating",{query:{token:this.apiKey},...t});return e.rating!=null?(e.created=new Date(e.created),new UG(e)):null}fetchRelatedItems(t,e){return Ic(this.portal).requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...t,token:this.apiKey},...e},hT)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}reload(){return Ic(this.portal).request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then(t=>(this.sourceJSON=t,this.read(t),this))}update(t){return this.id?this.load().then(()=>Ic(this.portal).signIn()).then(()=>{const e=t&&t.data,r={method:"post"};r.query=this.createPostQuery();for(const i in r.query)r.query[i]===null&&(r.query[i]="");return r.query.clearEmptyFields=!0,e!=null&&(typeof e=="string"?r.query.text=e:typeof e=="object"&&(r.query.text=JSON.stringify(e))),this.portal.request(`${this.userItemUrl}/update`,r).then(()=>this.reload())}):Promise.reject(new H("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(t){if(!this.id)throw new H("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:e,itemUrl:r}=this;await Ic(e).signIn();const{copyResources:i,folder:n,tags:s,title:o}=t||{},a={method:"post",query:{copyPrivateResources:i==="all",folder:typeof n=="string"?n:n==null?void 0:n.id,includeResources:!!i,tags:s==null?void 0:s.join(","),title:o}},{itemId:l}=await e.request(`${r}/copy`,a);return new hT({id:l,portal:e})}updateThumbnail(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t.thumbnail,r=t.filename,i={method:"post"};if(typeof e=="string")cd(e)?i.query={data:e}:i.query={url:Fc(e)},v(r)&&(i.query.filename=r);else{const n=new FormData;v(r)?n.append("file",e,r):n.append("file",e),i.body=n}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,i).then(()=>this.reload())}):Promise.reject(new H("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(t={},e){return(await Q(()=>import("./resourceUtils-49972048.js"),[])).fetchResources(this,t,e)}async addResource(t,e,r){const i=await Q(()=>import("./resourceUtils-49972048.js"),[]);return t.portalItem=this,i.addOrUpdateResource(t,"add",e,r)}async removeResource(t,e){const r=await Q(()=>import("./resourceUtils-49972048.js"),[]);if(t.portalItem&&t.portalItem.itemUrl!==this.itemUrl)throw new H("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return r.removeResource(this,t,e)}async removeAllResources(t){return(await Q(()=>import("./resourceUtils-49972048.js"),[])).removeAllResources(this,t)}resourceFromPath(t){return new sct({portalItem:this,path:t})}toJSON(){const t=this.extent,e={accessInformation:this.accessInformation,categories:se(this.categories),created:this.created&&this.created.getTime(),description:this.description,extent:t&&[[t.xmin,t.ymin],[t.xmax,t.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:this.modified&&this.modified.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:se(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:se(this.typeKeywords),url:this.url};return wSe(e)}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new hT({sourceJSON:t})}_getPostQuery(){const t=this.toJSON();for(const e in t)e==="tags"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="typeKeywords"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="extent"&&t[e]&&(t[e]=JSON.stringify(t[e]));return t}};u([d({type:["private","shared","org","public"]})],Tr.prototype,"access",void 0),u([d()],Tr.prototype,"accessInformation",void 0),u([d({type:String})],Tr.prototype,"apiKey",void 0),u([d({json:{read:{source:"appProxies"}}})],Tr.prototype,"applicationProxies",void 0),u([d()],Tr.prototype,"avgRating",void 0),u([d()],Tr.prototype,"categories",void 0),u([d({type:Date})],Tr.prototype,"created",void 0),u([d()],Tr.prototype,"culture",void 0),u([d()],Tr.prototype,"description",void 0),u([d({readOnly:!0})],Tr.prototype,"displayName",null),u([d({type:ur})],Tr.prototype,"extent",void 0),u([Me("extent")],Tr.prototype,"readExtent",null),u([d()],Tr.prototype,"groupCategories",void 0),u([d({readOnly:!0})],Tr.prototype,"iconUrl",null),u([d()],Tr.prototype,"id",void 0),u([d({readOnly:!0})],Tr.prototype,"isLayer",null),u([d({type:Boolean,readOnly:!0})],Tr.prototype,"isOrgItem",void 0),u([d()],Tr.prototype,"itemControl",void 0),u([d({readOnly:!0})],Tr.prototype,"itemPageUrl",null),u([d({readOnly:!0})],Tr.prototype,"itemUrl",null),u([d()],Tr.prototype,"licenseInfo",void 0),u([d({type:Date})],Tr.prototype,"modified",void 0),u([d()],Tr.prototype,"name",void 0),u([d()],Tr.prototype,"numComments",void 0),u([d()],Tr.prototype,"numRatings",void 0),u([d()],Tr.prototype,"numViews",void 0),u([d()],Tr.prototype,"owner",void 0),u([d()],Tr.prototype,"ownerFolder",void 0),u([d({type:pa})],Tr.prototype,"portal",void 0),u([d()],Tr.prototype,"screenshots",void 0),u([d()],Tr.prototype,"size",void 0),u([d()],Tr.prototype,"snippet",void 0),u([d()],Tr.prototype,"sourceJSON",void 0),u([d({type:String})],Tr.prototype,"sourceUrl",void 0),u([d({type:String})],Tr.prototype,"spatialReference",void 0),u([d()],Tr.prototype,"tags",void 0),u([d()],Tr.prototype,"thumbnail",void 0),u([d({readOnly:!0})],Tr.prototype,"thumbnailUrl",null),u([d()],Tr.prototype,"title",void 0),u([d()],Tr.prototype,"type",void 0),u([d()],Tr.prototype,"typeKeywords",void 0),u([d({type:String,json:{read(t,e){var r;if(act.has(e.type)){const i=(r=this.portal)==null?void 0:r.restUrl;t||(t=i&&this.id?`${i}/content/items/${this.id}/data`:null)}return t}}})],Tr.prototype,"url",void 0),u([d({readOnly:!0})],Tr.prototype,"userItemUrl",null),Tr=hT=u([$("esri.portal.PortalItem")],Tr);const r_=Tr,PPe=Object.freeze(Object.defineProperty({__proto__:null,default:r_},Symbol.toStringTag,{value:"Module"}));async function lct(t){const e=t.spatialReference;if(e.isWGS84)return t.clone();if(e.isWebMercator)return uS(t);const r=Je.WGS84;return await kAe(e,r),ym(t,r)}function iE(t,e){if(!HC(t,e)){const r=t.typeKeywords;r?r.push(e):t.typeKeywords=[e]}}function HC(t,e){var r;return!!((r=t.typeKeywords)!=null&&r.includes(e))}function ih(t,e){const r=t.typeKeywords;if(r){const i=r.indexOf(e);i>-1&&r.splice(i,1)}}async function HBt(t){const e=t.clone().normalize();let r;if(e.length>1)for(const i of e)r?i.width>r.width&&(r=i):r=i;else r=e[0];return lct(r)}const voe={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table"};function lme(t){var l;const{portal:e,isOrgItem:r,itemControl:i}=t,n=(l=e.user)==null?void 0:l.privileges;let s=!n||n.includes("features:user:edit"),o=!!r&&!!(n!=null&&n.includes("features:user:fullEdit"));const a=i==="update"||i==="admin";return a?o=s=!0:o&&(s=!0),{features:{edit:s,fullEdit:o},content:{updateItem:a}}}const cct=t=>{let e=class extends t{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=ze(this.portalItem)}set portalItem(r){r!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",r))}readPortalItem(r,i,n){if(i.itemId)return new r_({id:i.itemId,portal:n&&n.portal})}writePortalItem(r,i){r&&r.id&&(i.itemId=r.id)}async loadFromPortal(r,i){if(this.portalItem&&this.portalItem.id)try{const n=await Q(()=>import("./layersLoader-aabc4951.js"),["assets/layersLoader-aabc4951.js","assets/fetchService-65c9e60a.js","assets/jsonContext-b7261aa0.js"]);return lr(i),await n.load({instance:this,supportedTypes:r.supportedTypes,validateItem:r.validateItem,supportsData:r.supportsData,layerModuleTypeMap:r.layerModuleTypeMap},i)}catch(n){throw ps(n)||re.getLogger(this.declaredClass).warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})
  ${n}`),n}}async finishLoadEditablePortalLayer(r){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(r).catch(i=>(Mu(i),!0)))}async _setUserPrivileges(r,i){if(!ri.userPrivilegesApplied)return this.finishLoadEditablePortalLayer(i);if(this.url)try{const{features:{edit:n,fullEdit:s},content:{updateItem:o}}=await this._fetchUserPrivileges(r,i);this._set("userHasEditingPrivileges",n),this._set("userHasFullEditingPrivileges",s),this._set("userHasUpdateItemPrivileges",o)}catch(n){Mu(n)}}async _fetchUserPrivileges(r,i){let n=this.portalItem;if(!r||!n||!n.loaded||n.sourceUrl)return this._fetchFallbackUserPrivileges(i);const s=r===n.id;if(s&&n.portal.user)return lme(n);let o,a;if(s)o=n.portal.url;else try{o=await gOe(this.url,i)}catch(p){Mu(p)}if(!o||!GWe(o,n.portal.url))return this._fetchFallbackUserPrivileges(i);try{const p=v(i)?i.signal:null;a=await(Oi==null?void 0:Oi.getCredential(`${o}/sharing`,{prompt:!1,signal:p}))}catch(p){Mu(p)}const l=!0,c=!1,h=!1;if(!a)return{features:{edit:l,fullEdit:c},content:{updateItem:h}};try{if(s?await n.reload():(n=new r_({id:r,portal:{url:o}}),await n.load(i)),n.portal.user)return lme(n)}catch(p){Mu(p)}return{features:{edit:l,fullEdit:c},content:{updateItem:h}}}async _fetchFallbackUserPrivileges(r){let i=!0;try{i=await this._fetchUserHasEditingPrivileges(r)}catch(n){Mu(n)}return{features:{edit:i,fullEdit:!1},content:{updateItem:!1}}}async _fetchUserHasEditingPrivileges(r){const i=this.url?Oi==null?void 0:Oi.findCredential(this.url):null;if(!i)return!0;const n=p4.credential===i?p4.user:await this._fetchEditingUser(r);return p4.credential=i,p4.user=n,R(n)||n.privileges==null||n.privileges.includes("features:user:edit")}async _fetchEditingUser(r){var h,p;const i=(p=(h=this.portalItem)==null?void 0:h.portal)==null?void 0:p.user;if(i)return i;const n=Oi.findServerInfo(this.url??"");if(!(n!=null&&n.owningSystemUrl))return null;const s=`${n.owningSystemUrl}/sharing/rest`,o=pa.getDefault();if(o&&o.loaded&&em(o.restUrl)===em(s))return o.user;const a=`${s}/community/self`,l=v(r)?r.signal:null,c=await hm(ei(a,{authMode:"no-prompt",query:{f:"json"},signal:l}));return c.ok?qne.fromJSON(c.value.data):null}read(r,i){i&&(i.layer=this),super.read(r,i)}write(r,i){const n=i&&i.portal,s=this.portalItem&&this.portalItem.id&&(this.portalItem.portal||pa.getDefault());return n&&s&&!RCe(s.restUrl,n.restUrl)?(i.messages&&i.messages.push(new H("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(r,{...i,layer:this})}};return u([d({type:r_})],e.prototype,"portalItem",null),u([Me("web-document","portalItem",["itemId"])],e.prototype,"readPortalItem",null),u([De("web-document","portalItem",{itemId:{type:String}})],e.prototype,"writePortalItem",null),u([d({clonable:!1})],e.prototype,"resourceReferences",void 0),u([d({type:Boolean,readOnly:!0})],e.prototype,"userHasEditingPrivileges",void 0),u([d({type:Boolean,readOnly:!0})],e.prototype,"userHasFullEditingPrivileges",void 0),u([d({type:Boolean,readOnly:!0})],e.prototype,"userHasUpdateItemPrivileges",void 0),e=u([$("esri.layers.mixins.PortalLayer")],e),e},p4={credential:null,user:null};let sI=class extends be{constructor(){super(...arguments),this.updating=!1,this.status="unknown"}};u([d()],sI.prototype,"updating",void 0),u([d()],sI.prototype,"status",void 0),sI=u([$("esri.layers.support.PublishingInfo")],sI);const uct=sI,IPe="esri.layers.mixins.PublishableLayer",hct=Symbol(IPe),dct=t=>{var e;let r=class extends t{constructor(){super(...arguments),this[e]=!0}get publishingInfo(){if(this.destroyed)return null;const i=this._get("publishingInfo");if(i)return i;const n=new uct;return this._checkPublishingStatus(n),n}_checkPublishingStatus(i){let o=0;const a=async c=>{let h;i.updating=!0;try{h=await this.fetchPublishingStatus()}catch{h="unavailable"}h!=="published"&&h!=="unavailable"||(i.status==="publishing"&&this.refresh(),l.remove()),i.status=h,i.updating=!1,l.removed||(o=setTimeout(a,c,c+125))},l={removed:!1,remove(){this.removed=!0,clearTimeout(o)}};this.when().catch(()=>l.remove()),a(250),this.own(l)}};return e=hct,u([d({readOnly:!0,clonable:!1})],r.prototype,"publishingInfo",null),r=u([$(IPe)],r),r},sD=new ct,N$=new WeakMap;function pct(t){$Pe(t)&&sD.push(t)}function fct(t){$Pe(t)&&sD.includes(t)&&sD.remove(t)}function $Pe(t){return t!=null&&typeof t=="object"&&"refreshInterval"in t&&"refresh"in t}function LPe(t,e){return Number.isFinite(t)&&Number.isFinite(e)?e<=0?t:LPe(e,t%e):0}let zG=0,f4=0;function mct(){const t=Date.now();for(const e of sD)e.refreshInterval&&t-(N$.get(e)??0)+5>=6e4*e.refreshInterval&&(N$.set(e,t),e.refresh(t))}d2e(()=>{const t=Date.now();let e=0;for(const r of sD)e=LPe(Math.round(6e4*r.refreshInterval),e),r.refreshInterval?N$.get(r)||N$.set(r,t):N$.delete(r);if(e!==f4){if(f4=e,clearInterval(zG),f4===0)return void(zG=0);zG=setInterval(mct,f4)}});function gct(t){return t!=null&&typeof t=="object"&&"refreshTimestamp"in t&&"refresh"in t}const yct=t=>{let e=class extends t{constructor(...r){super(...r),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=s2e(()=>this.hasDataChanged()),this.when().then(()=>{pct(this)},()=>{})}destroy(){fct(this)}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(r=Date.now()){bR(this._debounceHasDataChanged()).then(i=>{i&&this._set("refreshTimestamp",r),this.emit("refresh",{dataChanged:i})},i=>{re.getLogger(this.declaredClass).error(i),this.emit("refresh",{dataChanged:!1,error:i})})}async hasDataChanged(){return!0}};return u([d({type:Number,cast:r=>r>=.1?r:r<=0?0:.1,json:{write:!0}})],e.prototype,"refreshInterval",void 0),u([d({readOnly:!0})],e.prototype,"refreshTimestamp",void 0),u([d()],e.prototype,"refreshParameters",null),e=u([$("esri.layers.mixins.RefreshableLayer")],e),e},DPe=t=>{let e=class extends t{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const r={minScale:this.minScale,maxScale:this.maxScale},i=this.parent;i&&"effectiveScaleRange"in i&&_ct(r,i.effectiveScaleRange);const n=this._get("effectiveScaleRange");return n&&n.minScale===r.minScale&&n.maxScale===r.maxScale?n:r}};return u([d({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"minScale",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"maxScale",void 0),u([d({readOnly:!0})],e.prototype,"effectiveScaleRange",null),e=u([$("esri.layers.mixins.ScaleRangeLayer")],e),e};function _ct(t,e){return t.minScale=t.minScale>0?e.minScale>0?Math.min(t.minScale,e.minScale):t.minScale:e.minScale,t.maxScale=t.maxScale>0?e.maxScale>0?Math.max(t.maxScale,e.maxScale):t.maxScale:e.maxScale,t}const NPe=ja()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0});let oI=class extends bi(fe){constructor(e){super(e),this.unit="milliseconds",this.value=0}toMilliseconds(){return Frt(this.value,this.unit,"milliseconds")}};u([st(NPe,{nonNullable:!0})],oI.prototype,"unit",void 0),u([d({type:Number,json:{write:!0},nonNullable:!0})],oI.prototype,"value",void 0),oI=u([$("esri.TimeInterval")],oI);const LO=oI;function cme(t,e){return LO.fromJSON({value:t,unit:e})}let Il=class extends bi(fe){constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeReference=null,this.trackIdField=null,this.useTime=!0}readFullTimeExtent(e,r){if(!r.timeExtent||!Array.isArray(r.timeExtent)||r.timeExtent.length!==2)return null;const i=new Date(r.timeExtent[0]),n=new Date(r.timeExtent[1]);return new qc({start:i,end:n})}writeFullTimeExtent(e,r){e&&v(e.start)&&v(e.end)?r.timeExtent=[e.start.getTime(),e.end.getTime()]:r.timeExtent=null}readInterval(e,r){return r.timeInterval&&r.timeIntervalUnits?cme(r.timeInterval,r.timeIntervalUnits):r.defaultTimeInterval&&r.defaultTimeIntervalUnits?cme(r.defaultTimeInterval,r.defaultTimeIntervalUnits):null}writeInterval(e,r){r.timeInterval=(e==null?void 0:e.toJSON().value)??null,r.timeIntervalUnits=(e==null?void 0:e.toJSON().unit)??null}};u([d({type:Boolean,json:{name:"exportOptions.timeDataCumulative",write:!0}})],Il.prototype,"cumulative",void 0),u([d({type:String,json:{name:"endTimeField",write:{enabled:!0,allowNull:!0}}})],Il.prototype,"endField",void 0),u([d({type:qc,json:{write:{enabled:!0,allowNull:!0}}})],Il.prototype,"fullTimeExtent",void 0),u([Me("fullTimeExtent",["timeExtent"])],Il.prototype,"readFullTimeExtent",null),u([De("fullTimeExtent")],Il.prototype,"writeFullTimeExtent",null),u([d({type:Boolean,json:{write:!0}})],Il.prototype,"hasLiveData",void 0),u([d({type:LO,json:{write:{enabled:!0,allowNull:!0}}})],Il.prototype,"interval",void 0),u([Me("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],Il.prototype,"readInterval",null),u([De("interval")],Il.prototype,"writeInterval",null),u([d({type:String,json:{name:"startTimeField",write:{enabled:!0,allowNull:!0}}})],Il.prototype,"startField",void 0),u([d({type:$O,json:{write:{enabled:!0,allowNull:!0}}})],Il.prototype,"timeReference",void 0),u([d({type:String,json:{write:{enabled:!0,allowNull:!0}}})],Il.prototype,"trackIdField",void 0),u([d({type:Boolean,json:{name:"exportOptions.useTime",write:!0}})],Il.prototype,"useTime",void 0),Il=u([$("esri.layers.support.TimeInfo")],Il);const FPe=Il,vct=t=>{let e=class extends t{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(r,i){const n=i.timeInfo.exportOptions;if(!n)return null;const s=n.timeOffset,o=NPe.fromJSON(n.timeOffsetUnits);return s&&o?new LO({value:s,unit:o}):null}set timeInfo(r){fEe(r,this.fieldsIndex),this._set("timeInfo",r)}};return u([d({type:qc,json:{write:!1}})],e.prototype,"timeExtent",void 0),u([d({type:LO})],e.prototype,"timeOffset",void 0),u([Me("service","timeOffset",["timeInfo.exportOptions"])],e.prototype,"readOffset",null),u([d({value:null,type:FPe,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],e.prototype,"timeInfo",null),u([d({type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation"},origins:{"web-scene":{read:!1,write:!1}}}})],e.prototype,"useViewTime",void 0),e=u([$("esri.layers.mixins.TemporalLayer")],e),e},ume=new mr({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let u1=class extends bi(fe){constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}};u([d({json:{write:!0}})],u1.prototype,"name",void 0),u([d({json:{write:!0}})],u1.prototype,"description",void 0),u([d({json:{read:ume.read,write:ume.write}})],u1.prototype,"drawingTool",void 0),u([d({json:{write:!0}})],u1.prototype,"prototype",void 0),u([d({json:{write:!0}})],u1.prototype,"thumbnail",void 0),u1=u([$("esri.layers.support.FeatureTemplate")],u1);const boe=u1;let u0=class extends bi(fe){constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const r={};for(const i of Object.keys(e))r[i]=Nse(e[i]);return r}writeDomains(e,r){var n;const i={};for(const s of Object.keys(e))e[s]&&(i[s]=(n=e[s])==null?void 0:n.toJSON());r.domains=i}};u([d({json:{write:!0}})],u0.prototype,"id",void 0),u([d({json:{write:!0}})],u0.prototype,"name",void 0),u([d({json:{write:!0}})],u0.prototype,"domains",void 0),u([Me("domains")],u0.prototype,"readDomains",null),u([De("domains")],u0.prototype,"writeDomains",null),u([d({type:[boe],json:{write:!0}})],u0.prototype,"templates",void 0),u0=u([$("esri.layers.support.FeatureType")],u0);const kPe=u0;function bct(t){return t.type==="date"||t.type==="esriFieldTypeDate"}function hme(t){return t.type==="oid"||t.type==="esriFieldTypeOID"}function dme(t){return t.type==="global-id"||t.type==="esriFieldTypeGlobalID"}let wct=class{constructor(e=[]){if(this.fields=[],this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this.dateFields=[],this.numericFields=[],this._requiredFields=null,!e)return;this.fields=e;const r=[];for(const i of e){const n=i==null?void 0:i.name,s=fme(i==null?void 0:i.name);if(n&&s){const o=pme(n);this._fieldsMap.set(n,i),this._fieldsMap.set(o,i),this._normalizedFieldsMap.set(s,i),r.push(o),bct(i)?(this.dateFields.push(i),this._dateFieldsSet.add(i)):M9(i)&&(this._numericFieldsSet.add(i),this.numericFields.push(i)),hme(i)||dme(i)||(i.editable=i.editable==null||!!i.editable,i.nullable=i.nullable==null||!!i.nullable)}}r.sort(),this.uid=r.join(",")}destroy(){this._fieldsMap.clear()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)hme(e)||dme(e)||e.nullable||EHe(e)!==void 0||this._requiredFields.push(e)}return this._requiredFields}has(e){return this.get(e)!=null}get(e){if(!e)return;let r=this._fieldsMap.get(e);return r||(r=this._fieldsMap.get(pme(e))??this._normalizedFieldsMap.get(fme(e)),r&&this._fieldsMap.set(e,r),r)}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){const r=this.get(e);if(r)return r.name??void 0}};function pme(t){return t.trim().toLowerCase()}function fme(t){var e;return((e=gHe(t))==null?void 0:e.toLowerCase())??""}function xct(){return{fields:{type:[gB],value:null},fieldsIndex:{readOnly:!0,get(){return new wct(this.fields||[])}},outFields:{type:[String],json:{read:!1},set:function(t){this._userOutFields=t,this.notifyChange("outFields")},get:function(){var e;const t=this._userOutFields;if(!t||!t.length)return null;if(t.includes("*"))return["*"];if(!this.fields)return t;for(const r of t)((e=this.fieldsIndex)==null?void 0:e.has(r))||re.getLogger("esri.layers.support.fieldProperties").error("field-attributes-layer:invalid-field",`Invalid field ${r} found in outFields`,{layer:this,outFields:t});return mEe(this.fieldsIndex,t)}}}}const VG=re.getLogger("esri.layers.support.labelingInfo"),Tct=/\[([^\[\]]+)\]/gi;function mme(t,e,r){return t?t.map(i=>{const n=new CB;if(n.read(i,r),n.labelExpression){const s=e.fields||e.layerDefinition&&e.layerDefinition.fields||this.fields;n.labelExpression=n.labelExpression.replace(Tct,(o,a)=>`[${Sct(a,s)}]`)}return n}):null}function Sct(t,e){if(!e)return t;const r=t.toLowerCase();for(let i=0;i<e.length;i++){const n=e[i].name;if(n.toLowerCase()===r)return n}return t}const Ect={esriGeometryPoint:["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along"],esriGeometryMultipoint:null};function KBt(t,e){const r=se(t);return r.some(i=>Cct(i,e))?[]:r}function Cct(t,e){const r=t.labelPlacement,i=Ect[e];if(!t.symbol)return VG.warn("No ILabelClass symbol specified."),!0;if(!i)return VG.error(new H("labeling:unsupported-geometry-type",`Unable to create labels for layer, geometry type '${e}' is not supported`)),!0;if(!i.includes(r)){const n=i[0];r&&VG.warn(`Found invalid label placement type ${r} for ${e}. Defaulting to ${n}`),t.labelPlacement=n}return!1}const ff=[];function Act(t,e){if(uMe(t.url??""))return!0;const{wkid:r}=e;for(const i of ff){if((t.version??0)>=i[0])return!0;if(typeof i[1]=="function"&&(i[1]=i[1]()),i[1].has(r))return!1}return!0}ff.push([10.91,()=>{const t=new Set([9709,9716,9741,9761,9766]);for(let e=9712;e<=9713;e++)t.add(e);for(let e=9748;e<=9749;e++)t.add(e);for(let e=20904;e<=20932;e++)t.add(e);for(let e=21004;e<=21032;e++)t.add(e);for(let e=21207;e<=21264;e++)t.add(e);for(let e=21307;e<=21364;e++)t.add(e);for(let e=102759;e<=102760;e++)t.add(e);for(let e=102901;e<=102955;e++)t.add(e);return t}]),ff.push([10.9,()=>{const t=new Set([9300,9354,9364,9367,9373,9377,9387,9456,9473,9498,9678,9680,29874,103599,103872,104028]);for(let e=9356;e<=9360;e++)t.add(e);for(let e=9404;e<=9407;e++)t.add(e);for(let e=9476;e<=9482;e++)t.add(e);for(let e=9487;e<=9494;e++)t.add(e);for(let e=9697;e<=9699;e++)t.add(e);return t}]),ff.push([10.81,()=>{const t=new Set([9265,9333,103598,103699]);for(let e=9248;e<=9254;e++)t.add(e);for(let e=9271;e<=9273;e++)t.add(e);for(let e=9284;e<=9285;e++)t.add(e);for(let e=21453;e<=21463;e++)t.add(e);return t}]),ff.push([10.8,()=>{const t=new Set([8088,8395,8428,8433,8531,8687,8692,8694,8699,8900,9003,9006,9009,9012,9017,9191]);for(let e=8035;e<=8036;e++)t.add(e);for(let e=8455;e<=8456;e++)t.add(e);for(let e=8518;e<=8529;e++)t.add(e);for(let e=8533;e<=8536;e++)t.add(e);for(let e=8538;e<=8540;e++)t.add(e);for(let e=8677;e<=8679;e++)t.add(e);for(let e=8902;e<=8903;e++)t.add(e);for(let e=8907;e<=8910;e++)t.add(e);for(let e=8949;e<=8951;e++)t.add(e);for(let e=8972;e<=8987;e++)t.add(e);for(let e=9039;e<=9040;e++)t.add(e);for(let e=9068;e<=9069;e++)t.add(e);for(let e=9140;e<=9141;e++)t.add(e);for(let e=9148;e<=9150;e++)t.add(e);for(let e=9153;e<=9159;e++)t.add(e);for(let e=9205;e<=9218;e++)t.add(e);for(let e=9221;e<=9222;e++)t.add(e);for(let e=54098;e<=54101;e++)t.add(e);return t}]),ff.push([10.71,()=>{const t=new Set([6316]);for(let e=8351;e<=8353;e++)t.add(e);for(let e=9294;e<=9297;e++)t.add(e);for(let e=22619;e<=22621;e++)t.add(e);for(let e=103586;e<=103594;e++)t.add(e);return t}]),ff.push([10.7,()=>{const t=new Set([8387,8391,8427,8545,8682,8685,8818,31370,104022,104024,104975]);for(let e=8065;e<=8068;e++)t.add(e);for(let e=8082;e<=8083;e++)t.add(e);for(let e=8379;e<=8385;e++)t.add(e);for(let e=8836;e<=8840;e++)t.add(e);for(let e=8857;e<=8860;e++)t.add(e);for(let e=53035;e<=53037;e++)t.add(e);for(let e=54090;e<=54091;e++)t.add(e);for(let e=102498;e<=102499;e++)t.add(e);return t}]),ff.push([10.61,()=>new Set([102497])]),ff.push([10.6,()=>{const t=new Set([7803,7805,7887,8086,8232,8237,8240,8246,8249,8252,8255,9019,9391]);for(let e=7755;e<=7787;e++)t.add(e);for(let e=7791;e<=7795;e++)t.add(e);for(let e=7799;e<=7801;e++)t.add(e);for(let e=7825;e<=7831;e++)t.add(e);for(let e=7877;e<=7878;e++)t.add(e);for(let e=7882;e<=7883;e++)t.add(e);for(let e=7991;e<=7992;e++)t.add(e);for(let e=8042;e<=8043;e++)t.add(e);for(let e=8058;e<=8059;e++)t.add(e);for(let e=8311;e<=8348;e++)t.add(e);for(let e=9060;e<=9067;e++)t.add(e);for(let e=102562;e<=102568;e++)t.add(e);for(let e=102799;e<=102900;e++)t.add(e);return t}]),ff.push([10.51,()=>{const t=new Set([7683,7881,7886,7899,8888,9e3]);for(let e=8013;e<=8032;e++)t.add(e);for(let e=9053;e<=9057;e++)t.add(e);for(let e=104017;e<=104018;e++)t.add(e);for(let e=104971;e<=104974;e++)t.add(e);return t}]),ff.push([10.5,()=>{const t=new Set([6962,7035,7037,7039,7041,7084,7086,7133,7798,102399]);for(let e=4087;e<=4088;e++)t.add(e);for(let e=5896;e<=5899;e++)t.add(e);for(let e=7005;e<=7007;e++)t.add(e);for(let e=7057;e<=7070;e++)t.add(e);for(let e=7073;e<=7082;e++)t.add(e);for(let e=7109;e<=7128;e++)t.add(e);for(let e=7844;e<=7859;e++)t.add(e);return t}]);async function Rct(t,e,r){const i=t&&t.getAtOrigin&&t.getAtOrigin("renderer",e.origin);if(i&&i.type==="unique-value"&&i.styleOrigin){const n=await hm(i.populateFromStyle());if(lr(r),n.ok===!1){const s=n.error;e&&e.messages&&e.messages.push(new Sp("renderer:style-reference",`Failed to create unique value renderer from style reference: ${s.message}`,{error:s,context:e})),t.clear("renderer",e==null?void 0:e.origin)}}}const Oct=["oid","global-id"],Mct=["oid","global-id","guid"];function Pct({displayField:t,editFieldsInfo:e,fields:r,objectIdField:i,title:n},s){if(!r)return null;const o=Fct({editFieldsInfo:e,fields:r,objectIdField:i},s);if(!o.length)return null;const a=zct({titleBase:n,fields:r,displayField:t}),l=Uct();return new fN({title:a,content:l,fieldInfos:o})}const Ict=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i],$ct=(t,{editFieldsInfo:e,objectIdField:r,visibleFieldNames:i})=>i?i.has(t.name):!UPe(t.name,e)&&(!r||t.name!==r)&&!Oct.includes(t.type)&&!Ict.some(n=>n.test(t.name));function Lct(t,e){const r=t;return e&&(t=t.filter(i=>!e.includes(i.type))),t===r&&(t=t.slice()),t.sort(Dct),t}function Dct(t,e){return t.type==="oid"?-1:e.type==="oid"?1:gme(t)?-1:gme(e)?1:(t.alias||t.name).toLocaleLowerCase().localeCompare((e.alias||e.name).toLocaleLowerCase())}function UPe(t,e){if(!t||!e)return!1;const{creationDateField:r,creatorField:i,editDateField:n,editorField:s}=e;return[r&&r.toLowerCase(),i&&i.toLowerCase(),n&&n.toLowerCase(),s&&s.toLowerCase()].includes(t.toLowerCase())}function Nct(t,e){return t.editable&&!Mct.includes(t.type)&&!UPe(t.name,e)}function Fct({editFieldsInfo:t,fields:e,objectIdField:r},i){return Lct(e??[],(i==null?void 0:i.ignoreFieldTypes)||Vct).map(n=>new pN({fieldName:n.name,isEditable:Nct(n,t),label:n.alias,format:kct(n),visible:$ct(n,{editFieldsInfo:t,objectIdField:r,visibleFieldNames:i==null?void 0:i.visibleFieldNames})}))}function kct(t){switch(t.type){case"small-integer":case"integer":case"single":return new HA({digitSeparator:!0,places:0});case"double":return new HA({digitSeparator:!0,places:2});case"date":return new HA({dateFormat:"long-month-day-year"});default:return t.type==="string"&&wEe(t.name)?new HA({digitSeparator:!0,places:0}):null}}function Uct(){return[new dO,new zL]}function zct(t){const e=vHe(t),{titleBase:r}=t;return e?`${r}: {${e.trim()}}`:r??""}function gme(t){return(t.name&&t.name.toLowerCase())==="name"?!0:(t.alias&&t.alias.toLowerCase())==="name"}const Vct=["geometry","blob","raster","guid","xml"],nc="FeatureLayer",zPe="esri.layers.FeatureLayer",Bct=re.getLogger(zPe);function m4(t,e){return new H("layer:unsupported",`Layer (${t.title}, ${t.id}) of type '${t.declaredClass}' ${e}`,{layer:t})}function yme(t){return t&&t instanceof ct}const BG=xct();function jG(t,e,r){const i=!!(r!=null&&r.writeLayerSchema);return{enabled:i,ignoreOrigin:i}}let Tt=class extends mlt(ect(_st(dct(mst(hMe(nct(vct(DPe(yct(pst(OPe(cct(IN(fst(nst(bi(nD))))))))))))))))){constructor(...e){super(...e),this._handles=new qr,this.charts=null,this.copyright=null,this.displayField=null,this.dynamicDataSource=null,this.fields=null,this.fieldsIndex=null,this.formTemplate=null,this.fullExtent=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.screenSizePerspectiveEnabled=!0,this.spatialReference=Je.WGS84,this.subtypeCode=null,this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.type="feature",this.typeIdField=null,this.types=null,this.visible=!0}destroy(){var e;(e=this.source)==null||e.destroy(),this._handles=ze(this._handles)}normalizeCtorArgs(e,r){return typeof e=="string"?{url:e,...r}:e}load(e){var n;const r=v(e)?e.signal:null;if((n=this.portalItem)!=null&&n.loaded&&this.source)return this.addResolvingPromise(this.createGraphicsSource(r).then(s=>this.initLayerProperties(s))),Promise.resolve(this);const i=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection"]},e).catch(Mu).then(async()=>{if(this.url&&this.layerId==null&&/FeatureServer|MapServer\/*$/i.test(this.url)){const s=await this._fetchFirstLayerId(r);s!=null&&(this.layerId=s)}if(!this.url&&!this._hasMemorySource())throw new H("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this.initLayerProperties(await this.createGraphicsSource(r))}).then(()=>this._setUserPrivileges(this.serviceItemId,e)).then(()=>Qat(this,e));return this.addResolvingPromise(i),Promise.resolve(this)}readCapabilities(e,r){return r=r.layerDefinition||r,_Pe(r,this.url)}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")??0)+1}get editingEnabled(){var e;return!(this.loaded&&!((e=this.capabilities)!=null&&e.operations.supportsEditing))&&(this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges)}set editingEnabled(e){this._overrideIfSome("editingEnabled",e)}readEditingEnabled(e,r){return this._readEditingEnabled(r,!1)}readEditingEnabledFromWebMap(e,r,i){return this._readEditingEnabled(r,!0,i)}writeEditingEnabled(e,r){this._writeEditingEnabled(e,r,!1)}writeEditingEnabledToWebMap(e,r,i,n){this._writeEditingEnabled(e,r,!0,n)}get effectiveEditingEnabled(){return elt(this)}readIsTable(e,r){return(r=(r==null?void 0:r.layerDefinition)??r).type==="Table"||!r.geometryType}writeIsTable(e,r,i,n){n!=null&&n.writeLayerSchema&&ma(i,e?"Table":"Feature Layer",r)}readGlobalIdField(e,r){return gPe(r.layerDefinition||r)}readObjectIdField(e,r){return yPe(r.layerDefinition||r)}get parsedUrl(){const e=Uo(this.url);return e!=null&&(this.dynamicDataSource!=null?e.path=Yb(e.path,"dynamicLayer"):this.layerId!=null&&(e.path=Yb(e.path,this.layerId.toString()))),e}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){Bhe(e,this.fieldsIndex),this._set("renderer",e)}readRenderer(e,r,i){var s;const n=(s=(r=r.layerDefinition||r).drawingInfo)==null?void 0:s.renderer;if(n){const o=iD(n,r,i)??void 0;return o||Bct.error("Failed to create renderer",{rendererDefinition:r.drawingInfo.renderer,layer:this,context:i}),o}if(r.defaultSymbol)return r.types&&r.types.length?new PN({defaultSymbol:GG(r.defaultSymbol,r,i),field:r.typeIdField,uniqueValueInfos:r.types.map(o=>({id:o.id,symbol:GG(o.symbol,o,i)}))}):new MO({symbol:GG(r.defaultSymbol,r,i)})}set source(e){const r=this._get("source");r!==e&&(yme(r)&&this._resetMemorySource(r),yme(e)&&this._initMemorySource(e),this._set("source",e))}castSource(e){return e?Array.isArray(e)||e instanceof ct?new C0({layer:this,items:e}):e:null}readSource(e,r){const i=zse.fromJSON(r.featureSet);return new C0({layer:this,items:(i==null?void 0:i.features)??[]})}readTemplates(e,r){const i=r.editFieldsInfo,n=i&&i.creatorField,s=i&&i.editorField;return e=e&&e.map(o=>boe.fromJSON(o)),this._fixTemplates(e,n),this._fixTemplates(e,s),e}readTitle(e,r){var s;const i=((s=r.layerDefinition)==null?void 0:s.name)??r.name,n=r.title||r.layerDefinition&&r.layerDefinition.title;if(i){const o=this.portalItem&&this.portalItem.title;if(this.sublayerTitleMode==="item-title")return this.url?lst(this.url,i):i;let a=i;if(!a&&this.url){const l=aw(this.url);v(l)&&(a=l.title)}return a?(this.sublayerTitleMode==="item-title-and-service-name"&&o&&o!==a&&(a=o+" - "+a),ioe(a)):void 0}if(this.sublayerTitleMode==="item-title"&&n)return n}readTitleFromWebMap(e,r){return r.title||r.layerDefinition&&r.layerDefinition.name}readTypeIdField(e,r){let i=(r=r.layerDefinition||r).typeIdField;if(i&&r.fields){i=i.toLowerCase();const n=r.fields.find(s=>s.name.toLowerCase()===i);n&&(i=n.name)}return i}readTypes(e,r){e=(r=r.layerDefinition||r).types;const i=r.editFieldsInfo,n=i&&i.creatorField,s=i&&i.editorField;return e&&e.map(o=>(o=kPe.fromJSON(o),this._fixTemplates(o.templates,n),this._fixTemplates(o.templates,s),o))}readVisible(e,r){return r.layerDefinition&&r.layerDefinition.defaultVisibility!=null?!!r.layerDefinition.defaultVisibility:r.visibility!=null?!!r.visibility:void 0}async addAttachment(e,r){return kat(this,e,r,nc)}async updateAttachment(e,r,i){return Uat(this,e,r,i,nc)}async applyEdits(e,r){return zat(this,e,r)}on(e,r){return super.on(e,r)}createPopupTemplate(e){return Pct(this,e)}async createGraphicsSource(e){if(this._hasMemorySource()&&this.source)return this.source.load({signal:e});const{default:r}=await Hie(Q(()=>import("./FeatureLayerSource-763a0f3e.js"),["assets/FeatureLayerSource-763a0f3e.js","assets/assetEditingSupport-2cebf928.js","assets/clientSideDefaults-ffbb400d.js","assets/QueryEngineCapabilities-42e44ded.js","assets/QueryTask-92ff087d.js","assets/executeForIds-e51f9952.js"]),e);return new r({layer:this}).load({signal:e})}createQuery(){const e=Zat(this);e.dynamicDataSource=this.dynamicDataSource;const r=v(this.subtypeCode)?`${this.subtypeField} = ${this.subtypeCode}`:null,i=Unt(this.definitionExpression,r);return e.where=i||"1=1",e}async deleteAttachments(e,r){return Vat(this,e,r,nc)}async fetchRecomputedExtents(e){return Bat(this,e,nc)}getFeatureType(e){const{typeIdField:r,types:i}=this;if(!r||!e)return null;const n=e.attributes?e.attributes[r]:void 0;if(n==null)return null;let s=null;return i==null||i.some(o=>{const{id:a}=o;return a!=null&&(a.toString()===n.toString()&&(s=o),!!s)}),s}getFieldDomain(e,r){const i=r&&r.feature,n=this.getFeatureType(i);if(n){const s=n.domains&&n.domains[e];if(s&&s.type!=="inherited")return s}return this._getLayerDomain(e)}getField(e){return this.fieldsIndex.get(e)}async queryAttachments(e,r){return jat(this,e,r,nc)}async queryFeatures(e,r){const i=await this.load(),n=await i.source.queryFeatures(gp.from(e)??i.createQuery(),r);if(n!=null&&n.features)for(const s of n.features)s.layer=s.sourceLayer=i;return n}async queryObjectIds(e,r){return Gat(this,e,r,nc)}async queryFeatureCount(e,r){return Hat(this,e,r,nc)}async queryExtent(e,r){return qat(this,e,r,nc)}async queryRelatedFeatures(e,r){return Wat(this,e,r,nc)}async queryRelatedFeaturesCount(e,r){return Xat(this,e,r,nc)}async queryTopFeatures(e,r){var o;const{source:i,capabilities:n}=await this.load();if(!i.queryTopFeatures||!((o=n==null?void 0:n.query)!=null&&o.supportsTopFeaturesQuery))throw new H(nc,"Layer source does not support queryTopFeatures capability");const s=await i.queryTopFeatures(ZF.from(e),r);if(s!=null&&s.features)for(const a of s.features)a.layer=a.sourceLayer=this;return s}async queryTopObjectIds(e,r){const{source:i,capabilities:n}=await this.load();if(!i.queryTopObjectIds||!(n!=null&&n.query.supportsTopFeaturesQuery))throw new H(nc,"Layer source does not support queryTopObjectIds capability");return i.queryTopObjectIds(ZF.from(e),r)}async queryTopFeaturesExtent(e,r){var s;const{source:i,capabilities:n}=await this.load();if(!i.queryTopExtents||!((s=n==null?void 0:n.query)!=null&&s.supportsTopFeaturesQuery))throw new H(nc,"Layer source does not support queryTopExtents capability");return i.queryTopExtents(ZF.from(e),r)}async queryTopFeatureCount(e,r){var s;const{source:i,capabilities:n}=await this.load();if(!i.queryTopCount||!((s=n==null?void 0:n.query)!=null&&s.supportsTopFeaturesQuery))throw new H(nc,"Layer source does not support queryFeatureCount capability");return i.queryTopCount(ZF.from(e),r)}read(e,r){const i=e.featureCollection;if(i){const n=i.layers;n&&n.length===1&&(super.read(n[0],r),i.showLegend!=null&&super.read({showLegend:i.showLegend},r))}super.read(e,r),r&&r.origin==="service"&&(this.revert(["objectIdField","fields","timeInfo"],"service"),this.spatialReference||this.revert(["spatialReference"],"service"))}write(e,r){r={...r,origin:(r==null?void 0:r.origin)??void 0,writeLayerSchema:(r==null?void 0:r.writeLayerSchema)??this._hasMemorySource()};const{origin:i,layerContainerType:n,messages:s}=r;if(this.dynamicDataSource)return s==null||s.push(m4(this,"using a dynamic data source cannot be written to web scenes, web maps and feature service items")),null;if(this.isTable){if(i==="web-scene"||i==="web-map"&&n!=="tables")return s==null||s.push(m4(this,"using a table source cannot be written to web scenes and web maps")),null;if(this._hasMemorySource())return s==null||s.push(m4(this,"using an in-memory table source cannot be written to web scenes and web maps")),null}else if(this.loaded&&i==="web-map"&&n==="tables")return s==null||s.push(m4(this,"using a non-table source cannot be written to tables in web maps")),null;return super.write(e,r)}clone(){if(this._hasMemorySource())throw new H(nc,`FeatureLayer (title: ${this.title}, id: ${this.id}) created using in-memory source cannot be cloned`);return super.clone()}serviceSupportsSpatialReference(e){var r;return!!this.loaded&&(((r=this.source)==null?void 0:r.type)==="memory"||Act(this,e))}async save(e){return(await Q(()=>import("./featureLayerUtils-624c56e6.js"),["assets/featureLayerUtils-624c56e6.js","assets/fetchService-65c9e60a.js","assets/jsonContext-b7261aa0.js"])).save(this,e)}async saveAs(e,r){return(await Q(()=>import("./featureLayerUtils-624c56e6.js"),["assets/featureLayerUtils-624c56e6.js","assets/fetchService-65c9e60a.js","assets/jsonContext-b7261aa0.js"])).saveAs(this,e,r)}_readEditingEnabled(e,r,i){var s;let n=(s=e.layerDefinition)==null?void 0:s.capabilities;return n?this._hasEditingCapability(n):(n=e.capabilities,r&&(i==null?void 0:i.origin)==="web-map"&&!this._hasMemorySource()&&n?this._hasEditingCapability(n):void 0)}_hasEditingCapability(e){return e.toLowerCase().split(",").map(r=>r.trim()).includes("editing")}_writeEditingEnabled(e,r,i,n){var s,o;if(!e){const a=(o=(s=this.capabilities)==null?void 0:s.operations)!=null&&o.supportsSync?"Query,Sync":"Query";ma("layerDefinition.capabilities",a,r),i&&!(n!=null&&n.writeLayerSchema)&&(r.capabilities=a)}}_getLayerDomain(e){const r=this.fieldsIndex.get(e);return r?r.domain:null}_fetchFirstLayerId(e){return ei(this.url,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:e}).then(r=>{const i=r.data;if(i)return Array.isArray(i.layers)&&i.layers.length>0?i.layers[0].id:Array.isArray(i.tables)&&i.tables.length>0?i.tables[0].id:void 0})}async initLayerProperties(e){var r;return this._set("source",e),e.sourceJSON&&(this.sourceJSON=e.sourceJSON,this.read(e.sourceJSON,{origin:"service",portalItem:this.portalItem,portal:(r=this.portalItem)==null?void 0:r.portal,url:this.parsedUrl})),this._verifySource(),this._verifyFields(),Bhe(this.renderer,this.fieldsIndex),fEe(this.timeInfo,this.fieldsIndex),Rct(this,{origin:"service"})}async hasDataChanged(){return Yat(this)}async fetchPublishingStatus(){const e=this.source;return e!=null&&e.fetchPublishingStatus?e.fetchPublishingStatus():"unavailable"}_verifyFields(){var r,i;const e=((r=this.parsedUrl)==null?void 0:r.path)??"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+e+")"),this.isTable||this._hasMemorySource()||e.search(/\/FeatureServer\//i)!==-1||(i=this.fields)!=null&&i.some(n=>n.type==="geometry")||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+e+")")}_fixTemplates(e,r){e&&e.forEach(i=>{const n=i.prototype&&i.prototype.attributes;n&&r&&delete n[r]})}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new H("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new H("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(e){e.forEach(r=>{r.layer=this,r.sourceLayer=this}),this._handles.add([e.on("after-add",r=>{r.item.layer=this,r.item.sourceLayer=this}),e.on("after-remove",r=>{r.item.layer=null,r.item.sourceLayer=null})],"fl-source")}_resetMemorySource(e){e.forEach(r=>{r.layer=null,r.sourceLayer=null}),this._handles.remove("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}};u([Me("service","capabilities")],Tt.prototype,"readCapabilities",null),u([d({json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Tt.prototype,"charts",void 0),u([d({readOnly:!0})],Tt.prototype,"createQueryVersion",null),u([d({json:{read:{source:"layerDefinition.copyrightText"}}})],Tt.prototype,"copyright",void 0),u([d({json:{read:{source:"layerDefinition.displayField"}}})],Tt.prototype,"displayField",void 0),u([d({types:RS,readOnly:!0})],Tt.prototype,"defaultSymbol",void 0),u([d({type:$f})],Tt.prototype,"dynamicDataSource",void 0),u([d({type:Boolean})],Tt.prototype,"editingEnabled",null),u([Me(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],Tt.prototype,"readEditingEnabled",null),u([Me("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],Tt.prototype,"readEditingEnabledFromWebMap",null),u([De(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],Tt.prototype,"writeEditingEnabled",null),u([De("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],Tt.prototype,"writeEditingEnabledToWebMap",null),u([d({readOnly:!0})],Tt.prototype,"effectiveEditingEnabled",null),u([d({...BG.fields,json:{read:{source:"layerDefinition.fields"},origins:{service:{name:"fields"},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:jG}}}}})],Tt.prototype,"fields",void 0),u([d(BG.fieldsIndex)],Tt.prototype,"fieldsIndex",void 0),u([d({type:Jnt,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],Tt.prototype,"formTemplate",void 0),u([d({json:{read:{source:"layerDefinition.extent"}}})],Tt.prototype,"fullExtent",void 0),u([d({json:{origins:{"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:jG,writer(t,e,r){const i=t?qK.toJSON(t):null;i&&ma(r,i,e)}}}},read:{source:"layerDefinition.geometryType",reader:qK.read}}})],Tt.prototype,"geometryType",void 0),u([d({json:{read:{source:"layerDefinition.hasM"}}})],Tt.prototype,"hasM",void 0),u([d({json:{read:{source:"layerDefinition.hasZ"}}})],Tt.prototype,"hasZ",void 0),u([d(Ist)],Tt.prototype,"id",void 0),u([d({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],Tt.prototype,"infoFor3D",void 0),u([d({json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],Tt.prototype,"isTable",void 0),u([Me("service","isTable",["type","geometryType"]),Me("isTable",["layerDefinition.type","layerDefinition.geometryType"])],Tt.prototype,"readIsTable",null),u([De("web-map","isTable")],Tt.prototype,"writeIsTable",null),u([d(ooe)],Tt.prototype,"labelsVisible",void 0),u([d({type:[CB],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:mme},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:mme},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],Tt.prototype,"labelingInfo",void 0),u([d((()=>{const t=se(Pst);return t.json.origins["portal-item"]={write:{target:"layerDefinition.drawingInfo.transparency",writer(e,r,i){ma(i,k9(e),r)}}},t})())],Tt.prototype,"opacity",void 0),u([d(Ost)],Tt.prototype,"legendEnabled",void 0),u([d({type:["show","hide"],json:(()=>{const t=se(gMe.json);return t.origins["portal-item"]={read:!1,write:!1},t})()})],Tt.prototype,"listMode",void 0),u([Me("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],Tt.prototype,"readGlobalIdField",null),u([d({json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:jG}}}}})],Tt.prototype,"objectIdField",void 0),u([Me("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],Tt.prototype,"readObjectIdField",null),u([d({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],Tt.prototype,"operationalLayerType",void 0),u([d(BG.outFields)],Tt.prototype,"outFields",void 0),u([d({readOnly:!0})],Tt.prototype,"parsedUrl",null),u([d({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],Tt.prototype,"path",void 0),u([d(soe)],Tt.prototype,"popupEnabled",void 0),u([d({type:fN,json:{name:"popupInfo",write:!0}})],Tt.prototype,"popupTemplate",void 0),u([d({readOnly:!0})],Tt.prototype,"defaultPopupTemplate",null),u([d({types:bB,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:Lnt,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:(t,e,r)=>({ignoreOrigin:r==null?void 0:r.writeLayerSchema})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(t,e,r)=>({ignoreOrigin:r==null?void 0:r.writeLayerSchema})}}})],Tt.prototype,"renderer",null),u([Me("service","renderer",["drawingInfo.renderer","defaultSymbol"]),Me("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],Tt.prototype,"readRenderer",null),u([d((()=>{const t=se(Ast);return t.json.origins["portal-item"]={read:!1,write:!1},t})())],Tt.prototype,"screenSizePerspectiveEnabled",void 0),u([d({clonable:!1})],Tt.prototype,"source",null),u([cr("source")],Tt.prototype,"castSource",null),u([Me("portal-item","source",["featureSet"]),Me("web-map","source",["featureSet"])],Tt.prototype,"readSource",null),u([d({json:{read:{source:"layerDefinition.extent.spatialReference"}}})],Tt.prototype,"spatialReference",void 0),u([d({type:Number})],Tt.prototype,"subtypeCode",void 0),u([d({type:[boe]})],Tt.prototype,"templates",void 0),u([Me("templates",["editFieldsInfo","creatorField","editorField","templates"])],Tt.prototype,"readTemplates",null),u([d({type:FPe})],Tt.prototype,"timeInfo",void 0),u([d()],Tt.prototype,"title",void 0),u([Me("service","title",["name"]),Me("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],Tt.prototype,"readTitle",null),u([Me("web-map","title",["layerDefinition.name","title"])],Tt.prototype,"readTitleFromWebMap",null),u([d({type:String})],Tt.prototype,"sublayerTitleMode",void 0),u([d({json:{read:!1}})],Tt.prototype,"type",void 0),u([d({type:String})],Tt.prototype,"typeIdField",void 0),u([Me("service","typeIdField"),Me("typeIdField",["layerDefinition.typeIdField"])],Tt.prototype,"readTypeIdField",null),u([d({type:[kPe]})],Tt.prototype,"types",void 0),u([Me("service","types",["types"]),Me("types",["layerDefinition.types"])],Tt.prototype,"readTypes",null),u([d({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],Tt.prototype,"visible",void 0),u([Me("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],Tt.prototype,"readVisible",null),Tt=u([$(zPe)],Tt);const GG=Ew({types:Z9}),woe=Tt,e7t=Object.freeze(Object.defineProperty({__proto__:null,default:woe},Symbol.toStringTag,{value:"Module"})),jct=["$datastore","$map","$layer","$aggregatedfeatures"],Gct="esri.widgets.Feature.support.arcadeFeatureUtils",Hct=re.getLogger(Gct);function qct(t){return typeof t=="string"?SN(Sse(t)):Array.isArray(t)?Wct(t):(t==null?void 0:t.declaredClass)==="esri.arcade.Dictionary"?Xct(t):t}function Wct(t){return`<ul class="esri-widget__list">${t.map(e=>`<li>${typeof e=="string"?SN(Sse(e)):e}</li>`).join("")}</ul>`}function Xct(t){return`<table class="esri-widget__table">${t.keys().map(e=>{const r=t.field(e);return`<tr><th>${e}</th><td>${typeof r=="string"?SN(Sse(r)):r}</td></tr>`}).join("")}</table>`}function Yct({aggregatedFeatures:t,arcadeUtils:e,featureSetVars:r,context:i,viewInfo:n,map:s,graphic:o,interceptor:a}){r.forEach(l=>{const c=l.toLowerCase(),h=n.sr,p={map:s,spatialReference:h,interceptor:a};if(c==="$map"&&(i.vars[c]=e.convertMapToFeatureSetCollection(p)),c==="$layer"&&(i.vars[c]=e.convertFeatureLayerToFeatureSet({layer:o.sourceLayer,spatialReference:h,interceptor:a})),c==="$datastore"&&(i.vars[c]=e.convertServiceUrlToWorkspace({url:o.sourceLayer.url,spatialReference:h,interceptor:a})),c==="$aggregatedfeatures"){const f=o.layer,{fields:m,objectIdField:g,geometryType:_,spatialReference:b,displayField:w}=f,x=new woe({fields:m,objectIdField:g,geometryType:_,spatialReference:b,displayField:w,...f.type==="feature"?{templates:f.templates,typeIdField:f.typeIdField,types:f.types}:null,source:t});i.vars[c]=e.convertFeatureLayerToFeatureSet({layer:x,spatialReference:b,interceptor:a})}})}function VPe(){return Q(()=>import("./arcadeUtils-ee7c6660.js").then(t=>t.ax),["assets/arcadeUtils-ee7c6660.js","assets/arcadeTimeUtils-f06505ea.js","assets/executionError-fb3f283a.js","assets/number-b0a0df5c.js","assets/hash-0ddfbf4b.js"])}function Zct(t){return"createQuery"in t&&"queryFeatures"in t}async function Jct({graphic:t,view:e}){const{isAggregate:r,layer:i}=t;if(!r||!i||(e==null?void 0:e.type)!=="2d")return[];const n=await e.whenLayerView(i);if(!Zct(n))return[];const s=n.createQuery(),o=t.getObjectId();s.aggregateIds=o!=null?[o]:[];const{features:a}=await n.queryFeatures(s);return a}async function BPe({expressionInfo:t,arcadeUtils:e,interceptor:r,spatialReference:i,map:n,graphic:s,view:o}){if(!t||!t.expression)return null;const a=e.createSyntaxTree(t.expression),l=jct.filter(m=>e.hasVariable(a,m)),[c]=await Promise.all([Jct({graphic:s,view:o}),e.loadScriptDependencies(a,!0,l)]),h=e.getViewInfo({spatialReference:i}),p=e.createExecContext(s,h);p.interceptor=r,p.useAsync=!0,Yct({aggregatedFeatures:c,arcadeUtils:e,featureSetVars:l,context:p,viewInfo:h,map:n,graphic:s,interceptor:r});const f=e.createFunction(a,p);return e.executeAsyncFunction(f,p).catch(m=>Hct.error("arcade-execution-error",{error:m,graphic:s,expressionInfo:t}))}async function Kct({expressionInfos:t,spatialReference:e,graphic:r,interceptor:i,map:n,view:s}){if(!t||!t.length)return{};const o=await VPe(),a={};for(const h of t)a[`expression/${h.name}`]=BPe({expressionInfo:h,arcadeUtils:o,interceptor:i,spatialReference:e,map:n,graphic:r,view:s});const l=await ha(a),c={};for(const h in l)c[h]=qct(l[h].value);return c}const Qct=1;let yh=class extends Iw(be){constructor(e){super(e),this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.view=null,this._cancelQuery=()=>{const{_abortController:r}=this;r&&r.abort(),this._abortController=null},this._createVM=()=>{var n,s;const r=(n=this.contentElement)==null?void 0:n.type;(s=this.contentElementViewModel)==null||s.destroy();const i=r==="fields"?new dB:r==="media"?new mS:r==="text"?new Ez:null;this._set("contentElementViewModel",i)},this._compile=async()=>{this._cancelQuery();const r=new AbortController;this._abortController=r,await this._compileExpression(),this._abortController===r&&(this._abortController=null)},this._compileThrottled=ER(this._compile,Qct,this),this._compileExpression=async()=>{const{expressionInfo:r,graphic:i,interceptor:n,spatialReference:s,map:o,view:a,_abortController:l}=this;if(!(r&&i&&s&&o))return void this._set("contentElement",null);const c=await VPe();if(l!==this._abortController)return;const h=await BPe({arcadeUtils:c,expressionInfo:r,graphic:i,interceptor:n,map:o,spatialReference:s,view:a});if(!h||h.declaredClass!=="esri.arcade.Dictionary")return void this._set("contentElement",null);const p=await h.castAsJsonAsync(l==null?void 0:l.signal),f=p==null?void 0:p.type,m=f==="media"?jL.fromJSON(p):f==="text"?pO.fromJSON(p):f==="fields"?dO.fromJSON(p):null;this._set("contentElement",m)},this.handles.add([ne(()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view],()=>this._compileThrottled(),Vt),ne(()=>[this.contentElement],()=>this._createVM(),Vt)])}destroy(){var e;this._cancelQuery(),(e=this.contentElementViewModel)==null||e.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){var e;return((e=this.view)==null?void 0:e.spatialReference)??null}set spatialReference(e){this._override("spatialReference",e)}get state(){const{_abortController:e,contentElement:r,contentElementViewModel:i}=this;return e?"loading":r||i?"ready":"disabled"}get map(){var e;return((e=this.view)==null?void 0:e.map)??null}set map(e){this._override("map",e)}};u([d()],yh.prototype,"_abortController",void 0),u([d({type:xEe})],yh.prototype,"expressionInfo",void 0),u([d({type:Va})],yh.prototype,"graphic",void 0),u([d({readOnly:!0})],yh.prototype,"contentElement",void 0),u([d({readOnly:!0})],yh.prototype,"contentElementViewModel",void 0),u([d()],yh.prototype,"interceptor",void 0),u([d()],yh.prototype,"spatialReference",null),u([d({readOnly:!0})],yh.prototype,"state",null),u([d()],yh.prototype,"map",null),u([d()],yh.prototype,"view",void 0),yh=u([$("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],yh);const xoe=yh,g4={iconLoading:"esri-icon-loading-indicator esri-rotating",base:"esri-feature-expression",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"};let eU=class extends Ga{constructor(e,r){super(e,r),this._contentWidget=null,this.viewModel=new xoe}initialize(){this.addHandles(ne(()=>{var e;return(e=this.viewModel)==null?void 0:e.contentElementViewModel},()=>this._setupExpressionWidget(),Vt))}destroy(){this._destroyContentWidget()}renderLoading(){return ie("div",{key:"loading-container",class:g4.loadingSpinnerContainer},ie("span",{class:this.classes(g4.iconLoading,g4.spinner)}))}render(){var r;const{state:e}=this.viewModel;return ie("div",{class:g4.base},e==="loading"?this.renderLoading():e==="disabled"?null:(r=this._contentWidget)==null?void 0:r.render())}_destroyContentWidget(){const{_contentWidget:e}=this;e&&(e.viewModel=null,e.destroy()),this._contentWidget=null}_setupExpressionWidget(){const{contentElementViewModel:e,contentElement:r}=this.viewModel,i=r==null?void 0:r.type;this._destroyContentWidget();const n=e?i==="fields"?new IOe({viewModel:e}):i==="media"?new x3e({viewModel:e}):i==="text"?new M6({viewModel:e}):null:null;this._contentWidget=n,this.scheduleRender()}};u([d({type:xoe})],eU.prototype,"viewModel",void 0),eU=u([$("esri.widgets.Feature.FeatureExpression")],eU);const eut=eU,HG=100;let ln=class extends bi(c3(Iw(be))){constructor(e){super(e),this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.featuresPerPage=10,this.description=null,this.graphic=null,this.layer=null,this.map=null,this.orderByFields=null,this.featureCount=0,this.relationshipId=null,this.showAllEnabled=!1,this.title=null,this._cancelQuery=()=>{const{_queryAbortController:r}=this;r&&r.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{const{_queryFeatureCountAbortController:r}=this;r&&r.abort(),this._queryFeatureCountAbortController=null},this._cancelQueryPage=()=>{const{_queryPageAbortController:r}=this;r&&r.abort(),this._queryPageAbortController=null},this._queryController=async()=>{this._cancelQuery();const r=new AbortController;this._queryAbortController=r,await bR(this._query()),this._queryAbortController===r&&(this._queryAbortController=null)},this._queryFeatureCountController=async()=>{this._cancelQueryFeatureCount();const r=new AbortController;this._queryFeatureCountAbortController=r,await bR(this._queryFeatureCount()),this._queryFeatureCountAbortController===r&&(this._queryFeatureCountAbortController=null)},this._queryPageController=async()=>{const r=new AbortController;this._queryPageAbortController=r,await bR(this._queryPage()),this._queryPageAbortController===r&&(this._queryPageAbortController=null)},this._queryThrottled=ER(this._queryController,HG,this),this._queryFeatureCountThrottled=ER(this._queryFeatureCountController,HG,this),this._queryPageThrottled=ER(this._queryPageController,HG,this),this._query=async()=>{const{_queryAbortController:r,relatedFeatures:i}=this;this._destroyRelatedFeatureViewModels(),this.featurePage=1,i.removeAll(),i.addMany(this._sliceFeatures(await this._queryRelatedFeatures({signal:r==null?void 0:r.signal})))},this.handles.add([ne(()=>[this.displayCount,this.graphic,this.layer,this.map,this.orderByFieldsFixedCasing,this.relationshipId,this.featuresPerPage,this.showAllEnabled,this.canQuery,this.featureCount],()=>this._queryThrottled(),Vt),ne(()=>[this.featurePage,this.showAllEnabled],()=>this._queryPageThrottled()),ne(()=>[this.layer,this.relationshipId,this.objectId,this.canQuery],()=>this._queryFeatureCountThrottled())])}destroy(){this._destroyRelatedFeatureViewModels(),this.relatedFeatures.removeAll(),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage()}set featurePage(e){const{featuresPerPage:r,featureCount:i}=this,n=1,s=Math.ceil(i/r)||1;this._set("featurePage",Math.min(Math.max(e,n),s))}get featurePage(){return this._get("featurePage")}get orderByFieldsFixedCasing(){const{orderByFields:e,relatedLayer:r}=this;return e&&(r!=null&&r.loaded)?e.map(i=>{const n=i.clone(),s=QL(i.field,r);return n.field=s,n}):e??[]}get supportsCacheHint(){var e,r,i;return!!((i=(r=(e=this.layer)==null?void 0:e.capabilities)==null?void 0:r.queryRelated)!=null&&i.supportsCacheHint)}get canQuery(){var r,i;const e=(i=(r=this.layer)==null?void 0:r.capabilities)==null?void 0:i.queryRelated;return!!(this.relatedLayer&&this.relationship&&typeof this.relationshipId=="number"&&typeof this.objectId=="number"&&(e!=null&&e.supportsCount)&&(e!=null&&e.supportsPagination))}get itemDescriptionFieldName(){var e,r;return((r=(e=this.orderByFieldsFixedCasing)==null?void 0:e[0])==null?void 0:r.field)||null}set displayCount(e){this._set("displayCount",Math.min(Math.max(e,0),10))}get displayCount(){return this._get("displayCount")}get objectId(){var e,r;return(this.objectIdField&&((r=(e=this.graphic)==null?void 0:e.attributes)==null?void 0:r[this.objectIdField]))??null}get objectIdField(){var e;return((e=this.layer)==null?void 0:e.objectIdField)||null}get relatedFeatures(){return this._get("relatedFeatures")||new ct}get relatedLayer(){const{layer:e,map:r,relationship:i}=this;return e!=null&&e.loaded&&r&&i?fet(r,e,i)??null:null}get relationship(){var i;const{relationshipId:e,layer:r}=this;return typeof e=="number"?((i=r==null?void 0:r.relationships)==null?void 0:i.find(({id:n})=>n===e))??null:null}get relatedFeatureViewModels(){return this._get("relatedFeatureViewModels")||new ct}get state(){const{_queryAbortController:e,_queryFeatureCountAbortController:r,_queryPageAbortController:i,canQuery:n}=this;return r?"loading":e||i?"querying":n?"ready":"disabled"}_destroyRelatedFeatureViewModels(){var e;(e=this.relatedFeatureViewModels)==null||e.forEach(r=>!r.destroyed&&r.destroy()),this.relatedFeatureViewModels.removeAll()}async _queryFeatureCount(){const{layer:e,relatedLayer:r,relationshipId:i,objectId:n,_queryFeatureCountAbortController:s,canQuery:o,supportsCacheHint:a}=this;if(await(e==null?void 0:e.load()),await(r==null?void 0:r.load()),!o||!e||!r)return void this._set("featureCount",0);const l=r.createQuery(),c=new RO({cacheHint:a,relationshipId:i,returnGeometry:!1,objectIds:[n],where:ahe(l.where,void 0)}),h=await e.queryRelatedFeaturesCount(c,{signal:s==null?void 0:s.signal});this._set("featureCount",h[n]||0)}_sliceFeatures(e){const{showAllEnabled:r,displayCount:i}=this;return r?e:i?e.slice(0,i):[]}async _queryPage(){const{relatedFeatures:e,featurePage:r,showAllEnabled:i,_queryPageAbortController:n}=this;!i||r<2||e.addMany(await this._queryRelatedFeatures({signal:n==null?void 0:n.signal}))}async _queryRelatedFeatures(e){var A;const{orderByFieldsFixedCasing:r,showAllEnabled:i,featuresPerPage:n,displayCount:s,layer:o,relationshipId:a,featurePage:l,featureCount:c,relatedLayer:h,supportsCacheHint:p}=this,{canQuery:f,objectId:m}=this;if(!f||!o||!h)return[];const g=i?((l-1)*n+c)%c:0,_=i?n:s,b=h.objectIdField,w=[...r==null?void 0:r.map(I=>I.field),b].filter(v),x=r==null?void 0:r.map(I=>`${I.field} ${I.order}`),T=h.createQuery(),E=new RO({orderByFields:x,start:g,num:_,outFields:w,cacheHint:p,relationshipId:a,returnGeometry:!1,objectIds:[m],where:ahe(T.where,void 0)}),C=((A=(await o.queryRelatedFeatures(E,{signal:e==null?void 0:e.signal}))[m])==null?void 0:A.features)||[];return C.forEach(I=>{I.sourceLayer=h,I.layer=h}),C}};u([d()],ln.prototype,"_queryAbortController",void 0),u([d()],ln.prototype,"_queryPageAbortController",void 0),u([d()],ln.prototype,"_queryFeatureCountAbortController",void 0),u([d({value:1})],ln.prototype,"featurePage",null),u([d()],ln.prototype,"featuresPerPage",void 0),u([d({readOnly:!0})],ln.prototype,"orderByFieldsFixedCasing",null),u([d({readOnly:!0})],ln.prototype,"supportsCacheHint",null),u([d({readOnly:!0})],ln.prototype,"canQuery",null),u([d()],ln.prototype,"description",void 0),u([d({readOnly:!0})],ln.prototype,"itemDescriptionFieldName",null),u([d({value:3})],ln.prototype,"displayCount",null),u([d({type:Va})],ln.prototype,"graphic",void 0),u([d()],ln.prototype,"layer",void 0),u([d()],ln.prototype,"map",void 0),u([d({readOnly:!0})],ln.prototype,"objectId",null),u([d({readOnly:!0})],ln.prototype,"objectIdField",null),u([d()],ln.prototype,"orderByFields",void 0),u([d({readOnly:!0})],ln.prototype,"relatedFeatures",null),u([d({readOnly:!0})],ln.prototype,"relatedLayer",null),u([d({readOnly:!0})],ln.prototype,"relationship",null),u([d()],ln.prototype,"featureCount",void 0),u([d({readOnly:!0})],ln.prototype,"relatedFeatureViewModels",null),u([d()],ln.prototype,"relationshipId",void 0),u([d()],ln.prototype,"showAllEnabled",void 0),u([d()],ln.prototype,"state",null),u([d()],ln.prototype,"title",void 0),ln=u([$("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],ln);const Toe=ln,aI="esri-feature",qG=`${aI}-relationship`,Py={base:qG,esriWidget:"esri-widget",listContainer:`${qG}__list`,listContainerQuerying:`${qG}__list--querying`,featureObserver:`${aI}__feature-observer`,stickySpinnerContainer:`${aI}__sticky-loading-container`,loadingSpinnerContainer:`${aI}__loading-container`,spinner:`${aI}__loading-spinner`,iconLoading:"esri-icon-loading-indicator esri-rotating"},_me={title:!0,description:!0};let _c=class extends Ga{constructor(e,r){super(e,r),this._featureElementInfo=null,this._relatedFeatureIntersectionObserverNode=null,this._relatedFeatureIntersectionObserver=new IntersectionObserver(([i])=>{i!=null&&i.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this.headingLevel=2,this.viewModel=new Toe,this.messages=null,this.messagesCommon=null,this.visibleElements={..._me},this._increaseFeaturePage=()=>{const{state:i,showAllEnabled:n,relatedFeatures:s,featuresPerPage:o,featurePage:a}=this.viewModel;i==="ready"&&n&&s.length>=o*a&&this.viewModel.featurePage++}}initialize(){this._featureElementInfo=new hB,this.addHandles([ne(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),Vt),ne(()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),Yn(()=>this.viewModel.relatedFeatureViewModels,"change",()=>this._setupRelatedFeatureViewModels())])}loadDependencies(){return Promise.all([Q(()=>import("./calcite-list-41c44f24.js"),["assets/calcite-list-41c44f24.js","assets/utils3-7e94db45.js","assets/debounce-d5abe404.js","assets/scrim-bf227f3c.js"]),Q(()=>import("./calcite-list-item-f474d000.js"),["assets/calcite-list-item-f474d000.js","assets/utils3-7e94db45.js"]),Q(()=>import("./calcite-icon-e09f1c1a.js"),[]),Q(()=>import("./calcite-notice-9cad7547.js"),[])])}destroy(){this._unobserveRelatedFeatureObserver(),this._featureElementInfo=ze(this._featureElementInfo)}get displayShowAllButton(){const{showAllEnabled:e,featureCount:r,displayCount:i}=this.viewModel;return!e&&!!r&&(r>i||i===0)}get displayListItems(){return this.displayShowAllButton||this.viewModel.relatedFeatureViewModels.length>0}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get featureCountDescription(){const{messages:e}=this,{featureCount:r}=this.viewModel;return bg(r===1?e==null?void 0:e.numberRecord:e==null?void 0:e.numberRecords,{number:r})}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}castVisibleElements(e){return{..._me,...e}}renderStickyLoading(){return this.viewModel.state==="querying"?ie("div",{key:"sticky-loader",class:Py.stickySpinnerContainer},this.renderLoadingIcon()):null}renderLoadingIcon(){return ie("span",{class:this.classes(Py.iconLoading,Py.spinner)})}renderLoading(){return ie("div",{key:"loading-container",class:Py.loadingSpinnerContainer},this.renderLoadingIcon())}renderShowAllIconNode(){return ie("calcite-icon",{scale:"s",icon:"list",slot:"content-end"})}renderChevronIconNode(){const e=Ng(this.container)?"chevron-left":"chevron-right";return ie("calcite-icon",{scale:"s",icon:e,slot:"content-end"})}renderRelatedFeature(e){var s,o;const{itemDescriptionFieldName:r}=this.viewModel,i=e.title;e.description=r&&((s=e.formattedAttributes)==null?void 0:s.global[r]);const n=e.state==="loading";return ie("calcite-list-item",{key:e.uid,label:n?`${(o=this.messagesCommon)==null?void 0:o.loading}…`:i,description:n?"…":e.description??"",onCalciteListItemSelect:()=>this.emit("select-record",{featureViewModel:e})},this.renderChevronIconNode())}renderShowAllListItem(){var e;return this.displayShowAllButton?ie("calcite-list-item",{key:"show-all-item",label:(e=this.messages)==null?void 0:e.showAll,description:this.featureCountDescription,onCalciteListItemSelect:()=>this.emit("show-all-records")},this.renderShowAllIconNode()):null}renderNoRelatedFeaturesMessage(){var e;return ie("calcite-notice",{key:"no-related-features-message",icon:"information",open:!0,kind:"brand",scale:"s",width:"full"},ie("div",{slot:"message"},(e=this.messages)==null?void 0:e.noRelatedFeatures))}renderFeatureObserver(){return ie("div",{key:"feature-observer",class:Py.featureObserver,bind:this,afterCreate:this._relatedFeatureIntersectionObserverCreated})}renderList(){const{relatedFeatureViewModels:e}=this.viewModel;return ie("calcite-list",null,e.toArray().map(r=>this.renderRelatedFeature(r)),this.renderShowAllListItem())}renderRelatedFeatures(){const{displayListItems:e}=this,{state:r}=this.viewModel;return ie("div",{key:"list-container",class:this.classes(Py.listContainer,{[Py.listContainerQuerying]:r==="querying"})},e?this.renderList():r==="ready"?this.renderNoRelatedFeaturesMessage():null,this.renderStickyLoading(),this.renderFeatureObserver())}renderRelationshipNotFound(){var e;return ie("calcite-notice",{key:"relationship-not-found",icon:"exclamation-mark-triangle",open:!0,kind:"danger",scale:"s",width:"full"},ie("div",{slot:"message"},(e=this.messages)==null?void 0:e.relationshipNotFound))}render(){var r;const{state:e}=this.viewModel;return ie("div",{class:this.classes(Py.base,Py.esriWidget)},(r=this._featureElementInfo)==null?void 0:r.render(),e==="loading"?this.renderLoading():e==="disabled"?this.renderRelationshipNotFound():this.renderRelatedFeatures())}_setupRelatedFeatureViewModels(){const{relatedFeatureViewModels:e}=this.viewModel,r="related-feature-viewmodels";this.removeHandles(r),e==null||e.forEach(i=>{this.addHandles(ne(()=>[i.title,i.state],()=>this.scheduleRender(),Vt),r)}),this.scheduleRender()}_setupFeatureElementInfo(){var s;const{headingLevel:e,visibleElements:r}=this,i=r.description&&this.description,n=r.title&&this.title;(s=this._featureElementInfo)==null||s.set({description:i,title:n,headingLevel:e})}async _handleRelatedFeatureObserverChange(){this._unobserveRelatedFeatureObserver();const{state:e,showAllEnabled:r}=this.viewModel;await YS(0),this._relatedFeatureIntersectionObserverNode&&e==="ready"&&r&&this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode)}_relatedFeatureIntersectionObserverCreated(e){this._relatedFeatureIntersectionObserverNode=e}_unobserveRelatedFeatureObserver(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}};u([d()],_c.prototype,"_relatedFeatureIntersectionObserverNode",void 0),u([d({readOnly:!0})],_c.prototype,"displayShowAllButton",null),u([d({readOnly:!0})],_c.prototype,"displayListItems",null),u([d()],_c.prototype,"description",null),u([d({readOnly:!0})],_c.prototype,"featureCountDescription",null),u([d()],_c.prototype,"headingLevel",void 0),u([d()],_c.prototype,"title",null),u([d({type:Toe})],_c.prototype,"viewModel",void 0),u([d(),_a("esri/widgets/Feature/t9n/Feature")],_c.prototype,"messages",void 0),u([d(),_a("esri/t9n/common")],_c.prototype,"messagesCommon",void 0),u([d()],_c.prototype,"visibleElements",void 0),u([cr("visibleElements")],_c.prototype,"castVisibleElements",null),_c=u([$("esri.widgets.Feature.FeatureRelationship")],_c);const vme=_c;let tut=class{constructor(e,r){this.preLayerQueryCallback=e,this.preRequestCallback=r,this.preLayerQueryCallback||(this.preLayerQueryCallback=i=>{}),this.preRequestCallback||(this.preLayerQueryCallback=i=>{})}};var lI;const rut=1,bme="content-view-models",wme="relationship-view-models",xme={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0};let Vn=lI=class extends c3(be){constructor(t){super(t),this._handles=new qr,this._error=null,this._featureAbortController=null,this._graphicChangedThrottled=ER(this._graphicChanged,rut,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities={...xme},this.content=null,this.contentViewModels=[],this.description=null,this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=e=>{const{abilities:r}=this;return e.type==="attachments"&&!!r.attachmentsContent||e.type==="custom"&&!!r.customContent||e.type==="fields"&&!!r.fieldsContent||e.type==="media"&&!!r.mediaContent||e.type==="text"&&!!r.textContent||e.type==="expression"&&!!r.expressionContent||e.type==="relationship"&&!!r.relationshipContent},this._handles.add(ne(()=>[this.graphic,this._effectivePopupTemplate,this.abilities],()=>this._graphicChangedThrottled(),Vt))}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this._handles.destroy(),this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return v(this.graphic)?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return oet(upe(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return bOe(this.graphic)}castAbilities(t){return{...xme,...t}}get isTable(){var t;return((t=this._sourceLayer)==null?void 0:t.isTable)||!1}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(t){this._set("graphic",t?t.clone():null)}get spatialReference(){var t;return((t=this.view)==null?void 0:t.spatialReference)??null}set spatialReference(t){this._override("spatialReference",t)}get map(){var t;return((t=this.view)==null?void 0:t.map)||null}set map(t){this._override("map",t)}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(t,e){const r=this.contentViewModels[t];r instanceof mS&&r.setActiveMedia(e)}nextMedia(t){const e=this.contentViewModels[t];e instanceof mS&&e.next()}previousMedia(t){const e=this.contentViewModels[t];e instanceof mS&&e.previous()}async updateGeometry(){var o,a;const{graphic:t,spatialReference:e,_sourceLayer:r}=this;await(r==null?void 0:r.load());const i=r==null?void 0:r.objectIdField;if(!i||!t||!r)return;const n=(o=t==null?void 0:t.attributes)==null?void 0:o[i];if(n==null)return;const s=[n];if(!t.geometry){const l=(a=await COe({layer:r,graphic:t,outFields:[],objectIds:s,returnGeometry:!0,spatialReference:e}))==null?void 0:a.geometry;l&&(t.geometry=l)}}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}async _graphicChanged(){this._cancelFeatureQuery(),this._error=null,this._clear();const{graphic:t}=this;if(!t)return;const e=new AbortController;this._featureAbortController=e;try{await this._queryFeature({signal:e.signal})}catch(r){ps(r)||(this._error=r,re.getLogger(this.declaredClass).error("error","The popupTemplate could not be displayed for this feature.",{error:r,graphic:t,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===e&&(this._featureAbortController=null)}_cancelFeatureQuery(){const{_featureAbortController:t}=this;t&&t.abort(),this._featureAbortController=null}_compileContentElement(t,e){return t.type==="attachments"?this._compileAttachments(t,e):t.type==="custom"?this._compileCustom(t,e):t.type==="fields"?this._compileFields(t,e):t.type==="media"?this._compileMedia(t,e):t.type==="text"?this._compileText(t,e):t.type==="expression"?this._compileExpression(t,e):t.type==="relationship"?this._compileRelationship(t,e):void 0}_compileContent(t){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(t)?t.filter(this._isAllowedContentType).map((e,r)=>this._compileContentElement(e,r)).filter(v):typeof t=="string"?this._compileText(new pO({text:t}),0).text:t}_destroyContentViewModels(){var t,e;(t=this._handles)==null||t.remove(wme),(e=this._handles)==null||e.remove(bme),this.contentViewModels.forEach(r=>r&&!r.destroyed&&r.destroy()),this._set("contentViewModels",[])}_matchesFeature(t,e){var n;const r=(n=t==null?void 0:t.graphic)==null?void 0:n.getObjectId(),i=e==null?void 0:e.getObjectId();return v(r)&&v(i)&&r===i}_setRelatedFeaturesViewModels({relatedFeatureViewModels:t,relatedFeatures:e,map:r}){const{view:i,spatialReference:n}=this;e==null||e.filter(Boolean).forEach(s=>{t.find(o=>this._matchesFeature(o,s))||t.add(new lI({abilities:{relationshipContent:!1},map:r,view:i,spatialReference:n,graphic:s}))}),t.forEach(s=>{(e==null?void 0:e.find(a=>this._matchesFeature(s,a)))||t.remove(s)})}_setExpressionContentVM(t,e){const r=this.formattedAttributes,{contentElement:i,contentElementViewModel:n}=t,s=i==null?void 0:i.type;n&&s&&(s==="fields"&&(this._createFieldsFormattedAttributes({contentElement:i,contentElementIndex:e,formattedAttributes:r}),n.set(this._createFieldsVMParams(i,e))),s==="media"&&(this._createMediaFormattedAttributes({contentElement:i,contentElementIndex:e,formattedAttributes:r}),n.set(this._createMediaVMParams(i,e))),s==="text"&&n.set(this._createTextVMParams(i)))}_compileRelationship(t,e){const{displayCount:r,orderByFields:i,relationshipId:n,title:s,description:o}=t,{_sourceLayer:a,graphic:l,map:c}=this,h=new Toe({displayCount:r,graphic:l,orderByFields:i,relationshipId:n,layer:a,map:c,...this._compileTitleAndDesc({title:s,description:o})});return this.contentViewModels[e]=h,this._handles.add(Yn(()=>h.relatedFeatures,"change",()=>this._setRelatedFeaturesViewModels(h)),wme),t}_compileExpression(t,e){const{expressionInfo:r}=t,{graphic:i,map:n,spatialReference:s,view:o}=this,a=new xoe({expressionInfo:r,graphic:i,interceptor:lI.interceptor,map:n,spatialReference:s,view:o});return this.contentViewModels[e]=a,this._handles.add(ne(()=>a.contentElementViewModel,()=>this._setExpressionContentVM(a,e),Vt),bme),t}_compileAttachments(t,e){const{graphic:r}=this,{description:i,title:n}=t;return this.contentViewModels[e]=new Cse({graphic:r,...this._compileTitleAndDesc({title:n,description:i})}),t}_compileCustom(t,e){const{graphic:r}=this,{creator:i,destroyer:n}=t;return this.contentViewModels[e]=new Ez({graphic:r,creator:i,destroyer:n}),t}_compileTitleAndDesc({title:t,description:e}){const{_fieldInfoMap:r,_sourceLayer:i,graphic:n,formattedAttributes:s}=this,o=n==null?void 0:n.attributes,a=this._expressionAttributes,l=s.global;return{title:fS({attributes:o,fieldInfoMap:r,globalAttributes:l,expressionAttributes:a,layer:i,text:t}),description:fS({attributes:o,fieldInfoMap:r,globalAttributes:l,expressionAttributes:a,layer:i,text:e})}}_createFieldsVMParams(t,e){var c;const r=this._effectivePopupTemplate,i=this.formattedAttributes,n={...i==null?void 0:i.global,...i==null?void 0:i.content[e]},s=(c=(t==null?void 0:t.fieldInfos)||(r==null?void 0:r.fieldInfos))==null?void 0:c.filter(({fieldName:h})=>xse(h)||j0(h)||n.hasOwnProperty(h)),o=r==null?void 0:r.expressionInfos,{description:a,title:l}=t;return{attributes:n,expressionInfos:o,fieldInfos:s,...this._compileTitleAndDesc({title:l,description:a})}}_compileFields(t,e){const r=t.clone(),i=new dB(this._createFieldsVMParams(t,e));return this.contentViewModels[e]=i,r.fieldInfos=i.formattedFieldInfos.slice(0),r}_createMediaVMParams(t,e){const{abilities:r,graphic:i,_fieldInfoMap:n,_effectivePopupTemplate:s,relatedInfos:o,_sourceLayer:a,_expressionAttributes:l}=this,c=this.formattedAttributes,h=(i==null?void 0:i.attributes)??{},{description:p,mediaInfos:f,title:m}=t;return{abilities:{chartAnimation:r.chartAnimation},activeMediaInfoIndex:t.activeMediaInfoIndex||0,attributes:h,isAggregate:i==null?void 0:i.isAggregate,layer:a,fieldInfoMap:n,formattedAttributes:{...c==null?void 0:c.global,...c==null?void 0:c.content[e]},expressionAttributes:l,mediaInfos:f,popupTemplate:s,relatedInfos:o,...this._compileTitleAndDesc({title:m,description:p})}}_compileMedia(t,e){const r=t.clone(),i=new mS(this._createMediaVMParams(t,e));return r.mediaInfos=i.formattedMediaInfos.slice(0),this.contentViewModels[e]=i,r}_createTextVMParams(t){var s;const{graphic:e,_fieldInfoMap:r,_sourceLayer:i,_expressionAttributes:n}=this;if(t&&t.text){const o=(e==null?void 0:e.attributes)??{},a=((s=this.formattedAttributes)==null?void 0:s.global)??{};t.text=fS({attributes:o,fieldInfoMap:r,globalAttributes:a,expressionAttributes:n,layer:i,text:t.text})}return{graphic:e,creator:t.text}}_compileText(t,e){const r=t.clone();return this.contentViewModels[e]=new Ez(this._createTextVMParams(r)),r}_compileLastEditInfo(){const{_effectivePopupTemplate:t,_sourceLayer:e,graphic:r}=this;if(!t)return;const{lastEditInfoEnabled:i}=t,n=e==null?void 0:e.editFieldsInfo;return i&&n?set(n,r==null?void 0:r.attributes):void 0}_compileTitle(t){var a;const{_fieldInfoMap:e,_sourceLayer:r,graphic:i,_expressionAttributes:n}=this,s=(i==null?void 0:i.attributes)??{},o=((a=this.formattedAttributes)==null?void 0:a.global)??{};return fS({attributes:s,fieldInfoMap:e,globalAttributes:o,expressionAttributes:n,layer:r,text:t})}async _getTitle(){const{_effectivePopupTemplate:t,graphic:e}=this;if(!e)return null;const r=t==null?void 0:t.title;return Sz(r,{graphic:e})}async _getContent(){const{_effectivePopupTemplate:t,graphic:e}=this;if(!e)return null;const r=t==null?void 0:t.content;return Sz(r,{graphic:e})}async _queryFeature(t){const{_featureAbortController:e,_sourceLayer:r,graphic:i,_effectivePopupTemplate:n}=this,s=this.map,o=this.view,a=this.spatialReference;if(e!==this._featureAbortController||!i)return;await cet({graphic:i,popupTemplate:n,layer:r,spatialReference:a},t);const{content:{value:l},title:{value:c}}=await ha({content:this._getContent(),title:this._getTitle()}),{expressionAttributes:{value:h}}=await ha({checkForRelatedFeatures:this._checkForRelatedFeatures(t),expressionAttributes:Kct({expressionInfos:n==null?void 0:n.expressionInfos,spatialReference:a,graphic:i,map:s,interceptor:lI.interceptor,view:o})});e===this._featureAbortController&&i&&(this._expressionAttributes=h,this._graphicExpressionAttributes={...i.attributes,...h},this._set("formattedAttributes",this._createFormattedAttributes(l)),this._set("title",this._compileTitle(c)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(l)||null))}_createMediaFormattedAttributes({contentElement:t,contentElementIndex:e,formattedAttributes:r}){const{_effectivePopupTemplate:i,graphic:n,relatedInfos:s,_sourceLayer:o,_fieldInfoMap:a,_graphicExpressionAttributes:l}=this;r.content[e]=rG({fieldInfos:i==null?void 0:i.fieldInfos,graphic:n,attributes:{...l,...t.attributes},layer:o,fieldInfoMap:a,relatedInfos:s})}_createFieldsFormattedAttributes({contentElement:t,contentElementIndex:e,formattedAttributes:r}){if(t.fieldInfos){const{graphic:i,relatedInfos:n,_sourceLayer:s,_fieldInfoMap:o,_graphicExpressionAttributes:a}=this;r.content[e]=rG({fieldInfos:t.fieldInfos,graphic:i,attributes:{...a,...t.attributes},layer:s,fieldInfoMap:o,relatedInfos:n})}}_createFormattedAttributes(t){const{_effectivePopupTemplate:e,graphic:r,relatedInfos:i,_sourceLayer:n,_fieldInfoMap:s,_graphicExpressionAttributes:o}=this,a=e==null?void 0:e.fieldInfos,l={global:rG({fieldInfos:a,graphic:r,attributes:o,layer:n,fieldInfoMap:s,relatedInfos:i}),content:[]};return Array.isArray(t)&&t.forEach((c,h)=>{c.type==="fields"&&this._createFieldsFormattedAttributes({contentElement:c,contentElementIndex:h,formattedAttributes:l}),c.type==="media"&&this._createMediaFormattedAttributes({contentElement:c,contentElementIndex:h,formattedAttributes:l})}),l}_checkForRelatedFeatures(t){const{graphic:e,_effectivePopupTemplate:r}=this;return this._queryRelatedInfos(e,upe(r),t)}async _queryRelatedInfos(t,e,r){const{relatedInfos:i,_sourceLayer:n}=this;i.clear();const s=v(n==null?void 0:n.associatedLayer)?await(n==null?void 0:n.associatedLayer.load(r)):n;if(!s||!t)return;const o=e.filter(c=>c&&j0(c.fieldName));if(!o||!o.length)return;e.forEach(c=>this._configureRelatedInfo(c,s));const a=await yit({relatedInfos:i,layer:s},r);Object.keys(a).forEach(c=>{var f;const h=i.get(c.toString()),p=(f=a[c])==null?void 0:f.value;h&&p&&(h.layerInfo=p.data)});const l=await _it({graphic:t,relatedInfos:i,layer:s},r);Object.keys(l).forEach(c=>{var h;dit((h=l[c])==null?void 0:h.value,i.get(c.toString()))})}_configureRelatedInfo(t,e){const{relatedInfos:r}=this,i=D6(t.fieldName);if(!i)return;const{layerId:n,fieldName:s}=i;if(!n)return;const o=r.get(n.toString())||hit(n,e);o&&(vit({relatedInfo:o,fieldName:s,fieldInfo:t}),this.relatedInfos.set(n,o))}};Vn.interceptor=new tut(det,pet),u([d()],Vn.prototype,"_error",void 0),u([d()],Vn.prototype,"_featureAbortController",void 0),u([d({readOnly:!0})],Vn.prototype,"_effectivePopupTemplate",null),u([d({readOnly:!0})],Vn.prototype,"_fieldInfoMap",null),u([d({readOnly:!0})],Vn.prototype,"_sourceLayer",null),u([d()],Vn.prototype,"abilities",void 0),u([cr("abilities")],Vn.prototype,"castAbilities",null),u([d({readOnly:!0})],Vn.prototype,"content",void 0),u([d({readOnly:!0})],Vn.prototype,"contentViewModels",void 0),u([d()],Vn.prototype,"description",void 0),u([d({type:Boolean})],Vn.prototype,"defaultPopupTemplateEnabled",void 0),u([d({readOnly:!0})],Vn.prototype,"isTable",null),u([d({readOnly:!0})],Vn.prototype,"state",null),u([d({readOnly:!0})],Vn.prototype,"formattedAttributes",void 0),u([d({type:Va,value:null})],Vn.prototype,"graphic",null),u([d({readOnly:!0})],Vn.prototype,"lastEditInfo",void 0),u([d({readOnly:!0})],Vn.prototype,"relatedInfos",void 0),u([d()],Vn.prototype,"spatialReference",null),u([d({readOnly:!0})],Vn.prototype,"title",void 0),u([d()],Vn.prototype,"map",null),u([d({readOnly:!0})],Vn.prototype,"waitingForContent",null),u([d()],Vn.prototype,"view",void 0),Vn=lI=u([$("esri.widgets.FeatureViewModel")],Vn);const Soe=Vn,qa="esri-feature",gs={iconText:"esri-icon-font-fallback-text",iconLoading:"esri-icon-loading-indicator esri-rotating",esriTable:"esri-widget__table",esriWidget:"esri-widget",base:qa,container:`${qa}__size-container`,title:`${qa}__title`,main:`${qa}__main-container`,btn:`${qa}__button`,icon:`${qa}__icon`,content:`${qa}__content`,contentNode:`${qa}__content-node`,contentElement:`${qa}__content-element`,text:`${qa}__text`,lastEditedInfo:`${qa}__last-edited-info`,fields:`${qa}__fields`,fieldHeader:`${qa}__field-header`,fieldData:`${qa}__field-data`,fieldDataDate:`${qa}__field-data--date`,loadingSpinnerContainer:`${qa}__loading-container`,spinner:`${qa}__loading-spinner`},jPe=t=>{let e=class extends t{constructor(){super(...arguments),this.renderNodeContent=r=>Az(r)&&!r.destroyed?ie("div",{class:gs.contentNode,key:r},r.render()):r instanceof HTMLElement?ie("div",{class:gs.contentNode,key:r,bind:r,afterCreate:this._attachToNode}):POe(r)?ie("div",{class:gs.contentNode,key:r,bind:r.domNode,afterCreate:this._attachToNode}):null}_attachToNode(r){const i=this;r.appendChild(i)}};return e=u([$("esri.widgets.Feature.ContentMixin")],e),e};var iQ;const Tme={title:!0,content:!0,lastEditedInfo:!0},Sme="relationship-handles";let Ko=iQ=class extends jPe(Ga){constructor(t,e){super(t,e),this._contentWidgets=[],this.flowItems=null,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.messagesURIUtils=null,this.visibleElements={...Tme},this.viewModel=new Soe}initialize(){this.addHandles(ne(()=>{var t;return(t=this.viewModel)==null?void 0:t.contentViewModels},()=>this._setupContentWidgets(),Vt))}loadDependencies(){return Q(()=>import("./calcite-notice-9cad7547.js"),[])}destroy(){this._destroyContentWidgets()}get graphic(){return this.viewModel.graphic}set graphic(t){this.viewModel.graphic=t}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(t){this.viewModel.defaultPopupTemplateEnabled=t}get isTable(){return this.viewModel.isTable}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(t){this.viewModel.spatialReference=t}get title(){return this.viewModel.title}castVisibleElements(t){return{...Tme,...t}}get map(){return this.viewModel.map}set map(t){this.viewModel.map=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}render(){const{state:t}=this.viewModel,e=ie("div",{class:gs.container,key:"container"},this.renderTitle(),t==="error"?this.renderError():t==="loading"?this.renderLoading():this.renderContentContainer());return ie("div",{class:this.classes(gs.base,gs.esriWidget)},e)}setActiveMedia(t,e){return this.viewModel.setActiveMedia(t,e)}nextMedia(t){return this.viewModel.nextMedia(t)}previousMedia(t){return this.viewModel.previousMedia(t)}renderError(){const{messagesCommon:t,messages:e,visibleElements:r}=this;return ie("calcite-notice",{open:!0,kind:"danger",icon:"exclamation-mark-circle",scale:"s"},r.title?ie("div",{key:"error-title",slot:"title"},t.errorMessage):null,ie("div",{key:"error-message",slot:"message"},e.loadingError))}renderLoading(){return ie("div",{key:"loading-container",class:gs.loadingSpinnerContainer},ie("span",{class:this.classes(gs.iconLoading,gs.spinner)}))}renderContentContainer(){const{visibleElements:t}=this;return t.content?ie("div",{class:gs.main},[this.renderContent(),this.renderLastEditInfo()]):null}renderTitle(){const{visibleElements:t,title:e}=this;return t.title?ie(Ase,{level:this.headingLevel,class:gs.title,innerHTML:e}):null}renderContent(){const t=this.viewModel.content,e="content";if(!t)return null;if(Array.isArray(t))return t.length?ie("div",{class:gs.contentNode,key:`${e}-content-elements`},t.map(this.renderContentElement,this)):null;if(typeof t=="string"){const r=this._contentWidgets[0];return!r||r.destroyed?null:ie("div",{class:gs.contentNode,key:`${e}-content`},r.render())}return this.renderNodeContent(t)}renderContentElement(t,e){var i;const{visibleElements:r}=this;if(typeof r.content!="boolean"&&!((i=r.content)!=null&&i[t.type]))return null;switch(t.type){case"attachments":return this.renderAttachments(e);case"custom":return this.renderCustom(t,e);case"fields":return this.renderFields(e);case"media":return this.renderMedia(e);case"text":return this.renderText(t,e);case"expression":return this.renderExpression(e);case"relationship":return this.renderRelationship(e);default:return null}}renderAttachments(t){const e=this._contentWidgets[t];if(!e||e.destroyed)return null;const{state:r,attachmentInfos:i}=e.viewModel;return r==="loading"||i.length>0?ie("div",{key:this._buildKey("attachments-element",t),class:this.classes(gs.contentElement)},e.render()):null}renderRelationship(t){const e=this._contentWidgets[t];return e&&!e.destroyed&&this.flowItems?ie("div",{key:this._buildKey("relationship-element",t),class:gs.contentElement},e.render()):null}renderExpression(t){const e=this._contentWidgets[t];return!e||e.destroyed?null:ie("div",{key:this._buildKey("expression-element",t),class:gs.contentElement},e.render())}renderCustom(t,e){const{creator:r}=t,i=this._contentWidgets[e];return!i||i.destroyed?null:r?ie("div",{key:this._buildKey("custom-element",e),class:gs.contentElement},i.render()):null}renderFields(t){const e=this._contentWidgets[t];return!e||e.destroyed?null:ie("div",{key:this._buildKey("fields-element",t),class:gs.contentElement},e.render())}renderMedia(t){const e=this._contentWidgets[t];return!e||e.destroyed?null:ie("div",{key:this._buildKey("media-element",t),class:gs.contentElement},e.render())}renderLastEditInfo(){const{visibleElements:t,messages:e}=this,{lastEditInfo:r}=this.viewModel;if(!r||!t.lastEditedInfo)return null;const{date:i,user:n}=r,s=r.type==="edit"?n?e.lastEditedByUser:e.lastEdited:n?e.lastCreatedByUser:e.lastCreated,o=bg(s,{date:i,user:n});return ie("div",{key:"edit-info-element",class:this.classes(gs.lastEditedInfo,gs.contentElement)},o)}renderText(t,e){const r=t.text,i=this._contentWidgets[e];return!i||i.destroyed?null:r?ie("div",{key:this._buildKey("text-element",e),class:this.classes(gs.contentElement,gs.text)},i.render()):null}_buildKey(t,...e){return`${t}__${this.get("viewModel.graphic.uid")||"0"}-${e.join("-")}`}_destroyContentWidget(t){t&&(t.viewModel=null,!t.destroyed&&t.destroy())}_destroyContentWidgets(){this.removeHandles(Sme),this._contentWidgets.forEach(t=>this._destroyContentWidget(t)),this._contentWidgets=[]}_addFeatureRelationshipHandles(t){const{flowItems:e,visibleElements:r}=this;this.addHandles([Yn(()=>t,"select-record",({featureViewModel:i})=>{e&&(i.abilities={relationshipContent:!0},e.push(new iQ({flowItems:e,viewModel:i,visibleElements:r})))}),Yn(()=>t,"show-all-records",()=>{if(!e)return;const{viewModel:i}=t;i.showAllEnabled=!0;const n=new vme({visibleElements:{title:!1,description:!1},viewModel:i});this._addFeatureRelationshipHandles(n),e.push(n)})],Sme)}_setupContentWidgets(){this._destroyContentWidgets();const{headingLevel:t,visibleElements:e}=this,r=this.get("viewModel.content"),{contentViewModels:i}=this.viewModel;if(Array.isArray(r))r.forEach((n,s)=>{if(n.type==="attachments"&&(this._contentWidgets[s]=new xet({displayType:n.displayType,headingLevel:e.title?t+1:t,viewModel:i[s]})),n.type==="fields"&&(this._contentWidgets[s]=new IOe({viewModel:i[s]})),n.type==="media"&&(this._contentWidgets[s]=new x3e({viewModel:i[s]})),n.type==="text"&&(this._contentWidgets[s]=new M6({viewModel:i[s]})),n.type==="custom"&&(this._contentWidgets[s]=new M6({viewModel:i[s]})),n.type==="expression"&&(this._contentWidgets[s]=new eut({viewModel:i[s]})),n.type==="relationship"){const o=new vme({viewModel:i[s]});this._addFeatureRelationshipHandles(o),this._contentWidgets[s]=o}},this);else{const n=i[0];n&&!n.destroyed&&(this._contentWidgets[0]=new M6({viewModel:n}))}this.scheduleRender()}};u([d()],Ko.prototype,"graphic",null),u([d()],Ko.prototype,"defaultPopupTemplateEnabled",null),u([d()],Ko.prototype,"flowItems",void 0),u([d()],Ko.prototype,"headingLevel",void 0),u([d({readOnly:!0})],Ko.prototype,"isTable",null),u([d()],Ko.prototype,"label",null),u([d(),_a("esri/widgets/Feature/t9n/Feature")],Ko.prototype,"messages",void 0),u([d(),_a("esri/t9n/common")],Ko.prototype,"messagesCommon",void 0),u([d(),_a("esri/widgets/support/t9n/uriUtils")],Ko.prototype,"messagesURIUtils",void 0),u([d()],Ko.prototype,"spatialReference",null),u([d({readOnly:!0})],Ko.prototype,"title",null),u([d()],Ko.prototype,"visibleElements",void 0),u([cr("visibleElements")],Ko.prototype,"castVisibleElements",null),u([d()],Ko.prototype,"map",null),u([d()],Ko.prototype,"view",null),u([d({type:Soe})],Ko.prototype,"viewModel",void 0),Ko=iQ=u([$("esri.widgets.Feature")],Ko);const iut=Ko;var GPe;const tU=Symbol("anchorHandles");let dT=class extends Sn.EventedAccessor{constructor(e){super(e),this[GPe]=new qr,this.location=null,this.screenLocationEnabled=!1,this.view=null,this[tU].add([fo(()=>Fo(this.screenLocationEnabled?this.view:null,r=>[r.size,r.type==="3d"?r.camera:r.viewpoint]),()=>this.notifyChange("screenLocation")),ne(()=>this.screenLocation,(r,i)=>{v(r)&&v(i)&&this.emit("view-change")})])}destroy(){this.view=null,this[tU]=ze(this[tU])}get screenLocation(){var n;const{location:e,view:r,screenLocationEnabled:i}=this;return i&&v(e)&&v(r)&&r.ready?(n=r.toScreen)==null?void 0:n.call(r,e):null}};GPe=tU,u([d()],dT.prototype,"location",void 0),u([d()],dT.prototype,"screenLocation",null),u([d()],dT.prototype,"screenLocationEnabled",void 0),u([d()],dT.prototype,"view",void 0),dT=u([$("esri.widgets.support.AnchorElementViewModel")],dT);const HPe=dT,nut="esri.widgets.CompassViewModel";let rU=class extends HPe{constructor(e){super(e),this.visible=!1}};u([d()],rU.prototype,"visible",void 0),rU=u([$(nut)],rU);const qPe=rU,WG="esri-spinner",XG={base:WG,spinnerStart:`${WG}--start`,spinnerFinish:`${WG}--finish`};let pT=class extends Ga{constructor(e,r){super(e,r),this._animationDelay=500,this._animationPromise=null,this.viewModel=new qPe}initialize(){this.addHandles(ne(()=>this.visible,e=>this._visibleChange(e)))}destroy(){this._animationPromise=null}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}show(e){const{location:r,promise:i}=e??{};r&&(this.viewModel.location=r),this.visible=!0;const n=()=>this.hide();i&&i.catch(()=>{}).then(n)}hide(){this.visible=!1}render(){const{visible:e}=this,{screenLocation:r}=this.viewModel,i=!!r,n=e&&i,s=!e&&i,o={[XG.spinnerStart]:n,[XG.spinnerFinish]:s},a=this._getPositionStyles();return ie("div",{class:this.classes(XG.base,o),styles:a})}_visibleChange(e){if(e)return void(this.viewModel.screenLocationEnabled=!0);const r=YS(this._animationDelay);this._animationPromise=r,r.catch(()=>{}).then(()=>{this._animationPromise===r&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)})}_getPositionStyles(){const{screenLocation:e,view:r}=this.viewModel;if(R(r)||R(e))return{};const{padding:i}=r;return{left:e.x-i.left+"px",top:e.y-i.top+"px"}}};u([d()],pT.prototype,"location",null),u([d()],pT.prototype,"view",null),u([d({type:qPe})],pT.prototype,"viewModel",void 0),u([d()],pT.prototype,"visible",null),pT=u([$("esri.widgets.Spinner")],pT);const sut=pT,RB={iconZoom:"esri-icon-zoom-in-magnifying-glass",iconTrash:"esri-icon-trash",iconBrowseClusteredFeatures:"esri-icon-table"},gS=new u3({id:"zoom-to-feature",title:"{messages.zoom}",className:RB.iconZoom}),Eme=new u3({id:"remove-selected-feature",title:"{messages.remove}",className:RB.iconTrash}),ZA=new u3({id:"zoom-to-clustered-features",title:"{messages.zoom}",className:RB.iconZoom}),JA=new u3({id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:RB.iconBrowseClusteredFeatures}),out="esri.widgets.Popup.PopupViewModel",Fz=re.getLogger(out),aut=t=>{const{event:e,view:r}=t,{action:i}=e,n=r&&r.popup;if(!i)return Promise.reject(new H("trigger-action:missing-arguments","Event has no action"));if(!n)return Promise.reject(new H("trigger-action:missing-arguments","view.popup is missing"));const{disabled:s,id:o}=i;if(!o)return Promise.reject(new H("trigger-action:invalid-action","action.id is missing"));if(s)return Promise.reject(new H("trigger-action:invalid-action","Action is disabled"));if(o===gS.id)return cut(n.viewModel).catch(lY);if(o===ZA.id)return uut(n.viewModel);if(o===JA.id)return n.featureMenuOpen=!n.featureMenuOpen,n.viewModel.browseClusterEnabled=!n.viewModel.browseClusterEnabled,Promise.resolve();if(n.viewModel.browseClusterEnabled=!1,o===Eme.id){n.close();const{selectedFeature:a}=n;if(!a)return Promise.reject(new H(`trigger-action:${Eme.id}`,"selectedFeature is required",{selectedFeature:a}));const{sourceLayer:l}=a;return l?l.remove(a):r.graphics.remove(a),Promise.resolve()}return Promise.resolve()};function WPe(t){const{selectedFeature:e,location:r,view:i}=t;return i?i.type==="3d"?e??r??null:t.get("selectedFeature.geometry")||r:null}function WT(t){var e,r;return!!t&&t.isAggregate&&((r=(e=t.sourceLayer)==null?void 0:e.featureReduction)==null?void 0:r.type)==="cluster"}async function lut(t,e){if((e==null?void 0:e.type)!=="3d"||!t||t.declaredClass!=="esri.Graphic")return!0;const r=e.getViewForGraphic(t);if(r&&"whenGraphicBounds"in r){let i;try{i=await r.whenGraphicBounds(t,{useViewElevation:!0})}catch{}return!i||!i.boundingBox||i.boundingBox[0]===i.boundingBox[3]&&i.boundingBox[1]===i.boundingBox[4]&&i.boundingBox[2]===i.boundingBox[5]}return!0}async function cut(t){var h;const{location:e,selectedFeature:r,view:i,zoomFactor:n}=t,s=WPe(t);if(!i||!s){const p=new H("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:s,view:i});throw Fz.error(p),p}const o=i.scale/n,a=(h=t.selectedFeature)==null?void 0:h.geometry,l=a??e,c=v(l)&&l.type==="point"&&await lut(r,i);gS.active=!0,gS.disabled=!0;try{await t.zoomTo({target:{target:s,scale:c?o:void 0}})}catch{const f=new H("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:r});Fz.error(f)}finally{gS.active=!1,gS.disabled=!1,t.zoomToLocation=null,c&&(t.location=l)}}async function uut(t){const{selectedFeature:e,view:r}=t;if((r==null?void 0:r.type)!=="2d"){const o=new H("zoomToCluster:invalid-view","View must be 2d MapView.",{view:r});throw Fz.error(o),o}if(!e||!WT(e)){const o=new H("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:e});throw Fz.error(o),o}const[i,n]=await Eoe(r,e);ZA.active=!0,ZA.disabled=!0;const{extent:s}=await i.queryExtent(n);await t.zoomTo({target:s}),ZA.active=!1,ZA.disabled=!1}async function hut(t){const{view:e,selectedFeature:r}=t;if(!e||!r)return;const[i,n]=await Eoe(e,r),{extent:s}=await i.queryExtent(n);t.selectedClusterBoundaryFeature.geometry=s,e.graphics.add(t.selectedClusterBoundaryFeature)}async function dut(t){var o;const{selectedFeature:e,view:r}=t;if(!r||!e)return;const[i,n]=await Eoe(r,e);JA.active=!0,JA.disabled=!0;const{features:s}=await i.queryFeatures(n);JA.active=!1,JA.disabled=!1,(o=r.popup)==null||o.open({features:[e].concat(s),featureMenuOpen:!0})}async function Eoe(t,e){const r=await t.whenLayerView(e.sourceLayer),i=r.createQuery(),n=e.getObjectId();return i.aggregateIds=n!=null?[n]:[],[r,i]}function put(t){const e=t.features.filter(r=>WT(r));e.length&&(t.features=e)}function XPe(t){var e;if(R(t))return null;switch(t.type){case"point":return t;case"extent":return t.center;case"polygon":return t.centroid;case"multipoint":case"polyline":return(e=t.extent)==null?void 0:e.center;default:return null}}const zt="esri-popup",wM=`${zt}__header`,Ww=`${zt}--is-docked`,Ae={calciteThemeLight:"calcite-mode-light",calciteThemeDark:"calcite-mode-dark",iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow",iconDockToTop:"esri-icon-maximize",iconDockToBottom:"esri-icon-dock-bottom",iconDockToLeft:"esri-icon-dock-left",iconDockToRight:"esri-icon-dock-right",iconClose:"esri-icon-close",iconUndock:"esri-icon-minimize",iconCheckMark:"esri-icon-check-mark",iconLoading:"esri-icon-loading-indicator",iconDefaultAction:"esri-icon-default-action",iconActionsMenu:"esri-icon-handle-horizontal",rotating:"esri-rotating",base:zt,widget:"esri-widget",main:`${zt}__main-container`,loadingContainer:`${zt}__loading-container`,isCollapsible:`${zt}--is-collapsible`,isCollapsed:`${zt}--is-collapsed`,shadow:`${zt}--shadow`,isDocked:Ww,isDockedTopLeft:`${Ww}-top-left`,isDockedTopCenter:`${Ww}-top-center`,isDockedTopRight:`${Ww}-top-right`,isDockedBottomLeft:`${Ww}-bottom-left`,isDockedBottomCenter:`${Ww}-bottom-center`,isDockedBottomRight:`${Ww}-bottom-right`,alignTopCenter:`${zt}--aligned-top-center`,alignBottomCenter:`${zt}--aligned-bottom-center`,alignTopLeft:`${zt}--aligned-top-left`,alignBottomLeft:`${zt}--aligned-bottom-left`,alignTopRight:`${zt}--aligned-top-right`,alignBottomRight:`${zt}--aligned-bottom-right`,isFeatureMenuOpen:`${zt}--feature-menu-open`,isActionsMenuOpen:`${zt}--actions-menu-open`,hasFeatureUpdated:`${zt}--feature-updated`,header:wM,headerButtons:`${wM}-buttons`,headerContainer:`${wM}-container`,headerContainerButton:`${wM}-container--button`,headerTitle:`${wM}-title`,content:`${zt}__content`,contentHasFlows:"esri-content--has-flows",contentFlowItem:"esri-content__flow-item",footer:`${zt}__footer`,footerHasPagination:`${zt}__footer--has-pagination`,footerHasActions:`${zt}__footer--has-actions`,footerHasActionsMenu:`${zt}__footer--has-actions-menu`,button:`${zt}__button`,buttonDisabled:`${zt}__button--disabled`,buttonDock:`${zt}__button--dock`,icon:`${zt}__icon`,iconDock:`${zt}__icon--dock-icon`,inlineActionsContainer:`${zt}__inline-actions-container`,actionsMenuButton:`${zt}__actions-menu-button`,actions:`${zt}__actions`,action:`${zt}__action`,actionImage:`${zt}__action-image`,actionText:`${zt}__action-text`,actionToggle:`${zt}__action-toggle`,actionToggleOn:`${zt}__action-toggle--on`,actionExit:`${zt}__action--exit`,actionSelectFeature:`${zt}__action--select-feature`,pointer:`${zt}__pointer`,pointerDirection:`${zt}__pointer-direction`,navigation:`${zt}__navigation`,paginationPrevious:`${zt}__pagination-previous`,paginationNext:`${zt}__pagination-next`,paginationPreviousIconLTR:`${zt}__pagination-previous-icon`,paginationPreviousIconRTL:`${zt}__pagination-previous-icon--rtl`,paginationNextIconLTR:`${zt}__pagination-next-icon`,paginationNextIconRTL:`${zt}__pagination-next-icon--rtl`,featureMenu:`${zt}__feature-menu`,featureMenuList:`${zt}__feature-menu-list`,featureMenuItem:`${zt}__feature-menu-item`,featureMenuViewport:`${zt}__feature-menu-viewport`,featureMenuHeader:`${zt}__feature-menu-header`,featureMenuNote:`${zt}__feature-menu-note`,featureMenuSelected:`${zt}__feature-menu-item--selected`,featureMenuButton:`${zt}__feature-menu-button`,featureMenuTitle:`${zt}__feature-menu-title`,featureMenuObserver:`${zt}__feature-menu-observer`,featureMenuLoader:`${zt}__feature-menu-loader`,collapseButton:`${zt}__collapse-button`,collapseIcon:`${zt}__collapse-icon`},YPe="OBJECTID";var h2;(function(t){t[t.size=22]="size",t[t.lineWidth=50]="lineWidth",t[t.maxSize=120]="maxSize",t[t.maxOutlineSize=80]="maxOutlineSize",t[t.tallSymbolWidth=20]="tallSymbolWidth"})(h2||(h2={}));function ZPe(){const t=new Float32Array(6);return t[0]=1,t[3]=1,t}function fut(t){const e=new Float32Array(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function mut(t,e,r,i,n,s){const o=new Float32Array(6);return o[0]=t,o[1]=e,o[2]=r,o[3]=i,o[4]=n,o[5]=s,o}function gut(t,e){return new Float32Array(t,e,6)}function JPe(t,e,r,i){const n=e[i],s=e[i+1];t[i]=r[0]*n+r[2]*s+r[4],t[i+1]=r[1]*n+r[3]*s+r[5]}function yut(t,e,r,i=0,n=0,s=2){const o=n||e.length/s;for(let a=i;a<o;a++)JPe(t,e,r,a*s)}Object.freeze(Object.defineProperty({__proto__:null,clone:fut,create:ZPe,createView:gut,fromValues:mut,transform:JPe,transformMany:yut},Symbol.toStringTag,{value:"Module"}));function _ut(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function vut(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function but(t,e,r,i,n,s,o){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=s,t[5]=o,t}function Coe(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5];let l=r*s-i*n;return l?(l=1/l,t[0]=s*l,t[1]=-i*l,t[2]=-n*l,t[3]=r*l,t[4]=(n*a-s*o)*l,t[5]=(i*o-r*a)*l,t):null}function wut(t){return t[0]*t[3]-t[1]*t[2]}function KPe(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=r[0],h=r[1],p=r[2],f=r[3],m=r[4],g=r[5];return t[0]=i*c+s*h,t[1]=n*c+o*h,t[2]=i*p+s*f,t[3]=n*p+o*f,t[4]=i*m+s*g+a,t[5]=n*m+o*g+l,t}function OB(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=Math.sin(r),h=Math.cos(r);return t[0]=i*h+s*c,t[1]=n*h+o*c,t[2]=i*-c+s*h,t[3]=n*-c+o*h,t[4]=a,t[5]=l,t}function Aoe(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=r[0],h=r[1];return t[0]=i*c,t[1]=n*c,t[2]=s*h,t[3]=o*h,t[4]=a,t[5]=l,t}function oD(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=r[0],h=r[1];return t[0]=i,t[1]=n,t[2]=s,t[3]=o,t[4]=i*c+s*h+a,t[5]=n*c+o*h+l,t}function QPe(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=-r,t[3]=i,t[4]=0,t[5]=0,t}function eIe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function Roe(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function xut(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function Tut(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+1)}function Sut(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t}function tIe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}function Eut(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t}function Cut(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t}function Aut(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function Rut(t,e){const r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=e[0],c=e[1],h=e[2],p=e[3],f=e[4],m=e[5],g=yl();return Math.abs(r-l)<=g*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(i-c)<=g*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(n-h)<=g*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(s-p)<=g*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(o-f)<=g*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(a-m)<=g*Math.max(1,Math.abs(a),Math.abs(m))}const Out=KPe,Mut=tIe;Object.freeze(Object.defineProperty({__proto__:null,add:Sut,copy:_ut,determinant:wut,equals:Rut,exactEquals:Aut,frob:Tut,fromRotation:QPe,fromScaling:eIe,fromTranslation:Roe,identity:vut,invert:Coe,mul:Out,multiply:KPe,multiplyScalar:Eut,multiplyScalarAndAdd:Cut,rotate:OB,scale:Aoe,set:but,str:xut,sub:Mut,subtract:tIe,translate:oD},Symbol.toStringTag,{value:"Module"}));const Cme=ue("android");ue("chrome")||Cme&&Cme>=4;dJ();function c7t(t){return t=t||globalThis.location.hostname,Iut.some(e=>(t==null?void 0:t.match(e))!=null)}function Put(t,e){return t&&(e=e||globalThis.location.hostname)?e.match(rIe)!=null||e.match(nIe)!=null?t.replace("static.arcgis.com","staticdev.arcgis.com"):e.match(iIe)!=null||e.match(sIe)!=null?t.replace("static.arcgis.com","staticqa.arcgis.com"):t:t}const rIe=/^devext.arcgis.com$/,iIe=/^qaext.arcgis.com$/,nIe=/^[\w-]*\.mapsdevext.arcgis.com$/,sIe=/^[\w-]*\.mapsqa.arcgis.com$/,Iut=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,rIe,iIe,/^jsapps.esri.com$/,nIe,sIe];h2.size;h2.maxSize;h2.maxOutlineSize;h2.lineWidth;h2.tallSymbolWidth;function oIe(t){return t&&"opacity"in t?t.opacity*oIe(t.parent):1}async function $ut(t,e){if(!t)return;const r=t.sourceLayer,i=(v(e)&&e.useSourceLayer?r:t.layer)??r,n=oIe(i);if(v(t.symbol)&&(!v(e)||e.ignoreGraphicSymbol!==!0)){const b=t.symbol.type==="web-style"?await ztt(t.symbol,{...e,cache:v(e)?e.webStyleCache:null}):t.symbol.clone();return lG(b,null,n),b}const s=(v(e)?e.renderer:null)??(i&&"renderer"in i?i.renderer:null);let o=s&&"getSymbolAsync"in s?await s.getSymbolAsync(t,e):null;if(!o)return;if(o=o.type==="web-style"?await o.fetchSymbol({...e,cache:v(e)?e.webStyleCache:null}):o.clone(),!(s&&"visualVariables"in s&&s.visualVariables&&s.visualVariables.length))return lG(o,null,n),o;if("arcadeRequiredForVisualVariables"in s&&s.arcadeRequiredForVisualVariables&&(R(e)||R(e.arcade))){const b={...e};b.arcade=await iy(),e=b}const a=await Q(()=>Promise.resolve().then(()=>Kse),void 0),l=[],c=[],h=[],p=[];for(const b of s.visualVariables)switch(b.type){case"color":l.push(b);break;case"opacity":c.push(b);break;case"rotation":p.push(b);break;case"size":b.target||h.push(b)}const f=!!l.length&&l[l.length-1],m=f?a.getColor(f,t,e):null,g=!!c.length&&c[c.length-1];let _=g?a.getOpacity(g,t,e):null;if(n!=null&&(_=_!=null?_*n:n),lG(o,m,_),h.length){const b=a.getAllSizes(h,t,e);await ktt(o,b)}for(const b of p)Utt(o,a.getRotationAngle(b,t,e),b.axis);return o}let S_=class{constructor(e,r){this._owner=r,this._properties={},this._afterDispatchHandle=null;for(const i in e){const n=e[i],s=new r2e(n,void 0,void 0,2,2);this._properties[i]={pool:s,acquired:[]}}this._afterDispatchHandle=m2e(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const e in this._properties){const r=this._properties[e];for(const i of r.acquired)Mhe(i)||r.pool.release(i);r.pool.destroy(),r.pool=null,r.acquired=null}this._properties=null,this._owner=null}get(e){const r=this._owner._get(e),i=this._properties[e];let n=i.pool.acquire();for(i.acquired.push(n);n===r;)i.acquired.push(n),n=i.pool.acquire();return n}_release(){for(const e in this._properties){const r=this._properties[e];let i=0;for(const n of r.acquired)Mhe(n)?r.acquired[i++]=n:r.pool.release(n);r.acquired.length=i}}};const Lut=ue("mac")?"Meta":"Ctrl",MB={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let t=48;t<58;t++)MB[t]=String.fromCharCode(t);for(let t=1;t<25;t++)MB[111+t]=`F${t}`;for(let t=65;t<91;t++)MB[t]=[String.fromCharCode(t+32),String.fromCharCode(t)];function Dut(t){if(t.key!==void 0)return G1(t);const e=MB[t.keyCode];return Array.isArray(e)?t.shiftKey?e[1]:e[0]:e}function Nut(t){switch(t){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}let Fut=class{constructor(e,r=[]){this.eventType=e,this.keyModifiers=r}matches(e){if(e.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const r=e.modifiers;for(const i of this.keyModifiers)if(!r.has(i))return!1;return!0}};const Ame=re.getLogger("esri.views.input.InputHandler");let nn=class{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const r=this._incoming[e];for(const i of r)this._incomingEventMatches.push(i.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(e=>e.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager?Ame.error("This InputHandler has already been registered with an InputManager"):(e.setEventCallback(r=>this._handleEvent(r)),e.setUninstallCallback(()=>this._onUninstall()),this._manager=e)}onUninstall(){}registerIncoming(e,r,i){let n;typeof r=="function"?(i=r,n=[]):n=r||[];const s=typeof e=="string"?new Fut(e,n):e,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=h=>{const p=this._incoming[h.match.eventType];if(p){const f=p.indexOf(h);p.splice(f,1),o(),this._manager&&this._manager.updateDependencies()}},l=new kut(s,i,{onPause:a,onRemove:a,onResume:h=>{const p=this._incoming[h.match.eventType];p&&!p.includes(h)&&(p.push(h),o(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[s.eventType];return c||(c=[],this._incoming[s.eventType]=c),c.push(l),o(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(e){if(this._outgoing[e])throw new Error("There is already a callback registered for this outgoing InputEvent: "+e);const r=new Uut(e,{onEmit:(i,n,s,o)=>{var a;(a=this._manager)==null||a.emit(i.eventType,n,s,o)},onRemove:i=>{var n;delete this._outgoing[i.eventType],(n=this._manager)==null||n.updateDependencies()}});return this._outgoing[e]=r,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),r}startCapturingPointer(e){var r;(r=this._manager)==null||r.setPointerCapture(e,!0)}stopCapturingPointer(e){var r;(r=this._manager)==null||r.setPointerCapture(e,!1)}refreshHasPendingInputs(){var e;(e=this._manager)==null||e.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):Ame.error("This InputHandler is not registered with an InputManager")}_handleEvent(e){var i;const r=this._incoming[e.type];if(r){for(const n of r)if(n.match.matches(e)&&((i=n.callback)==null||i.call(n,e),e.shouldStopPropagation()))break}}},kut=class{constructor(e,r,i){this.match=e,this._callback=r,this._handler=i}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}},Uut=class{constructor(e,r){this.eventType=e,this._removed=!1,this._handler=r}emit(e,r,i){this._removed||this._handler.onEmit(this,e,r,i)}remove(){this._removed=!0,this._handler.onRemove(this)}},zut=class extends nn{constructor(e){super(!0),this._onChange=e,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",r=>{this._update(r.data)})}_update(e){const r=e.native.pointerType==="touch"?"touch":"mouse",{x:i,y:n}=e;r===this._value&&this._x===i&&this._y===n||(this._value=r,this._x=i,this._y=n,this._onChange(r,i,n))}},kz=class{constructor(e){this._observable=new lne,this._value=e}get(){return Er(this._observable),this._value}set(e){e!==this._value&&(this._value=e,this._observable.notify())}},Vut=class extends nn{get multiTouchActive(){return this._multiTouchActive.get()}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=new kz(!1),this._onPointerAdd=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.add(e.native.pointerId),this._update())},this._onPointerRemove=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.delete(e.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.set(this._activeTouchPointerIds.size>1)}},Sf=class extends be{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=Lut,this._latestPointerType="mouse",this._propertiesPool=new S_({latestPointerLocation:Gut},this),this.latestPointerLocation=null,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const r of e)this.uninstallHandlers(r);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}installHandlers(e,r,i=Xg.INTERNAL){if(this._nameToGroup[e])return void re.getLogger(this.declaredClass).error("There is already an InputHandler group registered under the name `"+e+"`");if(r.length===0)return void re.getLogger(this.declaredClass).error("Can't register a group of zero handlers");const n={name:e,handlers:r.map(s=>({handler:s,active:!0,removed:!1,priorityIndex:0,groupPriority:i,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=n;for(let s=n.handlers.length-1;s>=0;s--){const o=n.handlers[s];this._handlers.push(o),o.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(a,l,c,h,p)=>{this._emitInputEvent(o.priorityIndex+1,a,l,c,p,h)},setPointerCapture:(a,l)=>{this._setPointerCapture(n,o,a,l)},setEventCallback:a=>{o.eventCallback=a},setUninstallCallback:a=>{o.uninstallCallback=a},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const r=this._nameToGroup[e];r?(r.handlers.forEach(i=>{var n;i.removed=!0,(n=i.uninstallCallback)==null||n.call(i)}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):re.getLogger(this.declaredClass).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,r=new Set;this._handlersPriority=[];for(let i=this._handlers.length-1;i>=0;i--){const n=this._handlers[i];n.priorityIndex=i,this._handlersPriority.push(n)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let i=this._handlersPriority.length-1;i>=0;i--){const n=this._handlersPriority[i];n.priorityIndex=i;let s=n.handler.hasSideEffects;if(!s){for(const o of n.handler.outgoingEventTypes)if(e.has(o)){s=!0;break}}if(s)for(const o of n.handler.incomingEventMatches){e.add(o.eventType);for(const a of o.keyModifiers)Nut(a)||r.add(a)}n.active=s}this._sourceEvents=e,this._keyModifiers=r,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,r,i){this._latestPointerType=e;const n=this._get("latestPointerLocation");if(R(n)||n.x!==r||n.y!==i){const s=this._propertiesPool.get("latestPointerLocation");s.x=r,s.y=i,this._set("latestPointerLocation",s)}}_onEventReceived(e,r){if(e==="pointer-capture-lost"){const s=r;this._pointerCaptures.delete(s.native.pointerId)}this._updateKeyModifiers(e,r);const i=this.test.timestamp!=null?this.test.timestamp:r.native?r.native.timestamp:void 0,n=r.native?r.native.cancelable:void 0;this._emitInputEventFromSource(e,r,i,n)}_updateKeyModifiers(e,r){if(!r)return;let i=!1;const n=()=>{if(!i){const a=new Set;this._activeKeyModifiers.forEach(l=>{a.add(l)}),this._activeKeyModifiers=a,i=!0}},s=(a,l)=>{l&&!this._activeKeyModifiers.has(a)?(n(),this._activeKeyModifiers.add(a)):!l&&this._activeKeyModifiers.has(a)&&(n(),this._activeKeyModifiers.delete(a))};if(e==="key-down"||e==="key-up"){const a=r.key;this._keyModifiers.has(a)&&s(a,e==="key-down")}const o=r.native;s("Alt",!(!o||!o.altKey)),s("Ctrl",!(!o||!o.ctrlKey)),s("Shift",!(!o||!o.shiftKey)),s("Meta",!(!o||!o.metaKey)),s("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new zut((e,r,i)=>this._setLatestPointer(e,r,i)),this._multiTouchHandler=new Vut,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],Xg.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,Xg.INTERNAL)}_setPointerCapture(e,r,i,n){const s=e.name+"-"+r.priorityIndex,o=this._pointerCaptures.get(i.pointerId)||new Set;this._pointerCaptures.set(i.pointerId,o),n?(o.add(s),o.size===1&&this.eventSource&&this.eventSource.setPointerCapture(i,!0)):o.has(s)&&(o.delete(s),o.size===0&&(this._pointerCaptures.delete(i.pointerId),this.eventSource&&this.eventSource.setPointerCapture(i,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,r,i,n){this._emitInputEvent(0,e,r,i,n)}_emitInputEvent(e,r,i,n,s,o){const a=n!==void 0?n:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),l=s!==void 0&&s,c={event:new But(r,i,a,o||this._activeKeyModifiers,l),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(c):this._doNewPropagation(c)}_doNewPropagation(e){this._currentPropagation={events:new az,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){var r,i;const e=Ic(this._currentPropagation);for(;e.events.length>0;){const{event:n,priorityIndex:s}=e.events.pop(),o=n.data&&n.data.eventId;if(!(o!=null&&this._stoppedPropagationEventIds.has(o)))for(e.currentHandler=this._handlersPriority[s];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!n.shouldStopPropagation()&&((i=(r=e.currentHandler).eventCallback)==null||i.call(r,n)),n.shouldStopPropagation()){o!=null&&this._stoppedPropagationEventIds.add(o);break}if(n.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:n,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}_pausePropagation(e){const r=new az;r.push(e);const i=this._currentPropagation;if(i){for(;i.events.length;)r.push(i.events.pop());i.events=r,i.currentHandler=null}}_compareHandlerPriority(e,r){if(e.handler.hasSideEffects!==r.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==r.groupPriority)return e.groupPriority>r.groupPriority?-1:1;for(const i of e.handler.incomingEventMatches)for(const n of r.handler.incomingEventMatches){if(i.eventType!==n.eventType)continue;const s=i.keyModifiers.filter(o=>n.keyModifiers.includes(o));if(s.length===i.keyModifiers.length!=(s.length===n.keyModifiers.length))return i.keyModifiers.length>n.keyModifiers.length?-1:1}return e.priorityIndex>r.priorityIndex?-1:1}_sortHandlersPriority(e){const r=[];for(const i of e){let n=0;for(;n<r.length&&this._compareHandlerPriority(i,r[n])>=0;)n++;r.splice(n,0,i)}return r}get debug(){const e=r=>{const i=this._setPointerCapture;this._setPointerCapture=()=>{},r(),this._setPointerCapture=i};return{injectEvent:(r,i)=>{e(()=>{this._onEventReceived(r,i)})},disablePointerCapture:e}}};u([d({readOnly:!0})],Sf.prototype,"hasPendingInputs",null),u([d({constructOnly:!0})],Sf.prototype,"eventSource",void 0),u([d({constructOnly:!0})],Sf.prototype,"recognizers",void 0),u([d()],Sf.prototype,"_latestPointerType",void 0),u([d()],Sf.prototype,"latestPointerType",null),u([d()],Sf.prototype,"multiTouchActive",null),u([d({readOnly:!0})],Sf.prototype,"latestPointerLocation",void 0),Sf=u([$("esri.views.input.InputManager")],Sf);let But=class{constructor(e,r,i,n,s){this.type=e,this.data=r,this.timestamp=i,this.modifiers=n,this.cancelable=s,this._propagationState=N1.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=N1.STOPPED}shouldStopPropagation(){return(this._propagationState&N1.STOPPED)!=0}async(e){this._propagationState|=N1.PAUSED;const r=(i,n)=>{this._propagationState&=~N1.PAUSED;const s=this._resumeCallback;if(this._resumeCallback=null,s&&s(),n)throw i;return i};return(typeof e=="function"?e():e).then(i=>r(i,!1),i=>r(i,!0))}shouldPausePropagation(e){return!!(this._propagationState&N1.PAUSED)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}};var N1;(function(t){t[t.NONE=0]="NONE",t[t.STOPPED=1]="STOPPED",t[t.PAUSED=2]="PAUSED"})(N1||(N1={}));const Xg={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};let jut=class{};const Gut=jut;function Rme(t){return t&&typeof t.highlight=="function"}function Hut(t){return t&&typeof t.maskOccludee=="function"}function w7t(t,e,r){return R(t)||t>r&&(e===0||t<e)}function x7t(t,e){return v(t)&&t>0||v(e)&&e>0}function T7t(t){const e=t.effectiveScaleRange;return{minScale:(e==null?void 0:e.minScale)??0,maxScale:(e==null?void 0:e.maxScale)??0}}const aIe=t=>{let e=class extends t{constructor(...r){super(...r),this.goToOverride=null,this.view=null}callGoTo(r){const{view:i}=this;return b9(i),this.goToOverride?this.goToOverride(i,r):i.goTo(r.target,r.options)}};return u([d()],e.prototype,"goToOverride",void 0),u([d()],e.prototype,"view",void 0),e=u([$("esri.widgets.support.GoTo")],e),e},F$=ct.ofType({key:"type",defaultKeyValue:"button",base:D9,typeMap:{button:u3,toggle:FEe}}),qut=()=>[gS.clone()],Wut=()=>[ZA.clone(),JA.clone()];let Xr=class extends aIe(HPe){get isLoadingFeature(){return this.featureViewModels.some(e=>e.waitingForContent)}constructor(e){super(e),this._handles=new qr,this._pendingPromises=new Set,this._fetchFeaturesController=null,this._highlightSelectedFeaturePromise=null,this._highlightActiveFeaturePromise=null,this._selectedClusterFeature=null,this.featurePage=null,this.actions=new F$,this.activeFeature=null,this.defaultPopupTemplateEnabled=!1,this.autoCloseEnabled=!1,this.autoOpenEnabled=!0,this.browseClusterEnabled=!1,this.content=null,this.featuresPerPage=20,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new Va({symbol:new Mw({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null}initialize(){this._handles.add([ne(()=>[this.autoOpenEnabled,this.view],()=>this._autoOpenEnabledChange()),this.on("view-change",()=>this._autoClose()),ne(()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view],()=>this._highlightSelectedFeature()),ne(()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view],()=>this._highlightActiveFeature()),ne(()=>{var e,r;return(r=(e=this.view)==null?void 0:e.animation)==null?void 0:r.state},e=>this._animationStateChange(e)),ne(()=>this.location,e=>this._locationChange(e)),ne(()=>this.selectedFeature,e=>this._selectedFeatureChange(e)),ne(()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage],()=>this._selectedFeatureIndexChange()),ne(()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels],()=>this._setGraphicOnFeatureViewModels()),ne(()=>this.featureViewModels,()=>this._featureViewModelsChange()),this.on("trigger-action",e=>aut({event:e,view:this.view})),fo(()=>!this.waitingForResult,()=>this._waitingForResultChange(),Zr),ne(()=>{var e,r;return[this.features,(e=this.view)==null?void 0:e.map,(r=this.view)==null?void 0:r.spatialReference]},()=>this._updateFeatureVMs()),ne(()=>{var e;return(e=this.view)==null?void 0:e.scale},()=>this._viewScaleChange()),fo(()=>!this.visible,()=>this.browseClusterEnabled=!1),ne(()=>this.browseClusterEnabled,e=>e?this.enableClusterBrowsing():this.disableClusterBrowsing())])}destroy(){this._cancelFetchingFeatures(),this._handles.destroy(),this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const e=this._get("allActions")||new F$;e.removeAll();const{actions:r,defaultActions:i,defaultPopupTemplateEnabled:n,includeDefaultActions:s,selectedFeature:o}=this,a=s?i.concat(r):r,l=o&&(typeof o.getEffectivePopupTemplate=="function"&&o.getEffectivePopupTemplate(n)||o.popupTemplate),c=l&&l.actions,h=l&&l.overwriteActions?c:c?c.concat(a):a;return h&&h.filter(Boolean).forEach(p=>e.add(p)),e}get defaultActions(){const e=this._get("defaultActions")||new F$;return e.removeAll(),e.addMany(WT(this.selectedFeature)?Wut():qut()),e}get featureCount(){return this.features.length}get features(){return this._get("features")||[]}set features(e){const r=e||[];this._set("features",r);const{pendingPromisesCount:i,promiseCount:n,selectedFeatureIndex:s}=this,o=n&&r.length;o&&i&&s===-1?this.selectedFeatureIndex=0:o&&s!==-1||(this.selectedFeatureIndex=r.length?0:-1)}get location(){return this._get("location")||null}set location(e){var n,s,o;let r=e;const i=(s=(n=this.view)==null?void 0:n.spatialReference)==null?void 0:s.isWebMercator;e&&((o=e==null?void 0:e.spatialReference)!=null&&o.isWGS84)&&i&&(r=Gg(e)),this._set("location",r)}get pendingPromisesCount(){return this._pendingPromises.size}get waitingForResult(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||this.featureCount!==0)}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(e){if(this._pendingPromises.clear(),this.features=[],!Array.isArray(e)||!e.length)return this._set("promises",[]),void this.notifyChange("pendingPromisesCount");this._set("promises",e),(e=e.slice(0)).forEach(r=>{this._pendingPromises.add(r);const i=s=>{this._pendingPromises.has(r)&&this._updateFeatures(s),this._updatePendingPromises(r)},n=()=>this._updatePendingPromises(r);r.then(i,n)}),this.notifyChange("pendingPromisesCount")}get selectedFeature(){const{features:e,selectedFeatureIndex:r}=this;return r===-1?null:e[r]||null}get selectedFeatureIndex(){const e=this._get("selectedFeatureIndex");return typeof e=="number"?e:-1}set selectedFeatureIndex(e){const{featureCount:r}=this;e=isNaN(e)||e<-1||!r?-1:(e+r)%r,this.activeFeature=null,this._set("selectedFeatureIndex",e)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get state(){return this.get("view.ready")?"ready":"disabled"}centerAtLocation(){const{view:e}=this,r=WPe(this);return r&&e?this.callGoTo({target:{target:r,scale:e.scale}}):Promise.reject(new H("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:r,view:e}))}zoomTo(e){return this.callGoTo(e)}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(e,r){const{view:i}=this;if(!i||!e)throw new H("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:i});return i.fetchPopupFeatures(e,{event:r&&r.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:r&&r.signal})}open(e){const r={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...e,visible:!0},{fetchFeatures:i}=r;delete r.fetchFeatures,i&&this._setFetchFeaturesPromises(r.location);const n=["actionsMenuOpen","collapsed","featureMenuOpen"];for(const s of n)delete r[s];this.set(r)}triggerAction(e){const r=this.allActions.getItemAt(e);r&&!r.disabled&&this.emit("trigger-action",{action:r})}next(){return this.selectedFeatureIndex=this.selectedFeatureIndex+1,this}previous(){return this.selectedFeatureIndex=this.selectedFeatureIndex-1,this}disableClusterBrowsing(){put(this),this._clearBrowsedClusterGraphics()}async enableClusterBrowsing(){const{view:e,selectedFeature:r}=this;(e==null?void 0:e.type)==="2d"?WT(r)?(await hut(this),await dut(this)):re.getLogger(this.declaredClass).warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",r):re.getLogger(this.declaredClass).warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",r)}_animationStateChange(e){this.zoomToLocation||(gS.disabled=e==="waiting-for-target")}_clearBrowsedClusterGraphics(){var r;const e=(r=this.view)==null?void 0:r.graphics;e&&(e.remove(this.selectedClusterBoundaryFeature),this._selectedClusterFeature&&e.remove(this._selectedClusterFeature)),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if(WT(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=this.selectedFeature?[this.selectedFeature]:[])}_locationChange(e){const{selectedFeature:r,updateLocationEnabled:i}=this;i&&e&&(!r||r.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:e,featureCount:r,featurePage:i,featuresPerPage:n,featureViewModels:s}=this;if(i===null)return;const o=((i-1)*n+r)%r,a=o+n;s.slice(o,a).forEach((l,c)=>{l&&!l.graphic&&(l.graphic=e[o+c])})}async _selectedFeatureChange(e){const{location:r,updateLocationEnabled:i,view:n}=this;if(e&&n){if(this.browseClusterEnabled)return this._selectedClusterFeature&&(n.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),WT(e)?void 0:(e.symbol=await $ut(e),this._selectedClusterFeature=e,void n.graphics.add(this._selectedClusterFeature));!i&&r||!e.geometry?i&&!e.geometry&&this.centerAtLocation().then(()=>{var o;const s=(o=n.center)==null?void 0:o.clone();s&&(this.location=s)}):this.location=XPe(e.geometry)}}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(e){return this._fetchFeaturesWithController(this._getScreenPoint(e||this.location)).then(r=>{const{clientOnlyGraphics:i,promisesPerLayerView:n}=r,s=Promise.resolve(i),o=n.map(a=>a.promise);this.promises=[s,...o]})}_destroyFeatureVMs(){this.featureViewModels.forEach(e=>e&&!e.destroyed&&e.destroy()),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:e,features:r,featureViewModels:i}=this;if(WT(e)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!r||!r.length)return;const n=i.slice(0),s=[];r.forEach((o,a)=>{var c,h;if(!o)return;let l=null;if(n.some((p,f)=>(p&&p.graphic===o&&(l=p,n.splice(f,1)),!!l)),l)s[a]=l;else{const p=new Soe({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:(c=this.view)==null?void 0:c.spatialReference,graphic:o===e?o:null,map:(h=this.view)==null?void 0:h.map,view:this.view});s[a]=p}}),n.forEach(o=>o&&!o.destroyed&&o.destroy()),this._set("featureViewModels",s)}_getScreenPoint(e){const{view:r}=this;return r&&e&&typeof r.toScreen=="function"?r.toScreen(e):null}_autoOpenEnabledChange(){const e="auto-fetch-features",{_handles:r,autoOpenEnabled:i}=this;if(r.remove(e),i&&this.view){const n=this.view.on("click",s=>{s.pointerType==="mouse"&&s.button!==0||this._fetchFeaturesAndOpen(s)},Xg.WIDGET);r.add(n,e)}}_cancelFetchingFeatures(){const e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}_fetchFeaturesWithController(e,r){this._cancelFetchingFeatures();const i=new AbortController,{signal:n}=i;this._fetchFeaturesController=i,this.notifyChange("waitingForResult");const s=this.fetchFeatures(e,{signal:n,event:r});return s.catch(()=>{}).then(()=>{this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}),s}_fetchFeaturesAndOpen(e){const{screenPoint:r,mapPoint:i}=e,{view:n}=this;this._fetchFeaturesWithController(r,e).then(s=>{var h;const{clientOnlyGraphics:o,promisesPerLayerView:a,location:l}=s,c=[Promise.resolve(o),...a.map(p=>p.promise)];return(h=n==null?void 0:n.popup)==null||h.open({location:l||i,promises:c}),s})}_updatePendingPromises(e){e&&this._pendingPromises.has(e)&&(this._pendingPromises.delete(e),this.notifyChange("pendingPromisesCount"))}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}async _getLayerView(e,r){return await e.when(),e.whenLayerView(r)}_getHighlightLayer(e){const{layer:r,sourceLayer:i}=e;return i&&"layer"in i&&i.layer?i.layer:(i==null?void 0:i.type)==="map-notes"||(i==null?void 0:i.type)==="subtype-group"?i:r}_getHighlightTarget(e,r){const i=r.type==="imagery"?void 0:"objectIdField"in r?r.objectIdField||YPe:null,n=e.attributes;return n&&i&&n[i]||e}async _highlightActiveFeature(){const e="highlight-active-feature";this._handles.remove(e);const{highlightEnabled:r,view:i,activeFeature:n,visible:s}=this;if(!(n&&i&&r&&s))return;const o=this._getHighlightLayer(n);if(!(o&&o instanceof nD))return;const a=this._getLayerView(i,o);this._highlightActiveFeaturePromise=a;const l=await a;if(!(l&&Rme(l)&&this._highlightActiveFeaturePromise===a&&this.activeFeature&&this.highlightEnabled))return;const c=l.highlight(this._getHighlightTarget(n,o));this._handles.add(c,e)}async _highlightSelectedFeature(){const e="highlight-selected-feature";this._handles.remove(e);const{selectedFeature:r,highlightEnabled:i,view:n,visible:s}=this;if(!(r&&n&&i&&s))return;const o=this._getHighlightLayer(r);if(!(o&&o instanceof nD))return;const a=this._getLayerView(n,o);this._highlightSelectedFeaturePromise=a;const l=await a;if(!(l&&Rme(l)&&this._highlightSelectedFeaturePromise===a&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;const c=l.highlight(this._getHighlightTarget(r,o));this._handles.add(c,e)}_updateFeatures(e){const{features:r}=this;if(!e||!e.length)return;if(!r.length)return void(this.features=e);const i=e.filter(n=>!r.includes(n));this.features=r.concat(i)}};u([d()],Xr.prototype,"featurePage",void 0),u([d()],Xr.prototype,"isLoadingFeature",null),u([d({type:F$})],Xr.prototype,"actions",void 0),u([d({readOnly:!0})],Xr.prototype,"active",null),u([d()],Xr.prototype,"activeFeature",void 0),u([d({readOnly:!0})],Xr.prototype,"allActions",null),u([d({type:Boolean})],Xr.prototype,"defaultPopupTemplateEnabled",void 0),u([d()],Xr.prototype,"autoCloseEnabled",void 0),u([d()],Xr.prototype,"autoOpenEnabled",void 0),u([d()],Xr.prototype,"browseClusterEnabled",void 0),u([d()],Xr.prototype,"content",void 0),u([d({type:F$,readOnly:!0})],Xr.prototype,"defaultActions",null),u([d({readOnly:!0})],Xr.prototype,"featureCount",null),u([d()],Xr.prototype,"features",null),u([d()],Xr.prototype,"featuresPerPage",void 0),u([d()],Xr.prototype,"featureViewModelAbilities",void 0),u([d({readOnly:!0})],Xr.prototype,"featureViewModels",void 0),u([d()],Xr.prototype,"highlightEnabled",void 0),u([d()],Xr.prototype,"includeDefaultActions",void 0),u([d({type:Ue})],Xr.prototype,"location",null),u([d({readOnly:!0})],Xr.prototype,"pendingPromisesCount",null),u([d({readOnly:!0})],Xr.prototype,"selectedClusterBoundaryFeature",void 0),u([d({readOnly:!0})],Xr.prototype,"waitingForResult",null),u([d({readOnly:!0})],Xr.prototype,"promiseCount",null),u([d()],Xr.prototype,"promises",null),u([d({value:null,readOnly:!0})],Xr.prototype,"selectedFeature",null),u([d({value:-1})],Xr.prototype,"selectedFeatureIndex",null),u([d({readOnly:!0})],Xr.prototype,"selectedFeatureViewModel",null),u([d({readOnly:!0})],Xr.prototype,"state",null),u([d()],Xr.prototype,"title",void 0),u([d()],Xr.prototype,"updateLocationEnabled",void 0),u([d()],Xr.prototype,"view",void 0),u([d()],Xr.prototype,"visible",void 0),u([d()],Xr.prototype,"zoomFactor",void 0),u([d()],Xr.prototype,"zoomToLocation",void 0),u([d()],Xr.prototype,"centerAtLocation",null),Xr=u([$("esri.widgets.Popup.PopupViewModel")],Xr);const lIe=Xr,Ome="selected-index",Xut=0,Mme="popup-spinner",Pme={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},Ime="esri-popup";function Iy(t,e){return e===void 0?`${Ime}__${t}`:`${Ime}__${t}-${e}`}const $me={closeButton:!0,featureNavigation:!0};let Ut=class extends jPe(Ga){constructor(e,r){super(e,r),this._blurClose=!1,this._blurContainer=!1,this._containerNode=null,this._mainContainerNode=null,this._featureMenuNode=null,this._actionsMenuNode=null,this._focusClose=!1,this._focusContainer=!1,this._focusDockButton=!1,this._focusFeatureMenuButton=!1,this._focusActionsMenuButton=!1,this._focusFirstFeature=!1,this._focusFirstAction=!1,this._handles=new qr,this._pointerOffsetInPx=16,this._spinner=null,this._feature=null,this._featureMenuIntersectionObserverNode=null,this._featureMenuViewportNode=null,this._rootFlowItemNode=null,this._featureMenuIntersectionObserverCallback=([i])=>{i!=null&&i.isIntersecting&&this.viewModel.featurePage!=null&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._displaySpinnerThrottled=ER(()=>this._displaySpinner(),Xut),this._exitRelatedRecordsActions=new WeakMap,this._featureSelectionActions=new WeakMap,this._flowItems=new ct,this.alignment="auto",this.collapsed=!1,this.collapseEnabled=!0,this.dockEnabled=!1,this.featureMenuOpen=!1,this.headingLevel=2,this.maxInlineActions=3,this.messages=null,this.messagesCommon=null,this.spinnerEnabled=!0,this.viewModel=new lIe,this.visibleElements={...$me},this._handleOpenRelatedFeature=i=>{this._openRelatedFeature(i)},this._addSelectedFeatureIndexHandle(),this.addHandles([ne(()=>{var i;return(i=this.viewModel)==null?void 0:i.screenLocation},()=>this._positionContainer()),ne(()=>{var i;return[(i=this.viewModel)==null?void 0:i.active,this.dockEnabled]},()=>this._toggleScreenLocationEnabled()),ne(()=>{var i;return(i=this.viewModel)==null?void 0:i.screenLocation},(i,n)=>{!!i!=!!n&&this.reposition()}),ne(()=>{var i,n,s,o,a,l;return[(n=(i=this.viewModel)==null?void 0:i.view)==null?void 0:n.padding,(o=(s=this.viewModel)==null?void 0:s.view)==null?void 0:o.size,(a=this.viewModel)==null?void 0:a.active,(l=this.viewModel)==null?void 0:l.location,this.alignment]},()=>this.reposition()),ne(()=>this.spinnerEnabled,i=>this._spinnerEnabledChange(i)),ne(()=>{var i,n;return(n=(i=this.viewModel)==null?void 0:i.view)==null?void 0:n.size},(i,n)=>this._updateDockEnabledForViewSize(i,n)),ne(()=>{var i;return(i=this.viewModel)==null?void 0:i.view},(i,n)=>this._viewChange(i,n)),ne(()=>{var i,n;return(n=(i=this.viewModel)==null?void 0:i.view)==null?void 0:n.ready},(i,n)=>this._viewReadyChange(i??!1,n??!1)),ne(()=>{var i,n;return[(i=this.viewModel)==null?void 0:i.waitingForResult,(n=this.viewModel)==null?void 0:n.location]},()=>{this._hideSpinner(),this._displaySpinnerThrottled()}),ne(()=>this.selectedFeatureWidget,()=>this._destroyFlowItemWidgets()),ne(()=>{var i,n,s,o;return[(n=(i=this.selectedFeatureWidget)==null?void 0:i.viewModel)==null?void 0:n.title,(o=(s=this.selectedFeatureWidget)==null?void 0:s.viewModel)==null?void 0:o.state]},()=>this._setTitleFromFeatureWidget()),ne(()=>{var i,n,s,o;return[(n=(i=this.selectedFeatureWidget)==null?void 0:i.viewModel)==null?void 0:n.content,(o=(s=this.selectedFeatureWidget)==null?void 0:s.viewModel)==null?void 0:o.state]},()=>this._setContentFromFeatureWidget()),fo(()=>!this.collapsed,()=>{var i,n;((n=(i=this.viewModel)==null?void 0:i.view)==null?void 0:n.widthBreakpoint)==="xsmall"&&this.viewModel.active&&this.collapseEnabled&&this.viewModel.centerAtLocation()}),Yn(()=>{var i;return(i=this.viewModel)==null?void 0:i.allActions},"change",()=>this._watchActions()),ne(()=>{var i;return(i=this.viewModel)==null?void 0:i.allActions},()=>this._watchActions(),Vt),ne(()=>{var i;return(i=this.viewModel)==null?void 0:i.featureViewModels},()=>this._featureMenuViewportScrollTop()),Yn(()=>this._flowItems,"change",()=>{this.notifyChange("_activeFlowItemWidget"),this.scheduleRender()}),ne(()=>{var i,n,s,o;return[(n=(i=this._activeFlowItemWidget)==null?void 0:i.viewModel)==null?void 0:n.state,(o=(s=this._activeFlowItemWidget)==null?void 0:s.viewModel)==null?void 0:o.title]},()=>this.scheduleRender())])}loadDependencies(){return Promise.all([Q(()=>import("./calcite-flow-24bc6433.js"),[]),Q(()=>import("./calcite-flow-item-80ffacc9.js"),["assets/calcite-flow-item-80ffacc9.js","assets/action-87057c25.js","assets/tooltip-db400be7.js","assets/debounce-d5abe404.js","assets/scrim-bf227f3c.js"]),Q(()=>import("./calcite-action-168e199a.js"),["assets/calcite-action-168e199a.js","assets/action-87057c25.js"]),Q(()=>import("./calcite-tooltip-a4a77949.js"),["assets/calcite-tooltip-a4a77949.js","assets/tooltip-db400be7.js","assets/debounce-d5abe404.js"]),Q(()=>import("./calcite-icon-e09f1c1a.js"),[])])}destroy(){var e,r;this._destroyFlowItemWidgets(),this._destroySelectedFeatureWidget(),this._destroySpinner(),(e=this._handles)==null||e.destroy(),this._unobserveFeatureMenuObserver(),(r=this._featureMenuIntersectionObserver)==null||r.disconnect()}get actionsMenuId(){return`${this.id}-actions-menu`}get actionsMenuButtonId(){return`${this.id}-actions-menu-button`}get featureMenuId(){return`${this.id}-feature-menu`}get titleId(){return`${this.id}-popup-title`}get contentId(){return`${this.id}-popup-content`}get hasContent(){const{selectedFeatureWidget:e,viewModel:r}=this;if(!e)return!!(r!=null&&r.content);const i=e.viewModel;if(i!=null&&i.waitingForContent||(i==null?void 0:i.state)==="error")return!0;const n=i==null?void 0:i.content;return Array.isArray(n)?!!n.length:!!n}get featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation!=null}get collapsible(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}get featureMenuVisible(){return this.featureNavigationVisible&&this.featureMenuOpen}get contentCollapsed(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}get dividedActions(){return this._divideActions()}get _activeFlowItemWidget(){const{_flowItems:e}=this;return e.getItemAt(e.length-1)||null}get actions(){return this.viewModel.actions}set actions(e){this.viewModel.actions=e}set actionsMenuOpen(e){this._set("actionsMenuOpen",!!e)}get actionsMenuOpen(){return!!this.viewModel.active&&this._get("actionsMenuOpen")}get autoCloseEnabled(){return this.viewModel.autoCloseEnabled}set autoCloseEnabled(e){this.viewModel.autoCloseEnabled=e}get autoOpenEnabled(){return this.viewModel.autoOpenEnabled}set autoOpenEnabled(e){this.viewModel.autoOpenEnabled=e}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(e){this.viewModel.defaultPopupTemplateEnabled=e}get content(){return this.viewModel.content}set content(e){this.viewModel.content=e}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||Pme}set dockOptions(e){var l,c;const r={...Pme},i=(c=(l=this.viewModel)==null?void 0:l.view)==null?void 0:c.breakpoints,n={};i&&(n.width=i.xsmall,n.height=i.xsmall);const s={...r,...e},o={...r.breakpoint,...n},{breakpoint:a}=s;typeof a=="object"?s.breakpoint={...o,...a}:a&&(s.breakpoint=o),this._set("dockOptions",s),this._setCurrentDockPosition(),this.reposition()}get featureCount(){return this.viewModel.featureCount}get features(){return this.viewModel.features}set features(e){this.viewModel.features=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(e){this.viewModel.highlightEnabled=e}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get promises(){return this.viewModel.promises}set promises(e){this.viewModel.promises=e}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(e){this.viewModel.selectedFeatureIndex=e}get selectedFeatureWidget(){const{_feature:e,visibleElements:r,headingLevel:i,_flowItems:n}=this,{selectedFeatureViewModel:s}=this.viewModel,o={...r,title:!1};return s?(e?(e.viewModel=s,e.visibleElements=o):this._feature=new iut({flowItems:n,headingLevel:i+1,viewModel:s,visibleElements:o}),this._feature):null}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(e){this.viewModel.updateLocationEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}castVisibleElements(e){return{...$me,...e}}blur(){const{active:e}=this.viewModel;e||re.getLogger(this.declaredClass).warn("Popup can only be blurred when currently active."),this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0,this.scheduleRender()}clear(){return this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(e,r){return this.viewModel.fetchFeatures(e,r)}focus(){const{active:e}=this.viewModel;e||re.getLogger(this.declaredClass).warn("Popup can only be focused when currently active."),this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0,this.scheduleRender()}next(){return this.viewModel.next()}open(e){var s,o;this._handles.remove(Ome);const r=!!e&&!!e.featureMenuOpen,i=!!e&&!!e.actionsMenuOpen,n={collapsed:!!e&&!!e.collapsed,actionsMenuOpen:i,featureMenuOpen:r};((o=(s=this.viewModel)==null?void 0:s.view)==null?void 0:o.widthBreakpoint)==="xsmall"&&(n.collapsed=!0),this.set(n),this.viewModel.open(e),this._shouldFocus(e),this._addSelectedFeatureIndexHandle()}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(e){return this.viewModel.triggerAction(e)}render(){var _,b,w,x;const{actionsMenuOpen:e,dockEnabled:r,featureMenuVisible:i,dividedActions:n,currentAlignment:s,currentDockPosition:o}=this,{active:a}=this.viewModel,{menuActions:l}=n,c=a&&l.length>1&&e,h=a&&r,p=a&&!r,f=(b=(_=this.selectedFeature)==null?void 0:_.layer)==null?void 0:b.title,m=(x=(w=this.selectedFeature)==null?void 0:w.layer)==null?void 0:x.id,g={[Ae.alignTopCenter]:s==="top-center",[Ae.alignBottomCenter]:s==="bottom-center",[Ae.alignTopLeft]:s==="top-left",[Ae.alignBottomLeft]:s==="bottom-left",[Ae.alignTopRight]:s==="top-right",[Ae.alignBottomRight]:s==="bottom-right",[Ae.isDocked]:h,[Ae.shadow]:p,[Ae.isDockedTopLeft]:o==="top-left",[Ae.isDockedTopCenter]:o==="top-center",[Ae.isDockedTopRight]:o==="top-right",[Ae.isDockedBottomLeft]:o==="bottom-left",[Ae.isDockedBottomCenter]:o==="bottom-center",[Ae.isDockedBottomRight]:o==="bottom-right",[Ae.isFeatureMenuOpen]:i,[Ae.isActionsMenuOpen]:c};return ie("div",{class:this.classes(Ae.base,g),role:"presentation","data-layer-title":f,"data-layer-id":m,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},a?[this.renderMainContainer(),this.renderPointer()]:null)}renderLoadingIcon(){return ie("span",{"aria-hidden":"true",class:this.classes(Ae.icon,Ae.iconLoading,Ae.rotating)})}renderNavigationLoading(){const{messagesCommon:e}=this;return this.viewModel.pendingPromisesCount?ie("div",{key:Iy("loading-container"),role:"presentation",class:Ae.loadingContainer,"aria-label":e.loading,title:e.loading},this.renderLoadingIcon()):null}renderPreviousIcon(){const e=Ng(this.container),r={[Ae.iconRightTriangleArrow]:e,[Ae.paginationPreviousIconRTL]:e,[Ae.iconLeftTriangleArrow]:!e,[Ae.paginationPreviousIconLTR]:!e};return ie("span",{"aria-hidden":"true",class:this.classes(Ae.icon,r)})}renderPreviousButton(){const{messages:e}=this;return ie("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes(Ae.button,Ae.paginationPrevious),"aria-label":e.previous,title:e.previous},this.renderPreviousIcon())}renderNextIcon(){const e=Ng(this.container),r={[Ae.iconLeftTriangleArrow]:e,[Ae.paginationNextIconRTL]:e,[Ae.iconRightTriangleArrow]:!e,[Ae.paginationNextIconLTR]:!e};return ie("span",{"aria-hidden":"true",class:this.classes(Ae.icon,r)})}renderNextButton(){const{messages:e}=this;return ie("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes(Ae.button,Ae.paginationNext),"aria-label":e.next,title:e.next},this.renderNextIcon())}renderFeatureMenuButton(){const{featureMenuOpen:e,featureMenuId:r,messagesCommon:i}=this,{featureCount:n,selectedFeatureIndex:s}=this.viewModel;return ie("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes(Ae.button,Ae.featureMenuButton),"aria-haspopup":"true","aria-controls":r,"aria-expanded":e.toString(),"aria-label":i.menu,title:i.menu},this._getPageText(n,s))}renderNavigationButtons(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:[]}renderDockIcon(){const{dockEnabled:e}=this,r=this._wouldDockTo(),i={[Ae.iconUndock]:e,[Ae.iconDock]:!e,[Ae.iconDockToRight]:!e&&(r==="top-right"||r==="bottom-right"),[Ae.iconDockToLeft]:!e&&(r==="top-left"||r==="bottom-left"),[Ae.iconDockToTop]:!e&&r==="top-center",[Ae.iconDockToBottom]:!e&&r==="bottom-center"};return ie("span",{"aria-hidden":"true",class:this.classes(i,Ae.icon)})}renderDockButton(){var s,o,a;const{dockEnabled:e,messages:r}=this,i=(o=(s=this.viewModel)==null?void 0:s.view)==null?void 0:o.widthBreakpoint,n=e?r.undock:r.dock;return i!=="xsmall"&&((a=this.dockOptions)!=null&&a.buttonEnabled)?ie("div",{role:"button","aria-label":n,title:n,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(Ae.button,Ae.buttonDock)},this.renderDockIcon()):null}renderTitle(){const{title:e}=this.viewModel,{titleId:r,collapsible:i,contentCollapsed:n,messagesCommon:s}=this,o={[Ae.headerContainerButton]:i},a=ie(Ase,{level:this.headingLevel,class:Ae.headerTitle,innerHTML:e??""}),l=i?ie("button",{key:`${e}--collapsible`,id:r,title:n?s.expand:s.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(Ae.headerContainer,o),"aria-expanded":n?"false":"true",onclick:this._toggleCollapsed,type:"button"},a,ie("calcite-icon",{class:Ae.collapseIcon,key:"collapse-icon",icon:n?"chevron-down":"chevron-up",scale:"m"})):ie("div",{key:e??"title",id:r,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(Ae.headerContainer,o)},a);return e?l:null}renderCloseIcon(){return ie("span",{"aria-hidden":"true",class:this.classes(Ae.icon,Ae.iconClose)})}renderCloseButton(){const{visibleElements:e,messagesCommon:r}=this;return e.closeButton?ie("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:Ae.button,"aria-label":r.close,title:r.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null}renderHeader(){return ie("header",{class:Ae.header},this.renderTitle(),ie("div",{class:Ae.headerButtons},this.renderDockButton(),this.renderCloseButton()))}renderContentContainer(){const{contentId:e,hasContent:r,contentCollapsed:i,_flowItems:n}=this,{content:s}=this.viewModel,o=n.toArray(),a={[Ae.contentHasFlows]:!!o.length};return r&&!i?ie("div",{key:s??"content",enterAnimation:this._createFeatureUpdatedAnimation(),id:e,class:this.classes(Ae.content,a)},ie("calcite-flow",{bind:this},ie("calcite-flow-item",{bind:this,"data-node-ref":"_rootFlowItemNode",afterCreate:fz,key:"root-flow-item",onCalciteFlowItemBack:this._handleBackClick},this.renderContent()),o.map(l=>this.renderFlowItem(l))),o.map(l=>this.renderFlowItemTooltips(l))):null}renderFlowItem(e){const{messages:r}=this,i=Cz(),n="graphic"in e&&!e.isTable;return ie("calcite-flow-item",{bind:this,class:this.classes({[Ae.calciteThemeDark]:!i,[Ae.calciteThemeLight]:i}),heading:e.title??"",description:this._getFlowItemDescription(e),onCalciteFlowItemBack:this._handleBackClick,key:`flow-item-${e.viewModel.uid}`},ie("calcite-action",{class:Ae.actionExit,icon:"move-up",label:r==null?void 0:r.exitRelatedRecords,text:r==null?void 0:r.exitRelatedRecords,slot:"header-actions-start",bind:this,afterCreate:s=>this._storeExitRelatedRecordsAction(e,s),onclick:this._destroyFlowItemWidgets}),n?ie("calcite-action",{class:Ae.actionSelectFeature,icon:"zoom-to-object",label:r==null?void 0:r.selectFeature,text:r==null?void 0:r.selectFeature,slot:"header-actions-end",bind:this,afterCreate:s=>this._storeFeatureSelectionAction(e,s),onclick:()=>this._handleOpenRelatedFeature(e)}):null,ie("div",{class:this.classes(Ae.contentFlowItem,{[Ae.calciteThemeDark]:i,[Ae.calciteThemeLight]:!i})},e.render()))}renderFlowItemTooltips(e){const{messages:r,_exitRelatedRecordsActions:i,_featureSelectionActions:n}=this,s=Cz(),o=n.get(e);return[ie("calcite-tooltip",{class:this.classes({[Ae.calciteThemeDark]:!s,[Ae.calciteThemeLight]:s}),key:`exit-related-records-tooltip-${e.viewModel.uid}`,label:r==null?void 0:r.exitRelatedRecords,overlayPositioning:"fixed",referenceElement:i.get(e),placement:"top"},r==null?void 0:r.exitRelatedRecords),o?ie("calcite-tooltip",{class:this.classes({[Ae.calciteThemeDark]:!s,[Ae.calciteThemeLight]:s}),key:`select-related-record-tooltip-${e.viewModel.uid}`,label:r==null?void 0:r.selectFeature,overlayPositioning:"fixed",referenceElement:o,placement:"top"},r==null?void 0:r.selectFeature):null]}renderActionsMenuButton(){const{actionsMenuId:e,actionsMenuButtonId:r,actionsMenuOpen:i,dividedActions:n,messagesCommon:s}=this,o=i?s.close:s.open,{menuActions:a}=n;return a.length?ie("div",{key:Iy("actions-menu-button"),class:this.classes(Ae.button,Ae.actionsMenuButton),role:"button",id:r,"aria-haspopup":"true","aria-controls":i?e:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":o,title:o},ie("span",{"aria-hidden":"true",class:Ae.iconActionsMenu})):null}renderMenuActions(){const{actionsMenuId:e,actionsMenuButtonId:r,actionsMenuOpen:i,dividedActions:n}=this,{menuActions:s}=n;return s.length&&i?ie("ul",{id:e,role:"menu","aria-labelledby":r,key:Iy("actions"),class:Ae.actions,bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},s.toArray().map(o=>this.renderAction({action:o,type:"menu-item"}))):null}renderInlineActions(){const{inlineActions:e}=this.dividedActions;return e.length?e.toArray().map(r=>this.renderAction({action:r,type:"inline"})):[]}renderInlineActionsContainer(){const{inlineActions:e,menuActions:r}=this.dividedActions,i=!!e.length,n=!!r.length;return i||n?ie("div",{key:"inline-actions-container","data-inline-actions":i.toString(),"data-menu-actions":n.toString(),class:Ae.inlineActionsContainer},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null}renderNavigation(){return this.featureNavigationVisible?ie("section",{key:Iy("navigation"),class:this.classes(Ae.navigation)},this.renderNavigationButtons()):null}renderFooter(){const{featureNavigationVisible:e,dividedActions:r}=this,{inlineActions:i,menuActions:n}=r,s=!!i.length,o=!!n.length,a={[Ae.footerHasPagination]:e,[Ae.footerHasActions]:s,[Ae.footerHasActionsMenu]:o};return e||s?ie("div",{key:Iy("feature-buttons"),class:this.classes(Ae.footer,a)},this.renderInlineActionsContainer(),this.renderNavigation()):null}renderFeatureMenuContainer(){const{messages:e}=this,{featureViewModels:r,isLoadingFeature:i}=this.viewModel,n=bg(e.selectedFeatures,{total:r.length});return ie("section",{key:Iy("menu"),class:Ae.featureMenu},ie("strong",{class:Ae.featureMenuHeader},n),ie("nav",{bind:this,class:Ae.featureMenuViewport,"data-node-ref":"_featureMenuViewportNode",afterCreate:fz},this.renderFeatureMenu(),ie("div",{class:Ae.featureMenuObserver,bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),i?ie("div",{class:Ae.featureMenuLoader},this.renderLoadingIcon()):null))}renderPointer(){return this.dockEnabled?null:ie("div",{key:Iy("pointer"),class:Ae.pointer,role:"presentation"},ie("div",{class:this.classes(Ae.pointerDirection,Ae.shadow)}))}renderMainContainer(){const{dockEnabled:e,currentAlignment:r,currentDockPosition:i,titleId:n,contentId:s,collapsible:o,hasContent:a,contentCollapsed:l,visibleElements:c}=this,{title:h}=this.viewModel,p=r==="bottom-left"||r==="bottom-center"||r==="bottom-right"||i==="top-left"||i==="top-center"||i==="top-right",f=r==="top-left"||r==="top-center"||r==="top-right"||i==="bottom-left"||i==="bottom-center"||i==="bottom-right",m={[Ae.shadow]:e,[Ae.isCollapsible]:o,[Ae.isCollapsed]:l};return ie("div",{class:this.classes(Ae.main,Ae.widget,m),tabIndex:c.closeButton?void 0:-1,role:"dialog","aria-labelledby":h?n:"","aria-describedby":a&&!l?s:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},p?this.renderFooter():null,p?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),f?this.renderFooter():null,f?this.renderFeatureMenuContainer():null)}renderContent(){var r;const e=(r=this.viewModel)==null?void 0:r.content;return e?typeof e=="string"?ie("div",{class:gs.contentNode,key:e,innerHTML:e}):this.renderNodeContent(e):null}renderActionText(e){return ie("span",{key:"text",class:Ae.actionText},e)}renderActionIcon(e){const r=this._getActionClass(e),i=this._getActionImage(e),n={[Ae.iconLoading]:e.active,[Ae.rotating]:e.active,[Ae.icon]:!!r,[Ae.actionImage]:!e.active&&!!i};return r&&(n[r]=!e.active),ie("span",{key:"icon","aria-hidden":"true",class:this.classes(Ae.icon,n),styles:this._getIconStyles(i)})}renderAction(e){const{action:r,type:i}=e,n=this._getActionTitle(r),s={[Ae.action]:r.type!=="toggle",[Ae.actionToggle]:r.type==="toggle",[Ae.actionToggleOn]:r.type==="toggle"&&r.value,[Ae.buttonDisabled]:r.disabled},o=[this.renderActionIcon(r),this.renderActionText(n)],a=i==="menu-item"?ie("li",{key:r.uid,role:"menuitem",tabIndex:0,title:n,"aria-label":n,class:this.classes(Ae.button,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":r.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},o):ie("div",{key:r.uid,role:"button",tabIndex:0,title:n,"aria-label":n,class:this.classes(Ae.button,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":r.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},o);return r.visible?a:null}renderFeatureMenuItem(e,r){const{messages:i,messagesCommon:n}=this,{selectedFeatureIndex:s,selectedFeatureViewModel:o}=this.viewModel,a=e===o,l={[Ae.featureMenuSelected]:a},c=a?ie("span",{key:Iy(`feature-menu-selected-feature-${s}`),title:i.selectedFeature,"aria-label":i.selectedFeature,class:Ae.iconCheckMark}):null,h=ie("span",{innerHTML:e.title||n.untitled});return ie("li",{role:"menuitem",tabIndex:-1,key:Iy(`feature-menu-feature-${s}`),class:this.classes(l,Ae.featureMenuItem),bind:this,"data-feature-index":r,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature,onmouseover:this._setActiveFeature,onmouseleave:this._removeActiveFeature},ie("span",{class:Ae.featureMenuTitle},h,c))}renderFeatureMenu(){const{featureMenuId:e}=this,{featureViewModels:r}=this.viewModel;return r.length>1?ie("ol",{class:Ae.featureMenuList,id:e,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},r.filter(i=>!!i.graphic).map((i,n)=>this.renderFeatureMenuItem(i,n))):null}_storeFeatureSelectionAction(e,r){this._featureSelectionActions.set(e,r),this.scheduleRender()}_storeExitRelatedRecordsAction(e,r){this._exitRelatedRecordsActions.set(e,r),this.scheduleRender()}_getFlowItemDescription(e){return"featureCountDescription"in e?e.featureCountDescription:e.viewModel.description??""}async _openRelatedFeature(e){await e.viewModel.updateGeometry();const r=e.graphic,i=r==null?void 0:r.geometry;if(R(i)||R(r))return;this._destroyFlowItemWidgets(),await this.viewModel.zoomTo({target:i});const n=XPe(i);this.open({features:[r],location:v(n)?n:void 0})}_destroyFlowItemWidgets(){this._flowItems.removeAll().forEach(e=>{"showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e.viewModel=null,e.destroy()})}_handleBackClick(){const e=this._flowItems.pop();e&&(this._exitRelatedRecordsActions.delete(e),this._featureSelectionActions.delete(e),"showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e&&(e.viewModel=null,e.destroy()))}_getActionTitle(e){const{messages:r,selectedFeature:i,messagesCommon:n}=this,{id:s}=e,o=i==null?void 0:i.attributes,a=e.title??"",l=s==="zoom-to-feature"?bg(a,{messages:r}):s==="remove-selected-feature"?bg(a,{messages:n}):s==="zoom-to-clustered-features"||s==="browse-clustered-features"?bg(a,{messages:r}):e.title;return l&&o?bg(l,o):l??""}_getActionClass(e){const{selectedFeature:r}=this,i=r==null?void 0:r.attributes,{className:n,image:s}=e,o=s||n?n:Ae.iconDefaultAction;return o&&i?bg(o,i):o??""}_getActionImage(e){const{selectedFeature:r}=this,i=r==null?void 0:r.attributes,{image:n}=e;return n&&i?bg(n,i):n??""}_createFeatureUpdatedAnimation(){return IJe("enter",Ae.hasFeatureUpdated)}_getInlineActionCount(){const{maxInlineActions:e,featureNavigationVisible:r}=this;if(typeof e!="number")return null;const i=Math.round(e);return Math.max(r?i-1:i,0)}_watchActions(){const{allActions:e}=this.viewModel;this.notifyChange("dividedActions");const r="actions";this._handles.remove(r),e&&e.forEach(i=>{this._handles.add(ne(()=>[i.uid,i.active,i.className,i.disabled,i.id,i.title,i.image,i.visible],()=>this.scheduleRender()),r)})}_divideActions(){const{allActions:e}=this.viewModel,r=e.filter(o=>o.visible),i=this._getInlineActionCount(),n=i===null,s=i===0;return{inlineActions:n?r.slice(0):s?new ct:r.slice(0,i),menuActions:n?new ct:s?r.slice(0):r.slice(i)}}_featureMenuOpenChanged(e){e?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0}_actionsMenuOpenChanged(e){e?this._focusFirstAction=!0:this._focusActionsMenuButton=!0}_setTitleFromFeatureWidget(){var i,n;const{selectedFeatureWidget:e,messagesCommon:r}=this;e&&(this.viewModel.title=((i=e.viewModel)==null?void 0:i.state)==="error"?r.errorMessage:((n=e.viewModel)==null?void 0:n.title)||"")}_setContentFromFeatureWidget(){const{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}_handleFeatureMenuKeyup(e){G1(e)==="Escape"&&(e.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())}_handleActionMenuKeyup(e){G1(e)==="Escape"&&(e.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())}_setActiveFeature(e){const{viewModel:r}=this,i=e.currentTarget["data-feature-index"];r.activeFeature=r.features[i]||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_handleFeatureMenuItemKeyup(e){const r=G1(e),{_featureMenuNode:i}=this,n=e.currentTarget["data-feature-index"];if(!i)return;const s=i.querySelectorAll("li"),o=s.length;r!=="ArrowUp"?r!=="ArrowDown"?r!=="Home"?r!=="End"||(e.stopPropagation(),s[s.length-1].focus()):(e.stopPropagation(),s[0].focus()):(e.stopPropagation(),s[(n+1+o)%o].focus()):(e.stopPropagation(),s[(n-1+o)%o].focus())}_handleActionMenuItemKeyup(e){const r=G1(e),{_actionsMenuNode:i}=this,n=e.currentTarget.dataset.actionUid,{menuActions:s}=this.dividedActions,o=s.findIndex(c=>c.uid===n);if(!i)return;const a=i.querySelectorAll("li"),l=a.length;r!=="ArrowUp"?r!=="ArrowDown"?r!=="Home"?r!=="End"||(e.stopPropagation(),a[a.length-1].focus()):(e.stopPropagation(),a[0].focus()):(e.stopPropagation(),a[(o+1+l)%l].focus()):(e.stopPropagation(),a[(o-1+l)%l].focus())}_handleMainKeyup(e){const r=G1(e);r==="ArrowLeft"&&(e.stopPropagation(),this.previous()),r==="ArrowRight"&&(e.stopPropagation(),this.next())}_spinnerEnabledChange(e){if(this._destroySpinner(),!e)return;const r=this.get("viewModel.view");this._createSpinner(r)}_hideSpinner(){const{_spinner:e}=this;e&&(e.location=null,e.hide())}_displaySpinner(){const{_spinner:e}=this;if(!e)return;const{location:r,waitingForResult:i}=this.viewModel;i&&r?e.show({location:r}):e.hide()}_getIconStyles(e){return{"background-image":e?`url(${e})`:""}}async _shouldFocus(e){e!=null&&e.shouldFocus&&(await tw(()=>{var r;return((r=this.viewModel)==null?void 0:r.active)===!0}),this.focus())}_addSelectedFeatureIndexHandle(){const e=ne(()=>{var r;return(r=this.viewModel)==null?void 0:r.selectedFeatureIndex},(r,i)=>this._selectedFeatureIndexUpdated(r,i));this._handles.add(e,Ome)}_selectedFeatureIndexUpdated(e,r){const{featureCount:i}=this;i&&e!==r&&e!==-1&&(this._destroyFlowItemWidgets(),this.actionsMenuOpen=!1,this.featureMenuOpen=!1,this._mainContainerNode&&(this._mainContainerNode.scrollTop=0),this._rootFlowItemNode&&this._rootFlowItemNode.scrollContentTo({top:0}))}_destroySelectedFeatureWidget(){const{_feature:e}=this;e&&(e.viewModel=null,e&&!e.destroyed&&e.destroy()),this._feature=null}_isScreenLocationWithinView(e,r){return e.x>-1&&e.y>-1&&e.x<=r.width&&e.y<=r.height}_isOutsideView(e){const{popupHeight:r,popupWidth:i,screenLocation:n,side:s,view:o}=e;if(isNaN(i)||isNaN(r)||!o||!n)return!1;const a=o.padding;return s==="right"&&n.x+i/2>o.width-a.right||s==="left"&&n.x-i/2<a.left||s==="top"&&n.y-r<a.top||s==="bottom"&&n.y+r>o.height-a.bottom}_calculateAutoAlignment(e){if(e!=="auto")return e;const{_pointerOffsetInPx:r,_containerNode:i,_mainContainerNode:n,viewModel:s}=this,{screenLocation:o,view:a}=s;if(R(o)||!a||!i)return"top-center";if(!this._isScreenLocationWithinView(o,a))return this._get("currentAlignment")||"top-center";function l(E){return parseInt(E.replace(/[^-\d\.]/g,""),10)}const c=n?window.getComputedStyle(n,null):null,h=c?l(c.getPropertyValue("max-height")):0,p=c?l(c.getPropertyValue("height")):0,{height:f,width:m}=i.getBoundingClientRect(),g=m+r,_=Math.max(f,h,p)+r,b=this._isOutsideView({popupHeight:_,popupWidth:g,screenLocation:o,side:"right",view:a}),w=this._isOutsideView({popupHeight:_,popupWidth:g,screenLocation:o,side:"left",view:a}),x=this._isOutsideView({popupHeight:_,popupWidth:g,screenLocation:o,side:"top",view:a}),T=this._isOutsideView({popupHeight:_,popupWidth:g,screenLocation:o,side:"bottom",view:a});return w?x?"bottom-right":"top-right":b?x?"bottom-left":"top-left":x?T?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(e){return typeof e=="function"?e.call(this):e}_getCurrentAlignment(){const{alignment:e,dockEnabled:r}=this;return r||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(e){const r=["left","right"];return Ng(this.container)&&r.reverse(),e.replace(/leading/gi,r[0]).replace(/trailing/gi,r[1])}_callDockPosition(e){return typeof e=="function"?e.call(this):e}_getDockPosition(){var e;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition((e=this.dockOptions)==null?void 0:e.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_wouldDockTo(){return this.dockEnabled?null:this._getDockPosition()}_calculateAutoDockPosition(e){var a;if(e!=="auto")return e;const r=(a=this.viewModel)==null?void 0:a.view,i=Ng(this.container)?"top-left":"top-right";if(!r)return i;const n=r.padding||{left:0,right:0,top:0,bottom:0},s=r.width-n.left-n.right,{breakpoints:o}=r;return o&&s<=o.xsmall?"bottom-center":i}_positionContainer(e=this._containerNode){if(e&&(this._containerNode=e),!this._containerNode)return;const{screenLocation:r}=this.viewModel,{width:i}=this._containerNode.getBoundingClientRect(),n=this._calculatePositionStyle(r,i);n&&Object.assign(this._containerNode.style,n)}_calculateFullWidth(e){const{currentAlignment:r,_pointerOffsetInPx:i}=this;return r==="top-left"||r==="bottom-left"||r==="top-right"||r==="bottom-right"?e+i:e}_calculateAlignmentPosition(e,r,i,n){const{currentAlignment:s,_pointerOffsetInPx:o}=this;if(!i)return;const{padding:a}=i,l=n/2,c=i.height-r,h=i.width-e;return s==="bottom-center"?{top:r+o-a.top,left:e-l-a.left}:s==="top-left"?{bottom:c+o-a.bottom,right:h+o-a.right}:s==="bottom-left"?{top:r+o-a.top,right:h+o-a.right}:s==="top-right"?{bottom:c+o-a.bottom,left:e+o-a.left}:s==="bottom-right"?{top:r+o-a.top,left:e+o-a.left}:s==="top-center"?{bottom:c+o-a.bottom,left:e-l-a.left}:void 0}_calculatePositionStyle(e,r){const{dockEnabled:i,view:n}=this;if(!n)return;if(i)return{left:"",top:"",right:"",bottom:""};if(R(e)||!r)return;const s=this._calculateFullWidth(r),o=this._calculateAlignmentPosition(e.x,e.y,n,s);return o?{top:o.top!==void 0?`${o.top}px`:"auto",left:o.left!==void 0?`${o.left}px`:"auto",bottom:o.bottom!==void 0?`${o.bottom}px`:"auto",right:o.right!==void 0?`${o.right}px`:"auto"}:void 0}_viewChange(e,r){e&&r&&(this.close(),this.clear())}_viewReadyChange(e,r){if(e){const i=this.get("viewModel.view");this._wireUpView(i)}else r&&(this.close(),this.clear())}_wireUpView(e){if(this._destroySpinner(),!e)return;const{spinnerEnabled:r}=this;r&&this._createSpinner(e),this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(e,r,i){const[n,s]=e,[o,a]=r,{width:l=0,height:c=0}=i??{};return n<=l&&o>l||n>l&&o<=l||s<=c&&a>c||s>c&&a<=c}_updateDockEnabledForViewSize(e,r){if(!e||!r)return;const i=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},n=i.left+i.right,s=i.top+i.bottom,o=[],a=[];o[0]=e[0]-n,o[1]=e[1]-s,a[0]=r[0]-n,a[1]=r[1]-s;const{dockOptions:l}=this,c=l.breakpoint;this._dockingThresholdCrossed(o,a,c)&&this._setDockEnabledForViewSize(l),this._setCurrentDockPosition()}_focusDockButtonNode(e){this._focusDockButton&&(this._focusDockButton=!1,e.focus())}_closeButtonNodeUpdated(e){return this._focusClose?(this._focusClose=!1,void e.focus()):this._blurClose?(this._blurClose=!1,void e.blur()):void 0}_mainContainerNodeUpdated(e){return this._mainContainerNode=e,this._focusContainer?(this._focusContainer=!1,void e.focus()):this._blurContainer?(this._blurContainer=!1,void e.blur()):void 0}_featureMenuNodeUpdated(e){if(this._featureMenuNode=e,!e||!this._focusFirstFeature)return;this._focusFirstFeature=!1;const r=e.querySelectorAll("li");r.length&&r[0].focus()}_actionsMenuNodeUpdated(e){if(this._actionsMenuNode=e,!e||!this._focusFirstAction)return;this._focusFirstAction=!1;const r=e.querySelectorAll("li");r.length&&r[0].focus()}_focusFeatureMenuButtonNode(e){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,e.focus())}_focusActionsMenuButtonNode(e){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,e.focus())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=0)}_toggleScreenLocationEnabled(){const{dockEnabled:e,viewModel:r}=this;if(!r)return;const i=r.active&&!e;r.screenLocationEnabled=i}_shouldDockAtCurrentViewSize(e){var l,c;const r=e.breakpoint,i=(c=(l=this.viewModel)==null?void 0:l.view)==null?void 0:c.ui;if(!i)return!1;const{width:n,height:s}=i;if(isNaN(n)||isNaN(s)||!r)return!1;const o=r.hasOwnProperty("width")&&n<=(r.width??0),a=r.hasOwnProperty("height")&&s<=(r.height??0);return o||a}_setDockEnabledForViewSize(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}_getPageText(e,r){return this.featureNavigationVisible?bg(this.messages.pageText,{index:r+1,total:e}):null}_destroySpinner(){const{_spinner:e,view:r}=this;e&&(r&&r.ui&&r.ui.remove(e,Mme),e.destroy(),this._spinner=null)}_createSpinner(e){e&&(this._spinner=new sut({view:e}),e.ui.add(this._spinner,{key:Mme,position:"manual"}))}_toggleCollapsed(){this.collapsed=!this.collapsed}_close(){this.close(),this.view&&this.view.focus()}_toggleDockEnabled(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()}_toggleFeatureMenu(){const e=!this.featureMenuOpen;this._featureMenuOpenChanged(e),this.actionsMenuOpen=!1,this.featureMenuOpen=e}_toggleActionsMenu(){const e=!this.actionsMenuOpen;this._actionsMenuOpenChanged(e),this.featureMenuOpen=!1,this.actionsMenuOpen=e}_triggerAction(e){const r=e.currentTarget.dataset.actionUid,{allActions:i}=this.viewModel,n=i.findIndex(o=>o.uid===r),s=i.getItemAt(n);s&&s.type==="toggle"&&(s.value=!s.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(n)}_selectFeature(e){const r=e.currentTarget["data-feature-index"];isNaN(r)||(this.viewModel.selectedFeatureIndex=r),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()}_next(){this.next()}_previous(){this.previous()}};u([d({readOnly:!0})],Ut.prototype,"actionsMenuId",null),u([d({readOnly:!0})],Ut.prototype,"actionsMenuButtonId",null),u([d({readOnly:!0})],Ut.prototype,"featureMenuId",null),u([d({readOnly:!0})],Ut.prototype,"titleId",null),u([d({readOnly:!0})],Ut.prototype,"contentId",null),u([d({readOnly:!0})],Ut.prototype,"hasContent",null),u([d({readOnly:!0})],Ut.prototype,"featureNavigationVisible",null),u([d({readOnly:!0})],Ut.prototype,"collapsible",null),u([d({readOnly:!0})],Ut.prototype,"featureMenuVisible",null),u([d({readOnly:!0})],Ut.prototype,"contentCollapsed",null),u([d({readOnly:!0})],Ut.prototype,"dividedActions",null),u([d({readOnly:!0,dependsOn:["_flowItems.length"]})],Ut.prototype,"_activeFlowItemWidget",null),u([d()],Ut.prototype,"actions",null),u([d()],Ut.prototype,"actionsMenuOpen",null),u([d()],Ut.prototype,"alignment",void 0),u([d()],Ut.prototype,"autoCloseEnabled",null),u([d()],Ut.prototype,"autoOpenEnabled",null),u([d()],Ut.prototype,"defaultPopupTemplateEnabled",null),u([d()],Ut.prototype,"content",null),u([d()],Ut.prototype,"collapsed",void 0),u([d()],Ut.prototype,"collapseEnabled",void 0),u([d({readOnly:!0})],Ut.prototype,"currentAlignment",null),u([d({readOnly:!0})],Ut.prototype,"currentDockPosition",null),u([d()],Ut.prototype,"dockOptions",null),u([d()],Ut.prototype,"dockEnabled",void 0),u([d({readOnly:!0})],Ut.prototype,"featureCount",null),u([d()],Ut.prototype,"featureMenuOpen",void 0),u([d()],Ut.prototype,"features",null),u([d()],Ut.prototype,"goToOverride",null),u([d()],Ut.prototype,"headingLevel",void 0),u([d()],Ut.prototype,"highlightEnabled",null),u([d()],Ut.prototype,"location",null),u([d()],Ut.prototype,"label",null),u([d()],Ut.prototype,"maxInlineActions",void 0),u([d(),_a("esri/widgets/Popup/t9n/Popup")],Ut.prototype,"messages",void 0),u([d(),_a("esri/t9n/common")],Ut.prototype,"messagesCommon",void 0),u([d()],Ut.prototype,"promises",null),u([d({readOnly:!0})],Ut.prototype,"selectedFeature",null),u([d()],Ut.prototype,"selectedFeatureIndex",null),u([d({readOnly:!0})],Ut.prototype,"selectedFeatureWidget",null),u([d()],Ut.prototype,"spinnerEnabled",void 0),u([d()],Ut.prototype,"title",null),u([d()],Ut.prototype,"updateLocationEnabled",null),u([d()],Ut.prototype,"view",null),u([d({type:lIe}),Cet(["triggerAction","trigger-action"])],Ut.prototype,"viewModel",void 0),u([d()],Ut.prototype,"visible",null),u([d()],Ut.prototype,"visibleElements",void 0),u([cr("visibleElements")],Ut.prototype,"castVisibleElements",null),u([Ph()],Ut.prototype,"_close",null),u([Ph()],Ut.prototype,"_toggleDockEnabled",null),u([Ph()],Ut.prototype,"_toggleFeatureMenu",null),u([Ph()],Ut.prototype,"_toggleActionsMenu",null),u([Ph()],Ut.prototype,"_triggerAction",null),u([Ph()],Ut.prototype,"_selectFeature",null),u([Ph()],Ut.prototype,"_next",null),u([Ph()],Ut.prototype,"_previous",null),Ut=u([$("esri.widgets.Popup")],Ut);const Lme=Ut,YG=[0,0];function Yut(t){const e=(t.ownerDocument||window.document).defaultView,r=t.getBoundingClientRect();return YG[0]=r.left+((e==null?void 0:e.pageXOffset)??0),YG[1]=r.top+((e==null?void 0:e.pageYOffset)??0),YG}function Dme(t){t&&(tRe(t),t.parentNode&&t.parentNode.removeChild(t))}function Zut(t){const e=document.createElement("div");return t.appendChild(e),e}const xM=16,y4=750,Jut=512,Kut=2,cIe=t=>{let e=class extends t{constructor(...r){var i;super(...r),this._freqInfo={freq:xM,time:y4},this._overlayRenderTaskHandle=null,this.height=0,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,r.length!==0&&((i=r[0])==null?void 0:i.popup)!==void 0||(this.popup=new Lme({view:this})),this.handles.add([ne(()=>this.cursor,n=>{const{surface:s}=this;s&&s.setAttribute("data-cursor",n)}),ne(()=>this.interacting,n=>{const{surface:s}=this;s&&s.setAttribute("data-interacting",n.toString())})])}initialize(){this.handles.add(ne(()=>this.ui,(r,i)=>this._handleUIChange(r,i))),this._wireUI(this.ui),this.handles.add([this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui=ze(this.ui),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null)}get container(){return this._get("container")??null}set container(r){const i=this._get("container"),n=nB(r);if(n||typeof r!="string"||re.getLogger(this.declaredClass).error("#container",`element with id '${r}' not found`),i===n)return;const s="dom-size";if(this.handles.remove(s),this._stopMeasuring(),i&&(i.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(Dme(this.root),this._set("root",null)),this.userContent&&(Pde(this.userContent,i),Dme(this.userContent),this._set("userContent",null))),!n)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);n.classList.add("esri-view");const o=document.createElement("div");o.className="esri-view-user-storage",Pde(n,o),n.appendChild(o),this._set("userContent",o);const a=document.createElement("div");a.className="esri-view-root",n.insertBefore(a,n.firstChild),this._set("root",a);const l=document.createElement("div");l.className="esri-view-surface",l.setAttribute("role","application"),l.tabIndex=0,a.appendChild(l),this._set("surface",l);const c=new Vde;a.appendChild(c.surface),this._set("overlay",c),ne(()=>c.needsRender,h=>{h&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=v_({render:()=>{var p;return(p=this.overlay)==null?void 0:p.render()}}):this._overlayRenderTaskHandle=$i(this._overlayRenderTaskHandle)}),this.forceDOMReadyCycle(),this.handles.add(ne(()=>this.size,h=>{const[p,f]=h,m="esri-view-surface--inset-outline";p>=document.body.clientWidth||f>=document.body.clientHeight?l.classList.add(m):l.classList.remove(m)},Vt),s),this._set("container",n),this._startMeasuring()}get focused(){const r=document.activeElement===this.surface;return document.hasFocus()&&r}set popup(r){const i=this._get("popup");i&&i!==r&&i.destroy(),this._set("popup",r)}get size(){return[this.width,this.height]}blur(){this.surface&&this.surface.blur()}focus(){this.surface&&this.surface.focus()}pageToContainer(r,i,n){const s=this.position;return r-=s?s[0]:0,i-=s?s[1]:0,n?(n[0]=r,n[1]=i):n=[r,i],n}containerToPage(r,i,n){const s=this.position;return r+=s?s[0]:0,i+=s?s[1]:0,n?(n[0]=r,n[1]=i):n=[r,i],n}_handleUIChange(r,i){i&&(this.handles.remove("ui"),i.destroy()),r&&this._wireUI(r),this._set("ui",r)}_wireUI(r){this.handles.remove("ui"),r&&(r.view=this,this.handles.add([ne(()=>this.root,i=>{r.container=i?Zut(i):null},Vt),ne(()=>this.popup,(i,n)=>{const s="popup",o="manual";n&&r.remove(n,s),i&&(i.view=r.view,r.add(i,{key:s,position:o}))},Vt)],"ui"))}_stopMeasuring(){this.handles.remove("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const r=this._freqInfo;r.freq=xM,r.time=y4,this.handles.add([(()=>{const i=()=>{r.freq=xM,r.time=y4};return window.addEventListener("resize",i),{remove(){window.removeEventListener("resize",i)}}})(),v_({prepare:i=>{const n=this._measure(),s=this._freqInfo;if(s.time+=i.deltaTime,n&&(s.freq=xM,this._get("resizing")||this._set("resizing",!0)),s.time<s.freq)return;s.time=0;const o=this._position();s.freq=o||n?xM:Math.min(y4,s.freq*Kut),!n&&s.freq>=Jut&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const r=this.container,i=r?r.clientWidth:0,n=r?r.clientHeight:0;if(i===0||n===0)return this.suspended||this._set("suspended",!0),!1;const s=this.width,o=this.height;return i===s&&n===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",i),this._set("height",n),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:s,oldHeight:o,width:i,height:n}),!0)}_position(){const r=this.container,i=this.position,n=r&&Yut(r);return!!n&&(!i||n[0]!==i[0]||n[1]!==i[1])&&(this._set("position",[n[0],n[1]]),!0)}forceDOMReadyCycle(){}};return u([d()],e.prototype,"container",null),u([d({readOnly:!0})],e.prototype,"focused",null),u([d({readOnly:!0})],e.prototype,"height",void 0),u([d({type:Lme})],e.prototype,"popup",null),u([d({type:Vde})],e.prototype,"overlay",void 0),u([d({readOnly:!0})],e.prototype,"position",void 0),u([d({readOnly:!0})],e.prototype,"resizing",void 0),u([d({readOnly:!0})],e.prototype,"root",void 0),u([d({value:null,readOnly:!0})],e.prototype,"size",null),u([d({readOnly:!0})],e.prototype,"surface",void 0),u([d({readOnly:!0})],e.prototype,"suspended",void 0),u([d()],e.prototype,"ui",void 0),u([d({readOnly:!0})],e.prototype,"userContent",void 0),u([d({readOnly:!0})],e.prototype,"width",void 0),u([d()],e.prototype,"widthBreakpoint",void 0),e=u([$("esri.views.DOMContainer")],e),e},uIe=t=>{let e=class extends t{async fetchPopupFeatures(r,i){await this.when();const{location:n,queryArea:s,layerViewsAndGraphics:o,clientOnlyGraphics:a}=await this._prepareFetchPopupFeatures(r,i),l=Promise.resolve(a),c=this._queryLayerPopupFeatures(s,o,i),h=c.map(p=>p.promise);return{location:n,clientOnlyGraphics:a,allGraphicsPromise:cY([l,...h]).then(p=>Array.from(new Set(p.flat()))),promisesPerLayerView:c}}_queryLayerPopupFeatures(r,i,n){return i.map(({layerView:s,graphics:o})=>{const a={clientGraphics:o,event:v(n)?n.event:void 0,signal:v(n)?n.signal:void 0,defaultPopupTemplateEnabled:!!v(n)&&!!n.defaultPopupTemplateEnabled},l=s.fetchPopupFeatures(r,a);return{layerView:s,promise:l}})}_isValidPopupGraphic(r,i){return r&&!!r.getEffectivePopupTemplate(v(i)&&i.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(r,i){const{clientGraphics:n,queryArea:s,location:o}=await this._popupHitTestGraphics(r,i),a=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:l,clientOnlyGraphics:c}=this._graphicsPerFetchPopupLayerView(n,a);return{clientOnlyGraphics:c,layerViewsAndGraphics:l,queryArea:s,location:o}}async _popupHitTestGraphics(r,i){const n=await this.popupHitTest(r),s=n.results,o=n.mapPoint,a=s.filter(c=>c.type==="graphic"&&this._isValidPopupGraphic(c.graphic,i)),l=a.length?a[0].mapPoint:null;return{clientGraphics:a.map(c=>c.graphic),queryArea:o,location:o||l}}_getFetchPopupLayerViews(){const r=[];return this.allLayerViews.forEach(i=>{this._isValidPopupLayerView(i)&&r.push(i)}),v(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&r.push(this.graphicsView),r.reverse()}_isValidPopupLayerView(r){return v(r)&&(!("layer"in r)||!r.suspended)&&"fetchPopupFeatures"in r}_graphicsPerFetchPopupLayerView(r,i){const n=[],s=new Map,o=i.map(a=>{const l=[];return"layer"in a?s.set(a.layer,l):s.set(a.graphics,l),{layerView:a,graphics:l}});for(const a of r){const l=s.get(a.layer)||s.get(a.sourceLayer)||null;l?l.push(a):n.push(a)}return{layerViewsAndGraphics:o,clientOnlyGraphics:n}}};return e=u([$("esri.views.PopupView")],e),e};async function Ooe(t,e){return await t.load(),Qut(t,e)}async function Qut(t,e){const r=[],i=(...s)=>{for(const o of s)R(o)||(Array.isArray(o)?i(...o):ct.isCollection(o)?o.forEach(a=>i(a)):qu.isLoadable(o)&&r.push(o))};e(i);let n=null;if(await ket(r,async s=>{const o=await hm(eht(s)?s.loadAll():s.load());o.ok!==!1||n||(n=o)}),n)throw n.error;return t}function eht(t){return"loadAll"in t&&typeof t.loadAll=="function"}async function tht(t){if(!t)return;const e=t.includes("-vector")?t.slice(0,t.indexOf("-vector")):t,r=await yAe("esri/t9n/basemaps");return r[t]||r[e]}const nQ={streets:{id:"streets",classic:!0,deprecated:!0,get thumbnailUrl(){return si("esri/images/basemap/streets.jpg")},baseMapLayers:[{id:"streets-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Street Map",showLegend:!1,visibility:!0,opacity:1}]},satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return si("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return si("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return si("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},topo:{id:"topo",classic:!0,deprecated:!0,get thumbnailUrl(){return si("esri/images/basemap/topo.jpg")},baseMapLayers:[{id:"topo-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Topo Map",showLegend:!1,visibility:!0,opacity:1}]},gray:{id:"gray",classic:!0,deprecated:!0,get thumbnailUrl(){return si("esri/images/basemap/gray.jpg")},baseMapLayers:[{id:"gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"dark-gray":{id:"dark-gray",classic:!0,deprecated:!0,get thumbnailUrl(){return si("esri/images/basemap/dark-gray.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"dark-gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return si("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"national-geographic":{id:"national-geographic",classic:!0,deprecated:!0,get thumbnailUrl(){return si("esri/images/basemap/national-geographic.jpg")},baseMapLayers:[{id:"national-geographic-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer",title:"NatGeo World Map",showLegend:!1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return si("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return si("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return si("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return si("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return si("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return si("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return si("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return si("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"arcgis-imagery":{get thumbnailUrl(){return si("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return si("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return si("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return si("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return si("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return si("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return si("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return si("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return si("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return si("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}},rht=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),iht=new Set(["csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","map-image","map-notes","media","ogc-feature","route","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function nht(t){return t.layerContainerType==="basemap"?rht:t.layerContainerType==="operational-layers"?iht:null}function sht(t,e){if(e.restrictedWebMapWriting){const r=nht(e);return!v(r)||r.has(t.type)&&!uB(t)}return!0}function oht(t,e){if(e)if(uB(t)){const r=nN("featureCollection.layers",e),i=r&&r[0]&&r[0].layerDefinition;i&&ZG(t,i)}else t.type==="stream"?ZG(t,e.layerDefinition=e.layerDefinition||{}):t.type!=="group"&&ZG(t,e)}function ZG(t,e){"maxScale"in t&&(e.maxScale=U8(t.maxScale)??void 0),"minScale"in t&&(e.minScale=U8(t.minScale)??void 0)}function aht(t,e){if(oht(t,e),e&&("blendMode"in t&&(e.blendMode=t.blendMode,e.blendMode==="normal"&&delete e.blendMode),e.opacity=U8(t.opacity)??void 0,e.title=t.title||"Layer",e.visibility=t.visible,"legendEnabled"in t&&t.type!=="wmts"))if(uB(t)){const r=e.featureCollection;r&&(r.showLegend=t.legendEnabled)}else e.showLegend=t.legendEnabled}function sQ(t,e,r){if(!("write"in t)||!t.write)return r&&r.messages&&r.messages.push(new H("layer:unsupported",`Layers (${t.title}, ${t.id}) of type '${t.declaredClass}' cannot be persisted`,{layer:t})),null;if(sht(t,r)){const i={};return t.write(i,r)?i:null}return v(e)&&aht(t,e=se(e)),e}var iU;let lht=0;const hIe="esri.Basemap";let Id=iU=class extends Cw(qu){constructor(t){super(t),this.id=null,this.portalItem=null,this.spatialReference=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+lht++,this.baseLayers=new ct,this.referenceLayers=new ct;const e=i=>{i.parent&&i.parent!==this&&"remove"in i.parent&&i.parent.remove(i),i.parent=this,i.type==="elevation"&&re.getLogger(this.declaredClass).error(`Layer '${i.title}, id:${i.id}' of type '${i.type}' is not supported as a basemap layer and will therefore be ignored.`)},r=i=>{i.parent=null};this.baseLayers.on("after-add",i=>e(i.item)),this.referenceLayers.on("after-add",i=>e(i.item)),this.baseLayers.on("after-remove",i=>r(i.item)),this.referenceLayers.on("after-remove",i=>r(i.item))}initialize(){this.when().catch(t=>{re.getLogger(this.declaredClass).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){var r;const t=this.baseLayers.removeAll();for(const i of t)i.destroy();const e=this.referenceLayers.removeAll();for(const i of e)i.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),(r=this.portalItem)==null||r.destroy(),this.portalItem=null}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set baseLayers(t){this._set("baseLayers",Kb(t,this._get("baseLayers")))}_writeBaseLayers(t,e,r){const i=[];t&&(r={...r,layerContainerType:"basemap"},this.baseLayers.forEach(n=>{const s=sQ(n,r.webmap?r.webmap.getLayerJSONFromResourceInfo(n):null,r);v(s)&&i.push(s)}),this.referenceLayers.forEach(n=>{const s=sQ(n,r.webmap?r.webmap.getLayerJSONFromResourceInfo(n):null,r);v(s)&&(n.type!=="scene"&&(s.isReference=!0),i.push(s))})),e.baseMapLayers=i}set referenceLayers(t){this._set("referenceLayers",Kb(t,this._get("referenceLayers")))}writeTitle(t,e){e.title=t||"Basemap"}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return Ooe(this,t=>{t(this.baseLayers,this.referenceLayers)})}clone(){const t={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.slice(),referenceLayers:this.referenceLayers.slice()};return this.loaded&&(t.loadStatus="loaded"),new iU({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}write(t,e){return t=t||{},e&&e.origin||(e={origin:"web-map",...e}),super.write(t,e),!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(t.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(r=>{const i=se(r);return i.url&&ly(i.url)&&(i.url=`https:${i.url}`),i.templateUrl&&ly(i.templateUrl)&&(i.templateUrl=`https:${i.templateUrl}`),i})),t}async _loadFromSource(t){const{resourceInfo:e,portalItem:r}=this;lr(t);const i=[];if(e){const n=e.context?e.context.url:null;if(i.push(this._loadLayersFromJSON(e.data,n,t)),e.data.id&&!e.data.title){const s=e.data.id;i.push(tht(s).then(o=>{o&&this.read({title:o},e.context)}))}}else r&&i.push(this._loadFromItem(r,t));await Promise.all(i)}async _loadLayersFromJSON(t,e,r){const i=this.resourceInfo&&this.resourceInfo.context,n=this.portalItem&&this.portalItem.portal||i&&i.portal||null,s=i&&i.origin==="web-scene"?"web-scene":"web-map",{populateOperationalLayers:o}=await Q(()=>import("./layersCreator-46a6cc05.js"),["assets/layersCreator-46a6cc05.js","assets/lazyLayerLoader-60b48c6f.js","assets/portalLayers-f443c7e1.js","assets/layersLoader-aabc4951.js","assets/fetchService-65c9e60a.js","assets/jsonContext-b7261aa0.js"]),a=[];if(lr(r),t.baseMapLayers&&Array.isArray(t.baseMapLayers)){const l={context:{origin:s,url:e,portal:n,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},c=f=>s==="web-scene"&&f.layerType==="ArcGISSceneServiceLayer"||f.isReference,h=o(this.baseLayers,t.baseMapLayers.filter(f=>!c(f)),l);a.push(h);const p=o(this.referenceLayers,t.baseMapLayers.filter(c),l);a.push(p)}await ha(a)}async _loadFromItem(t,e){const r=await t.load(e),i=await r.fetchData("json",e),n=Uo(t.itemUrl??"");return this._set("resourceInfo",{data:i.baseMap??{},context:{origin:t.type==="Web Scene"?"web-scene":"web-map",portal:t.portal||pa.getDefault(),url:n}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:i.spatialReference},this.resourceInfo.context),this.read({title:t.title,thumbnailUrl:t.thumbnailUrl},{origin:"portal-item",portal:t.portal||pa.getDefault(),url:n}),this._loadLayersFromJSON(this.resourceInfo.data,n,e)}static fromId(t){const e=nQ[t];if(e){if(e.deprecated){let r=null;t==="dark-gray"?r="dark-gray-vector":t==="gray"?r="gray-vector":t==="streets"?r="streets-vector":t==="topo"&&(r="topo-vector"),i2e(re.getLogger(hIe),`The ${t} basemap has entered mature support and is no longer being updated.`,{replacement:r,see:"https://arcg.is/1iq8aD",warnOnce:!0})}return iU.fromJSON(e)}return null}};u([d({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(t,e,r,i){this._writeBaseLayers(t,e,i)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:ct}},writer(t,e,r,i){this._writeBaseLayers(t,e,i)}}}}}})],Id.prototype,"baseLayers",null),u([d({type:String,json:{origins:{"web-scene":{write:!0}}}})],Id.prototype,"id",void 0),u([d({type:r_})],Id.prototype,"portalItem",void 0),u([d()],Id.prototype,"referenceLayers",null),u([d({readOnly:!0})],Id.prototype,"resourceInfo",void 0),u([d({type:Je})],Id.prototype,"spatialReference",void 0),u([d()],Id.prototype,"thumbnailUrl",void 0),u([d({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],Id.prototype,"title",void 0),u([De("title")],Id.prototype,"writeTitle",null),Id=iU=u([$(hIe)],Id);const Uz=Id,cht=Object.freeze(Object.defineProperty({__proto__:null,default:Uz},Symbol.toStringTag,{value:"Module"}));var oQ;let nU=oQ=class extends fe{constructor(t){super(t),this.type="none"}clone(){return new oQ({type:this.type})}};u([st({none:"none",stayAbove:"stay-above"})],nU.prototype,"type",void 0),nU=oQ=u([$("esri.ground.NavigationConstraint")],nU);let Bn=class extends be{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1,this.TERRAIN_USE_LEGACY_SHADING=!1}};u([d()],Bn.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),u([d()],Bn.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),u([d()],Bn.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),u([d()],Bn.prototype,"DECONFLICTOR_SHOW_GRID",void 0),u([d()],Bn.prototype,"LABELS_SHOW_BORDER",void 0),u([d()],Bn.prototype,"TEXT_SHOW_BASELINE",void 0),u([d()],Bn.prototype,"TEXT_SHOW_BORDER",void 0),u([d()],Bn.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),u([d()],Bn.prototype,"OVERLAY_SHOW_CENTER",void 0),u([d()],Bn.prototype,"SHOW_POI",void 0),u([d()],Bn.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),u([d()],Bn.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),u([d()],Bn.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),u([d()],Bn.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),u([d()],Bn.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),u([d()],Bn.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),u([d()],Bn.prototype,"I3S_TREE_SHOW_TILES",void 0),u([d()],Bn.prototype,"I3S_SHOW_MODIFICATIONS",void 0),u([d()],Bn.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),u([d()],Bn.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),u([d()],Bn.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),u([d()],Bn.prototype,"LINE_WIREFRAMES",void 0),u([d()],Bn.prototype,"TERRAIN_USE_LEGACY_SHADING",void 0),Bn=u([$("esri.views.3d.support.DebugFlags")],Bn);const Qr=new Bn;var aQ;let ig=aQ=class extends Cw(qu){constructor(t){super(t),this.opacity=1,this.shading=!Qr.TERRAIN_USE_LEGACY_SHADING,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new ct;const e=i=>{i.parent&&i.parent!==this&&"remove"in i.parent&&i.parent.remove(i),i.parent=this,i.type!=="elevation"&&i.type!=="base-elevation"&&re.getLogger(this.declaredClass).error(`Layer '${i.title}, id:${i.id}' of type '${i.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},r=i=>{i.parent=null};this.layers.on("after-add",i=>e(i.item)),this.layers.on("after-remove",i=>r(i.item))}initialize(){this.when().catch(t=>{re.getLogger(this.declaredClass).error("#load()","Failed to load ground",t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.layers.removeAll();for(const e of t)e.destroy();this.layers.destroy()}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set layers(t){this._set("layers",Kb(t,this._get("layers")))}writeLayers(t,e,r,i){const n=[];t&&(i={...i,layerContainerType:"ground"},t.forEach(s=>{if("write"in s){const o={};kit(s)().write(o,i)&&n.push(o)}else i&&i.messages&&i.messages.push(new H("layer:unsupported",`Layers (${s.title}, ${s.id}) of type '${s.declaredClass}' cannot be persisted in the ground`,{layer:s}))})),e.layers=n}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return Ooe(this,t=>{t(this.layers)})}async queryElevation(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:r}=await Q(()=>import("./ElevationQuery-ed9dfcd5.js"),[]);lr(e);const i=new r,n=this.layers.filter(Nme).toArray();return i.queryAll(n,t,e)}async createElevationSampler(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:r}=await Q(()=>import("./ElevationQuery-ed9dfcd5.js"),[]);lr(e);const i=new r,n=this.layers.filter(Nme).toArray();return i.createSamplerAll(n,t,e)}clone(){const t={opacity:this.opacity,surfaceColor:se(this.surfaceColor),navigationConstraint:se(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(t.loadStatus="loaded"),new aQ({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}_loadFromSource(t){const e=this.resourceInfo;return e?this._loadLayersFromJSON(e.data,e.context,t):Promise.resolve()}_loadLayersFromJSON(t,e,r){const i=e&&e.origin||"web-scene",n=e&&e.portal||null,s=e&&e.url||null;return Q(()=>import("./layersCreator-46a6cc05.js"),["assets/layersCreator-46a6cc05.js","assets/lazyLayerLoader-60b48c6f.js","assets/portalLayers-f443c7e1.js","assets/layersLoader-aabc4951.js","assets/fetchService-65c9e60a.js","assets/jsonContext-b7261aa0.js"]).then(({populateOperationalLayers:o})=>{lr(r);const a=[];if(t.layers&&Array.isArray(t.layers)){const l={context:{origin:i,url:s,portal:n,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,t.layers,l))}return ha(a)}).then(()=>{})}};function uht(t){return t&&"createElevationSampler"in t}function Nme(t){return t.type==="elevation"||uht(t)}u([d({json:{read:!1}})],ig.prototype,"layers",null),u([De("layers")],ig.prototype,"writeLayers",null),u([d({readOnly:!0})],ig.prototype,"resourceInfo",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:Xi,read:{reader:GL,source:"transparency"},write:{writer:(t,e)=>{e.transparency=k9(t)},target:"transparency"}}})],ig.prototype,"opacity",void 0),u([d({type:Boolean,nonNullable:!0,json:{read:!1}})],ig.prototype,"shading",void 0),u([d({type:Xe,json:{type:[Xi],write:(t,e)=>{e.surfaceColor=t.toJSON().slice(0,3)}}})],ig.prototype,"surfaceColor",void 0),u([d({type:nU,json:{write:!0}})],ig.prototype,"navigationConstraint",void 0),ig=aQ=u([$("esri.Ground")],ig);const zz=ig;function hht(t){var e,r;return!(!(t!=null&&t.loaded)||!((r=(e=yOe(t))==null?void 0:e.operations)!=null&&r.supportsEditing)||"editingEnabled"in t&&!NQe(t))}const Fme=re.getLogger("esri.support.basemapUtils");function dht(){return{}}function pht(t){for(const e in t){const r=t[e];(r==null?void 0:r.destroyed)===!1&&r.destroy(),delete t[e]}}function fht(t,e){let r;if(typeof t=="string"){if(!(t in nQ)){const i=Object.entries(nQ).filter(([n,s])=>ri.apiKey&&!s.classic||!ri.apiKey&&s.classic&&!s.deprecated).map(([n])=>`"${n}"`).join(", ");return Fme.warn(`Unable to find basemap definition for: ${t}. Try one of these: ${i}`),null}e&&(r=e[t]),r||(r=Uz.fromId(t),e&&(e[t]=r))}else r=bs(Uz,t);return r!=null&&r.destroyed&&(Fme.warn("The provided basemap is already destroyed",{basemap:r}),r=null),r}function mht(t){return!!(t!=null&&t.baseLayers.concat(t.referenceLayers).some(dIe))}function dIe(t){var e;if(kme(t.url))return!0;if(t.type==="vector-tile"){for(const r in t.sourceNameToSource)if(kme((e=t.sourceNameToSource[r])==null?void 0:e.sourceUrl))return!0}return!1}function ght(t,e){var s;if(R(e)||R(t))return{spatialReference:null,updating:!1};if(e.loadStatus==="not-loaded")return e.load(),{spatialReference:null,updating:!0};if(e.spatialReference)return{spatialReference:e.spatialReference,updating:!1};if(e.baseLayers.length===0)return{spatialReference:null,updating:!1};const r=e.baseLayers.getItemAt(0);switch(r.loadStatus){case"not-loaded":r.load();case"loading":return{spatialReference:null,updating:!0};case"failed":return{spatialReference:null,updating:!1}}const i=(("supportedSpatialReferences"in r?r.supportedSpatialReferences:null)||["tileInfo"in r?(s=r.tileInfo)==null?void 0:s.spatialReference:r.spatialReference]).filter(Boolean),n=t.spatialReference;return n?{spatialReference:i.find(o=>n.equals(o))??i[0]??null,updating:!1}:{spatialReference:i[0],updating:!1}}const yht=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;function kme(t){if(!t)return!1;const e=new Lb(Fc(t));return!!e.authority&&yht.test(e.authority)}function _ht(t){return new wO({getCollections:()=>[t.tables,t.layers],getChildrenFunction:e=>{const r=[];return"tables"in e&&r.push(e.tables),"layers"in e&&r.push(e.layers),r},itemFilterFunction:e=>{const r=e.parent;return!!r&&"tables"in r&&r.tables.includes(e)}})}const Ume={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function vht(t){let e=null;if(typeof t=="string")if(t in Ume){const r=Ume[t];e=new zz({resourceInfo:{data:{layers:[r]}}})}else re.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${t}. Try "world-elevation"`);else e=bs(zz,t);return e}function lQ(t,e,r){let i,n;if(t)for(let s=0,o=t.length;s<o;s++){if(i=t.getItemAt(s),i[e]===r)return i;if((i==null?void 0:i.type)==="group"&&(n=lQ(i.layers,e,r),n))return n}}const bht=t=>{let e=class extends t{constructor(...r){super(...r),this.layers=new ct;const i=o=>{o.parent&&"remove"in o.parent&&o.parent.remove(o)},n=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||re.getLogger(this.declaredClass).error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},s=o=>{o.parent=null,this.layerRemoved(o)};this.layers.on("before-add",o=>i(o.item)),this.layers.on("after-add",o=>n(o.item)),this.layers.on("after-remove",o=>s(o.item))}destroy(){const r=this.layers.removeAll();for(const i of r)this.layerRemoved(i),i.destroy();this.layers.destroy()}set layers(r){this._set("layers",Kb(r,this._get("layers")))}add(r,i){const n=this.layers;if(i=n.getNextIndex(i),r instanceof nD){const s=r;s.parent===this?this.reorder(s,i):n.add(s,i)}else Ju(r)?r.then(s=>{this.destroyed||this.add(s,i)}):re.getLogger(this.declaredClass).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(r,i){const n=this.layers;let s=n.getNextIndex(i);r.slice().forEach(o=>{o.parent!==this?(n.add(o,s),s+=1):this.reorder(o,s)})}findLayerById(r){return lQ(this.layers,"id",r)}findLayerByUid(r){return lQ(this.layers,"uid",r)}remove(r){return this.layers.remove(r)}removeMany(r){return this.layers.removeMany(r)}removeAll(){return this.layers.removeAll()}reorder(r,i){return this.layers.reorder(r,i)}layerAdded(r){}layerRemoved(r){}};return u([d()],e.prototype,"layers",null),e=u([$("esri.support.LayersMixin")],e),e};function cQ(t,e,r){if(t)for(let i=0,n=t.length;i<n;i++){const s=t.getItemAt(i);if(s[e]===r)return s;if((s==null?void 0:s.type)==="group"){const o=cQ(s.tables,e,r);if(o)return o}}}const wht=t=>{let e=class extends t{constructor(...r){super(...r),this.tables=new ct,this.tables.on("after-add",i=>{const n=i.item;n.parent&&n.parent!==this&&"tables"in n.parent&&n.parent.tables.remove(n),n.parent=this,n.type!=="feature"&&re.getLogger(this.declaredClass).error(`Layer 'title:${n.title}, id:${n.id}' of type '${n.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",i=>{i.item.parent=null})}destroy(){const r=this.tables.removeAll();for(const i of r)i.destroy();this.tables.destroy()}set tables(r){this._set("tables",Kb(r,this._get("tables")))}findTableById(r){return cQ(this.tables,"id",r)}findTableByUid(r){return cQ(this.tables,"uid",r)}};return u([d()],e.prototype,"tables",null),e=u([$("esri.support.TablesMixin")],e),e};let ng=class extends wht(bht(Sn.EventedMixin(be))){constructor(e){super(e),this.allLayers=new wO({getCollections:()=>{var r,i,n;return[(r=this.basemap)==null?void 0:r.baseLayers,(i=this.ground)==null?void 0:i.layers,this.layers,(n=this.basemap)==null?void 0:n.referenceLayers]},getChildrenFunction:r=>"layers"in r?r.layers:null}),this.allTables=_ht(this),this.basemap=null,this.editableLayers=new wO({getCollections:()=>[this.allLayers],itemFilterFunction:hht}),this.ground=new zz,this._basemapCache=dht()}destroy(){var e,r;this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),(e=this.ground)==null||e.destroy(),(r=this.basemap)==null||r.destroy(),pht(this._basemapCache),this._basemapCache=null}castBasemap(e){return fht(e,this._basemapCache)}castGround(e){const r=vht(e);return R(r)?this._get("ground"):r}findLayerById(e){return this.allLayers.find(r=>r.id===e)}findTableById(e){return this.allTables.find(r=>r.id===e)}};u([d({readOnly:!0,dependsOn:[]})],ng.prototype,"allLayers",void 0),u([d({readOnly:!0})],ng.prototype,"allTables",void 0),u([d({type:Uz})],ng.prototype,"basemap",void 0),u([cr("basemap")],ng.prototype,"castBasemap",null),u([d({readOnly:!0})],ng.prototype,"editableLayers",void 0),u([d({type:zz,nonNullable:!0})],ng.prototype,"ground",void 0),u([cr("ground")],ng.prototype,"castGround",null),ng=u([$("esri.Map")],ng);const PB=ng;let k$=class extends Iw(ct){constructor(e){super(e),this.handles.add([this.on("before-add",r=>{R(r.item)&&r.preventDefault()}),this.on("after-add",r=>this._own(r.item)),this.on("after-remove",r=>this._release(r.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(ct.ofType(this.itemType.Type))(e):new ct(e)}};function uQ(t,e){return{type:t,cast:UCe,set(r){const i=Kb(r,this._get(e),t);i.owner=this,this._set(e,i)}}}u([d()],k$.prototype,"owner",null),k$=u([$("esri.core.support.OwningCollection")],k$);let DO=class extends k${constructor(e){super(e),this.handles.add(this.on("before-add",r=>{R(r.item)||r.item.parent===this.owner&&(re.getLogger(this.declaredClass).warn("Analysis inside the collection must be unique. Not adding this element again."),r.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};DO=u([$("esri.support.AnalysesCollection")],DO);let U$=class extends k${_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};u([ane({Type:Va,ensureType:bs(Va)})],U$.prototype,"itemType",void 0),U$=u([$("esri.support.GraphicsCollection")],U$);let h1=class extends be{constructor(e){super(e),this.view=null,this.baseLayerViews=new ct,this.referenceLayerViews=new ct,this._loadingHandle=ne(()=>{var r,i;return(i=(r=this.view)==null?void 0:r.map)==null?void 0:i.basemap},r=>{r&&r.load().catch(()=>{})},Vt)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null)}get suspended(){return!this.view||this.view.suspended}get updating(){var r,i;if(this.view&&this.view.suspended)return!1;const e=(i=(r=this.view)==null?void 0:r.map)==null?void 0:i.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(n=>n.updating)||this.referenceLayerViews.some(n=>n.updating))}};u([d({constructOnly:!0})],h1.prototype,"view",void 0),u([d({readOnly:!0})],h1.prototype,"baseLayerViews",void 0),u([d({readOnly:!0})],h1.prototype,"referenceLayerViews",void 0),u([d({readOnly:!0})],h1.prototype,"suspended",null),u([d({type:Boolean,readOnly:!0})],h1.prototype,"updating",null),h1=u([$("esri.views.BasemapView")],h1);function xht(t){return"tryRecycleWith"in t}let Tht=class{constructor(e,r,i){this.layer=e,this.view=r,this.layerViewImporter=i,this._controller=new AbortController,this._deferred=__(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,Ua(this._controller.signal,()=>{const n=new H("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(n)})}tryRecycle(e){if(!this.done||!this.layerView||!xht(this.layerView))return null;const r=this.layer.type,i=this._controller.signal;for(let n=0;n<e.length;n++){const s=e[n];if(s.type!==r)continue;const o=this.layerView.tryRecycleWith(s,{signal:i});if(o){e.splice(n,1),this.layer=s;const a=this.layerView,l=a.view;return this.promise=Promise.race([o.then(()=>(lr(this._controller.signal),s.emit("layerview-destroy",{view:l,layerView:a}),l.emit("layerview-destroy",{view:l,layerView:a}),s.emit("layerview-create",{view:l,layerView:a}),l.emit("layerview-create",{view:l,layerView:a}),a)),new Promise((c,h)=>Ua(this._controller.signal,()=>h(Vr())))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:e}=this;if(!e)return;const{layer:r,view:i}=this;r.emit("layerview-destroy",{view:i,layerView:e}),i.emit("layerview-destroy",{layer:r,layerView:e}),this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null}async start(){var n,s,o;if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:r,view:i}=this;this._map=i.map;try{let a,l;if(await r.load({signal:e}),"prefetchResources"in r&&await((n=r.prefetchResources)==null?void 0:n.call(r,{signal:e})),Eht(r))a=await r.createLayerView(i,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(r))throw new H("layer:view-not-supported","No layerview implementation was found");const p=await this.layerViewImporter.importLayerView(r);lr(e),a="default"in p?new p.default({layer:r,view:i}):new p({layer:r,view:i})}const c=()=>{l=$i(l),a.destroyed||a.destroy(),a.layer=null,a.parent=null,a.view=null,this.done=!0};l=Ua(e,c),lr(e);try{await a.when()}catch(p){throw c(),p}if(!((o=(s=this._map)==null?void 0:s.allLayers)==null?void 0:o.includes(r)))return c(),void this._deferred.reject(new H("view:no-layerview-for-layer","The layer has been removed from the map",{layer:r}));this.layerView=a,r.emit("layerview-create",{view:i,layerView:a}),i.emit("layerview-create",{layer:r,layerView:a}),this.done=!0,this._deferred.resolve(a)}catch(a){r.emit("layerview-create-error",{view:i,error:a}),i.emit("layerview-create-error",{layer:r,error:a}),this.done=!0,this._deferred.reject(new H("layerview:create-error","layerview creation failed",{layer:r,error:a}))}}},$d=class extends be{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new Hg,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var i;const r=(i=this.view.map)==null?void 0:i.allLayers;if(r)for(const n of r)this.layerViewImporter.hasLayerViewModule(n)&&this.layerViewImporter.importLayerView(n)},this._reschedule=()=>(R(this._workPromise)&&(this._workPromise=__(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(L2(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var l,c,h;const r=this.view.map;if(this._map!==r&&(this.clear(),this._map=r),R(this._workPromise))return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const i=new Set,n=[],s=this.view.ready,o=p=>{if(!R(p)){for(const f of p)if(f){i.add(f);const m=this._layerLayerViewInfoMap.get(f);m&&s?m.start():m||this._recyclingInfoMap.has(f)||n.push(f),"layers"in f&&f.layers&&o(f.layers)}}};for(const p of this._rootCollectionNames)o(this.get(p));for(const[p,f]of this._layerLayerViewInfoMap)if(!i.has(p)){this._layerLayerViewInfoMap.delete(f.layer);const m=f.tryRecycle(n);m?(this._recyclingInfoMap.set(f.layer,f),m.then(()=>{this._recyclingInfoMap.delete(f.layer),this._layerLayerViewInfoMap.set(f.layer,f),this._reschedule()}).catch(()=>{this._recyclingInfoMap.delete(f.layer),f.destroy(),this._reschedule()})):f.destroy()}for(const[p,f]of this._recyclingInfoMap)i.has(p)||(this._recyclingInfoMap.delete(f.layer),f.destroy());for(const p of n)this._createLayerView(p);this._refreshCollections();const a=[(l=r==null?void 0:r.ground)==null?void 0:l.layers,(c=r==null?void 0:r.basemap)==null?void 0:c.baseLayers,(h=r==null?void 0:r.basemap)==null?void 0:h.referenceLayers,r==null?void 0:r.layers].filter(p=>!!p);i.forEach(p=>"layers"in p&&a.push(p.layers)),this.addHandles(a.map(p=>this._watchUpdatingTracking.addOnCollectionChange(()=>p,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.own([Yn(()=>{var e,r;return(r=(e=this.view)==null?void 0:e.map)==null?void 0:r.allLayers},"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),ne(()=>{const e=this.view,r=e==null?void 0:e.map;return[r==null?void 0:r.basemap,r==null?void 0:r.ground,r==null?void 0:r.layers,e==null?void 0:e.ready]},()=>this._reschedule(),Wi)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),this._watchUpdatingTracking.destroy(),this._map=null,v(this._workPromise)&&(this._workPromise.reject(Vr()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return v(this._workPromise)||this._watchUpdatingTracking.updating||ca(this._layerLayerViewInfoMap,e=>!e.done)}get updatingRemaining(){let e=0;for(const r of this._layerLayerViewInfoMap.values())r.done||++e;return e}clear(){if(!this.destroyed){for(const e of this._layerLayerViewInfoMap.values())e.destroy();this._layerLayerViewInfoMap.clear(),this._refreshCollections()}}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new H("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,r]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(e),this.get(r),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,r,i){if(!e||!r)return void(r&&r.removeAll());let n=0;for(const s of e){const o=this._layerLayerViewInfoMap.get(s);if(!o||!o.layerView)continue;const a=o.layerView;a.layer=s,a.parent=i,r.getItemAt(n)!==a&&r.splice(n,0,a),s.layers&&this._populateLayerViewsOwners(s.layers,a.layerViews,a),n+=1}n<r.length&&r.splice(n,r.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const r=new Tht(e,this.view,this.layerViewImporter);r.promise.then(()=>this._refreshCollections(),i=>{i&&(ps(i)||i.name==="cancelled:layerview-create")||re.getLogger(this.declaredClass).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:i}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,r),this.view.ready&&r.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};u([d()],$d.prototype,"_workPromise",void 0),u([d({readOnly:!0})],$d.prototype,"_watchUpdatingTracking",void 0),u([d({readOnly:!0})],$d.prototype,"_layersToLayerViews",null),u([d({readOnly:!0})],$d.prototype,"_rootCollectionNames",null),u([d()],$d.prototype,"layerViewImporter",void 0),u([d()],$d.prototype,"supportsGround",void 0),u([d({readOnly:!0})],$d.prototype,"updating",null),u([d({readOnly:!0})],$d.prototype,"updatingRemaining",null),u([d({constructOnly:!0})],$d.prototype,"view",void 0),$d=u([$("esri.views.LayerViewManager")],$d);const Sht=$d;function Eht(t){return"createLayerView"in t&&t.createLayerView!=null}let _h=class extends be{constructor(e){super(e),this.factor=1.5,this.offset=Gs(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};u([d({type:Number})],_h.prototype,"factor",void 0),u([d({nonNullable:!0})],_h.prototype,"offset",void 0),u([d()],_h.prototype,"position",void 0),u([d({type:Number,range:{min:0}})],_h.prototype,"size",void 0),u([d()],_h.prototype,"maskUrl",void 0),u([d()],_h.prototype,"maskEnabled",void 0),u([d()],_h.prototype,"overlayUrl",void 0),u([d()],_h.prototype,"overlayEnabled",void 0),u([d({readOnly:!0})],_h.prototype,"version",null),u([d({type:Boolean})],_h.prototype,"visible",void 0),_h=u([$("esri.views.Magnifier")],_h);const pIe=_h;let Cht=class{constructor(){this._tasks=new Array,this._running=new kz(!1)}get length(){return this._tasks.length}get running(){return this._running.get()}destroy(){this.cancelAll()}runTask(e){for(;!e.done&&this._process(e);)e.madeProgress()}push(e,r,i){return this._running.set(!0),new Promise((n,s)=>this._tasks.push(new zme(n,s,e,r,i)))}unshift(e,r,i){return this._running.set(!0),new Promise((n,s)=>this._tasks.unshift(new zme(n,s,e,r,i)))}_process(e){var i;if(this._tasks.length===0)return!1;const r=this._tasks.shift();try{const n=uo(r.signal);if(n&&!r.abortCallback)r.reject(Vr());else{const s=n?(i=r.abortCallback)==null?void 0:i.call(r,Vr()):r.callback(e);Ju(s)?s.then(r.resolve,r.reject):r.resolve(s)}}catch(n){r.reject(n)}return this._running.set(this._tasks.length>0),!0}cancelAll(){const e=Vr();for(const r of this._tasks)if(r.abortCallback){const i=r.abortCallback(e);r.resolve(i)}else r.reject(e);this._tasks.length=0,this._running.set(!1)}},zme=class{constructor(e,r,i,n,s){this.resolve=e,this.reject=r,this.callback=i,this.signal=n,this.abortCallback=s}},cI=class extends be{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};u([d()],cI.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),u([d()],cI.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),cI=u([$("esri.views.support.DebugFlags")],cI);const Aht=new cI;var Mr;(function(t){t[t.ANIMATING=0]="ANIMATING",t[t.INTERACTING=1]="INTERACTING",t[t.IDLE=2]="IDLE"})(Mr||(Mr={}));function Rht(){return new Vz.Scheduler}var za,St;(function(t){t[t.YIELD=1]="YIELD"})(za||(za={})),function(t){t.RESOURCE_CONTROLLER_IMMEDIATE="immediate",t.RESOURCE_CONTROLLER="schedule",t.SLIDE="slide",t.STREAM_DATA_LOADER="stream loader",t.ELEVATION_QUERY="elevation query",t.TERRAIN_SURFACE="terrain",t.SURFACE_GEOMETRY_UPDATES="surface geometry updates",t.LOD_RENDERER="LoD renderer",t.GRAPHICS_CORE="Graphics3D",t.I3S_CONTROLLER="I3S",t.POINT_CLOUD_LAYER="point cloud",t.FEATURE_TILE_FETCHER="feature fetcher",t.OVERLAY="overlay",t.STAGE="stage",t.GRAPHICS_DECONFLICTOR="graphics deconflictor",t.FILTER_VISIBILITY="Graphics3D filter visibility",t.SCALE_VISIBILITY="Graphics3D scale visibility",t.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",t.POINT_OF_INTEREST_FREQUENT="POI frequent",t.POINT_OF_INTEREST_INFREQUENT="POI infrequent",t.LABELER="labeler",t.FEATURE_QUERY_ENGINE="feature query",t.FEATURE_TILE_TREE="feature tile tree",t.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",t.ELEVATION_ALIGNMENT="elevation alignment",t.TEXT_TEXTURE_ATLAS="text texture atlas",t.TEXTURE_UNLOAD="texture unload",t.LINE_OF_SIGHT_TOOL="line of sight tool",t.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",t.ELEVATION_PROFILE="elevation profile",t.SNAPPING="snapping",t.SHADOW_ACCUMULATOR="shadow accumulator",t.CLOUDS_GENERATOR="clouds generator",t[t.TEST_PRIO=1]="TEST_PRIO"}(St||(St={}));const Sg=0,Vme=new Map([[St.RESOURCE_CONTROLLER_IMMEDIATE,Sg],[St.RESOURCE_CONTROLLER,4],[St.SLIDE,Sg],[St.STREAM_DATA_LOADER,Sg],[St.ELEVATION_QUERY,Sg],[St.TERRAIN_SURFACE,1],[St.SURFACE_GEOMETRY_UPDATES,1],[St.LOD_RENDERER,2],[St.GRAPHICS_CORE,2],[St.I3S_CONTROLLER,2],[St.POINT_CLOUD_LAYER,2],[St.FEATURE_TILE_FETCHER,2],[St.OVERLAY,4],[St.STAGE,4],[St.GRAPHICS_DECONFLICTOR,4],[St.FILTER_VISIBILITY,4],[St.SCALE_VISIBILITY,4],[St.FRUSTUM_VISIBILITY,4],[St.CLOUDS_GENERATOR,4],[St.POINT_OF_INTEREST_FREQUENT,6],[St.POINT_OF_INTEREST_INFREQUENT,30],[St.LABELER,8],[St.FEATURE_QUERY_ENGINE,8],[St.FEATURE_TILE_TREE,16],[St.FEATURE_TILE_TREE_ACTIVE,Sg],[St.ELEVATION_ALIGNMENT,12],[St.TEXT_TEXTURE_ATLAS,12],[St.TEXTURE_UNLOAD,12],[St.LINE_OF_SIGHT_TOOL,16],[St.LINE_OF_SIGHT_TOOL_INTERACTIVE,Sg],[St.SNAPPING,Sg],[St.SHADOW_ACCUMULATOR,30]]);function Bme(t){return Vme.has(t)?Vme.get(t):typeof t=="number"?t:1}const jme=6.5,Gme=1,Oht=30,Hme=1e3/30,qme=100,Wme=.9;var Vz,Xw;(function(t){class e{get updating(){return this._updating.get()}_updatingChanged(){this._updating.set(this._tasks.some(s=>s.needsUpdate))}constructor(){this._updating=new kz(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new B0("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new i,this._state=Mr.INTERACTING,this._tasks=new Wt,this._runQueue=new Wt,this._load=0,this._idleStateCallbacks=new Wt,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=ne(()=>Aht.SCHEDULER_LOG_SLOW_TASKS,o=>this._debug=o,Vt);for(const o of Object.keys(St))this.performanceInfo.tasks.set(St[o],new B0(St[o]));const s=this;this._test={FRAME_SAFETY_BUDGET:jme,INTERACTING_BUDGET:Hme,IDLE_BUDGET:qme,get availableBudget(){return s._budget.budget},usedBudget:0,getBudget:()=>s._budget,setBudget:o=>s._budget=o,updateTask:o=>this._updateTask(o),getState:o=>this._getState(o),getRuntime:o=>this._getRuntime(o),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(s=>s.remove()),this._tasks.clear(),$i(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(s){this._updatingChanged(),s&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())}))}registerTask(s,o){const a=Bme(s),l=new r(this,s,o,a);return this._tasks.push(l),this._updatingChanged(),this.performanceInfo.tasks.has(s)||this.performanceInfo.tasks.set(s,new B0(s)),l}registerIdleStateCallbacks(s,o){const a={idleBegin:s,idleEnd:o};this._idleStateCallbacks.push(a),this.state===Mr.IDLE&&this._idleUpdatesStartFired&&a.idleBegin();const l=this;return{remove:()=>this._removeIdleStateCallbacks(a),set idleBegin(c){l._idleUpdatesStartFired&&(a.idleEnd(),l._state===Mr.IDLE&&c()),a.idleBegin=c},set idleEnd(c){a.idleEnd=c}}}get load(){return this._load}set state(s){this._state!==s&&(this._state=s,this.state!==Mr.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(o=>o.idleEnd())))}get state(){return this._state}updateBudget(s){this._test.usedBudget=0,++this._frameNumber;let o=jme,a=s.frameDuration,l=Gme;switch(this.state){case Mr.IDLE:o=0,a=Math.max(qme,s.frameDuration),l=Oht;break;case Mr.INTERACTING:a=Math.max(Hme,s.frameDuration);case Mr.ANIMATING:}return a=a-s.elapsedFrameTime-o,this.state!==Mr.IDLE&&a<Gme&&!this._forceTask?(this._forceTask=!0,!1):(a=Math.max(a,l),this._budget.reset(a,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case Mr.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(s=>s.idleBegin())),this._runIdle();break;case Mr.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(s){this._idleUpdatesStartFired&&s.idleEnd(),this._idleStateCallbacks.removeUnordered(s)}removeTask(s){this._tasks.removeUnordered(s),this._runQueue.removeUnordered(s),this._updatingChanged()}_updateTask(s){this._tasks.forAll(o=>{o.name===s&&o.setPriority(s)})}_getState(s){if(this._runQueue.some(a=>a.name===s))return Xw.SCHEDULED;let o=Xw.IDLE;return this._tasks.forAll(a=>{a.name===s&&a.needsUpdate&&(a.schedulePriority<=1?o=Xw.READY:o!==Xw.READY&&(o=Xw.WAITING))}),o}_getRuntime(s){let o=0;return this._tasks.forAll(a=>{a.name===s&&(o+=a.runtime)}),o}_resetRuntimes(){this._tasks.forAll(s=>s.runtime=0)}_getRunning(){const s=new Map;if(this._tasks.forAll(a=>{a.needsUpdate&&s.set(a.name,(s.get(a.name)||0)+1)}),s.size===0)return null;let o="";return s.forEach((a,l)=>{o+=a>1?` ${a}x ${l}`:` ${l}`}),o}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const s=this._tasks.reduce((o,a)=>a.needsUpdate?++o:o,0);this._load=this._load*Wme+s*(1-Wme)}_schedule(){for(this._runQueue.filterInPlace(s=>!!s.needsUpdate||(s.schedulePriority=s.basePriority,!1)),this._tasks.forAll(s=>{s.basePriority===Sg&&s.needsUpdate&&!this._runQueue.includes(s)&&s.blockFrame!==this._frameNumber&&this._runQueue.unshift(s)});this._runQueue.length===0;){let s=!1,o=0;if(this._tasks.forAll(a=>{a.needsUpdate&&a.schedulePriority!==0&&a.basePriority!==Sg&&a.blockFrame!==this._frameNumber&&(s=!0,o=Math.max(o,a.basePriority),a.schedulePriority===1?(a.schedulePriority=0,this._runQueue.push(a)):--a.schedulePriority)}),!s)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const s=this._budget.now();this._startFrameTaskTimes();do for(;this._runQueue.length>0;){const o=this._budget.now(),a=this._runQueue.pop();this._budget.resetProgress();try{a.task.runTask(this._budget)===za.YIELD&&(a.blockFrame=this._frameNumber)}catch(c){re.getLogger("esri.views.support.Scheduler").error(`Exception in task "${a.name}"`,c)}!this._budget.hasProgressed&&a.blockFrame!==this._frameNumber&&a.needsUpdate&&(a.name,St.I3S_CONTROLLER,a.blockFrame=this._frameNumber),a.schedulePriority=a.basePriority;const l=this._budget.now()-o;if(a.runtime+=l,this._frameTaskTimes.set(a.priority,this._frameTaskTimes.get(a.priority)+l),this._debug&&l>2*this._budget.budget&&console.log("Task",a.name,"used",l,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-s)}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-s)}_startFrameTaskTimes(){for(const s of Object.keys(St))this._frameTaskTimes.set(St[s],0)}_recordFrameTaskTimes(s){this._frameTaskTimes.forEach((o,a)=>this.performanceInfo.tasks.get(a).record(o)),this.performanceInfo.total.record(s)}get test(){return this._test}}t.Scheduler=e;class r{get task(){return this._task.get()}get updating(){return this._queue.running}constructor(s,o,a,l){this._scheduler=s,this.name=o,this._basePriority=l,this.blockFrame=0,this.runtime=0,this._queue=new Cht,this._handles=new qr,this.schedulePriority=this._basePriority,this._task=new kz(v(a)?a:this._queue),this._handles.add(fo(()=>this.task.running,c=>s.taskRunningChanged(c)))}remove(){this.processQueue(jl),this._scheduler.removeTask(this),this.schedule=NO.schedule,this.reschedule=NO.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(s){this.name=s;const o=Bme(s);this._basePriority!==Sg&&this.schedulePriority===0||(this.schedulePriority=o),this._basePriority=o}get priority(){return this.name}set priority(s){this.setPriority(s)}get needsUpdate(){return this.updating||this.task.running}schedule(s,o,a){return this._queue.push(s,o,a)}reschedule(s,o,a){return this._queue.unshift(s,o,a)}processQueue(s){this._queue.runTask(s)}}class i{constructor(){this._begin=typeof performance<"u"?performance.now():0,this._budget=0,this._state=Mr.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(s){return!this.done&&(s()===!0&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(s){this._enabled=s}reset(s,o){this._begin=this.now(),this._budget=s,this._state=o,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}t.Budget=i})(Vz||(Vz={})),function(t){t.SCHEDULED="s",t.READY="r",t.WAITING="w",t.IDLE="i"}(Xw||(Xw={}));const jl=(()=>{const t=new Vz.Budget;return t.enabled=!1,t})();let Mht=class{remove(){}processQueue(){}schedule(e,r,i){try{if(uo(r)){const n=Vr();return i?Promise.resolve(i(n)):Promise.reject(n)}return uY(e(jl))}catch(n){return Promise.reject(n)}}reschedule(e,r,i){return this.schedule(e,r,i)}};const NO=new Mht;let KA=class extends be{constructor(e,r){super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=(r==null?void 0:r.registerTask(St.TEXTURE_UNLOAD))??NO}normalizeCtorArgs(){return{}}destroy(){super.destroy(),this._frameTask.remove(),this._textureRequests.forEach(e=>this._releaseTextureRequest(e)),this._textureRequests.clear()}get updating(){return this._frameTask.updating}fromData(e,r,i){const n=this.makeUid(e);let s=this._textureRequests.get(n);if(!s){const o=r();s={referenceCount:0,texture:o,textureAsync:null,abortController:null,onRemove:i},this._stage&&(this._stage.add(o),this._stage.loadImmediate(o)),this._textureRequests.set(n,s)}return s.referenceCount++,{uid:n,texture:s.texture,release:()=>this._release(n)}}_release(e){const r=this._textureRequests.get(e);r?(r.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),r.referenceCount--,r.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(e){if(!this._textureRequests)return;const r=this._textureRequests.get(e);!r||r.referenceCount>0||(this._releaseTextureRequest(r),this._textureRequests.delete(e))}_releaseTextureRequest(e){var r;e.onRemove&&e.onRemove(),e.texture?(r=this._stage)==null||r.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,r=null){return v(r)?`${e}.${r}px`:e}};u([d()],KA.prototype,"_frameTask",void 0),u([d()],KA.prototype,"updating",null),KA=u([$("esri.views.3d.support.TextureCollection")],KA);var Xme;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right"})(Xme||(Xme={}));const fIe=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],mIe={};function gIe(t){return!!mIe[t]}function Pht(t){for(const e of t)if(!gIe(e))return!1;return!0}fIe.forEach(t=>{mIe[t]=!0});let Iht=class{constructor(e){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this._handlers.forEach(({handler:r,priority:i},n)=>{var s;return(s=this.inputManager)==null?void 0:s.installHandlers(n,[r],i)})}disconnect(){this.inputManager&&this._handlers.forEach((e,r)=>{var i;return(i=this.inputManager)==null?void 0:i.uninstallHandlers(r)}),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(e,r,i,n){const s=Array.isArray(e)?e:e.split(",");if(!Pht(s))return s.some(gIe)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,a;Array.isArray(r)?a=r:(o=r,a=[]),typeof i=="function"?o=i:n=i,n=n??Xg.DEFAULT;const l=this._createUniqueGroupName(),c=new $ht(this.view,s,a,o);this._handlers.set(l,{handler:c,priority:n});for(const h of s){const p=this._handlerCounts.get(h)||0;this._handlerCounts.set(h,p+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],n),{remove:()=>this._removeHandler(l,s)}}hasHandler(e){return!!this._handlerCounts.get(e)}_removeHandler(e,r){if(this._handlers.has(e)){this._handlers.delete(e);for(const i of r){const n=this._handlerCounts.get(i);n===void 0?console.error("Trying to remove handler for event that has no handlers registered: ",i):n===1?this._handlerCounts.delete(i):this._handlerCounts.set(i,n-1)}}this.inputManager&&this.inputManager.uninstallHandlers(e)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},$ht=class extends nn{constructor(e,r,i,n){super(!0),this._latestDragStart=void 0,this.view=e;for(const s of r)switch(s){case"click":this.registerIncoming("click",i,o=>n(this._wrapClick(o)));break;case"double-click":this.registerIncoming("double-click",i,o=>n(this._wrapDoubleClick(o)));break;case"immediate-click":this.registerIncoming("immediate-click",i,o=>n(this._wrapImmediateClick(o)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",i,o=>n(this._wrapImmediateDoubleClick(o)));break;case"hold":this.registerIncoming("hold",i,o=>n(this._wrapHold(o)));break;case"drag":this.registerIncoming("drag",i,o=>{const a=this._wrapDrag(o);a&&n(a)});break;case"key-down":this.registerIncoming("key-down",i,o=>n(this._wrapKeyDown(o)));break;case"key-up":this.registerIncoming("key-up",i,o=>n(this._wrapKeyUp(o)));break;case"pointer-down":this.registerIncoming("pointer-down",i,o=>n(this._wrapPointer(o,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",i,o=>n(this._wrapPointer(o,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",i,o=>n(this._wrapPointer(o,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",i,o=>n(this._wrapPointerDrag(o)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",i,o=>n(this._wrapMouseWheel(o)));break;case"pointer-enter":this.registerIncoming("pointer-enter",i,o=>n(this._wrapPointer(o,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",i,o=>n(this._wrapPointer(o,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",i,o=>{n(this._wrapGamepad(o))});break;case"focus":this.registerIncoming("focus",i,o=>{n(this._wrapFocus(o))});break;case"blur":this.registerIncoming("blur",i,o=>{n(this._wrapBlur(o))})}}_wrapFocus(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:r=>e.async(r),preventDefault:()=>e.preventDefault()}}_wrapBlur(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:r=>e.async(r),preventDefault:()=>e.preventDefault()}}_wrapClick(e){const{pointerType:r,button:i,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:h}=e;return{type:"click",pointerType:r,button:i,buttons:n,x:s,y:o,native:a,timestamp:h,screenPoint:Gs(s,o),mapPoint:this._getMapPoint(s,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}_wrapDoubleClick(e){const{pointerType:r,button:i,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:h}=e;return{type:"double-click",pointerType:r,button:i,buttons:n,x:s,y:o,native:a,timestamp:h,mapPoint:this._getMapPoint(s,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}_wrapImmediateClick(e){const{pointerType:r,button:i,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:h,timestamp:p}=e;return{type:"immediate-click",pointerId:c,pointerType:r,button:i,buttons:n,x:s,y:o,native:a,timestamp:p,mapPoint:this._getMapPoint(s,o),eventId:l,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}_wrapImmediateDoubleClick(e){const{pointerType:r,button:i,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:h,timestamp:p}=e;return{type:"immediate-double-click",pointerId:c,pointerType:r,button:i,buttons:n,x:s,y:o,native:a,timestamp:p,mapPoint:this._getMapPoint(s,o),eventId:l,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}_wrapHold(e){const{pointerType:r,button:i,buttons:n,x:s,y:o,native:a}=e.data,{cancelable:l,timestamp:c}=e;return{type:"hold",pointerType:r,button:i,buttons:n,x:s,y:o,native:a,timestamp:c,mapPoint:this._getMapPoint(s,o),cancelable:l,stopPropagation:()=>e.stopPropagation(),async:h=>e.async(h),preventDefault:()=>e.preventDefault()}}_getMapPoint(e,r){return this.view.toMap(Gs(e,r),{exclude:[]})}_wrapDrag(e){const r=e.data,{x:i,y:n}=r.center,{action:s,pointerType:o,button:a}=r;if(s==="start"&&(this._latestDragStart=r),!this._latestDragStart)return;const l=r.pointer.native,c=r.buttons,{cancelable:h,timestamp:p}=e,f={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return s==="end"&&(this._latestDragStart=void 0),{type:"drag",action:s,x:i,y:n,origin:f,pointerType:o,button:a,buttons:c,radius:r.radius,angle:dl(r.angle),native:l,timestamp:p,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}_wrapKeyDown(e){const{key:r,repeat:i,native:n}=e.data,{cancelable:s,timestamp:o}=e;return{type:"key-down",key:r,repeat:i,native:n,timestamp:o,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:a=>e.async(a),preventDefault:()=>e.preventDefault()}}_wrapKeyUp(e){const{key:r,native:i}=e.data,{cancelable:n,timestamp:s}=e;return{type:"key-up",key:r,native:i,timestamp:s,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:o=>e.async(o),preventDefault:()=>e.preventDefault()}}_wrapPointer(e,r){const{x:i,y:n,button:s,buttons:o,native:a,eventId:l}=e.data,c=a.pointerId,h=a.pointerType,{cancelable:p,timestamp:f}=e;return{type:r,x:i,y:n,pointerId:c,pointerType:h,button:s,buttons:o,native:a,timestamp:f,eventId:l,cancelable:p,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}_wrapPointerDrag(e){const{x:r,y:i,buttons:n,native:s,eventId:o}=e.data.currentEvent,{button:a}=e.data.startEvent,l=e.data.startEvent.native.pointerId,c=e.data.startEvent.native.pointerType,h=e.data.action,p={x:e.data.startEvent.x,y:e.data.startEvent.y},{cancelable:f,timestamp:m}=e;return{type:"pointer-drag",x:r,y:i,pointerId:l,pointerType:c,button:a,buttons:n,action:h,origin:p,native:s,timestamp:m,eventId:o,cancelable:f,stopPropagation:()=>e.stopPropagation(),async:g=>e.async(g),preventDefault:()=>e.preventDefault()}}_wrapMouseWheel(e){const{cancelable:r,data:i,timestamp:n}=e,{x:s,y:o,deltaY:a,native:l}=i;return{type:"mouse-wheel",x:s,y:o,deltaY:a,native:l,timestamp:n,cancelable:r,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}_wrapGamepad(e){const{action:r,state:i,device:n}=e.data,{cancelable:s,timestamp:o}=e,{buttons:a,axes:l}=i;return{type:"gamepad",device:n,timestamp:o,action:r,buttons:a,axes:l,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}};var aD,Yme,Zme;(function(t){t[t.USER=0]="USER",t[t.MANAGER=1]="MANAGER"})(aD||(aD={})),function(t){t[t.None=0]="None",t[t.Unfocused=1]="Unfocused",t[t.Focused=2]="Focused",t[t.Unselected=4]="Unselected",t[t.Selected=8]="Selected",t[t.All=15]="All"}(Yme||(Yme={})),function(t){t[t.None=0]="None",t[t.Custom1=16]="Custom1",t[t.Custom2=32]="Custom2",t[t.Custom3=64]="Custom3",t[t.Custom4=128]="Custom4",t[t.Custom5=256]="Custom5",t[t.Custom6=512]="Custom6",t[t.Custom7=1024]="Custom7",t[t.Custom8=2048]="Custom8",t[t.Custom9=4096]="Custom9",t[t.Custom10=8192]="Custom10",t[t.Custom11=16384]="Custom11",t[t.Custom12=32768]="Custom12",t[t.All=65520]="All"}(Zme||(Zme={}));function Lht(t){return[t.on("before-add",e=>{const r=e.item;if(r==null||t.includes(r))return re.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void e.preventDefault();r.onAdd()}),t.on("after-remove",e=>{const r=e.item;r.active&&(r.view.activeTool=null),r.destroy()})]}function hQ(t){return t.visible&&t.getEditableFlag!=null&&t.getEditableFlag(aD.USER)&&t.getEditableFlag(aD.MANAGER)}function sg(t){return Gs(t.x,t.y)}function B7t(t){return wn(t.x,t.y)}function yIe(t,e){var i;const r=(i=t instanceof HTMLElement?t:t.surface)==null?void 0:i.getBoundingClientRect();return r?Gs(e.clientX-r.left,e.clientY-r.top):Gs(0,0)}function Bz(t,e){return e instanceof Event?yIe(t,e):sg(e)}function jz(t){if(t instanceof Event)return!0;if(typeof t=="object"&&"type"in t)switch(t.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}let Dht=class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}handleInputEvent(e,r){const i=()=>e.stopPropagation();switch(e.type){case"pointer-move":Jme(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(i(),e.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!Kme(e))break;const n=sg(e),s=this._intersect(n,e.pointerType,r.forEachTool);if(R(s))break;const o=s.manipulator,a=s.tool;!(v(o)&&v(a)&&o.interactive)||o.grabbable&&o.grabbableForEvent(e)||!o.grabbing||o.dragging||this._ungrabManipulatorBeforeDragging(o,e,r),v(o)&&v(a)&&o.interactive&&o.grabbable&&o.grabbableForEvent(e)&&!o.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:o,tool:a,start:n,pointerType:e.pointerType}),this._grabbedManipulators.size===1&&R(r.activeTool)&&(this._revertToNullActiveTool=!0,r.setActiveTool(s.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:n}),i());break}case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,r);break;case"pointer-drag":{if(!Kme(e))break;const n=this._grabbedManipulators.get(e.pointerId),s=Fo(n,({manipulator:h})=>h),o=Fo(n,({tool:h})=>h);if(R(s)||R(o))break;const a=sg(e);a.x=_e(a.x,0,r.view.width),a.y=_e(a.y,0,r.view.height);const l=n.start,c=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":e.action!=="update"&&this._grabbedManipulators.size!==1||(s.dragging=!0,c?s.events.emit("drag",{action:"update",start:l,screenPoint:a}):s.events.emit("drag",{action:"start",start:l,screenPoint:a,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:o,manipulator:s,start:l}));break;case"end":s.dragging=!1,c&&s.events.emit("drag",{action:"end",start:l,screenPoint:a}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,r)}i();break}case"immediate-click":{const n=sg(e),s=this._intersect(n,e.pointerType,r.forEachTool);if(Nht(e)||r.forEachTool(c=>{if((!v(s)||s.tool!==c||c.automaticManipulatorSelection)&&c.manipulators){let h=!1;c.manipulators.forEach(({manipulator:p})=>{p.selected&&(p.selected=!1,h=!0)}),h&&c.onManipulatorSelectionChanged&&c.onManipulatorSelectionChanged()}}),R(s))break;const{manipulator:o,tool:a}=s;if(!o.interactive)break;o.selectable&&a.automaticManipulatorSelection&&(o.selected=!o.selected,a.onManipulatorSelectionChanged&&a.onManipulatorSelectionChanged());const l=e.native.shiftKey;o.events.emit("immediate-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:l,stopPropagation:i});break}case"click":{const n=sg(e),s=this._intersect(n,e.pointerType,r.forEachTool),o=v(s)?s.manipulator:null;if(R(o)||!o.interactive)break;const a=e.native.shiftKey;o.events.emit(e.type,{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:a}),i();break}case"double-click":{const n=sg(e),s=this._intersect(n,e.pointerType,r.forEachTool),o=v(s)?s.manipulator:null;if(R(o)||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("double-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:i});break}case"immediate-double-click":{const n=sg(e),s=this._intersect(n,e.pointerType,r.forEachTool),o=v(s)?s.manipulator:null;if(R(o)||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:i});break}}this._onFocusChange(r.forEachTool)}_ungrabManipulatorBeforeDragging(e,r,i){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:r.pointerType,screenPoint:sg(r)}),this._grabbedManipulators.forEach(({manipulator:n},s)=>{n===e&&this._grabbedManipulators.delete(s)}),this._afterManipulatorUngrab(i.setActiveTool)}_handlePointerEnd(e,r){const i=Fo(this._grabbedManipulators.get(e.pointerId),({manipulator:n})=>n);R(i)||i.grabbing&&(i.grabbing=!1,i.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:sg(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorUngrab(r.setActiveTool))}_cursorFromMap(e){let r=null;return ca(e,({manipulator:i})=>!(R(i)||!i.interactive)&&(i.grabbing&&i.grabCursor?(r=i.grabCursor,!0):!!i.cursor&&(r=i.cursor,!0))),r}_onFocusChange(e){this._updateCursor(),this._updateFocusedManipulatorTools(e)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(e){const r=new Set,i=new Set;this._grabbedManipulators.forEach(({tool:n})=>{r.add(n)}),this._hoveredManipulators.forEach(({tool:n})=>{i.add(n)}),e(n=>{n.hasGrabbedManipulators=r.has(n),n.hasHoveredManipulators=i.has(n);const s=this._grabbedManipulators.values(),o=Y7e(s,({tool:a})=>a===n);n.firstGrabbedManipulator=v(o)?o.manipulator:null})}clearPointers(e,{forEachTool:r,setActiveTool:i},n=!0,s){const o=(a,l)=>a===e&&(R(s)||s===l);this._grabbedManipulators.forEach(({tool:a,manipulator:l,pointerType:c},h)=>{o(a,l)&&(this._grabbedManipulators.delete(h),l.grabbing=!1,l.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:c}))}),this._draggedManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._draggedManipulators.delete(c),l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}),n&&this._hoveredManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._hoveredManipulators.delete(c),l.hovering=!1)}),this._afterManipulatorUngrab(i),this._onFocusChange(r)}_intersect(e,r,i){let n=null;return i(s=>{if(s.manipulators==null||!hQ(s))return!1;const o=s.manipulators.intersect(e,r);return!R(o)&&(n={tool:s,manipulator:o},!0)}),n}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach((r,i)=>{this._updateHoveredStateForPointerAtScreenPosition(Gs(r.x,r.y),i,r.pointerType,e)})}handleHoverEvent(e,r){e.type!=="pointer-up"&&e.type!=="immediate-click"&&e.type!=="pointer-move"||!Jme(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(sg(e),e.pointerId,e.pointerType,r)}_updateHoveredStateForPointerAtScreenPosition(e,r,i,n){let s=this._intersect(e,i,n);const o=Fo(this._hoveredManipulators.get(r),({manipulator:a})=>a);v(s)&&!s.manipulator.interactive&&(s=null),v(s)&&o===s.manipulator||(v(o)&&(o.hovering=!1),v(s)?(s.manipulator.hovering=!0,this._hoveredManipulators.set(r,s)):this._hoveredManipulators.delete(r),this._onFocusChange(n))}_afterManipulatorUngrab(e){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}};function Jme(t){return t==="mouse"}function Kme(t){return t.pointerType!=="mouse"||t.button===0}function Nht(t){return!!t.native.shiftKey}const Qme="attached",JG="tools";let h0=class extends eD{constructor(e){super(e),this._manipulatorState=new Dht,this.tools=new ct,this.cursor=null,this._forEachTool=r=>{for(const i of this.tools.items)if(r(i))return}}initialize(){this.handles.add([this.view.on(fIe,e=>{this._handleInputEvent(e)},Xg.TOOL),...Lht(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.detach(),this.handles.removeAll()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(v(e)&&!this.view.ready)return void re.getLogger(this.declaredClass).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const r=this.activeTool;this._set("activeTool",e),v(r)&&r.deactivate(),v(e)&&e.activate(),this._removeIncompleteTools(e);for(const i of this.tools){this._updateToolEditableFlag(i);const n=hQ(i);!R(this.activeTool)&&n||this._manipulatorState.clearPointers(i,this._manipulatorStateEventArgs,!n)}this._updateCursor()}get updating(){var e;return this.updatingHandles.updating||this.tools.some(r=>r.updating)||(((e=this.textures)==null?void 0:e.updating)??!1)}attach(){var e;this.view.type==="3d"?(this._set("textures",new KA(this.view._stage,this.view.resourceController.scheduler)),this.handles.add([ne(()=>{const{state:r}=this.view;return"camera"in r&&r.camera},()=>this._forEachManipulator(r=>r.onViewChange())),(e=this.view.elevationProvider)==null?void 0:e.on("elevation-change",r=>this._forEachManipulator(i=>i.onElevationChange(r))),am(()=>this._set("textures",ze(this.textures)))],Qme)):this.handles.add(ne(()=>this.view.extent,()=>this._forEachManipulator(r=>r.onViewChange())))}detach(){v(this.activeTool)&&(this.activeTool=null),this.tools.removeAll(),this.handles.remove(Qme)}_forEachManipulator(e){this._forEachTool(r=>{r.manipulators&&r.manipulators.forEach(({manipulator:i})=>e(i,r))})}_handleInputEvent(e){let r=!1;const i={...e,stopPropagation:()=>{r=!0,e.stopPropagation()}};v(this.activeTool)?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(i):this._forEachTool(n=>{!r&&n.visible&&n.handleInputEvent(i)}),!r&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(i,this._manipulatorStateEventArgs),!r&&v(this.activeTool)&&this.activeTool.handleInputEventAfter(i),this._manipulatorState.handleHoverEvent(i,this._forEachTool),this._updateCursor()}_refreshToolWatchers(){this.handles.remove(JG),this._forEachTool(e=>{if(e instanceof be){const r=ne(()=>[e.cursor,e.visible,e.editable],()=>{hQ(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.handles.add(r,JG)}e.manipulators&&this.handles.add([e.manipulators.on("after-remove",r=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,r.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],JG)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){var r;(r=e.setEditableFlag)==null||r.call(e,aD.MANAGER,R(this.activeTool)||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;R(e)&&this._forEachTool(r=>!(!v(r.cursor)||!r.visible)&&(e=r.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(r=>(R(e)||r!==e)&&!r.created&&r.removeIncompleteOnCancel).forEach(r=>{this.tools.remove(r)})}};u([d({constructOnly:!0,nonNullable:!0})],h0.prototype,"view",void 0),u([d({readOnly:!0,nonNullable:!0})],h0.prototype,"textures",void 0),u([d({value:null})],h0.prototype,"activeTool",null),u([d({readOnly:!0,type:ct})],h0.prototype,"tools",void 0),u([d({readOnly:!0})],h0.prototype,"cursor",void 0),u([d({readOnly:!0})],h0.prototype,"updating",null),h0=u([$("esri.views.ToolViewManager")],h0);const Fht=h0;let qC=class extends be{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":kht.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return Uht[this.deviceType]}};u([d({nonNullable:!0,readOnly:!0})],qC.prototype,"nativeIndex",void 0),u([d({type:String,readOnly:!0})],qC.prototype,"deviceType",null),u([d({type:Number,readOnly:!0})],qC.prototype,"axisThreshold",null),qC=u([$("esri.views.input.gamepad.GamepadInputDevice")],qC);const kht=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),Uht={standard:.15,spacemouse:.025,unknown:0},Moe=qC;let uI=class extends be{constructor(...e){super(...e),this.devices=new ct,this.enabledFocusMode="document"}};u([d({type:ct.ofType(Moe),readOnly:!0})],uI.prototype,"devices",void 0),u([d({type:["document","view","none"]})],uI.prototype,"enabledFocusMode",void 0),uI=u([$("esri.views.input.gamepad.GamepadSettings")],uI);const zht=uI;let sU=class extends be{constructor(){super(...arguments),this.gamepad=new zht}};u([d({readOnly:!0})],sU.prototype,"gamepad",void 0),sU=u([$("esri.views.input.Input")],sU);const Vht=sU;let d1=class extends be{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};u([d({type:Boolean,nonNullable:!0})],d1.prototype,"enabled",void 0),u([d({type:Moe})],d1.prototype,"device",void 0),u([d({type:["pan","zoom"],nonNullable:!0})],d1.prototype,"mode",void 0),u([d({type:["forward-down","forward-up"],nonNullable:!0})],d1.prototype,"tiltDirection",void 0),u([d({type:Number,nonNullable:!0})],d1.prototype,"velocityFactor",void 0),d1=u([$("esri.views.navigation.gamepad.GamepadSettings")],d1);const _Ie=d1;let fT=class extends be{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new _Ie,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};u([d({type:Boolean})],fT.prototype,"browserTouchPanEnabled",void 0),u([d({type:_Ie,nonNullable:!0})],fT.prototype,"gamepad",void 0),u([d({type:Boolean})],fT.prototype,"momentumEnabled",void 0),u([d({type:Boolean})],fT.prototype,"mouseWheelZoomEnabled",void 0),fT=u([$("esri.views.navigation.Navigation")],fT);const vIe=fT;function Z7t(t,e,r){const i=bIe(t),n=e,s=Bht(i,n,r);if(i){const o=E3.deriveUnitFromSR(i,t.spatialReference).heightUnit;if(!r&&o!==i.heightUnit){const a=new H("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${o})`,{horizontalUnit:o});return new H("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:i,error:a})}}if(!jht(t)||s===Su.Unsupported)return new H("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:i});switch(s){case Su.Units:{const o=(i==null?void 0:i.heightUnit)||"unknown",a=(n==null?void 0:n.heightUnit)||"unknown",l=new H("layerview:incompatible-height-unit",`The vertical units of the layer (${o}) must match the vertical units of the scene (${a})`,{layerUnit:o,sceneUnit:a});return new H("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:n,error:l})}case Su.HeightModel:{const o=(i==null?void 0:i.heightModel)||"unknown",a=(n==null?void 0:n.heightModel)||"unknown",l=new H("layerview:incompatible-height-model",`The height model of the layer (${o}) must match the height model of the scene (${a})`,{layerHeightModel:o,sceneHeightModel:a});return new H("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:n,error:l})}case Su.CRS:{const o=(i==null?void 0:i.vertCRS)||"unknown",a=(n==null?void 0:n.vertCRS)||"unknown",l=new H("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${o}) must match the vertical datum of the scene (${a})`,{layerDatum:o,sceneDatum:a});return new H("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:n,error:l})}}return null}function Bht(t,e,r){if(!ege(t)||!ege(e))return Su.Unsupported;if(t==null||e==null)return Su.Ok;if(!r&&t.heightUnit!==e.heightUnit)return Su.Units;if(t.heightModel!==e.heightModel)return Su.HeightModel;switch(t.heightModel){case"gravity-related-height":return Su.Ok;case"ellipsoidal":return t.vertCRS===e.vertCRS?Su.Ok:Su.CRS;default:return Su.Unsupported}}var Su;function ege(t){return t==null||t.heightModel!=null&&t.heightUnit!=null}function jht(t){return"heightModelInfo"in t&&t.heightModelInfo!=null||t.spatialReference!=null||!TIe(t)}function bIe(t){var i;const e=t.url?aw(t.url):void 0;return!(((i=t.spatialReference)==null?void 0:i.vcsWkid)==null&&v(e)&&e.serverType==="ImageServer")&&wIe(t)&&t.heightModelInfo?t.heightModelInfo:TIe(t)?E3.deriveUnitFromSR(Hht,t.spatialReference):null}function wIe(t){return"heightModelInfo"in t}function xIe(t){if(t.type==="unknown"||!("capabilities"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function TIe(t){return xIe(t)?!!(t.capabilities&&t.capabilities.data&&t.capabilities.data.supportsZ):SIe(t)}function Ght(t){return t.layers!=null||SIe(t)||xIe(t)||wIe(t)}function SIe(t){switch(t.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(t){t[t.Ok=0]="Ok",t[t.Units=1]="Units",t[t.HeightModel=2]="HeightModel",t[t.CRS=3]="CRS",t[t.Unsupported=4]="Unsupported"})(Su||(Su={}));const Hht=new E3({heightModel:"gravity-related-height"});var qe;function tge(t){return t==="global"?qe.Global:qe.Local}function KG(t){return t===qe.Global?"global":"local"}(function(t){t[t.Global=1]="Global",t[t.Local=2]="Local"})(qe||(qe={}));let dQ,QG=null;async function qht(t){QG||(QG=Q(()=>Promise.resolve().then(()=>Bte),void 0).then(e=>dQ=e)),await QG,lr(t)}async function EIe(t,e,r,i){if(!t)return null;const n=t.spatialReference;return i2()||cy(n,e)?ym(t,e):dQ?dQ.projectGeometry(t,e,r,i):(await Promise.race([qht(i),n2(i)]),EIe(t,e,r,i))}let cn=class extends be{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=Tp(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return v(this.userSpatialReference)?this.userSpatialReference:this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return R(this.userSpatialReference)||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){var i,n,s,o;const e=(i=this.map)==null?void 0:i.call(this),r=[];return v(this.priorityCollection)&&r.push(this.priorityCollection),r.push({parent:e==null?void 0:e.basemap,layers:(n=e==null?void 0:e.basemap)==null?void 0:n.baseLayers},{layers:e==null?void 0:e.layers},{parent:e==null?void 0:e.ground,layers:(s=e==null?void 0:e.ground)==null?void 0:s.layers},{parent:e==null?void 0:e.basemap,layers:(o=e==null?void 0:e.basemap)==null?void 0:o.referenceLayers}),r}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};const{layers:e,updating:r}=this._allLayers;let i=null;for(const s of e){const o=this._getSupportedSpatialReferences(s);if(o.length>0){const a=this._narrowDownSpatialReferenceCandidates(i,o);v(a)&&(i=a)}if(v(i)&&i.length===1)break}if(r&&(R(i)||i.length!==1))return{updating:!0};const n=this._pickSpatialReferenceCandidate(i);return{spatialReference:v(n)?n.spatialReference:null,viewingMode:v(n)?n.viewingMode:null,updating:!1}}get _tileInfoTask(){var i,n,s,o,a,l,c;if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:r}=this._collectLayers([{parent:(n=(i=this.map)==null?void 0:i.call(this))==null?void 0:n.basemap,layers:(a=(o=(s=this.map)==null?void 0:s.call(this))==null?void 0:o.basemap)==null?void 0:a.baseLayers},{layers:(c=(l=this.map)==null?void 0:l.call(this))==null?void 0:c.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const h=e[0].tileInfo;return{tileInfo:h&&h.spatialReference.equals(this.spatialReference)?h:null,updating:!1}}return{updating:r}}get _heightModelInfoTask(){var i,n,s;if(!this.required.heightModelInfo||this.suspended&&((i=this._get("_heightModelInfoTask"))!=null&&i.heightModelInfo))return this._get("_heightModelInfoTask")??{updating:!1};const{layers:e,updating:r}=this._allLayers;for(const o of e)if(Ght(o)){const a=bIe(o);if(a)return{heightModelInfo:a,vcsWkid:(n=o.spatialReference)==null?void 0:n.vcsWkid,latestVcsWkid:(s=o.spatialReference)==null?void 0:s.latestVcsWkid,updating:!1}}return{updating:r}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,r=e.updating,i=[];for(const n of e.layers){const s="fullExtents"in n&&n.fullExtents||(v(n.fullExtent)?[n.fullExtent]:[]),o=this.requiresExtentInSpatialReference?null:s[0],a=s.find(l=>l.spatialReference.equals(this.spatialReference))??o;if(a)return{candidates:[{extent:a,layer:n}],updating:!1};if(this._getSupportedSpatialReferences(n).length>0)for(const l of s)i.push({extent:l,layer:n})}return{candidates:i,updating:r}}get _extentTask(){const{candidates:e,updating:r}=this._extentCandidatesTask;if(r)return{updating:r};if(R(e)||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const i=this._pickExtentCandidate(e),n=this.spatialReference;return i.extent.equals(this._projectExtentTask.input)&&n.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:v(this._projectExtentTask.task)&&!this._projectExtentTask.task.finished}:(v(this._projectExtentTask.task)&&(this._projectExtentTask.task=Tp(this._projectExtentTask.task)),this._projectExtentTask={input:i.extent.clone(),output:null,spatialReference:n.clone(),task:EN(async s=>{try{const o=await EIe(i.extent,n,i.layer.portalItem,s);this._projectExtentTask={...this._projectExtentTask,task:null,output:o}}catch{if(uo(s))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,r){if(R(e))return r;const i=[],n=(s,o)=>v(s)?v(o)?s===o&&s:s:o;for(const s of e)for(const o of r){if(!s.spatialReference.equals(o.spatialReference))continue;const a=n(s.viewingMode,o.viewingMode);if(a!==!1){i.push({spatialReference:s.spatialReference,viewingMode:a});break}}return i.length>0?i:null}_pickSpatialReferenceCandidate(e){const r=this.defaultSpatialReference;return R(e)||e.length<1?v(r)?{spatialReference:r,viewingMode:null}:null:(v(r)&&e.length>1&&e.some(({spatialReference:i})=>i.equals(r))&&(e=e.filter(({spatialReference:i})=>i.equals(r))),e.length>1&&e.some(({viewingMode:i})=>i!==qe.Local)&&(e=e.filter(({viewingMode:i})=>i!==qe.Local)),e[0])}_getSupportedSpatialReferences(e){const r="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(r.length===0)return[];const i=[];for(const n of r){const s=this.getSpatialReferenceSupport({spatialReference:n,layer:e});if(v(s)){const o=v(s.constraints)?s.constraints:[{spatialReference:n,viewingMode:null}];for(const{spatialReference:a,viewingMode:l}of o)(!this.requiresExtentInSpatialReference||R(this.userSpatialReference)||a.equals(this.userSpatialReference))&&i.push({spatialReference:a,viewingMode:l})}}return i}_pickExtentCandidate(e){const r=this.spatialReference;return e.find(({extent:i})=>r.equals(i.spatialReference))||e[0]}_collectLayers(e){var i;if(this._loadMaybe((i=this.map)==null?void 0:i.call(this))!=="loaded")return{layers:[],updating:!0};const r={layers:[],preloading:-1,updating:!1};for(const n of e)if(this._collectCollection(n,r),r.preloading===this.sourcePreloadCount)break;return{layers:r.layers,updating:r.updating}}_collectCollection(e,r){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return r.updating=!0,void++r.preloading;case"failed":return}for(const i of e.layers){switch(this._loadMaybe(i)){case"failed":continue;case"loading":r.updating=!0,++r.preloading;break;case"loaded":r.updating||r.layers.push(i),"layers"in i&&this._collectCollection({layers:i.layers},r)}if(r.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(()=>{}),"loading"):e.loadStatus:"loaded"}};u([d()],cn.prototype,"required",void 0),u([d({constructOnly:!0})],cn.prototype,"map",void 0),u([d({constructOnly:!0})],cn.prototype,"getSpatialReferenceSupport",void 0),u([d()],cn.prototype,"defaultSpatialReference",void 0),u([d()],cn.prototype,"userSpatialReference",void 0),u([d()],cn.prototype,"sourcePreloadCount",void 0),u([d()],cn.prototype,"priorityCollection",void 0),u([d()],cn.prototype,"requiresExtentInSpatialReference",void 0),u([d()],cn.prototype,"suspended",void 0),u([d({readOnly:!0})],cn.prototype,"ready",null),u([d({readOnly:!0})],cn.prototype,"heightModelInfoReady",null),u([d({readOnly:!0})],cn.prototype,"spatialReference",null),u([d({readOnly:!0})],cn.prototype,"extent",null),u([d({readOnly:!0})],cn.prototype,"heightModelInfo",null),u([d({readOnly:!0})],cn.prototype,"vcsWkid",null),u([d({readOnly:!0})],cn.prototype,"latestVcsWkid",null),u([d({readOnly:!0})],cn.prototype,"viewingMode",null),u([d({readOnly:!0})],cn.prototype,"tileInfo",null),u([d({readOnly:!0})],cn.prototype,"mapCollections",null),u([d({readOnly:!0})],cn.prototype,"_allLayers",null),u([d({readOnly:!0})],cn.prototype,"_spatialReferenceTask",null),u([d({readOnly:!0})],cn.prototype,"_tileInfoTask",null),u([d({readOnly:!0})],cn.prototype,"_heightModelInfoTask",null),u([d({readOnly:!0})],cn.prototype,"_extentCandidatesTask",null),u([d()],cn.prototype,"_extentTask",null),u([d()],cn.prototype,"_projectExtentTask",void 0),cn=u([$("esri.views.support.DefaultsFromMap")],cn);var oU;let Gt=oU=class extends Iw(Sn.EventedMixin(m3(be))){constructor(t){super(t),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new wO({getCollections:()=>{var e,r,i;return[(e=this.basemapView)==null?void 0:e.baseLayerViews,(r=this.groundView)==null?void 0:r.layerViews,this.layerViews,(i=this.basemapView)==null?void 0:i.referenceLayerViews]},getChildrenFunction:e=>e.layerViews}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new U$,this.analyses=new DO,this.typeSpecificPreconditionsReady=!0,this.layerViews=new ct,this.magnifier=new pIe,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.timeReference=new $O,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new Vht,this.navigation=new vIe,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new Iht(this),this.persistableViewModels=new ct,this._isValid=!1,this._readyCycleForced=!1,this._currentSpatialReference=null,this.handles.add(ne(()=>this.preconditionsReady,e=>{var r,i;e?(this._currentSpatialReference=this.spatialReference,oU.views.add(this)):(this._currentSpatialReference=null,oU.views.remove(this)),this.notifyChange("spatialReference"),!e&&this.ready?((r=this.toolViewManager)==null||r.detach(),v(this.analysisViewManager)&&this.analysisViewManager.detach(),(i=this.layerViewManager)==null||i.clear(),this._teardown()):e&&!this.ready&&(this._startup(),v(this.analysisViewManager)&&this.analysisViewManager.attach(),this.toolViewManager.attach())},Zr))}initialize(){this.addResolvingPromise(this.validate().then(()=>(this._isValid=!0,tw(()=>this.ready)))),this.basemapView=new h1({view:this}),this.layerViewManager=new Sht({view:this,layerViewImporter:{importLayerView:t=>this.importLayerView(t),hasLayerViewModule:t=>this.hasLayerViewModule(t)},supportsGround:this.supportsGround}),this.toolViewManager=new Fht({view:this}),this._setupSpatialReferenceLogger(),this.handles.add([ne(()=>this.initialExtentRequired,t=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:t},{sync:!0,initial:!0}),ne(()=>this.ready,t=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=t,this.defaultsFromMap.userSpatialReference=t?this.spatialReference:this._userSpatialReference)},{sync:!0}),ne(()=>this._userSpatialReference,t=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=t)},{sync:!0,initial:!0})])}_setupSpatialReferenceLogger(){let t=null;this.handles.add([ne(()=>{var e;return(e=this.defaultsFromMap)==null?void 0:e.ready},e=>{var i;const r=((i=this.map)==null?void 0:i.allLayers.length)>0;if(e&&!this.spatialReference&&r){if(v(t))return;const n=am(()=>t=Tp(t));t=EN(async s=>{try{await YS(this.spatialReferenceWarningDelay,null,s)}catch{return}finally{t=null}re.getLogger(this.declaredClass).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.handles.add(n,"spatial-reference-logger-task")}else this.handles.remove("spatial-reference-logger-task")},{sync:!0})])}destroy(){if(this.destroyed)return;this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=ze(this.graphics),this.analyses=ze(this.analyses),this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),ze(this.analysisViewManager),this.toolViewManager=ze(this.toolViewManager),this.layerViewManager=ze(this.layerViewManager),this.basemapView=ze(this.basemapView),this.invalidate(),this._emitter.clear(),this.handles.removeAll();const t=this.map;this.map=null,t==null||t.destroy()}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return re.getLogger(this.declaredClass).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){var t;return(t=this.toolViewManager)==null?void 0:t.activeTool}set activeTool(t){this.toolViewManager&&(this.toolViewManager.activeTool=t)}get animation(){return this._get("animation")}set animation(t){this._set("animation",t)}get center(){return null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new cn({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:t=>this.getSpatialReferenceSupport(t),...this._defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(t){this._set("extent",t)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){var t;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||qu.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._currentSpatialReference&&!((t=this.defaultsFromMap)!=null&&t.ready)||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(t){t!==this._get("map")&&(t!=null&&t.destroyed&&(re.getLogger(this.declaredClass).warn("#map","The provided map is already destroyed",{map:t}),t=null),qu.isLoadable(t)&&t.load().catch(()=>{}),this.constructed&&(this.forceReadyCycle(),this._currentSpatialReference=null),this._set("map",t))}get spatialReference(){var e,r;let t=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return t&&((r=(e=this.defaultsFromMap)==null?void 0:e.required)!=null&&r.heightModelInfo)&&(t=t.clone(),t.vcsWkid=this.defaultsFromMap.vcsWkid,t.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),t}set spatialReference(t){const e=!In(t,this._get("spatialReference"));this._set("_userSpatialReference",t),e&&(this._set("spatialReference",t),this._spatialReferenceChanged(t))}_spatialReferenceChanged(t){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get tools(){var t;return(t=this.toolViewManager)==null?void 0:t.tools}get initialExtent(){var t;return(t=this.defaultsFromMap)==null?void 0:t.extent}get cursor(){const t=this.toolViewManager?this.toolViewManager.cursor:null;return v(t)?t:this._cursor||"default"}set cursor(t){this._cursor=t,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(t){return this.layerViewManager.whenLayerView(t)}getDefaultSpatialReference(){var t;return(t=this.defaultsFromMap)==null?void 0:t.spatialReference}getDefaultHeightModelInfo(){var t;return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??((t=this.defaultsFromMap)==null?void 0:t.heightModelInfo)??null}importLayerView(t){throw new H("importLayerView() not implemented")}hasLayerViewModule(t){return!1}async validate(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(t){return v(this.getSpatialReferenceSupport({spatialReference:t}))}when(t,e){return this.isResolved()&&!this.ready&&re.getLogger(this.declaredClass).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(t,e)}forceReadyCycle(){this.ready&&(fo(()=>this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(t){this.toolViewManager.tools.add(t),this.activeTool=t}tryFatalErrorRecovery(){this.fatalError=null}};Gt.views=new ct,u([d()],Gt.prototype,"_userSpatialReference",void 0),u([d()],Gt.prototype,"activeTool",null),u([d({readOnly:!0})],Gt.prototype,"allLayerViews",void 0),u([d()],Gt.prototype,"groundView",void 0),u([d()],Gt.prototype,"animation",null),u([d()],Gt.prototype,"basemapView",void 0),u([d()],Gt.prototype,"center",null),u([d({readOnly:!0})],Gt.prototype,"_defaultsFromMapSettings",null),u([d()],Gt.prototype,"defaultsFromMap",null),u([d()],Gt.prototype,"fatalError",void 0),u([d({type:ur})],Gt.prototype,"extent",null),u([d(uQ(U$,"graphics"))],Gt.prototype,"graphics",void 0),u([d(uQ(DO,"analyses"))],Gt.prototype,"analyses",void 0),u([d({readOnly:!0,type:E3})],Gt.prototype,"heightModelInfo",null),u([d({readOnly:!0})],Gt.prototype,"interacting",null),u([d({readOnly:!0})],Gt.prototype,"navigating",null),u([d({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],Gt.prototype,"preconditionsReady",null),u([d({readOnly:!0})],Gt.prototype,"typeSpecificPreconditionsReady",void 0),u([d({type:ct,readOnly:!0})],Gt.prototype,"layerViews",void 0),u([d()],Gt.prototype,"resolution",null),u([d({type:pIe})],Gt.prototype,"magnifier",void 0),u([d({value:null,type:PB})],Gt.prototype,"map",null),u([d()],Gt.prototype,"padding",void 0),u([d({readOnly:!0})],Gt.prototype,"ready",void 0),u([d({type:Je})],Gt.prototype,"spatialReference",null),u([d()],Gt.prototype,"spatialReferenceWarningDelay",void 0),u([d()],Gt.prototype,"stationary",null),u([d({readOnly:!0})],Gt.prototype,"supportsGround",void 0),u([d({type:qc})],Gt.prototype,"timeExtent",void 0),u([d({type:$O,nonNullable:!0})],Gt.prototype,"timeReference",void 0),u([d()],Gt.prototype,"tools",null),u([d()],Gt.prototype,"toolViewManager",void 0),u([d({readOnly:!0})],Gt.prototype,"type",void 0),u([d({type:Number})],Gt.prototype,"scale",void 0),u([d({readOnly:!0})],Gt.prototype,"updating",void 0),u([d({readOnly:!0})],Gt.prototype,"initialExtentRequired",void 0),u([d({readOnly:!0})],Gt.prototype,"initialExtent",null),u([d()],Gt.prototype,"cursor",null),u([d({readOnly:!0})],Gt.prototype,"input",void 0),u([d({type:vIe,nonNullable:!0})],Gt.prototype,"navigation",void 0),u([d()],Gt.prototype,"layerViewManager",void 0),u([d()],Gt.prototype,"analysisViewManager",void 0),u([d()],Gt.prototype,"width",void 0),u([d()],Gt.prototype,"height",void 0),u([d({readOnly:!0})],Gt.prototype,"resizing",void 0),u([d({value:null,readOnly:!0})],Gt.prototype,"size",null),u([d({readOnly:!0})],Gt.prototype,"suspended",void 0),u([d({readOnly:!0})],Gt.prototype,"viewEvents",void 0),u([d({readOnly:!0})],Gt.prototype,"persistableViewModels",void 0),u([d()],Gt.prototype,"_isValid",void 0),u([d()],Gt.prototype,"_readyCycleForced",void 0),u([d()],Gt.prototype,"_currentSpatialReference",void 0),Gt=oU=u([$("esri.views.View")],Gt);const CIe=Gt;let p1=class extends oz{constructor(e){super(e),this.state="running",this.target=null,this._dfd=null}initialize(){this.addResolvingPromise(new Promise((e,r)=>this._dfd={resolve:e,reject:r}))}get done(){return this.state==="finished"||this.state==="stopped"}stop(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),(e=this._dfd)==null||e.reject(new H("ViewAnimation stopped")))}finish(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),(e=this._dfd)==null||e.resolve())}update(e,r){r||(r=Ju(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",r)}};u([d({readOnly:!0})],p1.prototype,"done",null),u([d({readOnly:!0,type:String})],p1.prototype,"state",void 0),u([d()],p1.prototype,"target",void 0),p1=u([$("esri.views.ViewAnimation")],p1),function(t){t.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(p1||(p1={}));const E_=p1;function XT(t,e,r,i){const n=3*t,s=3*(r-t)-n,o=1-n-s,a=3*e,l=3*(i-e)-a,c=1-a-l;function h(g){return((o*g+s)*g+n)*g}function p(g){return((c*g+l)*g+a)*g}function f(g){return(3*o*g+2*s)*g+n}function m(g,_){let b,w,x,T,E,C;for(x=g,C=0;C<8;C++){if(T=h(x)-g,Math.abs(T)<_)return x;if(E=f(x),Math.abs(E)<1e-6)break;x-=T/E}if(b=0,w=1,x=g,x<b)return b;if(x>w)return w;for(;b<w;){if(T=h(x),Math.abs(T-g)<_)return x;g>T?b=x:w=x,x=.5*(w-b)+b}return x}return function(g,_=1e-6){return p(m(g,_))}}const Wht=/^cubic-bezier\((.*)\)/,Bd={};function Xht(t){let e=Bd[t]||null;if(!e){const r=Wht.exec(t);if(r){const i=r[1].split(",").map(n=>parseFloat(n.trim()));i.length!==4||i.some(n=>isNaN(n))||(e=XT.apply(XT,i))}}return e}Bd.ease=XT(.25,.1,.25,1),Bd.linear=XT(0,0,1,1),Bd.easeIn=Bd["ease-in"]=XT(.42,0,1,1),Bd.easeOut=Bd["ease-out"]=XT(0,0,.58,1),Bd.easeInOut=Bd["ease-in-out"]=XT(.42,0,.58,1);function Fb(){return[1,0,0,1,0,0]}function Yht(t){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function Zht(t,e,r,i,n,s){return[t,e,r,i,n,s]}function Jht(t,e){return new Float64Array(t,e,6)}Object.freeze(Object.defineProperty({__proto__:null,clone:Yht,create:Fb,createView:Jht,fromValues:Zht},Symbol.toStringTag,{value:"Module"}));function Qs(t,e){return t[0]=e[0],t[1]=e[1],t}function dt(t,e,r){return t[0]=e,t[1]=r,t}function qd(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function jh(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function AIe(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function RIe(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function Kht(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function Qht(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function edt(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t}function tdt(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t}function rdt(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function sl(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function idt(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t}function uy(t,e){const r=e[0]-t[0],i=e[1]-t[1];return Math.sqrt(r*r+i*i)}function FO(t,e){const r=e[0]-t[0],i=e[1]-t[1];return r*r+i*i}function lD(t){const e=t[0],r=t[1];return Math.sqrt(e*e+r*r)}function OIe(t){const e=t[0],r=t[1];return e*e+r*r}function Poe(t,e){return t[0]=-e[0],t[1]=-e[1],t}function ndt(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function d2(t,e){const r=e[0],i=e[1];let n=r*r+i*i;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n),t}function Ss(t,e){return t[0]*e[0]+t[1]*e[1]}function MIe(t,e,r){const i=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=i,t}function W1(t,e,r,i){const n=e[0],s=e[1];return t[0]=n+i*(r[0]-n),t[1]=s+i*(r[1]-s),t}function sdt(t,e){e=e||1;const r=2*mN()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t}function pQ(t,e,r){const i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n,t[1]=r[1]*i+r[3]*n,t}function Ag(t,e,r){const i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n+r[4],t[1]=r[1]*i+r[3]*n+r[5],t}function odt(t,e,r){const i=e[0],n=e[1];return t[0]=r[0]*i+r[3]*n+r[6],t[1]=r[1]*i+r[4]*n+r[7],t}function adt(t,e,r){const i=e[0],n=e[1];return t[0]=r[0]*i+r[4]*n+r[12],t[1]=r[1]*i+r[5]*n+r[13],t}function yS(t,e,r,i){const n=e[0]-r[0],s=e[1]-r[1],o=Math.sin(i),a=Math.cos(i);return t[0]=n*a-s*o+r[0],t[1]=n*o+s*a+r[1],t}function ldt(t,e){const r=t[0],i=t[1],n=e[0],s=e[1];let o=r*r+i*i;o>0&&(o=1/Math.sqrt(o));let a=n*n+s*s;a>0&&(a=1/Math.sqrt(a));const l=(r*n+i*s)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function cdt(t){return"vec2("+t[0]+", "+t[1]+")"}function PIe(t,e){return t[0]===e[0]&&t[1]===e[1]}function IIe(t,e){const r=t[0],i=t[1],n=e[0],s=e[1],o=yl();return Math.abs(r-n)<=o*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-s)<=o*Math.max(1,Math.abs(i),Math.abs(s))}function udt(t,e,r,i,n){let s=e[0]-r[0],o=e[1]-r[1];const a=(i[0]*s+i[1]*o)*(n-1);return s=i[0]*a,o=i[1]*a,t[0]=e[0]+s,t[1]=e[1]+o,t}const hdt=lD,Ioe=jh,ddt=AIe,pdt=RIe,$Ie=uy,fdt=FO,mdt=OIe;Object.freeze(Object.defineProperty({__proto__:null,add:qd,angle:ldt,ceil:Kht,copy:Qs,cross:MIe,dist:$Ie,distance:uy,div:pdt,divide:RIe,dot:Ss,equals:IIe,exactEquals:PIe,floor:Qht,inverse:ndt,len:hdt,length:lD,lerp:W1,max:tdt,min:edt,mul:ddt,multiply:AIe,negate:Poe,normalize:d2,projectAndScale:udt,random:sdt,rotate:yS,round:rdt,scale:sl,scaleAndAdd:idt,set:dt,sqrDist:fdt,sqrLen:mdt,squaredDistance:FO,squaredLength:OIe,str:cdt,sub:Ioe,subtract:jh,transformMat2:pQ,transformMat2d:Ag,transformMat3:odt,transformMat4:adt},Symbol.toStringTag,{value:"Module"}));function Ne(){return[0,0]}function hI(t){return[t[0],t[1]]}function Rr(t,e){return[t,e]}function LIe(t){const e=Ne(),r=Math.min(2,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function DIe(t,e){return new Float64Array(t,e,2)}function NIe(){return Ne()}function FIe(){return Rr(1,1)}function kIe(){return Rr(1,0)}function UIe(){return Rr(0,1)}const Wc=NIe(),zIe=FIe(),gdt=kIe(),ydt=UIe();Object.freeze(Object.defineProperty({__proto__:null,ONES:zIe,UNIT_X:gdt,UNIT_Y:ydt,ZEROS:Wc,clone:hI,create:Ne,createView:DIe,fromArray:LIe,fromValues:Rr,ones:FIe,unitX:kIe,unitY:UIe,zeros:NIe},Symbol.toStringTag,{value:"Module"}));const VIe=96,BIe=39.37,_dt=180/Math.PI;function jIe(t){return t.wkid?t:t.spatialReference||Je.WGS84}function $oe(t,e){return e.type?dt(t,e.x,e.y):Qs(t,e)}function GIe(t){return Kl(t)}function z$(t,e){const r=Math.max(1,e[0]),i=Math.max(1,e[1]);return Math.max(t.width/r,t.height/i)*Adt(t.spatialReference)}async function dI(t,e,r,i){let n,s;if(!t||Array.isArray(t)&&!t.length)return null;if(ct.isCollection(t)&&(t=t.toArray()),Array.isArray(t)&&t.length&&typeof t[0]=="object"){const a=t.every(h=>"attributes"in h),l=t.some(h=>!h.geometry);let c=t;if(a&&l&&e&&e.allLayerViews){const h=new Map;for(const g of t){const _=g.layer,b=h.get(_)||[],w=g.attributes[_.objectIdField];w!=null&&b.push(w),h.set(_,b)}const p=[];h.forEach((g,_)=>{const b=e.allLayerViews.find(w=>w.layer.id===_.id);if(b&&"queryFeatures"in b){const w=_.createQuery();w.objectIds=g,w.returnGeometry=!0,p.push(b.queryFeatures(w))}});const f=await Promise.all(p),m=[];for(const g of f)if(g&&g.features&&g.features.length)for(const _ of g.features)v(_.geometry)&&m.push(_.geometry);c=m}for(const h of c)i=await dI(h,e,r,i);return i}if(Array.isArray(t)&&t.length===2&&typeof t[0]=="number"&&typeof t[1]=="number")n=new Ue(t);else if(t instanceof $_)n=t;else if("geometry"in t){if(t.geometry)n=t.geometry;else if(t.layer){const a=t.layer,l=e.allLayerViews.find(c=>c.layer.id===a.id);if(l&&"queryFeatures"in l){const c=a.createQuery();c.objectIds=[t.attributes[a.objectIdField]],c.returnGeometry=!0;const h=await l.queryFeatures(c);n=Xs(h,"features",0,"geometry")}}}if(R(n)||(s=n.type==="point"?new ur({xmin:n.x,ymin:n.y,xmax:n.x,ymax:n.y,spatialReference:n.spatialReference}):n.extent,!s))return null;i2()||cy(s.spatialReference,r)||await n2();const o=ym(s,r);return o?i=i?i.union(o):o:null}function vdt(t){if(t&&(!Array.isArray(t)||typeof t[0]!="number")&&(typeof t=="object"||Array.isArray(t)&&typeof t[0]=="object")){if("layer"in t&&t.layer&&t.layer.minScale&&t.layer.maxScale){const e=t.layer;return{min:e.minScale,max:e.maxScale}}if(Array.isArray(t)&&t.length&&t.every(e=>"layer"in e)){let e=0,r=0;for(const i of t){const n=i.layer;n&&n.minScale&&n.maxScale&&(e=n.minScale<e?n.minScale:e,r=n.maxScale>r?n.maxScale:r)}return e&&r?{min:e,max:r}:null}}}function eH(t,e){return In(jIe(t),e)?t:ym(t,e)}async function bdt(t,e){if(!t||!e)return new Xn({targetGeometry:new Ue,scale:0,rotation:0});let r=e.spatialReference;const{constraints:i,padding:n,viewpoint:s,size:o}=e,a=[n?o[0]-n.left-n.right:o[0],n?o[1]-n.top-n.bottom:o[1]];let l=null;t instanceof Xn?l=t:t.viewpoint?l=t.viewpoint:t.target&&t.target.declaredClass==="esri.Viewpoint"&&(l=t.target);let c=null;l&&l.targetGeometry?c=l.targetGeometry:t instanceof ur?c=t:(t||t&&("center"in t||"extent"in t||"target"in t))&&(c=await dI(t.center,e,r)||await dI(t.extent,e,r)||await dI(t.target,e,r)||await dI(t,e,r)),!c&&s&&s.targetGeometry?c=s.targetGeometry:!c&&e.extent&&(c=e.extent),r||(r=jIe(e.spatialReference||e.extent||c)),i2()||In(c.spatialReference,r)||cy(c,r)||await n2();const h=eH(c.center?c.center:c,r);let p=0;if(l&&v(l.targetGeometry)&&l.targetGeometry.type==="point")p=l.scale;else if("scale"in t&&t.scale)p=t.scale;else if("zoom"in t&&t.zoom!==-1&&i&&i.effectiveLODs)p=i.zoomToScale(t.zoom);else if(Array.isArray(c)||c.type==="point"||c.type==="extent"&&c.width===0&&c.height===0){const _=eH(e.extent,r);p=v(_)?z$(_,a):e.extent?z$(e.extent,a):s.scale}else p=z$(eH(c.extent,r),a);const f=vdt(t);f&&(f.min&&f.min>p?p=f.min:f.max&&f.max<p&&(p=f.max));let m=0;l?m=l.rotation:t.hasOwnProperty("rotation")?m=t.rotation:s&&(m=s.rotation);let g=new Xn({targetGeometry:h,scale:p,rotation:m});return i&&(g=i.fit(g),i.constrainByGeometry(g),i.rotationEnabled||(g.rotation=m)),g}function _m(t,e){const r=t.targetGeometry,i=e.targetGeometry;return r.x=i.x,r.y=i.y,r.spatialReference=i.spatialReference,t.scale=e.scale,t.rotation=e.rotation,t}function wdt(t,e,r){return r?dt(t,.5*(e[0]-r.right+r.left),.5*(e[1]-r.bottom+r.top)):sl(t,e,.5)}const xdt=function(){const t=Ne();return function(e,r,i){const n=r.targetGeometry;$oe(t,n);const s=.5*M3(r);return e.xmin=t[0]-s*i[0],e.ymin=t[1]-s*i[1],e.xmax=t[0]+s*i[0],e.ymax=t[1]+s*i[1],e.spatialReference=n.spatialReference,e}}();function Tdt(t,e,r,i,n){return fQ(t,e,r.center),t.scale=z$(r,i),n&&n.constraints&&n.constraints.constrain(t),t}function Sdt(t,e,r,i){return Noe(t,e,r,i),Coe(t,t)}const HIe=function(){const t=Ne();return function(e,r,i){return Ioe(e,Rdt(e,r),wdt(t,r,i))}}(),Edt=function(){const t=Fb(),e=Ne();return function(r,i,n,s){const o=M3(i),a=Loe(i);return dt(e,o,o),eIe(t,e),OB(t,t,a),oD(t,t,HIe(e,n,s)),oD(t,t,[0,s.top-s.bottom]),dt(r,t[4],t[5])}}();function M3(t){return t.scale*Cdt(t.targetGeometry)}function Cdt(t){return v(t)&&$a(t.spatialReference)?1/(GIe(t.spatialReference)*BIe*VIe):1}function Loe(t){return gN(t.rotation)||0}function Adt(t){return $a(t)?GIe(t)*BIe*VIe:1}function Rdt(t,e){return sl(t,e,.5)}const Doe=function(){const t=Ne(),e=Ne(),r=Ne();return function(i,n,s,o,a,l){return Poe(t,n),sl(e,s,.5*l),dt(r,1/o*l,-1/o*l),Roe(i,e),a&&OB(i,i,a),Aoe(i,i,r),oD(i,i,t),i}}(),Noe=function(){const t=Ne();return function(e,r,i,n){const s=M3(r),o=Loe(r);return $oe(t,r.targetGeometry),Doe(e,t,i,s,o,n)}}(),Odt=function(){const t=Ne();return function(e,r,i,n){const s=M3(r);return $oe(t,r.targetGeometry),Doe(e,t,i,s,0,n)}}();function Mdt(t){const e=fp(t);return e?e.valid[1]-e.valid[0]:0}function Pdt(t,e){return Math.round(Mdt(t)/e)}const Idt=function(){const t=Ne(),e=Ne(),r=[0,0,0];return function(i,n,s){jh(t,i,n),d2(t,t),jh(e,i,s),d2(e,e),MIe(r,t,e);let o=Math.acos(Ss(t,e)/(lD(t)*lD(e)))*_dt;return r[2]<0&&(o=-o),isNaN(o)&&(o=0),o}}(),$dt=function(){const t=Ne();return function(e,r,i,n){const s=e.targetGeometry;return _m(e,r),Edt(t,r,i,n),s.x+=t[0],s.y+=t[1],e}}(),fQ=function(t,e,r){_m(t,e);const i=t.targetGeometry;return i.x=r.x,i.y=r.y,i.spatialReference=r.spatialReference,t},Ldt=function(){const t=Ne();return function(e,r,i,n,s){s||(s="center"),Ioe(t,i,n),sl(t,t,.5);const o=t[0],a=t[1];switch(s){case"center":dt(t,0,0);break;case"left":dt(t,-o,0);break;case"top":dt(t,0,a);break;case"right":dt(t,o,0);break;case"bottom":dt(t,0,-a);break;case"top-left":dt(t,-o,a);break;case"bottom-left":dt(t,-o,-a);break;case"top-right":dt(t,o,a);break;case"bottom-right":dt(t,o,-a)}return IB(e,r,t),e}}();function Q7t(t,e,r){return _m(t,e),t.rotation+=r,t}function Ddt(t,e,r){return _m(t,e),t.rotation=r,t}const Ndt=function(){const t=Ne();return function(e,r,i,n,s){return _m(e,r),isNaN(i)||i===0||(WIe(t,n,r,s),e.scale=r.scale*i,XIe(t,t,e,s),IB(e,e,dt(t,t[0]-n[0],n[1]-t[1]))),e}}();function rge(t,e,r){return _m(t,e),t.scale=r,t}const qIe=function(){const t=Ne();return function(e,r,i,n,s,o){return _m(e,r),isNaN(i)||i===0||(WIe(t,s,r,o),e.scale=r.scale*i,e.rotation+=n,XIe(t,t,e,o),IB(e,e,dt(t,t[0]-s[0],s[1]-t[1]))),e}}(),ejt=function(){const t=Ne(),e=Ne();return function(r,i,n,s,o,a,l){return HIe(e,a,l),qd(t,o,e),s?qIe(r,i,n,s,t,a):Ndt(r,i,n,t,a)}}(),WIe=function(){const t=Fb();return function(e,r,i,n){return Ag(e,r,Sdt(t,i,n,1))}}(),XIe=function(){const t=Fb();return function(e,r,i,n){return Ag(e,r,Noe(t,i,n,1))}}(),IB=function(){const t=Ne(),e=Fb();return function(r,i,n){_m(r,i);const s=M3(i),o=r.targetGeometry;return QPe(e,Loe(i)),Aoe(e,e,Rr(s,s)),Ag(t,n,e),o.x+=t[0],o.y+=t[1],r}}();let Fdt=class{constructor(e,r,i,n){const s=e.targetGeometry,o=r.targetGeometry;n?typeof n=="string"&&(n=Xht(n)||Bd.ease):n=Bd.ease,this.easing=n,this.duration=i,this.sCenterX=s.x,this.sCenterY=s.y,this.sScale=e.scale,this.sRotation=e.rotation,this.tCenterX=o.x,this.tCenterY=o.y,this.tScale=r.scale,this.tRotation=r.rotation,this.dCenterX=this.tCenterX-this.sCenterX,this.dCenterY=this.tCenterY-this.sCenterY,this.dScale=this.tScale-this.sScale,this.dRotation=this.tRotation-this.sRotation,this.dRotation>180?this.dRotation-=360:this.dRotation<-180&&(this.dRotation+=360)}applyRatio(e,r){const i=this.easing(r);let n,s,o,a;r>=1?(n=this.tCenterX,s=this.tCenterY,o=this.tRotation,a=this.tScale):(n=this.sCenterX+i*this.dCenterX,s=this.sCenterY+i*this.dCenterY,o=this.sRotation+i*this.dRotation,a=this.sScale+i*this.dScale),e.targetGeometry.x=n,e.targetGeometry.y=s,e.scale=a,e.rotation=o}},d0=class extends be{constructor(e){super(e),this.updateFunction=null,this.animation=null,this.duration=200,this.transition=null,this.easing=Bd.ease,this.view=null,this.viewpoint=new Xn({targetGeometry:new Ue,scale:0,rotation:0}),this._updateTask=v_({postRender:this._postRender.bind(this)}),this._updateTask.pause()}destroy(){this._updateTask=$i(this._updateTask)}animate(e,r,i){this.stop();const n=this.viewpoint;_m(n,r),this.transition=new Fdt(this.viewpoint,e.target,i&&i.duration||this.duration,i&&i.easing||this.easing);const s=()=>{var o,a;this.animation===e&&this._updateTask&&(e.state==="finished"&&((o=this.transition)==null||o.applyRatio(this.viewpoint,1),(a=this.view)!=null&&a.state&&(this.view.state.viewpoint=this.viewpoint.clone())),this.animation=null,this.updateFunction=null)};return e.when(s,s),this._startTime=performance.now(),this._updateTask.resume(),this.animation=e,e}animateContinous(e,r){this.stop(),this.updateFunction=r,this.viewpoint=e;const i=new E_({target:e.clone()}),n=()=>{this.animation===i&&this._updateTask&&(this.animation=null,this.updateFunction=null)};return i.when(n,n),this._startTime=performance.now(),this._updateTask.resume(),this.animation=i,i}stop(){this.animation&&(this.animation.stop(),this.animation=null,this.updateFunction=null)}_postRender(e){var i,n;const r=this.animation;if(r&&r.state!==E_.State.STOPPED){if(this.updateFunction)this.updateFunction(this.viewpoint,e.deltaTime);else{const s=this.transition,o=(performance.now()-this._startTime)/s.duration,a=o>=1;s.applyRatio(this.viewpoint,o),a&&((i=this.animation)==null||i.finish())}(n=this.view)!=null&&n.state&&(this.view.state.viewpoint=this.viewpoint.clone())}else this._updateTask.pause()}};u([d()],d0.prototype,"animation",void 0),u([d()],d0.prototype,"duration",void 0),u([d()],d0.prototype,"transition",void 0),u([d()],d0.prototype,"easing",void 0),u([d()],d0.prototype,"view",void 0),u([d()],d0.prototype,"viewpoint",void 0),d0=u([$("esri.views.2d.AnimationManager")],d0);const kdt=d0;let Udt=class{constructor(e){this.view=e,this._stationaryHandle=null,this._frameTaskHandle=null,this._updateParameters=null,this._updateRequested=!1,this.stationary=!0,this.animationInProgress=!1,this.prepare=()=>{this._updateParameters&&(this._updateParameters.state=this.view.state,this._updateParameters.stationary=this.view.stationary,this._updateParameters.pixelRatio=window.devicePixelRatio,this._updateParameters.renderingOptions=this.view.renderingOptions)},this.update=()=>{var a;this._updateRequested=!1;const{basemapView:r,graphicsView:i,labelManager:n,layerViews:s,state:{id:o}}=this.view;r==null||r.baseLayerViews.forEach(this._updateLayerView,this),s.forEach(this._updateLayerView,this),r==null||r.referenceLayerViews.forEach(this._updateLayerView,this),v(n)&&(n.lastUpdateId!==o&&(n.viewChange(),n.lastUpdateId=o),n.updateRequested&&n.processUpdate(this._updateParameters)),v(i)&&(i.lastUpdateId!==o&&(i.viewChange(),i.lastUpdateId=o),i.updateRequested&&i.processUpdate(this._updateParameters)),this.view.graphicsTileStore.setViewState(this._updateParameters.state),this.animationInProgress||this._updateRequested||((a=this._frameTaskHandle)==null||a.pause())}}destroy(){this.stop()}start(){if(this._frameTaskHandle)return;const e=this.view;this.stationary=e.stationary,this._updateParameters={state:e.state,pixelRatio:window.devicePixelRatio,stationary:this.stationary,renderingOptions:e.renderingOptions},this._stationaryHandle=ne(()=>e.stationary,r=>{this.stationary=r,this.requestFrame()}),this._frameTaskHandle=v_(this),this.requestUpdate()}stop(){var e;this._frameTaskHandle&&(this._updateRequested=!1,(e=this._stationaryHandle)==null||e.remove(),this._frameTaskHandle.remove(),this._updateParameters=this._stationaryHandle=this._frameTaskHandle=null,this.stationary=!0,this.animationInProgress=!1)}requestUpdate(){this._updateRequested||(this._updateRequested=!0,this.requestFrame())}requestFrame(){this._frameTaskHandle&&this._frameTaskHandle.resume()}_updateLayerView(e){if(!e.attached)return void this.requestUpdate();const r=this.view.state,i=e.lastUpdateId;i!=null&&(this.stationary||e.moving)||(e.moving=!0,e.moveStart()),i!==r.id&&e.viewChange(),this.stationary&&e.moving&&(e.moving=!1,e.moveEnd()),e.lastUpdateId=r.id,e.updateRequested&&e.processUpdate(this._updateParameters),"layerViews"in e&&e.layerViews.forEach(this._updateLayerView,this)}};function Fs(){return Promise.all([Q(()=>import("./webglDeps-49a4afea.js"),["assets/webglDeps-49a4afea.js","assets/ShaderCompiler-77d0dcb6.js","assets/programUtils-f035fe8a.js","assets/ProgramTemplate-1b0f517f.js"]),Q(()=>import("./mapViewDeps-107e8873.js"),["assets/mapViewDeps-107e8873.js","assets/CIMResourceManager-838fa5d5.js","assets/Rasterizer-4d37f68f.js","assets/_commonjsHelpers-2f3e7994.js","assets/cimAnalyzer-c61475d8.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/enums-4b2a86a0.js","assets/alignmentUtils-ae955d28.js","assets/definitions-3ddd14a8.js","assets/number-b10bd8f5.js","assets/Rect-ea14f53a.js","assets/rasterizingUtils-4ed124bb.js","assets/imageutils-d17d5606.js","assets/Container-11969b8c.js","assets/BufferPool-bd8fed81.js","assets/enums-b1d611e3.js","assets/WGLContainer-ac65aabf.js","assets/WGLBrushVTLSymbol-3a605920.js","assets/StyleDefinition-7d58136b.js","assets/GeometryUtils-dd03fc25.js","assets/color-9f576cea.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-1b0f517f.js","assets/MaterialKey-071ea281.js","assets/utils-862b3f6d.js","assets/heatmapTextureUtils-fcd30222.js","assets/VTLMaterialManager-92c4316f.js","assets/programUtils-f035fe8a.js","assets/MagnifierPrograms-93e2232c.js","assets/Matcher-47b5ff38.js","assets/visualVariablesUtils-f04c4def.js","assets/visualVariablesUtils-fbbca9e0.js","assets/tileUtils-c2f19f52.js","assets/TurboLine-8bc5ef2e.js","assets/ExpandedCIM-aa517771.js","assets/CircularArray-f03cccc5.js","assets/ComputedAttributeStorage-eff52a13.js","assets/arcadeTimeUtils-f06505ea.js","assets/executionError-fb3f283a.js","assets/centroid-f5daa837.js","assets/MaterialPrograms-366125b9.js","assets/GraphicsView2D-7b26e85b.js","assets/projectionSupport-d70ac199.js","assets/json-48e3ea08.js","assets/AttributeStoreView-2b8ac15d.js","assets/schemaUtils-95f69e1c.js","assets/util-dd1f0345.js","assets/GraphicsView-f9d61ea4.js","assets/GraphicContainer-7120c266.js","assets/BaseGraphicContainer-6c950b21.js","assets/FeatureContainer-987f9077.js","assets/TileContainer-a917d354.js"])])}const TM=()=>Fs().then(()=>Q(()=>import("./TileLayerView2D-29fa9e33.js"),["assets/TileLayerView2D-29fa9e33.js","assets/Rasterizer-4d37f68f.js","assets/_commonjsHelpers-2f3e7994.js","assets/cimAnalyzer-c61475d8.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/enums-4b2a86a0.js","assets/alignmentUtils-ae955d28.js","assets/definitions-3ddd14a8.js","assets/number-b10bd8f5.js","assets/Rect-ea14f53a.js","assets/rasterizingUtils-4ed124bb.js","assets/Container-11969b8c.js","assets/BufferPool-bd8fed81.js","assets/enums-b1d611e3.js","assets/WGLContainer-ac65aabf.js","assets/WGLBrushVTLSymbol-3a605920.js","assets/StyleDefinition-7d58136b.js","assets/GeometryUtils-dd03fc25.js","assets/color-9f576cea.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-1b0f517f.js","assets/MaterialKey-071ea281.js","assets/utils-862b3f6d.js","assets/heatmapTextureUtils-fcd30222.js","assets/MagnifierPrograms-93e2232c.js","assets/imageutils-d17d5606.js","assets/Matcher-47b5ff38.js","assets/visualVariablesUtils-f04c4def.js","assets/visualVariablesUtils-fbbca9e0.js","assets/tileUtils-c2f19f52.js","assets/TurboLine-8bc5ef2e.js","assets/ExpandedCIM-aa517771.js","assets/CircularArray-f03cccc5.js","assets/ComputedAttributeStorage-eff52a13.js","assets/arcadeTimeUtils-f06505ea.js","assets/executionError-fb3f283a.js","assets/centroid-f5daa837.js","assets/GraphicsView2D-7b26e85b.js","assets/projectionSupport-d70ac199.js","assets/json-48e3ea08.js","assets/AttributeStoreView-2b8ac15d.js","assets/schemaUtils-95f69e1c.js","assets/util-dd1f0345.js","assets/GraphicsView-f9d61ea4.js","assets/imageUtils-7720d2d7.js","assets/BitmapTileContainer-4a4dbc42.js","assets/Bitmap-d328c993.js","assets/TileContainer-a917d354.js","assets/LayerView2D-f3ecbecf.js","assets/HighlightGraphicContainer-a039a0d2.js","assets/BaseGraphicContainer-6c950b21.js","assets/FeatureContainer-987f9077.js","assets/LayerView-1b945bf7.js","assets/RefreshableLayerView-23b69a26.js","assets/MapServiceLayerViewHelper-785c535e.js","assets/floorFilterUtils-080a7cd2.js","assets/sublayerUtils-a72692c8.js","assets/popupUtils-d91ea519.js","assets/drapedUtils-39abcefe.js"])),nE=()=>Fs().then(()=>Q(()=>import("./FeatureLayerView2D-83634c65.js"),["assets/FeatureLayerView2D-83634c65.js","assets/Container-11969b8c.js","assets/definitions-3ddd14a8.js","assets/LayerView2D-f3ecbecf.js","assets/schemaUtils-95f69e1c.js","assets/enums-b1d611e3.js","assets/color-9f576cea.js","assets/enums-4b2a86a0.js","assets/number-b10bd8f5.js","assets/utils-862b3f6d.js","assets/MaterialKey-071ea281.js","assets/alignmentUtils-ae955d28.js","assets/visualVariablesUtils-fbbca9e0.js","assets/cimAnalyzer-c61475d8.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/Rect-ea14f53a.js","assets/ExpandedCIM-aa517771.js","assets/util-dd1f0345.js","assets/FeatureLayerView-c926a694.js","assets/floorFilterUtils-080a7cd2.js","assets/popupUtils-d91ea519.js","assets/LayerView-1b945bf7.js","assets/RefreshableLayerView-23b69a26.js"])),ige={"base-dynamic":()=>Fs().then(()=>Q(()=>import("./BaseDynamicLayerView2D-149067b9.js"),["assets/BaseDynamicLayerView2D-149067b9.js","assets/BitmapContainer-16b267ea.js","assets/WGLContainer-ac65aabf.js","assets/definitions-3ddd14a8.js","assets/WGLBrushVTLSymbol-3a605920.js","assets/enums-b1d611e3.js","assets/number-b10bd8f5.js","assets/StyleDefinition-7d58136b.js","assets/enums-4b2a86a0.js","assets/GeometryUtils-dd03fc25.js","assets/color-9f576cea.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-1b0f517f.js","assets/MaterialKey-071ea281.js","assets/alignmentUtils-ae955d28.js","assets/utils-862b3f6d.js","assets/heatmapTextureUtils-fcd30222.js","assets/Container-11969b8c.js","assets/LayerView2D-f3ecbecf.js","assets/ExportStrategy-ef297d20.js","assets/Bitmap-d328c993.js","assets/LayerView-1b945bf7.js","assets/RefreshableLayerView-23b69a26.js"])),"base-tile":TM,"bing-maps":TM,csv:nE,"geo-rss":()=>Fs().then(()=>Q(()=>import("./GeoRSSLayerView2D-760b9cad.js"),["assets/GeoRSSLayerView2D-760b9cad.js","assets/LayerView2D-f3ecbecf.js","assets/Container-11969b8c.js","assets/definitions-3ddd14a8.js","assets/GraphicContainer-7120c266.js","assets/enums-b1d611e3.js","assets/BaseGraphicContainer-6c950b21.js","assets/FeatureContainer-987f9077.js","assets/AttributeStoreView-2b8ac15d.js","assets/visualVariablesUtils-f04c4def.js","assets/color-9f576cea.js","assets/enums-4b2a86a0.js","assets/number-b10bd8f5.js","assets/visualVariablesUtils-fbbca9e0.js","assets/TileContainer-a917d354.js","assets/WGLContainer-ac65aabf.js","assets/WGLBrushVTLSymbol-3a605920.js","assets/StyleDefinition-7d58136b.js","assets/GeometryUtils-dd03fc25.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-1b0f517f.js","assets/MaterialKey-071ea281.js","assets/alignmentUtils-ae955d28.js","assets/utils-862b3f6d.js","assets/heatmapTextureUtils-fcd30222.js","assets/GraphicsView2D-7b26e85b.js","assets/cimAnalyzer-c61475d8.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/Rect-ea14f53a.js","assets/projectionSupport-d70ac199.js","assets/json-48e3ea08.js","assets/Matcher-47b5ff38.js","assets/tileUtils-c2f19f52.js","assets/TurboLine-8bc5ef2e.js","assets/ExpandedCIM-aa517771.js","assets/schemaUtils-95f69e1c.js","assets/util-dd1f0345.js","assets/ComputedAttributeStorage-eff52a13.js","assets/arcadeTimeUtils-f06505ea.js","assets/executionError-fb3f283a.js","assets/centroid-f5daa837.js","assets/GraphicsView-f9d61ea4.js","assets/LayerView-1b945bf7.js"])),feature:nE,geojson:nE,graphics:()=>Fs().then(()=>Q(()=>import("./GraphicsLayerView2D-b974fcce.js"),["assets/GraphicsLayerView2D-b974fcce.js","assets/LayerView2D-f3ecbecf.js","assets/Container-11969b8c.js","assets/definitions-3ddd14a8.js","assets/GraphicContainer-7120c266.js","assets/enums-b1d611e3.js","assets/BaseGraphicContainer-6c950b21.js","assets/FeatureContainer-987f9077.js","assets/AttributeStoreView-2b8ac15d.js","assets/visualVariablesUtils-f04c4def.js","assets/color-9f576cea.js","assets/enums-4b2a86a0.js","assets/number-b10bd8f5.js","assets/visualVariablesUtils-fbbca9e0.js","assets/TileContainer-a917d354.js","assets/WGLContainer-ac65aabf.js","assets/WGLBrushVTLSymbol-3a605920.js","assets/StyleDefinition-7d58136b.js","assets/GeometryUtils-dd03fc25.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-1b0f517f.js","assets/MaterialKey-071ea281.js","assets/alignmentUtils-ae955d28.js","assets/utils-862b3f6d.js","assets/heatmapTextureUtils-fcd30222.js","assets/GraphicsView2D-7b26e85b.js","assets/cimAnalyzer-c61475d8.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/Rect-ea14f53a.js","assets/projectionSupport-d70ac199.js","assets/json-48e3ea08.js","assets/Matcher-47b5ff38.js","assets/tileUtils-c2f19f52.js","assets/TurboLine-8bc5ef2e.js","assets/ExpandedCIM-aa517771.js","assets/schemaUtils-95f69e1c.js","assets/util-dd1f0345.js","assets/ComputedAttributeStorage-eff52a13.js","assets/arcadeTimeUtils-f06505ea.js","assets/executionError-fb3f283a.js","assets/centroid-f5daa837.js","assets/GraphicsView-f9d61ea4.js","assets/LayerView-1b945bf7.js"])),group:()=>Fs().then(()=>Q(()=>import("./GroupLayerView2D-5a3fb7c5.js"),["assets/GroupLayerView2D-5a3fb7c5.js","assets/GroupContainer-2e6498c9.js","assets/WGLContainer-ac65aabf.js","assets/definitions-3ddd14a8.js","assets/WGLBrushVTLSymbol-3a605920.js","assets/enums-b1d611e3.js","assets/number-b10bd8f5.js","assets/StyleDefinition-7d58136b.js","assets/enums-4b2a86a0.js","assets/GeometryUtils-dd03fc25.js","assets/color-9f576cea.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-1b0f517f.js","assets/MaterialKey-071ea281.js","assets/alignmentUtils-ae955d28.js","assets/utils-862b3f6d.js","assets/heatmapTextureUtils-fcd30222.js","assets/Container-11969b8c.js","assets/LayerView2D-f3ecbecf.js","assets/GroupLayerView-e7f6bd66.js","assets/LayerView-1b945bf7.js"])),imagery:()=>Fs().then(()=>Q(()=>import("./ImageryLayerView2D-6d643040.js"),["assets/ImageryLayerView2D-6d643040.js","assets/RasterVFDisplayObject-27e98535.js","assets/dataUtils-b1b85b0c.js","assets/WGLBrushVTLSymbol-3a605920.js","assets/definitions-3ddd14a8.js","assets/enums-b1d611e3.js","assets/number-b10bd8f5.js","assets/StyleDefinition-7d58136b.js","assets/enums-4b2a86a0.js","assets/GeometryUtils-dd03fc25.js","assets/WGLContainer-ac65aabf.js","assets/color-9f576cea.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-1b0f517f.js","assets/MaterialKey-071ea281.js","assets/alignmentUtils-ae955d28.js","assets/utils-862b3f6d.js","assets/heatmapTextureUtils-fcd30222.js","assets/Container-11969b8c.js","assets/LayerView2D-f3ecbecf.js","assets/GraphicsView2D-7b26e85b.js","assets/cimAnalyzer-c61475d8.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/Rect-ea14f53a.js","assets/projectionSupport-d70ac199.js","assets/json-48e3ea08.js","assets/AttributeStoreView-2b8ac15d.js","assets/visualVariablesUtils-f04c4def.js","assets/visualVariablesUtils-fbbca9e0.js","assets/Matcher-47b5ff38.js","assets/tileUtils-c2f19f52.js","assets/TurboLine-8bc5ef2e.js","assets/ExpandedCIM-aa517771.js","assets/schemaUtils-95f69e1c.js","assets/util-dd1f0345.js","assets/ComputedAttributeStorage-eff52a13.js","assets/arcadeTimeUtils-f06505ea.js","assets/executionError-fb3f283a.js","assets/centroid-f5daa837.js","assets/GraphicsView-f9d61ea4.js","assets/HighlightGraphicContainer-a039a0d2.js","assets/BaseGraphicContainer-6c950b21.js","assets/FeatureContainer-987f9077.js","assets/TileContainer-a917d354.js","assets/BitmapContainer-16b267ea.js","assets/Bitmap-d328c993.js","assets/ExportStrategy-ef297d20.js","assets/rasterProjectionHelper-a7c6d8c6.js","assets/ImageryLayerView-79203e72.js","assets/popupUtils-d91ea519.js","assets/LayerView-1b945bf7.js","assets/RefreshableLayerView-23b69a26.js"])),"imagery-tile":()=>Fs().then(()=>Q(()=>import("./ImageryTileLayerView2D-7b877746.js"),["assets/ImageryTileLayerView2D-7b877746.js","assets/multidimensionalUtils-b4334c20.js","assets/RasterVFDisplayObject-27e98535.js","assets/dataUtils-b1b85b0c.js","assets/WGLBrushVTLSymbol-3a605920.js","assets/definitions-3ddd14a8.js","assets/enums-b1d611e3.js","assets/number-b10bd8f5.js","assets/StyleDefinition-7d58136b.js","assets/enums-4b2a86a0.js","assets/GeometryUtils-dd03fc25.js","assets/WGLContainer-ac65aabf.js","assets/color-9f576cea.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-1b0f517f.js","assets/MaterialKey-071ea281.js","assets/alignmentUtils-ae955d28.js","assets/utils-862b3f6d.js","assets/heatmapTextureUtils-fcd30222.js","assets/Container-11969b8c.js","assets/LayerView2D-f3ecbecf.js","assets/TileContainer-a917d354.js","assets/RawBlockCache-a930a23c.js","assets/rasterProjectionHelper-a7c6d8c6.js","assets/util-dd1f0345.js","assets/ImageryTileLayerView-792902bc.js","assets/popupUtils-d91ea519.js","assets/LayerView-1b945bf7.js","assets/RefreshableLayerView-23b69a26.js"])),kml:()=>Fs().then(()=>Q(()=>import("./KMLLayerView2D-26d20a7b.js"),["assets/KMLLayerView2D-26d20a7b.js","assets/kmlUtils-ef9d603b.js","assets/Bitmap-d328c993.js","assets/BitmapContainer-16b267ea.js","assets/WGLContainer-ac65aabf.js","assets/definitions-3ddd14a8.js","assets/WGLBrushVTLSymbol-3a605920.js","assets/enums-b1d611e3.js","assets/number-b10bd8f5.js","assets/StyleDefinition-7d58136b.js","assets/enums-4b2a86a0.js","assets/GeometryUtils-dd03fc25.js","assets/color-9f576cea.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-1b0f517f.js","assets/MaterialKey-071ea281.js","assets/alignmentUtils-ae955d28.js","assets/utils-862b3f6d.js","assets/heatmapTextureUtils-fcd30222.js","assets/Container-11969b8c.js","assets/LayerView2D-f3ecbecf.js","assets/GraphicContainer-7120c266.js","assets/BaseGraphicContainer-6c950b21.js","assets/FeatureContainer-987f9077.js","assets/AttributeStoreView-2b8ac15d.js","assets/visualVariablesUtils-f04c4def.js","assets/visualVariablesUtils-fbbca9e0.js","assets/TileContainer-a917d354.js","assets/GraphicsView2D-7b26e85b.js","assets/cimAnalyzer-c61475d8.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/Rect-ea14f53a.js","assets/projectionSupport-d70ac199.js","assets/json-48e3ea08.js","assets/Matcher-47b5ff38.js","assets/tileUtils-c2f19f52.js","assets/TurboLine-8bc5ef2e.js","assets/ExpandedCIM-aa517771.js","assets/schemaUtils-95f69e1c.js","assets/util-dd1f0345.js","assets/ComputedAttributeStorage-eff52a13.js","assets/arcadeTimeUtils-f06505ea.js","assets/executionError-fb3f283a.js","assets/centroid-f5daa837.js","assets/GraphicsView-f9d61ea4.js","assets/LayerView-1b945bf7.js","assets/rasterProjectionHelper-a7c6d8c6.js","assets/MaterialPrograms-366125b9.js","assets/programUtils-f035fe8a.js"])),"knowledge-graph":()=>Fs().then(()=>Q(()=>import("./KnowledgeGraphLayerView2D-1b23ca43.js"),["assets/KnowledgeGraphLayerView2D-1b23ca43.js","assets/LayerView2D-f3ecbecf.js","assets/Container-11969b8c.js","assets/definitions-3ddd14a8.js","assets/LayerView-1b945bf7.js"])),"link-chart":()=>Fs().then(()=>Q(()=>import("./KnowledgeGraphLayerView2D-1b23ca43.js"),["assets/KnowledgeGraphLayerView2D-1b23ca43.js","assets/LayerView2D-f3ecbecf.js","assets/Container-11969b8c.js","assets/definitions-3ddd14a8.js","assets/LayerView-1b945bf7.js"])),"knowledge-graph-sublayer":nE,"map-image":()=>Fs().then(()=>Q(()=>import("./MapImageLayerView2D-1c0582cc.js"),["assets/MapImageLayerView2D-1c0582cc.js","assets/BitmapContainer-16b267ea.js","assets/WGLContainer-ac65aabf.js","assets/definitions-3ddd14a8.js","assets/WGLBrushVTLSymbol-3a605920.js","assets/enums-b1d611e3.js","assets/number-b10bd8f5.js","assets/StyleDefinition-7d58136b.js","assets/enums-4b2a86a0.js","assets/GeometryUtils-dd03fc25.js","assets/color-9f576cea.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-1b0f517f.js","assets/MaterialKey-071ea281.js","assets/alignmentUtils-ae955d28.js","assets/utils-862b3f6d.js","assets/heatmapTextureUtils-fcd30222.js","assets/Container-11969b8c.js","assets/LayerView2D-f3ecbecf.js","assets/GraphicsView2D-7b26e85b.js","assets/cimAnalyzer-c61475d8.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/Rect-ea14f53a.js","assets/projectionSupport-d70ac199.js","assets/json-48e3ea08.js","assets/AttributeStoreView-2b8ac15d.js","assets/visualVariablesUtils-f04c4def.js","assets/visualVariablesUtils-fbbca9e0.js","assets/Matcher-47b5ff38.js","assets/tileUtils-c2f19f52.js","assets/TurboLine-8bc5ef2e.js","assets/ExpandedCIM-aa517771.js","assets/schemaUtils-95f69e1c.js","assets/util-dd1f0345.js","assets/ComputedAttributeStorage-eff52a13.js","assets/arcadeTimeUtils-f06505ea.js","assets/executionError-fb3f283a.js","assets/centroid-f5daa837.js","assets/GraphicsView-f9d61ea4.js","assets/HighlightGraphicContainer-a039a0d2.js","assets/BaseGraphicContainer-6c950b21.js","assets/FeatureContainer-987f9077.js","assets/TileContainer-a917d354.js","assets/ExportStrategy-ef297d20.js","assets/Bitmap-d328c993.js","assets/LayerView-1b945bf7.js","assets/MapImageLayerView-b81db94f.js","assets/ExportImageParameters-4ae8b8e3.js","assets/floorFilterUtils-080a7cd2.js","assets/sublayerUtils-a72692c8.js","assets/RefreshableLayerView-23b69a26.js","assets/MapServiceLayerViewHelper-785c535e.js","assets/popupUtils-d91ea519.js","assets/drapedUtils-39abcefe.js"])),"map-notes":()=>Fs().then(()=>Q(()=>import("./MapNotesLayerView2D-d27a4c43.js"),["assets/MapNotesLayerView2D-d27a4c43.js","assets/Container-11969b8c.js","assets/definitions-3ddd14a8.js","assets/GroupContainer-2e6498c9.js","assets/WGLContainer-ac65aabf.js","assets/WGLBrushVTLSymbol-3a605920.js","assets/enums-b1d611e3.js","assets/number-b10bd8f5.js","assets/StyleDefinition-7d58136b.js","assets/enums-4b2a86a0.js","assets/GeometryUtils-dd03fc25.js","assets/color-9f576cea.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-1b0f517f.js","assets/MaterialKey-071ea281.js","assets/alignmentUtils-ae955d28.js","assets/utils-862b3f6d.js","assets/heatmapTextureUtils-fcd30222.js","assets/LayerView2D-f3ecbecf.js","assets/GraphicContainer-7120c266.js","assets/BaseGraphicContainer-6c950b21.js","assets/FeatureContainer-987f9077.js","assets/AttributeStoreView-2b8ac15d.js","assets/visualVariablesUtils-f04c4def.js","assets/visualVariablesUtils-fbbca9e0.js","assets/TileContainer-a917d354.js","assets/GraphicsView2D-7b26e85b.js","assets/cimAnalyzer-c61475d8.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/Rect-ea14f53a.js","assets/projectionSupport-d70ac199.js","assets/json-48e3ea08.js","assets/Matcher-47b5ff38.js","assets/tileUtils-c2f19f52.js","assets/TurboLine-8bc5ef2e.js","assets/ExpandedCIM-aa517771.js","assets/schemaUtils-95f69e1c.js","assets/util-dd1f0345.js","assets/ComputedAttributeStorage-eff52a13.js","assets/arcadeTimeUtils-f06505ea.js","assets/executionError-fb3f283a.js","assets/centroid-f5daa837.js","assets/GraphicsView-f9d61ea4.js","assets/LayerView-1b945bf7.js"])),media:()=>Fs().then(()=>Q(()=>import("./MediaLayerView2D-f1cfb5c8.js"),["assets/MediaLayerView2D-f1cfb5c8.js","assets/Rasterizer-4d37f68f.js","assets/_commonjsHelpers-2f3e7994.js","assets/cimAnalyzer-c61475d8.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/enums-4b2a86a0.js","assets/alignmentUtils-ae955d28.js","assets/definitions-3ddd14a8.js","assets/number-b10bd8f5.js","assets/Rect-ea14f53a.js","assets/rasterizingUtils-4ed124bb.js","assets/Container-11969b8c.js","assets/BufferPool-bd8fed81.js","assets/enums-b1d611e3.js","assets/WGLContainer-ac65aabf.js","assets/WGLBrushVTLSymbol-3a605920.js","assets/StyleDefinition-7d58136b.js","assets/GeometryUtils-dd03fc25.js","assets/color-9f576cea.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-1b0f517f.js","assets/MaterialKey-071ea281.js","assets/utils-862b3f6d.js","assets/heatmapTextureUtils-fcd30222.js","assets/MagnifierPrograms-93e2232c.js","assets/imageutils-d17d5606.js","assets/Matcher-47b5ff38.js","assets/visualVariablesUtils-f04c4def.js","assets/visualVariablesUtils-fbbca9e0.js","assets/tileUtils-c2f19f52.js","assets/TurboLine-8bc5ef2e.js","assets/ExpandedCIM-aa517771.js","assets/CircularArray-f03cccc5.js","assets/ComputedAttributeStorage-eff52a13.js","assets/arcadeTimeUtils-f06505ea.js","assets/executionError-fb3f283a.js","assets/centroid-f5daa837.js","assets/GraphicsView2D-7b26e85b.js","assets/projectionSupport-d70ac199.js","assets/json-48e3ea08.js","assets/AttributeStoreView-2b8ac15d.js","assets/schemaUtils-95f69e1c.js","assets/util-dd1f0345.js","assets/GraphicsView-f9d61ea4.js","assets/LayerView2D-f3ecbecf.js","assets/LayerView-1b945bf7.js"])),"ogc-feature":()=>Fs().then(()=>Q(()=>import("./OGCFeatureLayerView2D-192f9bd8.js"),["assets/OGCFeatureLayerView2D-192f9bd8.js","assets/FeatureLayerView2D-83634c65.js","assets/Container-11969b8c.js","assets/definitions-3ddd14a8.js","assets/LayerView2D-f3ecbecf.js","assets/schemaUtils-95f69e1c.js","assets/enums-b1d611e3.js","assets/color-9f576cea.js","assets/enums-4b2a86a0.js","assets/number-b10bd8f5.js","assets/utils-862b3f6d.js","assets/MaterialKey-071ea281.js","assets/alignmentUtils-ae955d28.js","assets/visualVariablesUtils-fbbca9e0.js","assets/cimAnalyzer-c61475d8.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/Rect-ea14f53a.js","assets/ExpandedCIM-aa517771.js","assets/util-dd1f0345.js","assets/FeatureLayerView-c926a694.js","assets/floorFilterUtils-080a7cd2.js","assets/popupUtils-d91ea519.js","assets/LayerView-1b945bf7.js","assets/RefreshableLayerView-23b69a26.js","assets/OGCFeatureLayerView-67cb867e.js"])),"open-street-map":TM,"oriented-imagery":nE,route:()=>Fs().then(()=>Q(()=>import("./RouteLayerView2D-77cc22db.js"),["assets/RouteLayerView2D-77cc22db.js","assets/Stop-1a1fc92e.js","assets/LayerView2D-f3ecbecf.js","assets/Container-11969b8c.js","assets/definitions-3ddd14a8.js","assets/GraphicContainer-7120c266.js","assets/enums-b1d611e3.js","assets/BaseGraphicContainer-6c950b21.js","assets/FeatureContainer-987f9077.js","assets/AttributeStoreView-2b8ac15d.js","assets/visualVariablesUtils-f04c4def.js","assets/color-9f576cea.js","assets/enums-4b2a86a0.js","assets/number-b10bd8f5.js","assets/visualVariablesUtils-fbbca9e0.js","assets/TileContainer-a917d354.js","assets/WGLContainer-ac65aabf.js","assets/WGLBrushVTLSymbol-3a605920.js","assets/StyleDefinition-7d58136b.js","assets/GeometryUtils-dd03fc25.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-1b0f517f.js","assets/MaterialKey-071ea281.js","assets/alignmentUtils-ae955d28.js","assets/utils-862b3f6d.js","assets/heatmapTextureUtils-fcd30222.js","assets/GraphicsView2D-7b26e85b.js","assets/cimAnalyzer-c61475d8.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/Rect-ea14f53a.js","assets/projectionSupport-d70ac199.js","assets/json-48e3ea08.js","assets/Matcher-47b5ff38.js","assets/tileUtils-c2f19f52.js","assets/TurboLine-8bc5ef2e.js","assets/ExpandedCIM-aa517771.js","assets/schemaUtils-95f69e1c.js","assets/util-dd1f0345.js","assets/ComputedAttributeStorage-eff52a13.js","assets/arcadeTimeUtils-f06505ea.js","assets/executionError-fb3f283a.js","assets/centroid-f5daa837.js","assets/GraphicsView-f9d61ea4.js","assets/LayerView-1b945bf7.js"])),stream:()=>Fs().then(()=>Q(()=>import("./StreamLayerView2D-2cfaea00.js"),["assets/StreamLayerView2D-2cfaea00.js","assets/FeatureLayerView2D-83634c65.js","assets/Container-11969b8c.js","assets/definitions-3ddd14a8.js","assets/LayerView2D-f3ecbecf.js","assets/schemaUtils-95f69e1c.js","assets/enums-b1d611e3.js","assets/color-9f576cea.js","assets/enums-4b2a86a0.js","assets/number-b10bd8f5.js","assets/utils-862b3f6d.js","assets/MaterialKey-071ea281.js","assets/alignmentUtils-ae955d28.js","assets/visualVariablesUtils-fbbca9e0.js","assets/cimAnalyzer-c61475d8.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/Rect-ea14f53a.js","assets/ExpandedCIM-aa517771.js","assets/util-dd1f0345.js","assets/FeatureLayerView-c926a694.js","assets/floorFilterUtils-080a7cd2.js","assets/popupUtils-d91ea519.js","assets/LayerView-1b945bf7.js","assets/RefreshableLayerView-23b69a26.js"])),"subtype-group":()=>Fs().then(()=>Q(()=>import("./SubtypeGroupLayerView2D-d840b84b.js"),["assets/SubtypeGroupLayerView2D-d840b84b.js","assets/FeatureLayerView2D-83634c65.js","assets/Container-11969b8c.js","assets/definitions-3ddd14a8.js","assets/LayerView2D-f3ecbecf.js","assets/schemaUtils-95f69e1c.js","assets/enums-b1d611e3.js","assets/color-9f576cea.js","assets/enums-4b2a86a0.js","assets/number-b10bd8f5.js","assets/utils-862b3f6d.js","assets/MaterialKey-071ea281.js","assets/alignmentUtils-ae955d28.js","assets/visualVariablesUtils-fbbca9e0.js","assets/cimAnalyzer-c61475d8.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/Rect-ea14f53a.js","assets/ExpandedCIM-aa517771.js","assets/util-dd1f0345.js","assets/FeatureLayerView-c926a694.js","assets/floorFilterUtils-080a7cd2.js","assets/popupUtils-d91ea519.js","assets/LayerView-1b945bf7.js","assets/RefreshableLayerView-23b69a26.js"])),tile:TM,"vector-tile":()=>Fs().then(()=>Q(()=>import("./VectorTileLayerView2D-ef003849.js"),["assets/VectorTileLayerView2D-ef003849.js","assets/TileInfoViewPOT-a79f521b.js","assets/Rect-ea14f53a.js","assets/rasterizingUtils-4ed124bb.js","assets/StyleDefinition-7d58136b.js","assets/enums-4b2a86a0.js","assets/enums-b1d611e3.js","assets/TileContainer-a917d354.js","assets/WGLContainer-ac65aabf.js","assets/definitions-3ddd14a8.js","assets/WGLBrushVTLSymbol-3a605920.js","assets/number-b10bd8f5.js","assets/GeometryUtils-dd03fc25.js","assets/color-9f576cea.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-1b0f517f.js","assets/MaterialKey-071ea281.js","assets/alignmentUtils-ae955d28.js","assets/utils-862b3f6d.js","assets/heatmapTextureUtils-fcd30222.js","assets/Container-11969b8c.js","assets/StyleRepository-f0609e85.js","assets/colorUtils-c0f43caf.js","assets/GeometryUtils-53652037.js","assets/LayerView2D-f3ecbecf.js","assets/LayerView-1b945bf7.js"])),wcs:()=>Fs().then(()=>Q(()=>import("./ImageryTileLayerView2D-7b877746.js"),["assets/ImageryTileLayerView2D-7b877746.js","assets/multidimensionalUtils-b4334c20.js","assets/RasterVFDisplayObject-27e98535.js","assets/dataUtils-b1b85b0c.js","assets/WGLBrushVTLSymbol-3a605920.js","assets/definitions-3ddd14a8.js","assets/enums-b1d611e3.js","assets/number-b10bd8f5.js","assets/StyleDefinition-7d58136b.js","assets/enums-4b2a86a0.js","assets/GeometryUtils-dd03fc25.js","assets/WGLContainer-ac65aabf.js","assets/color-9f576cea.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-1b0f517f.js","assets/MaterialKey-071ea281.js","assets/alignmentUtils-ae955d28.js","assets/utils-862b3f6d.js","assets/heatmapTextureUtils-fcd30222.js","assets/Container-11969b8c.js","assets/LayerView2D-f3ecbecf.js","assets/TileContainer-a917d354.js","assets/RawBlockCache-a930a23c.js","assets/rasterProjectionHelper-a7c6d8c6.js","assets/util-dd1f0345.js","assets/ImageryTileLayerView-792902bc.js","assets/popupUtils-d91ea519.js","assets/LayerView-1b945bf7.js","assets/RefreshableLayerView-23b69a26.js"])),"web-tile":TM,wfs:nE,wms:()=>Fs().then(()=>Q(()=>import("./WMSLayerView2D-8a85873c.js"),["assets/WMSLayerView2D-8a85873c.js","assets/BitmapContainer-16b267ea.js","assets/WGLContainer-ac65aabf.js","assets/definitions-3ddd14a8.js","assets/WGLBrushVTLSymbol-3a605920.js","assets/enums-b1d611e3.js","assets/number-b10bd8f5.js","assets/StyleDefinition-7d58136b.js","assets/enums-4b2a86a0.js","assets/GeometryUtils-dd03fc25.js","assets/color-9f576cea.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-1b0f517f.js","assets/MaterialKey-071ea281.js","assets/alignmentUtils-ae955d28.js","assets/utils-862b3f6d.js","assets/heatmapTextureUtils-fcd30222.js","assets/Container-11969b8c.js","assets/LayerView2D-f3ecbecf.js","assets/ExportStrategy-ef297d20.js","assets/Bitmap-d328c993.js","assets/LayerView-1b945bf7.js","assets/RefreshableLayerView-23b69a26.js","assets/WMSLayerView-7ddfaa94.js","assets/ExportWMSImageParameters-2508fffe.js"])),wmts:()=>Fs().then(()=>Q(()=>import("./WMTSLayerView2D-129e2191.js"),["assets/WMTSLayerView2D-129e2191.js","assets/imageUtils-7720d2d7.js","assets/BitmapTileContainer-4a4dbc42.js","assets/Bitmap-d328c993.js","assets/WGLContainer-ac65aabf.js","assets/definitions-3ddd14a8.js","assets/WGLBrushVTLSymbol-3a605920.js","assets/enums-b1d611e3.js","assets/number-b10bd8f5.js","assets/StyleDefinition-7d58136b.js","assets/enums-4b2a86a0.js","assets/GeometryUtils-dd03fc25.js","assets/color-9f576cea.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-1b0f517f.js","assets/MaterialKey-071ea281.js","assets/alignmentUtils-ae955d28.js","assets/utils-862b3f6d.js","assets/heatmapTextureUtils-fcd30222.js","assets/Container-11969b8c.js","assets/TileContainer-a917d354.js","assets/LayerView2D-f3ecbecf.js","assets/LayerView-1b945bf7.js","assets/RefreshableLayerView-23b69a26.js"])),"line-of-sight":null,"base-elevation":null,"building-scene":null,dimension:null,elevation:null,"integrated-mesh":null,"point-cloud":null,voxel:null,scene:null,unknown:null,unsupported:null};function zdt(t){const e=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",r=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new H(`${r}:view-not-supported`,`${e} is not supported in 2D`)}const nge={hasLayerViewModule:t=>v(ige[t.type]),importLayerView:t=>{const e=ige[t.type];if(R(e))throw zdt(t);return e(t)}};function Vdt(t,e){const{spatialReference:r}=e,i=[e.x,e.y];let n=Number.POSITIVE_INFINITY,s=0,o=0;const a=[0,0],l=t.type==="extent"?[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]:t.rings;for(const c of l)for(let h=0;h<c.length-1;h++){DGe(a,i,c,h);const p=uy(i,a);p<n&&(n=p,s=a[0],o=a[1])}return{coordinate:new Ue({x:s,y:o,spatialReference:r}),distance:n}}var mQ;let YT=mQ=class extends L9(be){constructor(t){super(t),this.geometry=null,this.spatialReference=null}get normalizedGeometry(){if(R(this.geometry)||!this.spatialReference)return null;if(!this.spatialReference.equals(this.geometry.spatialReference))try{return ym(this.geometry,this.spatialReference)}catch(t){return re.getLogger(this.declaredClass).error("#constraints.geometry","could not project the geometry to the view's spatial reference",{geometry:this.geometry,spatialReference:this.spatialReference,error:t}),null}return this.geometry}constrain(t,e){if(R(this.normalizedGeometry))return t;const r=t.targetGeometry;if(this.normalizedGeometry.type==="extent"?R9(this.normalizedGeometry,r):V2e(this.normalizedGeometry,r))return t;const{coordinate:i}=Vdt(this.normalizedGeometry,r);return i&&(t.targetGeometry=i),t}clone(){var t,e;return new mQ({geometry:(t=this.geometry)==null?void 0:t.clone(),spatialReference:(e=this.spatialReference)==null?void 0:e.clone()})}};u([d({constructOnly:!0})],YT.prototype,"geometry",void 0),u([d({readOnly:!0})],YT.prototype,"normalizedGeometry",null),u([d({constructOnly:!0})],YT.prototype,"spatialReference",void 0),YT=mQ=u([$("esri.views.2d.constraints.GeometryConstraint")],YT);var gQ;let pI=gQ=class extends L9(be){constructor(){super(...arguments),this.enabled=!0,this.rotationEnabled=!0}constrain(t,e){return this.enabled&&e&&(this.rotationEnabled||(t.rotation=e.rotation)),t}clone(){return new gQ({enabled:this.enabled,rotationEnabled:this.rotationEnabled})}};u([d()],pI.prototype,"enabled",void 0),u([d()],pI.prototype,"rotationEnabled",void 0),pI=gQ=u([$("esri.views.2d.constraints.RotationConstraint")],pI);const YIe=pI;var yQ;let pu=yQ=class extends L9(be){constructor(t){super(t),this._lodByScale={},this._scales=[],this.effectiveLODs=null,this.effectiveMinZoom=-1,this.effectiveMaxZoom=-1,this.effectiveMinScale=0,this.effectiveMaxScale=0,this.lods=null,this.minZoom=-1,this.maxZoom=-1,this.minScale=0,this.maxScale=0,this.snapToZoom=!0}initialize(){let t,{lods:e,minScale:r,maxScale:i,minZoom:n,maxZoom:s}=this,o=-1,a=-1,l=!1,c=!1;if(r!==0&&i!==0&&r<i&&([r,i]=[i,r]),!e||!e.length)return this._set("effectiveMinScale",r),void this._set("effectiveMaxScale",i);e=e.map(h=>h.clone()),e.sort((h,p)=>p.scale-h.scale),e.forEach((h,p)=>h.level=p);for(const h of e)!l&&r>0&&r>=h.scale&&(o=h.level,l=!0),!c&&i>0&&i>=h.scale&&(a=t?t.level:-1,c=!0),t=h;n===-1&&(n=r===0?0:o),s===-1&&(s=i===0?e.length-1:a),n=Math.max(n,0),n=Math.min(n,e.length-1),s=Math.max(s,0),s=Math.min(s,e.length-1),n>s&&([n,s]=[s,n]),r=e[n].scale,i=e[s].scale,e.splice(0,n),e.splice(s-n+1,e.length),e.forEach((h,p)=>{this._lodByScale[h.scale]=h,this._scales[p]=h.scale}),this._set("effectiveLODs",e),this._set("effectiveMinZoom",n),this._set("effectiveMaxZoom",s),this._set("effectiveMinScale",r),this._set("effectiveMaxScale",i)}constrain(t,e){if(e&&t.scale===e.scale)return t;const r=this.effectiveMinScale,i=this.effectiveMaxScale,n=t.targetGeometry,s=e&&e.targetGeometry,o=i!==0&&t.scale<i,a=r!==0&&t.scale>r;if(o||a){const l=a?r:i;if(e&&s){const c=(l-e.scale)/(t.scale-e.scale);n.x=s.x+(n.x-s.x)*c,n.y=s.y+(n.y-s.y)*c}t.scale=l}return this.snapToZoom&&this.effectiveLODs&&(t.scale=this._getClosestScale(t.scale)),t}fit(t){if(!this.effectiveLODs||!this.snapToZoom)return this.constrain(t,null);const e=this.scaleToZoom(t.scale),r=Math.abs(e-Math.floor(e));return t.scale=this.zoomToScale(r>.99?Math.round(e):Math.floor(e)),t}zoomToScale(t){if(!this.effectiveLODs)return 0;t-=this.effectiveMinZoom,t=Math.max(0,t);const e=this._scales;if(t<=0)return e[0];if(t>=e.length)return e[e.length-1];const r=Math.round(t-.5),i=Math.round(t);return e[i]+(i-t)*(e[r]-e[i])}scaleToZoom(t){if(!this.effectiveLODs)return-1;const e=this._scales;let r,i;if(t>=e[0])return this.effectiveMinZoom;if(t<=e[e.length-1])return this.effectiveMaxZoom;for(let n=0;n<e.length-1;n++){if(r=e[n],i=e[n+1],i===t)return n+this.effectiveMinZoom+1;if(r>t&&i<t)return n+this.effectiveMinZoom+1-(t-i)/(r-i)}return-1}snapToClosestScale(t){if(!this.effectiveLODs)return t;const e=this.scaleToZoom(t);return this.zoomToScale(Math.round(e))}snapToNextScale(t,e=.5){if(!this.effectiveLODs)return t*e;const r=Math.round(this.scaleToZoom(t));return this.zoomToScale(r+1)}snapToPreviousScale(t,e=2){if(!this.effectiveLODs)return t*e;const r=Math.round(this.scaleToZoom(t));return this.zoomToScale(r-1)}clone(){return new yQ({lods:this.lods,minZoom:this.minZoom,maxZoom:this.maxZoom,minScale:this.minScale,maxScale:this.maxScale})}_getClosestScale(t){return this._lodByScale[t]||(t=this._scales.reduce((e,r)=>Math.abs(r-t)<=Math.abs(e-t)?r:e,this._scales[0])),this._lodByScale[t].scale}};u([d({readOnly:!0})],pu.prototype,"effectiveLODs",void 0),u([d({readOnly:!0})],pu.prototype,"effectiveMinZoom",void 0),u([d({readOnly:!0})],pu.prototype,"effectiveMaxZoom",void 0),u([d({readOnly:!0})],pu.prototype,"effectiveMinScale",void 0),u([d({readOnly:!0})],pu.prototype,"effectiveMaxScale",void 0),u([d()],pu.prototype,"lods",void 0),u([d()],pu.prototype,"minZoom",void 0),u([d()],pu.prototype,"maxZoom",void 0),u([d()],pu.prototype,"minScale",void 0),u([d()],pu.prototype,"maxScale",void 0),u([d()],pu.prototype,"snapToZoom",void 0),pu=yQ=u([$("esri.views.2d.constraints.ZoomConstraint")],pu);const ZIe=pu,Bdt={base:null,key:"type",typeMap:{extent:ur,polygon:Jl}};let Is=class extends be{constructor(e){super(e),this.lods=null,this.minScale=0,this.maxScale=0,this.minZoom=-1,this.maxZoom=-1,this.rotationEnabled=!0,this.snapToZoom=!0}destroy(){this.view=null}get effectiveLODs(){return this._zoom.effectiveLODs}get effectiveMinScale(){return this._zoom.effectiveMinScale}get effectiveMaxScale(){return this._zoom.effectiveMaxScale}get effectiveMinZoom(){return this._zoom.effectiveMinZoom}get effectiveMaxZoom(){return this._zoom.effectiveMaxZoom}set geometry(e){e?this._set("geometry",e):this._set("geometry",null)}get version(){var e,r,i;return`${(e=this._zoom)==null?void 0:e.uid}/${(r=this._rotation)==null?void 0:r.uid}/${(i=this._geometry)==null?void 0:i.uid}`}get _defaultLODs(){var i,n,s;const e=(n=(i=this.view)==null?void 0:i.defaultsFromMap)==null?void 0:n.tileInfo,r=(s=this.view)==null?void 0:s.spatialReference;return e&&r&&e.spatialReference.equals(r)?e.lods:null}get _geometry(){var e;return new YT({geometry:this.geometry,spatialReference:(e=this.view)==null?void 0:e.spatialReference})}get _rotation(){return new YIe({rotationEnabled:this.rotationEnabled})}get _zoom(){const e=this._get("_zoom"),r=this.lods||this._defaultLODs,i=this.minZoom,n=this.maxZoom,s=this.minScale,o=this.maxScale,a=this.snapToZoom;return e&&e.lods===r&&e.minZoom===i&&e.maxZoom===n&&e.minScale===s&&e.maxScale===o&&e.snapToZoom===a?e:new ZIe({lods:r,minZoom:i,maxZoom:n,minScale:s,maxScale:o,snapToZoom:a})}canZoomInTo(e){const r=this.effectiveMaxScale;return r===0||e>=r}canZoomOutTo(e){const r=this.effectiveMinScale;return r===0||e<=r}constrain(e,r){return this._zoom.constrain(e,r),this._rotation.constrain(e,r),this._geometry.constrain(e,r),e}constrainByGeometry(e){return this._geometry.constrain(e)}fit(e){return this._zoom.fit(e)}zoomToScale(e){return this._zoom.zoomToScale(e)}scaleToZoom(e){return this._zoom.scaleToZoom(e)}snapScale(e){return this._zoom.snapToClosestScale(e)}snapToNextScale(e){return this._zoom.snapToNextScale(e)}snapToPreviousScale(e){return this._zoom.snapToPreviousScale(e)}};u([d({readOnly:!0})],Is.prototype,"effectiveLODs",null),u([d({readOnly:!0})],Is.prototype,"effectiveMinScale",null),u([d({readOnly:!0})],Is.prototype,"effectiveMaxScale",null),u([d({readOnly:!0})],Is.prototype,"effectiveMinZoom",null),u([d({readOnly:!0})],Is.prototype,"effectiveMaxZoom",null),u([d({types:Bdt,value:null})],Is.prototype,"geometry",null),u([d({type:[Kd]})],Is.prototype,"lods",void 0),u([d()],Is.prototype,"minScale",void 0),u([d()],Is.prototype,"maxScale",void 0),u([d()],Is.prototype,"minZoom",void 0),u([d()],Is.prototype,"maxZoom",void 0),u([d()],Is.prototype,"rotationEnabled",void 0),u([d()],Is.prototype,"snapToZoom",void 0),u([d()],Is.prototype,"view",void 0),u([d({readOnly:!0})],Is.prototype,"version",null),u([d()],Is.prototype,"_defaultLODs",null),u([d({type:YT})],Is.prototype,"_geometry",null),u([d({type:YIe})],Is.prototype,"_rotation",null),u([d({readOnly:!0,type:ZIe})],Is.prototype,"_zoom",null),Is=u([$("esri.views.2d.MapViewConstraints")],Is);const JIe=Is;function Op(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function jdt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function cD(t,e,r,i,n,s,o,a,l,c){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=s,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t}function Foe(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Xu(t,e){if(t===e){const r=e[1],i=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=i,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function Lw(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=h*o-a*c,f=-h*s+a*l,m=c*s-o*l;let g=r*p+i*f+n*m;return g?(g=1/g,t[0]=p*g,t[1]=(-h*i+n*c)*g,t[2]=(a*i-n*o)*g,t[3]=f*g,t[4]=(h*r-n*l)*g,t[5]=(-a*r+n*s)*g,t[6]=m*g,t[7]=(-c*r+i*l)*g,t[8]=(o*r-i*s)*g,t):null}function koe(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8];return t[0]=o*h-a*c,t[1]=n*c-i*h,t[2]=i*a-n*o,t[3]=a*l-s*h,t[4]=r*h-n*l,t[5]=n*s-r*a,t[6]=s*c-o*l,t[7]=i*l-r*c,t[8]=r*o-i*s,t}function Gdt(t){const e=t[0],r=t[1],i=t[2],n=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*(c*s-o*l)+r*(-c*n+o*a)+i*(l*n-s*a)}function lw(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],p=e[8],f=r[0],m=r[1],g=r[2],_=r[3],b=r[4],w=r[5],x=r[6],T=r[7],E=r[8];return t[0]=f*i+m*o+g*c,t[1]=f*n+m*a+g*h,t[2]=f*s+m*l+g*p,t[3]=_*i+b*o+w*c,t[4]=_*n+b*a+w*h,t[5]=_*s+b*l+w*p,t[6]=x*i+T*o+E*c,t[7]=x*n+T*a+E*h,t[8]=x*s+T*l+E*p,t}function Gz(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],p=e[8],f=r[0],m=r[1];return t[0]=i,t[1]=n,t[2]=s,t[3]=o,t[4]=a,t[5]=l,t[6]=f*i+m*o+c,t[7]=f*n+m*a+h,t[8]=f*s+m*l+p,t}function Uoe(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],p=e[8],f=Math.sin(r),m=Math.cos(r);return t[0]=m*i+f*o,t[1]=m*n+f*a,t[2]=m*s+f*l,t[3]=m*o-f*i,t[4]=m*a-f*n,t[5]=m*l-f*s,t[6]=c,t[7]=h,t[8]=p,t}function zoe(t,e,r){const i=r[0],n=r[1],s=r[2];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=s*e[6],t[7]=s*e[7],t[8]=s*e[8],t}function Hdt(t,e,r){const i=r[0],n=r[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t}function qdt(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function Wdt(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=-r,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Xdt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Ydt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function Voe(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=r+r,a=i+i,l=n+n,c=r*o,h=i*o,p=i*a,f=n*o,m=n*a,g=n*l,_=s*o,b=s*a,w=s*l;return t[0]=1-p-g,t[3]=h-w,t[6]=f+b,t[1]=h+w,t[4]=1-c-g,t[7]=m-_,t[2]=f-b,t[5]=m+_,t[8]=1-c-p,t}function KIe(t,e){const r=e[0],i=e[1],n=e[2],s=e[4],o=e[5],a=e[6],l=e[8],c=e[9],h=e[10],p=h*o-a*c,f=-h*s+a*l,m=c*s-o*l,g=r*p+i*f+n*m;if(!g)return null;const _=1/g;return t[0]=p*_,t[1]=(-h*i+n*c)*_,t[2]=(a*i-n*o)*_,t[3]=f*_,t[4]=(h*r-n*l)*_,t[5]=(-a*r+n*s)*_,t[6]=m*_,t[7]=(-c*r+i*l)*_,t[8]=(o*r-i*s)*_,t}function kO(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],m=e[11],g=e[12],_=e[13],b=e[14],w=e[15],x=r*a-i*o,T=r*l-n*o,E=r*c-s*o,C=i*l-n*a,A=i*c-s*a,I=n*c-s*l,M=h*_-p*g,D=h*b-f*g,U=h*w-m*g,z=p*b-f*_,B=p*w-m*_,ee=f*w-m*b;let te=x*ee-T*B+E*z+C*U-A*D+I*M;return te?(te=1/te,t[0]=(a*ee-l*B+c*z)*te,t[1]=(l*U-o*ee-c*D)*te,t[2]=(o*B-a*U+c*M)*te,t[3]=(n*B-i*ee-s*z)*te,t[4]=(r*ee-n*U+s*D)*te,t[5]=(i*U-r*B-s*M)*te,t[6]=(_*I-b*A+w*C)*te,t[7]=(b*E-g*I-w*T)*te,t[8]=(g*A-_*E+w*x)*te,t):null}function Zdt(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function Jdt(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function Kdt(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2)}function Qdt(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t}function QIe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}function ept(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t}function tpt(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t}function rpt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function ipt(t,e){const r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=e[0],f=e[1],m=e[2],g=e[3],_=e[4],b=e[5],w=e[6],x=e[7],T=e[8],E=yl();return Math.abs(r-p)<=E*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(i-f)<=E*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(n-m)<=E*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(s-g)<=E*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(o-_)<=E*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(a-b)<=E*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(l-w)<=E*Math.max(1,Math.abs(l),Math.abs(w))&&Math.abs(c-x)<=E*Math.max(1,Math.abs(c),Math.abs(x))&&Math.abs(h-T)<=E*Math.max(1,Math.abs(h),Math.abs(T))}function Boe(t){const e=yl(),r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8];return Math.abs(1-(r*r+s*s+l*l))<=e&&Math.abs(1-(i*i+o*o+c*c))<=e&&Math.abs(1-(n*n+a*a+h*h))<=e}const npt=lw,spt=QIe;Object.freeze(Object.defineProperty({__proto__:null,add:Qdt,adjoint:koe,copy:jdt,determinant:Gdt,equals:ipt,exactEquals:rpt,frob:Kdt,fromMat2d:Ydt,fromMat4:Op,fromQuat:Voe,fromRotation:Wdt,fromScaling:Xdt,fromTranslation:qdt,identity:Foe,invert:Lw,isOrthoNormal:Boe,mul:npt,multiply:lw,multiplyScalar:ept,multiplyScalarAndAdd:tpt,normalFromMat4:kO,normalFromMat4Legacy:KIe,projection:Zdt,rotate:Uoe,scale:zoe,scaleByVec2:Hdt,set:cD,str:Jdt,sub:spt,subtract:QIe,translate:Gz,transpose:Xu},Symbol.toStringTag,{value:"Module"}));function Bc(){const t=new Float32Array(9);return t[0]=1,t[4]=1,t[8]=1,t}function e$e(t){const e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function aU(t,e,r,i,n,s,o,a,l){const c=new Float32Array(9);return c[0]=t,c[1]=e,c[2]=r,c[3]=i,c[4]=n,c[5]=s,c[6]=o,c[7]=a,c[8]=l,c}function opt(t,e){return new Float32Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:e$e,create:Bc,createView:opt,fromValues:aU},Symbol.toStringTag,{value:"Module"}));function joe(){return new Float32Array(2)}function apt(t){const e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e}function ep(t,e){const r=new Float32Array(2);return r[0]=t,r[1]=e,r}function lpt(t,e){return new Float32Array(t,e,2)}function t$e(){return joe()}function r$e(){return ep(1,1)}function i$e(){return ep(1,0)}function n$e(){return ep(0,1)}const s$e=t$e(),o$e=r$e(),cpt=i$e(),upt=n$e();Object.freeze(Object.defineProperty({__proto__:null,ONES:o$e,UNIT_X:cpt,UNIT_Y:upt,ZEROS:s$e,clone:apt,create:joe,createView:lpt,fromValues:ep,ones:r$e,unitX:i$e,unitY:n$e,zeros:t$e},Symbol.toStringTag,{value:"Module"}));function hpt(t){return t instanceof Float32Array&&t.length>=2}function dpt(t){return Array.isArray(t)&&t.length>=2}function tH(t){return hpt(t)||dpt(t)}var _Q;const $y=[0,0];let f1=_Q=class extends fe{constructor(t){super(t),this._viewpoint2D={center:Ne(),rotation:0,scale:0,spatialReference:void 0},this.center=[0,0],this.extent=new ur,this.id=0,this.inverseTransform=Fb(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=Fb(),this.transformNoRotation=Fb(),this.displayMat3=Bc(),this.displayViewMat3=Bc(),this.viewMat3=Bc(),this.viewMat2d=ZPe(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(t){this._set("pixelRatio",t),this._update()}set size(t){this._set("size",t),this._update()}set viewpoint(t){if(t){const e=this._viewpoint2D,r=t.targetGeometry;e.center[0]=r.x,e.center[1]=r.y,e.rotation=t.rotation,e.scale=t.scale,e.spatialReference=r.spatialReference}this._update()}copy(t){const e=this.size,r=this.viewpoint;return r&&e?(this.viewpoint=_m(r,t.viewpoint),this._set("size",Qs(e,t.size))):(this.viewpoint=t.viewpoint.clone(),this._set("size",[t.size[0],t.size[1]])),this._set("pixelRatio",t.pixelRatio),this}clone(){return new _Q({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(t,e,r){return tH(e)?Ag(t,e,this.inverseTransform):($y[0]=e,$y[1]=r,Ag(t,$y,this.inverseTransform))}toScreen(t,e,r){return tH(e)?Ag(t,e,this.transform):($y[0]=e,$y[1]=r,Ag(t,$y,this.transform))}toScreenNoRotation(t,e,r){return tH(e)?Ag(t,e,this.transformNoRotation):($y[0]=e,$y[1]=r,Ag(t,$y,this.transformNoRotation))}getScreenTransform(t,e){const{center:r}=this._viewpoint2D,i=this._get("pixelRatio")||1,n=this._get("size");return Doe(t,r,n,e,0,i),t}_update(){const{center:t,spatialReference:e,scale:r,rotation:i}=this._viewpoint2D,n=this._get("pixelRatio")||1,s=this._get("size"),o=new Xn({targetGeometry:new Ue(t[0],t[1],e),scale:r,rotation:i});if(this._set("viewpoint",o),!s||!e||!r)return;this.resolution=M3(o),this.rotation=i,this.scale=r,this.spatialReference=e,Qs(this.center,t);const a=s[0]!==0?2/s[0]:0,l=s[1]!==0?-2/s[1]:0;cD(this.displayMat3,a,0,0,0,l,0,-1,1,1);const c=Foe(this.viewMat3),h=ep(s[0]/2,s[1]/2),p=ep(-s[0]/2,-s[1]/2),f=gN(i);Gz(c,c,h),Uoe(c,c,f),Gz(c,c,p),lw(this.displayViewMat3,this.displayMat3,c);const m=Roe(this.viewMat2d,h);return OB(m,m,f),oD(m,m,p),xdt(this.extent,o,s),Noe(this.transform,o,s,n),Coe(this.inverseTransform,this.transform),Odt(this.transformNoRotation,o,s,n),this.worldScreenWidth=Pdt(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};u([d({readOnly:!0})],f1.prototype,"id",void 0),u([d({value:1,json:{write:!0}})],f1.prototype,"pixelRatio",null),u([d({json:{write:!0}})],f1.prototype,"size",null),u([d()],f1.prototype,"spatialReference",void 0),u([d({type:Xn,json:{write:!0}})],f1.prototype,"viewpoint",null),f1=_Q=u([$("esri.views.2d.ViewState")],f1);const vQ=f1;var bQ,wQ;let $0=bQ=class extends be{constructor(){super(...arguments),this.left=0,this.top=0,this.right=0,this.bottom=0}clone(){return new bQ({left:this.left,top:this.top,right:this.right,bottom:this.bottom})}};u([d()],$0.prototype,"left",void 0),u([d()],$0.prototype,"top",void 0),u([d()],$0.prototype,"right",void 0),u([d()],$0.prototype,"bottom",void 0),$0=bQ=u([$("esri.views.2d.PaddedViewState.Padding")],$0);let WC=wQ=class extends vQ{constructor(...t){super(...t),this.paddedViewState=new vQ,this._updateContent=(()=>{const e=Ne();return()=>{const r=this._get("size"),i=this._get("padding");if(!r||!i)return;const n=this.paddedViewState;dt(e,i.left+i.right,i.top+i.bottom),jh(e,r,e),Qs(n.size,e);const s=n.viewpoint;s&&(this.viewpoint=s)}})(),this.addHandles(ne(()=>[this.size,this.padding],()=>this._updateContent(),Zr)),this.padding=new $0,this.size=[0,0]}set padding(t){this._set("padding",t||new $0)}set viewpoint(t){if(t){const e=t.clone();this.paddedViewState.viewpoint=t,$dt(e,t,this._get("size"),this._get("padding"));const r=this._viewpoint2D,i=e.targetGeometry;r.center[0]=i.x,r.center[1]=i.y,r.rotation=e.rotation,r.scale=e.scale,r.spatialReference=i.spatialReference,this._update()}}clone(){return new wQ({padding:this.padding.clone(),size:this.size.slice(),viewpoint:this.paddedViewState.viewpoint.clone(),pixelRatio:this.pixelRatio})}};u([d()],WC.prototype,"paddedViewState",void 0),u([d({type:$0})],WC.prototype,"padding",null),u([d()],WC.prototype,"viewpoint",null),WC=wQ=u([$("esri.views.2d.PaddedViewState")],WC);const ppt=WC;let fpt=class{constructor(e,r){this.item=e,this.controller=r,this.promise=null}},a$e=class{constructor(e){this._deferreds=new Map,this._controllers=new Map,this._processingItems=new Map,this._isPaused=!1,this._schedule=null,this._task=null,this.concurrency=1,e.concurrency&&(this.concurrency=e.concurrency),this._queue=new az(e.peeker),this.process=e.process;const r=e.scheduler;e.priority&&v(r)&&(this._task=r.registerTask(e.priority,this))}destroy(){this.clear(),this._schedule&&(this._schedule.remove(),this._schedule=null),this._task&&(this._task.remove(),this._task=null)}get length(){return this._processingItems.size+this._queue.length}abort(e){const r=this._controllers.get(e);r&&r.abort()}clear(){this._queue.clear();const e=[];this._controllers.forEach(r=>e.push(r)),this._controllers.clear(),e.forEach(r=>r.abort()),this._processingItems.clear(),this._cancelNext()}forEach(e){this._deferreds.forEach((r,i)=>e(i))}get(e){const r=this._deferreds.get(e);return r?r.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._isPaused||(this._isPaused=!0,this._cancelNext())}push(e,r){const i=this.get(e);if(i)return i;const n=new AbortController;let s=null;r&&(s=Ua(r,()=>n.abort()));const o=()=>{const h=this._processingItems.get(e);h&&h.controller.abort(),a(),c.reject(Vr())},a=()=>{l.remove(),v(s)&&s.remove(),this._deferreds.delete(e),this._controllers.delete(e),this._queue.remove(e),this._processingItems.delete(e),this._scheduleNext()},l=E9(n.signal,o),c=__();return this._deferreds.set(e,c),this._controllers.set(e,n),c.promise.then(a,a),this._queue.push(e),this._scheduleNext(),c.promise}last(){return this._queue.last()}peek(){return this._queue.peek()}popLast(){return this._queue.popLast()}reset(){const e=[];this._processingItems.forEach(r=>e.push(r)),this._processingItems.clear();for(const r of e)this._queue.push(r.item),r.controller.abort();this._scheduleNext()}resume(){this._isPaused&&(this._isPaused=!1,this._scheduleNext())}takeAll(){const e=[];for(;this._queue.length;)e.push(this._queue.pop());return this.clear(),e}get running(){return!this._isPaused&&this._queue.length>0&&this._processingItems.size<this.concurrency}runTask(e){for(;!e.done&&this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),e.madeProgress()}_scheduleNext(){this._task||this._isPaused||this._schedule||(this._schedule=L2(()=>{this._schedule=null,this._next()}))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(e,r){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(r))}_processError(e,r){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(r))}_canProcessFulfillment(e){return!!this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e}_process(e){if(R(e))return;let r;const i=new AbortController,n=new fpt(e,i);this._processingItems.set(e,n);try{r=this.process(e,i.signal)}catch(s){this._processError(n,s)}Ju(r)?(n.promise=r,r.then(s=>this._processResult(n,s),s=>this._processError(n,s))):this._processResult(n,r)}get test(){return{update:e=>this.runTask(e)}}};function mpt(t,e){return t.length=0,e.forEach(r=>t.push(r)),t}const rH=new Set,_4=[],sE=new Map,sge=[0,0];let fv=class extends be{constructor(e){super(e),this._keyToItem=new Map,this.concurrency=6,this.strategy="scale-first",this.tileInfoView=null}initialize(){const{concurrency:e,process:r}=this;this._queue=new a$e({concurrency:e,process:(i,n)=>{const s=this._keyToItem.get(i);return r(s,{signal:n})},peeker:i=>i.values().next().value})}destroy(){this.clear(),this._queue=ze(this._queue)}get length(){return this._queue?this._queue.length:0}get onGoingCount(){return this._keyToItem.size}get updating(){return this.length>0||this.onGoingCount>0}abort(e){const r=typeof e=="string"?e:e.id;this._queue.abort(r)}clear(){this._queue.clear(),this._keyToItem.clear(),this.notifyChange("updating")}has(e){return typeof e=="string"?this._keyToItem.has(e):this._keyToItem.has(e.id)}isOngoing(e){const r=typeof e=="string"?e:e.id;return this.has(r)&&this._queue.isOngoing(r)}pause(){this._queue.pause()}push(e,r){const i=e.key.id+"-"+r;if(this.has(i))return this.get(i);const n=this._queue.push(i),s=()=>{this._keyToItem.delete(i),this.notifyChange("updating")};return this._keyToItem.set(i,e),n.then(s,s),this.notifyChange("updating"),n}reset(){this._queue.reset(),this.notifyChange("updating")}resume(){this._queue.resume()}_peekByScaleFirst(e){if(!this.state)return e.values().next().value;const r=this.tileInfoView;let i=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY;e.forEach(h=>{const p=this._keyToItem.get(h),f=this.tileInfoView.getTileScale(p.key);sE.has(f)||(sE.set(f,[]),i=Math.max(f,i),n=Math.min(f,n)),sE.get(f).push(p.key),rH.add(f)});let s=this.state.scale;sE.has(s)||(mpt(_4,rH),_4.sort((h,p)=>h-p),s=_4.reduce((h,p)=>Math.abs(p-s)<Math.abs(h-s)?p:h,_4[0])),s=Math.min(s,i),s=Math.max(s,n);const o=sE.get(s),a=r.getClosestInfoForScale(s),l=a.getColumnForX(this.state.center[0]),c=a.getRowForY(this.state.center[1]);return o.sort((h,p)=>{const f=a.denormalizeCol(h.col,h.world),m=a.denormalizeCol(p.col,p.world);return Math.sqrt((l-f)*(l-f)+(c-h.row)*(c-h.row))-Math.sqrt((l-m)*(l-m)+(c-p.row)*(c-p.row))}),rH.clear(),sE.clear(),o[0].id}_peekByCenterFirst(e){if(!this.state)return e.values().next().value;const r=this.tileInfoView,i=this.state.center;let n,s=Number.POSITIVE_INFINITY;return e.forEach(o=>{const a=this._keyToItem.get(o);r.getTileCoords(sge,a.key);const l=uy(sge,i);l<s&&(s=l,n=a.key)}),n.id}};u([d({constructOnly:!0})],fv.prototype,"concurrency",void 0),u([d({constructOnly:!0})],fv.prototype,"process",void 0),u([d()],fv.prototype,"state",void 0),u([d({constructOnly:!0})],fv.prototype,"strategy",void 0),u([d({constructOnly:!0})],fv.prototype,"tileInfoView",void 0),u([d({readOnly:!0})],fv.prototype,"updating",null),fv=u([$("esri.views.2d.tiling.PagedTileQueue")],fv);let cw=class mT{static getId(e,r,i,n){return typeof e=="object"?`${e.level}/${e.row}/${e.col}/${e.world}`:`${e}/${r}/${i}/${n}`}constructor(e,r,i,n){this.set(e,r,i,n)}get key(){return this}get id(){return this.toString()}set id(e){this.set(e)}get hash(){const e=4095&this.row,r=4095&this.col,i=63&this.level;return(3&this.world)<<30|r<<22|e<<8|i}acquire(e,r,i,n){this.set(e,r,i,n)}contains(e){const r=e.level-this.level;return r>=0&&this.row===e.row>>r&&this.col===e.col>>r&&this.world===e.world}equals(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}clone(){return new mT(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(e,r,i,n){if(e==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof e=="object")this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if(typeof e=="string"){const[s,o,a,l]=e.split("/");this.level=parseFloat(s),this.row=parseFloat(o),this.col=parseFloat(a),this.world=parseFloat(l)}else this.level=+e,this.row=+r,this.col=+i,this.world=+n||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new mT(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){const e=this.level+1,r=this.row<<1,i=this.col<<1,n=this.world;return[new mT(e,r,i,n),new mT(e,r,i+1,n),new mT(e,r+1,i,n),new mT(e,r+1,i+1,n)]}compareRowMajor(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}};cw.pool=new ko(cw,null,null,25,50);function mv(t,e){return[t,e]}function Yw(t,e,r){return t[0]=e,t[1]=r,t}function gpt(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t}const qp=new cw("0/0/0/0");let ypt=class l$e{static create(e,r,i=null){const n=fp(e.spatialReference),s=r.origin||mv(e.origin.x,e.origin.y),o=mv(e.size[0]*r.resolution,e.size[1]*r.resolution),a=mv(-1/0,-1/0),l=mv(1/0,1/0),c=mv(1/0,1/0);v(i)&&(Yw(a,Math.max(0,Math.floor((i.xmin-s[0])/o[0])),Math.max(0,Math.floor((s[1]-i.ymax)/o[1]))),Yw(l,Math.max(0,Math.floor((i.xmax-s[0])/o[0])),Math.max(0,Math.floor((s[1]-i.ymin)/o[1]))),Yw(c,l[0]-a[0]+1,l[1]-a[1]+1));const{cols:h,rows:p}=r;let f,m,g,_;return!i&&h&&p&&(Yw(a,h[0],p[0]),Yw(l,h[1],p[1]),Yw(c,h[1]-h[0]+1,p[1]-p[0]+1)),e.isWrappable?(f=mv(Math.ceil(Math.round((n.valid[1]-n.valid[0])/r.resolution)/e.size[0]),c[1]),m=mv(Math.floor((n.origin[0]-s[0])/o[0]),a[1]),g=mv(f[0]+m[0]-1,l[1]),_=!0):(m=a,g=l,f=c,_=!1),new l$e(r.level,r.resolution,r.scale,s,a,l,c,o,m,g,f,_)}constructor(e,r,i,n,s,o,a,l,c,h,p,f){this.level=e,this.resolution=r,this.scale=i,this.origin=n,this.first=s,this.last=o,this.size=a,this.norm=l,this.worldStart=c,this.worldEnd=h,this.worldSize=p,this.wrap=f}normalizeCol(e){if(!this.wrap)return e;const r=this.worldSize[0];return e<0?r-1-Math.abs((e+1)%r):e%r}denormalizeCol(e,r){return this.wrap?this.worldSize[0]*r+e:e}getWorldForColumn(e){return this.wrap?Math.floor(e/this.worldSize[0]):0}getFirstColumnForWorld(e){return e*this.worldSize[0]+this.first[0]}getLastColumnForWorld(e){return e*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(e){return(e-this.origin[0])/this.norm[0]}getXForColumn(e){return this.origin[0]+e*this.norm[0]}getRowForY(e){return(this.origin[1]-e)/this.norm[1]}getYForRow(e){return this.origin[1]-e*this.norm[1]}getTileBounds(e,r,i=!1){qp.set(r);const n=i?qp.col:this.denormalizeCol(qp.col,qp.world),s=qp.row;return gpt(e,this.getXForColumn(n),this.getYForRow(s+1),this.getXForColumn(n+1),this.getYForRow(s)),e}getTileCoords(e,r,i=!1){qp.set(r);const n=i?qp.col:this.denormalizeCol(qp.col,qp.world);return Array.isArray(e)?Yw(e,this.getXForColumn(n),this.getYForRow(qp.row)):(e.x=this.getXForColumn(n),e.y=this.getYForRow(qp.row)),e}},UO=class{constructor(){this.spans=[]}acquire(e){this.lodInfo=e}release(){this.lodInfo=null,this.spans.length=0}forEach(e,r){const{spans:i,lodInfo:n}=this,{level:s}=n;if(i.length!==0)for(const{row:o,colFrom:a,colTo:l}of i)for(let c=a;c<=l;c++)e.call(r,s,o,n.normalizeCol(c),n.getWorldForColumn(c))}};UO.pool=new ko(UO);let iH=class{constructor(e,r,i){this.row=e,this.colFrom=r,this.colTo=i}};const Qn=new cw("0/0/0/0");let _pt=class c$e{static create(e,r){e[1]>r[1]&&([e,r]=[r,e]);const[i,n]=e,[s,o]=r,a=s-i,l=o-n,c=l!==0?a/l:0,h=(Math.ceil(n)-n)*c,p=(Math.floor(n)-n)*c;return new c$e(i,Math.floor(n),Math.ceil(o),c,a<0?h:p,a<0?p:h,a<0?s:i,a<0?i:s)}constructor(e,r,i,n,s,o,a,l){this.x=e,this.ymin=r,this.ymax=i,this.invM=n,this.leftAdjust=s,this.rightAdjust=o,this.leftBound=a,this.rightBound=l}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+this.rightAdjust,this.rightBound)}};const nh=[[0,0],[0,0],[0,0],[0,0]],vpt=1e-6;let bpt=class{constructor(e,r=null){this.tileInfo=e,this.fullExtent=r,this.scales=[],this._infoByScale={},this._infoByLevel={};const i=e.lods.slice();i.sort((s,o)=>o.scale-s.scale);const n=this._lodInfos=i.map(s=>ypt.create(e,s,r));i.forEach((s,o)=>{this._infoByLevel[s.level]=n[o],this._infoByScale[s.scale]=n[o],this.scales[o]=s.scale},this),this._wrap=e.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(e){return this._infoByLevel[typeof e=="number"?e:e.level]}getTileBounds(e,r,i=!1){Qn.set(r);const n=this._infoByLevel[Qn.level];return n?n.getTileBounds(e,Qn,i):e}getTileCoords(e,r,i=!1){Qn.set(r);const n=this._infoByLevel[Qn.level];return n?n.getTileCoords(e,Qn,i):e}getTileCoverage(e,r=192,i="closest"){const n=i==="closest"?this.getClosestInfoForScale(e.scale):this.getSmallestInfoForScale(e.scale),s=UO.pool.acquire(n),o=this._wrap;let a,l,c,h=1/0,p=-1/0;const f=s.spans;nh[0][0]=nh[0][1]=nh[1][1]=nh[3][0]=-r,nh[1][0]=nh[2][0]=e.size[0]+r,nh[2][1]=nh[3][1]=e.size[1]+r;for(const b of nh)e.toMap(b,b),b[0]=n.getColumnForX(b[0]),b[1]=n.getRowForY(b[1]);const m=[];let g=3;for(let b=0;b<4;b++){if(nh[b][1]===nh[g][1]){g=b;continue}const w=_pt.create(nh[b],nh[g]);h=Math.min(w.ymin,h),p=Math.max(w.ymax,p),m[w.ymin]===void 0&&(m[w.ymin]=[]),m[w.ymin].push(w),g=b}if(h==null||p==null||p-h>100)return null;let _=[];for(a=h;a<p;){m[a]!=null&&(_=_.concat(m[a])),l=1/0,c=-1/0;for(let b=_.length-1;b>=0;b--){const w=_[b];l=Math.min(l,w.getLeftCol()),c=Math.max(c,w.getRightCol())}if(l=Math.floor(l),c=Math.floor(c),a>=n.first[1]&&a<=n.last[1])if(o)if(n.size[0]<n.worldSize[0]){const b=Math.floor(c/n.worldSize[0]);for(let w=Math.floor(l/n.worldSize[0]);w<=b;w++)f.push(new iH(a,Math.max(n.getFirstColumnForWorld(w),l),Math.min(n.getLastColumnForWorld(w),c)))}else f.push(new iH(a,l,c));else l>n.last[0]||c<n.first[0]||(l=Math.max(l,n.first[0]),c=Math.min(c,n.last[0]),f.push(new iH(a,l,c)));a+=1;for(let b=_.length-1;b>=0;b--){const w=_[b];w.ymax>=a?w.incrRow():_.splice(b,1)}}return s}getTileParentId(e){Qn.set(e);const r=this._infoByLevel[Qn.level],i=this._lodInfos.indexOf(r)-1;return i<0?null:(this._getTileIdAtLOD(Qn,this._lodInfos[i],Qn),Qn.id)}getTileResolution(e){const r=this._infoByLevel[typeof e=="object"?e.level:e];return r?r.resolution:-1}getTileScale(e){const r=this._infoByLevel[e.level];return r?r.scale:-1}intersects(e,r){Qn.set(r);const i=this._infoByLevel[Qn.level],n=e.lodInfo;if(n.resolution>i.resolution){this._getTileIdAtLOD(Qn,n,Qn);const o=n.denormalizeCol(Qn.col,Qn.world);for(const a of e.spans)if(a.row===Qn.row&&a.colFrom<=o&&a.colTo>=o)return!0}if(n.resolution<i.resolution){const[o,a,l,c]=e.spans.reduce((_,b)=>(_[0]=Math.min(_[0],b.row),_[1]=Math.max(_[1],b.row),_[2]=Math.min(_[2],b.colFrom),_[3]=Math.max(_[3],b.colTo),_),[1/0,-1/0,1/0,-1/0]),h=i.denormalizeCol(Qn.col,Qn.world),p=n.getColumnForX(i.getXForColumn(h)),f=n.getRowForY(i.getYForRow(Qn.row)),m=n.getColumnForX(i.getXForColumn(h+1))-1,g=n.getRowForY(i.getYForRow(Qn.row+1))-1;return!(p>c||m<l||f>a||g<o)}const s=n.denormalizeCol(Qn.col,Qn.world);return e.spans.some(o=>o.row===Qn.row&&o.colFrom<=s&&o.colTo>=s)}normalizeBounds(e,r,i){if(e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],this._wrap){const n=fp(this.tileInfo.spatialReference),s=-i*(n.valid[1]-n.valid[0]);e[0]+=s,e[2]+=s}return e}getSmallestInfoForScale(e){const r=this.scales;if(this._infoByScale[e])return this._infoByScale[e];if(e>r[0])return this._infoByScale[r[0]];for(let i=1;i<r.length-1;i++)if(e>r[i]+vpt)return this._infoByScale[r[i-1]];return this._infoByScale[r[r.length-1]]}getClosestInfoForScale(e){const r=this.scales;return this._infoByScale[e]||(e=r.reduce((i,n)=>Math.abs(n-e)<Math.abs(i-e)?n:i,r[0])),this._infoByScale[e]}scaleToLevel(e){const r=this.scales;if(this._infoByScale[e])return this._infoByScale[e].level;for(let i=r.length-1;i>=0;i--)if(e<r[i])return i===r.length-1?this._infoByScale[r[r.length-1]].level:this._infoByScale[r[i]].level+(r[i]-e)/(r[i]-r[i+1]);return this._infoByScale[r[0]].level}scaleToZoom(e){return this.tileInfo.scaleToZoom(e)}_getTileIdAtLOD(e,r,i){const n=this._infoByLevel[i.level];return e.set(i),r.resolution<n.resolution?null:(r.resolution===n.resolution||(e.level=r.level,e.col=Math.floor(i.col*n.resolution/r.resolution+.01),e.row=Math.floor(i.row*n.resolution/r.resolution+.01)),e)}};function wpt(t,e){return t.length=0,e.forEach(r=>t.push(r)),t}const nH=new Set,v4=[],oE=new Map,oge=[0,0];let p0=class extends be{constructor(e){super(e),this._keyToItem=new Map,this.concurrency=6,this.strategy="scale-first",this.tileInfoView=null}initialize(){const{concurrency:e,process:r,strategy:i}=this;this._queue=new a$e({concurrency:e,process:(n,s)=>{const o=this._keyToItem.get(n);return r(o,{signal:s})},peeker:i==="scale-first"?n=>this._peekByScaleFirst(n):n=>this._peekByCenterFirst(n)})}destroy(){this.clear(),this._queue=ze(this._queue)}get length(){return this._queue?this._queue.length:0}get onGoingCount(){return this._keyToItem.size}get updating(){return this.length>0||this.onGoingCount>0}abort(e){const r=typeof e=="string"?e:e.id;this._queue.abort(r)}clear(){this._queue.clear(),this._keyToItem.clear(),this.notifyChange("updating")}has(e){return typeof e=="string"?this._keyToItem.has(e):this._keyToItem.has(e.id)}isOngoing(e){const r=typeof e=="string"?e:e.id;return this.has(r)&&this._queue.isOngoing(r)}pause(){this._queue.pause()}push(e){const r=e.key.id;if(this._queue.has(r))return this._queue.get(r);const i=this._queue.push(r),n=()=>{this._keyToItem.delete(r),this.notifyChange("updating")};return this._keyToItem.set(r,e),i.then(n,n),this.notifyChange("updating"),i}reset(){this._queue.reset()}resume(){this._queue.resume()}_peekByScaleFirst(e){if(!this.state)return e.values().next().value;const r=this.tileInfoView;let i=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY;e.forEach(h=>{const p=this._keyToItem.get(h),f=this.tileInfoView.getTileScale(p.key);oE.has(f)||(oE.set(f,[]),i=Math.max(f,i),n=Math.min(f,n)),oE.get(f).push(p.key),nH.add(f)});let s=this.state.scale;oE.has(s)||(wpt(v4,nH),v4.sort((h,p)=>h-p),s=v4.reduce((h,p)=>Math.abs(p-s)<Math.abs(h-s)?p:h,v4[0])),s=Math.min(s,i),s=Math.max(s,n);const o=oE.get(s),a=r.getClosestInfoForScale(s),l=a.getColumnForX(this.state.center[0]),c=a.getRowForY(this.state.center[1]);return o.sort((h,p)=>{const f=a.denormalizeCol(h.col,h.world),m=a.denormalizeCol(p.col,p.world);return Math.sqrt((l-f)*(l-f)+(c-h.row)*(c-h.row))-Math.sqrt((l-m)*(l-m)+(c-p.row)*(c-p.row))}),nH.clear(),oE.clear(),o[0].id}_peekByCenterFirst(e){if(!this.state)return e.values().next().value;const r=this.tileInfoView,i=this.state.center;let n,s=Number.POSITIVE_INFINITY;return e.forEach(o=>{const a=this._keyToItem.get(o);r.getTileCoords(oge,a.key);const l=uy(oge,i);l<s&&(s=l,n=a.key)}),n.id}};u([d({constructOnly:!0})],p0.prototype,"concurrency",void 0),u([d({constructOnly:!0})],p0.prototype,"process",void 0),u([d()],p0.prototype,"state",void 0),u([d({constructOnly:!0})],p0.prototype,"strategy",void 0),u([d({constructOnly:!0})],p0.prototype,"tileInfoView",void 0),u([d({readOnly:!0})],p0.prototype,"updating",null),p0=u([$("esri.views.2d.tiling.TileQueue")],p0);const djt=p0;let xpt=class{constructor(e,r,i){this.maxSize=e,this._tileInfoView=r,this._removedFunc=i,this._tilePerId=new Map,this._tileKeysPerLevel=[]}has(e){return this._tilePerId.has(e)}get(e){return this._tilePerId.get(e)}pop(e){const r=this._tilePerId.get(e);if(!r)return;const i=r.key.level,n=this._tileKeysPerLevel[i];age(this._tilePerId,e);for(let s=0;s<n.length;s++)if(n[s].id===e){n.splice(s,1);break}return r.visible=!0,r}add(e){e.visible=!1;const r=e.key,i=r.id;if(this._tilePerId.has(i))return;this._tilePerId.set(i,e);const n=r.level;this._tileKeysPerLevel[n]||(this._tileKeysPerLevel[n]=[]),this._tileKeysPerLevel[n].push(r)}prune(e,r,i){let n=this._tilePerId.size;if(n<=this.maxSize)return;let s=this._tileKeysPerLevel.length-1;for(;n>this.maxSize&&s>=0;)s!==e&&(n=this._pruneAroundCenterTile(n,r,i,s)),s--;n>this.maxSize&&(n=this._pruneAroundCenterTile(n,r,i,e))}_pruneAroundCenterTile(e,r,i,n){const s=this._tileKeysPerLevel[n];if(!s||s.length===0)return e;const{size:o,origin:a}=this._tileInfoView.tileInfo,l=i*o[0],c=i*o[1],h=[0,0],p=[0,0];for(s.sort((f,m)=>(h[0]=a.x+l*(f.col+.5),h[1]=a.y-c*(f.row+.5),p[0]=a.x+l*(m.col+.5),p[1]=a.y-c*(m.row+.5),FO(h,r)-FO(p,r)));s.length>0;){const f=s.pop();if(this._removeTile(f.id),--e===this.maxSize)break}return e}_removeTile(e){const r=this._tilePerId.get(e);this._removedFunc&&r&&this._removedFunc(r),age(this._tilePerId,e)}};function age(t,e){t.delete(e)}const Zw=new cw(0,0,0,0),fd=new Map,aE=[],b4=[];let fjt=class{constructor(e){this._previousScale=Number.POSITIVE_INFINITY,this.cachePolicy="keep",this.coveragePolicy="closest",this.resampling=!0,this.tileIndex=new Map,this.tiles=[],this.buffer=192,this.acquireTile=e.acquireTile,this.releaseTile=e.releaseTile,this.tileInfoView=e.tileInfoView,this.resampling=e.resampling==null||!!e.resampling,e.cachePolicy&&(this.cachePolicy=e.cachePolicy),e.coveragePolicy&&(this.coveragePolicy=e.coveragePolicy),e.buffer!=null&&(this.buffer=e.buffer),e.cacheSize&&(this._tileCache=new xpt(e.cacheSize,this.tileInfoView,r=>{this.releaseTile(r)}))}destroy(){this.tileIndex.clear()}update(e){const{resampling:r,tileIndex:i}=this,n=this.tileInfoView.getTileCoverage(e.state,this.buffer,this.coveragePolicy);if(b4.length=0,aE.length=0,fd.clear(),!n)return;const{minScale:s,maxScale:o}=this.tileInfoView.tileInfo,{spans:a,lodInfo:l}=n,{level:c}=l,{scale:h,center:p,resolution:f}=e.state,m=!e.stationary&&h>this._previousScale;if(this._previousScale=h,this.tiles.length=0,!r&&(h>s||h<o))return this.tiles.length=0,fd.clear(),i.forEach(w=>{this.releaseTile(w)}),i.clear(),b4.length=0,aE.length=0,fd.clear(),UO.pool.release(n),!0;i.forEach(w=>w.visible=!0);let g=0,_=0;if(a.length>0)for(const{row:w,colFrom:x,colTo:T}of a)for(let E=x;E<=T;E++){g++;const C=Zw.set(c,w,l.normalizeCol(E),l.getWorldForColumn(E)).id;if(i.has(C)){const A=i.get(C);A.isReady?(fd.set(C,A),_++):m||this._addParentTile(C,fd)}else{let A;if(this._tileCache&&this._tileCache.has(C)){if(A=this._tileCache.pop(C),this.tileIndex.set(C,A),A.isReady){fd.set(C,A),_++;continue}}else A=this.acquireTile(Zw),this.tileIndex.set(C,A);m||this._addParentTile(C,fd)}}const b=_===g;i.forEach((w,x)=>{if(Zw.set(x),fd.has(x))return;const T=this.tileInfoView.intersects(n,Zw),E=this.cachePolicy==="purge"?Zw.level!==c:Zw.level>c;!T||!m&&b?!E&&T||aE.push(x):w.isReady?E&&this.cachePolicy==="purge"&&this._hasReadyAncestor(Zw,c)?aE.push(x):b4.push(x):E&&aE.push(x)});for(const w of b4){const x=i.get(w);x&&x.isReady&&fd.set(w,x)}for(const w of aE){const x=i.get(w);this._tileCache?this._tileCache.add(x):this.releaseTile(x),i.delete(w)}return fd.forEach(w=>this.tiles.push(w)),i.forEach(w=>{fd.has(w.key.id)||(w.visible=!1)}),this._tileCache&&this._tileCache.prune(c,p,f),UO.pool.release(n),fd.clear(),b}clear(e=!0){const{tileIndex:r}=this;e&&r.forEach(i=>{this.releaseTile(i)}),r.clear()}updateCacheSize(e){this._tileCache&&(this._tileCache.maxSize=e)}_addParentTile(e,r){let i=e,n=null;for(;i=this.tileInfoView.getTileParentId(i),i;)if(this.tileIndex.has(i)){if(n=this.tileIndex.get(i),n&&n.isReady){r.has(n.key.id)||r.set(n.key.id,n);break}}else if(this._tileCache&&this._tileCache.has(i)&&(n=this._tileCache.pop(i),this.tileIndex.set(i,n),n&&n.isReady)){r.has(n.key.id)||r.set(n.key.id,n);break}}_hasReadyAncestor(e,r){const i=Kt();this.tileInfoView.getTileBounds(i,e,!0);for(const n of this.tileIndex.values())if(n.isReady&&n.key.level>=r&&n.key.level<e.level){const s=Kt();if(this.tileInfoView.getTileBounds(s,n.key,!0),cZ(s,i))return!0}return!1}};function $B(t,e){switch(e){case"primary":return t.pointerType==="touch"||t.button===0;case"secondary":return t.pointerType!=="touch"&&t.button===2;case"tertiary":return t.pointerType!=="touch"&&t.button===1}}function Goe(t,e){if(t.pointerType==="touch")return!1;switch(e){case"primary":return t.button===0;case"secondary":return t.button===2;case"tertiary":return t.button===1}}let lge=class extends nn{constructor(e,r){super(!0),this._view=e,this.registerIncoming("double-click",r,i=>this._handleDoubleClick(i,r))}_handleDoubleClick(e,r){$B(e.data,"primary")&&(e.stopPropagation(),r?this._view.mapViewNavigation.zoomOut([e.data.x,e.data.y]):this._view.mapViewNavigation.zoomIn([e.data.x,e.data.y]))}},Tpt=class extends nn{constructor(e,r,i){super(!0),this.view=e,this.pointerType=r,this.registerIncoming("double-tap-drag",i,n=>this._handleDoubleTapDrag(n))}_handleDoubleTapDrag(e){const{data:r}=e,{pointerType:i}=r;if(i!==this.pointerType)return;e.stopPropagation();const{action:n,delta:s}=r,{view:o}=this,{mapViewNavigation:a}=o;switch(n){case"begin":{const{scale:l}=o;this._startScale=l,this._currentScale=l,this._previousDelta=s,a.begin();break}case"update":{if(this._previousDelta.y===s.y)return;this._previousDelta=s;const l=1.015**s.y,c=this._startScale*l,h=c/this._currentScale;a.setViewpointImmediate(h),this._currentScale=c;break}case"end":{const{constraints:l}=o,{effectiveLODs:c,snapToZoom:h}=l;if(!h||!c)return void a.end();const p=l.snapScale(this._currentScale),f=(s.y>0?Math.max(p,l.snapToPreviousScale(this._startScale)):Math.min(p,l.snapToNextScale(this._startScale)))/this._currentScale;a.zoom(f);break}}}},kN=class{constructor(e){this._callbacks=e,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(e){const r=e.data,i=r.pointers.size;switch(r.action){case"start":this._currentCount=i,this._emitStart(e);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=i,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=i,this._emitStart(e);break;case"end":this._emitEnd(e),this._currentCount=0}this._previousEvent=e}_emitStart(e){var r,i;this._startEvent=e,(i=(r=this._callbacks).condition)!=null&&i.call(r,this._currentCount,e)&&this._callbacks.start(this._currentCount,e,this._startEvent)}_emitUpdate(e){var r,i;(i=(r=this._callbacks).condition)!=null&&i.call(r,this._currentCount,e)&&this._callbacks.update(this._currentCount,e,this._startEvent)}_emitEnd(e){var r,i;(i=(r=this._callbacks).condition)!=null&&i.call(r,this._currentCount,e)&&this._callbacks.end(this._currentCount,e,this._startEvent),this._startEvent=null}},Spt=class extends nn{constructor(e,r,i){super(!0),this.view=e,this.pointerAction=r,this.registerIncoming("drag",i,n=>this._handleDrag(n)),this.registerIncoming("pointer-down",()=>this.stopMomentumNavigation())}onInstall(e){super.onInstall(e),this._dragEventSeparator=new kN({start:(r,i)=>{this.view.mapViewNavigation.pan.begin(this.view,i.data),i.stopPropagation()},update:(r,i)=>{this.view.mapViewNavigation.pan.update(this.view,i.data),i.stopPropagation()},end:(r,i)=>{this.view.mapViewNavigation.pan.end(this.view,i.data),i.stopPropagation()},condition:(r,i)=>r===1&&$B(i.data,this.pointerAction)})}_handleDrag(e){const r=this.view.mapViewNavigation;r.pinch.zoomMomentum||r.pinch.rotateMomentum?this.stopMomentumNavigation():this._dragEventSeparator.handle(e)}stopMomentumNavigation(){this.view.mapViewNavigation.pan.stopMomentumNavigation()}},Ept=class extends nn{constructor(e,r,i){super(!0),this._view=e,this.pointerAction=r;const n=this._view.mapViewNavigation;this._dragEventSeparator=new kN({start:(s,o)=>{n.rotate.begin(this._view,o.data),o.stopPropagation()},update:(s,o)=>{n.rotate.update(this._view,o.data),o.stopPropagation()},end:(s,o)=>{n.rotate.end(),o.stopPropagation()},condition:(s,o)=>s===1&&$B(o.data,this.pointerAction)}),this.registerIncoming("drag",i,s=>this._dragEventSeparator.handle(s))}};function Wp(t){let e=t*t;return t<0&&(e*=-1),e}function Cpt(t){return t.translation[0]=0,t.translation[1]=0,t.translation[2]=0,t.heading=0,t.tilt=0,t}function xQ(t,e,r){const i=r,n=t.state,s=t.device,o=e.tiltDirection==="forward-down"?1:-1,a=1;return s.deviceType==="standard"?(i.translation[0]=Wp(n.axes[0]),i.translation[1]=Wp(n.axes[1]),i.translation[2]=Wp(n.buttons[7])-Wp(n.buttons[6]),i.heading=Wp(n.axes[2]),i.tilt=Wp(n.axes[3])):s.deviceType==="spacemouse"&&(i.translation[0]=1.2*Wp(n.axes[0]),i.translation[1]=1.2*Wp(n.axes[1]),i.translation[2]=2*-Wp(n.axes[2]),i.heading=1.2*Wp(n.axes[5]),i.tilt=1.2*Wp(n.axes[3])),i.tilt*=o,le(i.translation,i.translation,a),i}function cge(t,e){const r=e;return r.translation[0]=t[1]-t[0],r.translation[1]=t[3]-t[2],r.translation[2]=t[4]-t[5],r.heading=t[7]-t[6],r.tilt=t[8]-t[9],r.zoom=t[10]-t[11],r}function lU(t){return t.translation[0]===0&&t.translation[1]===0&&t.translation[2]===0&&t.heading===0&&t.tilt===0&&t.zoom===0}let Apt=class extends nn{constructor(e){super(!0),this._view=e,this._frameTask=null,this._watchHandles=new qr,this._currentDevice=null,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._handle=this.registerIncoming("gamepad",r=>this._handleGamePadEvent(r)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([ne(()=>{var r;return(r=this._view.navigation.gamepad)==null?void 0:r.enabled},r=>{r?(this._handle.resume(),this._frameTask||(this._frameTask=v_({update:i=>this._frameUpdate(i.deltaTime)}))):(this._handle.pause(),this._frameTask&&(this._frameTask.remove(),this._frameTask=null))},Vt)])}onUninstall(){this._watchHandles.removeAll(),this._frameTask&&(this._frameTask.remove(),this._frameTask=null),super.onUninstall()}_handleGamePadEvent(e){const r=this._view.navigation.gamepad.device;r&&e.data.device!==r||this._currentDevice&&this._currentDevice!==e.data.device||(e.data.action==="end"?(this._currentDevice=null,Cpt(this._transformation)):(this._currentDevice=e.data.device,xQ(e.data,this._view.navigation.gamepad,this._transformation)))}_frameUpdate(e){const r=this._transformation;if(lU(r))return;const i=this._view.viewpoint.clone(),n=this._view.navigation.gamepad.velocityFactor,s=Opt*n*e;IB(i,i,[r.translation[0]*s,-r.translation[1]*s]);const o=1+r.translation[2]*Mpt*e,a=this._view.constraints.rotationEnabled?-r.heading*Rpt*e:0,l=this._view.size,c=[l[0]/2,l[1]];qIe(i,i,o,a,c,l);const h=this._view.constraints.constrain(i,this._view.viewpoint);this._view.viewpoint=h}};const Rpt=.06,Opt=.7,Mpt=6e-4;let Ppt=class extends nn{constructor(e,r,i){super(!0),this.view=e,this.keys=r,this._pressed=!1,this._keyMap={[r.left]:"left",[r.right]:"right",[r.up]:"up",[r.down]:"down"},this.registerIncoming("key-down",i,n=>this._handleKeyDown(n)),this.registerIncoming("key-up",i,n=>this._handleKeyUp(n)),this.registerIncoming("blur",i,()=>this._handleBlur())}_handleKeyDown(e){e.data.repeat||this._handleKey(e,!0)}_handleKeyUp(e){this._handleKey(e,!1)}_handleBlur(){this._pressed&&(this._pressed=!1,this.view.mapViewNavigation.stop())}_handleKey(e,r){const i=this._keyMap[e.data.key];if(this._pressed=i!=null,this._pressed){if(r)switch(this.view.mapViewNavigation.begin(),i){case"left":this.view.mapViewNavigation.continousPanLeft();break;case"right":this.view.mapViewNavigation.continousPanRight();break;case"up":this.view.mapViewNavigation.continousPanUp();break;case"down":this.view.mapViewNavigation.continousPanDown()}else this._pressed=!1,this.view.mapViewNavigation.stop();e.stopPropagation()}}},Ipt=class extends nn{constructor(e,r,i){super(!0),this.view=e,this.keys=r,this._pressed=!1,this._keyToDirection={[r.clockwiseOption1]:"clockwise",[r.clockwiseOption2]:"clockwise",[r.counterClockwiseOption1]:"counterClockwise",[r.counterClockwiseOption2]:"counterClockwise",[r.resetOption1]:"reset",[r.resetOption2]:"reset"},this.registerIncoming("key-down",i,n=>this._handleKeyDown(n)),this.registerIncoming("key-up",i,n=>this._handleKeyUp(n)),this.registerIncoming("blur",i,()=>this._handleBlur())}_handleKeyDown(e){e.data.repeat||this._handleKey(e,!0)}_handleKeyUp(e){this._handleKey(e,!1)}_handleBlur(){this._pressed&&(this._pressed=!1,this.view.mapViewNavigation.stop())}_handleKey(e,r){const i=e.modifiers;if(i.size>0&&!i.has("Shift")||!this.view.constraints.rotationEnabled)return;const n=this._keyToDirection[e.data.key];if(this._pressed=n!=null,this._pressed){if(r)switch(this.view.mapViewNavigation.begin(),n){case"clockwise":this.view.mapViewNavigation.continousRotateClockwise();break;case"counterClockwise":this.view.mapViewNavigation.continousRotateCounterclockwise();break;case"reset":this.view.mapViewNavigation.resetRotation()}else this._pressed=!1,this.view.mapViewNavigation.stop();e.stopPropagation()}}};var QA;(function(t){t[t.IN=0]="IN",t[t.OUT=1]="OUT"})(QA||(QA={}));let $pt=class extends nn{constructor(e,r,i){super(!0),this.view=e,this.keys=r,this._keysToZoomAction={},this.registerIncoming("key-down",i,n=>this._handleKeyDown(n)),r.zoomIn.forEach(n=>this._keysToZoomAction[n]=QA.IN),r.zoomOut.forEach(n=>this._keysToZoomAction[n]=QA.OUT)}_handleKeyDown(e){this._handleKey(e)}_handleKey(e){const r=e.modifiers;if(r.size>0&&!r.has("Shift"))return;const{key:i}=e.data;if(!(i in this._keysToZoomAction))return;const n=this._keysToZoomAction[i],{mapViewNavigation:s}=this.view;let o=null;switch(n){case QA.IN:o=s.zoomIn();break;case QA.OUT:o=s.zoomOut();break;default:return}s.begin(),o.then(()=>s.end()),e.stopPropagation()}};const Lpt=.6;let Dpt=class extends nn{constructor(e,r){super(!0),this._view=e,this._canZoom=!0,this.registerIncoming("mouse-wheel",r,i=>this._handleMouseWheel(i))}_handleMouseWheel(e){if(!this._view.navigation.mouseWheelZoomEnabled||(e.preventDefault(),e.stopPropagation(),!this._canZoom))return;const r=this._view.mapViewNavigation,{x:i,y:n,deltaY:s}=e.data,o=1/Lpt**(1/60*s),a=r.zoom(o,[i,n]);a&&(this._canZoom=!1,a.catch(()=>{}).then(()=>{this._canZoom=!0,r.end()}))}},Npt=class extends nn{constructor(e){super(!0),this.view=e,this.registerIncoming("drag",i=>this._handleDrag(i)),this.registerIncoming("pointer-down",()=>this._stopMomentumNavigation());const r=this.view.mapViewNavigation;this._dragEventSeparator=new kN({start:(i,n)=>{r.pinch.begin(this.view,n.data),n.stopPropagation()},update:(i,n)=>{r.pinch.update(this.view,n.data),n.stopPropagation()},end:(i,n)=>{r.pinch.end(this.view),n.stopPropagation()},condition:i=>i>=2})}_handleDrag(e){this._dragEventSeparator.handle(e)}_stopMomentumNavigation(){this.view.mapViewNavigation.pinch.stopMomentumNavigation()}};function uge(t){const e=t.native;return e?{buttons:e.buttons.map(r=>r.pressed?r.value?r.value:1:0),axes:e.axes.map(r=>Upt(r,t.axisThreshold))}:{buttons:[],axes:[]}}function Fpt(t,e){if(t.axes.length!==e.axes.length||t.buttons.length!==e.buttons.length)return!1;for(let r=0;r<t.axes.length;r++)if(t.axes[r]!==e.axes[r])return!1;for(let r=0;r<t.buttons.length;r++)if(t.buttons[r]!==e.buttons[r])return!1;return!0}function kpt(t){for(let e=0;e<t.axes.length;e++)if(t.axes[e]!==0)return!1;for(let e=0;e<t.buttons.length;e++)if(t.buttons[e]!==0)return!1;return!0}function Upt(t,e){const r=Math.abs(t);return r<e?0:Math.sign(t)*(r-e)/(1-e)}let zpt=class{constructor(e,r){this._element=e,this._input=r,this._hasEventListeners=!1,this._onConnectGamepad=s=>{this._connectGamepad(s.gamepad)},this._onDisconnectGamepad=s=>{const o=s.gamepad,a=o.index,l=this._inputDevices[a];l&&(this._emitGamepadEvent(o,uge(l),!1),this._inputDevices.splice(a,1),this._latestUpdate.splice(a,1),this._input.gamepad.devices.remove(l),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const i="getGamepads"in window.navigator,n=window.isSecureContext;this.supported=i&&n,this.supported&&(this._forEachGamepad(s=>this._connectGamepad(s)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const r=new Moe(e);r.deviceType!=="unknown"&&(this._inputDevices[e.index]=r,this._input.gamepad.devices.add(r)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=v_({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),r=this._element.contains(document.activeElement),i=this._input.gamepad.enabledFocusMode==="document"&&!e||this._input.gamepad.enabledFocusMode==="view"&&!r;this._forEachGamepad(n=>{const s=this._inputDevices[n.index];if(!s)return;const o=this._latestUpdate[n.index],a=uge(s),l=i||kpt(a);o&&(o.timestamp===n.timestamp||!o.active&&l||Fpt(o.state,a))||this._emitGamepadEvent(n,a,!l)})}_forEachGamepad(e){const r=window.navigator.getGamepads();for(let i=0;i<r.length;i++){const n=r[i];this._validate(n)&&e(n)}}_emitGamepadEvent(e,r,i){const n=this._latestUpdate[e.index],s=n&&n.active;if(!s&&!i)return;const o=!s&&i?"start":s&&i?"update":"end";this._latestUpdate[e.index]={timestamp:e.timestamp,state:r,active:i},this._callback&&this._callback({device:this._inputDevices[e.index],state:r,action:o})}_validate(e){if(!e||!e.connected)return!1;for(let r=0;r<e.axes.length;r++)if(isNaN(e.axes[r]))return!1;return!0}};const hge=ue("edge"),Vpt=ue("chrome"),Bpt=ue("ff"),jpt=ue("safari"),dge="esri-view-surface",lE={touchNone:`${dge}--touch-none`,touchPan:`${dge}--touch-pan`};let Hoe=class u$e{constructor(e,r){this._input=r,this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new zpt(e,this._input),this._gamepadSource.onEvent=i=>this._callback("gamepad",i)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(e=>{this._releasePointerCaptureSafe(e)}),this._gamepadSource=ze(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const r in this._active)if(!e||!e.has(r)){const i=this._active[r];this._element.removeEventListener(sH[r],i),delete this._active[r]}e&&e.forEach(r=>{if(!this._active[r]&&sH[r]){const i=(this._eventHandlers[r]||this._handleDefault).bind(this,r);this._element.addEventListener(sH[r],i),this._active[r]=i}}),this._gamepadSource.hasEventListeners=(e==null?void 0:e.has("gamepad"))??!1}setPointerCapture(e,r){r?(this._element.setPointerCapture(e.pointerId),this._activePointerCaptures.add(e.pointerId)):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?lE.touchNone:lE.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?lE.touchPan:lE.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(lE.touchNone),this._element.classList.remove(lE.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch{}}_updateNormalizedPointerLikeEvent(e,r){const i=yIe(this._element,e);return u$e.test.disableSubpixelCoordinates&&(i.x=Math.round(i.x),i.y=Math.round(i.y)),r.x=i.x,r.y=i.y,r}_handleKey(e,r){const i=Dut(r);i&&e==="key-up"&&this._keyDownState.delete(i);const n={native:r,key:i,repeat:!!i&&this._keyDownState.has(i)};i&&e==="key-down"&&this._keyDownState.add(n.key),this._callback(e,n)}_handlePointer(e,r){const i=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});this._callback(e,i)}_handlePointerPreventDefault(e,r){const i=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});r.preventDefault(),this._callback(e,i)}_handleMouseWheel(e,r){let i=r.deltaY;switch(r.deltaMode){case 0:hge&&(i=i/document.documentElement.clientHeight*600);break;case 1:i*=30;break;case 2:i*=900}hge?i*=.7:Vpt||jpt?i*=.6:Bpt&&(i*=1.375);const n=100,s=Math.abs(i);s>n&&(i=i/s*200/(1+Math.exp(-.02*(s-n))));const o=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,deltaY:i});this._callback(e,o)}_handlePointerCaptureLost(e,r){this._activePointerCaptures.delete(r.pointerId),this._handleDefault(e,r)}_handleDefault(e,r){const i={native:r};r.preventDefault(),this._callback(e,i)}_preventAltKeyDefault(e){e.key==="Alt"&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}};Hoe.test={disableSubpixelCoordinates:!1};const sH={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};let h$e=class extends nn{constructor(){super(!0),this.registerIncoming("context-menu",e=>{e.data.native.preventDefault()})}};function qoe(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}function Gpt(t,e){const r=e.x-t.x,i=e.y-t.y;return Math.sqrt(r*r+i*i)}function Hpt(t,e){if(e?(e.radius=0,e.center.x=0,e.center.y=0):e={radius:0,center:Gs()},t.length===0)return e;if(t.length===1)return e.center.x=t[0].x,e.center.y=t[0].y,e;if(t.length===2){const[T,E]=t,[C,A]=[E.x-T.x,E.y-T.y];return e.radius=Math.sqrt(C*C+A*A)/2,e.center.x=(T.x+E.x)/2,e.center.y=(T.y+E.y)/2,e}let r=0,i=0;for(let T=0;T<t.length;T++)r+=t[T].x,i+=t[T].y;r/=t.length,i/=t.length;const n=t.map(T=>T.x-r),s=t.map(T=>T.y-i);let o=0,a=0,l=0,c=0,h=0,p=0,f=0;for(let T=0;T<n.length;T++){const E=n[T],C=s[T],A=E*E,I=C*C;o+=A,a+=I,l+=E*C,c+=A*E,h+=I*C,p+=E*I,f+=C*A}const m=.5*(c+p),g=.5*(h+f),_=o*a-l*l,b=(m*a-g*l)/_,w=(o*g-l*m)/_,x=Gs(b+r,w+i);return{radius:Math.sqrt(b*b+w*w+(o+a)/t.length),center:x}}function IS(t){const{native:e}=t,{pointerId:r,button:i,pointerType:n}=e;return n==="mouse"?`${r}:${i}`:`${n}`}const hp={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};let d$e=class extends nn{constructor(e=hp.maximumDoubleClickDelay,r=hp.maximumDoubleClickDistance,i=hp.maximumDoubleTouchDelay,n=hp.maximumDoubleTouchDistance,s=lN){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=r,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=n,this._clock=s,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach(e=>e.doubleClickTimer=$i(e.doubleClickTimer))}get hasPendingInputs(){return ca(this._pointerState,e=>e.doubleClickTimer!=null)}_clearDoubleClickTimer(e,r){const i=this._pointerState.get(e);i&&(i.doubleClickTimer=$i(i.doubleClickTimer),r&&this._click.emit(i.event.data,void 0,i.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const r=this._pointerState.get(e);r.pointerDownCount===1&&this._click.emit(r.event.data,void 0,r.event.modifiers),r.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_getPointerId(e){const{pointerId:r,pointerType:i,button:n}=e.native;return i==="mouse"?`${r}:${n}`:`${i}`}_handleImmediateClick(e){const r=e.data,{pointerType:i}=r.native,n=this._getPointerId(r);if(!this._pointerState.has(n))return void this._startClick(e);const s=this._pointerState.get(n),{data:o,modifiers:a}=s.event,l=i==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;qoe(o,r)>l?(this._clearDoubleClickTimer(n,!0),this._startClick(e)):(this._clearDoubleClickTimer(n,!1),s.pointerDownCount===2&&this._doubleClick.emit(o,void 0,a))}_handlePointerDown(e){const r=IS(e.data),i=this._pointerState.get(r);i&&(i.pointerDownCount+=1)}_startClick(e){const{data:r}=e,{native:{pointerType:i}}=r,n=IS(r),s=i==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(n),s),a=1;this._pointerState.set(n,{event:e,doubleClickTimer:o,pointerDownCount:a}),this.refreshHasPendingInputs()}},qpt=class extends nn{constructor(e=hp.maximumDoubleClickDelay,r=hp.maximumDoubleClickDistance,i=hp.maximumDoubleTouchDelay,n=hp.maximumDoubleTouchDistance,s=lN){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=r,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=n,this._clock=s,this._doubleTapDragReady=!1,this._doubleTapDragActive=!1,this._dragStartCenter=Gs(0,0),this._pointerState=new Map,this._doubleTapDrag=this.registerOutgoing("double-tap-drag"),this._dragEventSeparator=new kN({start:(o,a)=>this._dragStart(o,a),update:(o,a)=>this._dragUpdate(a),end:(o,a)=>this._dragEnd(a)}),this.registerIncoming("drag",o=>this._dragEventSeparator.handle(o)),this.registerIncoming("pointer-down",o=>this._handlePointerDown(o)),this.registerIncoming("pointer-up",()=>this._handlePointerUp())}onUninstall(){this._pointerState.forEach(e=>{e.doubleTapTimeout=$i(e.doubleTapTimeout)})}get hasPendingInputs(){return ca(this._pointerState,e=>e.doubleTapTimeout!=null)}_clearPointerDown(e){const r=this._pointerState.get(e);r&&(r.doubleTapTimeout=$i(r.doubleTapTimeout),this._pointerState.delete(e),this.refreshHasPendingInputs())}_createDoubleTapDragData(e,r,i){const{button:n,buttons:s,pointer:o,pointers:a,pointerType:l,timestamp:c}=i;return{action:e,delta:r,button:n,buttons:s,pointer:o,pointers:a,pointerType:l,timestamp:c}}_dragStart(e,r){if(!this._doubleTapDragReady||e!==1)return;this._doubleTapDragReady=!1,this._doubleTapDragActive=!0;const{data:i,modifiers:n}=r,{center:s}=i;this._dragStartCenter=s;const o=this._createDoubleTapDragData("begin",Gs(0,0),i);this._doubleTapDrag.emit(o,void 0,n),r.stopPropagation()}_dragUpdate(e){if(!this._doubleTapDragActive)return;const{data:r,modifiers:i}=e,{center:n}=r,s=Gs(n.x-this._dragStartCenter.x,n.y-this._dragStartCenter.y),o=this._createDoubleTapDragData("update",s,r);this._doubleTapDrag.emit(o,void 0,i),e.stopPropagation()}_dragEnd(e){if(!this._doubleTapDragActive)return;const{data:r,modifiers:i}=e,{center:n}=r,s=Gs(n.x-this._dragStartCenter.x,n.y-this._dragStartCenter.y),o=this._createDoubleTapDragData("end",s,r);this._doubleTapDrag.emit(o,void 0,i),this._doubleTapDragActive=!1,e.stopPropagation()}_handlePointerDown(e){const{data:r}=e,i=IS(r),n=this._pointerState.get(i),{pointerType:s}=r.native;if(n){const o=s==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;this._clearPointerDown(i),qoe(n.event.data,r)>o?this._storePointerDown(e):this._doubleTapDragReady=!0}else this._storePointerDown(e)}_handlePointerUp(){this._doubleTapDragReady=!1}_storePointerDown(e){const{data:r}=e,{pointerType:i}=r.native,n=IS(r),s=i==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._clearPointerDown(n),s);this._pointerState.set(n,{event:e,doubleTapTimeout:o}),this.refreshHasPendingInputs()}},p$e=class extends nn{constructor(e){super(!1),this._navigationTouch=e,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(e,r,i,n){return{action:e,pointerType:this._pointerType,button:this._mouseButton,buttons:r.buttons,timestamp:n,pointers:Wpt(this._activePointerMap),pointer:r,angle:i.angle,radius:i.radius,center:i.center}}_addPointer(e){const r=e.native.pointerId,i=w4(this._activePointerMap).angle,n={event:e,initialAngle:0,lastAngle:0};this._activePointerMap.set(r,n);const s=cU(n,f$e(this._activePointerMap));n.initialAngle=s,n.lastAngle=s,this._updatePointerAngles(i)}_updatePointer(e){if(e&&e.x==null&&e.y==null)return;const r=e.native.pointerId,i=this._activePointerMap.get(r);i?i.event=e:this._addPointer(e)}_removePointer(e){const r=w4(this._activePointerMap).angle;this._activePointerMap.delete(e),this._updatePointerAngles(r)}_updatePointerAngles(e){const r=w4(this._activePointerMap);this._activePointerMap.forEach(i=>{i.initialAngle=cU(i,r)-e,i.lastAngle=cU(i,r)-e})}_emitEvent(e,r,i){const n=w4(this._activePointerMap);this._drag.emit(this._createPayload(e,r,n,i),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(e){const r=e.data.native.pointerId,i=e.timestamp;this._activePointerMap.get(r)&&(this._activePointerMap.size===1?(this._updatePointer(e.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",e.data,i),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(r)):(this._removePointer(r),this._emitEvent("removed",e.data,e.timestamp)))}_handlePointerDrag(e){const r=e.data,i=r.currentEvent,n=e.timestamp;switch(r.action){case"start":case"update":this._isDragging?this._activePointerMap.has(i.native.pointerId)?(this._updatePointer(i),!this._isCurrentDragSuppressed&&this._emitEvent("update",i,n)):(this._addPointer(i),this._emitEvent("added",i,n),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(i),this._pointerType=e.data.startEvent.pointerType,this._mouseButton=e.data.startEvent.button,this._startStateModifiers=e.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",i,n))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function f$e(t){const e=[];return t.forEach(r=>{e.push(Gs(r.event.x,r.event.y))}),Hpt(e)}function w4(t){const e=f$e(t);let r=0;return t.forEach(i=>{let n=cU(i,e),s=n-i.lastAngle;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;n=i.lastAngle+s,i.lastAngle=n;const o=n-i.initialAngle;r+=o}),r/=t.size||1,{angle:r,radius:e.radius,center:e.center}}function Wpt(t){const e=new Map;return t.forEach((r,i)=>e.set(i,r.event)),e}function cU(t,e){const r=t.event,i=r.x-e.center.x,n=r.y-e.center.y;return Math.atan2(n,i)}var pge;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right",t[t.Back=3]="Back",t[t.Forward=4]="Forward",t[t.Undefined=-1]="Undefined"})(pge||(pge={}));let m$e=class extends nn{constructor(e=hp.maximumDoubleClickDelay,r=hp.maximumDoubleClickDistance,i=hp.maximumDoubleTouchDelay,n=hp.maximumDoubleTouchDistance,s=lN){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=r,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=n,this._clock=s,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(e){const r=e.data,i=IS(r);if(!this._pointerState.has(i)){const n={downButton:r.native.button,immediateDoubleClick:null};this._pointerState.set(i,n),this.startCapturingPointer(r.native)}}_handlePointerUp(e){const r=e.data,i=IS(r),n=this._pointerState.get(i);if(n&&n.downButton===r.native.button){const s=n.immediateDoubleClick;if(s){s.timeoutHandle.remove();const o=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;qoe(s,e.data)>o?this._startImmediateDoubleClick(e,n):(this._immediateDoubleClick.emit(e.data,void 0,s.modifiers),this._removeState(r))}else this._startImmediateDoubleClick(e,n)}}_startImmediateDoubleClick(e,r){const i=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;r.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(e.data),i)}}_removeState(e){const r=IS(e);this._pointerState.delete(r),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}};const SM={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};let g$e=class extends nn{constructor(e=SM.maximumClickDelay,r=SM.movementUntilMouseDrag,i=SM.movementUntilPenDrag,n=SM.movementUntilTouchDrag,s=SM.holdDelay,o=lN){super(!1),this._maximumClickDelay=e,this._movementUntilMouseDrag=r,this._movementUntilPenDrag=i,this._movementUntilTouchDrag=n,this._holdDelay=s,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",a=>{this._handlePointerLoss(a,"pointer-up")}),this.registerIncoming("pointer-capture-lost",a=>{this._handlePointerLoss(a,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",a=>{this._handlePointerLoss(a,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(e=>{e.holdTimeout=$i(e.holdTimeout)}),super.onUninstall()}_handlePointerDown(e){const r=e.data,i=r.native.pointerId;let n=null;this._pointerState.size===0&&(n=this._clock.setTimeout(()=>{const o=this._pointerState.get(i);if(o){if(!o.isDragging){const a=o.previousEvent;this._pointerHold.emit(a,void 0,e.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this._holdDelay));const s={startEvent:r,previousEvent:r,startTimestamp:e.timestamp,isDragging:!1,downButton:r.native.button,holdTimeout:n,modifiers:new Set};this._pointerState.set(i,s),this.startCapturingPointer(r.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}_createPointerDragData(e,r,i){return{action:e,startEvent:r.startEvent,previousEvent:r.previousEvent,currentEvent:i}}_handlePointerMove(e){const r=e.data,i=r.native.pointerId,n=this._pointerState.get(i);n&&(n.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",n,r),void 0,n.modifiers):Gpt(r,n.startEvent)>this._getDragThreshold(r.native.pointerType)&&this._startDragging(e),n.previousEvent=r)}_getDragThreshold(e){switch(e){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(e){const r=e.data,i=r.native.pointerId;this._pointerState.forEach(n=>{n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging||(n.modifiers=e.modifiers,n.isDragging=!0,i===n.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",n,r)):this._pointerDrag.emit(this._createPointerDragData("start",n,n.previousEvent),e.timestamp))})}_handlePointerLoss(e,r){const i=e.data,n=i.native.pointerId,s=this._pointerState.get(n);s&&(s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",s,r==="pointer-up"?i:s.previousEvent),void 0,s.modifiers):r==="pointer-up"&&s.downButton===i.native.button&&e.timestamp-s.startTimestamp<=this._maximumClickDelay&&!s.holdEmitted&&this._immediateClick.emit(i),this._pointerState.delete(n),this.stopCapturingPointer(i.native),this._pointerState.size===0&&this._moveHandle.pause())}};const x4={counter:"Ctrl",pan:{left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown"},zoom:{zoomIn:["=","+"],zoomOut:["-","_"]},rotate:{clockwiseOption1:"a",clockwiseOption2:"A",counterClockwiseOption1:"d",counterClockwiseOption2:"D",resetOption1:"n",resetOption2:"N"}};let gT=class extends be{constructor(){super(...arguments),this._handles=new qr}initialize(){const e=()=>{var r;return(r=this.view)==null?void 0:r.ready};this._handles.add([fo(()=>!e(),()=>this._disconnect()),fo(e,()=>this._connect())])}destroy(){this._handles=ze(this._handles),this._disconnect()}get latestPointerType(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerType}get latestPointerLocation(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerLocation}get multiTouchActive(){var e;return((e=this._inputManager)==null?void 0:e.multiTouchActive)??!1}_disconnect(){this.view.viewEvents.disconnect(),this._inputManager=ze(this._inputManager)}_connect(){const e=this.view.surface,r=new Hoe(e,this.view.input),i=[new m$e,new g$e,new d$e,new p$e(this.view.navigation),new qpt],n=new Sf({eventSource:r,recognizers:i});n.installHandlers("prevent-context-menu",[new h$e],Xg.INTERNAL),n.installHandlers("navigation",[new Npt(this.view),new Apt(this.view),new Dpt(this.view),new lge(this.view),new lge(this.view,[x4.counter]),new Spt(this.view,"primary"),new Ppt(this.view,x4.pan),new $pt(this.view,x4.zoom),new Ipt(this.view,x4.rotate),new Ept(this.view,"secondary"),new Tpt(this.view,"touch")],Xg.INTERNAL),this.view.viewEvents.connect(n),this._source=r,this._inputManager=n,ne(()=>{var s,o;return(o=(s=this.view)==null?void 0:s.navigation)==null?void 0:o.browserTouchPanEnabled},s=>{this._source&&(this._source.browserTouchPanningEnabled=!s)},Vt)}get test(){return{inputManager:this._inputManager}}};u([d()],gT.prototype,"view",void 0),u([d()],gT.prototype,"latestPointerType",null),u([d()],gT.prototype,"latestPointerLocation",null),u([d()],gT.prototype,"multiTouchActive",null),gT=u([$("esri.views.2d.input.MapViewInputManager")],gT);const Xpt=gT;var fge,mge,gge,TQ={},Ypt={get exports(){return TQ},set exports(t){TQ=t}};fge=Ypt,mge=function(){function t(n,s,o,a,l){e(n,s,o||0,a||n.length-1,l||i)}function e(n,s,o,a,l){for(;a>o;){if(a-o>600){var c=a-o+1,h=s-o+1,p=Math.log(c),f=.5*Math.exp(2*p/3),m=.5*Math.sqrt(p*f*(c-f)/c)*(h-c/2<0?-1:1);e(n,s,Math.max(o,Math.floor(s-h*f/c+m)),Math.min(a,Math.floor(s+(c-h)*f/c+m)),l)}var g=n[s],_=o,b=a;for(r(n,o,s),l(n[a],g)>0&&r(n,o,a);_<b;){for(r(n,_,b),_++,b--;l(n[_],g)<0;)_++;for(;l(n[b],g)>0;)b--}l(n[o],g)===0?r(n,o,b):r(n,++b,a),b<=s&&(o=b+1),s<=b&&(a=b-1)}}function r(n,s,o){var a=n[s];n[s]=n[o],n[o]=a}function i(n,s){return n<s?-1:n>s?1:0}return t},(gge=mge())!==void 0&&(fge.exports=gge);const y$e=TQ;function Hz(t,e){if(!(this instanceof Hz))return new Hz(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&(typeof e=="function"?this.toBBox=e:this._initFormat(e)),this.clear()}function Zpt(t,e,r){if(!r)return e.indexOf(t);for(var i=0;i<e.length;i++)if(r(t,e[i]))return i;return-1}function cE(t,e){fI(t,0,t.children.length,e,t)}function fI(t,e,r,i,n){n||(n=XC(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(var s,o=e;o<r;o++)s=t.children[o],mI(n,t.leaf?i(s):s);return n}function mI(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function yge(t,e){return t.minX-e.minX}function _ge(t,e){return t.minY-e.minY}function oH(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function T4(t){return t.maxX-t.minX+(t.maxY-t.minY)}function Jpt(t,e){return(Math.max(e.maxX,t.maxX)-Math.min(e.minX,t.minX))*(Math.max(e.maxY,t.maxY)-Math.min(e.minY,t.minY))}function Kpt(t,e){var r=Math.max(t.minX,e.minX),i=Math.max(t.minY,e.minY),n=Math.min(t.maxX,e.maxX),s=Math.min(t.maxY,e.maxY);return Math.max(0,n-r)*Math.max(0,s-i)}function aH(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function S4(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function XC(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function vge(t,e,r,i,n){for(var s,o=[e,r];o.length;)(r=o.pop())-(e=o.pop())<=i||(s=e+Math.ceil((r-e)/i/2)*i,y$e(t,s,e,r,n),o.push(e,s,s,r))}Hz.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,r=[],i=this.toBBox;if(!S4(t,e))return r;for(var n,s,o,a,l=[];e;){for(n=0,s=e.children.length;n<s;n++)o=e.children[n],S4(t,a=e.leaf?i(o):o)&&(e.leaf?r.push(o):aH(t,a)?this._all(o,r):l.push(o));e=l.pop()}return r},collides:function(t){var e=this.data,r=this.toBBox;if(!S4(t,e))return!1;for(var i,n,s,o,a=[];e;){for(i=0,n=e.children.length;i<n;i++)if(s=e.children[i],S4(t,o=e.leaf?r(s):s)){if(e.leaf||aH(t,o))return!0;a.push(s)}e=a.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,r=t.length;e<r;e++)this.insert(t[e]);return this}var i=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var n=this.data;this.data=i,i=n}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=XC([]),this},remove:function(t,e){if(!t)return this;for(var r,i,n,s,o=this.data,a=this.toBBox(t),l=[],c=[];o||l.length;){if(o||(o=l.pop(),i=l[l.length-1],r=c.pop(),s=!0),o.leaf&&(n=Zpt(t,o.children,e))!==-1)return o.children.splice(n,1),l.push(o),this._condense(l),this;s||o.leaf||!aH(o,a)?i?(r++,o=i.children[r],s=!1):o=null:(l.push(o),c.push(r),r=0,i=o,o=o.children[0])}return this},toBBox:function(t){return t},compareMinX:yge,compareMinY:_ge,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var r=[];t;)t.leaf?e.push.apply(e,t.children):r.push.apply(r,t.children),t=r.pop();return e},_build:function(t,e,r,i){var n,s=r-e+1,o=this._maxEntries;if(s<=o)return cE(n=XC(t.slice(e,r+1)),this.toBBox),n;i||(i=Math.ceil(Math.log(s)/Math.log(o)),o=Math.ceil(s/Math.pow(o,i-1))),(n=XC([])).leaf=!1,n.height=i;var a,l,c,h,p=Math.ceil(s/o),f=p*Math.ceil(Math.sqrt(o));for(vge(t,e,r,f,this.compareMinX),a=e;a<=r;a+=f)for(vge(t,a,c=Math.min(a+f-1,r),p,this.compareMinY),l=a;l<=c;l+=p)h=Math.min(l+p-1,c),n.children.push(this._build(t,l,h,i-1));return cE(n,this.toBBox),n},_chooseSubtree:function(t,e,r,i){for(var n,s,o,a,l,c,h,p;i.push(e),!e.leaf&&i.length-1!==r;){for(h=p=1/0,n=0,s=e.children.length;n<s;n++)l=oH(o=e.children[n]),(c=Jpt(t,o)-l)<p?(p=c,h=l<h?l:h,a=o):c===p&&l<h&&(h=l,a=o);e=a||e.children[0]}return e},_insert:function(t,e,r){var i=this.toBBox,n=r?t:i(t),s=[],o=this._chooseSubtree(n,this.data,e,s);for(o.children.push(t),mI(o,n);e>=0&&s[e].children.length>this._maxEntries;)this._split(s,e),e--;this._adjustParentBBoxes(n,s,e)},_split:function(t,e){var r=t[e],i=r.children.length,n=this._minEntries;this._chooseSplitAxis(r,n,i);var s=this._chooseSplitIndex(r,n,i),o=XC(r.children.splice(s,r.children.length-s));o.height=r.height,o.leaf=r.leaf,cE(r,this.toBBox),cE(o,this.toBBox),e?t[e-1].children.push(o):this._splitRoot(r,o)},_splitRoot:function(t,e){this.data=XC([t,e]),this.data.height=t.height+1,this.data.leaf=!1,cE(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,r){var i,n,s,o,a,l,c,h;for(l=c=1/0,i=e;i<=r-e;i++)o=Kpt(n=fI(t,0,i,this.toBBox),s=fI(t,i,r,this.toBBox)),a=oH(n)+oH(s),o<l?(l=o,h=i,c=a<c?a:c):o===l&&a<c&&(c=a,h=i);return h},_chooseSplitAxis:function(t,e,r){var i=t.leaf?this.compareMinX:yge,n=t.leaf?this.compareMinY:_ge;this._allDistMargin(t,e,r,i)<this._allDistMargin(t,e,r,n)&&t.children.sort(i)},_allDistMargin:function(t,e,r,i){t.children.sort(i);var n,s,o=this.toBBox,a=fI(t,0,e,o),l=fI(t,r-e,r,o),c=T4(a)+T4(l);for(n=e;n<r-e;n++)s=t.children[n],mI(a,t.leaf?o(s):s),c+=T4(a);for(n=r-e-1;n>=e;n--)s=t.children[n],mI(l,t.leaf?o(s):s),c+=T4(l);return c},_adjustParentBBoxes:function(t,e,r){for(var i=r;i>=0;i--)mI(e[i],t)},_condense:function(t){for(var e,r=t.length-1;r>=0;r--)t[r].children.length===0?r>0?(e=t[r-1].children).splice(e.indexOf(t[r]),1):this.clear():cE(t[r],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}};let bge=class _$e{constructor(e,r){this.key=new cw(0,0,0,0),this.bounds=Kt(),this.objectIds=new Set,this.key.set(r);const i=e.getLODInfoAt(this.key);this.tileInfoView=e,this.tileInfoView.getTileBounds(this.bounds,this.key,!0),this.resolution=i.resolution,this.scale=i.scale,this.level=i.level}get id(){return this.key.id}get extent(){return ur.fromBounds(this.bounds,this.tileInfoView.tileInfo.spatialReference)}get transform(){return{originPosition:"upperLeft",scale:[this.resolution,this.resolution],translate:[this.bounds[0],this.bounds[3]]}}createChildTiles(){const e=this.key.getChildKeys(),r=Nc.acquire();for(let i=0;i<e.length;i++)r[i]=new _$e(this.tileInfoView,e[i]);return r}getQuantizationParameters(){return o3e.fromJSON({mode:"view",originPosition:"upperLeft",tolerance:this.resolution,extent:{xmin:this.bounds[0],ymin:this.bounds[1],xmax:this.bounds[2],ymax:this.bounds[3],spatialReference:this.tileInfoView.tileInfo.spatialReference}})}};const Jw={added:[],removed:[]},lH=new Set,Qpt=new cw(0,0,0,0);let eft=class extends Sn{constructor(e){super(),this._tiles=new Map,this._index=Hz(9,ue("esri-csp-restrictions")?r=>({minX:r.bounds[0],minY:r.bounds[1],maxX:r.bounds[2],maxY:r.bounds[3]}):[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]),this.tiles=[],this.tileScheme=e}destroy(){this.clear()}clear(){this.tiles.length=0,this._tiles.clear(),this._index.clear()}has(e){return this._tiles.has(e)}get(e){return this._tiles.get(e)}boundsIntersections(e){return this._index.search({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]})}updateTiles(e){const r={added:[],removed:[]};for(const i of e.added)if(!this.has(i)){const n=new bge(this.tileScheme,i);this._tiles.set(i,n),this._index.insert(n),r.added.push(n)}for(const i of e.removed)if(this.has(i)){const n=this.get(i);this._tiles.delete(i),this._index.remove(n),r.removed.push(n)}this.tiles.length=0,this._tiles.forEach(i=>this.tiles.push(i)),(r.added.length||r.removed.length)&&this.emit("update",r)}setViewState(e){const r=this.tileScheme.getTileCoverage(e,0);if(!r)return;const{spans:i,lodInfo:n}=r,{level:s}=n;if(i.length>0)for(const{row:o,colFrom:a,colTo:l}of i)for(let c=a;c<=l;c++){const h=Qpt.set(s,o,n.normalizeCol(c),n.getWorldForColumn(c)).id;if(lH.add(h),!this.has(h)){const p=new bge(this.tileScheme,h);this._tiles.set(h,p),this._index.insert(p),this.tiles.push(p),Jw.added.push(p)}}for(let o=this.tiles.length-1;o>=0;o--){const a=this.tiles[o];lH.has(a.id)||(this._tiles.delete(a.id),this.tiles.splice(o,1),this._index.remove(a),Jw.removed.push(a))}(Jw.added.length||Jw.removed.length)&&this.emit("update",Jw),UO.pool.release(r),lH.clear(),Jw.added.length=0,Jw.removed.length=0}},yT=class extends be{constructor(){super(...arguments),this.color=new Xe([0,255,255]),this.haloOpacity=1,this.fillOpacity=.25}equals(e){return this.color.equals(e.color)&&(this.haloColor||this.color).equals(e.haloColor||e.color)&&this.haloOpacity===e.haloOpacity&&this.fillOpacity===e.fillOpacity}};u([d({type:Xe})],yT.prototype,"color",void 0),u([d({type:Xe})],yT.prototype,"haloColor",void 0),u([d()],yT.prototype,"haloOpacity",void 0),u([d()],yT.prototype,"fillOpacity",void 0),yT=u([$("esri.views.2d.support.HighlightOptions")],yT);const v$e=yT,tft=t=>t.includes("Brush");let b$e=class{constructor(){this._names=new Map}begin(e){this._names.has(e)||(this._names.set(e,!1),tft(e)&&this.record("Esri.FirstDraw"),performance.mark(`Esri.${e}.Start`))}end(e){this._names.has(e)&&!this._names.get(e)&&(this._names.set(e,!0),performance.mark(`Esri.${e}.End`))}record(e){this._names.has(e)||(this._names.set(e,!0),performance.mark(`Esri.${e}`))}};function rft(t,e,r,i,n,s,o,a){t.ignorePadding&&(i={left:0,right:0,top:0,bottom:0});let l=null;t.width!=null&&t.height!=null?l=[t.width,t.height]:t.width==null&&t.height!=null?l=[t.height,t.height]:t.width!=null&&t.height==null?l=[t.width,t.width]:t.width==null&&t.height==null&&(l=null);const c=r[0]-(i.left+i.right),h=r[1]-(i.top+i.bottom);let p,f,m=t.area||{x:0,y:0,width:c,height:h};if(l){const g=c/h,_=l[0]/l[1];if(_>g){const b=m.width/_;m={x:m.x,y:Math.round(m.y+(m.height-b)/2),width:m.width,height:Math.round(b)}}else{const b=m.height*_;m={x:Math.round(m.x+(m.width-b)/2),y:m.y,width:Math.round(b),height:m.height}}}else l=[m.width,m.height];return l[0]>m.width?(p=Math.min(l[0]/m.width,e),f=l[0]/m.width/p):(p=1,f=l[0]/m.width),{resolutionScale:p,cropArea:{x:Math.round((m.x+i.left)*p),y:Math.round((m.y+i.top)*p),width:Math.round(m.width*p),height:Math.round(m.height*p)},outputScale:f,format:n,quality:s,children:o,rotation:a}}let EM=null,qz=!0;function cH(t,e,r){if(!t||!e)throw new Error("Cannot construct image data without dimensions");if(qz)try{return new ImageData(t,e)}catch{qz=!1}return w$e(t,e,r)}function ift(t,e,r,i){if(!e||!r)throw new Error("Cannot construct image data without dimensions");if(qz)try{return new ImageData(t,e,r)}catch{qz=!1}const n=w$e(e,r,i);return n.data.set(t,0),n}function nft(){return EM||(EM=document.createElement("canvas"),EM.width=1,EM.height=1),EM}function w$e(t,e,r){return r||(r=nft()),r.getContext("2d").createImageData(t,e)}const wge=2048,sft=1.5,oft=8;function aft(t,e){const{format:r,quality:i,rotation:n,disableDecorations:s}=t||{},o=Woe(t,e.padding),a=gft(t,{width:e.width-o.left-o.right,height:e.height-o.top-o.bottom}),{width:l,height:c}=mft(t,a),h=S$e(r),p=E$e[h];return{format:h,quality:_e(i??p,0,100),area:a,width:l,height:c,rotation:n,disableDecorations:!!s,ignoreBackground:!(!t||!t.ignoreBackground),ignorePadding:!(!t||!t.ignorePadding)}}function lft(t,e){const r=aft(t,e),i=r.area,n=r.width/i.width,s=Woe(r,e.padding),o=s.left+s.right,a=s.top+s.bottom,l=e.width-o,c=e.height-a,h=Math.floor(l*n+o),p=Math.floor(c*n+a),f=t&&t.layers?t.layers:[],m=r.ignoreBackground,g=r.ignorePadding;return{framebufferWidth:h,framebufferHeight:p,region:{x:Math.floor(i.x*n)+s.left,y:Math.floor(i.y*n)+s.top,width:r.width,height:r.height},format:r.format,quality:r.quality,rotation:r.rotation,pixelRatio:n,layers:f,disableDecorations:r.disableDecorations,ignoreBackground:m,ignorePadding:g,objectAndLayerIdColor:!1}}function uU(t,e,r){const{ctx:i,canvas:n}=x$e(t,r),s=i.getImageData(0,0,t.width,t.height),o=uft(n,e);return T$e(n),{dataUrl:o,data:s}}function hU(t,e){const{ctx:r,canvas:i}=x$e(t,e),n=r.getImageData(0,0,t.width,t.height);return T$e(i),n}function x$e(t,e){const r=cft();e.premultipliedAlpha&&bft(t),r.width=t.width,r.height=t.height;const i=r.getContext("2d",{willReadFrequently:!0});return i.putImageData(t,0,0),e.flipY&&vft(i),{ctx:i,canvas:r}}function T$e(t){t.width=0,t.height=0}function cft(){return R(uH)&&(uH=document.createElement("canvas")),uH}let uH=null;function uft(t,e){const r=wft[e.format],i=e.quality/100;return t.toDataURL(r,i)}function hft(t,e){const r=S$e(t),i=E$e[r];return{format:r,quality:_e(e??i,0,100)}}function dft(t,e){return e/Math.max(t[0],t[1])}function pft(t,e,r,i=0,n=0,s=t.width-i,o=t.height-n,a=!1){const{data:l}=t,{width:c,height:h,data:p}=e,f=s/c,m=o/h,g=Math.ceil(f/2),_=Math.ceil(m/2),b=t.width;for(let w=0;w<h;w++)for(let x=0;x<c;x++){const T=4*(x+(a?h-w-1:w)*c);let E=0,C=0,A=0,I=0,M=0,D=0;const U=(w+.5)*m;for(let z=Math.floor(w*m);z<(w+1)*m;z++){const B=Math.abs(U-(z+.5))/_,ee=(x+.5)*f,te=B*B;for(let K=Math.floor(x*f);K<(x+1)*f;K++){const W=Math.abs(ee-(K+.5))/g,N=Math.sqrt(te+W*W);if(N>=1)continue;let L=2*N*N*N-3*N*N+1;const F=4*(i+K+(n+z)*b);D+=L*l[F+3],C+=L,!r&&l[F+3]<255&&(L=L*l[F+3]/255),A+=L*l[F],I+=L*l[F+1],M+=L*l[F+2],E+=L}}p[T]=A/E,p[T+1]=I/E,p[T+2]=M/E,p[T+3]=D/C}return e}function fft(t,e,r){if(!e)return t;const{framebufferWidth:i,framebufferHeight:n,pixelRatio:s,region:o}=t,a=Woe(t,r),l=a.left+a.right,c=a.top+a.bottom,h=i-l,p=n-c,f=Math.min(oft,Math.min((wge-l)/h,(wge-c)/p));return f<sft?t:{...t,framebufferWidth:Math.round(h*f)+l,framebufferHeight:Math.round(p*f)+c,pixelRatio:s*f,resample:{region:{x:Math.round((o.x-a.left)*f)+a.left,y:Math.round((o.y-a.top)*f)+a.top,width:Math.round(o.width*f),height:Math.round(o.height*f)},width:i,height:n}}}function mft(t,e){if(!t)return e;const r=t.width,i=t.height;if(r!=null&&i!=null)return{width:Math.floor(r),height:Math.floor(i)};if(r==null&&i==null)return e;const n=e.width/e.height;return i==null?{width:Math.floor(r),height:Math.floor(r/n)}:{width:Math.floor(i*n),height:Math.floor(i)}}function gft(t,e){const r={x:0,y:0,width:e.width,height:e.height};if(t&&t.area){t.area.x!=null&&(r.x=Math.floor(t.area.x)),t.area.y!=null&&(r.y=Math.floor(t.area.y));const i=t.area.width!=null?Math.floor(t.area.width):null,n=t.area.height!=null?Math.floor(t.area.height):null;if(r.width=e.width-r.x,r.height=e.height-r.y,i!=null&&n!=null)r.width=Math.min(r.width,i),r.height=Math.min(r.height,n);else if(i==null&&n!=null){const s=Math.min(r.width,i);r.height=s/r.width*r.height,r.width=s}else if(i!=null&&n==null){const s=Math.min(r.height,n);r.width=s/r.height*r.width,r.height=s}}return yft(_ft(r,t),e)}function yft(t,e){const r=Math.floor(Math.max(t.x,0)),i=Math.floor(Math.max(t.y,0)),n={x:r,y:i,width:Math.floor(Math.min(t.width,e.width-r)),height:Math.floor(Math.min(t.height,e.height-i))},s=n.width/n.height,o=t.width/t.height;if(o===s)return n;if(o>s){const c=Math.floor(n.width/o),h=n.height-c;return{x:n.x,y:Math.floor(n.y+h/2),width:n.width,height:c}}const a=Math.floor(n.height*o),l=n.width-a;return{x:Math.floor(n.x+l/2),y:n.y,width:a,height:n.height}}function _ft(t,e){if(!e||e.width==null||e.height==null)return t;const r=e.width/e.height,i=t.width/t.height;if(i===r)return t;if(i<r){const s=Math.floor(t.height*r);return t.x-=(s-t.width)/2,t.width=s,t}const n=Math.floor(t.width/r);return t.y-=(n-t.height)/2,t.height=n,t}function Woe(t,e){return!e||t&&t.ignorePadding?Tft:e}function S$e(t){switch(t){case"png":case"jpg":case"jpeg":return t;default:return xft}}function vft(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}function bft(t){const e=t.data,r=e.length;for(let i=0;i<r;i+=4){const n=e[i+3];if(n!==255&&n>0){const s=255/n;e[i+0]=e[i+0]*s,e[i+1]=e[i+1]*s,e[i+2]=e[i+2]*s}}}const wft={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},xge=98,xft="png",E$e={png:100,jpg:xge,jpeg:xge},Tft={top:0,right:0,bottom:0,left:0};var Et;function Sft(t,e,r={}){const i=C$e(t);for(;i.length>1;){const n=Wz(e,i.shift(),r);if(v(n))return n}return Eft(e,i.shift(),r)}function C$e(t){const e=ue("esri-force-webgl");if(e===Et.WEBGL1||e===Et.WEBGL2)return[e];switch(t){case"2d":return ue("mac")&&ue("chrome")?[Et.WEBGL1,Et.WEBGL2]:[Et.WEBGL2,Et.WEBGL1];case"3d":return[Et.WEBGL2,Et.WEBGL1]}}function Eft(t,e,r={}){if(!window.WebGLRenderingContext)return Tge(t,Cft),null;const i=Wz(t,e,r);return R(i)&&Tge(t,Aft),i}function Wz(t,e,r={}){const i=e===Et.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"];let n=null;for(const s of i){try{n=t.getContext(s,r)}catch{}if(n)break}return n}function Tge(t,e){const r=t.parentNode;r&&(r.innerHTML='<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+e+"</div></div></td></tr></table>")}(function(t){t[t.WEBGL1=1]="WEBGL1",t[t.WEBGL2=2]="WEBGL2"})(Et||(Et={}));const Cft='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',Aft=`It doesn't appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>`;let hH,dH;function Rft(t){const e=C$e(t);for(;e.length>1;){const r=Sge(e.shift());if(r.available)return r}return Sge(e.shift())}function Sge(t){switch(t){case Et.WEBGL1:return Oft();case Et.WEBGL2:return Mft()}}function Oft(){return hH||(hH=$ft()),hH}function Mft(){return dH||(dH=Lft()),dH}let A$e=class{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsElementIndexUint=!1,this.supportsStandardDerivatives=!1,this.supportsInstancedArrays=!1,this.supportsTextureFloat=!1,this.supportsTextureHalfFloat=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}},Pft=class extends A$e{constructor(){super(...arguments),this.type=Et.WEBGL1}},Ift=class extends A$e{constructor(){super(...arguments),this.type=Et.WEBGL2,this.supportsElementIndexUint=!0,this.supportsStandardDerivatives=!0,this.supportsInstancedArrays=!0,this.supportsTextureFloat=!0,this.supportsTextureHalfFloat=!0}};function R$e(t,e){var s;if(t===Et.WEBGL1&&typeof WebGLRenderingContext>"u"||t===Et.WEBGL2&&typeof WebGL2RenderingContext>"u")return null;const r=document.createElement("canvas");if(!r)return null;let i=Wz(r,t,{failIfMajorPerformanceCaveat:!0});if(R(i)&&(i=Wz(r,t),v(i)&&(e.majorPerformanceCaveat=!0)),R(i))return i;if(t===Et.WEBGL1){const o=(s=i.getParameter(i.VERSION))==null?void 0:s.match(/^WebGL\s+([\d.]*)/);if(o){const a=parseFloat(o[1]);e.available=a>=.94}}else e.available=!0;e.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),e.supportsVertexShaderSamplers=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const n=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);return n&&(e.supportsHighPrecisionFragment=n.precision>0),i}function $ft(){const t=new Pft,e=R$e(Et.WEBGL1,t);return R(e)||(t.supportsElementIndexUint=e.getExtension("OES_element_index_uint")!==null,t.supportsStandardDerivatives=e.getExtension("OES_standard_derivatives")!==null,t.supportsInstancedArrays=e.getExtension("ANGLE_instanced_arrays")!==null,t.supportsTextureFloat=e.getExtension("OES_texture_float")!==null,t.supportsTextureHalfFloat=e.getExtension("OES_texture_half_float")!==null,t.supportsColorBufferFloat=e.getExtension("WEBGL_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=e.getExtension("EXT_color_buffer_half_float")!==null),t}function Lft(){const t=new Ift,e=R$e(Et.WEBGL2,t);return R(e)||(t.supportsColorBufferFloat=e.getExtension("EXT_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=t.supportsColorBufferFloat||e.getExtension("EXT_color_buffer_half_float")!==null),t}function O$e(t){const e=Rft(t);if(!e.available)return new H("webgl:required","WebGL is required but not supported.");if(t==="3d"&&e.majorPerformanceCaveat)return new H("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!e.supportsHighPrecisionFragment)return new H("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!e.supportsVertexShaderSamplers)return new H("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(e.type===Et.WEBGL1){if(!e.supportsElementIndexUint)return new H("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!e.supportsStandardDerivatives)return new H("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!e.supportsInstancedArrays)return new H("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null}function Dft(t){return t&&"nodeType"in t}function Nft(t){return t&&typeof t.render=="function"}const Ege={component:"esri-component"};let _T=class extends be{constructor(){super(...arguments),this.widget=null}destroy(){this.widget&&this.widget.destroy(),this.node=null}get id(){return this.get("widget.id")||this.get("node.id")}set node(e){const r=this._get("node");e!==r&&(e&&e.classList.add(Ege.component),r&&r.classList.remove(Ege.component),this._set("node",e))}castNode(e){return e?typeof e=="string"||Dft(e)?(this._set("widget",null),nB(e)):(Nft(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};u([d({dependsOn:[]})],_T.prototype,"id",null),u([d()],_T.prototype,"node",null),u([cr("node")],_T.prototype,"castNode",null),u([d({readOnly:!0})],_T.prototype,"widget",void 0),_T=u([$("esri.views.ui.Component")],_T);const dU=_T,Fft={left:0,top:0,bottom:0,right:0},M$e={bottom:30,top:15,right:15,left:15},pH="manual",Ly="esri-ui",sc={ui:Ly,corner:`${Ly}-corner`,innerContainer:`${Ly}-inner-container`,manualContainer:`${Ly}-manual-container`,cornerContainer:`${Ly}-corner-container`,topLeft:`${Ly}-top-left`,topRight:`${Ly}-top-right`,bottomLeft:`${Ly}-bottom-left`,bottomRight:`${Ly}-bottom-right`};function kft(t){return t&&!t._started&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}function fH(t){const e=t,r=typeof e=="object"&&e!==null&&Object.getPrototypeOf(e);return(r===null||r===Object.prototype)&&("component"in e||"index"in e||"position"in e)?t:null}function mH(t,{top:e,bottom:r,left:i,right:n}){t.style.top=e,t.style.bottom=r,t.style.left=i,t.style.right=n}let og=class extends Sn.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentToKey=new Map,this._locale=mp(),this.view=null,this._applyViewPadding=()=>{const r=this.container;r&&mH(r,this._toPxPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const r=this._innerContainer;r&&mH(r,this._toPxPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([ne(()=>{var e;return[(e=this.view)==null?void 0:e.padding,this.container]},this._applyViewPadding,Vt),ne(()=>this.padding,this._applyUIPadding,Vt),ne(()=>[this.container,this._locale],([e,r])=>{e&&e.setAttribute("lang",r)},Vt),SEe(e=>{this._locale=e})])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._componentToKey.clear()}set container(e){const r=this._get("container");e!==r&&(e&&(e.classList.add(sc.ui),Met(e),this._attachContainers(e)),r&&(r.classList.remove(sc.ui),mH(r,{top:"",bottom:"",left:"",right:""}),tRe(r)),this._set("container",e))}get height(){const e=this.get("view.height")||0;if(e===0)return e;const r=this._getViewPadding(),i=r.top+r.bottom;return Math.max(e-i,0)}get padding(){return this._get("padding")}set padding(e){this._overrideIfSome("padding",e)}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:{...M$e,...e}}get width(){const e=this.get("view.width")||0;if(e===0)return e;const r=this._getViewPadding(),i=r.left+r.right;return Math.max(e-i,0)}add(e,r){let i,n;if(Array.isArray(e))return void e.forEach(o=>this.add(o,r));const s=fH(e);s&&({index:i,position:r,component:e,key:n}=s),r&&typeof r=="object"&&({index:i,key:n,position:r}=r),!e||r&&!this._isValidPosition(r)||this._add(e,r,i,n)}remove(e,r){if(!e)return;if(Array.isArray(e))return e.map(n=>this.remove(n,r));const i=this._find(e);if(i){const n=this._componentToKey;if(n.has(e)&&n.get(e)!==r)return;const s=this._components.indexOf(i);return i.node.parentNode&&i.node.parentNode.removeChild(i.node),this._componentToKey.delete(e),this._components.splice(s,1)[0]}}empty(e){return Array.isArray(e)?e.map(r=>this.empty(r)).reduce((r,i)=>r.concat(i)):(e=e||pH)===pH?Array.prototype.slice.call(this._manualContainer.children).filter(r=>!r.classList.contains(sc.corner)).map(r=>this.remove(r)):this._isValidPosition(e)?Array.prototype.slice.call(this._cornerNameToContainerLookup[e].children).map(this.remove,this):null}move(e,r){if(Array.isArray(e)&&e.forEach(o=>this.move(o,r)),!e)return;let i;const n=fH(e)||fH(r);if(n&&(i=n.index,r=n.position,e=n.component||e),r&&!this._isValidPosition(r))return;const s=this.remove(e);s&&this.add(s,{position:r,index:i})}find(e){if(!e)return null;const r=this._findById(e);return r&&(r.widget||r.node)}getPosition(e){for(const r in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[r].contains(e))return r;return null}_add(e,r,i,n){e instanceof dU||(e=new dU({node:e})),this._place({component:e,position:r,index:i}),this._components.push(e),n&&this._componentToKey.set(e,n)}_find(e){return e?e instanceof dU?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){return this.get("view.padding")||Fft}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(sc.innerContainer),e.classList.add(sc.cornerContainer);const r=document.createElement("div");r.classList.add(sc.innerContainer),r.classList.add(sc.manualContainer);const i=document.createElement("div");i.classList.add(sc.topLeft),i.classList.add(sc.corner),e.appendChild(i);const n=document.createElement("div");n.classList.add(sc.topRight),n.classList.add(sc.corner),e.appendChild(n);const s=document.createElement("div");s.classList.add(sc.bottomLeft),s.classList.add(sc.corner),e.appendChild(s);const o=document.createElement("div");o.classList.add(sc.bottomRight),o.classList.add(sc.corner),e.appendChild(o),this._innerContainer=e,this._manualContainer=r;const a=Ng();this._cornerNameToContainerLookup={"top-left":i,"top-right":n,"bottom-left":s,"bottom-right":o,"top-leading":a?n:i,"top-trailing":a?i:n,"bottom-leading":a?o:s,"bottom-trailing":a?s:o},this._positionNameToContainerLookup={manual:r,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const r=e.component,i=e.position||pH,n=e.index,s=this._positionNameToContainerLookup[i],o=n!=null&&n>-1;if(kft(r.widget)&&r.widget.startup(),!o)return void s.appendChild(r.node);const a=Array.prototype.slice.call(s.children);if(n===0)return void(s.firstChild?Mde(r.node,s.firstChild):s.appendChild(r.node));n>=a.length?s.appendChild(r.node):Mde(r.node,a[n])}_toPxPosition(e){return{top:this._toPxUnit(e.top),left:this._toPxUnit(e.left),right:this._toPxUnit(e.right),bottom:this._toPxUnit(e.bottom)}}_toPxUnit(e){return e===0?"0":e+"px"}_findByComponent(e){let r,i=null;return this._components.some(n=>(r=n===e,r&&(i=n),r)),i}_findById(e){let r,i=null;return this._components.some(n=>(r=n.id===e,r&&(i=n),r)),i}_findByNode(e){let r,i=null;return this._components.some(n=>(r=n.node===e,r&&(i=n),r)),i}};u([d()],og.prototype,"_locale",void 0),u([d()],og.prototype,"container",null),u([d()],og.prototype,"height",null),u([d({value:M$e})],og.prototype,"padding",null),u([cr("padding")],og.prototype,"castPadding",null),u([d()],og.prototype,"view",void 0),u([d()],og.prototype,"width",null),og=u([$("esri.views.ui.UI")],og);const Uft=og;function Cge(t,e){return t&&"copyright"in t&&(!e||typeof t.originOf=="function"&&t.originOf("copyright")==="user")}function zft(t,e){return t.length!==e.length||t.some((r,i)=>r.text!==e[i].text)}function E4(t,e,r){!r||!e||t.find(i=>i.layerView===e&&i.text===r)||t.push({text:r,layerView:e})}function Vft(t){return t.type==="bing-maps"}const gv=[];let YC=class extends eD{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.handles.remove("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new ct,this.view=null,this._allLayerViewsChange=r=>{this.handles.remove("suspension");const i=this.get("view.allLayerViews");i&&this.handles.add(i.map(n=>ne(()=>{var s;return[n.suspended,(s=n.layer)==null?void 0:s.attributionVisible]},()=>this._updateAttributionItems())),"suspension"),r&&r.removed&&r.removed.forEach(n=>{this._pendingAttributions.delete(n),this._fetchedAttributionData.delete(n)}),this._updateAttributionItems()},this.handles.add([Yn(()=>{var r;return(r=this.view)==null?void 0:r.allLayerViews},"change",r=>this._allLayerViewsChange(r),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),fo(()=>{var r;return((r=this.view)==null?void 0:r.stationary)===!0},()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const e=this.view,r=e==null?void 0:e.allLayerViews;gv.length=0,e&&r?(r.forEach(i=>{var o;if(i.suspended||!((o=i.layer)!=null&&o.attributionVisible))return;const n=i.layer;if(Cge(n,"user"))return void E4(gv,i,n.copyright);if(n.hasAttributionData){if(this._fetchedAttributionData.has(i)){const a=this._fetchedAttributionData.get(i);return void(a?E4(gv,i,this._getDynamicAttribution(a,e,n)):Cge(n)&&E4(gv,i,n.copyright))}return void this._fetchAttributionData(i)}const s=n.get("portalItem.accessInformation");E4(gv,i,s||n.copyright)}),zft(this.items,gv)&&(this.items.removeAll(),this.items.addMany(gv)),gv.length=0,this.notifyChange("state")):this._clear()}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const r=await hm(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const i=r.ok?this._createContributionIndex(r.value,Vft(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,i)}this._updateAttributionItems()}_createContributionIndex(e,r){const i=e.contributors,n={};if(!i)return n;for(let s=0;s<i.length;s++){const o=i[s],a=o.coverageAreas;if(!a)return;for(const l of a){const c=l.bbox,h=l.zoomMin-(r&&l.zoomMin?1:0),p=l.zoomMax-(r&&l.zoomMax?1:0),f={xmin:c[1],ymin:c[0],xmax:c[3],ymax:c[2],spatialReference:Je.WGS84},m={extent:Gg(f),attribution:o.attribution||"",score:l.score!=null?l.score:100,id:s};for(let g=h;g<=p;g++)n[g]=n[g]||[],n[g].push(m)}}return n.maxKey=Math.max.apply(null,Object.keys(n)),n}_getDynamicAttribution(e,r,i){var h;const{extent:n,scale:s}=r;let o=((h=i.tileInfo)==null?void 0:h.scaleToZoom(s))??0;if(o=Math.min(e.maxKey??0,Math.round(o)),!n||o==null||o<=-1)return"";const a=e[o],l=D2(n.center.clone().normalize(),r.spatialReference),c={};return a?a.filter(p=>{const f=p.id,m=!c[f]&&l&&p.extent&&R9(p.extent,l);return m&&(c[f]=!0),m}).sort((p,f)=>f.score-p.score||p.objectId-f.objectId).map(p=>p.attribution).join(", "):""}};u([d({readOnly:!0,type:ct})],YC.prototype,"items",void 0),u([d({readOnly:!0})],YC.prototype,"state",null),u([d()],YC.prototype,"view",void 0),YC=u([$("esri.widgets.Attribution.AttributionViewModel")],YC);const P$e=YC,uE="esri-attribution",yv={base:`${uE} esri-widget`,poweredBy:`${uE}__powered-by`,sources:`${uE}__sources`,open:`${uE}--open`,sourcesOpen:`${uE}__sources--open`,link:`${uE}__link`,widgetIcon:"esri-icon-description",interactive:"esri-interactive"};let vc=class extends Ga{constructor(e,r){super(e,r),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(i=>i.forEach(({target:n})=>this._checkSourceTextOverflow(n))),this.iconClass=yv.widgetIcon,this.itemDelimiter=" | ",this.messages=null,this.viewModel=new P$e}initialize(){this.addHandles(Yn(()=>{var e;return(e=this.viewModel)==null?void 0:e.items},"change",()=>this.scheduleRender()))}destroy(){var e;(e=this._resizeObserver)==null||e.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,r)=>(e.includes(r.text)||e.push(r.text),e),[]).join(this.itemDelimiter)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[yv.open]:this._isOpen};return ie("div",{bind:this,class:this.classes(yv.base,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())}renderPoweredBy(){return ie("div",{class:yv.poweredBy},"Powered by"," ",ie("a",{class:yv.link,href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))}renderSourcesNode(){const e=this._isOpen,r=this._isInteractive,i=r?"0":"",{attributionText:n}=this,s={[yv.sourcesOpen]:e,[yv.interactive]:r};return ie("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(yv.sources,s),innerHTML:n,tabindex:i})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let r=!1;const{clientHeight:i,clientWidth:n,scrollWidth:s}=e,o=s>n,a=this._attributionTextOverflowed!==o;if(this._attributionTextOverflowed=o,a&&(r=!0),this._isOpen){const l=i<this._prevSourceNodeHeight;this._prevSourceNodeHeight=i,l&&(this._isOpen=!1,r=!0)}r&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};u([d()],vc.prototype,"_isOpen",void 0),u([d()],vc.prototype,"_isInteractive",null),u([d()],vc.prototype,"_attributionTextOverflowed",void 0),u([d()],vc.prototype,"_prevSourceNodeHeight",void 0),u([d({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],vc.prototype,"attributionText",null),u([d()],vc.prototype,"iconClass",void 0),u([d()],vc.prototype,"itemDelimiter",void 0),u([d()],vc.prototype,"label",null),u([d(),_a("esri/widgets/Attribution/t9n/Attribution")],vc.prototype,"messages",void 0),u([d()],vc.prototype,"view",null),u([d({type:P$e})],vc.prototype,"viewModel",void 0),u([Ph()],vc.prototype,"_toggleState",null),vc=u([$("esri.widgets.Attribution")],vc);const Bft=vc,jft="esri.widgets.CompassViewModel";let vT=class extends aIe(be){constructor(e){super(e),this._handles=new qr,this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._handles.add(ne(()=>this.view,this._updateRotationWatcher,Vt))}destroy(){$i(this._handles),this.view=null}get canShowNorth(){const e=this.get("view.spatialReference");return!(!e||!e.isWebMercator&&!e.isGeographic)}get state(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}reset(){var r;if(!this.get("view.ready"))return;const e={};((r=this.view)==null?void 0:r.type)==="2d"?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){e!=null&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const r=-e.heading;this.orientation={x:0,y:0,z:r}}_updateRotationWatcher(e){this._handles.removeAll(),e&&this._handles.add(e.type==="2d"?ne(()=>e==null?void 0:e.rotation,this._updateForRotation,Vt):ne(()=>e==null?void 0:e.camera,this._updateForCamera,Vt))}};u([d({readOnly:!0})],vT.prototype,"canShowNorth",null),u([d()],vT.prototype,"orientation",void 0),u([d({readOnly:!0})],vT.prototype,"state",null),u([d()],vT.prototype,"view",void 0),vT=u([$(jft)],vT);const I$e=vT,_v={base:"esri-compass esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",icon:"esri-compass__icon",rotationIcon:"esri-icon-dial",northIcon:"esri-icon-compass",widgetIcon:"esri-icon-locate-circled",interactive:"esri-interactive",disabled:"esri-disabled"};let ag=class extends Ga{constructor(e,r){super(e,r),this.iconClass=_v.widgetIcon,this.messages=null,this.viewModel=new I$e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:r}=this.viewModel,i=r==="disabled",n=(r==="rotation"?"rotation":"compass")=="compass",s=i?-1:0,o={[_v.disabled]:i,[_v.interactive]:!i},a={[_v.northIcon]:n,[_v.rotationIcon]:!n},{messages:l}=this;return ie("div",{bind:this,class:this.classes(_v.base,o),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:s,"aria-label":l.reset,title:l.reset},ie("span",{"aria-hidden":"true",class:this.classes(_v.icon,a),styles:this._toRotationTransform(e)}),ie("span",{class:_v.text},l.reset))}_reset(){this.viewModel.reset()}_toRotationTransform(e){return{transform:`rotateZ(${e.z}deg)`}}};u([d()],ag.prototype,"goToOverride",null),u([d()],ag.prototype,"iconClass",void 0),u([d()],ag.prototype,"label",null),u([d(),_a("esri/widgets/Compass/t9n/Compass")],ag.prototype,"messages",void 0),u([d()],ag.prototype,"view",null),u([d({type:I$e})],ag.prototype,"viewModel",void 0),u([Ph()],ag.prototype,"_reset",null),ag=u([$("esri.widgets.Compass")],ag);const Gft=ag,hE="esri-navigation-toggle",md={base:`${hE} esri-widget`,button:`${hE}__button esri-widget--button`,activeButton:`${hE}__button--active`,panButton:`${hE}__button--pan`,rotateButton:`${hE}__button--rotate`,isLayoutHorizontal:`${hE}--horizontal`,rotationIcon:"esri-icon-rotate",panIcon:"esri-icon-pan",widgetIcon:"esri-icon-pan2",disabled:"esri-disabled"};let ZC=class extends be{constructor(e){super(e),this.navigationMode="pan",this.view=null}initialize(){this.own(fo(()=>{var e;return(e=this.view)==null?void 0:e.inputManager},()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){var e;return this.get("view.ready")&&((e=this.view)==null?void 0:e.type)==="3d"?"ready":"disabled"}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){this.get("view.inputManager").primaryDragAction=this.navigationMode==="pan"?"pan":"rotate"}};u([d({readOnly:!0})],ZC.prototype,"state",null),u([d()],ZC.prototype,"navigationMode",void 0),u([d()],ZC.prototype,"view",void 0),ZC=u([$("esri.widgets.NavigationToggleViewModel")],ZC);const $$e=ZC;let lg=class extends Ga{constructor(e,r){super(e,r),this.iconClass=md.widgetIcon,this.messages=null,this.viewModel=new $$e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}toggle(){return this.viewModel.toggle()}render(){const e=this.get("viewModel.state")==="disabled",r=this.get("viewModel.navigationMode")==="pan",i={[md.disabled]:e,[md.isLayoutHorizontal]:this.layout==="horizontal"},n={[md.activeButton]:r},s={[md.activeButton]:!r},o=e?-1:0,a=this.messages.toggle;return ie("div",{bind:this,class:this.classes(md.base,i),onclick:this._toggle,onkeydown:this._toggle,tabIndex:o,"aria-label":a,title:a},ie("div",{class:this.classes(md.button,md.panButton,n)},ie("span",{class:md.panIcon})),ie("div",{class:this.classes(md.button,md.rotateButton,s)},ie("span",{class:md.rotationIcon})))}_toggle(){this.toggle()}};u([d()],lg.prototype,"iconClass",void 0),u([d()],lg.prototype,"label",null),u([d({value:"vertical"})],lg.prototype,"layout",null),u([d(),_a("esri/widgets/NavigationToggle/t9n/NavigationToggle")],lg.prototype,"messages",void 0),u([d()],lg.prototype,"view",null),u([d({type:$$e})],lg.prototype,"viewModel",void 0),u([Ph()],lg.prototype,"_toggle",null),lg=u([$("esri.widgets.NavigationToggle")],lg);const Hft=lg,CM={button:"esri-widget--button esri-widget",disabled:"esri-disabled",interactive:"esri-interactive",iconText:"esri-icon-font-fallback-text",icon:"esri-icon"};let m1=class extends Ga{constructor(){super(...arguments),this.enabled=!0,this.iconClass="",this.title=""}render(){const e=this.enabled?0:-1,r={[CM.disabled]:!this.enabled,[CM.interactive]:this.enabled},i={[this.iconClass]:!!this.iconClass};return ie("div",{bind:this,class:this.classes(CM.button,r),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:e,title:this.title},ie("span",{"aria-hidden":"true",role:"presentation",class:this.classes(CM.icon,i)}),ie("span",{class:CM.iconText},this.title))}_triggerAction(){this.action.call(this)}};u([d()],m1.prototype,"action",void 0),u([d()],m1.prototype,"enabled",void 0),u([d()],m1.prototype,"iconClass",void 0),u([d()],m1.prototype,"title",void 0),u([Ph()],m1.prototype,"_triggerAction",null),m1=u([$("esri.widgets.IconButton")],m1);const Age=m1;let JC=class extends be{get canZoomIn(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),r=this.get("view.constraints.effectiveMaxScale");return r===0||e>r}get canZoomOut(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),r=this.get("view.constraints.effectiveMinScale");return r===0||e<r}};u([d({readOnly:!0})],JC.prototype,"canZoomIn",null),u([d({readOnly:!0})],JC.prototype,"canZoomOut",null),u([d()],JC.prototype,"view",void 0),JC=u([$("esri.widgets.Zoom.ZoomConditions2D")],JC);const qft=JC;let KC=class extends be{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};u([d({readOnly:!0})],KC.prototype,"canZoomIn",null),u([d({readOnly:!0})],KC.prototype,"canZoomOut",null),u([d()],KC.prototype,"view",void 0),KC=u([$("esri.widgets.Zoom.ZoomConditions3D")],KC);const Wft=KC;let g1=class extends be{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return v(this._zoomConditions)&&this._zoomConditions.canZoomIn}get canZoomOut(){var e;return v(this._zoomConditions)&&((e=this._zoomConditions)==null?void 0:e.canZoomOut)}get state(){var e;return(e=this.view)!=null&&e.ready?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new qft({view:e}):e.type==="3d"&&(this._zoomConditions=new Wft({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():bR(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():bR(e.goTo({zoomFactor:.5}))}};u([d()],g1.prototype,"_zoomConditions",void 0),u([d()],g1.prototype,"canZoomIn",null),u([d()],g1.prototype,"canZoomOut",null),u([d({readOnly:!0})],g1.prototype,"state",null),u([d()],g1.prototype,"view",null),g1=u([$("esri.widgets.Zoom.ZoomViewModel")],g1);const L$e=g1,AM={base:"esri-zoom esri-widget",horizontalLayout:"esri-zoom--horizontal",zoomInIcon:"esri-icon-plus",zoomOutIcon:"esri-icon-minus",widgetIcon:"esri-icon-zoom-in-magnifying-glass"};let f0=class extends Ga{constructor(e,r){super(e,r),this.iconClass=AM.widgetIcon,this.messages=null,this.viewModel=new L$e}initialize(){this._zoomInButton=new Age({action:this.zoomIn.bind(this),iconClass:AM.zoomInIcon}),this._zoomOutButton=new Age({action:this.zoomOut.bind(this),iconClass:AM.zoomOutIcon})}destroy(){this._zoomInButton=ze(this._zoomInButton),this._zoomOutButton=ze(this._zoomOutButton)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}set view(e){this.viewModel.view=e}get view(){return this.viewModel.view}render(){const e=this.viewModel,r={[AM.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:i,canZoomOut:n}=e;this._zoomInButton.enabled=i,this._zoomOutButton.enabled=n;const{zoomIn:s,zoomOut:o}=this.messages;return this._zoomInButton.title=s,this._zoomOutButton.title=o,ie("div",{class:this.classes(AM.base,r)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};u([d()],f0.prototype,"iconClass",void 0),u([d()],f0.prototype,"label",null),u([d({value:"vertical"})],f0.prototype,"layout",null),u([d(),_a("esri/widgets/Zoom/t9n/Zoom")],f0.prototype,"messages",void 0),u([d()],f0.prototype,"view",null),u([d({type:L$e})],f0.prototype,"viewModel",void 0),f0=u([$("esri.widgets.Zoom")],f0);const Xft=f0;function Yft(t){return t&&t.view!==void 0}let pU=class extends Uft{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[]}initialize(){this.addHandles([ne(()=>this.components,this._componentsWatcher.bind(this),Vt),ne(()=>this.view,this._updateViewAwareWidgets.bind(this),Vt)])}_add(e,r,i,n){let s=e;if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;s=this._createComponent(e)}super._add(s,r,i,n)}_removeComponents(e){e.forEach(r=>{const i=this._find(r);i&&(this.remove(i),i.destroy())})}_updateViewAwareWidgets(e){this.components.forEach(r=>{const i=this._find(r),n=i&&i.widget;Yft(n)&&(n.view=e)})}_componentsWatcher(e,r){this._removeComponents(r),this._addComponents(e),this._adjustPadding(e)}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:r}=this.padding;this.padding=r}}_addComponents(e){this.constructed&&e.forEach(r=>this.add(this._createComponent(r),this._defaultPositionLookup[r]))}_createComponent(e){const r=this._createWidget(e);if(r)return new dU({id:e,node:r})}_createWidget(e){return e==="attribution"?this._createAttribution():e==="compass"?this._createCompass():e==="navigation-toggle"?this._createNavigationToggle():e==="zoom"?this._createZoom():void 0}_createAttribution(){return new Bft({view:this.view})}_createCompass(){return new Gft({view:this.view})}_createNavigationToggle(){return new Hft({view:this.view})}_createZoom(){return new Xft({view:this.view})}};u([d()],pU.prototype,"components",void 0),pU=u([$("esri.views.ui.DefaultUI")],pU);const D$e=pU;let fU=class extends D$e{constructor(e){super(e),this.components=["attribution","zoom"]}};u([d()],fU.prototype,"components",void 0),fU=u([$("esri.views.ui.2d.DefaultUI2D")],fU);const N$e=fU;var SQ;let mU=SQ=class extends fe{constructor(t){super(t),this.color=new Xe([0,0,0,1])}clone(){return new SQ(se({color:this.color}))}};u([d({type:Xe,json:{write:!0}})],mU.prototype,"color",void 0),mU=SQ=u([$("esri.webmap.background.ColorBackground")],mU);const LB=mU;let F$e,k$e,U$e,z$e,V$e,B$e;async function Zft(){const[,{GraphicsView2D:t,GraphicContainer:e,LabelManager:r,MapViewNavigation:i,MagnifierView2D:n,Stage:s}]=await Promise.all([Q(()=>import("./webglDeps-49a4afea.js"),["assets/webglDeps-49a4afea.js","assets/ShaderCompiler-77d0dcb6.js","assets/programUtils-f035fe8a.js","assets/ProgramTemplate-1b0f517f.js"]),Q(()=>import("./mapViewDeps-107e8873.js"),["assets/mapViewDeps-107e8873.js","assets/CIMResourceManager-838fa5d5.js","assets/Rasterizer-4d37f68f.js","assets/_commonjsHelpers-2f3e7994.js","assets/cimAnalyzer-c61475d8.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/enums-4b2a86a0.js","assets/alignmentUtils-ae955d28.js","assets/definitions-3ddd14a8.js","assets/number-b10bd8f5.js","assets/Rect-ea14f53a.js","assets/rasterizingUtils-4ed124bb.js","assets/imageutils-d17d5606.js","assets/Container-11969b8c.js","assets/BufferPool-bd8fed81.js","assets/enums-b1d611e3.js","assets/WGLContainer-ac65aabf.js","assets/WGLBrushVTLSymbol-3a605920.js","assets/StyleDefinition-7d58136b.js","assets/GeometryUtils-dd03fc25.js","assets/color-9f576cea.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-1b0f517f.js","assets/MaterialKey-071ea281.js","assets/utils-862b3f6d.js","assets/heatmapTextureUtils-fcd30222.js","assets/VTLMaterialManager-92c4316f.js","assets/programUtils-f035fe8a.js","assets/MagnifierPrograms-93e2232c.js","assets/Matcher-47b5ff38.js","assets/visualVariablesUtils-f04c4def.js","assets/visualVariablesUtils-fbbca9e0.js","assets/tileUtils-c2f19f52.js","assets/TurboLine-8bc5ef2e.js","assets/ExpandedCIM-aa517771.js","assets/CircularArray-f03cccc5.js","assets/ComputedAttributeStorage-eff52a13.js","assets/arcadeTimeUtils-f06505ea.js","assets/executionError-fb3f283a.js","assets/centroid-f5daa837.js","assets/MaterialPrograms-366125b9.js","assets/GraphicsView2D-7b26e85b.js","assets/projectionSupport-d70ac199.js","assets/json-48e3ea08.js","assets/AttributeStoreView-2b8ac15d.js","assets/schemaUtils-95f69e1c.js","assets/util-dd1f0345.js","assets/GraphicsView-f9d61ea4.js","assets/GraphicContainer-7120c266.js","assets/BaseGraphicContainer-6c950b21.js","assets/FeatureContainer-987f9077.js","assets/TileContainer-a917d354.js"])]);k$e=t,U$e=e,z$e=r,V$e=i,B$e=n,F$e=s}const Rge=160;function Jft(t){return t&&t.declaredClass==="esri.Viewpoint"}let dr=class extends eRe(cIe(uIe(CIe))){constructor(e){super(e),this._magnifierView=null,this._stage=null,this._resolveWhenReady=[],this.rootLayerViews=new wO({getCollections:()=>{var r,i;return[(r=this.basemapView)==null?void 0:r.baseLayerViews,this.layerViews,(i=this.basemapView)==null?void 0:i.referenceLayerViews]},getChildrenFunction:()=>null}),this.featuresTilingScheme=null,this.fullOpacity=1,this.graphicsView=null,this.labelManager=null,this.mapViewNavigation=null,this.renderingOptions={samplingMode:"dynamic",edgeLabelsVisible:!0,labelsAnimationTime:125,labelCollisionsEnabled:!0},this.rendering=!1,this.supersampleScreenshotsEnabled=!0,this.supportsGround=!1,this._stationaryTimer=null,this._gotoTask=null,this.frameTask=new Udt(this),this._pePromise=null,this.floors=new ct,this.highlightOptions=new v$e,this.inputManager=new Xpt({view:this}),this.map=null,this.resizeAlign="center",this.spatialReferenceLocked=!1,this.timeline=new b$e,this.type="2d",this.ui=new N$e,this._pixelFormat={flipY:!0,premultipliedAlpha:!0},this.constraints=new JIe,this.padding={top:0,right:0,bottom:0,left:0},this.handles.add([ne(()=>this.viewpoint,()=>{this._lastStationaryEventTimestamp=performance.now(),this._flipStationary(Rge)},Zr),this.on("resize",r=>this._resizeHandler(r)),ne(()=>{var r;return(r=this.animationManager)==null?void 0:r.animation},r=>{this.animation=r})]),bAe()}destroy(){this._set("preconditionsReady",!1),this._gotoTask=this.frameTask=null,this.rootLayerViews.destroy(),this.inputManager.destroy(),this._set("inputManager",null)}get graphicsTileStore(){return new eft(this.featuresTilingScheme)}get initialExtentRequired(){var a;const{scale:e,constraints:r,center:i,viewpoint:n,extent:s}=this;let o=this.zoom;return!(this.map&&"initialViewProperties"in this.map&&((a=this.map.initialViewProperties)!=null&&a.viewpoint))&&!s&&(r!=null&&r.effectiveLODs||(o=-1),(!i||e===0&&o===-1)&&(!n||!v(n.targetGeometry)||n.targetGeometry.type!=="extent"&&!n.scale))}get resourceManager(){return this._stage.resourceManager}get textureManager(){return this._stage.painter.textureManager}get _defaultsFromMapSettings(){return{required:{tileInfo:!0,heightModelInfo:!1,extent:!1},requiresExtentInSpatialReference:this.spatialReferenceLocked}}get _projectionEngineLoaded(){return!!i2()||(this._pePromise||(this._pePromise=n2().finally(()=>{this._pePromise=null})),!1)}get typeSpecificPreconditionsReady(){const e=this._getDefaultViewpoint();if(!e)return!1;const r=this.spatialReference,i=e.targetGeometry;return!!cy(i.spatialReference,r)||this._projectionEngineLoaded}set animation(e){const r=this._get("animation");if(e===r)return;if(r&&r.stop(),!e||e.isFulfilled())return void this._set("animation",null);this._set("animation",e),this.frameTask.animationInProgress=!0;const i=()=>{var n;e===this._get("animation")&&(this._set("animation",null),(n=this.frameTask)==null||n.requestFrame()),this.frameTask&&(this.frameTask.animationInProgress=!1)};e.when(i,i)}get background(){return Kft(this.map)?this.map.initialViewProperties.background:null}set background(e){this._override("background",e)}get center(){if(!this.ready)return this._get("center");const{center:e,spatialReference:r}=this.state.paddedViewState;return new Ue({x:e[0],y:e[1],spatialReference:r})}set center(e){if(e==null)return;if(!this.ready)return this._set("center",e),void this.notifyChange("initialExtentRequired");let r;try{r=this._project(e,this.spatialReference)}catch(n){return void re.getLogger(this.declaredClass).error(new H("mapview:invalid-center","could not project the value in the view's spatial reference",{input:e,error:n}))}const i=this.viewpoint;fQ(i,i,r),this.viewpoint=i}set constraints(e){const r=this._get("constraints");r&&(this.handles.remove("map-view-constraints"),r.destroy()),this._set("constraints",e),e&&(e.view=this,this.ready&&(this.state.viewpoint=e.fit(this.state.paddedViewState.viewpoint)),this.handles.add(ne(()=>e.version,()=>{this.ready&&this.state&&(this.state.viewpoint=e.fit(this.state.paddedViewState.viewpoint))},Zr),"map-view-constraints"))}get extent(){return this.ready?this.state.paddedViewState.extent.clone():this._get("extent")}set extent(e){if(e==null)return;if(!e.width||!e.height)return void re.getLogger(this.declaredClass).error(new H("mapview:invalid-extent","invalid extent size"));if(!this.ready)return this._set("extent",e),this._set("center",null),this._set("viewpoint",null),this._set("scale",0),this._set("zoom",-1),void this.notifyChange("initialExtentRequired");let r;try{r=this._project(e,this.spatialReference)}catch(n){return void re.getLogger(this.declaredClass).error(new H("mapview:invalid-extent","could not project the value in the view's spatial reference",{error:n}))}const i=this.viewpoint;Tdt(i,i,r,this.size,{constraints:this.constraints}),this.viewpoint=i}get padding(){return this.ready?this.state.padding:this._get("padding")}set padding(e){this.ready?(this.state.padding=e,this._set("padding",this.state.padding)):this._set("padding",e)}get resolution(){return this.state?this.state.resolution:0}get rotation(){return this.ready?this.state.rotation:this._get("rotation")}set rotation(e){if(isNaN(e))return;if(!this.ready)return void this._set("rotation",e);const r=this.viewpoint;Ddt(r,r,e),this.viewpoint=r}get scale(){return this.ready?this.state.scale:this._get("scale")}set scale(e){if(!e||isNaN(e))return;if(!this.ready){this._set("scale",e),this._set("zoom",-1);const i=this._get("extent");return i&&(this._set("extent",null),this._set("center",i.center)),void this.notifyChange("initialExtentRequired")}const r=this.viewpoint;rge(r,r,e),this.viewpoint=r}get stationary(){return!(this.animation||this.navigating||this.resizing||this._stationaryTimer)}get updating(){var r,i,n;const e=!this.destroyed&&(!this.layerViewManager||!this.labelManager||!this.graphicsView||this.layerViewManager.updating===!0||this.labelManager.updating===!0||this.graphicsView.updating===!0||this.allLayerViews.some(s=>!s.destroyed&&!("layerViews"in s)&&s.updating===!0));if(ue("esri-2d-log-updating")){const s=this.allLayerViews.reduce((o,a)=>({...o,[a.layer.id]:!a.destroyed&&!("layerViews"in a)&&a.updating}),{});console.log(`Updating MapView: ${e}
-> Null LayerViewManager: ${!this.layerViewManager}
-> Null LabelManager: ${!this.labelManager}
-> Null GraphicsView: ${!this.graphicsView}
-> layerViewManager.updating: ${(r=this.layerViewManager)==null?void 0:r.updating}
-> labelManager.updating: ${(i=this.labelManager)==null?void 0:i.updating}
-> graphicsView.updating: ${(n=this.graphicsView)==null?void 0:n.updating}
-> allLayerViews: ${JSON.stringify(s)}
`)}return e}get viewpoint(){if(!this.ready)return this._get("viewpoint");const e=this.state.paddedViewState;return e&&e.viewpoint.clone()}set viewpoint(e){if(e==null)return;if(!this.ready)return this._set("viewpoint",e),this._set("extent",null),this._set("center",null),this._set("zoom",-1),this._set("scale",0),void this.notifyChange("initialExtentRequired");let r,i;try{r=this._project(e,this.spatialReference),!e.scale||isNaN(e.scale)?i=new H("mapview:invalid-viewpoint",`invalid scale value of ${e.scale}`):R(e.targetGeometry)&&(i=new H("mapview:invalid-viewpoint","geometry not defined"))}catch(s){i=new H("mapview:invalid-viewpoint","could not project the value in the view's spatial reference",{error:s})}if(i)return void re.getLogger(this.declaredClass).error(i);this._scaleBeforeChangingSpatialReference=null;const n=new Xn({targetGeometry:new Ue,scale:0,rotation:0});_m(n,r),this.constraints.constrain(n,this.state.paddedViewState.viewpoint),this.state.viewpoint=n,this.frameTask.requestFrame(),this._set("viewpoint",n)}get zoom(){return this.ready?this.constraints.scaleToZoom(this.scale):this._get("zoom")}set zoom(e){if(e==null)return;if(!this.ready){this._set("zoom",e),this._set("scale",0);const i=this._get("extent");return i&&(this._set("extent",null),this._set("center",i.center)),void this.notifyChange("initialExtentRequired")}if(!this.constraints.effectiveLODs)return void this._set("zoom",-1);const r=this.viewpoint;rge(r,r,this.constraints.zoomToScale(e)),this.viewpoint=r,this._set("zoom",this.constraints.scaleToZoom(this.scale))}get navigating(){return!(!this.mapViewNavigation||!this.mapViewNavigation.interacting)}goTo(e,r){if(e)return this.animation&&(this.animation=null),this._createAnimation(),tw(()=>this.ready,r).then(()=>{var s;const i={animate:!0,...r},n=bdt(e,this);return(s=this.animation)==null||s.update(n),this._gotoTask={},i.animate?this._gotoAnimated(n,i):this._gotoImmediate(n,i)});re.getLogger(this.declaredClass).error("#goTo()","target cannot be null or undefined")}async hitTest(e,r){const i=jz(e)?Bz(this,e):e;if(!this.ready||isNaN(i.x)||isNaN(i.y))return{screenPoint:i,results:[]};let n=new Set,s=!1,o=null,a=null;r!=null&&r.include?Mge(r.include,Oge(this,p=>n.add(p),p=>{o||(o=new Set),o.add(p)},p=>n.add(p),()=>s=!0)):(s=!0,n=new Set(this.allLayerViews)),r!=null&&r.exclude&&Mge(r.exclude,Oge(this,p=>n.delete(p),p=>{a||(a=new Set),a.add(p)}));const l=this.allLayerViews.filter(p=>!p.suspended&&n.has(p)).reverse(),c=this.toMap(i);let h=[...s?this.graphicsView.hitTest(c).map(p=>({type:"graphic",graphic:p,layer:null,mapPoint:c})):[],...await Promise.all(l.map(p=>p.hitTest(c,i)).toArray())].filter(v).flat().filter(v);return o&&(h=h.filter(p=>!("graphic"in p)||!p.graphic||(o==null?void 0:o.has(EQ(p.graphic))))),a&&(h=h.filter(p=>!("graphic"in p)||!p.graphic||(a==null?void 0:a.has(EQ(p.graphic))))),{screenPoint:i,results:h}}async takeScreenshot(e){const r=this._createScreenshotPlan(e),i=await this._stage.takeScreenshot(r);return uU(i,{format:r.format,quality:r.quality,rotation:0,disableDecorations:!1},this._pixelFormat)}async _takeScreenshot(e){const r=this._createScreenshotPlan(e),i=await this._stage.takeScreenshot(r);return hU(i,this._pixelFormat)}_createScreenshotPlan(e){e=e??{};const r=this.supersampleScreenshotsEnabled?Math.min(4,dft(this.size,Math.min(4096,this._stage.context.parameters.maxTextureSize))):1;let i;e.layers?(i=[],e.layers.forEach(o=>{const a=this.allLayerViews.find(l=>l.layer.id===o.id);a&&"container"in a&&a.container&&i.push(a.container)})):i=this._stage.children;const{format:n,quality:s}=hft(e.format,e.quality);return rft(e,r,this.size,this.padding,n,s,i,e.rotation)}get test(){return{takeScreenshot:e=>this._takeScreenshot(e)}}toMap(e){if(!this.ready)return null;const r=jz(e)?Bz(this,e):e,i=[0,0],[n,s]=this.state.toMap(i,[r.x,r.y]),o=this.spatialReference;return new Ue({x:n,y:s,spatialReference:o})}toScreen(e){if(!this.ready)return null;const r=this._project(e,this.spatialReference),i=[r.x,r.y];return this.state.toScreen(i,i),Gs(i[0],i[1])}on(e,r,i,n){return this.inputManager&&this.viewEvents.on(e,r,i,n)||super.on(e,r)}hasEventListener(e){return super.hasEventListener(e)||this.viewEvents.hasHandler(e)}whenLayerView(e){return super.whenLayerView(e)}graphicChanged(e){this.graphicsView&&this.graphicsView.graphicUpdateHandler(e)}whenReady(){return new Promise(e=>{this.ready?e(this):this._resolveWhenReady.push(e)})}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var e,r,i;return this.map&&"initialViewProperties"in this.map&&((r=(e=this.map)==null?void 0:e.initialViewProperties)==null?void 0:r.spatialReference)||((i=this.defaultsFromMap)==null?void 0:i.spatialReference)||null}hasLayerViewModule(e){return nge.hasLayerViewModule(e)}importLayerView(e){return nge.importLayerView(e)}pixelSizeAt(){return this.ready?this.state.resolution:(re.getLogger(this.declaredClass).error("#pixelSizeAt()","Map view cannot be used before it is ready"),null)}popupHitTest(e){return this.hitTest(e).then(r=>({...r,mapPoint:this.toMap(e)}))}requestUpdate(){this.ready&&this.frameTask.requestUpdate()}validate(){let e=O$e(this.type);return ue("safari")&&ue("safari")<9&&(e=new H("mapview:browser-not-supported","This browser is not supported by MapView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:ue("safari")})),v(e)?(re.getLogger(this.declaredClass).warn("#validate()",e.message),Promise.reject(e)):Zft()}_createAnimation(){return this.animation&&!this.animation.done||(this.animation=new E_),this.animation}_cancellableGoTo(e,r,i){const n=()=>e===this._gotoTask,s=i.then(()=>{n()&&(this.animation=null)}).catch(a=>{throw n()&&(r&&!r.done&&(r.stop(),this.frameTask.animationInProgress=!1),this.animation=null),a}),o=new Promise(a=>a(s));return r.when().catch(()=>{n()&&o.cancel&&o.cancel()}),o}_gotoImmediate(e,r){const i=this._gotoTask,n=this.animation,s=e.then(o=>{if(lr(r),i!==this._gotoTask)throw new H("view:goto-interrupted","Goto was interrupted");this.viewpoint=n.target=o,n.finish()});return this._cancellableGoTo(i,n,s)}_flipStationary(e){return this._stationaryTimer!==null||(this._stationaryTimer=setTimeout(()=>{this._stationaryTimer=null;const r=performance.now()-this._lastStationaryEventTimestamp;r<Rge&&(this._stationaryTimer=this._flipStationary(r))},e)),this._stationaryTimer}_getDefaultViewpoint(){var w,x,T,E;const{constraints:e,initialExtent:r,map:i,padding:n,size:s}=this;if(!e)return null;const o=i&&"initialViewProperties"in i?i.initialViewProperties:void 0,a={zoom:this._get("zoom"),scale:this._get("scale"),center:this._get("center"),extent:this._get("extent"),rotation:this._get("rotation"),viewpoint:this._get("viewpoint"),spatialReference:this._userSpatialReference};e.effectiveLODs?a.zoom!==-1&&(a.scale=e.zoomToScale(a.zoom)):a.zoom=-1;let l=null,c=null,h=0;const p=a.viewpoint&&a.viewpoint.rotation,f=a.viewpoint&&a.viewpoint.targetGeometry;v(f)&&(f.type==="extent"?l=f:f.type==="point"&&(c=f,h=a.viewpoint.scale));const m=a.extent||l||((x=(w=o==null?void 0:o.viewpoint)==null?void 0:w.targetGeometry)==null?void 0:x.extent)||r,g=a.center||c||(m==null?void 0:m.center),_=a.scale||h||((T=o==null?void 0:o.viewpoint)==null?void 0:T.scale)||m&&z$(m,[s[0]-n.left-n.right,s[1]-n.top-n.bottom]),b=a.rotation||p||((E=o==null?void 0:o.viewpoint)==null?void 0:E.rotation)||0;return g&&_?new Xn({targetGeometry:g,scale:_,rotation:b}):null}_gotoAnimated(e,r){const i=this._gotoTask,n=this.animation;if(!n)return Promise.resolve();const s=e.then(o=>{if(lr(r),i!==this._gotoTask)throw new H("view:goto-interrupted","Goto was interrupted");return n.update(o),this.animationManager.animate(n,this.viewpoint,r),n.when().then(()=>{},()=>{})});return this._cancellableGoTo(i,n,s)}_project(e,r){var s;const i=e&&e.targetGeometry||e;if(!r)return e;if(!i)return null;if(r.imageCoordinateSystem||(s=i.spatialReference)!=null&&s.imageCoordinateSystem||In(r,i.spatialReference))return e;const n=ym(i,r);if(!n)throw new H("mapview:projection-not-possible","projecting input geometry to target spatial reference returned a null value",{geometry:i,spatialReference:r});return Jft(e)?(e.targetGeometry=n,e):n}_resizeHandler(e){if(!this.ready)return;const r=this.state;let i=this.state.paddedViewState.viewpoint;const n=this.state.paddedViewState.size.concat();r.size=[e.width,e.height],Ldt(i,i,n,this.state.paddedViewState.size,this.resizeAlign),i=this.constraints.constrain(i,void 0),this.state.viewpoint=i}_startup(){var l,c;this.timeline.begin("MapView Startup");const e=this._getDefaultViewpoint(),r=e.targetGeometry;try{this._project(e,this.spatialReference)}catch(h){re.getLogger(this.declaredClass).warn(new Sp("mapview:startup-projection-error","projection of initial viewpoint to the view's spatial reference, defaulting to the initial viewpoint.",{center:r.toJSON(),spatialReference:this.spatialReference,error:h})),e.targetGeometry=((l=this.defaultsFromMap.extent)==null?void 0:l.center)||new Ue({x:0,y:0,spatialReference:this.spatialReference})}(c=this.constraints)==null||c.fit(e),this._set("state",new ppt({padding:this._get("padding"),size:this.size,viewpoint:e})),this.graphics.owner=this;const i=new F$e(this.surface,{canvas:this.renderCanvas,supersampleScreenshots:this.supersampleScreenshotsEnabled,contextOptions:{disabledExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions},renderingOptions:this.renderingOptions,timeline:this.timeline});this._stage=i,this._magnifierView=new B$e,this._magnifierView.magnifier=this.magnifier;const n=new z$e({view:this});this._set("labelManager",n);const s=new kdt({view:this});this._set("animationManager",s);const o=new V$e({view:this,animationManager:s});this._set("mapViewNavigation",o),this._setupSpatialReferenceDependentProperties(),this.handles.add([this.rootLayerViews.on("change",()=>this._updateStageChildren()),i.on("post-render",()=>this._set("rendering",i.renderRequested)),i.on("will-render",()=>this._set("rendering",i.renderRequested)),i.on("webgl-error",h=>this.fatalError=h.error),ne(()=>this.stationary,h=>i.stationary=h,Wi),ne(()=>this.background,h=>{i.background=h,this._magnifierView.background=h},Wi),ne(()=>this.magnifier,h=>this._magnifierView.magnifier=h,Wi),ne(()=>this.renderingOptions,h=>i.renderingOptions=h,Wi),ne(()=>this.highlightOptions,h=>i.highlightOptions=h,Wi),ne(()=>this.state.id,()=>i.state=this.state,Wi)],"map-view"),this._updateStageChildren();const a=this._resolveWhenReady;this._resolveWhenReady=[],a.forEach(h=>h(this)),this.timeline.end("MapView Startup"),this.frameTask&&this.frameTask.start(),this._set("ready",!0)}_teardown(){this._destroySpatialReferenceDependentProperties(),this.handles.remove("map-view"),this.mapViewNavigation.destroy(),this._set("mapViewNavigation",null),this.animationManager.destroy(),this._set("animationManager",null),this.layerViewManager.clear(),this.labelManager.destroy(),this._magnifierView.destroy(),this._stage.destroy(),this._stage=null,this._set("graphicsView",null),this._magnifierView=null,this._set("labelManager",null),this._set("mapViewNavigation",null),this.graphics.owner=null,this.frameTask&&this.frameTask.stop(),this._stationaryTimer&&(clearTimeout(this._stationaryTimer),this._stationaryTimer=null),this._set("ready",!1);const{center:[e,r],spatialReference:i,rotation:n,scale:s}=this.state.paddedViewState,o=new Ue({x:e,y:r,spatialReference:i});this._set("viewpoint",null),this._set("extent",null),this._set("center",o),this._set("zoom",-1),this._set("rotation",n),this._set("scale",s),this._set("spatialReference",i),this._set("state",null),this.animation=null}_updateStageChildren(){this._stage.removeAllChildren(),this.rootLayerViews.forEach(r=>{this._stage.addChild(r.container)});const e=this.graphicsView;this._stage.addChild(e.container),this._stage.addChild(this._magnifierView)}_setupSpatialReferenceDependentProperties(){const e=new bpt(S$.create({spatialReference:this.spatialReference,size:512,numLODs:36}));this._set("featuresTilingScheme",e);const r=new k$e({view:this,graphics:this.graphics,requestUpdateCallback:()=>this.requestUpdate(),container:new U$e(e)});this.frameTask.graphicsView=r,this._set("graphicsView",r)}_destroySpatialReferenceDependentProperties(){const e=this.graphicsView;this._set("graphicsView",null),this.frameTask.graphicsView=null,e.destroy(),this._set("featuresTilingScheme",null)}_spatialReferenceChanged(e){if(!this.ready)return;this.frameTask.stop();for(const l of this.allLayerViews)l.processDetach();this._destroySpatialReferenceDependentProperties();const r=this.state.paddedViewState.clone();if(R(this._scaleBeforeChangingSpatialReference))this._scaleBeforeChangingSpatialReference=r.scale;else{const l=r.viewpoint.clone();l.scale=this._scaleBeforeChangingSpatialReference,r.viewpoint=l}const i=r.clone(),[n,s]=r.center;let o=null;try{o=this._project(new Ue({x:n,y:s,spatialReference:r.spatialReference}),e)}catch(l){i2()||re.getLogger(this.declaredClass).warn(new Sp("mapview:spatial-reference-change","could not project the view's center to the new spatial reference",{center:o==null?void 0:o.toJSON(),spatialReference:e,error:l}))}o||(o=new Ue({x:0,y:0,spatialReference:e}));const a=fQ(new Xn({targetGeometry:new Ue,scale:0,rotation:0}),r.viewpoint,o);i.viewpoint=a;try{const c=[r.size[0]/2,r.size[1]/2],h=[c[0]+20,c[1]],p=r.toMap([0,0],h),{x:f,y:m}=this._project(new Ue({x:p[0],y:p[1],spatialReference:r.spatialReference}),e);p[0]=f,p[1]=m,i.toScreen(p,p);const g=Idt(c,p,h),_=Math.hypot(p[0]-c[0],p[1]-c[1])/20;!Number.isFinite(_)||Math.abs(_)>4?(a.rotation=0,a.targetGeometry=new Ue({x:0,y:0,spatialReference:e})):(a.scale*=_,a.scale>ue("mapview-srswitch-adjust-rotation-scale-threshold")?a.rotation=0:a.rotation+=Number.isFinite(g)?g:0)}catch{}this._get("constraints").constrain(a,void 0),this._get("state").viewpoint=a,this._stage.state=this.state,this._setupSpatialReferenceDependentProperties();for(const l of this.allLayerViews)l.processAttach();this.frameTask.requestFrame(),this.frameTask.start(),this._updateStageChildren()}};dr.type="2d",u([d({readOnly:!0})],dr.prototype,"animationManager",void 0),u([d({constructOnly:!0})],dr.prototype,"deactivatedWebGLExtensions",void 0),u([d({constructOnly:!0})],dr.prototype,"debugWebGLExtensions",void 0),u([d({readOnly:!0})],dr.prototype,"featuresTilingScheme",void 0),u([d({readOnly:!0})],dr.prototype,"fullOpacity",void 0),u([d({readOnly:!0})],dr.prototype,"graphicsTileStore",null),u([d()],dr.prototype,"graphicsView",void 0),u([d({readOnly:!0})],dr.prototype,"state",void 0),u([d()],dr.prototype,"initialExtentRequired",null),u([d()],dr.prototype,"labelManager",void 0),u([d({readOnly:!0})],dr.prototype,"resourceManager",null),u([d({readOnly:!0})],dr.prototype,"textureManager",null),u([d({readOnly:!0})],dr.prototype,"mapViewNavigation",void 0),u([d({constructOnly:!0})],dr.prototype,"renderCanvas",void 0),u([d()],dr.prototype,"renderingOptions",void 0),u([d({readOnly:!0})],dr.prototype,"rendering",void 0),u([d({constructOnly:!0})],dr.prototype,"supersampleScreenshotsEnabled",void 0),u([d({readOnly:!0})],dr.prototype,"supportsGround",void 0),u([d()],dr.prototype,"_stationaryTimer",void 0),u([d()],dr.prototype,"_defaultsFromMapSettings",null),u([d()],dr.prototype,"_pePromise",void 0),u([d({readOnly:!0})],dr.prototype,"typeSpecificPreconditionsReady",null),u([d()],dr.prototype,"animation",null),u([d({type:LB})],dr.prototype,"background",null),u([d({value:null,type:Ue,dependsOn:["state.id","ready"]})],dr.prototype,"center",null),u([d({type:JIe})],dr.prototype,"constraints",null),u([d({value:null,type:ur,dependsOn:["state.id","ready"]})],dr.prototype,"extent",null),u([d()],dr.prototype,"floors",void 0),u([d({type:v$e})],dr.prototype,"highlightOptions",void 0),u([d({readOnly:!0})],dr.prototype,"inputManager",void 0),u([d()],dr.prototype,"map",void 0),u([d({value:{top:0,right:0,bottom:0,left:0},cast:t=>({top:0,right:0,bottom:0,left:0,...t})})],dr.prototype,"padding",null),u([d()],dr.prototype,"resizeAlign",void 0),u([d({readOnly:!0,dependsOn:["state.id"]})],dr.prototype,"resolution",null),u([d({value:0,type:Number,dependsOn:["state.id","ready"]})],dr.prototype,"rotation",null),u([d({value:0,type:Number,dependsOn:["state.id","ready"]})],dr.prototype,"scale",null),u([d({constructOnly:!0})],dr.prototype,"spatialReferenceLocked",void 0),u([d()],dr.prototype,"stationary",null),u([d({type:b$e,readOnly:!0})],dr.prototype,"timeline",void 0),u([d({readOnly:!0})],dr.prototype,"type",void 0),u([d({readOnly:!0})],dr.prototype,"updating",null),u([d({value:null,type:Xn,dependsOn:["state.id","ready"]})],dr.prototype,"viewpoint",null),u([d({value:-1,dependsOn:["state.id","ready"]})],dr.prototype,"zoom",null),u([d({readOnly:!0})],dr.prototype,"navigating",null),u([d({type:N$e})],dr.prototype,"ui",void 0),dr=u([$("esri.views.MapView")],dr);const j$e=dr;function EQ(t){var r,i;const e=t.getObjectId();return e?`${((r=t.layer)==null?void 0:r.uid)??((i=t.sourceLayer)==null?void 0:i.uid)??"MapView"}/${e}`:`"MapView/${t.uid}`}function Oge(t,e,r,i,n){return s=>{if(s instanceof Va){if(s.layer===t)n==null||n();else{const o=t.allLayerViews.find(a=>a.layer===s.layer);o&&(i==null||i(o))}r(EQ(s))}else{const o=t.allLayerViews.find(a=>a.layer===s);o&&e(o)}}}function Mge(t,e){if(t)if(LL(t))for(const r of t)if(LL(r))for(const i of r)e(i);else e(r);else e(t)}function Kft(t){return(t==null?void 0:t.declaredClass)==="esri.WebMap"}function vi(){return[1,0,0,0,1,0,0,0,1]}function Qft(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]}function G$e(t,e,r,i,n,s,o,a,l){return[t,e,r,i,n,s,o,a,l]}function H$e(t,e){return new Float64Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:Qft,create:vi,createView:H$e,fromValues:G$e},Symbol.toStringTag,{value:"Module"}));const Ch=P(),QC=vi(),gH=vi(),Pge=vi();function yb(t,e,r){return he(Ch,e[0],e[1],1),Gl(Ch,Ch,Xu(QC,r)),Ch[2]===0?dt(t,Ch[0],Ch[1]):dt(t,Ch[0]/Ch[2],Ch[1]/Ch[2])}function emt(t,e,r){return Ige(gH,e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]),Ige(Pge,r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7]),lw(t,koe(gH,gH),Pge),t[8]!==0&&(t[0]/=t[8],t[1]/=t[8],t[2]/=t[8],t[3]/=t[8],t[4]/=t[8],t[5]/=t[8],t[6]/=t[8],t[7]/=t[8],t[8]/=t[8]),t}function Ige(t,e,r,i,n,s,o,a,l){cD(t,e,i,s,r,n,o,1,1,1),he(Ch,a,l,1),koe(QC,t);const[c,h,p]=Gl(Ch,Ch,Xu(QC,QC));return cD(QC,c,0,0,0,h,0,0,0,p),lw(t,QC,t)}let CQ=class extends xY{projectOrWarn(e,r){if(R(e))return e;const{geometry:i,pending:n}=dz(e,r);return n?null:n||i?i:(re.getLogger(this.declaredClass).warn("geometry could not be projected to the spatial reference",{georeference:this,geometry:e,sourceSpatialReference:e.spatialReference,targetSpatialReference:r}),null)}};CQ=u([$("esri.layers.support.GeoreferenceBase")],CQ);const DB=CQ,yH=vi(),_o=Ne();let gI=class extends be{constructor(){super(...arguments),this.sourcePoint=null,this.mapPoint=null}};u([d()],gI.prototype,"sourcePoint",void 0),u([d({type:Ue})],gI.prototype,"mapPoint",void 0),gI=u([$("esri.layers.support.ControlPoint")],gI);let mf=class extends Cw(DB){constructor(e){super(e),this.controlPoints=null,this.height=0,this.type="control-points",this.width=0}readControlPoints(e,r){const i=Je.fromJSON(r.spatialReference),n=G$e(...r.coefficients,1);return e.map(s=>(dt(_o,s.x,s.y),yb(_o,_o,n),{sourcePoint:s,mapPoint:new Ue({x:_o[0],y:_o[1],spatialReference:i})}))}writeControlPoints(e,r,i,n){if(R(this.transform)){const s=new H("web-document-write:invalid-georeference","Invalid 'controlPoints', 'width', 'height' configuration.",{layer:n==null?void 0:n.layer,georeference:this});n!=null&&n.messages?n.messages.push(s):re.getLogger(this.declaredClass).error(s.name,s.message)}else v(e)&&oc(e[0])&&(r.controlPoints=e.map(s=>{const o=s.sourcePoint;return{x:o.x,y:o.y}}),r.spatialReference=e[0].mapPoint.spatialReference.toJSON(),r.coefficients=this.transform.slice(0,8))}get coords(){if(R(this.controlPoints))return null;const e=this._updateTransform(yH);if(R(e)||!oc(this.controlPoints[0]))return null;const r=this.controlPoints[0].mapPoint.spatialReference;return smt(e,this.width,this.height,r)}set coords(e){if(R(this.controlPoints)||!oc(this.controlPoints[0]))return;const r=this.controlPoints[0].mapPoint.spatialReference;if(e=this.projectOrWarn(e,r),R(e))return;const{width:i,height:n}=this,{rings:[[s,o,a,l]]}=e,c={sourcePoint:Gs(0,n),mapPoint:new Ue({x:s[0],y:s[1],spatialReference:r})},h={sourcePoint:Gs(0,0),mapPoint:new Ue({x:o[0],y:o[1],spatialReference:r})},p={sourcePoint:Gs(i,0),mapPoint:new Ue({x:a[0],y:a[1],spatialReference:r})},f={sourcePoint:Gs(i,n),mapPoint:new Ue({x:l[0],y:l[1],spatialReference:r})};oc(c)&&oc(h)&&oc(p)&&oc(f)&&($ge(yH,c,h,p,f),this.controlPoints=this.controlPoints.map(({sourcePoint:m})=>(dt(_o,m.x,m.y),yb(_o,_o,yH),{sourcePoint:m,mapPoint:new Ue({x:_o[0],y:_o[1],spatialReference:r})})))}get inverseTransform(){return R(this.transform)?null:Lw(vi(),this.transform)}get transform(){return this._updateTransform()}toMap(e){if(R(e)||R(this.transform)||R(this.controlPoints)||!oc(this.controlPoints[0]))return null;dt(_o,e.x,e.y);const r=this.controlPoints[0].mapPoint.spatialReference;return yb(_o,_o,this.transform),new Ue({x:_o[0],y:_o[1],spatialReference:r})}toSource(e){if(R(e)||R(this.inverseTransform)||R(this.controlPoints)||!oc(this.controlPoints[0]))return null;const r=this.controlPoints[0].mapPoint.spatialReference;return e=e.normalize(),e=dz(e,r).geometry,R(e)?null:(dt(_o,e.x,e.y),yb(_o,_o,this.inverseTransform),Gs(_o[0],_o[1]))}_updateTransform(e){const{controlPoints:r,width:i,height:n}=this;if(R(r)||!(i>0)||!(n>0))return null;const[s,o,a,l]=r;if(!oc(s))return null;const c=s.mapPoint.spatialReference,h=this._projectControlPoint(o,c),p=this._projectControlPoint(a,c),f=this._projectControlPoint(l,c);if(!h.valid||!p.valid||!f.valid||!oc(h.controlPoint))return null;R(e)&&(e=vi());let m=null;return m=oc(p.controlPoint)&&oc(f.controlPoint)?$ge(e,s,h.controlPoint,p.controlPoint,f.controlPoint):oc(p.controlPoint)?rmt(e,s,h.controlPoint,p.controlPoint):tmt(e,s,h.controlPoint),m.every(g=>g===0)?null:m}_projectControlPoint(e,r){if(!oc(e))return{valid:!0,controlPoint:e};const{sourcePoint:i,mapPoint:n}=e,{geometry:s,pending:o}=dz(n,r);return o?{valid:!1,controlPoint:null}:o||s?{valid:!0,controlPoint:{sourcePoint:i,mapPoint:s}}:(re.getLogger(this.declaredClass).warn("map point could not be projected to the spatial reference",{georeference:this,controlPoint:e,sourceSpatialReference:n.spatialReference,targetSpatialReference:r}),{valid:!1,controlPoint:null})}};function oc(t){return v(t)&&v(t.sourcePoint)&&v(t.mapPoint)}u([d({type:[gI],json:{write:{allowNull:!1,isRequired:!0}}})],mf.prototype,"controlPoints",void 0),u([Me("controlPoints")],mf.prototype,"readControlPoints",null),u([De("controlPoints")],mf.prototype,"writeControlPoints",null),u([d()],mf.prototype,"coords",null),u([d({json:{write:!0}})],mf.prototype,"height",void 0),u([d({readOnly:!0})],mf.prototype,"inverseTransform",null),u([d({readOnly:!0})],mf.prototype,"transform",null),u([d({json:{write:!0}})],mf.prototype,"width",void 0),mf=u([$("esri.layers.support.ControlPointsGeoreference")],mf);const H0=Ne(),q0=Ne(),$S=Ne(),_b=Ne(),W0=Ne(),X0=Ne(),LS=Ne(),vb=Ne(),C4=Math.PI/2;function Y0(t,e,r){dt(t,r.sourcePoint.x,r.sourcePoint.y),dt(e,r.mapPoint.x,r.mapPoint.y)}function tmt(t,e,r){return Y0(H0,W0,e),Y0(q0,X0,r),yS($S,q0,H0,C4),yS(_b,H0,q0,C4),yS(LS,X0,W0,-C4),yS(vb,W0,X0,-C4),Xoe(t,H0,q0,$S,_b,W0,X0,LS,vb)}function rmt(t,e,r,i){return Y0(H0,W0,e),Y0(q0,X0,r),Y0($S,LS,i),W1(_b,H0,q0,.5),yS(_b,$S,_b,Math.PI),W1(vb,W0,X0,.5),yS(vb,LS,vb,Math.PI),Xoe(t,H0,q0,$S,_b,W0,X0,LS,vb)}function $ge(t,e,r,i,n){return Y0(H0,W0,e),Y0(q0,X0,r),Y0($S,LS,i),Y0(_b,vb,n),Xoe(t,H0,q0,$S,_b,W0,X0,LS,vb)}const imt=new Array(8).fill(0),nmt=new Array(8).fill(0);function Lge(t,e,r,i,n){return t[0]=e[0],t[1]=e[1],t[2]=r[0],t[3]=r[1],t[4]=i[0],t[5]=i[1],t[6]=n[0],t[7]=n[1],t}function Xoe(t,e,r,i,n,s,o,a,l){return emt(t,Lge(imt,e,r,i,n),Lge(nmt,s,o,a,l))}function smt(t,e,r,i){const n=Rr(0,r),s=Rr(0,0),o=Rr(e,0),a=Rr(e,r);return yb(n,n,t),yb(s,s,t),yb(o,o,t),yb(a,a,t),new Jl({rings:[[n,s,o,a,n]],spatialReference:i})}const q$e=mf;let y1=class extends DB{constructor(e){super(e),this.bottomLeft=null,this.bottomRight=null,this.topLeft=null,this.topRight=null,this.type="corners"}get coords(){let{topLeft:e,topRight:r,bottomLeft:i,bottomRight:n}=this;if(R(e)||R(r)||R(i)||R(n))return null;const s=e.spatialReference;return r=this.projectOrWarn(r,s),i=this.projectOrWarn(i,s),n=this.projectOrWarn(n,s),R(r)||R(i)||R(n)?null:new Jl({rings:[[[i.x,i.y],[e.x,e.y],[r.x,r.y],[n.x,n.y],[i.x,i.y]]],spatialReference:s})}set coords(e){const{topLeft:r}=this;if(R(r))return;const i=r.spatialReference;if(e=this.projectOrWarn(e,i),R(e))return;const{rings:[[n,s,o,a]]}=e;this.bottomLeft=new Ue({x:n[0],y:n[1],spatialReference:i}),this.topLeft=new Ue({x:s[0],y:s[1],spatialReference:i}),this.topRight=new Ue({x:o[0],y:o[1],spatialReference:i}),this.bottomRight=new Ue({x:a[0],y:a[1],spatialReference:i})}};u([d()],y1.prototype,"coords",null),u([d({type:Ue})],y1.prototype,"bottomLeft",void 0),u([d({type:Ue})],y1.prototype,"bottomRight",void 0),u([d({type:Ue})],y1.prototype,"topLeft",void 0),u([d({type:Ue})],y1.prototype,"topRight",void 0),y1=u([$("esri.layers.support.CornersGeoreference")],y1);const omt=y1;let eA=class extends DB{constructor(e){super(e),this.extent=null,this.rotation=0,this.type="extent-and-rotation"}get coords(){if(R(this.extent))return null;const{xmin:e,ymin:r,xmax:i,ymax:n,spatialReference:s}=this.extent;let o;if(this.rotation){const{x:a,y:l}=this.extent.center,c=Dge(a,l,this.rotation);o=[c(e,r),c(e,n),c(i,n),c(i,r)],o.push(o[0])}else o=[[e,r],[e,n],[i,n],[i,r],[e,r]];return new Jl({rings:[o],spatialReference:s})}set coords(e){if(R(e)||R(this.extent))return;const r=this.extent.spatialReference;if(e=this.projectOrWarn(e,r),R(e)||R(e.extent))return;const{rings:[[i,n,s]],extent:{center:{x:o,y:a}}}=e,l=dl(Math.PI/2-Math.atan2(n[1]-i[1],n[0]-i[0])),c=Dge(o,a,-l),[h,p]=c(i[0],i[1]),[f,m]=c(s[0],s[1]);this.extent=new ur({xmin:h,ymin:p,xmax:f,ymax:m,spatialReference:r}),this.rotation=l}};function Dge(t,e,r){const i=gN(r),n=Math.cos(i),s=Math.sin(i);return(o,a)=>[n*(o-t)+s*(a-e)+t,n*(a-e)-s*(o-t)+e]}u([d()],eA.prototype,"coords",null),u([d({type:ur})],eA.prototype,"extent",void 0),u([d({type:Number})],eA.prototype,"rotation",void 0),eA=u([$("esri.layers.support.ExtentAndRotationGeoreference")],eA);const Yoe=eA,amt={key:"type",base:DB,typeMap:{"control-points":q$e,corners:omt,"extent-and-rotation":Yoe}};let tA=class extends L9(Cw(qu)){constructor(){super(...arguments),this.georeference=null,this.opacity=1}readGeoreference(e){return q$e.fromJSON(e)}};u([d({types:amt,json:{write:!0}})],tA.prototype,"georeference",void 0),u([Me("georeference")],tA.prototype,"readGeoreference",null),u([d()],tA.prototype,"opacity",void 0),tA=u([$("esri.layers.support.MediaElementBase")],tA);const Zoe=tA;function lmt(t){return Joe[cmt(t)]||hmt}function cmt(t){return t instanceof Blob?t.type:umt(t.url)}function umt(t){const e=aXe(t);return AQ[e]||W$e}const Joe={},W$e="text/plain",hmt=Joe[W$e],AQ={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(const t in AQ)Joe[AQ[t]]=t;let _1=class extends Zoe{constructor(e){super(e),this.content=null,this.image=null,this.type="image",this.image=null}load(){const e=this.image;if(typeof e=="string"){const r=ei(e,{responseType:"image"}).then(({data:i})=>{this._set("content",i)});this.addResolvingPromise(r)}else if(e instanceof HTMLImageElement){const r=e.decode().then(()=>{this._set("content",e)});this.addResolvingPromise(r)}else e?this._set("content",e):this.addResolvingPromise(Promise.reject(new H("image-element:invalid-image-type","Invalid image type",{image:e})));return Promise.resolve(this)}readImage(e,r,i){return k2(r.url,i)}writeImage(e,r,i,n){if(R(e))return;const s=n==null?void 0:n.portalItem,o=n==null?void 0:n.resources;if(!s||!o)return void(typeof e=="string"&&(r[i]=x_(e,n)));const a=typeof e!="string"||cd(e)||Zb(e)?null:e;if(a){if(NCe(a)==null)return void(r[i]=a);const l=x_(a,{...n,verifyItemRelativeUrls:n&&n.verifyItemRelativeUrls?{writtenUrls:n.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},vO.NO);if(s&&l&&!Bu(l))return o.toKeep.push({resource:s.resourceFromPath(l),compress:!1}),void(r[i]=l)}r[i]="<pending>",o.pendingOperations.push(X$e(e).then(l=>{const c=pmt(l,s);r[i]=c.itemRelativeUrl,o.toAdd.push({resource:c,content:l,compress:!1,finish:h=>{this.image=h.url}})}))}};u([d({readOnly:!0})],_1.prototype,"content",void 0),u([d({json:{name:"url",type:String}})],_1.prototype,"image",void 0),u([Me("image",["url"])],_1.prototype,"readImage",null),u([De("image")],_1.prototype,"writeImage",null),u([d({readOnly:!0,json:{name:"mediaType"}})],_1.prototype,"type",void 0),_1=u([$("esri.layers.support.ImageElement")],_1);const Koe=_1;async function X$e(t){if(typeof t=="string"){if(Zb(t)){const{data:e}=await ei(t,{responseType:"blob"});return e}return cd(t)?XWe(t):X$e((await ei(t,{responseType:"image"})).data)}return new Promise(e=>dmt(t).toBlob(e))}function dmt(t){if(t instanceof HTMLCanvasElement)return t;const e=t instanceof HTMLImageElement?t.naturalWidth:t.width,r=t instanceof HTMLImageElement?t.naturalHeight:t.height,i=document.createElement("canvas"),n=i.getContext("2d");return i.width=e,i.height=r,t instanceof HTMLImageElement?n.drawImage(t,0,0,t.width,t.height):t instanceof ImageData&&n.putImageData(t,0,0),i}function pmt(t,e){const r=ARe(),i=`${Yb("media",r)}.${lmt(t)}`;return e.resourceFromPath(i)}let fmt=class{constructor(e=9,r){this._compareMinX=Nge,this._compareMinY=Fge,this._toBBox=i=>i,this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),r&&(typeof r=="function"?this._toBBox=r:this._initFormat(r)),this.clear()}destroy(){this.clear(),Kw.prune(),O4.prune(),Kc.prune(),M4.prune()}all(e){this._all(this._data,e)}search(e,r){let i=this._data;const n=this._toBBox;if(R4(e,i))for(Kw.clear();i;){for(let s=0,o=i.children.length;s<o;s++){const a=i.children[s],l=i.leaf?n(a):a;R4(e,l)&&(i.leaf?r(a):vH(e,l)?this._all(a,r):Kw.push(a))}i=Kw.pop()}}collides(e){let r=this._data;const i=this._toBBox;if(!R4(e,r))return!1;for(Kw.clear();r;){for(let n=0,s=r.children.length;n<s;n++){const o=r.children[n],a=r.leaf?i(o):o;if(R4(e,a)){if(r.leaf||vH(e,a))return!0;Kw.push(o)}}r=Kw.pop()}return!1}load(e){if(!e.length)return this;if(e.length<this._minEntries){for(let i=0,n=e.length;i<n;i++)this.insert(e[i]);return this}let r=this._build(e.slice(0,e.length),0,e.length-1,0);if(this._data.children.length)if(this._data.height===r.height)this._splitRoot(this._data,r);else{if(this._data.height<r.height){const i=this._data;this._data=r,r=i}this._insert(r,this._data.height-r.height-1,!0)}else this._data=r;return this}insert(e){return e&&this._insert(e,this._data.height-1),this}clear(){return this._data=new gU([]),this}remove(e){if(!e)return this;let r,i=this._data,n=null,s=0,o=!1;const a=this._toBBox(e);for(Kc.clear(),M4.clear();i||Kc.length>0;){if(i||(i=Kc.pop(),n=Kc.data[Kc.length-1],s=M4.pop()??0,o=!0),i.leaf&&(r=ML(i.children,e,i.children.length,i.indexHint),r!==-1))return i.children.splice(r,1),Kc.push(i),this._condense(Kc),this;o||i.leaf||!vH(i,a)?n?(s++,i=n.children[s],o=!1):i=null:(Kc.push(i),M4.push(s),s=0,n=i,i=i.children[0])}return this}toJSON(){return this._data}fromJSON(e){return this._data=e,this}_all(e,r){let i=e;for(O4.clear();i;){if(i.leaf===!0)for(const n of i.children)r(n);else O4.pushArray(i.children);i=O4.pop()??null}}_build(e,r,i,n){const s=i-r+1;let o=this._maxEntries;if(s<=o){const h=new gU(e.slice(r,i+1));return dE(h,this._toBBox),h}n||(n=Math.ceil(Math.log(s)/Math.log(o)),o=Math.ceil(s/o**(n-1)));const a=new bH([]);a.height=n;const l=Math.ceil(s/o),c=l*Math.ceil(Math.sqrt(o));kge(e,r,i,c,this._compareMinX);for(let h=r;h<=i;h+=c){const p=Math.min(h+c-1,i);kge(e,h,p,l,this._compareMinY);for(let f=h;f<=p;f+=l){const m=Math.min(f+l-1,p);a.children.push(this._build(e,f,m,n-1))}}return dE(a,this._toBBox),a}_chooseSubtree(e,r,i,n){for(;n.push(r),r.leaf!==!0&&n.length-1!==i;){let s,o=1/0,a=1/0;for(let l=0,c=r.children.length;l<c;l++){const h=r.children[l],p=_H(h),f=mmt(e,h)-p;f<a?(a=f,o=p<o?p:o,s=h):f===a&&p<o&&(o=p,s=h)}r=s||r.children[0]}return r}_insert(e,r,i){const n=this._toBBox,s=i?e:n(e);Kc.clear();const o=this._chooseSubtree(s,this._data,r,Kc);for(o.children.push(e),_I(o,s);r>=0&&Kc.data[r].children.length>this._maxEntries;)this._split(Kc,r),r--;this._adjustParentBBoxes(s,Kc,r)}_split(e,r){const i=e.data[r],n=i.children.length,s=this._minEntries;this._chooseSplitAxis(i,s,n);const o=this._chooseSplitIndex(i,s,n);if(!o)return void console.log("  Error: assertion failed at PooledRBush._split: no valid split index");const a=i.children.splice(o,i.children.length-o),l=i.leaf?new gU(a):new bH(a);l.height=i.height,dE(i,this._toBBox),dE(l,this._toBBox),r?e.data[r-1].children.push(l):this._splitRoot(i,l)}_splitRoot(e,r){this._data=new bH([e,r]),this._data.height=e.height+1,dE(this._data,this._toBBox)}_chooseSplitIndex(e,r,i){let n,s,o;n=s=1/0;for(let a=r;a<=i-r;a++){const l=yI(e,0,a,this._toBBox),c=yI(e,a,i,this._toBBox),h=gmt(l,c),p=_H(l)+_H(c);h<n?(n=h,o=a,s=p<s?p:s):h===n&&p<s&&(s=p,o=a)}return o}_chooseSplitAxis(e,r,i){const n=e.leaf?this._compareMinX:Nge,s=e.leaf?this._compareMinY:Fge;this._allDistMargin(e,r,i,n)<this._allDistMargin(e,r,i,s)&&e.children.sort(n)}_allDistMargin(e,r,i,n){e.children.sort(n);const s=this._toBBox,o=yI(e,0,r,s),a=yI(e,i-r,i,s);let l=A4(o)+A4(a);for(let c=r;c<i-r;c++){const h=e.children[c];_I(o,e.leaf?s(h):h),l+=A4(o)}for(let c=i-r-1;c>=r;c--){const h=e.children[c];_I(a,e.leaf?s(h):h),l+=A4(a)}return l}_adjustParentBBoxes(e,r,i){for(let n=i;n>=0;n--)_I(r.data[n],e)}_condense(e){for(let r=e.length-1;r>=0;r--){const i=e.data[r];if(i.children.length===0)if(r>0){const n=e.data[r-1],s=n.children;s.splice(ML(s,i,s.length,n.indexHint),1)}else this.clear();else dE(i,this._toBBox)}}_initFormat(e){const r=["return a"," - b",";"];this._compareMinX=new Function("a","b",r.join(e[0])),this._compareMinY=new Function("a","b",r.join(e[1])),this._toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}};function dE(t,e){yI(t,0,t.children.length,e,t)}function yI(t,e,r,i,n){n||(n=new gU([])),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(let s,o=e;o<r;o++)s=t.children[o],_I(n,t.leaf?i(s):s);return n}function _I(t,e){t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY)}function Nge(t,e){return t.minX-e.minX}function Fge(t,e){return t.minY-e.minY}function _H(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function A4(t){return t.maxX-t.minX+(t.maxY-t.minY)}function mmt(t,e){return(Math.max(e.maxX,t.maxX)-Math.min(e.minX,t.minX))*(Math.max(e.maxY,t.maxY)-Math.min(e.minY,t.minY))}function gmt(t,e){const r=Math.max(t.minX,e.minX),i=Math.max(t.minY,e.minY),n=Math.min(t.maxX,e.maxX),s=Math.min(t.maxY,e.maxY);return Math.max(0,n-r)*Math.max(0,s-i)}function vH(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function R4(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function kge(t,e,r,i,n){const s=[e,r];for(;s.length;){const o=s.pop(),a=s.pop();if(o-a<=i)continue;const l=a+Math.ceil((o-a)/i/2)*i;y$e(t,l,a,o,n),s.push(a,l,l,o)}}const Kw=new Wt,O4=new Wt,Kc=new Wt,M4=new Wt({deallocator:void 0});let ymt=class{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}},Y$e=class extends ymt{constructor(){super(...arguments),this.height=1,this.indexHint=new Mie}},gU=class extends Y$e{constructor(e){super(),this.children=e,this.leaf=!0}},bH=class extends Y$e{constructor(e){super(),this.children=e,this.leaf=!1}};const _mt=5e4,vI={minX:0,minY:0,maxX:0,maxY:0};function vmt(t){vI.minX=t[0],vI.minY=t[1],vI.maxX=t[2],vI.maxY=t[3]}function bmt(t,e,r){vmt(e),t.search(vI,r)}let wmt=class{constructor(){this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new fmt(9,ue("esri-csp-restrictions")?e=>({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}):["[0]","[1]","[2]","[3]"]),this._loadIndex=()=>{if(this._indexInvalid){const e=new Array(this._idByBounds.size);let r=0;this._idByBounds.forEach((i,n)=>{e[r++]=n}),this._indexInvalid=!1,this._index.clear(),this._index.load(e)}else this._boundsToLoad.length&&(this._index.load(Array.from(new Set(this._boundsToLoad.filter(e=>this._idByBounds.has(e))))),this._boundsToLoad.length=0)}}get fullBounds(){if(!this._boundsById.size)return null;const e=td();for(const r of this._boundsById.values())r&&(e[0]=Math.min(r[0],e[0]),e[1]=Math.min(r[1],e[1]),e[2]=Math.max(r[2],e[2]),e[3]=Math.max(r[3],e[3]));return e}get valid(){return!this._indexInvalid}clear(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}delete(e){const r=this._boundsById.get(e);this._boundsById.delete(e),r&&(this._idByBounds.delete(r),this._indexInvalid||this._index.remove(r))}forEachInBounds(e,r){this._loadIndex(),bmt(this._index,e,i=>r(this._idByBounds.get(i)))}get(e){return this._boundsById.get(e)}has(e){return this._boundsById.has(e)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(e,r){if(!this._indexInvalid){const i=this._boundsById.get(e);i&&(this._index.remove(i),this._idByBounds.delete(i))}this._boundsById.set(e,r),r&&(this._idByBounds.set(r,e),this._indexInvalid||(this._boundsToLoad.push(r),this._boundsToLoad.length>_mt&&this._loadIndex()))}};function xmt(t){return Z$e(t,!0)}function gGt(t){return Z$e(t,!1)}function Z$e(t,e){if(R(t))return null;const r=t.spatialReference,i=fp(r),n="toJSON"in t?t.toJSON():t;if(!i)return n;const s=Wb(r)?102100:4326,o=YA[s].maxX,a=YA[s].minX;if(dN(n))return Uge(n,o,a);if(hN(n))return n.points=n.points.map(l=>Uge(l,o,a)),n;if(O9(n))return Tmt(n,i);if(Q0(n)||a3(n)){const l=HGe(Emt,n),c={xmin:l[0],ymin:l[1],xmax:l[2],ymax:l[3]},h=cp(c.xmin,a)*(2*o),p=h===0?n:Use(n,h);return c.xmin+=h,c.xmax+=h,c.xmax>o?Vge(p,o,e):c.xmin<a?Vge(p,a,e):p}return n}function Tmt(t,e){if(!e)return t;const r=Smt(t,e).map(i=>i.extent);return r.length<2?r[0]||t:r.length>2?(t.xmin=e.valid[0],t.xmax=e.valid[1],t):{rings:r.map(i=>[[i.xmin,i.ymin],[i.xmin,i.ymax],[i.xmax,i.ymax],[i.xmax,i.ymin],[i.xmin,i.ymin]])}}function Uge(t,e,r){if(Array.isArray(t)){const i=t[0];if(i>e){const n=cp(i,e);t[0]=i+n*(-2*e)}else if(i<r){const n=cp(i,r);t[0]=i+n*(-2*r)}}else{const i=t.x;if(i>e){const n=cp(i,e);t.x+=n*(-2*e)}else if(i<r){const n=cp(i,r);t.x+=n*(-2*r)}}return t}function Smt(t,e){const r=[],{ymin:i,ymax:n,xmin:s,xmax:o}=t,a=t.xmax-t.xmin,[l,c]=e.valid,{x:h,frameId:p}=zge(t.xmin,e),{x:f,frameId:m}=zge(t.xmax,e),g=h===f&&a>0;if(a>2*c){const _={xmin:s<o?h:f,ymin:i,xmax:c,ymax:n},b={xmin:l,ymin:i,xmax:s<o?f:h,ymax:n},w={xmin:0,ymin:i,xmax:c,ymax:n},x={xmin:l,ymin:i,xmax:0,ymax:n},T=[],E=[];P4(_,w)&&T.push(p),P4(_,x)&&E.push(p),P4(b,w)&&T.push(m),P4(b,x)&&E.push(m);for(let C=p+1;C<m;C++)T.push(C),E.push(C);r.push(new Qw(_,[p]),new Qw(b,[m]),new Qw(w,T),new Qw(x,E))}else h>f||g?r.push(new Qw({xmin:h,ymin:i,xmax:c,ymax:n},[p]),new Qw({xmin:l,ymin:i,xmax:f,ymax:n},[m])):r.push(new Qw({xmin:h,ymin:i,xmax:f,ymax:n},[p]));return r}function zge(t,e){const[r,i]=e.valid,n=2*i;let s,o=0;return t>i?(s=Math.ceil(Math.abs(t-i)/n),t-=s*n,o=s):t<r&&(s=Math.ceil(Math.abs(t-r)/n),t+=s*n,o=-s),{x:t,frameId:o}}function P4(t,e){const{xmin:r,ymin:i,xmax:n,ymax:s}=e;return I4(t,r,i)&&I4(t,r,s)&&I4(t,n,s)&&I4(t,n,i)}function I4(t,e,r){return e>=t.xmin&&e<=t.xmax&&r>=t.ymin&&r<=t.ymax}function Vge(t,e,r=!0){const i=!a3(t);if(i&&Y2e(t),r)return new Cmt().cut(t,e);const n=i?t.rings:t.paths,s=i?4:2,o=n.length,a=-2*e;for(let l=0;l<o;l++){const c=n[l];if(c&&c.length>=s){const h=[];for(const p of c)h.push([p[0]+a,p[1]]);n.push(h)}}return i?t.rings=n:t.paths=n,t}let Qw=class{constructor(e,r){this.extent=e,this.frameIds=r}};const Emt=Kt();let Cmt=class{constructor(){this._linesIn=[],this._linesOut=[]}cut(e,r){let i;if(this._xCut=r,e.rings)this._closed=!0,i=e.rings,this._minPts=4;else{if(!e.paths)return null;this._closed=!1,i=e.paths,this._minPts=2}for(const s of i){if(!s||s.length<this._minPts)continue;let o=!0;for(const a of s)o?(this.moveTo(a),o=!1):this.lineTo(a);this._closed&&this.close()}this._pushLineIn(),this._pushLineOut(),i=[];for(const s of this._linesIn)s&&s.length>=this._minPts&&i.push(s);const n=-2*this._xCut;for(const s of this._linesOut)if(s&&s.length>=this._minPts){for(const o of s)o[0]+=n;i.push(s)}return this._closed?e.rings=i:e.paths=i,e}moveTo(e){this._pushLineIn(),this._pushLineOut(),this._prevSide=this._side(e[0]),this._moveTo(e[0],e[1],this._prevSide),this._prevPt=e,this._firstPt=e}lineTo(e){const r=this._side(e[0]);if(r*this._prevSide==-1){const i=this._intersect(this._prevPt,e);this._lineTo(this._xCut,i,0),this._prevSide=0,this._lineTo(e[0],e[1],r)}else this._lineTo(e[0],e[1],r);this._prevSide=r,this._prevPt=e}close(){const e=this._firstPt,r=this._prevPt;e[0]===r[0]&&e[1]===r[1]||this.lineTo(e),this._checkClosingPt(this._lineIn),this._checkClosingPt(this._lineOut)}_moveTo(e,r,i){this._closed?(this._lineIn.push([i<=0?e:this._xCut,r]),this._lineOut.push([i>=0?e:this._xCut,r])):(i<=0&&this._lineIn.push([e,r]),i>=0&&this._lineOut.push([e,r]))}_lineTo(e,r,i){this._closed?(this._addPolyVertex(this._lineIn,i<=0?e:this._xCut,r),this._addPolyVertex(this._lineOut,i>=0?e:this._xCut,r)):i<0?(this._prevSide===0&&this._pushLineOut(),this._lineIn.push([e,r])):i>0?(this._prevSide===0&&this._pushLineIn(),this._lineOut.push([e,r])):this._prevSide<0?(this._lineIn.push([e,r]),this._lineOut.push([e,r])):this._prevSide>0&&(this._lineOut.push([e,r]),this._lineIn.push([e,r]))}_addPolyVertex(e,r,i){const n=e.length;n>1&&e[n-1][0]===r&&e[n-2][0]===r?e[n-1][1]=i:e.push([r,i])}_checkClosingPt(e){const r=e.length;r>3&&e[0][0]===this._xCut&&e[r-2][0]===this._xCut&&e[1][0]===this._xCut&&(e[0][1]=e[r-2][1],e.pop())}_side(e){return e<this._xCut?-1:e>this._xCut?1:0}_intersect(e,r){const i=(this._xCut-e[0])/(r[0]-e[0]);return e[1]+i*(r[1]-e[1])}_pushLineIn(){this._lineIn&&this._lineIn.length>=this._minPts&&this._linesIn.push(this._lineIn),this._lineIn=[]}_pushLineOut(){this._lineOut&&this._lineOut.length>=this._minPts&&this._linesOut.push(this._lineOut),this._lineOut=[]}},m0=class extends be{constructor(e){super(e)}get bounds(){const e=this.coords;return R(e)||R(e.extent)?null:HL(e.extent)}get coords(){var r;const e=(r=this.element.georeference)==null?void 0:r.coords;return dz(e,this.spatialReference).geometry}get normalizedCoords(){return Jl.fromJSON(xmt(this.coords))}get normalizedBounds(){const e=v(this.normalizedCoords)?this.normalizedCoords.extent:null;return v(e)?HL(e):null}};u([d()],m0.prototype,"spatialReference",void 0),u([d()],m0.prototype,"element",void 0),u([d()],m0.prototype,"bounds",null),u([d()],m0.prototype,"coords",null),u([d()],m0.prototype,"normalizedCoords",null),u([d()],m0.prototype,"normalizedBounds",null),m0=u([$("esri.layers.support.MediaElementView")],m0);let bI=class extends Zoe{constructor(e){super(e),this.content=null,this.type="video"}load(){const e=this.video;if(typeof e=="string"){const r=document.createElement("video");r.src=e,r.crossOrigin="anonymous",r.autoplay=!0,r.muted=!0,r.loop=!0,this.addResolvingPromise(this._loadVideo(r).then(()=>{this._set("content",r)}))}else e instanceof HTMLVideoElement?this.addResolvingPromise(this._loadVideo(e).then(()=>{this._set("content",e)})):this.addResolvingPromise(Promise.reject(new H("video-element:invalid-video-type","Invalid video type",{video:e})));return Promise.resolve(this)}set video(e){this.loadStatus==="not-loaded"?this._set("video",e):re.getLogger(this.declaredClass).error("#video","video cannot be changed after the element is loaded.")}_loadVideo(e){return new Promise((r,i)=>{e.oncanplay=()=>{e.oncanplay=null,e.play().then(r,i)},e.crossOrigin!=="anonymous"&&(e.crossOrigin="anonymous",e.src=e.src)})}};u([d({readOnly:!0})],bI.prototype,"content",void 0),u([d()],bI.prototype,"video",null),bI=u([$("esri.layers.support.VideoElement")],bI);const Qoe=bI,Amt={key:"type",defaultKeyValue:"image",base:Zoe,typeMap:{image:Koe,video:Qoe}},Bge=ct.ofType(Amt);let rA=class extends qu.LoadableMixin(m3(Iw(Sn.EventedAccessor))){constructor(e){super(e),this._index=new wmt,this._elementViewsMap=new Map,this._elementsIndexes=new Map,this._elementsChangedHandler=r=>{for(const n of r.removed){const s=this._elementViewsMap.get(n);this._elementViewsMap.delete(n),this._index.delete(s),this.handles.remove(s),s.destroy(),this.notifyChange("fullExtent")}const{spatialReference:i}=this;for(const n of r.added){if(this._elementViewsMap.get(n))continue;const s=new m0({spatialReference:i,element:n});this._elementViewsMap.set(n,s);const o=ne(()=>s.coords,()=>this._updateIndexForElement(s,!1));this._updateIndexForElement(s,!0),this.handles.add(o,s)}this._elementsIndexes.clear(),this.elements.forEach((n,s)=>this._elementsIndexes.set(n,s)),this.emit("refresh")},this.elements=new Bge}async load(e){if(lr(e),!this.spatialReference){const r=this.elements.find(i=>v(i.georeference)&&v(i.georeference.coords));this._set("spatialReference",r?r.georeference.coords.spatialReference:Je.WGS84)}return this._elementsChangedHandler({added:this.elements.items,removed:[]}),this.handles.add(this.elements.on("change",this._elementsChangedHandler)),this}destroy(){this._index.clear(),this._elementViewsMap.clear(),this._elementsIndexes.clear()}set elements(e){this._set("elements",Kb(e,this._get("elements"),Bge))}get fullExtent(){if(this.loadStatus==="not-loaded")return null;const e=this._index.fullBounds;return R(e)?null:new ur({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:this.spatialReference})}set spatialReference(e){this.loadStatus==="not-loaded"?this._set("spatialReference",e):re.getLogger(this.declaredClass).error("#spatialReference","spatialReference cannot be changed after the source is loaded.")}async queryElements(e,r){await this.load(),await kAe(e.spatialReference,this.spatialReference,null,r);const i=In(e.spatialReference,this.spatialReference)?e:ym(e,this.spatialReference);if(!i)return[];const n=i.normalize(),s=[];for(const o of n)this._index.forEachInBounds(HL(o),({normalizedCoords:a,element:l})=>{v(a)&&G2e(o,a)&&s.push(l)});return s.sort((o,a)=>this._elementsIndexes.get(o)-this._elementsIndexes.get(a)),s}_updateIndexForElement(e,r){const i=e.normalizedBounds,n=this._index.has(e),s=v(i);this._index.delete(e),s&&this._index.set(e,i),this.notifyChange("fullExtent"),r||(n!==s?this.emit("refresh"):this.emit("change",{element:e.element}))}};u([d()],rA.prototype,"elements",null),u([d({readOnly:!0})],rA.prototype,"fullExtent",null),u([d()],rA.prototype,"spatialReference",null),rA=u([$("esri.layers.support.LocalMediaElementSource")],rA);const wH=rA;function jge(t){return typeof t=="object"&&t!=null&&"type"in t}let fu=class extends hMe(DPe(OPe(IN(nD)))){constructor(e){super(e),this.effectiveSource=null,this.copyright=null,this.operationalLayerType="MediaLayer",this.spatialReference=null,this.type="media",this.source=new wH}load(e){const r=this.source;if(!r)return this.addResolvingPromise(Promise.reject(new H("media-layer:source-missing","Set 'MediaLayer.source' before loading the layer."))),Promise.resolve(this);const i=jge(r)?new wH({elements:new ct([r])}):r;this._set("effectiveSource",i),this.spatialReference&&(i.spatialReference=this.spatialReference);const n=i.load(e).then(()=>{this.spatialReference=i.spatialReference});return this.addResolvingPromise(n),Promise.resolve(this)}destroy(){var e,r;(e=this.effectiveSource)==null||e.destroy(),(r=this.source)==null||r.destroy()}get fullExtent(){return this.loaded?this.effectiveSource.fullExtent:null}set source(e){this.loadStatus==="not-loaded"?this._set("source",e):re.getLogger(this.declaredClass).error("#source","source cannot be changed after the layer is loaded.")}castSource(e){return e?Array.isArray(e)||e instanceof ct?new wH({elements:e}):e:null}readSource(e,r,i){const n=r.mediaType==="image"?new Koe:r.mediaType==="video"?new Qoe:null;return n==null||n.read(r,i),n}writeSource(e,r,i,n){var s;e&&jge(e)&&e.type==="image"?e.write(r,n):n!=null&&n.messages&&((s=n==null?void 0:n.messages)==null||s.push(new H("media-layer:unsupported-source","source must be an 'ImageElement'")))}};u([d({readOnly:!0})],fu.prototype,"effectiveSource",void 0),u([d({type:String})],fu.prototype,"copyright",void 0),u([d({readOnly:!0})],fu.prototype,"fullExtent",null),u([d({type:["MediaLayer"]})],fu.prototype,"operationalLayerType",void 0),u([d({type:["show","hide"]})],fu.prototype,"listMode",void 0),u([d({nonNullable:!0,json:{write:{enabled:!0,allowNull:!1}}})],fu.prototype,"source",null),u([cr("source")],fu.prototype,"castSource",null),u([Me("source",["url"])],fu.prototype,"readSource",null),u([De("source")],fu.prototype,"writeSource",null),u([d()],fu.prototype,"spatialReference",void 0),u([d({readOnly:!0})],fu.prototype,"type",void 0),fu=u([$("esri.layers.MediaLayer")],fu);const eae=fu,TGt=Object.freeze(Object.defineProperty({__proto__:null,default:eae},Symbol.toStringTag,{value:"Module"}));let v1=class extends be{constructor(e){super(e),this._viewpointHandle=null,this._handles=new qr,this.group=null}initialize(){this._handles.add(Yn(()=>{var e;return(e=this.view)==null?void 0:e.ui},"expand",e=>{const{target:r}=e;r&&r!==this&&r.expanded&&r.group&&r.group===this.group&&this._collapse()}))}destroy(){this._viewpointHandle=null,this.view=null,this._handles.destroy(),this._handles=null}set autoCollapse(e){this._set("autoCollapse",e),this._watchViewpoint()}set expanded(e){const r=!!e;this._set("expanded",r);const i=this.get("view.ui");i&&i.emit("expand",{target:this}),this._viewpointHandleChange(r)}get state(){return this.get("view.ready")?"ready":"disabled"}set view(e){this._get("view")!==e&&(this._set("view",e),e&&fo(()=>e.ready,()=>{this.view===e&&this._watchViewpoint()},{once:!0,initial:!0}))}_viewpointHandleChange(e){this._viewpointHandle&&(e?fo(()=>this.view.stationary,()=>this._viewpointHandle.resume(),{once:!0,initial:!0}):this._viewpointHandle.pause())}_watchViewpoint(){const e="viewpoint";this._handles.remove(e),this._viewpointHandle=null;const{autoCollapse:r,view:i}=this;if(i&&r){const n=sYe(()=>i.type==="3d"?i.camera:i.viewpoint,()=>this._collapse());this._handles.add(n,e),this._viewpointHandle=n}}_collapse(){this.expanded=!1}};u([d({value:!1})],v1.prototype,"autoCollapse",null),u([d({value:!1})],v1.prototype,"expanded",null),u([d()],v1.prototype,"group",void 0),u([d({readOnly:!0})],v1.prototype,"state",null),u([d({value:null})],v1.prototype,"view",null),v1=u([$("esri.widgets.Expand.ExpandViewModel")],v1);const J$e=v1,Qc="esri-expand",vo={base:`${Qc} esri-widget`,modeAuto:`${Qc}--auto`,modeDrawer:`${Qc}--drawer`,modeFloating:`${Qc}--floating`,container:`${Qc}__container`,containerExpanded:`${Qc}__container--expanded`,panel:`${Qc}__panel`,button:"esri-widget--button",text:"esri-icon-font-fallback-text",icon:"esri-collapse__icon",iconExpanded:`${Qc}__icon--expanded`,iconNumber:`${Qc}__icon-number`,iconNumberExpanded:`${Qc}__icon-number--expanded`,expandIcon:"esri-icon-expand",collapseIcon:"esri-icon-collapse",content:`${Qc}__content`,contentExpanded:`${Qc}__content--expanded`,expandMask:`${Qc}__mask`,expandMaskExpanded:`${Qc}__mask--expanded`};let $s=class extends Ga{constructor(e,r){super(e,r),this.closeOnEsc=!0,this.collapseTooltip="",this.content="",this.expandTooltip="",this.iconNumber=0,this.messages=null,this.messagesCommon=null,this.mode="auto",this.viewModel=new J$e,this._handleKeyDown=i=>{const{closeOnEsc:n,_toggleButtonEl:s,expanded:o}=this;!o||!n||i.target===s||i.key!=="Escape"||(typeof n=="function"?n(i):n)&&(this.expanded=!1,s==null||s.focus())}}get contentId(){return`${this.id}_controls_content`}get expandTitle(){const{expanded:e,messagesCommon:r,collapseTooltip:i,expandTooltip:n}=this;return e?i||r.collapse:n||r.expand}get autoCollapse(){return this.viewModel.autoCollapse}set autoCollapse(e){this.viewModel.autoCollapse=e}get collapseIconClass(){return vo.collapseIcon}set collapseIconClass(e){this._overrideIfSome("collapseIconClass",e)}get expanded(){return this.viewModel.expanded}set expanded(e){this.viewModel.expanded=e}get expandIconClass(){return Az(this.content)?this.content.iconClass:vo.expandIcon}set expandIconClass(e){this._overrideIfSome("expandIconClass",e)}get group(){return this.viewModel.group}set group(e){this.viewModel.group=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}expand(){this.viewModel.expanded=!0}collapse(){this.viewModel.expanded=!1}toggle(){this.viewModel.expanded=!this.viewModel.expanded}render(){const{mode:e}=this,r={[vo.modeAuto]:e==="auto",[vo.modeDrawer]:e==="drawer",[vo.modeFloating]:e==="floating"};return ie("div",{class:this.classes(vo.base,r),onkeydown:this._handleKeyDown},this.renderMask(),this.renderContainer())}renderContainer(){const{expanded:e}=this,r={[vo.containerExpanded]:e};return ie("div",{class:this.classes(vo.container,r)},this.renderPanel(),this.renderContent())}renderMask(){const{expanded:e}=this,r={[vo.expandMaskExpanded]:e};return ie("div",{bind:this,onclick:this._toggle,class:this.classes(vo.expandMask,r)})}renderBadgeNumber(){const{expanded:e,iconNumber:r}=this;return r&&!e?ie("span",{key:"expand__icon-number",class:vo.iconNumber},r):null}renderPanelNumber(){const{iconNumber:e,expanded:r}=this;return e&&r?ie("span",{key:"expand__expand-icon-number",class:this.classes(vo.iconNumber,vo.iconNumberExpanded)},e):null}renderIcon(){const{collapseIconClass:e,expandIconClass:r,expanded:i}=this,n={[vo.iconExpanded]:i,[e]:i,[r]:!i};return e===r&&(n[e]=!0),ie("span",{"aria-hidden":"true",class:this.classes(vo.icon,n)})}renderTitle(){return ie("span",{class:vo.text},this.expandTitle)}renderExpandButton(){const{expanded:e,expandTitle:r,contentId:i}=this;return ie("div",{afterCreate:this._storeToggleButtonEl,"aria-controls":i,"aria-expanded":e?"true":"false",bind:this,class:vo.button,onclick:this._toggle,onkeydown:this._toggle,role:"button",tabindex:"0",title:r},this.renderBadgeNumber(),this.renderIcon(),this.renderTitle())}renderPanel(){return ie("div",{class:vo.panel},this.renderExpandButton(),this.renderPanelNumber())}renderContent(){const{expanded:e,contentId:r,content:i}=this,n={[vo.contentExpanded]:e},s={id:r,role:"region",class:this.classes(vo.content,n)};return typeof i=="string"?ie("div",{key:"content__string",innerHTML:i,...s}):Az(i)?ie("div",{key:"content__widget",...s},i.render()):i instanceof HTMLElement?ie("div",{key:"content__html-element",bind:i,afterCreate:this._attachToNode,...s}):POe(i)?ie("div",{key:"content__node",bind:i.domNode,afterCreate:this._attachToNode,...s}):null}_toggle(){this.toggle()}_attachToNode(e){const r=this;e.appendChild(r)}_storeToggleButtonEl(e){this._toggleButtonEl=e}};u([d({readOnly:!0})],$s.prototype,"contentId",null),u([d({readOnly:!0})],$s.prototype,"expandTitle",null),u([d()],$s.prototype,"autoCollapse",null),u([d()],$s.prototype,"closeOnEsc",void 0),u([d()],$s.prototype,"collapseIconClass",null),u([d()],$s.prototype,"collapseTooltip",void 0),u([d()],$s.prototype,"content",void 0),u([d()],$s.prototype,"expanded",null),u([d()],$s.prototype,"expandIconClass",null),u([d()],$s.prototype,"expandTooltip",void 0),u([d()],$s.prototype,"group",null),u([d()],$s.prototype,"iconNumber",void 0),u([d()],$s.prototype,"label",null),u([d(),_a("esri/widgets/Expand/t9n/Expand")],$s.prototype,"messages",void 0),u([d(),_a("esri/t9n/common")],$s.prototype,"messagesCommon",void 0),u([d()],$s.prototype,"mode",void 0),u([d()],$s.prototype,"view",null),u([d({type:J$e})],$s.prototype,"viewModel",void 0),u([Ph()],$s.prototype,"_toggle",null),$s=u([$("esri.widgets.Expand")],$s);const K$e=$s;let yU=class extends fe{get version(){return this.commitVersionProperties(),(this._get("version")||0)+1}};u([d({readOnly:!0})],yU.prototype,"version",null),yU=u([$("esri.views.layers.support.ClipArea")],yU);const Rmt=yU;var RQ;let bT=RQ=class extends Rmt{constructor(t){super(t),this.type="rect",this.left=null,this.right=null,this.top=null,this.bottom=null}clone(){return new RQ({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left"),this.commitProperty("right"),this.commitProperty("top"),this.commitProperty("bottom")}};u([d({type:[Number,String],json:{write:!0}})],bT.prototype,"left",void 0),u([d({type:[Number,String],json:{write:!0}})],bT.prototype,"right",void 0),u([d({type:[Number,String],json:{write:!0}})],bT.prototype,"top",void 0),u([d({type:[Number,String],json:{write:!0}})],bT.prototype,"bottom",void 0),bT=RQ=u([$("esri.views.layers.support.ClipRect")],bT);const $4=bT;function Omt(t,e){const r=10**e;return Math.round(t*r)/r}const L4={left:0,right:0,top:0,bottom:0};let mu=class extends be{constructor(e){super(e),this._leadingClips=new Map,this._trailingClips=new Map,this.direction="horizontal",this.leadingLayers=new ct,this.max=100,this.min=0,this.precision=4,this.step=.5,this.stepMultiplier=10,this.trailingLayers=new ct,this.view=null}initialize(){this.addHandles([ne(()=>{var e;return[this.view,(e=this.view)==null?void 0:e.ready,this.position,this.direction]},()=>this._clipLayers(),Vt),Yn(()=>this.leadingLayers,"change",()=>this._clipLeadingLayers()),Yn(()=>this.trailingLayers,"change",()=>this._clipTrailingLayers())])}destroy(){this._removeExistingClips()}get position(){return 25}set position(e){const{precision:r,min:i,max:n}=this;this._set("position",Omt(Math.max(Math.min(e,n),i),r))}get state(){const{view:e}=this;return e&&e.ready?"ready":"disabled"}_clipLayers(){this._clipLeadingLayers(),this._clipTrailingLayers()}_clipLeadingLayers(){this._removeClips("leading");const{leadingLayers:e}=this;e.forEach(r=>this._clipLayer({layer:r,type:"leading"}))}_clipTrailingLayers(){this._removeClips("trailing");const{trailingLayers:e}=this;e.forEach(r=>this._clipLayer({layer:r,type:"trailing"}))}async _getLayerView(e){const{view:r}=this;if(!e||!r)return null;const i=await r.whenLayerView(e);return"clips"in i?i:null}_getVerticalClipRect(e){const{position:r}=this;return e==="leading"?new $4({...L4,bottom:100-r+"%"}):e==="trailing"?new $4({...L4,top:`${r}%`}):null}_getHorizontalClipRect(e){const{position:r}=this;return e==="leading"?new $4({...L4,right:100-r+"%"}):e==="trailing"?new $4({...L4,left:`${r}%`}):null}_getClipRect(e){const{direction:r}=this;return r==="vertical"?this._getVerticalClipRect(e):r==="horizontal"?this._getHorizontalClipRect(e):null}async _clipLayer(e){const{_leadingClips:r,_trailingClips:i}=this,{layer:n,type:s}=e,o=s==="trailing"?i:s==="leading"?r:null,a=await this._getLayerView(n);if(!(a&&"clips"in a&&o&&a.hasOwnProperty("clips")))return;const l=o.get(a);l&&a.clips.remove(l);const c=this._getClipRect(s);c&&(o.set(a,c),a.clips.add(c))}_removeClips(e){const{_leadingClips:r,_trailingClips:i}=this,n=e==="trailing"?i:e==="leading"?r:null;n&&(n.forEach((s,o)=>{o&&o.hasOwnProperty("clips")&&o.clips.remove(s)}),n.clear())}_removeExistingClips(){this._removeClips("leading"),this._removeClips("trailing")}};u([d()],mu.prototype,"direction",void 0),u([d({type:ct,nonNullable:!0})],mu.prototype,"leadingLayers",void 0),u([d({readOnly:!0})],mu.prototype,"max",void 0),u([d({readOnly:!0})],mu.prototype,"min",void 0),u([d()],mu.prototype,"position",null),u([d()],mu.prototype,"precision",void 0),u([d({readOnly:!0})],mu.prototype,"state",null),u([d()],mu.prototype,"step",void 0),u([d()],mu.prototype,"stepMultiplier",void 0),u([d({type:ct,nonNullable:!0})],mu.prototype,"trailingLayers",void 0),u([d()],mu.prototype,"view",void 0),mu=u([$("esri.widgets.Swipe.SwipeViewModel")],mu);const Q$e=mu,Dy="esri-swipe",ac={base:Dy,baseDisabled:`${Dy}--disabled`,vertical:`${Dy}--vertical`,horizontal:`${Dy}--horizontal`,container:`${Dy}__container`,divider:`${Dy}__divider`,handle:`${Dy}__handle`,handleHidden:`${Dy}__handle--hidden`,widgetIcon:"esri-icon-up-down-arrows",handleIcon:`${Dy}__handle-icon`,dragIconHorizontal:"esri-icon-drag-horizontal",dragIconVertical:"esri-icon-drag-vertical",widget:"esri-widget",disabled:"esri-disabled"},Gge={handle:!0,divider:!0};let bc=class extends Ga{constructor(e,r){super(e,r),this.disabled=!1,this.iconClass=ac.widgetIcon,this.messages=null,this.viewModel=new Q$e,this._pointerOffset=0,this._container=null,this._onContainerPointerDown=this._onContainerPointerDown.bind(this),this._onContainerPointerMove=this._onContainerPointerMove.bind(this),this._onContainerPointerUp=this._onContainerPointerUp.bind(this)}get direction(){return this.viewModel.direction}set direction(e){this.viewModel.direction=e}get dragLabel(){var e;return((e=this.messages)==null?void 0:e.dragLabel)??""}set dragLabel(e){this._overrideIfSome("dragLabel",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get leadingLayers(){return this.viewModel.leadingLayers}set leadingLayers(e){this.viewModel.leadingLayers=e}get position(){return this.viewModel.position}set position(e){this.viewModel.position=e}get trailingLayers(){return this.viewModel.trailingLayers}set trailingLayers(e){this.viewModel.trailingLayers=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}set visibleElements(e){this._set("visibleElements",{...Gge,...e})}get visibleElements(){return this._get("visibleElements")||Gge}render(){const{state:e,direction:r}=this.viewModel,i=e==="disabled"||this.disabled,n={[ac.disabled]:i,[ac.baseDisabled]:i,[ac.vertical]:r==="vertical",[ac.horizontal]:r==="horizontal"};return ie("div",{class:this.classes(ac.base,ac.widget,n)},e==="disabled"?null:this.renderContainer())}renderHandle(){const{direction:e}=this.viewModel,{visibleElements:r}=this,i={[ac.dragIconHorizontal]:e==="vertical",[ac.dragIconVertical]:e==="horizontal"},n=this.classes(ac.handle,!r.handle&&ac.handleHidden);return ie("div",{key:"handle",role:"presentation",class:n},ie("span",{"aria-hidden":"true",class:this.classes(ac.handleIcon,i)}))}renderDivider(){const{visibleElements:e}=this;return e&&e.divider?ie("div",{key:"divider",role:"presentation",class:ac.divider}):null}renderContent(){return[this.renderDivider(),this.renderHandle()]}renderContainer(){const{disabled:e,dragLabel:r,viewModel:i}=this,{max:n,min:s,direction:o,position:a}=i,l=`${a}%`,c={top:o==="vertical"?l:void 0,left:o==="vertical"?void 0:l},h=this.renderContent();return ie("div",e?{key:"container",role:"presentation",styles:c,class:ac.container}:{tabIndex:0,key:"container",bind:this,afterCreate:this._afterContainerCreate,onkeydown:this._onContainerKeyDown,"touch-action":"none",role:"slider",title:r,"aria-label":r,"aria-orientation":o,"aria-valuemax":`${n}`,"aria-valuemin":`${s}`,"aria-valuenow":`${a}`,"aria-valuetext":l,styles:c,class:ac.container},h)}_afterContainerCreate(e){this._container=e,e.addEventListener("pointerdown",this._onContainerPointerDown)}_calculatePointerOffset(e){const{direction:r}=this,i=e.target,n=(r==="vertical"?i.clientHeight:i.clientWidth)/2,s=i.getBoundingClientRect(),o=e.clientX-s.left,a=e.clientY-s.top;this._pointerOffset=r==="vertical"?a-n:o-n}_onContainerPointerDown(e){e.preventDefault(),this._container&&document.activeElement!==this.container&&this._container.focus(),this._calculatePointerOffset(e),document.addEventListener("pointerup",this._onContainerPointerUp),document.addEventListener("pointermove",this._onContainerPointerMove)}_onContainerPointerUp(e){e.preventDefault(),document.removeEventListener("pointerup",this._onContainerPointerUp),document.removeEventListener("pointermove",this._onContainerPointerMove)}_onContainerPointerMove(e){e.preventDefault();const{_pointerOffset:r,container:i,direction:n}=this,{clientX:s,clientY:o}=e,{top:a,left:l,width:c,height:h}=i.getBoundingClientRect(),p=(n==="vertical"?o-a-r:s-l-r)/(n==="vertical"?h:c)*100;this.position=p}_getKeyPosition(e){const r=G1(e),{position:i}=this,{max:n,min:s,step:o,stepMultiplier:a,direction:l}=this.viewModel,c=o*a;return["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Home","End","PageUp","PageDown"].includes(r)&&(e.preventDefault(),e.stopPropagation()),(l==="vertical"?r==="ArrowDown"||r==="ArrowRight":r==="ArrowUp"||r==="ArrowRight")?i+(e.shiftKey?c:o):(l==="vertical"?r==="ArrowUp"||r==="ArrowLeft":r==="ArrowDown"||r==="ArrowLeft")?i-(e.shiftKey?c:o):r==="Home"?s:r==="End"?n:(l==="vertical"?r==="PageDown":r==="PageUp")?i+c:(l==="vertical"?r==="PageUp":r==="PageDown")?i-c:null}_onContainerKeyDown(e){const r=this._getKeyPosition(e);typeof r=="number"&&(this.position=r)}};u([d()],bc.prototype,"direction",null),u([d()],bc.prototype,"disabled",void 0),u([d()],bc.prototype,"dragLabel",null),u([d()],bc.prototype,"iconClass",void 0),u([d()],bc.prototype,"label",null),u([d()],bc.prototype,"leadingLayers",null),u([d(),_a("esri/widgets/Swipe/t9n/Swipe")],bc.prototype,"messages",void 0),u([d()],bc.prototype,"position",null),u([d()],bc.prototype,"trailingLayers",null),u([d()],bc.prototype,"view",null),u([d({type:Q$e})],bc.prototype,"viewModel",void 0),u([d()],bc.prototype,"visibleElements",null),bc=u([$("esri.widgets.Swipe")],bc);const Mmt=bc;/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.7
 */const OQ="hidden-form-input";function tae(t){return"checked"in t}const MQ=new WeakMap,rae=new WeakSet;function Pmt(t,e){const r="calciteInternalFormComponentRegister";let i=!1;return t.addEventListener(r,n=>{i=n.composedPath().some(s=>rae.has(s)),n.stopPropagation()},{once:!0}),e.dispatchEvent(new CustomEvent(r,{bubbles:!0,composed:!0})),i}function Imt(t){const{formEl:e}=t;return e?("requestSubmit"in e?e.requestSubmit():e.submit(),!0):!1}function $mt(t){var e;(e=t.formEl)==null||e.reset()}function OGt(t){const{el:e,value:r}=t,i=v3(e,"form");if(!i||Pmt(i,e))return;t.formEl=i,t.defaultValue=r,tae(t)&&(t.defaultChecked=t.checked);const n=(t.onFormReset||Lmt).bind(t);i.addEventListener("reset",n),MQ.set(t.el,n),rae.add(e)}function Lmt(){if(tae(this)){this.checked=this.defaultChecked;return}this.value=this.defaultValue}function MGt(t){const{el:e,formEl:r}=t;if(!r)return;const i=MQ.get(e);r.removeEventListener("reset",i),MQ.delete(e),t.formEl=null,rae.delete(e)}const eLe=t=>{t.target.dispatchEvent(new CustomEvent("calciteInternalHiddenInputChange",{bubbles:!0}))},Hge=t=>t.removeEventListener("change",eLe);function Dmt(t){const{el:e,formEl:r,name:i,value:n}=t,{ownerDocument:s}=e,o=e.querySelectorAll(`input[slot="${OQ}"]`);if(!r||!i){o.forEach(p=>{Hge(p),p.remove()});return}const a=Array.isArray(n)?n:[n],l=[],c=new Set;o.forEach(p=>{const f=a.find(m=>m==p.value);f!=null?(c.add(f),qge(t,p,f)):l.push(p)});let h;a.forEach(p=>{if(c.has(p))return;let f=l.pop();f||(f=s.createElement("input"),f.slot=OQ),h||(h=s.createDocumentFragment()),h.append(f),f.addEventListener("change",eLe),qge(t,f,p)}),h&&e.append(h),l.forEach(p=>{Hge(p),p.remove()})}function qge(t,e,r){var a;const{defaultValue:i,disabled:n,name:s,required:o}=t;e.defaultValue=i,e.disabled=n,e.name=s,e.required=o,e.tabIndex=-1,tae(t)?(e.checked=t.checked,e.defaultChecked=t.defaultChecked,e.value=t.checked?r||"on":""):e.value=r||"",(a=t.syncHiddenFormInput)==null||a.call(t,e)}const PGt=({component:t})=>(Dmt(t),_s("slot",{name:OQ}));/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.7
 */function Nmt(){}function Fmt(t,e=!1){if(t.disabled){t.el.setAttribute("tabindex","-1"),t.el.setAttribute("aria-disabled","true"),t.el.contains(document.activeElement)&&document.activeElement.blur(),t.el.click=Nmt;return}t.el.click=HTMLElement.prototype.click,typeof e=="function"?t.el.setAttribute("tabindex",e.call(t)?"0":"-1"):e===!0?t.el.setAttribute("tabindex","0"):e===!1&&t.el.removeAttribute("tabindex"),t.el.removeAttribute("aria-disabled")}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.7
 */const tLe="calciteInternalLabelClick",iae="calciteInternalLabelConnected",PQ="calciteInternaLabelDisconnected",Wge="calcite-label",Xz=new WeakMap,uD=new WeakMap,Yz=new WeakMap,$R=new Set,kmt=t=>{const{id:e}=t,r=e&&sQe(t,{selector:`${Wge}[for="${e}"]`});if(r)return r;const i=v3(t,Wge);return!i||Umt(i,t)?null:i};function Umt(t,e){let r;const i="custom-element-ancestor-check",n=o=>{o.stopImmediatePropagation();const a=o.composedPath();r=a.slice(a.indexOf(e),a.indexOf(t))};return t.addEventListener(i,n,{once:!0}),e.dispatchEvent(new CustomEvent(i,{composed:!0,bubbles:!0})),t.removeEventListener(i,n),r.filter(o=>o!==e&&o!==t).filter(o=>{var a;return(a=o.tagName)==null?void 0:a.includes("-")}).length>0}function rLe(t){const e=kmt(t.el);if(Xz.has(e)||!e&&$R.has(t))return;const r=Gmt.bind(t);if(e){t.labelEl=e;const i=Bmt.bind(t);Xz.set(t.labelEl,i),t.labelEl.addEventListener(tLe,i),$R.delete(t),document.removeEventListener(iae,uD.get(t)),Yz.set(t,r),document.addEventListener(PQ,r)}else $R.has(t)||(r(),document.removeEventListener(PQ,Yz.get(t)))}function zmt(t){if($R.delete(t),document.removeEventListener(iae,uD.get(t)),document.removeEventListener(PQ,Yz.get(t)),uD.delete(t),Yz.delete(t),!t.labelEl)return;const e=Xz.get(t.labelEl);t.labelEl.removeEventListener(tLe,e),Xz.delete(t.labelEl)}function Vmt(t){var e,r;return t.label||((r=(e=t.labelEl)==null?void 0:e.textContent)==null?void 0:r.trim())||""}function Bmt(t){this.disabled||this.el.contains(t.detail.sourceEvent.target)||this.onLabelClick(t)}function jmt(){$R.has(this)&&rLe(this)}function Gmt(){$R.add(this);const t=uD.get(this)||jmt.bind(this);uD.set(this,t),document.addEventListener(iae,t)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.7
 */const iLe=new WeakMap,nLe=new WeakMap;function Hmt(t){nLe.set(t,new Promise(e=>iLe.set(t,e)))}function qmt(t){iLe.get(t)()}function Wmt(t){return nLe.get(t)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.7
 */function IGt(t){return t==="Enter"||t===" "}const sLe=["0","1","2","3","4","5","6","7","8","9"];/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.7
 */function nae(t,e,r){const i=Xmt(t);return new i(e,r)}function Xmt(t){class e extends window.MutationObserver{constructor(i){super(i),this.observedEntry=[],this.callback=i}observe(i,n){return this.observedEntry.push({target:i,options:n}),super.observe(i,n)}unobserve(i){const n=this.observedEntry.filter(s=>s.target!==i);this.observedEntry=[],this.callback(super.takeRecords(),this),this.disconnect(),n.forEach(s=>this.observe(s.target,s.options))}}return function(){return t==="intersection"?window.IntersectionObserver:t==="mutation"?e:window.ResizeObserver}()}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.7
 */const Ymt=new RegExp("-","g"),Zmt=new RegExp("\\.?0+$");class ji{constructor(e){if(this.add=n=>ji.fromBigInt(this.value+new ji(n).value),this.subtract=n=>ji.fromBigInt(this.value-new ji(n).value),this.multiply=n=>ji._divRound(this.value*new ji(n).value,ji.SHIFT),this.divide=n=>ji._divRound(this.value*ji.SHIFT,new ji(n).value),e instanceof ji)return e;const[r,i]=String(e).split(".").concat("");this.value=BigInt(r+i.padEnd(ji.DECIMALS,"0").slice(0,ji.DECIMALS))+BigInt(ji.ROUNDED&&i[ji.DECIMALS]>="5"),this.isNegative=e.charAt(0)==="-"}getIntegersAndDecimals(){const e=this.value.toString().replace(Ymt,"").padStart(ji.DECIMALS+1,"0"),r=e.slice(0,-ji.DECIMALS),i=e.slice(-ji.DECIMALS).replace(Zmt,"");return{integers:r,decimals:i}}toString(){const{integers:e,decimals:r}=this.getIntegersAndDecimals();return`${this.isNegative?"-":""}${e}${r.length?"."+r:""}`}formatToParts(e){const{integers:r,decimals:i}=this.getIntegersAndDecimals(),n=e.numberFormatter.formatToParts(BigInt(r));return this.isNegative&&n.unshift({type:"minusSign",value:e.minusSign}),i.length&&(n.push({type:"decimal",value:e.decimal}),i.split("").forEach(s=>n.push({type:"fraction",value:s}))),n}format(e){const{integers:r,decimals:i}=this.getIntegersAndDecimals(),n=`${this.isNegative?e.minusSign:""}${e.numberFormatter.format(BigInt(r))}`,s=i.length?`${e.decimal}${i.split("").map(o=>e.numberFormatter.format(Number(o))).join("")}`:"";return`${n}${s}`}}ji.DECIMALS=100;ji.ROUNDED=!0;ji.SHIFT=BigInt("1"+"0".repeat(ji.DECIMALS));ji._divRound=(t,e)=>ji.fromBigInt(t/e+(ji.ROUNDED?t*BigInt(2)/e%BigInt(2):BigInt(0)));ji.fromBigInt=t=>Object.assign(Object.create(ji.prototype),{value:t});function sae(t){return!(!t||isNaN(Number(t)))}function $Gt(t){return!t||!tgt(t)?"":Zz(t,e=>{let r=!1;const i=e.split("").filter((n,s)=>n.match(/\./g)&&!r?(r=!0,!0):n.match(/\-/g)&&s===0?!0:sLe.includes(n)).reduce((n,s)=>n+s);return sae(i)?new ji(i).toString():""})}const Jmt=/^([-0])0+(?=\d)/,Kmt=/(?!^\.)\.$/,Qmt=/(?!^-)-/g,egt=/^-\b0\b\.?0*$/,LGt=t=>Zz(t,e=>{const r=e.replace(Qmt,"").replace(Kmt,"").replace(Jmt,"$1");return sae(r)?egt.test(r)?r:new ji(r).toString():e});function Zz(t,e){if(!t)return t;const r=t.toLowerCase().indexOf("e")+1;return r?t.replace(/[eE]*$/g,"").substring(0,r).concat(t.slice(r).replace(/[eE]/g,"")).split(/[eE]/).map((i,n)=>e(n===1?i.replace(/\./g,""):i)).join("e").replace(/^e/,"1e"):e(t)}function tgt(t){return sLe.some(e=>t.includes(e))}const uw="en",rgt=["ar","bg","bs","ca","cs","da","de","el",uw,"es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","no","nl","pl","pt-BR","pt-PT","ro","ru","sk","sl","sr","sv","th","tr","uk","vi","zh-CN","zh-HK","zh-TW"],igt=["ar","bg","bs","ca","cs","da","de","de-CH","el",uw,"en-AU","en-CA","en-GB","es","es-MX","et","fi","fr","fr-CH","he","hi","hr","hu","id","it","it-CH","ja","ko","lt","lv","mk","no","nl","pl","pt","pt-PT","ro","ru","sk","sl","sr","sv","th","tr","uk","vi","zh-CN","zh-HK","zh-TW"],ngt=["arab","arabext","bali","beng","deva","fullwide","gujr","guru","hanidec","khmr","knda","laoo","latn","limb","mlym","mong","mymr","orya","tamldec","telu","thai","tibt"],oLe=t=>ngt.includes(t),xH=new Intl.NumberFormat().resolvedOptions().numberingSystem,aLe=xH==="arab"||!oLe(xH)?"latn":xH,sgt=t=>oLe(t)?t:aLe;function lLe(t,e="cldr"){const r=e==="cldr"?igt:rgt;return t?r.includes(t)?t:(t=t.toLowerCase(),t==="nb"?"no":e==="t9n"&&t==="pt"?"pt-BR":(t.includes("-")&&(t=t.replace(/(\w+)-(\w+)/,(i,n,s)=>`${n}-${s.toUpperCase()}`),r.includes(t)||(t=t.split("-")[0])),t==="zh"?"zh-CN":r.includes(t)?t:(console.warn(`Translations for the "${t}" locale are not available and will fall back to the default, English (en).`),uw))):uw}const hD=new Set;function ogt(t){agt(t),hD.size===0&&(_U==null||_U.observe(document.documentElement,{attributes:!0,attributeFilter:["lang"],subtree:!0})),hD.add(t)}function agt(t){t.effectiveLocale=cgt(t)}function lgt(t){hD.delete(t),hD.size===0&&_U.disconnect()}const _U=nae("mutation",t=>{t.forEach(e=>{const r=e.target;hD.forEach(i=>{if(!aQe(r,i.el))return;const s=v3(i.el,"[lang]");if(!s){i.effectiveLocale=uw;return}const o=s.lang;i.effectiveLocale=s.hasAttribute("lang")&&o===""?uw:o})})});function cgt(t){var e;return t.el.lang||((e=v3(t.el,"[lang]"))==null?void 0:e.lang)||document.documentElement.lang||uw}class ugt{constructor(){this.delocalize=e=>this._numberFormatOptions?Zz(e,r=>r.trim().replace(new RegExp(`[${this._minusSign}]`,"g"),"-").replace(new RegExp(`[${this._group}]`,"g"),"").replace(new RegExp(`[${this._decimal}]`,"g"),".").replace(new RegExp(`[${this._digits.join("")}]`,"g"),this._getDigitIndex)):e,this.localize=e=>this._numberFormatOptions?Zz(e,r=>sae(r.trim())?new ji(r.trim()).format(this).replace(new RegExp(`[${this._actualGroup}]`,"g"),this._group):r):e}get group(){return this._group}get decimal(){return this._decimal}get minusSign(){return this._minusSign}get digits(){return this._digits}get numberFormatter(){return this._numberFormatter}get numberFormatOptions(){return this._numberFormatOptions}set numberFormatOptions(e){if(e.locale=lLe(e==null?void 0:e.locale),e.numberingSystem=sgt(e==null?void 0:e.numberingSystem),!this._numberFormatOptions&&e.locale===uw&&e.numberingSystem===aLe&&Object.keys(e).length===2||JSON.stringify(this._numberFormatOptions)===JSON.stringify(e))return;this._numberFormatOptions=e,this._numberFormatter=new Intl.NumberFormat(this._numberFormatOptions.locale,this._numberFormatOptions),this._digits=[...new Intl.NumberFormat(this._numberFormatOptions.locale,{useGrouping:!1,numberingSystem:this._numberFormatOptions.numberingSystem}).format(9876543210)].reverse();const r=new Map(this._digits.map((n,s)=>[n,s])),i=new Intl.NumberFormat(this._numberFormatOptions.locale).formatToParts(-123456789e-1);this._actualGroup=i.find(n=>n.type==="group").value,this._group=this._actualGroup.trim().length===0?" ":this._actualGroup,this._decimal=i.find(n=>n.type==="decimal").value,this._minusSign=i.find(n=>n.type==="minusSign").value,this._getDigitIndex=n=>r.get(n)}}const DGt=new ugt;/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.7
 */const D4={};async function hgt(t,e){const r=`${e}_${t}`;return D4[r]||(D4[r]=fetch(MRe(`./assets/${e}/t9n/messages_${t}.json`)).then(i=>(i.ok||Xge(),i.json())).catch(()=>Xge())),D4[r]}function Xge(){throw new Error("could not fetch component message bundle")}function oae(t){t.messages={...t.defaultMessages,...t.messageOverrides}}async function dgt(t){t.defaultMessages=await cLe(t,t.effectiveLocale),oae(t)}async function cLe(t,e){const{el:r}=t,n=r.tagName.toLowerCase().replace("calcite-","");return hgt(lLe(e,"t9n"),n)}async function pgt(t,e){t.defaultMessages=await cLe(t,e),oae(t)}function fgt(t){t.onMessagesChange=ggt}function mgt(t){t.onMessagesChange=void 0}function ggt(){oae(this)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.7
 */const ygt={icon:"icon",flipRtl:"flip-rtl"},TH={},SH={},uLe={s:16,m:24,l:32};async function _gt({icon:t,scale:e}){const r=uLe[e],i=vgt(t),n=i.charAt(i.length-1)==="F",o=`${n?i.substring(0,i.length-1):i}${r}${n?"F":""}`;if(TH[o])return TH[o];SH[o]||(SH[o]=fetch(MRe(`./assets/icon/${o}.json`)).then(l=>l.json()).catch(()=>(console.error(`"${o}" is not a valid calcite-ui-icon name`),"")));const a=await SH[o];return TH[o]=a,a}function vgt(t){const e=!isNaN(Number(t.charAt(0))),r=t.split("-");if(r.length>0){const n=/[a-z]/i;t=r.map((s,o)=>s.replace(n,function(l,c){return o===0&&c===0?l:l.toUpperCase()})).join("")}return e?`i${t}`:t}const bgt="@keyframes in{0%{opacity:0}100%{opacity:1}}@keyframes in-down{0%{opacity:0;transform:translate3D(0, -5px, 0)}100%{opacity:1;transform:translate3D(0, 0, 0)}}@keyframes in-up{0%{opacity:0;transform:translate3D(0, 5px, 0)}100%{opacity:1;transform:translate3D(0, 0, 0)}}@keyframes in-scale{0%{opacity:0;transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;transform:scale3D(1, 1, 1)}}:root{--calcite-animation-timing:calc(150ms * var(--calcite-internal-duration-factor));--calcite-internal-duration-factor:var(--calcite-duration-factor, 1);--calcite-internal-animation-timing-fast:calc(100ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-medium:calc(200ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-slow:calc(300ms * var(--calcite-internal-duration-factor))}.calcite-animate{opacity:0;animation-fill-mode:both;animation-duration:var(--calcite-animation-timing)}.calcite-animate__in{animation-name:in}.calcite-animate__in-down{animation-name:in-down}.calcite-animate__in-up{animation-name:in-up}.calcite-animate__in-scale{animation-name:in-scale}@media (prefers-reduced-motion: reduce){:root{--calcite-internal-duration-factor:0}}:root{--calcite-floating-ui-transition:var(--calcite-animation-timing);--calcite-floating-ui-z-index:600}:host([hidden]){display:none}:host{display:inline-flex;color:var(--calcite-ui-icon-color)}:host([scale=s]){block-size:1rem;inline-size:1rem;min-inline-size:1rem;min-block-size:1rem}:host([scale=m]){block-size:1.5rem;inline-size:1.5rem;min-inline-size:1.5rem;min-block-size:1.5rem}:host([scale=l]){block-size:2rem;inline-size:2rem;min-inline-size:2rem;min-block-size:2rem}.flip-rtl{transform:scaleX(-1)}.svg{display:block}",wgt=vse(class extends bse{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.icon=null,this.flipRtl=!1,this.scale="m",this.textLabel=void 0,this.pathData=void 0,this.visible=!1}connectedCallback(){this.waitUntilVisible(()=>{this.visible=!0,this.loadIconPathData()})}disconnectedCallback(){var t;(t=this.intersectionObserver)==null||t.disconnect(),this.intersectionObserver=null}async componentWillLoad(){this.loadIconPathData()}render(){const{el:t,flipRtl:e,pathData:r,scale:i,textLabel:n}=this,s=nQe(t),o=uLe[i],a=!!n,l=[].concat(r||"");return _s(gse,{"aria-hidden":hQe(!a),"aria-label":a?n:null,role:a?"img":null},_s("svg",{"aria-hidden":"true",class:{[ygt.flipRtl]:s==="rtl"&&e,svg:!0},fill:"currentColor",height:"100%",viewBox:`0 0 ${o} ${o}`,width:"100%",xmlns:"http://www.w3.org/2000/svg"},l.map(c=>typeof c=="string"?_s("path",{d:c}):_s("path",{d:c.d,opacity:"opacity"in c?c.opacity:1}))))}async loadIconPathData(){const{icon:t,scale:e,visible:r}=this;!t||!r||(this.pathData=await _gt({icon:t,scale:e}))}waitUntilVisible(t){if(this.intersectionObserver=nae("intersection",e=>{e.forEach(r=>{r.isIntersecting&&(this.intersectionObserver.disconnect(),this.intersectionObserver=null,t())})},{rootMargin:"50px"}),!this.intersectionObserver){t();return}this.intersectionObserver.observe(this.el)}static get assetsDirs(){return["assets"]}get el(){return this}static get watchers(){return{icon:["loadIconPathData"],scale:["loadIconPathData"]}}static get style(){return bgt}},[1,"calcite-icon",{icon:[513],flipRtl:[516,"flip-rtl"],scale:[513],textLabel:[1,"text-label"],pathData:[32],visible:[32]}]);function hLe(){if(typeof customElements>"u")return;["calcite-icon"].forEach(e=>{switch(e){case"calcite-icon":customElements.get(e)||customElements.define(e,wgt);break}})}hLe();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.7
 */const xgt='@charset "UTF-8";@keyframes in{0%{opacity:0}100%{opacity:1}}@keyframes in-down{0%{opacity:0;transform:translate3D(0, -5px, 0)}100%{opacity:1;transform:translate3D(0, 0, 0)}}@keyframes in-up{0%{opacity:0;transform:translate3D(0, 5px, 0)}100%{opacity:1;transform:translate3D(0, 0, 0)}}@keyframes in-scale{0%{opacity:0;transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;transform:scale3D(1, 1, 1)}}:root{--calcite-animation-timing:calc(150ms * var(--calcite-internal-duration-factor));--calcite-internal-duration-factor:var(--calcite-duration-factor, 1);--calcite-internal-animation-timing-fast:calc(100ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-medium:calc(200ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-slow:calc(300ms * var(--calcite-internal-duration-factor))}.calcite-animate{opacity:0;animation-fill-mode:both;animation-duration:var(--calcite-animation-timing)}.calcite-animate__in{animation-name:in}.calcite-animate__in-down{animation-name:in-down}.calcite-animate__in-up{animation-name:in-up}.calcite-animate__in-scale{animation-name:in-scale}@media (prefers-reduced-motion: reduce){:root{--calcite-internal-duration-factor:0}}:root{--calcite-floating-ui-transition:var(--calcite-animation-timing);--calcite-floating-ui-z-index:600}:host([hidden]){display:none}:host{position:relative;margin-inline:auto;display:none;align-items:center;justify-content:center;opacity:1;min-block-size:var(--calcite-loader-size);font-size:var(--calcite-loader-font-size);stroke:var(--calcite-ui-brand);stroke-width:3;fill:none;transform:scale(1, 1);animation:loader-color-shift calc(var(--calcite-internal-animation-timing-slow) * 2) alternate-reverse infinite linear;padding-block:var(--calcite-loader-padding, 4rem)}:host([scale=s]){--calcite-loader-font-size:var(--calcite-font-size--2);--calcite-loader-size:2rem;--calcite-loader-size-inline:0.75rem}:host([scale=m]){--calcite-loader-font-size:var(--calcite-font-size-0);--calcite-loader-size:4rem;--calcite-loader-size-inline:1rem}:host([scale=l]){--calcite-loader-font-size:var(--calcite-font-size-2);--calcite-loader-size:6rem;--calcite-loader-size-inline:1.5rem}:host([no-padding]){padding-block:0px}:host{display:flex}.loader__text{display:block;text-align:center;font-size:var(--calcite-font-size--2);line-height:1rem;color:var(--calcite-ui-text-1);margin-block-start:calc(var(--calcite-loader-size) + 1.5rem)}.loader__percentage{position:absolute;display:block;text-align:center;color:var(--calcite-ui-text-1);font-size:var(--calcite-loader-font-size);inline-size:var(--calcite-loader-size);inset-inline-start:50%;margin-inline-start:calc(var(--calcite-loader-size) / 2 * -1);line-height:0.25;transform:scale(1, 1)}.loader__svgs{position:absolute;overflow:visible;opacity:1;inline-size:var(--calcite-loader-size);block-size:var(--calcite-loader-size);inset-inline-start:50%;margin-inline-start:calc(var(--calcite-loader-size) / 2 * -1);transform:scale(1, 1)}.loader__svg{position:absolute;inset-block-start:0px;transform-origin:center;overflow:visible;inset-inline-start:0;inline-size:var(--calcite-loader-size);block-size:var(--calcite-loader-size);animation-iteration-count:infinite;animation-timing-function:linear;animation-name:loader-clockwise}@supports (display: grid){.loader__svg--1{animation-name:loader-offset-1}.loader__svg--2{animation-name:loader-offset-2}.loader__svg--3{animation-name:loader-offset-3}}:host([type=determinate]){animation:none;stroke:var(--calcite-ui-border-3)}:host([type=determinate]) .loader__svg--3{animation:none;stroke:var(--calcite-ui-brand);stroke-dasharray:150.79632;transform:rotate(-90deg);transition:all var(--calcite-internal-animation-timing-fast) linear}:host([inline]){position:relative;margin:0px;animation:none;stroke:currentColor;stroke-width:2;padding-block:0px;block-size:var(--calcite-loader-size-inline);min-block-size:var(--calcite-loader-size-inline);inline-size:var(--calcite-loader-size-inline);margin-inline-end:calc(var(--calcite-loader-size-inline) * 0.5);vertical-align:calc(var(--calcite-loader-size-inline) * -1 * 0.2)}:host([inline]) .loader__svgs{inset-block-start:0px;margin:0px;inset-inline-start:0;inline-size:var(--calcite-loader-size-inline);block-size:var(--calcite-loader-size-inline)}:host([inline]) .loader__svg{inline-size:var(--calcite-loader-size-inline);block-size:var(--calcite-loader-size-inline)}:host([complete]){opacity:0;transform:scale(0.75, 0.75);transform-origin:center;transition:opacity var(--calcite-internal-animation-timing-medium) linear 1000ms, transform var(--calcite-internal-animation-timing-medium) linear 1000ms}:host([complete]) .loader__svgs{opacity:0;transform:scale(0.75, 0.75);transform-origin:center;transition:opacity calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms, transform calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms}:host([complete]) .loader__percentage{color:var(--calcite-ui-brand);transform:scale(1.05, 1.05);transform-origin:center;transition:color var(--calcite-internal-animation-timing-medium) linear, transform var(--calcite-internal-animation-timing-medium) linear}.loader__svg--1{stroke-dasharray:27.9252444444% 139.6262222222%;animation-duration:calc(var(--calcite-internal-animation-timing-slow) * 2.4)}@keyframes loader-offset-1{0%{stroke-dasharray:27.9252444444% 251.3272%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-83.7757333333%}100%{stroke-dasharray:27.9252444444% 251.3272%;stroke-dashoffset:-279.2524444444%}}.loader__svg--2{stroke-dasharray:55.8504888889% 139.6262222222%;animation-duration:calc(var(--calcite-internal-animation-timing-slow) * 3.2)}@keyframes loader-offset-2{0%{stroke-dasharray:55.8504888889% 223.4019555556%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-97.7383555556%}100%{stroke-dasharray:55.8504888889% 223.4019555556%;stroke-dashoffset:-279.2524444444%}}.loader__svg--3{stroke-dasharray:13.9626222222% 139.6262222222%;animation-duration:calc(var(--calcite-internal-animation-timing-slow) * 3.867)}@keyframes loader-offset-3{0%{stroke-dasharray:13.9626222222% 265.2898222222%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-76.7944222222%}100%{stroke-dasharray:13.9626222222% 265.2898222222%;stroke-dashoffset:-279.2524444444%}}@keyframes loader-color-shift{0%{stroke:var(--calcite-ui-brand)}33%{stroke:var(--calcite-ui-brand-press)}66%{stroke:var(--calcite-ui-brand-hover)}100%{stroke:var(--calcite-ui-brand)}}@keyframes loader-clockwise{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}',Tgt=vse(class extends bse{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.inline=!1,this.label=void 0,this.scale="m",this.type=void 0,this.value=0,this.text=""}render(){const{el:t,inline:e,label:r,scale:i,text:n,type:s,value:o}=this,a=t.id||VKe(),l=.45,c=e?this.getInlineSize(i):this.getSize(i),h=c*l,p=`0 0 ${c} ${c}`,f=s==="determinate",m=2*h*Math.PI,g=o/100*m,_=m-g,b=Math.floor(o),w={"aria-valuenow":b,"aria-valuemin":0,"aria-valuemax":100,complete:b===100},x={r:h,cx:c/2,cy:c/2},T={"stroke-dasharray":`${g} ${_}`};return _s(gse,{"aria-label":r,id:a,role:"progressbar",...f?w:{}},_s("div",{class:"loader__svgs"},_s("svg",{"aria-hidden":"true",class:"loader__svg loader__svg--1",viewBox:p},_s("circle",{...x})),_s("svg",{"aria-hidden":"true",class:"loader__svg loader__svg--2",viewBox:p},_s("circle",{...x})),_s("svg",{"aria-hidden":"true",class:"loader__svg loader__svg--3",viewBox:p,...f?{style:T}:{}},_s("circle",{...x}))),n&&_s("div",{class:"loader__text"},n),f&&_s("div",{class:"loader__percentage"},o))}getSize(t){return{s:32,m:56,l:80}[t]}getInlineSize(t){return{s:12,m:16,l:20}[t]}get el(){return this}static get style(){return xgt}},[1,"calcite-loader",{inline:[516],label:[1],scale:[513],type:[513],value:[2],text:[1]}]);function dLe(){if(typeof customElements>"u")return;["calcite-loader"].forEach(e=>{switch(e){case"calcite-loader":customElements.get(e)||customElements.define(e,Tgt);break}})}dLe();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.7
 */(function(t){if(typeof t.requestSubmit=="function")return;t.requestSubmit=function(i){i?(e(i,this),i.click()):(i=document.createElement("input"),i.type="submit",i.hidden=!0,this.appendChild(i),i.click(),this.removeChild(i))};function e(i,n){i instanceof HTMLElement||r(TypeError,"parameter 1 is not of type 'HTMLElement'"),i.type=="submit"||r(TypeError,"The specified element is not a submit button"),i.form==n||r(DOMException,"The specified element is not owned by this form element","NotFoundError")}function r(i,n,s){throw new i("Failed to execute 'requestSubmit' on 'HTMLFormElement': "+n+".",s)}})(HTMLFormElement.prototype);const sh={buttonLoader:"calcite-button--loader",content:"content",contentSlotted:"content--slotted",icon:"icon",iconStart:"icon--start",iconEnd:"icon--end",loadingIn:"loading-in",loadingOut:"loading-out",iconStartEmpty:"icon-start-empty",iconEndEmpty:"icon-end-empty",buttonPadding:"button-padding",buttonPaddingShrunk:"button-padding--shrunk"},Sgt="@keyframes in{0%{opacity:0}100%{opacity:1}}@keyframes in-down{0%{opacity:0;transform:translate3D(0, -5px, 0)}100%{opacity:1;transform:translate3D(0, 0, 0)}}@keyframes in-up{0%{opacity:0;transform:translate3D(0, 5px, 0)}100%{opacity:1;transform:translate3D(0, 0, 0)}}@keyframes in-scale{0%{opacity:0;transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;transform:scale3D(1, 1, 1)}}:root{--calcite-animation-timing:calc(150ms * var(--calcite-internal-duration-factor));--calcite-internal-duration-factor:var(--calcite-duration-factor, 1);--calcite-internal-animation-timing-fast:calc(100ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-medium:calc(200ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-slow:calc(300ms * var(--calcite-internal-duration-factor))}.calcite-animate{opacity:0;animation-fill-mode:both;animation-duration:var(--calcite-animation-timing)}.calcite-animate__in{animation-name:in}.calcite-animate__in-down{animation-name:in-down}.calcite-animate__in-up{animation-name:in-up}.calcite-animate__in-scale{animation-name:in-scale}@media (prefers-reduced-motion: reduce){:root{--calcite-internal-duration-factor:0}}:root{--calcite-floating-ui-transition:var(--calcite-animation-timing);--calcite-floating-ui-z-index:600}:host([hidden]){display:none}:host([disabled]){pointer-events:none;cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-ui-opacity-disabled)}:host{display:inline-block;inline-size:auto;vertical-align:middle}:host([round]){border-radius:50px}:host([round]) a,:host([round]) button{border-radius:50px}:host button,:host a{outline-color:transparent}:host button:focus,:host a:focus{outline:2px solid var(--calcite-ui-brand);outline-offset:2px}:host button,:host a{--calcite-button-content-margin-internal:0.5rem;--calcite-button-padding-x-internal:7px;--calcite-button-padding-y-internal:3px;padding-block:var(--calcite-button-padding-y-internal);padding-inline:var(--calcite-button-padding-x-internal);position:relative;box-sizing:border-box;display:flex;block-size:100%;inline-size:100%;cursor:pointer;-webkit-user-select:none;user-select:none;-webkit-appearance:none;appearance:none;align-items:center;justify-content:center;border-radius:0px;border-style:none;text-align:center;font-family:inherit;font-weight:var(--calcite-font-weight-normal);text-decoration-line:none;transition:color var(--calcite-animation-timing) ease-in-out, background-color var(--calcite-animation-timing) ease-in-out, box-shadow var(--calcite-animation-timing) ease-in-out, outline-color var(--calcite-internal-animation-timing-fast) ease-in-out}:host button:hover,:host a:hover{text-decoration-line:none}.content{display:flex;flex-basis:auto;margin-inline:var(--calcite-button-content-margin-internal)}.icon-start-empty .content{margin-inline-start:unset}.icon-end-empty .content{margin-inline-end:unset}:host([scale=m]) button,:host([scale=m]) a{--calcite-button-content-margin-internal:0.75rem}:host([scale=l]) button,:host([scale=l]) a{--calcite-button-content-margin-internal:1rem}:host([width=auto]){inline-size:auto}:host([width=half]){inline-size:50%}:host([width=full]){inline-size:100%}:host([alignment=center]:not([width=auto])) a,:host([alignment=center]:not([width=auto])) button{justify-content:center}:host([alignment=start]:not([width=auto])) a,:host([alignment=start]:not([width=auto])) button{justify-content:flex-start}:host([alignment=end]:not([width=auto])) a,:host([alignment=end]:not([width=auto])) button{justify-content:flex-end}:host([alignment*=space-between]:not([width=auto])) a,:host([alignment*=space-between]:not([width=auto])) button{justify-content:space-between}:host([alignment=icon-start-space-between]:not([width=auto])) .icon--start{margin-inline-end:auto}:host([alignment=icon-start-space-between]:not([width=auto])) a,:host([alignment=icon-start-space-between]:not([width=auto])) button{text-align:unset}:host([alignment=icon-end-space-between]:not([width=auto])) .icon--end{margin-inline-start:auto}:host([alignment=icon-end-space-between]:not([width=auto])) a,:host([alignment=icon-end-space-between]:not([width=auto])) button{text-align:unset}:host([alignment=center]) a:not(.content--slotted) .icon--start+.icon--end,:host([alignment=center]) button:not(.content--slotted) .icon--start+.icon--end{margin-inline-start:var(--calcite-button-content-margin-internal)}.icon{position:relative;margin:0px;display:inline-flex;font-weight:var(--calcite-font-weight-normal);line-height:inherit}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}:host([loading]){pointer-events:none}:host([loading]) button,:host([loading]) a{pointer-events:none;opacity:var(--calcite-ui-opacity-disabled)}@keyframes loader-in{0%{inline-size:0;opacity:0;transform:scale(0.5)}100%{inline-size:1em;opacity:1;transform:scale(1)}}@keyframes loader-out{0%{inline-size:1em;opacity:1;transform:scale(1)}100%{inline-size:0;opacity:0;transform:scale(0.5)}}.calcite-button--loader{display:flex}.calcite-button--loader calcite-loader{margin:0px;transition:inline-size var(--calcite-internal-animation-timing-slow) ease-in-out, opacity var(--calcite-internal-animation-timing-slow) ease-in-out, transform var(--calcite-internal-animation-timing-slow) ease-in-out}.calcite-button--loader calcite-loader.loading-in{animation-name:loader-in;animation-duration:var(--calcite-internal-animation-timing-slow)}.calcite-button--loader calcite-loader.loading-out{animation-name:loader-out;animation-duration:var(--calcite-internal-animation-timing-slow)}:host([loading]) button.content--slotted .calcite-button--loader calcite-loader,:host([loading]) a.content--slotted .calcite-button--loader calcite-loader{margin-inline-end:var(--calcite-button-content-margin-internal)}:host([loading]) button:not(.content--slotted) .icon--start,:host([loading]) button:not(.content--slotted) .icon--end,:host([loading]) a:not(.content--slotted) .icon--start,:host([loading]) a:not(.content--slotted) .icon--end{display:none}:host([appearance]) button,:host([appearance]) a{border-width:1px;border-style:solid;border-color:transparent}:host([kind=brand]) button,:host([kind=brand]) a{background-color:var(--calcite-ui-brand);color:var(--calcite-ui-text-inverse)}:host([kind=brand]) button:hover,:host([kind=brand]) button:focus,:host([kind=brand]) a:hover,:host([kind=brand]) a:focus{background-color:var(--calcite-ui-brand-hover)}:host([kind=brand]) button:active,:host([kind=brand]) a:active{background-color:var(--calcite-ui-brand-press)}:host([kind=brand]) button calcite-loader,:host([kind=brand]) a calcite-loader{color:var(--calcite-ui-text-inverse)}:host([kind=danger]) button,:host([kind=danger]) a{background-color:var(--calcite-ui-danger);color:var(--calcite-ui-text-inverse)}:host([kind=danger]) button:hover,:host([kind=danger]) button:focus,:host([kind=danger]) a:hover,:host([kind=danger]) a:focus{background-color:var(--calcite-ui-danger-hover)}:host([kind=danger]) button:active,:host([kind=danger]) a:active{background-color:var(--calcite-ui-danger-press)}:host([kind=danger]) button calcite-loader,:host([kind=danger]) a calcite-loader{color:var(--calcite-ui-text-inverse)}:host([kind=neutral]) button,:host([kind=neutral]) a{background-color:var(--calcite-ui-foreground-3);color:var(--calcite-ui-text-1)}:host([kind=neutral]) button:hover,:host([kind=neutral]) button:focus,:host([kind=neutral]) a:hover,:host([kind=neutral]) a:focus{background-color:var(--calcite-ui-foreground-2)}:host([kind=neutral]) button:active,:host([kind=neutral]) a:active{background-color:var(--calcite-ui-foreground-1)}:host([kind=neutral]) button calcite-loader,:host([kind=neutral]) a calcite-loader{color:var(--calcite-ui-text-1)}:host([kind=inverse]) button,:host([kind=inverse]) a{color:var(--calcite-ui-text-inverse);background-color:var(--calcite-ui-inverse)}:host([kind=inverse]) button:hover,:host([kind=inverse]) button:focus,:host([kind=inverse]) a:hover,:host([kind=inverse]) a:focus{background-color:var(--calcite-ui-inverse-hover)}:host([kind=inverse]) button:active,:host([kind=inverse]) a:active{background-color:var(--calcite-ui-inverse-press)}:host([kind=inverse]) button calcite-loader,:host([kind=inverse]) a calcite-loader{color:var(--calcite-ui-text-inverse)}:host([appearance=outline-fill]) button,:host([appearance=outline-fill]) a{border-width:1px;border-style:solid;background-color:var(--calcite-ui-foreground-1);box-shadow:inset 0 0 0 1px transparent}:host([appearance=outline-fill][kind=brand]) button,:host([appearance=outline-fill][kind=brand]) a{border-color:var(--calcite-ui-brand);background-color:var(--calcite-ui-foreground-1);color:var(--calcite-ui-brand)}:host([appearance=outline-fill][kind=brand]) button:hover,:host([appearance=outline-fill][kind=brand]) a:hover{border-color:var(--calcite-ui-brand-hover);color:var(--calcite-ui-brand-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-brand-hover)}:host([appearance=outline-fill][kind=brand]) button:focus,:host([appearance=outline-fill][kind=brand]) a:focus{border-color:var(--calcite-ui-brand);color:var(--calcite-ui-brand);box-shadow:inset 0 0 0 2px var(--calcite-ui-brand)}:host([appearance=outline-fill][kind=brand]) button:active,:host([appearance=outline-fill][kind=brand]) a:active{border-color:var(--calcite-ui-brand-press);color:var(--calcite-ui-brand-press);box-shadow:inset 0 0 0 2px var(--calcite-ui-brand-press)}:host([appearance=outline-fill][kind=brand]) button calcite-loader,:host([appearance=outline-fill][kind=brand]) a calcite-loader{color:var(--calcite-ui-brand)}:host([appearance=outline-fill][kind=danger]) button,:host([appearance=outline-fill][kind=danger]) a{border-color:var(--calcite-ui-danger);background-color:var(--calcite-ui-foreground-1);color:var(--calcite-ui-danger)}:host([appearance=outline-fill][kind=danger]) button:hover,:host([appearance=outline-fill][kind=danger]) a:hover{border-color:var(--calcite-ui-danger-hover);color:var(--calcite-ui-danger-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-danger-hover)}:host([appearance=outline-fill][kind=danger]) button:focus,:host([appearance=outline-fill][kind=danger]) a:focus{border-color:var(--calcite-ui-danger);color:var(--calcite-ui-danger);box-shadow:inset 0 0 0 2px var(--calcite-ui-danger)}:host([appearance=outline-fill][kind=danger]) button:active,:host([appearance=outline-fill][kind=danger]) a:active{border-color:var(--calcite-ui-danger-press);color:var(--calcite-ui-danger-press);box-shadow:inset 0 0 0 2px var(--calcite-ui-danger-press)}:host([appearance=outline-fill][kind=danger]) button calcite-loader,:host([appearance=outline-fill][kind=danger]) a calcite-loader{color:var(--calcite-ui-danger)}:host([appearance=outline-fill][kind=neutral]) button,:host([appearance=outline-fill][kind=neutral]) a{background-color:var(--calcite-ui-foreground-1);color:var(--calcite-ui-text-1);border-color:var(--calcite-ui-foreground-3)}:host([appearance=outline-fill][kind=neutral]) button:hover,:host([appearance=outline-fill][kind=neutral]) a:hover{box-shadow:inset 0 0 0 1px var(--calcite-ui-foreground-3)}:host([appearance=outline-fill][kind=neutral]) button:focus,:host([appearance=outline-fill][kind=neutral]) a:focus{box-shadow:inset 0 0 0 2px var(--calcite-ui-foreground-3)}:host([appearance=outline-fill][kind=neutral]) button:active,:host([appearance=outline-fill][kind=neutral]) a:active{box-shadow:inset 0 0 0 2px var(--calcite-ui-foreground-3)}:host([appearance=outline-fill][kind=neutral]) button calcite-loader,:host([appearance=outline-fill][kind=neutral]) a calcite-loader{color:var(--calcite-ui-text-1)}:host([appearance=outline-fill][kind=inverse]) button,:host([appearance=outline-fill][kind=inverse]) a{background-color:var(--calcite-ui-foreground-1);color:var(--calcite-ui-text-1);border-color:var(--calcite-ui-inverse)}:host([appearance=outline-fill][kind=inverse]) button:hover,:host([appearance=outline-fill][kind=inverse]) a:hover{border-color:var(--calcite-ui-inverse-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-inverse-hover)}:host([appearance=outline-fill][kind=inverse]) button:focus,:host([appearance=outline-fill][kind=inverse]) a:focus{border-color:var(--calcite-ui-inverse);box-shadow:inset 0 0 0 2px var(--calcite-ui-inverse)}:host([appearance=outline-fill][kind=inverse]) button:active,:host([appearance=outline-fill][kind=inverse]) a:active{border-color:var(--calcite-ui-inverse-press);box-shadow:inset 0 0 0 2px var(--calcite-ui-inverse-press)}:host([appearance=outline-fill][kind=inverse]) button calcite-loader,:host([appearance=outline-fill][kind=inverse]) a calcite-loader{color:var(--calcite-ui-text-1)}:host([appearance=outline]) button,:host([appearance=outline]) a{border-width:1px;border-style:solid;background-color:transparent;box-shadow:inset 0 0 0 1px transparent}:host([appearance=outline][kind=brand]) button,:host([appearance=outline][kind=brand]) a{border-color:var(--calcite-ui-brand);background-color:transparent;color:var(--calcite-ui-brand)}:host([appearance=outline][kind=brand]) button:hover,:host([appearance=outline][kind=brand]) a:hover{border-color:var(--calcite-ui-brand-hover);color:var(--calcite-ui-brand-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-brand-hover)}:host([appearance=outline][kind=brand]) button:focus,:host([appearance=outline][kind=brand]) a:focus{border-color:var(--calcite-ui-brand);color:var(--calcite-ui-brand);box-shadow:inset 0 0 0 2px var(--calcite-ui-brand)}:host([appearance=outline][kind=brand]) button:active,:host([appearance=outline][kind=brand]) a:active{border-color:var(--calcite-ui-brand-press);color:var(--calcite-ui-brand-press);box-shadow:inset 0 0 0 2px var(--calcite-ui-brand-press)}:host([appearance=outline][kind=brand]) button calcite-loader,:host([appearance=outline][kind=brand]) a calcite-loader{color:var(--calcite-ui-brand)}:host([appearance=outline][kind=danger]) button,:host([appearance=outline][kind=danger]) a{border-color:var(--calcite-ui-danger);background-color:transparent;color:var(--calcite-ui-danger)}:host([appearance=outline][kind=danger]) button:hover,:host([appearance=outline][kind=danger]) a:hover{border-color:var(--calcite-ui-danger-hover);color:var(--calcite-ui-danger-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-danger-hover)}:host([appearance=outline][kind=danger]) button:focus,:host([appearance=outline][kind=danger]) a:focus{border-color:var(--calcite-ui-danger);color:var(--calcite-ui-danger);box-shadow:inset 0 0 0 2px var(--calcite-ui-danger)}:host([appearance=outline][kind=danger]) button:active,:host([appearance=outline][kind=danger]) a:active{border-color:var(--calcite-ui-danger-press);color:var(--calcite-ui-danger-press);box-shadow:inset 0 0 0 2px var(--calcite-ui-danger-press)}:host([appearance=outline][kind=danger]) button calcite-loader,:host([appearance=outline][kind=danger]) a calcite-loader{color:var(--calcite-ui-danger)}:host([appearance=outline][kind=neutral]) button,:host([appearance=outline][kind=neutral]) a{background-color:transparent;color:var(--calcite-ui-text-1);border-color:var(--calcite-ui-border-1)}:host([appearance=outline][kind=neutral]) button:hover,:host([appearance=outline][kind=neutral]) a:hover{box-shadow:inset 0 0 0 1px var(--calcite-ui-foreground-3)}:host([appearance=outline][kind=neutral]) button:focus,:host([appearance=outline][kind=neutral]) a:focus{box-shadow:inset 0 0 0 2px var(--calcite-ui-foreground-3)}:host([appearance=outline][kind=neutral]) button:active,:host([appearance=outline][kind=neutral]) a:active{box-shadow:inset 0 0 0 2px var(--calcite-ui-foreground-3)}:host([appearance=outline][kind=neutral]) button calcite-loader,:host([appearance=outline][kind=neutral]) a calcite-loader{color:var(--calcite-ui-text-1)}:host([appearance=outline][kind=inverse]) button,:host([appearance=outline][kind=inverse]) a{background-color:transparent;color:var(--calcite-ui-text-1);border-color:var(--calcite-ui-inverse)}:host([appearance=outline][kind=inverse]) button:hover,:host([appearance=outline][kind=inverse]) a:hover{border-color:var(--calcite-ui-inverse-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-inverse-hover)}:host([appearance=outline][kind=inverse]) button:focus,:host([appearance=outline][kind=inverse]) a:focus{border-color:var(--calcite-ui-inverse);box-shadow:inset 0 0 0 2px var(--calcite-ui-inverse)}:host([appearance=outline][kind=inverse]) button:active,:host([appearance=outline][kind=inverse]) a:active{border-color:var(--calcite-ui-inverse-press);box-shadow:inset 0 0 0 2px var(--calcite-ui-inverse-press)}:host([appearance=outline][kind=inverse]) button calcite-loader,:host([appearance=outline][kind=inverse]) a calcite-loader{color:var(--calcite-ui-text-1)}:host([appearance=outline-fill][split-child=primary]) button,:host([appearance=outline][split-child=primary]) button{border-inline-end-width:0;border-inline-start-width:1px}:host([appearance=outline-fill][split-child=secondary]) button,:host([appearance=outline][split-child=secondary]) button{border-inline-start-width:0;border-inline-end-width:1px}:host([appearance=transparent]:not(.enable-editing-button)) button,:host([appearance=transparent]:not(.enable-editing-button)) a{background-color:transparent}:host([appearance=transparent]:not(.enable-editing-button)) button:hover,:host([appearance=transparent]:not(.enable-editing-button)) button:focus,:host([appearance=transparent]:not(.enable-editing-button)) a:hover,:host([appearance=transparent]:not(.enable-editing-button)) a:focus{background-color:var(--calcite-button-transparent-hover)}:host([appearance=transparent]:not(.enable-editing-button)) button:active,:host([appearance=transparent]:not(.enable-editing-button)) a:active{background-color:var(--calcite-button-transparent-press)}:host([appearance=transparent][kind=brand]) button,:host([appearance=transparent][kind=brand]) a{color:var(--calcite-ui-brand)}:host([appearance=transparent][kind=brand]) button:hover,:host([appearance=transparent][kind=brand]) a:hover{color:var(--calcite-ui-brand-hover)}:host([appearance=transparent][kind=brand]) button:focus,:host([appearance=transparent][kind=brand]) a:focus{color:var(--calcite-ui-brand)}:host([appearance=transparent][kind=brand]) button:active,:host([appearance=transparent][kind=brand]) a:active{color:var(--calcite-ui-brand-press)}:host([appearance=transparent][kind=brand]) button calcite-loader,:host([appearance=transparent][kind=brand]) a calcite-loader{color:var(--calcite-ui-brand)}:host([appearance=transparent][kind=danger]) button,:host([appearance=transparent][kind=danger]) a{color:var(--calcite-ui-danger)}:host([appearance=transparent][kind=danger]) button:hover,:host([appearance=transparent][kind=danger]) a:hover{color:var(--calcite-ui-danger-hover)}:host([appearance=transparent][kind=danger]) button:focus,:host([appearance=transparent][kind=danger]) a:focus{color:var(--calcite-ui-danger)}:host([appearance=transparent][kind=danger]) button:active,:host([appearance=transparent][kind=danger]) a:active{color:var(--calcite-ui-danger-press)}:host([appearance=transparent][kind=danger]) button calcite-loader,:host([appearance=transparent][kind=danger]) a calcite-loader{color:var(--calcite-ui-danger)}:host([appearance=transparent][kind=neutral]:not(.cancel-editing-button)) button,:host([appearance=transparent][kind=neutral]:not(.cancel-editing-button)) a,:host([appearance=transparent][kind=neutral]:not(.cancel-editing-button)) calcite-loader{color:var(--calcite-ui-text-1)}:host([appearance=transparent][kind=neutral].cancel-editing-button) button{border-block-start-width:1px;border-block-end-width:1px;color:var(--calcite-ui-text-3);border-block-start-color:var(--calcite-ui-border-input);border-block-end-color:var(--calcite-ui-border-input);border-block-style:solid}:host([appearance=transparent][kind=neutral].cancel-editing-button) button:not(.content--slotted){--calcite-button-padding-y-internal:0}:host([appearance=transparent][kind=neutral].cancel-editing-button) button:hover{color:var(--calcite-ui-text-1)}:host([appearance=transparent][kind=neutral].enable-editing-button) button{background-color:transparent}:host(.confirm-changes-button) button:focus,:host(.cancel-editing-button) button:focus,:host(.enable-editing-button) button:focus{outline-offset:-2px}:host([appearance=transparent][kind=inverse]) button,:host([appearance=transparent][kind=inverse]) a,:host([appearance=transparent][kind=inverse]) calcite-loader{color:var(--calcite-ui-text-inverse)}:host([scale=s]) button.content--slotted,:host([scale=s]) a.content--slotted{font-size:var(--calcite-font-size--2);line-height:1rem}:host([scale=s][appearance=transparent]) button.content--slotted,:host([scale=s][appearance=transparent]) a.content--slotted{--calcite-button-padding-x-internal:0.5rem}:host([scale=s]) button,:host([scale=s]) a{--calcite-button-padding-y-internal:3px}:host([scale=m]) button.content--slotted,:host([scale=m]) a.content--slotted{--calcite-button-padding-x-internal:11px;font-size:var(--calcite-font-size--1);line-height:1rem}:host([scale=m]) button,:host([scale=m]) a{--calcite-button-padding-y-internal:7px}:host([scale=m][appearance=transparent]) button.content--slotted,:host([scale=m][appearance=transparent]) a.content--slotted{--calcite-button-padding-x-internal:0.75rem}:host([scale=l]) button.content--slotted,:host([scale=l]) a.content--slotted{--calcite-button-padding-x-internal:15px;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=l]) .button-padding{--calcite-button-padding-x-internal:1rem;--calcite-button-padding-y-internal:11px}:host([scale=l]) .button-padding--shrunk{--calcite-button-padding-y-internal:9px}:host([scale=s]) button:not(.content--slotted),:host([scale=s]) a:not(.content--slotted){--calcite-button-padding-x-internal:0.125rem;--calcite-button-padding-y-internal:3px;inline-size:1.5rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;min-block-size:1.5rem}:host([scale=m]) button:not(.content--slotted),:host([scale=m]) a:not(.content--slotted){--calcite-button-padding-x-internal:0.125rem;--calcite-button-padding-y-internal:7px;inline-size:2rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;min-block-size:2rem}:host([scale=l]) button:not(.content--slotted),:host([scale=l]) a:not(.content--slotted){--calcite-button-padding-x-internal:0.125rem;--calcite-button-padding-y-internal:9px;inline-size:2.75rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;min-block-size:2.75rem}:host([scale=l][appearance=transparent]) button:not(.content--slotted),:host([scale=l][appearance=transparent]) a:not(.content--slotted){--calcite-button-padding-y-internal:0.625rem}:host([scale=s][icon-start][icon-end]) button:not(.content--slotted),:host([scale=s][icon-start][icon-end]) a:not(.content--slotted){--calcite-button-padding-x-internal:23px;block-size:1.5rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=s][icon-start][icon-end][appearance=transparent]) button:not(.content--slotted),:host([scale=s][icon-start][icon-end][appearance=transparent]) a:not(.content--slotted){--calcite-button-padding-x-internal:1.5rem}:host([scale=m][icon-start][icon-end]) button:not(.content--slotted),:host([scale=m][icon-start][icon-end]) a:not(.content--slotted){--calcite-button-padding-x-internal:2rem;block-size:2rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=m][icon-start][icon-end][appearance=transparent]) button:not(.content--slotted),:host([scale=m][icon-start][icon-end][appearance=transparent]) a:not(.content--slotted){--calcite-button-padding-x-internal:33px}:host([scale=l][icon-start][icon-end]) button:not(.content--slotted),:host([scale=l][icon-start][icon-end]) a:not(.content--slotted){--calcite-button-padding-x-internal:43px;block-size:2.75rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=l][icon-start][icon-end]) button:not(.content--slotted) .icon--start+.icon--end,:host([scale=l][icon-start][icon-end]) a:not(.content--slotted) .icon--start+.icon--end{margin-inline-start:1rem}:host([scale=l][icon-start][icon-end][appearance=transparent]) button:not(.content--slotted),:host([scale=l][icon-start][icon-end][appearance=transparent]) a:not(.content--slotted){--calcite-button-padding-x-internal:2.75rem}",Egt=vse(class extends bse{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.mutationObserver=nae("mutation",()=>this.updateHasContent()),this.handleClick=()=>{const{type:t}=this;this.href||(t==="submit"?Imt(this):t==="reset"&&$mt(this))},this.alignment="center",this.appearance="solid",this.label=void 0,this.kind="brand",this.disabled=!1,this.href=void 0,this.iconEnd=void 0,this.iconFlipRtl=void 0,this.iconStart=void 0,this.loading=!1,this.name=void 0,this.rel=void 0,this.round=!1,this.scale="m",this.splitChild=!1,this.target=void 0,this.type="button",this.width="auto",this.messages=void 0,this.messageOverrides=void 0,this.hasContent=!1,this.hasLoader=!1,this.effectiveLocale="",this.defaultMessages=void 0}loadingChanged(t,e){t&&!e&&(this.hasLoader=!0),!t&&e&&window.setTimeout(()=>{this.hasLoader=!1},300)}onMessagesChange(){}async connectedCallback(){ogt(this),fgt(this),this.hasLoader=this.loading,this.setupTextContentObserver(),rLe(this),this.formEl=v3(this.el,"form")}disconnectedCallback(){var t;(t=this.mutationObserver)==null||t.disconnect(),zmt(this),lgt(this),mgt(this),this.formEl=null}async componentWillLoad(){Hmt(this),this.updateHasContent(),await dgt(this)}componentDidLoad(){qmt(this)}componentDidRender(){Fmt(this)}render(){const t=this.href?"a":"button",e=t,r=this.hasLoader?_s("div",{class:sh.buttonLoader},_s("calcite-loader",{class:this.loading?sh.loadingIn:sh.loadingOut,inline:!0,label:this.messages.loading,scale:this.scale==="l"?"m":"s"})):null,i=!this.iconStart&&!this.iconEnd,n=_s("calcite-icon",{class:{[sh.icon]:!0,[sh.iconStart]:!0},flipRtl:this.iconFlipRtl==="start"||this.iconFlipRtl==="both",icon:this.iconStart,scale:this.scale==="l"?"m":"s"}),s=_s("calcite-icon",{class:{[sh.icon]:!0,[sh.iconEnd]:!0},flipRtl:this.iconFlipRtl==="end"||this.iconFlipRtl==="both",icon:this.iconEnd,scale:this.scale==="l"?"m":"s"}),o=_s("span",{class:sh.content},_s("slot",null));return _s(e,{"aria-label":Vmt(this),class:{[sh.buttonPadding]:i,[sh.buttonPaddingShrunk]:!i,[sh.contentSlotted]:this.hasContent,[sh.iconStartEmpty]:!this.iconStart,[sh.iconEndEmpty]:!this.iconEnd},disabled:this.disabled||this.loading,href:t==="a"&&this.href,name:t==="button"&&this.name,onClick:this.handleClick,ref:a=>this.childEl=a,rel:t==="a"&&this.rel,tabIndex:this.disabled||this.loading?-1:null,target:t==="a"&&this.target,type:t==="button"&&this.type},r,this.iconStart?n:null,this.hasContent?o:null,this.iconEnd?s:null)}async setFocus(){var t;await Wmt(this),(t=this.childEl)==null||t.focus()}effectiveLocaleChange(){pgt(this,this.effectiveLocale)}updateHasContent(){var e,r;const t=this.el.textContent.trim().length>0||this.el.childNodes.length>0;this.hasContent=this.el.childNodes.length===1&&((e=this.el.childNodes[0])==null?void 0:e.nodeName)==="#text"?((r=this.el.textContent)==null?void 0:r.trim().length)>0:t}setupTextContentObserver(){var t;(t=this.mutationObserver)==null||t.observe(this.el,{childList:!0,subtree:!0})}onLabelClick(){this.handleClick(),this.setFocus()}static get assetsDirs(){return["assets"]}get el(){return this}static get watchers(){return{loading:["loadingChanged"],messageOverrides:["onMessagesChange"],effectiveLocale:["effectiveLocaleChange"]}}static get style(){return Sgt}},[1,"calcite-button",{alignment:[513],appearance:[513],label:[1],kind:[513],disabled:[516],href:[513],iconEnd:[513,"icon-end"],iconFlipRtl:[513,"icon-flip-rtl"],iconStart:[513,"icon-start"],loading:[516],name:[513],rel:[513],round:[516],scale:[513],splitChild:[520,"split-child"],target:[513],type:[1537],width:[513],messages:[1040],messageOverrides:[1040],hasContent:[32],hasLoader:[32],effectiveLocale:[32],defaultMessages:[32],setFocus:[64]}]);function Cgt(){if(typeof customElements>"u")return;["calcite-button","calcite-icon","calcite-loader"].forEach(e=>{switch(e){case"calcite-button":customElements.get(e)||customElements.define(e,Egt);break;case"calcite-icon":customElements.get(e)||hLe();break;case"calcite-loader":customElements.get(e)||dLe();break}})}Cgt();const Agt=t=>t.toLowerCase().split("-").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(""),pLe=t=>t.replace(/([A-Z])/g,e=>`-${e[0].toLowerCase()}`),Rgt=(t,e,r={})=>{if(t instanceof Element){const i=Ogt(t.classList,e,r);i!==""&&(t.className=i),Object.keys(e).forEach(n=>{if(!(n==="children"||n==="style"||n==="ref"||n==="class"||n==="className"||n==="forwardedRef"))if(n.indexOf("on")===0&&n[2]===n[2].toUpperCase()){const s=n.substring(2),o=s[0].toLowerCase()+s.substring(1);fLe(o)||Mgt(t,o,e[n])}else t[n]=e[n],typeof e[n]==="string"&&t.setAttribute(pLe(n),e[n])})}},Ogt=(t,e,r)=>{const i=e.className||e.class,n=r.className||r.class,s=EH(t),o=EH(i?i.split(" "):[]),a=EH(n?n.split(" "):[]),l=[];return s.forEach(c=>{o.has(c)?(l.push(c),o.delete(c)):a.has(c)||l.push(c)}),o.forEach(c=>l.push(c)),l.join(" ")};/**
 * Checks if an event is supported in the current execution environment.
 * @license Modernizr 3.0.0pre (Custom Build) | MIT
 */const fLe=t=>{if(typeof document>"u")return!0;{const e="on"+t;let r=e in document;if(!r){const i=document.createElement("div");i.setAttribute(e,"return;"),r=typeof i[e]=="function"}return r}},Mgt=(t,e,r)=>{const i=t.__events||(t.__events={}),n=i[e];n&&t.removeEventListener(e,n),t.addEventListener(e,i[e]=function(o){r&&r.call(this,o)})},EH=t=>{const e=new Map;return t.forEach(r=>e.set(r,r)),e},Pgt=(t,e)=>{typeof t=="function"?t(e):t!=null&&(t.current=e)},Igt=(...t)=>e=>{t.forEach(r=>{Pgt(r,e)})},$gt=(t,e)=>{const r=(i,n)=>hL.createElement(t,Object.assign({},i,{forwardedRef:n}));return r.displayName=e,hL.forwardRef(r)};var Lgt=globalThis&&globalThis.__rest||function(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]]);return r};const Dgt=(t,e,r,i)=>{i!==void 0&&i();const n=Agt(t),s=class extends hL.Component{constructor(o){super(o),this.setComponentElRef=a=>{this.componentEl=a}}componentDidMount(){this.componentDidUpdate(this.props)}componentDidUpdate(o){Rgt(this.componentEl,this.props,o)}render(){const o=this.props,{children:a,forwardedRef:l,style:c,className:h,ref:p}=o,f=Lgt(o,["children","forwardedRef","style","className","ref"]);let m=Object.keys(f).reduce((_,b)=>{const w=f[b];if(b.indexOf("on")===0&&b[2]===b[2].toUpperCase()){const x=b.substring(2).toLowerCase();typeof document<"u"&&fLe(x)&&(_[b]=w)}else{const x=typeof w;(x==="string"||x==="boolean"||x==="number")&&(_[pLe(b)]=w)}return _},{});r&&(m=r(this.props,m));const g=Object.assign(Object.assign({},m),{ref:Igt(l,this.setComponentElRef),style:c});return ut.createElement(t,g,a)}static get displayName(){return n}};return e&&(s.contextType=e),$gt(s,n)},mLe=Dgt("calcite-button");var IQ={},Ngt={get exports(){return IQ},set exports(t){IQ=t}};(function(t){var e=typeof window<"u"?window:typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?self:{};/**
 * Prism: Lightweight, robust, elegant syntax highlighting
 *
 * @license MIT <https://opensource.org/licenses/MIT>
 * @author Lea Verou <https://lea.verou.me>
 * @namespace
 * @public
 */var r=function(i){var n=/(?:^|\s)lang(?:uage)?-([\w-]+)(?=\s|$)/i,s=0,o={},a={manual:i.Prism&&i.Prism.manual,disableWorkerMessageHandler:i.Prism&&i.Prism.disableWorkerMessageHandler,util:{encode:function x(T){return T instanceof l?new l(T.type,x(T.content),T.alias):Array.isArray(T)?T.map(x):T.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},type:function(x){return Object.prototype.toString.call(x).slice(8,-1)},objId:function(x){return x.__id||Object.defineProperty(x,"__id",{value:++s}),x.__id},clone:function x(T,E){E=E||{};var C,A;switch(a.util.type(T)){case"Object":if(A=a.util.objId(T),E[A])return E[A];C={},E[A]=C;for(var I in T)T.hasOwnProperty(I)&&(C[I]=x(T[I],E));return C;case"Array":return A=a.util.objId(T),E[A]?E[A]:(C=[],E[A]=C,T.forEach(function(M,D){C[D]=x(M,E)}),C);default:return T}},getLanguage:function(x){for(;x;){var T=n.exec(x.className);if(T)return T[1].toLowerCase();x=x.parentElement}return"none"},setLanguage:function(x,T){x.className=x.className.replace(RegExp(n,"gi"),""),x.classList.add("language-"+T)},currentScript:function(){if(typeof document>"u")return null;if("currentScript"in document&&1<2)return document.currentScript;try{throw new Error}catch(C){var x=(/at [^(\r\n]*\((.*):[^:]+:[^:]+\)$/i.exec(C.stack)||[])[1];if(x){var T=document.getElementsByTagName("script");for(var E in T)if(T[E].src==x)return T[E]}return null}},isActive:function(x,T,E){for(var C="no-"+T;x;){var A=x.classList;if(A.contains(T))return!0;if(A.contains(C))return!1;x=x.parentElement}return!!E}},languages:{plain:o,plaintext:o,text:o,txt:o,extend:function(x,T){var E=a.util.clone(a.languages[x]);for(var C in T)E[C]=T[C];return E},insertBefore:function(x,T,E,C){C=C||a.languages;var A=C[x],I={};for(var M in A)if(A.hasOwnProperty(M)){if(M==T)for(var D in E)E.hasOwnProperty(D)&&(I[D]=E[D]);E.hasOwnProperty(M)||(I[M]=A[M])}var U=C[x];return C[x]=I,a.languages.DFS(a.languages,function(z,B){B===U&&z!=x&&(this[z]=I)}),I},DFS:function x(T,E,C,A){A=A||{};var I=a.util.objId;for(var M in T)if(T.hasOwnProperty(M)){E.call(T,M,T[M],C||M);var D=T[M],U=a.util.type(D);U==="Object"&&!A[I(D)]?(A[I(D)]=!0,x(D,E,null,A)):U==="Array"&&!A[I(D)]&&(A[I(D)]=!0,x(D,E,M,A))}}},plugins:{},highlightAll:function(x,T){a.highlightAllUnder(document,x,T)},highlightAllUnder:function(x,T,E){var C={callback:E,container:x,selector:'code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code'};a.hooks.run("before-highlightall",C),C.elements=Array.prototype.slice.apply(C.container.querySelectorAll(C.selector)),a.hooks.run("before-all-elements-highlight",C);for(var A=0,I;I=C.elements[A++];)a.highlightElement(I,T===!0,C.callback)},highlightElement:function(x,T,E){var C=a.util.getLanguage(x),A=a.languages[C];a.util.setLanguage(x,C);var I=x.parentElement;I&&I.nodeName.toLowerCase()==="pre"&&a.util.setLanguage(I,C);var M=x.textContent,D={element:x,language:C,grammar:A,code:M};function U(B){D.highlightedCode=B,a.hooks.run("before-insert",D),D.element.innerHTML=D.highlightedCode,a.hooks.run("after-highlight",D),a.hooks.run("complete",D),E&&E.call(D.element)}if(a.hooks.run("before-sanity-check",D),I=D.element.parentElement,I&&I.nodeName.toLowerCase()==="pre"&&!I.hasAttribute("tabindex")&&I.setAttribute("tabindex","0"),!D.code){a.hooks.run("complete",D),E&&E.call(D.element);return}if(a.hooks.run("before-highlight",D),!D.grammar){U(a.util.encode(D.code));return}if(T&&i.Worker){var z=new Worker(a.filename);z.onmessage=function(B){U(B.data)},z.postMessage(JSON.stringify({language:D.language,code:D.code,immediateClose:!0}))}else U(a.highlight(D.code,D.grammar,D.language))},highlight:function(x,T,E){var C={code:x,grammar:T,language:E};if(a.hooks.run("before-tokenize",C),!C.grammar)throw new Error('The language "'+C.language+'" has no grammar.');return C.tokens=a.tokenize(C.code,C.grammar),a.hooks.run("after-tokenize",C),l.stringify(a.util.encode(C.tokens),C.language)},tokenize:function(x,T){var E=T.rest;if(E){for(var C in E)T[C]=E[C];delete T.rest}var A=new p;return f(A,A.head,x),h(x,A,T,A.head,0),g(A)},hooks:{all:{},add:function(x,T){var E=a.hooks.all;E[x]=E[x]||[],E[x].push(T)},run:function(x,T){var E=a.hooks.all[x];if(!(!E||!E.length))for(var C=0,A;A=E[C++];)A(T)}},Token:l};i.Prism=a;function l(x,T,E,C){this.type=x,this.content=T,this.alias=E,this.length=(C||"").length|0}l.stringify=function x(T,E){if(typeof T=="string")return T;if(Array.isArray(T)){var C="";return T.forEach(function(U){C+=x(U,E)}),C}var A={type:T.type,content:x(T.content,E),tag:"span",classes:["token",T.type],attributes:{},language:E},I=T.alias;I&&(Array.isArray(I)?Array.prototype.push.apply(A.classes,I):A.classes.push(I)),a.hooks.run("wrap",A);var M="";for(var D in A.attributes)M+=" "+D+'="'+(A.attributes[D]||"").replace(/"/g,"&quot;")+'"';return"<"+A.tag+' class="'+A.classes.join(" ")+'"'+M+">"+A.content+"</"+A.tag+">"};function c(x,T,E,C){x.lastIndex=T;var A=x.exec(E);if(A&&C&&A[1]){var I=A[1].length;A.index+=I,A[0]=A[0].slice(I)}return A}function h(x,T,E,C,A,I){for(var M in E)if(!(!E.hasOwnProperty(M)||!E[M])){var D=E[M];D=Array.isArray(D)?D:[D];for(var U=0;U<D.length;++U){if(I&&I.cause==M+","+U)return;var z=D[U],B=z.inside,ee=!!z.lookbehind,te=!!z.greedy,K=z.alias;if(te&&!z.pattern.global){var W=z.pattern.toString().match(/[imsuy]*$/)[0];z.pattern=RegExp(z.pattern.source,W+"g")}for(var N=z.pattern||z,L=C.next,F=A;L!==T.tail&&!(I&&F>=I.reach);F+=L.value.length,L=L.next){var G=L.value;if(T.length>x.length)return;if(!(G instanceof l)){var q=1,Z;if(te){if(Z=c(N,F,x,ee),!Z||Z.index>=x.length)break;var ye=Z.index,X=Z.index+Z[0].length,oe=F;for(oe+=L.value.length;ye>=oe;)L=L.next,oe+=L.value.length;if(oe-=L.value.length,F=oe,L.value instanceof l)continue;for(var pe=L;pe!==T.tail&&(oe<X||typeof pe.value=="string");pe=pe.next)q++,oe+=pe.value.length;q--,G=x.slice(F,oe),Z.index-=F}else if(Z=c(N,0,G,ee),!Z)continue;var ye=Z.index,Se=Z[0],He=G.slice(0,ye),Le=G.slice(ye+Se.length),Te=F+G.length;I&&Te>I.reach&&(I.reach=Te);var Fe=L.prev;He&&(Fe=f(T,Fe,He),F+=He.length),m(T,Fe,q);var Ve=new l(M,B?a.tokenize(Se,B):Se,K,Se);if(L=f(T,Fe,Ve),Le&&f(T,L,Le),q>1){var bt={cause:M+","+U,reach:Te};h(x,T,E,L.prev,F,bt),I&&bt.reach>I.reach&&(I.reach=bt.reach)}}}}}}function p(){var x={value:null,prev:null,next:null},T={value:null,prev:x,next:null};x.next=T,this.head=x,this.tail=T,this.length=0}function f(x,T,E){var C=T.next,A={value:E,prev:T,next:C};return T.next=A,C.prev=A,x.length++,A}function m(x,T,E){for(var C=T.next,A=0;A<E&&C!==x.tail;A++)C=C.next;T.next=C,C.prev=T,x.length-=A}function g(x){for(var T=[],E=x.head.next;E!==x.tail;)T.push(E.value),E=E.next;return T}if(!i.document)return i.addEventListener&&(a.disableWorkerMessageHandler||i.addEventListener("message",function(x){var T=JSON.parse(x.data),E=T.language,C=T.code,A=T.immediateClose;i.postMessage(a.highlight(C,a.languages[E],E)),A&&i.close()},!1)),a;var _=a.util.currentScript();_&&(a.filename=_.src,_.hasAttribute("data-manual")&&(a.manual=!0));function b(){a.manual||a.highlightAll()}if(!a.manual){var w=document.readyState;w==="loading"||w==="interactive"&&_&&_.defer?document.addEventListener("DOMContentLoaded",b):window.requestAnimationFrame?window.requestAnimationFrame(b):window.setTimeout(b,16)}return a}(e);t.exports&&(t.exports=r),typeof Bce<"u"&&(Bce.Prism=r),r.languages.markup={comment:{pattern:/<!--(?:(?!<!--)[\s\S])*?-->/,greedy:!0},prolog:{pattern:/<\?[\s\S]+?\?>/,greedy:!0},doctype:{pattern:/<!DOCTYPE(?:[^>"'[\]]|"[^"]*"|'[^']*')+(?:\[(?:[^<"'\]]|"[^"]*"|'[^']*'|<(?!!--)|<!--(?:[^-]|-(?!->))*-->)*\]\s*)?>/i,greedy:!0,inside:{"internal-subset":{pattern:/(^[^\[]*\[)[\s\S]+(?=\]>$)/,lookbehind:!0,greedy:!0,inside:null},string:{pattern:/"[^"]*"|'[^']*'/,greedy:!0},punctuation:/^<!|>$|[[\]]/,"doctype-tag":/^DOCTYPE/i,name:/[^\s<>'"]+/}},cdata:{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,greedy:!0},tag:{pattern:/<\/?(?!\d)[^\s>\/=$<%]+(?:\s(?:\s*[^\s>\/=]+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))|(?=[\s/>])))+)?\s*\/?>/,greedy:!0,inside:{tag:{pattern:/^<\/?[^\s>\/]+/,inside:{punctuation:/^<\/?/,namespace:/^[^\s>\/:]+:/}},"special-attr":[],"attr-value":{pattern:/=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+)/,inside:{punctuation:[{pattern:/^=/,alias:"attr-equals"},{pattern:/^(\s*)["']|["']$/,lookbehind:!0}]}},punctuation:/\/?>/,"attr-name":{pattern:/[^\s>\/]+/,inside:{namespace:/^[^\s>\/:]+:/}}}},entity:[{pattern:/&[\da-z]{1,8};/i,alias:"named-entity"},/&#x?[\da-f]{1,8};/i]},r.languages.markup.tag.inside["attr-value"].inside.entity=r.languages.markup.entity,r.languages.markup.doctype.inside["internal-subset"].inside=r.languages.markup,r.hooks.add("wrap",function(i){i.type==="entity"&&(i.attributes.title=i.content.replace(/&amp;/,"&"))}),Object.defineProperty(r.languages.markup.tag,"addInlined",{value:function(n,s){var o={};o["language-"+s]={pattern:/(^<!\[CDATA\[)[\s\S]+?(?=\]\]>$)/i,lookbehind:!0,inside:r.languages[s]},o.cdata=/^<!\[CDATA\[|\]\]>$/i;var a={"included-cdata":{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,inside:o}};a["language-"+s]={pattern:/[\s\S]+/,inside:r.languages[s]};var l={};l[n]={pattern:RegExp(/(<__[^>]*>)(?:<!\[CDATA\[(?:[^\]]|\](?!\]>))*\]\]>|(?!<!\[CDATA\[)[\s\S])*?(?=<\/__>)/.source.replace(/__/g,function(){return n}),"i"),lookbehind:!0,greedy:!0,inside:a},r.languages.insertBefore("markup","cdata",l)}}),Object.defineProperty(r.languages.markup.tag,"addAttribute",{value:function(i,n){r.languages.markup.tag.inside["special-attr"].push({pattern:RegExp(/(^|["'\s])/.source+"(?:"+i+")"+/\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))/.source,"i"),lookbehind:!0,inside:{"attr-name":/^[^\s=]+/,"attr-value":{pattern:/=[\s\S]+/,inside:{value:{pattern:/(^=\s*(["']|(?!["'])))\S[\s\S]*(?=\2$)/,lookbehind:!0,alias:[n,"language-"+n],inside:r.languages[n]},punctuation:[{pattern:/^=/,alias:"attr-equals"},/"|'/]}}}})}}),r.languages.html=r.languages.markup,r.languages.mathml=r.languages.markup,r.languages.svg=r.languages.markup,r.languages.xml=r.languages.extend("markup",{}),r.languages.ssml=r.languages.xml,r.languages.atom=r.languages.xml,r.languages.rss=r.languages.xml,function(i){var n=/(?:"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"|'(?:\\(?:\r\n|[\s\S])|[^'\\\r\n])*')/;i.languages.css={comment:/\/\*[\s\S]*?\*\//,atrule:{pattern:RegExp("@[\\w-](?:"+/[^;{\s"']|\s+(?!\s)/.source+"|"+n.source+")*?"+/(?:;|(?=\s*\{))/.source),inside:{rule:/^@[\w-]+/,"selector-function-argument":{pattern:/(\bselector\s*\(\s*(?![\s)]))(?:[^()\s]|\s+(?![\s)])|\((?:[^()]|\([^()]*\))*\))+(?=\s*\))/,lookbehind:!0,alias:"selector"},keyword:{pattern:/(^|[^\w-])(?:and|not|only|or)(?![\w-])/,lookbehind:!0}}},url:{pattern:RegExp("\\burl\\((?:"+n.source+"|"+/(?:[^\\\r\n()"']|\\[\s\S])*/.source+")\\)","i"),greedy:!0,inside:{function:/^url/i,punctuation:/^\(|\)$/,string:{pattern:RegExp("^"+n.source+"$"),alias:"url"}}},selector:{pattern:RegExp(`(^|[{}\\s])[^{}\\s](?:[^{};"'\\s]|\\s+(?![\\s{])|`+n.source+")*(?=\\s*\\{)"),lookbehind:!0},string:{pattern:n,greedy:!0},property:{pattern:/(^|[^-\w\xA0-\uFFFF])(?!\s)[-_a-z\xA0-\uFFFF](?:(?!\s)[-\w\xA0-\uFFFF])*(?=\s*:)/i,lookbehind:!0},important:/!important\b/i,function:{pattern:/(^|[^-a-z0-9])[-a-z0-9]+(?=\()/i,lookbehind:!0},punctuation:/[(){};:,]/},i.languages.css.atrule.inside.rest=i.languages.css;var s=i.languages.markup;s&&(s.tag.addInlined("style","css"),s.tag.addAttribute("style","css"))}(r),r.languages.clike={comment:[{pattern:/(^|[^\\])\/\*[\s\S]*?(?:\*\/|$)/,lookbehind:!0,greedy:!0},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0,greedy:!0}],string:{pattern:/(["'])(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0},"class-name":{pattern:/(\b(?:class|extends|implements|instanceof|interface|new|trait)\s+|\bcatch\s+\()[\w.\\]+/i,lookbehind:!0,inside:{punctuation:/[.\\]/}},keyword:/\b(?:break|catch|continue|do|else|finally|for|function|if|in|instanceof|new|null|return|throw|try|while)\b/,boolean:/\b(?:false|true)\b/,function:/\b\w+(?=\()/,number:/\b0x[\da-f]+\b|(?:\b\d+(?:\.\d*)?|\B\.\d+)(?:e[+-]?\d+)?/i,operator:/[<>]=?|[!=]=?=?|--?|\+\+?|&&?|\|\|?|[?*/~^%]/,punctuation:/[{}[\];(),.:]/},r.languages.javascript=r.languages.extend("clike",{"class-name":[r.languages.clike["class-name"],{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$A-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\.(?:constructor|prototype))/,lookbehind:!0}],keyword:[{pattern:/((?:^|\})\s*)catch\b/,lookbehind:!0},{pattern:/(^|[^.]|\.\.\.\s*)\b(?:as|assert(?=\s*\{)|async(?=\s*(?:function\b|\(|[$\w\xA0-\uFFFF]|$))|await|break|case|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally(?=\s*(?:\{|$))|for|from(?=\s*(?:['"]|$))|function|(?:get|set)(?=\s*(?:[#\[$\w\xA0-\uFFFF]|$))|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)\b/,lookbehind:!0}],function:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*(?:\.\s*(?:apply|bind|call)\s*)?\()/,number:{pattern:RegExp(/(^|[^\w$])/.source+"(?:"+(/NaN|Infinity/.source+"|"+/0[bB][01]+(?:_[01]+)*n?/.source+"|"+/0[oO][0-7]+(?:_[0-7]+)*n?/.source+"|"+/0[xX][\dA-Fa-f]+(?:_[\dA-Fa-f]+)*n?/.source+"|"+/\d+(?:_\d+)*n/.source+"|"+/(?:\d+(?:_\d+)*(?:\.(?:\d+(?:_\d+)*)?)?|\.\d+(?:_\d+)*)(?:[Ee][+-]?\d+(?:_\d+)*)?/.source)+")"+/(?![\w$])/.source),lookbehind:!0},operator:/--|\+\+|\*\*=?|=>|&&=?|\|\|=?|[!=]==|<<=?|>>>?=?|[-+*/%&|^!=<>]=?|\.{3}|\?\?=?|\?\.?|[~:]/}),r.languages.javascript["class-name"][0].pattern=/(\b(?:class|extends|implements|instanceof|interface|new)\s+)[\w.\\]+/,r.languages.insertBefore("javascript","keyword",{regex:{pattern:RegExp(/((?:^|[^$\w\xA0-\uFFFF."'\])\s]|\b(?:return|yield))\s*)/.source+/\//.source+"(?:"+/(?:\[(?:[^\]\\\r\n]|\\.)*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}/.source+"|"+/(?:\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.)*\])*\])*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}v[dgimyus]{0,7}/.source+")"+/(?=(?:\s|\/\*(?:[^*]|\*(?!\/))*\*\/)*(?:$|[\r\n,.;:})\]]|\/\/))/.source),lookbehind:!0,greedy:!0,inside:{"regex-source":{pattern:/^(\/)[\s\S]+(?=\/[a-z]*$)/,lookbehind:!0,alias:"language-regex",inside:r.languages.regex},"regex-delimiter":/^\/|\/$/,"regex-flags":/^[a-z]+$/}},"function-variable":{pattern:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*[=:]\s*(?:async\s*)?(?:\bfunction\b|(?:\((?:[^()]|\([^()]*\))*\)|(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)\s*=>))/,alias:"function"},parameter:[{pattern:/(function(?:\s+(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)?\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\))/,lookbehind:!0,inside:r.languages.javascript},{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$a-z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*=>)/i,lookbehind:!0,inside:r.languages.javascript},{pattern:/(\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*=>)/,lookbehind:!0,inside:r.languages.javascript},{pattern:/((?:\b|\s|^)(?!(?:as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)(?![$\w\xA0-\uFFFF]))(?:(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*\s*)\(\s*|\]\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*\{)/,lookbehind:!0,inside:r.languages.javascript}],constant:/\b[A-Z](?:[A-Z_]|\dx?)*\b/}),r.languages.insertBefore("javascript","string",{hashbang:{pattern:/^#!.*/,greedy:!0,alias:"comment"},"template-string":{pattern:/`(?:\\[\s\S]|\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}|(?!\$\{)[^\\`])*`/,greedy:!0,inside:{"template-punctuation":{pattern:/^`|`$/,alias:"string"},interpolation:{pattern:/((?:^|[^\\])(?:\\{2})*)\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}/,lookbehind:!0,inside:{"interpolation-punctuation":{pattern:/^\$\{|\}$/,alias:"punctuation"},rest:r.languages.javascript}},string:/[\s\S]+/}},"string-property":{pattern:/((?:^|[,{])[ \t]*)(["'])(?:\\(?:\r\n|[\s\S])|(?!\2)[^\\\r\n])*\2(?=\s*:)/m,lookbehind:!0,greedy:!0,alias:"property"}}),r.languages.insertBefore("javascript","operator",{"literal-property":{pattern:/((?:^|[,{])[ \t]*)(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*:)/m,lookbehind:!0,alias:"property"}}),r.languages.markup&&(r.languages.markup.tag.addInlined("script","javascript"),r.languages.markup.tag.addAttribute(/on(?:abort|blur|change|click|composition(?:end|start|update)|dblclick|error|focus(?:in|out)?|key(?:down|up)|load|mouse(?:down|enter|leave|move|out|over|up)|reset|resize|scroll|select|slotchange|submit|unload|wheel)/.source,"javascript")),r.languages.js=r.languages.javascript,function(){if(typeof r>"u"||typeof document>"u")return;Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);var i="Loading…",n=function(_,b){return"✖ Error "+_+" while fetching file: "+b},s="✖ Error: File does not exist or is empty",o={js:"javascript",py:"python",rb:"ruby",ps1:"powershell",psm1:"powershell",sh:"bash",bat:"batch",h:"c",tex:"latex"},a="data-src-status",l="loading",c="loaded",h="failed",p="pre[data-src]:not(["+a+'="'+c+'"]):not(['+a+'="'+l+'"])';function f(_,b,w){var x=new XMLHttpRequest;x.open("GET",_,!0),x.onreadystatechange=function(){x.readyState==4&&(x.status<400&&x.responseText?b(x.responseText):x.status>=400?w(n(x.status,x.statusText)):w(s))},x.send(null)}function m(_){var b=/^\s*(\d+)\s*(?:(,)\s*(?:(\d+)\s*)?)?$/.exec(_||"");if(b){var w=Number(b[1]),x=b[2],T=b[3];return x?T?[w,Number(T)]:[w,void 0]:[w,w]}}r.hooks.add("before-highlightall",function(_){_.selector+=", "+p}),r.hooks.add("before-sanity-check",function(_){var b=_.element;if(b.matches(p)){_.code="",b.setAttribute(a,l);var w=b.appendChild(document.createElement("CODE"));w.textContent=i;var x=b.getAttribute("data-src"),T=_.language;if(T==="none"){var E=(/\.(\w+)$/.exec(x)||[,"none"])[1];T=o[E]||E}r.util.setLanguage(w,T),r.util.setLanguage(b,T);var C=r.plugins.autoloader;C&&C.loadLanguages(T),f(x,function(A){b.setAttribute(a,c);var I=m(b.getAttribute("data-range"));if(I){var M=A.split(/\r\n?|\n/g),D=I[0],U=I[1]==null?M.length:I[1];D<0&&(D+=M.length),D=Math.max(0,Math.min(D-1,M.length)),U<0&&(U+=M.length),U=Math.max(0,Math.min(U,M.length)),A=M.slice(D,U).join(`
`),b.hasAttribute("data-start")||b.setAttribute("data-start",String(D+1))}w.textContent=A,r.highlightElement(w)},function(A){b.setAttribute(a,h),w.textContent=A})}}),r.plugins.fileHighlight={highlight:function(b){for(var w=(b||document).querySelectorAll(p),x=0,T;T=w[x++];)r.highlightElement(T)}};var g=!1;r.fileHighlight=function(){g||(console.warn("Prism.fileHighlight is deprecated. Use `Prism.plugins.fileHighlight.highlight` instead."),g=!0),r.plugins.fileHighlight.highlight.apply(this,arguments)}}()})(Ngt);const gLe=IQ;(function(){if(typeof Prism>"u"||typeof document>"u")return;var t="line-numbers",e=/\n(?!$)/g,r=Prism.plugins.lineNumbers={getLine:function(o,a){if(!(o.tagName!=="PRE"||!o.classList.contains(t))){var l=o.querySelector(".line-numbers-rows");if(l){var c=parseInt(o.getAttribute("data-start"),10)||1,h=c+(l.children.length-1);a<c&&(a=c),a>h&&(a=h);var p=a-c;return l.children[p]}}},resize:function(o){i([o])},assumeViewportIndependence:!0};function i(o){if(o=o.filter(function(l){var c=n(l),h=c["white-space"];return h==="pre-wrap"||h==="pre-line"}),o.length!=0){var a=o.map(function(l){var c=l.querySelector("code"),h=l.querySelector(".line-numbers-rows");if(!(!c||!h)){var p=l.querySelector(".line-numbers-sizer"),f=c.textContent.split(e);p||(p=document.createElement("span"),p.className="line-numbers-sizer",c.appendChild(p)),p.innerHTML="0",p.style.display="block";var m=p.getBoundingClientRect().height;return p.innerHTML="",{element:l,lines:f,lineHeights:[],oneLinerHeight:m,sizer:p}}}).filter(Boolean);a.forEach(function(l){var c=l.sizer,h=l.lines,p=l.lineHeights,f=l.oneLinerHeight;p[h.length-1]=void 0,h.forEach(function(m,g){if(m&&m.length>1){var _=c.appendChild(document.createElement("span"));_.style.display="block",_.textContent=m}else p[g]=f})}),a.forEach(function(l){for(var c=l.sizer,h=l.lineHeights,p=0,f=0;f<h.length;f++)h[f]===void 0&&(h[f]=c.children[p++].getBoundingClientRect().height)}),a.forEach(function(l){var c=l.sizer,h=l.element.querySelector(".line-numbers-rows");c.style.display="none",c.innerHTML="",l.lineHeights.forEach(function(p,f){h.children[f].style.height=p+"px"})})}}function n(o){return o?window.getComputedStyle?getComputedStyle(o):o.currentStyle||null:null}var s=void 0;window.addEventListener("resize",function(){r.assumeViewportIndependence&&s===window.innerWidth||(s=window.innerWidth,i(Array.prototype.slice.call(document.querySelectorAll("pre."+t))))}),Prism.hooks.add("complete",function(o){if(o.code){var a=o.element,l=a.parentNode;if(!(!l||!/pre/i.test(l.nodeName))&&!a.querySelector(".line-numbers-rows")&&Prism.util.isActive(a,t)){a.classList.remove(t),l.classList.add(t);var c=o.code.match(e),h=c?c.length+1:1,p,f=new Array(h+1).join("<span></span>");p=document.createElement("span"),p.setAttribute("aria-hidden","true"),p.className="line-numbers-rows",p.innerHTML=f,l.hasAttribute("data-start")&&(l.style.counterReset="linenumber "+(parseInt(l.getAttribute("data-start"),10)-1)),o.element.appendChild(p),i([l]),Prism.hooks.run("line-numbers",o)}}}),Prism.hooks.add("line-numbers",function(o){o.plugins=o.plugins||{},o.plugins.lineNumbers=!0})})();function Fgt(){const t=ut.useRef(null),e=ut.useRef(null),[r,i]=ut.useState(null),[n,s]=ut.useState(null);ut.useEffect(()=>{o()},[]);async function o(){if(gLe.highlightAll(),!(t!=null&&t.current))return;ri.portalUrl="http://arcgis.com/";const c=new PB({basemap:"satellite"}),h=new j$e({container:t==null?void 0:t.current,map:c,zoom:3});h.ui.add([new K$e({view:h,content:e==null?void 0:e.current,expanded:!0,group:"group1",expandTooltip:"MediaLayer"})],"top-left"),i(h)}async function a(){const c=new Koe({image:"Liverpool.png",georeference:new Yoe({extent:new ur({spatialReference:{wkid:102100},xmin:-339441.5168570463,ymin:7051887318179514e-9,xmax:-324839.58261292917,ymax:7067371687353565e-9})})}),h=new eae({source:[c]});r.map.layers.add(h),await r.when(),await h.when(),s(h);const p=new Mmt({leadingLayers:[h],position:75,view:r});let f=!0,m=0;const g=setInterval(()=>{if(m===2){clearInterval(g);return}f?p.position=p.position-.05:p.position=p.position+.05,p.position===40?f=!1:p.position===75&&(f=!0,m++)},1);r.ui.add(p),r==null||r.goTo(new ur({spatialReference:{wkid:102100},xmin:-339441.5168570463,ymin:7051887318179514e-9,xmax:-324839.58261292917,ymax:7067371687353565e-9}).expand(1))}return JR("div",{className:"App",children:[Qi("div",{id:"view",ref:t}),JR("div",{ref:e,className:"card",children:[Qi("p",{className:"title",children:"MediaLayer"}),Qi("pre",{className:"line-numbers",children:Qi("code",{className:"language-js",children:`new MediaLayer({ 
  source: new ImageElement({
    image: "/Liverpool.png",
    georeference: 
      new ExtentAndRotationGeoreference({
        extent: new Extent({          
          xmin: -339441.5168570463,
          ymin: 7051887.318179514,
          xmax: -324839.58261292917,
          ymax: 7067371.687353565,
          spatialReference: { 
            wkid: 102100 
          }
        })
      })
  })
});`})}),Qi(mLe,{className:"btn","icon-start":"play",onClick:a})]})]})}let F_=class{constructor(e){this._allocator=e,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&aO(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*Yge);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}_grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,Yge));e++)this._items.push(this._allocator())}};const Yge=1024;function $e(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function zO(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]}function aae(t,e,r,i,n,s,o,a,l,c,h,p,f,m,g,_){return[t,e,r,i,n,s,o,a,l,c,h,p,f,m,g,_]}function yLe(t,e){return new Float64Array(t,e,16)}const id=$e();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:id,clone:zO,create:$e,createView:yLe,fromValues:aae},Symbol.toStringTag,{value:"Module"}));var Nu;(function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.Z=2]="Z"})(Nu||(Nu={}));function Dp(){return[0,0,0,1]}function kgt(t){return[t[0],t[1],t[2],t[3]]}function Ugt(t,e,r,i){return[t,e,r,i]}function _Le(t,e){return new Float64Array(t,e,4)}const zgt=Dp();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:zgt,clone:kgt,create:Dp,createView:_Le,fromValues:Ugt},Symbol.toStringTag,{value:"Module"}));let P3=class wT{constructor(e,r,i){this._itemByteSize=e,this._itemCreate=r,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(i/this._itemByteSize)}get(){this._itemsPtr===0&&aO(()=>this._reset());const e=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=e;){const r=new ArrayBuffer(this._itemsPerBuffer*this._itemByteSize);for(let i=0;i<this._itemsPerBuffer;++i)this._items.push(this._itemCreate(r,i*this._itemByteSize));this._buffers.push(r)}return this._items[this._itemsPtr++]}_reset(){const e=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>e;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(e=pE){return new wT(16,DIe,e)}static createVec3f64(e=pE){return new wT(24,yne,e)}static createVec4f64(e=pE){return new wT(32,V3e,e)}static createMat3f64(e=pE){return new wT(72,H$e,e)}static createMat4f64(e=pE){return new wT(128,yLe,e)}static createQuatf64(e=pE){return new wT(32,_Le,e)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this._itemByteSize}}};const pE=4*CO.KILOBYTES,FGt=P3.createVec2f64(),Ye=P3.createVec3f64(),lae=P3.createVec4f64();P3.createMat3f64();const cae=P3.createMat4f64(),kGt=P3.createQuatf64();function vm(t){return t?{origin:On(t.origin),vector:On(t.vector)}:{origin:P(),vector:P()}}function Vgt(t,e){const r=jgt.get();return r.origin=t,r.vector=e,r}function UGt(t,e=vm()){return Bgt(t.origin,t.vector,e)}function Bgt(t,e,r=vm()){return ce(r.origin,t),ce(r.vector,e),r}function DS(t,e,r=vm()){return ce(r.origin,t),ge(r.vector,e,t),r}function uae(t,e){const r=ge(Ye.get(),e,t.origin),i=ve(t.vector,r),n=ve(t.vector,t.vector),s=_e(i/n,0,1),o=ge(Ye.get(),le(Ye.get(),t.vector,s),r);return ve(o,o)}function zGt(t,e,r){return $Q(t,e,0,1,r)}function VGt(t,e,r){return me(r,t.origin,le(r,t.vector,e))}function $Q(t,e,r,i,n){const{vector:s,origin:o}=t,a=ge(Ye.get(),e,o),l=ve(s,a)/nl(s);return le(n,s,_e(l,r,i)),me(n,n,t.origin)}function BGt(t,e){if(bLe(t,Vgt(e.origin,e.direction),!1,Jz)){const{tA:r,pB:i,distance2:n}=Jz;if(r>=0&&r<=1)return n;if(r<0)return ga(t.origin,i);if(r>1)return ga(me(Ye.get(),t.origin,t.vector),i)}return null}function vLe(t,e,r){return!!bLe(t,e,!0,Jz)&&(ce(r,Jz.pA),!0)}function bLe(t,e,r,i){const s=t.origin,o=me(Ye.get(),s,t.vector),a=e.origin,l=me(Ye.get(),a,e.vector),c=Ye.get(),h=Ye.get();if(c[0]=s[0]-a[0],c[1]=s[1]-a[1],c[2]=s[2]-a[2],h[0]=l[0]-a[0],h[1]=l[1]-a[1],h[2]=l[2]-a[2],Math.abs(h[0])<1e-6&&Math.abs(h[1])<1e-6&&Math.abs(h[2])<1e-6)return!1;const p=Ye.get();if(p[0]=o[0]-s[0],p[1]=o[1]-s[1],p[2]=o[2]-s[2],Math.abs(p[0])<1e-6&&Math.abs(p[1])<1e-6&&Math.abs(p[2])<1e-6)return!1;const f=c[0]*h[0]+c[1]*h[1]+c[2]*h[2],m=h[0]*p[0]+h[1]*p[1]+h[2]*p[2],g=c[0]*p[0]+c[1]*p[1]+c[2]*p[2],_=h[0]*h[0]+h[1]*h[1]+h[2]*h[2],b=(p[0]*p[0]+p[1]*p[1]+p[2]*p[2])*_-m*m;if(Math.abs(b)<1e-6)return!1;let w=(f*m-g*_)/b,x=(f+m*w)/_;r&&(w=_e(w,0,1),x=_e(x,0,1));const T=Ye.get(),E=Ye.get();return T[0]=s[0]+w*p[0],T[1]=s[1]+w*p[1],T[2]=s[2]+w*p[2],E[0]=a[0]+x*h[0],E[1]=a[1]+x*h[1],E[2]=a[2]+x*h[2],i.tA=w,i.tB=x,i.pA=T,i.pB=E,i.distance2=ga(T,E),!0}const Jz={tA:0,tB:0,pA:P(),pB:P(),distance2:0},jgt=new F_(()=>vm());function Do(t){return t?Zge(On(t.origin),On(t.direction)):Zge(P(),P())}function Zge(t,e){return{origin:t,direction:e}}function jGt(t,e){return g_(t.origin,e.origin)&&g_(t.direction,e.direction)}function nd(t,e){const r=Wgt.get();return r.origin=t,r.direction=e,r}function Kz(t,e=Do()){return wLe(t.origin,t.direction,e)}function Ggt(t,e,r=Do()){return ce(r.origin,t),ge(r.direction,e,t),r}function wLe(t,e,r=Do()){return ce(r.origin,t),ce(r.direction,e),r}function Hgt(t,e){const r=vt(Ye.get(),we(Ye.get(),t.direction),ge(Ye.get(),e,t.origin));return ve(r,r)}function qgt(t,e,r){const i=ve(t.direction,ge(r,e,t.origin));return me(r,t.origin,le(r,t.direction,i)),r}const Wgt=new F_(()=>Do());function V$(t,e){return ve(t,e)/Pe(t)}function hae(t,e){const r=ve(t,e)/(Pe(t)*Pe(e));return-Js(r)}function xLe(t,e,r){we(N4,t),we(CH,e);const i=ve(N4,CH),n=Js(i),s=vt(N4,N4,CH);return ve(s,r)<0?2*Math.PI-n:n}const N4=P(),CH=P();function Os(){return pr()}function VO(t,e=Os()){return Vf(e,t)}function TLe(t,e){return Zt(t[0],t[1],t[2],e)}function Xgt(t){return t}function SLe(t){t[0]=t[1]=t[2]=t[3]=0}function NB(t,e){return t[0]=t[1]=t[2]=0,t[3]=e,t}function i_(t){return t[3]}function Ygt(t){return t}function ELe(t,e,r,i){return Zt(t,e,r,i)}function Zgt(t,e,r){return t!==r&&ce(r,t),r[3]=t[3]+e,r}function Jgt(t,e,r){return re.getLogger("esri.geometry.support.sphere").error("sphere.setExtent is not yet supported"),t===r?r:VO(t,r)}function Dw(t,e,r){if(R(e))return!1;const{origin:i,direction:n}=e,s=Kgt;s[0]=i[0]-t[0],s[1]=i[1]-t[1],s[2]=i[2]-t[2];const o=n[0]*n[0]+n[1]*n[1]+n[2]*n[2];if(o===0)return!1;const a=2*(n[0]*s[0]+n[1]*s[1]+n[2]*s[2]),l=a*a-4*o*(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]-t[3]*t[3]);if(l<0)return!1;const c=Math.sqrt(l);let h=(-a-c)/(2*o);const p=(-a+c)/(2*o);return(h<0||p<h&&p>0)&&(h=p),!(h<0)&&(r&&(r[0]=i[0]+n[0]*h,r[1]=i[1]+n[1]*h,r[2]=i[2]+n[2]*h),!0)}const Kgt=P();function LQ(t,e){return Dw(t,e,null)}function Qgt(t,e,r){if(Dw(t,e,r))return r;const i=I3(t,e,Ye.get());return me(r,e.origin,le(Ye.get(),e.direction,Pi(e.origin,i)/Pe(e.direction))),r}function I3(t,e,r){const i=Ye.get(),n=cae.get();vt(i,e.origin,e.direction);const s=i_(t);vt(r,i,e.origin),le(r,r,1/Pe(r)*s);const o=RLe(t,e.origin),a=hae(e.origin,r);return rd(n,a+o,i),Ke(r,r,n),r}function eyt(t,e,r){return Dw(t,e,r)?r:(qgt(e,t,r),CLe(t,r,r))}function CLe(t,e,r){const i=ge(Ye.get(),e,t),n=le(Ye.get(),i,t[3]/Pe(i));return me(r,n,t)}function ALe(t,e){const r=ge(Ye.get(),e,t),i=nl(r),n=t[3]*t[3];return Math.sqrt(Math.abs(i-n))}function RLe(t,e){const r=ge(Ye.get(),e,t),i=Pe(r),n=i_(t),s=n+Math.abs(n-i);return Js(n/s)}const AH=P();function OLe(t,e,r,i){const n=ge(AH,e,t);switch(r){case Nu.X:{const s=Xhe(n,AH)[2];return he(i,-Math.sin(s),Math.cos(s),0)}case Nu.Y:{const s=Xhe(n,AH),o=s[1],a=s[2],l=Math.sin(o);return he(i,-l*Math.cos(a),-l*Math.sin(a),Math.cos(o))}case Nu.Z:return we(i,n);default:return}}function MLe(t,e){const r=ge(DQ,e,t);return Pe(r)-t[3]}function tyt(t,e,r,i){const n=MLe(t,e),s=OLe(t,e,Nu.Z,DQ),o=le(DQ,s,r-n);return me(i,e,o)}function ryt(t,e){const r=ga(t,e),i=i_(t);return r<=i*i}const DQ=P(),FB=Os(),iyt=Object.freeze(Object.defineProperty({__proto__:null,altitudeAt:MLe,angleToSilhouette:RLe,axisAt:OLe,clear:SLe,closestPoint:eyt,closestPointOnSilhouette:I3,containsPoint:ryt,copy:VO,create:Os,distanceToSilhouette:ALe,elevate:Zgt,fromCenterAndRadius:TLe,fromRadius:NB,fromValues:ELe,getCenter:Ygt,getRadius:i_,intersectRay:Dw,intersectRayClosestSilhouette:Qgt,intersectsRay:LQ,projectPoint:CLe,setAltitudeAt:tyt,setExtent:Jgt,tmpSphere:FB,wrap:Xgt},Symbol.toStringTag,{value:"Module"}));function p2(t){const e=t[0]*t[0]+t[4]*t[4]+t[8]*t[8],r=t[1]*t[1]+t[5]*t[5]+t[9]*t[9],i=t[2]*t[2]+t[6]*t[6]+t[10]*t[10];return Math.sqrt(Math.max(e,r,i))}function nyt(t,e){const r=Math.sqrt(e[0]*e[0]+e[4]*e[4]+e[8]*e[8]),i=Math.sqrt(e[1]*e[1]+e[5]*e[5]+e[9]*e[9]),n=Math.sqrt(e[2]*e[2]+e[6]*e[6]+e[10]*e[10]);return he(t,r,i,n),t}function GGt(t,e,r){r=r||t;const i=ve(t,e);he(r,t[0]-i*e[0],t[1]-i*e[1],t[2]-i*e[2]),we(r,r)}function HGt(t,e,r){Math.abs(t[0])>Math.abs(t[1])?he(e,0,1,0):he(e,1,0,0),vt(r,t,e),we(e,e),vt(e,r,t),we(r,r)}function F4(t,e,r,i,n,s){const o=t+(e-t)*n;return o+(r+(i-r)*n-o)*s}function syt(t,e,r,i=P()){const n=Pe(t),s=Pe(e),o=ve(t,e)/(n*s);if(o<.9999999999999999){const a=Math.acos(o),l=((1-r)*n+r*s)/Math.sin(a),c=l/n*Math.sin((1-r)*a),h=l/s*Math.sin(r*a);return le(_S,t,c),le(vS,e,h),me(i,_S,vS)}return fs(i,t,e,r)}function qGt(t,e,r,i=P(),n=P()){const s=Pe(t),o=Pe(e),a=ve(t,e)/(s*o);if(a<.9999999999999999){const l=Math.acos(a),c=Math.sin(l),h=Math.sin(r*l),p=Math.sin((1-r)*l),f=(1-r)*s+r*o;{const m=f/c,g=m/o*h;le(_S,t,m/s*p),le(vS,e,g),me(i,_S,vS)}{const m=1/s*(-Math.cos((1-r)*l)*l*f+p*(-s+o));le(_S,t,m);const g=1/o*(Math.cos(r*l)*l*f+h*(-s+o));le(vS,e,g),me(n,_S,vS),le(n,n,1/c)}return n}return fs(i,t,e,r),ge(n,e,t),we(n,n),n}function vU(t,e,r){t=we(_S,t),e=we(vS,e);const i=Js(ve(t,e));if(r){const n=vt(oyt,t,e);if(ve(n,r)<0)return-i}return i}function bU(t){const e=t.length;return r=>{if(r<=t[0][0])return t[0][1];if(r>=t[e-1][0])return t[e-1][1];let i=1;for(;r>t[i][0];)i++;const n=t[i-1][0],s=t[i][0],o=(s-r)/(s-n);return o*t[i-1][1]+(1-o)*t[i][1]}}function WGt(t,e,r,i){ge(Jge,e,t),ge(Kge,r,t),vt(i,Jge,Kge),we(i,i),i[3]=-ve(t,i)}const Jge=P(),Kge=P(),oyt=P(),_S=P(),vS=P();function Yr(t=wI){return[t[0],t[1],t[2],t[3]]}function ayt(t=wI[0],e=wI[1],r=wI[2],i=wI[3]){return dae(t,e,r,i,lae.get())}function kB(t,e){return dae(e[0],e[1],e[2],e[3],t)}function dae(t,e,r,i,n=Yr()){return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n}function PLe(t,e,r){return ce(r,t),r[3]=e,r}function UN(t,e,r){const i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=Math.abs(i-1)>1e-5&&i>1e-12?1/Math.sqrt(i):1;return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=-(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]),r}function rl(t,e,r,i=Yr()){const n=r[0]-e[0],s=r[1]-e[1],o=r[2]-e[2],a=t[0]-e[0],l=t[1]-e[1],c=t[2]-e[2],h=s*c-o*l,p=o*a-n*c,f=n*l-s*a,m=h*h+p*p+f*f,g=Math.abs(m-1)>1e-5&&m>1e-12?1/Math.sqrt(m):1;return i[0]=h*g,i[1]=p*g,i[2]=f*g,i[3]=-(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]),i}function ILe(t,e,r,i,n){const s=t.length/3;if(s<3)return!1;he(RM,t[3*r],t[3*r+1],t[3*r+2]);let o=i,a=!1;for(;o<s-1&&!a;){const l=3*o;he(fE,t[l],t[l+1],t[l+2]),o++,a=!Hl(RM,fE)}if(!a)return!1;for(o=Math.max(o,n),a=!1;o<s&&!a;){const l=3*o;he(ZT,t[l],t[l+1],t[l+2]),o++,ge(k4,RM,fE),we(k4,k4),ge(U4,fE,ZT),we(U4,U4),a=!Hl(RM,ZT)&&!Hl(fE,ZT)&&Math.abs(ve(k4,U4))<lyt}return a?(rl(RM,fE,ZT,e),!0):(r!==0||i!==1||n!==2)&&ILe(t,e,0,1,2)}const lyt=.99619469809,RM=P(),fE=P(),ZT=P(),k4=P(),U4=P();function NQ(t,e,r){return e!==t&&kB(t,e),t[3]=-ve(t,r),t}function FQ(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function dD(t,e,r,i){return vt(ZT,e,t),UN(r,ZT,i)}function XGt(t,e,r,i){return UB(t,e,ge(Ye.get(),r,e),fyt,i)}function j2(t,e,r){return!!v(e)&&UB(t,e.origin,e.direction,myt,r)}function cyt(t,e,r){return UB(t,e.origin,e.vector,Yg.NONE,r)}function uyt(t,e,r){return UB(t,e.origin,e.vector,Yg.CLAMP,r)}function $Le(t,e){return Ri(t,e)>=0}function hyt(t,e){const r=ve(t,e.ray.direction),i=-Ri(t,e.ray.origin);if(i<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return i>0;if((i<0||r<0)&&!(i<0&&r<0))return!0;const n=i/r;return r>0?n<e.c1&&(e.c1=n):n>e.c0&&(e.c0=n),e.c0<=e.c1}function dyt(t,e){const r=ve(t,e.ray.direction),i=-Ri(t,e.ray.origin);if(r>-1e-6&&r<1e-6)return i>0;const n=i/r;return r>0?n<e.c1&&(e.c1=n):n>e.c0&&(e.c0=n),e.c0<=e.c1}function pyt(t,e,r){const i=le(Ye.get(),t,-t[3]),n=kQ(t,ge(Ye.get(),e,i),Ye.get());return me(r,n,i),r}function kQ(t,e,r){const i=le(Ye.get(),t,ve(t,e));return ge(r,e,i),r}function Ri(t,e){return ve(t,e)+t[3]}function UB(t,e,r,i,n){const s=ve(t,r);if(s===0)return!1;let o=-(ve(t,e)+t[3])/s;return i&Yg.CLAMP&&(o=_e(o,0,1)),!(!(i&Yg.INFINITE_MIN)&&o<0||!(i&Yg.INFINITE_MAX)&&o>1)&&(me(n,e,le(n,r,o)),!0)}function YGt(t){return t}const wI=[0,0,1,0];var Yg;(function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.INFINITE_MIN=4]="INFINITE_MIN",t[t.INFINITE_MAX=8]="INFINITE_MAX"})(Yg||(Yg={}));const fyt=Yg.INFINITE_MIN|Yg.INFINITE_MAX,myt=Yg.INFINITE_MAX,RH=re.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");let gyt=class{constructor(){this.plane=Yr(),this.origin=P(),this.basis1=P(),this.basis2=P()}};const LLe=gyt;function k_(t=HLe){return{plane:Yr(t.plane),origin:On(t.origin),basis1:On(t.basis1),basis2:On(t.basis2)}}function yyt(t,e,r){const i=Oyt.get();return i.origin=t,i.basis1=e,i.basis2=r,i.plane=ayt(0,0,0,0),zB(i),i}function G2(t,e=k_()){return pae(t.origin,t.basis1,t.basis2,e)}function _yt(t,e){ce(e.origin,t.origin),ce(e.basis1,t.basis1),ce(e.basis2,t.basis2),kB(e.plane,t.plane)}function pae(t,e,r,i=k_()){return ce(i.origin,t),ce(i.basis1,e),ce(i.basis2,r),zB(i),Ayt(i,"fromValues()"),i}function zB(t){dD(t.basis2,t.basis1,t.origin,t.plane)}function DLe(t,e,r){t!==r&&G2(t,r);const i=le(Ye.get(),C_(t),e);return me(r.origin,r.origin,i),r.plane[3]-=e,r}function vyt(t,e,r){return NLe(e,r),DLe(r,yae(t,t.origin),r),r}function NLe(t,e=k_()){const r=(t[2]-t[0])/2,i=(t[3]-t[1])/2;return he(e.origin,t[0]+r,t[1]+i,0),he(e.basis1,r,0,0),he(e.basis2,0,i,0),dae(0,0,1,0,e.plane),e}function fae(t,e,r){return!!j2(t.plane,e,r)&&jLe(t,r)}function byt(t,e,r){if(fae(t,e,r))return r;const i=FLe(t,e,Ye.get());return me(r,e.origin,le(Ye.get(),e.direction,Pi(e.origin,i)/Pe(e.direction))),r}function FLe(t,e,r){const i=Qz.get();GLe(t,e,i,Qz.get());let n=Number.POSITIVE_INFINITY;for(const s of vae){const o=_ae(t,s,VB.get()),a=Ye.get();if(cyt(i,o,a)){const l=L_(Ye.get(),e.origin,a),c=Math.abs(Js(ve(e.direction,l)));c<n&&(n=c,ce(r,a))}}return n===Number.POSITIVE_INFINITY?kLe(t,e,r):r}function kLe(t,e,r){if(fae(t,e,r))return r;const i=Qz.get(),n=Qz.get();GLe(t,e,i,n);let s=Number.POSITIVE_INFINITY;for(const o of vae){const a=_ae(t,o,VB.get()),l=Ye.get();if(uyt(i,a,l)){const c=Hgt(e,l);if(!$Le(n,l))continue;c<s&&(s=c,ce(r,l))}}return mae(t,e.origin)<s&&ULe(t,e.origin,r),r}function ULe(t,e,r){const i=pyt(t.plane,e,Ye.get()),n=$Q(Qge(t,t.basis1),i,-1,1,Ye.get()),s=$Q(Qge(t,t.basis2),i,-1,1,Ye.get());return ge(r,me(Ye.get(),n,s),t.origin),r}function zLe(t,e,r){const{origin:i,basis1:n,basis2:s}=t,o=ge(Ye.get(),e,i),a=V$(n,o),l=V$(s,o),c=V$(C_(t),o);return he(r,a,l,c)}function mae(t,e){const r=zLe(t,e,Ye.get()),{basis1:i,basis2:n}=t,s=Pe(i),o=Pe(n),a=Math.max(Math.abs(r[0])-s,0),l=Math.max(Math.abs(r[1])-o,0),c=r[2];return a*a+l*l+c*c}function wyt(t,e){return Math.sqrt(mae(t,e))}function xyt(t,e){let r=Number.NEGATIVE_INFINITY;for(const i of vae){const n=_ae(t,i,VB.get()),s=uae(n,e);s>r&&(r=s)}return Math.sqrt(r)}function gae(t,e){return $Le(t.plane,e)&&jLe(t,e)}function Tyt(t,e,r,i){return Cyt(t,r,i)}function yae(t,e){const r=-t.plane[3];return V$(C_(t),e)-r}function Syt(t,e,r,i){const n=yae(t,e),s=le(Ryt,C_(t),r-n);return me(i,e,s),i}function VLe(t,e){return Hl(t.basis1,e.basis1)&&Hl(t.basis2,e.basis2)&&Hl(t.origin,e.origin)}function BLe(t,e,r){return t!==r&&G2(t,r),ya(mE,e),Wu(mE,mE),Ke(r.basis1,t.basis1,mE),Ke(r.basis2,t.basis2,mE),Ke(r.plane,t.plane,mE),Ke(r.origin,t.origin,e),NQ(r.plane,r.plane,r.origin),r}function Eyt(t,e,r,i){return t!==i&&G2(t,i),rd(OH,e,r),Ke(i.basis1,t.basis1,OH),Ke(i.basis2,t.basis2,OH),zB(i),i}function C_(t){return t.plane}function Cyt(t,e,r){switch(e){case Nu.X:ce(r,t.basis1),we(r,r);break;case Nu.Y:ce(r,t.basis2),we(r,r);break;case Nu.Z:ce(r,C_(t))}return r}function jLe(t,e){const r=ge(Ye.get(),e,t.origin),i=nl(t.basis1),n=nl(t.basis2),s=ve(t.basis1,r),o=ve(t.basis2,r);return-s-i<0&&s-i<0&&-o-n<0&&o-n<0}function Qge(t,e){const r=VB.get();return ce(r.origin,t.origin),ce(r.vector,e),r}function _ae(t,e,r){const{basis1:i,basis2:n,origin:s}=t,o=le(Ye.get(),i,e.origin[0]),a=le(Ye.get(),n,e.origin[1]);me(r.origin,o,a),me(r.origin,r.origin,s);const l=le(Ye.get(),i,e.direction[0]),c=le(Ye.get(),n,e.direction[1]);return le(r.vector,me(l,l,c),2),r}function Ayt(t,e){Math.abs(ve(t.basis1,t.basis2)/(Pe(t.basis1)*Pe(t.basis2)))>1e-6&&RH.warn(e,"Provided basis vectors are not perpendicular"),Math.abs(ve(t.basis1,C_(t)))>1e-6&&RH.warn(e,"Basis vectors and plane normal are not perpendicular"),Math.abs(-ve(C_(t),t.origin)-t.plane[3])>1e-6&&RH.warn(e,"Plane offset is not consistent with plane origin")}function GLe(t,e,r,i){const n=C_(t);dD(n,e.direction,e.origin,r),dD(r,n,e.origin,i)}const HLe={plane:Yr(),origin:ke(0,0,0),basis1:ke(1,0,0),basis2:ke(0,1,0)},Qz=new F_(Yr),VB=new F_(vm),Ryt=P(),Oyt=new F_(()=>k_()),vae=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],mE=$e(),OH=$e(),Myt=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:LLe,UP:HLe,altitudeAt:yae,axisAt:Tyt,closestPoint:kLe,closestPointOnSilhouette:FLe,copy:G2,copyWithoutVerify:_yt,create:k_,distance:wyt,distance2:mae,distanceToSilhouette:xyt,elevate:DLe,equals:VLe,extrusionContainsPoint:gae,fromAABoundingRect:NLe,fromValues:pae,intersectRay:fae,intersectRayClosestSilhouette:byt,normal:C_,projectPoint:ULe,projectPointLocal:zLe,rotate:Eyt,setAltitudeAt:Syt,setExtent:vyt,transform:BLe,updateUnboundedPlane:zB,wrap:yyt},Symbol.toStringTag,{value:"Module"})),Pyt=new Je(O2e),eye=new Je(Kie),tye=new Je(Qie),JGt=new Je(M2e);function BB(t){return t&&(my(t)||In(t,eye))?eye:t&&(gy(t)||In(t,tye))?tye:Pyt}function Iyt(t){const{value:e,operations:r}=t;return{operations:r,value:r.create(e)}}function $yt(t,e,r){return t.operations.setExtent(t.value,e,r.value),r}function Lyt(t){return{operations:t,value:t.create()}}function qLe(t,e,r=Lyt(t)){return r.operations=t,t.copy(e,r.value),r}function Dyt(t){return qLe(iyt,ELe(0,0,0,ii(t).radius))}const rye=2**50;function Nyt(){return qLe(Myt,pae([0,0,0],[rye,0,0],[0,rye,0]))}function Fyt(t,e,r){return t.operations.axisAt(t.value,e,Nu.Z,r)}function kyt(t,e,r,i){return t.operations.axisAt(t.value,e,r,i)}function Uyt(t,e,r){return t.operations.intersectRay(t.value,e,r)}function zyt(t,e,r){return t.operations.intersectRayClosestSilhouette(t.value,e,r)}function Vyt(t,e){return t.operations.altitudeAt(t.value,e)}function WLe(t,e,r,i){return t.operations.setAltitudeAt(t.value,e,r,i)}function Byt(t,e,r,i){return e!==i&&po(i,e),he(gE,i[12],i[13],i[14]),WLe(t,gE,r,gE),i[12]=gE[0],i[13]=gE[1],i[14]=gE[2],i}function MH(t,e,r){return t.operations.elevate(t.value,e,r.value)}const gE=P();function iye(t,e,r,i,n){return n[0]=ve(t,e),n[1]=ve(t,r),n[2]=ve(t,i),n}function UQ(t,e,r,i,n){ce(r,t),ce(z4,e),we(z4,z4),vt(i,z4,r),vt(n,i,r)}function XLe(t,e){return t?BB(e):e.isGeographic?Je.PlateCarree:e}const z4=P(),bae=96;function KGt(t,e){const r=e||t.extent,i=t.width,n=Kl(r&&r.spatialReference);return r&&i?r.width/i*n*ene*bae:0}function jyt(t,e){return t/(Kl(e)*ene*bae)}function Gyt(t){return t/(ene*bae)}const wae=re.getLogger("esri.layers.support.ElevationSampler");let YLe=class{queryElevation(e){return ZLe(e.clone(),this)}on(){return Yyt}projectIfRequired(e,r){return JLe(e,r)}},Hyt=class extends YLe{get spatialReference(){return this.extent.spatialReference}constructor(e,r,i){super(),this.tile=e,this.noDataValue=i;const n=e.tile.extent;this.extent=U9(n,r.spatialReference),this.extent.zmin=e.zmin,this.extent.zmax=e.zmax,this._aaExtent=n;const s=Kl(r.spatialReference),o=r.lodAt(e.tile.level).resolution*s;this.demResolution={min:o,max:o}}contains(e){const r=this.projectIfRequired(e,this.spatialReference);return!R(r)&&this.containsAt(r.x,r.y)}containsAt(e,r){return z9(this._aaExtent,e,r)}elevationAt(e,r){if(!this.containsAt(e,r)){const i=this.extent,n=`${i.xmin}, ${i.ymin}, ${i.xmax}, ${i.ymax}`;return wae.warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler extent (${n})`),this.noDataValue}return Nt(this.tile.sample(e,r),this.noDataValue)}},tHt=class extends YLe{get spatialReference(){return this.extent.spatialReference}constructor(e,r,i){let n;super(),typeof r=="number"?(this.noDataValue=r,n=null):(n=r,this.noDataValue=i),this.samplers=n?e.map(o=>new Hyt(o,n,this.noDataValue)):e;const s=this.samplers[0];if(s){this.extent=s.extent.clone();const{min:o,max:a}=s.demResolution;this.demResolution={min:o,max:a};for(let l=1;l<this.samplers.length;l++){const c=this.samplers[l];this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max)}}else this.extent=U9(Kt(),n.spatialReference),this.demResolution={min:0,max:0}}elevationAt(e,r){for(const i of this.samplers)if(i.containsAt(e,r))return i.elevationAt(e,r);return wae.warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler`),this.noDataValue}};function ZLe(t,e){const r=JLe(t,e.spatialReference);if(!r)return null;switch(t.type){case"point":qyt(t,r,e);break;case"polyline":Wyt(t,r,e);break;case"multipoint":Xyt(t,r,e)}return t}function JLe(t,e){if(R(t))return null;const r=t.spatialReference;if(r.equals(e))return t;const i=D2(t,e);return i||wae.error(`Cannot project geometry spatial reference (wkid:${r.wkid}) to elevation sampler spatial reference (wkid:${e.wkid})`),i}function qyt(t,e,r){t.z=r.elevationAt(e.x,e.y)}function Wyt(t,e,r){Mg.spatialReference=e.spatialReference;const i=t.hasM&&!t.hasZ;for(let n=0;n<t.paths.length;n++){const s=t.paths[n],o=e.paths[n];for(let a=0;a<s.length;a++){const l=s[a],c=o[a];Mg.x=c[0],Mg.y=c[1],i&&(l[3]=l[2]),l[2]=r.elevationAt(Mg.x,Mg.y)}}t.hasZ=!0}function Xyt(t,e,r){Mg.spatialReference=e.spatialReference;const i=t.hasM&&!t.hasZ;for(let n=0;n<t.points.length;n++){const s=t.points[n],o=e.points[n];Mg.x=o[0],Mg.y=o[1],i&&(s[3]=s[2]),s[2]=r.elevationAt(Mg.x,Mg.y)}t.hasZ=!0}const Mg=new Ue,Yyt={remove(){}},Zyt=12;let Pu=class wc{constructor(e){const r=wc.checkUnsupported(e);if(v(r))throw r;const i=e;this.spatialReference=i.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=o2(this.spatialReference)||my(this.spatialReference)||gy(this.spatialReference),this.origin=[i.origin.x,i.origin.y],this.pixelSize=i.size[0],this.dpi=i.dpi;const n=i.lods.reduce((c,h,p)=>(h.level<c.min&&(c.min=h.level,c.minIndex=p),c.max=Math.max(c.max,h.level),c),{min:1/0,minIndex:0,max:-1/0}),s=i.lods[n.minIndex],o=2**s.level;let a=s.resolution*o,l=s.scale*o;this.levels=new Array(n.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:l,tileSize:[a*i.size[0],a*i.size[1]]},a/=2,l/=2}clone(){return new wc(this.toTileInfo())}toTileInfo(){return new S$({dpi:this.dpi,origin:new Ue({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((e,r)=>new Kd({level:r,scale:e.scale,resolution:e.resolution}))})}getExtent(e,r,i,n){const s=this.levels[e],o=s.tileSize[0],a=s.tileSize[1];n[0]=this.origin[0]+i*o,n[2]=this.origin[0]+(i+1)*o,n[3]=this.origin[1]-r*a,n[1]=this.origin[1]-(r+1)*a}convertExtentToRadians(e,r){this._isWebMercator?(r[0]=Nhe(e[0]),r[1]=q8(e[1]),r[2]=Nhe(e[2]),r[3]=q8(e[3])):this._isGCS&&(r[0]=Xt(e[0]),r[1]=Xt(e[1]),r[2]=Xt(e[2]),r[3]=Xt(e[3]))}getExtentGeometry(e,r,i,n=new ur){return this.getExtent(e,r,i,Rm),n.spatialReference=this.spatialReference,n.xmin=Rm[0],n.ymin=Rm[1],n.xmax=Rm[2],n.ymax=Rm[3],n.zmin=void 0,n.zmax=void 0,n}ensureMaxLod(e){if(e==null)return!1;let r=!1;for(;this.levels.length<=e;){const i=this.levels[this.levels.length-1],n=i.resolution/2;this.levels.push({resolution:n,scale:i.scale/2,tileSize:[n*this.pixelSize,n*this.pixelSize]}),r=!0}return r}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const r=this.levels[0].scale;return e>=r?0:Math.log(r/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e){if(!(e instanceof wc)){if(wc.checkUnsupported(e))return!1;e=new wc(e)}if(!e.spatialReference.equals(this.spatialReference)||e.pixelSize!==this.pixelSize)return!1;const r=Math.min(this.levels.length,e.levels.length)-1,i=this.levels[r].resolution;let n=.5*i;return!TR(e.origin[0],this.origin[0],n)||!TR(e.origin[1],this.origin[1],n)?!1:(n=.5*i/2**r/this.pixelSize*Zyt,TR(i,e.levels[r].resolution,n))}rootTilesInExtent(e,r=null,i=1/0){const n=new Array,s=this.levels[0].tileSize;if(R(e)||s[0]===0||s[1]===0)return n;wc.computeRowColExtent(e,s,this.origin,Rm);let o=Rm[1],a=Rm[3],l=Rm[0],c=Rm[2];const h=c-l,p=a-o;if(h*p>i){const f=Math.floor(Math.sqrt(i));p>f&&(o=o+Math.floor(.5*p)-Math.floor(.5*f),a=o+f),h>f&&(l=l+Math.floor(.5*h)-Math.floor(.5*f),c=l+f)}for(let f=o;f<a;f++)for(let m=l;m<c;m++)n.push([0,f,m]);return v(r)&&(r[0]=this.origin[0]+l*s[0],r[1]=this.origin[1]-a*s[1],r[2]=this.origin[0]+c*s[0],r[3]=this.origin[1]-o*s[1]),n}static computeRowColExtent(e,r,i,n){const s=.001*(e[2]-e[0]+(e[3]-e[1]));n[0]=Math.max(0,Math.floor((e[0]+s-i[0])/r[0])),n[2]=Math.max(0,Math.ceil((e[2]-s-i[0])/r[0])),n[1]=Math.max(0,Math.floor((i[1]-e[3]+s)/r[1])),n[3]=Math.max(0,Math.ceil((i[1]-e[1]-s)/r[1]))}static isPowerOfTwo(e){const r=e.lods,i=r[0].resolution*2**r[0].level;return!r.some(n=>!Hqe(n.resolution,i/2**n.level))}static hasGapInLevels(e){const r=e.lods.map(i=>i.level);r.sort((i,n)=>i-n);for(let i=1;i<r.length;i++)if(r[i]!==r[0]+i)return!0;return!1}static tileSizeSupported(e){const r=e.size[1];return r===e.size[0]&&(r&r-1)==0&&r>=128&&r<=512}static hasOriginPerLODs(e){const r=e.origin;return e.lods.some(i=>i.origin!=null&&(i.origin[0]!==r.x||i.origin[1]!==r.y))}static getMissingTileInfoError(){return new H("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(e){return R(e)?xae():e.lods.length<1?new H("tilingscheme:generic","Tiling scheme must have at least one level"):wc.isPowerOfTwo(e)?wc.hasGapInLevels(e)?new H("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):wc.tileSizeSupported(e)?wc.hasOriginPerLODs(e)?new H("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new H("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new H("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(e,r){const i=e[2]-e[0],n=e[3]-e[1],s=Kl(r),o=1.2*Math.max(i,n),a=256,l=96,c=.0254,h=new wc(new S$({size:[a,a],origin:new Ue({x:e[0]-.5*(o-i),y:e[3]+.5*(o-n)}),lods:[new Kd({level:0,resolution:o/a,scale:1/(a/l*c/(o*s))})],spatialReference:r}));return h.ensureMaxLod(20),h}static makeWebMercatorAuxiliarySphere(e){const r=new wc(wc.WebMercatorAuxiliarySphereTileInfo);return r.ensureMaxLod(e),r}static makeGCSWithTileSize(e,r=256,i=16){const n=256/r,s=new wc(new S$({size:[r,r],origin:new Ue({x:-180,y:90,spatialReference:e}),spatialReference:e,lods:[new Kd({level:0,resolution:.703125*n,scale:295497598570834e-6*n})]}));return s.ensureMaxLod(i),s}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}};function xae(){return new H("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}Pu.WebMercatorAuxiliarySphereTileInfo=new S$({size:[256,256],origin:new Ue({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:Je.WebMercator}),spatialReference:Je.WebMercator,lods:[new Kd({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),Pu.WebMercatorAuxiliarySphere=Pu.makeWebMercatorAuxiliarySphere(19);const Rm=Kt(),eR=64,xI=512,Jyt=2.5,pD=qqe(JY/10),KLe=2,QLe=Kt();Pu.WebMercatorAuxiliarySphere.getExtent(0,0,0,QLe);const Kyt=Kt([-180,-90,180,90]),Qyt="Cannot extend surface to encompass all layers because it would result in too many root tiles.",e0t="Surface extent is too large for tile resolution at level 0.",t0t=3;let r0t=t0t;function zQ(t){return t<4?3:r0t}let b1=class extends Sn.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=pD}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if(e==null||R(e.extent)||R(e.spatialReference))return null;const r=U9(e.extent,e.spatialReference);return r.zmin=e.visibleElevationBounds.min,r.zmax=e.visibleElevationBounds.max,r}get spatialReference(){var e;return Nt((e=this.view.basemapTerrain)==null?void 0:e.spatialReference,Je.WGS84)}elevationAt(e,r){var i;if(R(this.extent)||!kl(this.extent,e,r)){const n=v(this.extent)?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return re.getLogger(this.declaredClass).warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler extent (${n})`),this.noDataValue}return Nt((i=this.view.elevationProvider)==null?void 0:i.getElevation(e,r,0,this.spatialReference,"ground"),this.noDataValue)}queryElevation(e){return ZLe(e.clone(),this)}};u([d({readOnly:!0})],b1.prototype,"demResolution",void 0),u([d({readOnly:!0})],b1.prototype,"extent",null),u([d({readOnly:!0})],b1.prototype,"noDataValue",void 0),u([d()],b1.prototype,"spatialReference",null),u([d({constructOnly:!0})],b1.prototype,"view",void 0),b1=u([$("esri.views.support.GroundViewElevationSampler")],b1);const i0t=b1;let w1=class extends be{constructor(e){super(e),this._handles=new qr,this.view=null,this.layerViews=new ct}initialize(){this._handles.add(fo(()=>{var e,r;return(r=(e=this.view)==null?void 0:e.map)==null?void 0:r.ground},e=>e.load())),this._handles.add(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null),this._handles&&(this._handles.destroy(),this._handles=null)}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new i0t({view:this.view}):null:null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this._handles.remove("updating"),this._handles.add(this.layerViews.map(e=>ne(()=>e.updating,()=>this._updateUpdating(),Zr)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};u([d({readOnly:!0})],w1.prototype,"elevationSampler",null),u([d({type:Boolean,readOnly:!0})],w1.prototype,"updating",null),u([d({constructOnly:!0})],w1.prototype,"view",void 0),u([d({type:ct,readOnly:!0})],w1.prototype,"layerViews",void 0),u([d({readOnly:!0})],w1.prototype,"suspended",null),w1=u([$("esri.views.GroundView")],w1);const n0t=w1,OM=()=>Q(()=>import("./TileLayerView3D-aa2a0f67.js"),["assets/TileLayerView3D-aa2a0f67.js","assets/LayerView3D-da1b015a.js","assets/TiledLayerView3D-a1037f80.js","assets/LayerView-1b945bf7.js","assets/RefreshableLayerView-23b69a26.js","assets/MapServiceLayerViewHelper-785c535e.js","assets/floorFilterUtils-080a7cd2.js","assets/sublayerUtils-a72692c8.js","assets/popupUtils-d91ea519.js","assets/drapedUtils-39abcefe.js"]),nye=()=>Q(()=>import("./ElevationLayerView3D-75e8f704.js"),["assets/ElevationLayerView3D-75e8f704.js","assets/LayerView3D-da1b015a.js","assets/TiledLayerView3D-a1037f80.js","assets/LayerView-1b945bf7.js"]),sye={"base-dynamic":()=>Q(()=>import("./BaseDynamicLayerView3D-c90d48c8.js"),["assets/BaseDynamicLayerView3D-c90d48c8.js","assets/DynamicLayerView3D-50a8ce9e.js","assets/LayerView3D-da1b015a.js","assets/projectExtentUtils-4e8d4f69.js","assets/ImageMaterial-97418884.js","assets/LayerView-1b945bf7.js","assets/RefreshableLayerView-23b69a26.js"]),"base-elevation":nye,"base-tile":OM,"bing-maps":OM,"building-scene":()=>Q(()=>import("./BuildingSceneLayerView3D-1959232a.js"),["assets/BuildingSceneLayerView3D-1959232a.js","assets/BuildingGroupSublayer-fe9f8589.js","assets/BuildingComponentSublayer-7e900898.js","assets/capabilities-a18453f6.js","assets/I3SIndexInfo-ec60d475.js","assets/I3SLayerDefinitions-979f223e.js","assets/I3SUtil-d5aff221.js","assets/I3SBinaryReader-525534dc.js","assets/popupUtils-d91ea519.js","assets/WhereClause-f6ddfb88.js","assets/executionError-fb3f283a.js","assets/I3SMeshView3D-b696b4dc.js","assets/I3SOverrides-432c03fa.js","assets/I3SNode-ce0e22bc.js","assets/RenderTexture-76842063.js","assets/FeatureLayerView3D-b5c9eab9.js","assets/FeatureLayerViewBase3D-7f72c504.js","assets/FeatureLikeLayerView3D-117b6659.js","assets/dehydratedFeatureComparison-4f346faa.js","assets/queryForSymbologySnapping-b15e9074.js","assets/elevationInfoUtils-72729690.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-b839ed8f.js","assets/optimizedFeatureQueryEngineAdapter-4dc0036f.js","assets/centroid-f5daa837.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-b565a77e.js","assets/QueryEngineResult-2c28eebf.js","assets/utils-ebf21391.js","assets/generateRendererUtils-bf5214e6.js","assets/projectionSupport-d70ac199.js","assets/json-48e3ea08.js","assets/utils-61f08010.js","assets/QueryEngineCapabilities-42e44ded.js","assets/timeSupport-d6519503.js","assets/FeatureStore-42c9ec6f.js","assets/heatmapTextureUtils-fcd30222.js","assets/projectExtentUtils-4e8d4f69.js","assets/LayerView3D-da1b015a.js","assets/EventedSet-9dd36680.js","assets/FeatureLayerView-c926a694.js","assets/LayerView-1b945bf7.js","assets/RefreshableLayerView-23b69a26.js","assets/SceneModification-93e668c8.js","assets/persistable-4ddc218c.js","assets/SceneLayerWorker-bd417782.js","assets/I3SQueryFeatureStore-de063927.js","assets/DefinitionExpressionSceneLayerView-2ee08ba8.js"]),csv:()=>Q(()=>import("./CSVLayerView3D-a9201652.js"),["assets/CSVLayerView3D-a9201652.js","assets/FeatureLayerViewBase3D-7f72c504.js","assets/FeatureLikeLayerView3D-117b6659.js","assets/dehydratedFeatureComparison-4f346faa.js","assets/queryForSymbologySnapping-b15e9074.js","assets/elevationInfoUtils-72729690.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-b839ed8f.js","assets/optimizedFeatureQueryEngineAdapter-4dc0036f.js","assets/centroid-f5daa837.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-b565a77e.js","assets/QueryEngineResult-2c28eebf.js","assets/WhereClause-f6ddfb88.js","assets/executionError-fb3f283a.js","assets/utils-ebf21391.js","assets/generateRendererUtils-bf5214e6.js","assets/projectionSupport-d70ac199.js","assets/json-48e3ea08.js","assets/utils-61f08010.js","assets/QueryEngineCapabilities-42e44ded.js","assets/timeSupport-d6519503.js","assets/FeatureStore-42c9ec6f.js","assets/heatmapTextureUtils-fcd30222.js","assets/projectExtentUtils-4e8d4f69.js","assets/LayerView3D-da1b015a.js","assets/EventedSet-9dd36680.js","assets/FeatureLayerView-c926a694.js","assets/popupUtils-d91ea519.js","assets/LayerView-1b945bf7.js","assets/RefreshableLayerView-23b69a26.js"]),dimension:()=>Q(()=>import("./DimensionLayerView3D-bdf0723b.js"),["assets/DimensionLayerView3D-bdf0723b.js","assets/LayerView3D-da1b015a.js","assets/LayerView-1b945bf7.js"]),elevation:nye,feature:()=>Q(()=>import("./FeatureLayerView3D-b5c9eab9.js"),["assets/FeatureLayerView3D-b5c9eab9.js","assets/FeatureLayerViewBase3D-7f72c504.js","assets/FeatureLikeLayerView3D-117b6659.js","assets/dehydratedFeatureComparison-4f346faa.js","assets/queryForSymbologySnapping-b15e9074.js","assets/elevationInfoUtils-72729690.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-b839ed8f.js","assets/optimizedFeatureQueryEngineAdapter-4dc0036f.js","assets/centroid-f5daa837.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-b565a77e.js","assets/QueryEngineResult-2c28eebf.js","assets/WhereClause-f6ddfb88.js","assets/executionError-fb3f283a.js","assets/utils-ebf21391.js","assets/generateRendererUtils-bf5214e6.js","assets/projectionSupport-d70ac199.js","assets/json-48e3ea08.js","assets/utils-61f08010.js","assets/QueryEngineCapabilities-42e44ded.js","assets/timeSupport-d6519503.js","assets/FeatureStore-42c9ec6f.js","assets/heatmapTextureUtils-fcd30222.js","assets/projectExtentUtils-4e8d4f69.js","assets/LayerView3D-da1b015a.js","assets/EventedSet-9dd36680.js","assets/FeatureLayerView-c926a694.js","assets/popupUtils-d91ea519.js","assets/LayerView-1b945bf7.js","assets/RefreshableLayerView-23b69a26.js"]),geojson:()=>Q(()=>import("./GeoJSONLayerView3D-dbc35d19.js"),["assets/GeoJSONLayerView3D-dbc35d19.js","assets/FeatureLayerViewBase3D-7f72c504.js","assets/FeatureLikeLayerView3D-117b6659.js","assets/dehydratedFeatureComparison-4f346faa.js","assets/queryForSymbologySnapping-b15e9074.js","assets/elevationInfoUtils-72729690.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-b839ed8f.js","assets/optimizedFeatureQueryEngineAdapter-4dc0036f.js","assets/centroid-f5daa837.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-b565a77e.js","assets/QueryEngineResult-2c28eebf.js","assets/WhereClause-f6ddfb88.js","assets/executionError-fb3f283a.js","assets/utils-ebf21391.js","assets/generateRendererUtils-bf5214e6.js","assets/projectionSupport-d70ac199.js","assets/json-48e3ea08.js","assets/utils-61f08010.js","assets/QueryEngineCapabilities-42e44ded.js","assets/timeSupport-d6519503.js","assets/FeatureStore-42c9ec6f.js","assets/heatmapTextureUtils-fcd30222.js","assets/projectExtentUtils-4e8d4f69.js","assets/LayerView3D-da1b015a.js","assets/EventedSet-9dd36680.js","assets/FeatureLayerView-c926a694.js","assets/popupUtils-d91ea519.js","assets/LayerView-1b945bf7.js","assets/RefreshableLayerView-23b69a26.js"]),graphics:()=>Q(()=>import("./GraphicsLayerView3D-d8c0f1ba.js"),["assets/GraphicsLayerView3D-d8c0f1ba.js","assets/LayerView3D-da1b015a.js","assets/queryForSymbologySnapping-b15e9074.js","assets/elevationInfoUtils-72729690.js","assets/GraphicsProcessor-47f520cd.js","assets/Graphics3DObjectStates-b839ed8f.js","assets/optimizedFeatureQueryEngineAdapter-4dc0036f.js","assets/centroid-f5daa837.js","assets/projectExtentUtils-4e8d4f69.js","assets/LayerView-1b945bf7.js"]),group:()=>Q(()=>import("./GroupLayerView-e7f6bd66.js"),["assets/GroupLayerView-e7f6bd66.js","assets/LayerView-1b945bf7.js"]),imagery:()=>Q(()=>import("./ImageryLayerView3D-02aaeff0.js"),["assets/ImageryLayerView3D-02aaeff0.js","assets/DynamicLayerView3D-50a8ce9e.js","assets/LayerView3D-da1b015a.js","assets/projectExtentUtils-4e8d4f69.js","assets/ImageMaterial-97418884.js","assets/LayerView-1b945bf7.js","assets/RefreshableLayerView-23b69a26.js","assets/ImageryLayerView-79203e72.js","assets/popupUtils-d91ea519.js"]),"integrated-mesh":()=>Q(()=>import("./IntegratedMeshLayerView3D-1eae1312.js"),["assets/IntegratedMeshLayerView3D-1eae1312.js","assets/I3SMeshView3D-b696b4dc.js","assets/I3SOverrides-432c03fa.js","assets/I3SNode-ce0e22bc.js","assets/I3SUtil-d5aff221.js","assets/I3SBinaryReader-525534dc.js","assets/RenderTexture-76842063.js","assets/FeatureLayerView3D-b5c9eab9.js","assets/FeatureLayerViewBase3D-7f72c504.js","assets/FeatureLikeLayerView3D-117b6659.js","assets/dehydratedFeatureComparison-4f346faa.js","assets/queryForSymbologySnapping-b15e9074.js","assets/elevationInfoUtils-72729690.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-b839ed8f.js","assets/optimizedFeatureQueryEngineAdapter-4dc0036f.js","assets/centroid-f5daa837.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-b565a77e.js","assets/QueryEngineResult-2c28eebf.js","assets/WhereClause-f6ddfb88.js","assets/executionError-fb3f283a.js","assets/utils-ebf21391.js","assets/generateRendererUtils-bf5214e6.js","assets/projectionSupport-d70ac199.js","assets/json-48e3ea08.js","assets/utils-61f08010.js","assets/QueryEngineCapabilities-42e44ded.js","assets/timeSupport-d6519503.js","assets/FeatureStore-42c9ec6f.js","assets/heatmapTextureUtils-fcd30222.js","assets/projectExtentUtils-4e8d4f69.js","assets/LayerView3D-da1b015a.js","assets/EventedSet-9dd36680.js","assets/FeatureLayerView-c926a694.js","assets/popupUtils-d91ea519.js","assets/LayerView-1b945bf7.js","assets/RefreshableLayerView-23b69a26.js","assets/SceneModification-93e668c8.js","assets/persistable-4ddc218c.js","assets/SceneLayerWorker-bd417782.js"]),"line-of-sight":()=>Q(()=>import("./LineOfSightLayerView3D-43d79747.js"),["assets/LineOfSightLayerView3D-43d79747.js","assets/LayerView3D-da1b015a.js","assets/LayerView-1b945bf7.js"]),"map-image":()=>Q(()=>import("./MapImageLayerView3D-a0165a65.js"),["assets/MapImageLayerView3D-a0165a65.js","assets/DynamicLayerView3D-50a8ce9e.js","assets/LayerView3D-da1b015a.js","assets/projectExtentUtils-4e8d4f69.js","assets/ImageMaterial-97418884.js","assets/LayerView-1b945bf7.js","assets/RefreshableLayerView-23b69a26.js","assets/MapImageLayerView-b81db94f.js","assets/ExportImageParameters-4ae8b8e3.js","assets/floorFilterUtils-080a7cd2.js","assets/sublayerUtils-a72692c8.js","assets/MapServiceLayerViewHelper-785c535e.js","assets/popupUtils-d91ea519.js","assets/drapedUtils-39abcefe.js"]),media:()=>Q(()=>import("./MediaLayerView3D-5f0f7c6e.js"),["assets/MediaLayerView3D-5f0f7c6e.js","assets/LayerView3D-da1b015a.js","assets/ImageMaterial-97418884.js","assets/LayerView-1b945bf7.js"]),"ogc-feature":()=>Q(()=>import("./OGCFeatureLayerView3D-a383b6a8.js"),["assets/OGCFeatureLayerView3D-a383b6a8.js","assets/FeatureLayerViewBase3D-7f72c504.js","assets/FeatureLikeLayerView3D-117b6659.js","assets/dehydratedFeatureComparison-4f346faa.js","assets/queryForSymbologySnapping-b15e9074.js","assets/elevationInfoUtils-72729690.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-b839ed8f.js","assets/optimizedFeatureQueryEngineAdapter-4dc0036f.js","assets/centroid-f5daa837.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-b565a77e.js","assets/QueryEngineResult-2c28eebf.js","assets/WhereClause-f6ddfb88.js","assets/executionError-fb3f283a.js","assets/utils-ebf21391.js","assets/generateRendererUtils-bf5214e6.js","assets/projectionSupport-d70ac199.js","assets/json-48e3ea08.js","assets/utils-61f08010.js","assets/QueryEngineCapabilities-42e44ded.js","assets/timeSupport-d6519503.js","assets/FeatureStore-42c9ec6f.js","assets/heatmapTextureUtils-fcd30222.js","assets/projectExtentUtils-4e8d4f69.js","assets/LayerView3D-da1b015a.js","assets/EventedSet-9dd36680.js","assets/FeatureLayerView-c926a694.js","assets/popupUtils-d91ea519.js","assets/LayerView-1b945bf7.js","assets/RefreshableLayerView-23b69a26.js","assets/OGCFeatureLayerView-67cb867e.js"]),"open-street-map":OM,"oriented-imagery":()=>Q(()=>import("./FeatureLayerView3D-b5c9eab9.js"),["assets/FeatureLayerView3D-b5c9eab9.js","assets/FeatureLayerViewBase3D-7f72c504.js","assets/FeatureLikeLayerView3D-117b6659.js","assets/dehydratedFeatureComparison-4f346faa.js","assets/queryForSymbologySnapping-b15e9074.js","assets/elevationInfoUtils-72729690.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-b839ed8f.js","assets/optimizedFeatureQueryEngineAdapter-4dc0036f.js","assets/centroid-f5daa837.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-b565a77e.js","assets/QueryEngineResult-2c28eebf.js","assets/WhereClause-f6ddfb88.js","assets/executionError-fb3f283a.js","assets/utils-ebf21391.js","assets/generateRendererUtils-bf5214e6.js","assets/projectionSupport-d70ac199.js","assets/json-48e3ea08.js","assets/utils-61f08010.js","assets/QueryEngineCapabilities-42e44ded.js","assets/timeSupport-d6519503.js","assets/FeatureStore-42c9ec6f.js","assets/heatmapTextureUtils-fcd30222.js","assets/projectExtentUtils-4e8d4f69.js","assets/LayerView3D-da1b015a.js","assets/EventedSet-9dd36680.js","assets/FeatureLayerView-c926a694.js","assets/popupUtils-d91ea519.js","assets/LayerView-1b945bf7.js","assets/RefreshableLayerView-23b69a26.js"]),"point-cloud":()=>Q(()=>import("./PointCloudLayerView3D-95a53583.js").then(t=>t.P),["assets/PointCloudLayerView3D-95a53583.js","assets/LayerView3D-da1b015a.js","assets/I3SUtil-d5aff221.js","assets/I3SBinaryReader-525534dc.js","assets/PointCloudWorkerUtil-d62d0e0a.js","assets/PointCloudUniqueValueRenderer-17a1fdde.js","assets/PopupSceneLayerView-d924d5b3.js","assets/popupUtils-d91ea519.js","assets/LayerView-1b945bf7.js"]),voxel:()=>Q(()=>import("./VoxelLayerView3D-4a61e823.js"),["assets/VoxelLayerView3D-4a61e823.js","assets/LayerView3D-da1b015a.js","assets/PopupSceneLayerView-d924d5b3.js","assets/popupUtils-d91ea519.js","assets/LayerView-1b945bf7.js"]),route:()=>Q(()=>import("./RouteLayerView3D-34604e79.js"),["assets/RouteLayerView3D-34604e79.js","assets/Stop-1a1fc92e.js","assets/LayerView3D-da1b015a.js","assets/GraphicsProcessor-47f520cd.js","assets/Graphics3DObjectStates-b839ed8f.js","assets/optimizedFeatureQueryEngineAdapter-4dc0036f.js","assets/centroid-f5daa837.js","assets/projectExtentUtils-4e8d4f69.js","assets/EventedSet-9dd36680.js","assets/LayerView-1b945bf7.js"]),scene:t=>t.profile==null||t.profile==="mesh-pyramids"?Q(()=>import("./SceneLayerView3D-3bf040f7.js"),["assets/SceneLayerView3D-3bf040f7.js","assets/WhereClause-f6ddfb88.js","assets/executionError-fb3f283a.js","assets/floorFilterUtils-080a7cd2.js","assets/I3SMeshView3D-b696b4dc.js","assets/I3SOverrides-432c03fa.js","assets/I3SNode-ce0e22bc.js","assets/I3SUtil-d5aff221.js","assets/I3SBinaryReader-525534dc.js","assets/RenderTexture-76842063.js","assets/FeatureLayerView3D-b5c9eab9.js","assets/FeatureLayerViewBase3D-7f72c504.js","assets/FeatureLikeLayerView3D-117b6659.js","assets/dehydratedFeatureComparison-4f346faa.js","assets/queryForSymbologySnapping-b15e9074.js","assets/elevationInfoUtils-72729690.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-b839ed8f.js","assets/optimizedFeatureQueryEngineAdapter-4dc0036f.js","assets/centroid-f5daa837.js","assets/QueryEngine-b565a77e.js","assets/QueryEngineResult-2c28eebf.js","assets/utils-ebf21391.js","assets/generateRendererUtils-bf5214e6.js","assets/projectionSupport-d70ac199.js","assets/json-48e3ea08.js","assets/utils-61f08010.js","assets/QueryEngineCapabilities-42e44ded.js","assets/timeSupport-d6519503.js","assets/FeatureStore-42c9ec6f.js","assets/heatmapTextureUtils-fcd30222.js","assets/projectExtentUtils-4e8d4f69.js","assets/LayerView3D-da1b015a.js","assets/EventedSet-9dd36680.js","assets/FeatureLayerView-c926a694.js","assets/popupUtils-d91ea519.js","assets/LayerView-1b945bf7.js","assets/RefreshableLayerView-23b69a26.js","assets/SceneModification-93e668c8.js","assets/persistable-4ddc218c.js","assets/SceneLayerWorker-bd417782.js","assets/SceneLayerView-d6d908d6.js","assets/DefinitionExpressionSceneLayerView-2ee08ba8.js","assets/I3SQueryFeatureStore-de063927.js","assets/PopupSceneLayerView-d924d5b3.js"]):Q(()=>import("./SceneLayerGraphicsView3D-0d904f9f.js"),["assets/SceneLayerGraphicsView3D-0d904f9f.js","assets/I3SOverrides-432c03fa.js","assets/I3SNode-ce0e22bc.js","assets/I3SUtil-d5aff221.js","assets/I3SBinaryReader-525534dc.js","assets/RenderTexture-76842063.js","assets/FeatureLayerView3D-b5c9eab9.js","assets/FeatureLayerViewBase3D-7f72c504.js","assets/FeatureLikeLayerView3D-117b6659.js","assets/dehydratedFeatureComparison-4f346faa.js","assets/queryForSymbologySnapping-b15e9074.js","assets/elevationInfoUtils-72729690.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-b839ed8f.js","assets/optimizedFeatureQueryEngineAdapter-4dc0036f.js","assets/centroid-f5daa837.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-b565a77e.js","assets/QueryEngineResult-2c28eebf.js","assets/WhereClause-f6ddfb88.js","assets/executionError-fb3f283a.js","assets/utils-ebf21391.js","assets/generateRendererUtils-bf5214e6.js","assets/projectionSupport-d70ac199.js","assets/json-48e3ea08.js","assets/utils-61f08010.js","assets/QueryEngineCapabilities-42e44ded.js","assets/timeSupport-d6519503.js","assets/FeatureStore-42c9ec6f.js","assets/heatmapTextureUtils-fcd30222.js","assets/projectExtentUtils-4e8d4f69.js","assets/LayerView3D-da1b015a.js","assets/EventedSet-9dd36680.js","assets/FeatureLayerView-c926a694.js","assets/popupUtils-d91ea519.js","assets/LayerView-1b945bf7.js","assets/RefreshableLayerView-23b69a26.js","assets/SceneLayerView-d6d908d6.js","assets/DefinitionExpressionSceneLayerView-2ee08ba8.js","assets/PopupSceneLayerView-d924d5b3.js"]),stream:()=>Q(()=>import("./StreamLayerView3D-f40f4e73.js"),["assets/StreamLayerView3D-f40f4e73.js","assets/StreamFeatureManager-dbbd1c4d.js","assets/CircularArray-f03cccc5.js","assets/createConnection-4bc173a6.js","assets/EventedSet-9dd36680.js","assets/FeatureLikeLayerView3D-117b6659.js","assets/dehydratedFeatureComparison-4f346faa.js","assets/queryForSymbologySnapping-b15e9074.js","assets/elevationInfoUtils-72729690.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-b839ed8f.js","assets/optimizedFeatureQueryEngineAdapter-4dc0036f.js","assets/centroid-f5daa837.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-b565a77e.js","assets/QueryEngineResult-2c28eebf.js","assets/WhereClause-f6ddfb88.js","assets/executionError-fb3f283a.js","assets/utils-ebf21391.js","assets/generateRendererUtils-bf5214e6.js","assets/projectionSupport-d70ac199.js","assets/json-48e3ea08.js","assets/utils-61f08010.js","assets/QueryEngineCapabilities-42e44ded.js","assets/timeSupport-d6519503.js","assets/FeatureStore-42c9ec6f.js","assets/heatmapTextureUtils-fcd30222.js","assets/projectExtentUtils-4e8d4f69.js","assets/LayerView3D-da1b015a.js","assets/LayerView-1b945bf7.js"]),tile:OM,"imagery-tile":()=>Q(()=>import("./ImageryTileLayerView3D-d3692648.js"),["assets/ImageryTileLayerView3D-d3692648.js","assets/LayerView3D-da1b015a.js","assets/TiledLayerView3D-a1037f80.js","assets/ImageryTileLayerView-792902bc.js","assets/rasterProjectionHelper-a7c6d8c6.js","assets/popupUtils-d91ea519.js","assets/LayerView-1b945bf7.js","assets/RefreshableLayerView-23b69a26.js","assets/drapedUtils-39abcefe.js"]),"vector-tile":()=>Q(()=>import("./VectorTileLayerView3D-10cfe6bd.js"),["assets/VectorTileLayerView3D-10cfe6bd.js","assets/TileInfoViewPOT-a79f521b.js","assets/Rect-ea14f53a.js","assets/rasterizingUtils-4ed124bb.js","assets/StyleDefinition-7d58136b.js","assets/enums-4b2a86a0.js","assets/WGLBrushVTLSymbol-3a605920.js","assets/definitions-3ddd14a8.js","assets/enums-b1d611e3.js","assets/number-b10bd8f5.js","assets/GeometryUtils-dd03fc25.js","assets/VTLMaterialManager-92c4316f.js","assets/ShaderCompiler-77d0dcb6.js","assets/programUtils-f035fe8a.js","assets/StyleRepository-f0609e85.js","assets/colorUtils-c0f43caf.js","assets/GeometryUtils-53652037.js","assets/LayerView3D-da1b015a.js","assets/TiledLayerView3D-a1037f80.js","assets/LayerView-1b945bf7.js"]),wcs:()=>Q(()=>import("./ImageryTileLayerView3D-d3692648.js"),["assets/ImageryTileLayerView3D-d3692648.js","assets/LayerView3D-da1b015a.js","assets/TiledLayerView3D-a1037f80.js","assets/ImageryTileLayerView-792902bc.js","assets/rasterProjectionHelper-a7c6d8c6.js","assets/popupUtils-d91ea519.js","assets/LayerView-1b945bf7.js","assets/RefreshableLayerView-23b69a26.js","assets/drapedUtils-39abcefe.js"]),"web-tile":OM,wfs:()=>Q(()=>import("./WFSLayerView3D-e40187a9.js"),["assets/WFSLayerView3D-e40187a9.js","assets/FeatureLayerViewBase3D-7f72c504.js","assets/FeatureLikeLayerView3D-117b6659.js","assets/dehydratedFeatureComparison-4f346faa.js","assets/queryForSymbologySnapping-b15e9074.js","assets/elevationInfoUtils-72729690.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-b839ed8f.js","assets/optimizedFeatureQueryEngineAdapter-4dc0036f.js","assets/centroid-f5daa837.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-b565a77e.js","assets/QueryEngineResult-2c28eebf.js","assets/WhereClause-f6ddfb88.js","assets/executionError-fb3f283a.js","assets/utils-ebf21391.js","assets/generateRendererUtils-bf5214e6.js","assets/projectionSupport-d70ac199.js","assets/json-48e3ea08.js","assets/utils-61f08010.js","assets/QueryEngineCapabilities-42e44ded.js","assets/timeSupport-d6519503.js","assets/FeatureStore-42c9ec6f.js","assets/heatmapTextureUtils-fcd30222.js","assets/projectExtentUtils-4e8d4f69.js","assets/LayerView3D-da1b015a.js","assets/EventedSet-9dd36680.js","assets/FeatureLayerView-c926a694.js","assets/popupUtils-d91ea519.js","assets/LayerView-1b945bf7.js","assets/RefreshableLayerView-23b69a26.js"]),wms:()=>Q(()=>import("./WMSLayerView3D-4c5fd9be.js"),["assets/WMSLayerView3D-4c5fd9be.js","assets/DynamicLayerView3D-50a8ce9e.js","assets/LayerView3D-da1b015a.js","assets/projectExtentUtils-4e8d4f69.js","assets/ImageMaterial-97418884.js","assets/LayerView-1b945bf7.js","assets/RefreshableLayerView-23b69a26.js","assets/WMSLayerView-7ddfaa94.js","assets/ExportWMSImageParameters-2508fffe.js"]),wmts:()=>Q(()=>import("./WMTSLayerView3D-e5b494cd.js"),["assets/WMTSLayerView3D-e5b494cd.js","assets/LayerView3D-da1b015a.js","assets/TiledLayerView3D-a1037f80.js","assets/LayerView-1b945bf7.js","assets/RefreshableLayerView-23b69a26.js"]),"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null};function s0t(t){const e=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",r=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new H(`${r}:view-not-supported`,`${e} is not supported in 3D`)}const oye={hasLayerViewModule:t=>v(sye[t.type]),importLayerView:t=>{const e=sye[t.type];if(R(e))throw s0t(t);return e(t)}},aye="analyses-owner-handles";var tR,JT;(function(t){t[t.PENDING=0]="PENDING",t[t.CREATED=1]="CREATED"})(tR||(tR={})),function(t){t[t.ADDED=0]="ADDED",t[t.REMOVED=1]="REMOVED"}(JT||(JT={}));let xT=class extends eD{constructor(e){super(e),this._allAnalysisViews=new ct,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=lye(),this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(Vr("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(Vr()),this._attachedToViewResolver=lye()}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const r=this._items.get(e);if(R(r)||r.state.list===JT.REMOVED)throw new H("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return r.createAnalysisViewTask.promise}_connectOwners(){this.handles.add(this._connectAnalysesCollection(this.view.analyses),aye)}_disconnectOwners(){this.handles.remove(aye),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const n of e)this._addAnalysis(n);const r=e.on("after-add",n=>this._addAnalysis(n.item)),i=e.on("after-remove",n=>this._removeAnalysis(n.item));return{remove:()=>{r.remove(),i.remove();for(const n of e)this._removeAnalysis(n)}}}_addAnalysis(e){const r=this._items.get(e);if(r==null){const i={state:{view:tR.PENDING,list:JT.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,i),i.createAnalysisViewTask=EN(n=>this._createAnalysisViewPromise(i,n))}else r.state.list=JT.ADDED}_removeAnalysis(e){const r=this._items.get(e);r!=null?(r.state.list=JT.REMOVED,this._scheduleUpdate()):re.getLogger(this.declaredClass).error("Trying to remove analysis which was not added")}_scheduleUpdate(){v(this._scheduledUpdateHandle)||(this._scheduledUpdateHandle=L2(()=>this._update()))}_update(){this._scheduledUpdateHandle=$i(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===JT.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case tR.PENDING:e.createAnalysisViewTask=Tp(e.createAnalysisViewTask);break;case tR.CREATED:v(e.view)&&(this._allAnalysisViews.remove(e.view),e.view=ze(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,r){const i=e.analysis,n=i.type,s=this._analysisModules[n];if(this._creatingViewCount+=1,R(s.module))try{s.module=await this._loadAnalysisModule(n)}catch(a){throw this._creatingViewCount-=1,a}if(uo(r))throw this._creatingViewCount-=1,Vr("AnalysisView creation aborted");const o=new s.module.default({analysis:i,view:this.view});try{await o.when()}catch(a){throw this._creatingViewCount-=1,a}if(uo(r))throw this._creatingViewCount-=1,o.destroy(),Vr("AnalysisView creation aborted");return e.view=o,e.state.view=tR.CREATED,this._allAnalysisViews.add(o),this._creatingViewCount-=1,o}_loadAnalysisModule(e){switch(e){case"area-measurement":return Q(()=>import("./AreaMeasurementAnalysisView3D-6e14bd95.js").then(r=>r.A),["assets/AreaMeasurementAnalysisView3D-6e14bd95.js","assets/analysisThemeUtils-57fc660f.js","assets/Segment-07c7d5fd.js","assets/LineVisualElement-eb1212d1.js","assets/elevationInfoUtils-72729690.js","assets/geometryEngine-01d2a8db.js","assets/geometryEngineBase-e1a33b0a.js","assets/hydrated-e133b6f4.js","assets/EditGeometryOperations-09a46b09.js"]);case"dimension":return Q(()=>import("./DimensionAnalysisView3D-75d90b60.js").then(r=>r.D),["assets/DimensionAnalysisView3D-75d90b60.js","assets/LineVisualElement-eb1212d1.js","assets/LengthDimension-b57c4171.js","assets/Segment-07c7d5fd.js","assets/elevationInfoUtils-72729690.js","assets/analysisViewUtils-5cccbc1a.js","assets/ImageMaterial-97418884.js","assets/Factory-42e09b62.js","assets/RightAngleQuadVisualElement-25f1aa0a.js","assets/VisualElementResources-2a16a5db.js","assets/PointVisualElement-82e2261f.js","assets/colorUtils-c0f43caf.js","assets/EditGeometryOperations-09a46b09.js","assets/QueryEngineResult-2c28eebf.js","assets/WhereClause-f6ddfb88.js","assets/executionError-fb3f283a.js","assets/utils-ebf21391.js","assets/generateRendererUtils-bf5214e6.js","assets/projectionSupport-d70ac199.js","assets/json-48e3ea08.js","assets/utils-61f08010.js","assets/dehydratedFeatureComparison-4f346faa.js","assets/RenderTexture-76842063.js"]);case"direct-line-measurement":return Q(()=>import("./DirectLineMeasurementAnalysisView3D-81b11a08.js").then(r=>r.D),["assets/DirectLineMeasurementAnalysisView3D-81b11a08.js","assets/analysisThemeUtils-57fc660f.js","assets/Segment-07c7d5fd.js","assets/LineVisualElement-eb1212d1.js","assets/elevationInfoUtils-72729690.js","assets/geometryEngine-01d2a8db.js","assets/geometryEngineBase-e1a33b0a.js","assets/hydrated-e133b6f4.js","assets/RightAngleQuadVisualElement-25f1aa0a.js","assets/VisualElementResources-2a16a5db.js"]);case"line-of-sight":return Q(()=>import("./LineOfSightAnalysisView3D-f033aac4.js"),["assets/LineOfSightAnalysisView3D-f033aac4.js","assets/LineVisualElement-eb1212d1.js","assets/LineOfSightAnalysisTarget-7bed3141.js","assets/persistable-4ddc218c.js","assets/elevationInfoUtils-72729690.js","assets/analysisViewUtils-5cccbc1a.js","assets/ImageMaterial-97418884.js","assets/PointVisualElement-82e2261f.js","assets/VisualElementResources-2a16a5db.js"]);case"slice":return Q(()=>import("./SliceAnalysisView3D-fd6ec751.js").then(r=>r.S),["assets/SliceAnalysisView3D-fd6ec751.js","assets/LineVisualElement-eb1212d1.js","assets/persistable-4ddc218c.js","assets/BuildingComponentSublayer-7e900898.js","assets/capabilities-a18453f6.js","assets/I3SIndexInfo-ec60d475.js","assets/I3SLayerDefinitions-979f223e.js","assets/I3SUtil-d5aff221.js","assets/I3SBinaryReader-525534dc.js","assets/popupUtils-d91ea519.js","assets/analysisViewUtils-5cccbc1a.js","assets/ImageMaterial-97418884.js","assets/Factory-42e09b62.js"])}}};function lye(){const t=qb();return t.promise.catch(()=>{}),t}u([d()],xT.prototype,"updating",null),u([d({constructOnly:!0})],xT.prototype,"view",void 0),u([d()],xT.prototype,"_allAnalysisViews",void 0),u([d()],xT.prototype,"_creatingViewCount",void 0),xT=u([$("esri.views.3d.analysis.AnalysisViewManager3D")],xT);const o0t=xT;let g0=class extends be{constructor(e){super(e),this.collision=new TI,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===qe.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==qe.Local?this._set("altitude",e):re.getLogger(this.declaredClass).warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?_e(e,this.altitude.min,this.altitude.max):e}clampTilt(e,r){if(!this.tilt)return r;const i=this.tilt(e);return _e(r,i.min,i.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===qe.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(r,i=PH)=>(i.min=Ma.min,i.max=e,i)}_createDefaultTiltLocal(){const e=this.collision.enabled?bU([[4e3,Ma.max],[1e4,Xt(88)],[6e6,Xt(88)]]):()=>Ma.max;return(r,i=PH)=>(i.min=Ma.min,i.max=e(r),i)}_createDefaultTiltGlobal(){const e=this.collision.enabled?bU([[4e3,Ma.max],[5e4,Xt(88)],[6e6,Xt(88)],[2e7,Ma.min]]):bU([[3e5,Ma.max],[3e6,Xt(88)],[6e6,Xt(88)],[2e7,Ma.min]]);return(r,i=PH)=>(i.min=Ma.min,i.max=e(r),i)}};function a0t(t){return{min:-2e5,max:4*t.radius}}u([d()],g0.prototype,"altitude",null),u([d({readOnly:!0})],g0.prototype,"collision",void 0),u([d()],g0.prototype,"distance",void 0),u([d({readOnly:!0})],g0.prototype,"minimumPoiDistance",void 0),u([d()],g0.prototype,"tilt",void 0),u([d({constructOnly:!0})],g0.prototype,"mode",void 0),g0=u([$("esri.views.3d.state.Constraints")],g0);const cye=a0t(Cr),Ma={min:Xt(.5),max:Xt(179.5)},PH={min:0,max:0};let TI=class extends be{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};u([d({type:Boolean})],TI.prototype,"enabled",void 0),u([d({type:Number})],TI.prototype,"elevationMargin",void 0),TI=u([$("esri.views.3d.state.Constraints.CollisionConstraint")],TI);let rR=class extends be{constructor(){super(...arguments),this.min=cye.min,this.max=cye.max}};u([d({type:Number})],rR.prototype,"min",void 0),u([d({type:Number})],rR.prototype,"max",void 0),rR=u([$("esri.views.3d.constraints.AltitudeConstraint")],rR);let A0=class extends be{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,r){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==r&&this._set("far",r))}};u([d({type:Number,value:1e-8})],A0.prototype,"near",null),u([cr("near")],A0.prototype,"castNear",null),u([d({type:Number,value:1e-8})],A0.prototype,"far",null),u([cr("far")],A0.prototype,"castFar",null),u([d({type:["auto","manual"]})],A0.prototype,"mode",void 0),A0=u([$("esri.views.3d.constraints.ClipDistanceConstraint")],A0);const VQ={min:dl(Ma.min),max:dl(Ma.max)};let KT=class extends be{constructor(){super(...arguments),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return _e(e,VQ.min,VQ.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};u([d({type:["auto","manual"]})],KT.prototype,"mode",void 0),u([d({type:Number,value:VQ.max})],KT.prototype,"max",null),u([cr("max")],KT.prototype,"castMax",null),KT=u([$("esri.views.3d.constraints.TiltConstraint")],KT);let QT=class extends be{constructor(){super(...arguments),this.tilt=new KT,this.altitude=new rR,this.clipDistance=new A0}};u([d({type:KT})],QT.prototype,"tilt",void 0),u([d({type:rR})],QT.prototype,"altitude",void 0),u([d({type:A0})],QT.prototype,"clipDistance",void 0),QT=u([$("esri.views.3d.constraints.Constraints")],QT);var BQ;let Ld=BQ=class extends fe{constructor(t){super(t),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(t,e){return e.datetime!=null&&new Date(e.datetime)||null}writeDate(t,e,r){e[r]=t.getTime()}readDirectShadowsEnabled(t,e){return!!e.directShadows}writedirectShadowsEnabled(t,e,r){t&&(e[r]=t)}writeDisplayUTCOffset(t,e){t!=null&&(e.displayUTCOffset=t)}clone(){return new BQ(this.cloneConstructProperties())}cloneConstructProperties(){const t={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(t.date=new Date(this.date.getTime())),t}};u([d({readOnly:!0,type:["sun"],json:{write:!0}})],Ld.prototype,"type",void 0),u([d({type:Date,json:{type:Number,write:{target:"datetime"}}})],Ld.prototype,"date",void 0),u([Me("date",["datetime"])],Ld.prototype,"readDate",null),u([De("date")],Ld.prototype,"writeDate",null),u([d({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],Ld.prototype,"directShadowsEnabled",void 0),u([Me("directShadowsEnabled",["directShadows"])],Ld.prototype,"readDirectShadowsEnabled",null),u([De("directShadowsEnabled")],Ld.prototype,"writedirectShadowsEnabled",null),u([d({type:Number,json:{write:!0}})],Ld.prototype,"displayUTCOffset",void 0),u([De("displayUTCOffset")],Ld.prototype,"writeDisplayUTCOffset",null),Ld=BQ=u([$("esri.webscene.SunLighting")],Ld);const fD=Ld;var iA;let cg=iA=class extends Sn.EventedMixin(fD){constructor(t){super(t),this.cameraTrackingEnabled=!0,this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const e=new Date().getFullYear(),r=new Date("March 15, "+e+" 12:00:00 UTC");this._set("defaultDate",r),this._set("date",r)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(t){return new iA(t.cloneConstructProperties())}set defaultDate(t){const e=this._get("date")===this._get("defaultDate");t=new Date(t.getTime()),this._set("defaultDate",t),e&&this._set("date",t)}set date(t){t!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(t.getTime())))}autoUpdate(t,e){const r=iA.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=e.hours,this.positionTimezoneInfo.minutes=e.minutes,this.positionTimezoneInfo.seconds=e.seconds;let i=null;v(t)&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(t.getTime())?(i=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(i=this.date&&this.date.getTime(),this._set("date",new Date(t.getTime()))));const n=iA.calculateTimezoneOffset(this.positionTimezoneInfo);if(r!==n&&(IH.target=this,IH.timezoneOffset=n,this.emit("timezone-will-change",IH)),v(t))return!!isNaN(t.getTime())||i!==t.getTime()}clone(){const t=this._get("date")===this._get("defaultDate"),e=new iA({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled});return t&&e._set("date",e._get("defaultDate")),e.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,e.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,e.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,e.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,e}cloneWithWebsceneLighting(t){const e=this.clone();return t.date!=null&&(e.date=t.date),e.directShadowsEnabled=t.directShadowsEnabled,e.displayUTCOffset=t.displayUTCOffset,e}cloneNonPersistentConstructProperties(){return{ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled,cameraTrackingEnabled:this.cameraTrackingEnabled}}};u([d({type:Boolean})],cg.prototype,"cameraTrackingEnabled",void 0),u([d({type:Boolean})],cg.prototype,"ambientOcclusionEnabled",void 0),u([d({type:Boolean})],cg.prototype,"waterReflectionEnabled",void 0),u([d({type:Date})],cg.prototype,"defaultDate",null),u([d({type:Date})],cg.prototype,"date",null),cg=iA=u([$("esri.views.3d.environment.SunLighting")],cg),function(t){function e({hours:r,minutes:i,seconds:n}){return Math.round(r+i/60+n/3600)}t.calculateTimezoneOffset=e}(cg||(cg={}));const IH={target:null,timezoneOffset:0},x1=cg;var jQ;let SI=jQ=class extends fe{constructor(t){super(t),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new jQ(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};u([d({readOnly:!0,type:["virtual"],json:{write:!0}})],SI.prototype,"type",void 0),u([d({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],SI.prototype,"directShadowsEnabled",void 0),SI=jQ=u([$("esri.webscene.VirtualLighting")],SI);const jB=SI;var wU;let nA=wU=class extends Sn.EventedMixin(jB){constructor(t){super(t),this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1,this.cameraTrackingEnabled=!0}clone(){return new wU({...this.cloneConstructProperties(),ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled,cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(t){return new wU(t.cloneConstructProperties())}cloneWithWebsceneLighting(t){const e=this.clone();return e.directShadowsEnabled=t.directShadowsEnabled,e}cloneNonPersistentConstructProperties(){return{ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled,cameraTrackingEnabled:this.cameraTrackingEnabled}}};u([d({type:Boolean})],nA.prototype,"ambientOcclusionEnabled",void 0),u([d({type:Boolean})],nA.prototype,"waterReflectionEnabled",void 0),u([d({type:Boolean})],nA.prototype,"cameraTrackingEnabled",void 0),nA=wU=u([$("esri.views.3d.environment.VirtualLighting")],nA);const EI=nA,l0t={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:x1,virtual:EI}};var GQ;let B$=GQ=class extends be{set quality(t){["low","high"].includes(t)&&this._set("quality",t)}clone(){return new GQ({quality:this.quality})}};u([d({type:["low","high"],value:"low"})],B$.prototype,"quality",null),B$=GQ=u([$("esri.views.3d.environment.SceneViewAtmosphere")],B$);var HQ;let CI=HQ=class extends fe{constructor(t){super(t),this.type="sunny",this.cloudCover=.5}clone(){return new HQ({cloudCover:this.cloudCover})}};u([st({sunny:"sunny"})],CI.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],CI.prototype,"cloudCover",void 0),CI=HQ=u([$("esri.views.3d.environment.SunnyWeather")],CI);const qQ=CI;var WQ;let AI=WQ=class extends fe{constructor(t){super(t),this.type="cloudy",this.cloudCover=.5}clone(){return new WQ({cloudCover:this.cloudCover})}};u([st({cloudy:"cloudy"})],AI.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],AI.prototype,"cloudCover",void 0),AI=WQ=u([$("esri.views.3d.environment.CloudyWeather")],AI);const c0t=AI;var XQ;let RI=XQ=class extends fe{constructor(t){super(t),this.type="foggy",this.fogStrength=.5}clone(){return new XQ({fogStrength:this.fogStrength})}};u([st({foggy:"foggy"})],RI.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],RI.prototype,"fogStrength",void 0),RI=XQ=u([$("esri.views.3d.environment.FoggyWeather")],RI);const u0t=RI;var YQ;let sA=YQ=class extends fe{constructor(t){super(t),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new YQ({cloudCover:this.cloudCover,precipitation:this.precipitation})}};u([st({rainy:"rainy"})],sA.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],sA.prototype,"cloudCover",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],sA.prototype,"precipitation",void 0),sA=YQ=u([$("esri.views.3d.environment.RainyWeather")],sA);const h0t=sA;var ZQ;let TT=ZQ=class extends fe{constructor(t){super(t),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new ZQ({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};u([st({snowy:"snowy"})],TT.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],TT.prototype,"cloudCover",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],TT.prototype,"precipitation",void 0),u([d({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],TT.prototype,"snowCover",void 0),TT=ZQ=u([$("esri.views.3d.environment.SnowyWeather")],TT);const d0t=TT,eDe={key:"type",base:qQ,typeMap:{sunny:qQ,cloudy:c0t,rainy:h0t,snowy:d0t,foggy:u0t}},p0t=Object.keys(eDe.typeMap);function f0t(t,e){return!!p0t.includes(t)||(e.error(`"${t}" is not a valid weather type`),!1)}const Wd=1e4,m0t={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:fD,virtual:jB}};let xU=class extends fe{constructor(e){super(e)}clone(){}};u([d({readOnly:!0,json:{read:!1}})],xU.prototype,"type",void 0),xU=u([$("esri.webscene.background.Background")],xU);const tDe=xU;var JQ;const g0t={...D_,nonNullable:!0};let OI=JQ=class extends tDe{constructor(t){super(t),this.type="color",this.color=new Xe([0,0,0,1])}clone(){return new JQ(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};u([st({color:"color"},{readOnly:!0})],OI.prototype,"type",void 0),u([d(g0t)],OI.prototype,"color",void 0),OI=JQ=u([$("esri.webscene.background.ColorBackground")],OI);const rDe=OI,uye={base:tDe,key:"type",typeMap:{color:rDe}};function y0t(t){return(e,r,i)=>{if(!e)return e;for(const n in t.typeMap)if(e.type===n){const s=new t.typeMap[n];return s.read(e,i),s}}}const _0t={types:uye,json:{read:y0t(uye),write:{overridePolicy:(t,e,r)=>({enabled:!r||!r.isPresentation})}}};var KQ;const iDe="esri.webscene.Environment",v0t=re.getLogger(iDe),hye=(t,e,r)=>({enabled:!r||!r.isPresentation});let T1=KQ=class extends fe{constructor(t){super(t),this.lighting=new fD,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(t){f0t(t==null?void 0:t.type,v0t)&&this._set("weather",t)}clone(){return new KQ(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?jB.prototype.clone.call(this.lighting):fD.prototype.clone.call(this.lighting),background:se(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};u([d({types:m0t,nonNullable:!0,json:{write:!0}})],T1.prototype,"lighting",void 0),u([d(_0t)],T1.prototype,"background",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:hye}}})],T1.prototype,"atmosphereEnabled",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:hye}}})],T1.prototype,"starsEnabled",void 0),u([d({types:eDe,nonNullable:!0,json:{write:!0},value:new qQ})],T1.prototype,"weather",null),T1=KQ=u([$(iDe)],T1);const nDe=T1;var MI;let oA=MI=class extends nDe{constructor(t){super(t),this.atmosphere=new B$,this.lighting=new x1,this.cachedCameraTrackingEnabled=null}static fromWebsceneEnvironment(t){const e=t.cloneConstructProperties();return new MI({...e,lighting:e.lighting?e.lighting.type==="virtual"?EI.fromWebsceneLighting(e.lighting):x1.fromWebsceneLighting(e.lighting):void 0})}castLighting(t){return this._convertLighting(t)}applyLighting(t){this.lighting=this._convertLighting(t)}_convertLighting(t){var e,r;return t?t instanceof x1||t instanceof EI?t:t instanceof fD?this.lighting&&this.lighting.type!=="virtual"?this.lighting.cloneWithWebsceneLighting(t):new x1({...t.cloneConstructProperties(),...(e=this.lighting)==null?void 0:e.cloneNonPersistentConstructProperties()}):t instanceof jB?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t):new EI({...t.cloneConstructProperties(),...(r=this.lighting)==null?void 0:r.cloneNonPersistentConstructProperties()}):om(l0t,t):new x1}clone(){return new MI({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:se(this.background)})}cloneWithWebsceneEnvironment(t){return new MI({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:se(this.background),...t.cloneConstructProperties(),lighting:this._getLighting(t)})}_getLighting(t){switch(t.lighting.type){case"sun":return this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(t.lighting):x1.fromWebsceneLighting(t.lighting);case"virtual":return this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t.lighting):EI.fromWebsceneLighting(t.lighting);default:return t.lighting,x1.fromWebsceneLighting(t.lighting)}}};u([d({type:B$,json:{read:!1},nonNullable:!0})],oA.prototype,"atmosphere",void 0),u([d({nonNullable:!0})],oA.prototype,"lighting",void 0),u([cr("lighting")],oA.prototype,"castLighting",null),oA=MI=u([$("esri.views.3d.environment.SceneViewEnvironment")],oA);const aA=oA;var ro;(function(t){t[t.Simple=0]="Simple",t[t.Realistic=1]="Realistic",t[t.Panoramic=2]="Panoramic",t[t.None=3]="None"})(ro||(ro={}));function Tae(t){return _e((t-1e5)/(1e6-1e5),0,1)}const QQ=1e4,b0t=.085,mD=1e5;let w0t=class{};const wi=w0t;function S(t,...e){let r="";for(let i=0;i<e.length;i++)r+=t[i]+e[i];return r+=t[t.length-1],r}(function(t){function e(i){return Math.round(i).toString()}function r(i){return i.toPrecision(8)}t.int=e,t.float=r})(S||(S={}));var O;(function(t){t.POSITION="position",t.NORMAL="normal",t.UV0="uv0",t.AUXPOS1="auxpos1",t.AUXPOS2="auxpos2",t.COLOR="color",t.SYMBOLCOLOR="symbolColor",t.SIZE="size",t.TANGENT="tangent",t.OFFSET="offset",t.SUBDIVISIONFACTOR="subdivisionFactor",t.COLORFEATUREATTRIBUTE="colorFeatureAttribute",t.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",t.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",t.DISTANCETOSTART="distanceToStart",t.UVMAPSPACE="uvMapSpace",t.BOUNDINGRECT="boundingRect",t.UVREGION="uvRegion",t.NORMALCOMPRESSED="normalCompressed",t.PROFILERIGHT="profileRight",t.PROFILEUP="profileUp",t.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",t.FEATUREVALUE="featureValue",t.MODELORIGINHI="modelOriginHi",t.MODELORIGINLO="modelOriginLo",t.MODEL="model",t.MODELNORMAL="modelNormal",t.INSTANCECOLOR="instanceColor",t.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",t.LOCALTRANSFORM="localTransform",t.GLOBALTRANSFORM="globalTransform",t.BOUNDINGSPHERE="boundingSphere",t.MODELORIGIN="modelOrigin",t.MODELSCALEFACTORS="modelScaleFactors",t.FEATUREATTRIBUTE="featureAttribute",t.STATE="state",t.LODLEVEL="lodLevel",t.POSITION0="position0",t.POSITION1="position1",t.NORMALA="normalA",t.NORMALB="normalB",t.COMPONENTINDEX="componentIndex",t.VARIANTOFFSET="variantOffset",t.VARIANTSTROKE="variantStroke",t.VARIANTEXTENSION="variantExtension",t.U8PADDING="u8padding",t.U16PADDING="u16padding",t.SIDENESS="sideness",t.START="start",t.END="end",t.UP="up",t.EXTRUDE="extrude",t.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",t.OBJECTANDLAYERIDCOLOR_INSTANCED="objectAndLayerIdColor_instanced"})(O||(O={}));var cs;function Zg(t,e){switch(e.textureCoordinateType){case cs.Default:return t.attributes.add(O.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(S`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case cs.Compressed:return t.attributes.add(O.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(S`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case cs.Atlas:return t.attributes.add(O.UV0,"vec2"),t.varyings.add("vuv0","vec2"),t.attributes.add(O.UVREGION,"vec4"),t.varyings.add("vuvRegion","vec4"),void t.vertex.code.add(S`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:e.textureCoordinateType;case cs.None:return void t.vertex.code.add(S`void forwardTextureCoordinates() {}`);case cs.COUNT:return}}(function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Atlas=2]="Atlas",t[t.Compressed=3]="Compressed",t[t.COUNT=4]="COUNT"})(cs||(cs={}));function Qu(t){t.code.add(S`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}function sd(t){t.include(Qu),t.code.add(S`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture2D(depthTex, uv)), nearFar);
}`)}function GB(t){t.fragment.code.add(S`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var _i;(function(t){t[t.Pass=0]="Pass",t[t.Draw=1]="Draw"})(_i||(_i={}));let Ln=class{constructor(e,r,i,n,s=null){this.name=e,this.type=r,this.arraySize=s,this.bind={[_i.Pass]:null,[_i.Draw]:null},v(i)&&v(n)&&(this.bind[i]=n)}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}},Jt=class extends Ln{constructor(e,r){super(e,"vec3",_i.Pass,(i,n,s)=>i.setUniform3fv(e,r(n,s)))}},Ie=class extends Ln{constructor(e,r){super(e,"float",_i.Pass,(i,n,s)=>i.setUniform1f(e,r(n,s)))}};function U_(t){t.uniforms.add(new Jt("mainLightDirection",(e,r)=>r.lighting.mainLight.direction))}function vy(t){t.uniforms.add(new Jt("mainLightIntensity",(e,r)=>r.lighting.mainLight.intensity))}function x0t(t,e){e.useLegacyTerrainShading?t.uniforms.add(new Ie("lightingFixedFactor",(r,i)=>i.lighting.noonFactor*(1-i.lighting.globalFactor))):t.constants.add("lightingFixedFactor","float",0)}function eV(t,e){const r=t.fragment;U_(r),vy(r),x0t(r,e),r.code.add(S`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
dotVal = mix(dotVal, 1.0, lightingFixedFactor);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)}let Hr=class extends Ln{constructor(e,r){super(e,"vec2",_i.Pass,(i,n,s)=>i.setUniform2fv(e,r(n,s)))}},br=class extends Ln{constructor(e,r){super(e,"vec4",_i.Pass,(i,n,s)=>i.setUniform4fv(e,r(n,s)))}},rn=class extends Ln{constructor(e,r){super(e,"mat4",_i.Pass,(i,n,s)=>i.setUniformMatrix4fv(e,r(n,s)))}};const sDe=re.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");let oDe=class{constructor(){this._includedModules=new Map}include(e,r){if(this._includedModules.has(e)){const i=this._includedModules.get(e);if(i!==r){sDe.error("Trying to include shader module multiple times with different sets of options.");const n=new Set;for(const s of Object.keys(i))i[s]!==e[s]&&n.add(s);for(const s of Object.keys(e))i[s]!==e[s]&&n.add(s);n.forEach(s=>console.error(`  ${s}: current ${i[s]} new ${e[s]}`))}}else this._includedModules.set(e,r),e(this.builder,r)}},Br=class extends oDe{constructor(){super(...arguments),this.vertex=new dye,this.fragment=new dye,this.attributes=new E0t,this.varyings=new C0t,this.extensions=new eee,this.constants=new aDe}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e){const r=this.extensions.generateSource(e),i=this.attributes.generateSource(e),n=this.varyings.generateSource(),s=e==="vertex"?this.vertex:this.fragment,o=s.uniforms.generateSource(),a=s.code.generateSource(),l=e==="vertex"?R0t:A0t,c=this.constants.generateSource().concat(s.constants.generateSource());return`
${r.join(`
`)}

${l}

${c.join(`
`)}

${o.join(`
`)}

${i.join(`
`)}

${n.join(`
`)}

${a.join(`
`)}`}generateBind(e,r){const i=new Map;this.vertex.uniforms.entries.forEach(o=>{const a=o.bind[e];v(a)&&i.set(o.name,a)}),this.fragment.uniforms.entries.forEach(o=>{const a=o.bind[e];v(a)&&i.set(o.name,a)});const n=Array.from(i.values()),s=n.length;return(o,a,l)=>{for(let c=0;c<s;++c)n[c](r,o,a,l)}}},T0t=class{constructor(){this._entries=new Map}add(e){if(!Array.isArray(e))return this._add(e);for(const r of e)this._add(r)}get(e){return this._entries.get(e)}_add(e){if(R(e))sDe.error(`Trying to add null Uniform from ${new Error().stack}.`);else{if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new H(`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}}generateSource(){return Array.from(this._entries.values()).map(e=>v(e.arraySize)?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`)}get entries(){return Array.from(this._entries.values())}},S0t=class{constructor(){this._entries=new Array}add(e){this._entries.push(e)}generateSource(){return this._entries}},dye=class extends oDe{constructor(){super(...arguments),this.uniforms=new T0t,this.code=new S0t,this.constants=new aDe}get builder(){return this}},E0t=class{constructor(){this._entries=new Array}add(e,r){this._entries.push([e,r])}generateSource(e){return e==="fragment"?[]:this._entries.map(r=>`attribute ${r[1]} ${r[0]};`)}},C0t=class{constructor(){this._entries=new Array}add(e,r){this._entries.push([e,r])}generateSource(){return this._entries.map(e=>`varying ${e[1]} ${e[0]};`)}},eee=class tee{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const r=e==="vertex"?tee.ALLOWLIST_VERTEX:tee.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(i=>r.includes(i)).map(i=>`#extension ${i} : enable`)}};eee.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],eee.ALLOWLIST_VERTEX=[];let aDe=class Ls{constructor(){this._entries=new Set}add(e,r,i){let n="ERROR_CONSTRUCTOR_STRING";switch(r){case"float":n=Ls._numberToFloatStr(i);break;case"int":n=Ls._numberToIntStr(i);break;case"bool":n=i.toString();break;case"vec2":n=`vec2(${Ls._numberToFloatStr(i[0])},                            ${Ls._numberToFloatStr(i[1])})`;break;case"vec3":n=`vec3(${Ls._numberToFloatStr(i[0])},                            ${Ls._numberToFloatStr(i[1])},                            ${Ls._numberToFloatStr(i[2])})`;break;case"vec4":n=`vec4(${Ls._numberToFloatStr(i[0])},                            ${Ls._numberToFloatStr(i[1])},                            ${Ls._numberToFloatStr(i[2])},                            ${Ls._numberToFloatStr(i[3])})`;break;case"ivec2":n=`ivec2(${Ls._numberToIntStr(i[0])},                             ${Ls._numberToIntStr(i[1])})`;break;case"ivec3":n=`ivec3(${Ls._numberToIntStr(i[0])},                             ${Ls._numberToIntStr(i[1])},                             ${Ls._numberToIntStr(i[2])})`;break;case"ivec4":n=`ivec4(${Ls._numberToIntStr(i[0])},                             ${Ls._numberToIntStr(i[1])},                             ${Ls._numberToIntStr(i[2])},                             ${Ls._numberToIntStr(i[3])})`;break;case"mat2":case"mat3":case"mat4":n=`${r}(${Array.prototype.map.call(i,s=>Ls._numberToFloatStr(s)).join(", ")})`}return this._entries.add(`const ${r} ${e} = ${n};`),this}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}};const A0t=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif`,R0t=`precision highp float;
precision highp sampler2D;`,Sae="Size",HB="InvSize";function yp(t,e,r=!1,i=0){if(t.hasWebGL2Context){const n=S`vec2(textureSize(${e}, ${S.int(i)}))`;return r?"(1.0 / "+n+")":n}return r?e+HB:e+Sae}function Wl(t,e,r,i=null,n=0){if(t.hasWebGL2Context)return S`texelFetch(${e}, ivec2(${r}), ${S.int(n)})`;let s=S`texture2D(${e}, ${r} * `;return s+=i?S`(${i}))`:S`${e+HB})`,s}var oi;(function(t){t[t.None=0]="None",t[t.Size=1]="Size",t[t.InvSize=2]="InvSize"})(oi||(oi={}));let Dt=class extends Ln{constructor(e,r){super(e,"sampler2D",_i.Pass,(i,n,s)=>i.bindTexture(e,r(n,s)))}};function rm(t,e,r=oi.None){const i=[new Dt(t,e)];if(r&oi.Size){const n=t+Sae;i.push(new Hr(n,(s,o)=>{const a=e(s,o);return v(a)?dt(pye,a.descriptor.width,a.descriptor.height):Wc}))}if(r&oi.InvSize){const n=t+HB;i.push(new Hr(n,(s,o)=>{const a=e(s,o);return v(a)?dt(pye,1/a.descriptor.width,1/a.descriptor.height):Wc}))}return i}const pye=Ne(),j$=ke(parseFloat(Number(5802e-9).toFixed(6)),parseFloat(Number(13558e-9).toFixed(6)),parseFloat(Number(331e-7).toFixed(6))),$H=3,LH=ke($H*parseFloat(Number(65e-8).toFixed(6)),$H*parseFloat(Number(1881e-9).toFixed(6)),$H*parseFloat(Number(85e-9).toFixed(6))),O0t=3996e-9,M0t=ke(parseFloat(Number(j$[0]+LH[0]).toFixed(6)),parseFloat(Number(j$[1]+LH[1]).toFixed(6)),parseFloat(Number(j$[2]+LH[2]).toFixed(6)));function P0t(t){const e=new Br;e.attributes.add(O.POSITION,"vec2"),e.include(Zg,{textureCoordinateType:cs.Default}),e.varyings.add("worldRay","vec3"),e.varyings.add("eyeDir","vec3");const{vertex:r,fragment:i}=e;return r.uniforms.add([new rn("inverseProjectionMatrix",(n,s)=>s.camera.inverseProjectionMatrix),new rn("inverseViewMatrix",(n,s)=>_3(I0t,s.camera.viewMatrix))]),r.code.add(S`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),i.uniforms.add([new Hr("radii",n=>n.radii),new Jt("cameraPosition",(n,s)=>s.camera.eye),new br("heightParameters",n=>n.heightParameters),new Ie("innerFadeDistance",n=>n.innerFadeDistance),new Ie("altitudeFade",n=>n.altitudeFade),new Dt("depthTex",n=>n.depthTex),new Ie("hazeStrength",n=>n.hazeStrength)]),i.constants.add("betaRayleigh","vec3",j$),i.constants.add("betaCombined","vec3",M0t),i.constants.add("betaMie","float",O0t),i.constants.add("scaleHeight","float",b0t*mD),U_(i),e.include(GB),t.haze&&(i.include(sd),i.uniforms.add(new Hr("nearFar",(n,s)=>s.camera.nearFar))),i.code.add(S`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),i.code.add(S`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),i.code.add(S`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),i.code.add(S`
    const int STEPS = 6;

    float getGlow(float dist, float radius, float intensity) {
      return pow(radius / max(dist, 1e-6), intensity);
    }

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${t.haze?S`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${t.haze?S``:" mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * "} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${t.haze?"":S`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${t.haze?S`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:S`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie += getGlow(1.0 - mu, 5e-5, 3.0) * smoothstep(0.01, 0.1, length(scattering));
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
      vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
      if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
        return fragColor;
      }

      float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
      vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
      float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
      if (relDist > 1.0) {
        return surfaceColor;
      }

      return mix(gl_FragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${t.haze?S`
          vec4 depthSample = texture2D(depthTex, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;
            cameraSpaceRay *= -linearDepthFromTexture(depthTex, vuv0, nearFar);
            terrainDepth = max(0.0, length(cameraSpaceRay));
          }`:S`
          float depthSample = texture2D(depthTex, vuv0).r;
          if (depthSample != 1.0) {
            gl_FragColor = vec4(0);
            return;
          }`}

      ${t.haze?S`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            float alpha = 1.0 - fadeOut;`:S`
            vec3 col = getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);;
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}
      col = tonemapACES(col);
      gl_FragColor = delinearizeGamma(vec4(col, alpha));
      ${t.haze?"":S`
          if (depthSample == 1.0) {
            gl_FragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, gl_FragColor);
          }`}
    }
  `),e}const I0t=$e(),$0t=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:j$,build:P0t},Symbol.toStringTag,{value:"Module"}));let jr=class{constructor(e,r){this._module=e,this._loadModule=r}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}};var Hi,Ft,Ce,hy,Lt,Wf,BO,ft,zi,Zn,it,$t,Ct,Ge,Ot,kt,Ul,zr,Uh,Ro,xn,Ur;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(Hi||(Hi={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(Ft||(Ft={})),function(t){t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(Ce||(Ce={})),function(t){t[t.ADD=32774]="ADD",t[t.SUBTRACT=32778]="SUBTRACT",t[t.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(hy||(hy={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"}(Lt||(Lt={})),function(t){t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(Wf||(Wf={})),function(t){t[t.CW=2304]="CW",t[t.CCW=2305]="CCW"}(BO||(BO={})),function(t){t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT"}(ft||(ft={})),function(t){t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS"}(zi||(zi={})),function(t){t[t.ZERO=0]="ZERO",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP"}(Zn||(Zn={})),function(t){t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(it||(it={})),function(t){t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}($t||($t={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(Ct||(Ct={})),function(t){t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.RED=6403]="RED",t[t.RG=33319]="RG",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER"}(Ge||(Ge={})),function(t){t[t.RGBA4=32854]="RGBA4",t[t.R16F=33325]="R16F",t[t.RG16F=33327]="RG16F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.R32F=33326]="R32F",t[t.RG32F=33328]="RG32F",t[t.RGBA32F=34836]="RGBA32F",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB5_A1=32855]="RGB5_A1",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.RGB16F=34843]="RGB16F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.RGB565=36194]="RGB565",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2=32857]="RGB10_A2",t[t.RGB10_A2UI=36975]="RGB10_A2UI"}(Ot||(Ot={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.INT=5124]="INT",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(kt||(kt={})),function(t){t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(Ul||(Ul={})),function(t){t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.STATIC_READ=35045]="STATIC_READ",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.STREAM_COPY=35042]="STREAM_COPY"}(zr||(zr={})),function(t){t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER"}(Uh||(Uh={})),function(t){t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(Ro||(Ro={})),function(t){t[t.TEXTURE=0]="TEXTURE",t[t.RENDER_BUFFER=1]="RENDER_BUFFER",t[t.CUBEMAP=2]="CUBEMAP"}(xn||(xn={})),function(t){t[t.NONE=0]="NONE",t[t.DEPTH_RENDER_BUFFER=1]="DEPTH_RENDER_BUFFER",t[t.STENCIL_RENDER_BUFFER=2]="STENCIL_RENDER_BUFFER",t[t.DEPTH_STENCIL_RENDER_BUFFER=3]="DEPTH_STENCIL_RENDER_BUFFER",t[t.DEPTH_STENCIL_TEXTURE=4]="DEPTH_STENCIL_TEXTURE"}(Ur||(Ur={}));const DH=33984;var ho,Ah;(function(t){t[t.Texture=0]="Texture",t[t.BufferObject=1]="BufferObject",t[t.VertexArrayObject=2]="VertexArrayObject",t[t.Shader=3]="Shader",t[t.Program=4]="Program",t[t.FramebufferObject=5]="FramebufferObject",t[t.Renderbuffer=6]="Renderbuffer",t[t.Sync=7]="Sync",t[t.COUNT=8]="COUNT"})(ho||(ho={})),function(t){t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(Ah||(Ah={}));const fye=33306;var jn,Nl,mye,gye,tV,ree,yye;(function(t){t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(jn||(jn={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT=5124]="INT",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(Nl||(Nl={})),function(t){t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS"}(mye||(mye={})),function(t){t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED"}(gye||(gye={})),function(t){t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED"}(tV||(tV={})),function(t){t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(ree||(ree={})),function(t){t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(yye||(yye={}));let Wr=class{constructor(e,r,i){this.release=i,this.initializeConfiguration(e,r),this._configuration=r.snapshot(),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}destroy(){this._program=rt(this._program),this._pipeline=this._configuration=null}reload(e){rt(this._program),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}get program(){return this._program}get compiled(){return this.program.compiled}get key(){return this._configuration.key}get configuration(){return this._configuration}bindPipelineState(e,r=null,i){e.setPipelineState(this.getPipelineState(r,i))}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}get primitiveType(){return Ft.TRIANGLES}getPipelineState(e,r){return this._pipeline}initializeConfiguration(e,r){}};const Lr=new Map([[O.POSITION,0],[O.NORMAL,1],[O.UV0,2],[O.COLOR,3],[O.SIZE,4],[O.TANGENT,4],[O.AUXPOS1,5],[O.SYMBOLCOLOR,5],[O.AUXPOS2,6],[O.FEATUREATTRIBUTE,6],[O.INSTANCEFEATUREATTRIBUTE,6],[O.INSTANCECOLOR,7],[O.OBJECTANDLAYERIDCOLOR,7],[O.OBJECTANDLAYERIDCOLOR_INSTANCED,7],[O.MODEL,8],[O.MODELNORMAL,12],[O.MODELORIGINHI,11],[O.MODELORIGINLO,15]]),L0t=re.getLogger("esri.views.webgl.checkWebGLError");function D0t(t,e){switch(e){case t.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case t.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case t.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case t.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case t.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case t.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const lDe=!!ue("enable-feature:webgl-debug");function Ih(){return lDe}function iee(){return lDe}function X1(t){if(Ih()){const e=t.getError();if(e){const r=D0t(t,e),i=new Error().stack;L0t.error(new H("webgl-error","WebGL error occured",{message:r,stack:i}))}}}let Gr=class{constructor(e,r,i){this._context=e,this._locations=i,this._textures=new Map,this._freeTextureUnits=new Wt({deallocator:null}),this._glProgram=e.programCache.acquire(r.generate("vertex"),r.generate("fragment"),i),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=r.generateBind(_i.Pass,this),this.bindDraw=r.generateBind(_i.Draw,this),this._fragmentUniforms=Ih()?r.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get compiled(){return this._glProgram.compiled}setUniform1b(e,r){this._glProgram.setUniform1i(e,r?1:0)}setUniform1i(e,r){this._glProgram.setUniform1i(e,r)}setUniform1f(e,r){this._glProgram.setUniform1f(e,r)}setUniform2fv(e,r){this._glProgram.setUniform2fv(e,r)}setUniform3fv(e,r){this._glProgram.setUniform3fv(e,r)}setUniform4fv(e,r){this._glProgram.setUniform4fv(e,r)}setUniformMatrix3fv(e,r){this._glProgram.setUniformMatrix3fv(e,r)}setUniformMatrix4fv(e,r){this._glProgram.setUniformMatrix4fv(e,r)}setUniform1fv(e,r){this._glProgram.setUniform1fv(e,r)}setUniform1iv(e,r){this._glProgram.setUniform1iv(e,r)}setUniform2iv(e,r){this._glProgram.setUniform3iv(e,r)}setUniform3iv(e,r){this._glProgram.setUniform3iv(e,r)}setUniform4iv(e,r){this._glProgram.setUniform4iv(e,r)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,r){if(R(r)||r.glName==null){const n=this._textures.get(e);return n&&(this._context.bindTexture(null,n.unit),this._freeTextureUnit(n),this._textures.delete(e)),null}let i=this._textures.get(e);return i==null?(i=this._allocTextureUnit(r),this._textures.set(e,i)):i.texture=r,this._context.useProgram(this),this.setUniform1i(e,i.unit),this._context.bindTexture(r,i.unit),i.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach((e,r)=>{this._context.bindTexture(e.texture,e.unit),this.setUniform1i(r,e.unit)}),v(this._fragmentUniforms)&&this._fragmentUniforms.forEach(e=>{e.type!=="sampler2D"&&e.type!=="samplerCube"||this._textures.has(e.name)||console.error(`Texture sampler ${e.name} has no bound texture`)})}_allocTextureUnit(e){return{texture:e,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}};var Ii,f2,Gn,n_,jc,A_,kb,jO,gi,m2,F0;(function(t){t[t.None=0]="None",t[t.Front=1]="Front",t[t.Back=2]="Back",t[t.COUNT=3]="COUNT"})(Ii||(Ii={})),function(t){t[t.Less=0]="Less",t[t.Lequal=1]="Lequal",t[t.COUNT=2]="COUNT"}(f2||(f2={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.UPDATE=1]="UPDATE"}(Gn||(Gn={})),function(t){t[t.NOT_LOADED=0]="NOT_LOADED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED"}(n_||(n_={})),function(t){t[t.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",t[t.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(jc||(jc={})),function(t){t[t.Highlight=0]="Highlight",t[t.MaskOccludee=1]="MaskOccludee",t[t.COUNT=2]="COUNT"}(A_||(A_={})),function(t){t[t.STRETCH=1]="STRETCH",t[t.PAD=2]="PAD"}(kb||(kb={})),function(t){t[t.CHANGED=0]="CHANGED",t[t.UNCHANGED=1]="UNCHANGED"}(jO||(jO={})),function(t){t[t.Blend=0]="Blend",t[t.Opaque=1]="Opaque",t[t.Mask=2]="Mask",t[t.MaskBlend=3]="MaskBlend",t[t.COUNT=4]="COUNT"}(gi||(gi={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(m2||(m2={})),function(t){t.DDS_ENCODING="image/vnd-ms.dds",t.KTX2_ENCODING="image/ktx2",t.BASIS_ENCODING="image/x.basis"}(F0||(F0={}));function bm(t,e,r=hy.ADD,i=[0,0,0,0]){return{srcRgb:t,srcAlpha:t,dstRgb:e,dstAlpha:e,opRgb:r,opAlpha:r,color:{r:i[0],g:i[1],b:i[2],a:i[3]}}}function mo(t,e,r,i,n=hy.ADD,s=hy.ADD,o=[0,0,0,0]){return{srcRgb:t,srcAlpha:e,dstRgb:r,dstAlpha:i,opRgb:n,opAlpha:s,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const Eae={face:Wf.BACK,mode:BO.CCW},cDe={face:Wf.FRONT,mode:BO.CCW},qB=t=>t===Ii.Back?Eae:t===Ii.Front?cDe:null,Xc={zNear:0,zFar:1},ir={r:!0,g:!0,b:!0,a:!0};function N0t(t){return G0t.intern(t)}function F0t(t){return H0t.intern(t)}function k0t(t){return q0t.intern(t)}function U0t(t){return W0t.intern(t)}function z0t(t){return X0t.intern(t)}function V0t(t){return Y0t.intern(t)}function B0t(t){return Z0t.intern(t)}function j0t(t){return J0t.intern(t)}function Ht(t){return K0t.intern(t)}let z_=class{constructor(e,r){this._makeKey=e,this._makeRef=r,this._interns=new Map}intern(e){if(!e)return null;const r=this._makeKey(e),i=this._interns;return i.has(r)||i.set(r,this._makeRef(e)),i.get(r)??null}};function V_(t){return"["+t.join(",")+"]"}const G0t=new z_(uDe,t=>({__tag:"Blending",...t}));function uDe(t){return t?V_([t.srcRgb,t.srcAlpha,t.dstRgb,t.dstAlpha,t.opRgb,t.opAlpha,t.color.r,t.color.g,t.color.b,t.color.a]):null}const H0t=new z_(hDe,t=>({__tag:"Culling",...t}));function hDe(t){return t?V_([t.face,t.mode]):null}const q0t=new z_(dDe,t=>({__tag:"PolygonOffset",...t}));function dDe(t){return t?V_([t.factor,t.units]):null}const W0t=new z_(pDe,t=>({__tag:"DepthTest",...t}));function pDe(t){return t?V_([t.func]):null}const X0t=new z_(fDe,t=>({__tag:"StencilTest",...t}));function fDe(t){return t?V_([t.function.func,t.function.ref,t.function.mask,t.operation.fail,t.operation.zFail,t.operation.zPass]):null}const Y0t=new z_(mDe,t=>({__tag:"DepthWrite",...t}));function mDe(t){return t?V_([t.zNear,t.zFar]):null}const Z0t=new z_(gDe,t=>({__tag:"ColorWrite",...t}));function gDe(t){return t?V_([t.r,t.g,t.b,t.a]):null}const J0t=new z_(yDe,t=>({__tag:"StencilWrite",...t}));function yDe(t){return t?V_([t.mask]):null}const K0t=new z_(Q0t,t=>({blending:N0t(t.blending),culling:F0t(t.culling),polygonOffset:k0t(t.polygonOffset),depthTest:U0t(t.depthTest),stencilTest:z0t(t.stencilTest),depthWrite:V0t(t.depthWrite),colorWrite:B0t(t.colorWrite),stencilWrite:j0t(t.stencilWrite)}));function Q0t(t){return t?V_([uDe(t.blending),hDe(t.culling),dDe(t.polygonOffset),pDe(t.depthTest),fDe(t.stencilTest),mDe(t.depthWrite),gDe(t.colorWrite),yDe(t.stencilWrite)]):null}let e_t=class{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setSubState(e,r,i,n){return(i||e!==r)&&(n(e),this._pipelineInvalid=!0),e}},t_t=class extends wi{constructor(){super(...arguments),this.heightParameters=pr(),this.radii=Ne(),this.innerFadeDistance=0,this.altitudeFade=0,this.hazeStrength=1}},nee=class _De extends Wr{initializeProgram(e){return new Gr(e.rctx,_De.shader.get().build(this.configuration),Lr)}initializePipeline(){return this.configuration.haze?Ht({blending:mo(Ce.ONE,Ce.ZERO,Ce.ONE_MINUS_SRC_COLOR,Ce.ONE),colorWrite:ir}):Ht({blending:mo(Ce.SRC_ALPHA,Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA,Ce.ONE_MINUS_SRC_ALPHA),depthTest:{func:zi.LEQUAL},colorWrite:ir})}};nee.shader=new jr($0t,()=>Q(()=>import("./ChapmanAtmosphere.glsl-49e720f2.js"),[]));let _l=class extends wi{constructor(){super(),this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const e=this._parameterNames,r={key:this.key};for(const i of e)r[i]=this[i];return r}};function j(t={}){return(e,r)=>{if(e._parameterNames=e._parameterNames??[],e._parameterNames.push(r),t.constValue!=null)Object.defineProperty(e,r,{get:()=>t.constValue});else{const i=e._parameterNames.length-1,n=t.count||2,s=Math.ceil(Math.log2(n)),o=e._parameterBits??[0];let a=0;for(;o[a]+s>16;)a++,a>=o.length&&o.push(0);e._parameterBits=o;const l=o[a],c=(1<<s)-1<<l;o[a]+=s,Object.defineProperty(e,r,{get(){return this[i]},set(h){if(this[i]!==h&&(this[i]=h,this._keyDirty=!0,this._parameterBits[a]=this._parameterBits[a]&~c|+h<<l&c,typeof h!="number"&&typeof h!="boolean"))throw new Error("Configuration value for "+r+" must be boolean or number, got "+typeof h)}})}}}let vDe=class extends _l{constructor(){super(...arguments),this.haze=!1}};u([j()],vDe.prototype,"haze",void 0);let va=class{constructor(e,r,i,n,s,o=!1,a=0){this.name=e,this.count=r,this.type=i,this.offset=n,this.stride=s,this.normalized=o,this.divisor=a}};new va(O.POSITION,3,ft.FLOAT,0,12);new va(O.POSITION,3,ft.FLOAT,0,20),new va(O.UV0,2,ft.FLOAT,12,20);new va(O.POSITION,3,ft.FLOAT,0,32),new va(O.NORMAL,3,ft.FLOAT,12,32),new va(O.UV0,2,ft.FLOAT,24,32);new va(O.POSITION,3,ft.FLOAT,0,16),new va(O.COLOR,4,ft.UNSIGNED_BYTE,12,16);const Cae=[new va(O.POSITION,2,ft.FLOAT,0,8)],$3=[new va(O.POSITION,2,ft.FLOAT,0,16),new va(O.UV0,2,ft.FLOAT,8,16)];function _ye(t){const e=t.gl;switch(e.getError()){case e.NO_ERROR:return null;case e.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case e.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case e.INVALID_OPERATION:return"The specified command is not allowed for the current state";case e.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case e.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case e.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function Da(t,e){return t.vertexBuffers[e].size/r_t(t.layout[e])}function r_t(t){return t[0].stride}function Aae(t,e,r,i,n=0){const s=t.gl,o=t.capabilities.instancing;t.bindBuffer(r);for(const a of i){const l=e.get(a.name);l===void 0&&console.error(`There is no location for vertex attribute '${a.name}' defined.`);const c=n*a.stride;if(a.count<=4)s.vertexAttribPointer(l,a.count,a.type,a.normalized,a.stride,a.offset+c),s.enableVertexAttribArray(l),a.divisor>0&&o&&o.vertexAttribDivisor(l,a.divisor);else if(a.count===9)for(let h=0;h<3;h++)s.vertexAttribPointer(l+h,3,a.type,a.normalized,a.stride,a.offset+12*h+c),s.enableVertexAttribArray(l+h),a.divisor>0&&o&&o.vertexAttribDivisor(l+h,a.divisor);else if(a.count===16)for(let h=0;h<4;h++)s.vertexAttribPointer(l+h,4,a.type,a.normalized,a.stride,a.offset+16*h+c),s.enableVertexAttribArray(l+h),a.divisor>0&&o&&o.vertexAttribDivisor(l+h,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count)}}function Rae(t,e,r,i){const n=t.gl,s=t.capabilities.instancing;t.bindBuffer(r);for(const o of i){const a=e.get(o.name);if(o.count<=4)n.disableVertexAttribArray(a),o.divisor&&o.divisor>0&&s&&s.vertexAttribDivisor(a,0);else if(o.count===9)for(let l=0;l<3;l++)n.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&s&&s.vertexAttribDivisor(a+l,0);else if(o.count===16)for(let l=0;l<4;l++)n.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&s&&s.vertexAttribDivisor(a+l,0);else console.error("Unsupported vertex attribute element count: "+o.count)}t.unbindBuffer(Lt.ARRAY_BUFFER)}function bDe(t){switch(t){case Ge.ALPHA:case Ge.LUMINANCE:case Ge.RED:case Ge.RED_INTEGER:case Ot.R8:case Ot.R8I:case Ot.R8UI:case Ot.R8_SNORM:case Ul.STENCIL_INDEX8:return 1;case Ge.LUMINANCE_ALPHA:case Ge.RG:case Ge.RG_INTEGER:case Ot.RGBA4:case Ot.R16F:case Ot.R16I:case Ot.R16UI:case Ot.RG8:case Ot.RG8I:case Ot.RG8UI:case Ot.RG8_SNORM:case Ot.RGB565:case Ot.RGB5_A1:case Ul.DEPTH_COMPONENT16:return 2;case Ge.DEPTH_COMPONENT:case Ge.RGB:case Ge.RGB_INTEGER:case Ot.RGB8:case Ot.RGB8I:case Ot.RGB8UI:case Ot.RGB8_SNORM:case Ot.SRGB8:case Ul.DEPTH_COMPONENT24:return 3;case Ge.DEPTH_STENCIL:case Ge.RGBA:case Ge.RGBA_INTEGER:case Ot.RGBA8:case Ot.R32F:case Ot.R11F_G11F_B10F:case Ot.RG16F:case Ot.R32I:case Ot.R32UI:case Ot.RG16I:case Ot.RG16UI:case Ot.RGBA8I:case Ot.RGBA8UI:case Ot.RGBA8_SNORM:case Ot.SRGB8_ALPHA8:case Ot.RGB9_E5:case Ot.RGB10_A2UI:case Ot.RGB10_A2:case Ul.DEPTH_STENCIL:case Ul.DEPTH_COMPONENT32F:case Ul.DEPTH24_STENCIL8:return 4;case Ul.DEPTH32F_STENCIL8:return 5;case Ot.RGB16F:case Ot.RGB16I:case Ot.RGB16UI:return 6;case Ot.RG32F:case Ot.RG32I:case Ot.RG32UI:case Ot.RGBA16F:case Ot.RGBA16I:case Ot.RGBA16UI:return 8;case Ot.RGB32F:case Ot.RGB32I:case Ot.RGB32UI:return 12;case Ot.RGBA32F:case Ot.RGBA32I:case Ot.RGBA32UI:return 16;case jn.COMPRESSED_RGB_S3TC_DXT1_EXT:case jn.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case jn.COMPRESSED_RGBA_S3TC_DXT3_EXT:case jn.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case jn.COMPRESSED_R11_EAC:case jn.COMPRESSED_SIGNED_R11_EAC:case jn.COMPRESSED_RGB8_ETC2:case jn.COMPRESSED_SRGB8_ETC2:case jn.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case jn.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case jn.COMPRESSED_RG11_EAC:case jn.COMPRESSED_SIGNED_RG11_EAC:case jn.COMPRESSED_RGBA8_ETC2_EAC:case jn.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}function g2(t){if(R(t))return 0;if("descriptor"in t)return t.glName?g2(t.descriptor):0;const e=t.internalFormat||"pixelFormat"in t&&t.pixelFormat;if(!e)return 0;const r="hasMipmap"in t&&t.hasMipmap?1.3:1,i=t.width*t.height;return bDe(e)*i*r}const ex=re.getLogger("esri.views.webgl.VertexArrayObject");let Mp=class{constructor(e,r,i,n,s=null){this._context=e,this._locations=r,this._layout=i,this._buffers=n,this._indexBuffer=s,this._glName=null,this._initialized=!1,e.instanceCounter.increment(ho.VertexArrayObject,this)}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get size(){return Object.keys(this._buffers).reduce((e,r)=>e+this._buffers[r].size,v(this._indexBuffer)?this._indexBuffer.size:0)}get layout(){return this._layout}get locations(){return this._locations}dispose(e=!0){var r,i,n;if(!this._context)return void((this._glName||e&&Object.getOwnPropertyNames(this._buffers).length>0)&&ex.warn("Leaked WebGL VAO"));if(this._glName){const s=(i=(r=this._context)==null?void 0:r.capabilities)==null?void 0:i.vao;s?(s.deleteVertexArray(this._glName),this._glName=null):ex.warn("Leaked WebGL VAO")}if(this._context.getBoundVAO()===this&&this._context.bindVAO(null),e){for(const s in this._buffers)(n=this._buffers[s])==null||n.dispose(),delete this._buffers[s];this._indexBuffer=rt(this._indexBuffer)}this._context.instanceCounter.decrement(ho.VertexArrayObject,this),this._context=XS(this._context)}initialize(){if(this._initialized)return;const e=this._context.capabilities.vao;if(e){const r=e.createVertexArray();e.bindVertexArray(r),this._bindLayout(),e.bindVertexArray(null),this._glName=r}this._initialized=!0}bind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:e,_layout:r,_indexBuffer:i}=this;e||ex.error("Vertex buffer dictionary is empty!");const n=this._context.gl;for(const s in e){const o=e[s];o||ex.error("Vertex buffer is uninitialized!");const a=r[s];a||ex.error("Vertex element descriptor is empty!"),Aae(this._context,this._locations,o,a)}v(i)&&(this._context.capabilities.vao?n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,i.glName):this._context.bindBuffer(i))}unbind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:e,_layout:r}=this;e||ex.error("Vertex buffer dictionary is empty!");for(const i in e){const n=e[i];n||ex.error("Vertex buffer is uninitialized!");const s=r[i];Rae(this._context,this._locations,n,s)}v(this._indexBuffer)&&this._context.unbindBuffer(this._indexBuffer.bufferType)}},wm=class extends Mp{};const Om=re.getLogger("esri.views.webgl.BufferObject");let Kr=class lA{static createIndex(e,r,i){return new lA(e,Lt.ELEMENT_ARRAY_BUFFER,r,i)}static createVertex(e,r,i){return new lA(e,Lt.ARRAY_BUFFER,r,i)}static createUniform(e,r,i){if(e.type!==Et.WEBGL2)throw new Error("Uniform buffers are supported in WebGL2 only!");return new lA(e,Lt.UNIFORM_BUFFER,r,i)}static createPixelPack(e,r=zr.STREAM_READ,i){if(e.type!==Et.WEBGL2)throw new Error("Pixel pack buffers are supported in WebGL2 only!");const n=new lA(e,Lt.PIXEL_PACK_BUFFER,r);return i&&n.setSize(i),n}static createPixelUnpack(e,r=zr.STREAM_DRAW,i){if(e.type!==Et.WEBGL2)throw new Error("Pixel unpack buffers are supported in WebGL2 only!");return new lA(e,Lt.PIXEL_UNPACK_BUFFER,r,i)}constructor(e,r,i,n){this._context=e,this.bufferType=r,this.usage=i,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(ho.BufferObject,this),this._glName=this._context.gl.createBuffer(),X1(this._context.gl),n&&this.setData(n)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteSize(){return this.bufferType===Lt.ELEMENT_ARRAY_BUFFER?this._indexType===ft.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===Lt.ELEMENT_ARRAY_BUFFER||this.bufferType===Lt.ARRAY_BUFFER}dispose(){var e;(e=this._context)!=null&&e.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(ho.BufferObject,this),this._context=XS(this._context)):this._glName&&Om.warn("Leaked WebGL buffer object")}setSize(e,r=null){if(e<=0&&Om.error("Buffer size needs to be positive!"),this.bufferType===Lt.ELEMENT_ARRAY_BUFFER&&v(r))switch(this._indexType=r,r){case ft.UNSIGNED_SHORT:e*=2;break;case ft.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let r=e.byteLength;this.bufferType===Lt.ELEMENT_ARRAY_BUFFER&&(Iie(e)&&(r/=2,this._indexType=ft.UNSIGNED_SHORT),$ie(e)&&(r/=4,this._indexType=ft.UNSIGNED_INT)),this._setBufferData(r,e)}_setBufferData(e,r=null){this._size=e;const i=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const n=this._context.gl;v(r)?n.bufferData(this.bufferType,r,this.usage):n.bufferData(this.bufferType,e,this.usage),X1(n),this._isVAOAware&&this._context.bindVAO(i)}setSubData(e,r,i,n){if(!e)return;(r<0||r*e.BYTES_PER_ELEMENT>=this.byteSize)&&Om.error("offset is out of range!"),i>=n&&Om.error("end must be bigger than start!"),(r+(n-i))*e.BYTES_PER_ELEMENT>this.byteSize&&Om.error("An attempt to write beyond the end of the buffer!");const s=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const o=this._context.gl;if(this._context.type===Et.WEBGL2)o.bufferSubData(this.bufferType,r*e.BYTES_PER_ELEMENT,e,i,n-i);else{const a=i===0&&n===e.length?e:e.subarray(i,n);o.bufferSubData(this.bufferType,r*e.BYTES_PER_ELEMENT,a)}X1(o),this._isVAOAware&&this._context.bindVAO(s)}getSubData(e,r=0,i,n){if(this._context.type!==Et.WEBGL2)return void Om.error("Get buffer subdata is supported in WebGL2 only!");if(i<0||n<0)return void Om.error("Problem getting subdata: offset and length were less than zero!");const s=i_t(e)?e.BYTES_PER_ELEMENT:1;if(s*((i??0)+(n??0))>e.byteLength)return void Om.error("Problem getting subdata: offset and length exceeded destination size!");r+s*(n??0)>this.byteSize&&Om.warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this._context.bindBuffer(this,Lt.COPY_READ_BUFFER),o.getBufferSubData(Lt.COPY_READ_BUFFER,r,e,i,n),this._context.unbindBuffer(Lt.COPY_READ_BUFFER)}async getSubDataAsync(e,r=0,i,n){this._context.type===Et.WEBGL2?(await this._context.clientWaitAsync(),this.getSubData(e,r,i,n)):Om.error("Get buffer subdata is supported in WebGL2 only!")}};function i_t(t){return XBe(t)}const NH={target:Ct.TEXTURE_2D,samplingMode:it.LINEAR,wrapMode:$t.REPEAT,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,isImmutable:!1},vye=4;let mt=class{constructor(e,r,i=null){this._context=e,this.type="texture",this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,e.instanceCounter.increment(ho.Texture,this),this._descriptor={...NH,...r};for(const n in NH)this._descriptor[n]===void 0&&(this._descriptor[n]=NH[n]);if(e.type!==Et.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),tx(this._descriptor.target)))throw new Error("3D and array textures are not supported in WebGL1");this._descriptor.target===Ct.TEXTURE_CUBE_MAP?this._setDataCubeMap(i):this.setData(i)}get glName(){return this._glName}get descriptor(){return this._descriptor}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._context.gl&&this._glName&&(this._context.unbindTexture(this),this._context.gl.deleteTexture(this._glName),this._glName=null,this._context.instanceCounter.decrement(ho.Texture,this))}release(){this.dispose()}resize(e,r){const i=this._descriptor;if(i.width!==e||i.height!==r){if(this._wasImmutablyAllocated)throw new Error("Immutable textures can't be resized!");i.width=e,i.height=r,this._descriptor.target===Ct.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(e=null){for(let r=Ct.TEXTURE_CUBE_MAP_POSITIVE_X;r<=Ct.TEXTURE_CUBE_MAP_NEGATIVE_Z;r++)this._setData(e,r)}setData(e){this._setData(e)}_setData(e,r){if(!this._context||!this._context.gl)return;const i=this._context.gl;this._glName||(this._glName=i.createTexture()),e===void 0&&(e=null);const n=this._descriptor,s=r??n.target,o=tx(s);e===null&&(n.width=n.width||vye,n.height=n.height||vye,o&&(n.depth=n.depth??1));const a=this._context.bindTexture(this,mt.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(mt.TEXTURE_UNIT_FOR_UPDATES),mt._validateTexture(this._context,n),this._configurePixelStorage(),X1(i);const l=n.pixelFormat;let c=n.internalFormat??this._deriveInternalFormat(l,n.dataType);if(FH(e)){let h=e.width,p=e.height;const f=1;e instanceof HTMLVideoElement&&(h=e.videoWidth,p=e.videoHeight),n.width&&n.height,o&&n.depth,n.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(s,c,n.hasMipmap,h,p,f),this._texImage(s,0,c,h,p,f,e),X1(i),n.hasMipmap&&this.generateMipmap(),n.width===void 0&&(n.width=h),n.height===void 0&&(n.height=p),o&&n.depth===void 0&&(n.depth=f)}else{const{width:h,height:p,depth:f}=n;if(h==null||p==null)throw new Error("Width and height must be specified!");if(o&&f==null)throw new Error("Depth must be specified!");if(n.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(s,c,n.hasMipmap,h,p,f),i.DEPTH24_STENCIL8&&c===i.DEPTH_STENCIL&&(c=i.DEPTH24_STENCIL8),TU(e)){const m=e.levels,g=bye(s,h,p,f),_=Math.min(g-1,m.length-1);v(this._context.gl2)?i.texParameteri(n.target,this._context.gl2.TEXTURE_MAX_LEVEL,_):n.hasMipmap=n.hasMipmap&&g===m.length;const b=c;if(!s_t(b))throw new Error("Attempting to use compressed data with an umcompressed format!");this._forEachMipmapLevel((w,x,T,E)=>{const C=m[Math.min(w,m.length-1)];this._compressedTexImage(s,w,b,x,T,E,C)},_)}else v(e)?(this._texImage(s,0,c,h,p,f,e),X1(i),n.hasMipmap&&this.generateMipmap()):this._forEachMipmapLevel((m,g,_,b)=>{this._texImage(s,m,c,g,_,b,null),X1(i)})}mt._applySamplingMode(i,this._descriptor),mt._applyWrapMode(i,this._descriptor),mt._applyAnisotropicFilteringParameters(this._context,this._descriptor),X1(i),this._context.bindTexture(a,mt.TEXTURE_UNIT_FOR_UPDATES)}updateData(e,r,i,n,s,o,a=0){o||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const l=this._context.gl,c=this._descriptor,{pixelFormat:h,dataType:p,target:f,isImmutable:m}=c,g=c.internalFormat??this._deriveInternalFormat(h,p);if(m&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");const _=this._context.bindTexture(this,mt.TEXTURE_UNIT_FOR_UPDATES,!0);if((r<0||i<0||n>c.width||s>c.height||r+n>c.width||i+s>c.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),a){if(R(this._context.gl2))return void console.error("Webgl2 must be enabled to use dataRowOffset!");l.pixelStorei(this._context.gl2.UNPACK_SKIP_ROWS,a)}if(FH(o)?v(this._context.gl2)?this._context.gl2.texSubImage2D(f,e,r,i,n,s,h,p,o):l.texSubImage2D(f,e,r,i,h,p,o):TU(o)?l.compressedTexSubImage2D(f,e,r,i,n,s,g,o.levels[e]):l.texSubImage2D(f,e,r,i,n,s,h,p,o),a){if(R(this._context.gl2))return void console.error("Webgl2 must be enabled to use dataRowOffset!");l.pixelStorei(this._context.gl2.UNPACK_SKIP_ROWS,0)}this._context.bindTexture(_,mt.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(e,r,i,n,s,o,a,l){l||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._context.gl2;if(R(c))throw new Error("3D textures are not supported in WebGL1");const h=this._descriptor,{pixelFormat:p,dataType:f,isImmutable:m,target:g}=h,_=h.internalFormat??this._deriveInternalFormat(p,f);if(m&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");tx(g)||console.warn("Attempting to set 3D texture data on a non-3D texture");const b=this._context.bindTexture(this,mt.TEXTURE_UNIT_FOR_UPDATES);if(this._context.setActiveTexture(mt.TEXTURE_UNIT_FOR_UPDATES),(r<0||i<0||n<0||s>h.width||o>h.height||a>h.depth||r+s>h.width||i+o>h.height||n+a>h.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),TU(l))l=l.levels[e],c.compressedTexSubImage3D(g,e,r,i,n,s,o,a,_,l);else{const w=l;c.texSubImage3D(g,e,r,i,n,s,o,a,p,f,w)}this._context.bindTexture(b,mt.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;if(!e.hasMipmap){if(this._wasImmutablyAllocated)throw new Error("Cannot add mipmaps to immutable texture after allocation");e.hasMipmap=!0,this._samplingModeDirty=!0,mt._validateTexture(this._context,e)}e.samplingMode===it.LINEAR?(this._samplingModeDirty=!0,e.samplingMode=it.LINEAR_MIPMAP_NEAREST):e.samplingMode===it.NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=it.NEAREST_MIPMAP_NEAREST);const r=this._context.bindTexture(this,mt.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(mt.TEXTURE_UNIT_FOR_UPDATES),this._context.gl.generateMipmap(e.target),this._context.bindTexture(r,mt.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,mt._validateTexture(this._context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._context.gl,r=this._descriptor;this._samplingModeDirty&&(mt._applySamplingMode(e,r),this._samplingModeDirty=!1),this._wrapModeDirty&&(mt._applyWrapMode(e,r),this._wrapModeDirty=!1)}_deriveInternalFormat(e,r){if(this._context.type===Et.WEBGL1)return e;switch(r){case kt.FLOAT:switch(e){case Ge.RGBA:return Ot.RGBA32F;case Ge.RGB:return Ot.RGB32F;default:throw new Error("Unable to derive format")}case kt.UNSIGNED_BYTE:switch(e){case Ge.RGBA:return Ot.RGBA8;case Ge.RGB:return Ot.RGB8}default:return e}}_configurePixelStorage(){const e=this._context.gl,{unpackAlignment:r,flipped:i,preMultiplyAlpha:n}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,r),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,i?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n?1:0)}_texStorage(e,r,i,n,s,o){const a=this._context.gl2;if(R(a))throw new Error("Immutable textures are not supported in WebGL1");if(!n_t(r))throw new Error("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=i?bye(e,n,s,o):1;if(tx(e)){if(o==null)throw new Error("Missing depth dimension for 3D texture upload");a.texStorage3D(e,l,r,n,s,o)}else a.texStorage2D(e,l,r,n,s);this._wasImmutablyAllocated=!0}_texImage(e,r,i,n,s,o,a){const l=this._context.gl;let c=null;const h=this._context.type===Et.WEBGL2,p=tx(e),{isImmutable:f,pixelFormat:m,dataType:g}=this._descriptor;if(h&&(c=l),h||!FH(a))if(f){if(v(a)){const _=a;if(p){if(o==null)throw new Error("Missing depth dimension for 3D texture upload");c.texSubImage3D(e,r,0,0,0,n,s,o,m,g,_)}else l.texSubImage2D(e,r,0,0,n,s,m,g,_)}}else{const _=a;if(p){if(o==null)throw new Error("Missing depth dimension for 3D texture upload");c.texImage3D(e,r,i,n,s,o,0,m,g,_)}else l.texImage2D(e,r,i,n,s,0,m,g,_)}else l.texImage2D(e,0,i,m,g,a)}_compressedTexImage(e,r,i,n,s,o,a){const l=this._context.gl;let c=null;const h=tx(e),p=this._descriptor.isImmutable;if(h){if(this._context.type!==Et.WEBGL2)throw new Error("3D textures are not supported in WebGL1");c=l}if(p){if(v(a))if(h){if(o==null)throw new Error("Missing depth dimension for 3D texture upload");c.compressedTexSubImage3D(e,r,0,0,0,n,s,o,i,a)}else l.compressedTexSubImage2D(e,r,0,0,n,s,i,a)}else if(h){if(o==null)throw new Error("Missing depth dimension for 3D texture upload");c.compressedTexImage3D(e,r,i,n,s,o,0,a)}else l.compressedTexImage2D(e,r,i,n,s,0,a)}_forEachMipmapLevel(e,r=1/0){let{width:i,height:n,depth:s,hasMipmap:o,target:a}=this._descriptor;const l=a===Ct.TEXTURE_3D;if(i==null||n==null||l&&s==null)throw new Error("Missing texture dimensions for mipmap calculation");for(let c=0;e(c,i,n,s),o&&(i!==1||n!==1||l&&s!==1)&&!(c>=r);++c)i=Math.max(1,i>>1),n=Math.max(1,n>>1),l&&(s=Math.max(1,s>>1))}static _validateTexture(e,r){(r.width!=null&&r.width<0||r.height!=null&&r.height<0||r.depth!=null&&r.depth<0)&&console.error("Negative dimension parameters are not allowed!");const i=e.type===Et.WEBGL2,n=r.width!=null&&lm(r.width)&&r.height!=null&&lm(r.height);i||!r.isImmutable&&!tx(r.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!"),i||n||(typeof r.wrapMode=="number"?r.wrapMode!==$t.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):r.wrapMode.s===$t.CLAMP_TO_EDGE&&r.wrapMode.t===$t.CLAMP_TO_EDGE||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),r.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))}static _applySamplingMode(e,r){let i=r.samplingMode,n=r.samplingMode;i===it.LINEAR_MIPMAP_NEAREST||i===it.LINEAR_MIPMAP_LINEAR?(i=it.LINEAR,r.hasMipmap||(n=it.LINEAR)):i!==it.NEAREST_MIPMAP_NEAREST&&i!==it.NEAREST_MIPMAP_LINEAR||(i=it.NEAREST,r.hasMipmap||(n=it.NEAREST)),e.texParameteri(r.target,e.TEXTURE_MAG_FILTER,i),e.texParameteri(r.target,e.TEXTURE_MIN_FILTER,n)}static _applyWrapMode(e,r){typeof r.wrapMode=="number"?(e.texParameteri(r.target,e.TEXTURE_WRAP_S,r.wrapMode),e.texParameteri(r.target,e.TEXTURE_WRAP_T,r.wrapMode)):(e.texParameteri(r.target,e.TEXTURE_WRAP_S,r.wrapMode.s),e.texParameteri(r.target,e.TEXTURE_WRAP_T,r.wrapMode.t))}static _applyAnisotropicFilteringParameters(e,r){const i=e.capabilities.textureFilterAnisotropic;i&&e.gl.texParameterf(r.target,i.TEXTURE_MAX_ANISOTROPY,r.maxAnisotropy??1)}};function n_t(t){return t in Ot}function s_t(t){return t in jn}function TU(t){return v(t)&&"type"in t&&t.type==="compressed"}function o_t(t){return v(t)&&"byteLength"in t}function FH(t){return v(t)&&!TU(t)&&!o_t(t)}function tx(t){return t===Ct.TEXTURE_3D||t===Ct.TEXTURE_2D_ARRAY}function bye(t,e,r,i=1){let n=Math.max(e,r);return t===Ct.TEXTURE_3D&&(n=Math.max(n,i)),Math.round(Math.log(n)/Math.LN2)+1}mt.TEXTURE_UNIT_FOR_UPDATES=0;function vl(t,e=Cae,r=Lr,i=-1,n=1){let s=null;return e===$3?s=new Float32Array([i,i,0,0,n,i,1,0,i,n,0,1,n,n,1,1]):s=new Float32Array([i,i,n,i,i,n,n,n]),new wm(t,r,{geometry:e},{geometry:Kr.createVertex(t,zr.STATIC_DRAW,s)})}function a_t(t,e=Cae,r=Lr){const i=new Float32Array([-1,-1,3,-1,-1,3]);return new wm(t,r,{geometry:e},{geometry:Kr.createVertex(t,zr.STATIC_DRAW,i)})}const wDe=4;function xDe(t,e=wDe){return new mt(t,{target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:it.NEAREST,width:e,height:e})}function l_t(t,e,r=wDe){const i=new Uint8Array(r*r*4);for(let n=0;n<i.length;n+=4)i[n+0]=255*e[0],i[n+1]=255*e[1],i[n+2]=255*e[2],i[n+3]=255*e[3];return new mt(t,{target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:it.NEAREST,width:r,height:r},i)}function TDe(t){return new mt(t,{target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:it.NEAREST,width:1,height:1},new Uint8Array([255,255,255,255]))}let kH=class{constructor(e,r){this._view=e,this.type=ro.Realistic,this._handles=new qr,this._passParameters=new t_t,this._rootTileElevationMin=NaN,this._lowerBoundEarthRadius=Cr.radius,this._fadeHaze=0,this._updateRadius(Cr.radius);const i=r.renderContext.rctx;this._updateRootTileElevationBounds(),this._handles.add([ne(()=>this._view.basemapTerrain.rootTileElevationBounds,()=>this._updateRootTileElevationBounds()),ne(()=>this._view.basemapTerrain.visibleElevationBounds,()=>this._updateVisibleElevationBounds())]);const n=new vDe;n.haze=!1,this._atmosphereTechnique=r.techniqueRepository.acquire(nee,n),n.haze=!0,this._atmosphereHazeTechnique=r.techniqueRepository.acquire(nee,n),this._vao=vl(i,$3)}destroy(){this._atmosphereTechnique.release(),this._atmosphereHazeTechnique.release(),this._vao.dispose(),this._handles.destroy()}render(e){this._render(e,this._atmosphereTechnique,e.offscreenRenderingHelper.depthTexture)}renderHaze(e,r){this._fadeHaze=r,this._render(e,this._atmosphereHazeTechnique,e.offscreenRenderingHelper.linearDepthTexture)}_render(e,r,i){if(R(i))return;this._update(e.bindParameters.camera),this._passParameters.depthTex=i;const n=e.rctx.bindTechnique(r,this._passParameters,e.bindParameters);e.offscreenRenderingHelper.renderDepthDetached(()=>this._renderCommon(n,e))}_renderCommon(e,r){R(this._vao)||(r.rctx.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.rctx.drawArrays(Ft.TRIANGLE_STRIP,0,4))}_adjustRadiusForTesselation(e){return e*Math.cos(Math.PI/16/16)}_updateRootTileElevationBounds(){const e=this._view.basemapTerrain.rootTileElevationBounds.min;e!==this._rootTileElevationMin&&(this._rootTileElevationMin=e,this._lowerBoundEarthRadius=Cr.radius,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const e=this._adjustRadiusForTesselation(Cr.radius+this._view.basemapTerrain.visibleElevationBounds.min);e<this._lowerBoundEarthRadius&&this._updateRadius(e)}_updateRadius(e){this._lowerBoundEarthRadius=e,dt(this._passParameters.radii,e,e+mD),this._passParameters.innerFadeDistance=2*Math.sqrt((2*e-QQ)*QQ)}_update(e){if(R(e))return;const r=nl(e.eye),i=Math.sqrt(r),n=r-this._passParameters.radii[1]*this._passParameters.radii[1],s=_e((i-this._passParameters.radii[0])/mD,0,1);ai(this._passParameters.heightParameters,i,r,n,s),this._passParameters.altitudeFade=Tae(i-this._lowerBoundEarthRadius),this._passParameters.hazeStrength=Bt(Bt(.6,1,mO(9500,10500,i-Cr.radius)),1,this._fadeHaze)}static isSupported(e){return e.renderContext.rctx.capabilities.depthTexture}};function Ki(){return new Float32Array(3)}function rV(t){const e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function ti(t,e,r){const i=new Float32Array(3);return i[0]=t,i[1]=e,i[2]=r,i}function SDe(t,e){return new Float32Array(t,e,3)}function Oae(){return Ki()}function EDe(){return ti(1,1,1)}function CDe(){return ti(1,0,0)}function ADe(){return ti(0,1,0)}function RDe(){return ti(0,0,1)}const c_t=Oae(),u_t=EDe(),h_t=CDe(),d_t=ADe(),p_t=RDe();Object.freeze(Object.defineProperty({__proto__:null,ONES:u_t,UNIT_X:h_t,UNIT_Y:d_t,UNIT_Z:p_t,ZEROS:c_t,clone:rV,create:Ki,createView:SDe,fromValues:ti,ones:EDe,unitX:CDe,unitY:ADe,unitZ:RDe,zeros:Oae},Symbol.toStringTag,{value:"Module"}));function ODe(t){t.extensions.add("GL_EXT_shader_texture_lod"),t.extensions.add("GL_OES_standard_derivatives"),t.fragment.code.add(S`#ifndef GL_EXT_shader_texture_lod
float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {
float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));
return max(0.0, 0.5 * log2(deltaMaxSqr));
}
#endif
vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
#ifdef GL_EXT_shader_texture_lod
return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);
#else
vec2 dUVdxAuto = dFdx(uvAtlas);
vec2 dUVdyAuto = dFdy(uvAtlas);
float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);
float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);
return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);
#endif
}`)}function Mae(t,e){switch(t.include(Zg,e),t.fragment.code.add(S`
  struct TextureLookupParameter {
    vec2 uv;
    ${e.supportsTextureAtlas?"vec2 size;":""}
  } vtc;
  `),e.textureCoordinateType){case cs.Default:case cs.Compressed:return void t.fragment.code.add(S`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return texture2D(texture, params.uv);
}`);case cs.Atlas:return t.include(ODe),void t.fragment.code.add(S`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return textureAtlasLookup(texture, params.size, params.uv, vuvRegion);
}`);default:e.textureCoordinateType;case cs.None:case cs.COUNT:return}}let Kh=class extends Ln{constructor(e,r){super(e,"vec3",_i.Draw,(i,n,s,o)=>i.setUniform3fv(e,r(n,s,o)))}},gD=class extends Ln{constructor(e,r){super(e,"vec2",_i.Draw,(i,n,s,o)=>i.setUniform2fv(e,r(n,s,o)))}},zN=class extends Ln{constructor(e,r){super(e,"sampler2D",_i.Draw,(i,n,s)=>i.bindTexture(e,r(n,s)))}};function Ub(t,e,r=oi.None){const i=[new zN(t,e)];if(r&oi.Size){const n=t+Sae;i.push(new gD(n,(s,o)=>{const a=e(s,o);return v(a)?dt(wye,a.descriptor.width,a.descriptor.height):Wc}))}if(r&oi.InvSize){const n=t+HB;i.push(new gD(n,(s,o)=>{const a=e(s,o);return v(a)?dt(wye,1/a.descriptor.width,1/a.descriptor.height):Wc}))}return i}const wye=Ne();let Nw=class{constructor(e){this._material=e.material,this._techniqueRepository=e.techniqueRep,this._output=e.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}get _stippleTextureRepository(){return this._techniqueRepository.constructionContext.stippleTextureRepository}ensureTechnique(e,r){return this._technique=this._techniqueRepository.releaseAndAcquire(e,this._material.getConfiguration(this._output,r),this._technique),this._technique}ensureResources(e){return n_.LOADED}},Pae=class extends Nw{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textureRepository=e.textureRep,this._textureId=e.textureId,this._acquire(e.textureId,r=>this._texture=r),this._acquire(e.normalTextureId,r=>this._textureNormal=r),this._acquire(e.emissiveTextureId,r=>this._textureEmissive=r),this._acquire(e.occlusionTextureId,r=>this._textureOcclusion=r),this._acquire(e.metallicRoughnessTextureId,r=>this._textureMetallicRoughness=r)}dispose(){this._texture=en(this._texture),this._textureNormal=en(this._textureNormal),this._textureEmissive=en(this._textureEmissive),this._textureOcclusion=en(this._textureOcclusion),this._textureMetallicRoughness=en(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return this._numLoading===0?n_.LOADED:n_.LOADING}get textureBindParameters(){return new MDe(v(this._texture)?this._texture.glTexture:null,v(this._textureNormal)?this._textureNormal.glTexture:null,v(this._textureEmissive)?this._textureEmissive.glTexture:null,v(this._textureOcclusion)?this._textureOcclusion.glTexture:null,v(this._textureMetallicRoughness)?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){(R(this._texture)||e!==this._texture.id)&&(this._texture=en(this._texture),this._textureId=e,this._acquire(this._textureId,r=>this._texture=r))}_acquire(e,r){if(R(e))return void r(null);const i=this._textureRepository.acquire(e);if(Ju(i))return++this._numLoading,void i.then(n=>{if(this._disposed)return en(n),void r(null);r(n)}).finally(()=>--this._numLoading);r(i)}},MDe=class extends wi{constructor(e=null,r=null,i=null,n=null,s=null){super(),this.texture=e,this.textureNormal=r,this.textureEmissive=i,this.textureOcclusion=n,this.textureMetallicRoughness=s}};const WHt=ti(0,.6,.2);var _t;(function(t){t[t.Disabled=0]="Disabled",t[t.Normal=1]="Normal",t[t.Schematic=2]="Schematic",t[t.Water=3]="Water",t[t.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",t[t.Terrain=5]="Terrain",t[t.TerrainWithWater=6]="TerrainWithWater",t[t.COUNT=7]="COUNT"})(_t||(_t={}));function Iae(t,e){const r=t.fragment,i=e.hasMetallicRoughnessTexture||e.hasEmissionTexture||e.hasOcclusionTexture;if(e.pbrMode===_t.Normal&&i&&t.include(Mae,e),e.pbrMode!==_t.Schematic)if(e.pbrMode!==_t.Disabled){if(e.pbrMode===_t.Normal){r.code.add(S`vec3 mrr;
vec3 emission;
float occlusion;`);const n=e.supportsTextureAtlas?e.hasWebGL2Context?oi.None:oi.Size:oi.None,s=e.pbrTextureBindType;e.hasMetallicRoughnessTexture&&(r.uniforms.add(s===_i.Pass?rm("texMetallicRoughness",o=>o.textureMetallicRoughness,n):Ub("texMetallicRoughness",o=>o.textureMetallicRoughness,n)),r.code.add(S`void applyMetallnessAndRoughness(TextureLookupParameter params) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),e.hasEmissionTexture&&(r.uniforms.add(s===_i.Pass?rm("texEmission",o=>o.textureEmissive,n):Ub("texEmission",o=>o.textureEmissive,n)),r.code.add(S`void applyEmission(TextureLookupParameter params) {
emission *= textureLookup(texEmission, params).rgb;
}`)),e.hasOcclusionTexture?(r.uniforms.add(s===_i.Pass?rm("texOcclusion",o=>o.textureOcclusion,n):Ub("texOcclusion",o=>o.textureOcclusion,n)),r.code.add(S`void applyOcclusion(TextureLookupParameter params) {
occlusion *= textureLookup(texOcclusion, params).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):r.code.add(S`float getBakedOcclusion() { return 1.0; }`),r.uniforms.add(s===_i.Pass?[new Jt("emissionFactor",o=>o.emissiveFactor),new Jt("mrrFactors",o=>o.mrrFactors)]:[new Kh("emissionFactor",o=>o.emissiveFactor),new Kh("mrrFactors",o=>o.mrrFactors)]),r.code.add(S`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;
      ${i?S`vtc.uv = vuv0;`:""}
      ${e.hasMetallicRoughnessTextureTransform?S`vtc.uv = metallicRoughnessUV;`:""}
      ${e.hasMetallicRoughnessTexture?e.supportsTextureAtlas?S`
                vtc.size = ${yp(e,"texMetallicRoughness")};
                applyMetallnessAndRoughness(vtc);`:S`applyMetallnessAndRoughness(vtc);`:""}
      ${e.hasEmissiveTextureTransform?S`vtc.uv = emissiveUV;`:""}
      ${e.hasEmissionTexture?e.supportsTextureAtlas?S`
                vtc.size = ${yp(e,"texEmission")};
                applyEmission(vtc);`:S`applyEmission(vtc);`:""}
      ${e.hasOcclusionTextureTransform?S`vtc.uv = occlusionUV;`:""}
      ${e.hasOcclusionTexture?e.supportsTextureAtlas?S`
                vtc.size = ${yp(e,"texOcclusion")};
                applyOcclusion(vtc);`:S`applyOcclusion(vtc);`:""}
    }
  `)}}else r.code.add(S`float getBakedOcclusion() { return 1.0; }`);else r.code.add(S`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}function $ae(t,e){const r=t.fragment,i=e.lightingSphericalHarmonicsOrder!==void 0?e.lightingSphericalHarmonicsOrder:2;i===0?(r.uniforms.add(new Jt("lightingAmbientSH0",(n,s)=>he(xye,s.lighting.sh.r[0],s.lighting.sh.g[0],s.lighting.sh.b[0]))),r.code.add(S`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):i===1?(r.uniforms.add([new br("lightingAmbientSH_R",(n,s)=>ai(Ny,s.lighting.sh.r[0],s.lighting.sh.r[1],s.lighting.sh.r[2],s.lighting.sh.r[3])),new br("lightingAmbientSH_G",(n,s)=>ai(Ny,s.lighting.sh.g[0],s.lighting.sh.g[1],s.lighting.sh.g[2],s.lighting.sh.g[3])),new br("lightingAmbientSH_B",(n,s)=>ai(Ny,s.lighting.sh.b[0],s.lighting.sh.b[1],s.lighting.sh.b[2],s.lighting.sh.b[3]))]),r.code.add(S`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):i===2&&(r.uniforms.add([new Jt("lightingAmbientSH0",(n,s)=>he(xye,s.lighting.sh.r[0],s.lighting.sh.g[0],s.lighting.sh.b[0])),new br("lightingAmbientSH_R1",(n,s)=>ai(Ny,s.lighting.sh.r[1],s.lighting.sh.r[2],s.lighting.sh.r[3],s.lighting.sh.r[4])),new br("lightingAmbientSH_G1",(n,s)=>ai(Ny,s.lighting.sh.g[1],s.lighting.sh.g[2],s.lighting.sh.g[3],s.lighting.sh.g[4])),new br("lightingAmbientSH_B1",(n,s)=>ai(Ny,s.lighting.sh.b[1],s.lighting.sh.b[2],s.lighting.sh.b[3],s.lighting.sh.b[4])),new br("lightingAmbientSH_R2",(n,s)=>ai(Ny,s.lighting.sh.r[5],s.lighting.sh.r[6],s.lighting.sh.r[7],s.lighting.sh.r[8])),new br("lightingAmbientSH_G2",(n,s)=>ai(Ny,s.lighting.sh.g[5],s.lighting.sh.g[6],s.lighting.sh.g[7],s.lighting.sh.g[8])),new br("lightingAmbientSH_B2",(n,s)=>ai(Ny,s.lighting.sh.b[5],s.lighting.sh.b[6],s.lighting.sh.b[7],s.lighting.sh.b[8]))]),r.code.add(S`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),e.pbrMode!==_t.Normal&&e.pbrMode!==_t.Schematic||r.code.add(S`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const xye=P(),Ny=pr();function VN(t){t.vertex.code.add(S`const float PI = 3.141592653589793;`),t.fragment.code.add(S`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}var Hn,y2;function f_t(t){return v(t)&&v(t.cubeMap)}function Lae(t){return v(t)&&!t.running}(function(t){t[t.RENDERING=0]="RENDERING",t[t.FINISHED_RENDERING=1]="FINISHED_RENDERING",t[t.FADING_TEXTURE_CHANNELS=2]="FADING_TEXTURE_CHANNELS",t[t.SWITCH_CHANNELS=3]="SWITCH_CHANNELS",t[t.FINISHED=4]="FINISHED"})(Hn||(Hn={})),function(t){t[t.RG=0]="RG",t[t.BA=1]="BA"}(y2||(y2={}));let m_t=class{constructor(){this.readChannels=y2.RG,this.renderingStage=Hn.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=P(),this.isCameraPositionFinal=!0,this.parallax=new Tye,this.parallaxNew=new Tye,this.crossFade={enabled:!1,factor:1,distanceThresholdFactor:.3},this.fadeInOut={stage:io.FINISHED,factor:1,distanceThresholdFactor:.6},this.fadeIn={stage:Au.FINISHED,factor:1,distanceThresholdFactor:2},this.fadeInOutHeight={stage:hw.FINISHED,factor:-1}}get isFading(){return this.fadeInOut.stage===io.FADE_OUT||this.fadeInOut.stage===io.FADE_IN||this.fadeIn.stage===Au.FADE_IN||this.fadeInOutHeight.stage!==hw.FINISHED||this.renderingStage===Hn.FADING_TEXTURE_CHANNELS}};var Au,io,hw;(function(t){t[t.FINISHED=0]="FINISHED",t[t.CHANGE_ANCHOR=1]="CHANGE_ANCHOR",t[t.FADE_IN=2]="FADE_IN"})(Au||(Au={})),function(t){t[t.FINISHED=0]="FINISHED",t[t.FADE_OUT=1]="FADE_OUT",t[t.SWITCH=2]="SWITCH",t[t.FADE_IN=3]="FADE_IN"}(io||(io={})),function(t){t[t.FINISHED=0]="FINISHED",t[t.HEIGHT_FADE=1]="HEIGHT_FADE"}(hw||(hw={}));let Tye=class{constructor(){this.anchorPointClouds=P(),this.cloudsHeight=1e5,this.radiusCurvatureCorrectionFactor=0,this.transform=$e()}},s_=class extends Ln{constructor(e,r){super(e,"bool",_i.Pass,(i,n,s)=>i.setUniform1b(e,r(n,s)))}},g_t=class extends Ln{constructor(e,r){super(e,"samplerCube",_i.Pass,(i,n,s)=>i.bindTexture(e,r(n,s)))}};function PDe(t){const e=t.fragment;e.uniforms.add([new rn("rotationMatrixClouds",(r,i)=>i.cloudsFade.parallax.transform),new rn("rotationMatrixCloudsCrossFade",(r,i)=>i.cloudsFade.parallaxNew.transform),new Jt("anchorPosition",(r,i)=>i.cloudsFade.parallax.anchorPointClouds),new Jt("anchorPositionCrossFade",(r,i)=>i.cloudsFade.parallaxNew.anchorPointClouds),new Ie("cloudsHeight",(r,i)=>i.cloudsFade.parallax.cloudsHeight),new Ie("radiusCurvatureCorrectionFactor",(r,i)=>i.cloudsFade.parallax.radiusCurvatureCorrectionFactor),new Ie("totalFadeInOut",(r,i)=>i.cloudsFade.fadeInOut.stage===io.FINISHED?i.cloudsFade.fadeInOutHeight.factor+1-i.cloudsFade.fadeIn.factor:i.cloudsFade.fadeInOutHeight.factor+1-i.cloudsFade.fadeInOut.factor),new Ie("crossFadeAnchorFactor",(r,i)=>_e(i.cloudsFade.crossFade.factor,0,1)),new g_t("cubeMap",(r,i)=>v(i.cloudsFade.data)&&v(i.cloudsFade.data.cubeMap)?i.cloudsFade.data.cubeMap.colorTexture:null),new s_("crossFade",(r,i)=>i.cloudsFade.crossFade.enabled),new s_("readChannelsRG",(r,i)=>i.cloudsFade.readChannels===y2.RG),new s_("fadeTextureChannels",(r,i)=>i.cloudsFade.renderingStage===Hn.FADING_TEXTURE_CHANNELS)]),e.constants.add("planetRadius","float",Cr.radius),e.code.add(S`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),e.code.add(S`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),e.code.add(S`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),U_(e),vy(e),e.code.add(S`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),e.code.add(S`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = textureCube(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`),e.code.add(S`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),e.code.add(S`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),e.code.add(S`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}function by(t){t.code.add(S`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function y_t(){const t=new Br;t.attributes.add(O.POSITION,"vec2"),t.varyings.add("worldRay","vec3");const{vertex:e,fragment:r}=t;return e.uniforms.add([new rn("inverseProjectionMatrix",(i,n)=>n.camera.inverseProjectionMatrix),new rn("inverseViewMatrix",(i,n)=>_3(__t,n.camera.viewMatrix))]),e.code.add(S`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),r.include(by),r.include(Qu),t.include($ae,{pbrMode:_t.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(VN),t.include(GB),t.include(eV,{useLegacyTerrainShading:!1}),t.include(PDe,{instancedDoublePrecision:!1,useLegacyTerrainShading:!1}),r.uniforms.add([new Jt("cameraPosition",(i,n)=>n.camera.eye)]),r.code.add(S`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
gl_FragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),t}const __t=$e(),v_t=Object.freeze(Object.defineProperty({__proto__:null,build:y_t},Symbol.toStringTag,{value:"Module"}));let IDe=class $De extends Wr{constructor(e){super(e,new _l,()=>this.destroy())}initializeProgram(e){return new Gr(e.rctx,$De.shader.get().build(),Lr)}initializePipeline(){return Ht({blending:mo(Ce.ONE,Ce.ZERO,Ce.SRC_ALPHA,Ce.ONE),depthTest:{func:zi.LEQUAL},colorWrite:ir})}};IDe.shader=new jr(v_t,()=>Q(()=>import("./CloudsComposition.glsl-78abaa01.js"),[]));let ST=class extends be{constructor(e){super(e),this._technique=new IDe(e),this._vao=vl(e.rctx)}destroy(){this._technique=en(this._technique),this._vao=rt(this._vao)}render(e){const r=e.bindParameters.cloudsFade;if(R(this._vao)||R(r.data))return;if(!this._technique.compiled)return void this.requestRender();const i=e.rctx.bindTechnique(this._technique,b_t,e.bindParameters);e.rctx.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays(Ft.TRIANGLE_STRIP,0,4)}};u([d({constructOnly:!0})],ST.prototype,"rctx",void 0),u([d({constructOnly:!0})],ST.prototype,"viewingMode",void 0),u([d({constructOnly:!0})],ST.prototype,"planetRadius",void 0),u([d({constructOnly:!0})],ST.prototype,"requestRender",void 0),ST=u([$("esri.views.3d.environment.CloudsComposition")],ST);const b_t=new wi;var Uc;(function(t){t[t.SIXTEEN=0]="SIXTEEN",t[t.HUNDRED=1]="HUNDRED",t[t.TWOHUNDRED=2]="TWOHUNDRED",t[t.COUNT=3]="COUNT"})(Uc||(Uc={}));let SU=class extends _l{constructor(){super(...arguments),this.steps=Uc.SIXTEEN,this.writeTextureChannels=y2.RG}};u([j({count:Uc.COUNT})],SU.prototype,"steps",void 0),u([j({constValue:ue("esri-mobile")?1024:2048})],SU.prototype,"cubeMapSize",void 0),u([j()],SU.prototype,"writeTextureChannels",void 0);let PI=class{constructor(e,r,i,n,s,o,a,l,c=.5){this.coverage=e,this.density=r,this.absorption=i,this.cloudSize=n,this.detailSize=s,this.smoothness=o,this.cloudHeight=a,this.raymarchingSteps=l,this.median=c}};const Sye=new PI([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],Uc.SIXTEEN),Ka={sunny:Sye,cloudy:new PI([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],Uc.TWOHUNDRED,.6),rainy:new PI([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],Uc.TWOHUNDRED,.4),snowy:new PI([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],Uc.HUNDRED,.65),foggy:new PI([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],Uc.SIXTEEN),default:Sye},Xd=ue("esri-mobile")?64:128,w_t=Xd/128,Ef=Math.ceil(Math.sqrt(Xd)),Ff=(Xd+2)*Ef,x_t=1e5,UH=128,T_t=Ff/1560;function Np(t,e=!0){t.attributes.add(O.POSITION,"vec2"),e&&t.varyings.add("uv","vec2"),t.vertex.code.add(S`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${e?S`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}let yD=class extends Ln{constructor(e,r){super(e,"mat3",_i.Draw,(i,n,s)=>i.setUniformMatrix3fv(e,r(n,s)))}},LDe=class extends wi{constructor(){super(...arguments),this.cloudRadius=0,this.cloudSize=0,this.detailSize=0,this.absorption=0,this.density=0,this.smoothness=0,this.cloudHeight=0,this.coverage=0,this.raymarchingSteps=Ka.default.raymarchingSteps,this.weatherTile=Ne()}},DDe=class extends wi{constructor(){super(...arguments),this.viewMatrix=vi()}};function S_t(t){const e=new Br;e.include(Np,!1);const r=e.fragment;return r.uniforms.add([new Ie("cloudRadius",i=>i.cloudRadius),new Ie("power",i=>Bt(35,120,i.absorption)),new Ie("sigmaE",i=>1+i.absorption),new Ie("density",i=>Bt(0,.3,i.density)),new Ie("cloudSize",i=>Bt(0,.02,Math.max(.01,1-i.cloudSize))),new Ie("detailSize",i=>Bt(0,.2,Math.max(.01,1-i.detailSize))),new Ie("smoothness",i=>Bt(0,.5,1-i.smoothness)),new Ie("cloudHeight",i=>Bt(0,1500,i.cloudHeight)),new Ie("coverage",i=>i.coverage),new yD("view",i=>i.viewMatrix),new Dt("cloudShapeTexture",i=>v(i.noiseTexture)?i.noiseTexture.textureAtlas:null),new Hr("cloudVariables",i=>dt(E_t,i.coverage,i.absorption))]),r.constants.add("halfCubeMapSize","float",.5*t.cubeMapSize),r.code.add(S`
    const int STEPS = ${t.steps===Uc.SIXTEEN?S`16`:t.steps===Uc.HUNDRED?S`100`:S`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),r.code.add(S`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${S.float(Ff)};
      const float dataWidth = ${S.float(Ff)};
      const float tileRows = ${S.float(Ef)};
      const vec3 atlasDimensions = vec3(${S.float(Xd)}, ${S.float(Xd)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${S.float(w_t)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture2D(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Non-power-of-two textures can't be tiled using WebGL1
      // Get fractional part of uv to tile
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = fract((${S.float(T_t)} * p) / ${S.float(Ff)} + 0.5);

      return texture2D(cloudShapeTexture, uv).a;
    }
    `),r.code.add(S`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),r.code.add(S`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),r.code.add(`
    float multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      float luminance = 0.0;

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),r.code.add(S`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),r.code.add(S`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`),r.code.add(S`void main() {
if (coverage ==  0.0) {
gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
gl_FragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
gl_FragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`),e}const E_t=Ne(),C_t=Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:DDe,CloudsPassParameters:LDe,build:S_t},Symbol.toStringTag,{value:"Module"}));let NDe=class FDe extends Wr{constructor(e,r){super(e,r,()=>this.destroy())}initializeProgram(e){return new Gr(e.rctx,FDe.shader.get().build(this.configuration),Lr)}initializePipeline(){return Ht({blending:bm(Ce.CONSTANT_COLOR,Ce.ONE_MINUS_CONSTANT_COLOR,hy.ADD,this.configuration.writeTextureChannels===y2.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:zi.LEQUAL},colorWrite:ir})}};NDe.shader=new jr(C_t,()=>Q(()=>import("./Clouds.glsl-8c077935.js"),[]));var Gh;(function(t){t[t.Full=0]="Full",t[t.WeatherMap=1]="WeatherMap",t[t.COUNT=2]="COUNT"})(Gh||(Gh={}));let see=class extends _l{constructor(){super(...arguments),this.mode=Gh.Full}};u([j({count:Gh.COUNT})],see.prototype,"mode",void 0);let kDe=class extends wi{constructor(){super(...arguments),this.weatherTile=Rr(0,0)}};function A_t(t){const e=new Br;return e.include(Np,!1),e.fragment.code.add(S`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),t.mode===Gh.Full&&e.fragment.code.add(S`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${S.float(Ef)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${S.float(8)});

      float worley0 = worley(p, ${S.float(2)} * 2.0);
      float worley1 = worley(p, ${S.float(2)} * 8.0);
      float worley2 = worley(p, ${S.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${S.float(2)});
      float worley1 = worley(p, ${S.float(2)} * 2.0);
      float worley2 = worley(p, ${S.float(2)} * 4.0);
      float worley3 = worley(p, ${S.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),e.fragment.uniforms.add(new Hr("weatherTile",r=>r.weatherTile)),e.fragment.code.add(S`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${S.float(UH)});

      // Get global coordinates of p
      p += weatherTile * ${S.float(UH)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${S.float(x_t)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),e.fragment.code.add(S`void main() {`),t.mode===Gh.Full&&e.fragment.code.add(S`
        float padWidth = 1.0;
        float paddedSize = ${S.float(Xd)} + 2.0 * padWidth;
        float tileCount = ${S.float(Ef)} * ${S.float(Ef)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${S.float(Xd)};
          }

          if (startPadY) {
            pixel.y += ${S.float(Xd)};
          }

          if (endPadX) {
            pixel.x -= ${S.float(Xd)};
          }

          if (endPadY) {
            pixel.y -= ${S.float(Xd)};
          }

          uv = vec2(pixel.xy / ${S.float(Xd)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${S.float(Xd)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${S.float(Ef)} * ${S.float(Ef)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${S.float(Ef)} * ${S.float(Ef)});
        p = p_;
        p.z /= (${S.float(Ef)} * ${S.float(Ef)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),e.fragment.code.add(S`
      vec2 mapUV = ${S.float(UH)} * (gl_FragCoord.xy / ${S.float(Ff)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${t.mode===Gh.Full?S`gl_FragColor.ba = vec2(0.0, map);`:S`gl_FragColor = vec4(map);`};
    }
  `),e}const R_t=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:kDe,build:A_t},Symbol.toStringTag,{value:"Module"}));let oee=class UDe extends Wr{initializeProgram(e){return new Gr(e.rctx,UDe.shader.get().build(this.configuration),Lr)}initializePipeline(){return Ht({blending:this.configuration.mode===Gh.Full?bm(Ce.ONE,Ce.ZERO):mo(Ce.ZERO,Ce.ONE,Ce.ONE,Ce.ZERO),depthTest:{func:zi.ALWAYS},colorWrite:ir})}};oee.shader=new jr(R_t,()=>Q(()=>import("./NoiseTextureAtlas.glsl-91f34592.js"),[]));let cA=class{constructor(e,r){this._context=e,this._desc=r,this.type="renderbuffer",this._context.instanceCounter.increment(ho.Renderbuffer,this);const i=this._context.gl;this.glName=i.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:n,height:s,internalFormat:o,multisampled:a}=r;if(a){if(this._context.type!==Et.WEBGL2)throw new Error("Multisampled renderbuffers are not supported in WebGL1!");i.renderbufferStorageMultisample(i.RENDERBUFFER,this.samples,o,n,s)}else i.renderbufferStorage(i.RENDERBUFFER,o,n,s)}get descriptor(){return this._desc}get samples(){const e=this._desc.samples,r=this._context.parameters.maxSamples;return e?Math.min(e,r):r}resize(e,r){const i=this._desc;if(i.width===e&&i.height===r)return;i.width=e,i.height=r;const n=this._context.gl;this._context.bindRenderbuffer(this),i.multisampled?n.renderbufferStorageMultisample(n.RENDERBUFFER,this.samples,i.internalFormat,i.width,i.height):n.renderbufferStorage(n.RENDERBUFFER,i.internalFormat,i.width,i.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(ho.Renderbuffer,this),this._context=XS(this._context))}},Jn=class uA{constructor(e,r,i=null,n=null){if(this._context=e,this._glName=null,this._depthAttachment=null,this._stencilAttachment=null,this._colorAttachments=new Map,this._depthStencilTexture=null,this._initialized=!1,this._desc={...r},e.instanceCounter.increment(ho.FramebufferObject,this),v(i)){Array.isArray(i)||(i=[i]);for(let s=0;s<i.length;++s){const o=i[s],a=Ah.COLOR_ATTACHMENT0+s;let l;Cye(o)?(y0(o)?(l=o.descriptor,this._colorAttachments.set(a,o)):(l=o,this._colorAttachments.set(a,new mt(this._context,l))),V4(l,this._desc)):(Eye(o)?(l=o.descriptor,this._colorAttachments.set(a,o)):(l=o,this._colorAttachments.set(a,new cA(this._context,l))),zH(l,this._desc)),this._validateColorAttachmentPoint(a)}}if(v(n)){let s,o;if(Cye(n))this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),y0(n)?(o=n.descriptor,this._depthStencilTexture=n):(o=n,this._depthStencilTexture=new mt(this._context,o)),V4(o,this._desc);else{Eye(n)?(o=n.descriptor,s=n):(o=n,s=new cA(this._context,o));const a=this._desc.depthStencilTarget??Ur.DEPTH_STENCIL_RENDER_BUFFER;a===Ur.STENCIL_RENDER_BUFFER?this._stencilAttachment=s:a===Ur.DEPTH_RENDER_BUFFER||a===Ur.DEPTH_STENCIL_RENDER_BUFFER?this._depthAttachment=s:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),this._desc.depthStencilTarget=a,zH(o,this._desc)}}}dispose(){if(!this._desc)return;const e=this._context.getBoundFramebufferObject();this._disposeColorAttachments(),this._disposeDepthStencilAttachments(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(e),this._context.instanceCounter.decrement(ho.FramebufferObject,this),this._desc=null}get glName(){return this._glName}get descriptor(){return this._desc}get colorTexture(){const e=this._colorAttachments.get(Ah.COLOR_ATTACHMENT0);return e&&y0(e)?e:null}get colorAttachment(){return this._colorAttachments.get(Ah.COLOR_ATTACHMENT0)}get depthStencilAttachment(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._desc.width??0}get height(){return this._desc.height??0}get gpuMemoryUsage(){return[...this._colorAttachments].reduce((e,[r,i])=>e+g2(i),0)+g2(this.depthStencilAttachment)}getColorTexture(e){const r=this._colorAttachments.get(e);return r&&y0(r)?r:null}attachColorTexture(e,r=Ah.COLOR_ATTACHMENT0){e&&(this._validateColorAttachmentPoint(r),V4(e.descriptor,this._desc),this._disposeColorAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,r)),this._colorAttachments.set(r,e))}detachColorTexture(e=Ah.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(e);if(y0(r)){const i=r;return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e)),this._colorAttachments.delete(e),i}}setColorTextureTarget(e,r=Ah.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(r);y0(i)&&this._framebufferTexture2D(i.glName,r,e)}attachDepthStencilTexture(e){if(R(e))return;const r=e.descriptor;r.pixelFormat!==Ge.DEPTH_STENCIL&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),r.dataType!==kt.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),V4(r,this._desc),this._desc.depthStencilTarget&&this._desc.depthStencilTarget!==Ur.DEPTH_STENCIL_TEXTURE&&(this._desc.depthStencilTarget=Ur.DEPTH_STENCIL_TEXTURE),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,fye)),this._depthStencilTexture=e}detachDepthStencilTexture(){const e=this._depthStencilTexture;return e&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,fye)),this._depthStencilTexture=null,e}attachDepthStencilBuffer(e){if(R(e))return;const r=e.descriptor;if(r.internalFormat!==Ul.DEPTH_STENCIL&&r.internalFormat!==Ul.DEPTH_COMPONENT16&&console.error("Depth/Stencil buffer must have correct internalFormat"),zH(r,this._desc),this._disposeDepthStencilAttachments(),this._desc.depthStencilTarget=r.internalFormat===Ul.DEPTH_STENCIL?Ur.DEPTH_STENCIL_RENDER_BUFFER:Ur.DEPTH_RENDER_BUFFER,this._initialized){this._context.bindFramebuffer(this);const i=this._context.gl,n=this._desc.depthStencilTarget===Ur.DEPTH_RENDER_BUFFER?i.DEPTH_ATTACHMENT:i.DEPTH_STENCIL_ATTACHMENT;i.framebufferRenderbuffer(Ro.FRAMEBUFFER,n,i.RENDERBUFFER,e.glName)}this._depthAttachment=e}detachDepthStencilBuffer(){const e=this._context.gl,r=this._depthAttachment;if(r&&this._initialized){this._context.bindFramebuffer(this);const i=this._desc.depthStencilTarget===Ur.DEPTH_RENDER_BUFFER?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(Ro.FRAMEBUFFER,i,e.RENDERBUFFER,null)}return this._depthAttachment=null,r}detachAll(){this._colorAttachments.forEach((e,r)=>this._detachColorAttachment(r)),this.detachDepthStencilBuffer(),this.detachDepthStencilTexture()}copyToTexture(e,r,i,n,s,o,a){(e<0||r<0||s<0||o<0)&&console.error("Offsets cannot be negative!"),(i<=0||n<=0)&&console.error("Copy width and height must be greater than zero!");const l=this._desc,c=a.descriptor;a.descriptor.target!==Ct.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),((l==null?void 0:l.width)==null||(l==null?void 0:l.height)==null||(c==null?void 0:c.width)==null||(c==null?void 0:c.height)==null||e+i>l.width||r+n>l.height||s+i>c.width||o+n>c.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const h=this._context,p=h.bindTexture(a,mt.TEXTURE_UNIT_FOR_UPDATES);h.setActiveTexture(mt.TEXTURE_UNIT_FOR_UPDATES),h.bindFramebuffer(this),h.gl.copyTexSubImage2D(Ct.TEXTURE_2D,0,s,o,e,r,i,n),h.bindTexture(p,mt.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,r,i,n,s,o,a){(i<=0||n<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,r,i,n,s,o,a)}async readPixelsAsync(e,r,i,n,s,o,a){if(this._context.type!==Et.WEBGL2)return Ih()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),void this.readPixels(e,r,i,n,s,o,a);const l=this._context.gl,c=Kr.createPixelPack(this._context,zr.STREAM_READ,a.byteLength);this._context.bindBuffer(c),this._context.bindFramebuffer(this),l.readPixels(e,r,i,n,s,o,0),this._context.unbindBuffer(Lt.PIXEL_PACK_BUFFER),await c.getSubDataAsync(a),c.dispose()}resize(e,r){const i=this._desc;if(i.width!==e||i.height!==r){if(i.width=e,i.height=r,!this._initialized)return this._colorAttachments.forEach(n=>{n&&n.resize(e,r)}),void(this._depthStencilTexture&&this._depthStencilTexture.resize(e,r));this._colorAttachments.forEach(n=>{n&&n.resize(e,r)}),this._depthStencilTexture!=null?this._depthStencilTexture.resize(e,r):(this._depthAttachment||this._stencilAttachment)&&(this._depthAttachment&&this._depthAttachment.resize(e,r),this._stencilAttachment&&this._stencilAttachment.resize(e,r)),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1}}initializeAndBind(e=Ro.FRAMEBUFFER){const r=this._context.gl;if(this._initialized)return void r.bindFramebuffer(e,this.glName);this._glName&&r.deleteFramebuffer(this._glName);const i=this._context,n=r.createFramebuffer(),s=this._desc,o=s.colorTarget??xn.RENDER_BUFFER,a=s.width??1,l=s.height??1;if(r.bindFramebuffer(e,n),this._colorAttachments.size===0)if(o===xn.TEXTURE||o===xn.CUBEMAP)this._colorAttachments.set(Ah.COLOR_ATTACHMENT0,O_t(i,s,this.descriptor.colorTarget===xn.CUBEMAP?Ct.TEXTURE_CUBE_MAP:Ct.TEXTURE_2D));else{const h=new cA(i,{internalFormat:Ot.RGBA4,width:a,height:l});this._colorAttachments.set(Ah.COLOR_ATTACHMENT0,h)}this._colorAttachments.forEach((h,p)=>{h&&(y0(h)?this._framebufferTexture2D(h.glName,p,Aye(h),e):r.framebufferRenderbuffer(e,p,r.RENDERBUFFER,h.glName))});const c=s.depthStencilTarget??Ur.NONE;switch(c){case Ur.DEPTH_RENDER_BUFFER:case Ur.DEPTH_STENCIL_RENDER_BUFFER:{this._depthAttachment||(this._depthAttachment=new cA(i,{internalFormat:s.depthStencilTarget===Ur.DEPTH_RENDER_BUFFER?Ul.DEPTH_COMPONENT16:Ul.DEPTH_STENCIL,width:a,height:l}));const h=c===Ur.DEPTH_RENDER_BUFFER?r.DEPTH_ATTACHMENT:r.DEPTH_STENCIL_ATTACHMENT;r.framebufferRenderbuffer(e,h,r.RENDERBUFFER,this._depthAttachment.glName);break}case Ur.STENCIL_RENDER_BUFFER:this._stencilAttachment||(this._stencilAttachment=new cA(i,{internalFormat:Ul.STENCIL_INDEX8,width:a,height:l})),r.framebufferRenderbuffer(e,r.STENCIL_ATTACHMENT,r.RENDERBUFFER,this._stencilAttachment.glName);break;case Ur.DEPTH_STENCIL_TEXTURE:if(!this._depthStencilTexture){i.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!");const h={target:Ct.TEXTURE_2D,pixelFormat:Ge.DEPTH_STENCIL,dataType:kt.UNSIGNED_INT_24_8,samplingMode:it.NEAREST,wrapMode:$t.CLAMP_TO_EDGE,width:a,height:l};this._depthStencilTexture=new mt(i,h)}this._framebufferTexture2D(this._depthStencilTexture.glName,r.DEPTH_STENCIL_ATTACHMENT,Aye(this._depthStencilTexture),e)}Ih()&&r.checkFramebufferStatus(e)!==r.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=n,this._initialized=!0}_framebufferTexture2D(e,r=Ah.COLOR_ATTACHMENT0,i=Ct.TEXTURE_2D,n=Ro.FRAMEBUFFER,s=0){this._context.gl.framebufferTexture2D(n,r,i,e,s)}_detachColorAttachment(e){Ih()&&console.warn("Detaching an FBO attachment can be a slow due to invalidating framebuffer completeness!");const r=this._context.gl,i=this._colorAttachments.get(e);return y0(i)?this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e)):this._initialized&&(this._context.bindFramebuffer(this),r.framebufferRenderbuffer(Ro.FRAMEBUFFER,e,r.RENDERBUFFER,null)),this._colorAttachments.delete(e),i}_disposeColorAttachments(){this._colorAttachments.forEach((e,r)=>{this._detachColorAttachment(r),e.dispose()}),this._colorAttachments.clear()}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthAttachment){if(this._initialized){this._context.bindFramebuffer(this);const r=this._desc.depthStencilTarget===Ur.DEPTH_RENDER_BUFFER?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(Ro.FRAMEBUFFER,r,e.RENDERBUFFER,null)}this._depthAttachment.dispose(),this._depthAttachment=null}this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),e.framebufferRenderbuffer(Ro.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)}_validateColorAttachmentPoint(e){if(uA._MAX_COLOR_ATTACHMENTS===-1){const i=this._context.capabilities.drawBuffers;if(i){const n=this._context.gl;uA._MAX_COLOR_ATTACHMENTS=n.getParameter(i.MAX_COLOR_ATTACHMENTS)}else uA._MAX_COLOR_ATTACHMENTS=1}const r=e-Ah.COLOR_ATTACHMENT0;r+1>uA._MAX_COLOR_ATTACHMENTS&&re.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${r+1}. Implementation supports up to ${uA._MAX_COLOR_ATTACHMENTS} color attachments`)}};function y0(t){return t!=null&&"type"in t&&t.type==="texture"}function Eye(t){return t!=null&&"type"in t&&t.type==="renderbuffer"}function Cye(t){return y0(t)||t!=null&&"pixelFormat"in t}function O_t(t,e,r){return new mt(t,{target:r,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:it.NEAREST,wrapMode:$t.CLAMP_TO_EDGE,width:e.width,height:e.height})}function V4(t,e){t.target!==Ct.TEXTURE_2D&&t.target!==Ct.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),e.width!==void 0&&e.width>=0&&e.height!==void 0&&e.height>=0?e.width===t.width&&e.height===t.height||console.error("Color attachment texture must match the framebuffer's!"):(e.width=t.width,e.height=t.height)}function zH(t,e){e.width!==void 0&&e.width>=0&&e.height!==void 0&&e.height>=0?e.width===t.width&&e.height===t.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(e.width=t.width,e.height=t.height)}function Aye(t){return t.descriptor.target===Ct.TEXTURE_CUBE_MAP?Ct.TEXTURE_CUBE_MAP_POSITIVE_X:Ct.TEXTURE_2D}Jn._MAX_COLOR_ATTACHMENTS=-1;let II=class extends be{constructor(e){super(e),this._needsRender=!0,this._passParameters=new kDe,this._frameBuffer=new Jn(e.context.renderContext.rctx,{colorTarget:xn.TEXTURE,width:Ff,height:Ff},{target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE,samplingMode:it.LINEAR,hasMipmap:!1,width:Ff,height:Ff}),this._vao=vl(e.context.renderContext.rctx)}get _techniqueRepository(){return this.context.techniqueRepository}get textureAtlas(){return v(this._texture)?v(this._weatherMapTechnique)&&this._weatherMapTechnique.compiled&&this._needsRender&&(this._texture=this._render(Gh.WeatherMap)):v(this._fullTechnique)&&this._fullTechnique.compiled&&(this._texture=this._render(Gh.Full)),this._texture}_setDirty(){this._needsRender=!0}updateWeatherMap(e){this._passParameters.weatherTile[0]===e[0]&&this._passParameters.weatherTile[1]===e[1]||(Qs(this._passParameters.weatherTile,e),this._setDirty())}destroy(){this._fullTechniqueCached=en(this._fullTechniqueCached),this._weatherMapTechniqueCached=en(this._weatherMapTechniqueCached),this._frameBuffer=rt(this._frameBuffer),this._vao=rt(this._vao)}get _fullTechnique(){if(R(this._fullTechniqueCached)){const e=new see;e.mode=Gh.Full,this._fullTechniqueCached=this._techniqueRepository.acquire(oee,e)}return this._fullTechniqueCached}get _weatherMapTechnique(){if(R(this._weatherMapTechniqueCached)){const e=new see;e.mode=Gh.WeatherMap,this._weatherMapTechniqueCached=this._techniqueRepository.acquire(oee,e)}return this._weatherMapTechniqueCached}_render(e){if(R(this._vao)||R(this._frameBuffer))return null;const r=e===Gh.Full?this._fullTechnique:this._weatherMapTechnique,i=this.context.renderContext.rctx,n=i.getViewport();i.setViewport(0,0,Ff,Ff),i.bindFramebuffer(this._frameBuffer);const s=i.bindTechnique(r,this._passParameters,null);return i.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao),i.gl.drawArrays(i.gl.TRIANGLE_STRIP,0,4),i.setViewport(n.x,n.y,n.width,n.height),this._needsRender=!1,this._frameBuffer.colorTexture}};u([d({constructOnly:!0})],II.prototype,"context",void 0),u([d({readOnly:!0})],II.prototype,"_techniqueRepository",null),II=u([$("esri.views.3d.environment.NoiseTextureAtlas")],II);function zDe(t){t.include(sd),t.uniforms.add([new Dt("geometryDepthTexture",(e,r)=>r.multipassGeometry.linearDepthTexture),new Hr("nearFar",(e,r)=>r.camera.nearFar)]),t.code.add(S`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}let M_t=class{constructor(){this.enabled=!1}};function od(t,e){e.hasMultipassTerrain&&(t.fragment.include(sd),t.fragment.uniforms.add(new Dt("terrainDepthTexture",(r,i)=>i.multipassTerrain.linearDepthTexture)),t.fragment.uniforms.add(new Hr("nearFar",(r,i)=>i.camera.nearFar)),t.fragment.uniforms.add(new Hr("inverseViewport",(r,i)=>i.inverseViewport)),t.fragment.code.add(S`
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){
      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${e.cullAboveGround?">":"<="} terrainDepth){
        discard;
      }
    }
  `))}let P_t=class{constructor(){this.enabled=!1,this.cullAboveGround=!1}};function I_t(t,e){const r=t.fragment;r.include(sd),r.uniforms.add(new Hr("nearFar",(i,n)=>n.camera.nearFar)),r.uniforms.add(new Dt("depthMap",(i,n)=>n.linearDepthTexture)),r.uniforms.add(new rn("proj",(i,n)=>n.ssr.camera.projectionMatrix)),r.uniforms.add(new Ie("invResolutionHeight",(i,n)=>1/n.ssr.camera.height)),r.uniforms.add(new rn("reprojectionMatrix",(i,n)=>n.ssr.reprojectionMatrix)),r.code.add(S`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${e.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}let $_t=class{constructor(){this.enabled=!1,this.fadeFactor=1,this.reprojectionMatrix=$e()}};function WB(t){return t?{ray:Do(t.ray),c0:t.c0,c1:t.c1}:{ray:Do(),c0:0,c1:Number.MAX_VALUE}}function L_t(t,e=WB()){return Kz(t,e.ray),e.c0=0,e.c1=Number.MAX_VALUE,e}function D_t(t,e,r=WB()){const i=Pe(t.vector);return wLe(t.origin,e,r.ray),r.c0=0,r.c1=i,r}function hqt(t,e){return VDe(t,t.c0,e)}function dqt(t,e){return VDe(t,t.c1,e)}function VDe(t,e,r){return me(r,t.ray.origin,le(r,t.ray.direction,e))}new F_(()=>WB());function _D(t){return t?[Yr(t[0]),Yr(t[1]),Yr(t[2]),Yr(t[3]),Yr(t[4]),Yr(t[5])]:[Yr(),Yr(),Yr(),Yr(),Yr(),Yr()]}function BDe(){return[P(),P(),P(),P(),P(),P(),P(),P()]}function iV(t,e){for(let r=0;r<dw.NUM;r++)kB(t[r],e[r])}function jDe(t,e,r,i=z_t){const n=Mn(cae.get(),e,t);ya(n,n);for(let s=0;s<aee.NUM;++s){const o=qh(lae.get(),U_t[s],n);he(i[s],o[0]/o[3],o[1]/o[3],o[2]/o[3])}GDe(r,i)}function GDe(t,e){rl(e[lt.FAR_BOTTOM_LEFT],e[lt.NEAR_BOTTOM_LEFT],e[lt.NEAR_TOP_LEFT],t[Ai.LEFT]),rl(e[lt.NEAR_BOTTOM_RIGHT],e[lt.FAR_BOTTOM_RIGHT],e[lt.FAR_TOP_RIGHT],t[Ai.RIGHT]),rl(e[lt.FAR_BOTTOM_LEFT],e[lt.FAR_BOTTOM_RIGHT],e[lt.NEAR_BOTTOM_RIGHT],t[Ai.BOTTOM]),rl(e[lt.NEAR_TOP_LEFT],e[lt.NEAR_TOP_RIGHT],e[lt.FAR_TOP_RIGHT],t[Ai.TOP]),rl(e[lt.NEAR_BOTTOM_LEFT],e[lt.NEAR_BOTTOM_RIGHT],e[lt.NEAR_TOP_RIGHT],t[Ai.NEAR]),rl(e[lt.FAR_BOTTOM_RIGHT],e[lt.FAR_BOTTOM_LEFT],e[lt.FAR_TOP_LEFT],t[Ai.FAR])}function bb(t,e){for(let r=0;r<dw.NUM;r++){const i=t[r];if(i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]>=e[3])return!1}return!0}function N_t(t,e){return qDe(t,L_t(e,WDe.get()))}function pqt(t,e){for(let r=0;r<dw.NUM;r++){const i=t[r];if(!dyt(i,e))return!1}return!0}function F_t(t,e,r){return qDe(t,D_t(e,r,WDe.get()))}function HDe(t,e){for(let r=0;r<dw.NUM;r++)if(Ri(t[r],e)>0)return!1;return!0}function qDe(t,e){for(let r=0;r<dw.NUM;r++)if(!hyt(t[r],e))return!1;return!0}var Ai,lt;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.TOP=3]="TOP",t[t.NEAR=4]="NEAR",t[t.FAR=5]="FAR"})(Ai||(Ai={})),function(t){t[t.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",t[t.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",t[t.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",t[t.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",t[t.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",t[t.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",t[t.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",t[t.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(lt||(lt={}));const k_t={bottom:[lt.FAR_BOTTOM_RIGHT,lt.NEAR_BOTTOM_RIGHT,lt.NEAR_BOTTOM_LEFT,lt.FAR_BOTTOM_LEFT],near:[lt.NEAR_BOTTOM_LEFT,lt.NEAR_BOTTOM_RIGHT,lt.NEAR_TOP_RIGHT,lt.NEAR_TOP_LEFT],far:[lt.FAR_BOTTOM_RIGHT,lt.FAR_BOTTOM_LEFT,lt.FAR_TOP_LEFT,lt.FAR_TOP_RIGHT],right:[lt.NEAR_BOTTOM_RIGHT,lt.FAR_BOTTOM_RIGHT,lt.FAR_TOP_RIGHT,lt.NEAR_TOP_RIGHT],left:[lt.FAR_BOTTOM_LEFT,lt.NEAR_BOTTOM_LEFT,lt.NEAR_TOP_LEFT,lt.FAR_TOP_LEFT],top:[lt.FAR_TOP_LEFT,lt.NEAR_TOP_LEFT,lt.NEAR_TOP_RIGHT,lt.FAR_TOP_RIGHT]};var dw,aee;(function(t){t[t.NUM=6]="NUM"})(dw||(dw={})),function(t){t[t.NUM=8]="NUM"}(aee||(aee={}));const U_t=[Zt(-1,-1,-1,1),Zt(1,-1,-1,1),Zt(1,1,-1,1),Zt(-1,1,-1,1),Zt(-1,-1,1,1),Zt(1,-1,1,1),Zt(1,1,1,1),Zt(-1,1,1,1)],WDe=new F_(WB),z_t=BDe();function V_t(t,e,r){return 2*Math.atan(Math.sqrt(e*e+r*r)*Math.tan(.5*t)/e)}function B_t(t,e,r){return 2*Math.atan(Math.sqrt(e*e+r*r)*Math.tan(.5*t)/r)}function j_t(t,e,r){return 2*Math.atan(e*Math.tan(.5*t)/Math.sqrt(e*e+r*r))}function G_t(t,e,r){return 2*Math.atan(r*Math.tan(.5*t)/Math.sqrt(e*e+r*r))}var lee;let Pt=lee=class extends be{constructor(t={}){super(t),this._center=P(),this._up=P(),this._viewUp=P(),this._viewForward=P(),this._viewRight=P(),this._ray=Do(),this._viewport=Zt(0,0,1,1),this._padding=Zt(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=Rr(1,1e3),this._viewDirty=!0,this._viewMatrix=$e(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=$e(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=$e(),this._frustumDirty=!0,this._frustum=_D(),this._fullViewport=pr(),this._pixelRatio=1,this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center,"_center")}get ray(){return ge(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){po(this._viewMatrix,t),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get screenViewport(){if(this.pixelRatio===1)return this._viewport;const t=h3(pr(),this._viewport,1/this.pixelRatio),e=this._get("screenViewport");return e&&Sne(t,e)?e:t}get x(){return this._viewport[0]}set x(t){t+=this._padding[yr.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(t){t+=this._padding[yr.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[yr.RIGHT]+this._padding[yr.LEFT]}set fullWidth(t){this.width=t-(this._padding[yr.RIGHT]+this._padding[yr.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[yr.TOP]+this._padding[yr.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[yr.TOP]+this._padding[yr.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[yr.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[yr.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){xR(this._padding,t)||(this._viewport[0]+=t[yr.LEFT]-this._padding[yr.LEFT],this._viewport[1]+=t[yr.BOTTOM]-this._padding[yr.BOTTOM],this._viewport[2]-=t[yr.RIGHT]+t[yr.LEFT]-(this._padding[yr.RIGHT]+this._padding[yr.LEFT]),this._viewport[3]-=t[yr.TOP]+t[yr.BOTTOM]-(this._padding[yr.TOP]+this._padding[yr.BOTTOM]),Vf(this._padding,t),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&(Mn(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){const t=this.width,e=this.height,r=this.near*Math.tan(this.fovY/2),i=r*this._aspect,n=AAe($e(),-i*(1+2*this._padding[yr.LEFT]/t),i*(1+2*this._padding[yr.RIGHT]/t),-r*(1+2*this._padding[yr.BOTTOM]/e),r*(1+2*this._padding[yr.TOP]/e),this.near,this.far),s=this._get("projectionMatrix");return s&&rse(s,n)?s:n}get inverseProjectionMatrix(){return ya($e(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||$e()}get fov(){return this._fov}set fov(t){this._fov=t,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return j_t(this._fov,this.width,this.height)}set fovX(t){this._fov=V_t(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return G_t(this._fov,this.width,this.height)}set fovY(t){this._fov=B_t(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return Pi(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(ya(this._viewInverseTransposeMatrix,this.viewMatrix),Wu(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const e=2*t-1;return 2*this.near*this.far/(this.far+this.near-e*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation!=null&&this.relativeElevation>=0}copyFrom(t){ce(this._ray.origin,t.eye),this.center=t.center,this.up=t.up,Vf(this._viewport,t.viewport),this.notifyChange("_viewport"),Vf(this._padding,t.padding),this.notifyChange("_padding"),Qs(this._nearFar,t.nearFar),this.notifyChange("_nearFar"),this._fov=t.fov,this.relativeElevation=t.relativeElevation;const e=t;return this._viewDirty=e._viewDirty,this._viewDirty||(po(this._viewMatrix,t.viewMatrix),ce(this._viewRight,t.viewRight),ce(this._viewUp,t.viewUp),ce(this._viewForward,t.viewForward)),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||(iV(this._frustum,t.frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(po(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),Vf(this._fullViewport,t.fullViewport),this.pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up}clone(){return new lee().copyFrom(this)}equals(t){return Hl(this.eye,t.eye)&&Hl(this.center,t.center)&&Hl(this.up,t.up)&&xR(this._viewport,t.viewport)&&xR(this._padding,t.padding)&&PIe(this.nearFar,t.nearFar)&&this._fov===t.fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation}almostEquals(t){if(Math.abs(t.fov-this._fov)>=.001||Q8(t.padding,this._padding)>=.5||Q8(this.screenViewport,t.screenViewport)>=.5)return!1;Lo(Wa,t.eye,t.center),Lo(VH,this.eye,this.center);const e=ve(Wa,VH),r=ZY(Wa),i=ZY(VH),n=5e-4;return e*e>=(1-1e-10)*r*i&&bne(t.eye,this.eye)<Math.max(r,i)*n*n}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(V$(this.viewForward,ge(Wa,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,e){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(e||1)))}getScreenCenter(t=wn()){return t[0]=(this.padding[yr.LEFT]+this.width/2)/this.pixelRatio,t[1]=(this.padding[yr.TOP]+this.height/2)/this.pixelRatio,t}getRenderCenter(t,e=.5,r=.5){return t[0]=this.padding[yr.LEFT]+this.width*e,t[1]=this.padding[yr.BOTTOM]+this.height*r,t[2]=.5,t}setGLViewport(t){const e=this.viewport,r=this.padding;t.setViewport(e[0]-r[3],e[1]-r[2],e[2]+r[1]+r[3],e[3]+r[0]+r[2])}applyProjection(t,e){t!==gr&&ce(gr,t),gr[3]=1,qh(gr,gr,this.projectionMatrix);const r=Math.abs(gr[3]);le(gr,gr,1/r);const i=this.fullViewport;e[0]=Bt(0,i[0]+i[2],.5+.5*gr[0]),e[1]=Bt(0,i[1]+i[3],.5+.5*gr[1]),e[2]=.5*(gr[2]+1),e[3]=r}unapplyProjection(t,e){const r=this.fullViewport;gr[0]=(t[0]/(r[0]+r[2])*2-1)*t[3],gr[1]=(t[1]/(r[1]+r[3])*2-1)*t[3],gr[2]=(2*t[2]-1)*t[3],gr[3]=t[3],this.inverseProjectionMatrix!=null&&(qh(gr,gr,this.inverseProjectionMatrix),e[0]=gr[0],e[1]=gr[1],e[2]=gr[2])}projectToScreen(t,e){return this.projectToRenderScreen(t,BH),this.renderToScreen(BH,e),e}projectToRenderScreen(t,e){if(gr[0]=t[0],gr[1]=t[1],gr[2]=t[2],gr[3]=1,qh(gr,gr,this.viewProjectionMatrix),gr[3]===0)return null;le(gr,gr,1/Math.abs(gr[3]));const r=this.fullViewport;return"x"in e?(e.x=Bt(0,r[0]+r[2],.5+.5*gr[0]),e.y=Bt(0,r[1]+r[3],.5+.5*gr[1])):(e[0]=Bt(0,r[0]+r[2],.5+.5*gr[0]),e[1]=Bt(0,r[1]+r[3],.5+.5*gr[1]),e.length>2&&(e[2]=.5*(gr[2]+1))),e}unprojectFromScreen(t,e){return this.unprojectFromRenderScreen(this.screenToRender(t,BH),e)}unprojectFromRenderScreen(t,e){if(Mn(B4,this.projectionMatrix,this.viewMatrix),!ya(B4,B4))return null;const r=this.fullViewport;return gr[0]=2*(t[0]-r[0])/r[2]-1,gr[1]=2*(t[1]-r[1])/r[3]-1,gr[2]=2*t[2]-1,gr[3]=1,qh(gr,gr,B4),gr[3]===0?null:(e[0]=gr[0]/gr[3],e[1]=gr[1]/gr[3],e[2]=gr[2]/gr[3],e)}constrainWindowSize(t,e,r,i){const n=t*this.pixelRatio,s=e*this.pixelRatio,o=Math.max(n-r/2,0),a=Math.max(this.fullHeight-s-i/2,0),l=-Math.min(n-r/2,0),c=-Math.min(this.fullHeight-s-i/2,0);return[o,a,r-l- -Math.min(this.fullWidth-n-r/2,0),i-c- -Math.min(s-i/2,0)]}computeUp(t){t===qe.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,e){const r=t[0]*this.pixelRatio,i=this.fullHeight-t[1]*this.pixelRatio;return e[0]=r,e[1]=i,e}renderToScreen(t,e){const r=t[0]/this.pixelRatio,i=(this.fullHeight-t[1])/this.pixelRatio;e[0]=r,e[1]=i}_computeUpGlobal(){ge(Wa,this.center,this.eye);const t=Pe(this.center);t<1?(he(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(ve(Wa,this.center))>.9999*Pe(Wa)*t||(vt(this._up,Wa,this.center),vt(this._up,this._up,Wa),we(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){L_(Wa,this.eye,this.center),Math.abs(Wa[2])<=.9999&&(le(Wa,Wa,Wa[2]),he(this._up,-Wa[0],-Wa[1],1-Wa[2]),we(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(t,e,r=""){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?Hl(t,e)||(ce(e,t),this._markViewDirty(),r.length&&this.notifyChange(r)):re.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(jDe(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(eB(this._viewMatrix,this.eye,this.center,this.up),he(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),he(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),he(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};u([d()],Pt.prototype,"_center",void 0),u([d()],Pt.prototype,"_up",void 0),u([d()],Pt.prototype,"_viewport",void 0),u([d()],Pt.prototype,"_padding",void 0),u([d()],Pt.prototype,"_fov",void 0),u([d()],Pt.prototype,"_nearFar",void 0),u([d()],Pt.prototype,"_pixelRatio",void 0),u([d()],Pt.prototype,"pixelRatio",null),u([d()],Pt.prototype,"eye",null),u([d()],Pt.prototype,"center",null),u([d()],Pt.prototype,"up",null),u([d({readOnly:!0})],Pt.prototype,"nearFar",null),u([d()],Pt.prototype,"near",null),u([d()],Pt.prototype,"far",null),u([d()],Pt.prototype,"viewport",null),u([d({readOnly:!0})],Pt.prototype,"screenViewport",null),u([d()],Pt.prototype,"x",null),u([d()],Pt.prototype,"y",null),u([d()],Pt.prototype,"width",null),u([d()],Pt.prototype,"height",null),u([d()],Pt.prototype,"fullWidth",null),u([d()],Pt.prototype,"fullHeight",null),u([d({readOnly:!0})],Pt.prototype,"_aspect",null),u([d()],Pt.prototype,"padding",null),u([d({readOnly:!0})],Pt.prototype,"projectionMatrix",null),u([d({readOnly:!0})],Pt.prototype,"inverseProjectionMatrix",null),u([d()],Pt.prototype,"fov",null),u([d()],Pt.prototype,"fovX",null),u([d()],Pt.prototype,"fovY",null),Pt=lee=u([$("esri.views.3d.webgl-engine.lib.Camera")],Pt);const gr=pr(),B4=$e(),Wa=P(),VH=P(),BH=La();var yr;(function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT"})(yr||(yr={}));var Ee;(function(t){t[t.INTEGRATED_MESH=0]="INTEGRATED_MESH",t[t.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",t[t.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",t[t.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL",t[t.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN",t[t.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",t[t.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN",t[t.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL",t[t.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL",t[t.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",t[t.POSTPROCESSING_ENVIRONMENT_OPAQUE=10]="POSTPROCESSING_ENVIRONMENT_OPAQUE",t[t.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT",t[t.LASERLINES=12]="LASERLINES",t[t.LASERLINES_CONTRAST_CONTROL=13]="LASERLINES_CONTRAST_CONTROL",t[t.HUD_MATERIAL=14]="HUD_MATERIAL",t[t.LABEL_MATERIAL=15]="LABEL_MATERIAL",t[t.LINE_CALLOUTS=16]="LINE_CALLOUTS",t[t.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH",t[t.DRAPED_MATERIAL=18]="DRAPED_MATERIAL",t[t.DRAPED_WATER=19]="DRAPED_WATER",t[t.VOXEL=20]="VOXEL",t[t.MAX_SLOTS=21]="MAX_SLOTS"})(Ee||(Ee={}));var At;(function(t){t[t.Color=0]="Color",t[t.Alpha=1]="Alpha",t[t.FrontFace=2]="FrontFace",t[t.NONE=3]="NONE",t[t.COUNT=4]="COUNT"})(At||(At={}));let Dae=class{constructor(e=P()){this.intensity=e}},XDe=class{constructor(e=P(),r=ke(.57735,.57735,.57735)){this.intensity=e,this.direction=r}},nV=class{constructor(e=P(),r=ke(.57735,.57735,.57735),i=!0,n=1,s=1){this.intensity=e,this.direction=r,this.castShadows=i,this.specularStrength=n,this.environmentStrength=s}},YDe=class{constructor(){this.r=[0],this.g=[0],this.b=[0]}};function H_t(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]*e[i];return r}function jH(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]*e;return r}function LR(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]+e[i];return r}function ZDe(t){return(t+1)*(t+1)}function q_t(t){return _e(Math.floor(Math.sqrt(t)-1),0,2)}function JDe(t,e,r){const i=t[0],n=t[1],s=t[2],o=r||[];return o.length=ZDe(e),e>=0&&(o[0]=.28209479177),e>=1&&(o[1]=.4886025119*i,o[2]=.4886025119*s,o[3]=.4886025119*n),e>=2&&(o[4]=1.09254843059*i*n,o[5]=1.09254843059*n*s,o[6]=.31539156525*(3*s*s-1),o[7]=1.09254843059*i*s,o[8]=.54627421529*(i*i-n*n)),o}function W_t(t,e){const r=ZDe(t),i=e||{r:[],g:[],b:[]};i.r.length=i.g.length=i.b.length=r;for(let n=0;n<r;n++)i.r[n]=i.g[n]=i.b[n]=0;return i}function X_t(t,e){const r=q_t(e.r.length);for(const i of t)ul(cee,i.direction),JDe(cee,r,k0),H_t(k0,EU),jH(k0,i.intensity[0],yE),LR(e.r,yE),jH(k0,i.intensity[1],yE),LR(e.g,yE),jH(k0,i.intensity[2],yE),LR(e.b,yE);return e}function Y_t(t,e){JDe(cee,0,k0);for(const r of t)e.r[0]+=k0[0]*EU[0]*r.intensity[0]*4*Math.PI,e.g[0]+=k0[0]*EU[0]*r.intensity[1]*4*Math.PI,e.b[0]+=k0[0]*EU[0]*r.intensity[2]*4*Math.PI;return e}function Z_t(t,e,r,i){W_t(e,i),he(r.intensity,0,0,0);let n=!1;const s=J_t,o=K_t,a=Q_t;s.length=0,o.length=0,a.length=0;for(const l of t)l instanceof nV&&!n?(ce(r.direction,l.direction),ce(r.intensity,l.intensity),r.specularStrength=l.specularStrength,r.environmentStrength=l.environmentStrength,r.castShadows=l.castShadows,n=!0):l instanceof nV||l instanceof XDe?s.push(l):l instanceof Dae?o.push(l):l instanceof YDe&&a.push(l);X_t(s,i),Y_t(o,i);for(const l of a)LR(i.r,l.r),LR(i.g,l.g),LR(i.b,l.b)}const J_t=[],K_t=[],Q_t=[],k0=[0],yE=[0],cee=P(),EU=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];let Rye=class{constructor(){this.color=P(),this.intensity=1}},evt=class{constructor(){this.direction=P(),this.ambient=new Rye,this.diffuse=new Rye}};const KDe=.4;let GH=class{constructor(){this._shOrder=2,this._legacy=new evt,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new YDe,this._mainLight=new nV(P(),ke(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(e){Z_t(e,this._shOrder,this._mainLight,this._sphericalHarmonics),ce(this._legacy.direction,this._mainLight.direction);const r=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*r,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*r,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*r,le(this._legacy.diffuse.color,this._mainLight.intensity,r),ce(j4,this._legacy.diffuse.color),le(j4,j4,KDe*this.globalFactor),me(this._legacy.ambient.color,this._legacy.ambient.color,j4)}copyFrom(e){this._sphericalHarmonics.r=Array.from(e.sh.r),this._sphericalHarmonics.g=Array.from(e.sh.g),this._sphericalHarmonics.b=Array.from(e.sh.b),this._mainLight.direction=On(e.mainLight.direction),this._mainLight.intensity=On(e.mainLight.intensity),this._mainLight.castShadows=e.mainLight.castShadows,this._mainLight.specularStrength=e.mainLight.specularStrength,this._mainLight.environmentStrength=e.mainLight.environmentStrength,this.globalFactor=e.globalFactor,this.noonFactor=e.noonFactor}lerpLighting(e,r,i){if(fs(this._mainLight.intensity,e.mainLight.intensity,r.mainLight.intensity,i),this._mainLight.environmentStrength=Bt(e.mainLight.environmentStrength,r.mainLight.environmentStrength,i),this._mainLight.specularStrength=Bt(e.mainLight.specularStrength,r.mainLight.specularStrength,i),ce(this._mainLight.direction,r.mainLight.direction),this._mainLight.castShadows=r.mainLight.castShadows,this.globalFactor=Bt(e.globalFactor,r.globalFactor,i),this.noonFactor=Bt(e.noonFactor,r.noonFactor,i),e.sh.r.length===r.sh.r.length)for(let n=0;n<r.sh.r.length;n++)this._sphericalHarmonics.r[n]=Bt(e.sh.r[n],r.sh.r[n],i),this._sphericalHarmonics.g[n]=Bt(e.sh.g[n],r.sh.g[n],i),this._sphericalHarmonics.b[n]=Bt(e.sh.b[n],r.sh.b[n],i);else for(let n=0;n<r.sh.r.length;n++)this._sphericalHarmonics.r[n]=r.sh.r[n],this._sphericalHarmonics.g[n]=r.sh.g[n],this._sphericalHarmonics.b[n]=r.sh.b[n]}};const j4=P();let XB=class{constructor(e,r,i){this.shadowMap=e,this.ssaoHelper=r,this.slicePlane=i,this.slot=Ee.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=At.NONE,this._camera=new Pt,this._inverseViewport=Ne(),this.oldLighting=new GH,this.newLighting=new GH,this._fadedLighting=new GH,this._lighting=this.newLighting,this.ssr=new $_t,this.multipassTerrain=new P_t,this.multipassGeometry=new M_t,this.overlays=[],this.cloudsFade=new m_t}get camera(){return this._camera}set camera(e){this._camera=this.ssr.camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(e){const{oldLighting:r,newLighting:i}=this;e>=1?this._lighting=i:(this._fadedLighting.lerpLighting(r,i,e),this._lighting=this._fadedLighting)}},xc=class extends be{constructor(e){super(e),this._handles=new qr,this._techniques=new Array,this._techniqueConfiguration=new SU,this._bindParameters=new XB(null,null,null),this._passParameters=new LDe,this._drawParameters=new DDe,this._weatherTile=Ne(),this._weatherTileCount=128,this._faceIndex=0,this._tileIndex=0,this.coverage=Bt(Ka.default.coverage[0],Ka.default.coverage[1],.5),this.density=Bt(Ka.default.density[0],Ka.default.density[1],.5),this.absorption=Bt(Ka.default.absorption[0],Ka.default.absorption[1],.5),this.cloudSize=Bt(Ka.default.cloudSize[0],Ka.default.cloudSize[1],.5),this.detailSize=Bt(Ka.default.detailSize[0],Ka.default.detailSize[1],.5),this.smoothness=Bt(Ka.default.smoothness[0],Ka.default.smoothness[1],.5),this.cloudHeight=Bt(Ka.default.cloudHeight[0],Ka.default.cloudHeight[1],.5),this.raymarchingSteps=Ka.default.raymarchingSteps,this._viewMatrix=$e(),this._dirty=!1,this.running=!1}_getTechnique(e){const r=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,i=r===y2.RG?2*e:2*e+1;return this._techniques[i]||(this._techniqueConfiguration.writeTextureChannels=r,this._techniqueConfiguration.steps=e,this._techniques[i]=new NDe({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[i])}updateWeatherTile(){const e=this.view.camera.position.latitude,r=this.view.camera.position.longitude;if(e==null||r==null)return;dt(this._weatherTile,(e+90)/180,(r+180)/360);const i=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1));this._weatherTile[0]=Math.floor(2*this._weatherTileCount*this._weatherTile[0]),this._weatherTile[1]=Math.floor(4*(this._weatherTileCount-i)*this._weatherTile[1]);let n=0,s=0;if(v(this.view.environment)&&this.view.environment.lighting.type!=="virtual"&&v(this.view.environment.lighting.date)){const o=new Date(this.view.environment.lighting.date);o.setUTCHours(this.view.environment.lighting.date.getUTCHours()+(this.view.environment.lighting.displayUTCOffset??0)),n=31*o.getUTCMonth()+o.getUTCDate(),s=o.getUTCFullYear()}this._weatherTile[0]=(this._weatherTile[0]+n)%(2*this._weatherTileCount),this._weatherTile[1]=(this._weatherTile[1]+s%100)%(4*this._weatherTileCount),IIe(this._passParameters.weatherTile,this._weatherTile)||this.setDirty()}initialize(){this._vao=vl(this.context.renderContext.rctx);const e=ii(this.view.spatialReference);this._passParameters.cloudRadius=.5*e.radius,this.setDirty(),this.updateWeatherTile(),this._handles.add([this.view.resourceController.scheduler.registerTask(St.CLOUDS_GENERATOR,this),ne(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingSteps],()=>this.setDirty(),Vt)])}destroy(){this._handles.destroy(),this._techniques.forEach(e=>en(e)),this._frameBufferCube=rt(this._frameBufferCube),this._techniques.length=0,this._vao=rt(this._vao),this._passParameters.noiseTexture=ze(this._passParameters.noiseTexture)}get _tilesPerFace(){switch(this._techniqueConfiguration.steps){case Uc.SIXTEEN:return 1;case Uc.HUNDRED:return 4;case Uc.COUNT:case Uc.TWOHUNDRED:return 8}}_ensureNoiseTexture(){if(v(this._passParameters.noiseTexture))this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile);else{const e=this.context;this._passParameters.noiseTexture=new II({context:e}),this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile)}return v(this._passParameters.noiseTexture.textureAtlas)}_ensureFrameBufferCube(e){if(R(this._frameBufferCube)){const r={target:Ct.TEXTURE_CUBE_MAP,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE,samplingMode:it.LINEAR,hasMipmap:!1,width:e,height:e};this._frameBufferCube=new Jn(this.context.renderContext.rctx,{colorTarget:xn.CUBEMAP,width:e,height:e},r)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}destroyFrameBufferCube(){this._frameBufferCube=rt(this._frameBufferCube)}applyPreset(e,r){const i=e.median,n=s=>{const o=Bt(s[0],s[1],i);return r<.5?Bt(s[0],o,2*r):Bt(o,s[1],2*(r-.5))};this.coverage=n(e.coverage),this.density=n(e.density),this.absorption=n(e.absorption),this.cloudSize=n(e.cloudSize),this.detailSize=n(e.detailSize),this.smoothness=n(e.smoothness),this.cloudHeight=n(e.cloudHeight),this.raymarchingSteps=e.raymarchingSteps}setDirty(){this._dirty=this.running=!0}runTask(e){if(R(this._vao))return this._dirty=this.running=!1,this.context.renderContext.bindParameters.cloudsFade.renderingStage=Hn.FINISHED_RENDERING,void e.madeProgress();this._faceIndex===0&&this._tileIndex===0&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,this.updateWeatherTile(),Qs(this._passParameters.weatherTile,this._weatherTile));const r=this._getTechnique(this._passParameters.raymarchingSteps);if(!r.compiled||!this.context.renderContext.bindParameters.cloudsFade.isCameraPositionFinal||this.context.renderContext.bindParameters.cloudsFade.isFading||!this._ensureNoiseTexture())return za.YIELD;this._faceIndex===0&&this._tileIndex===0&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=Hn.RENDERING,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._dirty=!1);const i=this.context.renderContext.rctx,n=i.bindTechnique(r,this._passParameters,this._bindParameters);i.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao);const s=i.getViewport(),o=r.configuration.cubeMapSize,a=o/this._tilesPerFace,l=this._tileIndex*a;i.setViewport(0,l,o,a);const c=this._ensureFrameBufferCube(o);i.bindFramebuffer(c);const h=tvt[this._faceIndex],p=rvt[this._faceIndex];OAe(this._viewMatrix,ivt,h,p),Op(this._drawParameters.viewMatrix,this._viewMatrix);const f=Ct.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex;return c.setColorTextureTarget(f),n.bindDraw(this._drawParameters,this._bindParameters,this._passParameters),i.gl.drawArrays(i.gl.TRIANGLE_STRIP,0,4),i.gl.flush(),i.setViewport(s.x,s.y,s.width,s.height),this.requestRender(),++this._tileIndex,this._faceIndex===4&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._faceIndex=0,this._tileIndex=0,this.context.renderContext.bindParameters.cloudsFade.renderingStage=Hn.FINISHED_RENDERING):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0),e.madeProgress(),za.YIELD}};u([d({constructOnly:!0})],xc.prototype,"context",void 0),u([d({constructOnly:!0})],xc.prototype,"view",void 0),u([d({constructOnly:!0})],xc.prototype,"requestRender",void 0),u([d()],xc.prototype,"coverage",void 0),u([d()],xc.prototype,"density",void 0),u([d()],xc.prototype,"absorption",void 0),u([d()],xc.prototype,"cloudSize",void 0),u([d()],xc.prototype,"detailSize",void 0),u([d()],xc.prototype,"smoothness",void 0),u([d()],xc.prototype,"cloudHeight",void 0),u([d()],xc.prototype,"raymarchingSteps",void 0),u([d()],xc.prototype,"running",void 0),xc=u([$("esri.views.3d.environment.CloudsGenerator")],xc);const tvt=[ti(1,0,0),ti(-1,0,0),ti(0,1,0),ti(0,-1,0),ti(0,0,1)],rvt=[ti(0,1,0),ti(0,1,0),ti(0,0,-1),ti(0,0,1),ti(0,1,0)],ivt=Oae();let Nae=class extends wi{constructor(){super(...arguments),this.fogColor=P(),this.hazeColor=P(),this.fogStrength=4e-6,this.hazeStrength=4e-6,this.atmosphereC=1,this.fogAmount=0,this.hazeAmount=0}};function nvt(t){const e=new Br;e.attributes.add(O.POSITION,"vec2"),e.include(Zg,{textureCoordinateType:cs.Default}),e.varyings.add("worldRay","vec3"),e.varyings.add("eyeDir","vec3");const{vertex:r,fragment:i}=e;return r.uniforms.add([new rn("inverseProjectionMatrix",(n,s)=>s.camera.inverseProjectionMatrix),new rn("inverseViewMatrix",(n,s)=>_3(svt,s.camera.viewMatrix))]),r.code.add(S`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),i.uniforms.add(new Ie("atmosphereC",n=>n.atmosphereC)),i.uniforms.add(new Jt("cameraPosition",(n,s)=>s.camera.eye)),i.uniforms.add(new Hr("nearFar",(n,s)=>s.camera.nearFar)),i.uniforms.add(new Dt("depthTex",n=>n.depthTexture)),i.uniforms.add(new Ie("fogStrength",n=>t.haze?n.hazeStrength:n.fogStrength)),i.uniforms.add(new Ie("fogAmount",n=>t.haze?n.hazeAmount:n.fogAmount)),i.uniforms.add(new Jt("fogColor",n=>t.haze?n.hazeColor:n.fogColor)),e.include(GB),i.include(sd),i.code.add(S`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),i.code.add(S`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),i.code.add(S`
    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;

      float depthSample = texture2D(depthTex, vuv0).r;
      float zNorm = 2.0 * depthSample - 1.0;
      float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
      if(depthSample < 1.0 && depthSample > 0.0){
        vec3 cameraSpaceRay = normalize(eyeDir);
        cameraSpaceRay /= cameraSpaceRay.z;
        cameraSpaceRay *= linDepth;
        terrainDepth = max(0.0, length(cameraSpaceRay));
      }

      ${t.haze?S`
          if(terrainDepth == -1.0){
            gl_FragColor = vec4(0);
            return;
          }`:""}

      vec4 fog = applyFog(terrainDepth, rayDir);

      gl_FragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
    }
  `),e}const svt=$e(),QDe=Object.freeze(Object.defineProperty({__proto__:null,FogHazePassParameters:Nae,build:nvt},Symbol.toStringTag,{value:"Module"}));let eNe=class tNe extends Wr{initializeProgram(e){return new Gr(e.rctx,tNe.shader.get().build(this.configuration),Lr)}initializePipeline(){return this.configuration.haze?Ht({blending:mo(Ce.ONE,Ce.ZERO,Ce.ONE_MINUS_SRC_COLOR,Ce.ONE),colorWrite:ir}):Ht({blending:mo(Ce.SRC_ALPHA,Ce.ZERO,Ce.ONE_MINUS_SRC_ALPHA,Ce.ONE),colorWrite:ir})}};eNe.shader=new jr(QDe,()=>Q(()=>import("./FogHaze.glsl-5523dd1a.js"),[]));let Fae=class extends _l{constructor(){super(...arguments),this.haze=!1}};u([j()],Fae.prototype,"haze",void 0);const ovt=.95,avt=1;let $I=class extends be{constructor(e){super(e),this._passParameters=new Nae;const r=e.context.renderContext.rctx;this._vao=vl(r,$3),this._technique=e.context.techniqueRepository.acquire(eNe,new Fae);const i=ii(e.view.spatialReference);this._planetRadius=i.radius,this._atmosphereRadius=i.radius+mD}destroy(){this._technique.release(),this._vao.dispose()}set strength(e){this._passParameters.fogStrength=e}get strength(){return this._passParameters.fogStrength}render(e,r){if(this._update(e,r),this._passParameters.fogAmount<=0)return;const i=this._technique;if(!i.compiled)return void this.context.requestRender();const n=e.offscreenRenderingHelper;n.renderDepthDetached(()=>{this._passParameters.depthTexture=n.depthTexture;const s=e.rctx.bindTechnique(i,this._passParameters,e.bindParameters);this._renderFog(s,e)})}_renderFog(e,r){const i=r.rctx;i.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(Ft.TRIANGLE_STRIP,0,4)}_update(e,r){const i=e.bindParameters.camera;we(Oye,i.eye);const n=Math.max(0,ve(Oye,e.bindParameters.lighting.mainLight.direction)),s=r.color;le(Mye,s,.1),fs(this._passParameters.fogColor,Mye,s,n);const o=Pe(i.eye),a=o*o;this._passParameters.atmosphereC=a-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.fogAmount=(1-mO(ovt*Wd,avt*Wd,Math.abs(o-this._planetRadius)))*r.amount,this._passParameters.fogStrength=r.strength}static isSupported(e){return e.capabilities.depthTexture}};u([d({constructOnly:!0})],$I.prototype,"context",void 0),u([d({constructOnly:!0})],$I.prototype,"view",void 0),$I=u([$("esri.views.3d.environment.Fog")],$I);let lvt=class{constructor(){this.color=P(),this.strength=0,this.amount=0}};const Oye=P(),Mye=P();let Io=class extends _l{constructor(){super(...arguments),this.hasWebGL2Context=!1}};u([j({constValue:!0})],Io.prototype,"hasSliceHighlight",void 0),u([j({constValue:!1})],Io.prototype,"hasSliceInVertexProgram",void 0),u([j({constValue:!1})],Io.prototype,"instancedDoublePrecision",void 0),u([j({constValue:!1})],Io.prototype,"useLegacyTerrainShading",void 0),u([j({constValue:!1})],Io.prototype,"hasModelTransformation",void 0),u([j({constValue:_i.Pass})],Io.prototype,"pbrTextureBindType",void 0),u([j()],Io.prototype,"hasWebGL2Context",void 0);var dy;(function(t){t[t.Cone=0]="Cone",t[t.Cylinder=1]="Cylinder",t[t.Underground=2]="Underground",t[t.COUNT=3]="COUNT"})(dy||(dy={}));let kae=class extends Io{constructor(){super(...arguments),this.geometry=dy.Cone}};u([j({count:dy.COUNT})],kae.prototype,"geometry",void 0);var V;(function(t){t[t.Color=0]="Color",t[t.Depth=1]="Depth",t[t.Normal=2]="Normal",t[t.Shadow=3]="Shadow",t[t.ShadowHighlight=4]="ShadowHighlight",t[t.ShadowExcludeHighlight=5]="ShadowExcludeHighlight",t[t.Highlight=6]="Highlight",t[t.Alpha=7]="Alpha",t[t.ObjectAndLayerIdColor=8]="ObjectAndLayerIdColor",t[t.COUNT=9]="COUNT"})(V||(V={}));function BN(t){t.attributes.add(O.POSITION,"vec3"),t.vertex.code.add(S`vec3 positionModel() { return position; }`)}function sV({code:t},e){e.doublePrecisionRequiresObfuscation?t.add(S`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):t.add(S`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}let wy=class extends Ln{constructor(e,r){super(e,"mat3",_i.Pass,(i,n,s)=>i.setUniformMatrix3fv(e,r(n,s)))}};function DR(t,e){t.include(BN);const r=t.vertex;r.include(sV,e),t.varyings.add("vPositionWorldCameraRelative","vec3"),t.varyings.add("vPosition_view","vec3"),r.uniforms.add([new Jt("transformWorldFromViewTH",i=>i.transformWorldFromViewTH),new Jt("transformWorldFromViewTL",i=>i.transformWorldFromViewTL),new wy("transformViewFromCameraRelativeRS",i=>i.transformViewFromCameraRelativeRS),new rn("transformProjFromView",i=>i.transformProjFromView),new yD("transformWorldFromModelRS",i=>i.transformWorldFromModelRS),new Kh("transformWorldFromModelTH",i=>i.transformWorldFromModelTH),new Kh("transformWorldFromModelTL",i=>i.transformWorldFromModelTL)]),r.code.add(S`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),r.code.add(S`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${e.spherical?S`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:S`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),t.fragment.uniforms.add(new Jt("transformWorldFromViewTL",i=>i.transformWorldFromViewTL)),r.code.add(S`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),t.fragment.code.add(S`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}let rNe=class extends wi{constructor(){super(...arguments),this.transformWorldFromViewTH=P(),this.transformWorldFromViewTL=P(),this.transformViewFromCameraRelativeRS=vi(),this.transformProjFromView=$e()}},iNe=class extends wi{constructor(){super(...arguments),this.transformWorldFromModelRS=vi(),this.transformWorldFromModelTH=Ki(),this.transformWorldFromModelTL=Ki()}};function pw(t){t.varyings.add("linearDepth","float")}function _2(t){t.vertex.uniforms.add(new Hr("nearFar",(e,r)=>r.camera.nearFar))}function YB(t){t.vertex.code.add(S`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function L3(t,e){const{vertex:r}=t;switch(e.output){case V.Color:if(e.receiveShadows)return pw(t),void r.code.add(S`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case V.Depth:case V.Shadow:case V.ShadowHighlight:case V.ShadowExcludeHighlight:return t.include(DR,e),pw(t),_2(t),YB(t),void r.code.add(S`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}r.code.add(S`void forwardLinearDepth() {}`)}function zc(t,e){if(YB(t),e.hasModelTransformation)return t.vertex.code.add(S`vec4 transformPositionWithDepth(mat4 proj, mat4 view, mat4 model, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * (model * vec4(pos, 1.0));
depth = calculateLinearDepth(nearFar, eye.z);
return proj * eye;
}`),void t.vertex.code.add(S`vec4 transformPosition(mat4 proj, mat4 view, mat4 model, vec3 pos) {
return proj * (view * (model * vec4(pos, 1.0)));
}`);t.vertex.code.add(S`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),t.vertex.code.add(S`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}let Uae=class extends wi{constructor(){super(...arguments),this.texV=Ne(),this.altitudeFade=0,this.innerScale=0,this.undergroundFadeAlpha=0,this.silhouette=new nNe}},nNe=class{constructor(){this.center=P(),this.v1=P(),this.v2=P()}};function cvt(t){const e=new Br,{vertex:r,fragment:i}=e;if(U_(r),t.geometry===dy.Underground)e.attributes.add(O.POSITION,"vec2"),e.varyings.add("color","vec4"),r.uniforms.add([new Jt("cameraPosition",(n,s)=>s.camera.eye),new Ie("undergroundFadeAlpha",n=>n.undergroundFadeAlpha)]),r.code.add(S`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),i.code.add(S`void main() {
gl_FragColor = color;
}`);else{e.include(zc,t),e.attributes.add(O.POSITION,"vec3"),e.varyings.add("vtc","vec2"),e.varyings.add("falloff","float");const n=t.geometry===dy.Cylinder;r.uniforms.add([new rn("proj",(a,l)=>l.camera.projectionMatrix),new rn("view",(a,l)=>l.camera.viewMatrix)]),n||(e.varyings.add("innerFactor","float"),r.uniforms.add(new Jt("silCircleCenter",a=>a.silhouette.center)),r.uniforms.add(new Jt("silCircleV1",a=>a.silhouette.v1)),r.uniforms.add(new Jt("silCircleV2",a=>a.silhouette.v2)),r.uniforms.add(new Hr("texV",a=>a.texV)),r.uniforms.add(new Ie("innerScale",a=>a.innerScale)));const s=6.2831853,o=1/128;r.code.add(S`
		void main(void) {
      ${n?S`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:S`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${S.float(s*o)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${S.float(o)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),i.uniforms.add(new Dt("tex",a=>a.texture)),n||i.uniforms.add(new Ie("altitudeFade",a=>a.altitudeFade)),i.code.add(S`
		void main() {
			vec4 atmosphereColor = texture2D(tex, vtc) * falloff;
      ${n?S`gl_FragColor = atmosphereColor;`:S`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			gl_FragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return e}const uvt=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:nNe,SimpleAtmospherePassParameters:Uae,build:cvt},Symbol.toStringTag,{value:"Module"}));let oV=class sNe extends Wr{initializeProgram(e){return new Gr(e.rctx,sNe.shader.get().build(this.configuration),Lr)}initializePipeline(){return this.configuration.geometry===dy.Cylinder?Ht({blending:mo(Ce.SRC_ALPHA,Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA,Ce.ONE_MINUS_SRC_ALPHA),culling:Eae,depthTest:{func:zi.LEQUAL},colorWrite:ir}):Ht({blending:mo(Ce.SRC_ALPHA,Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA,Ce.ONE_MINUS_SRC_ALPHA),depthTest:{func:zi.LEQUAL},colorWrite:ir})}};oV.shader=new jr(uvt,()=>Q(()=>import("./SimpleAtmosphere.glsl-d78a46ac.js"),[]));const oNe=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);function eh(t,e=0){const r=t.stride;return t.fieldNames.filter(i=>{const n=t.fields.get(i).optional;return!(n&&n.glPadding)}).map(i=>{const n=t.fields.get(i),s=n.constructor.ElementCount,o=hvt(n.constructor.ElementType),a=n.offset,l=!(!n.optional||!n.optional.glNormalized);return new va(i,s,o,a,r,l,e)})}function hvt(t){const e=dvt[t];if(e)return e;throw new Error("BufferType not supported in WebGL")}const dvt={u8:ft.UNSIGNED_BYTE,u16:ft.UNSIGNED_SHORT,u32:ft.UNSIGNED_INT,i8:ft.BYTE,i16:ft.SHORT,i32:ft.INT,f32:ft.FLOAT};let zae=class{constructor(e,r,i=0,n,s){this.TypedArrayConstructor=e,this.elementCount=9;const o=this.TypedArrayConstructor;n===void 0&&(n=9*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=s==null?new o(r,a):new o(r,a,(s-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const n=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,n,this.stride,n+i*this.stride)}getMat(e,r){let i=e*this.typedBufferStride;for(let n=0;n<9;n++)r[n]=this.typedBuffer[i++];return r}setMat(e,r){let i=e*this.typedBufferStride;for(let n=0;n<9;n++)this.typedBuffer[i++]=r[n]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}copyFrom(e,r,i){const n=this.typedBuffer,s=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;for(let l=0;l<9;++l)n[o++]=s[a++]}get buffer(){return this.typedBuffer.buffer}};zae.ElementCount=9;let Vae=class{constructor(e,r,i=0,n,s){this.TypedArrayConstructor=e,this.elementCount=16;const o=this.TypedArrayConstructor;n===void 0&&(n=16*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=s==null?new o(r,a):new o(r,a,(s-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const n=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,n,this.stride,n+i*this.stride)}getMat(e,r){let i=e*this.typedBufferStride;for(let n=0;n<16;n++)r[n]=this.typedBuffer[i++];return r}setMat(e,r){let i=e*this.typedBufferStride;for(let n=0;n<16;n++)this.typedBuffer[i++]=r[n]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}copyFrom(e,r,i){const n=this.typedBuffer,s=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;for(let l=0;l<16;++l)n[o++]=s[a++]}get buffer(){return this.typedBuffer.buffer}};Vae.ElementCount=16;let B_=class{constructor(e,r,i=0,n,s){this.TypedArrayConstructor=e,this.elementCount=1;const o=this.TypedArrayConstructor;n===void 0&&(n=o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=s==null?new o(r,a):new o(r,a,(s-i)/o.BYTES_PER_ELEMENT),this.stride=n,this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(e,r,i=this.count-r){const n=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,n,this.stride,n+i*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,r){this.typedBuffer[e*this.typedBufferStride]=r}get buffer(){return this.typedBuffer.buffer}};B_.ElementCount=1;let j_=class{constructor(e,r,i=0,n,s){this.TypedArrayConstructor=e,this.elementCount=2;const o=this.TypedArrayConstructor;n===void 0&&(n=2*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=s==null?new o(r,a):new o(r,a,(s-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const n=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,n,this.stride,n+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,dt(r,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e]=r[1]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e]=i}copyFrom(e,r,i){const n=this.typedBuffer,s=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;n[o++]=s[a++],n[o]=s[a]}get buffer(){return this.typedBuffer.buffer}};j_.ElementCount=2;let G_=class{constructor(e,r,i=0,n,s){this.TypedArrayConstructor=e,this.elementCount=3;const o=this.TypedArrayConstructor;n===void 0&&(n=3*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=s==null?new o(r,a):new o(r,a,(s-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const n=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,n,this.stride,n+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,he(r,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e++]=r[1],this.typedBuffer[e]=r[2]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i,n){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e++]=i,this.typedBuffer[e]=n}copyFrom(e,r,i){const n=this.typedBuffer,s=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;n[o++]=s[a++],n[o++]=s[a++],n[o]=s[a]}get buffer(){return this.typedBuffer.buffer}};G_.ElementCount=3;let H_=class{constructor(e,r,i=0,n,s){this.TypedArrayConstructor=e,this.start=i,this.elementCount=4;const o=this.TypedArrayConstructor;n===void 0&&(n=4*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=s==null?new o(r,a):new o(r,a,(s-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const n=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,n,this.stride,n+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,ai(r,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e++]=r[1],this.typedBuffer[e++]=r[2],this.typedBuffer[e]=r[3]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i,n,s){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e++]=i,this.typedBuffer[e++]=n,this.typedBuffer[e]=s}copyFrom(e,r,i){const n=this.typedBuffer,s=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;n[o++]=s[a++],n[o++]=s[a++],n[o++]=s[a++],n[o]=s[a]}get buffer(){return this.typedBuffer.buffer}};H_.ElementCount=4;let Bae=class aNe extends B_{constructor(e,r=0,i,n){super(Float32Array,e,r,i,n),this.elementType="f32"}static fromTypedArray(e,r){return new aNe(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Bae.ElementType="f32";let q_=class uee extends j_{constructor(e,r=0,i,n){super(Float32Array,e,r,i,n),this.elementType="f32"}slice(e,r){return this.sliceBuffer(uee,e,r)}static fromTypedArray(e,r){return new uee(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};q_.ElementType="f32";let Ui=class hee extends G_{constructor(e,r=0,i,n){super(Float32Array,e,r,i,n),this.elementType="f32"}slice(e,r){return this.sliceBuffer(hee,e,r)}static fromTypedArray(e,r){return new hee(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Ui.ElementType="f32";let Yu=class dee extends H_{constructor(e,r=0,i,n){super(Float32Array,e,r,i,n),this.elementType="f32"}slice(e,r){return this.sliceBuffer(dee,e,r)}static fromTypedArray(e,r){return new dee(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Yu.ElementType="f32";let fw=class pee extends zae{constructor(e,r=0,i,n){super(Float32Array,e,r,i,n),this.elementType="f32"}slice(e,r){return this.sliceBuffer(pee,e,r)}static fromTypedArray(e,r){return new pee(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};fw.ElementType="f32";let jae=class fee extends zae{constructor(e,r=0,i,n){super(Float64Array,e,r,i,n),this.elementType="f64"}slice(e,r){return this.sliceBuffer(fee,e,r)}static fromTypedArray(e,r){return new fee(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};jae.ElementType="f64";let Gae=class mee extends Vae{constructor(e,r=0,i,n){super(Float32Array,e,r,i,n),this.elementType="f32"}slice(e,r){return this.sliceBuffer(mee,e,r)}static fromTypedArray(e,r){return new mee(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Gae.ElementType="f32";let vD=class gee extends Vae{constructor(e,r=0,i,n){super(Float64Array,e,r,i,n),this.elementType="f64"}slice(e,r){return this.sliceBuffer(gee,e,r)}static fromTypedArray(e,r){return new gee(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};vD.ElementType="f64";let Hae=class yee extends B_{constructor(e,r=0,i,n){super(Float64Array,e,r,i,n),this.elementType="f64"}slice(e,r){return this.sliceBuffer(yee,e,r)}static fromTypedArray(e,r){return new yee(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Hae.ElementType="f64";let qae=class _ee extends j_{constructor(e,r=0,i,n){super(Float64Array,e,r,i,n),this.elementType="f64"}slice(e,r){return this.sliceBuffer(_ee,e,r)}static fromTypedArray(e,r){return new _ee(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};qae.ElementType="f64";let ml=class vee extends G_{constructor(e,r=0,i,n){super(Float64Array,e,r,i,n),this.elementType="f64"}slice(e,r){return this.sliceBuffer(vee,e,r)}static fromTypedArray(e,r){return new vee(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};ml.ElementType="f64";let ZB=class bee extends H_{constructor(e,r=0,i,n){super(Float64Array,e,r,i,n),this.elementType="f64"}slice(e,r){return this.sliceBuffer(bee,e,r)}static fromTypedArray(e,r){return new bee(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};ZB.ElementType="f64";let GO=class wee extends B_{constructor(e,r=0,i,n){super(Uint8Array,e,r,i,n),this.elementType="u8"}slice(e,r){return this.sliceBuffer(wee,e,r)}static fromTypedArray(e,r){return new wee(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};GO.ElementType="u8";let JB=class xee extends j_{constructor(e,r=0,i,n){super(Uint8Array,e,r,i,n),this.elementType="u8"}slice(e,r){return this.sliceBuffer(xee,e,r)}static fromTypedArray(e,r){return new xee(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};JB.ElementType="u8";let bD=class Tee extends G_{constructor(e,r=0,i,n){super(Uint8Array,e,r,i,n),this.elementType="u8"}slice(e,r){return this.sliceBuffer(Tee,e,r)}static fromTypedArray(e,r){return new Tee(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};bD.ElementType="u8";let gl=class See extends H_{constructor(e,r=0,i,n){super(Uint8Array,e,r,i,n),this.elementType="u8"}slice(e,r){return this.sliceBuffer(See,e,r)}static fromTypedArray(e,r){return new See(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};gl.ElementType="u8";let KB=class Eee extends B_{constructor(e,r=0,i,n){super(Uint16Array,e,r,i,n),this.elementType="u16"}slice(e,r){return this.sliceBuffer(Eee,e,r)}static fromTypedArray(e,r){return new Eee(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};KB.ElementType="u16";let Wae=class Cee extends j_{constructor(e,r=0,i,n){super(Uint16Array,e,r,i,n),this.elementType="u16"}slice(e,r){return this.sliceBuffer(Cee,e,r)}static fromTypedArray(e,r){return new Cee(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Wae.ElementType="u16";let QB=class Aee extends G_{constructor(e,r=0,i,n){super(Uint16Array,e,r,i,n),this.elementType="u16"}slice(e,r){return this.sliceBuffer(Aee,e,r)}static fromTypedArray(e,r){return new Aee(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};QB.ElementType="u16";let jN=class Ree extends H_{constructor(e,r=0,i,n){super(Uint16Array,e,r,i,n),this.elementType="u16"}slice(e,r){return this.sliceBuffer(Ree,e,r)}static fromTypedArray(e,r){return new Ree(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};jN.ElementType="u16";let e7=class Oee extends B_{constructor(e,r=0,i,n){super(Uint32Array,e,r,i,n),this.elementType="u32"}slice(e,r){return this.sliceBuffer(Oee,e,r)}static fromTypedArray(e,r){return new Oee(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};e7.ElementType="u32";let Xae=class Mee extends j_{constructor(e,r=0,i,n){super(Uint32Array,e,r,i,n),this.elementType="u32"}slice(e,r){return this.sliceBuffer(Mee,e,r)}static fromTypedArray(e,r){return new Mee(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Xae.ElementType="u32";let lNe=class Pee extends G_{constructor(e,r=0,i,n){super(Uint32Array,e,r,i,n),this.elementType="u32"}slice(e,r){return this.sliceBuffer(Pee,e,r)}static fromTypedArray(e,r){return new Pee(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};lNe.ElementType="u32";let cNe=class Iee extends H_{constructor(e,r=0,i,n){super(Uint32Array,e,r,i,n),this.elementType="u32"}slice(e,r){return this.sliceBuffer(Iee,e,r)}static fromTypedArray(e,r){return new Iee(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};cNe.ElementType="u32";let Yae=class $ee extends B_{constructor(e,r=0,i,n){super(Int8Array,e,r,i,n),this.elementType="i8"}slice(e,r){return this.sliceBuffer($ee,e,r)}static fromTypedArray(e,r){return new $ee(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Yae.ElementType="i8";let t7=class Lee extends j_{constructor(e,r=0,i,n){super(Int8Array,e,r,i,n),this.elementType="i8"}slice(e,r){return this.sliceBuffer(Lee,e,r)}static fromTypedArray(e,r){return new Lee(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};t7.ElementType="i8";let uNe=class Dee extends G_{constructor(e,r=0,i,n){super(Int8Array,e,r,i,n),this.elementType="i8"}slice(e,r){return this.sliceBuffer(Dee,e,r)}static fromTypedArray(e,r){return new Dee(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};uNe.ElementType="i8";let hNe=class Nee extends H_{constructor(e,r=0,i,n){super(Int8Array,e,r,i,n),this.elementType="i8"}slice(e,r){return this.sliceBuffer(Nee,e,r)}static fromTypedArray(e,r){return new Nee(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};hNe.ElementType="i8";let dNe=class Fee extends B_{constructor(e,r=0,i,n){super(Int16Array,e,r,i,n),this.elementType="i16"}slice(e,r){return this.sliceBuffer(Fee,e,r)}static fromTypedArray(e,r){return new Fee(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};dNe.ElementType="i16";let r7=class kee extends j_{constructor(e,r=0,i,n){super(Int16Array,e,r,i,n),this.elementType="i16"}slice(e,r){return this.sliceBuffer(kee,e,r)}static fromTypedArray(e,r){return new kee(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};r7.ElementType="i16";let pNe=class Uee extends G_{constructor(e,r=0,i,n){super(Int16Array,e,r,i,n),this.elementType="i16"}slice(e,r){return this.sliceBuffer(Uee,e,r)}static fromTypedArray(e,r){return new Uee(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};pNe.ElementType="i16";let fNe=class zee extends H_{constructor(e,r=0,i,n){super(Int16Array,e,r,i,n),this.elementType="i16"}slice(e,r){return this.sliceBuffer(zee,e,r)}static fromTypedArray(e,r){return new zee(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};fNe.ElementType="i16";let mNe=class Vee extends B_{constructor(e,r=0,i,n){super(Int32Array,e,r,i,n),this.elementType="i32"}slice(e,r){return this.sliceBuffer(Vee,e,r)}static fromTypedArray(e,r){return new Vee(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};mNe.ElementType="i32";let gNe=class Bee extends j_{constructor(e,r=0,i,n){super(Int32Array,e,r,i,n),this.elementType="i32"}slice(e,r){return this.sliceBuffer(Bee,e,r)}static fromTypedArray(e,r){return new Bee(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};gNe.ElementType="i32";let yNe=class jee extends G_{constructor(e,r=0,i,n){super(Int32Array,e,r,i,n),this.elementType="i32"}slice(e,r){return this.sliceBuffer(jee,e,r)}static fromTypedArray(e,r){return new jee(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};yNe.ElementType="i32";let _Ne=class Gee extends H_{constructor(e,r=0,i,n){super(Int32Array,e,r,i,n),this.elementType="i32"}slice(e,r){return this.sliceBuffer(Gee,e,r)}static fromTypedArray(e,r){return new Gee(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};_Ne.ElementType="i32";function vNe(t){switch(t){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}function pvt(t){switch(t){case"u8":case"u16":case"u32":return!1;case"i8":case"i16":case"i32":case"f32":case"f64":return!0}}function fvt(t){switch(t){case"u8":case"u16":case"u32":case"i8":case"i16":case"i32":return!0;case"f32":case"f64":return!1}}function mvt(t){switch(t){case"u8":return 255;case"u16":return 65535;case"u32":return 4294967295;case"i8":return 127;case"i16":return 32767;case"i32":return 2147483647;case"f32":return 3402823e32;case"f64":return 179769e303}}let Pye=class bNe{constructor(e,r){this.layout=e,this.buffer=typeof r=="number"?new ArrayBuffer(r*e.stride):r;for(const i of e.fieldNames){const n=e.fields.get(i);this[i]=new n.constructor(this.buffer,n.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,r){const i=this[e];return i&&i.elementCount===r.ElementCount&&i.elementType===r.ElementType?i:null}slice(e,r){return new bNe(this.layout,this.buffer.slice(e*this.stride,r*this.stride))}copyFrom(e,r,i,n){const s=this.stride;if(s%4==0){const o=new Uint32Array(e.buffer,r*s,n*s/4);new Uint32Array(this.buffer,i*s,n*s/4).set(o)}else{const o=new Uint8Array(e.buffer,r*s,n*s);new Uint8Array(this.buffer,i*s,n*s).set(o)}}},gvt=class wNe{constructor(){this.stride=0,this.fields=new Map,this.fieldNames=[]}vec2f(e,r){return this._appendField(e,q_,r),this}vec2f64(e,r){return this._appendField(e,qae,r),this}vec3f(e,r){return this._appendField(e,Ui,r),this}vec3f64(e,r){return this._appendField(e,ml,r),this}vec4f(e,r){return this._appendField(e,Yu,r),this}vec4f64(e,r){return this._appendField(e,ZB,r),this}mat3f(e,r){return this._appendField(e,fw,r),this}mat3f64(e,r){return this._appendField(e,jae,r),this}mat4f(e,r){return this._appendField(e,Gae,r),this}mat4f64(e,r){return this._appendField(e,vD,r),this}vec4u8(e,r){return this._appendField(e,gl,r),this}f32(e,r){return this._appendField(e,Bae,r),this}f64(e,r){return this._appendField(e,Hae,r),this}u8(e,r){return this._appendField(e,GO,r),this}u16(e,r){return this._appendField(e,KB,r),this}i8(e,r){return this._appendField(e,Yae,r),this}vec2i8(e,r){return this._appendField(e,t7,r),this}vec2i16(e,r){return this._appendField(e,r7,r),this}vec2u8(e,r){return this._appendField(e,JB,r),this}vec4u16(e,r){return this._appendField(e,jN,r),this}u32(e,r){return this._appendField(e,e7,r),this}_appendField(e,r,i){const n=r.ElementCount*vNe(r.ElementType),s=this.stride;this.fields.set(e,{size:n,constructor:r,offset:s,optional:i}),this.stride+=n,this.fieldNames.push(e)}alignTo(e){return this.stride=Math.floor((this.stride+e-1)/e)*e,this}hasField(e){return this.fieldNames.includes(e)}createBuffer(e){return new Pye(this,e)}createView(e){return new Pye(this,e)}clone(){const e=new wNe;return e.stride=this.stride,e.fields=new Map,this.fields.forEach((r,i)=>e.fields.set(i,r)),e.fieldNames=this.fieldNames.slice(),e.BufferType=this.BufferType,e}};function mn(){return new gvt}let Qe=class{constructor(e,r,i=!1,n=r){this.data=e,this.size=r,this.exclusive=i,this.stride=n}};var Hee;(function(t){function e(o,a){const l=o[a],c=o[a+1],h=o[a+2];return Math.sqrt(l*l+c*c+h*h)}function r(o,a){const l=o[a],c=o[a+1],h=o[a+2],p=1/Math.sqrt(l*l+c*c+h*h);o[a]*=p,o[a+1]*=p,o[a+2]*=p}function i(o,a,l){o[a]*=l,o[a+1]*=l,o[a+2]*=l}function n(o,a,l,c,h,p=a){(h=h||o)[p]=o[a]+l[c],h[p+1]=o[a+1]+l[c+1],h[p+2]=o[a+2]+l[c+2]}function s(o,a,l,c,h,p=a){(h=h||o)[p]=o[a]-l[c],h[p+1]=o[a+1]-l[c+1],h[p+2]=o[a+2]-l[c+2]}t.length=e,t.normalize=r,t.scale=i,t.add=n,t.subtract=s})(Hee||(Hee={}));var Wn;(function(t){t[t.Layer=0]="Layer",t[t.Object=1]="Object",t[t.Mesh=2]="Mesh",t[t.Line=3]="Line",t[t.Point=4]="Point",t[t.Material=5]="Material",t[t.Texture=6]="Texture",t[t.COUNT=7]="COUNT"})(Wn||(Wn={}));function Zu(t,e=!1){return t<=ey?e?new Array(t).fill(0):new Array(t):new Float64Array(t)}function yvt(t){return length<=ey?Array.from(t):new Float64Array(t)}function _p(t,e,r){return Array.isArray(t)?t.slice(e,e+r):t.subarray(e,e+r)}function us(t,e=!1){return t<=ey?e?new Array(t).fill(0):new Array(t):new Float32Array(t)}function Iye(t){return length<=ey?Array.from(t):new Float32Array(t)}function $ye(t,e,r){return Array.isArray(t)?t.slice(e,e+r):t.subarray(e,e+r)}function _vt(t){if(t.length<ey)return Array.from(t);if(Array.isArray(t))return Float64Array.from(t);switch(t.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(t);case 2:return Uint16Array.from(t);case 4:return Float32Array.from(t);default:return Float64Array.from(t)}}const Cl=pr();let vvt=class{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}};function wt(t,e){if(!t){e=e||"Assertion";const r=new Error(e).stack;throw new vvt(`${e} at ${r}`)}}function _E(t,e){t||(e=e||"",console.warn("Verify failed: "+e+`
`+new Error("verify").stack))}function Lye(t,e,r,i){let n,s=(r[0]-t[0])/e[0],o=(i[0]-t[0])/e[0];s>o&&(n=s,s=o,o=n);let a=(r[1]-t[1])/e[1],l=(i[1]-t[1])/e[1];if(a>l&&(n=a,a=l,l=n),s>l||a>o)return!1;a>s&&(s=a),l<o&&(o=l);let c=(r[2]-t[2])/e[2],h=(i[2]-t[2])/e[2];return c>h&&(n=c,c=h,h=n),!(s>h||c>o)&&(h<o&&(o=h),!(o<0))}function G4(t,e,r,i,n,s=Ne()){const o=(i[n]-r[n])*(e[0]-t[0])-(i[0]-r[0])*(e[n]-t[n]),a=(i[0]-r[0])*(t[n]-r[n])-(i[n]-r[n])*(t[0]-r[0]);if(o===0)return!1;const l=a/o;return s[0]=t[0]+l*(e[0]-t[0]),s[1]=t[n]+l*(e[n]-t[n]),!0}function Dye(t,e,r,i,n){Cl[0]=t[0],Cl[1]=t[1],Cl[2]=t[2],Cl[3]=1,qh(Cl,Cl,e),n.length>2&&(n[2]=-Cl[2]),qh(Cl,Cl,r),wt(Cl[3]!==0),n[0]=Cl[0]/Cl[3],n[1]=Cl[1]/Cl[3],n[2]=Cl[2]/Cl[3],n[0]=(.5*n[0]+.5)*i[2]+i[0],n[1]=(.5*n[1]+.5)*i[3]+i[1]}function bvt(t,e){return Math.log(t)/Math.log(e)}function wvt(t,e,r,i){t[12]=e,t[13]=r,t[14]=i}function xNe(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[7]===0&&t[8]===0&&t[9]===0&&t[10]===1&&t[11]===0&&t[15]===1}let TNe=class SNe{constructor(e,r,i,n){this.primitiveIndices=e,this._numIndexPerPrimitive=r,this.indices=i,this.position=n,this._children=void 0,wt(e.length>=1),wt(i.length%this._numIndexPerPrimitive==0),wt(i.length>=e.length*this._numIndexPerPrimitive),wt(n.size===3||n.size===4);const{data:s,size:o}=n,a=e.length;let l=o*i[this._numIndexPerPrimitive*e[0]];rx.clear(),rx.push(l);const c=ke(s[l],s[l+1],s[l+2]),h=On(c);for(let m=0;m<a;++m){const g=this._numIndexPerPrimitive*e[m];for(let _=0;_<this._numIndexPerPrimitive;++_){l=o*i[g+_],rx.push(l);let b=s[l];c[0]=Math.min(b,c[0]),h[0]=Math.max(b,h[0]),b=s[l+1],c[1]=Math.min(b,c[1]),h[1]=Math.max(b,h[1]),b=s[l+2],c[2]=Math.min(b,c[2]),h[2]=Math.max(b,h[2])}}this.bbMin=c,this.bbMax=h;const p=fs(P(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(h[0]-c[0],h[1]-c[1]),h[2]-c[2]);let f=this.radius*this.radius;for(let m=0;m<rx.length;++m){l=rx.getItemAt(m);const g=s[l]-p[0],_=s[l+1]-p[1],b=s[l+2]-p[2],w=g*g+_*_+b*b;if(w<=f)continue;const x=Math.sqrt(w),T=.5*(x-this.radius);this.radius=this.radius+T,f=this.radius*this.radius;const E=T/x;p[0]+=g*E,p[1]+=_*E,p[2]+=b*E}this.center=p,rx.clear()}getChildren(){if(this._children||ga(this.bbMin,this.bbMax)<=1)return this._children;const e=fs(P(),this.bbMin,this.bbMax,.5),r=this.primitiveIndices.length,i=new Uint8Array(r),n=new Array(8);for(let c=0;c<8;++c)n[c]=0;const{data:s,size:o}=this.position;for(let c=0;c<r;++c){let h=0;const p=this._numIndexPerPrimitive*this.primitiveIndices[c];let f=o*this.indices[p],m=s[f],g=s[f+1],_=s[f+2];for(let b=1;b<this._numIndexPerPrimitive;++b){f=o*this.indices[p+b];const w=s[f],x=s[f+1],T=s[f+2];w<m&&(m=w),x<g&&(g=x),T<_&&(_=T)}m<e[0]&&(h|=1),g<e[1]&&(h|=2),_<e[2]&&(h|=4),i[c]=h,++n[h]}let a=0;for(let c=0;c<8;++c)n[c]>0&&++a;if(a<2)return;const l=new Array(8);for(let c=0;c<8;++c)l[c]=n[c]>0?new Uint32Array(n[c]):void 0;for(let c=0;c<8;++c)n[c]=0;for(let c=0;c<r;++c){const h=i[c];l[h][n[h]++]=this.primitiveIndices[c]}this._children=new Array;for(let c=0;c<8;++c)l[c]!==void 0&&this._children.push(new SNe(l[c],this._numIndexPerPrimitive,this.indices,this.position));return this._children}static prune(){rx.prune()}};const rx=new Wt({deallocator:null});let GN=class{constructor(){this.id=Vu()}unload(){}};function xvt(t){return t?{p0:On(t.p0),p1:On(t.p1),p2:On(t.p2)}:{p0:P(),p1:P(),p2:P()}}function Nye(t,e,r){const i=e[0]-t[0],n=e[1]-t[1],s=r[0]-t[0],o=r[1]-t[1];return .5*Math.abs(i*o-n*s)}function Tvt(t,e,r){return ge(HH,e,t),ge(Fye,r,t),Pe(vt(HH,HH,Fye))/2}new F_(vm);new F_(()=>xvt());const HH=P(),Fye=P();function Svt(t,e,r){if(!t||!e)return!1;const{size:i,data:n}=t;he(r,0,0,0),he(jd,0,0,0);let s=0,o=0;for(let a=0;a<e.length-2;a+=3){const l=e[a+0]*i,c=e[a+1]*i,h=e[a+2]*i;he(Mo,n[l+0],n[l+1],n[l+2]),he(U0,n[c+0],n[c+1],n[c+2]),he(H4,n[h+0],n[h+1],n[h+2]);const p=Tvt(Mo,U0,H4);p?(me(Mo,Mo,U0),me(Mo,Mo,H4),le(Mo,Mo,1/3*p),me(r,r,Mo),s+=p):(me(jd,jd,Mo),me(jd,jd,U0),me(jd,jd,H4),o+=3)}return(o!==0||s!==0)&&(s!==0?(le(r,r,1/s),!0):o!==0&&(le(r,jd,1/o),!0))}function Evt(t,e,r){if(!t||!e)return!1;const{size:i,data:n}=t;he(r,0,0,0);let s=-1,o=0;for(let a=0;a<e.length;a++){const l=e[a]*i;s!==l&&(r[0]+=n[l+0],r[1]+=n[l+1],r[2]+=n[l+2],o++),s=l}return o>1&&le(r,r,1/o),o>0}function Cvt(t,e,r,i){if(!t)return!1;he(i,0,0,0),he(jd,0,0,0);let n=0,s=0;const{size:o,data:a}=t,l=e?e.length-1:a.length/o-1,c=l+(r?2:0);for(let h=0;h<c;h+=2){const p=h<l?h:l,f=h<l?h+1:0,m=(e?e[p]:p)*o,g=(e?e[f]:f)*o;Mo[0]=a[m],Mo[1]=a[m+1],Mo[2]=a[m+2],U0[0]=a[g],U0[1]=a[g+1],U0[2]=a[g+2],le(Mo,me(Mo,Mo,U0),.5);const _=yN(Mo,U0);_>0?(me(i,i,le(Mo,Mo,_)),n+=_):n===0&&(me(jd,jd,Mo),s++)}return n!==0?(le(i,i,1/n),!0):s!==0&&(le(i,jd,1/s),!0)}const Mo=P(),U0=P(),H4=P(),jd=P();function NR(t){if(Array.isArray(t)){if(t.length<ey)return t;for(const e of t)if(e>=65536)return new Uint32Array(t);return new Uint16Array(t)}if(t.length<ey)return Array.from(t);if(t.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return t;for(const e of t)if(e>=65536)return t;return new Uint16Array(t)}function ENe(t){const e=3*t;return e<=ey?new Array(e):e<=65536?new Uint16Array(e):new Uint32Array(e)}let F1=(()=>{const t=new Uint32Array(131072);for(let e=0;e<t.length;++e)t[e]=e;return t})();const CNe=[0],FR=(()=>{const t=new Uint16Array(65536);for(let e=0;e<t.length;++e)t[e]=e;return t})();function HO(t){if(t===1)return CNe;if(t<ey)return Array.from(new Uint16Array(FR.buffer,0,t));if(t<FR.length)return new Uint16Array(FR.buffer,0,t);if(t>F1.length){const e=Math.max(2*F1.length,t);F1=new Uint32Array(e);for(let r=0;r<F1.length;r++)F1[r]=r}return new Uint32Array(F1.buffer,0,t)}function jqt(t){if(t===1)return CNe;if(t<ey)return Array.from(new Uint16Array(FR.buffer,0,t));if(t<FR.length)return new Uint16Array(FR.slice(0,t));if(t>F1.length){const e=new Uint32Array(t);for(let r=0;r<e.length;r++)e[r]=r;return e}return new Uint32Array(F1.slice(0,t))}let aV=class{constructor(e){this.channel=e,this.id=Vu()}};function qee(t,e,r){for(let i=0;i<r;++i)e[2*i]=t[i],e[2*i+1]=t[i]-e[2*i]}function Avt(t,e){const r=t.length;for(let i=0;i<r;++i)iR[0]=t[i],e[i]=iR[0];return e}function Rvt(t,e){const r=t.length;for(let i=0;i<r;++i)iR[0]=t[i],iR[1]=t[i]-iR[0],e[i]=iR[1];return e}const iR=new Float32Array(2);function Wee(t,e){return R(t)&&(t=[]),t.push(e),t}function Xee(t,e){if(R(t))return null;const r=t.filter(i=>i!==e);return r.length===0?null:r}function Ovt(t,e,r,i,n){q4[0]=t.get(e,0),q4[1]=t.get(e,1),q4[2]=t.get(e,2),qee(q4,ix,3),r.set(n,0,ix[0]),i.set(n,0,ix[1]),r.set(n,1,ix[2]),i.set(n,1,ix[3]),r.set(n,2,ix[4]),i.set(n,2,ix[5])}const q4=P(),ix=new Float32Array(6);let As=class ANe extends GN{constructor(e,r,i=[],n=null,s=Wn.Mesh,o=null,a=-1){super(),this.material=e,this.mapPositions=n,this.type=s,this.objectAndLayerIdColor=o,this.edgeIndicesLength=a,this.visible=!0,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[l,c]of r)c&&this._vertexAttributes.set(l,{...c});if(i==null||i.length===0){const l=Mvt(this._vertexAttributes),c=HO(l);this.edgeIndicesLength=this.edgeIndicesLength<0?l:this.edgeIndicesLength;for(const h of this._vertexAttributes.keys())this._indices.set(h,c)}else for(const[l,c]of i)c&&(this._indices.set(l,NR(c)),l===O.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(l).length:this.edgeIndicesLength))}instantiate(e={}){const r=new ANe(e.material||this.material,[],void 0,this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._vertexAttributes.forEach((i,n)=>{i.exclusive=!1,r._vertexAttributes.set(n,i)}),this._indices.forEach((i,n)=>r._indices.set(n,i)),r._boundingInfo=this._boundingInfo,r.transformation=e.transformation||this.transformation,r}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(e){let r=this._vertexAttributes.get(e);return r&&!r.exclusive&&(r={...r,exclusive:!0,data:_vt(r.data)},this._vertexAttributes.set(e,r)),r}get indices(){return this._indices}get indexCount(){const e=this._indices.values().next().value;return e?e.length:0}get faceCount(){return this.indexCount/3}get boundingInfo(){return R(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===Wn.Mesh?this._computeAttachmentOriginTriangles(e):this.type===Wn.Line?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(v(this._transformation)&&Ke(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){const r=this.indices.get(O.POSITION),i=this.vertexAttributes.get(O.POSITION);return Svt(i,r,e)}_computeAttachmentOriginLines(e){const r=this.vertexAttributes.get(O.POSITION),i=this.indices.get(O.POSITION);return Cvt(r,i,i&&Pvt(this.material.parameters,r,i),e)}_computeAttachmentOriginPoints(e){const r=this.indices.get(O.POSITION),i=this.vertexAttributes.get(O.POSITION);return Evt(i,r,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.indices.get(O.POSITION),r=this.vertexAttributes.get(O.POSITION);if(!e||e.length===0||!r)return null;const i=this.type===Wn.Mesh?3:1;wt(e.length%i==0,"Indexing error: "+e.length+" not divisible by "+i);const n=HO(e.length/i);return new TNe(n,i,e,r)}get transformation(){return Nt(this._transformation,id)}set transformation(e){this._transformation=e&&e!==id?zO(e):null}get shaderTransformation(){return v(this._shaderTransformer)?this._shaderTransformer(this.transformation):this.transformation}get shaderTransformer(){return this._shaderTransformer}set shaderTransformer(e){this._shaderTransformer=e}get hasVolatileTransformation(){return v(this._shaderTransformer)}addHighlight(){const e=new aV(A_.Highlight);return this.highlights=Wee(this.highlights,e),e}removeHighlight(e){this.highlights=Xee(this.highlights,e)}};function Mvt(t){const e=t.values().next().value;return e==null?0:e.data.length/e.size}function Pvt(t,e,r){return!(!("isClosed"in t)||!t.isClosed)&&(r?r.length>2:e.data.length>6)}const vE=Hee,qH=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],Ivt=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],$vt=[0,0,1,0,1,1,0,1],Lvt=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],RNe=new Array(36);for(let t=0;t<6;t++)for(let e=0;e<6;e++)RNe[6*t+e]=t;const ET=new Array(36);for(let t=0;t<6;t++)ET[6*t+0]=0,ET[6*t+1]=1,ET[6*t+2]=2,ET[6*t+3]=2,ET[6*t+4]=3,ET[6*t+5]=0;function Dvt(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(24);for(let i=0;i<8;i++)r[3*i]=qH[i][0]*e[0],r[3*i+1]=qH[i][1]*e[1],r[3*i+2]=qH[i][2]*e[2];return new As(t,[[O.POSITION,new Qe(r,3,!0)],[O.NORMAL,new Qe(Ivt,3)],[O.UV0,new Qe($vt,2)]],[[O.POSITION,Lvt],[O.NORMAL,RNe],[O.UV0,ET]])}const WH=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],Nvt=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],Fvt=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],kvt=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function Uvt(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(18);for(let i=0;i<6;i++)r[3*i]=WH[i][0]*e[0],r[3*i+1]=WH[i][1]*e[1],r[3*i+2]=WH[i][2]*e[2];return new As(t,[[O.POSITION,new Qe(r,3,!0)],[O.NORMAL,new Qe(Nvt,3)]],[[O.POSITION,Fvt],[O.NORMAL,kvt]])}const CU=ti(-.5,0,-.5),AU=ti(.5,0,-.5),RU=ti(0,0,.5),OU=ti(0,.5,0),bE=Ki(),wE=Ki(),kR=Ki(),UR=Ki(),zR=Ki();ge(bE,CU,OU),ge(wE,CU,AU),vt(kR,bE,wE),we(kR,kR),ge(bE,AU,OU),ge(wE,AU,RU),vt(UR,bE,wE),we(UR,UR),ge(bE,RU,OU),ge(wE,RU,CU),vt(zR,bE,wE),we(zR,zR);const XH=[CU,AU,RU,OU],zvt=[0,-1,0,kR[0],kR[1],kR[2],UR[0],UR[1],UR[2],zR[0],zR[1],zR[2]],Vvt=[0,1,2,3,1,0,3,2,1,3,0,2],Bvt=[0,0,0,1,1,1,2,2,2,3,3,3];function jvt(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(12);for(let i=0;i<4;i++)r[3*i]=XH[i][0]*e[0],r[3*i+1]=XH[i][1]*e[1],r[3*i+2]=XH[i][2]*e[2];return new As(t,[[O.POSITION,new Qe(r,3,!0)],[O.NORMAL,new Qe(zvt,3)]],[[O.POSITION,Vvt],[O.NORMAL,Bvt]])}function Hqt(t,e,r,i,n={uv:!0}){const s=-Math.PI,o=2*Math.PI,a=-Math.PI/2,l=Math.PI,c=Math.max(3,Math.floor(r)),h=Math.max(2,Math.floor(i)),p=(c+1)*(h+1),f=us(3*p),m=us(3*p),g=us(2*p),_=[];let b=0;for(let E=0;E<=h;E++){const C=[],A=E/h,I=a+A*l,M=Math.cos(I);for(let D=0;D<=c;D++){const U=D/c,z=s+U*o,B=Math.cos(z)*M,ee=Math.sin(I),te=-Math.sin(z)*M;f[3*b]=B*e,f[3*b+1]=ee*e,f[3*b+2]=te*e,m[3*b]=B,m[3*b+1]=ee,m[3*b+2]=te,g[2*b]=U,g[2*b+1]=A,C.push(b),++b}_.push(C)}const w=new Array;for(let E=0;E<h;E++)for(let C=0;C<c;C++){const A=_[E][C],I=_[E][C+1],M=_[E+1][C+1],D=_[E+1][C];E===0?(w.push(A),w.push(M),w.push(D)):E===h-1?(w.push(A),w.push(I),w.push(M)):(w.push(A),w.push(I),w.push(M),w.push(M),w.push(D),w.push(A))}const x=[[O.POSITION,w],[O.NORMAL,w]],T=[[O.POSITION,new Qe(f,3,!0)],[O.NORMAL,new Qe(m,3,!0)]];return n.uv&&(T.push([O.UV0,new Qe(g,2,!0)]),x.push([O.UV0,w])),n.offset&&(x[0][0]=O.OFFSET,T[0][0]=O.OFFSET,x.push([O.POSITION,new Array(w.length).fill(0)]),T.push([O.POSITION,new Qe(Float64Array.from(n.offset),3,!0)])),new As(t,T,x)}function Gvt(t,e,r,i){const{vertexAttributes:n,indices:s}=ONe(e,r,i);return new As(t,n,s)}function ONe(t,e,r){const i=t;let n,s;if(r)n=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],s=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const h=i*(1+Math.sqrt(5))/2;n=[-i,h,0,i,h,0,-i,-h,0,i,-h,0,0,-i,h,0,i,h,0,-i,-h,0,i,-h,h,0,-i,h,0,i,-h,0,-i,-h,0,i],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let h=0;h<n.length;h+=3)vE.scale(n,h,t/vE.length(n,h));let o={};function a(h,p){h>p&&([h,p]=[p,h]);const f=h.toString()+"."+p.toString();if(o[f])return o[f];let m=n.length;return n.length+=3,vE.add(n,3*h,n,3*p,n,m),vE.scale(n,m,t/vE.length(n,m)),m/=3,o[f]=m,m}for(let h=0;h<e;h++){const p=s.length,f=new Array(4*p);for(let m=0;m<p;m+=3){const g=s[m],_=s[m+1],b=s[m+2],w=a(g,_),x=a(_,b),T=a(b,g),E=4*m;f[E]=g,f[E+1]=w,f[E+2]=T,f[E+3]=_,f[E+4]=x,f[E+5]=w,f[E+6]=b,f[E+7]=T,f[E+8]=x,f[E+9]=w,f[E+10]=x,f[E+11]=T}s=f,o={}}const l=Iye(n);for(let h=0;h<l.length;h+=3)vE.normalize(l,h);const c=[[O.POSITION,s],[O.NORMAL,s]];return{vertexAttributes:[[O.POSITION,new Qe(Iye(n),3,!0)],[O.NORMAL,new Qe(l,3,!0)]],indices:c}}function Yee(t,e,r,i,n,s,o,a,l=null){const c=r?[r[0],r[1],r[2]]:[0,0,0],h=e?[e[0],e[1],e[2]]:[0,0,1];o=o||[0,0];const p=i?[255*i[0],255*i[1],255*i[2],i.length>3?255*i[3]:255]:[255,255,255,255],f=v(n)&&n.length===2?n:[1,1],m=[[O.POSITION,new Qe(c,3,!0)],[O.NORMAL,new Qe(h,3,!0)],[O.UV0,new Qe(o,o.length)],[O.COLOR,new Qe(p,4,!0)],[O.SIZE,new Qe(f,2)]];if(s!=null){const g=[s[0],s[1],s[2],s[3]];m.push([O.AUXPOS1,new Qe(g,4)])}if(a!=null){const g=[a[0],a[1],a[2],a[3]];m.push([O.AUXPOS2,new Qe(g,4)])}return new As(t,m,null,null,Wn.Point,l)}const Hvt=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function qqt(t,e=Hvt){const r=new Array(12);for(let h=0;h<4;h++)for(let p=0;p<3;p++)r[3*h+p]=e[h][p];const i=[0,1,2,2,3,0],n=[0,0,1],s=[0,0,0,0,0,0],o=[0,0,1,0,1,1,0,1],a=[255,255,255,255],l=[[O.POSITION,i],[O.NORMAL,s],[O.UV0,i],[O.COLOR,s]],c=[[O.POSITION,new Qe(r,3,!0)],[O.NORMAL,new Qe(n,3,!0)],[O.UV0,new Qe(o,2,!0)],[O.COLOR,new Qe(a,4,!0)]];return new As(t,c,l)}function kye(t,e,r,i,n,s=!0,o=!0){let a=0;const l=r,c=e;let h=ti(0,a,0),p=ti(0,a+c,0),f=ti(0,-1,0),m=ti(0,1,0);n&&(a=c,p=ti(0,0,0),h=ti(0,a,0),f=ti(0,1,0),m=ti(0,-1,0));const g=[p,h],_=[f,m],b=i+2,w=Math.sqrt(c*c+l*l);if(n)for(let M=i-1;M>=0;M--){const D=M*(2*Math.PI/i),U=ti(Math.cos(D)*l,a,Math.sin(D)*l);g.push(U);const z=ti(c*Math.cos(D)/w,-l/w,c*Math.sin(D)/w);_.push(z)}else for(let M=0;M<i;M++){const D=M*(2*Math.PI/i),U=ti(Math.cos(D)*l,a,Math.sin(D)*l);g.push(U);const z=ti(c*Math.cos(D)/w,l/w,c*Math.sin(D)/w);_.push(z)}const x=new Array,T=new Array;if(s){for(let M=3;M<g.length;M++)x.push(1),x.push(M-1),x.push(M),T.push(0),T.push(0),T.push(0);x.push(g.length-1),x.push(2),x.push(1),T.push(0),T.push(0),T.push(0)}if(o){for(let M=3;M<g.length;M++)x.push(M),x.push(M-1),x.push(0),T.push(M),T.push(M-1),T.push(1);x.push(0),x.push(2),x.push(g.length-1),T.push(1),T.push(2),T.push(_.length-1)}const E=us(3*b);for(let M=0;M<b;M++)E[3*M]=g[M][0],E[3*M+1]=g[M][1],E[3*M+2]=g[M][2];const C=us(3*b);for(let M=0;M<b;M++)C[3*M]=_[M][0],C[3*M+1]=_[M][1],C[3*M+2]=_[M][2];const A=[[O.POSITION,x],[O.NORMAL,T]],I=[[O.POSITION,new Qe(E,3,!0)],[O.NORMAL,new Qe(C,3,!0)]];return new As(t,I,A)}function qvt(t,e,r,i,n,s,o){const a=n?rV(n):ti(1,0,0),l=s?rV(s):ti(0,0,0);o=o??!0;const c=Ki();we(c,a);const h=Ki();le(h,c,Math.abs(e));const p=Ki();le(p,h,-.5),me(p,p,l);const f=ti(0,1,0);Math.abs(1-ve(c,f))<.2&&he(f,0,0,1);const m=Ki();vt(m,c,f),we(m,m),vt(f,m,c);const g=2*i+(o?2:0),_=i+(o?2:0),b=us(3*g),w=us(3*_),x=us(2*g),T=new Array(3*i*(o?4:2)),E=new Array(3*i*(o?4:2));o&&(b[3*(g-2)+0]=p[0],b[3*(g-2)+1]=p[1],b[3*(g-2)+2]=p[2],x[2*(g-2)]=0,x[2*(g-2)+1]=0,b[3*(g-1)+0]=b[3*(g-2)+0]+h[0],b[3*(g-1)+1]=b[3*(g-2)+1]+h[1],b[3*(g-1)+2]=b[3*(g-2)+2]+h[2],x[2*(g-1)]=1,x[2*(g-1)+1]=1,w[3*(_-2)+0]=-c[0],w[3*(_-2)+1]=-c[1],w[3*(_-2)+2]=-c[2],w[3*(_-1)+0]=c[0],w[3*(_-1)+1]=c[1],w[3*(_-1)+2]=c[2]);const C=(z,B,ee)=>{T[z]=B,E[z]=ee};let A=0;const I=Ki(),M=Ki();for(let z=0;z<i;z++){const B=z*(2*Math.PI/i);le(I,f,Math.sin(B)),le(M,m,Math.cos(B)),me(I,I,M),w[3*z+0]=I[0],w[3*z+1]=I[1],w[3*z+2]=I[2],le(I,I,r),me(I,I,p),b[3*z+0]=I[0],b[3*z+1]=I[1],b[3*z+2]=I[2],x[2*z+0]=z/i,x[2*z+1]=0,b[3*(z+i)+0]=b[3*z+0]+h[0],b[3*(z+i)+1]=b[3*z+1]+h[1],b[3*(z+i)+2]=b[3*z+2]+h[2],x[2*(z+i)+0]=z/i,x[2*z+1]=1;const ee=(z+1)%i;C(A++,z,z),C(A++,z+i,z),C(A++,ee,ee),C(A++,ee,ee),C(A++,z+i,z),C(A++,ee+i,ee)}if(o){for(let z=0;z<i;z++){const B=(z+1)%i;C(A++,g-2,_-2),C(A++,z,_-2),C(A++,B,_-2)}for(let z=0;z<i;z++){const B=(z+1)%i;C(A++,z+i,_-1),C(A++,g-1,_-1),C(A++,B+i,_-1)}}const D=[[O.POSITION,T],[O.NORMAL,E],[O.UV0,T]],U=[[O.POSITION,new Qe(b,3,!0)],[O.NORMAL,new Qe(w,3,!0)],[O.UV0,new Qe(x,2,!0)]];return new As(t,U,D)}function Wqt(t,e,r,i,n,s,o=ti(0,0,0)){const a=e.length,l=us(r.length*a*3+(6*i.length||0)),c=us(r.length*a*3+(i?6:0)),h=new Array,p=new Array;let f=0,m=0;const g=Ki(),_=Ki(),b=Ki(),w=Ki(),x=Ki(),T=Ki(),E=Ki(),C=P(),A=Ki(),I=Ki(),M=Ki(),D=Ki(),U=Ki(),z=Yr();he(A,0,1,0),ge(_,r[1],r[0]),we(_,_),s?(me(C,r[0],o),we(b,C)):he(b,0,0,1),lV(_,b,A,A,x,b,Uye),ce(w,b),ce(D,x);for(let F=0;F<i.length;F++)le(T,x,i[F][0]),le(C,b,i[F][2]),me(T,T,C),me(T,T,r[0]),l[f++]=T[0],l[f++]=T[1],l[f++]=T[2];c[m++]=-_[0],c[m++]=-_[1],c[m++]=-_[2];for(let F=0;F<n.length;F++)h.push(n[F][0]>0?n[F][0]:-n[F][0]-1+i.length),h.push(n[F][1]>0?n[F][1]:-n[F][1]-1+i.length),h.push(n[F][2]>0?n[F][2]:-n[F][2]-1+i.length),p.push(0),p.push(0),p.push(0);let B=i.length;const ee=i.length-1;for(let F=0;F<r.length;F++){let G=!1;F>0&&(ce(g,_),F<r.length-1?(ge(_,r[F+1],r[F]),we(_,_)):G=!0,me(I,g,_),we(I,I),me(M,r[F-1],w),UN(r[F],I,z),j2(z,nd(M,g),C)?(ge(C,C,r[F]),we(b,C),vt(x,I,b),we(x,x)):lV(I,w,D,A,x,b,Uye),ce(w,b),ce(D,x)),s&&(me(C,r[F],o),we(U,C));for(let q=0;q<a;q++)if(le(T,x,e[q][0]),le(C,b,e[q][1]),me(T,T,C),we(E,T),c[m++]=E[0],c[m++]=E[1],c[m++]=E[2],me(T,T,r[F]),l[f++]=T[0],l[f++]=T[1],l[f++]=T[2],!G){const Z=(q+1)%a;h.push(B+q),h.push(B+a+q),h.push(B+Z),h.push(B+Z),h.push(B+a+q),h.push(B+a+Z);for(let X=0;X<6;X++){const oe=h.length-6;p.push(h[oe+X]-ee)}}B+=a}const te=r[r.length-1];for(let F=0;F<i.length;F++)le(T,x,i[F][0]),le(C,b,i[F][1]),me(T,T,C),me(T,T,te),l[f++]=T[0],l[f++]=T[1],l[f++]=T[2];const K=m/3;c[m++]=_[0],c[m++]=_[1],c[m++]=_[2];const W=B-a;for(let F=0;F<n.length;F++)h.push(n[F][0]>=0?B+n[F][0]:-n[F][0]-1+W),h.push(n[F][2]>=0?B+n[F][2]:-n[F][2]-1+W),h.push(n[F][1]>=0?B+n[F][1]:-n[F][1]-1+W),p.push(K),p.push(K),p.push(K);const N=[[O.POSITION,h],[O.NORMAL,p]],L=[[O.POSITION,new Qe(l,3,!0)],[O.NORMAL,new Qe(c,3,!0)]];return new As(t,L,N)}function Xqt(t,e,r,i){wt(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),wt(e[0].length===3,"createPolylineGeometry(): malformed vertex"),wt(r==null||r.length===e.length,"createPolylineGeometry: need same number of points and normals"),wt(r==null||r[0].length===3,"createPolylineGeometry(): malformed normal");const n=Zu(3*e.length),s=new Array(2*(e.length-1));let o=0,a=0;for(let h=0;h<e.length;h++){for(let p=0;p<3;p++)n[o++]=e[h][p];h>0&&(s[a++]=h-1,s[a++]=h)}const l=[],c=[];if(l.push([O.POSITION,s]),c.push([O.POSITION,new Qe(n,3,!0)]),r){const h=us(3*r.length);let p=0;for(let f=0;f<e.length;f++)for(let m=0;m<3;m++)h[p++]=r[f][m];l.push([O.NORMAL,s]),c.push([O.NORMAL,new Qe(h,3,!0)])}return i&&(c.push([O.COLOR,new Qe(i,4)]),l.push([O.COLOR,HO(i.length/4)])),new As(t,c,l,null,Wn.Line)}function Wvt(t,e=t){const r=t.vertexAttributes,i=r.get(O.POSITION).data,n=r.get(O.NORMAL).data;if(n){const s=e.getMutableAttribute(O.NORMAL).data;for(let o=0;o<n.length;o+=3){const a=n[o+1];s[o+1]=-n[o+2],s[o+2]=a}}if(i){const s=e.getMutableAttribute(O.POSITION).data;for(let o=0;o<i.length;o+=3){const a=i[o+1];s[o+1]=-i[o+2],s[o+2]=a}}}function YH(t,e,r,i,n){return!(Math.abs(ve(e,t))>n)&&(vt(r,t,e),we(r,r),vt(i,r,t),we(i,i),!0)}function lV(t,e,r,i,n,s,o){return YH(t,e,n,s,o)||YH(t,r,n,s,o)||YH(t,i,n,s,o)}const Uye=.99619469809;let Xvt=class{constructor(e,r){this.type=ro.Panoramic,this._configuration=new kae,this._passParameters=new Uae,this._configuration.geometry=dy.Cylinder,this._technique=r.techniqueRepository.acquire(oV,this._configuration);const i=r.renderContext.rctx;this._vao=this._createVertexArrayObject(i),this._vaoCount=Da(this._vao,"geometry"),this._passParameters.texture=new mt(i,{pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE,samplingMode:it.LINEAR,flipped:!0,width:1,height:512},oNe)}destroy(){this._passParameters.texture=rt(this._passParameters.texture),this._vao.dispose(),this._technique.release()}render(e){const r=e.rctx,i=r.bindTechnique(this._technique,this._passParameters,e.bindParameters);Yvt(zye,e.bindParameters.camera.viewMatrix),i.setUniformMatrix4fv("view",zye),r.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(Ft.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(e){const r=ONe(1,2,!1),i=r.indices[0][1],n=r.vertexAttributes[0][1];for(let l=0;l<i.length;l+=3){const c=i[l];i[l]=i[l+2],i[l+2]=c}const s=n.data,o=Vye.createBuffer(i.length),a=o.position;for(let l=0;l<i.length;++l){const c=3*i[l];a.set(l,0,s[c]),a.set(l,1,s[c+1]),a.set(l,2,s[c+2])}return new wm(e,Lr,{geometry:eh(Vye)},{geometry:Kr.createVertex(e,zr.STATIC_DRAW,o.buffer)})}};function Yvt(t,e){po(t,e),t[12]=0,t[13]=0,t[14]=0,t[15]=1}const zye=$e(),Vye=mn().vec3f(O.POSITION);var R_;(function(t){t[t.Rain=0]="Rain",t[t.Snow=1]="Snow",t[t.COUNT=2]="COUNT"})(R_||(R_={}));let Zee=class extends _l{constructor(){super(...arguments),this.type=R_.Rain}};u([j({count:R_.COUNT})],Zee.prototype,"type",void 0);function Zvt(t){const e=new Br;return e.attributes.add(O.POSITION,"vec3"),e.attributes.add(O.INSTANCEFEATUREATTRIBUTE,"float"),e.vertex.uniforms.add(new Jt("cameraPosition",(r,i)=>i.camera.eye)),e.vertex.uniforms.add(new Jt("offset",(r,i)=>Jvt(r,i))),e.vertex.uniforms.add(new Ie("width",r=>r.width)),e.vertex.uniforms.add(new rn("proj",(r,i)=>i.camera.projectionMatrix)),e.vertex.uniforms.add(new rn("view",(r,i)=>i.camera.viewMatrix)),e.vertex.uniforms.add(new Ie("time",r=>r.time)),e.varyings.add("vUv","vec2"),e.vertex.code.add(S`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${t.type===R_.Rain?S`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:S`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),e.fragment.uniforms.add([new Ie("opacity",r=>r.opacity),new Jt("particleColor",(r,i)=>Kvt(i,t))]),e.fragment.code.add(S`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${t.type===R_.Rain?S`d = 0.35 * smoothstep(0.5, 0.0, d);`:S`d = smoothstep(0.5, 0.1, d);`}
      gl_FragColor = opacity * vec4(particleColor * d, d);
    }
  `),e}function Jvt(t,e){const r=e.camera.eye,i=.5*t.width,n=1/t.width,s=HEe(Jee,he(Jee,(r[0]+i)*n,(r[1]+i)*n,(r[2]+i)*n));return Lo(s,r,le(s,s,t.width))}function Kvt(t,e){const r=e.type===R_.Rain?e1t:Qvt,i=le(Jee,r,t1t),n=t.camera.eye;we(Bye,n);const s=Math.max(0,ve(Bye,t.lighting.mainLight.direction));return fs(i,i,r,s)}const Jee=P(),Bye=P(),Qvt=ke(1,1,1),e1t=ke(.85,.85,.85),t1t=.7,r1t=Object.freeze(Object.defineProperty({__proto__:null,build:Zvt},Symbol.toStringTag,{value:"Module"}));let i1t=class extends wi{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=1}},Kee=class MNe extends Wr{initializeProgram(e){return new Gr(e.rctx,MNe.shader.get().build(this.configuration),MU)}initializePipeline(){return Ht({blending:mo(Ce.ONE,Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA,Ce.ONE_MINUS_SRC_ALPHA),depthTest:{func:zi.LEQUAL},colorWrite:ir})}};Kee.shader=new jr(r1t,()=>Q(()=>import("./Precipitation.glsl-9f2f75d7.js"),[]));const MU=new Map([[O.POSITION,0],[O.INSTANCEFEATUREATTRIBUTE,1]]);let PNe=class{constructor(){this.enabled=!0,this._time=0}get time(){return this._time}advance({deltaTime:e,fixedTime:r}){return v(r)?this._time!==r&&(this._time=r,!0):(this._time=this._time+e,e!==0)}},n1t=class{constructor(e,r){this.deltaTime=e,this.fixedTime=r}},CT=class extends be{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._passParameters=new i1t,this._animation=new PNe,this._updatingTracking=new Hg,this._passParameters.time=0,this._passParameters.radius=ii(e.view.spatialReference).radius,this._techniqueRepository=e.context.techniqueRepository}destroy(){this._updatingTracking.destroy(),this._numParticles=0,this._snowTechniqueCached=en(this._snowTechniqueCached),this._rainTechniqueCached=en(this._rainTechniqueCached),this._vao=rt(this._vao),this._instanceIdBuffer=rt(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get _rainTechnique(){if(R(this._rainTechniqueCached)){const e=new Zee;e.type=R_.Rain,this._rainTechniqueCached=this._techniqueRepository.acquire(Kee,e)}return this._rainTechniqueCached}get _snowTechnique(){if(R(this._snowTechniqueCached)){const e=new Zee;e.type=R_.Snow,this._snowTechniqueCached=this._techniqueRepository.acquire(Kee,e)}return this._snowTechniqueCached}update(e){return this._animation.advance(e)}render(e,r,i){var l;const n=i==="rainy"?this._rainTechnique:this._snowTechnique;if(!n.compiled)return void this.context.requestRender();const s=e.rctx;if(this._ensureResources(s),R(n)||R(this._vao)||R(this._instanceIdBuffer)||(v(e.bindParameters.cloudsFade.data)&&(this._passParameters.opacity=1-e.bindParameters.cloudsFade.fadeInOutHeight.factor),this._passParameters.opacity<=0))return;const o=.35;r=r<.5?Bt(0,o,2*r):Bt(o,1,2*(r-.5)),this._passParameters.time=(i==="rainy"?this._rainSpeed:this._snowSpeed)*qie(this._animation.time)%1e5;const a=s.bindTechnique(n,this._passParameters,e.bindParameters);s.bindVAO(this._vao),a.assertCompatibleVertexAttributeLocations(this._vao),Aae(s,MU,this._instanceIdBuffer,jye,0),(l=s.capabilities.instancing)==null||l.drawArraysInstanced(Ft.TRIANGLES,0,3,this._numParticles*r),Rae(s,MU,this._instanceIdBuffer,jye)}_ensureResources(e){R(this._vao)&&(this._vao=this._createVertexArrayObject(e)),R(this._instanceIdBuffer)&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const r=[];for(let i=0;i<this._numParticles;i++)r.push(i);return Kr.createVertex(e,zr.STATIC_DRAW,new Float32Array(r))}_createVertexArrayObject(e){const r=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new wm(e,MU,{geometry:eh(s1t)},{geometry:Kr.createVertex(e,zr.STATIC_DRAW,r)})}};u([d({constructOnly:!0})],CT.prototype,"context",void 0),u([d({constructOnly:!0})],CT.prototype,"view",void 0),u([d({readOnly:!0})],CT.prototype,"updating",null),u([d()],CT.prototype,"_updatingTracking",void 0),CT=u([$("esri.views.3d.environment.Precipitation")],CT);const s1t=mn().vec3f(O.POSITION),jye=eh(mn().f32(O.INSTANCEFEATUREATTRIBUTE),1),o1t=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]),W4=128,Gye=-QQ,Hye=0,ZH=50,a1t=()=>1-511/512,l1t=bU([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);let c1t=class{constructor(e,r){this.view=e,this.type=ro.Simple,this._passParameters=new Uae,this._vaoCount=0,this._texV1=1,this._isMars=my(e.spatialReference);const i=ii(e.spatialReference);this._planetRadius=i.radius,this._outerRimWidth=i.outerAtmosphereRimWidth,this._innerRimFactor=(this._planetRadius+Gye)/this._planetRadius,this._middleRimFactor=(this._planetRadius+Hye)/this._planetRadius,this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius,this._texV0=Hye/this._outerRimWidth,this._texVScale=this._texV1-this._texV0,this._techniqueRepository=r.techniqueRepository;const n=r.renderContext.rctx;this._cameraChangeHandle=ne(()=>{var a;return(a=this.view.state)==null?void 0:a.camera},()=>r.requestRender(),Wi),this._vao=this._createRibbon(n),this._vaoCount=Da(this._vao,"geometry"),this._fadeVao=vl(n),this._fadeVaoCount=Da(this._fadeVao,"geometry");const s=this._isMars?o1t:oNe;this._passParameters.texture=new mt(n,{pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE,samplingMode:it.LINEAR,flipped:!0,width:1,height:512},s);const o=new kae;o.geometry=dy.Cone,this._coneTechnique=this._techniqueRepository.acquire(oV,o),o.geometry=dy.Underground,this._undergroundTechnique=this._techniqueRepository.acquire(oV,o)}destroy(){this._coneTechnique.release(),this._undergroundTechnique.release(),this._cameraChangeHandle.remove(),this._passParameters.texture=rt(this._passParameters.texture),this._fadeVao.dispose(),this._vao.dispose()}render(e){const r=e.bindParameters.camera;this._update(r);const i=e.rctx;this._passParameters.undergroundFadeAlpha<1&&(i.bindTechnique(this._coneTechnique,this._passParameters,e.bindParameters),i.bindVAO(this._vao),i.drawArrays(Ft.TRIANGLES,0,this._vaoCount)),this._passParameters.undergroundFadeAlpha>0&&(i.bindTechnique(this._undergroundTechnique,this._passParameters,e.bindParameters),i.bindVAO(this._fadeVao),i.drawArrays(Ft.TRIANGLE_STRIP,0,this._fadeVaoCount))}renderHaze(){}_update(e){const r=P(),i=this._planetRadius,n=Pe(e.eye),s=n-i;if(s<0){const m=Math.min(-s/5e3,1);this._passParameters.undergroundFadeAlpha=m}else this._passParameters.undergroundFadeAlpha=0;const o=Math.max(ZH,s),a=i+Gye;this._passParameters.innerScale=u1t(i+o,i,a)-1,this._passParameters.altitudeFade=Tae(s),le(r,e.eye,(i+ZH)/n),qye(r,e.center,e.up,i,this._passParameters.silhouette);const l=this._computeScreenRimWidth(e,r,e.up,this._passParameters.silhouette),c=a1t(),h=l1t(s);let p=this._texV0+c*this._texVScale,f=this._texV0+l*h*this._texVScale;if(s>ZH){qye(e.eye,e.center,e.up,i,this._passParameters.silhouette);const m=this._computeScreenRimWidth(e,e.eye,e.up,this._passParameters.silhouette),g=_e((m-1.5)/(l-1.5),0,1);p=this._texV0+g*c*this._texVScale,f=this._texV0+Bt(this._texV1,l*h,g)*this._texVScale}dt(this._passParameters.texV,p,f)}_createRibbon(e){const r=us(3+3*W4*3),i=new Uint32Array(3*W4*5);r[0]=0,r[1]=0,r[2]=-1;for(let o=0;o<W4;o++){const a=9*o+3;r[a+0]=o,r[a+1]=this._innerRimFactor,r[a+2]=-1,r[a+3]=o,r[a+4]=this._middleRimFactor,r[a+5]=0,r[a+6]=o,r[a+7]=this._outerRimFactor,r[a+8]=1;const l=3*o+1,c=o===W4-1?1:l+3,h=15*o;i[h+0]=l,i[h+1]=l+1,i[h+2]=c+1,i[h+3]=c+1,i[h+4]=c,i[h+5]=l,i[h+6]=l+1,i[h+7]=l+2,i[h+8]=c+2,i[h+9]=c+2,i[h+10]=c+1,i[h+11]=l+1,i[h+12]=l,i[h+13]=c,i[h+14]=0}const n=Wye.createBuffer(i.length),s=n.position;for(let o=0;o<i.length;++o){const a=3*i[o];s.set(o,0,r[a]),s.set(o,1,r[a+1]),s.set(o,2,r[a+2])}return new wm(e,Lr,{geometry:eh(Wye)},{geometry:Kr.createVertex(e,zr.STATIC_DRAW,n.buffer)})}_computeScreenRimWidth(e,r,i,n){return me(xE,n.center,n.v2),le(X4,xE,this._outerRimFactor),eB(JH,r,xE,i),Dye(xE,JH,e.projectionMatrix,e.viewport,xE),Dye(X4,JH,e.projectionMatrix,e.viewport,X4),Pi(xE,X4)/e.height}};function qye(t,e,r,i,n){const s=Pe(t),o=i*Math.sqrt(s*s-i*i)/s,a=Math.sqrt(i*i-o*o),l=n.v1,c=n.v2;return le(n.center,t,a/s),vt(l,t,e),nl(l)<1&&vt(l,t,r),le(l,l,o/Pe(l)),vt(c,l,t),le(c,c,o/Pe(c)),o}const JH=$e(),xE=P(),X4=P();function u1t(t,e,r){return t*t/(Math.sqrt(t*t-e*e)*Math.sqrt(t*t-r*r)+e*r)}const Wye=mn().vec3f(O.POSITION);let INe=class $Ne extends Wr{initializeProgram(e){return new Gr(e.rctx,$Ne.shader.get().build(this.configuration),Lr)}initializePipeline(){return Ht({blending:mo(Ce.ONE,Ce.ZERO,Ce.ONE_MINUS_SRC_COLOR,Ce.ONE),colorWrite:ir})}};INe.shader=new jr(QDe,()=>Q(()=>import("./FogHaze.glsl-5523dd1a.js"),[]));const h1t=.7,d1t=1;let LI=class extends be{constructor(e){super(e),this._passParameters=new Nae;const r=e.context.renderContext.rctx;this._vao=vl(r,$3);const i=ii(e.view.spatialReference);this._planetRadius=i.radius,this._atmosphereRadius=i.radius+mD;const n=new Fae;n.haze=!0,this._hazeTechnique=e.context.techniqueRepository.acquire(INe,n)}destroy(){this._hazeTechnique.release(),this._vao.dispose()}set strength(e){this._passParameters.hazeStrength=e}get strength(){return this._passParameters.hazeStrength}render(e,r){if(this.view.basemapTerrain.baseOpacity===0||(this._update(e,r),this._passParameters.hazeAmount<=0))return;const i=this._hazeTechnique;if(!i.compiled)return void this.context.requestRender();const n=e.offscreenRenderingHelper;n.renderDepthDetached(()=>{this._passParameters.depthTexture=n.depthTexture;const s=e.rctx.bindTechnique(i,this._passParameters,e.bindParameters);this._renderSimpleHaze(s,e)})}_renderSimpleHaze(e,r){const i=r.rctx;i.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(Ft.TRIANGLE_STRIP,0,4)}_update(e,r){const i=e.bindParameters.camera;we(Xye,i.eye);const n=Math.max(0,ve(Xye,e.bindParameters.lighting.mainLight.direction)),s=f1t;le(Yye,s,0),fs(this._passParameters.hazeColor,Yye,s,n);const o=Pe(i.eye),a=o*o;this._passParameters.atmosphereC=a-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.hazeAmount=(1-mO(h1t*Wd,d1t*Wd,Math.abs(o-this._planetRadius)))*r.amount,this._passParameters.fogStrength=r.strength}static isSupported(e){return e.capabilities.depthTexture}};u([d({constructOnly:!0})],LI.prototype,"context",void 0),u([d({constructOnly:!0})],LI.prototype,"view",void 0),LI=u([$("esri.views.3d.environment.SimpleHaze")],LI);let p1t=class{constructor(){this.strength=0,this.amount=0}};const f1t=ke(.24,.44,.8),Xye=P(),Yye=P();function Zae(t){const e=S`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,r=S`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;t.vertex.code.add(e),t.vertex.code.add(r),t.fragment.code.add(e),t.fragment.code.add(r)}function m1t(){const t=new Br;return t.attributes.add(O.POSITION,"vec3"),t.attributes.add(O.COLOR,"vec4"),t.attributes.add(O.SIZE,"float"),t.varyings.add("vcolor","vec4"),t.varyings.add("vsize","float"),t.vertex.uniforms.add([new rn("transform",(e,r)=>g1t(e,r)),new br("viewport",(e,r)=>r.camera.fullViewport),new Ie("pixelRatio",(e,r)=>r.camera.pixelRatio)]),t.include(Zae),t.vertex.code.add(S`void main(void) {
vec4 posProj = transform * vec4(position, 0);
gl_Position = alignToPixelCenter(posProj, viewport.zw);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),t.fragment.code.add(S`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
gl_FragColor = vec4(vcolor.xyz, intensity);
}`),t}function g1t(t,e){return po(vv,e.camera.projectionMatrix),vv[10]=24e-8-1,vv[11]=-1,vv[14]=(24e-8-2)*e.camera.near,Mn(vv,vv,e.camera.viewMatrix),Mn(vv,vv,t.modelMatrix)}const vv=$e(),y1t=Object.freeze(Object.defineProperty({__proto__:null,build:m1t},Symbol.toStringTag,{value:"Module"}));let _1t=class extends wi{constructor(){super(...arguments),this.modelMatrix=$e()}},LNe=class DNe extends Wr{constructor(e){super(e,new _l,()=>this.destroy())}initializeProgram(e){return new Gr(e.rctx,DNe.shader.get().build(),Lr)}initializePipeline(){return Ht({blending:mo(Ce.SRC_ALPHA,Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA,Ce.ONE_MINUS_SRC_ALPHA),depthTest:{func:zi.LEQUAL},colorWrite:ir})}};LNe.shader=new jr(y1t,()=>Q(()=>import("./Stars.glsl-27fa5c77.js"),[]));let S1=class extends be{get updating(){return this._updatingTracking.updating||this.loading}get loading(){return v(this._loadDataTask)&&!this._loadDataTask.finished}constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._renderParameter=new _1t,this._updatingTracking=new Hg}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=Tp(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=en(this._technique),this._vao=rt(this._vao)}render(e){const{rctx:r}=e;if(this._ensureResources(r),R(this._technique)||R(this._vao))return;if(!this._technique.compiled)return void this.requestRender();const i=r.bindTechnique(this._technique,this._renderParameter,e.bindParameters);r.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(Ft.POINTS,0,this._numPoints)}_ensureResources(e){if(v(this._technique)||R(TE))return;this._technique=new LNe({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=TE.byteLength/Zye;const r=new Float32Array(TE,0,2*this._numPoints),i=new Uint8Array(TE,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(e,r,i,this._numPoints),this._updatingTracking.add(()=>this.view.environment.lighting.type!=="virtual"?this.view.environment.lighting.date:null,n=>this._update(n),Vt)}_computeDayDuration(e){const r=e,i=new Date(e.getFullYear(),0,1,11,58,56);return(+r-+i)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+i)}_update(e){if(!e)return;const r=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,i=2*this._computeDayDuration(e),n=po(this._renderParameter.modelMatrix,w1t);TO(n,n,-i*Math.PI),Mn(n,b1t,n),TO(n,n,-r*Math.PI),this.requestRender()}_hexToRGB(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}_unpackUint8Attributes(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}_createVertexArrayObject(e,r,i,n){const s=Jye.createBuffer(n),o=s.position,a=s.color,l=s.size;for(let c=0;c<n;c++){const h=r[2*c+0],p=r[2*c+1];o.set(c,0,-Math.cos(h)*Math.sin(p)),o.set(c,1,-Math.sin(h)*Math.sin(p)),o.set(c,2,-Math.cos(p));const f=this._unpackUint8Attributes(i[c]),m=this._hexToRGB(v1t[f[1]]);a.set(c,0,255*m[0]),a.set(c,1,255*m[1]),a.set(c,2,255*m[2]),a.set(c,3,255),l.set(c,f[0])}return new wm(e,Lr,{geometry:eh(Jye)},{geometry:Kr.createVertex(e,zr.STATIC_DRAW,s.buffer)})}_createLoadDataTask(){if(v(TE))return null;const e=EN(async r=>{const{data:i}=await mYe("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:r});this._verifyStarData(i),TE=i});return e.promise.catch(r=>{ps(r)||re.getLogger(this.declaredClass).error(r)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}_verifyStarData(e){if(!e)throw new H("stars:no-data-received","Failed to create stars because star catalogue is missing");const r=e.byteLength/Zye;if(r%1!=0||r>5e4||r<5e3)throw new H("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};u([d({constructOnly:!0})],S1.prototype,"view",void 0),u([d({constructOnly:!0})],S1.prototype,"requestRender",void 0),u([d({readOnly:!0})],S1.prototype,"updating",null),u([d()],S1.prototype,"_loadDataTask",void 0),u([d()],S1.prototype,"_updatingTracking",void 0),S1=u([$("esri.views.3d.environment.Stars")],S1);const v1t=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],b1t=aae(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),w1t=aae(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),Zye=9,Jye=mn().vec3f(O.POSITION).vec4u8(O.COLOR).f32(O.SIZE);let TE=null;function x1t(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function cV(t,e,r){r*=.5;const i=Math.sin(r);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(r),t}function Jae(t,e){const r=2*Math.acos(e[3]),i=Math.sin(r/2);return i>yl()?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=1,t[1]=0,t[2]=0),r}function Kae(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=r[0],l=r[1],c=r[2],h=r[3];return t[0]=i*h+o*a+n*c-s*l,t[1]=n*h+o*l+s*a-i*c,t[2]=s*h+o*c+i*l-n*a,t[3]=o*h-i*a-n*l-s*c,t}function T1t(t,e,r){r*=.5;const i=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+o*a,t[1]=n*l+s*a,t[2]=s*l-n*a,t[3]=o*l-i*a,t}function S1t(t,e,r){r*=.5;const i=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l-s*a,t[1]=n*l+o*a,t[2]=s*l+i*a,t[3]=o*l-n*a,t}function E1t(t,e,r){r*=.5;const i=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+n*a,t[1]=n*l-i*a,t[2]=s*l+o*a,t[3]=o*l-s*a,t}function C1t(t,e){const r=e[0],i=e[1],n=e[2];return t[0]=r,t[1]=i,t[2]=n,t[3]=Math.sqrt(Math.abs(1-r*r-i*i-n*n)),t}function PU(t,e,r,i){const n=e[0],s=e[1],o=e[2],a=e[3];let l,c,h,p,f,m=r[0],g=r[1],_=r[2],b=r[3];return c=n*m+s*g+o*_+a*b,c<0&&(c=-c,m=-m,g=-g,_=-_,b=-b),1-c>yl()?(l=Math.acos(c),h=Math.sin(l),p=Math.sin((1-i)*l)/h,f=Math.sin(i*l)/h):(p=1-i,f=i),t[0]=p*n+f*m,t[1]=p*s+f*g,t[2]=p*o+f*_,t[3]=p*a+f*b,t}function A1t(t){const e=mN,r=e(),i=e(),n=e(),s=Math.sqrt(1-r),o=Math.sqrt(r);return t[0]=s*Math.sin(2*Math.PI*i),t[1]=s*Math.cos(2*Math.PI*i),t[2]=o*Math.sin(2*Math.PI*n),t[3]=o*Math.cos(2*Math.PI*n),t}function R1t(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=r*r+i*i+n*n+s*s,a=o?1/o:0;return t[0]=-r*a,t[1]=-i*a,t[2]=-n*a,t[3]=s*a,t}function v2(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function NNe(t,e){const r=e[0]+e[4]+e[8];let i;if(r>0)i=Math.sqrt(r+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{let n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);const s=(n+1)%3,o=(n+2)%3;i=Math.sqrt(e[3*n+n]-e[3*s+s]-e[3*o+o]+1),t[n]=.5*i,i=.5/i,t[3]=(e[3*s+o]-e[3*o+s])*i,t[s]=(e[3*s+n]+e[3*n+s])*i,t[o]=(e[3*o+n]+e[3*n+o])*i}return t}function O1t(t,e,r,i){const n=.5*Math.PI/180;e*=n,r*=n,i*=n;const s=Math.sin(e),o=Math.cos(e),a=Math.sin(r),l=Math.cos(r),c=Math.sin(i),h=Math.cos(i);return t[0]=s*l*h-o*a*c,t[1]=o*a*h+s*l*c,t[2]=o*l*c-s*a*h,t[3]=o*l*h+s*a*c,t}function M1t(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}const Qae=Vf,P1t=ai,I1t=wne,$1t=Kae,L1t=h3,D1t=eCe,N1t=F9,FNe=xne,F1t=FNe,kNe=Tne,k1t=kNe,ele=QEe,U1t=xR,z1t=Sne;function V1t(t,e,r){const i=ve(e,r);return i<-.999999?(vt(Mm,B1t,e),Tu(Mm)<1e-6&&vt(Mm,j1t,e),we(Mm,Mm),cV(t,Mm,Math.PI),t):i>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(vt(Mm,e,r),t[0]=Mm[0],t[1]=Mm[1],t[2]=Mm[2],t[3]=1+i,ele(t,t))}const Mm=P(),B1t=ke(1,0,0),j1t=ke(0,1,0);function G1t(t,e,r,i,n,s){return PU(Kye,e,n,s),PU(Qye,r,i,s),PU(t,Kye,Qye,2*s*(1-s)),t}const Kye=Dp(),Qye=Dp();function H1t(t,e,r,i){const n=q1t;return n[0]=r[0],n[3]=r[1],n[6]=r[2],n[1]=i[0],n[4]=i[1],n[7]=i[2],n[2]=-e[0],n[5]=-e[1],n[8]=-e[2],ele(t,NNe(t,n))}const q1t=vi();Object.freeze(Object.defineProperty({__proto__:null,add:I1t,calculateW:C1t,conjugate:v2,copy:Qae,dot:D1t,equals:z1t,exactEquals:U1t,fromEuler:O1t,fromMat3:NNe,getAxisAngle:Jae,identity:x1t,invert:R1t,len:F1t,length:FNe,lerp:N1t,mul:$1t,multiply:Kae,normalize:ele,random:A1t,rotateX:T1t,rotateY:S1t,rotateZ:E1t,rotationTo:V1t,scale:L1t,set:P1t,setAxes:H1t,setAxisAngle:cV,slerp:PU,sqlerp:G1t,sqrLen:k1t,squaredLength:kNe,str:M1t},Symbol.toStringTag,{value:"Module"}));function HN(t=X1t){return[t[0],t[1],t[2],t[3]]}function oWt(t,e,r=HN()){return ce(r,t),r[3]=e,r}function e0e(t,e,r=HN()){return vt(r,t,e),we(r,r),r[3]=-XEe(t,e),r}function aWt(t,e,r=HN()){return cV(Y4,t,t0e(t)),cV(r0e,e,t0e(e)),Kae(Y4,r0e,Y4),W1t(r,dl(Jae(r,Y4)))}function lWt(t){return t}function t0e(t){return Xt(t[3])}function W1t(t,e){return t[3]=e,t}const X1t=[0,0,1,0],Y4=Dp(),r0e=Dp();HN();function Y1t(t,e,r){const i=t.parallax.anchorPointClouds;t.fadeIn.stage===Au.FINISHED&&(t.fadeIn.factor=0,ce(i,Pg),t.fadeIn.stage=Au.CHANGE_ANCHOR,t.crossFade.enabled=!1,t.fadeInOut.stage=io.FINISHED),t.fadeIn.stage===Au.CHANGE_ANCHOR&&t.isCameraPositionFinal&&(Lae(t.data)&&t.renderingStage!==Hn.RENDERING||t.renderingStage===Hn.FADING_TEXTURE_CHANNELS)&&(ce(i,Pg),t.fadeIn.stage=Au.FADE_IN,t.startTime=e,t.renderingStage===Hn.FADING_TEXTURE_CHANNELS&&(t.renderingStage=Hn.SWITCH_CHANNELS)),t.fadeIn.factor<1&&t.fadeIn.stage===Au.FADE_IN?t.fadeIn.factor=r?_e((e-t.startTime)/(UNe*r),0,1):1:t.fadeIn.factor>=1&&t.fadeIn.stage===Au.FADE_IN&&(t.fadeIn.stage=Au.FINISHED,t.fadeIn.factor=1)}function Z1t(t,e,r){const{fadeInOut:i,crossFade:n}=t;i.stage===io.FINISHED&&(t.startTime=e,i.factor=1,i.stage=io.FADE_OUT),i.factor>0&&i.stage===io.FADE_OUT?i.factor=r?1-_e((e-t.startTime)/(tbt*r),0,1):0:(i.factor<=0&&i.stage===io.FADE_OUT&&(i.factor=0,ce(t.parallax.anchorPointClouds,Pg)),i.factor<=0&&i.stage===io.FADE_OUT&&t.isCameraPositionFinal&&(i.factor=0,i.stage=io.SWITCH,t.crossFade.enabled=!1,n.factor=1),i.stage===io.SWITCH&&(Lae(t.data)&&t.renderingStage!==Hn.RENDERING||t.renderingStage===Hn.FADING_TEXTURE_CHANNELS)&&(t.startTime=e,i.factor=0,i.stage=io.FADE_IN,ce(t.parallax.anchorPointClouds,Pg),t.crossFade.enabled=!1,n.factor=1,t.renderingStage===Hn.FADING_TEXTURE_CHANNELS&&(t.renderingStage=Hn.SWITCH_CHANNELS)),i.factor<1&&i.stage===io.FADE_IN?i.factor=r?_e((e-t.startTime)/(UNe*r),0,1):1:i.factor>=1&&i.stage===io.FADE_IN&&(i.stage=io.FINISHED,i.factor=1))}function J1t(t,e,r,i){const{crossFade:n}=t,s=t.parallax.anchorPointClouds;t.crossFade.enabled&&!i||(ce(t.parallaxNew.anchorPointClouds,Pg),t.startTime=e,n.factor=0,t.crossFade.enabled=!0),n.factor<1&&t.crossFade.enabled?n.factor=r?_e((e-t.startTime)/(rbt*r),0,1):1:n.factor>=1&&t.crossFade.enabled&&(t.crossFade.enabled=!1,n.factor=1,ce(s,t.parallaxNew.anchorPointClouds),t.renderingStage===Hn.FADING_TEXTURE_CHANNELS&&(t.renderingStage=Hn.SWITCH_CHANNELS))}function i0e(t,e,r,i){const n=t.fadeInOutHeight,s=n.stage===hw.FINISHED?r:t.startTimeHeightFade;if(i!==0){const o=(r-s)/(ibt*i);n.factor+=e?-o:o}else n.factor=e?0:1;t.startTimeHeightFade=r,n.factor=_e(n.factor,0,1),n.stage=hw.HEIGHT_FADE}function K1t(t,e,r,i,n){t.renderingStage===Hn.FINISHED_RENDERING&&(t.renderingStage=Hn.FADING_TEXTURE_CHANNELS);const s=Pe(e.eye);t.fadeInOutHeight.factor<0&&(t.fadeInOutHeight.factor=s-Cr.radius>Wd?1:0),t.isCameraPositionFinal=Xb(t.cameraPositionLastFrame,e.eye),we(Pg,e.eye),le(Pg,Pg,Cr.radius);const o=t.parallax;o.anchorPointClouds[0]===0&&o.anchorPointClouds[1]===0&&o.anchorPointClouds[2]===0&&ce(o.anchorPointClouds,Pg);const a=Pe(ge(ebt,o.anchorPointClouds,Pg));let l=!0;a>t.fadeIn.distanceThresholdFactor*o.cloudsHeight||t.fadeIn.stage!==Au.FINISHED?Y1t(t,i,n):a>t.fadeInOut.distanceThresholdFactor*o.cloudsHeight||t.fadeInOut.stage!==io.FINISHED?Z1t(t,i,n):a>t.crossFade.distanceThresholdFactor*o.cloudsHeight||t.crossFade.enabled||t.renderingStage===Hn.FADING_TEXTURE_CHANNELS?J1t(t,i,n,(r!==Mr.IDLE||!Lae(t.data))&&t.renderingStage!==Hn.FADING_TEXTURE_CHANNELS):l=!1;const c=s-Cr.radius;if((c>1.7*Wd||c<-Wd)&&t.fadeInOutHeight.factor<1?t.fadeInOutHeight.factor=1:(c>Wd||c<-.35*Wd)&&t.fadeInOutHeight.factor<1?i0e(t,!1,i,n):c<Wd&&c>-.35*Wd&&t.fadeInOutHeight.factor>0?i0e(t,!0,i,n):t.fadeInOutHeight.stage=hw.FINISHED,t.renderingStage===Hn.SWITCH_CHANNELS&&(t.readChannels=1-t.readChannels,t.renderingStage=Hn.FINISHED),o.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(s*s-Cr.radius*Cr.radius,0))/s,e0e(n0e,o.anchorPointClouds,SE),Du(o.transform,id,SE[3],SE),l){const{parallaxNew:h}=t;e0e(n0e,h.anchorPointClouds,SE),Du(h.transform,id,SE[3],SE)}ce(t.cameraPositionLastFrame,e.eye)}function Q1t(t){return t.crossFade.enabled||t.fadeInOut.stage!==io.FINISHED||t.fadeIn.stage!==Au.FINISHED||t.fadeInOutHeight.stage!==hw.FINISHED||t.renderingStage!==Hn.FINISHED}const n0e=ke(0,0,1),SE=HN(),Pg=P(),ebt=P(),UNe=1,tbt=.5,rbt=1.3,ibt=1;let D3=class{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(e,r){var i;return(i=this._outer.get(e))==null?void 0:i.get(r)}set(e,r,i){const n=this._outer.get(e);n?n.set(r,i):this._outer.set(e,new Map([[r,i]]))}delete(e,r){const i=this._outer.get(e);i&&(i.delete(r),i.size===0&&this._outer.delete(e))}forEach(e){this._outer.forEach((r,i)=>e(r,i))}};var ss;function s0e(t=ue("enable-feature:high-quality-idle")){const e=new D3;return t&&(e.set(Mr.INTERACTING,ss.Antialiasing,!0),e.set(Mr.IDLE,ss.Antialiasing,!0),e.set(Mr.INTERACTING,ss.HighQualityTransparency,!0),e.set(Mr.IDLE,ss.HighQualityTransparency,!0),e.set(Mr.INTERACTING,ss.RealisticAtmosphere,!0),e.set(Mr.IDLE,ss.RealisticAtmosphere,!0),e.set(Mr.IDLE,ss.SSAO,!0),e.set(Mr.IDLE,ss.WaterReflection,!0),e.set(Mr.IDLE,ss.PhysicalPixelRendering,!0)),e.set(Mr.ANIMATING,ss.ShadowMapUpdate,!0),e.set(Mr.INTERACTING,ss.ShadowMapUpdate,!0),e.set(Mr.IDLE,ss.ShadowMapUpdate,!0),e.set(Mr.IDLE,ss.HighQualityVoxel,!0),e}(function(t){t[t.Antialiasing=0]="Antialiasing",t[t.HighQualityTransparency=1]="HighQualityTransparency",t[t.HighQualityVoxel=2]="HighQualityVoxel",t[t.RealisticAtmosphere=3]="RealisticAtmosphere",t[t.SSAO=4]="SSAO",t[t.WaterReflection=5]="WaterReflection",t[t.ShadowMapUpdate=6]="ShadowMapUpdate",t[t.PhysicalPixelRendering=7]="PhysicalPixelRendering"})(ss||(ss={}));var VR;(function(t){t[t.Immediate=0]="Immediate",t[t.Faded=1]="Faded"})(VR||(VR={}));var DI;const nbt=[Ee.POSTPROCESSING_ENVIRONMENT_OPAQUE,Ee.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];let To=DI=class extends be{constructor(t){super(t),this._context=null,this._atmosphere=null,this._hqAtmosphere=null,this._oldWeatherParameters=new KH,this._newWeatherParameters=new KH,this._fadedWeatherParameters=new KH,this._weatherParameters=this._newWeatherParameters}initialize(){this.view._stage.addRenderPlugin(nbt,this)}destroy(){var t;this.removeHandles(),((t=this.view)==null?void 0:t._stage)!=null&&this.view._stage.removeRenderPlugin(this),this._set("view",null)}get atmosphere(){return v(this._hqAtmosphere)&&this.view._stage.renderer.isFeatureEnabled(ss.RealisticAtmosphere)?this._hqAtmosphere:this._atmosphere}get _atmosphereType(){return v(this.atmosphere)?this.atmosphere.type:ro.None}get canRender(){var t;return!!((t=this.view.basemapTerrain)!=null&&t.renderer.canRender)||this.view.viewingMode!=="global"}get needsLinearDepth(){return this._atmosphereType===ro.Realistic}updateAnimation(t){return!!v(this._precipitation)&&this._precipitation.update(t)}get updating(){return v(this._stars)&&this._stars.updating||v(this._clouds)&&this._clouds.running}get weatherVisible(){return Pe(this.view.state.camera.eye)-ii(this.view.spatialReference).radius<=Wd}get _stars(){var i;const t=this.view,e=((i=t.environment)==null?void 0:i.starsEnabled)??!1,r=this._get("_stars");return!e||R(this._context)?(ze(r),null):v(r)?r:new S1({view:t,requestRender:()=>this._setNeedsRender()})}get _precipitation(){const t=this._get("_precipitation");if(!this._precipitationEnabled||R(this._context))return ze(t),null;const e=this.view,r=this._context;return v(t)&&t.context===r?t:(ze(t),new CT({context:r,view:e}))}get _clouds(){const t=this._get("_clouds");if(!this.weatherEnabled||R(this._context))return ze(t),null;if(v(t))return t;const e=this.view,r=this._context;return ze(t),new xc({context:r,view:e,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const t=this._get("_cloudsComposition");if(!this.weatherEnabled||R(this._context))return ze(t),null;const e=this.view.state.viewingMode,r=this._context.renderContext.rctx,i=ii(this.view.spatialReference).radius;return v(t)&&t.viewingMode===e&&t.planetRadius===i?t:(ze(t),new ST({rctx:r,viewingMode:e,planetRadius:i,requestRender:()=>this._setNeedsRender()}))}get _fog(){const t=this._get("_fog");if(!this.weatherEnabled||R(this._context))return ze(t),null;if(v(t))return t;const e=this.view,r=this._context;return new $I({context:r,view:e})}get _simpleHaze(){const t=this._get("_simpleHaze");if(!this.weatherEnabled||R(this._context))return ze(t),null;if(v(t))return t;const e=this.view,r=this._context;return new LI({context:r,view:e})}get weatherEnabled(){var t,e;return!!((e=(t=this.view)==null?void 0:t.environmentManager)!=null&&e.weatherEnabled)}get _precipitationEnabled(){return this.weatherEnabled&&(this.view.environment.weather.type==="rainy"||this.view.environment.weather.type==="snowy")}initializeRenderContext(t=null){this._context=t;const e=()=>this._setNeedsRender();this.addHandles([fo(()=>{var r;return(r=this.view)==null?void 0:r.basemapTerrain},()=>this._updateBasemapTerrain(),Wi),ne(()=>({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled,quality:this.view.environment.atmosphere.quality}),r=>this._updateAtmosphere(r),Wi),ne(()=>this._stars,e),ne(()=>this._precipitation,e),ne(()=>this._clouds,()=>this._updateWeather(),Vt),ne(()=>this._fog,()=>this._updateFogHaze(),Vt),ne(()=>this._simpleHaze,()=>this._updateFogHaze(),Vt),ne(()=>this.view.state.mode,()=>{this._setNeedsRender()},Zr),ne(()=>this._atmosphereType,()=>this._updateBasemapTerrain(),Wi),ne(()=>this._weatherUpdateParameters,()=>{this._updateWeather(),this._updateFogHaze()},Wi)])}uninitializeRenderContext(){this._context=null,this._atmosphere=ze(this._atmosphere),this._hqAtmosphere=ze(this._hqAtmosphere),this._set("_stars",ze(this._stars)),this._set("_precipitation",ze(this._precipitation)),this._set("_clouds",ze(this._clouds)),this._set("_cloudsComposition",ze(this._cloudsComposition)),this._set("_fog",ze(this._fog)),this._set("_simpleHaze",ze(this._simpleHaze))}prepareRender(t){t.bindParameters.cloudsFade.data=f_t(this._clouds)?this._clouds:null,this.view.viewingMode!=="local"&&(K1t(t.bindParameters.cloudsFade,t.bindParameters.camera,this.view.state.mode,t.time,this.view.qualitySettings.fadeDuration),this._updateWeatherFading(t.bindParameters),t.bindParameters.cloudsFade.renderingStage===Hn.FINISHED&&v(this._clouds)&&this._clouds.coverage===0&&this._clouds.running===!1&&(this._clouds.destroyFrameBufferCube(),t.bindParameters.cloudsFade.data=null))}render(t){if(t.output===V.Color)switch(t.bindParameters.slot){case Ee.POSTPROCESSING_ENVIRONMENT_OPAQUE:v(this._stars)&&this._stars.render(t),v(this.atmosphere)&&(this.atmosphere.render(t),v(this._cloudsComposition)&&v(t.bindParameters.cloudsFade.data)&&(this.weatherVisible&&v(this._clouds)&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(t)),Q1t(t.bindParameters.cloudsFade)&&v(this._context)&&this._context.requestRender());break;case Ee.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:if(v(this.atmosphere)&&(this.atmosphere.renderHaze(t,this._weatherParameters.haze.amount),this._weatherParameters.haze.amount>0&&this._atmosphereType!==ro.Realistic&&v(this._simpleHaze)&&this._simpleHaze.render(t,this._weatherParameters.haze),this._weatherParameters.fog.amount>0&&v(this._fog)&&this._fog.render(t,this._weatherParameters.fog),v(this._precipitation))){const e=this.view.environment.weather;e.type!=="rainy"&&e.type!=="snowy"||this._precipitation.render(t,e.precipitation,e.type)}}}updateLightSources(t,e,r,i){if(v(this._context)){const n=this._context.renderContext;n.bindParameters.oldLighting.copyFrom(n.bindParameters.lighting),n.bindParameters.newLighting.noonFactor=e,n.bindParameters.newLighting.globalFactor=r,n.bindParameters.newLighting.set(t),i===VR.Faded||n.bindParameters.weatherFading?n.bindParameters.fadeLighting(0):n.bindParameters.fadeLighting(1),this._context.requestRender()}}get _weatherUpdateParameters(){const t=this.weatherEnabled?this.view.environment.weather:null;return R(t)?null:t.type==="rainy"||t.type==="snowy"?{type:t.type,weatherAdjustment:t.cloudCover,effect:t.precipitation}:{type:t.type,weatherAdjustment:t.type==="foggy"?t.fogStrength:t.cloudCover}}_updateWeatherFading(t){if(!t.weatherFading)return;const e=t.cloudsFade;return e.fadeIn.stage===Au.FADE_IN?(t.fadeLighting(e.fadeIn.factor),void this._fadeWeather(e.fadeIn.factor)):e.fadeInOut.stage===io.FADE_IN?(t.fadeLighting(e.fadeInOut.factor),void this._fadeWeather(e.fadeInOut.factor)):e.crossFade.enabled?(t.fadeLighting(e.crossFade.factor),void this._fadeWeather(e.crossFade.factor)):(t.fadeLighting(0),void this._fadeWeather(0))}_fadeWeather(t){const{_newWeatherParameters:e,_oldWeatherParameters:r}=this;t>=1?this._weatherParameters=e:(this._fadedWeatherParameters.lerp(r,e,t),this._weatherParameters=this._fadedWeatherParameters)}_updateWeather(){const t=this._weatherUpdateParameters;R(t)||R(this._clouds)||(this._clouds.applyPreset(Ka[t.type],t.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){v(this._context)&&this._context.requestRender()}_updateFogHaze(){const t=this._weatherUpdateParameters;if(R(this._fog)||R(this._simpleHaze)||R(t)||R(this._context))return;const e=this._context.renderContext.bindParameters;switch(this._oldWeatherParameters.copyFrom(this._weatherParameters),t.type){case"foggy":this._newWeatherParameters.fog.strength=Bt(3e-5,.005,t.weatherAdjustment**3),ce(this._newWeatherParameters.fog.color,o0e),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.haze.strength=0,this._newWeatherParameters.haze.amount=this._atmosphereType===ro.Realistic?1:0,this._setNeedsRender();break;case"rainy":this._newWeatherParameters.fog.strength=Bt(4e-6,2e-4,(t.effect??0)**3),ce(this._newWeatherParameters.fog.color,sbt),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.haze.strength=0,this._newWeatherParameters.haze.amount=0,this._setNeedsRender();break;case"snowy":this._newWeatherParameters.fog.strength=Bt(4e-6,2e-4,(t.effect??0)**3),ce(this._newWeatherParameters.fog.color,o0e),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.haze.strength=0,this._newWeatherParameters.haze.amount=this._atmosphereType===ro.Realistic?1:0,this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,this._newWeatherParameters.haze.strength=4e-6,this._newWeatherParameters.haze.amount=1,this._setNeedsRender()}e.weatherFading?this._fadeWeather(0):this._fadeWeather(1)}_updateAtmosphere(t){const e=this._selectAtmosphereType(t);if(v(this._atmosphere)?this._atmosphere.type===e:e===ro.None)return;this._atmosphere=ze(this._atmosphere),this._hqAtmosphere=ze(this._hqAtmosphere);const r=this._getAtmosphereClass(e);r&&v(this._context)&&(this._atmosphere=new r(this.view,this._context),e===ro.Simple&&(this._hqAtmosphere=new kH(this.view,this._context))),this._setNeedsRender(),this._updateBasemapTerrain()}_getAtmosphereClass(t){switch(t){case ro.Realistic:return kH;case ro.Panoramic:return Xvt;case ro.Simple:return c1t;default:case ro.None:return null}}_selectAtmosphereType(t){const{enabled:e,quality:r,viewingMode:i}=t;return!e||gy(this.view.spatialReference)?ro.None:i===qe.Local?ro.Panoramic:v(this._context)&&r==="high"&&kH.isSupported(this._context)&&NL(this.view.spatialReference)?ro.Realistic:ro.Simple}_updateBasemapTerrain(){this.view.basemapTerrain&&(this.view.basemapTerrain.velvetOverground=this._atmosphereType===ro.Simple)}get test(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled,quality:this.view.environment.atmosphere.quality}),stubGetAtmosphereClass:t=>{a0e=DI.prototype._getAtmosphereClass,DI.prototype._getAtmosphereClass=t},restoreGetAtmosphereClass:()=>{DI.prototype._getAtmosphereClass=a0e}}}};u([d({constructOnly:!0})],To.prototype,"view",void 0),u([d({readOnly:!0})],To.prototype,"atmosphere",null),u([d({readOnly:!0})],To.prototype,"_atmosphereType",null),u([d({type:Boolean,readOnly:!0})],To.prototype,"updating",null),u([d({readOnly:!0})],To.prototype,"weatherVisible",null),u([d()],To.prototype,"_context",void 0),u([d()],To.prototype,"_atmosphere",void 0),u([d()],To.prototype,"_hqAtmosphere",void 0),u([d({readOnly:!0})],To.prototype,"_stars",null),u([d({readOnly:!0})],To.prototype,"_precipitation",null),u([d({readOnly:!0})],To.prototype,"_clouds",null),u([d({readOnly:!0})],To.prototype,"_cloudsComposition",null),u([d({readOnly:!0})],To.prototype,"_fog",null),u([d({readOnly:!0})],To.prototype,"_simpleHaze",null),u([d({readOnly:!0})],To.prototype,"weatherEnabled",null),u([d({readOnly:!0})],To.prototype,"_precipitationEnabled",null),u([d({readOnly:!0})],To.prototype,"_weatherUpdateParameters",null),To=DI=u([$("esri.views.3d.environment.EnvironmentRenderer")],To);let KH=class{constructor(){this.fog=new lvt,this.haze=new p1t}copyFrom(e){this.fog.amount=e.fog.amount,this.haze.amount=e.haze.amount,this.fog.strength=e.fog.strength,this.haze.strength=e.haze.strength,ce(this.fog.color,e.fog.color)}lerp(e,r,i){this.fog.amount=Bt(e.fog.amount,r.fog.amount,i),this.haze.amount=Bt(e.haze.amount,r.haze.amount,i),this.fog.strength=Bt(e.fog.strength,r.fog.strength,i),this.haze.strength=Bt(e.haze.strength,r.haze.strength,i),fs(this.fog.color,e.fog.color,r.fog.color,i)}};const sbt=ke(.5,.5,.5),o0e=ke(1.5,1.5,1.5);let a0e;function l0e(t,e,r){if(R(e.longitude)||R(e.latitude)||R(r.longitude)||R(r.latitude))throw new Error("Invalid points: no lon/lat");return obt(t,e.longitude,e.latitude,r.longitude,r.latitude)}function obt(t,e,r,i,n){const s=Xt(r),o=Xt(n),a=s-o,l=Xt(e)-Xt(i),c=Math.sin(a/2),h=Math.sin(l/2),p=2*Ep(Math.sqrt(c*c+Math.cos(s)*Math.cos(o)*h*h))*t;return Math.round(1e4*p)/1e4}function abt(t,e,r){const i=e.spatialReference,n=ii(i),s=new Ue(e.x,t.y,i),o=new Ue(r.x,t.y,i),a=new Ue(t.x,e.y,i),l=new Ue(t.x,r.y,i);return{lon:l0e(n.radius,s,o),lat:l0e(n.radius,a,l)}}function lbt(t,e,r){const i=e/r,n=Xt(t),s=Math.sin(i/2),o=Math.cos(n),a=2*Ep(Math.sqrt(s*s/(o*o)));return dl(a)}function cbt(t,e){let r=t/15;return e||(r=Math.round(r)),r}function c0e(t,e){const r=t==null?void 0:t[0];if(r==null)return null;e||(e={hours:0,minutes:0,seconds:0}),e.hours=cbt(r,!0);const i=e.hours%1;e.hours-=i,e.minutes=60*i;const n=e.minutes%1;return e.minutes-=n,e.seconds=Math.round(60*n),e}var u0e,h0e,d0e,Qee={},ubt={get exports(){return Qee},set exports(t){Qee=t}};u0e=ubt,h0e=function(){var t=Math.PI,e=Math.sin,r=Math.cos,i=Math.tan,n=Math.asin,s=Math.atan2,o=Math.acos,a=t/180,l=864e5,c=2440588,h=2451545,p={dec:0,ra:0};function f(N){return N.valueOf()/l-.5+c}function m(N){return new Date((N+.5-c)*l)}function g(N){return f(N)-h}var _=23.4397*a;function b(N,L){return s(e(N)*r(_)-i(L)*e(_),r(N))}function w(N,L){return n(e(L)*r(_)+r(L)*e(_)*e(N))}function x(N,L,F){return s(e(N),r(N)*e(L)-i(F)*r(L))}function T(N,L,F){return n(e(L)*e(F)+r(L)*r(F)*r(N))}function E(N,L){return a*(280.16+360.9856235*N)-L}function C(N){return a*(357.5291+.98560028*N)}function A(N){return a*(1.9148*e(N)+.02*e(2*N)+3e-4*e(3*N))}function I(N,L){return N+L+102.9372*a+t}function M(N,L){var F=C(N),G=I(F,A(F));return L||(L={dec:0,ra:0}),L.dec=w(G,0),L.ra=b(G,0),L}var D={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(N,L,F,G){var q=a*-F,Z=a*L,X=g(N),oe=M(X,p),pe=E(X,q)-oe.ra;return G||(G={azimuth:0,altitude:0}),G.azimuth=x(pe,Z,oe.dec),G.altitude=T(pe,Z,oe.dec),G}},U=[[-.83,"sunrise","sunset"]];D.addTime=function(N,L,F){U.push([N,L,F])};var z=9e-4;function B(N,L){return Math.round(N-z-L/(2*t))}function ee(N,L,F){return z+(N+L)/(2*t)+F}function te(N,L,F){return h+N+.0053*e(L)-.0069*e(2*F)}function K(N,L,F){return o((e(N)-e(L)*e(F))/(r(L)*r(F)))}function W(N){var L=a*(134.963+13.064993*N),F=a*(93.272+13.22935*N),G=a*(218.316+13.176396*N)+6.289*a*e(L),q=5.128*a*e(F),Z=385001-20905*r(L);return{ra:b(G,q),dec:w(G,q),dist:Z}}return D.getTimes=function(N,L,F){var G=a*-F,q=a*L,Z=B(g(N),G),X=ee(0,G,Z),oe=C(X),pe=A(oe),ye=I(oe,pe),Se=w(ye,0),He=te(X,oe,ye);function Le(nr){return te(ee(K(nr,q,Se),G,Z),oe,ye)}function Te(nr){var er=(e(nr)-e(q)*e(Se))/(r(q)*r(Se));return er<-1?D.PolarException.MIDNIGHT_SUN:er>1?D.PolarException.POLAR_NIGHT:D.PolarException.NORMAL}var Fe,Ve,bt,tt,jt,Qt={solarNoon:m(He),nadir:m(He-.5),polarException:D.PolarException.NORMAL};for(Fe=0,Ve=U.length;Fe<Ve;Fe+=1)jt=He-((tt=Le((bt=U[Fe])[0]*a))-He),Qt[bt[1]]=m(jt),Qt[bt[2]]=m(tt);return Qt.polarException=Te(U[0][0]*a),Qt},D.getMoonPosition=function(N,L,F){var G=a*-F,q=a*L,Z=g(N),X=W(Z),oe=E(Z,G)-X.ra,pe=T(oe,q,X.dec);return pe+=.017*a/i(pe+10.26*a/(pe+5.1*a)),{azimuth:x(oe,q,X.dec),altitude:pe,distance:X.dist}},D.getMoonFraction=function(N){var L=g(N),F=M(L),G=W(L),q=149598e3,Z=o(e(F.dec)*e(G.dec)+r(F.dec)*r(G.dec)*r(F.ra-G.ra)),X=s(q*e(Z),G.dist-q*r(Z));return(1+r(X))/2},D},(d0e=h0e())!==void 0&&(u0e.exports=d0e);const b2=Qee,Eg={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};function hbt(t,e,r,i,n,s){he(s.ambient.color,1,1,1),s.ambient.intensity=Eg.global.ambient,he(s.direct.color,1,1,1),s.direct.intensity=Eg.global.direct;const o=e[2],a=_e((Math.abs(o)-Eg.local.altitude)/(Eg.global.altitude-Eg.local.altitude),0,1);let l;if(s.globalFactor=a,v(t)&&(l=b2.getTimes(t,e[1],e[0])),a<1){let c;if(v(t))c=_bt(t,l,i);else{const h=BNe(i);c={direct:{intensity:Eg.local.directAtNoon*h.direct,color:ke(1,1,1)},ambient:{intensity:Eg.local.ambientAtNoon*h.ambient,color:ke(1,1,1)},timeOfDay:"early afternoon"}}fs(s.ambient.color,c.ambient.color,s.ambient.color,a),s.ambient.intensity=Bt(c.ambient.intensity,s.ambient.intensity,a),fs(s.direct.color,c.direct.color,s.direct.color,a),s.direct.intensity=Bt(c.direct.intensity,s.direct.intensity,a),s.specularStrength=i==="rainy"||i==="snowy"||i==="foggy"?0:1,s.environmentStrength=i==="rainy"?.7:i==="snowy"||i==="foggy"?.75:1}s.noonFactor=v(t)?ybt(t,l):1,v(t)?dbt(t,e,r,s.direct.directionToLightSource):zNe(n,r,s.direct.directionToLightSource)}function zNe(t,e,r){e===qe.Global?we(QH,t.eye):he(QH,0,0,1),le(eq,t.viewForward,-1);const i=vU(eq,QH),n=Math.max(i-2*tq,0),s=.85*n/(n+1),o=Math.max(tq,i-tq-s);rd(f0e,-o,t.viewRight),Ke(r,eq,f0e),me(r,r,le(vbt,t.viewRight,bbt)),we(r,r)}function dbt(t,e,r,i){const n=gbt,s=Rp(mbt);if(r===qe.Global)b2.getPosition(t,0,0,n),he(i,0,0,-1),xO(s,s,-n.azimuth),K9(s,s,-n.altitude),Ke(i,i,s);else{const o=Eg.planarDirection,a=o.globalAngles,l=e[2];let c=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);c=_e(c,0,1),c<1?(b2.getPosition(t,e[1],e[0],n),n.azimuth=(1-c)*n.azimuth+c*a.azimuth,n.altitude=(1-c)*n.altitude+c*a.altitude):(n.azimuth=a.azimuth,n.altitude=a.altitude),he(i,0,-1,0),TO(s,s,-n.azimuth),xO(s,s,-n.altitude),Ke(i,i,s)}}function pbt(t,e){if(e===qe.Global)return!0;const r=Eg.planarDirection;return Math.abs(t)<r.localAltitude}const fbt=ke(.5773502691896258,-.5773502691896258,.5773502691896258);let VNe=class{constructor(){this.ambient={color:ke(1,1,1),intensity:.55},this.direct={color:ke(1,1,1),intensity:.55,directionToLightSource:On(fbt)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}};const mbt=$e(),gbt={azimuth:0,altitude:0};function ybt(t,e){const r=t.valueOf();let i,n;e.polarException===b2.PolarException.MIDNIGHT_SUN?(i=r-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,n=i+432e6):e.polarException===b2.PolarException.POLAR_NIGHT?(i=r-2,n=r-1):(i=e.sunrise.valueOf(),n=e.sunset.valueOf());const s=i+(n-i)/2;return 1-_e(Math.abs(r-s)/432e5,0,1)}function BNe(t){switch(t){case"disabled":case"sunny":case"cloudy":return{direct:1,ambient:1};case"rainy":return{direct:.4,ambient:1.2};case"snowy":return{direct:.5,ambient:1.3};case"foggy":return{direct:.2,ambient:1.6}}}function p0e(t,e){const r=(t[0]+t[1]+t[2])/3;for(let i=0;i<3;i++)t[i]=t[i]+(r-t[i])*e;return t}function _bt(t,e,r){const i=t.valueOf();let n,s;e.polarException===b2.PolarException.MIDNIGHT_SUN?(n=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,s=n+432e6):e.polarException===b2.PolarException.POLAR_NIGHT?(n=i-2,s=i-1):(n=e.sunrise.valueOf(),s=e.sunset.valueOf());const o=s-n,a=n+o/2,l=o/4,c=a-l,h=a+l,p=.06*o,f=n-p/2,m=n+p/2,g=s-p/2,_=s+p/2,b=Eg.local,w=[.01,b.ambientAtNight],x=[.8,.8,1],T=[.01,.01,.01],E=[b.directAtTwilight,b.ambientAtTwilight],C=[1,.6,.5],A=[.8,.8,1],I=[.9*b.directAtNoon,b.ambientAtNoon],M=[1,.98,.98],D=[.98,.98,1],U=[b.directAtNoon,b.ambientAtNoon],z=[1,1,1],B=[1,1,1],ee=I,te=M,K=D,W=E,N=C,L=A;let F,G,q=[0,0],Z=[0,0,0],X=[0,0,0];i<f||i>_?(q=w,Z=T,X=x,G="night"):i<m?(F=m-f,q=Sa(i-f,F,w,E),Z=Sa(i-f,F,T,C),X=Sa(i-f,F,x,A),G="sun rising"):i<c?(F=c-m,q=Sa(i-m,F,E,I),Z=Sa(i-m,F,C,M),X=Sa(i-m,F,A,D),G="early morning"):i<a?(F=a-c,q=Sa(i-c,F,I,U),Z=Sa(i-c,F,M,z),X=Sa(i-c,F,D,B),G="late morning"):i<h?(F=h-a,q=Sa(i-a,F,U,ee),Z=Sa(i-a,F,z,te),X=Sa(i-a,F,B,K),G="early afternoon"):i<g?(F=g-h,q=Sa(i-h,F,ee,W),Z=Sa(i-h,F,te,N),X=Sa(i-h,F,K,L),G="late afternoon"):i<_&&(F=_-g,q=Sa(i-g,F,W,w),Z=Sa(i-g,F,N,T),X=Sa(i-g,F,L,x),G="sun setting");let oe=0;switch(r){case"rainy":case"foggy":case"snowy":oe=.5}oe>0&&(Z=p0e(Z,oe),X=p0e(X,oe));const pe=ke(Z[0],Z[1],Z[2]),ye=ke(X[0],X[1],X[2]),Se=BNe(r);return{direct:{intensity:q[0]*Se.direct,color:pe},ambient:{intensity:q[1]*Se.ambient,color:ye},timeOfDay:G}}function Sa(t,e,r,i){const n=[];for(let s=0;s<r.length;s++)n[s]=(i[s]-r[s])*t/e+r[s];return n}const f0e=$e(),QH=P(),eq=P(),vbt=P(),tq=.25,bbt=.2;let gf=class extends Sn.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandles=new qr,this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new nV,this._ambientLight=new Dae,this._moonLight=new XDe,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView(),this._viewHandles.destroy()}get _view(){var e;return(e=this._renderer)==null?void 0:e.view}get updating(){var e;return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!((e=this._renderer)!=null&&e.updating))}get weatherEnabled(){var e,r,i;return((e=this._view)==null?void 0:e.environment.atmosphereEnabled)&&!this._disableWeather&&((i=(r=this._view)==null?void 0:r.state)==null?void 0:i.viewingMode)===qe.Global&&NL(this._view.spatialReference)}get weatherVisible(){var e;return this.weatherEnabled&&((e=this._renderer)==null?void 0:e.weatherVisible)}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){if(this._renderer)return;this._renderer=new To({view:e});const r=()=>this._updateRenderParameters(),i=()=>this._cameraHandler();this._viewHandles.add([ne(()=>e.environment.lighting,n=>this._updateLightingHandler(n),Zr),ne(()=>e.environment.lighting.type!=="virtual"?e.environment.lighting.date:null,n=>this._lightingDateHandler(n),Zr),ne(()=>e.stationary,()=>this._interactingStationaryHandler()),ne(()=>e.environment.lighting.directShadowsEnabled,r,Zr),ne(()=>e.environment.lighting.ambientOcclusionEnabled,r,Zr),ne(()=>e.environment.lighting.waterReflectionEnabled,r,Zr),ne(()=>{var n;return(n=e.environment.background)==null?void 0:n.color},r,Zr),ne(()=>e.spatialReference,()=>this._resetReferencePosition(!0),Zr),ne(()=>e.environment.weather.type,()=>this._updateLighting(null,VR.Faded),Zr),ne(()=>this.weatherEnabled,()=>this._updateLighting(null,VR.Faded),Zr),ne(()=>e.viewingMode,()=>this._resetReferencePosition(!0),Wi),ne(()=>e.environment.lighting.type!=="virtual"&&e.environment.lighting.cameraTrackingEnabled,n=>this._updateCameraTracking(n),Wi),ne(()=>e.state.camera,i,Wi),ne(()=>this.disableQueries,i)]),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer=ze(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type!=="virtual"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type!=="virtual"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const r=this._view.environment.lighting;(r==null?void 0:r.type)!=="virtual"&&(r.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const r=this._view.environment.lighting;if((r==null?void 0:r.type)!=="virtual"){if(e){if(!r.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const i=this._view.spatialReference;if(!o2(i)){const n=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(n))return void this._requestReferencePositionUpdate(n)}if(this._preupdateTracking(e),v(this._referencePosWGS84Comparable)){const n=c0e(this._referencePosWGS84Comparable,m0e);v(n)&&(r.autoUpdate(null,n),this._trackingEnabled&&(r.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type!=="virtual"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const r=this._view;if(!r.ready)return;const i=r.stateManager.camera;i&&(this._cameraHandlerClientSide(i,e)||this._cameraHandlerServerSide(i))}_cameraHandlerClientSide(e,r){const i=NL(this._view.spatialReference);if(i&&!o2(this._view.spatialReference))return this._view.environment.lighting.type==="virtual"&&this._updateLighting(),!1;const n=e.position;return R(this._referencePosWGS84Comparable)&&(this._referencePosWGS84Comparable=P()),i?bZe(n,this._referencePosWGS84Comparable):he(this._referencePosWGS84Comparable,n.longitude??0,n.latitude??0,n.z??0),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,r)||this._updateLighting(r),!0}_cameraHandlerServerSide(e){const r=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(r))&&this._requestReferencePositionUpdate(r,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=(r.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e,r=VR.Immediate){const i=this._view;e=e||(i.environment.lighting.type==="virtual"?null:i.environment.lighting.date);const n=this._referencePosWGS84Comparable,s=v(n)?wbt:xbt,o=this.weatherVisible?i.environment.weather.type:"disabled";v(n)?hbt(e,n,i.state.viewingMode,o,i.state.camera,s):i.environment.lighting.type==="virtual"&&zNe(i.state.camera,i.state.viewingMode,s.direct.directionToLightSource);const a=this._mainLight,l=s.direct;le(a.intensity,l.color,l.intensity*Math.PI),ce(a.direction,l.directionToLightSource),a.specularStrength=s.specularStrength,a.environmentStrength=s.environmentStrength;const c=this._ambientLight;le(c.intensity,s.ambient.color,s.ambient.intensity);const h=this._moonLight;fs(h.intensity,Sbt,Ebt,s.globalFactor);const p=(1-.5*s.globalFactor)*(1-.4*s.noonFactor*(1-s.globalFactor));le(h.intensity,h.intensity,p),ce(h.direction,l.directionToLightSource),this._renderer.updateLightSources([a,c,h],s.noonFactor,s.globalFactor,r),this._updateRenderParameters()}_autoUpdateTimezone(e,r=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||R(e))return!1;const i=Tbt;i.setTime((r||this._view.environment.lighting.date).getTime());const n=c0e(e,m0e);if(R(n))return!1;let s=this._view.environment.lighting.positionTimezoneInfo;if(s.autoUpdated){if(s.hours===n.hours&&s.minutes===n.minutes&&s.seconds===n.seconds)return!1}else s=n;const o=i.getUTCHours()-(n.hours-s.hours),a=i.getUTCMinutes()-(n.minutes-s.minutes),l=i.getUTCSeconds()-(n.seconds-s.seconds);return i.setUTCHours(o),i.setUTCMinutes(a),i.setUTCSeconds(l),!r&&this._view.environment.lighting.autoUpdate(i,n)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const r=kh(this._referencePosWGS84Comparable,!0,s=>pbt(s[2],this._view.state.viewingMode)),i=this._view.environment.background,n=i instanceof rDe?{type:"color",color:eoe(Xe.toUnitRGBA(i.color))}:{type:"color",color:Zt(0,0,0,1)};e.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&r,background:n,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,r=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!r,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const i=this._referencePosUpdateQuery=YS(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===i){const s=()=>this._referencePosUpdateQuery!==i;return this._doReferencePositionUpdateQuery(s)}}).catch(s=>{s.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===i&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),n=this._referencePosUpdateTimer=YS(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===n&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const r=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(r[0])&&!isNaN(r[1])){const i=(this._referencePosMapCoords.z??0)*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=r[0],this._referencePosWGS84Comparable[1]=r[1],this._referencePosWGS84Comparable[2]=i):this._referencePosWGS84Comparable=[r[0],r[1],i],this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let r=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(r*=this._view.mapCoordsHelper.unitInMeters),r>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){const e=this;return{get renderer(){return e._renderer},set referencePointUpdateInterval(r){e._referencePointUpdateInterval=r},set referencePointUpdateDistThreshold(r){e._referencePointUpdateDistThreshold=r},set referencePosUpdateTimer(r){e._referencePosUpdateTimer=r},set referencePointUpdateDelay(r){e._referencePointUpdateDelay=r},set disableWeather(r){e._disableWeather=r}}}};u([d({type:Boolean,readOnly:!0})],gf.prototype,"updating",null),u([d()],gf.prototype,"disableQueries",void 0),u([d()],gf.prototype,"_disableWeather",void 0),u([d()],gf.prototype,"weatherEnabled",null),u([d()],gf.prototype,"weatherVisible",null),u([d()],gf.prototype,"referencePositionWGS84Comparable",null),u([d()],gf.prototype,"_renderer",void 0),u([d()],gf.prototype,"_referencePosWGS84Comparable",void 0),gf=u([$("esri.views.3d.environment.SceneViewEnvironmentManager")],gf);const wbt=new VNe,xbt=new VNe,Tbt=new Date,m0e={hours:0,minutes:0,seconds:0},Sbt=ke(.22,.22,.33),Ebt=ke(.22,.22,.22);var qi;(function(t){t[t.NONE=0]="NONE",t[t.TILT=1]="TILT",t[t.ALTITUDE=2]="ALTITUDE",t[t.DISTANCE=4]="DISTANCE",t[t.COLLISION=8]="COLLISION",t[t.ALL=15]="ALL",t[t.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"})(qi||(qi={}));var fr;(function(t){t[t.NONE=0]="NONE",t[t.ZOOM=1]="ZOOM",t[t.TUMBLE=2]="TUMBLE",t[t.LOOK_AROUND=3]="LOOK_AROUND",t[t.PAN=4]="PAN",t[t.ASCEND=5]="ASCEND"})(fr||(fr={}));var Vo;(function(t){t[t.TUMBLE=0]="TUMBLE",t[t.LOOK_AROUND=1]="LOOK_AROUND"})(Vo||(Vo={}));function wD(t,e){return(t&e)!=0}function uV(t,e,r,i,n,s){t!==0&&(r?(s.min=Math.min(s.min,e),s.max=Math.max(s.max,e)):i!=null?(s.min-=Math.max(0,(e-s.min)*(1-i)),s.max+=Math.max(0,(e-s.max)*(1-i))):n&&(s.min-=Math.max(0,e-s.min-n),s.max+=Math.max(0,e-s.max-n)))}const mw={selection:qi.NONE,interactionType:fr.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Vo.TUMBLE};function jNe(t,e,r,i){return e=e||t.viewForward,ce(i,e),le(i,i,Math.sign(ve(e,r))),i}function Cbt(t,e,r,i){return Pbt(t,e,r,Obt(i,e,r,!0))}function Abt(t,e,r,i){const n=ve(r,ge(t,i,e));return me(t,e,le(t,r,n))}const Rbt={dir:P(),len:0,clip:Ne()};function Obt(t,e,r,i){const n=Rbt;return t?(r&&i&&(n.len=Pi(e,r)),ce(n.dir,t)):i?(n.len=Pi(e,r),ge(n.dir,r,e),le(n.dir,n.dir,1/n.len)):(ge(n.dir,r,e),we(n.dir,n.dir)),n}function Mbt(t,e,r){const i=ve(t,r.dir),n=-Ri(t,e);if(n<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return n>0;if((n<0||i<0)&&!(n<0&&i<0))return!0;const s=n/i;return i>0?s<r.clip[1]&&(r.clip[1]=s):s>r.clip[0]&&(r.clip[0]=s),r.clip[0]<=r.clip[1]}function Pbt(t,e,r,i){i.clip[0]=0,i.clip[1]=r?i.len:Number.MAX_VALUE;for(let n=0;n<t.length;n++)if(!Mbt(t[n],e,i))return!1;return!0}function Ibt(t,e,r=mw){const i=tle(t,e,r);if(i===0)return!1;const n=t.renderCoordsHelper,s=n.getAltitude(e.eye)+i,o=jNe(e,r.interactionDirection,Dbt(t,e,Math.sign(i),Ubt),kbt),a=ce(zbt,e.viewForward),l=n.intersectInfiniteManifold(nd(e.eye,o),s,rq);return e.eye=v(l)?l:n.setAltitude(rq,s,e.eye),e.center=Abt(rq,e.eye,a,e.center),!0}function tle(t,e,r=mw){if(!$bt(t,r)||!t.state.constraints.altitude)return 0;const i=Nbt(t.state.constraints.altitude,Fbt);Lbt(t,r,i);const n=t.renderCoordsHelper.getAltitude(e.eye),s=_e(n,i.min,i.max)-n;return Math.abs(s)<=1e-6?0:s}function $bt(t,e){const r=t.state.constraints.altitude;return!(!t.state.isGlobal||!r)&&(e.interactionType!==fr.TUMBLE||!wD(e.selection,qi.TILT))}function Lbt(t,e,r){const i=e.interactionType;if(i===fr.NONE)return;const{min:n,max:s}=r,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=i===fr.TUMBLE||i===fr.ZOOM,c=tle(t,o),h=c===0?0:t.renderCoordsHelper.getAltitude(o.eye);r.min=n,r.max=s,uV(c,h,l,a,.05*h,r)}function Dbt(t,e,r,i){return t.renderCoordsHelper.worldUpAtPosition(e.eye,i),le(i,i,r),i}function Nbt(t,e){return e.min=t.min,e.max=t.max,e}const Fbt={min:0,max:0},kbt=P(),Ubt=P(),zbt=P(),rq=P();function rle(t,e,r=mw){if(!t.state.isLocal)return 0;const i=t.state.constraints.distance;if(!t.pointsOfInterest.surfaceOrigin.renderLocation||i===1/0)return 0;Z4.min=0,Z4.max=i,Bbt(t,r,Z4);const n=ile(t,e),s=Z4.max-n;return s>=-1e-6?0:s}function Vbt(t,e,r=mw){const i=rle(t,e,r);if(i===0)return!1;const n=t.pointsOfInterest.surfaceOrigin;if(!n.renderLocation)return!1;const s=ile(t,e)+i,o=ce(Gbt,e.eye),a=jNe(e,r.interactionDirection,jbt(e,n.renderLocation,Wbt),qbt);if(!Dw(TLe(n.renderLocation,s),nd(e.eye,a),J4))return!1;e.eye=J4;const l=ge(Hbt,e.eye,o);e.center=me(J4,e.center,l);const c=t.renderCoordsHelper.getAltitude(e.center),h=t.renderCoordsHelper.intersectInfiniteManifold(e.ray,c,J4);return v(h)&&(e.center=h),!0}function Bbt(t,e,r){const i=e.interactionType;if(i===fr.NONE)return;const{min:n,max:s}=r,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=i===fr.ZOOM||i===fr.PAN,c=rle(t,o),h=c===0?0:ile(t,o);r.min=n,r.max=s,uV(c,h,l,a,.05*h,r)}function ile(t,e){const r=t.pointsOfInterest.surfaceOrigin;return r.renderLocation?Pi(e.eye,r.renderLocation):0}function jbt(t,e,r){return L_(r,t.eye,e)}const Z4={min:0,max:0},Gbt=P(),Hbt=P(),qbt=P(),Wbt=P(),J4=P();var pn,ba;(function(t){t[t.OBJECT=0]="OBJECT",t[t.HUD=1]="HUD",t[t.TERRAIN=2]="TERRAIN",t[t.OVERLAY=3]="OVERLAY",t[t.I3S=4]="I3S",t[t.PCL=5]="PCL",t[t.LOD=6]="LOD",t[t.VOXEL=7]="VOXEL"})(pn||(pn={}));let Xbt=class{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=ba.ALL}};(function(t){t[t.MIN=0]="MIN",t[t.MINMAX=1]="MINMAX",t[t.ALL=2]="ALL"})(ba||(ba={}));let Ybt=class{constructor(e,r,i){this.object=e,this.geometryId=r,this.triangleNr=i}},Zbt=class extends Ybt{constructor(e,r,i,n){super(e,r,i),this.center=v(n)?On(n):null}},GNe=class{constructor(e){this.layerUid=e}},i7=class extends GNe{constructor(e,r){super(e),this.graphicUid=r}};function xm(t){return v(t)&&v(t.dist)}function g0e(t){return(e,r,i)=>(fs(y0e,e,r,i),!gae(t,y0e))}function n7(t){return xm(t)&&t.intersector===pn.OBJECT&&!!t.target}function s7(t){return xm(t)&&t.intersector===pn.HUD&&!!t.target&&"center"in t.target&&v(t.target.center)}const y0e=P();let Jbt=class{constructor(){this._transform=$e(),this._transformInverse=new K4({value:this._transform},ya,$e),this._transformInverseTranspose=new K4(this._transformInverse,Wu,$e),this._transformTranspose=new K4({value:this._transform},Wu,$e),this._transformInverseRotation=new K4({value:this._transform},KIe,vi)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){po(this._transform,e)}multiplyTransform(e){Mn(this._transform,this._transform,e)}set(e){po(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,r){this.setTransformMatrix(e),this.multiplyTransform(r),this._invalidateLazyTransforms()}},K4=class{constructor(e,r,i){this._original=e,this._update=r,this._dirty=!0,this._transform=i()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}},Kbt=class{constructor(e=0){this.offset=e,this.tmpVertex=P()}applyToVertex(e,r,i){const n=e+this.localOrigin[0],s=r+this.localOrigin[1],o=i+this.localOrigin[2],a=this.offset/Math.sqrt(n*n+s*s+o*o);return this.tmpVertex[0]=e+n*a,this.tmpVertex[1]=r+s*a,this.tmpVertex[2]=i+o*a,this.tmpVertex}applyToAabb(e){for(let s=0;s<3;++s)bv[s]=e[0+s]+this.localOrigin[s],Q4[s]=e[3+s]+this.localOrigin[s],EE[s]=bv[s];const r=this.applyToVertex(bv[0],bv[1],bv[2]);for(let s=0;s<3;++s)e[s]=r[s],e[s+3]=r[s];const i=s=>{const o=this.applyToVertex(s[0],s[1],s[2]);for(let a=0;a<3;++a)e[a+0]=Math.min(e[a+0],o[a]),e[a+3]=Math.max(e[a+3],o[a])};for(let s=1;s<8;++s){for(let o=0;o<3;++o)EE[o]=s&1<<o?Q4[o]:bv[o];i(EE)}let n=0;for(let s=0;s<3;++s)bv[s]*Q4[s]<0&&(n|=1<<s);if(n!==0&&n!==7){for(let s=0;s<8;++s)if(!(n&s)){for(let o=0;o<3;++o)n[o]?EE[o]=0:EE[o]=s&1<<o?bv[o]:Q4[o];i(EE)}}for(let s=0;s<3;++s)e[s+0]-=this.localOrigin[s],e[s+3]-=this.localOrigin[s];return e}};const bv=P(),Q4=P(),EE=P();let Qbt=class{constructor(e=0){this.componentLocalOriginLength=0,this._tmpVertex=P(),this._mbs=Os(),this._obb={center:P(),halfSize:Ki(),quaternion:null},this._totalOffset=0,this._offset=0,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}applyToVertex(e,r,i){const n=e,s=r,o=i+this.componentLocalOriginLength,a=this._totalOffset/Math.sqrt(n*n+s*s+o*o);return this._tmpVertex[0]=e+n*a,this._tmpVertex[1]=r+s*a,this._tmpVertex[2]=i+o*a,this._tmpVertex}applyToAabb(e){const r=e[0],i=e[1],n=e[2]+this.componentLocalOriginLength,s=e[3],o=e[4],a=e[5]+this.componentLocalOriginLength,l=r*s<0?0:Math.min(Math.abs(r),Math.abs(s)),c=i*o<0?0:Math.min(Math.abs(i),Math.abs(o)),h=n*a<0?0:Math.min(Math.abs(n),Math.abs(a)),p=Math.sqrt(l*l+c*c+h*h);if(p<this._totalOffset)return e[0]-=r<0?this._totalOffset:0,e[1]-=i<0?this._totalOffset:0,e[2]-=n<0?this._totalOffset:0,e[3]+=s>0?this._totalOffset:0,e[4]+=o>0?this._totalOffset:0,e[5]+=a>0?this._totalOffset:0,e;const f=Math.max(Math.abs(r),Math.abs(s)),m=Math.max(Math.abs(i),Math.abs(o)),g=Math.max(Math.abs(n),Math.abs(a)),_=Math.sqrt(f*f+m*m+g*g),b=this._totalOffset/_,w=this._totalOffset/p;return e[0]+=r*(r>0?b:w),e[1]+=i*(i>0?b:w),e[2]+=n*(n>0?b:w),e[3]+=s*(s<0?b:w),e[4]+=o*(o<0?b:w),e[5]+=a*(a<0?b:w),e}applyToMbs(e){const r=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=this._totalOffset/r;return this._mbs[0]=e[0]+e[0]*i,this._mbs[1]=e[1]+e[1]*i,this._mbs[2]=e[2]+e[2]*i,this._mbs[3]=e[3]+e[3]*this._totalOffset/r,this._mbs}applyToObb(e){const r=e.center,i=this._totalOffset/Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);this._obb.center[0]=r[0]+r[0]*i,this._obb.center[1]=r[1]+r[1]*i,this._obb.center[2]=r[2]+r[2]*i,Qf(this._obb.halfSize,e.halfSize,e.quaternion),me(this._obb.halfSize,this._obb.halfSize,e.center);const n=this._totalOffset/Math.sqrt(this._obb.halfSize[0]*this._obb.halfSize[0]+this._obb.halfSize[1]*this._obb.halfSize[1]+this._obb.halfSize[2]*this._obb.halfSize[2]);return this._obb.halfSize[0]+=this._obb.halfSize[0]*n,this._obb.halfSize[1]+=this._obb.halfSize[1]*n,this._obb.halfSize[2]+=this._obb.halfSize[2]*n,ge(this._obb.halfSize,this._obb.halfSize,e.center),v2(w0e,e.quaternion),Qf(this._obb.halfSize,this._obb.halfSize,w0e),this._obb.halfSize[0]*=this._obb.halfSize[0]<0?-1:1,this._obb.halfSize[1]*=this._obb.halfSize[1]<0?-1:1,this._obb.halfSize[2]*=this._obb.halfSize[2]<0?-1:1,this._obb.quaternion=e.quaternion,this._obb}},ewt=class{constructor(e=0){this.offset=e,this.sphere=Os(),this.tmpVertex=P()}applyToVertex(e,r,i){const n=this.objectTransform.transform;let s=n[0]*e+n[4]*r+n[8]*i+n[12],o=n[1]*e+n[5]*r+n[9]*i+n[13],a=n[2]*e+n[6]*r+n[10]*i+n[14];const l=this.offset/Math.sqrt(s*s+o*o+a*a);s+=s*l,o+=o*l,a+=a*l;const c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*s+c[4]*o+c[8]*a+c[12],this.tmpVertex[1]=c[1]*s+c[5]*o+c[9]*a+c[13],this.tmpVertex[2]=c[2]*s+c[6]*o+c[10]*a+c[14],this.tmpVertex}applyToMinMax(e,r){const i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i;const n=this.offset/Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);r[0]+=r[0]*n,r[1]+=r[1]*n,r[2]+=r[2]*n}applyToAabb(e){const r=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*r,e[1]+=e[1]*r,e[2]+=e[2]*r;const i=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*i,e[4]+=e[4]*i,e[5]+=e[5]*i,e}applyToBoundingSphere(e){const r=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=this.offset/r;return this.sphere[0]=e[0]+e[0]*i,this.sphere[1]=e[1]+e[1]*i,this.sphere[2]=e[2]+e[2]*i,this.sphere[3]=e[3]+e[3]*this.offset/r,this.sphere}};const _0e=new ewt;function ete(t){return v(t)?(_0e.offset=t,_0e):null}const v0e=new Qbt;function twt(t){return v(t)?(v0e.offset=t,v0e):null}const b0e=new Kbt;function rwt(t){return v(t)?(b0e.offset=t,b0e):null}const Y1="terrain",w0e=Dp(),qO=1e-5;let iwt=class{constructor(e){this.options=new Xbt,this._results=new nwt,this.transform=new Jbt,this.tolerance=qO,this.verticalOffset=null,this._ray=Do(),this._rayEnd=P(),this._rayBeginTransformed=P(),this._rayEndTransformed=P(),this.viewingMode=e??qe.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,r,i){this.resetWithRay(Ggt(e,r,this._ray),i)}resetWithRay(e,r){this.camera=r,e!==this._ray&&Kz(e,this._ray),this.options.verticalOffset!==0?this.viewingMode===qe.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,me(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,r,i,n,s){this.point=r,this.filterPredicate=n,this.tolerance=i??qO;const o=ete(this.verticalOffset);if(v(e)&&e.length>0){const a=s?l=>{s(l)&&this.intersectObject(l)}:l=>{this.intersectObject(l)};for(const l of e){const c=l.getSpatialQueryAccelerator&&l.getSpatialQueryAccelerator();v(c)?(v(o)?c.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,a,o):c.forEachAlongRay(this._ray.origin,this._ray.direction,a),this.options.selectionMode&&this.options.hud&&c.forEachDegenerateObject(a)):l.objects.forAll(h=>a(h))}}this.sortResults()}intersectObject(e){const r=e.geometries;if(!r)return;const i=e.transformation,n=ete(this.verticalOffset);for(const s of r){if(!s.visible)continue;const{material:o,id:a}=s;this.transform.setAndInvalidateLazyTransforms(i,s.shaderTransformation),Ke(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),Ke(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;v(n)&&(n.objectTransform=this.transform),o.intersect(s,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(c,h,p,f,m,g)=>{if(c>=0){if(v(this.filterPredicate)&&!this.filterPredicate(this._ray.origin,this._rayEnd,c))return;const _=f?this._results.hud:this._results,b=f?w=>{const x=new Zbt(e,a,p,g);w.set(pn.HUD,x,c,h,id,m)}:w=>w.set(pn.OBJECT,{object:e,geometryId:a,triangleNr:p},c,h,l,m);if((_.min.drapedLayerOrder==null||m>=_.min.drapedLayerOrder)&&(_.min.dist==null||c<_.min.dist)&&b(_.min),this.options.store!==ba.MIN&&(_.max.drapedLayerOrder==null||m<_.max.drapedLayerOrder)&&(_.max.dist==null||c>_.max.dist)&&b(_.max),this.options.store===ba.ALL)if(f){const w=new tte(this._ray);b(w),this._results.hud.all.push(w)}else{const w=new BR(this._ray);b(w),this._results.all.push(w)}}})}}sortResults(e=this._results.all){e.sort((r,i)=>r.dist!==i.dist?Nt(r.dist,0)-Nt(i.dist,0):r.drapedLayerOrder!==i.drapedLayerOrder?Nt(r.drapedLayerOrder,Number.MAX_VALUE)-Nt(i.drapedLayerOrder,Number.MAX_VALUE):Nt(i.drapedLayerGraphicOrder,Number.MIN_VALUE)-Nt(r.drapedLayerGraphicOrder,Number.MIN_VALUE))}};function Pp(t){return new iwt(t)}let nwt=class{constructor(){this.min=new BR(Do()),this.max=new BR(Do()),this.hud={min:new tte(Do()),max:new tte(Do()),all:new Array},this.ground=new BR(Do()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}},BR=class{get ray(){return this._ray}get distanceInRenderSpace(){return v(this.dist)?(le(e5,this.ray.direction,this.dist),Pe(e5)):null}getIntersectionPoint(e){return!!xm(this)&&(le(e5,this.ray.direction,this.dist),me(e,this.ray.origin,e5),!0)}getTransformedNormal(e){return ce(MM,this.normal),MM[3]=0,qh(MM,MM,this.transformation),ce(e,MM),we(e,e)}constructor(e){this.intersector=pn.OBJECT,this.normal=P(),this.transformation=$e(),this._ray=Do(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=pn.OBJECT,Kz(e,this._ray)}set(e,r,i,n,s,o,a){this.intersector=e,this.dist=i,ce(this.normal,Nt(n,GEe)),po(this.transformation,Nt(s,id)),this.target=r,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(e){Kz(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,ce(this.normal,e.normal),po(this.transformation,e.transformation)}},tte=class extends BR{constructor(){super(...arguments),this.intersector=pn.HUD}};function nle(t){return new BR(t)}const e5=P(),MM=pr();function HNe(t,e,r,i){return v(t.renderCoordsHelper.fromRenderCoords(e.eye,hV,i))&&fCe(r,hV)}function o7(t,e){return t.elevationProvider?Nt(t.elevationProvider.getElevation(e[0],e[1],e[2],t.renderCoordsHelper.spatialReference,"ground"),0):0}function H2(t,e,r,i){const n=t.state.camera.clone();e&&r&&i&&(n.eye=e,n.center=r,n.up=i),swt(t,n.ray,wv)||ce(wv,n.center);const s=t.state.constraints,o=s.minimumPoiDistance;if(ga(n.eye,wv)<o){const a=s.collision.enabled;ce(nx,n.viewForward),le(nx,nx,o),a?n.eye=ge(hV,wv,nx):me(wv,n.eye,nx);const l=t.renderCoordsHelper,c=l.getAltitude(n.eye),h=s.collision.elevationMargin;a&&c<h&&(ge(nx,wv,n.eye),n.eye=l.setAltitude(hV,h,n.eye),me(wv,n.eye,nx))}return n.center=wv,n}function x0e(t,e,r){if(!t.state.isGlobal||!t.stateManager.constraintsManager)return!1;const i=o7(t,e),n=t.stateManager.constraintsManager.nearFarHeuristic,{far:s}=n.compute(e,r,t.renderDataExtent,i,awt),o=s*s;return ga(e,r)>o}function swt(t,e,r){let i=T0e[t.viewingMode];i||(i=Pp(t.state.viewingMode),i.options.backfacesTerrain=!t.state.isGlobal,i.options.invisibleTerrain=!0,T0e[t.viewingMode]=i);const{isGlobal:n}=t.state;return!(!t.sceneIntersectionHelper.intersectRay(e,i,r)||x0e(t,e.origin,r))||!(!t.renderCoordsHelper.intersectManifold(e,0,r)||x0e(t,e.origin,r))||!!n&&owt(e,r,ii(t.spatialReference).radius)}function owt(t,e,r){const i=ve(t.origin,t.origin)-r*r,n=i>0?Math.sqrt(i)/3:1;return le(e,t.direction,n/Pe(t.direction)),me(e,e,t.origin),!0}const T0e={},hV=P(),wv=P(),nx=P(),awt={near:0,far:0};function N3(t,e,r=dp.EYE){const i=t.state.constraints;if(!i.collision.enabled)return!1;const n=o7(t,e.eye),s=t.renderCoordsHelper.getAltitude(e.eye),o=n+i.collision.elevationMargin;if(s>=o)return!1;const a=Pe(e.eye);if(ge(t5,e.center,e.eye),e.eye=t.renderCoordsHelper.setAltitude(lwt,o,e.eye),r===dp.EYE_AND_CENTER)e.center=me(t5,e.eye,t5);else if(r===dp.EYE_AND_CENTER_SCALE){const l=(a-s+o)/a;e.center=le(t5,e.center,l)}return!0}var dp;(function(t){t[t.EYE=0]="EYE",t[t.EYE_AND_CENTER=1]="EYE_AND_CENTER",t[t.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(dp||(dp={}));const t5=P(),lwt=P();function gw(t,e,r){t.worldUpAtPosition(e,S0e),ge(iq,r,e);const i=Pe(iq);return i===0?0:Js(ve(iq,S0e)/i)}const S0e=P(),iq=P();function qNe(t,e,r=mw,i=!0){PM.eyeCenterDistance=0,PM.requiresTwoSteps=!1;const n=sle(t,e,r,void 0,PM);if(n===0)return!1;switch(rd(r5,-n,e.viewRight),r.tiltMode){case Vo.LOOK_AROUND:Ke(xv,e.viewForward,r5),le(xv,xv,PM.eyeCenterDistance),e.center=me(Z1,e.eye,xv);break;case Vo.TUMBLE:ge(xv,e.center,e.eye),Ke(xv,xv,r5),e.eye=ge(Z1,e.center,xv);break;default:r.tiltMode}return e.up=Ke(Z1,e.up,r5),!PM.requiresTwoSteps||!i||qNe(t,e,r,!1)}function sle(t,e,r=mw,i=mw,n){if(!t.state.constraints.tilt)return 0;const s=e.distance,o=t.state.constraints.tilt(s,_wt);return ywt(t,r,o),i.interactionType===fr.TUMBLE&&wD(i.selection,qi.ALTITUDE)&&WNe(t,i.interactionStartCamera,o),r.tiltMode===Vo.LOOK_AROUND||i.tiltMode===Vo.LOOK_AROUND?uwt(t,e,o,n):cwt(t,e,o)}function cwt(t,e,r){const i=gw(t.renderCoordsHelper,e.center,e.eye),n=i-_e(i,r.min,r.max);return xD(n)?n:0}function uwt(t,e,r,i){switch(i&&(i.requiresTwoSteps=!1),t.viewingMode){case"global":return dwt(t,e,r,i);case"local":return hwt(t,e,r,i)}}function hwt(t,e,r,i){const n=gw(t.renderCoordsHelper,e.center,e.eye),s=_e(n,r.min,r.max),o=n-s;if(!xD(o))return 0;if(i){const a=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=t.renderCoordsHelper.getAltitude(e.eye)-a,c=Math.cos(s);Math.abs(c)>1e-4?i.eyeCenterDistance=l/c:i.eyeCenterDistance=e.distance}return o}function dwt(t,e,r,i){const n=pwt(t,e,vwt),s=_e(n.tiltAtCenter,r.min,r.max);if(!xD(n.tiltAtCenter-s))return 0;let o,a;return n.centerIsOnSurface?(o=fwt(n),a=mwt(n,o)):(o=n.constraints.clampTilt(n.eyeCenterDistance,n.tiltAtCenter),i&&o<Math.PI/2&&(i.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=gwt(n,o)),i&&(i.eyeCenterDistance=rte(n,o)),a}function pwt(t,e,r){const i=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,n=i+ii(t.spatialReference).radius,s=t.renderCoordsHelper.intersectManifold(e.ray,i,Z1);return r.eyeCenterDistance=e.distance,r.centerIsOnSurface=!1,v(s)?(r.eyeCenterDistance=Pi(e.eye,s),r.tiltAtCenter=gw(t.renderCoordsHelper,s,e.eye),r.centerIsOnSurface=!0):t.state.isLocal?r.tiltAtCenter=gw(t.renderCoordsHelper,e.center,e.eye):(I3(NB(FB,n),e.ray,Z1),r.eyeCenterDistance=Pi(e.eye,Z1),r.tiltAtCenter=Js(-ve(e.viewForward,we(Z1,Z1)))),r.radius=n,r.eyeRadius=Pe(e.eye),r.constraints=t.state.constraints,r}function xD(t){return Math.abs(t)>1e-9}function fwt(t){const{constraints:e,eyeCenterDistance:r,tiltAtCenter:i}=t;let n=i,s=e.clampTilt(r,i);const o=rte(t,s);if(e.clampTilt(o,i)===s)return s;let a=0;for(;a<10&&xD(s-n);){const l=(n+s)/2,c=rte(t,l);xD(e.clampTilt(c,l)-l)?n=l:s=l,a++}return s}function rte(t,e){if(!t.centerIsOnSurface)return t.eyeCenterDistance;const r=Math.PI-_e(e,0,Math.PI),i=Ep(t.radius/t.eyeRadius*Math.sin(r)),n=Math.PI-r-i,s=Math.sin(n)/Math.sin(r);if(t.eyeRadius<t.radius&&s>1){const o=Math.PI-i,a=Math.PI-r-o;return Math.sin(a)/Math.sin(r)*t.eyeRadius}return s*t.eyeRadius}function mwt(t,e){const r=Ep(t.radius/t.eyeRadius*Math.sin(t.tiltAtCenter)),i=Ep(t.radius/t.eyeRadius*Math.sin(e));return t.eyeRadius>t.radius?r-i:i-r}function gwt(t,e){return t.tiltAtCenter-Math.PI/2-(e-Math.PI/2)}function ywt(t,e,r){if(e.interactionType===fr.NONE)return;const{interactionStartCamera:i,interactionFactor:n}=e;if(!i)return;const{min:s,max:o}=r,a=sle(t,i,mw,e),l=a===0?0:gw(t.renderCoordsHelper,i.center,i.eye);r.min=s,r.max=o,e.interactionType===fr.TUMBLE?(wD(e.selection,qi.ALTITUDE)&&WNe(t,i,r),uV(a,l,!0,n,E0e,r)):uV(a,l,!1,n,E0e,r)}function WNe(t,e,r){const i=t.state.constraints;if(t.state.isLocal||!i.altitude||!e)return;const n=nl(e.center),s=Math.sqrt(n),o=e.distance,a=ii(t.spatialReference).radius,l=i.altitude.min+a,c=i.altitude.max+a,h=(l*l-o*o-n)/(-2*s*o),p=(c*c-o*o-n)/(-2*s*o);r.min=Math.max(r.min,Math.min(Math.PI-Js(p),r.max)),r.max=Math.min(r.max,Math.PI-Js(h))}const xv=P(),r5=$e(),Z1=P(),E0e=Xt(5),_wt={min:0,max:0},vwt={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},PM={eyeCenterDistance:0,requiresTwoSteps:!1};function bwt(t){return t}const a7=t=>t*t,ole=t=>1-a7(1-t),wwt=t=>t<.5?a7(2*t)/2:(ole(2*(t-.5))+1)/2,ale=t=>t*t*t,XNe=t=>1-ale(1-t),YNe=t=>t<.5?ale(2*t)/2:(XNe(2*(t-.5))+1)/2,lle=t=>t*t*t*t,ZNe=t=>1-lle(1-t),xwt=t=>t<.5?lle(2*t)/2:(ZNe(2*(t-.5))+1)/2,cle=t=>t*t*t*t*t,JNe=t=>1-cle(1-t),Twt=t=>t<.5?cle(2*t)/2:(JNe(2*(t-.5))+1)/2,ule=t=>1-Math.cos(t*Math.PI/2),KNe=t=>1-ule(1-t),Swt=t=>t<.5?ule(2*t)/2:(KNe(2*(t-.5))+1)/2,hle=t=>2**(10*(t-1)),qN=t=>1-hle(1-t),Ewt=t=>t<.5?hle(2*t)/2:(qN(2*(t-.5))+1)/2,dle=t=>-(Math.sqrt(1-t*t)-1),QNe=t=>1-dle(1-t),Cwt=t=>t<.5?dle(2*t)/2:(QNe(2*(t-.5))+1)/2;function Fp(t){const e=2*(t-Math.sqrt((t-1)*t)),r=e/2/t;return i=>i<r?t*i*i:e*i-e+1}function kp(t,e){return(r,i)=>r<e?e*t(r/e,i):1-t((1-r)/(1-e),i)*(1-e)}const Awt=kp(Fp(1),1),Rwt=kp(Fp(1),0),eFe=kp(Fp(1),.5),Owt=kp(Fp(2),1),Mwt=kp(Fp(2),0),Pwt=kp(Fp(2),.5),Iwt=kp(Fp(3),1),$wt=kp(Fp(3),0),Lwt=kp(Fp(3),.5),Dwt=kp(Fp(4),1),Nwt=kp(Fp(4),0),Fwt=kp(Fp(4),.5),kwt={linear:bwt,"in-quad":a7,"out-quad":ole,"in-out-quad":wwt,"in-coast-quad":Awt,"out-coast-quad":Rwt,"in-out-coast-quad":eFe,"in-cubic":ale,"out-cubic":XNe,"in-out-cubic":YNe,"in-coast-cubic":Owt,"out-coast-cubic":Mwt,"in-out-coast-cubic":Pwt,"in-quart":lle,"out-quart":ZNe,"in-out-quart":xwt,"in-coast-quart":Iwt,"out-coast-quart":$wt,"in-out-coast-quart":Lwt,"in-quint":cle,"out-quint":JNe,"in-out-quint":Twt,"in-coast-quint":Dwt,"out-coast-quint":Nwt,"in-out-coast-quint":Fwt,"in-sine":ule,"out-sine":KNe,"in-out-sine":Swt,"in-expo":hle,"out-expo":qN,"in-out-expo":Ewt,"in-circ":dle,"out-circ":QNe,"in-out-circ":Cwt};function ls(t,e,r=Bwt,i=e){i!==e&&i.copyFrom(e),i.computeUp(t.state.viewingMode);let n=!1;for(let a=0;a<jwt;a++){let l=0;for(const c of Vwt)if(wD(r.selection,c.type)){const h=Math.abs(c.error(t,i,r));c.apply(t,i,r)&&(n=!0,l+=h)}if(l===0)break}const s=wD(r.selection,qi.COLLISION),o=Uwt(r.interactionType,t);return s&&N3(t,i,o)&&(n=!0),n&&i.computeUp(t.state.viewingMode),n}function Uwt(t,e){switch(t){case fr.PAN:return dp.EYE_AND_CENTER;case fr.ASCEND:return e.state.isGlobal?dp.EYE_AND_CENTER_SCALE:dp.EYE_AND_CENTER;default:return dp.EYE}}function kf(t){const e=Math.min(1,t/150);return YNe(e)}function zwt(t,e,r){return sle(t,e,r)*e.distance}const Vwt=[{type:qi.TILT,error:zwt,apply:qNe},{type:qi.ALTITUDE,error:tle,apply:Ibt},{type:qi.DISTANCE,error:rle,apply:Vbt}],Bwt={selection:qi.ALL,interactionType:fr.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Vo.TUMBLE},jwt=5,oh=P(),eu=P(),Tv=P(),Xa=P(),sx=P(),Gwt=P(),ah={upward:ke(0,0,1),forward:ke(0,1,0),sideway:ke(1,0,0)},C0e=vi();let A0e=class{constructor(e=qe.Global){this.viewingMode=e,this.center=P(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=On(ah.forward)}pixelsPerPanAtZoom(e){return this.size/2/(this._zoomToPanScale*e)}zoomAtPixelsPerPan(e){return this.size/2/(this._zoomToPanScale*e)}pixelsPerRotateAtZoom(){const e=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/e}compareTo(e,r){if(r||(r={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===qe.Global){const s=(Pe(this.center)+Pe(e.center))/2;r.pan=vU(this.center,e.center)*s}else r.pan=Pi(this.center,e.center);let i=Math.abs(e.yaw-this.yaw);i>=Math.PI&&(i=2*Math.PI-i);const n=Math.abs(e.pitch-this.pitch);return r.rotate=Math.max(i,n),r.sourceZoom=this.distance,r.targetZoom=e.distance,r}interpolate(e,r,i){this.viewingMode===qe.Global?syt(e.center,r.center,i.pan,this.center):fs(this.center,e.center,r.center,i.pan),this.distance=isFinite(r.distance)?Bt(e.distance,r.distance,i.zoom):e.distance,this.pitch=Bt(e.pitch,r.pitch,i.rotate);let n=e.yaw;const s=r.yaw;Math.abs(s-n)>=Math.PI&&(n+=2*(n<s?1:-1)*Math.PI),this.yaw=Bt(n,s,i.rotate)}copyFrom(e){ce(this.center,e.center),this.pitch=e.pitch,this.yaw=e.yaw,this.distance=e.distance,ce(this.lookAtDirection,e.lookAtDirection),this.size=e.size,this.copyFromCommon(e),this.viewingMode=e.viewingMode}copyFromRenderCamera(e){const r=this._lookAtOrientation(e.center,C0e);ce(this.center,e.center),ge(Xa,e.center,e.eye),Gl(Xa,Xa,r),Gl(sx,e.up,r),this.distance=Pe(Xa),this.distance!==0&&(Xa[0]/=this.distance,Xa[1]/=this.distance,Xa[2]/=this.distance),this.pitch=this._eyeUpToPitch(Xa),this.yaw=this._eyeUpToYaw(Xa,sx),this.size=Math.sqrt(e.width*e.width+e.height*e.height),this.copyFromCommon(e)}copyFromCommon(e){this.fov=e.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(e){const r=this._lookAtOrientation(this.center,C0e);Xu(r,r),this._axisAngleVec3(ah.sideway,this.pitch-Math.PI/2,ah.forward,Xa),this._axisAngleVec3(ah.upward,this.yaw,Xa),this._axisAngleVec3(ah.sideway,this.pitch-Math.PI/2,ah.upward,sx),this._axisAngleVec3(ah.upward,this.yaw,sx),le(Xa,Xa,this.distance),Gl(Xa,Xa,r),Gl(sx,sx,r),e.center=this.center,e.eye=ge(Xa,this.center,Xa),e.up=sx}_axisAngleVec3(e,r,i,n=i){const s=Math.cos(r),o=Math.sin(r);return le(oh,i,s),vt(eu,e,i),le(eu,eu,o),le(Tv,e,(1-s)*ve(e,i)),me(n,me(n,oh,eu),Tv)}_lookAtOrientation(e,r=vi()){return this._upAtLookAt(e,Tv),vt(oh,this.lookAtDirection,Tv),we(oh,oh),oh[0]===0&&oh[1]===0&&oh[2]===0&&ce(oh,ah.sideway),vt(eu,Tv,oh),we(eu,eu),r[0]=oh[0],r[1]=eu[0],r[2]=Tv[0],r[3]=oh[1],r[4]=eu[1],r[5]=Tv[1],r[6]=oh[2],r[7]=eu[2],r[8]=Tv[2],r}_upAtLookAt(e,r){return this.viewingMode===qe.Local?ce(r,ah.upward):we(r,e)}_eyeUpToPitch(e){return Math.PI-vU(ah.upward,e)}_eyeUpToYaw(e,r){const i=Gwt;return Math.abs(r[2])<.5?(ce(i,r),e[2]>0&&le(i,i,-1)):ce(i,e),vt(eu,i,ah.upward),we(eu,eu),vU(ah.sideway,eu,ah.upward)}};const dV={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};let Hwt=class tFe{constructor(e){this._createCamera=e,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:dV.desiredScreenFlow},this.source=e(),this.target=e()}clone(){const e=new tFe(this._createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings)}update(e,r,i){this.source!==e&&this.source.copyFrom(e),this.target!==r&&this.target.copyFrom(r),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=i.desiredScreenFlow!=null?i.desiredScreenFlow:dV.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(e){const r=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/r}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}},qwt=class{constructor(){this.segments=[]}get time(){return this.segments.reduce((e,r)=>e+r.time,0)}interpolateComponentsAt(e,r){e=Math.min(Math.max(e,0),1),e*=this.time;let i=0,n=0;const s=this.definition;for(let o=0;o<this.segments.length;o++){const a=this.segments[o],l=a.definition;if(e<=a.time||o===this.segments.length-1){if(r=this.segmentInterpolateComponentsAt(a,a.time===0?0:e/a.time,r),s.hasPan&&!isNaN(r.pan)&&isFinite(s.compared.pan)?r.pan=(i+l.compared.pan*r.pan)/s.compared.pan:r.pan=1,s.hasRotate&&!isNaN(r.rotate)&&isFinite(s.compared.rotate)?r.rotate=(n+l.compared.rotate*r.rotate)/s.compared.rotate:r.rotate=1,s.hasZoom&&!isNaN(r.zoom)&&isFinite(l.compared.targetZoom)){const c=r.zoom*(l.compared.targetZoom-l.compared.sourceZoom)+l.compared.sourceZoom,h=this.segments[0].definition.compared.sourceZoom,p=this.segments[this.segments.length-1].definition.compared.targetZoom;r.zoom=(c-h)/(p-h)}else r.zoom=1;return r}e-=a.time,i+=l.compared.pan,n+=l.compared.rotate}}segmentInterpolateComponentsAt(e,r,i){return e.interpolateComponentsAt(r,i)}},nq=class{get time(){return this._time}constructor(e){e&&this.update(e)}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,r=e.compared,i=r.sourceZoom,n=r.targetZoom;this._zoomSign=i>n?1:-1,this._panPixelsAtSource=r.pan*e.source.pixelsPerPanAtZoom(i);const s=(e.source.pixelsPerRotateAtZoom(i)+e.target.pixelsPerRotateAtZoom(n))/2;this._rotatePixels=r.rotate*s}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom,{hasZoom:i,hasPan:n,hasRotate:s}=this.definition;let o=0,a=0;i&&(n&&(o=(r/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),s&&(a=this._zoomSign*(Math.log(e/r)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(i&&n&&s){const c=o+a+o*a;this._zoomPixelFlow=o*a/c*l,this._panPixelFlow=a/c*l,this._rotatePixelFlow=o/c*l}else if(i&&n){const c=1+o;this._zoomPixelFlow=o/c*l,this._panPixelFlow=1/c*l}else if(i&&s){const c=1+a;this._zoomPixelFlow=a/c*l,this._rotatePixelFlow=1/c*l}else if(n&&s){const c=this._panPixelsAtSource/this._rotatePixels,h=1+c;this._panPixelFlow=c/h*l,this._rotatePixelFlow=1/h*l}else n?this._panPixelFlow=l:i?this._zoomPixelFlow=l:s&&(this._rotatePixelFlow=l);this._time=s?this.rotateTime:i?this.zoomTime:n?this.panTime:0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,r=e*this._panPixelsAtSource;return Math.log(r*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0}_interpolateComponentsZoom(e){if(e===0||e===1)return e;if(this.definition.hasZoom){const r=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom;return(r*(r/i)**-e-r)/(i-r)}return e}_interpolateComponentsPan(e){if(e===0||e===1)return e;if(this.definition.hasPan&&this.definition.hasZoom){const r=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(r*e*this._time)-1))/(r*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,r){e=Math.min(Math.max(e,0),1);const i=this._interpolateComponentsZoom(e),n=this._interpolateComponentsPan(e),s=this._interpolateComponentsRotate(e);return r?(r.zoom=i,r.pan=n,r.rotate=s):r={zoom:i,pan:n,rotate:s},r}};function Wwt(t,e,r){const i=e-t.compared.sourceZoom,n=t.halfWindowPanAtZoom(i);return-t.halfWindowSize*(r.ascensionFactor*Math.LN2*t.compared.pan+n)*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2*n)}function Xwt(t,e,r){const i=1/e,n=Math.log(t.compared.sourceZoom*i),s=1/t.desiredPixelFlow,o=1/Math.LN2,a=e-t.compared.sourceZoom,l=1/a,c=(r.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(a))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*i*s*o*l*c-t.halfWindowSize*n*s*o*l+t.halfWindowSize*n*s*o*c/(a*a)}function Ywt(t,e,r){const i=e-t.compared.sourceZoom,n=1/i,s=1/e,o=Math.log(t.compared.sourceZoom*s),a=(r.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(i))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*n*(-2*n*s*a+2*n*o+2*s-2*o*a/(i*i)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function Zwt(t,e){return-t.halfWindowSize*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2)}function Jwt(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function Kwt(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function Qwt(t,e,r){return-t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e))}function ext(t,e,r){return t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e))}function txt(t,e,r){return-2*t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e*e))}function rxt(t,e,r){return t.halfWindowSize*(-t.halfWindowPanAtZoom(e)-r.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*t.halfWindowPanAtZoom(-e+t.compared.targetZoom))}function ixt(t,e,r){const i=Math.log(e/t.compared.targetZoom),n=1/t.desiredPixelFlow,s=1/Math.LN2,o=-e+t.compared.targetZoom,a=1/o,l=(-t.halfWindowPanAtZoom(e)-r.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return-t.halfWindowSize*i*n*s*a+t.halfWindowSize*i*n*s*l/(o*o)+t.halfWindowSize*n*s*a*l/e}function nxt(t,e,r){const i=e-t.compared.targetZoom,n=1/i,s=1/e,o=Math.log(e/t.compared.targetZoom),a=(t.halfWindowPanAtZoom(e)+r.descensionFactor*Math.LN2*t.compared.pan-t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*n*(-2*n*s*a-2*n*o+2*s+2*o*a/(i*i)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function sxt(t,e){return t.halfWindowSize*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2)}function oxt(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function axt(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function lxt(t){const e=Math.LN2*t.compared.pan,r=t.compared.sourceZoom-t.compared.targetZoom,i=t.halfWindowPanAtZoom(r),n=t.halfWindowSize*Math.log(t.compared.sourceZoom/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*i);return t.compared.sourceZoom<=t.compared.targetZoom?n*(e-i):n*(e+i)}function cxt(t,e){let r=uxt(t,e);const i={ascensionFactor:e.ascensionFactor!=null?e.ascensionFactor:.5,descensionFactor:e.descensionFactor!=null?e.descensionFactor:.5},n=i.ascensionFactor===0,s=i.descensionFactor===0,o=n?Zwt:Wwt,a=n?Jwt:Xwt,l=n?Kwt:Ywt,c=s?sxt:rxt,h=s?oxt:ixt,p=s?axt:nxt,f=E=>o(t,E,i)+Qwt(t,E,i)+c(t,E,i),m=E=>a(t,E,i)+ext(t,E,i)+h(t,E,i),g=E=>l(t,E,i)+txt(t,E,i)+p(t,E,i);let _=f(r);const b=lxt(t);let w;const x=e.maximumIterations||20,T=e.maximumDistance!=null?e.maximumDistance:1/0;for(w=0;w<x;w++){const C=(m(r)+1e-6)/g(r);if(isNaN(C)||r>=T&&C<0){if(!isFinite(T))return null;r=T,_=f(r);break}if(r-=C,r<t.compared.sourceZoom||r<t.compared.targetZoom)return null;const A=f(r);if(Math.abs(A-_)/_<=.005)break;_=A}return _>b*(1-.3)||r<t.compared.sourceZoom||r<t.compared.targetZoom?null:r}function uxt(t,e){const r=Math.max(t.compared.sourceZoom,t.compared.targetZoom),i=t.source.zoomAtPixelsPerPan(t.desiredPixelFlow/t.compared.pan)/2;return i<r?e.maximumDistance!=null?r+(e.maximumDistance-r)/2:1.5*r:e.maximumDistance?Math.min(e.maximumDistance,i):i}let hxt=class extends qwt{constructor(e,r){super(),this._preallocSegments=[new nq,new nq,new nq],this._ascensionSegment=null,this._descensionSegment=null,this.update(e,r)}update(e,r){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();let i=null;r&&r.apex&&(i=cxt(e,r.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,i==null?this._updateWithoutApex():this._updateWithApex(i,r==null?void 0:r.apex)}segmentInterpolateComponentsAt(e,r,i){return i=e.interpolateComponentsAt(r,i),e===this._ascensionSegment?i.zoom=ole(i.zoom):e===this._descensionSegment&&(i.zoom=a7(i.zoom)),i}_updateWithApex(e,r){const[i,n,s]=this._preallocSegments,o=(r==null?void 0:r.ascensionFactor)??.5,a=Math.min(1-o,(r==null?void 0:r.ascensionFactor)!=null&&r.descensionFactor!=null?r.descensionFactor:.5),l=1-o-a;i.definition?i.definition.copyFrom(this.definition):i.definition=this.definition.clone(),i.definition.compared.targetZoom=e,i.definition.compared.pan=this.definition.compared.pan*o,i.definition.compared.rotate=this.definition.compared.rotate*o,i.update(),this._ascensionSegment=i,this.segments.push(i),l>0&&(n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.copyFrom(this.definition),n.definition.compared.sourceZoom=e,n.definition.compared.targetZoom=e,n.definition.compared.pan=this.definition.compared.pan*l,n.definition.compared.rotate=this.definition.compared.rotate*l,n.update(),this.segments.push(n)),s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.compared.sourceZoom=e,s.definition.compared.pan=this.definition.compared.pan*a,s.definition.compared.rotate=this.definition.compared.rotate*a,s.update(),this._descensionSegment=s,this.segments.push(s)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}};const dxt={zoom:0,pan:0,rotate:0};let pxt=class{get time(){return this._time}constructor(e){this._createCamera=e,this._time=0,this.definition=new Hwt(e),this.path=new hxt}update(e,r,i){this.definition.update(e,r,i),this.path.update(this.definition,i),this._time=this._applyTimeSettings(o2e(isFinite(this.path.time)?this.path.time:0),i),this._easing=i.easing?i.easing:this._time>=1e3?eFe:qN}cameraAt(e,r){r=r||this._createCamera(),e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const i=this.path.interpolateComponentsAt(e,dxt);return r.interpolate(this.definition.source,this.definition.target,i),r}_normalizedEasing(e){const r=this._easing(0,this._time),i=this._easing(1,this._time);return(this._easing(e,this._time)-r)/(i-r)}_applyTimeSettings(e,r){const i=r.speedFactor!=null?r.speedFactor:1;r.duration!=null?e=r.duration:r.speedFactor!=null&&(e=e/i);const n=r.minDuration!=null?r.minDuration:dV.minDuration/i,s=r.maxDuration!=null?r.maxDuration:dV.maxDuration/i;return Math.min(Math.max(n,e),s)}};const fxt=P();let mxt=class{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(e){this.currentTime=0,this._animation=new pxt(()=>new A0e(e)),this._current=new A0e(e)}update(e,r,i){const n=this._animation.definition.source,s=this._animation.definition.target,o=ge(fxt,r.center,e.center),a=Pe(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),ce(n.lookAtDirection,o),ce(s.lookAtDirection,o),n.copyFromRenderCamera(e),s.copyFromRenderCamera(r),this._current.copyFrom(n),this._animation.update(n,s,i),this.currentTime=0,e.almostEquals(r)&&(this.currentTime=this._animation.time)}cameraAt(e,r){return this._animation.cameraAt(e,this._current),r=r||new Pt,this._current.copyToRenderCamera(r),r}step(e,r){return this.finished||(this.currentTime=this.currentTime+o2e(e),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,r)}};var bn;(function(t){t.Ready="ready",t.Rejected="rejected",t.Running="running",t.Stopped="stopped",t.Finished="finished"})(bn||(bn={}));let L0=class extends be{constructor(e){super(e),this.state=bn.Ready}get active(){return this.state===bn.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=bn.Stopped,!0)}finishController(){this.state=bn.Finished}get steppingFinished(){return!1}};u([d({constructOnly:!0})],L0.prototype,"view",void 0),u([d({readOnly:!0})],L0.prototype,"active",null),u([d()],L0.prototype,"state",void 0),u([d({readOnly:!0})],L0.prototype,"isInteractive",null),L0=u([$("esri.views.3d.state.controllers.CameraController")],L0);let TD=class extends L0{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(Vr()),this._asyncResult=null),this.state===bn.Finished||this.state===bn.Stopped?(b9(e),this.state===bn.Finished?e.resolve():e.reject(Vr())):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=bn.Running,v(this.viewAnimation)&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){!v(this.viewAnimation)||this.state!==bn.Ready&&this.state!==bn.Running||(this.viewAnimation.state===E_.State.FINISHED?this.finish():this.viewAnimation.state===E_.State.STOPPED&&(this.state=bn.Stopped))}onControllerEnd(){v(this.viewAnimation)&&!this.viewAnimation.done&&(this.state===bn.Finished?this.viewAnimation.finish():this.state===bn.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===bn.Finished?this._asyncResult.resolve():this._asyncResult.reject(Vr()))}finish(){this.finishController()}};TD=u([$("esri.views.3d.state.controllers.AnimationController")],TD);let Z0=class extends TD{get intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.mode="interaction",this._hasTarget=!1}initialize(){this.animation=new mxt(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new E_}get isInteractive(){return this.mode==="interaction"}begin(e,r){this._hasTarget=!0;const i=this.animationSettings(r);i5.copyFrom(this.view.state.camera);const n=Pp(this.view.state.viewingMode);this.intersectionHelper.intersectRay(i5.ray,n,R0e)&&(i5.center=R0e),this.animation.update(i5,e,i),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(e,r){this._hasTarget&&this.animation.step(e,r)}onControllerEnd(e){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:typeof e.easing=="string"?kwt[e.easing]:e.easing}}};u([d({constructOnly:!0})],Z0.prototype,"mode",void 0),u([d({readOnly:!0})],Z0.prototype,"isInteractive",null),Z0=u([$("esri.views.3d.state.controllers.PointToPointAnimationController")],Z0);const i5=new Pt,R0e=P();function l7(t=yxt){return[t[0],t[1],t[2],t[3]]}function SD(t,e){return gxt(t[0],t[1],t[2],e,lae.get())}function gxt(t,e,r,i,n=l7()){return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n}function ple(t,e,r){return vt(r,t,e),we(r,r),r[3]=hae(t,e),r}const yxt=[0,0,1,0];function rFe(t,e,r){return _xt(t,t.screenToRender(e,Ye.get()),r)}function _xt(t,e,r){const i=Qs(Ye.get(),e);if(i[2]=0,!t.unprojectFromRenderScreen(i,r.origin))return null;const n=Qs(Ye.get(),e);n[2]=1;const s=t.unprojectFromRenderScreen(n,Ye.get());return R(s)?null:(ge(r.direction,s,r.origin),r)}function F3(t,e,r){return fle(t,t.screenToRender(e,Ye.get()),r)}function fle(t,e,r){ce(r.origin,t.eye);const i=he(Ye.get(),e[0],e[1],1),n=t.unprojectFromRenderScreen(i,Ye.get());return R(n)?null:(ge(r.direction,n,r.origin),r)}function mle(t,e,r,i){const n=F3(e,r,vxt);return Dw(t,n,i)}const vxt=Do();var WO;(function(t){t[t.Ellipsoid=0]="Ellipsoid",t[t.Silhouette=1]="Silhouette"})(WO||(WO={}));const iFe=30,pV=[1,3e8],c7=80,nFe=8,sFe=200,oFe=1508e5,aFe=5,lFe=50,bxt=5,wxt=10,sq=90,q2={exclude:new Set([Y1])};function NS(t,e,r){return r[0]=e[0]/(t.fullWidth/t.pixelRatio),r[1]=e[1]/(t.fullHeight/t.pixelRatio),r}function ite(t){for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;return t}function yw(t,e,r){const i=rd(cae.get(),r[3],r);R(i)||PAe(i,id)||(ge(mi,t.eye,e),Ke(mi,mi,i),t.eye=me(mi,mi,e),ge(mi,t.center,e),Ke(mi,mi,i),t.center=me(mi,mi,e),t.up=Ke(mi,t.up,i))}function xxt(t,e,r,i){return j2(t,rFe(e,r,_le),i)}function nte(t,e,r,i){return j2(t,F3(e,r,_le),i)}function gle(t,e,r,i){const n=Ye.get();let s=1-r;ge(n,e,t.eye);const o=Pe(n);let a=o*(1-s);s>=0&&a<i&&(a=i,s=-(a-o)/o),Math.abs(o-a)<1e-6||(le(n,n,s),t.eye=me(mi,t.eye,n),t.center=fs(mi,t.center,e,s))}function cFe(t,e,r){e.getScreenCenter(O0e),mle(t,e,O0e,mi)&&(e.center=mi);const i=e.distance,n=i*r;if(Math.abs(i-n)<1e-6)return;const s=le(Ye.get(),e.viewForward,n);e.eye=ge(mi,e.center,s)}const O0e=wn();function oq(t,e){he(e,0,0,0);for(const r of t)me(e,e,r);le(e,e,1/t.length)}function IU(t,e,r,i){return Math.sin(t/Pe(e))*(r+i.radius)}function M0e(t,e,r,i){return IU(Math.PI/2,e,r,i)+(t-Math.PI/2)}var No;(function(t){t[t.Vertical=0]="Vertical",t[t.Horizontal=1]="Horizontal"})(No||(No={}));const P0e={Elevation:3e4,Angle:Xt(16)},n5={Pole:.95,Angle:Xt(18),Tilt:45},uFe=Xt(80);function hFe(t,e,r,i,n,s){const o=P(),a=Os();let l=!0,c=!0;return t.intersectScreen(r,o,s)?a[3]=Pe(o):(c=!1,e.aboveGround&&n!==WO.Ellipsoid?a[3]=Math.max(Pe(e.center),.9*i.radius):a[3]=Pe(e.eye)-e.relativeElevation,n===WO.Silhouette?ED(a,e,r,o):l=mle(a,e,r,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function u7(t,e,r){return Pe(t.eye)-r.radius>P0e.Elevation?No.Horizontal:(F3(t,e,U0e),-Math.sign(t.relativeElevation)*(.5*Math.PI+hae(t.eye,U0e.direction))<P0e.Angle?No.Vertical:No.Horizontal)}function dFe(t,e,r){ge(aq,r,e),t.eye=ge(mi,t.eye,aq),t.center=ge(mi,t.center,aq)}const aq=P();function ED(t,e,r,i){const n=F3(e,r,_le);return!R(n)&&(I3(t,n,s5),Dw(t,n,i)?!(ga(s5,n.origin)<ga(i,n.origin))||(ce(i,s5),!1):(ge(CE,e.eye,e.center),we(CE,CE),PLe(CE,-ve(we(CE,CE),s5),I0e),j2(I0e,n,i),!1))}const s5=P(),CE=P(),I0e=Yr();function pFe(t,e,r,i,n,s){let o=0;if(vt(gV,t,e),ge(c5,t,e),Pe(t)<=n||!i.aboveGround){vt(r,c5,i.eye);const a=ve(t,e)/(Pe(t)*Pe(e));if(a<.9999)o=Js(a);else{const c=Pe(vt(P(),t,e))/(Pe(t)*Pe(e));o=Ep(c)}const l=Math.cos(_e(ew.normalize(Xt(s)),0,uFe));o=-o-Math.max(0,Pe(e)-n)/(l*n)}else ge($0e,i.eye,i.center),vt(r,c5,$0e),o=-Pe(c5)/n;return we(r,r),le(r,r,Pe(gV)),o}const $0e=P();function L0e(t,e,r,i){let n,s;const o=Math.cos(_e(ew.normalize(Xt(i)),0,uFe));return n=e>r?-(e-r)/(o*r):e<-r?Math.PI-(e+r)/(o*r):Js(e/r),s=t>r?-(t-r)/(o*r):t<-r?Math.PI-(t+r)/(o*r):Js(t/r),(s-n)*r}function Txt(t,e,r,i,n,s,o,a,l,c){const h=L0e(t[2],e[2],s[3],a),p=l?L0e(t[0],e[0],s[3],180):e[0]-t[0],f=Math.sin(o)*p-Math.cos(o)*h,m=Math.cos(o)*p+Math.sin(o)*h;we(mi,n);const g=l?f/Math.sqrt(Math.abs(s[3]**2-ve(r,mi)**2)):f/s[3],_=m/Math.sqrt(Math.abs(s[3]**2-ve(r,i)**2));dt(c,g,_)}function fFe(t,e,r,i,n,s,o,a,l,c){vt(gV,t,e),UQ(s.up,s.eye,o5,a5,l5),UQ([0,0,1],s.eye,o_,zb,_Fe),ce(r,zb),ce(i,o_),we(r,r),le(r,r,Pe(gV)),iye(t,we(a5,a5),we(l5,l5),we(o5,o5),D0e),iye(e,a5,l5,o5,N0e),Txt(D0e,N0e,t,o_,zb,o,a,l,c,n)}function Sxt(t,e,r,i,n,s,o){rd(fV,n,i),rd(mV,o,s),Mn(nR,fV,mV),ge(e,t,r),Ke(e,e,nR),me(e,e,r)}function mFe(t,e,r,i,n,s){rd(fV,i,r),rd(mV,s,n),Mn(nR,fV,mV),ge(mi,t.eye,e),Ke(mi,mi,nR),t.eye=me(mi,mi,e),ge(mi,t.center,e),Ke(mi,mi,nR),t.center=me(mi,mi,e),ge(mi,t.up,e),Ke(mi,mi,nR),t.up=me(mi,mi,e)}function yle(t,e,r,i,n,s){return(Math.abs(i)>Math.PI-n5.Angle||Math.abs(i)<n5.Angle)&&(Math.abs(t[2])<r*n5.Pole||Math.abs(e)>r)&&s.aboveGround&&n<n5.Tilt}function gFe(t,e,r,i,n,s){if(s)ple(r,i,F0e),yw(e,t,F0e);else{const o=pFe(r,i,k0e,e,t[3],n);yw(e,t,SD(k0e,o))}}function yFe(t,e,r,i,n,s,o){const a=o?20:1,l=1e-12;let c,h;ce(ox,i),u5.copyFrom(e);for(let p=0;p<a&&ga(r,ox)>l&&(c=ga(r,ox),fFe(r,ox,zb,o_,IM,u5,t,n,s,o),mFe(u5,t,o_,IM[1],zb,IM[0]),Sxt(ox,ox,t,o_,IM[1],zb,IM[0]),h=ga(r,ox),h<c||p===0);p++)e.copyFrom(u5)}function Ext(t,e,r,i,n,s,o){yle(r,ve(e.up,r),t[3],-ew.normalize(Xt(n)),s,e)?yFe(t,e,r,i,-ew.normalize(Xt(n)),s,o):gFe(t,e,r,i,s,o)}function Cxt(t,e,r,i,n,s){const{eye:o}=t;UQ([0,0,1],o,o_,zb,_Fe);const a=e.translation[0]*r.pan,l=n.mode==="zoom"?0:e.translation[1]*r.pan,c=Math.max(Math.sqrt(Math.abs(1-ve(t.center,o_)**2/Pe(t.center)**2)),.5),h=(Math.sin(s)*l+Math.cos(s)*a)/c,p=-Math.cos(s)*l+Math.sin(s)*a;switch(Du(i.pan.matrix,i.pan.matrix,h,o_),i.pan.enabled=!0,n.mode){case"pan":Du(i.pan.matrix,i.pan.matrix,p,zb),i.pan.enabled=!0;break;case"zoom":i.zoom=-e.translation[1]*r.zoom}}function Axt(t,e,r,i,n){const{eye:s,viewRight:o}=t,a=vt(Ye.get(),o,s),l=e.translation[0]*r.pan;switch(l!==0&&(Du(i.pan.matrix,i.pan.matrix,-l,a),i.pan.enabled=!0),n.mode){case"pan":{const c=e.translation[1]*r.pan;c!==0&&(Du(i.pan.matrix,i.pan.matrix,c,o),i.pan.enabled=!0);break}case"zoom":i.zoom=-e.translation[1]*r.zoom}}function Rxt(t,e,r,i,n,s,o,a,l){yle(t.center,ve(t.up,t.center),Pe(t.center),-ew.normalize(Xt(s)),o,e)?Cxt(e,r,i,a,l,-ew.normalize(Xt(n))):Axt(e,r,i,a,l)}const o_=P(),zb=P(),_Fe=P(),o5=P(),a5=P(),l5=P(),D0e=P(),N0e=P(),IM=Ne(),F0e=l7(),fV=$e(),mV=$e(),nR=$e(),ox=P(),mi=P(),c5=P(),u5=new Pt,gV=P(),k0e=P(),_le={origin:P(),direction:P()},U0e={origin:P(),direction:P()},z0e=.6,lq=4,Oxt=60;let yV=class extends Z0{constructor(){super(...arguments),this._zoomLocation=P(),this._tmpCamera=new Pt,this._tmpViewDir=P(),this._tmpRayDir={origin:P(),direction:P()},this._targetOnSphere=P(),this._tmpCenter=P(),this._constraintOptions={selection:qi.ALL_EXCEPT_COLLISION,interactionType:fr.ZOOM,interactionFactor:null,interactionStartCamera:new Pt,interactionDirection:null,tiltMode:Vo.TUMBLE},this._sphere=Os()}initialize(){this._intersector=Pp(this.view.state.viewingMode)}zoomStep(e,r){if(!this.active)return;const i=this.view.state,{interactionStartCamera:n}=this._constraintOptions;n&&(this.animation.finished?n.copyFrom(i.camera):this.animation.cameraAt(1,n));let s=!1,o=!1;this.intersectionHelper.intersectScreen(r,this._zoomLocation,this.view.map.ground.opacity===0?q2:{})&&(s=e>0,o=!0),this._tmpCamera.copyFrom(i.camera),s?this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:ce(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,e,this._zoomLocation,r,o),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:qN}}_updateCamera(e,r,i,n,s){const o=ii(this.view.spatialReference),a=u7(e,n,o),l=Math.abs(this.view.camera.position.z);we(d5,e.eye),le(d5,d5,-1),F3(e,n,this._tmpRayDir),we(this._tmpRayDir.direction,this._tmpRayDir.direction);const c=_e(Math.min(nFe,1/Math.abs(ve(d5,this._tmpRayDir.direction)))*l,sFe,oFe);if(a===No.Horizontal){let h=z0e**r;this._sphere[3]=Pe(i),ge(this._tmpViewDir,e.center,e.eye);const p=Math.min(Pe(this._tmpViewDir),c);let f=p*h;if(h<=1&&f<lq&&(f=lq,h=f/p),Math.abs(p-f)<1e-6)return;const m=Pe(e.center);if(this._sphere[3]!==m){const g=this._sphere[3]+h*(m-this._sphere[3]);e.center=le(h5,e.center,g/m)}le(this._tmpViewDir,this._tmpViewDir,-h),e.eye=me(h5,e.center,this._tmpViewDir),ls(this.view,e,this._constraintOptions),ga(i,e.center)>1e-12&&mle(this._sphere,e,n,this._targetOnSphere)&&Ext(this._sphere,e,i,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let h=z0e**Math.abs(r);const p=r>0?1:-1;ge(this._tmpViewDir,i,e.eye);const f=Pe(this._tmpViewDir),m=this.view._stage.renderView.getMinimalDepthForArea(null,n[0],n[1],this.view.state.camera,Oxt);let g=v(m)?m:c;g=s&&r>0?Math.min(g,f):g,le(this._tmpRayDir.direction,this._tmpRayDir.direction,g),me(i,this._tmpRayDir.origin,this._tmpRayDir.direction);let _=g*h;const b=Math.max(lq,1.01*e.nearFar[0]);if(r>0&&_<b&&(_=b,h=_/g),Math.abs(g-_)<1e-6)return;le(this._tmpRayDir.direction,this._tmpRayDir.direction,p*(1-h)),e.eye=me(h5,e.eye,this._tmpRayDir.direction),e.center=me(h5,e.center,this._tmpRayDir.direction)}N3(this.view,e)}};yV=u([$("esri.views.3d.state.controllers.global.ZoomStepController")],yV);const h5=P(),d5=P(),Mxt=.6,Pxt=4,Ixt=60;let _V=class extends Z0{constructor(){super(...arguments),this._zoomLocation=P(),this._tmpCamera=new Pt,this._tmpRayDir=P(),this._tmpCenter=P(),this._constraintOptions={selection:qi.ALL,interactionType:fr.ZOOM,interactionFactor:null,interactionStartCamera:new Pt,interactionDirection:null,tiltMode:Vo.TUMBLE}}zoomStep(e,r){if(!this.active)return;const i=this.view.state,{interactionStartCamera:n}=this._constraintOptions;n&&(this.animation.finished?n.copyFrom(i.camera):this.animation.cameraAt(1,n)),this._tmpCamera.copyFrom(i.camera);const s=Pp(this.view.state.viewingMode);let o=!1;e>0?(o=this.intersectionHelper.intersectScreenFreePointFallback(r,this._zoomLocation,this.view.map.ground.opacity===0?q2:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:ce(this._zoomLocation,this._tmpCamera.center);const a=Mxt**e;let l=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,r[0],r[1],this.view.state.camera,Ixt);ge(p5,this._tmpCamera.eye,this._zoomLocation),we(p5,p5);const c=_e(Math.min(nFe,1/Math.abs(ve($xt,p5)))*Math.abs(this.view.camera.position.z),sFe,oFe);if(l=v(l)?l:c,l){const h=P();ge(h,this._zoomLocation,this._tmpCamera.eye),(l<Pe(h)||!o)&&(we(h,h),me(this._zoomLocation,this._tmpCamera.eye,le(h,h,l)))}this._updateCamera(this._tmpCamera,a,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:qN}}_updateCamera(e,r,i){ge(this._tmpRayDir,i,e.eye);const n=Pe(this._tmpRayDir);let s=n*r;const o=r<=1,a=Math.max(Pxt,1.01*e.nearFar[0]);s!==0&&(o&&s<a&&(s=a,r=s/n),Math.abs(n-s)<1e-6||(le(this._tmpRayDir,this._tmpRayDir,r),e.eye=ge(V0e,i,this._tmpRayDir),e.center=fs(V0e,e.center,i,1-r),ls(this.view,e,this._constraintOptions)))}};_V=u([$("esri.views.3d.state.controllers.local.ZoomStepController")],_V);const V0e=P(),$xt=ke(0,0,1),p5=P();let Lxt=class extends nn{constructor(e,r){super(!0),this._view=e,this.registerIncoming("double-click",r,i=>this._handleDoubleClick(i))}_handleDoubleClick(e){const r=e.data;if($B(r,"primary")){const i=this._view.state.isGlobal?new yV({view:this._view,mode:"animation"}):new _V({view:this._view,mode:"animation"});this._view.state.switchCameraController(i),i.zoomStep(Math.log(.5)/Math.log(.6),wn(r.x,r.y)),e.stopPropagation()}}};function Dxt(t,e,r){return t===qe.Global?new Fxt(r):new Nxt(e,r)}let Nxt=class{constructor(e,r){this._elevationProvider=e,this._referenceEllipsoid=ii(r),this._unitInMeters=Kl(r,this._referenceEllipsoid.metersPerDegree)}compute(e,r,i,n,s){var T;s||(s={near:0,far:0});let o=e[2]*this._unitInMeters;const a=o,l=o-n,c=(T=this._elevationProvider)==null?void 0:T.visibleElevationBounds;c&&(o=l>=0?a-this._unitInMeters*c.min:this._unitInMeters*c.max-a);const h={x:(i=v(i)?i:new ur({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-i.xmin,y:i.ymax-i.ymin,z:4*Math.max(i.xmax-i.xmin,i.ymax-i.ymin)},p=Math.max(h.x,h.y,h.z);ge(ax,r,e),AE[0]=ax[0]>0?i.xmax:i.xmin,AE[1]=ax[1]>0?i.ymax:i.ymin,AE[2]=ax[2]>0?p/2:-p/2,ge(AE,AE,e),we(ax,ax);const f=1.1*ve(AE,ax)*this._unitInMeters,m=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),g=Math.max(i.xmax-i.xmin,i.ymax-i.ymin),_=g*zxt*this._unitInMeters,b=g*Vxt*this._unitInMeters,w=_e((o-b)/(_-b),0,1)**3,x=Math.min(Bt(m,f,w),m)*Math.max(Math.log(Math.abs(l)),1);return vFe(Math.min(x,Math.max(34064e4,p))/this._unitInMeters,kxt,this._unitInMeters,s)}},Fxt=class{constructor(e){this._referenceEllipsoid=ii(e)}compute(e,r,i,n,s){s||(s={near:0,far:0});const o=Pe(e),a=o-this._referenceEllipsoid.radius,l=this._referenceEllipsoid.radius+Math.min(0,n),c=Math.abs(a-n),h=Math.max(c,Math.abs(a)),p=Math.sqrt(h*(h+2*l)),f=o+this._referenceEllipsoid.radius;return vFe(1.2*Bt(p,f,Tae(h)),_e(2e4-(Math.log(h)-7.983)/9.011*19e3,1e3,2e4),1,s)}};function vFe(t,e,r,i){const n=Uxt/r;return t/e>n?(i.far=t,i.near=i.far/e):(i.near=n,i.far=i.near*e),i}const kxt=2e4,Uxt=2,zxt=.001,Vxt=1e-4,AE=P(),ax=P();let $U=class extends be{constructor(e){super(e)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const r=this.view.state.camera;v(e.spatialReference)&&HNe(this.view,r,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>N3(this.view,e,dp.EYE_AND_CENTER))}};u([d({constructOnly:!0})],$U.prototype,"view",void 0),$U=u([$("esri.views.3d.state.ElevationCollisionConstraint")],$U);let NI=class extends be{constructor(e){super(e),this.nearFarHeuristic=Dxt(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([ne(()=>{var e,r,i,n;return[(r=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:r.near,(n=(i=this.view.constraints)==null?void 0:i.clipDistance)==null?void 0:n.far]},()=>this._clipDistanceNearFarChanged()),ne(()=>{var e,r;return(r=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:r.mode},()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e)),ne(()=>this.view.renderDataExtent,()=>this._updateNearFar(),Zr),ne(()=>{var e,r,i,n;return[(r=(e=this.view.constraints)==null?void 0:e.altitude)==null?void 0:r.min,(n=(i=this.view.constraints)==null?void 0:i.altitude)==null?void 0:n.max]},()=>this._updateAltitude(),Zr),ne(()=>{var e,r;return(r=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:r.max},()=>this._updateTiltMax(),Zr),ne(()=>{var e,r;return(r=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:r.mode},()=>this._updateTilt(),Zr),ne(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this._updateTiltAutoMax(),Zr),ne(()=>{var e,r,i,n,s,o;return[(i=(r=(e=this.view.map)==null?void 0:e.ground)==null?void 0:r.navigationConstraint)==null?void 0:i.type,(o=(s=(n=this.view.state)==null?void 0:n.constraints)==null?void 0:s.collision)==null?void 0:o.enabled]},()=>this._updateCollision(),Zr)]),this.view.state.isLocal&&this.addHandles(ne(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),Vt)),this._updateNearFar(),this.view.state.viewingMode!==qe.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new $U({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){var r;const e=(r=this.view.constraints)==null?void 0:r.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(i=>this._updateCameraNearFarManual(i,e))}_updateNearFar(){this.view.state.updateCamera(e=>this._updateCameraNearFar(e))}_updateCameraNearFar(e){const r=this.view.constraints&&this.view.constraints.clipDistance;(r?r.mode:"auto")==="manual"?this._updateCameraNearFarManual(e,r):this._updateCameraNearFarAuto(e,r)}_updateCameraNearFarAuto(e,r){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,o7(this.view,e.eye),e),r&&r.autoUpdate(e.near,e.far)}_updateCameraNearFarManual(e,r){r&&(e.near=r.near,e.far=r.far)}_updateCollision(){var n,s,o;const e=(o=(s=(n=this.view.map)==null?void 0:n.ground)==null?void 0:s.navigationConstraint)==null?void 0:o.type,r=!e||e==="stay-above",i=this.view.state.constraints.collision;if(r!==i.enabled){i.enabled=r,r&&this._reapplyConstraints(qi.COLLISION);const a=this.view.constraints&&this.view.constraints.tilt;a&&a.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==qe.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const r=this.view.state.constraints;r.tilt=r.createConstantMaxTilt(Xt(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const r=this.view.state.constraints;if(r.tilt){const i=r.tilt(this.view.state.camera.distance).max;e.autoUpdate(dl(i))}}_updateLocalSurfaceDistance(e){if(R(e))return;let r=Math.max(e.width,e.height);if(r<=0)return;e.zmax!=null&&e.zmin!=null&&(r=Math.max(r,e.zmax-e.zmin));const i=this.view.state,n=3*r/Math.atan(i.camera.fov/2);n!==i.constraints.distance&&(i.constraints.distance=n)}_reapplyConstraints(e=qi.ALL){this.view.state.updateCamera(r=>ls(this.view,r,{selection:e,interactionType:fr.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:Vo.TUMBLE}))}};u([d({constructOnly:!0})],NI.prototype,"view",void 0),u([d({readOnly:!0})],NI.prototype,"surfaceCollisionConstraint",void 0),NI=u([$("esri.views.3d.state.ConstraintsManager")],NI);let J1=class{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}constructor(e){this.renderCoordsHelper=e,this.frustum=_D(),this._points=BDe(),this.lines=new Array(12),this._origin=P(),this._direction=P(),this._altitude=null;for(let r=0;r<12;r++)this.lines[r]={origin:null,direction:P(),endpoint:null}}update(e){jDe(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),ce(this._origin,e.eye),ce(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(e){for(let r=0;r<this._points.length;r++)ce(this._points[r],e[r]);GDe(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return bb(this.frustum,e)}intersectsRay(e){return N_t(this.frustum,e)}intersectsLineSegment(e,r){return F_t(this.frustum,e,r)}intersectsPoint(e){return HDe(this.frustum,e)}_updateLines(){const e=this._points;for(let r=0;r<4;r++){const i=r+4;cq(this.lines[r],e[r],e[i]),cq(this.lines[r+4],e[r],r===3?e[0]:e[r+1]),cq(this.lines[r+8],e[i],r===3?e[4]:e[i+1])}}};function cq(t,e,r){t.origin=e,t.endpoint=r,L_(t.direction,e,r)}J1.planePointIndices=k_t,J1.nearFarLineIndices=[[lt.NEAR_BOTTOM_LEFT,lt.FAR_BOTTOM_LEFT],[lt.NEAR_BOTTOM_RIGHT,lt.FAR_BOTTOM_RIGHT],[lt.NEAR_TOP_RIGHT,lt.FAR_TOP_RIGHT],[lt.NEAR_TOP_LEFT,lt.FAR_TOP_LEFT]];let G$=class extends L0{set desiredCamera(e){this._set("desiredCamera",e.clone())}constructor(e){super(e),this._handles=new qr}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=bn.Running,this._handles.add(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this._handles.removeAll()}stepController(){}_handleElevationChangeEvent(e){v(e.spatialReference)&&!HNe(this.view,this.desiredCamera,e.extent,e.spatialReference)||this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),N3(this.view,e,dp.EYE_AND_CENTER)||this.constraintEnabled||(this.state=bn.Stopped)})}};u([d({constructOnly:!0})],G$.prototype,"desiredCamera",null),G$=u([$("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],G$);const Bxt=P(),f5=P();function vle(){return{direction:P(),up:P()}}function bFe(t,e,r,i,n){let s=we(Bxt,t),o=ve(s,i);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(ve(e,i)),o<.99?(ce(s,e),a&&le(s,s,-1)):s=null);let l=0;if(s){le(f5,i,ve(i,s)),ge(s,s,f5);const h=ve(s,n)/(Pe(s)*Pe(n));vt(f5,s,n),l=(ve(f5,i)>0?1:-1)*dl(Js(h))}const c=dl(Js(-ve(i,t)/Pe(t)));return r?(r.heading=l,r.tilt=c,r):{heading:l,tilt:c}}const wFe=ke(0,1,0),xFe=ke(0,0,1),$M=$e(),Fy=P(),ky=P();function TFe(t,e,r,i=vle()){const{direction:n,up:s}=i;return SAe($M,-Xt(e)),xO($M,$M,Xt(r)),Ke(n,xFe,$M),le(n,n,-1),Ke(s,wFe,$M),i}function jxt(t,e,r,i){return bFe(e,r,i,xFe,wFe)}function Gxt(t,e,r,i){const n=TFe(t,r,i),s=P();return le(s,n.direction,-e),me(s,s,t),{up:n.up,eye:s,heading:r,tilt:i}}function Hxt(t){return dl(t)}function qxt(t){return Xt(t)}function SFe(t,e,r,i,n){const s=t.renderSpatialReference,o=t.map&&t.spatialReference||e.spatialReference;return Ba(e,Fy,s),Ba(e,ky,s),Fy[0]-=r/2,ky[0]+=r/2,Fy[1]-=i/2,ky[1]+=i/2,zo(Fy,s,Fy,o),zo(ky,s,ky,o),n?(n.xmin=Fy[0],n.ymin=Fy[1],n.xmax=ky[0],n.ymax=ky[1],n.spatialReference=o):n=new ur(Fy[0],Fy[1],ky[0],ky[1],o),n}const Wxt=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:jxt,eyeForCenterWithHeadingTilt:Gxt,eyeTiltToLookAtTilt:qxt,headingTiltToDirectionUp:TFe,lookAtTiltToEyeTilt:Hxt,toExtent:SFe},Symbol.toStringTag,{value:"Module"})),EFe=ke(0,0,1),CFe=we(P(),ke(1,1,1)),Xxt=new Qb(-180,180),LM=$e(),k1=P(),RE=P();function AFe(t,e,r,i=vle()){vt(k1,t,EFe),ve(k1,k1)===0&&vt(k1,t,CFe),rd(LM,-Xt(e),t),Du(LM,LM,-Xt(r),k1);const{up:n,direction:s}=i;return vt(n,k1,t),we(n,n),Ke(n,n,LM),we(s,t),ul(s,s),Ke(s,s,LM),i}function Yxt(t,e,r,i){const n=k1,s=RE;return we(n,t),vt(RE,n,EFe),ve(RE,RE)===0&&vt(RE,n,CFe),vt(s,RE,n),bFe(e,r,i,n,s)}function Zxt(t,e,r,i){const n={eye:P(),up:null,tilt:i,heading:r},s=k1;s[0]=t[0],s[1]=t[2],s[2]=-t[1];const o=e,a=Xt(r),l=Xt(i),c=Math.sin(a),h=Math.cos(a),p=Math.sin(l),f=Math.cos(l),m=Pe(s);let g;if(Math.abs(l)<1e-8)g=o+m;else{const W=m/p,N=Ep(o/W),L=Math.PI-l-N;g=W*Math.sin(L)}const _=f*o,b=o*o*(p*p),w=h*h*b,x=g-_,T=x*x,E=w*(w+T-s[1]*s[1]);if(E<0)return le(n.eye,s,g/m),n.tilt=0,m5(n,t);const C=Math.sqrt(E),A=s[1]*x,I=w+T;let M;if(M=h>0?-C+A:C+A,Math.abs(I)<1e-8)return m<1e-8?(n.eye[0]=0,n.eye[1]=0,n.eye[2]=o):le(n.eye,s,g/m),n.tilt=0,uq(n.eye),m5(n,t);n.eye[1]=M/I;const D=c*c*b,U=p*o,z=h*U*n.eye[1],B=n.eye[1]*n.eye[1],ee=1-B,te=Math.sqrt(ee),K=w*B+D-2*z*te*x+ee*T;return Math.abs(K)<1e-8?(le(n.eye,s,g/m),n.tilt=0,uq(n.eye),m5(n,t)):(n.eye[0]=(ee*(g*s[0]-_*s[0])-U*te*(s[0]*n.eye[1]*h+s[2]*c))/K,n.eye[2]=(ee*(g*s[2]-_*s[2])-U*te*(s[2]*n.eye[1]*h-s[0]*c))/K,le(n.eye,n.eye,g),uq(n.eye),m5(n,t))}function uq(t){const e=t[1];t[1]=-t[2],t[2]=e}function m5(t,e){const r=AFe(e,t.heading,t.tilt);return t.up=r.up,t}function Jxt(t,e,r){const i=Pe(e),n=Math.sqrt(r*r+i*i-2*r*i*Math.cos(Math.PI-t)),s=Ep(r/(n/Math.sin(t)));return dl(t-s)}function Kxt(t,e,r){const i=Xt(t),n=Pe(e);return Ep(r/(n/Math.sin(i)))+i}function RFe(t,e,r,i,n){let s,o,a,l;const c=e.latitude,h=ii(t.spatialReference).radius,p=e.longitude,f=lbt(c,r,h)/2;s=p-f,o=p+f;const m=Xt(c),g=(1+Math.sin(m))/(1-Math.sin(m)),_=(g+1)*Math.tan(i/h/2),b=_*_;function w(T){const E=Math.PI/2;return(T=iYe.normalize(T,-E))>E&&(T=Math.PI-T),T}if(a=1.5*Math.PI-2*Math.atan(.5*(_+Math.sqrt(4*g+b))),l=a+i/h,a=w(a),l=w(l),l<a){const T=l;l=a,a=T}if(a=Math.max(dl(a),-90),l=Math.min(dl(l),90),o=Xxt.monotonic(s,o),o-s>180){const T=(o-s-180)/2;s+=T,o-=T}const x=t.spatialReference&&t.spatialReference.isGeographic?t.spatialReference:Je.WGS84;return n?(n.xmin=s,n.ymin=a,n.xmax=o,n.ymax=l,n.spatialReference=x):n=new ur(s,a,o,l,x),t.spatialReference&&t.spatialReference.isWebMercator&&Gg(n,!1,n),n}const Qxt=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:Yxt,eyeForCenterWithHeadingTilt:Zxt,eyeTiltToLookAtTilt:Kxt,headingTiltToDirectionUp:AFe,lookAtTiltToEyeTilt:Jxt,toExtent:RFe},Symbol.toStringTag,{value:"Module"}));function vV(t){return t.type==="point"}let OFe=class{constructor(e,r=null,i=0){this.array=e,this.spatialReference=r,this.offset=i}};function MFe(t){return"array"in t}function Fg(t,e,r="ground"){if(vV(e))return t.getElevation(e.x,e.y,e.z||0,e.spatialReference,r);if(MFe(e)){let i=e.offset;return t.getElevation(e.array[i++],e.array[i++],e.array[i]||0,Nt(e.spatialReference,t.spatialReference),r)}return t.getElevation(e[0],e[1],e[2]||0,t.spatialReference,r)}function bV(t,e){return t!=null&&(e==null||(e===qe.Local?!t.isGeographic||t.isWGS84||t.wkid===sp.CGCS2000:t.isWebMercator||t.isWGS84||t.wkid===sp.CGCS2000||t.wkid===sp.GCSMARS2000||t.wkid===sp.GCSMARS2000_SPHERE||t.wkid===sp.GCSMOON2000))}const PFe=re.getLogger("esri.views.3d.support.cameraUtils"),IFe=39.37,$Fe=96,ste=1,eTt=8,tTt=5,LFe=1,B0e=P(),rTt={heading:0,tilt:0},K1=new Ue,iTt=new Qb(-20037508342788905e-9,20037508342788905e-9),nTt=new Qb(-180,180);var Na;function WN(t){return t.spatialReference||Je.WGS84}function k3(t){return t.viewingMode==="global"?Qxt:Wxt}function sTt(t,e,r,i,n){return k3(t).headingTiltToDirectionUp(e,r,i,n)}function R0(t,e){if(R(e))return null;const r=t.renderSpatialReference,i=k3(t).headingTiltToDirectionUp,n=P();if(!Ba(e.position,n,r))return null;const s=i(n,e.heading,e.tilt);le(s.direction,s.direction,t.state.camera.distance),me(s.direction,s.direction,n);const o=H2(t,n,s.direction,s.up);return o.fov=Xt(e.fov),o}(function(t){t[t.LOCKED=0]="LOCKED",t[t.ADJUST=1]="ADJUST"})(Na||(Na={}));const OE=P();function XO(t,e,r){const i=t.renderSpatialReference,n=h7(t,e.eye,e.viewForward,e.up,rTt);let s=WN(t);return zo(e.eye,i,OE,s)||(s=Je.WGS84,zo(e.eye,i,OE,s)),R(r)?new Ap(new Ue(OE,s),n.heading,n.tilt,dl(e.fov)):(r.position.x=OE[0],r.position.y=OE[1],r.position.z=OE[2],r.position.spatialReference=s,r.heading=n.heading,r.tilt=n.tilt,r.fov=dl(e.fov),r)}function ble(t,e,r){const i=t.state.camera,n=i.width/2/i.pixelRatio;return t.renderCoordsHelper.viewingMode===qe.Global&&r!=null&&(e*=Math.cos(Xt(r))),e/=t.renderCoordsHelper.unitInMeters,n/($Fe*IFe/e)/Math.tan(i.fovX/2)}function w2(t,e,r){const i=t.state.camera,n=e*Math.tan(i.fovX/2),s=i.width/2/i.pixelRatio;let o=$Fe*IFe/(s/n);return t.renderCoordsHelper.viewingMode===qe.Global&&r!=null&&(o/=Math.cos(Xt(r))),o*=t.renderCoordsHelper.unitInMeters,o}function DFe(t,e,r,i,n,s){return NFe(t,e,ble(t,r,e.latitude),i,n,s)}function NFe(t,e,r,i,n,s){if(FS(s)){const a=new U3(s.signal);return CD(t,i.heading,i.tilt,e,r,n,a),void a.resolver.promise.then(l=>{const c=xV(t,l,i.fov);if(!R(c))return s.resolver.resolve(c);s.resolver.reject()},l=>s.resolver.reject(l))}const o=CD(t,i.heading,i.tilt,e,r,n);return xV(t,o,i.fov,s)}function h7(t,e,r,i,n){return k3(t).directionToHeadingTilt(e,r,i,n)}function oTt(t,e){return!!(t.basemapTerrain&&t.renderCoordsHelper.fromRenderCoords(e,K1,t.spatialReference)&&t.elevationProvider&&Nt(Fg(t.elevationProvider,K1),0)>(K1.z??0)-LFe)}async function aTt(t,e,r){if(!t.renderCoordsHelper.fromRenderCoords(e,K1,t.spatialReference)||!t.elevationProvider)return!1;const i=K1.z??0,n=await t.elevationProvider.queryElevation(K1.x,K1.y,i,K1.spatialReference,"ground",r);return Nt(n,0)>i-LFe}async function lTt(t,e,r){const i=P();if(e)if(e instanceof Ue){if(Ba(e,i,t.renderSpatialReference),e.z==null&&t.basemapTerrain!=null&&t.elevationProvider!=null){const n=await t.elevationProvider.queryElevation(e.x,e.y,e.z??0,e.spatialReference,"ground",r);return v(n)&&t.renderCoordsHelper.setAltitude(i,n),i}}else ce(i,e);else ce(i,t.state.camera.center);return i}function cTt(t,e){const r=P();if(e&&e instanceof Ue){if(Ba(e,r,t.renderSpatialReference),e.z==null&&t.basemapTerrain!=null&&t.elevationProvider!=null){const i=Fg(t.elevationProvider,e);v(i)&&t.renderCoordsHelper.setAltitude(r,i)}}else ce(r,e||t.state.camera.center);return r}function CD(t,e,r,i,n,s,o){const a=i&&i instanceof Ue?i:null;if(FS(o))return lTt(t,i,o.signal).then(c=>{ote(t,e,r,a,c,n,s,o)},c=>o.resolver.reject(c)),null;const l=cTt(t,i);return ote(t,e,r,a,l,n,s,o)}function ote(t,e,r,i,n,s,o,a){if(R(i)){const p=t.renderSpatialReference;if(i=iw(n,p,WN(t)),R(i))return null}s=Math.max(s,t.state.constraints.minimumPoiDistance);const l=dTt(t,e,r,n,s,o),c=(0,k3(t).eyeForCenterWithHeadingTilt)(n,s,l.heading,l.tilt);if(o===Na.ADJUST&&t.viewingMode==="global"&&r>0){const p=()=>{const m=FFe(t,n,s,fTt(t,s,r,n));return o=r-m<1?Na.LOCKED:Na.ADJUST,ote(t,e,m,i,n,s,o,a)},f=t.map.ground.navigationConstraint;if(!f||f.type==="stay-above"){if(oTt(t,c.eye))return p();if(FS(a))return aTt(t,c.eye,a.signal).then(m=>m?p():(a.resolver.resolve({eye:c.eye,up:c.up,center:On(n),heading:c.heading,tilt:c.tilt}),null)),null}}const h=!a||FS(a)?{center:P(),eye:P(),up:P(),tilt:0,heading:0}:a;return h.eye=c.eye,h.up=c.up,h.center=On(n),h.heading=c.heading,h.tilt=c.tilt,FS(a)&&a.resolver.resolve(h),h}function H$(t,e,r,i,n,s=null){let o,a,l;if(t.state.isGlobal){if(!bV(e.spatialReference,qe.Global))return FS(s)&&s.resolver.reject(),null;const b=new Ue(e.xmin,e.ymin,e.spatialReference),w=new Ue(e.xmax,e.ymax,e.spatialReference),x=e.spatialReference.isGeographic?nTt:iTt;o=new Ue({x:x.center(b.x,w.x),y:(w.y+b.y)/2,z:e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0,spatialReference:e.spatialReference});const T=ii(e.spatialReference),E=abt(o,b,w);a=E.lon,l=E.lat,x.diff(b.x,w.x)>x.range/2&&(a+=T.halfCircumference),a=Math.min(a,T.halfCircumference),l=Math.min(l,T.halfCircumference)}else{const b=Nt(t.renderSpatialReference,e.spatialReference);b.equals(e.spatialReference)||(e=ym(e,b)),a=e.xmax-e.xmin,l=e.ymax-e.ymin;const w=e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0;o=new Ue({x:e.xmin+.5*a,y:e.ymin+.5*l,z:w,spatialReference:b})}const c=e.zmax!=null&&e.zmin!=null?e.zmax-e.zmin:0,h=t.state.camera,p=1/Math.tan(h.fovX/2),f=1/Math.tan(h.fovY/2),m=1/Math.tan(h.fov/2),g=Math.max(.5*a*p,.5*l*f,.5*c*m)/ste;if(FS(s)){const b=new U3(s.signal);return CD(t,r,i,o,g,n,b),void b.resolver.promise.then(w=>{const x=xV(t,w,t.camera.fov);if(!R(x))return s.resolver.resolve(x);s.resolver.reject()},w=>s.resolver.reject(w))}const _=CD(t,r,i,o,g,n);return xV(t,_,t.camera.fov,s)}function uTt(t,e,r){const i=t.renderSpatialReference,n=iw(r,i,WN(t));if(R(n))return null;const s=Math.tan(e.fovX/2),o=Math.tan(e.fovY/2),a=yN(e.eye,r),l=2*a*s*ste,c=2*a*o*ste;return t.viewingMode==="global"?RFe(t,n,l,c):SFe(t,n,l,c)}function hTt(t,e,r){const i=t.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(r/i)/Math.LN2>eTt)return!0;const n=t.renderSpatialReference,s=WN(t),o=iw(e,n,s),a=iw(t.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,n,s);if(R(o)||R(a))return!1;const l=Math.tan(.5*t.state.camera.fov)*i;return a.distance(o)/l>tTt}function dTt(t,e,r,i,n,s){let o=0;return s===Na.ADJUST&&hTt(t,i,n)?(e=0,o=pTt(t,n,r,i)):o=wle(t,i,n,r),o=t.state.constraints.clampTilt(n,o),{heading:e,tilt:r=FFe(t,i,n,o)}}const wV=.7;function pTt(t,e,r,i){const n=wle(t,i,e,r);if(!t.state.constraints.tilt)return n;const s=t.state.constraints.tilt(e);s.max=Math.min(s.max,.5*Math.PI);const o=s.min*(1-wV)+s.max*wV;return Math.min(n,o)}function fTt(t,e,r,i){let n=wle(t,i,e,r);if(!t.state.constraints.tilt)return n;const s=t.state.constraints.tilt(e);return n=Math.min(n,.5*Math.PI),s.min*(1-wV)+n*wV}function FFe(t,e,r,i){return k3(t).lookAtTiltToEyeTilt(i,e,r)}function wle(t,e,r,i){return k3(t).eyeTiltToLookAtTilt(i,e,r)}function xV(t,e,r,i){if(R(e))return null;const n=t.renderSpatialReference,s=iw(e.eye,n,WN(t));return R(s)?null:v(i)?(i.position=s,i.heading=e.heading,i.tilt=e.tilt,i.fov=r,i):new Ap(s,e.heading,e.tilt,r)}function mTt(t,e){var i;const r=(i=t.basemapTerrain)==null?void 0:i.tilingScheme;if(r)return r.levelAtScale(e);PFe.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function kFe(t,e){var i;const r=(i=t.basemapTerrain)==null?void 0:i.tilingScheme;if(r)return r.scaleAtLevel(e);PFe.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function UFe(t,e){return zo(e.center,t.renderSpatialReference,B0e,Je.WGS84),w2(t,e.distance,B0e[1])}let U3=class{constructor(e){this.signal=e,this.resolver=qb()}};function FS(t){return t&&"resolver"in t}const gTt=.66;function zFe(t){return 360-Kne.normalize(t)}function d7(t){return Kne.normalize(360-t)}function DM(t){return v(t)&&t.resolver&&t.resolver.reject(),null}function yTt(t,e){return v(t)&&t.resolver&&t.resolver.resolve(e),e}function VFe(t,e,r,i=null){if(!e)return DM(i);const n=t.spatialReference||Je.WGS84;if(v(e.camera)){const c=D2(e.camera.position,n);if(R(c))return DM(i);const h=e.camera.clone();return h.position=c,yTt(i,h)}if(R(e.targetGeometry))return DM(i);const s=e.get("targetGeometry.spatialReference");if(s&&!Ib(s,n))return DM(i);const o=XO(t,t.state.camera);let a=Na.ADJUST;if(e.rotation!=null&&(o.heading=zFe(e.rotation),a=Na.LOCKED),r!=null&&(o.tilt=r),e.targetGeometry.type==="point"){const c=e.targetGeometry;let h;const p=e.targetGeometry.clone();return h=e.scale!=null?ble(t,e.scale,c.latitude):t.state.camera.distance,NFe(t,p,h,o,a,i)}const l=e.targetGeometry.extent;return l?H$(t,l,o.heading,o.tilt,a,i):DM(i)}function _Tt(t,e,r=null){return R(r)&&(r=new Xn),Sle(t,null,e.clone(),r)}async function vTt(t,e,r){const i=OTt(t,e);if(!i)throw new H("viewpointutils-create:no-target","Missing target for creating viewpoint");const n=new Ap({fov:t.camera.fov}),s=new Xn({camera:n});if(i.target instanceof Xn)return lx(await xTt(t,i.target,i,r,s));if(i.target instanceof Ap)return lx(jFe(t,i.target,s));const o=i.scale!=null||i.zoom!=null;if(i.target instanceof ur){const c=i.target.xmin===i.target.xmax||i.target.ymin===i.target.ymax;return lx(o||c?await ate(t,i,i.target.center,n,r,s):await CTt(t,i,i.target,n,r,s))}const a={boundingBox:ki(),hasZ:!1,screenSpaceObjects:[]},l=o?bTt(t,i):void 0;if(await BFe(t,i.target,l,a),isFinite(a.boundingBox[0])){let c;if(Bf(a.boundingBox,as),$h.x=as[0],$h.y=as[1],$h.z=as[2],$h.spatialReference=t.spatialReference,isFinite($h.z)&&a.hasZ?c=Ine(a.boundingBox):($h.z=void 0,c=hWe(Pne(a.boundingBox,PTt))),o||c)return lx(await ate(t,i,$h,n,r,s));const h=MTt(t,a.screenSpaceObjects);return lx(await RTt(t,i,$h,a.boundingBox,h,n,r,s))}return i.position?lx(STt(t,i,n,s)):lx(await ETt(t,i,n,r,s))}function xle(t,e){return e.scale==null&&e.zoom!=null?kFe(t,e.zoom):e.scale}function bTt(t,e){const r=xle(t,e);return r?Gyt(r):void 0}function Tle(t,e){let r=!1;return e.heading!=null?(t.heading=e.heading,r=!0):e.rotation!=null&&(t.heading=zFe(e.rotation),r=!0),e.tilt!=null&&(t.tilt=e.tilt,r=!0),e.fov!=null&&(t.fov=e.fov),r}function Sle(t,e,r,i){const n=t.spatialReference||Je.WGS84;return e=v(e)?e:R0(t,r),R(e)||(i.targetGeometry=iw(e.center,t.renderSpatialReference,n),i.scale=UFe(t,e),i.rotation=d7(r.heading),i.camera=r),i}function TV(t,e,r){var a,l;const i=()=>new H("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!e)throw i();if(!Ib(e.spatialReference,t.spatialReference))throw new H("viewpointutils:incompatible-spatialreference",`Spatial reference (${e.spatialReference?e.spatialReference.wkid:"unknown"}) is incompatible with the view (${(a=t.spatialReference)==null?void 0:a.wkid})`,{geometry:e});const n=[];if(!e.hasZ&&t.basemapTerrain){let c;switch(e.type){case"point":c=e;break;case"multipoint":case"polyline":c=(l=e.extent)==null?void 0:l.center;break;case"mesh":c=e.origin;break;case"extent":c=e.center;break;case"polygon":c=e.centroid}c&&v(t.basemapTerrain.spatialReference)&&Ib(c,t.basemapTerrain.spatialReference)&&t.elevationProvider?as[2]=Nt(Fg(t.elevationProvider,c),0):as[2]=0}(0,ITt[e.type])(e,c=>{n.push(c[0],c[1],c[2])},as);const s=n.length/3;if(s===0)throw i();const o=new Array(n.length);if($n(n,e.spatialReference,0,o,t.spatialReference,0,s)){e.hasZ&&(r.hasZ=!0);for(let c=0;c<o.length;c+=3)e.hasZ?(as[0]=o[c+0],as[1]=o[c+1],as[2]=o[c+2]):(as[0]=o[c+0],as[1]=o[c+1]),ay(r.boundingBox,as)}}async function wTt(t,e,r,i){const n=await hm(t.whenViewForGraphic(e));if(n.ok===!1||R(n.value)||!("whenGraphicBounds"in n.value))return void TV(t,e.geometry,i);const s=n.value,o=await hm(s.whenGraphicBounds(e,{minDemResolution:r}));if(o.ok===!1)return void TV(t,e.geometry,i);const{screenSpaceObjects:a,boundingBox:l}=o.value;gO(i.boundingBox,l),a&&a.forEach(c=>{i.screenSpaceObjects.push(c)}),isFinite(l[2])&&(i.hasZ=!0)}async function BFe(t,e,r,i){var n;if(Array.isArray(e)&&e.length===2){const s=e[0],o=e[1];if(typeof s=="number"&&typeof o=="number")return $h.x=s,$h.y=o,$h.z=void 0,$h.spatialReference=(n=t.spatialReference)!=null&&n.isGeographic?t.spatialReference:Je.WGS84,void TV(t,$h,i)}e&&typeof e.map=="function"?await ha(e.map(s=>BFe(t,s,r,i))):e instanceof $_?TV(t,e,i):e instanceof Va&&await wTt(t,e,r,i)}async function xTt(t,e,r,i,n){if(v(e.camera))return jFe(t,e.camera,n);n.scale=e.scale,n.rotation=e.rotation,n.targetGeometry=v(e.targetGeometry)?e.targetGeometry.clone():null,n.camera=null,r.heading!=null?n.rotation=d7(r.heading):r.rotation!=null&&(n.rotation=r.rotation);const s=xle(t,r);s!=null&&(n.scale=s);const o=new U3(i);return VFe(t,n,r.tilt,o),n.camera=await o.resolver.promise,n}function jFe(t,e,r){const i=t.spatialReference,n=D2(e.position,i);return R(n)?null:((e=e.clone()).fov=t.camera.fov,e.position=n,Sle(t,null,e,r))}function TTt(t,e,r,i,n,s){const o=t.renderSpatialReference;return Ba(r,y5,o),Ba(e,hq,o),s.targetGeometry=new Ue(e),n.position=new Ue(r),ge(SV,hq,y5),h7(t,y5,SV,i.up,n),s.scale=w2(t,Pi(y5,hq),s.targetGeometry.latitude),s.rotation=d7(n.heading),s.camera=n,s}async function ate(t,e,r,i,n,s){if(R(r))throw new H("createfromcenter","invalid point");s.targetGeometry=r.clone();const o=H2(t);if(e.position)return TTt(t,s.targetGeometry,e.position,o,i,s);if(e.zoomFactor){const l=o.distance/e.zoomFactor,c=le(as,o.viewForward,-l);o.eye=me(as,o.center,c),s.scale=w2(t,l,r.latitude)}XO(t,o,i);const a=Tle(i,e)?Na.LOCKED:Na.ADJUST;if(!e.zoomFactor){const l=xle(t,e);l==null?(Ba(r,as,t.renderSpatialReference),HDe(o.frustum,as)?s.scale=w2(t,Pi(o.eye,as),r.latitude):s.scale=UFe(t,o)):s.scale=l;const c=new U3(n);DFe(t,s.targetGeometry,s.scale,i,a,c),s.camera=await c.resolver.promise}return s}function STt(t,e,r,i){const n=H2(t);return ce(SV,n.viewForward),h7(t,n.eye,SV,n.up,dq),r.position=new Ue(e.position),r.heading=e.heading!=null?e.heading:dq.heading,r.tilt=e.tilt!=null?e.tilt:dq.tilt,Sle(t,null,r,i)}async function ETt(t,e,r,i,n){const s=H2(t);return ate(t,e,iw(s.center,t.renderSpatialReference,t.spatialReference),r,i,n)}async function CTt(t,e,r,i,n,s){s.targetGeometry=r.clone();const o=H2(t);XO(t,o,i);const a=Tle(i,e)?Na.LOCKED:Na.ADJUST,l=new U3(n);return H$(t,r,i.heading,i.tilt,a,l),s.camera=await l.resolver.promise,s}function ATt(t,e,r,i,n){let s=0;r.z!=null?s=r.z:t.basemapTerrain&&t.elevationProvider&&(s=Fg(t.elevationProvider,r)),he(as,r.x,r.y,s),um(t.spatialReference,as,j0e,t.renderSpatialReference),Op(g5,j0e),Xu(g5,g5),ki(NM);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let g=0;g<o.length;g++){const _=o[g];let b=i[_[2]];isFinite(b)||(b=s),he(as,i[_[0]],i[_[1]],b),zo(as,t.spatialReference,as,t.renderSpatialReference),ay(NM,Gl(as,as,g5))}const a=N2(NM),l=Ow(NM),c=F2(NM),h=1/Math.tan(e.fovX/2),p=1/Math.tan(e.fovY/2),f=.5*Math.sqrt(a*a+c*c)*Math.max(p,h)+.5*l,m=.5*l*p+.5*Math.max(a,c);return Math.max(f,m)/n}async function RTt(t,e,r,i,n,s,o,a){a.targetGeometry=r.clone();const l=H2(t),c=ATt(t,l,r,i,n);XO(t,l,s);const h=Tle(s,e)?Na.LOCKED:Na.ADJUST;a.scale=w2(t,c,a.targetGeometry.latitude);const p=new U3(o);return DFe(t,a.targetGeometry,a.scale,s,h,p),a.camera=await p.resolver.promise,a}function OTt(t,e){if(!e||!t.spatialReference)return null;const r={target:void 0};if("declaredClass"in e||Array.isArray(e))r.target=e;else{for(const i in e)r[i]=e[i];e.center&&!r.target&&(r.target=e.center)}return r}function lx(t){return t&&v(t.camera)&&(t.rotation=d7(t.camera.heading)),t}function MTt(t,e){const r=gTt;if(!e.length)return r;let i=Number.NEGATIVE_INFINITY;for(let n=0;n<e.length;n++){const s=e[n].screenSpaceBoundingRect;i=Math.max(i,Math.abs(s[0]),Math.abs(s[1]),Math.abs(s[2]),Math.abs(s[3]))}return r-i/Math.min(t.width,t.height)*2}const as=P(),j0e=$e(),g5=vi(),NM=Ks(),PTt=Kt(),SV=P(),y5=P(),hq=P(),dq={heading:0,tilt:0},$h=new Ue,ITt={point(t,e,r){r[0]=t.x,r[1]=t.y,t.z!=null&&(r[2]=t.z),e(r)},polygon(t,e,r){const i=t.hasZ;for(let n=0;n<t.rings.length;n++){const s=t.rings[n];for(let o=0;o<s.length;o++)r[0]=s[o][0],r[1]=s[o][1],i&&(r[2]=s[o][2]),e(r)}},polyline(t,e,r){const i=t.hasZ;for(let n=0;n<t.paths.length;n++){const s=t.paths[n];for(let o=0;o<s.length;o++)r[0]=s[o][0],r[1]=s[o][1],i&&(r[2]=s[o][2]),e(r)}},multipoint(t,e,r){const i=t.points,n=t.hasZ;for(let s=0;s<i.length;s++)r[0]=i[s][0],r[1]=i[s][1],n&&(r[2]=i[s][2]),e(r)},extent(t,e,r){t.zmin!=null&&t.zmax!=null?(e(he(r,t.xmin,t.ymin,t.zmin)),e(he(r,t.xmax,t.ymin,t.zmin)),e(he(r,t.xmin,t.ymax,t.zmin)),e(he(r,t.xmax,t.ymax,t.zmin)),e(he(r,t.xmin,t.ymin,t.zmax)),e(he(r,t.xmax,t.ymin,t.zmax)),e(he(r,t.xmin,t.ymax,t.zmax)),e(he(r,t.xmax,t.ymax,t.zmax))):(e(he(r,t.xmin,t.ymin,r[2])),e(he(r,t.xmax,t.ymin,r[2])),e(he(r,t.xmin,t.ymax,r[2])),e(he(r,t.xmax,t.ymax,r[2])))},mesh(t,e,r){const i=t.vertexAttributes&&t.vertexAttributes.position;if(i)for(let n=0;n<i.length;n+=3)e(he(r,i[n+0],i[n+1],i[n+2]))}};let $Tt=class{constructor(e,r,i){this.target=e,this.options=r,this.view=i,this.state="pending",this._animationController=null,this._promise=new Promise((n,s)=>{this._resolveCallback=n,this._rejectCallback=s;const o=new AbortController;v(this.options.signal)&&Ua(this.options.signal,()=>{this.abort()}),this._abortController=o,this.waitForReady()})}then(e,r){return this._promise.then(e,r)}catch(e){return this._promise.catch(e)}resolve(e){if(this.state!=="finished")return this.state="finished",this._resolveCallback(e)}reject(e){if(this.state!=="finished")return this.state="finished",this._rejectCallback(e)}abort(e=!1){this._abortController.abort(),this.state==="wait-for-animation-finish"&&!e&&v(this._animationController)&&this.view.state.cameraController===this._animationController&&this._animationController.active&&this._animationController.stopController(),this.reject(Vr())}async waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await tw(()=>this.view.ready,this._abortController.signal)}catch(e){return this.reject(e)}this.createViewPoint()}createViewPoint(){this.state!=="finished"&&(this.state="wait-for-viewpoint",this._animationController=this.options.animate?this._getAnimationController():null,vTt(this.view,this.target,this._abortController.signal).then(e=>{if(this.state==="finished")return;const r=e?this._getCameraFromViewpoint(e):null;if(!R(r))if(this.options.animate){if(R(this._animationController))return;this.startAnimation(r,this._animationController)}else this.view.stateManager.setStateCamera(r.camera,{applyConstraints:!r.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()},e=>{this.reject(e)}))}_getCameraFromViewpoint(e){var s;const r=!!(this.target instanceof Xn&&this.target.camera||this.target instanceof Ap),i=e.camera;if(R(i))return null;if(!this.view.stateManager.isCompatible(i)){const o=i.position,a=o&&o.spatialReference,l=a?a.wkid:"none",c=(s=this.view.spatialReference)==null?void 0:s.wkid;return this.reject(new H("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${l}, view: ${c})`,{camera:i})),null}const n=R0(this.view,i);return R(n)?(this.reject(new H("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:e,camera:n,isFullySpecified:r}}startAnimation(e,r){this.state="wait-for-animation-finish";const i=r.viewAnimation;if(R(i))return void this.reject(new H("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(i.update(e.viewpoint,"running"),!r.active||R(r.viewAnimation)||r.viewAnimation.target!==e.viewpoint||this.view.state.cameraController!==r)return this.abort();let n;e.isFullySpecified?(n=new G$({view:this.view,desiredCamera:e.camera}),N3(this.view,e.camera,dp.EYE_AND_CENTER)):ls(this.view,e.camera),r.begin(e.camera,this.options);const s=()=>{const a=this.view.state.cameraController;n&&(a&&a.active?a instanceof Z0&&v(a.viewAnimation)&&a.viewAnimation.target===e.viewpoint&&(this.view.state.cameraController=n):v(r.viewAnimation)&&r.viewAnimation.target===e.viewpoint&&r.state==="finished"&&(this.view.state.cameraController=n))},o=a=>{if(!R(this.view.state))switch(r.state){case bn.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case bn.Ready:case bn.Rejected:case bn.Running:case bn.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(a)}}};i.when(s,a=>o(a)),r.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let e=null,r=null;const i=this.view.state.cameraController;return i instanceof Z0&&(i.updateStateFromViewAnimation(),i.active&&(e=i,r=e.viewAnimation)),e!=null||(e=new Z0({view:this.view,mode:"animation"}),r=e.viewAnimation,this.view.state.switchCameraController(e))?e:(v(r)&&r.stop(),this.reject(new H("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}},Ds=class extends be{get camera(){const e=this._get("camera");if(!this.ready)return e;const r=XO(this.view,this.view.state.camera,pq);return r&&e&&r.equals(e)?e:r.clone()}set camera(e){var r,i;this._updatePropertyBeforeReady("camera",e)||((r=this.view.elevationProvider)==null||r.enableElevationCache(!0),this.setStateCamera(R0(this.view,e),{applyConstraints:!1})||re.getLogger(this.declaredClass).error("#camera=","Invalid camera",e),(i=this.view.elevationProvider)==null||i.enableElevationCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const r=XO(this.view,this.view.state.contentCamera,pq);return r&&e&&r.equals(e)?e:r.clone()}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const r=R0(this.view,e);R(r)?this.view.state.contentCamera=null:(this._updateElevation(r),this.view.state.contentCamera=r)}installContentCameraReset(e){if(this.removeHandles(fq),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const r=this.zoom,i=this.view.state.camera.distance**2,n=$c(this.view.state.camera.center),s=e.sticky?this.contentCamera.clone():null;return this.addHandles([ne(()=>this.contentCamera,()=>{e.sticky||(this.removeHandles(fq),this.test.contentCameraResetState.clear())}),ne(()=>this.zoom,o=>{o!==void 0&&r!==void 0&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(o-r)/2),Math.abs(o-r)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s))}),ne(()=>this.view.state.camera,o=>{const a=ga(n,o.center);this.test.contentCameraResetState.set("camera.center",a/i),a>i?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s)})],fq),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){var r;this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():re.getLogger(this.declaredClass).error("#center=","Invalid center",e):re.getLogger(this.declaredClass).error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((r=this.view.spatialReference)==null?void 0:r.wkid)+")",e):re.getLogger(this.declaredClass).error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,r=uTt(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return v(r)?r:this._get("extent")}set extent(e){var r;this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||re.getLogger(this.declaredClass).error("#extent=","Invalid extent",e):re.getLogger(this.declaredClass).error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((r=this.view.spatialReference)==null?void 0:r.wkid)+")",e):re.getLogger(this.declaredClass).error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this._propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get hasInitialView(){return!!this.view.get("map.initialViewProperties.viewpoint")}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return w2(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||re.getLogger(this.declaredClass).error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,r=e.padding,i=e.pixelRatio,n=this._get("padding"),s=Math.round(r[yr.TOP]/i),o=Math.round(r[yr.RIGHT]/i),a=Math.round(r[yr.BOTTOM]/i),l=Math.round(r[yr.LEFT]/i);return n!=null&&n.top===s&&n.right===o&&n.bottom===a&&n.left===l?n:{top:s,right:o,bottom:a,left:l}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,_5),this.view.state.updateCamera(r=>r.padding=_5))}_paddingToArray(e,r,i){e?ai(i,e.top||0,e.right||0,e.bottom||0,e.left||0):ai(i,0,0,0,0);for(let n=0;n<4;n++)i[n]=Math.round(i[n]*r)}get screenCenter(){const e=this.padding;return Gs((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?_Tt(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){var r;if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||re.getLogger(this.declaredClass).error("#viewpoint=","Invalid viewpoint",e);else{const i=v(e.camera)?e.camera.position:e.targetGeometry,n=v(i)&&i.spatialReference;re.getLogger(this.declaredClass).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(n?n.wkid:"none")+", view: "+((r=this.view.spatialReference)==null?void 0:r.wkid)+")",e)}else re.getLogger(this.declaredClass).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?mTt(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||e===void 0||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||re.getLogger(this.declaredClass).error("#zoom=","Invalid zoom",e)}get _pixelRatio(){var e;return v(this._devicePixelRatioOverride)?this._devicePixelRatioOverride:this._usePhysicalPixelRendering?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,(e=this.view)==null?void 0:e.qualitySettings.maximumPixelRatio)}get _rasterPixelRatio(){return v(this._devicePixelRatioOverride)?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){var e,r;return((r=(e=this.view)==null?void 0:e._stage)==null?void 0:r.renderer.isFeatureEnabled(ss.PhysicalPixelRendering))??!1}get _usePhysicalPixelRenderingAny(){var r,i;const e=(i=(r=this.view)==null?void 0:r._stage)==null?void 0:i.renderer;return e&&(e.isFeatureEnabled(ss.PhysicalPixelRendering,Mr.IDLE)||e.isFeatureEnabled(ss.PhysicalPixelRendering,Mr.INTERACTING)||e.isFeatureEnabled(ss.PhysicalPixelRendering,Mr.ANIMATING))}constructor(e){super(e),this._propertiesPool=new S_({frustum:J1},this),this._cameraSetByUser=!1,this._gotoOperation=null,this.constraintsManager=null,this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._cameraChangeTime=0,this._updatingIgnoreRenderState=!1,this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:r=>this._devicePixelRatioOverride=r,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},set updatingIgnoreRenderState(r){this.viewStateManager._updatingIgnoreRenderState=r},get updatingIgnoreRenderState(){return this.viewStateManager._updatingIgnoreRenderState||v(this.renderState)}}}initialize(){this._cameraChangeTime=performance.now(),this.addHandles([Yn(()=>this.view.state.events,"before-camera-change",e=>e&&this._updateElevation(e)),ne(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},(e,r)=>this._cameraChangedHandler(e,r),Zr)]),fo(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},e=>this._updateElevation(e),{once:!0,sync:!0}),this.addHandles([v_({prepare:()=>this._prepareFrame()}),ne(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0,this.removeHandles(v5)}),Yn(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit(),this._propertiesPool=ze(this._propertiesPool)}init(){this.constraintsManager=new NI({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(const r of e)this.set(r.name,r.value);if(!this._cameraSetByUser){const r=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent;r&&this.isCompatible(r)?this._setInitialView(r):this.view.state.viewingMode===qe.Local&&this.addHandles(fo(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles(v5),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),v5)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles(v5),this.constraintsManager=ze(this.constraintsManager))}async goTo(e,r){const i={animate:!0,...r};return v(this._gotoOperation)&&this._gotoOperation.abort(i.animate),this._gotoOperation=new $Tt(e,i,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation}debugSetCameraOnContent(){this.setStateCamera(H2(this.view),{applyConstraints:!1})}step(e){const r=this.view.state,i=r==null?void 0:r.cameraController;i&&(r.updateCamera(n=>i.stepController(e,n)),i.steppingFinished&&i.finishController())}_cancelGoToOperation(){v(this._gotoOperation)&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const e=new Set,r=[];for(const{propertyName:i,overrides:n}of DTt){const s=e.has(i),o=this._isOverridden(i);!s&&o&&r.push({name:i,value:this._get(i)}),this._clearOverride(i),(s||o)&&n.forEach(a=>e.add(a))}return r}_setInitialView(e){if(R(e)||this._cameraSetByUser)return;if(e instanceof Ap)return void this.setStateCamera(R0(this.view,e),{applyConstraints:!1});if(e instanceof Xn){if(e.targetGeometry instanceof ur){const s=H$(this.view,e.targetGeometry,0,.5,Na.LOCKED);return void(v(s)&&this.setStateCamera(R0(this.view,s),{applyConstraints:!0}))}const i={applyConstraints:!e.camera},n=this._viewpointToCamera(e);return void this.setStateCamera(n,i)}const r=H$(this.view,e,0,.5,Na.LOCKED);v(r)&&this.setStateCamera(R0(this.view,r),{applyConstraints:!0})}_updatePropertyBeforeReady(e,r){return!this.ready&&(this._override(e,r),r&&LTt.includes(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return!R(e)&&(e instanceof Xn?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof Ap?this.isCompatible(e.position):e.spatialReference&&Ib(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=NTt){return this._cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,r,i=Sv){const{heading:n,tilt:s}=this._getPreservingHeadingTilt(),o=CD(this.view,n,s,e,r,Na.ADJUST);return R(o)?null:(i.copyFrom(this.view.state.camera),i.eye=o.eye,i.center=o.center,i.up=o.up,i)}_centerToCamera(e){const r=this.view.pointsOfInterest.centerOnContent;r.runTask();const i=r.distance;return this._centerPointAtDistanceToCamera(e,i)}_extentToCamera(e){const{heading:r,tilt:i}=this._getPreservingHeadingTilt(),n=H$(this.view,e,r,i,Na.ADJUST,pq);return n?R0(this.view,n):null}_scaleToCamera(e){if(e==null)return null;const r=this.view.pointsOfInterest.centerOnContent;r.runTask();const i=r.renderLocation,n=r.location.latitude;if(n==null)return null;const s=ble(this.view,e,n);return this._centerPointAtDistanceToCamera(i,s)}_zoomToCamera(e){return this._scaleToCamera(kFe(this.view,e))}_viewpointToCamera(e){return R0(this.view,VFe(this.view,e))}setStateCamera(e,r){return!(R(e)||!this.view.state.stopActiveCameraController())&&(this._cameraSetByUser=!0,r.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(i=>{r.positionAndOrientationOnly?(i.eye=e.eye,i.center=e.center,i.up=e.up):i.copyFrom(e),r.applyConstraints&&ls(this.view,i)}),r.applyConstraints||(this.view.state.cameraController=new G$({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:r}=this.view;if(!e||!r)return;this._windowDevicePixelRatio=window.devicePixelRatio;const i=this._pixelRatio,n=Math.round(e.clientWidth*i),s=Math.round(e.clientHeight*i);if(n!==0&&s!==0&&(r.width===n&&r.height===s||(r.width=n,r.height=s),this.view.state)){const o=this.view.state.camera;o.fullWidth===n&&o.fullHeight===s&&o.pixelRatio===i||(Sv.copyFrom(o),Sv.pixelRatio!==i&&(this._paddingToArray(this.padding,i,_5),Sv.padding=_5),Sv.fullWidth=n,Sv.fullHeight=s,Sv.pixelRatio=i,this.view.state.camera=Sv),this._updateViewState()}}_updateElevation(e){var s;const r=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,i=((s=this.view.renderCoordsHelper)==null?void 0:s.getAltitude(e.eye))??0,n=r?o7(this.view,e.eye):0;e.relativeElevation=i-n}_updateViewState(){v(this.test.renderState)?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=Mr.ANIMATING:this.view.interacting?this.view.state.mode=Mr.INTERACTING:(this.view.state.mode===Mr.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<=FTt?this.view.state.mode=Mr.INTERACTING:this.view.state.mode=Mr.IDLE),this.view.state.rasterPixelRatio=this._rasterPixelRatio,this.view.state.contentPixelRatio=Math.min(this._pixelRatio,this.view.qualitySettings.maximumPixelRatio)}_cameraChangedHandler(e,r){e&&r&&e.almostEquals(r)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};u([d({type:Ap,dependsOn:["view.state.camera","ready"]})],Ds.prototype,"camera",null),u([d({type:Ap,dependsOn:["view.state.contentCamera","ready"]})],Ds.prototype,"contentCamera",null),u([d({type:Ue})],Ds.prototype,"center",null),u([d({type:ur})],Ds.prototype,"extent",null),u([d({readOnly:!0})],Ds.prototype,"frustum",null),u([d({readOnly:!0})],Ds.prototype,"hasInitialView",null),u([d({readOnly:!0,type:Boolean})],Ds.prototype,"ready",void 0),u([d({type:Number})],Ds.prototype,"scale",null),u([d()],Ds.prototype,"padding",null),u([d({readOnly:!0})],Ds.prototype,"screenCenter",null),u([d({constructOnly:!0})],Ds.prototype,"view",void 0),u([d({type:Xn})],Ds.prototype,"viewpoint",null),u([d({type:Number})],Ds.prototype,"zoom",null),u([d({readOnly:!0})],Ds.prototype,"_pixelRatio",null),u([d({readOnly:!0})],Ds.prototype,"_rasterPixelRatio",null),u([d({readOnly:!0})],Ds.prototype,"_usePhysicalPixelRendering",null),u([d({readOnly:!0})],Ds.prototype,"_usePhysicalPixelRenderingAny",null),u([d()],Ds.prototype,"_windowDevicePixelRatio",void 0),u([d()],Ds.prototype,"_devicePixelRatioOverride",void 0),Ds=u([$("esri.views.3d.state.ViewStateManager")],Ds);const LTt=["camera","viewpoint","extent","scale","center","zoom"],DTt=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],NTt={heading:0,tilt:0},pq=new Ap,Sv=new Pt,_5=pr(),v5="pending-initial-view",fq="content-camera-reset",FTt=300,G0e=100;let kg=class extends L0{constructor(){super(...arguments),this.startCamera=new Pt,this.currentCamera=new Pt,this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<G0e}stepController(e,r){r.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(r)}onControllerStart(e){this.state=bn.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=performance.now(),setTimeout(()=>this.notifyChange("isInteractive"),G0e),this.view.state.updateCamera(e=>this.stepController(0,e)),this.steppingFinished&&this.finishController()}};u([d({readOnly:!0})],kg.prototype,"isInteractive",null),u([d()],kg.prototype,"_lastInteraction",void 0),kg=u([$("esri.views.3d.state.controllers.InteractiveController")],kg);var Eu;(function(t){t[t.CENTER=0]="CENTER",t[t.EYE=1]="EYE"})(Eu||(Eu={}));let q$=class extends kg{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.pivot=Eu.CENTER,this._rotScale=0,this._lastPoint=Ne(),this._tmpWorldUp=P(),this._tmpViewDir=P(),this._tmpRotCurPoint=Ne(),this._tmpTransf=$e(),this._tmpAxis=P(),this._tmpPivotPoint=P(),this._pivotPos=P(),this._constraintOptions={selection:qi.ALL,interactionType:fr.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Vo.TUMBLE}}initialize(){this._rotScale=this.pivot===Eu.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case Eu.EYE:ce(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=fr.LOOK_AROUND,this._constraintOptions.tiltMode=Vo.LOOK_AROUND,this._constraintOptions.selection=qi.NONE;break;case Eu.CENTER:{const r=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,this.view.map.ground.opacity===0?q2:{});r||ce(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(e,r),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=fr.TUMBLE,this._constraintOptions.tiltMode=Vo.TUMBLE,this._constraintOptions.selection=qi.ALL&~qi.DISTANCE;break}}this._constraintOptions.interactionStartCamera=this.startCamera,NS(this.startCamera,e,this._lastPoint)}}_constrainPivotPoint(e,r){const i=this.startCamera,n=P();ge(n,this._pivotPos,i.eye);const s=Pe(n),o=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(i.eye,H0e);let a=Math.max(Math.min(bxt,1/Math.abs(ve(H0e,i.viewForward)))*o,wxt);r&&(a=Math.min(s,a));const l=ii(this.view.spatialReference),c=wn(i.width/i.pixelRatio*.5,i.height/i.pixelRatio*.5),h=u7(this.startCamera,c,l);let p=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,i.fullWidth/i.pixelRatio*.5,i.fullHeight/i.pixelRatio*.5,i,2.5*sq,sq),f=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],i,sq);(v(p)||v(f))&&(p=Nt(p,f),f=R(f)||h===No.Horizontal?p:f,a=p>f?f:p,a=r?Math.min(a,s):a),we(n,n),ce(this._pivotPos,me(this._tmpPivotPoint,i.eye,le(this._tmpPivotPoint,n,a)))}update(e){if(this.active){switch(this.pivot){case Eu.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this._pivotPos);break;case Eu.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this._pivotPos)}ls(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.active&&this.finishController()}_applyRotation(e,r,i,n){this.view.renderCoordsHelper.worldUpAtPosition(n,this._tmpWorldUp),NS(e,r,this._tmpRotCurPoint);let s=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,o=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;ge(this._tmpViewDir,i,n);const a=Pe(this._tmpViewDir),l=Js(ve(this._tmpViewDir,this._tmpWorldUp)/a);if(this.pivot===Eu.EYE){s*=-.5;const c=.5*Math.PI-l,h=.5*Math.PI*.99;s=c-Math.max(-h,Math.min(h,c+s))}return s=_e(s+l,Ma.min,Ma.max)-l,vt(this._tmpAxis,e.up,this._tmpViewDir),this.pivot===Eu.CENTER&&(o=-o),rd(this._tmpTransf,o,this._tmpWorldUp),Du(this._tmpTransf,this._tmpTransf,s,this._tmpAxis),Ke(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),e.up=Ke(mq,e.up,this._tmpTransf),me(mq,n,this._tmpViewDir),Qs(this._lastPoint,this._tmpRotCurPoint),mq}};u([d()],q$.prototype,"pivot",void 0),q$=u([$("esri.views.3d.state.controllers.RotateController")],q$);const mq=P(),H0e=P();let gq=class extends nn{constructor(e,r,i,n){super(!0),this._view=e,this.pointerAction=r,this._pivot=i,this.registerIncoming("drag",n,s=>this._handleDrag(s))}_handleDrag(e){const r=e.data;if(r.pointers.size>1||!Goe(e.data,this.pointerAction))return;const i=wn(r.center.x,r.center.y);switch(r.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new q$({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":this._cameraController&&this._cameraController.update(i);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}},lte=class extends kg{constructor(){super(...arguments),this._pickPoint=P(),this._tmpP0=Ne(),this._panAxisAngle=l7(),this._tmpRayDir=P(),this._tmpRayDirPick=P(),this._targetOnSphere=P(),this._navMode=No.Horizontal,this._tmpRay={origin:P(),direction:P()},this.dragBeginPoint=wn(),this._normalizedAnchorPoint=Ne(),this._constraintOptions={selection:qi.ALL_EXCEPT_COLLISION,interactionType:fr.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Vo.TUMBLE},this._sphere=Os(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;Qs(this.dragBeginPoint,e),NS(this.startCamera,e,this._normalizedAnchorPoint);const r=ii(this.view.spatialReference),i=hFe(this._intersectionHelper,this.startCamera,e,r,WO.Ellipsoid,this.view.map.ground.opacity===0?q2:{});if(this._navMode=u7(this.startCamera,e,r),this._navMode===No.Horizontal)this._hasPickPoint=!!i.scenePickPoint,this._pickPoint=Nt(i.scenePickPoint,this._pickPoint),this._sphere=i.sphere;else{let n;F3(this.startCamera,e,this._tmpRay),we(this._tmpRay.direction,this._tmpRay.direction),v(i.scenePickPoint)&&(ge(this._tmpRayDirPick,this.startCamera.eye,i.scenePickPoint),n=Pe(this._tmpRayDirPick));const s=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,q0e);let o=_e(Math.min(iFe,1/Math.abs(ve(q0e,this._tmpRay.direction)))*s,pV[0],pV[1]);const a=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,c7);o=v(a)?a:o,o=n!=null?Math.min(o,n):o,this._hasPickPoint=!0,le(this._tmpRay.direction,this._tmpRay.direction,o),me(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navMode===No.Horizontal){ge(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const r=Pe(this._tmpRayDir);NS(this.currentCamera,e,this._tmpP0);const i=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let n=r*2**i;const s=this.view.state.constraints.minimumPoiDistance;if(i<0&&n<s&&(n=s),Math.abs(r-n)<1e-6)return;if(this._hasPickPoint&&n<r){const o=1-(1-n/r)*(1-this._sphere[3]/Pe(this.currentCamera.center));this.currentCamera.center=le(b5,this.currentCamera.center,o)}le(this._tmpRayDir,this._tmpRayDir,-n/r),this.currentCamera.eye=me(b5,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=kf(uy(this.dragBeginPoint,e)),ls(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(ED(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),ple(this._pickPoint,this._targetOnSphere,this._panAxisAngle),yw(this.currentCamera,this._sphere,this._panAxisAngle))}else{const r=Pe(this._tmpRay.direction);NS(this.currentCamera,e,this._tmpP0);const i=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let n=r*2**i;const s=this.view.state.constraints.minimumPoiDistance;if(i<0&&n<s&&(n=s),Math.abs(r-n)<1e-6)return;le(this._tmpRayDir,this._tmpRay.direction,1-n/r),this.currentCamera.eye=me(b5,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=me(b5,this.currentCamera.center,this._tmpRayDir)}N3(this.view,this.currentCamera),this.commitCamera()}}end(){this.active&&this.finishController()}};lte=u([$("esri.views.3d.state.controllers.global.ZoomController")],lte);const b5=P(),q0e=P();let cte=class extends kg{constructor(){super(...arguments),this._tmpP=P(),this._tmpDir=P(),this._tmpN=P(),this._tmpP0=Ne(),this._tmpPoi=P(),this._tmpRayDir=P(),this.dragBeginPoint=wn(),this._normalizedAnchorPoint=Ne(),this._constraintOptions={selection:qi.ALL,interactionType:fr.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:P(),tiltMode:Vo.TUMBLE},this._plane=Yr()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;Qs(this.dragBeginPoint,e),NS(this.startCamera,e,this._normalizedAnchorPoint);const r=this._intersectionHelper.intersectScreenFreePointFallback(e,this._tmpP,this.view.map.ground.opacity===0?q2:{});ge(this._tmpDir,this._tmpP,this.startCamera.eye);const i=Pe(this._tmpDir);we(this._tmpDir,this._tmpDir);const n=Math.abs(this.view.camera.position.z);let s=_e(Math.min(iFe,1/Math.abs(ve(kTt,this._tmpDir)))*n,pV[0],pV[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],this.view.state.camera,c7);s=v(o)?o:s,s=r?Math.min(s,i):s,le(this._tmpDir,this._tmpDir,s),me(this._tmpP,this.startCamera.eye,this._tmpDir),ge(this._tmpN,this.startCamera.eye,this.startCamera.center),we(this._tmpN,this._tmpN),this._tmpN[1]<0&&ul(this._tmpN,this._tmpN),UN(this._tmpP,this._tmpN,this._plane),this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(!this.active)return;xxt(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||ce(this._tmpPoi,this.currentCamera.center),NS(this.currentCamera,e,this._tmpP0);let r=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);Qs(this._normalizedAnchorPoint,this._tmpP0),ge(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const i=Pe(this._tmpRayDir);let n=i*(1-r);this._constraintOptions.interactionDirection&&(ce(this._constraintOptions.interactionDirection,this._tmpRayDir),le(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(r)/i));const s=this.view.state.constraints.minimumPoiDistance;r>=0&&n<s&&(n=s,r=-(n-i)/i),Math.abs(i-n)<1e-6||(le(this._tmpRayDir,this._tmpRayDir,r),this.currentCamera.eye=me(cx,this.currentCamera.eye,this._tmpRayDir),fs(cx,this.currentCamera.center,this._tmpPoi,r),this._tmpPoi[2]>this.startCamera.center[2]?cx[2]=Math.max(this.startCamera.center[2],cx[2]):cx[2]=Math.min(this.startCamera.center[2],cx[2]),this.currentCamera.center=cx,this._constraintOptions.interactionFactor=kf(uy(this.dragBeginPoint,e)),ls(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}end(){this.active&&this.finishController()}};cte=u([$("esri.views.3d.state.controllers.local.ZoomController")],cte);const cx=P(),kTt=ke(0,0,1);let UTt=class extends nn{constructor(e,r,i){super(!0),this._view=e,this.pointerAction=r,this.registerIncoming("drag",i,n=>this._handleDrag(n))}_handleDrag(e){const r=e.data;if(r.pointers.size>1||!Goe(e.data,this.pointerAction))return;const i=wn(r.center.x,r.center.y);switch(r.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._view.state.isGlobal?this._cameraController=new lte({view:this._view}):this._cameraController=new cte({view:this._view}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":this._cameraController&&this._cameraController.update(i);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}},bS=class extends kg{constructor(e){super(e),this._filteredSurfaceElevation=0,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new Pt,this._headingStart=0,this._constraintOptions={selection:qi.ALL,interactionType:fr.NONE,interactionStartCamera:new Pt,interactionFactor:0,interactionDirection:null,tiltMode:Vo.LOOK_AROUND}}handleEventGamepad(e){const r=xQ(e,this.view.navigation.gamepad,this._transformation);(e.action==="end"||lU(r))&&this.finishController()}activateDirection(e){this._keysButtonState[e]=1,cge(this._keysButtonState,this._transformation)}deactivateDirection(e){this._keysButtonState[e]=0;const r=cge(this._keysButtonState,this._transformation);lU(r)&&this.finishController()}onControllerStart(e){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const r=this.view.pointsOfInterest.cameraOnSurface.location.z,i=1;this._filteredSurfaceElevation+=i*(r-this._filteredSurfaceElevation)*e}stepController(e,r){var i;this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(r),this._updateCameraCenter(),(i=this._constraintOptions.interactionStartCamera)==null||i.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,ux),this._applyDisabledMovementTypes(ux),this._applyPan(ux.pan),this._applyRotate(ux.rotate),this._applyZoom(ux.zoom),this._applyAscend(ux.ascend),this._constraintOptions.interactionType=fr.NONE,this._constraintOptions.selection=qi.COLLISION,ls(this.view,this.currentCamera,this._constraintOptions),super.stepController(e,r)}_updateStartHeading(){this._transformation.heading!==0&&(this._headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const r=this.currentCamera;ge(lc,r.center,r.eye),Ke(lc,lc,e.matrix),r.center=me(lc,lc,r.eye),r.up=Ke(lc,r.up,e.matrix),this._constraintOptions.interactionType=fr.LOOK_AROUND,this._constraintOptions.selection=qi.ALL_EXCEPT_COLLISION,ls(this.view,r,this._constraintOptions)}_applyPan(e,r=this.currentCamera){e.enabled&&(r.eye=Ke(lc,r.eye,e.matrix),r.center=Ke(lc,r.center,e.matrix),this.view.state.isGlobal&&(r.up=Ke(lc,r.up,e.matrix)),this._constraintOptions.interactionType=fr.PAN,this._constraintOptions.selection=qi.ALL,ls(this.view,r,this._constraintOptions))}_applyZoom(e){if(!e)return;const r=this.currentCamera.viewForward;this.currentCamera.eye=me(lc,this.currentCamera.eye,le(Ye.get(),r,e)),ce(FM,r),ul(FM,FM),this._constraintOptions.interactionDirection=FM,this._constraintOptions.interactionType=fr.ZOOM,this._constraintOptions.selection=qi.ALL_EXCEPT_COLLISION,ls(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const r=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,Ye.get());if(this._constraintOptions.interactionDirection=ce(FM,r),this.view.state.isGlobal){const i=Pe(this.currentCamera.eye),n=(i+e)/i;this.currentCamera.eye=le(lc,this.currentCamera.eye,n),this.currentCamera.center=le(lc,this.currentCamera.center,n)}else{const i=le(Ye.get(),r,e);this.currentCamera.eye=me(lc,this.currentCamera.eye,i),this.currentCamera.center=me(lc,this.currentCamera.center,i)}this._updateCameraCenter(),this._constraintOptions.interactionType=fr.ASCEND,this._constraintOptions.selection=qi.COLLISION,ls(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=qi.ALL_EXCEPT_COLLISION,ls(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(e,r,i){qTt(i);const n=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(n,r,i):this._calculateControlTransformationGlobal(n,r,i)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,r=this.view.renderCoordsHelper,i=this.currentCamera.ray;this.currentCamera.center=r.intersectManifoldClosestSilhouette(i,e,lc)}_calculateControlTransformationLocal(e,r,i){const{viewRight:n,viewForward:s}=r,o=this._transformation,a=this.view.navigation.gamepad,l=he(Ye.get(),s[0],s[1],0);we(l,l);const c=o.translation[0]*e.pan;if(c!==0){const _=le(Ye.get(),n,c);Hc(i.pan.matrix,i.pan.matrix,_),i.pan.enabled=!0}switch(a.mode){case"pan":{const _=-o.translation[1]*e.pan;if(_!==0){const b=le(Ye.get(),l,_);Hc(i.pan.matrix,i.pan.matrix,b),i.pan.enabled=!0}i.zoom=o.zoom*e.zoom;break}case"zoom":i.zoom=(-o.translation[1]+o.zoom)*e.zoom;break;default:a.mode}const h=o.translation[2]*e.ascend;i.ascend=h;const p=-o.heading*e.rotate;p!==0&&(Du(i.rotate.matrix,i.rotate.matrix,p,this.view.renderCoordsHelper.worldUpAtPosition(r.eye,Ye.get())),i.rotate.enabled=!0);const f=o.tilt*e.rotate,m=gw(this.view.renderCoordsHelper,r.center,r.eye),g=_e(m+f,Ma.min,Ma.max)-m;g&&(Du(i.rotate.matrix,i.rotate.matrix,g,n),i.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,r,i){const{eye:n,viewRight:s}=r,o=this._transformation,a=this.view.navigation.gamepad,l=vt(Ye.get(),s,n);we(l,l),ul(l,l),Rxt(this.startCamera,r,o,e,this.view.camera.heading,this._headingStart,this.view.camera.tilt,i,a),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(ux.pan,this._tmpCamera);const c=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,h=o.translation[2]*e.ascend;i.ascend=h;const p=-o.heading*e.rotate;p!==0&&(Du(i.rotate.matrix,i.rotate.matrix,p,this._tmpCamera.eye),i.rotate.enabled=!0);const f=o.tilt*e.rotate,m=this._clampTiltDeltaGlobalToValidRange(f,r.ray,c);m!==0&&(Du(i.rotate.matrix,i.rotate.matrix,m,this._tmpCamera.viewRight),i.rotate.enabled=!0),i.zoom+=o.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,r,i){const n=ii(this.view.spatialReference),s=IU(Ma.min,r.origin,i,n);let o=0,a=0;const l=Ye.get();if(this.view.renderCoordsHelper.intersectManifold(r,i,l)){const c=gw(this.view.renderCoordsHelper,l,r.origin);o=IU(c,r.origin,i,n),a=IU(Ma.max,r.origin,i,n)}else{I3(NB(FB,i+n.radius),r,l);const c=Js(-ve(r.direction,we(l,l)));o=M0e(c,r.origin,i,n),a=M0e(Ma.max,r.origin,i,n)}return _e(o+e,s,a)-o}_getPointAbsoluteSurfaceElevation(e,r,i){const{renderCoordsHelper:n}=this.view,s=n.getAltitude(e),o=r+Math.abs(s-r);return n.setAltitude(i,o,e),o}_clampedDistanceToSurface(e,r){const{renderCoordsHelper:i}=this.view,{camera:n}=this.view.state,{direction:s}=sTt(this.view,r,0,GFe,HTt),o=i.intersectManifoldClosestSilhouette(nd(r,s),e,Ye.get()),a=Pi(r,o),l=i.intersectManifoldClosestSilhouette(nd(r,L_(Ye.get(),r,n.center)),e,Ye.get()),c=Pi(r,l);return Math.min(a,c)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:r,state:i}=this.view,{camera:n,isGlobal:s}=i,o=r.intersectManifoldClosestSilhouette(n.ray,this._filteredSurfaceElevation,Ye.get());if(s){const a=ge(Ye.get(),e,o),l=Pe(a);le(a,a,1/l);const c=we(Ye.get(),e),h=Js(ve(c,a));return l*Math.sin(Math.min(VTt,h))}{const a=ce(Ye.get(),e);return r.setAltitude(a,this._filteredSurfaceElevation),Pi(o,a)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:BTt}_computeVelocities(e){const r=this._filteredSurfaceElevation,i=r+ii(this.view.spatialReference).radius,{camera:n,isGlobal:s}=this.view.state,o=Ye.get(),a=this._getPointAbsoluteSurfaceElevation(n.eye,r,o),l=this._clampedDistanceToSurface(r,o),c=n.width/2,h=W0e*n.width,p=W0e*n.width,f=l*Math.tan(.5*n.fovX)/c,m=f/i,g=f/this._computeHeadingRotateRadius(o),_=a-r;return{pan:(s?m:f)*h*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(h*e/c)*_-_),zoom:2**(h*e/c)*l-l,rotate:_e(g*p,jTt,GTt)*e}}_applyDisabledMovementTypes(e){!v(this.disableMovements)||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&Rp(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&Rp(e.rotate.matrix))}static activatesFor(e,r){const i=xQ(r,e.navigation.gamepad,zTt);return!(r.action==="end"||lU(i))}};u([d({constructOnly:!0})],bS.prototype,"gamepadDevice",void 0),u([d({constructOnly:!0})],bS.prototype,"disableMovements",void 0),bS=u([$("esri.views.3d.state.controllers.GamepadKeyboardController")],bS);const zTt={translation:[0,0,0],heading:0,tilt:0,zoom:0},GFe=80,VTt=Xt(GFe),W0e=.75,BTt=5,jTt=Xt(30),GTt=Xt(80),ux={zoom:0,ascend:0,pan:{enabled:!1,matrix:$e()},rotate:{enabled:!1,matrix:$e()}},lc=P(),FM=P(),HTt=vle();function qTt(t){t.zoom=0,t.ascend=0,t.pan.enabled=!1,Rp(t.pan.matrix),t.rotate.enabled=!1,Rp(t.rotate.matrix)}let WTt=class extends nn{constructor(e){super(!0),this._view=e,this._watchHandles=new qr,this._handle=this.registerIncoming("gamepad",r=>this._handleEventGamepad(r)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([ne(()=>this._view.navigation.gamepad.enabled,r=>{r?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},Vt),ne(()=>this._view.navigation.gamepad.device,r=>{this._cameraControllerGamepad&&r&&this._cameraControllerGamepad.gamepadDevice!==r&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(e){const r=this._view.navigation.gamepad.device;if(r&&e.data.device!==r)return;const i=this._cameraControllerGamepad&&this._cameraControllerGamepad.active;if(i||bS.activatesFor(this._view,e.data)){if(!i){const n=new bS({view:this._view,gamepadDevice:e.data.device});this._view.state.switchCameraController(n)&&(this._cameraControllerGamepad=n)}this._cameraControllerGamepad&&this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===e.data.device&&this._cameraControllerGamepad.handleEventGamepad(e.data)}}};var bu;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.FORWARD=2]="FORWARD",t[t.BACKWARD=3]="BACKWARD",t[t.UP=4]="UP",t[t.DOWN=5]="DOWN",t[t.HEADINGLEFT=6]="HEADINGLEFT",t[t.HEADINGRIGHT=7]="HEADINGRIGHT",t[t.TILTUP=8]="TILTUP",t[t.TILTDOWN=9]="TILTDOWN",t[t.ZOOMIN=10]="ZOOMIN",t[t.ZOOMOUT=11]="ZOOMOUT"})(bu||(bu={}));let XTt=class extends nn{constructor(e,r){super(!0),this._view=e,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:qe.Local},this._keyToNumber={[r.left]:bu.LEFT,[r.right]:bu.RIGHT,[r.forward]:bu.FORWARD,[r.backward]:bu.BACKWARD,[r.up]:bu.UP,[r.down]:bu.DOWN,[r.headingLeft]:bu.HEADINGLEFT,[r.headingRight]:bu.HEADINGRIGHT,[r.tiltUp]:bu.TILTUP,[r.tiltDown]:bu.TILTDOWN,[r.zoomIn]:bu.ZOOMIN,[r.zoomOut]:bu.ZOOMOUT},this.registerIncoming("key-down",null,i=>this._handleKeyDown(i)),this.registerIncoming("key-up",null,i=>this._handleKeyUp(i)),this.registerIncoming("blur",null,()=>this._handleBlur())}_handleKeyDown(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const r=this._keyToNumber[e.data.key];r!=null&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||(this._cameraControllerKeyboard=new bS({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(r),e.stopPropagation()))}_handleBlur(){this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const r=this._keyToNumber[e.data.key];r!=null&&this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.deactivateDirection(r),e.stopPropagation())}},YTt=class extends nn{constructor(e,r){super(!0),this._view=e,this.registerIncoming("mouse-wheel",r,i=>this._handleMouseWheel(i))}_handleMouseWheel(e){if(!this._view.navigation.mouseWheelZoomEnabled)return;const r=e.data;this._cameraController&&this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new yV({view:this._view,mode:"interaction"}):new _V({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._cameraController)),this._cameraController.zoomStep(-1/60*r.deltaY,wn(r.x,r.y)),e.preventDefault(),e.stopPropagation()}},EV=class{constructor(e){this._gain=e}reset(e){this._value=e}set gain(e){this._gain=e}get value(){return this._value===void 0?0:this._value}update(e){this._value===void 0?this._value=e:this._value=this._gain*e+(1-this._gain)*this._value}},x2=class extends TD{constructor(){super(...arguments),this._beginCamera=new Pt,this._elapsedTimeSec=0,this.constraintOptions={selection:qi.ALL,interactionType:fr.PAN,interactionFactor:0,interactionStartCamera:new Pt,interactionDirection:null,tiltMode:Vo.TUMBLE}}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new E_}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(e){this._beginCamera.copyFrom(e),this.constraintOptions.interactionStartCamera=this._beginCamera,super.onControllerStart(e)}stepController(e,r){r.copyViewFrom(this._beginCamera),this._elapsedTimeSec+=e,this.momentumStep(this._elapsedTimeSec,r),ls(this.view,r,this.constraintOptions)}};x2=u([$("esri.views.3d.state.controllers.momentum.MomentumController")],x2);let W$=class extends x2{constructor(e){super(e),this.interactionType=fr.PAN,this._tmpPan=P()}momentumStep(e,r){const i=this.momentum.value(e);le(this._tmpPan,this.momentum.direction,i),r.eye=ge(X0e,r.eye,this._tmpPan),r.center=ge(X0e,r.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};u([d({constructOnly:!0})],W$.prototype,"momentum",void 0),W$=u([$("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],W$);const X0e=P(),ZTt=P(),w5=P();let LU=class extends x2{constructor(e){super(e),this.interactionType=fr.PAN}momentumStep(e,r){const i=this.momentum.value1(e),n=this.momentum.value2(e);ce(w5,r.eye),we(w5,w5),vt(this.momentum.axis2,w5,this.momentum.axis1),mFe(r,ZTt,this.momentum.axis1,i,this.momentum.axis2,n)}};u([d({constructOnly:!0})],LU.prototype,"momentum",void 0),LU=u([$("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],LU);let eS=class extends x2{set center(e){this._set("center",On(e))}set axis(e){this._set("axis",On(e))}constructor(e){super(e),this.interactionType=fr.TUMBLE}momentumStep(e,r){const i=this.momentum.value(e);yw(r,this.center,SD(this.axis,i))}};u([d({constructOnly:!0})],eS.prototype,"momentum",void 0),u([d({constructOnly:!0})],eS.prototype,"center",null),u([d({constructOnly:!0})],eS.prototype,"axis",null),eS=u([$("esri.views.3d.state.controllers.momentum.MomentumController")],eS);let sR=class extends x2{set zoomCenter(e){this._set("zoomCenter",On(e))}constructor(e){super(e),this.interactionType=fr.ZOOM,this.constraintOptions.interactionDirection=P()}momentumStep(e,r){const{interactionDirection:i}=this.constraintOptions;if(!i)return;ce(i,r.eye);const n=this.momentum.valueDelta(0,e);gle(r,this.zoomCenter,n,this.view.state.constraints.minimumPoiDistance),L_(i,r.eye,i)}};u([d({constructOnly:!0})],sR.prototype,"momentum",void 0),u([d({constructOnly:!0})],sR.prototype,"zoomCenter",null),sR=u([$("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],sR);let AT=class extends x2{set screenCenter(e){this._set("screenCenter",wn(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",On(e))}constructor(e){super(e),this.interactionType=fr.ZOOM,this.radius=0,this._tmpSceneCenter=P(),this._tmpZoomAxisAngle=l7(),this._sphere=Os()}initialize(){this._sphere[3]=this.radius}momentumStep(e,r){const i=this.momentum.valueDelta(0,e);cFe(this._sphere,r,i),this.constraintOptions.interactionType=fr.ZOOM,ls(this.view,r,this.constraintOptions),ED(this._sphere,r,this.screenCenter,this._tmpSceneCenter),ple(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),yw(r,this._sphere,this._tmpZoomAxisAngle),this.constraintOptions.interactionType=fr.PAN}};u([d({constructOnly:!0})],AT.prototype,"momentum",void 0),u([d({constructOnly:!0})],AT.prototype,"screenCenter",null),u([d({constructOnly:!0})],AT.prototype,"sceneCenter",null),u([d({constructOnly:!0})],AT.prototype,"radius",void 0),AT=u([$("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],AT);let Uf=class{constructor(e){this._gain=e,this.lastValue=void 0,this.filteredDelta=void 0}update(e){if(this.hasLastValue()){const r=this.computeDelta(e);this._updateDelta(r)}this.lastValue=e}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return this.lastValue!==void 0}hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(e){return this.lastValue===void 0?NaN:e-this.lastValue}_updateDelta(e){this.filteredDelta!==void 0?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*e:this.filteredDelta=e}},p7=class{constructor(e,r,i){this._initialVelocity=e,this._stopVelocity=r,this._friction=i,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(e){return e>this.duration}get friction(){return this._friction}value(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}valueDelta(e,r){const i=this.value(e);return this.value(e+r)-i}valueFromInitialVelocity(e,r){r=Math.min(r,this.duration);const i=1-this.friction;return e*(i**r-1)/Math.log(i)}},JTt=class extends p7{constructor(e,r,i,n,s){super(e,r,i),this._sceneVelocity=n,this.direction=s}value(e){return super.valueFromInitialVelocity(this._sceneVelocity,e)}},HFe=class{constructor(e=300,r=12,i=.84){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this.enabled=!0,this._time=new Uf(.6),this._screen=[new Uf(.4),new Uf(.4)],this._scene=[new Uf(.6),new Uf(.6),new Uf(.6)],this._tmpDirection=P()}add(e,r,i){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(i)<.015)return;this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._scene[0].update(r[0]),this._scene[1].update(r[1]),this._scene[2].update(r[2]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,r=this._screen[1].filteredDelta,i=e==null||r==null?0:Math.sqrt(e*e+r*r),n=this._time.filteredDelta,s=n==null||i==null?0:i/n;return Math.abs(s)<this._minimumInitialVelocity?null:this.createMomentum(s,this._stopVelocity,this._friction)}createMomentum(e,r,i){he(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const n=Pe(this._tmpDirection);n>0&&le(this._tmpDirection,this._tmpDirection,1/n);const s=this._time.filteredDelta;return new JTt(e,r,i,s==null?0:n/s,this._tmpDirection)}},Y0e=class{constructor(e){this._gain=e}update(e){this.filteredValue!==void 0?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*e:this.filteredValue=e}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}};const Z0e=1e-5;let KTt=class extends p7{constructor(e,r,i,n,s,o=0,a){super(e,r,i),this._angularVelocity1=n,this.axis1=s,this.angularVelocity2=o,this.axis2=a}value1(e){return super.valueFromInitialVelocity(this._angularVelocity1,e)}value2(e){return super.valueFromInitialVelocity(this.angularVelocity2,e)}},QTt=class{constructor(e=300,r=12,i=.84){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this.enabled=!0,this._tmpAxis1=P(),this._tmpAxis2=P(),this._tmpAngles=Ne(),this._time=new Uf(.3),this._screen=[new Uf(.4),new Uf(.4)],this._angle1=new Y0e(.6),this._angle2=new Y0e(.6),this._axis1=P(),this._axis2=P(),this._lastScene=P()}addMomentumDirectRotation(e,r,i,n,s,o){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(i)<.01)return;let a=pFe(this._lastScene,r,this._tmpAxis2,n,s,o);this._angle2.update(0),nl(this._tmpAxis2)<Z0e?a=0:we(this._axis1,this._tmpAxis2),this._angle1.update(a),ce(this._lastScene,r)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(i)}}addMomentumPreserveHeading(e,r,i,n,s,o,a){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(i)<.01)return;fFe(this._lastScene,r,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,n,s,o,a,!1),nl(this._tmpAxis2)<Z0e?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),we(this._axis1,this._tmpAxis1),we(this._axis2,this._tmpAxis2)),ce(this._lastScene,r)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,r=this._screen[1].filteredDelta,i=e==null||r==null?null:Math.sqrt(e*e+r*r),n=this._time.filteredDelta,s=i==null||n==null?0:i/n;return Math.abs(s)<this._minimumInitialVelocity?null:this.createMomentum(s,this._stopVelocity,this._friction)}createMomentum(e,r,i){const n=this._time.filteredDelta,s=this._angle1.filteredValue,o=this._angle2.filteredValue,a=n==null||o==null?0:o/n;return new KTt(e,r,i,n==null||s==null?0:s/n,this._axis1,a,this._axis2)}},qFe=class{constructor(e=2.5,r=.01,i=.95,n=12){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this._maxVelocity=n,this.enabled=!0,this.value=new Uf(.8),this.time=new Uf(.3)}add(e,r){if(this.enabled&&r!=null){if(this.time.hasLastValue()){if(this.time.computeDelta(r)<.01)return;if(this.value.hasFilteredDelta()){const i=this.value.computeDelta(e);this.value.filteredDelta*i<0&&this.value.reset()}}this.time.update(r),this.value.update(e)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=_e(e,-this._maxVelocity,this._maxVelocity),Math.abs(e)<this._minimumInitialVelocity?null:this.createMomentum(e,this._stopVelocity,this._friction)}createMomentum(e,r,i){return new p7(e,r,i)}},WFe=class extends qFe{constructor(e=3,r=.01,i=.95,n=12){super(e,r,i,n)}add(e,r){const i=this.value.lastValue;if(i!=null){let n=e-i;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;e=i+n}super.add(e,r)}},eSt=class extends p7{constructor(e,r,i){super(e,r,i)}value(e){const r=super.value(e);return Math.exp(r)}valueDelta(e,r){const i=super.value(e),n=super.value(e+r)-i;return Math.exp(n)}},XFe=class extends qFe{constructor(e=2.5,r=.01,i=.95,n=12){super(e,r,i,n)}add(e,r){super.add(Math.log(e),r)}createMomentum(e,r,i){return new eSt(e,r,i)}},ute=class extends kg{constructor(){super(...arguments),this._smoothRotation=new EV(.05),this._rotationAxis=P(),this._beginAngle=0,this._beginHeading=0,this._panningPlane=Yr(),this._beginRadius=0,this._smoothScaling=new EV(.05),this._zoomCenterScreen=wn(),this._zoomMomentumEstimator=new XFe,this._rotationMomentumEstimator=new WFe,this._panSphericalMomentumEstimator=new QTt,this._panPlanarMomentumEstimator=new HFe,this._adjustedSphere=Os(),this._tmp3d=P(),this._tmpScreenPointArray=wn(),this._beginScreenPoint=wn(),this._beginScenePoint=P(),this._screenPickPoint=wn(),this._scenePickPoint=P(),this._mode=No.Horizontal,this._sphere=Os(),this._pointerCount=0,this._tmpInteractionDirection=P(),this._constraintOptions={selection:qi.ALL,interactionType:fr.NONE,interactionFactor:0,interactionStartCamera:new Pt,interactionDirection:null,tiltMode:Vo.TUMBLE}}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){var s;if(!this.active)return;const r=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=r,this._rotationMomentumEstimator.enabled=r,this._panPlanarMomentumEstimator.enabled=r,this._panSphericalMomentumEstimator.enabled=r,this._beginHeading=-ew.normalize(Xt(this.view.camera.heading)),this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._smoothRotation.reset(),Og(e.center,this._screenPickPoint),Qs(this._beginScreenPoint,this._screenPickPoint);const i=ii(this.view.spatialReference),n=hFe(this._intersectionHelper,this.startCamera,this._screenPickPoint,i,WO.Silhouette,this.view.map.ground.opacity===0?q2:{});R(n.scenePickPoint)||(this._scenePickPoint=n.scenePickPoint,this._sphere=n.sphere,ce(this._beginScenePoint,this._scenePickPoint),this._mode=u7(this.startCamera,this._screenPickPoint,i),this._mode===No.Vertical&&this._preparePlanarPanMode(e,n.hasGeometryIntersection),(s=this._constraintOptions.interactionStartCamera)==null||s.copyFrom(this.startCamera))}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const r=e.pointers.size>1;this._mode===No.Horizontal?(r&&this._zoomSpherical(e),this._panningSpherical(e),r&&this._rotateSpherical(e)):(r&&this._zoomPlanar(e),this._panningPlanar(e),r&&this._rotatePlanar(e)),this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const r=this._zoomMomentumEstimator.evaluateMomentum();if(r)return this._mode===No.Horizontal?new AT({view:this.view,momentum:r,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new sR({view:this.view,momentum:r,zoomCenter:this._beginScenePoint});const i=this._rotationMomentumEstimator.evaluateMomentum();if(i)return new eS({view:this.view,momentum:i,center:this._sphere,axis:this._rotationAxis});if(this._mode===No.Horizontal){const n=this._panSphericalMomentumEstimator.evaluateMomentum();if(n)return new LU({view:this.view,momentum:n})}else{const n=this._panPlanarMomentumEstimator.evaluateMomentum();if(n)return new W$({view:this.view,momentum:n})}return null}_preparePlanarPanMode(e,r){const i=ul(this._tmp3d,this.startCamera.viewForward);UN(this._scenePickPoint,i,this._panningPlane);const n=wn(this._screenPickPoint[0],0),s=P(),o=Pe(this.startCamera.eye);this._adjustedSphere[3]=o<this._sphere[3]?o-100:this._sphere[3],ED(this._adjustedSphere,this.startCamera,n,s);const a=La();this.startCamera.projectToRenderScreen(s,a);const l=P(),c=P(),h=P();ge(l,this._scenePickPoint,this.currentCamera.eye);const p=Pe(l);we(l,l);const f=aFe*Math.max(Math.abs(this.view.camera.position.z),lFe),m=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,c7);let g=v(m)?m:f;g=r?Math.min(g,p):g,ce(h,me(c,this.currentCamera.eye,le(c,l,g))),this._panningPlane[3]=-ve(this._panningPlane,h),this.startCamera.center=me(c,this.startCamera.eye,le(c,this.startCamera.viewForward,g));const _=Og(e.center,this._tmpScreenPointArray);nte(this._panningPlane,this.startCamera,_,this._beginScenePoint)}_zoomSpherical(e){const r=this._beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=i,this._smoothScaling.update(r),cFe(this._sphere,this.currentCamera,this._smoothScaling.value),Og(e.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),this._constraintOptions.interactionType=fr.ZOOM,this._constraintOptions.interactionFactor=kf(e.radius-this._beginRadius),ls(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(e){const r=Og(e.center,this._tmpScreenPointArray);ED(this._sphere,this.currentCamera,r,this._tmp3d),yle(this._beginScenePoint,ve(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(yFe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(r,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(gFe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(r,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=fr.PAN,this._constraintOptions.interactionFactor=kf(uy(this._screenPickPoint,r)),ls(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(e){we(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||ul(this._rotationAxis,this._rotationAxis);const r=this._smoothRotation.value,i=r+ite(e.angle-r),n=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=n,this._smoothRotation.update(i);const s=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(s,.001*e.timestamp),yw(this.currentCamera,this._sphere,SD(this._rotationAxis,s)),this._constraintOptions.interactionType=fr.TUMBLE,this._constraintOptions.interactionFactor=kf(e.radius*i),ls(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(e){const r=Og(e.center,this._tmpScreenPointArray);nte(this._panningPlane,this.currentCamera,r,this._tmp3d)&&(dFe(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(r,this._tmp3d,.001*e.timestamp),this._constraintOptions.interactionType=fr.PAN,this._constraintOptions.interactionFactor=kf(uy(this._beginScreenPoint,r)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),ls(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(e){const r=this._beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=i,this._smoothScaling.update(r),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),gle(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=fr.ZOOM,this._constraintOptions.interactionFactor=kf(e.radius-this._beginRadius),ls(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(e){ce(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||ul(this._rotationAxis,this._rotationAxis);const r=this._smoothRotation.value;let i=e.angle-r;i=ite(i);const n=r+i,s=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=s,this._smoothRotation.update(n);const o=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(o,.001*e.timestamp),yw(this.currentCamera,this._sphere,SD(this._rotationAxis,o)),this._constraintOptions.interactionType=fr.TUMBLE,this._constraintOptions.interactionFactor=kf(e.radius*o),ls(this.view,this.currentCamera,this._constraintOptions)}};ute=u([$("esri.views.3d.state.controllers.global.PinchAndPanController")],ute);const J0e=ke(0,0,1),tSt={ELEVATION_THRESHOLD:3e4,ANGLE_THRESHOLD:16/180*Math.PI};let hte=class extends kg{constructor(){super(...arguments),this._rotationValueSmooth=new EV(.05),this._scalingValueSmooth=new EV(.05),this._planeHorizontal=Yr(),this._planeVertical=Yr(),this._rotationMomentumEstimator=new WFe,this._panMomentumEstimator=new HFe(300,12,.9),this._zoomMomentumEstimator=new XFe,this._beginRadius=0,this._beginCenter=P(),this._beginAngle=0,this._tmpPoints=[],this._panMode=No.Horizontal,this._beginCenterScreen=wn(),this._tmpCentroid3d=P(),this._tmpCentroid2d=wn(),this._tmp2d=wn(),this._pointerCount=0,this._constraintOptions={selection:qi.ALL,interactionType:fr.NONE,interactionFactor:0,interactionStartCamera:new Pt,interactionDirection:null,tiltMode:Vo.TUMBLE}}begin(e){var g;if(!this.active)return;const r=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=r,this._rotationMomentumEstimator.enabled=r,this._panMomentumEstimator.enabled=r,this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),Og(e.center,this._beginCenterScreen),PLe(J0e,0,this._planeHorizontal);const i=P(),n=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,i,this.view.map.ground.opacity===0?q2:{}),s=P();ul(s,this.startCamera.viewForward);const o=P();ce(o,J0e);const a=ve(s,o),l=Ep(a<0?-a:a);this._panMode=l>=tSt.ANGLE_THRESHOLD?No.Horizontal:No.Vertical;const c=Math.min(aFe,1/Math.abs(ve(o,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),lFe);NQ(this._planeHorizontal,this._planeHorizontal,i),this.startCamera.aboveGround||FQ(this._planeHorizontal,this._planeHorizontal);const h=P(),p=P(),f=P();ge(h,i,this.currentCamera.eye);const m=Pe(h);if(we(h,h),this._panMode===No.Vertical){le(o,o,a),ge(this._planeVertical,s,o),we(this._planeVertical,this._planeVertical),NQ(this._planeVertical,this._planeVertical,i);const _=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,c7);let b=v(_)?_:c;b=n?Math.min(b,m):b,ce(f,me(p,this.currentCamera.eye,le(p,h,b))),this._planeVertical[3]=-ve(this._planeVertical,f),this._computePlanePoints(e.pointers,this._planeVertical,this.startCamera,this._tmpPoints),oq(this._tmpPoints,this._beginCenter)}else{const _=n?m:c;ce(f,me(p,this.currentCamera.eye,le(p,h,_))),this._planeHorizontal[3]=-ve(this._planeHorizontal,f),this._computePlanePoints(e.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),oq(this._tmpPoints,this._beginCenter)}(g=this._constraintOptions.interactionStartCamera)==null||g.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const r=e.pointers.size>1,i=this._panMode===No.Horizontal?this._planeHorizontal:this._planeVertical,n=this._beginCenter;if(r){const s=this._beginRadius/e.radius,o=.001875*Math.min(Math.max(e.radius,40),120);this._scalingValueSmooth.gain=o,this._scalingValueSmooth.update(s),gle(this.currentCamera,n,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*e.timestamp),this._constraintOptions.interactionType=fr.ZOOM,this._constraintOptions.interactionFactor=kf(Math.abs(e.radius-this._beginRadius)),ls(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(e.pointers,i,this.currentCamera,this._tmpPoints),oq(this._tmpPoints,this._tmpCentroid3d),Og(e.center,this._tmpCentroid2d),dFe(this.currentCamera,n,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*e.timestamp),this._constraintOptions.interactionType=fr.PAN,this._constraintOptions.interactionFactor=kf(uy(this._beginCenterScreen,this._tmpCentroid2d)),ls(this.view,this.currentCamera,this._constraintOptions),r){const s=this._planeHorizontal,o=n,a=this._rotationValueSmooth.value,l=a+ite(e.angle-a),c=.00125*Math.min(Math.max(e.radius,40),120);this._rotationValueSmooth.gain=c,this._rotationValueSmooth.update(l);const h=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(h,.001*e.timestamp),yw(this.currentCamera,o,SD(s,h)),this._constraintOptions.interactionType=fr.TUMBLE,this._constraintOptions.interactionFactor=kf(Math.abs(e.radius*h)),ls(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const r=this._zoomMomentumEstimator.evaluateMomentum();if(r)return new sR({view:this.view,momentum:r,zoomCenter:this._beginCenter});const i=this._rotationMomentumEstimator.evaluateMomentum();if(i)return new eS({view:this.view,momentum:i,center:this._beginCenter,axis:this._planeHorizontal});const n=this._panMomentumEstimator.evaluateMomentum();return n?new W$({view:this.view,momentum:n}):null}_computePlanePoints(e,r,i,n){n.length=e.size;const s=this._tmp2d;let o=0;return e.forEach(a=>{s[0]=a.x,s[1]=a.y,n[o]===void 0&&(n[o]=P()),nte(r,i,s,n[o]),o+=1}),n}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};hte=u([$("esri.views.3d.state.controllers.local.PinchAndPanController")],hte);let K0e=class extends nn{constructor(e,r,i){super(!0),this._view=e,this.pointerAction=r,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",i,n=>this._handleDrag(n))}_handleDrag(e){if(e.data.pointerType==="mouse"&&!Goe(e.data,this.pointerAction))return;const r=e.timestamp-this._lastEndTimestamp,i=40,n=this._momentum&&this._momentum.active&&r<i;switch(e.data.action){case"start":case"update":if(n)break;this._controller&&this._controller.active?e.data.timestamp-this._lastTimestamp>2&&(this._controller.update(e.data),this._lastTimestamp=e.timestamp):this._startController(e);break;case"end":case"removed":this._endController(e,!0);break;case"added":this._endController(e,!1),this._startController(e)}e.stopPropagation()}_endController(e,r){if(this._controller&&this._controller.active){this._lastEndTimestamp=e.timestamp;const i=this._controller.end(e.data);r&&i&&(this._momentum=i,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(e){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(e.data),this._lastTimestamp=e.timestamp}_createController(){return this._view.state.isGlobal?new ute({view:this._view}):new hte({view:this._view})}},rSt=class extends nn{constructor(e,r){super(!0),this.view=e,this.registerIncoming("pointer-down",r,()=>this.view.state.stopActiveCameraController())}},YFe=class extends nn{constructor(e,r){super(!0),this.key=e,this.registerIncoming("key-down",r,i=>this._handleKeyDown(i))}_handleKeyDown(e){e.data.key===this.key&&(this.activate(),e.stopPropagation())}},iSt=class extends YFe{constructor(e,r,i){super(r,i),this.view=e}activate(){this.view.goTo({heading:0}).catch(()=>{})}},nSt=class extends YFe{constructor(e,r,i){super(r,i),this.view=e}activate(){this.view.goTo({tilt:0}).catch(()=>{})}},sSt=class extends nn{constructor(e,r=!1){super(!0),this._view=e,this._invert=r,this.registerIncoming("vertical-two-finger-drag",i=>this._handleTwoFinger(i))}_handleTwoFinger(e){var n,s,o;const r=this._invert?-1:1,i=wn(0,e.data.delta*r);switch(e.data.action){case"begin":(n=this._cameraController)==null||n.end(),this._cameraController=new q$({view:this._view,pivot:Eu.CENTER}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":(s=this._cameraController)==null||s.update(i);break;case"end":(o=this._cameraController)==null||o.end(),this._cameraController=null}}},oSt=class extends nn{constructor(e=20,r=40){super(!1),this._threshold=e,this._maxDelta=r,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new kN({start:(i,n)=>this._observeStart(i,n),update:(i,n,s)=>this._observeUpdate(i,n,s),end:(i,n)=>this._observeEnd(n)}),this.registerIncoming("drag",i=>this._dragEventSeparator.handle(i))}get failed(){return this._state==="failed"}_observeStart(e,r){e===1&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:r.data.button,buttons:r.data.buttons,pointerType:r.data.pointerType,timestamp:r.data.timestamp,pointers:r.data.pointers,pointer:r.data.pointer,angle:r.data.angle,radius:r.data.radius,center:r.data.center}),r.stopPropagation()),this._state=e===2?"ready":"failed"}_observeUpdate(e,r,i){if(this._state!=="failed"&&e===2)return this._state==="active"?(this._vertical.emit({delta:r.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void r.stopPropagation()):void(this._checkMovementWithinLimits(r.data,i.data)?this._checkVerticalThresholdReached(r.data,i.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=r.data.center,this._artificalDrag.emit({action:"end",button:r.data.button,buttons:r.data.buttons,pointerType:r.data.pointerType,timestamp:r.data.timestamp,pointers:r.data.pointers,pointer:r.data.pointer,angle:r.data.angle,radius:r.data.radius,center:r.data.center}),this._vertical.emit({delta:r.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),r.stopPropagation()):this._state="failed")}_observeEnd(e){this._state==="active"&&(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",e.stopPropagation())}_checkMovementWithinLimits(e,r){let i=-1/0,n=1/0,s=-1/0,o=1/0;for(const{x:_,y:b}of r.pointers.values())i=Math.max(i,_),n=Math.min(n,_),s=Math.max(s,b),o=Math.min(o,b);let a=-1/0,l=1/0,c=-1/0,h=1/0;for(const{x:_,y:b}of e.pointers.values())a=Math.max(a,_),l=Math.min(l,_),c=Math.max(c,b),h=Math.min(h,b);const p=i-n,f=s-o,m=a-l,g=c-h;return Math.abs(e.center.x-r.center.x)<this._threshold&&Math.abs(m-p)<=this._maxDelta&&Math.abs(g-f)<=this._maxDelta}_checkVerticalThresholdReached(e,r){let i=Math.abs(e.center.y-r.center.y);return e.pointers.forEach((n,s)=>{const o=r.pointers.get(s);i=Math.min(i,Math.abs(n.y-o.y))}),i>=this._threshold}},yf=class extends be{constructor(){super(...arguments),this._handles=new qr}destroy(){this._handles=ze(this._handles),this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get hasPendingInputs(){var e;return!!((e=this._inputManager)!=null&&e.hasPendingInputs)}get latestPointerType(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerType}get latestPointerLocation(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerLocation}get multiTouchActive(){var e;return((e=this._inputManager)==null?void 0:e.multiTouchActive)??!1}disconnect(){this.view.viewEvents.disconnect(),this._inputManager=ze(this._inputManager)}connect(){const e=this.view;this._source=new Hoe(this.view.surface,e.input);const r=[new m$e,new g$e,new d$e,new p$e(this.view.navigation),new oSt],i=new Sf({eventSource:this._source,recognizers:r});this._inputManager=i,i.installHandlers("prevent-context-menu",[new h$e],Xg.INTERNAL),this._modeDragPan=new K0e(e,"primary"),this._modeDragRotate=new gq(e,"secondary",Eu.CENTER),this._modeDragZoom=new UTt(e,"tertiary");const n={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};i.installHandlers("navigation",[new rSt(e),new Lxt(e),new WTt(e),new XTt(e,n.pan),new YTt(e),new nSt(e,n.resetTilt),new iSt(e,n.resetHeading),new gq(e,"primary",Eu.EYE,[n.lookAround]),new gq(e,"secondary",Eu.CENTER,[n.lookAround]),new K0e(e,"tertiary",[n.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new sSt(e)],Xg.INTERNAL),this.view.viewEvents.connect(i),this._updateMode(),this._handles.add(ne(()=>{var s;return(s=this.view.navigation)==null?void 0:s.browserTouchPanEnabled},s=>{this._source.browserTouchPanningEnabled=!s},Vt))}_updateMode(){var n;const e=this.mode,r=this.primaryDragAction,i=(n=dte.get(e))==null?void 0:n.get(r);i&&(this._modeDragPan&&(this._modeDragPan.pointerAction=i.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=i.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=i.zoom))}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};u([d()],yf.prototype,"view",void 0),u([d({value:"pan"})],yf.prototype,"primaryDragAction",null),u([d({value:"default"})],yf.prototype,"mode",null),u([d({readOnly:!0})],yf.prototype,"hasPendingInputs",null),u([d()],yf.prototype,"latestPointerType",null),u([d()],yf.prototype,"latestPointerLocation",null),u([d()],yf.prototype,"multiTouchActive",null),u([d()],yf.prototype,"_inputManager",void 0),yf=u([$("esri.views.3d.input.SceneInputManager")],yf);const dte=new Map,yq=new Map,_q=new Map;yq.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),yq.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),_q.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),_q.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),dte.set("default",yq),dte.set("pro",_q);const aSt=yf;let Lh,jR,pte=!1,fte=!1,mte=!1,gte=!1,X$=null;function lSt(t,e){if(!fte||!jR)return;ZFe();const r=jR;let i=0;for(let n=0;n<t.accBinsNumX;n++)for(let s=0;s<t.accBinsNumY;s++){const o=t.accBins[n][t.accBinsNumY-1-s];i+=o.length;const a=n*t.accBinsSizeX,l=(n+1)*t.accBinsSizeX,c=s*t.accBinsSizeY,h=(s+1)*t.accBinsSizeY;r.fillText(o.length.toFixed(),a+5,c+15),JFe(a,l,c,h,"blue")}r.fillText("total totalShownLabels: "+i,70,40),r.fillText("total visible labels: "+e.size,70,50),r.fillText("total numTests: "+t.accNumTests,70,30)}function cSt(t){mte=Qr.DECONFLICTOR_SHOW_VISIBLE,gte=Qr.DECONFLICTOR_SHOW_INVISIBLE,pte=mte||gte,fte=Qr.DECONFLICTOR_SHOW_GRID,X$=null,pte||fte?X$=()=>uSt(t):Lh&&(Lh.parentElement.removeChild(Lh),Lh=null)}function ZFe(){X$&&(X$(),X$=null)}function uSt(t){Lh==null&&(Lh=document.createElement("canvas"),Lh.setAttribute("id","canvas2d"),t.surface.parentElement.style.position="relative",t.surface.parentElement.appendChild(Lh));const{state:e}=t,{camera:r,pixelRatio:i}=e,{width:n,height:s}=r,o=n*i,a=s*i;Lh.setAttribute("width",`${o}px`),Lh.setAttribute("height",`${a}px`),Lh.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${n}px;height:${s}px`),jR=Lh.getContext("2d"),jR.clearRect(0,0,n,s),jR.font="12px Arial"}function JFe(t,e,r,i,n){ZFe();const s=Lh.height,o=jR;o.beginPath(),o.lineWidth=1,o.strokeStyle=n,o.moveTo(t,s-r),o.lineTo(e,s-r),o.stroke(),o.lineTo(e,s-i),o.stroke(),o.lineTo(e,s-r),o.stroke(),o.lineTo(t,s-r),o.stroke(),o.lineTo(t,s-r),o.stroke(),o.closePath()}function hSt(t,e){pte&&(e&&mte||!e&&gte)&&JFe(t.aabr[0],t.aabr[2],t.aabr[1],t.aabr[3],e?"green":"red")}var aa,Iu;(function(t){t[t.GRAPHIC=0]="GRAPHIC",t[t.LABEL=1]="LABEL",t[t._COUNT=2]="_COUNT"})(aa||(aa={})),function(t){t[t.USER_SETTING=0]="USER_SETTING",t[t.SCALE_RANGE=1]="SCALE_RANGE",t[t.FILTER=2]="FILTER",t[t.DECONFLICTION=3]="DECONFLICTION",t[t._COUNT=4]="_COUNT"}(Iu||(Iu={}));function KFe(t,e){return new r4e(t,n4e,e)}function dSt(t,e){const{curvatureDependent:r,scaleStart:i,scaleFallOffRange:n}=n4e;return new r4e(t,{curvatureDependent:{min:{curvature:r.min.curvature,tiltAngle:r.min.tiltAngle,scaleFallOffFactor:vq.curvatureDependent.min.scaleFallOffFactor},max:{curvature:r.max.curvature,tiltAngle:r.max.tiltAngle,scaleFallOffFactor:vq.curvatureDependent.max.scaleFallOffFactor}},scaleStart:i,scaleFallOffRange:n,minPixelSize:vq.minPixelSize},e)}function pSt(t){return Math.abs(t*t*t)}function QFe(t,e,r){const i=r.parameters,n=r.paddingPixelsOverride;return kM.scale=Math.min(i.divisor/(e-i.offset),1),kM.factor=pSt(t),kM.minPixelSize=i.minPixelSize,kM.paddingPixels=n,kM}function e4e(t,e){return t===0?e.minPixelSize:e.minPixelSize*(1+2*e.paddingPixels/t)}function Ele(t,e){return Math.max(Bt(t*e.scale,t,e.factor),e4e(t,e))}function fSt(t,e,r){const i=QFe(t,e,r);return i.minPixelSize=0,i.paddingPixels=0,Ele(1,i)}function Q0e(t,e,r,i){i.scale=fSt(t,e,r),i.factor=0,i.minPixelSize=r.parameters.minPixelSize,i.paddingPixels=r.paddingPixelsOverride}function t4e(t,e,r=[0,0]){const i=Math.min(Math.max(e.scale,e4e(t[1],e)/Math.max(1e-5,t[1])),1);return r[0]=t[0]*i,r[1]=t[1]*i,r}function mSt(t,e,r,i){return Ele(t,QFe(e,r,i))}let r4e=class i4e{get paddingPixelsOverride(){return this._paddingPixelsOverride||this.parameters.paddingPixels}constructor(e,r,i,n=gSt(),s){this._viewingMode=e,this._description=r,this._ellipsoidRadius=i,this.parameters=n,this._paddingPixelsOverride=s,this._viewingMode===qe.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(e){return(!this.parameters||this.parameters.camera.fovY!==e.fovY||this.parameters.camera.distance!==e.distance)&&(this._calculateParameters(e,this._ellipsoidRadius,this.parameters),!0)}overridePadding(e){return e!==this.paddingPixelsOverride?new i4e(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,e):this}_calculateParameters(e,r,i){const{scaleStart:n,scaleFallOffRange:s,minPixelSize:o}=this._description,{fovY:a,distance:l}=e,c=this._calculateCurvatureDependentParameters(e,r),h=this._coverageCompensation(e,r,c),{tiltAngle:p,scaleFallOffFactor:f}=c,m=Math.sin(p)*l,g=.5*Math.PI-p-a*(.5-n*h),_=m/Math.cos(g),b=g+a*s*h,w=(_-f*(m/Math.cos(b)))/(1-f);return i.camera.fovY=e.fovY,i.camera.distance=e.distance,i.offset=w,i.divisor=_-w,i.minPixelSize=o,i}_calculateCurvatureDependentParametersLocal(e,r,i=e_e){return i.tiltAngle=this._description.curvatureDependent.min.tiltAngle,i.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,i}_calculateCurvatureDependentParametersGlobal(e,r,i=e_e){const n=this._description.curvatureDependent,s=1+e.distance/r,o=Math.sqrt(s*s-1),[a,l]=[n.min.curvature,n.max.curvature],c=_e((o-a)/(l-a),0,1),[h,p]=[n.min,n.max];return i.tiltAngle=Bt(h.tiltAngle,p.tiltAngle,c),i.scaleFallOffFactor=Bt(h.scaleFallOffFactor,p.scaleFallOffFactor,c),i}_surfaceCoverageCompensationLocal(e,r,i){return(e.fovY-i.tiltAngle)/e.fovY}_surfaceCoverageCompensationGlobal(e,r,i){const n=r*r,s=i.tiltAngle+.5*Math.PI,{fovY:o,distance:a}=e,l=a*a+n-2*Math.cos(s)*a*r,c=Math.sqrt(l),h=Math.sqrt(l-n);return(Math.acos(h/c)-Math.asin(r/(c/Math.sin(s)))+.5*o)/o}};const n4e={curvatureDependent:{min:{curvature:Xt(10),tiltAngle:Xt(12),scaleFallOffFactor:.5},max:{curvature:Xt(70),tiltAngle:Xt(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},vq={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function gSt(){return{camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0}}const kM={scale:0,factor:0,minPixelSize:0,paddingPixels:0},e_e={tiltAngle:0,scaleFallOffFactor:0};function ySt(t){return t instanceof Float32Array&&t.length>=16}function _St(t){return Array.isArray(t)&&t.length>=16}function vSt(t){return ySt(t)||_St(t)}function Cle(t){t.vertex.code.add(S`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`),t.vertex.code.add(S`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),t.vertex.code.add(S`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`),t.vertex.code.add(S`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`),t.vertex.code.add(S`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),t.vertex.code.add(S`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`),t.vertex.code.add(S`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function bSt(t){t.uniforms.add(new br("screenSizePerspective",e=>s4e(e.screenSizePerspective)))}function f7(t){t.uniforms.add(new br("screenSizePerspectiveAlignment",e=>s4e(e.screenSizePerspectiveAlignment||e.screenSizePerspective)))}function s4e(t){return ai(wSt,t.parameters.divisor,t.parameters.offset,t.parameters.minPixelSize,t.paddingPixelsOverride)}const wSt=pr();let o4e=class extends Ln{constructor(e,r){super(e,"mat4",_i.Draw,(i,n,s)=>i.setUniformMatrix4fv(e,r(n,s)))}};function mm(t,e){e.instancedDoublePrecision?t.constants.add("cameraPosition","vec3",cl):t.uniforms.add(new Kh("cameraPosition",(r,i)=>he(a4e,i.camera.viewInverseTransposeMatrix[3]-r.origin[0],i.camera.viewInverseTransposeMatrix[7]-r.origin[1],i.camera.viewInverseTransposeMatrix[11]-r.origin[2])))}function Gu(t,e){if(!e.instancedDoublePrecision)return void t.uniforms.add([new rn("proj",(i,n)=>n.camera.projectionMatrix),new o4e("view",(i,n)=>Hc(t_e,n.camera.viewMatrix,i.origin)),new Kh("localOrigin",i=>i.origin)]);const r=i=>he(a4e,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]);t.uniforms.add([new rn("proj",(i,n)=>n.camera.projectionMatrix),new rn("view",(i,n)=>Hc(t_e,n.camera.viewMatrix,r(n))),new Jt("localOrigin",(i,n)=>r(n))])}const t_e=CN(),a4e=P();function YO(t){t.uniforms.add(new rn("viewNormal",(e,r)=>r.camera.viewInverseTransposeMatrix))}function l4e(t,e){const r=t.vertex;e.hasVerticalOffset?(c4e(r),e.hasScreenSizePerspective&&(t.include(Cle),f7(r),mm(t.vertex,e)),r.code.add(S`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${e.spherical?S`vec3 worldNormal = normalize(worldPos + localOrigin);`:S`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${e.hasScreenSizePerspective?S`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:S`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):r.code.add(S`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const xSt=pr();function c4e(t){t.uniforms.add(new br("verticalOffset",(e,r)=>{const{minWorldLength:i,maxWorldLength:n,screenLength:s}=e.verticalOffset,o=Math.tan(.5*r.camera.fovY)/(.5*r.camera.fullViewport[3]),a=r.camera.pixelRatio||1;return ai(xSt,s*a,o,i,n)}))}var Rh;(function(t){t[t.Occluded=0]="Occluded",t[t.NotOccluded=1]="NotOccluded",t[t.Both=2]="Both",t[t.COUNT=3]="COUNT"})(Rh||(Rh={}));var kc;function u4e(t,e){t.include(Cle),t.attributes.add(O.POSITION,"vec3"),t.attributes.add(O.NORMAL,"vec3"),t.attributes.add(O.AUXPOS1,"vec4");const r=t.vertex;Gu(r,e),mm(r,e),r.uniforms.add([new br("viewport",(i,n)=>n.camera.fullViewport),new Ie("polygonOffset",i=>i.shaderPolygonOffset),new Ie("cameraGroundRelative",(i,n)=>n.camera.aboveGround?1:-1),new Ie("renderTransparentlyOccludedHUD",(i,n)=>n.renderTransparentlyOccludedHUD===Rh.Occluded?1:n.renderTransparentlyOccludedHUD===Rh.NotOccluded?0:.75),new Dt("hudVisibilityTexture",(i,n)=>n.hudVisibilityTexture)]),e.hasVerticalOffset&&c4e(r),r.constants.add("smallOffsetAngle","float",.984807753012208),r.code.add(S`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),r.code.add(S`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),e.isDraped&&!e.hasVerticalOffset||YO(r),e.isDraped||(r.uniforms.add(new Ie("perDistancePixelRatio",(i,n)=>Math.tan(n.camera.fovY/2)/(n.camera.fullViewport[2]/2))),r.code.add(S`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`)),e.screenCenterOffsetUnitsEnabled===kc.Screen&&r.uniforms.add(new Ie("pixelRatio",(i,n)=>n.camera.pixelRatio)),e.hasScreenSizePerspective&&f7(r),r.code.add(S`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${e.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${e.hasScreenSizePerspective&&(e.hasVerticalOffset||e.screenCenterOffsetUnitsEnabled===kc.Screen)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${e.hasVerticalOffset?e.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${e.hasVerticalOffset?S`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${e.screenCenterOffsetUnitsEnabled!==kc.Screen?S`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${e.screenCenterOffsetUnitsEnabled===kc.Screen?e.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${e.screenCenterOffsetUnitsEnabled===kc.Screen?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),r.code.add(S`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}(function(t){t[t.World=0]="World",t[t.Screen=1]="Screen",t[t.COUNT=2]="COUNT"})(kc||(kc={}));const x5=Ks();function h4e(t,e,r,i,n,s){if(t.visible)if(t.boundingInfo){wt(t.type===Wn.Mesh);const o=e.tolerance;d4e(t.boundingInfo,r,i,o,n,s)}else{const o=t.indices.get(O.POSITION),a=t.vertexAttributes.get(O.POSITION);XN(r,i,0,o.length/3,o,a,void 0,n,s)}}const TSt=P();function d4e(t,e,r,i,n,s){if(R(t))return;const o=f4e(e,r,TSt);if(yCe(x5,t.bbMin),_Ce(x5,t.bbMax),v(n)&&n.applyToAabb(x5),Rle(x5,e,o,i)){const{primitiveIndices:a,indices:l,position:c}=t,h=a?a.length:l.length/3;if(h>ASt){const p=t.getChildren();if(p!==void 0){for(const f of p)d4e(f,e,r,i,n,s);return}}XN(e,r,0,h,l,c,a,n,s)}}const p4e=P();function XN(t,e,r,i,n,s,o,a,l){if(o)return SSt(t,e,r,i,n,s,o,a,l);const{data:c,stride:h}=s,p=t[0],f=t[1],m=t[2],g=e[0]-p,_=e[1]-f,b=e[2]-m;for(let w=r,x=3*r;w<i;++w){let T=h*n[x++],E=c[T++],C=c[T++],A=c[T];T=h*n[x++];let I=c[T++],M=c[T++],D=c[T];T=h*n[x++];let U=c[T++],z=c[T++],B=c[T];v(a)&&([E,C,A]=a.applyToVertex(E,C,A,w),[I,M,D]=a.applyToVertex(I,M,D,w),[U,z,B]=a.applyToVertex(U,z,B,w));const ee=I-E,te=M-C,K=D-A,W=U-E,N=z-C,L=B-A,F=_*L-N*b,G=b*W-L*g,q=g*N-W*_,Z=ee*F+te*G+K*q;if(Math.abs(Z)<=Number.EPSILON)continue;const X=p-E,oe=f-C,pe=m-A,ye=X*F+oe*G+pe*q;if(Z>0){if(ye<0||ye>Z)continue}else if(ye>0||ye<Z)continue;const Se=oe*K-te*pe,He=pe*ee-K*X,Le=X*te-ee*oe,Te=g*Se+_*He+b*Le;if(Z>0){if(Te<0||ye+Te>Z)continue}else if(Te>0||ye+Te<Z)continue;const Fe=(W*Se+N*He+L*Le)/Z;Fe>=0&&l(Fe,Ale(ee,te,K,W,N,L,p4e),w,!1)}}function SSt(t,e,r,i,n,s,o,a,l){const{data:c,stride:h}=s,p=t[0],f=t[1],m=t[2],g=e[0]-p,_=e[1]-f,b=e[2]-m;for(let w=r;w<i;++w){const x=o[w];let T=3*x,E=h*n[T++],C=c[E++],A=c[E++],I=c[E];E=h*n[T++];let M=c[E++],D=c[E++],U=c[E];E=h*n[T];let z=c[E++],B=c[E++],ee=c[E];v(a)&&([C,A,I]=a.applyToVertex(C,A,I,w),[M,D,U]=a.applyToVertex(M,D,U,w),[z,B,ee]=a.applyToVertex(z,B,ee,w));const te=M-C,K=D-A,W=U-I,N=z-C,L=B-A,F=ee-I,G=_*F-L*b,q=b*N-F*g,Z=g*L-N*_,X=te*G+K*q+W*Z;if(Math.abs(X)<=Number.EPSILON)continue;const oe=p-C,pe=f-A,ye=m-I,Se=oe*G+pe*q+ye*Z;if(X>0){if(Se<0||Se>X)continue}else if(Se>0||Se<X)continue;const He=pe*W-K*ye,Le=ye*te-W*oe,Te=oe*K-te*pe,Fe=g*He+_*Le+b*Te;if(X>0){if(Fe<0||Se+Fe>X)continue}else if(Fe>0||Se+Fe<X)continue;const Ve=(N*He+L*Le+F*Te)/X;Ve>=0&&l(Ve,Ale(te,K,W,N,L,F,p4e),x,!1)}}const r_e=P(),i_e=P();function Ale(t,e,r,i,n,s,o){return he(r_e,t,e,r),he(i_e,i,n,s),vt(o,r_e,i_e),we(o,o),o}function f4e(t,e,r){return he(r,1/(e[0]-t[0]),1/(e[1]-t[1]),1/(e[2]-t[2]))}function Rle(t,e,r,i){return Ole(t,e,r,i,1/0)}function Ole(t,e,r,i,n){const s=(t[0]-i-e[0])*r[0],o=(t[3]+i-e[0])*r[0];let a=Math.min(s,o),l=Math.max(s,o);const c=(t[1]-i-e[1])*r[1],h=(t[4]+i-e[1])*r[1];if(l=Math.min(l,Math.max(c,h)),l<0||(a=Math.max(a,Math.min(c,h)),a>l))return!1;const p=(t[2]-i-e[2])*r[2],f=(t[5]+i-e[2])*r[2];return l=Math.min(l,Math.max(p,f)),!(l<0)&&(a=Math.max(a,Math.min(p,f)),!(a>l)&&a<n)}function m4e(t,e,r,i,n){let s=(r.screenLength||0)*t.pixelRatio;v(n)&&(s=mSt(s,i,e,n));const o=s*Math.tan(.5*t.fovY)/(.5*t.fullHeight);return _e(o*e,r.minWorldLength||0,r.maxWorldLength!=null?r.maxWorldLength:1/0)}function g4e(t,e){const r=e?g4e(e):{};for(const i in t){let n=t[i];n&&n.forEach&&(n=CSt(n)),n==null&&i in r||(r[i]=n)}return r}function ESt(t,e){let r=!1;for(const i in e){const n=e[i];n!==void 0&&(Array.isArray(n)?t[i]===null?(t[i]=n.slice(),r=!0):Oie(t[i],n)&&(r=!0):t[i]!==n&&(r=!0,t[i]=n))}return r}function CSt(t){const e=[];return t.forEach(r=>e.push(r)),e}const y4e={multiply:1,ignore:2,replace:3,tint:4},ASt=1e3;let Fw=class extends GN{constructor(e,r){super(),this.type=Wn.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=Lr,this._pp0=ke(0,0,1),this._pp1=ke(0,0,0),this._parameters=g4e(e,r),this.validateParameters(this._parameters)}dispose(){}get parameters(){return this._parameters}update(e){return!1}setParameters(e,r=!0){ESt(this._parameters,e)&&(this.validateParameters(this._parameters),r&&this.parametersChanged())}validateParameters(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}shouldRender(e){return this.isVisible()&&this.isVisibleForOutput(e.output)&&(this.renderOccluded&e.renderOccludedMask)!=0}isVisibleForOutput(e){return!0}get renderOccluded(){return this.parameters.renderOccluded}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}get insertOrder(){return this._insertOrder}set insertOrder(e){e!==this._insertOrder&&(this._insertOrder=e,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){v(this.repository)&&this.repository.materialChanged(this)}intersectDraped(e,r,i,n,s,o){return this._pp0[0]=this._pp1[0]=n[0],this._pp0[1]=this._pp1[1]=n[1],this.intersect(e,r,i,this._pp0,this._pp1,s)}},_4e=class extends n1t{constructor(e,r,i){super(r,i),this.camera=e}};var vn;(function(t){t[t.Occlude=1]="Occlude",t[t.Transparent=2]="Transparent",t[t.OccludeAndTransparent=4]="OccludeAndTransparent",t[t.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",t[t.Opaque=16]="Opaque"})(vn||(vn={}));let z3=class extends wi{constructor(){super(...arguments),this.renderOccluded=vn.Occlude}},v4e=class{constructor(){this.factor=new n_e,this.factorAlignment=new n_e}},n_e=class{constructor(){this.scale=0,this.factor=0,this.minPixelSize=0,this.paddingPixels=0}};function UXt(t,e,r,i,n=1){const s=r.typedBuffer,o=r.typedBufferStride,a=t.length;if(i*=o,n===1)for(let l=0;l<a;++l)s[i]=e[t[l]],i+=o;else for(let l=0;l<a;++l){const c=e[t[l]];for(let h=0;h<n;h++)s[i]=c,i+=o}}function RSt(t,e,r,i){const n=r.typedBuffer,s=r.typedBufferStride,o=t.length;i*=s;for(let a=0;a<o;++a){const l=2*t[a];n[i]=e[l],n[i+1]=e[l+1],i+=s}}function b4e(t,e,r,i,n){const s=r.typedBuffer,o=r.typedBufferStride,a=t.length;if(i*=o,n==null||n===1)for(let l=0;l<a;++l){const c=3*t[l];s[i]=e[c],s[i+1]=e[c+1],s[i+2]=e[c+2],i+=o}else for(let l=0;l<a;++l){const c=3*t[l];for(let h=0;h<n;++h)s[i]=e[c],s[i+1]=e[c+1],s[i+2]=e[c+2],i+=o}}function ZO(t,e,r,i,n=1){const s=r.typedBuffer,o=r.typedBufferStride,a=t.length;if(i*=o,n===1)for(let l=0;l<a;++l){const c=4*t[l];s[i]=e[c],s[i+1]=e[c+1],s[i+2]=e[c+2],s[i+3]=e[c+3],i+=o}else for(let l=0;l<a;++l){const c=4*t[l];for(let h=0;h<n;++h)s[i]=e[c],s[i+1]=e[c+1],s[i+2]=e[c+2],s[i+3]=e[c+3],i+=o}}function s_e(t,e,r){const i=t.typedBuffer,n=t.typedBufferStride;e*=n;for(let s=0;s<r;++s)i[e]=0,i[e+1]=0,i[e+2]=0,i[e+3]=0,e+=n}function m7(t,e,r,i,n,s=1){if(!r)return void b4e(t,e,i,n,s);const o=i.typedBuffer,a=i.typedBufferStride,l=t.length,c=r[0],h=r[1],p=r[2],f=r[4],m=r[5],g=r[6],_=r[8],b=r[9],w=r[10],x=r[12],T=r[13],E=r[14];n*=a;let C=0,A=0,I=0;const M=tB(r)?D=>{C=e[D]+x,A=e[D+1]+T,I=e[D+2]+E}:D=>{const U=e[D],z=e[D+1],B=e[D+2];C=c*U+f*z+_*B+x,A=h*U+m*z+b*B+T,I=p*U+g*z+w*B+E};if(s===1)for(let D=0;D<l;++D)M(3*t[D]),o[n]=C,o[n+1]=A,o[n+2]=I,n+=a;else for(let D=0;D<l;++D){M(3*t[D]);for(let U=0;U<s;++U)o[n]=C,o[n+1]=A,o[n+2]=I,n+=a}}function Mle(t,e,r,i,n,s=1){if(!r)return void b4e(t,e,i,n,s);const o=r,a=i.typedBuffer,l=i.typedBufferStride,c=t.length,h=o[0],p=o[1],f=o[2],m=o[4],g=o[5],_=o[6],b=o[8],w=o[9],x=o[10],T=!ise(o),E=1e-6,C=1-E;n*=l;let A=0,I=0,M=0;const D=tB(o)?U=>{A=e[U],I=e[U+1],M=e[U+2]}:U=>{const z=e[U],B=e[U+1],ee=e[U+2];A=h*z+m*B+b*ee,I=p*z+g*B+w*ee,M=f*z+_*B+x*ee};if(s===1)if(T)for(let U=0;U<c;++U){D(3*t[U]);const z=A*A+I*I+M*M;if(z<C&&z>E){const B=1/Math.sqrt(z);a[n]=A*B,a[n+1]=I*B,a[n+2]=M*B}else a[n]=A,a[n+1]=I,a[n+2]=M;n+=l}else for(let U=0;U<c;++U)D(3*t[U]),a[n]=A,a[n+1]=I,a[n+2]=M,n+=l;else for(let U=0;U<c;++U){if(D(3*t[U]),T){const z=A*A+I*I+M*M;if(z<C&&z>E){const B=1/Math.sqrt(z);A*=B,I*=B,M*=B}}for(let z=0;z<s;++z)a[n]=A,a[n+1]=I,a[n+2]=M,n+=l}}function OSt(t,e,r,i,n,s=1){if(!r)return void ZO(t,e,i,n,s);const o=r,a=i.typedBuffer,l=i.typedBufferStride,c=t.length,h=o[0],p=o[1],f=o[2],m=o[4],g=o[5],_=o[6],b=o[8],w=o[9],x=o[10],T=!ise(o),E=1e-6,C=1-E;if(n*=l,s===1)for(let A=0;A<c;++A){const I=4*t[A],M=e[I],D=e[I+1],U=e[I+2],z=e[I+3];let B=h*M+m*D+b*U,ee=p*M+g*D+w*U,te=f*M+_*D+x*U;if(T){const K=B*B+ee*ee+te*te;if(K<C&&K>E){const W=1/Math.sqrt(K);B*=W,ee*=W,te*=W}}a[n]=B,a[n+1]=ee,a[n+2]=te,a[n+3]=z,n+=l}else for(let A=0;A<c;++A){const I=4*t[A],M=e[I],D=e[I+1],U=e[I+2],z=e[I+3];let B=h*M+m*D+b*U,ee=p*M+g*D+w*U,te=f*M+_*D+x*U;if(T){const K=B*B+ee*ee+te*te;if(K<C&&K>E){const W=1/Math.sqrt(K);B*=W,ee*=W,te*=W}}for(let K=0;K<s;++K)a[n]=B,a[n+1]=ee,a[n+2]=te,a[n+3]=z,n+=l}}function Ple(t,e,r,i,n,s=1){const o=i.typedBuffer,a=i.typedBufferStride,l=t.length;if(n*=a,r!==e.length||r!==4)if(s!==1)if(r!==4)for(let c=0;c<l;++c){const h=3*t[c];for(let p=0;p<s;++p)o[n]=e[h],o[n+1]=e[h+1],o[n+2]=e[h+2],o[n+3]=255,n+=a}else for(let c=0;c<l;++c){const h=4*t[c];for(let p=0;p<s;++p)o[n]=e[h],o[n+1]=e[h+1],o[n+2]=e[h+2],o[n+3]=e[h+3],n+=a}else{if(r===4){for(let c=0;c<l;++c){const h=4*t[c];o[n]=e[h],o[n+1]=e[h+1],o[n+2]=e[h+2],o[n+3]=e[h+3],n+=a}return}for(let c=0;c<l;++c){const h=3*t[c];o[n]=e[h],o[n+1]=e[h+1],o[n+2]=e[h+2],o[n+3]=255,n+=a}}else{o[n]=e[0],o[n+1]=e[1],o[n+2]=e[2],o[n+3]=e[3];const c=new Uint32Array(i.typedBuffer.buffer,i.start),h=a/4,p=c[n/=4];n+=h;const f=l*s;for(let m=1;m<f;++m)c[n]=p,n+=h}}function w4e(t,e,r,i,n=1){const s=e.typedBuffer,o=e.typedBufferStride;if(i*=o,n===1)for(let a=0;a<r;++a)s[i]=t[0],s[i+1]=t[1],s[i+2]=t[2],s[i+3]=t[3],i+=o;else for(let a=0;a<r;++a)for(let l=0;l<n;++l)s[i]=t[0],s[i+1]=t[1],s[i+2]=t[2],s[i+3]=t[3],i+=o}function x4e(t,e,r,i,n,s){for(const o of e.fieldNames){const a=t.vertexAttributes.get(o),l=t.indices.get(o);if(a&&l)switch(o){case O.POSITION:{wt(a.size===3);const c=n.getField(o,Ui);wt(!!c,`No buffer view for ${o}`),c&&m7(l,a.data,r,c,s);break}case O.NORMAL:{wt(a.size===3);const c=n.getField(o,Ui);wt(!!c,`No buffer view for ${o}`),c&&Mle(l,a.data,i,c,s);break}case O.UV0:{wt(a.size===2);const c=n.getField(o,q_);wt(!!c,`No buffer view for ${o}`),c&&RSt(l,a.data,c,s);break}case O.COLOR:case O.SYMBOLCOLOR:{wt(a.size===3||a.size===4);const c=n.getField(o,gl);wt(!!c,`No buffer view for ${o}`),c&&Ple(l,a.data,a.size,c,s);break}case O.TANGENT:{wt(a.size===4);const c=n.getField(o,Yu);wt(!!c,`No buffer view for ${o}`),c&&OSt(l,a.data,i,c,s);break}case O.PROFILERIGHT:case O.PROFILEUP:case O.PROFILEVERTEXANDNORMAL:case O.FEATUREVALUE:{wt(a.size===4);const c=n.getField(o,Yu);wt(!!c,`No buffer view for ${o}`),c&&ZO(l,a.data,c,s)}}else if(o===O.OBJECTANDLAYERIDCOLOR&&v(t.objectAndLayerIdColor)){const c=t.indices.get(O.POSITION);if(wt(!!c,`No buffer view for ${o}`),c){const h=c.length,p=n.getField(o,gl);w4e(t.objectAndLayerIdColor,p,h,s)}}}}function AD(t,e,r=0){const i=_e(t,0,ISt);for(let n=0;n<4;n++)e[r+n]=Math.floor(256*$St(i*MSt[n]))}function Ile(t,e=0){let r=0;for(let i=0;i<4;i++)r+=t[e+i]*PSt[i];return r}const MSt=[1,256,65536,16777216],PSt=[1/256,1/65536,1/16777216,1/4294967296],ISt=Ile(new Uint8ClampedArray([255,255,255,255]));function $St(t){return t-Math.floor(t)}async function O_(t,e){const{data:r}=await ei(t,{responseType:"image",...e});return r}let $le=class extends wi{constructor(){super(...arguments),this.color=Zt(1,1,1,1)}};function LSt(){const t=new Br;return t.include(Np),t.fragment.uniforms.add([new Dt("tex",e=>e.texture),new br("uColor",e=>e.color)]),t.fragment.code.add(S`void main() {
vec4 texColor = texture2D(tex, uv);
gl_FragColor = texColor * uColor;
}`),t}const DSt=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:$le,build:LSt},Symbol.toStringTag,{value:"Module"}));function NSt(){if(R(bq)){const t=e=>si(`esri/libs/basisu/${e}`);bq=Q(()=>import("./basis_transcoder-e0466ff6.js"),["assets/basis_transcoder-e0466ff6.js","assets/_commonjsHelpers-2f3e7994.js"]).then(e=>e.b).then(({default:e})=>e({locateFile:t}).then(r=>(r.initializeBasis(),delete r.then,r)))}return bq}let bq;var tS;(function(t){t[t.ETC1_RGB=0]="ETC1_RGB",t[t.ETC2_RGBA=1]="ETC2_RGBA",t[t.BC1_RGB=2]="BC1_RGB",t[t.BC3_RGBA=3]="BC3_RGBA",t[t.BC4_R=4]="BC4_R",t[t.BC5_RG=5]="BC5_RG",t[t.BC7_M6_RGB=6]="BC7_M6_RGB",t[t.BC7_M5_RGBA=7]="BC7_M5_RGBA",t[t.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",t[t.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",t[t.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",t[t.ATC_RGB=11]="ATC_RGB",t[t.ATC_RGBA=12]="ATC_RGBA",t[t.FXT1_RGB=17]="FXT1_RGB",t[t.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",t[t.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",t[t.ETC2_EAC_R11=20]="ETC2_EAC_R11",t[t.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",t[t.RGBA32=13]="RGBA32",t[t.RGB565=14]="RGB565",t[t.BGR565=15]="BGR565",t[t.RGBA4444=16]="RGBA4444"})(tS||(tS={}));let im=null,T5=null;async function T4e(){return R(T5)&&(T5=NSt(),im=await T5),T5}function FSt(t,e){if(R(im))return t.byteLength;const r=new im.BasisFile(new Uint8Array(t)),i=E4e(r)?S4e(r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),e):0;return r.close(),r.delete(),i}function kSt(t,e){if(R(im))return t.byteLength;const r=new im.KTX2File(new Uint8Array(t)),i=C4e(r)?S4e(r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),e):0;return r.close(),r.delete(),i}function S4e(t,e,r,i,n){const s=bDe(e?jn.COMPRESSED_RGBA8_ETC2_EAC:jn.COMPRESSED_RGB8_ETC2),o=n&&t>1?(4**t-1)/(3*4**(t-1)):1;return Math.ceil(r*i*s*o)}function E4e(t){return t.getNumImages()>=1&&!t.isUASTC()}function C4e(t){return t.getFaces()>=1&&t.isETC1S()}async function USt(t,e,r){R(im)&&(im=await T4e());const i=new im.BasisFile(new Uint8Array(r));if(!E4e(i))return null;i.startTranscoding();const n=A4e(t,e,i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),(s,o)=>i.getImageTranscodedSizeInBytes(0,s,o),(s,o,a)=>i.transcodeImage(a,0,s,o,0,0));return i.close(),i.delete(),n}async function zSt(t,e,r){R(im)&&(im=await T4e());const i=new im.KTX2File(new Uint8Array(r));if(!C4e(i))return null;i.startTranscoding();const n=A4e(t,e,i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),(s,o)=>i.getImageTranscodedSizeInBytes(s,0,0,o),(s,o,a)=>i.transcodeImage(a,s,0,0,o,0,-1,-1));return i.close(),i.delete(),n}function A4e(t,e,r,i,n,s,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=t.capabilities,[h,p]=l?i?[tS.ETC2_RGBA,jn.COMPRESSED_RGBA8_ETC2_EAC]:[tS.ETC1_RGB,jn.COMPRESSED_RGB8_ETC2]:c?i?[tS.BC3_RGBA,jn.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[tS.BC1_RGB,jn.COMPRESSED_RGB_S3TC_DXT1_EXT]:[tS.RGBA32,Ge.RGBA],f=e.hasMipmap?r:Math.min(1,r),m=[];for(let w=0;w<f;w++)m.push(new Uint8Array(o(w,h))),a(w,h,m[w]);const g=m.length>1,_=g?it.LINEAR_MIPMAP_LINEAR:it.LINEAR,b={...e,samplingMode:_,hasMipmap:g,internalFormat:p,width:n,height:s};return new mt(t,b,{type:"compressed",levels:m})}const UM=re.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),VSt=542327876,BSt=131072,jSt=4;function Lle(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function GSt(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)}const HSt=Lle("DXT1"),qSt=Lle("DXT3"),WSt=Lle("DXT5"),XSt=31,YSt=0,ZSt=1,JSt=2,KSt=3,QSt=4,e2t=7,t2t=20,r2t=21;function i2t(t,e,r){const{textureData:i,internalFormat:n,width:s,height:o}=Ic(n2t(r,e.hasMipmap??!1));return e.samplingMode=i.levels.length>1?it.LINEAR_MIPMAP_LINEAR:it.LINEAR,e.hasMipmap=i.levels.length>1,e.internalFormat=n,e.width=s,e.height=o,new mt(t,e,i)}function n2t(t,e){const r=new Int32Array(t,0,XSt);if(r[YSt]!==VSt)return UM.error("Invalid magic number in DDS header"),null;if(!(r[t2t]&jSt))return UM.error("Unsupported format, must contain a FourCC code"),null;const i=r[r2t];let n,s;switch(i){case HSt:n=8,s=jn.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case qSt:n=16,s=jn.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case WSt:n=16,s=jn.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return UM.error("Unsupported FourCC code:",GSt(i)),null}let o=1,a=r[QSt],l=r[KSt];!(3&a)&&!(3&l)||(UM.warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,h=l;let p,f;r[JSt]&BSt&&e!==!1&&(o=Math.max(1,r[e2t])),o===1||lm(a)&&lm(l)||(UM.warn("Ignoring mipmaps of non power of two sized compressed texture."),o=1);let m=r[ZSt]+4;const g=[];for(let _=0;_<o;++_)f=(a+3>>2)*(l+3>>2)*n,p=new Uint8Array(t,m,f),g.push(p),m+=f,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:g},internalFormat:s,width:c,height:h}}let W2=class DU extends GN{constructor(e,r){super(),this._data=e,this.type=Wn.Texture,this._glTexture=null,this._powerOfTwoStretchInfo=null,this._loadingPromise=null,this._loadingController=null,this.events=new Sn,this._passParameters=new $le,this.params=r||{},this.params.mipmap=this.params.mipmap!==!1,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:$t.REPEAT,t:$t.REPEAT},this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||kb.STRETCH,this.estimatedTexMemRequired=DU._estimateTexMemRequired(this._data,this.params),this._startPreload()}_startPreload(){const e=this._data;R(e)||(e instanceof HTMLVideoElement?this._startPreloadVideoElement(e):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){if(!(Zb(e.src)||e.preload==="auto"&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";const r=!e.paused;if(e.src=e.src,r&&e.autoplay){const i=()=>{e.removeEventListener("canplay",i),e.play()};e.addEventListener("canplay",i)}}}_startPreloadImageElement(e){cd(e.src)||Zb(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}static _getDataDimensions(e){return e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e}static _estimateTexMemRequired(e,r){if(R(e))return 0;if(tM(e)||VT(e))return r.encoding===F0.KTX2_ENCODING?kSt(e,!!r.mipmap):r.encoding===F0.BASIS_ENCODING?FSt(e,!!r.mipmap):e.byteLength;const{width:i,height:n}=e instanceof Image||e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?DU._getDataDimensions(e):r;return(r.mipmap?4/3:1)*i*n*(r.components||4)||0}dispose(){this._data=void 0}get width(){return this.params.width}get height(){return this.params.height}_createDescriptor(e){return{target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?it.LINEAR_MIPMAP_LINEAR:it.LINEAR,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:this.params.maxAnisotropy??(this.params.mipmap?e.parameters.maxMaxAnisotropy:1)}}get glTexture(){return this._glTexture}load(e,r){if(v(this._glTexture))return this._glTexture;if(v(this._loadingPromise))return this._loadingPromise;const i=this._data;return R(i)?(this._glTexture=new mt(e,this._createDescriptor(e),null),this._glTexture):typeof i=="string"?this._loadFromURL(e,r,i):i instanceof Image?this._loadFromImageElement(e,r,i):i instanceof HTMLVideoElement?this._loadFromVideoElement(e,r,i):i instanceof ImageData||i instanceof HTMLCanvasElement?this._loadFromImage(e,i,r):(tM(i)||VT(i))&&this.params.encoding===F0.DDS_ENCODING?(this._data=void 0,this._loadFromDDSData(e,i)):(tM(i)||VT(i))&&this.params.encoding===F0.KTX2_ENCODING?(this._data=void 0,this._loadFromKTX2(e,i)):(tM(i)||VT(i))&&this.params.encoding===F0.BASIS_ENCODING?(this._data=void 0,this._loadFromBasis(e,i)):VT(i)?this._loadFromPixelData(e,i):tM(i)?this._loadFromPixelData(e,new Uint8Array(i)):null}get requiresFrameUpdates(){return this._data instanceof HTMLVideoElement}frameUpdate(e,r,i){if(!(this._data instanceof HTMLVideoElement)||R(this._glTexture)||this._data.readyState<Y$.HAVE_CURRENT_DATA||i===this._data.currentTime)return i;if(v(this._powerOfTwoStretchInfo)){const{framebuffer:n,vao:s,sourceTexture:o}=this._powerOfTwoStretchInfo;o.setData(this._data),this._drawStretchedTexture(e,r,n,s,o,this._glTexture)}else{const{videoWidth:n,videoHeight:s}=this._data,{width:o,height:a}=this._glTexture.descriptor;n!==o||s!==a?this._glTexture.updateData(0,0,0,Math.min(n,o),Math.min(s,a),this._data):this._glTexture.setData(this._data)}return this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this.params.updateCallback&&this.params.updateCallback(),this._data.currentTime}_loadFromDDSData(e,r){return this._glTexture=i2t(e,this._createDescriptor(e),r),this._glTexture}_loadFromKTX2(e,r){return this._loadAsync(()=>zSt(e,this._createDescriptor(e),r).then(i=>(this._glTexture=i,i)))}_loadFromBasis(e,r){return this._loadAsync(()=>USt(e,this._createDescriptor(e),r).then(i=>(this._glTexture=i,i)))}_loadFromPixelData(e,r){wt(this.params.width>0&&this.params.height>0);const i=this._createDescriptor(e);return i.pixelFormat=this.params.components===1?Ge.LUMINANCE:this.params.components===3?Ge.RGB:Ge.RGBA,i.width=this.params.width,i.height=this.params.height,this._glTexture=new mt(e,i,r),this._glTexture}_loadFromURL(e,r,i){return this._loadAsync(async n=>{const s=await O_(i,{signal:n});return lr(n),this._loadFromImage(e,s,r)})}_loadFromImageElement(e,r,i){return i.complete?this._loadFromImage(e,i,r):this._loadAsync(async n=>{const s=await jCe(i,i.src,!1,n);return lr(n),this._loadFromImage(e,s,r)})}_loadFromVideoElement(e,r,i){return i.readyState>=Y$.HAVE_CURRENT_DATA?this._loadFromImage(e,i,r):this._loadFromVideoElementAsync(e,r,i)}_loadFromVideoElementAsync(e,r,i){return this._loadAsync(n=>new Promise((s,o)=>{const a=()=>{i.removeEventListener("loadeddata",l),i.removeEventListener("error",c),$i(h)},l=()=>{i.readyState>=Y$.HAVE_CURRENT_DATA&&(a(),s(this._loadFromImage(e,i,r)))},c=p=>{a(),o(p||new H("Failed to load video"))};i.addEventListener("loadeddata",l),i.addEventListener("error",c);const h=Ua(n,()=>c(Vr()))}))}_loadFromImage(e,r,i){const n=DU._getDataDimensions(r);this.params.width=n.width,this.params.height=n.height;const s=this._createDescriptor(e);return s.pixelFormat=this.params.components===3?Ge.RGB:Ge.RGBA,!this._requiresPowerOfTwo(e,s)||lm(n.width)&&lm(n.height)?(s.width=n.width,s.height=n.height,this._glTexture=new mt(e,s,r),this._glTexture):(this._glTexture=this._makePowerOfTwoTexture(e,r,n,s,i),this._glTexture)}_loadAsync(e){const r=new AbortController;this._loadingController=r;const i=e(r.signal);this._loadingPromise=i;const n=()=>{this._loadingController===r&&(this._loadingController=null),this._loadingPromise===i&&(this._loadingPromise=null)};return i.then(n,n),i}_requiresPowerOfTwo(e,r){const i=$t.CLAMP_TO_EDGE,n=typeof r.wrapMode=="number"?r.wrapMode===i:r.wrapMode.s===i&&r.wrapMode.t===i;return e.type===Et.WEBGL1&&(r.hasMipmap||!n)}_makePowerOfTwoTexture(e,r,i,n,s){const{width:o,height:a}=i,l=fO(o),c=fO(a);let h;switch(n.width=l,n.height=c,this.params.powerOfTwoResizeMode){case kb.PAD:n.textureCoordinateScaleFactor=[o/l,a/c],h=new mt(e,n),h.updateData(0,0,0,o,a,r);break;case kb.STRETCH:case null:case void 0:h=this._stretchToPowerOfTwo(e,r,n,s());break;default:this.params.powerOfTwoResizeMode}return n.hasMipmap&&h.generateMipmap(),h}_stretchToPowerOfTwo(e,r,i,n){const s=new mt(e,i),o=new Jn(e,{colorTarget:xn.TEXTURE,depthStencilTarget:Ur.NONE},s),a=new mt(e,{target:Ct.TEXTURE_2D,pixelFormat:i.pixelFormat,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE,samplingMode:it.LINEAR,flipped:!!i.flipped,maxAnisotropy:8,preMultiplyAlpha:i.preMultiplyAlpha},r),l=vl(e),c=e.getBoundFramebufferObject();return this._drawStretchedTexture(e,n,o,l,a,s),this.requiresFrameUpdates?this._powerOfTwoStretchInfo={vao:l,sourceTexture:a,framebuffer:o}:(l.dispose(!0),a.dispose(),o.detachColorTexture(),o.dispose()),e.bindFramebuffer(c),s}_drawStretchedTexture(e,r,i,n,s,o){this._passParameters.texture=s,e.bindFramebuffer(i);const a=e.getViewport();e.setViewport(0,0,o.descriptor.width,o.descriptor.height),e.bindTechnique(r,this._passParameters,null),e.bindVAO(n),e.drawArrays(Ft.TRIANGLE_STRIP,0,Da(n,"geometry")),e.bindFramebuffer(null),e.setViewport(a.x,a.y,a.width,a.height),this._passParameters.texture=null}unload(){if(v(this._powerOfTwoStretchInfo)){const{framebuffer:e,vao:r,sourceTexture:i}=this._powerOfTwoStretchInfo;r.dispose(!0),i.dispose(),e.dispose(),this._glTexture=null,this._powerOfTwoStretchInfo=null}if(v(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null),v(this._loadingController)){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}};var Y$;(function(t){t[t.HAVE_NOTHING=0]="HAVE_NOTHING",t[t.HAVE_METADATA=1]="HAVE_METADATA",t[t.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t[t.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t[t.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(Y$||(Y$={}));const RD=128,Dle=.5;function R4e(t,e=RD,r=e*Dle,i=0){const n=s2t(t,e,r,i);return new W2(n,{mipmap:!1,wrap:{s:$t.CLAMP_TO_EDGE,t:$t.CLAMP_TO_EDGE},width:e,height:e,components:4,noUnpackFlip:!0})}function s2t(t,e=RD,r=e*Dle,i=0){switch(t){case"circle":default:return o2t(e,r);case"square":return a2t(e,r);case"cross":return c2t(e,r,i);case"x":return u2t(e,r,i);case"kite":return l2t(e,r);case"triangle":return h2t(e,r);case"arrow":return d2t(e,r)}}function o2t(t,e){const r=t/2-.5;return YN(t,P4e(r,r,e/2))}function a2t(t,e){return O4e(t,e,!1)}function l2t(t,e){return O4e(t,e,!0)}function c2t(t,e,r=0){return M4e(t,e,!1,r)}function u2t(t,e,r=0){return M4e(t,e,!0,r)}function h2t(t,e){return YN(t,I4e(t/2,e,e/2))}function d2t(t,e){const r=e,i=e/2,n=t/2,s=.8*r,o=P4e(n,(t-e)/2-s,Math.sqrt(s*s+i*i)),a=I4e(n,r,i);return YN(t,(l,c)=>Math.max(a(l,c),-o(l,c)))}function O4e(t,e,r){return r&&(e/=Math.SQRT2),YN(t,(i,n)=>{let s=i-.5*t+.25,o=.5*t-n-.75;if(r){const a=(s+o)/Math.SQRT2;o=(o-s)/Math.SQRT2,s=a}return Math.max(Math.abs(s),Math.abs(o))-.5*e})}function M4e(t,e,r,i=0){e-=i,r&&(e*=Math.SQRT2);const n=.5*e;return YN(t,(s,o)=>{let a,l=s-.5*t,c=.5*t-o-1;if(r){const h=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=h}return l=Math.abs(l),c=Math.abs(c),a=l>c?l>n?Math.sqrt((l-n)*(l-n)+c*c):c:c>n?Math.sqrt(l*l+(c-n)*(c-n)):l,a-=i/2,a})}function P4e(t,e,r){return(i,n)=>{const s=i-t,o=n-e;return Math.sqrt(s*s+o*o)-r}}function I4e(t,e,r){const i=Math.sqrt(e*e+r*r);return(n,s)=>{const o=Math.abs(n-t)-r,a=s-t+e/2+.75,l=(e*o+r*a)/i,c=-a;return Math.max(l,c)}}function YN(t,e){const r=new Uint8Array(4*t*t);for(let i=0;i<t;i++)for(let n=0;n<t;n++){const s=n+t*i;let o=e(n,i);o=o/t+.5,AD(o,r,4*s)}return r}let VXt=class extends wi{constructor(e){super(),this.slicePlaneLocalOrigin=e}};function p2t(t,e){$4e(t,e,[new Jt("slicePlaneOrigin",(r,i)=>F4e(e,r,i)),new Jt("slicePlaneBasis1",(r,i)=>{var n;return CV(e,r,i,(n=i.slicePlane)==null?void 0:n.basis1)}),new Jt("slicePlaneBasis2",(r,i)=>{var n;return CV(e,r,i,(n=i.slicePlane)==null?void 0:n.basis2)})])}function hs(t,e){$4e(t,e,[new Kh("slicePlaneOrigin",(r,i)=>F4e(e,r,i)),new Kh("slicePlaneBasis1",(r,i)=>{var n;return CV(e,r,i,(n=i.slicePlane)==null?void 0:n.basis1)}),new Kh("slicePlaneBasis2",(r,i)=>{var n;return CV(e,r,i,(n=i.slicePlane)==null?void 0:n.basis2)})])}function $4e(t,e,r){if(!e.hasSlicePlane){const o=S`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return e.hasSliceInVertexProgram&&t.vertex.code.add(o),void t.fragment.code.add(o)}t.extensions.add("GL_OES_standard_derivatives"),e.hasSliceInVertexProgram&&t.vertex.uniforms.add(r),t.fragment.uniforms.add(r);const i=S`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,n=S`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,s=e.hasSliceHighlight?S`
        ${n}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:S`#define highlightSlice(_color_, _pos_) (_color_)`;e.hasSliceInVertexProgram&&t.vertex.code.add(i),t.fragment.code.add(i),t.fragment.code.add(s)}function L4e(t,e,r){return t.instancedDoublePrecision?he(f2t,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]):e.slicePlaneLocalOrigin}function D4e(t,e){return v(t)?ge(AV,e.origin,t):e.origin}function N4e(t,e,r){return t.hasSliceTranslatedView?v(e)?Hc(m2t,r.camera.viewMatrix,e):r.camera.viewMatrix:null}function F4e(t,e,r){if(R(r.slicePlane))return cl;const i=L4e(t,e,r),n=D4e(i,r.slicePlane),s=N4e(t,i,r);return v(s)?Ke(AV,n,s):n}function CV(t,e,r,i){if(R(i)||R(r.slicePlane))return cl;const n=L4e(t,e,r),s=D4e(n,r.slicePlane),o=N4e(t,n,r);return v(o)?(me(zM,i,s),Ke(AV,s,o),Ke(zM,zM,o),ge(zM,zM,AV)):i}const f2t=P(),AV=P(),zM=P(),m2t=$e();function g7(t,e){const r=e.output===V.ObjectAndLayerIdColor,i=e.objectAndLayerIdColorInstanced;r&&(t.varyings.add("objectAndLayerIdColorVarying","vec4"),i?t.attributes.add(O.OBJECTANDLAYERIDCOLOR_INSTANCED,"vec4"):t.attributes.add(O.OBJECTANDLAYERIDCOLOR,"vec4")),t.vertex.code.add(S`
     void forwardObjectAndLayerIdColor() {
      ${r?i?S`objectAndLayerIdColorVarying = objectAndLayerIdColor_instanced * 0.003921568627451;`:S`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:S``} }`),t.fragment.code.add(S`
      void outputObjectAndLayerIdColor() {
        ${r?S`gl_FragColor = objectAndLayerIdColorVarying;`:S``} }`)}function g2t(t,e){const{vertex:r,fragment:i}=t;e.hasMultipassGeometry&&r.include(zDe),e.hasMultipassTerrain&&t.varyings.add("depth","float"),r.code.add(S`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${e.hasMultipassGeometry?S`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${e.hasMultipassTerrain?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),e.hasMultipassTerrain&&i.include(sd),e.hasMultipassTerrain&&i.uniforms.add([...rm("terrainDepthTexture",(n,s)=>s.multipassTerrain.linearDepthTexture,e.hasWebGL2Context?oi.None:oi.InvSize),new Hr("nearFar",(n,s)=>s.camera.nearFar)]),i.include(Qu),i.code.add(S`
  void main() {
    gl_FragColor = vec4(1, 1, 1, 1);
    ${e.hasMultipassTerrain?S`
          vec2 uv = gl_FragCoord.xy;

          // Read the rgba data from the texture linear depth
          vec4 terrainDepthData = ${Wl(e,"terrainDepthTexture","uv")};

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          // If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          // Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            gl_FragColor.g = 0.5;
          }`:""}
  }
  `)}const y2t=Zt(1,1,0,1),k4e=Zt(1,0,1,1);function W_(t,e){t.fragment.uniforms.add(rm("depthTex",(r,i)=>i.highlightDepthTexture,e.hasWebGL2Context?oi.None:oi.InvSize)),t.fragment.constants.add("occludedHighlightFlag","vec4",y2t).add("unoccludedHighlightFlag","vec4",k4e),t.fragment.code.add(S`
    void outputHighlight() {
      vec3 fragCoord = gl_FragCoord.xyz;

      float sceneDepth = ${Wl(e,"depthTex","fragCoord.xy")}.x;
      if (fragCoord.z > sceneDepth + 5e-7) {
        gl_FragColor = occludedHighlightFlag;
      }
      else {
        gl_FragColor = unoccludedHighlightFlag;
      }
    }
  `)}let y7=class extends Ln{constructor(e,r,i){super(e,"vec4",_i.Pass,(n,s,o)=>n.setUniform4fv(e,r(s,o)),i)}},ol=class extends Ln{constructor(e,r,i){super(e,"float",_i.Pass,(n,s,o)=>n.setUniform1fv(e,r(s,o)),i)}},Nle=class extends z3{constructor(){super(...arguments),this.vvSizeEnabled=!1,this.vvSizeMinSize=ke(1,1,1),this.vvSizeMaxSize=ke(100,100,100),this.vvSizeOffset=ke(0,0,0),this.vvSizeFactor=ke(1,1,1),this.vvSizeValue=ke(1,1,1),this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvOpacityEnabled=!1,this.vvOpacityValues=[0,0,0,0,0,0,0,0],this.vvOpacityOpacities=[1,1,1,1,1,1,1,1],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=vi()}};const nm=8;function GR(t,e){e.hasVvInstancing&&(e.vvSize||e.vvColor)&&t.attributes.add(O.INSTANCEFEATUREATTRIBUTE,"vec4");const r=t.vertex;e.vvSize?(r.uniforms.add(new Jt("vvSizeMinSize",i=>i.vvSizeMinSize)),r.uniforms.add(new Jt("vvSizeMaxSize",i=>i.vvSizeMaxSize)),r.uniforms.add(new Jt("vvSizeOffset",i=>i.vvSizeOffset)),r.uniforms.add(new Jt("vvSizeFactor",i=>i.vvSizeFactor)),r.uniforms.add(new wy("vvSymbolRotationMatrix",i=>i.vvSymbolRotationMatrix)),r.uniforms.add(new Jt("vvSymbolAnchor",i=>i.vvSymbolAnchor)),r.code.add(S`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),r.code.add(S`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${e.hasVvInstancing?S`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):r.code.add(S`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),e.vvColor?(r.constants.add("vvColorNumber","int",nm),e.hasVvInstancing&&r.uniforms.add([new ol("vvColorValues",i=>i.vvColorValues,nm),new y7("vvColorColors",i=>i.vvColorColors,nm)]),r.code.add(S`
      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {
        float value = featureAttribute.y;
        if (value <= values[0]) {
          return colors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (values[i] >= value) {
            float f = (value - values[i-1]) / (values[i] - values[i-1]);
            return mix(colors[i-1], colors[i], f);
          }
        }
        return colors[vvColorNumber - 1];
      }

      ${e.hasVvInstancing?S`
      vec4 vvColor() {
        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);
      }`:""}
    `)):r.code.add(S`vec4 vvColor() { return vec4(1.0); }`)}const RV=.1,Fa=.001;function _2t(t){const e=new Br,r=t.signedDistanceFieldEnabled;if(e.include(Zae),e.include(u4e,t),e.include(hs,t),t.occlusionPass)return e.include(g2t,t),e;const{vertex:i,fragment:n}=e;e.include(Cle),n.include(Qu),n.include(by),e.include(GR,t),e.include(g7,t),e.varyings.add("vcolor","vec4"),e.varyings.add("vtc","vec2"),e.varyings.add("vsize","vec2"),t.binaryHighlightOcclusionEnabled&&e.varyings.add("voccluded","float"),i.uniforms.add([new br("viewport",(c,h)=>h.camera.fullViewport),new Hr("screenOffset",(c,h)=>dt(U4e,2*c.screenOffset[0]*h.camera.pixelRatio,2*c.screenOffset[1]*h.camera.pixelRatio)),new Hr("anchorPosition",c=>OV(c)),new br("materialColor",c=>c.color),new Ie("pixelRatio",(c,h)=>h.camera.pixelRatio)]),r&&(i.uniforms.add(new br("outlineColor",c=>c.outlineColor)),n.uniforms.add([new br("outlineColor",c=>o_e(c)?c.outlineColor:Wg),new Ie("outlineSize",c=>o_e(c)?c.outlineSize:0)])),t.hasScreenSizePerspective&&(bSt(i),f7(i)),(t.debugDrawLabelBorder||t.binaryHighlightOcclusionEnabled)&&e.varyings.add("debugBorderCoords","vec4"),e.attributes.add(O.UV0,"vec2"),e.attributes.add(O.COLOR,"vec4"),e.attributes.add(O.SIZE,"vec2"),e.attributes.add(O.AUXPOS2,"vec4"),i.code.add(S`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${t.hasScreenSizePerspective?S`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:S`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${t.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${t.occlusionTestEnabled||t.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${t.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const s=S`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,o=t.pixelSnappingEnabled?r?S`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:S`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:S`posProj += quadOffset;`;t.vvColor&&i.uniforms.add([new y7("vvColorColors",c=>c.vvColorColors,nm),new ol("vvColorValues",c=>c.vvColorValues,nm)]),i.uniforms.add(new Hr("textureCoordinateScaleFactor",c=>v(c.texture)&&v(c.texture.descriptor.textureCoordinateScaleFactor)?c.texture.descriptor.textureCoordinateScaleFactor:zIe)),i.code.add(S`
    ${t.occlusionTestEnabled?"if (visible) {":""}
    ${s}
    ${t.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${t.output===V.ObjectAndLayerIdColor?S`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${S.float(Fa)};
    ${r?`alphaDiscard = alphaDiscard && outlineColor.a < ${S.float(Fa)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${o}
      gl_Position = posProj;
    }

    vtc = uv * textureCoordinateScaleFactor;

    ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${t.occlusionTestEnabled?S`} else { vtc = vec2(0.0);
      ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),n.uniforms.add(new Dt("tex",c=>c.texture));const a=t.debugDrawLabelBorder?S`(isBorder > 0.0 ? 0.0 : ${S.float(RV)})`:S.float(RV),l=S`
    ${t.debugDrawLabelBorder?S`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${r?S`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${S.float(RD)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${S.float(Fa)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:S`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${t.debugDrawLabelBorder?S`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;return t.output===V.Alpha&&n.code.add(S`
      void main() {
        ${l}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `),t.output===V.ObjectAndLayerIdColor&&n.code.add(S`
      void main() {
        ${l}
        outputObjectAndLayerIdColor();
      }
      `),t.output===V.Color&&n.code.add(S`
    void main() {
      ${l}
      ${t.transparencyPassType===At.FrontFace?"gl_FragColor.rgb /= gl_FragColor.a;":""}
    }
    `),t.output===V.Highlight&&(e.include(W_,t),n.code.add(S`
    void main() {
      ${l}
      ${t.binaryHighlightOcclusionEnabled?S`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),e}function o_e(t){return t.outlineColor[3]>0&&t.outlineSize>0}function OV(t,e=U4e){return t.textureIsSignedDistanceField?v2t(t.anchorPosition,t.distanceFieldBoundingBox,e):Qs(e,t.anchorPosition),e}function v2t(t,e,r){v(e)?dt(r,t[0]*(e[2]-e[0])+e[0],t[1]*(e[3]-e[1])+e[1]):dt(r,0,0)}const U4e=Ne(),b2t=Object.freeze(Object.defineProperty({__proto__:null,build:_2t,calculateAnchorPosForRendering:OV},Symbol.toStringTag,{value:"Module"})),Qh=mo(Ce.SRC_ALPHA,Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA,Ce.ONE_MINUS_SRC_ALPHA),w2t=bm(Ce.ONE,Ce.ONE),z4e=bm(Ce.ZERO,Ce.ONE_MINUS_SRC_ALPHA);function X_(t){return t===At.FrontFace?null:t===At.Alpha?z4e:w2t}function _7(t){return t===At.FrontFace?Xc:null}const v7=5e5,b7={factor:-1,units:-2};function w7(t){return t?b7:null}function kw(t,e=zi.LESS){return t===At.NONE||t===At.FrontFace?e:zi.LEQUAL}let V4e=class B4e extends Wr{initializeConfiguration(e,r){r.hasWebGL2Context=e.rctx.type===Et.WEBGL2,r.spherical=e.viewingMode===qe.Global}initializeProgram(e){return new Gr(e.rctx,B4e.shader.get().build(this.configuration),Lr)}_setPipelineState(e){const r=this.configuration,i=e===At.NONE,n=e===At.FrontFace,s=this.configuration.hasPolygonOffset?x2t:null,o=(i||n)&&r.output!==V.Highlight&&(r.depthEnabled||r.occlusionPass)?Xc:null;return Ht({blending:r.output===V.Color||r.output===V.Alpha||r.output===V.Highlight?i?T2t:X_(e):null,depthTest:{func:zi.LEQUAL},depthWrite:o,colorWrite:ir,polygonOffset:s})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return this.configuration.occlusionPass?Ft.POINTS:Ft.TRIANGLES}};V4e.shader=new jr(b2t,()=>Q(()=>import("./HUDMaterial.glsl-f5cca7bc.js"),[]));const x2t={factor:0,units:-4},T2t=bm(Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA);let is=class extends Io{constructor(){super(...arguments),this.output=V.Color,this.screenCenterOffsetUnitsEnabled=kc.World,this.transparencyPassType=At.NONE,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.binaryHighlightOcclusionEnabled=!0,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.isDraped=!1,this.hasMultipassGeometry=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}};u([j({count:V.COUNT})],is.prototype,"output",void 0),u([j({count:kc.COUNT})],is.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([j({count:At.COUNT})],is.prototype,"transparencyPassType",void 0),u([j()],is.prototype,"spherical",void 0),u([j()],is.prototype,"occlusionTestEnabled",void 0),u([j()],is.prototype,"signedDistanceFieldEnabled",void 0),u([j()],is.prototype,"vvSize",void 0),u([j()],is.prototype,"vvColor",void 0),u([j()],is.prototype,"hasVerticalOffset",void 0),u([j()],is.prototype,"hasScreenSizePerspective",void 0),u([j()],is.prototype,"debugDrawLabelBorder",void 0),u([j()],is.prototype,"binaryHighlightOcclusionEnabled",void 0),u([j()],is.prototype,"hasSlicePlane",void 0),u([j()],is.prototype,"hasPolygonOffset",void 0),u([j()],is.prototype,"depthEnabled",void 0),u([j()],is.prototype,"pixelSnappingEnabled",void 0),u([j()],is.prototype,"isDraped",void 0),u([j()],is.prototype,"hasMultipassGeometry",void 0),u([j()],is.prototype,"hasMultipassTerrain",void 0),u([j()],is.prototype,"cullAboveGround",void 0),u([j()],is.prototype,"occlusionPass",void 0),u([j()],is.prototype,"objectAndLayerIdColorInstanced",void 0),u([j({constValue:!0})],is.prototype,"hasSliceInVertexProgram",void 0),u([j({constValue:!1})],is.prototype,"hasVvInstancing",void 0);let JO=class extends Fw{constructor(e){super(e,new $2t),this._configuration=new is}getConfiguration(e,r){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?kc.Screen:kc.World,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.isDraped=this.parameters.isDraped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.vvSize=!!this.parameters.vvSizeEnabled,this._configuration.vvColor=!!this.parameters.vvColorEnabled,this._configuration.occlusionPass=r.slot===Ee.OCCLUSION_PIXELS&&this.parameters.occlusionTest&&(e===V.Color||e===V.Alpha),e===V.Color&&(this._configuration.debugDrawLabelBorder=!!Qr.LABELS_SHOW_BORDER),e===V.Highlight&&(this._configuration.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassGeometry=r.multipassGeometry.enabled,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}intersect(e,r,i,n,s,o){if(!i.options.selectionMode||!i.options.hud||!e.visible)return;const a=this.parameters;let l=1,c=1;if(Op(xq,r),v(e.shaderTransformer)){const x=e.shaderTransformer(c_e);l=x[0],c=x[5],C2t(xq)}const h=e.vertexAttributes.get(O.POSITION),p=e.vertexAttributes.get(O.SIZE),f=e.vertexAttributes.get(O.NORMAL),m=e.vertexAttributes.get(O.AUXPOS1);wt(h.size>=3);const g=i.point,_=i.camera,b=OV(a);l*=_.pixelRatio,c*=_.pixelRatio;const w=this.parameters.centerOffsetUnits==="screen";for(let x=0;x<h.data.length/h.size;x++){const T=x*h.size;he(Ya,h.data[T],h.data[T+1],h.data[T+2]),Ke(Ya,Ya,r);const E=x*p.size;Ev[0]=p.data[E]*l,Ev[1]=p.data[E+1]*c,Ke(Ya,Ya,_.viewMatrix);const C=x*m.size;if(he(lh,m.data[C+0],m.data[C+1],m.data[C+2]),!w&&(Ya[0]+=lh[0],Ya[1]+=lh[1],lh[2]!==0)){const I=lh[2];we(lh,Ya),ge(Ya,Ya,le(lh,lh,I))}const A=x*f.size;if(he(VM,f.data[A],f.data[A+1],f.data[A+2]),this._normalAndViewAngle(VM,xq,_,Tq),this._applyVerticalOffsetTransformationView(Ya,Tq,_,wq),_.applyProjection(Ya,Al),Al[0]>-1){Al[0]=Math.floor(Al[0]),Al[1]=Math.floor(Al[1]),w&&(lh[0]||lh[1])&&(Al[0]+=lh[0],lh[1]!==0&&(Al[1]+=Ele(lh[1],wq.factorAlignment)),_.unapplyProjection(Al,Ya)),Al[0]+=this.parameters.screenOffset[0],Al[1]+=this.parameters.screenOffset[1],t4e(Ev,wq.factor,Ev);const I=M2t*_.pixelRatio;let M=0;if(a.textureIsSignedDistanceField&&(M=a.outlineSize*_.pixelRatio/2),g&&a_e(g,Al[0],Al[1],Ev,I,M,a,b)){const D=i.ray;if(Ke(l_e,Ya,ya(O2t,_.viewMatrix)),Al[0]=g[0],Al[1]=g[1],_.unprojectFromRenderScreen(Al,Ya)){const U=P();ce(U,D.direction);const z=1/Pe(U);le(U,U,z),o(Pi(D.origin,Ya)*z,U,-1,!0,1,l_e)}}}}}intersectDraped(e,r,i,n,s,o){const a=e.vertexAttributes.get(O.POSITION),l=e.vertexAttributes.get(O.SIZE),c=this.parameters,h=OV(c);let p=1,f=1;if(v(e.shaderTransformer)){const g=e.shaderTransformer(c_e);p=g[0],f=g[5]}p*=e.screenToWorldRatio,f*=e.screenToWorldRatio;const m=P2t*e.screenToWorldRatio;for(let g=0;g<a.data.length/a.size;g++){const _=g*a.size,b=a.data[_],w=a.data[_+1],x=g*l.size;Ev[0]=l.data[x]*p,Ev[1]=l.data[x+1]*f;let T=0;c.textureIsSignedDistanceField&&(T=c.outlineSize*e.screenToWorldRatio/2),a_e(n,b,w,Ev,m,T,c,h)&&s(o.dist,o.normal,-1,!1)}}createBufferWriter(){return new D2t(this)}_normalAndViewAngle(e,r,i,n){return vSt(r)&&(r=Op(R2t,r)),Gl(n.normal,e,r),Ke(n.normal,n.normal,i.viewInverseTransposeMatrix),n.cosAngle=ve(j4e,I2t),n}_updateScaleInfo(e,r,i){const n=this.parameters;v(n.screenSizePerspective)?Q0e(i,r,n.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),v(n.screenSizePerspectiveAlignment)?Q0e(i,r,n.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)}applyShaderOffsetsView(e,r,i,n,s,o,a){const l=this._normalAndViewAngle(r,i,s,Tq);return this._applyVerticalGroundOffsetView(e,l,s,a),this._applyVerticalOffsetTransformationView(a,l,s,o),this._applyPolygonOffsetView(a,l,n[3],s,a),this._applyCenterOffsetView(a,n,a),a}applyShaderOffsetsNDC(e,r,i,n,s){return this._applyCenterOffsetNDC(e,r,i,n),v(s)&&ce(s,n),this._applyPolygonOffsetNDC(n,r,i,n),n}_applyPolygonOffsetView(e,r,i,n,s){const o=n.aboveGround?1:-1;let a=Math.sign(i);a===0&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return ce(s,e);const c=_e(Math.abs(r.cosAngle),.01,1),h=1-Math.sqrt(1-c*c)/c/n.viewport[2];return le(s,e,l>0?h:1/h),s}_applyVerticalGroundOffsetView(e,r,i,n){const s=Pe(e),o=i.aboveGround?1:-1,a=.5*i.computeRenderPixelSizeAtDist(s),l=le(Ya,r.normal,o*a);return me(n,e,l),n}_applyVerticalOffsetTransformationView(e,r,i,n){const s=this.parameters;if(!s.verticalOffset||!s.verticalOffset.screenLength){if(s.screenSizePerspective||s.screenSizePerspectiveAlignment){const c=Pe(e);this._updateScaleInfo(n,c,r.cosAngle)}else n.factor.scale=1,n.factorAlignment.scale=1;return e}const o=Pe(e),a=Nt(s.screenSizePerspectiveAlignment,s.screenSizePerspective),l=m4e(i,o,s.verticalOffset,r.cosAngle,a);return this._updateScaleInfo(n,o,r.cosAngle),le(r.normal,r.normal,l),me(e,e,r.normal)}_applyCenterOffsetView(e,r,i){const n=this.parameters.centerOffsetUnits!=="screen";return i!==e&&ce(i,e),n&&(i[0]+=r[0],i[1]+=r[1],r[2]&&(we(VM,i),me(i,i,le(VM,VM,r[2])))),i}_applyCenterOffsetNDC(e,r,i,n){const s=this.parameters.centerOffsetUnits!=="screen";return n!==e&&ce(n,e),s||(n[0]+=r[0]/i.fullWidth*2,n[1]+=r[1]/i.fullHeight*2),n}_applyPolygonOffsetNDC(e,r,i,n){const s=this.parameters.shaderPolygonOffset;if(e!==n&&ce(n,e),s){const o=i.aboveGround?1:-1,a=o*Math.sign(r[3]);n[2]-=(a||o)*s}return n}requiresSlot(e,r){if(r===V.Color||r===V.Alpha||r===V.Highlight||r===V.ObjectAndLayerIdColor){if(e===Ee.DRAPED_MATERIAL)return!0;const{drawInSecondSlot:i,occlusionTest:n}=this.parameters;return e===(i?Ee.LABEL_MATERIAL:Ee.HUD_MATERIAL)||n&&e===Ee.OCCLUSION_PIXELS}return!1}createGLMaterial(e){return new S2t(e)}calculateRelativeScreenBounds(e,r,i=Kt()){return E2t(this.parameters,e,r,i),i[2]=i[0]+e[0],i[3]=i[1]+e[1],i}},S2t=class extends Pae{constructor(e){super({...e,...e.material.parameters})}selectProgram(e){return this.ensureTechnique(V4e,e)}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}};function E2t(t,e,r,i=A2t){return Qs(i,t.anchorPosition),i[0]*=-e[0],i[1]*=-e[1],i[0]+=t.screenOffset[0]*r,i[1]+=t.screenOffset[1]*r,i}function C2t(t){const e=t[0],r=t[1],i=t[2],n=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=1/Math.sqrt(e*e+r*r+i*i),p=1/Math.sqrt(n*n+s*s+o*o),f=1/Math.sqrt(a*a+l*l+c*c);return t[0]=e*h,t[1]=r*h,t[2]=i*h,t[3]=n*p,t[4]=s*p,t[5]=o*p,t[6]=a*f,t[7]=l*f,t[8]=c*f,t}function a_e(t,e,r,i,n,s,o,a){let l=e-n-(a[0]>0?i[0]*a[0]:0),c=l+i[0]+2*n,h=r-n-(a[1]>0?i[1]*a[1]:0),p=h+i[1]+2*n;const f=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&v(f)&&(l+=i[0]*f[0],h+=i[1]*f[1],c-=i[0]*(1-f[2]),p-=i[1]*(1-f[3]),l-=s,c+=s,h-=s,p+=s),t[0]>l&&t[0]<c&&t[1]>h&&t[1]<p}const wq=new v4e,A2t=Ne(),Ya=P(),VM=P(),Al=pr(),j4e=P(),l_e=P(),xq=vi(),R2t=vi(),O2t=$e(),lh=P(),Tq={normal:j4e,cosAngle:0},c_e=$e(),M2t=1,P2t=2,Ev=[0,0],I2t=ke(0,0,1);let $2t=class extends MDe{constructor(){super(...arguments),this.renderOccluded=vn.Occlude,this.color=Zt(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=Rr(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.outlineColor=Zt(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.binaryHighlightOcclusion=!0,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1}};const G4e=mn().vec3f(O.POSITION).vec3f(O.NORMAL).vec2f(O.UV0).vec4u8(O.COLOR).vec2f(O.SIZE).vec4f(O.AUXPOS1).vec4f(O.AUXPOS2),L2t=G4e.clone().vec4u8(O.OBJECTANDLAYERIDCOLOR);let D2t=class{constructor(e){this._material=e,this.vertexBufferLayout=ue("enable-feature:objectAndLayerId-rendering")?L2t:G4e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 6*e.indices.get(O.POSITION).length}write(e,r,i,n,s){m7(i.indices.get(O.POSITION),i.vertexAttributes.get(O.POSITION).data,e,n.position,s,6),Mle(i.indices.get(O.NORMAL),i.vertexAttributes.get(O.NORMAL).data,r,n.normal,s,6);const o=i.vertexAttributes.get(O.UV0).data;let a,l,c,h;if(o==null||o.length<4){const w=this._material.parameters;a=0,l=0,c=w.texCoordScale[0],h=w.texCoordScale[1]}else a=o[0],l=o[1],c=o[2],h=o[3];c=Math.min(1.99999,c+1),h=Math.min(1.99999,h+1);let p=i.indices.get(O.POSITION).length,f=s;const m=n.uv0;for(let w=0;w<p;++w)m.set(f,0,a),m.set(f,1,l),f+=1,m.set(f,0,c),m.set(f,1,l),f+=1,m.set(f,0,c),m.set(f,1,h),f+=1,m.set(f,0,c),m.set(f,1,h),f+=1,m.set(f,0,a),m.set(f,1,h),f+=1,m.set(f,0,a),m.set(f,1,l),f+=1;Ple(i.indices.get(O.COLOR),i.vertexAttributes.get(O.COLOR).data,4,n.color,s,6);const g=i.indices.get(O.SIZE),_=i.vertexAttributes.get(O.SIZE).data;p=g.length;const b=n.size;f=s;for(let w=0;w<p;++w){const x=_[2*g[w]],T=_[2*g[w]+1];for(let E=0;E<6;++E)b.set(f,0,x),b.set(f,1,T),f+=1}if(i.indices.get(O.AUXPOS1)&&i.vertexAttributes.get(O.AUXPOS1)?ZO(i.indices.get(O.AUXPOS1),i.vertexAttributes.get(O.AUXPOS1).data,n.auxpos1,s,6):s_e(n.auxpos1,s,6*p),i.indices.get(O.AUXPOS2)&&i.vertexAttributes.get(O.AUXPOS2)?ZO(i.indices.get(O.AUXPOS2),i.vertexAttributes.get(O.AUXPOS2).data,n.auxpos2,s,6):s_e(n.auxpos2,s,6*p),v(i.objectAndLayerIdColor)&&i.indices.get(O.POSITION)){const w=i.indices.get(O.POSITION).length,x=n.getField(O.OBJECTANDLAYERIDCOLOR,gl);w4e(i.objectAndLayerIdColor,x,w,s,6)}}};const Pm=P(),ME=pr(),BM=pr(),Sq=P(),N2t=$e(),F2t=Os(),Eq=Do(),k2t=P(),U2t=Kt();class z2t{constructor(){this.aabr=Kt(),this.distance=0,this.culled=!1,this.visible=!1}}class V2t{constructor(e,r){this.graphics3DGraphic=e,this.slicePlaneEnabled=r,this.info={}}}var xu;(function(t){t[t.Idle=0]="Idle",t[t.Process=1]="Process",t[t.Sort=2]="Sort",t[t.Deconflict=3]="Deconflict",t[t.NumStates=4]="NumStates"})(xu||(xu={}));class H4e{constructor(){this.camera=new Pt,this.slicePlane=k_(),this.slicePlaneEnabled=!1}copyFrom(e){this.camera.copyFrom(e.camera),G2(e.slicePlane,this.slicePlane),this.slicePlaneEnabled=e.slicePlaneEnabled}}let oR=class extends be{get dirty(){return this._dirty}get state(){return this._state}constructor(t){super(t),this._dirty=!1,this._runningViewState=new H4e,this._state=xu.Idle,this._active=new Map,this._visible=new Map,this._iterators=new H2t,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null,this.accNumTests=0}destroy(){this._active.clear(),this._visible.clear(),this._iterators=null}setDirty(){!this._dirty&&this._active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==xu.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const t=this._state/xu.NumStates;return this._dirty?.5*t:t}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(t){switch(this._state){case xu.Idle:this._startUpdate(),t.madeProgress();case xu.Process:if(this._state=xu.Process,!this._processActiveGraphics(t))return;case xu.Sort:if(this._state=xu.Sort,!this._sortVisibleGraphics(t))return;case xu.Deconflict:if(this._state=xu.Deconflict,!this._deconflictVisibleGraphics(t))return;default:lSt(this,this._visible),this._state=xu.Idle,this.notifyChange("updating")}}modifyGraphics(t,e){e?t.forEach(r=>this.addToActiveGraphics(r)):t.forEach(r=>this.removeFromActiveGraphics(r)),this.setDirty()}layerSupportsDeconfliction(t){if(R(t)||t.type!=="object3d")return!1;const e=t.stageObject;if((e?e.geometries.length:0)!==1)return!1;const r=e==null?void 0:e.geometries[0];return(r==null?void 0:r.material)instanceof JO}_startUpdate(){cSt(this.view),this._dirty=!1,this._runningViewState.copyFrom(this.viewState);const{fullWidth:t,fullHeight:e}=this._runningViewState.camera;this._initBins(t,e),this._resetIterators()}addToActiveGraphics(t){t.info[this.visibilityGroup]=new z2t,this._active.set(t.graphics3DGraphic.graphic.uid,t),this.setDirty()}removeFromActiveGraphics(t){this._visible.delete(t.graphics3DGraphic.graphic.uid),B2t(t,this.visibilityGroup),delete t.info[this.visibilityGroup],this._active.delete(t.graphics3DGraphic.graphic.uid),this.setDirty()}_processActiveGraphics(t){const e=this._ensureActiveGraphicsIterator(),r=_3(N2t,this._runningViewState.camera.projectionMatrix),i=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._runningViewState.camera.relativeElevation>0?F2t:null;let n=0;for(v(i)&&(Ke(i,cl,this._runningViewState.camera.viewMatrix),i[3]=ii(this.view.spatialReference).radius,n=ALe(i,cl));!t.done;){t.madeProgress();const s=e.next();if(s.done===!0)return this._resetActiveGraphicsIterator(),!0;const o=s.value,a=o&&o.info[this.visibilityGroup];a&&(this._collectGraphics3DGraphics(o,r,i,n),a.culled?this._visible.delete(o.graphics3DGraphic.graphic.uid):this._visible.set(o.graphics3DGraphic.graphic.uid,o))}return!1}_sortVisibleGraphics(t){const e=this._ensureSortGraphicsIterator();for(;!t.done;){const r=e.next();if(t.madeProgress(),r.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(t){const e=this._ensureVisibleGraphicsIterator(),r=this.visibilityGroup===aa.LABEL;for(;!t.done;){t.madeProgress();const i=e.next();if(i.done===!0)return this._resetVisibleGraphicsIterator(),!0;const n=i.value,s=n.info[this.visibilityGroup];if(!s||s.culled)continue;const o=n.graphics3DGraphic,a=(!r||o.isVisible())&&!this._isConflicted(n);a&&this._addToBins(n),s.visible=a,this._setGraphicVisibility(n,a),hSt(s,a)}return!1}_resetIterators(){this._iterators.active=null,this._iterators.visible=null,this._iterators.sort=null}_ensureActiveGraphicsIterator(){return this._iterators.active||(this._iterators.active=u_e(this._active)),this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){return this._iterators.visible||(this._iterators.visible=u_e(this._visible)),this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){return this._iterators.sort||(this._iterators.sort=j2t(this._visible,this._iterators.sortArray,this.visibilityGroup)),this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(t,e,r,i){const n=t.graphics3DGraphic;if(n.destroyed)return;const s=t.info[this.visibilityGroup];if(!n.isVisible(aa.GRAPHIC,Iu.DECONFLICTION))return void(s.culled=!0);const o=this.getGraphicsLayers(n);td(s.aabr);let a=null;for(const l of o){if(!this.layerSupportsDeconfliction(l))continue;const c=l.stageObject.geometries[0].material;if(R(a)){if(a=X2t,this._getProjectionInfo(l,e,a),a.isOutsideScreen||this._isCulledBySlice(t,Pm)||v(r)&&this._isCulledByHorizon(a,r,i))return void(s.culled=!0);!Qr.TESTS_DISABLE_OPTIMIZATIONS&&s.visible&&(a.distance*=.7)}this._expandBoundingRect(s,l,c,a)}R(a)?s.culled=!0:(s.distance=a.distance,s.culled=!1)}_getProjectionInfo(t,e,r){const i=this._runningViewState.camera,n=t.stageObject,s=n.geometries[0],o=s.material,a=n.boundingVolumeWorldSpace.bounds;Ke(Pm,a,i.viewMatrix);const l=s.vertexAttributes,c=l.get(O.NORMAL).data,h=l.get(O.AUXPOS1).data;o.applyShaderOffsetsView(Pm,c,n.transformation,h,i,r.scaleInfo,Pm),ai(ME,Pm[0],Pm[1],Pm[2],1),qh(BM,ME,i.projectionMatrix),le(r.positionNDC,BM,1/BM[3]),o.applyShaderOffsetsNDC(r.positionNDC,h,i,r.positionNDC,Sq),r.distanceWithoutPolygonOffset=i.depthNDCToWorld(Sq[2]),r.distance=Sq[2]===r.positionNDC[2]?r.distanceWithoutPolygonOffset:i.depthNDCToWorld(r.positionNDC[2]),ai(BM,r.positionNDC[0],r.positionNDC[1],r.positionNDC[2],1),qh(ME,BM,e),h3(ME,ME,1/ME[3]),he(r.positionView,Pm[0],Pm[1],Pm[2])}_isCulledByHorizon(t,e,r){return ce(Eq.direction,t.positionView),he(Eq.origin,0,0,0),!!Dw(e,Eq,k2t)&&t.distanceWithoutPolygonOffset>r}_isCulledBySlice(t,e){return t.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&gae(this._runningViewState.slicePlane,e)}_expandBoundingRect(t,e,r,{positionNDC:i,scaleInfo:n}){const s=this._runningViewState.camera,o=e.getScreenSize(q2t);t4e(o,n.factor,o),o[0]*=s.pixelRatio,o[1]*=s.pixelRatio;const a=tz(r.calculateRelativeScreenBounds(o,n.factorAlignment.scale,U2t),Bt(0,s.fullWidth,.5+.5*i[0]),Bt(0,s.fullHeight,.5+.5*i[1])),l=this.iconMarginFactor;if(l!==0){const c=l*Math.min(Bh(a),cm(a));a[0]-=c,a[1]-=c,a[2]+=c,a[3]+=c}$b(t.aabr,a,t.aabr)}_isConflicted(t){const e=t.graphics3DGraphic.graphic.uid,r=t.info[this.visibilityGroup];for(let i=Math.floor(r.aabr[0]/this._accBinsSizeX);i<=Math.floor(r.aabr[2]/this._accBinsSizeX);i++)if(!(i<0||i>=this._accBinsNumX))for(let n=Math.floor(r.aabr[1]/this._accBinsSizeY);n<=Math.floor(r.aabr[3]/this._accBinsSizeY);n++){if(n<0||n>=this._accBinsNumY)continue;const s=this._accBins[i][n];for(let o=0;o<s.length;o++){const a=s.data[o],l=a.info[this.visibilityGroup];if(l&&l.visible&&a.graphics3DGraphic.graphic.uid!==e&&(this.accNumTests++,V9(l.aabr,r.aabr)))return!0}}return!1}_initBins(t,e){if(this._accBins==null){this._accBins=[];for(let r=0;r<this._accBinsNumX;r++){this._accBins.push([]);const i=this._accBins[this._accBins.length-1];for(let n=0;n<this._accBinsNumY;n++)i.push(new Wt)}}else for(let r=0;r<this._accBinsNumX;r++)for(let i=0;i<this._accBinsNumY;i++)this._accBins[r][i].clear();this._accBinsSizeX=t/this._accBinsNumX,this._accBinsSizeY=e/this._accBinsNumY,this.accNumTests=0}_addToBins(t){const e=t.info[this.visibilityGroup],r=Math.floor(e.aabr[0]/this._accBinsSizeX),i=Math.floor(e.aabr[2]/this._accBinsSizeX),n=Math.floor(e.aabr[1]/this._accBinsSizeY),s=Math.floor(e.aabr[3]/this._accBinsSizeY);for(let o=r;o<=i;o++)if(!(o<0||o>=this._accBinsNumX))for(let a=n;a<=s;a++)a<0||a>=this._accBinsNumY||this._accBins[o][a].push(t)}_setGraphicVisibility(t,e){const r=t.graphics3DGraphic;r.destroyed||(r.setVisibilityFlag(Iu.DECONFLICTION,e,this.visibilityGroup),this.visibilityGroup===aa.LABEL&&this.view.labeler.setLabelGraphicVisibility(r,e))}};function B2t(t,e){const r=t.graphics3DGraphic;r.destroyed||r.clearVisibilityFlag(Iu.DECONFLICTION,e)}function*u_e(t){if(Map.prototype.entries){const e=t.entries();for(let r=e.next();!r.done;r=e.next())yield r.value[1]}else yield*t.values()}function*j2t(t,e,r){e.clear(),t.forEach((n,s)=>{const o=e.pushNew();o.id=s,o.visible=n.graphics3DGraphic.hasVisibilityFlag(Iu.DECONFLICTION,r),o.prio=n.info?n.info[r].distance:Number.MAX_VALUE}),yield;const i=e.iterableSort((n,s)=>n.visible!==s.visible?n.visible?-1:1:n.prio!==s.prio?n.prio-s.prio:n.id-s.id);for(let n=i.next();!n.done;n=i.next())yield;e.forAll(n=>{const s=t.get(n.id);s&&(t.delete(n.id),t.set(n.id,s))}),e.clear()}u([d({constructOnly:!0})],oR.prototype,"view",void 0),u([d({type:Boolean,readOnly:!0})],oR.prototype,"updating",null),oR=u([$("esri.views.3d.layers.graphics.Deconflictor")],oR);class G2t{}class H2t{constructor(e=null,r=null,i=null){this.active=e,this.visible=r,this.sort=i,this.sortArray=new Wt({allocator:n=>n||new G2t})}}const q2t=Ne();class W2t{constructor(){this.positionView=P(),this.positionNDC=P(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo=new v4e}get isOutsideScreen(){const e=this.positionNDC;return e[0]<-1||e[1]<-1||e[2]<-1||e[0]>=1||e[1]>=1}}const X2t=new W2t,Y2t=2e3;let NU=class extends oR{constructor(e){super(e),this.visibilityGroup=aa.LABEL,this.iconMarginFactor=0,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return za.YIELD;const r=performance.now();if(e.state!==Mr.IDLE&&r-this._lastDeconfliction<Y2t)return za.YIELD;super.runTask(e),this.state===xu.Idle&&(this._lastDeconfliction=r)}enabledChanged(e,r){this.modifyGraphics(r,e.labelsEnabled)}getGraphicsLayers(e){return e.labelLayers}};u([d({constructOnly:!0})],NU.prototype,"parent",void 0),NU=u([$("esri.views.3d.layers.graphics.LabelDeconflictor")],NU);let yte=class extends oR{constructor(){super(...arguments),this._handles=new qr,this._contexts=new Map,this._viewState=new H4e,this.visibilityGroup=aa.GRAPHIC,this._iconMarginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._handles.add([ne(()=>{var e,r;return(r=(e=this.view)==null?void 0:e.state)==null?void 0:r.camera},()=>{this._updateViewState(),this.setDirty()}),ne(()=>{var e,r,i;return(i=(r=(e=this.view)==null?void 0:e.map)==null?void 0:r.ground)==null?void 0:i.opacity},(e,r)=>{e!==1&&r!==1||this.setDirty()}),ne(()=>{var e;return(e=this.view)==null?void 0:e.slicePlane},()=>{this._updateSlicePlane(),this._slicePlaneChanged()},Vt)]),this._frameTask=this.view.resourceController.scheduler.registerTask(St.GRAPHICS_DECONFLICTOR,this),this._labels=new NU({view:this.view,parent:this})}destroy(){this._labels.destroy(),this._labels=null,this._handles.destroy(),this._handles=null,this._frameTask&&(this._frameTask.remove(),this._frameTask=null)}get iconMarginFactor(){return this._iconMarginFactor}set iconMarginFactor(e){this._iconMarginFactor=e,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(e,r){const i=!(this._graphicSupportsDeconfliction(r)&&Cq(e));r.setVisibilityFlag(Iu.DECONFLICTION,i,aa.GRAPHIC)}_updateViewState(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;v(e)&&BLe(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=v(e)}_slicePlaneChanged(){ca(this._contexts,(e,r)=>r.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){const r=this._getGraphicsContext(e);return{addGraphic:i=>this._addGraphic(e,r,i),removeGraphic:i=>this._removeGraphic(r,i),labelingInfoChange:()=>this._labels.enabledChanged(e,r),featureReductionChange:()=>this.enabledChanged(e,r),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,r),clear:()=>r.forEach(i=>this._removeGraphic(r,i.graphics3DGraphic))}}removeGraphicsOwner(e){const r=this._contexts.get(e);r&&(r.forEach(i=>this._removeGraphic(r,i.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,r,i){const n=i.graphic.uid,s=new V2t(i,e.symbolCreationContext.slicePlaneEnabled);r.set(n,s),Cq(e)&&this.addToActiveGraphics(s),e.labelsEnabled&&this._labels.addToActiveGraphics(s)}_removeGraphic(e,r){const i=r.graphic.uid,n=e.get(i);n&&(this.removeFromActiveGraphics(n),this._labels.removeFromActiveGraphics(n),e.delete(i),this.setDirty())}enabledChanged(e,r){const i=Cq(e);i||Z2t(e),this.modifyGraphics(r,i)}_slicePlaneEnabledChanged(e,r){const i=e.symbolCreationContext.slicePlaneEnabled;r.forEach(n=>n.slicePlaneEnabled=i),this.setDirty()}getGraphicsLayers(e){return e.layers}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const r=e.layers;if(!r||!r.length)return!1;for(const i of r)if(this.layerSupportsDeconfliction(i))return!0;return!1}_getGraphicsContext(e){const r=this._contexts.get(e);if(r)return r;const i=new Map;return this._contexts.set(e,i),this.setDirty(),i}};function Cq(t){const e=t.layer;return!(!e||!e.featureReduction||e.featureReduction.type!=="selection")}function Z2t(t){const e=t.graphics3DGraphics;e&&e.forEach(r=>r.clearVisibilityFlag(Iu.DECONFLICTION))}yte=u([$("esri.views.3d.layers.graphics.GraphicsDeconflictor")],yte);const V3=(t,e,r)=>[e,r],Ip=(t,e,r)=>[e,r,t[2]],B3=(t,e,r)=>[e,r,t[2],t[3]];function QXt(t){return t?{originPosition:t.originPosition==="upper-left"?"upperLeft":t.originPosition==="lower-left"?"lowerLeft":t.originPosition,scale:t.tolerance?[t.tolerance,t.tolerance]:[1,1],translate:v(t.extent)?[t.extent.xmin,t.extent.ymax]:[0,0]}:null}function OD({scale:t,translate:e},r){return Math.round((r-e[0])/t[0])}function MD({scale:t,translate:e},r){return Math.round((e[1]-r)/t[1])}function Fle(t,e,r){const i=[];let n,s,o,a;for(let l=0;l<r.length;l++){const c=r[l];l>0?(o=OD(t,c[0]),a=MD(t,c[1]),o===n&&a===s||(i.push(e(c,o-n,a-s)),n=o,s=a)):(n=OD(t,c[0]),s=MD(t,c[1]),i.push(e(c,n,s)))}return i.length>0?i:null}function J2t(t,e,r,i){return Fle(t,r?i?B3:Ip:i?Ip:V3,e)}function K2t(t,e,r,i){const n=[],s=r?i?B3:Ip:i?Ip:V3;for(let o=0;o<e.length;o++){const a=Fle(t,s,e[o]);a&&a.length>=3&&n.push(a)}return n.length?n:null}function Q2t(t,e,r,i){const n=[],s=r?i?B3:Ip:i?Ip:V3;for(let o=0;o<e.length;o++){const a=Fle(t,s,e[o]);a&&a.length>=2&&n.push(a)}return n.length?n:null}function q4e({scale:t,translate:e},r){return r*t[0]+e[0]}function W4e({scale:t,translate:e},r){return e[1]-r*t[1]}function X4e(t,e,r){const i=new Array(r.length);if(!r.length)return i;const[n,s]=t.scale;let o=q4e(t,r[0][0]),a=W4e(t,r[0][1]);i[0]=e(r[0],o,a);for(let l=1;l<r.length;l++){const c=r[l];o+=c[0]*n,a-=c[1]*s,i[l]=e(c,o,a)}return i}function Y4e(t,e,r){const i=new Array(r.length);for(let n=0;n<r.length;n++)i[n]=X4e(t,e,r[n]);return i}function eEt(t,e,r,i){return X4e(t,r?i?B3:Ip:i?Ip:V3,e)}function tEt(t,e,r,i){return Y4e(t,r?i?B3:Ip:i?Ip:V3,e)}function rEt(t,e,r,i){return Y4e(t,r?i?B3:Ip:i?Ip:V3,e)}function iEt(t,e,r,i,n){return e.xmin=OD(t,r.xmin),e.ymin=MD(t,r.ymin),e.xmax=OD(t,r.xmax),e.ymax=MD(t,r.ymax),e!==r&&(i&&(e.zmin=r.zmin,e.zmax=r.zmax),n&&(e.mmin=r.mmin,e.mmax=r.mmax)),e}function nEt(t,e,r,i,n){return e.points=J2t(t,r.points,i,n)??[],e}function sEt(t,e,r,i,n){return e.x=OD(t,r.x),e.y=MD(t,r.y),e!==r&&(i&&(e.z=r.z),n&&(e.m=r.m)),e}function oEt(t,e,r,i,n){const s=K2t(t,r.rings,i,n);return s?(e.rings=s,e):null}function aEt(t,e,r,i,n){const s=Q2t(t,r.paths,i,n);return s?(e.paths=s,e):null}function eYt(t,e){return t&&e?dN(e)?sEt(t,{},e,!1,!1):a3(e)?aEt(t,{},e,!1,!1):Q0(e)?oEt(t,{},e,!1,!1):hN(e)?nEt(t,{},e,!1,!1):O9(e)?iEt(t,{},e,!1,!1):null:null}function Z4e(t,e,r,i,n){return v(r)&&(e.points=eEt(t,r.points,i,n)),e}function J4e(t,e,r,i,n){return R(r)||(e.x=q4e(t,r.x),e.y=W4e(t,r.y),e!==r&&(i&&(e.z=r.z),n&&(e.m=r.m))),e}function K4e(t,e,r,i,n){return v(r)&&(e.rings=rEt(t,r.rings,i,n)),e}function Q4e(t,e,r,i,n){return v(r)&&(e.paths=tEt(t,r.paths,i,n)),e}let tYt=class{constructor(e,r,i){this.uid=e,this.geometry=r,this.attributes=i,this.visible=!0,this.objectId=null,this.centroid=null}};function iYt(t){return v(t.geometry)}let nYt=class{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}};function oYt(t){var s;const e=uEe.fromJSON(t.geometryType),r=Je.fromJSON(t.spatialReference),i=t.transform,n=t.features.map(o=>{const a=lEt(o,e,r,t.objectIdFieldName),l=a.geometry;if(v(l)&&i)switch(l.type){case"point":a.geometry=J4e(i,l,l,l.hasZ,l.hasM);break;case"multipoint":a.geometry=Z4e(i,l,l,!!l.hasZ,!!l.hasM);break;case"polygon":a.geometry=K4e(i,l,l,!!l.hasZ,!!l.hasM);break;case"polyline":a.geometry=Q4e(i,l,l,!!l.hasZ,!!l.hasM);break;case"extent":case"mesh":a.geometry=l}return a});return{geometryType:e,features:n,spatialReference:r,fields:((s=t.fields)==null?void 0:s.map(o=>gB.fromJSON(o)))??[],objectIdFieldName:t.objectIdFieldName,globalIdFieldName:t.globalIdFieldName,geohashFieldName:t.geohashFieldName,geometryProperties:t.geometryProperties,hasZ:t.hasZ,hasM:t.hasM,exceededTransferLimit:t.exceededTransferLimit,transform:null}}function lEt(t,e,r,i){return{uid:Vu(),objectId:i&&t.attributes?t.attributes[i]:null,attributes:t.attributes,geometry:cEt(t.geometry,e,r),visible:!0}}function cEt(t,e,r){if(R(t))return null;switch(e){case"point":{const i=t;return{x:i.x,y:i.y,z:i.z,m:i.m,hasZ:i.z!=null,hasM:i.m!=null,type:"point",spatialReference:r}}case"polyline":{const i=t;return{paths:i.paths,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polyline",spatialReference:r}}case"polygon":{const i=t;return{rings:i.rings,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polygon",spatialReference:r}}case"multipoint":{const i=t;return{points:i.points,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"multipoint",spatialReference:r}}}}function Y_(t,e,r,i){return{x:t,y:e,z:r,hasZ:r!=null,hasM:!1,spatialReference:i,type:"point"}}function uEt(t){if(R(t))return 0;let e=32;switch(t.type){case"point":e+=42;break;case"polyline":case"polygon":{let r=0;const i=2+(t.hasZ?1:0)+(t.hasM?1:0),n=t.type==="polyline"?t.paths:t.rings;for(const s of n)r+=s.length;e+=8*r*i+64,e+=128*r,e+=34,e+=32*(n.length+1);break}case"multipoint":{const r=2+(t.hasZ?1:0)+(t.hasM?1:0),i=t.points.length;e+=8*i*r+64,e+=128*i,e+=34,e+=32;break}case"extent":e+=98,t.hasM&&(e+=32),t.hasZ&&(e+=32);break;case"mesh":e+=EF(t.vertexAttributes.position),e+=EF(t.vertexAttributes.normal),e+=EF(t.vertexAttributes.uv),e+=EF(t.vertexAttributes.tangent)}return e}function aYt(t){let e=32;return e+=cOe(t.attributes),e+=3,e+=8+uEt(t.geometry),e}function hEt(t){if(R(t))return 0;switch(t.type){case"point":return 1;case"polyline":{let e=0;for(const r of t.paths)e+=r.length;return e}case"polygon":{let e=0;for(const r of t.rings)e+=r.length;return e}case"multipoint":return t.points.length;case"extent":return 2;case"mesh":{const e=t.vertexAttributes&&t.vertexAttributes.position;return e?e.length/3:0}default:return}}function lYt(t){if(R(t))return!1;switch(t.type){case"extent":case"point":return!0;case"polyline":for(const e of t.paths)if(e.length>0)return!0;return!1;case"polygon":for(const e of t.rings)if(e.length>0)return!0;return!1;case"multipoint":return t.points.length>0;case"mesh":return!t.loaded||t.vertexAttributes.position.length>0}}function cYt(t,e){switch(ki(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[3]=t.x,e[1]=e[4]=t.y,t.hasZ&&(e[2]=e[5]=t.z);break;case"polyline":for(let r=0;r<t.paths.length;r++)zj(e,t.paths[r],!!t.hasZ);break;case"polygon":for(let r=0;r<t.rings.length;r++)zj(e,t.rings[r],!!t.hasZ);break;case"multipoint":zj(e,t.points,!!t.hasZ);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[3]=t.xmax,e[4]=t.ymax,t.zmin!=null&&(e[2]=t.zmin),t.zmax!=null&&(e[5]=t.zmax)}}function dEt(t,e){switch(td(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[2]=t.x,e[1]=e[3]=t.y;break;case"polyline":for(let r=0;r<t.paths.length;r++)Uj(e,t.paths[r]);break;case"polygon":for(let r=0;r<t.rings.length;r++)Uj(e,t.rings[r]);break;case"multipoint":Uj(e,t.points);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax}}function uYt(t,e){return t.objectId!=null?t.objectId:t.attributes&&e?t.attributes[e]:null}function e5e(t){return"declaredClass"in t}function h_e(t){return"declaredClass"in t}function pEt(t){return"declaredClass"in t}function fEt(t,e){return t?pEt(t)?t:new Va({layer:e,sourceLayer:e,visible:t.visible,symbol:se(t.symbol),attributes:se(t.attributes),geometry:t5e(t.geometry)}):null}function t5e(t){return R(t)?null:e5e(t)?t:ry(mEt(t))}function mEt(t){const{wkid:e,wkt:r,latestWkid:i}=t.spatialReference,n={wkid:e,wkt:r,latestWkid:i};switch(t.type){case"point":{const{x:s,y:o,z:a,m:l}=t;return{x:s,y:o,z:a,m:l,spatialReference:n}}case"polygon":{const{rings:s,hasZ:o,hasM:a}=t;return{rings:d_e(s),hasZ:o,hasM:a,spatialReference:n}}case"polyline":{const{paths:s,hasZ:o,hasM:a}=t;return{paths:d_e(s),hasZ:o,hasM:a,spatialReference:n}}case"extent":{const{xmin:s,xmax:o,ymin:a,ymax:l,zmin:c,zmax:h,mmin:p,mmax:f,hasZ:m,hasM:g}=t;return{xmin:s,xmax:o,ymin:a,ymax:l,zmin:c,zmax:h,mmin:p,mmax:f,hasZ:m,hasM:g,spatialReference:n}}case"multipoint":{const{points:s,hasZ:o,hasM:a}=t;return{points:i5e(s)?r5e(s):s,hasZ:o,hasM:a,spatialReference:n}}default:return}}function d_e(t){return gEt(t)?t.map(e=>r5e(e)):t}function r5e(t){return t.map(e=>Array.from(e))}function gEt(t){for(const e of t)if(e.length!==0)return i5e(e);return!1}function i5e(t){return t.length>0&&(Lie(t[0])||Die(t[0]))}function yEt(t,e){if(!t)return null;let r;if(h_e(t)){if(e==null)return t.clone();if(h_e(e))return e.copy(t)}return e!=null?(r=e,r.x=t.x,r.y=t.y,r.spatialReference=t.spatialReference,t.hasZ?(r.z=t.z,r.hasZ=t.hasZ):(r.z=void 0,r.hasZ=!1),t.hasM?(r.m=t.m,r.hasM=!0):(r.m=void 0,r.hasM=!1)):(r=Y_(t.x,t.y,t.z,t.spatialReference),t.hasM&&(r.m=t.m,r.hasM=!0)),r}function hYt(t){const{wkid:e,wkt:r,latestWkid:i}=t,n={wkid:e,wkt:r,latestWkid:i};return Je.fromJSON(n)}const Aq=re.getLogger("esri.layers.support.labelFormatUtils"),Rq={type:"simple",evaluate:()=>null},_Et={getAttribute:(t,e)=>t.field(e)};async function n5e(t,e,r){if(!t||!t.symbol||!e)return Rq;const i=t.where,n=EB(t),s=i?await Q(()=>import("./WhereClause-f6ddfb88.js").then(a=>a.W),["assets/WhereClause-f6ddfb88.js","assets/executionError-fb3f283a.js"]):null;let o;if(n.type==="arcade"){const a=await lHe(n.expression,r,e);if(R(a))return Rq;o={type:"arcade",evaluate(l){try{const c=a.evaluate({$feature:"attributes"in l?a.repurposeFeature(l):l});if(c!=null)return c.toString()}catch{Aq.error(new H("arcade-expression-error","Encountered an error when evaluating label expression for feature",{feature:l,expression:n}))}return null},needsHydrationToEvaluate:()=>_oe(n.expression)==null}}else o={type:"simple",evaluate:a=>n.expression.replace(/{[^}]*}/g,l=>{const c=l.slice(1,-1),h=e.get(c);if(!h)return l;let p=null;return"attributes"in a?a&&a.attributes&&(p=a.attributes[h.name]):p=a.field(h.name),p==null?"":s5e(p,h)})};if(i){let a;try{a=s.WhereClause.create(i,e)}catch(c){return Aq.error(new H("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:i,error:c})),Rq}const l=o.evaluate;o.evaluate=c=>{const h="attributes"in c?void 0:_Et;try{if(a.testFeature(c,h))return l(c)}catch(p){Aq.error(new H("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:i,feature:c,error:p}))}return null}}return o}function s5e(t,e){if(t==null)return"";const r=e.domain;if(r){if(r.type==="codedValue"||r.type==="coded-value"){const n=t;for(const s of r.codedValues)if(s.code===n)return s.name}else if(r.type==="range"){const n=+t,s="range"in r?r.range[0]:r.minValue,o="range"in r?r.range[1]:r.maxValue;if(s<=n&&n<=o)return r.name}}let i=t;return e.type==="date"||e.type==="esriFieldTypeDate"?i=ny(i,P9("short-date")):M9(e)&&(i=sy(+i)),i||""}const dYt=Object.freeze(Object.defineProperty({__proto__:null,createLabelFunction:n5e,formatField:s5e},Symbol.toStringTag,{value:"Module"}));let o5e=class{constructor(e=null,r="center",i="center",n=null,s=[0,0,0],o=0,a=[0,0,0,1],l=[0,0],c="world",h=0,p=0){this.verticalOffset=e,this.horizontalPlacement=r,this.verticalPlacement=i,this.text=n,this.translation=s,this.elevationOffset=o,this.centerOffset=a,this.screenOffset=l,this.centerOffsetUnits=c,this.displayWidth=h,this.displayHeight=p}};function kle(t,e){if(t.type==="point")return Cv(t,e,!1);if(e5e(t))switch(t.type){case"extent":return Cv(t.center,e,!1);case"polygon":return Cv(t.centroid,e,!1);case"polyline":return Cv(p_e(t),e,!0);case"mesh":return Cv(t.origin,e,!1)}else switch(t.type){case"extent":return Cv(vEt(t),e,!0);case"polygon":return Cv(bEt(t),e,!0);case"polyline":return Cv(p_e(t),e,!0)}}function p_e(t){const e=t.paths[0];if(!e||e.length===0)return null;const r=X2e(e,W2e(e)/2);return Y_(r[0],r[1],r[2],t.spatialReference)}function vEt(t){return Y_(.5*(t.xmax+t.xmin),.5*(t.ymax+t.ymin),t.zmin!=null&&t.zmax!=null&&isFinite(t.zmin)&&isFinite(t.zmax)?.5*(t.zmax+t.zmin):void 0,t.spatialReference)}function bEt(t){const e=t.rings[0];if(!e||e.length===0)return null;const r=ine(t.rings,!!t.hasZ);return Y_(r[0],r[1],r[2],t.spatialReference)}function Cv(t,e,r){const i=r?t:yEt(t);return e&&t?gZe(t,i,e)?i:null:i}function fYt(t,e,r,i=0){if(t){e||(e=Kt());const n=t;let s=.5*n.width*(r-1),o=.5*n.height*(r-1);return n.width<1e-7*n.height?s+=o/20:n.height<1e-7*n.width&&(o+=s/20),ai(e,n.xmin-s-i,n.ymin-o-i,n.xmax+s+i,n.ymax+o+i),e}return null}function a5e(t,e){for(let r=0;r<t.geometries.length;++r){const i=t.geometries[r].getMutableAttribute(O.AUXPOS1);i&&i.data[3]!==e&&(i.data[3]=e,t.geometryVertexAttrsUpdated(t.geometries[r]))}}function Z$(t,e){const r=MN(op);return v(t)&&(r[0]=t[0],r[1]=t[1],r[2]=t[2]),v(e)?r[3]=e:v(t)&&t.length>3&&(r[3]=t[3]),r}function mYt(t,e,r,i,n,s=[0,0,0,0]){for(let o=0;o<3;++o)v(t)&&t[o]!=null?s[o]=t[o]:v(r)&&r[o]!=null?s[o]=r[o]:s[o]=n[o];return v(e)?s[3]=e:v(i)?s[3]=i:s[3]=n[3],s}function f_e(t=Lg,e,r,i=1){const n=new Array(3);if(R(e)||R(r))n[0]=1,n[1]=1,n[2]=1;else{let s,o=0;for(let a=2;a>=0;a--){const l=t[a];let c;const h=l!=null,p=a===0&&!s&&!h,f=r[a];l==="symbol-value"||p?c=f!==0?e[a]/f:1:h&&l!=="proportional"&&isFinite(l)&&(c=f!==0?l/f:1),c!=null&&(n[a]=c,s=c,o=Math.max(o,Math.abs(c)))}for(let a=2;a>=0;a--)n[a]==null?n[a]=s:n[a]===0&&(n[a]=.001*o)}for(let s=2;s>=0;s--)n[s]/=i;return $c(n)}function wEt(t){return t.isPrimitive!=null}function x7(t){return MV(wEt(t)?[t.width,t.depth,t.height]:t)?null:"Symbol sizes may not be negative values"}function MV(t){if(Array.isArray(t)){for(const e of t)if(!MV(e))return!1;return!0}return t==null||t>=0}function xEt(t,e,r,i=$e()){const n=t||0,s=e||0,o=r||0;return n!==0&&TO(i,i,-n/180*Math.PI),s!==0&&xO(i,i,s/180*Math.PI),o!==0&&K9(i,i,o/180*Math.PI),i}function Ule(t,e,r){if(r.minDemResolution!=null)return r.minDemResolution;const i=Kl(e),n=N2(t)*i,s=F2(t)*i,o=Ow(t)*(e.isGeographic?1:i);return n===0&&s===0&&o===0?r.minDemResolutionForPoints:.01*Math.max(n,s,o)}function l5e(t,e,r,i,n,s,o,a,l,c,h){const p=MEt[h.mode];let f,m,g=0;if($n(t,e,r,i,l.spatialReference,n,a))return p.requiresAlignment(h)?(g=p.applyElevationAlignmentBuffer(i,n,s,o,a,l,c,h),f=s,m=o):(f=i,m=n),$n(f,l.spatialReference,m,s,c.spatialReference,o,a)?g:void 0}function j3(t,e,r,i,n){const s=(vV(t)?t.z:MFe(t)?t.array[t.offset+2]:t[2])||0;switch(r.mode){case"on-the-ground":{const o=Nt(Fg(e,t,"ground"),0);return n.verticalDistanceToGround=0,n.sampledElevation=o,void(n.z=o)}case"relative-to-ground":{const o=Nt(Fg(e,t,"ground"),0),a=r.geometryZWithOffset(s,i);return n.verticalDistanceToGround=a,n.sampledElevation=o,void(n.z=a+o)}case"relative-to-scene":{const o=Nt(Fg(e,t,"scene"),0),a=r.geometryZWithOffset(s,i);return n.verticalDistanceToGround=a,n.sampledElevation=o,void(n.z=a+o)}case"absolute-height":{const o=r.geometryZWithOffset(s,i),a=Nt(Fg(e,t,"ground"),0);return n.verticalDistanceToGround=o-a,n.sampledElevation=a,void(n.z=o)}default:return void(n.z=0)}}function TEt(t,e,r,i){return j3(t,e,r,i,aR),aR.z}function ZN(t,e,r){return e==null||r==null?t.definedChanged:e==="on-the-ground"&&r==="on-the-ground"?t.staysOnTheGround:e===r||e!=="on-the-ground"&&r!=="on-the-ground"?Pn.UPDATE:t.onTheGroundChanged}function $p(t){return t==="relative-to-ground"||t==="relative-to-scene"}function _w(t){return t!=="absolute-height"}function SEt(t,e,r,i,n){j3(e,r,n,i,aR),a5e(t,aR.verticalDistanceToGround);const s=aR.sampledElevation,o=po(PEt,t.transformation);return S5[0]=e.x,S5[1]=e.y,S5[2]=aR.z,um(e.spatialReference,S5,o,i.spatialReference)?t.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),s}function EEt(t,e,r,i,n,s){let o=0;const a=s.spatialReference;e*=3,i*=3;for(let l=0;l<n;++l){const c=t[e+0],h=t[e+1],p=t[e+2],f=Nt(s.getElevation(c,h,p,a,"ground"),0);o+=f,r[i+0]=c,r[i+1]=h,r[i+2]=f,e+=3,i+=3}return o/n}function CEt(t,e,r,i,n,s,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,p=s.spatialReference;e*=3,i*=3;for(let f=0;f<n;++f){const m=t[e+0],g=t[e+1],_=t[e+2],b=Nt(s.getElevation(m,g,_,p,"ground"),0);l+=b,r[i+0]=m,r[i+1]=g,r[i+2]=h==null?_+b+c:b+c,e+=3,i+=3}return l/n}function AEt(t,e,r,i,n,s,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,p=s.spatialReference;e*=3,i*=3;for(let f=0;f<n;++f){const m=t[e+0],g=t[e+1],_=t[e+2],b=Nt(s.getElevation(m,g,_,p,"scene"),0);l+=b,r[i+0]=m,r[i+1]=g,r[i+2]=h==null?_+b+c:b+c,e+=3,i+=3}return l/n}function REt(t){const e=t.meterUnitOffset,r=t.featureExpressionInfoContext;return e!==0||r!=null}function OEt(t,e,r,i,n,s,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;e*=3,i*=3;for(let h=0;h<n;++h){const p=t[e+0],f=t[e+1],m=t[e+2];r[i+0]=p,r[i+1]=f,r[i+2]=c==null?m+l:l,e+=3,i+=3}return 0}let JN=class{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}};var Pn;(function(t){t[t.NONE=0]="NONE",t[t.UPDATE=1]="UPDATE",t[t.RECREATE=2]="RECREATE"})(Pn||(Pn={}));const MEt={"absolute-height":{applyElevationAlignmentBuffer:OEt,requiresAlignment:REt},"on-the-ground":{applyElevationAlignmentBuffer:EEt,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:CEt,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:AEt,requiresAlignment:()=>!0}},PEt=$e(),aR=new JN,S5=P();function zle(t){return v(t.mapPositions)}function c5e(t,e,r,i,n){const s=t.stageObject,o=s.geometries;let a=0;for(const l of o){if(!zle(l))continue;const{update:c,averageGeometrySampledElevation:h}=h5e(l,e,r,i,n);a+=h,c&&s.geometryVertexAttrsUpdated(l)}return a/o.length}function PD(t,e,r,i,n){var p;const s=t.stageObject,o=e.centerPointInElevationSR;let a=0;(p=s.metadata)!=null&&p.usesVerticalDistanceToGround?(i(o,Dc),a5e(s,Dc.verticalDistanceToGround),a=Dc.sampledElevation):(i(o,Dc),e.mode!=="absolute-height"&&(a=Dc.sampledElevation));const l=po(IEt,s.transformation),c=he(u5e,l[12],l[13],l[14]);Qr.TESTS_DISABLE_OPTIMIZATIONS?(Lc[0]=o.x,Lc[1]=o.y,Lc[2]=Dc.z,um(o.spatialReference,Lc,l,n.spatialReference)&&(s.transformation=l)):n.setAltitudeOfTransformation(Dc.z,l);const h=Vle/n.unitInMeters;return(Math.abs(l[12]-c[0])>=h||Math.abs(l[13]-c[1])>=h||Math.abs(l[14]-c[2])>=h)&&(s.transformation=l),a}const IEt=$e();function $Et(t,e,r,i,n){const s=t.graphics3DSymbolLayer.lodRenderer;if(R(s))return 0;const o=e.centerPointInElevationSR;i(o,Dc);const a=e.mode!=="absolute-height"?Dc.sampledElevation:0,l=s.instanceData,c=t.instanceIndex,h=DEt;l.getGlobalTransform(c,h);const p=he(u5e,h[12],h[13],h[14]);Qr.TESTS_DISABLE_OPTIMIZATIONS?(Lc[0]=o.x,Lc[1]=o.y,Lc[2]=Dc.z,um(o.spatialReference,Lc,h,n.spatialReference)&&l.setGlobalTransform(c,h)):n.setAltitudeOfTransformation(Dc.z,h);const f=Vle/n.unitInMeters;return(Qr.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(h[12]-p[0])>=f||Math.abs(h[13]-p[1])>=f||Math.abs(h[14]-p[2])>=f)&&l.setGlobalTransform(c,h),a}function LEt(t,e,r,i,n){const s=t.stageObject,o=s.geometries;if(o.length===0)return 0;let a=0,l=null,c=0,h=!1;for(const p of o){if(!zle(p))continue;const f=p.vertexAttributes.get(O.POSITION);if(f!==l){const{update:m,averageGeometrySampledElevation:g}=h5e(p,e,r,i,n);c=g,l=f,h=m}h&&s.geometryVertexAttrsUpdated(p),a+=c}return a/o.length}const Vle=.01,Lc=P(),gd=P(),PE=P(),DEt=$e(),u5e=P(),Dc=new JN;function h5e(t,e,r,i,n){let s=!1;const o=t.shaderTransformation,a=e.requiresSampledElevationInfo;gd[0]=o[12],gd[1]=o[13],gd[2]=o[14],t.invalidateBoundingInfo();const l=t.getMutableAttribute(O.POSITION),c=l.data,h=l.size,p=c.length/h,f=new OFe(t.mapPositions,r);let m=0,g=0;for(let _=0;_<p;_++){if(PE[0]=c[m],PE[1]=c[m+1],PE[2]=c[m+2],i(f,Dc),a&&(g+=Dc.sampledElevation),Qr.TESTS_DISABLE_OPTIMIZATIONS)c[m]=f.array[f.offset],c[m+1]=f.array[f.offset+1],c[m+2]=Dc.z,$n(c,r,m,c,n.spatialReference,m,1),c[m]-=gd[0],c[m+1]-=gd[1],c[m+2]-=gd[2],s=!0;else{Lc[0]=c[m]+gd[0],Lc[1]=c[m+1]+gd[1],Lc[2]=c[m+2]+gd[2],n.setAltitude(Lc,Dc.z),c[m]=Lc[0]-gd[0],c[m+1]=Lc[1]-gd[1],c[m+2]=Lc[2]-gd[2];const b=Vle/n.unitInMeters;(Math.abs(PE[0]-c[m])>=b||Math.abs(PE[1]-c[m+1])>=b||Math.abs(PE[2]-c[m+2])>=b)&&(s=!0)}m+=h,f.offset+=3}return g/=p,{update:s,averageGeometrySampledElevation:g}}const NEt=re.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function FEt(t){return{cachedResult:t.cachedResult,arcade:t.arcade?{func:t.arcade.func,context:t.arcade.modules.arcadeUtils.createExecContext(null,{sr:t.arcade.context.spatialReference}),modules:t.arcade.modules}:null}}function yYt(t){const e=t&&t.expression;if(typeof e=="string"){const r=f5e(e);if(r!=null)return{cachedResult:r}}return null}async function _Yt(t,e,r,i){const n=t&&t.expression;if(typeof n!="string")return null;const s=f5e(n);if(s!=null)return{cachedResult:s};const o=await iy();lr(r);const a=o.arcadeUtils,l=a.createSyntaxTree(n);return a.dependsOnView(l)?(i!=null&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:a.createFunction(l),context:a.createExecContext(null,{sr:e}),modules:o}}}function d5e(t,e,r){return t.arcadeUtils.createFeature(e.attributes,e.geometry,r)}function Ble(t,e){if(t!=null&&!p5e(t)){if(!e||!t.arcade)return void NEt.errorOncePerTick("Arcade support required but not provided");const r=e;r._geometry&&(r._geometry=t5e(r._geometry)),t.arcade.modules.arcadeUtils.updateExecContext(t.arcade.context,e)}}function kEt(t){if(t!=null){if(p5e(t))return t.cachedResult;const e=t.arcade;let r=e==null?void 0:e.modules.arcadeUtils.executeFunction(e.func,e.context);return typeof r!="number"&&(t.cachedResult=0,r=0),r}return 0}function vYt(t,e=!1){let r=t&&t.featureExpressionInfo;const i=r&&r.expression;return e||i==="0"||(r=null),r??null}const UEt={cachedResult:0};function p5e(t){return t.cachedResult!=null}function f5e(t){return t==="0"?0:null}let Tm=class m5e{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=Tst(e)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,r){const i=this.calculateOffsetRenderUnits(r);return this.featureExpressionInfoContext!=null?i:e+i}calculateOffsetRenderUnits(e){let r=this._meterUnitOffset;const i=this.featureExpressionInfoContext;return i!=null&&(r+=kEt(i)*this._metersPerElevationInfoUnit),r/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=xst(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=Nt(e.offset,0)}updateFeatureExpressionInfoContext(e,r,i){if(R(e))return void(this._featureExpressionInfoContext=null);const n=e&&e.arcade;n&&v(r)&&v(i)?(this._featureExpressionInfoContext=FEt(e),Ble(this._featureExpressionInfoContext,d5e(n.modules,r,i))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const r=new m5e;return v(e)&&r.setFromElevationInfo(e),r}},zEt=class{constructor(e,r,i){this.graphic=e,this.renderingInfo=r,this.layer=i}};var ar;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.TRANSPARENT=1]="TRANSPARENT",t[t.OPAQUE=2]="OPAQUE"})(ar||(ar={}));let VEt=class{constructor(e,r,i){this.baseMaterial=e,this.edgeMaterials=r,this.properties=i}},xy=class{get isElevationSource(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}constructor(e,r,i,n,s,o,a,l=null){this.graphics3DSymbolLayer=e,this.stageObject=r,this._uniqueGeometries=i,this._uniqueMaterials=n,this._sharedResource=s,this.elevationAligner=o,this.elevationContext=a,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._stage=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e,r){this._stageLayer=r,this._stage=e,e.addMany(this._uniqueMaterials),e.addMany(this._uniqueGeometries),e.add(this.stageObject)}destroy(){const e=this._stage;this._stageLayer&&(e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries)),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);const r=this._stage.renderer.ensureEdgeView();r.hasObject(this.stageObject)&&r.removeObject(this.stageObject),this.stageObject.dispose(),v(this._sharedResource)&&this._sharedResource.release(),this._visible=!1,this._stageLayer=null,this._stage=null}layerOpacityChanged(e,r){if(R(this._edgeState))return;const i=m_e(this._edgeState.baseMaterial);let n=!1;for(const s of this._edgeState.edgeMaterials)s.objectTransparency!==i&&(s.objectTransparency=i,n=!0);n&&this._resetEdgeObject(r),this._stage.renderer.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[e])}slicePlaneEnabledChanged(e,r){R(this._edgeState)||(this._stage.renderer.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:e},!r),this._edgeState.properties.hasSlicePlane=e)}setVisibility(e){if(this._stage!=null&&this._visible!==e&&(this._visible=e,this.stageObject.visible=e,this._visible&&!this._addedToStage&&(this._stageLayer.add(this.stageObject),this._addedToStage=!0),v(this._edgeState))){const r=this._stage.renderer.ensureEdgeView();r.hasObject(this.stageObject)?r.updateObjectVisibility(this.stageObject,e):e&&this._addOrUpdateEdgeObject(r,!1)}}get visible(){return this._visible}alignWithElevation(e,r,i,n){if(this.elevationAligner==null)return;v(i)&&Ble(this.elevationContext.featureExpressionInfoContext,i);const s=(o,a)=>j3(o,e,this.elevationContext,r,a);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,s,r),this._resetEdgeObject(n)}alignWithAbsoluteElevation(e,r,i){const n=(s,o)=>{o.sampledElevation=e,o.verticalDistanceToGround=0,o.z=e};this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,n,r),this._resetEdgeObject(i)}getCenterObjectSpace(e=P()){return ce(e,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(e=Ks()){const r=this.stageObject.boundingVolumeObjectSpace;return yCe(e,r.min),_Ce(e,r.max),e}computeAttachmentOrigin(e){if(this.useObjectOriginAsAttachmentOrigin){const r=this.stageObject.transformation;e.render.origin[0]+=r[12],e.render.origin[1]+=r[13],e.render.origin[2]+=r[14],e.render.num++}else for(const r of this.stageObject.geometries)r.computeAttachmentOrigin(Uy)&&(Ke(Uy,Uy,this.stageObject.transformation),me(e.render.origin,e.render.origin,Uy),e.render.num++)}async getProjectedBoundingBox(e,r,i,n,s){const o=this.getBoundingBoxObjectSpace(s),a=BEt,l=Ine(o)?1:a.length;for(let h=0;h<l;h++){const p=a[h];Av[0]=o[p[0]],Av[1]=o[p[1]],Av[2]=o[p[2]],Ke(Av,Av,this.stageObject.transformation),hx[3*h+0]=Av[0],hx[3*h+1]=Av[1],hx[3*h+2]=Av[2]}if(!e(hx,0,l))return null;ki(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let p=0;p<3;p++)o[p]=Math.min(o[p],hx[h+p]),o[p+3]=Math.max(o[p+3],hx[h+p]);c&&i.push({location:hx.slice(h,h+3),screenSpaceBoundingRect:c})}if(r&&r.service&&this.elevationContext.mode!=="absolute-height"){Bf(o,Uy);const h=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let p=0;if(r.useViewElevation)p=Nt(r.service.getElevation(Uy[0],Uy[1],h),0);else try{const f=Ule(o,r.service.spatialReference,r);p=Nt(await r.service.queryElevation(Uy[0],Uy[1],n,f,h),0)}catch{}gCe(o,0,0,-this.alignedSampledElevation+p)}return o}addObjectState(e,r){e===A_.Highlight&&r.addObject(this.stageObject,this.stageObject.highlight()),e===A_.MaskOccludee&&r.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeObject(this.stageObject)}_resetEdgeObject(e){if(R(this._edgeState))return;const r=this._stage.renderer.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(r,e):r.removeObject(this.stageObject)}_addOrUpdateEdgeObject(e,r){const i=this._edgeState;if(R(i))return;const n=m_e(i.baseMaterial);for(const s of i.edgeMaterials)s.objectTransparency=n;e.addOrUpdateObject3D(this.stageObject,i.edgeMaterials,i.properties,!r).then(()=>{var s;return(s=this._stageLayer)==null?void 0:s.sync()})}};function m_e(t){return t.isVisible()?t.parameters.transparent?ar.TRANSPARENT:ar.OPAQUE:ar.INVISIBLE}const hx=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Av=P(),Uy=P(),BEt=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];let g5e=class{constructor(e,r=null){this.labelText=r,this.elevationOffset=Nt(e,0)}};var Ys;(function(t){t[t.Recreate_Symbol=0]="Recreate_Symbol",t[t.Recreate_Graphics=1]="Recreate_Graphics",t[t.Fast_Update=2]="Fast_Update"})(Ys||(Ys={}));let jle=class{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=Fh.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,r){return this._loadStatus===Fh.LOADED?(e&&e(),Nt(this._loader,Promise.resolve())):this._loadStatus===Fh.FAILED?(r&&r(this._loadError),Nt(this._loader,Promise.resolve())):(R(this._loader)&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=Fh.LOADED},i=>{throw this._loadError=i,this._abortController=null,this._loadStatus=Fh.FAILED,!ps(i)&&this.logger&&i.message&&this.logger.warn(i.message),i})),this._loader.then(e,r).catch(()=>{}),this._loader)}abortLoad(){v(this._abortController)?this._abortController=Tp(this._abortController):this._loadStatus===Fh.LOADING&&(this._loadStatus=Fh.FAILED),this._loader=null}};var Fh;(function(t){t[t.LOADING=0]="LOADING",t[t.LOADED=1]="LOADED",t[t.FAILED=2]="FAILED"})(Fh||(Fh={}));const y5e=3,_te=3,_5e=10;let v5e=class{constructor(e,r=null){this.geometry=e,this.textures=r}};function E5(t){const e=[];return t.levels.forEach(r=>r.components.forEach(i=>e.push(i.geometry.material))),iN(e)}function g_e(t){const e=new Array;return t.levels.forEach(r=>{r.components.forEach(i=>{v(i.textures)&&e.push(...i.textures)})}),iN(e)}function b5e(t){const e=t.components.map(r=>r.geometry);return iN(e)}function y_e(t){const e=[];return t.levels.forEach(r=>{r.components.forEach(i=>{e.push(i.geometry)})}),iN(e)}function jEt(t){switch(t){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function w5e(t,e){const r=(i,n,s=!1)=>({levels:i.map(o=>{const a=n(o.tesselation);return s&&Wvt(a),{components:[new v5e(a)],faceCount:a.indexCount/3,minScreenSpaceRadius:o.minScreenSpaceRadius}})});switch(t){case"sphere":return r([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],i=>Gvt(e,.5,i,!0));case"cube":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>Dvt(e,1));case"cone":return r(Oq,i=>kye(e,1,.5,i,!1),!0);case"inverted-cone":return r(Oq,i=>kye(e,1,.5,i,!0),!0);case"cylinder":return r(Oq,i=>qvt(e,1,.5,i,[0,0,1],[0,0,.5]));case"tetrahedron":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>jvt(e,1),!0);case"diamond":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>Uvt(e,1),!0);default:return}}const Oq=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];function GEt(t){return t.type==="fill"}function HEt(t){return t.type==="extrude"}function qEt(t){return t&&t.enabled&&(HEt(t)||GEt(t))&&v(t.edges)}function WEt(t){return t&&t.enabled&&t.edges||null}function x5e(t,e){return XEt(WEt(t),e)}function XEt(t,e){if(R(t))return null;const r=v(t.color)?eoe(Xe.toUnitRGBA(t.color)):Zt(0,0,0,0),i=da(t.size),n=da(t.extensionLength);switch(t.type){case"solid":return YEt({color:r,size:i,extensionLength:n,...e});case"sketch":return ZEt({color:r,size:i,extensionLength:n,...e});default:return}}function YEt(t){return{...JEt,...t,type:"solid"}}function ZEt(t){return{...KEt,...t,type:"sketch"}}const JEt={color:Zt(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:ar.OPAQUE,hasSlicePlane:!1},KEt={color:Zt(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:ar.OPAQUE,hasSlicePlane:!1},Gle={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};function CYt(t){return t.type==="web-style"?Gle:Hle(t.symbolLayers.toArray().map(e=>T5e(t,e)))}function Hle(t){let e=0,r=0,i=0,n=!1,s=0;const o={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const a of t)R(a)||(e+=a.primitivesPerFeature,r+=a.primitivesPerCoordinate,i+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.bytesPerCoordinate+=a.memory.bytesPerCoordinate,o.resourceBytes+=a.memory.resourceBytes,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.draped.bytesPerCoordinate+=a.memory.bytesPerCoordinate,n=n||a.estimated,++s);return{primitivesPerFeature:e,primitivesPerCoordinate:r,drawCallsPerFeature:i,estimated:n,memory:o,numComplexities:s}}function AYt(t){const e=Hle(t);return e.numComplexities>0&&(e.primitivesPerFeature/=e.numComplexities,e.primitivesPerCoordinate/=e.numComplexities,e.drawCallsPerFeature/=e.numComplexities,e.memory.bytesPerFeature/=e.numComplexities,e.memory.bytesPerFeatureLabel/=e.numComplexities,e.memory.bytesPerCoordinate/=e.numComplexities,e.memory.resourceBytes/=e.numComplexities,e.memory.draped.bytesPerFeature/=e.numComplexities,e.memory.draped.bytesPerFeatureLabel/=e.numComplexities,e.memory.draped.bytesPerCoordinate/=e.numComplexities),e}const __e={};function T5e(t,e){const r=S5e(t,e),i=qEt(e)?2:0;switch(e.type){case"extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:i,estimated:!1,memory:r};case"fill":return t.type==="mesh-3d"?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:i,estimated:!1,memory:r}:v(e.outline)&&e.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:r}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:r};case"water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:r};case"line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:r};case"object":return e.resource&&e.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:r}:{...QEt(e.resource&&e.resource.primitive||WCe),memory:r};case"path":{let n=0,s=0;switch(e.profile){case"circle":n=_5e;break;case"quad":n=4;break;default:return void(e.profile,void 0)}switch(e.join??"simple"){case"round":s=y5e;break;case"miter":case"bevel":s=1;break;default:return}const o=2*n,a=n*s*2;let l=-2*a-o;switch(e.cap){case"none":break;case"butt":case"square":l+=2*(n-1);break;case"round":l+=2*(n*(_te-1)*2+n);break;default:return}return{primitivesPerFeature:l,primitivesPerCoordinate:a+o,drawCallsPerFeature:0,estimated:!1,memory:r}}case"text":case"icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:r};default:return}}function S5e(t,e){const r=t.type==="point-3d";switch(e.type){case"extrude":return e.edges&&e.edges.size>0?cc.EXTRUDE_EDGES:cc.EXTRUDE;case"fill":return v(e.outline)&&e.outline.size>0?cc.FILL_OUTLINE:cc.FILL;case"water":return cc.FILL;case"line":return e.join==="round"?cc.LINE_ROUND:cc.LINE_MITER;case"path":switch(e.join){case"round":switch(e.profile){case"circle":return cc.PATH_ROUND_CIRCLE;case"quad":return cc.PATH_ROUND_QUAD;default:return void(e.profile,void 0)}case"miter":case"bevel":switch(e.profile){case"circle":return cc.PATH_MITER_CIRCLE;case"quad":return cc.PATH_MITER_QUAD;default:return void(e.profile,void 0)}default:return}case"object":return r?cc.OBJECT_POINT:cc.OBJECT_POLYGON;case"icon":case"text":return r?cc.ICON_POINT:cc.ICON_POLYGON;default:return}}function QEt(t){let e=__e[t];if(e)return e;const r=w5e(t,null);return e={primitivesPerFeature:b5e(r.levels[0]).reduce((i,n)=>i+n.indices.get(O.POSITION).length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1},__e[t]=e,e}const cc={ICON_POINT:{bytesPerFeature:3293.7707557538765,bytesPerFeatureLabel:1020.2764,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:2213.51585392203,bytesPerFeatureLabel:1008.84664,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:4745.397589234022,bytesPerFeatureLabel:1006.5440666666666,bytesPerCoordinate:3.8971910718981526,resourceBytes:0,draped:{bytesPerFeature:3711.9299672493826,bytesPerFeatureLabel:991.1003999999999,bytesPerCoordinate:3.916858016273668}},OBJECT_POINT:{bytesPerFeature:1751.6405617660876,bytesPerFeatureLabel:1024.7827699999998,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:1751.6405617660876,bytesPerFeatureLabel:1024.7827699999998,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:3265.877223973855,bytesPerFeatureLabel:1002.3207366666666,bytesPerCoordinate:4.003101524580855,resourceBytes:0,draped:{bytesPerFeature:3265.877223973855,bytesPerFeatureLabel:1002.3207366666666,bytesPerCoordinate:4.003101524580855}},LINE_MITER:{bytesPerFeature:5757.019675077085,bytesPerFeatureLabel:998.6150266666667,bytesPerCoordinate:24.456810187064043,resourceBytes:0,draped:{bytesPerFeature:4101.480288021862,bytesPerFeatureLabel:1007.7540599999999,bytesPerCoordinate:18.25629912730874}},LINE_ROUND:{bytesPerFeature:5770.95297166408,bytesPerFeatureLabel:1017.77396,bytesPerCoordinate:24.60919037084966,resourceBytes:0,draped:{bytesPerFeature:4089.5796612121826,bytesPerFeatureLabel:987.8320266666666,bytesPerCoordinate:18.43599029126731}},PATH_MITER_CIRCLE:{bytesPerFeature:36120.81813311945,bytesPerFeatureLabel:977.3815,bytesPerCoordinate:2713.2216607858863,resourceBytes:0,draped:{bytesPerFeature:36120.81813311945,bytesPerFeatureLabel:977.3815,bytesPerCoordinate:2713.2216607858863}},PATH_ROUND_CIRCLE:{bytesPerFeature:23268.96777866874,bytesPerFeatureLabel:985.2637,bytesPerCoordinate:5284.873051323177,resourceBytes:0,draped:{bytesPerFeature:23268.96777866874,bytesPerFeatureLabel:985.2637,bytesPerCoordinate:5284.873051323177}},PATH_MITER_QUAD:{bytesPerFeature:24548.629753007182,bytesPerFeatureLabel:964.6924,bytesPerCoordinate:2114.107276663994,resourceBytes:0,draped:{bytesPerFeature:24548.629753007182,bytesPerFeatureLabel:964.6924,bytesPerCoordinate:2114.107276663994}},PATH_ROUND_QUAD:{bytesPerFeature:34316.219663191616,bytesPerFeatureLabel:975.7985,bytesPerCoordinate:3331.3952550120293,resourceBytes:0,draped:{bytesPerFeature:34316.219663191616,bytesPerFeatureLabel:975.7985,bytesPerCoordinate:3331.3952550120293}},FILL:{bytesPerFeature:6141.501452970723,bytesPerFeatureLabel:1008.2056066666665,bytesPerCoordinate:9.669541106191478,resourceBytes:0,draped:{bytesPerFeature:4615.812654782311,bytesPerFeatureLabel:1004.2114200000001,bytesPerCoordinate:7.378043214430644}},FILL_OUTLINE:{bytesPerFeature:9038.575581319641,bytesPerFeatureLabel:1017.9996066666668,bytesPerCoordinate:14.96569682175086,resourceBytes:0,draped:{bytesPerFeature:6369.386021594582,bytesPerFeatureLabel:1008.9863733333334,bytesPerCoordinate:10.25287774000214}},EXTRUDE:{bytesPerFeature:20071.2337049912,bytesPerFeatureLabel:1019.49468,bytesPerCoordinate:49.39369614206849,resourceBytes:0,draped:{bytesPerFeature:20071.2337049912,bytesPerFeatureLabel:1019.49468,bytesPerCoordinate:49.39369614206849}},EXTRUDE_EDGES:{bytesPerFeature:22300.21739345088,bytesPerFeatureLabel:1017.4348466666665,bytesPerCoordinate:49.40242281963031,resourceBytes:0,draped:{bytesPerFeature:22300.21739345088,bytesPerFeatureLabel:1017.4348466666665,bytesPerCoordinate:49.40242281963031}}},IE=re.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");let Ty=class extends jle{constructor(e,r,i,n){super(i.schedule),this.symbol=e,this.symbolLayer=r,this._context=i,this._elevationInfoOverride=null,this._ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this.complexity=null,this.logger=IE,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this._renderPriority=n.renderPriority,this._renderPriorityStep=n.renderPriorityStep,this._elevationContext=new Tm,this.complexity=this.computeComplexity(),this._ignoreDrivers=n.ignoreDrivers,this._ignoreDrivers||(this._drivenProperties=v_e(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}_drivenPropertiesChanged(e){if(this._ignoreDrivers)return!1;const r=this._drivenProperties,i=v_e(e);return i.color!==r.color||i.opacity!==r.opacity||i.opacityAlwaysOpaque!==r.opacityAlwaysOpaque||i.size!==r.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,r,i,n){const s=e.projectionSuccess,o="polygons"in e?e.polygons:null,a=`${n} geometry failed to be created`;let l=null;s?!this._logGeometryValidationWarnings(r,i,n)&&o&&o.length===0&&i==="rings"&&r.length>0&&r[0].length>2&&(l=`${a} (filled rings should use clockwise winding - try reversing the order of vertices)`):l=`${a} (failed to project geometry to view spatial reference)`,l&&IE.warnOncePerTick(l)}_logGeometryValidationWarnings(e,r,i){const n=`${i} geometry failed to be created`;return!e.length||e.length===1&&!e[0].length?(IE.warnOncePerTick(`${n} (no ${r} were defined)`),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(IE.warnOncePerTick(`${n} (${r} should be defined as a 2D array)`),!0)}_validateGeometry(e,r=null,i=null){if(v(r)&&!r.includes(e.type))return this.logger.warn("unsupported geometry type for "+i+` symbol: ${e.type}`),!1;if(e.type==="point"){const n=e;if(!isFinite(n.x)||!isFinite(n.y))return IE.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return eCt}_defaultElevationInfoZ(){return tCt}_updateElevationContext(){v(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,r=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||r.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,r){const i=e.geometry,n=this.getDefaultElevationInfo(i);r.unit=this._elevationContext.unit!=null?this._elevationContext.unit:n.unit,r.mode=this.getGeometryElevationMode(i,n),r.offsetMeters=Nt(this._elevationContext.meterUnitOffset,Nt(n.offset,0));const s=!this._elevationOptions.supportsOnTheGround&&r.mode==="on-the-ground";s&&(r.mode="relative-to-ground",r.offsetMeters=0);const o=s?UEt:this._elevationContext.featureExpressionInfoContext;return r.updateFeatureExpressionInfoContext(o,e,this._context.layer),r}prepareSymbolLayerPatch(e){}updateGeometry(e,r){return!1}onRemoveGraphic(e){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity??0:this._context.layer.opacity??1}_getCombinedOpacity(e,r=b_e){let i=1;return this.draped||(i*=this._getLayerOpacity()),this._drivenProperties.opacity||(v(e)?i*=e.a:r.hasIntrinsicColor||(i=0)),i}_getCombinedOpacityAndColor(e,r=b_e){const i=this._getCombinedOpacity(e,r);if(this._drivenProperties.color)return Z$(null,i);const n=v(e)?Xe.toUnitRGB(e):Lg;return Z$(n,i)}_getVertexOpacityAndColor(e,r=null){const i=this._drivenProperties.color?e.color:null,n=this._drivenProperties.opacity?e.opacity:null,s=Z$(i,n);return v(r)&&(s[0]*=r,s[1]*=r,s[2]*=r,s[3]*=r),s}isFastUpdatesEnabled(){return this._fastUpdates&&this._fastUpdates.enabled}computeComplexity(){return T5e(this.symbol,this.symbolLayer)}globalPropertyChanged(e,r,i){switch(e){case"opacity":return this.layerOpacityChanged(r,i),!0;case"elevationInfo":{const n=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(r,i,n)!==Pn.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(r,i);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged();case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged();default:return!1}}updateGraphics3DGraphicElevationInfo(e,r,i){let n=Pn.UPDATE;return e.forEach(s=>{const o=r(s);if(v(o)){const a=s.graphic;this.setGraphicElevationContext(a,o.elevationContext),o.needsElevationUpdates=i(o.elevationContext.mode)}else n=Pn.RECREATE}),n}applyRendererDiff(e,r){return Ys.Recreate_Symbol}getFastUpdateAttrValues(e){if(!this._fastUpdates.enabled)return null;const r=this._fastUpdates.visualVariables,i=r.size?a_(r.size.field,e):0,n=r.color?a_(r.color.field,e):0,s=r.opacity?a_(r.opacity.field,e):0;return Zt(i,n,s,0)}get draped(){return this._draped}ensureDrapedStatus(e){return this._draped==null?(this._draped=e,!0):(e!==this.draped&&IE.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const e=()=>{var r,i,n,s,o,a,l,c,h,p,f,m;return{size:((n=(i=(r=this._fastUpdates)==null?void 0:r.visualVariables)==null?void 0:i.size)==null?void 0:n.field)??null,color:((a=(o=(s=this._fastUpdates)==null?void 0:s.visualVariables)==null?void 0:o.color)==null?void 0:a.field)??null,opacity:((h=(c=(l=this._fastUpdates)==null?void 0:l.visualVariables)==null?void 0:c.opacity)==null?void 0:h.field)??null,rotation:((m=(f=(p=this._fastUpdates)==null?void 0:p.visualVariables)==null?void 0:f.rotation)==null?void 0:m.field)??null}};return{drivenProperties:this._drivenProperties,getVisVarFields:e}}};function a_(t,e){const r=t!=null?e.attributes[t]:0;return r!=null&&isFinite(r)?r:0}function v_e(t){const e={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return t&&"visualVariables"in t&&t.visualVariables&&t.visualVariables.forEach(r=>{switch(r.type){case"color":if(e.color=!0,r.stops)for(let i=0;i<r.stops.length;i++){const n=r.stops[i].color;n&&(e.opacity=!0,n.a<1&&(e.opacityAlwaysOpaque=!1))}break;case"opacity":e.opacity=!0,e.opacityAlwaysOpaque=!1;break;case"size":e.size=!0}}),e}const eCt={mode:"on-the-ground",offset:0,unit:"meters"},tCt={mode:"absolute-height",offset:0,unit:"meters"},b_e={hasIntrinsicColor:!1};let Z_=class extends GN{get geometries(){return this._geometries}get transformation(){return this._transformation}set transformation(e){po(this._transformation,e),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}constructor(e={}){super(),this.type=Wn.Object,this._geometries=new Array,this._transformation=$e(),this._bvObjectSpace=new w_e,this._bvWorldSpace=new w_e,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._visible=!0,this.castShadow=e.castShadow==null||e.castShadow,this.metadata=e.metadata,this.metadata&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new E5e);const r=e.geometries;v(r)&&(this._geometries=Array.from(r))}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){wt(this._parentLayer==null||e==null,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._hasVolatileTransformation=this._hasVolatileTransformation||e.hasVolatileTransformation,this._emit("objectGeometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){const r=this._geometries.splice(e,1)[0];r&&(this._emit("objectGeometryRemoved",{object:this,geometry:r}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(e){this._emit("objectGeometryUpdated",{object:this,geometry:e}),this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const r of this._geometries)r.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new aV(A_.MaskOccludee);for(const r of this._geometries)r.occludees=Wee(r.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const r of this._geometries)r.occludees=Xee(r.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new aV(A_.Highlight);for(const r of this._geometries)r.highlights=Wee(r.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const r of this._geometries)r.highlights=Xee(r.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,r){return Mn(r,this.transformation,e.transformation)}_getCombinedShaderTransformation(e){return Mn($e(),this.transformation,e.shaderTransformation)}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._validateBoundingVolume(),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._validateBoundingVolume(),this._bvObjectSpace}_validateBoundingVolume(){if(!this._bvDirty&&!this._hasVolatileTransformation)return;this._bvObjectSpace.init(),this._bvWorldSpace.init();for(const n of this._geometries){const s=n.boundingInfo;v(s)&&(x_e(s,this._bvObjectSpace,n.shaderTransformation),x_e(s,this._bvWorldSpace,this._getCombinedShaderTransformation(n)))}fs(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),fs(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);const e=P(),r=P(),i=p2(this.transformation);for(const n of this._geometries){const s=n.boundingInfo;if(R(s))continue;const o=n.shaderTransformation,a=p2(o);Ke(e,s.center,o);const l=Pi(e,this._bvObjectSpace.bounds),c=s.radius*a;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],l+c),Ke(r,e,this.transformation);const h=Pi(r,this._bvWorldSpace.bounds),p=c*i;this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],h+p)}this._bvDirty=!1}_invalidateBoundingVolume(){this._bvDirty=!0,v(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)}_emit(e,r){v(this._parentLayer)&&this._parentLayer.events.emit(e,r)}get test(){const e=this;return{hasGeometry:r=>e._geometries.includes(r),getGeometryIndex:r=>e._geometries.indexOf(r)}}},E5e=class{constructor(){this.min=ke(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=ke(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}},w_e=class extends E5e{constructor(){super(...arguments),this.bounds=Os()}init(){he(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),he(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),SLe(this.bounds)}};function x_e(t,e,r){const i=t.bbMin,n=t.bbMax;if(tB(r)){const s=he(rCt,r[12],r[13],r[14]);me(ch,i,s),me(Xp,n,s);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],ch[o]),e.max[o]=Math.max(e.max[o],Xp[o])}else if(Ke(ch,i,r),Hl(i,n))for(let s=0;s<3;++s)e.min[s]=Math.min(e.min[s],ch[s]),e.max[s]=Math.max(e.max[s],ch[s]);else{Ke(Xp,n,r);for(let s=0;s<3;++s)e.min[s]=Math.min(e.min[s],ch[s],Xp[s]),e.max[s]=Math.max(e.max[s],ch[s],Xp[s]);for(let s=0;s<3;++s){ce(ch,i),ce(Xp,n),ch[s]=n[s],Xp[s]=i[s],Ke(ch,ch,r),Ke(Xp,Xp,r);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],ch[o],Xp[o]),e.max[o]=Math.max(e.max[o],ch[o],Xp[o])}}}const rCt=P(),ch=P(),Xp=P();function qle(t,e,r,i,n,s){const o=t.clippingExtent;if(Ba(e,wb,t.elevationProvider.spatialReference),v(o)&&!Mne(o,wb))return null;Ba(e,wb,t.renderCoordsHelper.spatialReference);const a=t.localOriginFactory.getOrigin(wb),l=new Z_({castShadow:!1,metadata:{layerUid:t.layer.uid,graphicUid:n,usesVerticalDistanceToGround:!0}});return r.shaderTransformer=s,r.localOrigin=a,l.addGeometry(r),{object:l,sampledElevation:SEt(l,e,t.elevationProvider,t.renderCoordsHelper,i)}}function ID(t,e,r){const i=t.elevationContext,n=r.spatialReference;Ba(e,wb,n),i.centerPointInElevationSR=Y_(wb[0],wb[1],e.hasZ?wb[2]:0,v(n)?n:null)}function $D(t){switch(t.type){case"point":return t;case"polygon":case"extent":return kle(t);case"polyline":{const e=t.paths[0];if(!e||e.length===0)return null;const r=X2e(e,W2e(e)/2);return Y_(r[0],r[1],r[2],t.spatialReference)}case"mesh":return t.origin}return null}const wb=P();function iCt(t){const e=new Br;e.include(Zae),e.include(u4e,t),e.include(hs,t),e.attributes.add(O.UV0,"vec2");const{vertex:r,fragment:i}=e;return r.uniforms.add([new br("viewport",(n,s)=>s.camera.fullViewport),new Ie("lineSize",(n,s)=>Math.ceil(n.size)*s.camera.pixelRatio),new Hr("pixelToNDC",(n,s)=>dt(S_e,2/s.camera.fullViewport[2],2/s.camera.fullViewport[3])),new Ie("borderSize",(n,s)=>v(n.borderColor)?s.camera.pixelRatio:0),new Hr("screenOffset",(n,s)=>dt(S_e,n.screenOffset[0]*s.camera.pixelRatio,n.screenOffset[1]*s.camera.pixelRatio))]),e.varyings.add("coverageSampling","vec4"),e.varyings.add("lineSizes","vec2"),t.hasMultipassGeometry&&e.varyings.add("depth","float"),t.hasScreenSizePerspective&&f7(r),r.code.add(S`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${t.occlusionTestEnabled?S`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${t.hasScreenSizePerspective?S`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:S`
      vec2 screenOffsetScaled = screenOffset;
        `}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly
      // used to get the correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${t.hasMultipassGeometry?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${t.depthHudEnabled?t.depthHudAlignStartEnabled?S`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:S`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${t.hasScreenSizePerspective?S`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:S`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;
      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned
      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,
      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel
      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).
      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;
      float halfPixelSizeInt = floor(halfWholePixelSize);

      // Sub-pixel offset if we need to grow sub-pixels to the left
      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);

      // Pixel offset aligning to whole pixels and adding subpixel offset if needed
      float pixelOffset = -halfPixelSizeInt + subpixelOffset;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),i.uniforms.add([new br("uColor",n=>T_e(n.color)),new br("borderColor",n=>T_e(n.borderColor))]),t.hasMultipassGeometry&&(i.include(zDe,t),i.uniforms.add(new Hr("inverseViewport",(n,s)=>s.inverseViewport))),i.code.add(S`
    void main() {
      ${t.hasMultipassGeometry?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line
      // blends on top of the border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage
      // and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${t.depthHudEnabled?S`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:S`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      gl_FragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),e}function T_e(t){return v(t)?t:Wg}const S_e=Ne(),nCt=Object.freeze(Object.defineProperty({__proto__:null,build:iCt},Symbol.toStringTag,{value:"Module"}));let C5e=class A5e extends Wr{initializeConfiguration(e,r){r.spherical=e.viewingMode===qe.Global}initializeProgram(e){return new Gr(e.rctx,A5e.shader.get().build(this.configuration),Lr)}setPipelineState(e){const r=e?zi.ALWAYS:zi.LESS;return this.configuration.depthHudEnabled?Ht({depthTest:{func:r},depthWrite:Xc}):Ht({blending:mo(Ce.ONE,Ce.SRC_ALPHA,Ce.ONE_MINUS_SRC_ALPHA,Ce.ONE_MINUS_SRC_ALPHA),depthTest:{func:r},colorWrite:ir})}initializePipeline(){return this.setPipelineState(this.configuration.hasMultipassGeometry)}};C5e.shader=new jr(nCt,()=>Q(()=>import("./LineCallout.glsl-cdc92e8d.js"),[]));let Dd=class extends Io{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=kc.World,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.hasMultipassGeometry=!1}};u([j({count:kc.COUNT})],Dd.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([j()],Dd.prototype,"spherical",void 0),u([j()],Dd.prototype,"occlusionTestEnabled",void 0),u([j()],Dd.prototype,"hasVerticalOffset",void 0),u([j()],Dd.prototype,"hasScreenSizePerspective",void 0),u([j()],Dd.prototype,"depthHudEnabled",void 0),u([j()],Dd.prototype,"depthHudAlignStartEnabled",void 0),u([j()],Dd.prototype,"hasSlicePlane",void 0),u([j()],Dd.prototype,"hasMultipassGeometry",void 0),u([j({constValue:!0})],Dd.prototype,"hasSliceInVertexProgram",void 0),u([j({constValue:!1})],Dd.prototype,"isDraped",void 0);let C5=class vte extends Fw{get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}constructor(e){super(e,new R5e),this._configuration=new Dd,this._uniqueMaterialIdentifier=vte.uniqueMaterialIdentifier(this.parameters)}getPassParameters(){return this.parameters}getConfiguration(e,r){const i=(r==null?void 0:r.slot)!==Ee.LINE_CALLOUTS;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=v(this.parameters.verticalOffset),this._configuration.hasScreenSizePerspective=v(this.parameters.screenSizePerspective),this._configuration.depthHudEnabled=i,this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?kc.Screen:kc.World,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasMultipassGeometry=r.multipassGeometry.enabled,this._configuration}intersect(){}requiresSlot(e,r){if(r===V.Color)switch(e){case Ee.LINE_CALLOUTS:case Ee.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1}createGLMaterial(e){return new sCt(e)}createBufferWriter(){return new aCt}validateParameters(e){const r=vte.uniqueMaterialIdentifier(e);r!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=r)}static uniqueMaterialIdentifier(e){return JSON.stringify({screenOffset:e.screenOffset||[0,0],centerOffsetUnits:e.centerOffsetUnits||"world"})}},sCt=class extends Nw{beginSlot(e){return this.ensureTechnique(C5e,e)}},R5e=class extends z3{constructor(){super(...arguments),this.screenOffset=Wc,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}};const oCt=mn().vec3f(O.POSITION).vec3f(O.NORMAL).vec2f(O.UV0).vec4f(O.AUXPOS1),E_e=[ep(0,0),ep(1,0),ep(0,1),ep(1,0),ep(1,1),ep(0,1)];let aCt=class{constructor(){this.vertexBufferLayout=oCt}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 6*e.indices.get(O.POSITION).length}write(e,r,i,n,s){m7(i.indices.get(O.POSITION),i.vertexAttributes.get(O.POSITION).data,e,n.position,s,6),Mle(i.indices.get(O.NORMAL),i.vertexAttributes.get(O.NORMAL).data,r,n.normal,s,6),ZO(i.indices.get(O.AUXPOS1),i.vertexAttributes.get(O.AUXPOS1).data,n.auxpos1,s,6);for(let o=0;o<E_e.length;++o)n.uv0.setVec(s+o,E_e[o])}},O5e=class M5e extends Ty{constructor(e,r){super(e,null,r,uCt),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._material=new C5(this._materialParameters),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}_perInstanceMaterialParameters(e){const r=this._materialParameters;return r.screenOffset=e.screenOffset||Wc,r.centerOffsetUnits=e.centerOffsetUnits||"world",r}get _materialParameters(){const e=new R5e,r=this.symbol,i=r.callout;if(e.color=v(i.color)?Xe.toUnitRGBA(i.color):[0,0,0,0],e.color[3]*=this._getLayerOpacity(),e.size=da(i.size||0),r.verticalOffset){const{screenLength:o,minWorldLength:a,maxWorldLength:l}=r.verticalOffset;e.verticalOffset={screenLength:da(o),minWorldLength:a||0,maxWorldLength:v(l)?l:1/0}}e.borderColor=v(i.border)&&v(i.border.color)?Xe.toUnitRGBA(i.border.color):null;const n=r.symbolLayers.getItemAt(0).type==="object",s=r.type==="label-3d";return e.occlusionTest=!n,e.shaderPolygonOffset=n?0:void 0,e.depthHUDAlignStart=s,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}_defaultElevationInfoNoZ(){return cCt}createGraphics3DGraphic(e){const r=e.renderingInfo,i=e.graphic,n=this.setGraphicElevationContext(i,new Tm,r.elevationOffset||0),s=r.symbol,o=this._elevationContext.mode==="on-the-ground"&&(s.type==="cim"||!s.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(s.type!=="label-3d"&&o||s.type==="point-3d"&&s.symbolLayers.every(l=>l.type==="text"&&!QCe(l)))return null;const a=kle(i.geometry);return R(a)?null:this._createAs3DShape(a,n,r,i.uid)}layerOpacityChanged(){v(this._material)&&this._material.setParameters(this._materialParameters)}layerElevationInfoChanged(e,r,i){const n=this._elevationContext.mode,s=ZN(M5e.elevationModeChangeTypes,i,n);return s!==Pn.UPDATE||e.forEach(o=>{const a=r(o);v(a)&&this.updateGraphicElevationContext(o.graphic,a)}),s}slicePlaneEnabledChanged(){return R(this._material)||this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}setGraphicElevationContext(e,r,i=0){const n=super.setGraphicElevationContext(e,r);return n.addOffsetRenderUnits(i),n}updateGraphicElevationContext(e,r){this.setGraphicElevationContext(e,r.elevationContext,v(r.metadata)?r.metadata.elevationOffset:0),r.needsElevationUpdates=$p(r.elevationContext.mode)}computeComplexity(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:Gle.memory}}_createVertexData(e){const{translation:r,centerOffset:i}=e,n=new Qe(r?[r[0],r[1],r[2]]:[0,0,0],3,!0),s=new Qe(i?[i[0],i[1],i[2],i[3]]:[0,0,0,1],4,!0);return[[O.POSITION,n],[O.NORMAL,new Qe([0,0,1],3,!0)],[O.AUXPOS1,s]]}_getOrCreateMaterial(e){const r=this._perInstanceMaterialParameters(e),i=C5.uniqueMaterialIdentifier(r);if(v(this._material)&&i===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(v(e.materialCollection)){let n=e.materialCollection.get(i);return R(n)&&(n=new C5(r),e.materialCollection.add(i,n)),{material:n,isUnique:!1}}return{material:new C5(r),isUnique:!0}}_createAs3DShape(e,r,i,n){const s=this._context.layer.uid,o=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:s}),a=this._getOrCreateMaterial(i),l=new As(a.material,this._createVertexData(i),lCt,null,Wn.Point,o),c=qle(this._context,e,l,r,n);if(R(c))return null;const h=new xy(this,c.object,[l],a.isUnique?[a.material]:null,null,PD,r);return h.metadata=new g5e(i.elevationOffset),h.alignedSampledElevation=c.sampledElevation,h.needsElevationUpdates=$p(r.mode),ID(h,e,this._context.elevationProvider),h}};O5e.elevationModeChangeTypes={definedChanged:Pn.UPDATE,staysOnTheGround:Pn.UPDATE,onTheGroundChanged:Pn.RECREATE};const Mq=[0],lCt=[[O.POSITION,Mq],[O.NORMAL,Mq],[O.AUXPOS1,Mq]],cCt={mode:"relative-to-ground",offset:0},uCt={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};let hCt=class{constructor(e,r,i=P(),n=pr(),s=Ne(),o="world",a=0,l=null){this.renderer=e,this.symbol=r,this.translation=i,this.centerOffset=n,this.screenOffset=s,this.centerOffsetUnits=o,this.elevationOffset=a,this.materialCollection=l}},dCt=class extends zEt{};const C_e=re.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function pCt(t,e){if(!Zne(t))return C_e.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${t.type}' does not support callouts`),null;if(!t.callout)return null;const r=fCt[t.callout.type];return r?new r(t,e):(C_e.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${t.callout.type}`),null)}const fCt={line:O5e},A_e=new ko(Array,t=>B9(t,vCe),null,10,5),mCt=Kt();let gCt=class{get labelLayers(){return this._labelLayers}get extent(){return this._extent}constructor(e,r,i,n,s){this.graphic=e,this.graphics3DSymbol=r,this.layers=i,this._labelLayers=new Array,this._auxiliaryLayers=new Array,this._visibilityFlags=yCt(aa._COUNT,Iu._COUNT),this._featureExpressionFeature=null,this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1},this._extent=null,this.isElevationSource=!1,++r.referenced,this._featureExpressionFeature=s?d5e(s,e,n):null;for(const o of i)v(o)&&(this.isElevationSource=this.isElevationSource||o.isElevationSource)}initialize(e,r){this._layer=r,this._stage=e,this._forEachSymbolLayerGraphic(i=>{i.initialize(e,r),i.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(e=>e.destroy()),this.layers=null,this._auxiliaryLayers=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.layers==null}clearLabelGraphics(){this._forEachLabelGraphic(e=>e.destroy()),this._labelLayers.length=0}addLabelGraphic(e,r,i){this._labelLayers.push(e),e.initialize(r,i),e.setVisibility(this.isVisible(aa.LABEL))}addAuxiliaryGraphic(e){this._auxiliaryLayers.push(e),this._layer&&(e.initialize(this._stage,this._layer),e.setVisibility(this.isVisible()))}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic(r=>{r.type==="draped"&&(e=!0)}),e}isVisible(e=aa.GRAPHIC,r){for(let i=0;i<=e;i++){const n=this._visibilityFlags[i];for(let s=0;s<n.length;++s)if(n[s]===!1&&s!==r)return!1}return!0}hasVisibilityFlag(e,r){return this._visibilityFlags[r][e]!=null}setVisibilityFlag(e,r,i){const n=this.isVisible(i);this._visibilityFlags[i][e]=r;const s=this.isVisible(i);if(n===s)return!1;if(i===aa.LABEL)this._forEachLabelGraphic(o=>o.setVisibility(s));else{this._forEachSymbolLayerGraphic(a=>a.setVisibility(s));const o=this.isVisible(aa.LABEL);this._forEachLabelGraphic(a=>a.setVisibility(o))}return!0}clearVisibilityFlag(e,r=aa.GRAPHIC){return this.setVisibilityFlag(e,void 0,r)}computeExtent(e){if(!this._extent){const r=this.graphic.geometry;if(R(r))return!1;this._extent=Kt(),dEt(r,this._extent);const i=r.spatialReference;if(!In(i,e)&&!rB(this._extent,i,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,r){return v(this._optimizedGeometry.geometry)&&this._optimizedGeometry.hasZ===e&&this._optimizedGeometry.hasM===r||(this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,r),this._optimizedGeometry.hasZ=e,this._optimizedGeometry.hasM=r),this._optimizedGeometry.geometry}_convertGraphicToOptimizedGeometry(e,r,i){let n=e.geometry;return n.type!=="mesh"&&n.type!=="extent"||(n=Jl.fromExtent(n.type==="mesh"?n.extent:n)),eit(n,r,i)}get usedMemory(){let e=cOe(this.graphic.attributes);return this._forEachSymbolLayerGraphic(r=>{const i=r.graphics3DSymbolLayer.complexity;if(R(i))return;const n=r.type==="draped"?i.memory.draped:i.memory;e+=n.bytesPerFeature,n.bytesPerCoordinate&&(e+=hEt(this.graphic.geometry)*n.bytesPerCoordinate)}),e}computeAttachmentOrigin(){const e={render:{origin:P(),num:0},draped:{origin:Ne(),num:0}};for(const r of this.layers)R(r)||r.computeAttachmentOrigin(e);return e.render.num>1&&le(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&sl(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,r,i,n,s){return s||(s={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),s.boundingBox?ki(s.boundingBox):s.boundingBox=ki(),s.requiresDrapedElevation=!1,await pB(this.layers,async o=>{if(R(o))return;const a=o.type==="draped"?r:e,l=A_e.acquire(),c=await o.getProjectedBoundingBox(a,i,s.screenSpaceObjects,n,l);isFinite(c[2])&&isFinite(c[5])||(s.requiresDrapedElevation=!0),c&&gO(s.boundingBox,l),A_e.release(l)}),fWe(s.boundingBox)||lZ(Pne(s.boundingBox,mCt))?s:null}needsElevationUpdates(){for(const e of this.layers)if(v(e)&&(e.type==="object3d"||e.type==="lod-instance")&&e.needsElevationUpdates)return!0;for(const e of this._labelLayers)if(e&&e.needsElevationUpdates)return!0;return!1}alignWithElevation(e,r,i){this._forEachRenderedGraphic(n=>{n.type!=="object3d"&&n.type!=="lod-instance"||n.alignWithElevation(e,r,this._featureExpressionFeature,i)})}alignWithAbsoluteElevation(e,r,i){this._forEachRenderedGraphic(n=>{n.type==="object3d"&&n.alignWithAbsoluteElevation(e,r,i)})}addObjectStateSet(e,r){this._forEachSymbolLayerGraphic(i=>i.addObjectState(e,r))}removeObjectState(e){this._forEachSymbolLayerGraphic(r=>r.removeObjectState(e))}_forEachGraphicList(e,r){e.forEach(i=>i&&r(i))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._forEachGraphicList(this._auxiliaryLayers,e)}_forEachLabelGraphic(e){this._forEachGraphicList(this._labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}};function yCt(t,e){const r=new Array(t);for(let i=0;i<r.length;i++)r[i]=new Array(e);return r}var R_e,O_e,M_e,vw={},_Ct={get exports(){return vw},set exports(t){vw=t}};R_e=_Ct,O_e=function(){function t(N,L,F){F=F||2;var G,q,Z,X,oe,pe,ye,Se=L&&L.length,He=Se?L[0]*F:N.length,Le=e(N,0,He,F,!0),Te=[];if(!Le||Le.next===Le.prev)return Te;if(Se&&(Le=l(N,L,Le,F)),N.length>80*F){G=Z=N[0],q=X=N[1];for(var Fe=F;Fe<He;Fe+=F)(oe=N[Fe])<G&&(G=oe),(pe=N[Fe+1])<q&&(q=pe),oe>Z&&(Z=oe),pe>X&&(X=pe);ye=(ye=Math.max(Z-G,X-q))!==0?1/ye:0}return i(Le,Te,F,G,q,ye),Te}function e(N,L,F,G,q){var Z,X;if(q===W(N,L,F,G)>0)for(Z=L;Z<F;Z+=G)X=ee(Z,N[Z],N[Z+1],X);else for(Z=F-G;Z>=L;Z-=G)X=ee(Z,N[Z],N[Z+1],X);if(X&&C(X,X.next)){var oe=X.next;te(X),X=oe}return X}function r(N,L){if(!N)return N;L||(L=N);var F,G=N;do if(F=!1,G.steiner||!C(G,G.next)&&E(G.prev,G,G.next)!==0)G=G.next;else{var q=G.prev;if(te(G),(G=L=q)===G.next)break;F=!0}while(F||G!==L);return L}function i(N,L,F,G,q,Z,X){if(N){!X&&Z&&g(N,G,q,Z);for(var oe,pe,ye=N;N.prev!==N.next;)if(oe=N.prev,pe=N.next,Z?s(N,G,q,Z):n(N))L.push(oe.i/F),L.push(N.i/F),L.push(pe.i/F),te(N),N=pe.next,ye=pe.next;else if((N=pe)===ye){X?X===1?i(N=o(r(N),L,F),L,F,G,q,Z,2):X===2&&a(N,L,F,G,q,Z):i(r(N),L,F,G,q,Z,1);break}}}function n(N){var L=N.prev,F=N,G=N.next;if(E(L,F,G)>=0)return!1;for(var q=N.next.next;q!==N.prev;){if(x(L.x,L.y,F.x,F.y,G.x,G.y,q.x,q.y)&&E(q.prev,q,q.next)>=0)return!1;q=q.next}return!0}function s(N,L,F,G){var q=N.prev,Z=N,X=N.next;if(E(q,Z,X)>=0)return!1;for(var oe=q.x<Z.x?q.x<X.x?q.x:X.x:Z.x<X.x?Z.x:X.x,pe=q.y<Z.y?q.y<X.y?q.y:X.y:Z.y<X.y?Z.y:X.y,ye=q.x>Z.x?q.x>X.x?q.x:X.x:Z.x>X.x?Z.x:X.x,Se=q.y>Z.y?q.y>X.y?q.y:X.y:Z.y>X.y?Z.y:X.y,He=b(oe,pe,L,F,G),Le=b(ye,Se,L,F,G),Te=N.prevZ,Fe=N.nextZ;Te&&Te.z>=He&&Fe&&Fe.z<=Le;){if(Te!==N.prev&&Te!==N.next&&x(q.x,q.y,Z.x,Z.y,X.x,X.y,Te.x,Te.y)&&E(Te.prev,Te,Te.next)>=0||(Te=Te.prevZ,Fe!==N.prev&&Fe!==N.next&&x(q.x,q.y,Z.x,Z.y,X.x,X.y,Fe.x,Fe.y)&&E(Fe.prev,Fe,Fe.next)>=0))return!1;Fe=Fe.nextZ}for(;Te&&Te.z>=He;){if(Te!==N.prev&&Te!==N.next&&x(q.x,q.y,Z.x,Z.y,X.x,X.y,Te.x,Te.y)&&E(Te.prev,Te,Te.next)>=0)return!1;Te=Te.prevZ}for(;Fe&&Fe.z<=Le;){if(Fe!==N.prev&&Fe!==N.next&&x(q.x,q.y,Z.x,Z.y,X.x,X.y,Fe.x,Fe.y)&&E(Fe.prev,Fe,Fe.next)>=0)return!1;Fe=Fe.nextZ}return!0}function o(N,L,F){var G=N;do{var q=G.prev,Z=G.next.next;!C(q,Z)&&A(q,G,G.next,Z)&&U(q,Z)&&U(Z,q)&&(L.push(q.i/F),L.push(G.i/F),L.push(Z.i/F),te(G),te(G.next),G=N=Z),G=G.next}while(G!==N);return r(G)}function a(N,L,F,G,q,Z){var X=N;do{for(var oe=X.next.next;oe!==X.prev;){if(X.i!==oe.i&&T(X,oe)){var pe=B(X,oe);return X=r(X,X.next),pe=r(pe,pe.next),i(X,L,F,G,q,Z),void i(pe,L,F,G,q,Z)}oe=oe.next}X=X.next}while(X!==N)}function l(N,L,F,G){var q,Z,X,oe=[];for(q=0,Z=L.length;q<Z;q++)(X=e(N,L[q]*G,q<Z-1?L[q+1]*G:N.length,G,!1))===X.next&&(X.steiner=!0),oe.push(w(X));for(oe.sort(c),q=0;q<oe.length;q++)F=r(F=p(oe[q],F),F.next);return F}function c(N,L){return N.x-L.x}function h(N){if(N.next.prev===N)return N;let L=N;for(;;){const F=L.next;if(F.prev===L||F===L||F===N)break;L=F}return L}function p(N,L){var F=f(N,L);if(!F)return L;var G=B(F,N),q=r(F,F.next);let Z=h(G);return r(Z,Z.next),q=h(q),h(L===F?q:L)}function f(N,L){var F,G=L,q=N.x,Z=N.y,X=-1/0;do{if(Z<=G.y&&Z>=G.next.y&&G.next.y!==G.y){var oe=G.x+(Z-G.y)*(G.next.x-G.x)/(G.next.y-G.y);if(oe<=q&&oe>X){if(X=oe,oe===q){if(Z===G.y)return G;if(Z===G.next.y)return G.next}F=G.x<G.next.x?G:G.next}}G=G.next}while(G!==L);if(!F)return null;if(q===X)return F;var pe,ye=F,Se=F.x,He=F.y,Le=1/0;G=F;do q>=G.x&&G.x>=Se&&q!==G.x&&x(Z<He?q:X,Z,Se,He,Z<He?X:q,Z,G.x,G.y)&&(pe=Math.abs(Z-G.y)/(q-G.x),U(G,N)&&(pe<Le||pe===Le&&(G.x>F.x||G.x===F.x&&m(F,G)))&&(F=G,Le=pe)),G=G.next;while(G!==ye);return F}function m(N,L){return E(N.prev,N,L.prev)<0&&E(L.next,N,N.next)<0}function g(N,L,F,G){var q=N;do q.z===null&&(q.z=b(q.x,q.y,L,F,G)),q.prevZ=q.prev,q.nextZ=q.next,q=q.next;while(q!==N);q.prevZ.nextZ=null,q.prevZ=null,_(q)}function _(N){var L,F,G,q,Z,X,oe,pe,ye=1;do{for(F=N,N=null,Z=null,X=0;F;){for(X++,G=F,oe=0,L=0;L<ye&&(oe++,G=G.nextZ);L++);for(pe=ye;oe>0||pe>0&&G;)oe!==0&&(pe===0||!G||F.z<=G.z)?(q=F,F=F.nextZ,oe--):(q=G,G=G.nextZ,pe--),Z?Z.nextZ=q:N=q,q.prevZ=Z,Z=q;F=G}Z.nextZ=null,ye*=2}while(X>1);return N}function b(N,L,F,G,q){return(N=1431655765&((N=858993459&((N=252645135&((N=16711935&((N=32767*(N-F)*q)|N<<8))|N<<4))|N<<2))|N<<1))|(L=1431655765&((L=858993459&((L=252645135&((L=16711935&((L=32767*(L-G)*q)|L<<8))|L<<4))|L<<2))|L<<1))<<1}function w(N){var L=N,F=N;do(L.x<F.x||L.x===F.x&&L.y<F.y)&&(F=L),L=L.next;while(L!==N);return F}function x(N,L,F,G,q,Z,X,oe){return(q-X)*(L-oe)-(N-X)*(Z-oe)>=0&&(N-X)*(G-oe)-(F-X)*(L-oe)>=0&&(F-X)*(Z-oe)-(q-X)*(G-oe)>=0}function T(N,L){return N.next.i!==L.i&&N.prev.i!==L.i&&!D(N,L)&&(U(N,L)&&U(L,N)&&z(N,L)&&(E(N.prev,N,L.prev)||E(N,L.prev,L))||C(N,L)&&E(N.prev,N,N.next)>0&&E(L.prev,L,L.next)>0)}function E(N,L,F){return(L.y-N.y)*(F.x-L.x)-(L.x-N.x)*(F.y-L.y)}function C(N,L){return N.x===L.x&&N.y===L.y}function A(N,L,F,G){var q=M(E(N,L,F)),Z=M(E(N,L,G)),X=M(E(F,G,N)),oe=M(E(F,G,L));return q!==Z&&X!==oe||!(q!==0||!I(N,F,L))||!(Z!==0||!I(N,G,L))||!(X!==0||!I(F,N,G))||!(oe!==0||!I(F,L,G))}function I(N,L,F){return L.x<=Math.max(N.x,F.x)&&L.x>=Math.min(N.x,F.x)&&L.y<=Math.max(N.y,F.y)&&L.y>=Math.min(N.y,F.y)}function M(N){return N>0?1:N<0?-1:0}function D(N,L){var F=N;do{if(F.i!==N.i&&F.next.i!==N.i&&F.i!==L.i&&F.next.i!==L.i&&A(F,F.next,N,L))return!0;F=F.next}while(F!==N);return!1}function U(N,L){return E(N.prev,N,N.next)<0?E(N,L,N.next)>=0&&E(N,N.prev,L)>=0:E(N,L,N.prev)<0||E(N,N.next,L)<0}function z(N,L){var F=N,G=!1,q=(N.x+L.x)/2,Z=(N.y+L.y)/2;do F.y>Z!=F.next.y>Z&&F.next.y!==F.y&&q<(F.next.x-F.x)*(Z-F.y)/(F.next.y-F.y)+F.x&&(G=!G),F=F.next;while(F!==N);return G}function B(N,L){var F=new K(N.i,N.x,N.y),G=new K(L.i,L.x,L.y),q=N.next,Z=L.prev;return N.next=L,L.prev=N,F.next=q,q.prev=F,G.next=F,F.prev=G,Z.next=G,G.prev=Z,G}function ee(N,L,F,G){var q=new K(N,L,F);return G?(q.next=G.next,q.prev=G,G.next.prev=q,G.next=q):(q.prev=q,q.next=q),q}function te(N){N.next.prev=N.prev,N.prev.next=N.next,N.prevZ&&(N.prevZ.nextZ=N.nextZ),N.nextZ&&(N.nextZ.prevZ=N.prevZ)}function K(N,L,F){this.i=N,this.x=L,this.y=F,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function W(N,L,F,G){for(var q=0,Z=L,X=F-G;Z<F;Z+=G)q+=(N[X]-N[Z])*(N[Z+1]+N[X+1]),X=Z;return q}return t.deviation=function(N,L,F,G){var q=L&&L.length,Z=q?L[0]*F:N.length,X=Math.abs(W(N,0,Z,F));if(q)for(var oe=0,pe=L.length;oe<pe;oe++){var ye=L[oe]*F,Se=oe<pe-1?L[oe+1]*F:N.length;X-=Math.abs(W(N,ye,Se,F))}var He=0;for(oe=0;oe<G.length;oe+=3){var Le=G[oe]*F,Te=G[oe+1]*F,Fe=G[oe+2]*F;He+=Math.abs((N[Le]-N[Fe])*(N[Te+1]-N[Le+1])-(N[Le]-N[Te])*(N[Fe+1]-N[Le+1]))}return X===0&&He===0?0:Math.abs((He-X)/X)},t.flatten=function(N){for(var L=N[0][0].length,F={vertices:[],holes:[],dimensions:L},G=0,q=0;q<N.length;q++){for(var Z=0;Z<N[q].length;Z++)for(var X=0;X<L;X++)F.vertices.push(N[q][Z][X]);q>0&&(G+=N[q-1].length,F.holes.push(G))}return F},t},(M_e=O_e())!==void 0&&(R_e.exports=M_e);const T7=re.getLogger("esri.views.3d.support.buffer.math");function KN(t,e,r){if(t.count!==e.count)return void T7.error("source and destination buffers need to have the same number of elements");const i=t.count,n=r[0],s=r[1],o=r[2],a=r[4],l=r[5],c=r[6],h=r[8],p=r[9],f=r[10],m=r[12],g=r[13],_=r[14],b=t.typedBuffer,w=t.typedBufferStride,x=e.typedBuffer,T=e.typedBufferStride;for(let E=0;E<i;E++){const C=E*w,A=E*T,I=x[A],M=x[A+1],D=x[A+2];b[C]=n*I+a*M+h*D+m,b[C+1]=s*I+l*M+p*D+g,b[C+2]=o*I+c*M+f*D+_}}function bw(t,e,r){if(t.count!==e.count)return void T7.error("source and destination buffers need to have the same number of elements");const i=t.count,n=r[0],s=r[1],o=r[2],a=r[3],l=r[4],c=r[5],h=r[6],p=r[7],f=r[8],m=t.typedBuffer,g=t.typedBufferStride,_=e.typedBuffer,b=e.typedBufferStride;for(let w=0;w<i;w++){const x=w*g,T=w*b,E=_[T],C=_[T+1],A=_[T+2];m[x]=n*E+a*C+h*A,m[x+1]=s*E+l*C+p*A,m[x+2]=o*E+c*C+f*A}}function bte(t,e,r){const i=Math.min(t.count,e.count),n=t.typedBuffer,s=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;for(let l=0;l<i;l++){const c=l*s,h=l*a;n[c]=r*o[h],n[c+1]=r*o[h+1],n[c+2]=r*o[h+2]}}function Wle(t,e){const r=Math.min(t.count,e.count),i=t.typedBuffer,n=t.typedBufferStride,s=e.typedBuffer,o=e.typedBufferStride;for(let a=0;a<r;a++){const l=a*n,c=a*o,h=s[c],p=s[c+1],f=s[c+2],m=h*h+p*p+f*f;if(m>0){const g=1/Math.sqrt(m);i[l]=g*h,i[l+1]=g*p,i[l+2]=g*f}}}function vCt(t,e,r){const i=Math.min(t.count,e.count),n=t.typedBuffer,s=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;for(let l=0;l<i;l++){const c=l*s,h=l*a;n[c]=o[h]>>r,n[c+1]=o[h+1]>>r,n[c+2]=o[h+2]>>r}}Object.freeze(Object.defineProperty({__proto__:null,normalize:Wle,scale:bte,shiftRight:vCt,transformMat3:bw,transformMat4:KN},Symbol.toStringTag,{value:"Module"}));function bCt(t,e,r){return{objectId:t,target:e,distance:r,type:"vertex"}}function P_e(t,e,r,i,n,s=!1){return{objectId:t,target:e,distance:r,type:"edge",start:i,end:n,draped:s}}function S7(t,e){if(!t||t.symbol)return null;const r=e&&e.renderer;return t&&v(r)&&r.getObservationRenderer?r.getObservationRenderer(t):r}function wCt(t,e){if(v(t.symbol))return t.symbol;const r=S7(t,e);return v(r)&&r.type!=="dot-density"?r.getSymbol(t,e):null}function UYt(t,e){const r=S7(t,e),i=wCt(t,e);if(R(i))return null;const n={renderer:r,symbol:i};if(R(r)||!("visualVariables"in r)||!r.visualVariables)return n;const s=Zse(r,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of s)switch(a.type){case"color":n.color=l.toRgba();break;case"size":if(a.target==="outline")n.outlineSize=l;else{const c=a.axis,h=a.useSymbolValue?"symbol-value":l;switch(c){case"width":o[0]=h;break;case"depth":o[1]=h;break;case"height":o[2]=h;break;case"width-and-depth":o[0]=o[1]=h;break;default:o[0]=o[1]=o[2]=h}}break;case"opacity":n.opacity=l;break;case"rotation":switch(a.axis){case"tilt":n.tilt=l;break;case"roll":n.roll=l;break;default:n.heading=l}}return o[0]==="proportional"&&o[1]==="proportional"&&o[2]==="proportional"||(n.size=o),n}async function xCt(t,e){if(v(t.symbol))return t.symbol;const r=S7(t,e);return v(r)?r.getSymbolAsync(t,e):null}async function zYt(t,e){const r=S7(t,e),i=await xCt(t,e);if(!i)return null;const n={renderer:r,symbol:i};if(!r||!("visualVariables"in r)||!r.visualVariables)return n;const s=Zse(r,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of s)if(a.type==="color")n.color=Xe.toUnitRGBA(l);else if(a.type==="size")if(a.target==="outline")n.outlineSize=l;else{const c=a.axis,h=a.useSymbolValue?"symbol-value":l;c==="width"?o[0]=h:c==="depth"?o[1]=h:c==="height"?o[2]=h:o[0]=o[1]=c==="width-and-depth"?h:o[2]=h}else a.type==="opacity"?n.opacity=l:a.type==="rotation"&&a.axis==="tilt"?n.tilt=l:a.type==="rotation"&&a.axis==="roll"?n.roll=l:a.type==="rotation"&&(n.heading=l);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(n.size=o),n}function TCt(t,e=0){const r=t[e];return typeof r=="number"&&isFinite(r)?r:null}function SCt(t){for(let e=0;e<3;e++){const r=t[e];if(typeof r=="number")return isFinite(r)?r:0}return 0}function I_e(t){const e=[[O.POSITION,t.indices]],r=[[O.POSITION,new Qe(t.attributeData.position,3,!0)]];return v(t.attributeData.color)&&(r.push([O.COLOR,new Qe(t.attributeData.color,4,!0)]),e.push([O.COLOR,new Array(t.indices.length).fill(0)])),v(t.attributeData.uvMapSpace)&&(r.push([O.UVMAPSPACE,new Qe(t.attributeData.uvMapSpace,4,!0)]),e.push([O.UVMAPSPACE,t.indices])),v(t.attributeData.boundingRect)&&(r.push([O.BOUNDINGRECT,new Qe(t.attributeData.boundingRect,9,!0)]),e.push([O.BOUNDINGRECT,t.indices])),new As(t.material,r,e,t.mapPositions,Wn.Mesh,t.attributeData.objectAndLayerIdColor)}function $_e(t){const e=[[O.POSITION,t.indices],[O.UV0,t.indices]],r=[[O.POSITION,new Qe(t.attributeData.position,3,!0)],[O.UV0,new Qe(t.attributeData.uv0,2,!0)]];return new As(t.material,r,e,t.mapPositions)}function LD(t){switch(t.type){case"extent":if(t instanceof ur)return Jl.fromExtent(t);break;case"polygon":return t}return null}let E7=class{constructor(e,r,i){this.renderData=e,this.layerUid=r,this.graphicUid=i,this.outGeometries=new Array}};function wte(t,e,r){const i=Array.isArray(t),n=i?t.length/e:t.byteLength/(4*e),s=i?t:new Uint32Array(t,0,n*e),o=(r==null?void 0:r.minReduction)??0,a=(r==null?void 0:r.originalIndices)||null,l=a?a.length:0,c=(r==null?void 0:r.componentOffsets)||null;let h=0;if(c)for(let A=0;A<c.length-1;A++){const I=c[A+1]-c[A];I>h&&(h=I)}else h=n;const p=Math.floor(1.1*h)+1;(Im==null||Im.length<2*p)&&(Im=new Uint32Array(fO(2*p)));for(let A=0;A<2*p;A++)Im[A]=0;let f=0;const m=!!c&&!!a,g=m?l:n;let _=ENe(n/3);const b=new Uint32Array(l),w=1.96;let x=o!==0?Math.ceil(4*w*w/(o*o)*o*(1-o)):g,T=1,E=c?c[1]:g;for(let A=0;A<g;A++){if(A===x){const B=1-f/A;if(B+w*Math.sqrt(B*(1-B)/A)<o)return null;x*=2}if(A===E){for(let B=0;B<2*p;B++)Im[B]=0;if(a)for(let B=c[T-1];B<c[T];B++)b[B]=_[a[B]];E=c[++T]}const I=m?a[A]:A,M=I*e,D=ACt(s,M,e);let U=D%p,z=f;for(;Im[2*U+1]!==0;){if(Im[2*U]===D){const B=Im[2*U+1]-1;if(ECt(s,M,B*e,e)){z=_[B];break}}U++,U>=p&&(U-=p)}z===f&&(Im[2*U]=D,Im[2*U+1]=I+1,f++),_[I]=z}if(o!==0&&1-f/n<o)return null;if(m){for(let A=c[T-1];A<b.length;A++)b[A]=_[a[A]];_=NR(b)}const C=i?new Array(f):new Uint32Array(f*e);f=0;for(let A=0;A<g;A++)_[A]===f&&(CCt(s,(m?a[A]:A)*e,C,f*e,e),f++);if(a&&!m){const A=new Uint32Array(l);for(let I=0;I<A.length;I++)A[I]=_[a[I]];_=NR(A)}return{buffer:Array.isArray(C)?C:C.buffer,indices:_,uniqueCount:f}}function ECt(t,e,r,i){for(let n=0;n<i;n++)if(t[e+n]!==t[r+n])return!1;return!0}function CCt(t,e,r,i,n){for(let s=0;s<n;s++)r[i+s]=t[e+s]}function ACt(t,e,r){let i=0;for(let n=0;n<r;n++)i=t[e+n]+i|0,i=i+(i<<11)+(i>>>2)|0;return i>>>0}let Im=null;function BYt(t){const e=QN(t.rings,t.hasZ,py.CCW_IS_HOLE),r=new Array;let i=0,n=0;for(const a of e.polygons){const l=a.count,c=a.index,h=_p(e.position,3*c,3*l),p=a.holeIndices.map(m=>m-c),f=new Uint32Array(vw(h,p,3));r.push({position:h,faces:f}),i+=h.length,n+=f.length}const s=RCt(r,i,n),o=Array.isArray(s.position)?wte(s.position,3,{originalIndices:s.faces}):wte(s.position.buffer,6,{originalIndices:s.faces});return s.position=new Float64Array(o.buffer),s.faces=o.indices,s}function RCt(t,e,r){if(t.length===1)return t[0];const i=Zu(e),n=new Uint32Array(r);let s=0,o=0,a=0;for(const l of t){for(let c=0;c<l.position.length;c++)i[s++]=l.position[c];for(let c=0;c<l.faces.length;c++)n[o++]=l.faces[c]+a;a=s/3}return{position:i,faces:n}}function QN(t,e,r){const i=t.length,n=new Array(i),s=new Array(i),o=new Array(i);let a=0,l=0,c=0,h=0;for(let m=0;m<i;++m)h+=t[m].length;const p=Zu(3*h);let f=0;for(let m=i-1;m>=0;m--){const g=t[m],_=r===py.CCW_IS_HOLE&&OCt(g);if(_&&i!==1)n[a++]=g;else{let b=g.length;for(let x=0;x<a;++x)b+=n[x].length;const w={index:f,pathLengths:new Array(a+1),count:b,holeIndices:new Array(a)};w.pathLengths[0]=g.length,g.length>0&&(o[c++]={index:f,count:g.length}),f=_?A5(g,g.length-1,-1,p,f,g.length,e):A5(g,0,1,p,f,g.length,e);for(let x=0;x<a;++x){const T=n[x];w.holeIndices[x]=f,w.pathLengths[x+1]=T.length,T.length>0&&(o[c++]={index:f,count:T.length}),f=A5(T,0,1,p,f,T.length,e)}a=0,w.count>0&&(s[l++]=w)}}for(let m=0;m<a;++m){const g=n[m];g.length>0&&(o[c++]={index:f,count:g.length}),f=A5(g,0,1,p,f,g.length,e)}return s.length=l,o.length=c,{position:p,polygons:s,outlines:o}}function A5(t,e,r,i,n,s,o){n*=3;for(let a=0;a<s;++a){const l=t[e];i[n++]=l[0],i[n++]=l[1],i[n++]=o?l[2]:0,e+=r}return n/3}function OCt(t){return!rne(t,!1,!1)}var py;(function(t){t[t.NONE=0]="NONE",t[t.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(py||(py={}));var J$,PV,xte;(function(t){t[t.RasterImage=0]="RasterImage",t[t.Features=1]="Features"})(J$||(J$={})),function(t){t[t.MapLayer=0]="MapLayer",t[t.ViewLayer=1]="ViewLayer",t[t.Outline=2]="Outline",t[t.SnappingHint=3]="SnappingHint"}(PV||(PV={})),function(t){t[t.WithRasterImage=0]="WithRasterImage",t[t.WithoutRasterImage=1]="WithoutRasterImage"}(xte||(xte={}));var dn,tp,It,K$,Rn,js,tl;(function(t){t[t.INNER=0]="INNER",t[t.OUTER=1]="OUTER"})(dn||(dn={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",t[t.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",t[t.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(tp||(tp={})),function(t){t[t.NORTH=0]="NORTH",t[t.NORTH_EAST=1]="NORTH_EAST",t[t.EAST=2]="EAST",t[t.SOUTH_EAST=3]="SOUTH_EAST",t[t.SOUTH=4]="SOUTH",t[t.SOUTH_WEST=5]="SOUTH_WEST",t[t.WEST=6]="WEST",t[t.NORTH_WEST=7]="NORTH_WEST"}(It||(It={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(K$||(K$={})),function(t){t[t.Color=0]="Color",t[t.ColorNoRasterImage=1]="ColorNoRasterImage",t[t.Highlight=2]="Highlight",t[t.Water=3]="Water",t[t.Occluded=4]="Occluded",t[t.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"}(Rn||(Rn={})),function(t){t[t.FADING=0]="FADING",t[t.IMMEDIATE=1]="IMMEDIATE",t[t.UNFADED=2]="UNFADED"}(js||(js={})),function(t){t[t.INSIDE=0]="INSIDE",t[t.INTERSECTS=1]="INTERSECTS",t[t.OUTSIDE=2]="OUTSIDE"}(tl||(tl={}));let MCt=class{constructor(e,r){this.vec3=e,this.id=r}};function Q$(t,e,r,i){return new MCt(ke(t,e,r),i)}var Pc;(function(t){t[t.None=0]="None",t[t.ColorAndWater=1]="ColorAndWater",t[t.Highlight=2]="Highlight",t[t.Occluded=3]="Occluded",t[t.ObjectAndLayerIdColor=4]="ObjectAndLayerIdColor"})(Pc||(Pc={}));let L_e=class{get extent(){return this._extent}constructor(e,r){this.index=e,this.renderTargets=r,this._extent=Kt(),this.resolution=0,this.renderLocalOrigin=Q$(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new PCt,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=e,this.validTargets=new Array(r.renderTargets.length).fill(!1)}getValidTexture(e){return this.validTargets[e]?this.renderTargets.getTarget(e).getTexture():null}get _needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(e){const r=e===Pc.ColorAndWater?this.renderTargets.getTarget(Rn.Color):e===Pc.Highlight?this.renderTargets.getTarget(Rn.Highlight):e===Pc.ObjectAndLayerIdColor?this.renderTargets.getTarget(Rn.ObjectAndLayerIdColor):this.renderTargets.getTarget(Rn.Occluded);return r?r.getTexture():null}getColorTextureNoRasterImage(){return this._needsColorWithoutRasterImage?this.getValidTexture(Rn.ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(Rn.Color):null}getNormalTexture(e){const r=e===Pc.ColorAndWater?this.renderTargets.getTarget(Rn.Water):null;return r?r.getTexture():null}draw(e,r){const i=this.computeRenderTargetValidityBitfield();for(const n of this.renderTargets.renderTargets)n.type!==Rn.ColorNoRasterImage||this._needsColorWithoutRasterImage?this.validTargets[n.type]=e.drawTarget(this,n,r):this.validTargets[n.type]=!1;return i^this.computeRenderTargetValidityBitfield()?jO.CHANGED:jO.UNCHANGED}computeRenderTargetValidityBitfield(){const e=this.validTargets;return+e[Rn.Color]|+e[Rn.ColorNoRasterImage]<<1|+e[Rn.Highlight]<<2|+e[Rn.Water]<<3|+e[Rn.Occluded]<<4}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const r=.001*e.range;if(this._extent[0]-r<=e.min){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];tz(this._extent,e.range,0,i)}if(this._extent[2]+r>=e.max){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];tz(this._extent,-e.range,0,i)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,w_(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const r=this.canvasGeometries.extents[e];if(r[0]!==r[2]&&r[1]!==r[3])return!0}return!1}applyViewport(e){e.setViewport(this.index===dn.INNER?0:this.resolution,0,this.resolution,this.resolution)}},PCt=class{constructor(){this.extents=[Kt(),Kt(),Kt()],this.numViews=0}},P5e=class{constructor(e,r){this._size=joe(),this._fbo=null,this._fbo=new Jn(e,{colorTarget:xn.TEXTURE,depthStencilTarget:Ur.NONE},{target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE,samplingMode:it.LINEAR_MIPMAP_LINEAR,hasMipmap:r,maxAnisotropy:8,width:0,height:0})}dispose(){this._fbo=rt(this._fbo)}getTexture(){return this._fbo?this._fbo.colorTexture:null}isValid(){return this._fbo!==null}resize(e,r){this._size[0]=e,this._size[1]=r,this._fbo.resize(this._size[0],this._size[1])}bind(e){e.bindFramebuffer(this._fbo)}generateMipMap(){const e=this._fbo.colorTexture;e.descriptor.hasMipmap&&e.generateMipmap()}disposeRenderTargetMemory(){var e;(e=this._fbo)==null||e.resize(0,0)}get gpuMemoryUsage(){var e;return((e=this._fbo)==null?void 0:e.gpuMemoryUsage)??0}},$E=class{constructor(e,r,i,n=!0){this.output=r,this.type=i,this.valid=!1,this.lastUsed=1/0,this.fbo=new P5e(e,n)}},ICt=class{constructor(e){this.renderTargets=[new $E(e,V.Color,Rn.Color),new $E(e,V.Color,Rn.ColorNoRasterImage),new $E(e,V.Highlight,Rn.Highlight,!1),new $E(e,V.Normal,Rn.Water),new $E(e,V.Color,Rn.Occluded)],ue("enable-feature:objectAndLayerId-rendering")&&this.renderTargets.push(new $E(e,V.ObjectAndLayerIdColor,Rn.ObjectAndLayerIdColor))}getTarget(e){return this.renderTargets[e].fbo}dispose(){for(const e of this.renderTargets)e.fbo.dispose()}disposeRenderTargetMemory(){for(const e of this.renderTargets)e.fbo.disposeRenderTargetMemory()}validateUsageForTarget(e,r,i){if(e)r.lastUsed=i;else if(i-r.lastUsed>$Ct)r.fbo.disposeRenderTargetMemory(),r.lastUsed=1/0;else if(r.lastUsed<1/0)return!0;return!1}get gpuMemoryUsage(){return this.renderTargets.reduce((e,r)=>e+r.fbo.gpuMemoryUsage,0)}};const $Ct=1e3;let I5e=class{constructor(e){this._context=e,this._perConstructorInstances=new D3,this._frameCounter=0,this._keepAliveFrameCount=D_e}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach(e=>e.forEach(r=>r.technique.destroy())),this._perConstructorInstances.clear()}acquire(e,r=DCt){const i=r.key;let n=this._perConstructorInstances.get(e,i);if(R(n)){const s=new e(this._context,r,()=>this.release(s));n=new LCt(s),this._perConstructorInstances.set(e,i,n)}return++n.refCount,n.technique}releaseAndAcquire(e,r,i){if(v(i)){if(r.key===i.key)return i;this.release(i)}return this.acquire(e,r)}release(e){if(R(e)||this._perConstructorInstances.empty)return;const r=this._perConstructorInstances.get(e.constructor,e.key);R(r)||(--r.refCount,r.refCount===0&&(r.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==D_e&&this._perConstructorInstances.forEach((e,r)=>{e.forEach((i,n)=>{i.refCount===0&&i.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(i.technique.destroy(),this._perConstructorInstances.delete(r,n))})})}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach((r,i)=>{const n=async(s,o)=>{const a=o.shader;a&&(await a.reload(),s.forEach(l=>l.technique.reload(this._context)))};e.push(n(r,i))}),await Promise.all(e)}},LCt=class{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}};const D_e=-1,DCt=new _l;let $5e=class{constructor(e,r,i,n){this._textureRepository=e,this._techniqueRepository=r,this.materialChanged=i,this.requestRender=n,this._id2glMaterialRef=new D3}dispose(){this._textureRepository.destroy()}acquire(e,r,i){if(this._ownMaterial(e),!e.requiresSlot(r,i))return null;let n=this._id2glMaterialRef.get(i,e.id);if(R(n)){const s=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:i});n=new NCt(s),this._id2glMaterialRef.set(i,e.id,n)}return n.ref(),n.glMaterial}release(e,r){const i=this._id2glMaterialRef.get(r,e.id);v(i)&&(i.unref(),i.referenced||(rt(i.glMaterial),this._id2glMaterialRef.delete(r,e.id)))}_ownMaterial(e){v(e.repository)&&e.repository!==this&&re.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}},NCt=class{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,wt(this._refCnt>=0)}get referenced(){return this._refCnt>0}};const FCt={orderedRepackingEnabled:!1},kCt={rootOrigin:null},UCt=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","objectGeometryUpdated"];let Tte=class Ste{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(e,r){this._objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new Co,this._objectCount=0,r&&(r.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=r.maximumObjectsPerNode),r.maximumDepth!==void 0&&(this._maximumDepth=r.maximumDepth))}destroy(){this._degenerateObjects.clear(),Co.clearPool(),Ete[0]=null,dx.prune(),RT.prune()}add(e,r=e.length){this._objectCount+=r,this._grow(e,r);const i=Co.acquire();for(let n=0;n<r;n++){const s=e[n];this._isDegenerate(s)?this._degenerateObjects.add(s):(i.init(this._root),this._add(s,i))}Co.release(i)}remove(e,r=null){this._objectCount-=e.length;const i=Co.acquire();for(const n of e){const s=v(r)?r:VO(this._objectToBoundingSphere(n),GCt);FI(s[3])?(i.init(this._root),this._remove(n,s,i)):this._degenerateObjects.delete(n)}Co.release(i),this._shrink()}update(e,r){if(!FI(r[3])&&this._isDegenerate(e))return;const i=jCt(e);this.remove(i,r),this.add(i)}forEachAlongRay(e,r,i){const n=nd(e,r);this._forEachNode(this._root,s=>{if(!this._intersectsNode(n,s))return!1;const o=s.node;return o.terminals.forAll(a=>{this._intersectsObject(n,a)&&i(a)}),o.residents!==null&&o.residents.forAll(a=>{this._intersectsObject(n,a)&&i(a)}),!0})}forEachAlongRayWithVerticalOffset(e,r,i,n){const s=nd(e,r);this._forEachNode(this._root,o=>{if(!this._intersectsNodeWithOffset(s,o,n))return!1;const a=o.node;return a.terminals.forAll(l=>{this._intersectsObjectWithOffset(s,l,n)&&i(l)}),a.residents!==null&&a.residents.forAll(l=>{this._intersectsObjectWithOffset(s,l,n)&&i(l)}),!0})}forEach(e){this._forEachNode(this._root,r=>{const i=r.node;return i.terminals.forAll(e),i.residents!==null&&i.residents.forAll(e),!0}),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,r,i,n=()=>!0,s=1/0){let o=1/0,a=1/0,l=null;const c=Pq(e,r),h=p=>{if(--s,!n(p))return;const f=this._objectToBoundingSphere(p);if(!bb(i,f))return;const m=U1(e,r,f),g=m-f[3],_=m+f[3];g<o&&(o=g,a=_,l=p)};return this._forEachNodeDepthOrdered(this._root,p=>{if(s<=0||!bb(i,p.bounds)||(le(yd,c,p.halfSize),me(yd,yd,p.bounds),U1(e,r,yd)>a))return!1;const f=p.node;return f.terminals.forAll(m=>h(m)),f.residents!==null&&f.residents.forAll(m=>h(m)),!0},e,r),l}forEachInDepthRange(e,r,i,n,s,o,a){let l=-1/0,c=1/0;const h={setRange:_=>{i===Ste.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,_.near),c=Math.min(c,_.far)):(l=Math.max(l,-_.far),c=Math.min(c,-_.near))}};h.setRange(n);const p=U1(r,i,e),f=Pq(r,i),m=Pq(r,-i),g=_=>{if(!a(_))return;const b=this._objectToBoundingSphere(_),w=b,x=U1(r,i,w)-p,T=x-b[3],E=x+b[3];T>c||E<l||!bb(o,b)||s(_,h)};this._forEachNodeDepthOrdered(this._root,_=>{if(!bb(o,_.bounds)||(le(yd,f,_.halfSize),me(yd,yd,_.bounds),U1(r,i,yd)-p>c)||(le(yd,m,_.halfSize),me(yd,yd,_.bounds),U1(r,i,yd)-p<l))return!1;const b=_.node;return b.terminals.forAll(w=>g(w)),b.residents!==null&&b.residents.forAll(w=>g(w)),!0},r,i)}forEachNode(e){this._forEachNode(this._root,r=>e(r.node,r.bounds,r.halfSize))}forEachNeighbor(e,r){const i=i_(r),n=r,s=l=>{const c=this._objectToBoundingSphere(l),h=i_(c),p=i+h;return!(ga(c,n)-p*p<=0)||e(l)};let o=!0;const a=l=>{o&&(o=s(l))};this._forEachNode(this._root,l=>{const c=i_(l.bounds),h=i+c;if(ga(l.bounds,n)-h*h>0)return!1;const p=l.node;return p.terminals.forAll(a),o&&p.residents!==null&&p.residents.forAll(a),o}),o&&this.forEachDegenerateObject(a)}_intersectsNode(e,r){return R5(r.bounds,2*-r.halfSize,Dh),R5(r.bounds,2*r.halfSize,Nh),Lye(e.origin,e.direction,Dh,Nh)}_intersectsNodeWithOffset(e,r,i){return R5(r.bounds,2*-r.halfSize,Dh),R5(r.bounds,2*r.halfSize,Nh),i.applyToMinMax(Dh,Nh),Lye(e.origin,e.direction,Dh,Nh)}_intersectsObject(e,r){const i=this._objectToBoundingSphere(r);return!(i[3]>0)||LQ(i,e)}_intersectsObjectWithOffset(e,r,i){const n=this._objectToBoundingSphere(r);return!(n[3]>0)||LQ(i.applyToBoundingSphere(n),e)}_forEachNode(e,r){let i=Co.acquire().init(e);const n=[i];for(;n.length!==0;){if(i=n.pop(),r(i)&&!i.isLeaf())for(let s=0;s<i.node.children.length;s++)i.node.children[s]&&n.push(Co.acquire().init(i).advance(s));Co.release(i)}}_forEachNodeDepthOrdered(e,r,i,n=Ste.DepthOrder.FRONT_TO_BACK){let s=Co.acquire().init(e);const o=[s];for(BCt(i,n,k_e);o.length!==0;){if(s=o.pop(),r(s)&&!s.isLeaf())for(let a=7;a>=0;--a){const l=k_e[a];s.node.children[l]&&o.push(Co.acquire().init(s).advance(l))}Co.release(s)}}_remove(e,r,i){dx.clear();const n=i.advanceTo(r,(s,o)=>{dx.push(s.node),dx.push(o)})?i.node.terminals:i.node.residents;if(n.removeUnordered(e),n.length===0)for(let s=dx.length-2;s>=0;s-=2){const o=dx.data[s],a=dx.data[s+1];if(!this._purge(o,a))break}}_nodeIsEmpty(e){if(e.terminals.length!==0)return!1;if(e.residents!==null)return e.residents.length===0;for(let r=0;r<e.children.length;r++)if(e.children[r])return!1;return!0}_purge(e,r){return r>=0&&(e.children[r]=null),!!this._nodeIsEmpty(e)&&(e.residents===null&&(e.residents=new Wt({shrink:!0})),!0)}_add(e,r){r.advanceTo(this._objectToBoundingSphere(e))?r.node.terminals.push(e):(r.node.residents.push(e),r.node.residents.length>this._maximumObjectsPerNode&&r.depth<this._maximumDepth&&this._split(r))}_split(e){const r=e.node.residents;e.node.residents=null;for(let i=0;i<r.length;i++){const n=Co.acquire().init(e);this._add(r.getItemAt(i),n),Co.release(n)}}_grow(e,r){if(r!==0&&(N_e(e,r,i=>this._objectToBoundingSphere(i),zy),FI(zy[3])&&!this._fitsInsideTree(zy)))if(this._nodeIsEmpty(this._root.node))VO(zy,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const i=this._rootBoundsForRootAsSubNode(zy);this._placingRootViolatesMaxDepth(i)?this._rebuildTree(zy,i):this._growRootAsSubNode(i),Co.release(i)}}_rebuildTree(e,r){ce($q,r.bounds),$q[3]=r.halfSize,N_e([e,$q],2,n=>n,Lq);const i=Co.acquire().init(this._root);this._root.initFrom(null,Lq,Lq[3]),this._root.increaseHalfSize(1.25),this._forEachNode(i,n=>(this.add(n.node.terminals.data,n.node.terminals.length),n.node.residents!==null&&this.add(n.node.residents.data,n.node.residents.length),!0)),Co.release(i)}_placingRootViolatesMaxDepth(e){const r=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let i=0;return this._forEachNode(this._root,n=>(i=Math.max(i,n.depth),i+r<=this._maximumDepth)),i+r>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const r=e[3],i=e;let n=-1/0;const s=this._root.bounds,o=this._root.halfSize;for(let l=0;l<3;l++){const c=s[l]-o-(i[l]-r),h=i[l]+r-(s[l]+o),p=Math.max(0,Math.ceil(c/(2*o))),f=Math.max(0,Math.ceil(h/(2*o)))+1,m=2**Math.ceil(Math.log(p+f)*Math.LOG2E);n=Math.max(n,m),O5[l].min=p,O5[l].max=f}for(let l=0;l<3;l++){let c=O5[l].min,h=O5[l].max;const p=(n-(c+h))/2;c+=Math.ceil(p),h+=Math.floor(p);const f=s[l]-o-c*o*2;Iq[l]=f+(h+c)*o}const a=n*o;return Iq[3]=a*D5e,Co.acquire().initFrom(null,Iq,a,0)}_growRootAsSubNode(e){const r=this._root.node;ce(zy,this._root.bounds),zy[3]=this._root.halfSize,this._root.init(e),e.advanceTo(zy,null,!0),e.node.children=r.children,e.node.residents=r.residents,e.node.terminals=r.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(e===-1)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let e=null;const r=this._root.node.children;let i=0,n=0;for(;n<r.length&&e==null;)i=n++,e=r[i];for(;n<r.length;)if(r[n++])return-1;return i}_isDegenerate(e){return!FI(this._objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const r=this._root.bounds,i=this._root.halfSize;return e[3]<=i&&e[0]>=r[0]-i&&e[0]<=r[0]+i&&e[1]>=r[1]-i&&e[1]<=r[1]+i&&e[2]>=r[2]-i&&e[2]<=r[2]+i}},Co=class hA{constructor(){this.bounds=Os(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,r,i,n=this.depth){return this.node=v(e)?e:hA.createEmptyNode(),v(r)&&VO(r,this.bounds),this.halfSize=i,this.depth=n,this}increaseHalfSize(e){this.halfSize*=e,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*D5e}advance(e){let r=this.node.children[e];r||(r=hA.createEmptyNode(),this.node.children[e]=r),this.node=r,this.halfSize/=2,this.depth++;const i=L5e[e];return this.bounds[0]+=i[0]*this.halfSize,this.bounds[1]+=i[1]*this.halfSize,this.bounds[2]+=i[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(e,r,i=!1){for(;;){if(this.isTerminalFor(e))return r&&r(this,-1),!0;if(this.isLeaf()){if(!i)return r&&r(this,-1),!1;this.node.residents=null}const n=this._childIndex(e);r&&r(this,n),this.advance(n)}}isLeaf(){return this.node.residents!=null}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const r=this.bounds;return(r[0]<e[0]?1:0)+(r[1]<e[1]?2:0)+(r[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new Wt({shrink:!0}),residents:new Wt({shrink:!0})}}static acquire(){return hA._pool.acquire()}static release(e){hA._pool.release(e)}static clearPool(){hA._pool.prune()}};function zCt(t,e){t[0]=Math.min(t[0],e[0]-e[3]),t[1]=Math.min(t[1],e[1]-e[3]),t[2]=Math.min(t[2],e[2]-e[3])}function VCt(t,e){t[0]=Math.max(t[0],e[0]+e[3]),t[1]=Math.max(t[1],e[1]+e[3]),t[2]=Math.max(t[2],e[2]+e[3])}function R5(t,e,r){r[0]=t[0]+e,r[1]=t[1]+e,r[2]=t[2]+e}function N_e(t,e,r,i){if(e===1){const n=r(t[0]);VO(n,i)}else{Dh[0]=1/0,Dh[1]=1/0,Dh[2]=1/0,Nh[0]=-1/0,Nh[1]=-1/0,Nh[2]=-1/0;for(let n=0;n<e;n++){const s=r(t[n]);FI(s[3])&&(zCt(Dh,s),VCt(Nh,s))}fs(i,Dh,Nh,.5),i[3]=Math.max(Nh[0]-Dh[0],Nh[1]-Dh[1],Nh[2]-Dh[2])/2}}function BCt(t,e,r){if(!RT.length)for(let i=0;i<8;++i)RT.push({index:0,distance:0});for(let i=0;i<8;++i){const n=L5e[i];RT.data[i].index=i,RT.data[i].distance=U1(t,e,n)}RT.sort((i,n)=>i.distance-n.distance);for(let i=0;i<8;++i)r[i]=RT.data[i].index}function Pq(t,e){let r,i=1/0;for(let n=0;n<8;++n){const s=U1(t,e,F_e[n]);s<i&&(i=s,r=F_e[n])}return r}function U1(t,e,r){return e*(t[0]*r[0]+t[1]*r[1]+t[2]*r[2])}function FI(t){return!isNaN(t)&&t!==-1/0&&t!==1/0&&t>0}Co._pool=new ko(Co),function(t){var e;(e=t.DepthOrder||(t.DepthOrder={}))[e.FRONT_TO_BACK=1]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(Tte||(Tte={}));const L5e=[ke(-1,-1,-1),ke(1,-1,-1),ke(-1,1,-1),ke(1,1,-1),ke(-1,-1,1),ke(1,-1,1),ke(-1,1,1),ke(1,1,1)],F_e=[ke(-1,-1,-1),ke(-1,-1,1),ke(-1,1,-1),ke(-1,1,1),ke(1,-1,-1),ke(1,-1,1),ke(1,1,-1),ke(1,1,1)],D5e=Math.sqrt(3),Ete=[null];function jCt(t){return Ete[0]=t,Ete}const Iq=Os(),yd=P(),Dh=P(),Nh=P(),dx=new Wt,GCt=Os(),zy=Os(),$q=Os(),Lq=Os(),O5=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],RT=new Wt,k_e=[0,0,0,0,0,0,0,0],Xf=Tte;var Vb;(function(t){t[t.ASYNC=0]="ASYNC",t[t.SYNC=1]="SYNC"})(Vb||(Vb={}));let N5e=class extends GN{get objects(){return this._objects}constructor(e,r=""){super(),this.apiLayerUid=r,this.type=Wn.Layer,this.events=new Sn,this.sliceable=!1,this._objects=new Wt,this._objectsAdded=new Wt,this._stageHandles=new qr,this.apiLayerUid=r,this.visible=(e==null?void 0:e.visible)??!0,this.pickable=(e==null?void 0:e.pickable)??!0,this.updatePolicy=(e==null?void 0:e.updatePolicy)??Vb.ASYNC,this._disableOctree=(e==null?void 0:e.disableOctree)??!1}destroy(){this.detachStage(),this._stage=null}attachStage(e){this.detachStage(),this._stage=e;for(const r of UCt)this._stageHandles.add(this.events.on(r,i=>e.handleEvent(r,i)))}detachStage(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),v(this._octree)&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),v(this._octree)&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const r of e)r.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),v(this._octree)&&this._objectsAdded.pushArray(e)}removeMany(e){const r=new Array;if(this._objects.removeUnorderedMany(e,e.length,r),r.length!==0){for(const i of r)i.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:r}),v(this._octree)){for(let i=0;i<r.length;)this._objectsAdded.removeUnordered(r[i])?(r[i]=r[r.length-1],r.length-=1):++i;this._octree.remove(r)}}}sync(){v(this._stage)&&this.updatePolicy!==Vb.SYNC&&this._stage.syncLayer(this.id)}notifyObjectBBChanged(e,r){v(this._octree)&&!this._objectsAdded.includes(e)&&this._octree.update(e,r)}getSpatialQueryAccelerator(){return R(this._octree)&&this._objects.length>50&&!this._disableOctree?(this._octree=new Xf(e=>e.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):v(this._octree)&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=ze(this._octree),this._objectsAdded.clear()}};function IV(t){return v(t)&&t.type===Wn.Layer}var vp,T2;(function(t){t[t.Draped=0]="Draped",t[t.Screen=1]="Screen",t[t.World=2]="World",t[t.COUNT=3]="COUNT"})(vp||(vp={})),function(t){t[t.Center=0]="Center",t[t.Tip=1]="Tip",t[t.COUNT=2]="COUNT"}(T2||(T2={}));let Qo=class extends Io{constructor(){super(...arguments),this.output=V.Color,this.transparencyPassType=At.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.space=vp.Screen,this.hideOnShortSegments=!1,this.hasCap=!1,this.anchor=T2.Center,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}};u([j({count:V.COUNT})],Qo.prototype,"output",void 0),u([j({count:At.COUNT})],Qo.prototype,"transparencyPassType",void 0),u([j()],Qo.prototype,"occluder",void 0),u([j()],Qo.prototype,"hasSlicePlane",void 0),u([j()],Qo.prototype,"writeDepth",void 0),u([j({count:vp.COUNT})],Qo.prototype,"space",void 0),u([j()],Qo.prototype,"hideOnShortSegments",void 0),u([j()],Qo.prototype,"hasCap",void 0),u([j({count:T2.COUNT})],Qo.prototype,"anchor",void 0),u([j()],Qo.prototype,"hasTip",void 0),u([j()],Qo.prototype,"vvSize",void 0),u([j()],Qo.prototype,"vvColor",void 0),u([j()],Qo.prototype,"vvOpacity",void 0),u([j()],Qo.prototype,"hasOccludees",void 0),u([j()],Qo.prototype,"hasMultipassTerrain",void 0),u([j()],Qo.prototype,"cullAboveGround",void 0),u([j({constValue:!0})],Qo.prototype,"hasVvInstancing",void 0),u([j({constValue:!0})],Qo.prototype,"hasSliceTranslatedView",void 0);const U_e=8;function F5e(t,e){const r=t.vertex;r.uniforms.add(new Ie("intrinsicWidth",i=>i.width)),e.vvSize?(t.attributes.add(O.SIZEFEATUREATTRIBUTE,"float"),r.uniforms.add(new Jt("vvSizeMinSize",i=>i.vvSizeMinSize)),r.uniforms.add(new Jt("vvSizeMaxSize",i=>i.vvSizeMaxSize)),r.uniforms.add(new Jt("vvSizeOffset",i=>i.vvSizeOffset)),r.uniforms.add(new Jt("vvSizeFactor",i=>i.vvSizeFactor)),r.code.add(S`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(t.attributes.add(O.SIZE,"float"),r.code.add(S`float getSize(){
return intrinsicWidth * size;
}`)),e.vvOpacity?(t.attributes.add(O.OPACITYFEATUREATTRIBUTE,"float"),r.constants.add("vvOpacityNumber","int",8),r.uniforms.add([new ol("vvOpacityValues",i=>i.vvOpacityValues,U_e),new ol("vvOpacityOpacities",i=>i.vvOpacityOpacities,U_e)]),r.code.add(S`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):r.code.add(S`vec4 applyOpacity( vec4 color ){
return color;
}`),e.vvColor?(t.attributes.add(O.COLORFEATUREATTRIBUTE,"float"),r.constants.add("vvColorNumber","int",nm),r.uniforms.add(new ol("vvColorValues",i=>i.vvColorValues,nm)),r.uniforms.add(new y7("vvColorColors",i=>i.vvColorColors,nm)),r.code.add(S`vec4 interpolateColor( float value ) {
if (value <= vvColorValues[0]) {
return vvColorColors[0];
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return mix(vvColorColors[i-1], vvColorColors[i], f);
}
}
return vvColorColors[vvColorNumber - 1];
}
vec4 getColor(){
return applyOpacity(interpolateColor(colorFeatureAttribute));
}`)):(t.attributes.add(O.COLOR,"vec4"),r.code.add(S`vec4 getColor(){
return applyOpacity(color);
}`))}function M_(t,e){switch(t.fragment.include(Qu),e.output){case V.Shadow:case V.ShadowHighlight:case V.ShadowExcludeHighlight:t.extensions.add("GL_OES_standard_derivatives"),t.fragment.code.add(S`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`);break;case V.Depth:t.fragment.code.add(S`void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_linearDepth);
}`)}}let k5e=class{constructor(e){this._rctx=e,this._cache=new Map}destroy(){this._cache.forEach(e=>rt(e.stippleTexture)),this._cache.clear()}_acquire(e){if(R(e))return null;const r=this._patternId(e),i=this._cache.get(r);if(i)return i.refCount++,i;const{encodedData:n,paddedPixels:s}=qCt(e),o=new HCt(new mt(this._rctx,{width:s,height:1,internalFormat:Ge.RGBA,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE},n));return this._cache.set(r,o),o}release(e){if(R(e))return;const r=this._patternId(e),i=this._cache.get(r);i&&(i.refCount--,i.refCount===0&&(v(i.stippleTexture)&&i.stippleTexture.dispose(),this._cache.delete(r)))}swap(e,r){const i=this._acquire(r);return this.release(e),i}_patternId(e){return`${e.pattern.join(",")}-r${e.pixelRatio}`}},HCt=class extends wi{constructor(e){super(),this.stippleTexture=e,this.refCount=1}};function qCt(t){const e=Xle(t),r=1/t.pixelRatio,i=U5e(t),n=z5e(t),s=(Math.floor(.5*(n-1))+.5)*r,o=[];let a=1;for(const m of e){for(let g=0;g<m;g++){const _=a*(Math.min(g,m-1-g)+.5)*r/s*.5+.5;o.push(_)}a=-a}const l=Math.round(e[0]/2),c=[...o.slice(l),...o.slice(0,l)],h=i+V5e,p=new Uint8Array(4*h);let f=4;for(const m of c)AD(m,p,f),f+=4;return p.copyWithin(0,f-4,f),p.copyWithin(f,4,8),{encodedData:p,paddedPixels:h}}function Xle(t){return t.pattern.map(e=>Math.round(e*t.pixelRatio))}function U5e(t){if(R(t))return 1;const e=Xle(t);return Math.floor(e.reduce((r,i)=>r+i))}function z5e(t){return Xle(t).reduce((e,r)=>Math.max(e,r))}const V5e=2;function WCt(t){return R(t)?Wg:t.length===4?t:ai(XCt,t[0],t[1],t[2],1)}const XCt=pr();function B5e(t,e){t.constants.add("stippleAlphaColorDiscard","float",.001),t.constants.add("stippleAlphaHighlightDiscard","float",.5),e.stippleEnabled?YCt(t,e):ZCt(t)}function YCt(t,e){const r=!(e.draped&&e.stipplePreferContinuous),{vertex:i,fragment:n}=t;n.include(Qu),e.draped||(mm(i,e),i.uniforms.add(new Ie("worldToScreenPerDistanceRatio",(o,a)=>1/a.camera.perScreenPixelRatio)),i.code.add(S`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),t.varyings.add("vStippleDistance","float"),e.stippleRequiresClamp&&t.varyings.add("vStippleDistanceLimits","vec2"),e.stippleRequiresStretchMeasure&&t.varyings.add("vStipplePatternStretch","float"),i.code.add(S`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${KCt};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),i.code.add(S`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),i.code.add(S`
    if (segmentLengthPseudoScreen >= ${r?"patternLength":"1e4"}) {
  `),i.uniforms.add(new Ie("pixelRatio",(o,a)=>a.camera.pixelRatio)),i.code.add(S`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${e.stippleRequiresStretchMeasure?S`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `),n.constants.add("stippleTexturePadding","float",V5e);const s=e.hasWebGL2Context?oi.None:oi.Size;n.uniforms.add(rm("stipplePatternTexture",o=>o.stippleTexture,s)),n.uniforms.add([new Ie("stipplePatternSDFNormalizer",o=>JCt(o.stipplePattern)),new Ie("stipplePatternPixelSizeInv",o=>1/Yle(o))]),n.code.add(S`
    float padStippleTexture(float u) {
      float paddedTextureSize = ${yp(e,"stipplePatternTexture")}.x;
      float unpaddedTextureSize = paddedTextureSize - stippleTexturePadding;

      return (u * unpaddedTextureSize + stippleTexturePadding * 0.5) / paddedTextureSize;
    }
  `),n.code.add(S`
    float getStippleSDF(out bool isClamped) {
      ${e.stippleRequiresClamp?S`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:S`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${e.stippleScaleWithLineWidth?S`u *= vLineSizeInv;`:""}
      u = padStippleTexture(fract(u));

      float encodedSDF = rgba2float(texture2D(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${e.stippleRequiresStretchMeasure?S`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:S`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${e.stippleScaleWithLineWidth?S`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:S`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `),e.stippleOffColorEnabled?(n.uniforms.add(new br("stippleOffColor",o=>WCt(o.stippleOffColor))),n.code.add(S`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):n.code.add(S`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function ZCt(t){t.fragment.code.add(S`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}function JCt(t){return v(t)?(Math.floor(.5*(z5e(t)-1))+.5)/t.pixelRatio:1}function Yle(t){const e=t.stipplePattern;return v(e)?U5e(t.stipplePattern)/e.pixelRatio:1}const KCt=S.float(.4),DD=64,Zle=DD/2,j5e=Zle/5,QCt=DD/j5e,eAt=.25;function tAt(t,e){return t.fromData(`${e}-marker`,()=>R4e(e,DD,Zle,j5e))}function G5e(t,e){const r=t.vertex;t.constants.add("markerSizePerLineWidth","float",QCt),r.uniforms.add(new Ie("pixelRatio",(i,n)=>n.camera.pixelRatio)),R(r.uniforms.get("markerScale"))&&r.constants.add("markerScale","float",1),r.code.add(S`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`),e.space===vp.World&&(r.constants.add("maxSegmentLengthFraction","float",.45),r.uniforms.add(new Ie("perRenderPixelRatio",(i,n)=>n.camera.perRenderPixelRatio)),r.code.add(S`float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}
bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}`))}var bp;(function(t){t[t.BUTT=0]="BUTT",t[t.SQUARE=1]="SQUARE",t[t.ROUND=2]="ROUND",t[t.COUNT=3]="COUNT"})(bp||(bp={}));let un=class extends Io{constructor(){super(...arguments),this.output=V.Color,this.capType=bp.BUTT,this.transparencyPassType=At.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.wireframe=!1,this.objectAndLayerIdColorInstanced=!1}};u([j({count:V.COUNT})],un.prototype,"output",void 0),u([j({count:bp.COUNT})],un.prototype,"capType",void 0),u([j({count:At.COUNT})],un.prototype,"transparencyPassType",void 0),u([j()],un.prototype,"occluder",void 0),u([j()],un.prototype,"hasSlicePlane",void 0),u([j()],un.prototype,"hasPolygonOffset",void 0),u([j()],un.prototype,"writeDepth",void 0),u([j()],un.prototype,"draped",void 0),u([j()],un.prototype,"stippleEnabled",void 0),u([j()],un.prototype,"stippleOffColorEnabled",void 0),u([j()],un.prototype,"stippleScaleWithLineWidth",void 0),u([j()],un.prototype,"stipplePreferContinuous",void 0),u([j()],un.prototype,"roundJoins",void 0),u([j()],un.prototype,"applyMarkerOffset",void 0),u([j()],un.prototype,"vvSize",void 0),u([j()],un.prototype,"vvColor",void 0),u([j()],un.prototype,"vvOpacity",void 0),u([j()],un.prototype,"falloffEnabled",void 0),u([j()],un.prototype,"innerColorEnabled",void 0),u([j()],un.prototype,"hasOccludees",void 0),u([j()],un.prototype,"hasMultipassTerrain",void 0),u([j()],un.prototype,"cullAboveGround",void 0),u([j()],un.prototype,"wireframe",void 0),u([j({constValue:!0})],un.prototype,"stippleRequiresClamp",void 0),u([j({constValue:!0})],un.prototype,"stippleRequiresStretchMeasure",void 0),u([j({constValue:!0})],un.prototype,"hasVvInstancing",void 0),u([j({constValue:!0})],un.prototype,"hasSliceTranslatedView",void 0),u([j()],un.prototype,"objectAndLayerIdColorInstanced",void 0);const $V=1;function rAt(t){const e=new Br,{vertex:r,fragment:i}=e,n=t.hasMultipassTerrain&&(t.output===V.Color||t.output===V.Alpha);e.include(VN),e.include(F5e,t),e.include(B5e,t);const s=t.applyMarkerOffset&&!t.draped;s&&(r.uniforms.add(new Ie("markerScale",m=>m.markerScale)),e.include(G5e,{space:vp.World})),t.output===V.Depth&&e.include(M_,t),e.include(g7,t),Gu(r,t),r.uniforms.add([new rn("inverseProjectionMatrix",(m,g)=>g.camera.inverseProjectionMatrix),new Hr("nearFar",(m,g)=>g.camera.nearFar),new Ie("miterLimit",m=>m.join!=="miter"?0:m.miterLimit),new br("viewport",(m,g)=>g.camera.fullViewport)]),r.constants.add("LARGE_HALF_FLOAT","float",65500),e.attributes.add(O.POSITION,"vec3"),e.attributes.add(O.SUBDIVISIONFACTOR,"float"),e.attributes.add(O.UV0,"vec2"),e.attributes.add(O.AUXPOS1,"vec3"),e.attributes.add(O.AUXPOS2,"vec3"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),pw(e),n&&e.varyings.add("depth","float");const o=t.capType===bp.ROUND,a=t.stippleEnabled&&t.stippleScaleWithLineWidth||o;a&&e.varyings.add("vLineWidth","float");const l=t.stippleEnabled&&t.stippleScaleWithLineWidth;l&&e.varyings.add("vLineSizeInv","float");const c=t.innerColorEnabled||o;c&&e.varyings.add("vLineDistance","float");const h=t.stippleEnabled&&o,p=t.falloffEnabled||h;p&&e.varyings.add("vLineDistanceNorm","float"),o&&(e.varyings.add("vSegmentSDF","float"),e.varyings.add("vReverseSegmentSDF","float")),r.code.add(S`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),r.code.add(S`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),YB(e),r.code.add(S`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${n?"depth = pos.z;":""}
      linearDepth = calculateLinearDepth(nearFar,pos.z);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),r.uniforms.add(new Ie("pixelRatio",(m,g)=>g.camera.pixelRatio)),r.code.add(S`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${a?S`vLineWidth = lineWidth;`:""}
      ${l?S`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);
  `),s&&r.code.add(S`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`),r.code.add(S`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),(t.stippleEnabled||o)&&r.code.add(S`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${o?S`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),r.code.add(S`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),t.roundJoins?r.code.add(S`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${t.stippleEnabled?S`min(1.0, subdivisionFactor * ${S.float(($V+2)/($V+1))})`:S`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):r.code.add(S`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const f=t.capType!==bp.BUTT;return r.code.add(S`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${f?S`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),r.code.add(S`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${p||c?S`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${c?S`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${p?S`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),o&&r.code.add(S`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),t.stippleEnabled&&(t.draped?r.uniforms.add(new Ie("worldToScreenRatio",(m,g)=>1/g.screenToPCSRatio)):r.code.add(S`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),r.code.add(S`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),t.draped?r.code.add(S`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):r.code.add(S`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),r.uniforms.add(new Ie("stipplePatternPixelSize",m=>Yle(m))),r.code.add(S`
      float patternLength = ${t.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `)),r.code.add(S`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${t.wireframe&&!t.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `),n&&e.include(od,t),e.include(hs,t),i.include(by),i.code.add(S`
  void main() {
    discardBySlice(vpos);
    ${n?"terrainDepthTest(gl_FragCoord, depth);":""}
  `),t.wireframe?i.code.add(S`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(o&&i.code.add(S`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${S.float(Fa)}) {
        discard;
      }
    `),h?i.code.add(S`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${S.float(Fa)}, stippleCoverage);
      `):i.code.add(S`float stippleAlpha = getStippleAlpha();`),i.uniforms.add(new br("intrinsicColor",m=>m.color)),t.output!==V.ObjectAndLayerIdColor&&i.code.add(S`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);`),i.code.add(S`vec4 color = intrinsicColor * vColor;`),t.innerColorEnabled&&(i.uniforms.add(new br("innerColor",m=>Nt(m.innerColor,m.color))),i.uniforms.add(new Ie("innerWidth",(m,g)=>m.innerWidth*g.camera.pixelRatio)),i.code.add(S`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),i.code.add(S`vec4 finalColor = blendStipple(color, stippleAlpha);`),t.falloffEnabled&&(i.uniforms.add(new Ie("falloff",m=>m.falloff)),i.code.add(S`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`))),i.code.add(S`
    ${t.output===V.ObjectAndLayerIdColor?S`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${S.float(Fa)}) {
      discard;
    }

    ${t.output===V.Alpha?S`gl_FragColor = vec4(finalColor.a);`:""}
    ${t.output===V.Color?S`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===V.Color&&t.transparencyPassType===At.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${t.output===V.Highlight?S`gl_FragColor = vec4(1.0);`:""}
    ${t.output===V.Depth?S`outputDepth(linearDepth);`:""}
    ${t.output===V.ObjectAndLayerIdColor?S`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const iAt=Object.freeze(Object.defineProperty({__proto__:null,RIBBONLINE_NUM_ROUND_JOIN_SUBDIVISIONS:$V,build:rAt},Symbol.toStringTag,{value:"Module"})),Jle={func:zi.LESS},LV={func:zi.ALWAYS},fy={mask:255},H5e={mask:0},nAt=t=>({function:{func:zi.NOTEQUAL,ref:t,mask:t},operation:{fail:Zn.KEEP,zFail:Zn.KEEP,zPass:Zn.KEEP}}),sAt=t=>({function:{func:zi.ALWAYS,ref:t,mask:t},operation:{fail:Zn.KEEP,zFail:Zn.KEEP,zPass:Zn.REPLACE}}),Uw={function:{func:zi.ALWAYS,ref:jc.OutlineVisualElementMask,mask:jc.OutlineVisualElementMask},operation:{fail:Zn.KEEP,zFail:Zn.KEEP,zPass:Zn.ZERO}},ww={function:{func:zi.ALWAYS,ref:jc.OutlineVisualElementMask,mask:jc.OutlineVisualElementMask},operation:{fail:Zn.KEEP,zFail:Zn.KEEP,zPass:Zn.REPLACE}},q5e={function:{func:zi.EQUAL,ref:jc.OutlineVisualElementMask,mask:jc.OutlineVisualElementMask},operation:{fail:Zn.KEEP,zFail:Zn.KEEP,zPass:Zn.KEEP}},W5e={function:{func:zi.NOTEQUAL,ref:jc.OutlineVisualElementMask,mask:jc.OutlineVisualElementMask},operation:{fail:Zn.KEEP,zFail:Zn.KEEP,zPass:Zn.KEEP}},X5e=new Map([[O.POSITION,0],[O.SUBDIVISIONFACTOR,1],[O.UV0,2],[O.AUXPOS1,3],[O.AUXPOS2,4],[O.COLOR,5],[O.COLORFEATUREATTRIBUTE,5],[O.SIZE,6],[O.SIZEFEATUREATTRIBUTE,6],[O.OPACITYFEATUREATTRIBUTE,7],[O.OBJECTANDLAYERIDCOLOR,8]]);let Y5e=class Z5e extends Wr{initializeProgram(e){return new Gr(e.rctx,Z5e.shader.get().build(this.configuration),X5e)}_makePipelineState(e,r){const i=this.configuration,n=e===At.NONE,s=e===At.FrontFace;return Ht({blending:i.output===V.Color||i.output===V.Alpha?n?Qh:X_(e):null,depthTest:{func:kw(e)},depthWrite:n?i.writeDepth?Xc:null:_7(e),colorWrite:ir,stencilWrite:i.hasOccludees?fy:null,stencilTest:i.hasOccludees?r?ww:Uw:null,polygonOffset:n||s?i.hasPolygonOffset?z_e:null:b7})}initializePipeline(){const e=this.configuration;if(e.occluder){const r=e.hasPolygonOffset?z_e:null;this._occluderPipelineTransparent=Ht({blending:Qh,polygonOffset:r,depthTest:LV,depthWrite:null,colorWrite:ir,stencilWrite:null,stencilTest:W5e}),this._occluderPipelineOpaque=Ht({blending:Qh,polygonOffset:r,depthTest:LV,depthWrite:null,colorWrite:ir,stencilWrite:H5e,stencilTest:q5e}),this._occluderPipelineMaskWrite=Ht({blending:null,polygonOffset:r,depthTest:Jle,depthWrite:null,colorWrite:null,stencilWrite:fy,stencilTest:ww})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?Ft.LINES:Ft.TRIANGLE_STRIP}getPipelineState(e,r){return r?this._occludeePipelineState:this.configuration.occluder?e===Ee.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===Ee.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,r)}};Y5e.shader=new jr(iAt,()=>Q(()=>import("./RibbonLine.glsl-5eed889a.js"),[]));const z_e={factor:0,units:-4};var wu;(function(t){t[t.LEFT_JOIN_START=-2]="LEFT_JOIN_START",t[t.LEFT_JOIN_END=-1]="LEFT_JOIN_END",t[t.LEFT_CAP_START=-4]="LEFT_CAP_START",t[t.LEFT_CAP_END=-5]="LEFT_CAP_END",t[t.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",t[t.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",t[t.RIGHT_CAP_START=4]="RIGHT_CAP_START",t[t.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(wu||(wu={}));let lR=class extends Fw{constructor(e){super(e,new aAt),this._configuration=new un,this._vertexAttributeLocations=X5e,this._layout=this.createLayout()}isClosed(e,r){return K5e(this.parameters,e,r)}getConfiguration(e,r){this._configuration.output=e,this._configuration.draped=r.slot===Ee.DRAPED_MATERIAL;const i=v(this.parameters.stipplePattern)&&e!==V.Highlight;return this._configuration.stippleEnabled=i,this._configuration.stippleOffColorEnabled=i&&v(this.parameters.stippleOffColor),this._configuration.stippleScaleWithLineWidth=i&&this.parameters.stippleScaleWithLineWidth,this._configuration.stipplePreferContinuous=i&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins=this.parameters.join==="round",this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=!!v(this.parameters.markerParameters)&&cAt(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&v(this.parameters.innerColor),this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===vn.OccludeAndTransparentStencil,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersectDraped(e,r,i,n,s,o){if(!i.options.selectionMode)return;const a=e.vertexAttributes.get(O.POSITION).data,l=e.vertexAttributes.get(O.SIZE);let c=this.parameters.width;if(this.parameters.vvSizeEnabled){const _=e.vertexAttributes.get(O.SIZEFEATUREATTRIBUTE).data[0];c*=_e(this.parameters.vvSizeOffset[0]+_*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else l&&(c*=l.data[0]);const h=n[0],p=n[1],f=(c/2+4)*e.screenToWorldRatio;let m=Number.MAX_VALUE,g=0;for(let _=0;_<a.length-5;_+=3){const b=a[_],w=a[_+1],x=h-b,T=p-w,E=a[_+3]-b,C=a[_+4]-w,A=_e((E*x+C*T)/(E*E+C*C),0,1),I=E*A-x,M=C*A-T,D=I*I+M*M;D<m&&(m=D,g=_/3)}m<f*f&&s(o.dist,o.normal,g,!1)}intersect(e,r,i,n,s,o){if(!i.options.selectionMode||!e.visible)return;if(!xNe(r))return void re.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const a=e.vertexAttributes,l=a.get(O.POSITION).data;let c=this.parameters.width;if(this.parameters.vvSizeEnabled){const x=a.get(O.SIZEFEATUREATTRIBUTE).data[0];c*=_e(this.parameters.vvSizeOffset[0]+x*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else a.has(O.SIZE)&&(c*=a.get(O.SIZE).data[0]);const h=i.camera,p=uAt;Qs(p,i.point);const f=c*h.pixelRatio/2+4*h.pixelRatio;he(jM[0],p[0]-f,p[1]+f,0),he(jM[1],p[0]+f,p[1]+f,0),he(jM[2],p[0]+f,p[1]-f,0),he(jM[3],p[0]-f,p[1]-f,0);for(let x=0;x<4;x++)if(!h.unprojectFromRenderScreen(jM[x],Vy[x]))return;rl(h.eye,Vy[0],Vy[1],Nq),rl(h.eye,Vy[1],Vy[2],Fq),rl(h.eye,Vy[2],Vy[3],kq),rl(h.eye,Vy[3],Vy[0],Uq);let m=Number.MAX_VALUE,g=0;const _=J5e(this.parameters,a,e.indices)?l.length-2:l.length-5;for(let x=0;x<_;x+=3){uc[0]=l[x]+r[12],uc[1]=l[x+1]+r[13],uc[2]=l[x+2]+r[14];const T=(x+3)%l.length;if(hc[0]=l[T]+r[12],hc[1]=l[T+1]+r[13],hc[2]=l[T+2]+r[14],Ri(Nq,uc)<0&&Ri(Nq,hc)<0||Ri(Fq,uc)<0&&Ri(Fq,hc)<0||Ri(kq,uc)<0&&Ri(kq,hc)<0||Ri(Uq,uc)<0&&Ri(Uq,hc)<0)continue;if(h.projectToRenderScreen(uc,fx),h.projectToRenderScreen(hc,mx),fx[2]<0&&mx[2]>0){ge($m,uc,hc);const C=h.frustum,A=-Ri(C[Ai.NEAR],uc)/ve($m,C[Ai.NEAR]);le($m,$m,A),me(uc,uc,$m),h.projectToRenderScreen(uc,fx)}else if(fx[2]>0&&mx[2]<0){ge($m,hc,uc);const C=h.frustum,A=-Ri(C[Ai.NEAR],hc)/ve($m,C[Ai.NEAR]);le($m,$m,A),me(hc,hc,$m),h.projectToRenderScreen(hc,mx)}else if(fx[2]<0&&mx[2]<0)continue;fx[2]=0,mx[2]=0;const E=uae(DS(fx,mx,j_e),p);E<m&&(m=E,ce(V_e,uc),ce(B_e,hc),g=x/3)}const b=i.rayBegin,w=i.rayEnd;if(m<f*f){let x=Number.MAX_VALUE;if(vLe(DS(V_e,B_e,j_e),DS(b,w,hAt),px)){ge(px,px,b);const T=Pe(px);le(px,px,1/T),x=T/Pi(b,w)}o(x,px,g,!1)}}createLayout(){const e=mn().vec3f(O.POSITION).f32(O.SUBDIVISIONFACTOR).vec2f(O.UV0).vec3f(O.AUXPOS1).vec3f(O.AUXPOS2);return this.parameters.vvSizeEnabled?e.f32(O.SIZEFEATUREATTRIBUTE):e.f32(O.SIZE),this.parameters.vvColorEnabled?e.f32(O.COLORFEATUREATTRIBUTE):e.vec4f(O.COLOR),this.parameters.vvOpacityEnabled&&e.f32(O.OPACITYFEATUREATTRIBUTE),ue("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(O.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new lAt(this._layout,this.parameters)}requiresSlot(e,r){return r===V.Color||r===V.Alpha||r===V.Highlight||r===V.Depth||r===V.ObjectAndLayerIdColor?e===Ee.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===vn.OccludeAndTransparentStencil?e===Ee.OPAQUE_MATERIAL||e===Ee.OCCLUDER_MATERIAL||e===Ee.TRANSPARENT_OCCLUDER_MATERIAL:r===V.Color||r===V.Alpha?e===(this.parameters.writeDepth?Ee.TRANSPARENT_MATERIAL:Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===Ee.OPAQUE_MATERIAL:!1}createGLMaterial(e){return new oAt(e)}validateParameters(e){e.join!=="miter"&&(e.miterLimit=0),v(e.markerParameters)&&(e.markerScale=e.markerParameters.width/e.width)}},oAt=class extends Nw{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==V.Color&&this._output!==V.Alpha||this._updateOccludeeState(e);const r=this._material.parameters.stipplePattern;return this._stipplePattern!==r&&(this._material.setParameters(this._stippleTextureRepository.swap(this._stipplePattern,r)),this._stipplePattern=r),this.ensureTechnique(Y5e,e)}},aAt=class extends Nle{constructor(){super(...arguments),this.width=0,this.color=op,this.join="miter",this.cap=bp.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}},lAt=class{constructor(e,r){this._parameters=r,this.numJoinSubdivisions=0,this.vertexBufferLayout=e;const i=r.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=i;break;case"round":this.numJoinSubdivisions=$V+i}}_isClosed(e){return J5e(this._parameters,e.vertexAttributes,e.indices)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const i=e.indices.get(O.POSITION).length/2+1,n=this._isClosed(e);let s=n?2:2*2;return s+=((n?i:i-1)-(n?0:1))*(2*this.numJoinSubdivisions+4),s+=2,this._parameters.wireframe&&(s=2+4*(s-2)),s}write(e,r,i,n,s){var K;const o=dAt,a=pAt,l=fAt,c=i.vertexAttributes.get(O.POSITION).data,h=i.indices&&i.indices.get(O.POSITION),p=(K=i.vertexAttributes.get(O.DISTANCETOSTART))==null?void 0:K.data;h&&h.length!==2*(c.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let f=1,m=0;this._parameters.vvSizeEnabled?m=i.vertexAttributes.get(O.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(O.SIZE)&&(f=i.vertexAttributes.get(O.SIZE).data[0]);let g=[1,1,1,1],_=0;this._parameters.vvColorEnabled?_=i.vertexAttributes.get(O.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(O.COLOR)&&(g=i.vertexAttributes.get(O.COLOR).data);const b=ue("enable-feature:objectAndLayerId-rendering")?i.objectAndLayerIdColor:null;let w=0;this._parameters.vvOpacityEnabled&&(w=i.vertexAttributes.get(O.OPACITYFEATUREATTRIBUTE).data[0]);const x=c.length/3,T=new Float32Array(n.buffer),E=ue("enable-feature:objectAndLayerId-rendering")?new Uint8Array(n.buffer):null,C=this.vertexBufferLayout.stride/4;let A=s*C;const I=A;let M=0;const D=p?(W,N,L)=>M=p[L]:(W,N,L)=>M+=Pi(W,N),U=ue("enable-feature:objectAndLayerId-rendering"),z=(W,N,L,F,G,q,Z)=>{if(T[A++]=N[0],T[A++]=N[1],T[A++]=N[2],T[A++]=F,T[A++]=Z,T[A++]=G,T[A++]=W[0],T[A++]=W[1],T[A++]=W[2],T[A++]=L[0],T[A++]=L[1],T[A++]=L[2],this._parameters.vvSizeEnabled?T[A++]=m:T[A++]=f,this._parameters.vvColorEnabled)T[A++]=_;else{const X=Math.min(4*q,g.length-4);T[A++]=g[X],T[A++]=g[X+1],T[A++]=g[X+2],T[A++]=g[X+3]}this._parameters.vvOpacityEnabled&&(T[A++]=w),U&&(v(b)&&(E[4*A]=b[0],E[4*A+1]=b[1],E[4*A+2]=b[2],E[4*A+3]=b[3]),A++)};A+=C,he(a,c[0],c[1],c[2]),e&&Ke(a,a,e);const B=this._isClosed(i);if(B){const W=c.length-3;he(o,c[W],c[W+1],c[W+2]),e&&Ke(o,o,e)}else he(l,c[3],c[4],c[5]),e&&Ke(l,l,e),z(a,a,l,1,wu.LEFT_CAP_START,0,0),z(a,a,l,1,wu.RIGHT_CAP_START,0,0),ce(o,a),ce(a,l);const ee=B?0:1,te=B?x:x-1;for(let W=ee;W<te;W++){const N=(W+1)%x*3;he(l,c[N],c[N+1],c[N+2]),e&&Ke(l,l,e),D(o,a,W),z(o,a,l,0,wu.LEFT_JOIN_END,W,M),z(o,a,l,0,wu.RIGHT_JOIN_END,W,M);const L=this.numJoinSubdivisions;for(let F=0;F<L;++F){const G=(F+1)/(L+1);z(o,a,l,G,wu.LEFT_JOIN_END,W,M),z(o,a,l,G,wu.RIGHT_JOIN_END,W,M)}z(o,a,l,1,wu.LEFT_JOIN_START,W,M),z(o,a,l,1,wu.RIGHT_JOIN_START,W,M),ce(o,a),ce(a,l)}B?(he(l,c[3],c[4],c[5]),e&&Ke(l,l,e),M=D(o,a,te),z(o,a,l,0,wu.LEFT_JOIN_END,ee,M),z(o,a,l,0,wu.RIGHT_JOIN_END,ee,M)):(M=D(o,a,te),z(o,a,a,0,wu.LEFT_CAP_END,te,M),z(o,a,a,0,wu.RIGHT_CAP_END,te,M)),Dq(T,I+C,T,I,C),A=Dq(T,A-C,T,A,C),this._parameters.wireframe&&this._addWireframeVertices(n,I,A,C)}_addWireframeVertices(e,r,i,n){const s=new Float32Array(e.buffer,i*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(e.buffer,r*Float32Array.BYTES_PER_ELEMENT,i-r);let a=0;const l=c=>a=Dq(o,c,s,a,n);for(let c=0;c<o.length-1;c+=2*n)l(c),l(c+2*n),l(c+1*n),l(c+2*n),l(c+1*n),l(c+3*n)}};function Dq(t,e,r,i,n){for(let s=0;s<n;s++)r[i++]=t[e++];return i}function J5e(t,e,r){return K5e(t,e.get(O.POSITION).data,r?r.get(O.POSITION):null)}function K5e(t,e,r){return!!t.isClosed&&(r?r.length>2:e.length>6)}function cAt(t){return t.anchor===T2.Tip&&t.hideOnShortSegments&&t.placement==="begin-end"&&t.worldSpace}const uc=P(),hc=P(),$m=P(),px=P(),uAt=P(),fx=La(),mx=La(),V_e=P(),B_e=P(),j_e=vm(),hAt=vm(),dAt=P(),pAt=P(),fAt=P(),jM=[La(),La(),La(),La()],Vy=[P(),P(),P(),P()],Nq=Yr(),Fq=Yr(),kq=Yr(),Uq=Yr();let Kle=class{constructor(e){this._originSR=e,this._origins=new Map,this._objects=new Map,this._gridSize=5e5,this._rootOriginId="root/"+Vu()}getOrigin(e){const r=this._origins.get(this._rootOriginId);if(r==null){const h=kCt.rootOrigin;if(v(h))return this._origins.set(this._rootOriginId,Q$(h[0],h[1],h[2],this._rootOriginId)),this.getOrigin(e);const p=Q$(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,p),p}const i=this._gridSize,n=Math.round(e[0]/i),s=Math.round(e[1]/i),o=Math.round(e[2]/i),a=`${n}/${s}/${o}`;let l=this._origins.get(a);const c=.5*i;if(ge(jo,e,r.vec3),jo[0]=Math.abs(jo[0]),jo[1]=Math.abs(jo[1]),jo[2]=Math.abs(jo[2]),jo[0]<c&&jo[1]<c&&jo[2]<c){if(l){const h=Math.max(...jo);if(ge(jo,e,l.vec3),jo[0]=Math.abs(jo[0]),jo[1]=Math.abs(jo[1]),jo[2]=Math.abs(jo[2]),Math.max(...jo)<h)return l}return r}return l||(l=Q$(n*i,s*i,o*i,a),this._origins.set(a,l)),l}_drawOriginBox(e,r=Zt(1,1,0,1)){const i=window.view,n=i._stage,s=r.toString();if(!this._objects.has(s)){this._material=new lR({width:2,color:r}),n.add(this._material);const m=new N5e({pickable:!1}),g=new Z_({castShadow:!1});n.add(g),m.add(g),n.add(m),this._objects.set(s,g)}const o=this._objects.get(s),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=a.length,c=new Array(3*l),h=new Array,p=.5*this._gridSize;for(let m=0;m<l;m++)c[3*m+0]=e[0]+(1&a[m]?p:-p),c[3*m+1]=e[1]+(2&a[m]?p:-p),c[3*m+2]=e[2]+(4&a[m]?p:-p),m>0&&h.push(m-1,m);$n(c,this._originSR,0,c,i.renderSpatialReference,0,l);const f=new As(this._material,[[O.POSITION,new Qe(c,3,!0)]],[[O.POSITION,h]],null,Wn.Line);n.add(f),o.addGeometry(f)}get test(){const e=this;return{set gridSize(r){e._gridSize=r}}}};const jo=P();let Q5e=class{constructor(e,r,i,n=null){this.rctx=e,this.sliceHelper=n,this.lastFrameCamera=new Pt,this.output=V.Color,this.renderOccludedMask=G_e,this.bindParameters=new XB(r,i,v(n)?n.plane:null)}resetRenderOccludedMask(){this.renderOccludedMask=G_e}},mAt=class extends Q5e{constructor(e,r,i,n,s){super(e,i,n,s),this.offscreenRenderingHelper=r,this.sliceHelper=s,this.time=0}};const G_e=vn.Occlude|vn.OccludeAndTransparent|vn.OccludeAndTransparentStencil;let kI=class extends Pt{constructor(){super(...arguments),this._projectionMatrix=$e()}get projectionMatrix(){return this._projectionMatrix}};u([d()],kI.prototype,"_projectionMatrix",void 0),u([d({readOnly:!0})],kI.prototype,"projectionMatrix",null),kI=u([$("esri.views.3d.webgl-engine.lib.CascadeCamera")],kI);var KO;(function(t){t[t.Highlight=0]="Highlight",t[t.Default=1]="Default"})(KO||(KO={}));let M5=class{constructor(){this.camera=new kI,this.lightMat=$e()}},Qle=class{get depthTexture(){return this._depthTexture}get textureSize(){return this._textureSize}get numCascades(){return this._numCascades}get cascadeDistances(){return ai(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}constructor(e,r){this._rctx=e,this._viewingMode=r,this._enabled=!1,this._snapshots=new Array,this._textureSize=0,this._numCascades=1,this._maxNumCascades=4,this._projectionView=$e(),this._projectionViewInverse=$e(),this._modelViewLight=$e(),this._splitSchemeLambda=0,this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=pr(),this._cascades=[new M5,new M5,new M5,new M5],this._lastOrigin=null,this._maxTextureSize=Math.min(ue("esri-mobile")?2048:8192,this._rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}disposeOffscreenBuffers(){this._discardDepthTexture(),this._discardAllSnapshots()}set maxCascades(e){this._maxNumCascades=_e(Math.floor(e),1,4)}get maxCascades(){return this._maxNumCascades}set enabled(e){this._enabled=e,e||(this._discardDepthTexture(),this._discardAllSnapshots())}get enabled(){return this._enabled}get ready(){return this._enabled&&v(this._depthTexture)}getSnapshot(e){return this.enabled?this._snapshots[e]:null}get cascades(){for(let e=0;e<this._numCascades;++e)Vq[e]=this._cascades[e];return Vq.length=this._numCascades,Vq}start(e,r,i){wt(this.enabled),this._textureSize=this._computeTextureSize(e.fullWidth,e.fullHeight),this._ensureDepthTexture();const{near:n,far:s}=this._clampNearFar(i);this._computeCascadeDistances(s,n),this._setupMatrices(e,r);const{viewMatrix:o,projectionMatrix:a}=e;for(let l=0;l<this._numCascades;++l)this._constructCascade(l,a,o,r);this._lastOrigin=null,this.clear()}finish(e){wt(this.enabled),this._rctx.bindFramebuffer(e)}getShadowMapMatrices(e){if(!this._lastOrigin||!Hl(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||P(),ce(this._lastOrigin,e);for(let r=0;r<this._numCascades;++r){Hc(Z_e,this._cascades[r].lightMat,e);for(let i=0;i<16;++i)J_e[16*r+i]=Z_e[i]}}return J_e}takeCascadeSnapshotTo(e,r){wt(this.enabled);const i=this._ensureSnapshot(r);this._bindFbo();const n=this._rctx,s=n.bindTexture(i,mt.TEXTURE_UNIT_FOR_UPDATES);n.gl.copyTexSubImage2D(Ct.TEXTURE_2D,0,e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[2],e.camera.viewport[3]),n.bindTexture(s,mt.TEXTURE_UNIT_FOR_UPDATES)}clear(){const e=this._rctx;this._bindFbo(),e.setClearColor(1,1,1,1),e.clearSafe(Hi.COLOR_BUFFER_BIT|Hi.DEPTH_BUFFER_BIT)}_computeTextureSize(e,r){const i=.5*Math.log(e*e+r*r)*Math.LOG2E,n=.35,s=2**Math.round(i+n);return Math.min(this._maxTextureSize,2*s)}_ensureDepthTexture(){if(v(this._depthTexture)&&this._depthTexture.descriptor.width===this._textureSize)return;this._discardDepthTexture();const e={target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE,samplingMode:it.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};this._depthTexture=new mt(this._rctx,e),this._fbo=new Jn(this._rctx,{colorTarget:xn.TEXTURE,depthStencilTarget:Ur.DEPTH_RENDER_BUFFER,width:this._textureSize,height:this._textureSize},this._depthTexture)}_ensureSnapshot(e){let r=this._snapshots[e];if(v(r)&&r.descriptor.width===this._textureSize)return r;this._discardSnapshot(e);const i={target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE,samplingMode:it.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};return r=new mt(this._rctx,i),this._snapshots[e]=r,r}_discardDepthTexture(){this._fbo=rt(this._fbo),this._depthTexture=rt(this._depthTexture)}_discardSnapshot(e){this._snapshots[e]=rt(this._snapshots[e])}_discardAllSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){const e=this._rctx;e.unbindTexture(this._depthTexture),e.bindFramebuffer(this._fbo)}_constructCascade(e,r,i,n){const s=this._cascades[e],o=-this._cascadeDistances[e],a=-this._cascadeDistances[e+1],l=(r[10]*o+r[14])/Math.abs(r[11]*o+r[15]),c=(r[10]*a+r[14])/Math.abs(r[11]*a+r[15]);wt(l<c);for(let m=0;m<8;++m){ai(H_e,m%4==0||m%4==3?-1:1,m%4==0||m%4==1?-1:1,m<4?l:c,1);const g=Gd[m];qh(g,H_e,this._projectionViewInverse),g[0]/=g[3],g[1]/=g[3],g[2]/=g[3]}ul(zq,Gd[0]),s.camera.viewMatrix=Hc(gAt,this._modelViewLight,zq);for(let m=0;m<8;++m)Ke(Gd[m],Gd[m],s.camera.viewMatrix);let h=Gd[0][2],p=Gd[0][2];for(let m=1;m<8;++m)h=Math.min(h,Gd[m][2]),p=Math.max(p,Gd[m][2]);h-=200,p+=200,s.camera.near=-p,s.camera.far=-h,bAt(i,n,h,p,s.camera),Mn(s.lightMat,s.camera.projectionMatrix,s.camera.viewMatrix);const f=this._textureSize/2;s.camera.viewport=[e%2==0?0:f,Math.floor(e/2)===0?0:f,f,f]}_setupMatrices(e,r){Mn(this._projectionView,e.projectionMatrix,e.viewMatrix),ya(this._projectionViewInverse,this._projectionView);const i=this._viewingMode===qe.Global?e.eye:he(zq,0,0,1);eB(this._modelViewLight,[0,0,0],[-r[0],-r[1],-r[2]],i)}_clampNearFar(e){let{near:r,far:i}=e;return r<2&&(r=2),i<2&&(i=2),r>=i&&(r=2,i=4),{near:r,far:i}}_computeCascadeDistances(e,r){this._numCascades=Math.min(1+Math.floor(bvt(e/r,4)),this._maxNumCascades);const i=(e-r)/this._numCascades,n=(e/r)**(1/this._numCascades);let s=r,o=r;for(let a=0;a<this._numCascades+1;++a)this._cascadeDistances[a]=Bt(s,o,this._splitSchemeLambda),s*=n,o+=i}get gpuMemoryUsage(){var e;return this._snapshots.reduce((r,i)=>r+g2(i),((e=this._fbo)==null?void 0:e.gpuMemoryUsage)??0)}get test(){const e=this;return{maxNumCascades:this._maxNumCascades,cascades:this._cascades,textureSize:this._textureSize,set splitSchemeLambda(r){e._splitSchemeLambda=r},get splitSchemeLambda(){return e._splitSchemeLambda}}}};const gAt=$e(),H_e=pr(),Gd=[];for(let t=0;t<8;++t)Gd.push(pr());const q_e=Ne(),W_e=Ne(),yAt=Ne(),X_e=Ne(),Y_e=Ne(),zq=P(),Vq=[],Z_e=$e(),J_e=new Float32Array(64),uh=Ne(),LE=Ne(),gx=[Ne(),Ne(),Ne(),Ne()],eo=Ne(),Bq=Ne(),Rv=Ne(),GM=Ne(),DE=Ne(),NE=Ne(),P5=Ne();function _At(t,e,r,i,n,s,o,a){dt(uh,0,0);for(let C=0;C<4;++C)qd(uh,uh,t[C]);sl(uh,uh,.25),dt(LE,0,0);for(let C=4;C<8;++C)qd(LE,LE,t[C]);sl(LE,LE,.25),W1(gx[0],t[4],t[5],.5),W1(gx[1],t[5],t[6],.5),W1(gx[2],t[6],t[7],.5),W1(gx[3],t[7],t[4],.5);let l=0,c=FO(gx[0],uh);for(let C=1;C<4;++C){const A=FO(gx[C],uh);A<c&&(c=A,l=C)}jh(eo,gx[l],t[l+4]);const h=eo[0];let p,f;eo[0]=-eo[1],eo[1]=h,jh(Bq,LE,uh),Ss(Bq,eo)<0&&Poe(eo,eo),W1(eo,eo,Bq,r),d2(eo,eo),p=f=Ss(jh(Rv,t[0],uh),eo);for(let C=1;C<8;++C){const A=Ss(jh(Rv,t[C],uh),eo);A<p?p=A:A>f&&(f=A)}Qs(i,uh),sl(Rv,eo,p-e),qd(i,i,Rv);let m=-1,g=1,_=0,b=0;for(let C=0;C<8;++C){jh(GM,t[C],i),d2(GM,GM);const A=eo[0]*GM[1]-eo[1]*GM[0];A>0?A>m&&(m=A,_=C):A<g&&(g=A,b=C)}_E(m>0,"leftArea"),_E(g<0,"rightArea"),sl(DE,eo,p),qd(DE,DE,uh),sl(NE,eo,f),qd(NE,NE,uh),P5[0]=-eo[1],P5[1]=eo[0];const w=G4(i,t[b],NE,qd(Rv,NE,P5),1,n),x=G4(i,t[_],NE,Rv,1,s),T=G4(i,t[_],DE,qd(Rv,DE,P5),1,o),E=G4(i,t[b],DE,Rv,1,a);_E(w,"rayRay"),_E(x,"rayRay"),_E(T,"rayRay"),_E(E,"rayRay")}function Ir(t,e){return 3*e+t}const K_e=Ne();function tu(t,e){return dt(K_e,t[e],t[e+3]),K_e}const dc=Ne(),at=vi();function vAt(t,e,r,i,n){jh(dc,r,i),sl(dc,dc,.5),at[0]=dc[0],at[1]=dc[1],at[2]=0,at[3]=dc[1],at[4]=-dc[0],at[5]=0,at[6]=dc[0]*dc[0]+dc[1]*dc[1],at[7]=dc[0]*dc[1]-dc[1]*dc[0],at[8]=1,at[Ir(0,2)]=-Ss(tu(at,0),t),at[Ir(1,2)]=-Ss(tu(at,1),t);let s=Ss(tu(at,0),r)+at[Ir(0,2)],o=Ss(tu(at,1),r)+at[Ir(1,2)],a=Ss(tu(at,0),i)+at[Ir(0,2)],l=Ss(tu(at,1),i)+at[Ir(1,2)];s=-(s+a)/(o+l),at[Ir(0,0)]+=at[Ir(1,0)]*s,at[Ir(0,1)]+=at[Ir(1,1)]*s,at[Ir(0,2)]+=at[Ir(1,2)]*s,s=1/(Ss(tu(at,0),r)+at[Ir(0,2)]),o=1/(Ss(tu(at,1),r)+at[Ir(1,2)]),at[Ir(0,0)]*=s,at[Ir(0,1)]*=s,at[Ir(0,2)]*=s,at[Ir(1,0)]*=o,at[Ir(1,1)]*=o,at[Ir(1,2)]*=o,at[Ir(2,0)]=at[Ir(1,0)],at[Ir(2,1)]=at[Ir(1,1)],at[Ir(2,2)]=at[Ir(1,2)],at[Ir(1,2)]+=1,s=Ss(tu(at,1),e)+at[Ir(1,2)],o=Ss(tu(at,2),e)+at[Ir(2,2)],a=Ss(tu(at,1),r)+at[Ir(1,2)],l=Ss(tu(at,2),r)+at[Ir(2,2)],s=-.5*(s/o+a/l),at[Ir(1,0)]+=at[Ir(2,0)]*s,at[Ir(1,1)]+=at[Ir(2,1)]*s,at[Ir(1,2)]+=at[Ir(2,2)]*s,s=Ss(tu(at,1),e)+at[Ir(1,2)],o=Ss(tu(at,2),e)+at[Ir(2,2)],a=-o/s,at[Ir(1,0)]*=a,at[Ir(1,1)]*=a,at[Ir(1,2)]*=a,n[0]=at[0],n[1]=at[1],n[2]=0,n[3]=at[2],n[4]=at[3],n[5]=at[4],n[6]=0,n[7]=at[5],n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=at[6],n[13]=at[7],n[14]=0,n[15]=at[8]}function bAt(t,e,r,i,n){const s=1/Gd[0][3],o=1/Gd[4][3];wt(s<o);let a=s+Math.sqrt(s*o);const l=Math.sin(Js(t[2]*e[0]+t[6]*e[1]+t[10]*e[2]));a/=l,_At(Gd,a,l,q_e,W_e,yAt,X_e,Y_e),vAt(q_e,W_e,X_e,Y_e,n.projectionMatrix),n.projectionMatrix[10]=2/(r-i),n.projectionMatrix[14]=-(r+i)/(r-i)}function wAt(t){return xm(t)&&t.intersector===pn.TERRAIN&&!!t.target}let xAt=class extends i7{constructor(e,r,i){super(e,r),this.triangleNr=i}};function eke(t){return xm(t)&&t.intersector===pn.OVERLAY&&!!t.target}let Cte=class{constructor(){this.adds=new Wt,this.removes=new Wt,this.updates=new Wt({allocator:e=>e||new TAt,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return this.adds.length===0&&this.removes.length===0&&this.updates.length===0}},TAt=class{},SAt=class{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}};var _n,oo;(function(t){t[t.ADD=0]="ADD",t[t.UPDATE=1]="UPDATE",t[t.REMOVE=2]="REMOVE"})(_n||(_n={})),function(t){t[t.NONE=0]="NONE",t[t.VISIBILITY=1]="VISIBILITY",t[t.GEOMETRY=2]="GEOMETRY",t[t.TRANSFORMATION=4]="TRANSFORMATION",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.OCCLUDEE=16]="OCCLUDEE"}(oo||(oo={}));function tke(t){const e=new Map,r=i=>{let n=e.get(i);return n||(n=new SAt,e.set(i,n)),n};return t.removes.forAll(i=>{jq(i)&&r(i.material).removes.push(i)}),t.adds.forAll(i=>{jq(i)&&r(i.material).adds.push(i)}),t.updates.forAll(i=>{jq(i.renderGeometry)&&r(i.renderGeometry.material).updates.push(i)}),e}function jq(t){return t.geometry.indexCount>=1}let EAt=class{constructor(e){this._rctx=e,this._indexBuffer=this._createIndexbuffer(),this._program=this._createProgram()}_createProgram(){const e=`
    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,r=`
    void main(void) {
      gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`;return this._rctx.programCache.acquire(e,r,new Map([]))}_createIndexbuffer(){return Kr.createIndex(this._rctx,zr.STATIC_DRAW,new Uint32Array([0]))}resetIndicesType(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,Lt.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(Ft.POINTS,1,ft.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}},rke=class{constructor(e,r){this._material=e,this._repository=r,this._map=new Map}destroy(){this._map.forEach((e,r)=>{v(e)&&this._repository.release(this._material,r)})}load(e,r,i){if(!this._material.requiresSlot(r,i))return null;this._map.has(i)||this._map.set(i,this._repository.acquire(this._material,r,i));const n=this._map.get(i);if(v(n)){if(n.ensureResources(e)===n_.LOADED)return n;this._repository.requestRender()}return null}};function CAt(t){const e=S`vec3 decodeNormal(vec2 f) {
float z = 1.0 - abs(f.x) - abs(f.y);
return vec3(f + sign(f) * min(z, 0.0), z);
}`;t.vertex.code.add(e)}function eF(t,e){switch(e.normalType){case ci.CompressedAttribute:t.include(CAt),t.attributes.add(O.NORMALCOMPRESSED,"vec2"),t.vertex.code.add(S`vec3 normalModel() {
return decodeNormal(normalCompressed);
}`);break;case ci.Attribute:t.attributes.add(O.NORMAL,"vec3"),t.vertex.code.add(S`vec3 normalModel() {
return normal;
}`);break;case ci.ScreenDerivative:t.extensions.add("GL_OES_standard_derivatives"),t.fragment.code.add(S`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:e.normalType;case ci.COUNT:case ci.Ground:}}var ci;(function(t){t[t.Attribute=0]="Attribute",t[t.CompressedAttribute=1]="CompressedAttribute",t[t.Ground=2]="Ground",t[t.ScreenDerivative=3]="ScreenDerivative",t[t.COUNT=4]="COUNT"})(ci||(ci={}));function C7(t,e){switch(e.normalType){case ci.Attribute:case ci.CompressedAttribute:t.include(eF,e),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("vNormalView","vec3"),t.vertex.uniforms.add([new yD("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel),new wy("transformNormalViewFromGlobal",r=>r.transformNormalViewFromGlobal)]),t.vertex.code.add(S`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case ci.Ground:t.include(DR,e),t.varyings.add("vNormalWorld","vec3"),t.vertex.code.add(S`
        void forwardNormal() {
          vNormalWorld = ${e.spherical?S`normalize(vPositionWorldCameraRelative);`:S`vec3(0.0, 0.0, 1.0);`}
        }
        `);break;case ci.ScreenDerivative:t.vertex.code.add(S`void forwardNormal() {}`);break;default:e.normalType;case ci.COUNT:}}let ike=class extends rNe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=vi()}},nke=class extends iNe{constructor(){super(...arguments),this.transformNormalGlobalFromModel=vi(),this.toMapSpace=pr()}},Ate=class extends nke{constructor(e=P()){super(),this.origin=e,this.slicePlaneLocalOrigin=this.origin}},G3=class{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(O.POSITION).length}write(e,r,i,n,s){x4e(i,this.vertexBufferLayout,e,r,n,s)}};const AAt=mn().vec3f(O.POSITION),RAt=mn().vec3f(O.POSITION).vec2f(O.UV0),ske=mn().vec3f(O.POSITION).vec4u8(O.COLOR);mn().vec3f(O.POSITION).vec4u8(O.OBJECTANDLAYERIDCOLOR);mn().vec3f(O.POSITION).vec2f(O.UV0).vec4u8(O.OBJECTANDLAYERIDCOLOR);const OAt=mn().vec3f(O.POSITION).vec4u8(O.COLOR).vec4u8(O.OBJECTANDLAYERIDCOLOR);let ece=class extends Fw{intersect(e,r,i,n,s,o){return h4e(e,i,n,s,void 0,o)}};function MAt(t){t.fragment.code.add(S`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function PAt(t){t.fragment.code.add(S`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}function Q_e(t){t.fragment.uniforms.add(new Dt("texWaveNormal",e=>e.waveNormal)),t.fragment.uniforms.add(new Dt("texWavePerturbation",e=>e.wavePertubation)),t.fragment.uniforms.add([new br("waveParams",e=>ai(IAt,e.waveStrength,e.waveTextureRepeat,e.flowStrength,e.flowOffset)),new Hr("waveDirection",e=>dt($At,e.waveDirection[0]*e.waveVelocity,e.waveDirection[1]*e.waveVelocity))]),t.include(MAt),t.fragment.code.add(S`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture2D(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const IAt=pr(),$At=Ne();function ND(t,e){e.spherical?t.vertex.code.add(S`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):t.vertex.code.add(S`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),e.spherical?t.vertex.code.add(S`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):t.vertex.code.add(S`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}let tF=class extends Ln{constructor(e,r){super(e,"int",_i.Pass,(i,n,s)=>i.setUniform1i(e,r(n,s)))}},LAt=class extends Ln{constructor(e,r,i){super(e,"mat4",_i.Draw,(n,s,o)=>n.setUniformMatrix4fv(e,r(s,o)),i)}},DAt=class extends Ln{constructor(e,r,i){super(e,"mat4",_i.Pass,(n,s,o)=>n.setUniformMatrix4fv(e,r(s,o)),i)}},oke=class extends wi{constructor(){super(...arguments),this.origin=P()}};function A7(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new DAt("shadowMapMatrix",(r,i)=>i.shadowMap.getShadowMapMatrices(r.origin),4)),ake(t,e))}function S2(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new LAt("shadowMapMatrix",(r,i)=>i.shadowMap.getShadowMapMatrices(r.origin),4)),ake(t,e))}function ake(t,e){const r=t.fragment;r.include(Qu),r.uniforms.add([...rm("shadowMapTex",(i,n)=>n.shadowMap.depthTexture,e.hasWebGL2Context?oi.None:oi.Size),new tF("numCascades",(i,n)=>n.shadowMap.numCascades),new br("cascadeDistances",(i,n)=>n.shadowMap.cascadeDistances)]),r.code.add(S`
    int chooseCascade(float depth, out mat4 mat) {
      vec4 distance = cascadeDistances;

      // choose correct cascade
      int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;

      mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];

      return i;
    }

    vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
      vec4 lv = mat * vec4(_vpos, 1.0);
      lv.xy /= lv.w;
      return 0.5 * lv.xyz + vec3(0.5);
    }

    vec2 cascadeCoordinates(int i, vec3 lvpos) {
      return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;
    }

    float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
      return rgba2float(texture2D(_depthTex, uv));
    }

    float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
      return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
    }

    float filterShadow(vec2 uv, vec3 lvpos, float textureSize, sampler2D _depthTex) {
      float halfPixelSize = 0.5 / textureSize;

      // filter, offset by half pixels
      vec2 st = fract((vec2(halfPixelSize) + uv) * textureSize);

      float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
      float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
      float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
      float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);

      return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
    }

    float readShadowMap(const in vec3 _vpos, float _linearDepth) {
      mat4 mat;
      int i = chooseCascade(_linearDepth, mat);

      if (i >= numCascades) { return 0.0; }

      vec3 lvpos = lightSpacePosition(_vpos, mat);

      // vertex completely outside? -> no shadow
      if (lvpos.z >= 1.0) { return 0.0; }
      if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }

      // calc coord in cascade texture
      vec2 uv = cascadeCoordinates(i, lvpos);

      vec2 textureSize = ${yp(e,"shadowMapTex")};

      return filterShadow(uv, lvpos, textureSize.x, shadowMapTex);
    }
  `)}function NAt(t){const e=t.fragment.code;e.add(S`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),e.add(S`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),e.add(S`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function tce(t,e){const r=t.fragment.code;t.include(VN),e.pbrMode!==_t.Normal&&e.pbrMode!==_t.Schematic&&e.pbrMode!==_t.Terrain&&e.pbrMode!==_t.TerrainWithWater||(r.add(S`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),r.add(S`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),e.pbrMode!==_t.Normal&&e.pbrMode!==_t.Schematic||(t.include(NAt),r.add(S`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),r.add(S`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),r.add(S`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),r.add(S`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function FAt(t,e){const r=t.fragment.code;t.include(VN),r.add(S`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${e.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),r.add(S`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),r.add(S`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),r.add(S`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),r.add(S`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)}function lke(t,e){t.include(FAt,e),t.include(GB),t.include(PAt),e.hasCloudsReflections&&t.include(PDe,e),e.hasScreenSpaceReflections&&t.include(I_t,e);const r=t.fragment;r.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),r.code.add(S`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),r.uniforms.add([new Ie("lightingSpecularStrength",(i,n)=>n.lighting.mainLight.specularStrength),new Ie("lightingEnvironmentStrength",(i,n)=>n.lighting.mainLight.environmentStrength)]),r.code.add(S`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),e.hasCloudsReflections&&r.code.add(S`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y*cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),e.hasScreenSpaceReflections?(r.uniforms.add([new rn("view",(i,n)=>n.ssr.camera.viewMatrix),new Dt("lastFrameColorTexture",(i,n)=>n.ssr.lastFrameColorTexture),new Ie("fadeFactor",(i,n)=>n.ssr.fadeFactor)]),r.code.add(S`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactor;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture2D(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`)):r.code.add(S`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),e.hasCloudsReflections?e.hasScreenSpaceReflections?r.code.add(S`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):r.code.add(S`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):r.code.add(S`return waterRenderedColor;
}`)}function kAt(t){const e=new Br,{vertex:r,fragment:i}=e;Gu(r,t),e.include(zc,t),e.attributes.add(O.POSITION,"vec3"),e.attributes.add(O.UV0,"vec2");const n=new br("waterColor",s=>s.color);if(t.output===V.Color&&t.isDraped)return e.varyings.add("vpos","vec3"),r.uniforms.add(n),r.code.add(S`
        void main(void) {
          if (waterColor.a < ${S.float(Fa)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),i.uniforms.add(n),i.code.add(S`void main() {
gl_FragColor = waterColor;
}`),e;switch(t.output!==V.Color&&t.output!==V.Alpha||(e.include(ND,t),e.include(L3,t),e.varyings.add("vuv","vec2"),e.varyings.add("vpos","vec3"),e.varyings.add("vnormal","vec3"),e.varyings.add("vtbnMatrix","mat3"),t.hasMultipassTerrain&&e.varyings.add("depth","float"),r.uniforms.add(n),r.code.add(S`
      void main(void) {
        if (waterColor.a < ${S.float(Fa)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${t.output===V.Color?"forwardLinearDepth();":""}
      }
    `)),e.include(od,t),t.output){case V.Alpha:e.include(hs,t),i.uniforms.add(n),i.code.add(S`
        void main() {
          discardBySlice(vpos);
          ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `);break;case V.Color:e.include(eV,t),e.include($ae,{pbrMode:_t.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(Q_e),e.include(hs,t),e.include(S2,t),e.include(lke,t),i.uniforms.add([n,new Ie("timeElapsed",s=>s.timeElapsed),r.uniforms.get("view"),r.uniforms.get("localOrigin")]),mm(i,t),i.include(by),U_(i),vy(i),i.code.add(S`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${t.receiveShadows?S`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${t.transparencyPassType===At.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `);break;case V.Normal:e.include(ND,t),e.include(Q_e,t),e.include(hs,t),e.varyings.add("vpos","vec3"),e.varyings.add("vuv","vec2"),r.uniforms.add(n),r.code.add(S`
        void main(void) {
          if (waterColor.a < ${S.float(Fa)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),i.uniforms.add(new Ie("timeElapsed",s=>s.timeElapsed)),i.code.add(S`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case V.Highlight:e.include(W_,t),e.varyings.add("vpos","vec3"),r.uniforms.add(n),r.code.add(S`
      void main(void) {
        if (waterColor.a < ${S.float(Fa)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),e.include(hs,t),i.code.add(S`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return e}const UAt=Object.freeze(Object.defineProperty({__proto__:null,build:kAt},Symbol.toStringTag,{value:"Module"}));let cke=class uke extends Wr{initializeConfiguration(e,r){r.hasWebGL2Context=e.rctx.type===Et.WEBGL2,r.spherical=e.viewingMode===qe.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Gr(e.rctx,uke.shader.get().build(this.configuration),Lr)}_setPipelineState(e){const r=this.configuration,i=e===At.NONE,n=e===At.FrontFace;return Ht({blending:r.output!==V.Normal&&r.output!==V.Highlight&&r.transparent?i?Qh:X_(e):null,depthTest:{func:kw(e)},depthWrite:i?r.writeDepth?Xc:null:_7(e),colorWrite:ir,polygonOffset:i||n?null:w7(r.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};cke.shader=new jr(UAt,()=>Q(()=>import("./WaterSurface.glsl-b8ec07f9.js"),[]));let ea=class extends Io{constructor(){super(...arguments),this.output=V.Color,this.transparencyPassType=At.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.isDraped=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}};u([j({count:V.COUNT})],ea.prototype,"output",void 0),u([j({count:At.COUNT})],ea.prototype,"transparencyPassType",void 0),u([j()],ea.prototype,"spherical",void 0),u([j()],ea.prototype,"receiveShadows",void 0),u([j()],ea.prototype,"hasSlicePlane",void 0),u([j()],ea.prototype,"transparent",void 0),u([j()],ea.prototype,"enableOffset",void 0),u([j()],ea.prototype,"writeDepth",void 0),u([j()],ea.prototype,"hasScreenSpaceReflections",void 0),u([j()],ea.prototype,"doublePrecisionRequiresObfuscation",void 0),u([j()],ea.prototype,"hasCloudsReflections",void 0),u([j()],ea.prototype,"isDraped",void 0),u([j()],ea.prototype,"hasMultipassTerrain",void 0),u([j()],ea.prototype,"cullAboveGround",void 0),u([j({constValue:_t.Water})],ea.prototype,"pbrMode",void 0),u([j({constValue:!0})],ea.prototype,"useCustomDTRExponentForWater",void 0),u([j({constValue:!0})],ea.prototype,"highStepCount",void 0),u([j({constValue:!1})],ea.prototype,"useFillLights",void 0);let zAt=class extends Nw{_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}_updateSSRState(e){e.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:e.ssr.enabled})}_updateCloudsReflectionState(e){const r=v(e.cloudsFade.data);r!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:r})}ensureResources(e){return this._techniqueRepository.constructionContext.waterTextureRepository.ensureResources(e)}beginSlot(e){return this._output===V.Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e)),this._material.setParameters(this._techniqueRepository.constructionContext.waterTextureRepository.passParameters),this.ensureTechnique(cke,e)}},hke=class extends ece{constructor(e){super(e,new dke),this._configuration=new ea,this.animation=new PNe}getConfiguration(e,r){return this._configuration.output=e,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.isDraped=this.parameters.isDraped,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<v7,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}update(e){const r=Math.min(e.camera.relativeElevation,e.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*r<VAt;const i=this.animation.advance(e);return this.setParameters({timeElapsed:qie(this.animation.time)*this.parameters.animationSpeed},!1),this.animation.enabled&&i}requiresSlot(e,r){switch(r){case V.Normal:return e===Ee.DRAPED_WATER;case V.Color:if(this.parameters.isDraped)return e===Ee.DRAPED_MATERIAL;break;case V.Alpha:break;case V.Highlight:return e===Ee.OPAQUE_MATERIAL||e===Ee.DRAPED_MATERIAL;default:return!1}let i=Ee.OPAQUE_MATERIAL;return this.parameters.transparent&&(i=this.parameters.writeDepth?Ee.TRANSPARENT_MATERIAL:Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===i}createGLMaterial(e){return new zAt(e)}createBufferWriter(){return new G3(RAt)}},dke=class extends z3{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=Rr(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=Zt(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1}};const VAt=35e3;let rce=class{constructor(e=0,r=0){this.from=e,this.to=r}get numElements(){return this.to-this.from}};function eve(t){const e=new Map;t.forAll(i=>e.set(i.from,i));let r=!0;for(;r;)r=!1,t.forEach(i=>{const n=e.get(i.to);n&&(i.to=n.to,e.delete(n.from),t.removeUnordered(n),r=!0)})}let tve=class extends rce{constructor(e,r,i){super(r,i),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return v(this.geometry.highlights)&&this.isVisible}get hasOccludees(){return v(this.geometry.occludees)}},BAt=class{constructor(){this.first=0,this.count=0}},jAt=class{constructor(){this._numElements=0,this._instances=new Map,this.holes=new Wt({allocator:e=>e||new rce,deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=I5(),this.drawCommandsHighlight=I5(),this.drawCommandsOccludees=I5(),this.drawCommandsShadowHighlightRest=I5()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(e,r){this.deleteInstance(e),this._instances.set(e,r),this._numElements+=r.numElements}deleteInstance(e){const r=this._instances.get(e);r&&(this._numElements-=r.numElements,this._instances.delete(e))}updateInstance(e,r,i){const n=this._instances.get(e);n&&(this._numElements-=n.numElements,n.from=r,n.to=i,this._numElements+=n.numElements)}updateDrawState(e){e.isVisible?(e.hasHighlights&&(this.hasHighlights=!0),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,this._instances.size===0)return;if(!this.needsMultipleCommands()){const i=this.drawCommandsDefault.pushNew(),n=this.holes.front();return v(this.vao)&&this.holes.length===1&&n.to===Math.floor(this.vao.size/e)?(i.first=0,void(i.count=n.from)):(i.first=1/0,i.count=0,this._instances.forEach(s=>{i.first=Math.min(i.first,s.from),i.count=Math.max(i.count,s.to)}),void(i.count-=i.first))}const r=Array.from(this._instances.values()).sort((i,n)=>i.from===n.from?i.to-n.to:i.from-n.from);for(const i of r)i.isVisible&&(rve(i.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,i),rve(i.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,i))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}};function GAt(t){return v(t.vao)}function I5(){return new Wt({allocator:t=>t||new BAt,deallocator:t=>t})}function rve(t,e){const r=t.back();if(r==null){const i=t.pushNew();return i.first=e.from,void(i.count=e.numElements)}if(HAt(r,e)){const i=e.from-r.first+e.numElements;r.count=i}else{const i=t.pushNew();i.first=e.from,i.count=e.numElements}}function HAt(t,e){return t.first+t.count>=e.from}let qAt=class{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach(e=>e.vao.dispose()),this.buffers.length=0}findBuffer(e){return this.buffers.find(r=>r.instances.has(e))}};const WAt=P6+1;let XAt=class{constructor(e,r,i){this._rctx=e,this._locations=r,this._layout=i,this._cache=e.newCache(`VaoCache ${Vu()}`,YAt)}dispose(){this._cache.destroy()}newVao(e){const r=e.toString(),i=this._cache.pop(r);if(v(i)){const s=i.pop();return i.length>0&&this._cache.put(r,i,e*i.length,WAt),s}const n=new wm(this._rctx,this._locations,{geometry:this._layout},{geometry:Kr.createVertex(this._rctx,zr.STATIC_DRAW)});return n.vertexBuffers.geometry.setSize(e),n}deleteVao(e){if(R(e))return null;const r=e.size,i=r.toString(),n=this._cache.pop(i);return v(n)?(n.push(e),this._cache.put(i,n,r*n.length,-1)):this._cache.put(i,[e],r,-1),null}};function YAt(t,e){if(e===I0.ALL)return void t.forEach(n=>n.dispose());const r=t.pop(),i=t.length*r.size;return r.dispose(),i}let pke=class{constructor(e,r,i){this._rctx=e,this._materialRepository=r,this.material=i,this._dataByOrigin=new Map,this._appleAmdDriverHelper=null,this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new rke(this.material,this._materialRepository),this._bufferWriter=i.createBufferWriter(),this._vaoCache=new XAt(e,i.vertexAttributeLocations,eh(this._bufferWriter.vertexBufferLayout)),this._rctx.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper=new EAt(this._rctx))}dispose(){var e;this._glMaterials.destroy(),this._dataByOrigin.forEach(r=>r.dispose()),this._dataByOrigin.clear(),this._vaoCache.dispose(),(e=this._appleAmdDriverHelper)==null||e.dispose()}get isEmpty(){return this._dataByOrigin.size===0}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this.material instanceof hke}get rendersOccluded(){return!this.isEmpty&&this.material.renderOccluded!==vn.Occlude}get numGeometries(){let e=0;return this._dataByOrigin.forEach(r=>e+=r.buffers.reduce((i,n)=>i+n.instances.size,0)),e}forEachGeometry(e){this._dataByOrigin.forEach(r=>r.buffers.forEach(i=>i.instances.forEach(n=>e(n.geometry))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){var n;const r=this._bufferWriter,i=r.vertexBufferLayout.stride/4;for(const s of e){const o=s.renderGeometry,a=(n=this._dataByOrigin.get(o.localOrigin.id))==null?void 0:n.findBuffer(o.id);if(R(a))return;const l=a.instances.get(o.id);if(s.updateType&(oo.GEOMETRY|oo.TRANSFORMATION)){const c=N5(r.elementCount(l.geometry.geometry)*i),h=r.vertexBufferLayout.createView(c.buffer);this._writeGeometry(o,h,0),a.vao.vertexBuffers.geometry.setSubData(c,l.from*i,0,l.numElements*i)}s.updateType&(oo.HIGHLIGHT|oo.OCCLUDEE|oo.VISIBILITY)&&(a.drawCommandsDirty=!0)}}_computeDeltas(e,r){var n;const i=new D3;for(const s of e){const o=s.localOrigin;if(R(o))continue;let a=i.get(o.id,null);R(a)&&(a=new ive(o.vec3),i.set(o.id,null,a)),a.changes.push(s)}for(const s of r){const o=s.localOrigin;if(R(o))continue;const a=(n=this._dataByOrigin.get(o.id))==null?void 0:n.findBuffer(s.id);if(R(a))continue;let l=i.get(o.id,a);R(l)&&(l=new ive(o.vec3),i.set(o.id,a,l)),l.changes.push(s)}return i}_addAndRemoveGeometries(e,r){const{_bufferWriter:i,_dataByOrigin:n}=this,s=i.vertexBufferLayout.stride/4,o=this._computeDeltas(e,r);o.forEach((a,l)=>{const c=a.get(null),h=v(c)?c.changes:[];o.delete(l,null);let p=n.get(l);if(a.forEach((f,m)=>{if(o.delete(l,m),R(m))return void wt(!1,"No VAO for removed geometries");if(m.instances.size===f.changes.length)return this._vaoCache.deleteVao(m.vao),PL(p.buffers,m),void(p.buffers.length===0&&h.length===0&&n.delete(l));const g=m.numElements,_=m.vao.size/4,b=h.reduce((E,C)=>E+i.elementCount(C.geometry),0),w=f.changes.reduce((E,C)=>E+i.elementCount(C.geometry),0),x=Math.min((g+b-w)*s,D5),T=x>_;x>DV&&x<_/2?(f.changes.forEach(({id:E})=>m.deleteInstance(E)),m.instances.forEach(({geometry:E})=>h.push(E)),this._vaoCache.deleteVao(m.vao),PL(p.buffers,m)):T?this._applyAndRebuild(m,h,f):this._applyRemoves(m,f)}),h.length>0)for(R(p)&&(p=new qAt(c.origin),n.set(l,p)),p.buffers.forEach(f=>this._applyAdds(f,h));h.length>0;)p.buffers.push(this._applyAndRebuild(new jAt,h,null))})}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(e=>{e.buffers.forEach(r=>{r.drawCommandsDirty&&(r.hasHiddenInstances=!1,r.hasHighlights=!1,r.hasOccludees=!1,ca(r.instances,i=>(r.updateDrawState(i),r.hasHiddenInstances&&r.hasHighlights&&r.hasOccludees)),r.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride)),this._hasHighlights=this._hasHighlights||r.hasHighlights,this._hasOccludees=this._hasOccludees||r.hasOccludees})})}_applyAndRebuild(e,r,i){if(v(i))for(const g of i.changes)e.deleteInstance(g.id);const n=this._bufferWriter,s=n.vertexBufferLayout.stride,o=s/4,a=Math.floor(D5/o);let l=e.numElements;for(;r.length>0;){const g=r.pop(),_=n.elementCount(g.geometry);if(l+_>a&&l>0){r.push(g);break}l+=_;const b=new tve(g,0,0);wt(e.instances.get(g.id)==null),e.addInstance(g.id,b)}const c=l*o,h=N5(c),p=n.vertexBufferLayout.createView(h.buffer);let f=0;e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,e.instances.forEach((g,_)=>{this._writeGeometry(g.geometry,p,f);const b=f;f+=n.elementCount(g.geometry.geometry),e.updateInstance(_,b,f),e.updateDrawState(g)}),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(sve(c)),e.vao.vertexBuffers.geometry.setSubData(h,0,0,f*o),e.holes.clear();const m=e.holes.pushNew();return m.from=f,m.to=Math.floor(e.vao.size/s),e.updateDrawCommands(s),e}_applyRemoves(e,r){if(r.changes.length===0)return;for(const a of r.changes){const l=a.id,c=e.instances.get(l);if(!c)continue;e.deleteInstance(l);const h=Lm.back();if(h){if(h.to===c.from){h.to=c.to;continue}if(h.from===c.to){h.from=c.from;continue}}const p=Lm.pushNew();p.from=c.from,p.to=c.to}eve(Lm);const i=this._bufferWriter.vertexBufferLayout.stride/4,n=Lm.reduce((a,l)=>Math.max(a,l.numElements),0)*i,s=N5(n);s.fill(0,0,n);const o=e.vao.vertexBuffers.geometry;Lm.forAll(a=>o.setSubData(s,a.from*i,0,a.numElements*i)),e.holes.pushArray(Lm.data,Lm.length),Lm.forAll((a,l)=>Lm.data[l]=null),Lm.clear(),e.drawCommandsDirty=!0}_applyAdds(e,r){if(r.length===0)return;if(!GAt(e))return void this._applyAndRebuild(e,r,null);const i=this._bufferWriter,n=i.vertexBufferLayout.stride/4,s=e.numElements,o=r.reduce((w,x)=>w+i.elementCount(x.geometry),0),a=Math.min((s+o)*n,D5),l=4*a;if(e.vao.size<sve(D5-DV)&&l>e.vao.size)return void this._applyAndRebuild(e,r,null);eve(e.holes);const c=new Array;for(const w of r){const x=i.elementCount(w.geometry),T=ZAt(e.holes,x);c.push(T)}const h=e.vao.vertexBuffers.geometry;let p=0,f=0,m=0;const g=N5(a),_=i.vertexBufferLayout.createView(g.buffer);r.forEach((w,x)=>{const T=c[x];if(R(T))return;if(m!==T){const A=m-f;A>0&&h.setSubData(g,f*n,0,A*n),f=T,p=0}const E=i.elementCount(w.geometry);this._writeGeometry(w,_,p),p+=E,m=T+E;const C=new tve(w,T,T+E);wt(e.instances.get(w.id)==null),e.addInstance(w.id,C),e.drawCommandsDirty=!0});const b=m-f;b>0&&h.setSubData(g,f*n,0,b*n),QBe(r,(w,x)=>R(c[x]))}_writeGeometry(e,r,i){const n=e.localOrigin.vec3;wvt(nve,-n[0],-n[1],-n[2]);const s=Mn(JAt,nve,e.transformation);ya($5,s),Wu($5,$5),this._bufferWriter.write(s,$5,e.geometry,r,i)}updateAnimation(e){return this.material.update(e)}requiresSlot(e,r){return this.material.requiresSlot(e,r)}render(e,r){var c;if(!this.requiresSlot(r.slot,e))return!1;const i=e===V.Highlight||e===V.ShadowHighlight;if(i&&!this._hasHighlights)return!1;const n=e===V.ShadowExcludeHighlight,s=!(i||n),o=this._rctx;let a;const l=()=>{if(v(a))return a;const h=this._glMaterials.load(o,r.slot,e);return R(h)?null:(a=h.beginSlot(r),R(a)?null:(o.bindTechnique(a,this.material.parameters,r),a))};(c=this._appleAmdDriverHelper)==null||c.resetIndicesType();for(const h of this._dataByOrigin.values())for(const p of h.buffers){if(i&&!p.hasHighlights)continue;const f=(i?p.drawCommandsHighlight:n&&p.needsMultipleCommands()?p.drawCommandsShadowHighlightRest:p.drawCommandsDefault)||null,m=s&&p.drawCommandsOccludees||null;if(f!=null&&f.length||m!=null&&m.length){const g=l();if(R(g))return!1;g.program.bindDraw(new Ate(h.origin),r,this.material.parameters),g.ensureAttributeLocations(p.vao),o.bindVAO(p.vao),f!=null&&f.length&&(g.bindPipelineState(o,r.slot,!1),f.forAll(_=>o.drawArrays(g.primitiveType,_.first,_.count))),m!=null&&m.length&&(g.bindPipelineState(o,r.slot,!0),m.forAll(_=>o.drawArrays(g.primitiveType,_.first,_.count)))}}return v(a)}get test(){return{material:this.material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}},ive=class{constructor(e){this.origin=e,this.changes=new Array}};function ZAt(t,e){let r;if(!t.some(n=>!(n.numElements<e)&&(r=n,!0)))return null;const i=r.from;return r.from+=e,r.from>=r.to&&t.removeUnordered(r),i}const nve=$e(),JAt=$e(),$5=$e(),Lm=new Wt({allocator:t=>t||new rce,deallocator:null}),DV=65536,L5=4*DV,fke=16777216,D5=fke/4;let Gq=new Float32Array(DV);function N5(t){return Gq.length<t&&(Gq=new Float32Array(t)),Gq}function sve(t){const e=4*t;return e<L5?L5:Math.max(Math.min(Math.ceil(1.5*e/L5)*L5,fke),e)}let Th=class extends be{constructor(e){super(e),this._pending=new KAt,this._changes=new Cte,this._materialRenderers=new Map,this._sortedMaterialRenderers=new Wt,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return ca(this._materialRenderers,e=>e.rendersOccluded)}get isEmpty(){return!this.updating&&this._materialRenderers.size===0&&this._geometries.size===0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=tke(this._changes);let r=!1,i=!1,n=!1;return e.forEach((s,o)=>{let a=this._materialRenderers.get(o);if(!a&&s.adds.length>0&&(a=new pke(this.rctx,this._materialRepository,o),this._materialRenderers.set(o,a),r=!0,i=!0,n=!0),!a)return;const l=i||a.hasHighlights,c=n||a.hasWater;a.modify(s),i=i||l!==a.hasHighlights,n=n||c!==a.hasWater,a.isEmpty&&(this._materialRenderers.delete(o),a.dispose(),r=!0)}),this._changes.clear(),r&&this._updateSortedMaterialRenderers(),i&&(this._hasHighlights=ca(this._materialRenderers,s=>s.hasHighlights)),n&&(this._hasWater=ca(this._materialRenderers,s=>s.hasWater)),this.notifyChange("updating"),!0}addGeometries(e,r){if(e.length===0)return;const i=this._validateRenderGeometries(e);for(const s of i)this._geometries.set(s.id,s);const n=this._pending.empty;for(const s of i)this._pending.adds.add(s);n&&this.notifyChange("updating"),r===_n.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,r){const i=this._pending.empty,n=this._pending.adds;for(const s of e)n.has(s)?(this._pending.removed.add(s),n.delete(s)):this._pending.removed.has(s)||this._pending.removes.add(s),this._geometries.delete(s.id);i&&!this._pending.empty&&this.notifyChange("updating"),r===_n.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,r){const i=this._changes.updates.length===0;for(const n of e){const s=this._changes.updates.pushNew();s.renderGeometry=this._validateRenderGeometry(n),s.updateType=r}switch(i&&this._changes.updates.length>0&&this.notifyChange("updating"),r){case oo.TRANSFORMATION:case oo.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case oo.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let r=!1;return this._sortedMaterialRenderers.forAll(i=>r=i.updateAnimation(e)||r),r}render(e){this._sortedMaterialRenderers.forAll(r=>{r.material.shouldRender(e)&&r.render(e.output,e.bindParameters)})}intersect(e,r,i,n,s){return this._geometries.forEach(o=>{if(n&&!n(o))return;this._intersectRenderGeometry(o,i,r,0,e,s);const a=this.rendererContext.longitudeCyclical;a&&(o.boundingSphere[0]-o.boundingSphere[3]<a.min&&this._intersectRenderGeometry(o,i,r,a.range,e,s),o.boundingSphere[0]+o.boundingSphere[3]>a.max&&this._intersectRenderGeometry(o,i,r,-a.range,e,s)),s++}),s}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach((r,i)=>{i.insertOrder=e++,this._sortedMaterialRenderers.push(r)}),this._sortedMaterialRenderers.sort((r,i)=>{const n=i.material.renderPriority-r.material.renderPriority;return n!==0?n:r.material.insertOrder-i.material.insertOrder})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const r=this._changes.updates.data[e];this._pending.has(r.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,r,i,n,s,o){if(!e.visible)return;let a=0;n+=e.transformation[12],a=e.transformation[13],Hq[0]=i[0]-n,Hq[1]=i[1]-a,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,s,Hq,(l,c,h)=>{QAt(r,h,e.material.renderPriority,o,s,e.layerUid,e.graphicUid)},r)}_notifyGraphicGeometryChanged(e){if(R(this.drapeSource.notifyGraphicGeometryChanged))return;let r;for(const i of e){const n=i.graphicUid;v(n)&&n!==r&&(this.drapeSource.notifyGraphicGeometryChanged(n),r=n)}}_notifyGraphicVisibilityChanged(e){if(R(this.drapeSource.notifyGraphicVisibilityChanged))return;let r;for(const i of e){const n=i.graphicUid;v(n)&&n!==r&&(this.drapeSource.notifyGraphicVisibilityChanged(n),r=n)}}_validateRenderGeometries(e){for(const r of e)this._validateRenderGeometry(r);return e}_validateRenderGeometry(e){return R(e.localOrigin)&&(e.localOrigin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};u([d()],Th.prototype,"drapeSource",void 0),u([d()],Th.prototype,"updating",null),u([d()],Th.prototype,"rctx",null),u([d()],Th.prototype,"rendererContext",void 0),u([d()],Th.prototype,"_materialRepository",null),u([d()],Th.prototype,"_localOriginFactory",null),u([d({readOnly:!0})],Th.prototype,"isEmpty",null),u([d()],Th.prototype,"_materialRenderers",void 0),u([d()],Th.prototype,"_geometries",void 0),Th=u([$("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],Th);let KAt=class{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}};function QAt(t,e,r,i,n,s,o){const a=new xAt(s,o,e),l=c=>{c.set(pn.OVERLAY,a,t.dist,t.normal,t.transformation,r,i)};if((n.results.min.drapedLayerOrder==null||r>=n.results.min.drapedLayerOrder)&&(n.results.min.dist==null||n.results.ground.dist<=n.results.min.dist)&&l(n.results.min),n.options.store!==ba.MIN&&(n.results.max.drapedLayerOrder==null||r<n.results.max.drapedLayerOrder)&&(n.results.max.dist==null||n.results.ground.dist>n.results.max.dist)&&l(n.results.max),n.options.store===ba.ALL){const c=nle(n.ray);l(c),n.results.all.push(c)}}const Hq=Ne(),qq=4;function eRt(){const t=new Br,e=t.fragment;t.include(Np);const r=(qq+1)/2,i=1/(2*r*r);return e.include(sd),e.uniforms.add([new Dt("depthMap",n=>n.depthTexture),new zN("tex",n=>n.colorTexture),new gD("blurSize",n=>n.blurSize),new Ie("projScale",(n,s)=>{const o=Pi(s.camera.eye,s.camera.center);return o>5e4?Math.max(0,n.projScale-(o-5e4)):n.projScale}),new Hr("nearFar",(n,s)=>s.camera.nearFar)]),e.code.add(S`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture2D(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv, nearFar);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${S.float(i)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),e.code.add(S`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${S.int(qq)}; r <= ${S.int(qq)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      gl_FragColor = vec4(b / w_total);
    }
  `),t}const tRt=Object.freeze(Object.defineProperty({__proto__:null,build:eRt},Symbol.toStringTag,{value:"Module"}));let mke=class gke extends Wr{initializeProgram(e){return new Gr(e.rctx,gke.shader.get().build(),Lr)}initializePipeline(){return Ht({colorWrite:ir})}};mke.shader=new jr(tRt,()=>Q(()=>import("./SSAOBlur.glsl-5d0a0a13.js"),[]));const rRt="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";function R7(t){t.fragment.uniforms.add(new br("projInfo",(e,r)=>iRt(r))),t.fragment.uniforms.add(new Hr("zScale",(e,r)=>yke(r))),t.fragment.code.add(S`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function iRt(t){const e=t.camera.projectionMatrix;return e[11]===0?ai(ove,2/(t.camera.fullWidth*e[0]),2/(t.camera.fullHeight*e[5]),(1+e[12])/e[0],(1+e[13])/e[5]):ai(ove,-2/(t.camera.fullWidth*e[0]),-2/(t.camera.fullHeight*e[5]),(1-e[8])/e[0],(1-e[9])/e[5])}const ove=pr();function yke(t){return t.camera.projectionMatrix[11]===0?dt(ave,0,1):dt(ave,1,0)}const ave=Ne(),lve=16;function nRt(){const t=new Br,e=t.fragment;return t.include(Np),e.include(sd),t.include(R7),e.uniforms.add(new Ie("radius",(r,i)=>ice(i.camera))),e.code.add(S`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn-bias, 0.0);
}`),e.code.add(S`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),e.uniforms.add([new Hr("nearFar",(r,i)=>i.camera.nearFar),new Dt("normalMap",r=>r.normalTexture),new Dt("depthMap",r=>r.depthTexture),new Hr("zScale",(r,i)=>yke(i)),new Ie("projScale",r=>r.projScale),new Dt("rnm",r=>r.noiseTexture),new Hr("rnmScale",(r,i)=>dt(cve,i.camera.fullWidth/r.noiseTexture.descriptor.width,i.camera.fullHeight/r.noiseTexture.descriptor.height)),new Ie("intensity",r=>r.intensity),new Hr("screenSize",(r,i)=>dt(cve,i.camera.fullWidth,i.camera.fullHeight))]),e.code.add(S`
    void main(void) {
      fillSphere();
      vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));
      float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

      if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
        gl_FragColor = vec4(0.0);
        return;
      }

      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

      // get the normal of current fragment
      vec4 norm4 = texture2D(normalMap, uv);
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
      bool isTerrain = norm4.w<0.5;

      float sum = .0;
      vec3 tapPixelPos;

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${S.int(lve)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        //don't use current or very nearby samples
        if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

        if (isTerrain) {
          bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;
          if (isTerrainTap) {
            continue;
          }
        }

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${S.int(lve)}),0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4)/2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
      gl_FragColor = vec4(A);
    }
  `),t}function ice(t){return Math.max(10,20*t.computeRenderPixelSizeAtDist(Math.abs(4*t.relativeElevation)))}const cve=Ne(),sRt=Object.freeze(Object.defineProperty({__proto__:null,build:nRt,getRadius:ice},Symbol.toStringTag,{value:"Module"}));let _ke=class vke extends Wr{initializeProgram(e){return new Gr(e.rctx,vke.shader.get().build(),Lr)}initializePipeline(){return Ht({colorWrite:ir})}};_ke.shader=new jr(sRt,()=>Q(()=>import("./SSAO.glsl-8683dd82.js"),[]));let oRt=class extends wi{constructor(){super(...arguments),this.projScale=1}},aRt=class extends oRt{constructor(){super(...arguments),this.intensity=1}},lRt=class extends wi{},cRt=class extends lRt{constructor(){super(...arguments),this.blurSize=Ne()}};const UI=2;let bke=class{constructor(e,r,i,n){this._view=e,this._techniqueRepository=r,this._rctx=i,this._requestRender=n,this._quadVAO=null,this._passParameters=new aRt,this._drawParameters=new cRt}dispose(){this.enabled=!1,this._quadVAO=rt(this._quadVAO)}disposeOffscreenBuffers(){Fo(this._ssaoFBO,e=>e.resize(0,0)),Fo(this._blur0FBO,e=>e.resize(0,0)),Fo(this._blur1FBO,e=>e.resize(0,0))}set enabled(e){e?this._enable():this._disable()}get enabled(){return v(this._enableTime)}get active(){return this.enabled&&this._ssaoTechnique.compiled&&this._blurTechnique.compiled}get colorTexture(){return v(this._blur1FBO)?this._blur1FBO.colorTexture:null}render(e,r,i,n){if(R(this._enableTime)||R(i)||R(n)||R(this._ssaoFBO)||R(this._blur0FBO)||R(this._blur1FBO))return;if(!this.active)return this._enableTime=r,void this._requestRender();this._enableTime===0&&(this._enableTime=r);const s=this._rctx,o=e.camera,a=this._view.qualitySettings.fadeDuration,l=a>0?Math.min(a,r-this._enableTime)/a:1;this._passParameters.normalTexture=n,this._passParameters.depthTexture=i,this._passParameters.projScale=1/o.computeRenderPixelSizeAtDist(1),this._passParameters.intensity=4*uRt/ice(o)**6*l;const c=o.fullViewport,h=c[2],p=c[3],f=h/UI,m=p/UI;this._ssaoFBO.resize(h,p),this._blur0FBO.resize(f,m),this._blur1FBO.resize(f,m),R(this._quadVAO)&&(this._quadVAO=vl(this._rctx)),s.bindFramebuffer(this._ssaoFBO),s.setViewport(0,0,h,p),s.bindTechnique(this._ssaoTechnique,this._passParameters,e).bindDraw(this._drawParameters,e,this._passParameters),s.bindVAO(this._quadVAO);const g=Da(this._quadVAO,"geometry");s.drawArrays(Ft.TRIANGLE_STRIP,0,g);const _=s.bindTechnique(this._blurTechnique,this._passParameters,e);s.setViewport(0,0,f,m),s.bindFramebuffer(this._blur0FBO),this._drawParameters.colorTexture=this._ssaoFBO.colorTexture,dt(this._drawParameters.blurSize,0,UI/p),_.bindDraw(this._drawParameters,e,this._passParameters),s.setViewport(0,0,f,m),s.drawArrays(Ft.TRIANGLE_STRIP,0,g),s.bindFramebuffer(this._blur1FBO),this._drawParameters.colorTexture=this._blur0FBO.colorTexture,dt(this._drawParameters.blurSize,UI/h,0),_.bindDraw(this._drawParameters,e,this._passParameters),s.drawArrays(Ft.TRIANGLE_STRIP,0,g),s.setViewport(c[0],c[1],c[2],c[3]),l<1&&this._requestRender()}_enable(){if(v(this._enableTime))return;const e={target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:it.LINEAR,wrapMode:$t.CLAMP_TO_EDGE,width:0,height:0},r={colorTarget:xn.TEXTURE,depthStencilTarget:Ur.NONE};this._ssaoFBO=new Jn(this._rctx,r,e),this._blur0FBO=new Jn(this._rctx,r,e),this._blur1FBO=new Jn(this._rctx,r,e);const i=Uint8Array.from(atob(rRt),n=>n.charCodeAt(0));this._passParameters.noiseTexture=new mt(this._rctx,{target:Ct.TEXTURE_2D,pixelFormat:Ge.RGB,dataType:kt.UNSIGNED_BYTE,hasMipmap:!0,width:32,height:32},i),R(this._ssaoTechnique)&&(this._ssaoTechnique=this._techniqueRepository.acquire(_ke)),R(this._blurTechnique)&&(this._blurTechnique=this._techniqueRepository.acquire(mke)),this._enableTime=0,this._requestRender()}_disable(){this._enableTime=null,this._passParameters.noiseTexture=rt(this._passParameters.noiseTexture),this._blur1FBO=rt(this._blur1FBO),this._blur0FBO=rt(this._blur0FBO),this._ssaoFBO=rt(this._ssaoFBO)}get gpuMemoryUsage(){return(v(this._blur0FBO)?this._blur0FBO.gpuMemoryUsage:0)+(v(this._blur1FBO)?this._blur1FBO.gpuMemoryUsage:0)+(v(this._ssaoFBO)?this._ssaoFBO.gpuMemoryUsage:0)}get test(){return{ssao:this._ssaoFBO,blur:this._blur1FBO}}};const uRt=.5;let nce=class wke extends Wr{initializeProgram(e){return new Gr(e.rctx,wke.shader.get().build(),Lr)}initializePipeline(){return this.configuration.hasAlpha?Ht({blending:mo(Ce.SRC_ALPHA,Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA,Ce.ONE_MINUS_SRC_ALPHA),colorWrite:ir}):Ht({colorWrite:ir})}};nce.shader=new jr(DSt,()=>Q(()=>import("./TextureOnly.glsl-098998df.js"),[]));let sce=class extends _l{constructor(){super(...arguments),this.hasAlpha=!1}};u([j()],sce.prototype,"hasAlpha",void 0);let _f=class extends be{get _bindParameters(){return this._renderContext.bindParameters}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}constructor(e){super(e),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._handles=new qr,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new Wt,this._passParameters=new $le,this._rctx=null,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this._camera=new Pt,this.worldToPCSRatio=1,this.events=new Sn,this.longitudeCyclical=null}initialize(){const e=this.view._stage.renderView;this._rctx=e.renderingContext;const r=e.waterTextureRepository;this._stippleTextureRepository=new k5e(e.renderingContext),this._shaderTechniqueRepository=new I5e({rctx:this._rctx,viewingMode:qe.Local,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:r}),this._renderContext=new Q5e(this._rctx,new Qle(this._rctx,this.view.state.viewingMode),new bke(this.view,this._shaderTechniqueRepository,this._rctx,()=>{})),this._handles.add([ne(()=>r.updating,()=>this.events.emit("content-changed"),Wi),ne(()=>this.spatialReference,i=>this._localOriginFactory=new Kle(i),Wi),Yn(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materialRepository=new $5e(e.textureRepository,this._shaderTechniqueRepository,i=>{(i.renderOccluded&NV)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")},()=>this.events.emit("content-changed")),this._bindParameters.slot=Ee.DRAPED_MATERIAL,this._bindParameters.highlightDepthTexture=TDe(this._rctx),this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=At.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new Dae(ke(1,1,1))]),this._handles.add(this.view.resourceController.scheduler.registerTask(St.STAGE,this))}destroy(){this._handles.destroy(),this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._debugTextureTechnique=en(this._debugTextureTechnique),this._passParameters.texture=rt(this._passParameters.texture),this._bindParameters.highlightDepthTexture=rt(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=ze(this._shaderTechniqueRepository),this._temporaryFBO=rt(this._temporaryFBO),this._quadVAO=rt(this._quadVAO),this.disposeOverlays()}get updating(){return this._sortedDrapeSourceRenderersDirty||ca(this._renderers,e=>e.updating)}get hasOverlays(){return v(this._overlays)&&v(this._overlayRenderTarget)}get gpuMemoryUsage(){return v(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,Th)}createDrapeSourceRenderer(e,r,i){const n=this._renderers.get(e);v(n)&&n.destroy();const s=new r({...i,rendererContext:this,drapeSource:e});return this._renderers.set(e,s),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(ne(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),s}removeDrapeSourceRenderer(e){if(R(e))return;const r=this._renderers.get(e);R(r)||(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this._handles.remove(e),r.destroy())}collectUnusedRenderTargetMemory(e){let r=!1;if(v(this._overlayRenderTarget))for(const i of this._overlayRenderTarget.renderTargets){const[n,s]=this.overlays,o=n.validTargets[i.type]||!s.validTargets[i.type];r=this._overlayRenderTarget.validateUsageForTarget(o,i,e)||r}return r}get overlays(){return Nt(this._overlays,[])}ensureDrapeTargets(e){v(this._overlays)&&this._overlays.forEach(r=>r.hasTargetWithoutRasterImage=r6(e,i=>i.drapeTargetType===xte.WithoutRasterImage))}ensureDrapeSources(e){v(this._overlays)&&this._overlays.forEach(r=>{r.hasDrapedFeatureSource=r6(e,i=>i.drapeSourceType===J$.Features),r.hasDrapedRasterSource=r6(e,i=>i.drapeSourceType===J$.RasterImage)})}ensureOverlays(e,r){R(this._overlays)&&(this._overlayRenderTarget=new ICt(this._rctx),this._overlays=[new L_e(dn.INNER,this._overlayRenderTarget),new L_e(dn.OUTER,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(r)}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=rt(this._overlayRenderTarget),this.events.emit("textures-disposed")}get running(){return this.updating}runTask(e){this._processDrapeSources(e,()=>!0)}_processDrapeSources(e,r){let i=!1;for(const[n,s]of this._renderers){if(e.done)break;(n.destroyed||r(n))&&s.commitChanges()&&(i=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,i=!0,this._updateSortedDrapeSourceRenderers()),i&&(v(this._overlays)&&this._renderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(jl,e=>e.updatePolicy===Vb.SYNC)}get isEmpty(){return!Qr.OVERLAY_DRAW_DEBUG_TEXTURE&&!ca(this._renderers,e=>!e.isEmpty)}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateAnimation(e){let r=!1;return this._renderers.forEach(i=>r=i.updateAnimation(e)||r),r}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawTarget(e,r,i){const n=e.canvasGeometries;if(n.numViews===0)return!1;this._screenToWorldRatio=i*e.mapUnitsPerPixel;const s=r.output;if(this.isEmpty||s===V.Highlight&&!this.hasHighlights||s===V.Normal&&!this.hasWater||!e.hasSomeSizedView())return!1;const o=r.fbo;if(!o.isValid())return!1;const a=2*e.resolution,l=e.resolution;o.resize(a,l);const c=this._rctx;if(this._camera.pixelRatio=e.pixelRatio*i,this._renderContext.output=s,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=s===V.Normal?Ee.DRAPED_WATER:Ee.DRAPED_MATERIAL,e.applyViewport(this._rctx),o.bind(c),e.index===dn.INNER&&(c.setClearColor(0,0,0,0),c.clearSafe(Hi.COLOR_BUFFER_BIT)),r.type===Rn.Occluded&&(this._renderContext.renderOccludedMask=NV),Qr.OVERLAY_DRAW_DEBUG_TEXTURE&&r.type!==Rn.Occluded)for(let h=0;h<n.numViews;h++)this._setViewParameters(n.extents[h],e),this._drawDebugTexture(e.resolution,dRt[e.index]);return this._renderers.size>0&&this._sortedRenderers.forAll(({drapeSource:h,renderer:p})=>{if(r.type===Rn.ColorNoRasterImage&&h.drapeSourceType===J$.RasterImage)return;const{fullOpacity:f}=h,m=v(f)&&f<1&&s===V.Color;m&&(this.bindTemporaryFramebuffer(this._rctx,a,l),c.clearSafe(Hi.COLOR_BUFFER_BIT));for(let g=0;g<n.numViews;g++)this._setViewParameters(n.extents[g],e),p.render(this._renderContext);m&&v(this._temporaryFBO)&&(o.bind(c),this.view._stage.renderView.compositingHelper.compositeOverlay(this._renderContext.bindParameters,this._temporaryFBO.getTexture(),f,e.index))}),c.bindFramebuffer(null),o.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,r,i){R(this._temporaryFBO)&&(this._temporaryFBO=new P5e(e,!1)),this._temporaryFBO.resize(r,i),this._temporaryFBO.bind(e)}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,r,i,n){var o;let s=0;for(const a of this._renderers.values())s=((o=a.intersect)==null?void 0:o.call(a,e,r,i,n,s))??s}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),this._renderers.size===0)return;const e=this.view.map.allLayers;this._renderers.forEach((r,i)=>{const n=e.indexOf(i.layer),s=n>=0,o=this._renderers.size*(i.renderGroup??(s?PV.MapLayer:PV.ViewLayer))+(s?n:0);this._sortedRenderers.push(new hRt(i,r,o))}),this._sortedRenderers.sort((r,i)=>r.index-i.index)}_setViewParameters(e,r){const i=this._camera;i.viewport=[0,0,r.resolution,r.resolution],RAe(i.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],i.near,i.far),Q9(i.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=ca(this._renderers,r=>r.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_updateHasHighlights(){const e=ca(this._renderers,r=>r.hasHighlights);e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}_updateRendersOccluded(){const e=ca(this._renderers,r=>r.rendersOccluded);e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}_drawDebugTexture(e,r){this._ensureDebugPatternResources(e,e,r);const i=this._rctx;i.bindTechnique(this._debugTextureTechnique,this._passParameters,null),i.bindVAO(this._quadVAO),i.drawArrays(Ft.TRIANGLE_STRIP,0,Da(this._quadVAO,"geometry"))}_ensureDebugPatternResources(e,r,i){if(he(this._passParameters.color,i[0],i[1],i[2]),this._passParameters.texture)return;const n=new Uint8Array(e*r*4);let s=0;for(let a=0;a<r;a++)for(let l=0;l<e;l++){const c=Math.floor(l/10),h=Math.floor(a/10);c<2||h<2||10*c>e-20||10*h>r-20?(n[s++]=255,n[s++]=255,n[s++]=255,n[s++]=255):(n[s++]=255,n[s++]=255,n[s++]=255,n[s++]=1&c&&1&h?1&l^1&a?0:255:1&c^1&h?0:128)}this._passParameters.texture=new mt(this._rctx,{target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:it.NEAREST,width:e,height:r},n);const o=new sce;o.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(nce,o),this._quadVAO=vl(this._rctx)}get test(){return{drapedRenderers:Array.from(this._renderers.values()),getDrapeSourceRenderer:e=>this._renderers.get(e)}}};u([d()],_f.prototype,"_sortedDrapeSourceRenderersDirty",void 0),u([d({autoDestroy:!0})],_f.prototype,"_shaderTechniqueRepository",void 0),u([d({autoDestroy:!0})],_f.prototype,"_stippleTextureRepository",void 0),u([d({constructOnly:!0})],_f.prototype,"view",void 0),u([d()],_f.prototype,"worldToPCSRatio",void 0),u([d()],_f.prototype,"spatialReference",void 0),u([d({type:Boolean,readOnly:!0})],_f.prototype,"updating",null),u([d()],_f.prototype,"isEmpty",null),_f=u([$("esri.views.3d.terrain.OverlayRenderer")],_f);let hRt=class{constructor(e,r,i){this.drapeSource=e,this.renderer=r,this.index=i}};const dRt=[[1,.5,.5],[.5,.5,1]],oce=-2,NV=vn.OccludeAndTransparent;function ace(t,e,r,i){const n=QN(t.rings,!!t.hasZ,py.CCW_IS_HOLE),s=Zu(n.position.length),o=l5e(n.position,t.spatialReference,0,s,0,n.position,0,n.position.length/3,e,r,i),a=o!=null;return new mRt(n.position,s,Ske(n.polygons,n.position,s),Tke(n.outlines,n.position,s),a,o)}function xke(t,e){const r=QN(t.rings,!1,py.CCW_IS_HOLE),i=$n(r.position,t.spatialReference,0,r.position,e,0,r.position.length/3);for(let n=2;n<r.position.length;n+=3)r.position[n]=oce;return{position:r.position,polygons:Ske(r.polygons,r.position),outlines:Tke(r.outlines,r.position),projectionSuccess:i}}function Tke(t,e,r=null){return t.filter(({count:i})=>i>1).map(({index:i,count:n})=>{const s=3*i,o=3*n;return v(r)?new Eke(i,n,_p(e,s,o),_p(r,s,o)):new lce(i,n,_p(e,s,o))})}function Ske(t,e,r=null){const i=new Array;for(const{index:n,count:s,holeIndices:o,pathLengths:a}of t){if(s<=1)continue;const l=3*n,c=3*s,h=o.map(f=>f-n),p=v(r)?new pRt(n,s,_p(e,3*n,3*s),_p(r,l,c),h,a):new fRt(n,s,_p(e,3*n,3*s),h,a);i.push(p)}return i}let lce=class{constructor(e,r,i){this.index=e,this.count=r,this.position=i}},Eke=class extends lce{constructor(e,r,i,n){super(e,r,i),this.mapPositions=n}},pRt=class extends Eke{constructor(e,r,i,n,s,o){super(e,r,i,n),this.holeIndices=s,this.pathLengths=o}},fRt=class extends lce{constructor(e,r,i,n,s){super(e,r,i),this.holeIndices=n,this.pathLengths=s}},mRt=class{constructor(e,r,i,n,s,o){this.position=e,this.mapPositions=r,this.polygons=i,this.outlines=n,this.projectionSuccess=s,this.sampledElevation=o}};function Cke(t,e){const r=t.fragment;switch(r.code.add(S`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),e.doubleSidedMode){case Tn.None:r.code.add(S`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case Tn.View:r.code.add(S`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case Tn.WindingOrder:r.code.add(S`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:e.doubleSidedMode;case Tn.COUNT:}}var Tn;(function(t){t[t.None=0]="None",t[t.View=1]="View",t[t.WindingOrder=2]="WindingOrder",t[t.COUNT=3]="COUNT"})(Tn||(Tn={}));function Ake(t){t.vertex.code.add(S`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}let gRt=class extends _l{constructor(){super(...arguments),this.instancedDoublePrecision=!1}};function Rke(t,e){e.instanced&&e.instancedDoublePrecision&&(t.attributes.add(O.MODELORIGINHI,"vec3"),t.attributes.add(O.MODELORIGINLO,"vec3"),t.attributes.add(O.MODEL,"mat3"),t.attributes.add(O.MODELNORMAL,"mat3"));const r=t.vertex;e.instancedDoublePrecision&&(r.include(sV,e),r.uniforms.add(new Kh("viewOriginHi",(i,n)=>Avt(he(F5,n.camera.viewInverseTransposeMatrix[3],n.camera.viewInverseTransposeMatrix[7],n.camera.viewInverseTransposeMatrix[11]),F5))),r.uniforms.add(new Kh("viewOriginLo",(i,n)=>Rvt(he(F5,n.camera.viewInverseTransposeMatrix[3],n.camera.viewInverseTransposeMatrix[7],n.camera.viewInverseTransposeMatrix[11]),F5)))),r.code.add(S`
    vec3 calculateVPos() {
      ${e.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `),r.code.add(S`
    vec3 subtractOrigin(vec3 _pos) {
      ${e.instancedDoublePrecision?S`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),r.code.add(S`
    vec3 dpNormal(vec4 _normal) {
      ${e.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `),e.output===V.Normal&&(YO(r),r.code.add(S`
    vec3 dpNormalView(vec4 _normal) {
      ${e.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `)),e.hasVertexTangents&&r.code.add(S`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${e.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `)}u([j()],gRt.prototype,"instancedDoublePrecision",void 0);const F5=P();var Hs;function yRt(t){switch(t){case"multiply":default:return Hs.Multiply;case"ignore":return Hs.Ignore;case"replace":return Hs.Replace;case"tint":return Hs.Tint}}function Oke(t,e,r){if(R(t)||e===Hs.Ignore)return r[0]=255,r[1]=255,r[2]=255,void(r[3]=255);const i=_e(Math.round(t[3]*FV),0,FV),n=i===0||e===Hs.Tint?0:e===Hs.Replace?_Rt:vRt;r[0]=_e(Math.round(t[0]*FE),0,FE),r[1]=_e(Math.round(t[1]*FE),0,FE),r[2]=_e(Math.round(t[2]*FE),0,FE),r[3]=i+n}(function(t){t[t.Multiply=1]="Multiply",t[t.Ignore=2]="Ignore",t[t.Replace=3]="Replace",t[t.Tint=4]="Tint"})(Hs||(Hs={}));const FE=255,FV=85,_Rt=FV,vRt=2*FV;function Mke(t){t.vertex.code.add(S`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${S.int(Hs.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${S.int(Hs.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${S.int(Hs.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${S.int(Hs.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}function Pke(t,e){e.hasSymbolColors?(t.include(Mke),t.attributes.add(O.SYMBOLCOLOR,"vec4"),t.varyings.add("colorMixMode","mediump float"),t.vertex.code.add(S`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(t.fragment.uniforms.add(new tF("colorMixMode",r=>y4e[r.colorMixMode])),t.vertex.code.add(S`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function X2(t,e){e.hasVertexColors?(t.attributes.add(O.COLOR,"vec4"),t.varyings.add("vColor","vec4"),t.vertex.code.add(S`void forwardVertexColor() { vColor = color; }`),t.vertex.code.add(S`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):t.vertex.code.add(S`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function bRt(t){t.fragment.code.add(S`
    #define discardOrAdjustAlpha(color) { if (color.a < ${S.float(Fa)}) { discard; } }
  `)}let kS=class extends Ln{constructor(e,r){super(e,"float",_i.Draw,(i,n,s)=>i.setUniform1f(e,r(n,s)))}};function US(t,e){Ike(t,e,new Ie("textureAlphaCutoff",r=>r.textureAlphaCutoff))}function wRt(t,e){Ike(t,e,new kS("textureAlphaCutoff",r=>r.textureAlphaCutoff))}function Ike(t,e,r){const i=t.fragment;switch(e.alphaDiscardMode!==gi.Mask&&e.alphaDiscardMode!==gi.MaskBlend||i.uniforms.add(r),e.alphaDiscardMode){case gi.Blend:return t.include(bRt);case gi.Opaque:i.code.add(S`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case gi.Mask:i.code.add(S`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case gi.MaskBlend:t.fragment.code.add(S`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function $ke(t,e){const{vertex:r,fragment:i}=t,n=e.hasModelTransformation;n&&r.uniforms.add(new rn("model",o=>v(o.modelTransformation)?o.modelTransformation:id));const s=e.hasColorTexture&&e.alphaDiscardMode!==gi.Opaque;switch(e.output){case V.Depth:case V.Shadow:case V.ShadowHighlight:case V.ShadowExcludeHighlight:case V.ObjectAndLayerIdColor:Gu(r,e),t.include(zc,e),t.include(Zg,e),t.include(GR,e),t.include(M_,e),t.include(hs,e),t.include(g7,e),_2(t),t.varyings.add("depth","float"),s&&i.uniforms.add(new Dt("tex",o=>o.texture)),r.code.add(S`
          void main(void) {
            vpos = calculateVPos();
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPositionWithDepth(proj, view, ${n?"model,":""} vpos, nearFar, depth);
            forwardTextureCoordinates();
            forwardObjectAndLayerIdColor();
          }
        `),t.include(US,e),i.code.add(S`
          void main(void) {
            discardBySlice(vpos);
            ${s?S`
                    vec4 texColor = texture2D(tex, ${e.hasColorTextureTransform?S`colorUV`:S`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${e.output===V.ObjectAndLayerIdColor?S`outputObjectAndLayerIdColor();`:S`outputDepth(depth);`}
          }
        `);break;case V.Normal:Gu(r,e),t.include(zc,e),t.include(eF,e),t.include(C7,e),t.include(Zg,e),t.include(GR,e),s&&i.uniforms.add(new Dt("tex",o=>o.texture)),t.varyings.add("vPositionView","vec3"),r.code.add(S`
          void main(void) {
            vpos = calculateVPos();
            vpos = subtractOrigin(vpos);
            ${e.normalType===ci.Attribute?S`
            vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:""}
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, ${n?"model,":""} vpos);
            forwardTextureCoordinates();
          }
        `),t.include(hs,e),t.include(US,e),i.code.add(S`
          void main() {
            discardBySlice(vpos);
            ${s?S`
                    vec4 texColor = texture2D(tex, ${e.hasColorTextureTransform?S`colorUV`:S`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${e.normalType===ci.ScreenDerivative?S`
                vec3 normal = screenDerivativeNormal(vPositionView);`:S`
                vec3 normal = normalize(vNormalWorld);
                if (gl_FrontFacing == false) normal = -normal;`}
            gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
          }
        `);break;case V.Highlight:Gu(r,e),t.include(zc,e),t.include(Zg,e),t.include(GR,e),s&&i.uniforms.add(new Dt("tex",o=>o.texture)),r.code.add(S`
          void main(void) {
            vpos = calculateVPos();
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, ${n?"model,":""} vpos);
            forwardTextureCoordinates();
          }
        `),t.include(hs,e),t.include(US,e),t.include(W_,e),i.code.add(S`
          void main() {
            discardBySlice(vpos);
            ${s?S`
                    vec4 texColor = texture2D(tex, ${e.hasColorTextureTransform?S`colorUV`:S`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}}function Lke(t,e){const r=t.fragment;if(e.hasVertexTangents?(t.attributes.add(O.TANGENT,"vec4"),t.varyings.add("vTangent","vec4"),e.doubleSidedMode===Tn.WindingOrder?r.code.add(S`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):r.code.add(S`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):(t.extensions.add("GL_OES_standard_derivatives"),r.code.add(S`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`)),e.textureCoordinateType!==cs.None){t.include(Mae,e);const i=e.supportsTextureAtlas?e.hasWebGL2Context?oi.None:oi.Size:oi.None;r.uniforms.add(e.pbrTextureBindType===_i.Pass?rm("normalTexture",n=>n.textureNormal,i):Ub("normalTexture",n=>n.textureNormal,i)),r.code.add(S`
    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
      vtc.uv = uv;
      ${e.supportsTextureAtlas?S`vtc.size = ${yp(e,"normalTexture")};`:""}
      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;
      return tangentSpace * rawNormal;
    }
  `)}}function rF(t,e){const r=t.fragment;e.receiveAmbientOcclusion?(r.uniforms.add(rm("ssaoTex",(i,n)=>n.ssaoHelper.colorTexture,e.hasWebGL2Context?oi.None:oi.InvSize)),r.constants.add("blurSizePixelsInverse","float",1/UI),r.code.add(S`
      float evaluateAmbientOcclusionInverse() {
        vec2 ssaoTextureSizeInverse = ${yp(e,"ssaoTex",!0)};
        return texture2D(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).a;
      }

      float evaluateAmbientOcclusion() {
        return 1.0 - evaluateAmbientOcclusionInverse();
      }
    `)):r.code.add(S`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)}function iF(t){t.constants.add("ambientBoostFactor","float",KDe)}function H3(t){t.uniforms.add(new Ie("lightingGlobalFactor",(e,r)=>r.lighting.globalFactor))}function E2(t,e){const r=t.fragment;switch(t.include(rF,e),e.pbrMode!==_t.Disabled&&t.include(tce,e),t.include($ae,e),t.include(VN),r.code.add(S`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${e.pbrMode===_t.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),iF(r),H3(r),U_(r),r.code.add(S`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${e.spherical?S`normalize(vPosWorld)`:S`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),vy(r),r.code.add(S`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),e.pbrMode){case _t.Disabled:case _t.WaterOnIntegratedMesh:case _t.Water:t.include(eV,e),r.code.add(S`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case _t.Normal:case _t.Schematic:r.code.add(S`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),r.code.add(S`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),e.useFillLights?r.uniforms.add(new s_("hasFillLights",(i,n)=>n.enableFillLights)):r.constants.add("hasFillLights","bool",!1),r.code.add(S`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),r.uniforms.add([new Ie("lightingSpecularStrength",(i,n)=>n.lighting.mainLight.specularStrength),new Ie("lightingEnvironmentStrength",(i,n)=>n.lighting.mainLight.environmentStrength)]),r.code.add(S`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),r.code.add(S`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${e.pbrMode===_t.Schematic?S`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:S`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case _t.Terrain:case _t.TerrainWithWater:t.include(eV,e),r.code.add(S`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluateTerrainLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:e.pbrMode;case _t.COUNT:}}function xRt(t){t.vertex.uniforms.add(new wy("colorTextureTransformMatrix",e=>v(e.colorTextureTransformMatrix)?e.colorTextureTransformMatrix:Bc())),t.varyings.add("colorUV","vec2"),t.vertex.code.add(S`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function TRt(t){t.vertex.uniforms.add(new wy("normalTextureTransformMatrix",e=>v(e.normalTextureTransformMatrix)?e.normalTextureTransformMatrix:Bc())),t.varyings.add("normalUV","vec2"),t.vertex.code.add(S`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function SRt(t){t.vertex.uniforms.add(new wy("emissiveTextureTransformMatrix",e=>v(e.emissiveTextureTransformMatrix)?e.emissiveTextureTransformMatrix:Bc())),t.varyings.add("emissiveUV","vec2"),t.vertex.code.add(S`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function ERt(t){t.vertex.uniforms.add(new wy("occlusionTextureTransformMatrix",e=>v(e.occlusionTextureTransformMatrix)?e.occlusionTextureTransformMatrix:Bc())),t.varyings.add("occlusionUV","vec2"),t.vertex.code.add(S`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function CRt(t){t.vertex.uniforms.add(new wy("metallicRoughnessTextureTransformMatrix",e=>v(e.metallicRoughnessTextureTransformMatrix)?e.metallicRoughnessTextureTransformMatrix:Bc())),t.varyings.add("metallicRoughnessUV","vec2"),t.vertex.code.add(S`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function FD(t){t.include(by),t.code.add(S`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${S.int(Hs.Multiply)}) {
        return allMixed;
      }
      if (mode == ${S.int(Hs.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${S.int(Hs.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${S.int(Hs.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${S.int(Hs.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function ARt(t){const e=new Br,{vertex:r,fragment:i,varyings:n}=e;return Gu(r,t),e.include(BN),n.add("vpos","vec3"),e.include(GR,t),e.include(Rke,t),e.include(l4e,t),t.hasColorTextureTransform&&e.include(xRt),t.output!==V.Color&&t.output!==V.Alpha||(t.hasNormalTextureTransform&&e.include(TRt),t.hasEmissionTextureTransform&&e.include(SRt),t.hasOcclusionTextureTransform&&e.include(ERt),t.hasMetallicRoughnessTextureTransform&&e.include(CRt),mm(r,t),e.include(eF,t),e.include(zc,t),t.normalType===ci.Attribute&&t.offsetBackfaces&&e.include(Ake),e.include(Lke,t),e.include(C7,t),t.instancedColor&&e.attributes.add(O.INSTANCECOLOR,"vec4"),n.add("localvpos","vec3"),e.include(Zg,t),e.include(L3,t),e.include(Pke,t),e.include(X2,t),r.uniforms.add(new br("externalColor",s=>s.externalColor)),n.add("vcolorExt","vec4"),t.hasMultipassTerrain&&n.add("depth","float"),t.hasModelTransformation&&r.uniforms.add(new rn("model",s=>v(s.modelTransformation)?s.modelTransformation:id)),r.code.add(S`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${t.instancedColor?"vcolorExt *= instanceColor;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${S.float(Fa)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = calculateVPos();
          localvpos = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${t.normalType===ci.Attribute?S`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${t.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, ${t.hasModelTransformation?"model,":""} vpos);
          ${t.normalType===ci.Attribute&&t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        ${t.hasColorTextureTransform?S`forwardColorUV();`:""}
        ${t.hasNormalTextureTransform?S`forwardNormalUV();`:""}
        ${t.hasEmissionTextureTransform?S`forwardEmissiveUV();`:""}
        ${t.hasOcclusionTextureTransform?S`forwardOcclusionUV();`:""}
        ${t.hasMetallicRoughnessTextureTransform?S`forwardMetallicRoughnessUV();`:""}
      }
    `)),t.output===V.Alpha&&(e.include(hs,t),e.include(US,t),e.include(od,t),i.uniforms.add([new Ie("opacity",s=>s.opacity),new Ie("layerOpacity",s=>s.layerOpacity)]),t.hasColorTexture&&i.uniforms.add(new Dt("tex",s=>s.texture)),i.include(FD),i.code.add(S`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${t.hasColorTexture?S`
                vec4 texColor = texture2D(tex, ${t.hasColorTextureTransform?S`colorUV`:S`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:S`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?S`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:S`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        gl_FragColor = vec4(opacity_);
      }
    `)),t.output===V.Color&&(e.include(hs,t),e.include(E2,t),e.include(rF,t),e.include(US,t),e.include(t.instancedDoublePrecision?A7:S2,t),e.include(od,t),mm(i,t),i.uniforms.add([r.uniforms.get("localOrigin"),new Jt("ambient",s=>s.ambient),new Jt("diffuse",s=>s.diffuse),new Ie("opacity",s=>s.opacity),new Ie("layerOpacity",s=>s.layerOpacity)]),t.hasColorTexture&&i.uniforms.add(new Dt("tex",s=>s.texture)),e.include(Iae,t),e.include(tce,t),i.include(FD),e.include(Cke,t),iF(i),H3(i),vy(i),i.code.add(S`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${t.hasColorTexture?S`
                vec4 texColor = texture2D(tex, ${t.hasColorTextureTransform?S`colorUV`:S`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:S`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${t.normalType===ci.ScreenDerivative?S`
                vec3 normal = screenDerivativeNormal(localvpos);`:S`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${t.pbrMode===_t.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${t.receiveShadows?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?S`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:S`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.hasNormalTexture?S`
                mat3 tangentSpace = ${t.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`:S`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${t.spherical?S`normalize(posWorld);`:S`vec3(0.0, 0.0, 1.0);`}

        ${t.snowCover?S`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${t.pbrMode===_t.Normal||t.pbrMode===_t.Schematic?S`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?S`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:S`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===At.Color?S`gl_FragColor = premultiplyAlpha(gl_FragColor);`:""}
      }
    `)),e.include($ke,t),e}const RRt=Object.freeze(Object.defineProperty({__proto__:null,build:ARt},Symbol.toStringTag,{value:"Module"}));let ORt=class extends ike{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=ke(0,1,.5),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=Ii.Back,this.emissiveFactor=ke(0,0,0),this.instancedDoublePrecision=!1,this.normalType=ci.Attribute,this.receiveSSAO=!0,this.receiveShadows=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=ke(.2,.2,.2),this.diffuse=ke(.8,.8,.8),this.externalColor=Zt(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=P(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvSizeValue=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=vi(),this.vvOpacityEnabled=!1,this.vvOpacityValues=[],this.vvOpacityOpacities=[],this.transparent=!1,this.writeDepth=!0,this.customDepthTest=f2.Less,this.textureAlphaMode=gi.Blend,this.textureAlphaCutoff=RV,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=vn.Occlude}},MRt=class extends nke{constructor(){super(...arguments),this.origin=P(),this.slicePlaneLocalOrigin=this.origin}},cce=class Dke extends Wr{initializeConfiguration(e,r){r.hasWebGL2Context=e.rctx.type===Et.WEBGL2,r.spherical=e.viewingMode===qe.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result,r.textureCoordinateType=r.hasColorTexture||r.hasMetallicRoughnessTexture||r.hasEmissionTexture||r.hasOcclusionTexture||r.hasNormalTexture?cs.Default:cs.None,r.objectAndLayerIdColorInstanced=r.instanced}initializeProgram(e){return this._initializeProgram(e,Dke.shader)}_initializeProgram(e,r){return new Gr(e.rctx,r.get().build(this.configuration),Lr)}_convertDepthTestFunction(e){return e===f2.Lequal?zi.LEQUAL:zi.LESS}_makePipeline(e,r){const i=this.configuration,n=e===At.NONE,s=e===At.FrontFace;return Ht({blending:i.output!==V.Color&&i.output!==V.Alpha||!i.transparent?null:n?Qh:X_(e),culling:PRt(i)?qB(i.cullFace):null,depthTest:{func:kw(e,this._convertDepthTestFunction(i.customDepthTest))},depthWrite:(n||s)&&i.writeDepth?Xc:null,colorWrite:ir,stencilWrite:i.hasOccludees?fy:null,stencilTest:i.hasOccludees?r?ww:Uw:null,polygonOffset:n||s?null:w7(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0),this._makePipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};function PRt(t){return t.cullFace!==Ii.None||!t.hasSlicePlane&&!t.transparent&&!t.doubleSidedMode}cce.shader=new jr(RRt,()=>Q(()=>import("./DefaultMaterial.glsl-bd5a5ff4.js"),[]));let tr=class extends Io{constructor(){super(...arguments),this.output=V.Color,this.alphaDiscardMode=gi.Opaque,this.doubleSidedMode=Tn.None,this.pbrMode=_t.Disabled,this.cullFace=Ii.None,this.transparencyPassType=At.NONE,this.normalType=ci.Attribute,this.textureCoordinateType=cs.None,this.customDepthTest=f2.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.objectAndLayerIdColorInstanced=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1}};u([j({count:V.COUNT})],tr.prototype,"output",void 0),u([j({count:gi.COUNT})],tr.prototype,"alphaDiscardMode",void 0),u([j({count:Tn.COUNT})],tr.prototype,"doubleSidedMode",void 0),u([j({count:_t.COUNT})],tr.prototype,"pbrMode",void 0),u([j({count:Ii.COUNT})],tr.prototype,"cullFace",void 0),u([j({count:At.COUNT})],tr.prototype,"transparencyPassType",void 0),u([j({count:ci.COUNT})],tr.prototype,"normalType",void 0),u([j({count:cs.COUNT})],tr.prototype,"textureCoordinateType",void 0),u([j({count:f2.COUNT})],tr.prototype,"customDepthTest",void 0),u([j()],tr.prototype,"spherical",void 0),u([j()],tr.prototype,"hasVertexColors",void 0),u([j()],tr.prototype,"hasSymbolColors",void 0),u([j()],tr.prototype,"hasVerticalOffset",void 0),u([j()],tr.prototype,"hasSlicePlane",void 0),u([j()],tr.prototype,"hasSliceHighlight",void 0),u([j()],tr.prototype,"hasColorTexture",void 0),u([j()],tr.prototype,"hasMetallicRoughnessTexture",void 0),u([j()],tr.prototype,"hasEmissionTexture",void 0),u([j()],tr.prototype,"hasOcclusionTexture",void 0),u([j()],tr.prototype,"hasNormalTexture",void 0),u([j()],tr.prototype,"hasScreenSizePerspective",void 0),u([j()],tr.prototype,"hasVertexTangents",void 0),u([j()],tr.prototype,"hasOccludees",void 0),u([j()],tr.prototype,"hasMultipassTerrain",void 0),u([j()],tr.prototype,"hasModelTransformation",void 0),u([j()],tr.prototype,"offsetBackfaces",void 0),u([j()],tr.prototype,"vvSize",void 0),u([j()],tr.prototype,"vvColor",void 0),u([j()],tr.prototype,"receiveShadows",void 0),u([j()],tr.prototype,"receiveAmbientOcclusion",void 0),u([j()],tr.prototype,"textureAlphaPremultiplied",void 0),u([j()],tr.prototype,"instanced",void 0),u([j()],tr.prototype,"instancedColor",void 0),u([j()],tr.prototype,"objectAndLayerIdColorInstanced",void 0),u([j()],tr.prototype,"instancedDoublePrecision",void 0),u([j()],tr.prototype,"doublePrecisionRequiresObfuscation",void 0),u([j()],tr.prototype,"writeDepth",void 0),u([j()],tr.prototype,"transparent",void 0),u([j()],tr.prototype,"enableOffset",void 0),u([j()],tr.prototype,"cullAboveGround",void 0),u([j()],tr.prototype,"snowCover",void 0),u([j()],tr.prototype,"hasColorTextureTransform",void 0),u([j()],tr.prototype,"hasEmissionTextureTransform",void 0),u([j()],tr.prototype,"hasNormalTextureTransform",void 0),u([j()],tr.prototype,"hasOcclusionTextureTransform",void 0),u([j()],tr.prototype,"hasMetallicRoughnessTextureTransform",void 0),u([j({constValue:!0})],tr.prototype,"hasVvInstancing",void 0),u([j({constValue:!1})],tr.prototype,"useCustomDTRExponentForWater",void 0),u([j({constValue:!1})],tr.prototype,"supportsTextureAtlas",void 0),u([j({constValue:!0})],tr.prototype,"useFillLights",void 0);function IRt(t){const e=new Br,{vertex:r,fragment:i,varyings:n}=e;return Gu(r,t),e.include(BN),n.add("vpos","vec3"),e.include(GR,t),e.include(Rke,t),e.include(l4e,t),t.output!==V.Color&&t.output!==V.Alpha||(mm(e.vertex,t),e.include(eF,t),e.include(zc,t),t.offsetBackfaces&&e.include(Ake),t.instancedColor&&e.attributes.add(O.INSTANCECOLOR,"vec4"),n.add("vNormalWorld","vec3"),n.add("localvpos","vec3"),t.hasMultipassTerrain&&n.add("depth","float"),e.include(Zg,t),e.include(L3,t),e.include(Pke,t),e.include(X2,t),r.uniforms.add(new br("externalColor",s=>s.externalColor)),n.add("vcolorExt","vec4"),r.code.add(S`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${t.instancedColor?"vcolorExt *= instanceColor;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${S.float(Fa)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${t.hasMultipassTerrain?S`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),t.output===V.Alpha&&(e.include(hs,t),e.include(US,t),e.include(od,t),i.uniforms.add([new Ie("opacity",s=>s.opacity),new Ie("layerOpacity",s=>s.layerOpacity)]),t.hasColorTexture&&i.uniforms.add(new Dt("tex",s=>s.texture)),i.include(FD),i.code.add(S`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?S`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${t.hasColorTexture?S`
                vec4 texColor = texture2D(tex, ${t.hasColorTextureTransform?S`colorUV`:S`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:S`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?S`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:S`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        gl_FragColor = vec4(opacity_);
      }
    `)),t.output===V.Color&&(e.include(hs,t),e.include(E2,t),e.include(rF,t),e.include(US,t),e.include(t.instancedDoublePrecision?A7:S2,t),e.include(od,t),mm(e.fragment,t),U_(i),iF(i),H3(i),i.uniforms.add([r.uniforms.get("localOrigin"),r.uniforms.get("view"),new Jt("ambient",s=>s.ambient),new Jt("diffuse",s=>s.diffuse),new Ie("opacity",s=>s.opacity),new Ie("layerOpacity",s=>s.layerOpacity)]),t.hasColorTexture&&i.uniforms.add(new Dt("tex",s=>s.texture)),e.include(Iae,t),e.include(tce,t),i.include(FD),e.extensions.add("GL_OES_standard_derivatives"),vy(i),i.code.add(S`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?S`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${t.hasColorTexture?S`
                vec4 texColor = texture2D(tex, ${t.hasColorTextureTransform?S`colorUV`:S`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:S`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${t.pbrMode===_t.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?S`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:S`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.snowCover?S`albedo = mix(albedo, vec3(1), 0.9);`:S``}
        ${S`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${t.pbrMode===_t.Normal||t.pbrMode===_t.Schematic?t.spherical?S`vec3 normalGround = normalize(vpos + localOrigin);`:S`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:S``}
        ${t.pbrMode===_t.Normal||t.pbrMode===_t.Schematic?S`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?S`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:S`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===At.Color?S`gl_FragColor = premultiplyAlpha(gl_FragColor);`:S``}
      }
    `)),e.include($ke,t),e}const $Rt=Object.freeze(Object.defineProperty({__proto__:null,build:IRt},Symbol.toStringTag,{value:"Module"}));let Nke=class Fke extends cce{initializeConfiguration(e,r){super.initializeConfiguration(e,r),r.hasMetallicRoughnessTexture=!1,r.hasEmissionTexture=!1,r.hasOcclusionTexture=!1,r.hasNormalTexture=!1,r.hasModelTransformation=!1,r.normalType=ci.Attribute,r.doubleSidedMode=Tn.WindingOrder,r.hasVertexTangents=!1}initializeProgram(e){return this._initializeProgram(e,Fke.shader)}};Nke.shader=new jr($Rt,()=>Q(()=>import("./RealisticTree.glsl-1f29f023.js"),[]));let P_=class extends Fw{constructor(e){super(e,NRt),this.supportsEdges=!0,this._configuration=new tr,this._vertexBufferLayout=FRt(this.parameters)}isVisibleForOutput(e){return e!==V.Shadow&&e!==V.ShadowExcludeHighlight&&e!==V.ShadowHighlight||this.parameters.castShadows}isVisible(){const e=this.parameters;if(!super.isVisible()||e.layerOpacity===0)return!1;const{instanced:r,hasVertexColors:i,hasSymbolColors:n,vvColorEnabled:s}=e,o=v(r)&&r.includes("color"),a=e.colorMixMode==="replace",l=e.opacity>0,c=e.externalColor&&e.externalColor[3]>0;return i&&(o||s||n)?!!a||l:i?a?c:l:o||s||n?!!a||l:a?c:l}getConfiguration(e,r){return this._configuration.output=e,this._configuration.hasNormalTexture=!!this.parameters.normalTextureId,this._configuration.hasColorTexture=!!this.parameters.textureId,this._configuration.hasVertexTangents=this.parameters.hasVertexTangents,this._configuration.instanced=!!this.parameters.instanced,this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.hasVerticalOffset=v(this.parameters.verticalOffset),this._configuration.hasScreenSizePerspective=v(this.parameters.screenSizePerspective),this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight,this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode,this._configuration.normalType=this.parameters.normalType,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,v(this.parameters.customDepthTest)&&(this._configuration.customDepthTest=this.parameters.customDepthTest),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.cullFace=this.parameters.hasSlicePlane?Ii.None:this.parameters.cullFace,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.hasModelTransformation=v(this.parameters.modelTransformation),e!==V.Color&&e!==V.Alpha||(this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this._configuration.doubleSidedMode=Tn.WindingOrder:this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Tn.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Tn.WindingOrder:Tn.None,this._configuration.instancedColor=v(this.parameters.instanced)&&this.parameters.instanced.includes("color"),this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=!!r.ssaoHelper.active&&this.parameters.receiveSSAO,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?_t.Schematic:_t.Normal:_t.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<v7,this._configuration.snowCover=this.hasSnowCover(r),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix),this._configuration}hasSnowCover(e){return v(e.weather)&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}intersect(e,r,i,n,s,o){if(v(this.parameters.verticalOffset)){const a=i.camera;he(Xq,r[12],r[13],r[14]);let l=null;switch(i.viewingMode){case qe.Global:l=we(uve,Xq);break;case qe.Local:l=ce(uve,zRt)}let c=0;const h=ge(VRt,Xq,a.eye),p=Pe(h),f=le(h,h,1/p);let m=null;this.parameters.screenSizePerspective&&(m=ve(l,f)),c+=m4e(a,p,this.parameters.verticalOffset,m??0,this.parameters.screenSizePerspective),le(l,l,c),Gl(Wq,l,i.transform.inverseRotation),n=ge(kRt,n,Wq),s=ge(URt,s,Wq)}h4e(e,i,n,s,ete(i.verticalOffset),o)}requiresSlot(e,r){return r===V.Color||r===V.Alpha||r===V.Depth||r===V.Normal||r===V.Shadow||r===V.ShadowHighlight||r===V.ShadowExcludeHighlight||r===V.Highlight||r===V.ObjectAndLayerIdColor?e===(this.parameters.transparent?this.parameters.writeDepth?Ee.TRANSPARENT_MATERIAL:Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:Ee.OPAQUE_MATERIAL)||e===Ee.DRAPED_MATERIAL:!1}createGLMaterial(e){return new LRt(e)}createBufferWriter(){return new G3(this._vertexBufferLayout)}},LRt=class extends Pae{constructor(e){super({...e,...e.material.parameters})}_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:e.shadowMap.enabled})}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==V.Color&&this._output!==V.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e));const r=this._material.parameters;this.updateTexture(r.textureId);const i=e.camera.viewInverseTransposeMatrix;return he(r.origin,i[3],i[7],i[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(r.treeRendering?Nke:cce,e)}},DRt=class extends ORt{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}};const NRt=new DRt;function FRt(t){const e=mn().vec3f(O.POSITION).vec3f(O.NORMAL),r=t.textureId||t.normalTextureId||t.metallicRoughnessTextureId||t.emissiveTextureId||t.occlusionTextureId;return t.hasVertexTangents&&e.vec4f(O.TANGENT),r&&e.vec2f(O.UV0),t.hasVertexColors&&e.vec4u8(O.COLOR),t.hasSymbolColors&&e.vec4u8(O.SYMBOLCOLOR),ue("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(O.OBJECTANDLAYERIDCOLOR),e}const kRt=P(),URt=P(),zRt=ke(0,0,1),uve=P(),Wq=P(),Xq=P(),VRt=P(),BRt=["polygon","extent"];let jRt=class extends Ty{constructor(e,r,i,n){super(e,r,i,n),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const a=x7(this._getSymbolSize());if(a)throw new H("graphics3dextrudesymbollayer:invalid-size",a)}const e=Xs(this.symbolLayer,"material","color"),r=this._getCombinedOpacityAndColor(e),i=$c(r),n=r[3],s=n<1||this.needsDrivenTransparentPass,o={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:i,ambient:i,opacity:n,transparent:s,cullFace:s?Ii.None:Ii.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0};this._material=new P_(o),this._bottomMaterial=new P_({...o,cullFace:Ii.Back}),this._context.stage.add(this._material),this._context.stage.add(this._bottomMaterial)}destroy(){super.destroy(),this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,BRt,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(e.renderingInfo,255),n=this.setGraphicElevationContext(r,new Tm);return this._createAs3DShape(r,e.renderingInfo,i,n,r.uid)}layerOpacityChanged(e,r){const i=Xs(this.symbolLayer,"material","color"),n=this._getCombinedOpacity(i),s=n<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:n,transparent:s}),this._bottomMaterial.setParameters({opacity:n,transparent:s});const o=this._getLayerOpacity();e.forEach(a=>{const l=r(a);v(l)&&l.layerOpacityChanged(o,this._context.isAsync)})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,_w)}slicePlaneEnabledChanged(e,r){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._bottomMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),e.forEach(i=>{const n=r(i);v(n)&&n.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_getExtrusionSize(e){let r;return r=e.size&&this._drivenProperties.size?TCt(e.size,2)??0:this._getSymbolSize(),r/=this._context.renderCoordsHelper.unitInMeters,r}applyRendererDiff(e,r){return this._drivenPropertiesChanged(r)?Ys.Recreate_Symbol:Ys.Recreate_Graphics}async queryForSnapping(e,r,i,n){const s=this._getExtrusionSize(i)*this._context.renderCoordsHelper.unitInMeters/JS(r),{objectId:o,target:a}=e,l=se(a);switch(l.z=(l.z??0)+s,e.type){case"edge":{const{start:c,end:h}=e,p=se(c),f=se(h);return p.z=(p.z??0)+s,f.z=(f.z??0)+s,[P_e(o,l,1/0,p,f)]}case"vertex":return[bCt(o,l,1/0),P_e(o,a,1/0,a,l)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(e,r,i,n,s){const o=LD(e.geometry);if(R(o))return null;if(o.rings.length===0||!o.rings.some(ee=>ee.length>0))return this._logGeometryValidationWarnings(o.rings,"rings","ExtrudeSymbol3DLayer"),null;const a=ace(o,this._context.elevationProvider,this._context.renderCoordsHelper,n);this._logGeometryCreationWarnings(a,o.rings,"rings","ExtrudeSymbol3DLayer");const l=kle(o);if(R(l))return null;const c=new Array,h=Ks(),p=$e(),f=P(),m=this._context.renderCoordsHelper.viewingMode===qe.Global;m||this._context.renderCoordsHelper.worldUpAtPosition(null,f),um(o.spatialReference,[l.x,l.y,0],p,this._context.renderCoordsHelper.spatialReference);const g=$e();ya(g,p);const _=vi();kO(_,g);const{polygons:b,mapPositions:w,position:x}=a,T=x.length/3,E=new Float64Array(3*T*6),C=new Float64Array(3*T*6),A=new Float64Array(3*T*6),I=new Float64Array(1*T*6);let M=0;for(let ee=0;ee<b.length;++ee){const te=b[ee],K=te.count;if(this._context.clippingExtent&&(ki(h),Wh(h,te.mapPositions),!jf(h,this._context.clippingExtent)))continue;const W=vw(te.mapPositions,te.holeIndices,3);if(W.length===0)continue;const N=3*K*2+W.length,L=new Array(N),F=new Array(W.length),G=6*K,q=3*E.BYTES_PER_ELEMENT,Z=new ml(E.buffer,M*q,q,(M+G)*q),X=3*C.BYTES_PER_ELEMENT,oe=new ml(C.buffer,M*X,X,(M+G)*X),pe=new Float64Array(A.buffer,3*M*A.BYTES_PER_ELEMENT,3*G),ye=new Float64Array(I.buffer,1*M*I.BYTES_PER_ELEMENT,1*G),Se=this._getExtrusionSize(r);GRt(x,w,W,te,Z.typedBuffer,pe,oe.typedBuffer,ye,L,F,Se,f,m),KN(Z,Z,g),bw(oe,oe,_),M+=6*K;const He=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:this._context.layer.uid}),Le=new YRt(Z.typedBuffer,pe,oe.typedBuffer,ye);c.push(hve(this._material,L,L.length-F.length,Le,i,He)),c.push(hve(this._bottomMaterial,F,0,Le,i,He))}if(c.length===0)return null;const D=new Z_({geometries:c,metadata:{layerUid:this._context.layer.uid,graphicUid:s,isElevationSource:!0}});D.transformation=p;const U=x5e(this.symbolLayer,{opacity:this._getLayerOpacity()}),z=v(U)?{baseMaterial:this._material,edgeMaterials:[U],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,B=new xy(this,D,c,null,null,WRt,n,z);return B.alignedSampledElevation=a.sampledElevation,B.needsElevationUpdates=_w(n.mode),B}};function hve(t,e,r,i,n,s){const o=new Array(e.length).fill(0),a=[[O.POSITION,new Qe(i.positions,3,!0)],[O.NORMAL,new Qe(i.normals,3,!0)],[O.COLOR,new Qe(n,4,!0)],[O.SIZE,new Qe(i.heights,1,!0)]],l=[[O.POSITION,e],[O.NORMAL,e],[O.COLOR,o]];return new As(t,a,l,i.elevation,Wn.Mesh,s,r)}function GRt(t,e,r,i,n,s,o,a,l,c,h,p,f){const m=r.length/3;let g=0,_=2*i.count;HRt(t,e,i.index,i.count,r,0,m,n,s,o,a,l,c,_,h,p,f);let b=2*i.count;_=0,dve(n,s,a,o,g,i.pathLengths[0],i.count,b,l,_,h),b+=4*i.pathLengths[0],_+=2*i.pathLengths[0],g+=i.pathLengths[0];for(let w=1;w<i.pathLengths.length;++w)dve(n,s,a,o,g,i.pathLengths[w],i.count,b,l,_,h),b+=4*i.pathLengths[w],_+=2*i.pathLengths[w],g+=i.pathLengths[w]}function HRt(t,e,r,i,n,s,o,a,l,c,h,p,f,m,g,_,b){ce(pc,_);const w=g>0?1:-1;let x=3*r,T=0,E=3*T,C=i,A=3*C;for(let D=0;D<i;++D)b&&(pc[0]=t[x+0],pc[1]=t[x+1],pc[2]=t[x+2],we(pc,pc)),a[E+0]=t[x+0],a[E+1]=t[x+1],a[E+2]=t[x+2],l[E+0]=e[x+0],l[E+1]=e[x+1],l[E+2]=e[x+2],c[E+0]=-w*pc[0],c[E+1]=-w*pc[1],c[E+2]=-w*pc[2],h[T]=0,a[A+0]=t[x+0]+g*pc[0],a[A+1]=t[x+1]+g*pc[1],a[A+2]=t[x+2]+g*pc[2],l[A+0]=e[x+0],l[A+1]=e[x+1],l[A+2]=e[x+2],c[A+0]=w*pc[0],c[A+1]=w*pc[1],c[A+2]=w*pc[2],h[C]=g,E+=3,A+=3,x+=3,T+=1,C+=1;x=3*s,E=0,A=3*m;const I=g<0?_ve:yve,M=g<0?yve:_ve;for(let D=0;D<o;++D)f[E+0]=n[x+I[0]],f[E+1]=n[x+I[1]],f[E+2]=n[x+I[2]],p[A+0]=n[x+M[0]]+i,p[A+1]=n[x+M[1]]+i,p[A+2]=n[x+M[2]]+i,E+=3,A+=3,x+=3}function k5(t,e,r,i,n,s,o){i[s]=i[o],o*=3,t[(s*=3)+0]=t[o+0],t[s+1]=t[o+1],t[s+2]=t[o+2],e[s+0]=e[o+0],e[s+1]=e[o+1],e[s+2]=e[o+2],r[s+0]=n[0],r[s+1]=n[1],r[s+2]=n[2]}const HM=P();function dve(t,e,r,i,n,s,o,a,l,c,h){let p=n,f=n+1,m=n+o,g=n+o+1,_=a,b=a+1,w=a+2*s,x=a+2*s+1;h<0&&(p=n+o+1,g=n),c*=3;for(let T=0;T<s;++T)T===s-1&&(h>0?(f=n,g=n+o):(f=n,p=n+o)),qRt(t,p,f,m,HM),k5(t,e,i,r,HM,_,p),k5(t,e,i,r,HM,b,f),k5(t,e,i,r,HM,w,m),k5(t,e,i,r,HM,x,g),l[c++]=_,l[c++]=w,l[c++]=x,l[c++]=_,l[c++]=x,l[c++]=b,p++,f++,m++,g++,_+=2,b+=2,w+=2,x+=2}const Yq=P(),pve=P(),fve=P(),mve=P(),gve=P();function qRt(t,e,r,i,n){e*=3,r*=3,i*=3,he(Yq,t[e++],t[e++],t[e++]),he(pve,t[r++],t[r++],t[r++]),he(fve,t[i++],t[i++],t[i++]),ge(mve,pve,Yq),ge(gve,fve,Yq),vt(n,gve,mve),we(n,n)}const kE=P();function WRt(t,e,r,i,n){const s=t.stageObject,o=s.geometries,a=o.length,l=e.mode!=="absolute-height";let c=0;const h=s.transformation,p=_3($e(),h);for(let f=0;f<a;f+=2){const m=o[f];if(!zle(m))continue;const g=m.getMutableAttribute(O.POSITION).data,_=m.vertexAttributes.get(O.SIZE).data,b=new OFe(m.mapPositions),w=g.length/3;let x=0,T=!1,E=0;for(let C=0;C<w;C++){kE[0]=g[x],kE[1]=g[x+1],kE[2]=g[x+2],i(b,U5),l&&(E+=U5.sampledElevation),Qr.TESTS_DISABLE_OPTIMIZATIONS?(he(ru,b.array[b.offset+0],b.array[b.offset+1],U5.z+_[x/3]),v(r)&&n.toRenderCoords(ru,r,ru),Ke(ru,ru,p)):(he(ru,g[x+0],g[x+1],g[x+2]),Ke(ru,ru,h),n.setAltitude(ru,U5.z+_[x/3]),Ke(ru,ru,p)),g[x]=ru[0],g[x+1]=ru[1],g[x+2]=ru[2];const A=XRt/n.unitInMeters;(Math.abs(kE[0]-g[x])>=A||Math.abs(kE[1]-g[x+1])>=A||Math.abs(kE[2]-g[x+2])>=A)&&(T=!0),b.offset+=3,x+=3}T&&(m.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(o[f]),o[f+1].invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(o[f+1])),c+=E/w}return c/a}const ru=P(),pc=P(),U5=new JN,yve=[0,2,1],_ve=[0,1,2],XRt=.01;let YRt=class{constructor(e,r,i,n){this.positions=e,this.elevation=r,this.normals=i,this.heights=n}};function ZRt(t,e,r,i,n){if(R(t))return null;const s=t.referencesGeometry()&&n?JRt(e,i,n):e,o=t.repurposeFeature(s);try{return t.evaluate({...r,$feature:o})}catch(a){return re.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}}const Zq=new Map;function JRt(t,e,r){const{transform:i,hasZ:n,hasM:s}=r;Zq.has(e)||Zq.set(e,KRt(e));const o=Zq.get(e)(t.geometry,i,n,s);return{...t,geometry:o}}function KRt(t){const e={};switch(t){case"esriGeometryPoint":return(r,i,n,s)=>J4e(i,e,r,n,s);case"esriGeometryPolygon":return(r,i,n,s)=>K4e(i,e,r,n,s);case"esriGeometryPolyline":return(r,i,n,s)=>Q4e(i,e,r,n,s);case"esriGeometryMultipoint":return(r,i,n,s)=>Z4e(i,e,r,n,s);default:return re.getLogger("esri.views.2d.support.arcadeOnDemand").error(new H("mapview-arcade",`Unable to handle geometryType: ${t}`)),r=>r}}const dJt=1.2,QRt=Wg;let O7=class{constructor(e,r,i,n){this.graphics3DSymbolLayer=e,this.renderGeometries=r,this.boundingBox=i,this._drapeSourceRenderer=n,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(e){this.stage=e}setVisibility(e){if(this.stage!=null&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,_n.ADD);if(e||this._addedToStage){for(const r of this.renderGeometries)r.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,oo.VISIBILITY)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,_n.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(e=P()){return he(e,0,0,0)}getBoundingBoxObjectSpace(e=Ks()){return ki(e)}addObjectState(e,r){e===A_.Highlight&&(this.renderGeometries.forEach(i=>{const n=i.geometry.addHighlight();r.addRenderGeometry(i,n,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,oo.HIGHLIGHT))}removeObjectState(e){this.renderGeometries.forEach(r=>{e.removeRenderGeometry(r)})}removeRenderGeometryObjectState(e,r){e.geometry.removeHighlight(r),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,oo.HIGHLIGHT)}computeAttachmentOrigin(e){for(const r of this.renderGeometries)r.geometry.computeAttachmentOrigin(UE)&&(e.draped.origin[0]+=UE[0],e.draped.origin[1]+=UE[1],e.draped.num++)}async getProjectedBoundingBox(e,r,i,n,s){ki(s);for(let o=0;o<this.renderGeometries.length;o++){const a=this.renderGeometries[o];this._getRenderGeometryProjectedBoundingRect(a,e,vve,i),pWe(s,vve)}if(r){let o;Bf(s,UE);const a=Ule(s,r.service.spatialReference,r);try{o=await r.service.queryElevation(UE[0],UE[1],n,a,"ground")}catch{}v(o)&&(s[2]=Math.min(s[2],o),s[5]=Math.max(s[5],o))}return s}_getRenderGeometryProjectedBoundingRect(e,r,i,n){if(this.boundingBox)B9(Dm,this.boundingBox);else{const s=e.boundingSphere,o=s[3];Dm[0]=s[0]-o,Dm[1]=s[1]-o,Dm[2]=s[2]-o,Dm[3]=s[0]+o,Dm[4]=s[1]+o,Dm[5]=s[2]+o}return r(Dm,0,2),this.calculateRelativeScreenBounds&&n.push({location:Bf(Dm),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),Pne(Dm,i)}};const vve=Kt(),Dm=Ks(),UE=P();let kke=class{constructor(e,r,i,n=2048){this.text=e,this._alignment=r,this._parameters=i,this._maxSize=n,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${e}`,this._lines=e.split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._backgroundHorizontalPadding)}get displayHeight(){const e=this._lineSpacing*(this._lines.length-1),r=this._lineHeight;return Math.ceil(e+r+2*this._haloSize+this._backgroundTopPadding+this._backgroundBottomPadding)}get renderedWidth(){return Math.ceil(this._toRenderUnit(this.displayWidth))}get renderedHeight(){return Math.ceil(this._toRenderUnit(this.displayHeight))}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._baselinePosition)}get _firstLineYOffset(){return this._backgroundTopPadding+this._haloSize}get _metrics(){if(R(this._metricsCached)){const e=Rte(bve,z5,z5).getContext("2d");this._setFontProperties(e,this._fontSize);let r=2*this._haloSize;const i=this._parameters.definition.font;i.style!=="italic"&&i.style!=="oblique"&&i.weight!=="bold"&&i.weight!=="bolder"||(r+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let n,s,o=0,a=0,l=0;this._lines.forEach((g,_)=>{const b=e.measureText(g),w=b.width,x=w+r;this._textWidths.push(w),this._lineWidths.push(x),o=Math.max(o,x),a=Math.max(a,b.actualBoundingBoxAscent),l=Math.max(l,b.actualBoundingBoxDescent),_===0&&(n=b),_===this._lines.length-1&&(s=b)});const c=e.font;let h=xve.get(c);if(!h){const g=e.measureText(tOt);h=new iOt(g.actualBoundingBoxAscent,g.actualBoundingBoxDescent),xve.set(c,h)}a=Math.max(a,h.actualBoundingBoxAscent),l=Math.max(l,h.actualBoundingBoxDescent);const p=a+l,f=this._hasBackground?n.actualBoundingBoxAscent:a,m=this._hasBackground?s.actualBoundingBoxDescent:l;this._metricsCached=new rOt(a-f,l-m,p,o,a)}return this._metricsCached}get _lineSpacing(){return(this._lineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _lineHeight(){return this._metrics.lineHeight}get _linePadding(){return this._lineHeight*eOt}get _baselinePosition(){return this._metrics.baselinePosition}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _backgroundHorizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _backgroundVerticalPadding(){return this._hasBackground?this._parameters.definition.background.padding[1]:0}get _backgroundTopPadding(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingTop)}get _backgroundBottomPadding(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingBottom)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(R(this._renderPixelRatio)){const e=this._parameters.definition.pixelRatio;this._maxSize>0?this._renderPixelRatio=Math.min(e,Math.min(this._maxSize/this.displayWidth,this._maxSize/this.displayHeight)):this._renderPixelRatio=e}return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case Bb.Left:return this._backgroundHorizontalPadding;case Bb.Center:return(this.displayWidth-this._lineWidths[e])/2;case Bb.Right:return this.displayWidth-this._backgroundHorizontalPadding-this._lineWidths[e]}}render(e,r=0,i=0){e.save();const n=r/=this.renderPixelRatio,s=i/=this.renderPixelRatio,o=this._haloSize,a=this._firstLineYOffset;r+=o,i+=a+this._baselinePosition;const l=this._haloSize>0;l&&this._renderHalo(e,n,s,o,a),this._setFontProperties(e,this._renderedFontSize);for(let c=0;c<this._lines.length;++c){const h=this._lines[c],p=this._getLineXOffset(c);l&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,h,r+p,i),this._renderLineDecoration(e,r+p,i,this._textWidths[c])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,h,r+this._getLineXOffset(c),i),this._renderLineDecoration(e,r+p,i,this._textWidths[c]),i+=this._lineSpacing}if(Qr.TEXT_SHOW_BASELINE){e.strokeStyle=wve,e.setLineDash([2,2]),e.lineWidth=1;let c=s+a;for(let h=0;h<this._lines.length;++h){const p=c+this._baselinePosition;this._drawLine(e,[n,p],[n+this.displayWidth,p]),c+=this._lineSpacing}}if(Qr.TEXT_SHOW_BORDER&&(e.strokeStyle=wve,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[n,s],[this.displayWidth,this.displayHeight])),this._hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,n,s,c),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,r,i,n,s=!1){if(this._parameters.definition.font.decoration==="none"||n===0)return;const o=1,a=Math.max(this._parameters.definition.size/16,o);switch(this._parameters.definition.font.decoration){case"underline":i+=2*a;break;case"line-through":i-=.33*this._baselinePosition}const l=s?this._haloSize:0;e.strokeStyle=s?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(a+2*l),e.beginPath(),e.moveTo(this._toRenderUnit(r-l),this._toRenderUnit(i)),e.lineTo(this._toRenderUnit(r+n+l),this._toRenderUnit(i)),e.stroke()}_roundedRect(e,r,i,n){r=this._toRenderUnit(r),i=this._toRenderUnit(i);const s=this.renderedWidth,o=this.renderedHeight;n!==0?(n=_e(n,0,Math.floor(o/2)),e.beginPath(),e.moveTo(r,i+n),e.arcTo(r,i,r+n,i,n),e.lineTo(r+s-n,i),e.arcTo(r+s,i,r+s,i+n,n),e.lineTo(r+s,i+o-n),e.arcTo(r+s,i+o,r+s-n,i+o,n),e.lineTo(r+n,i+o),e.arcTo(r,i+o,r,i+o-n,n),e.closePath()):e.rect(r,i,s,o)}_renderHalo(e,r,i,n,s){const o=this.renderedWidth,a=this.renderedHeight,l=Rte(bve,Math.max(o,z5),Math.max(a,z5)),c=l.getContext("2d");c.clearRect(0,0,o,a),this._setFontProperties(c,this._renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const h=this._renderedHaloSize<3;c.lineJoin=h?"miter":"round",h?this._renderHaloEmulated(c,n,s):this._renderHaloNative(c,n,s);let p=s+this._baselinePosition;for(let f=0;f<this._lines.length;++f){const m=this._getLineXOffset(f);this._renderLineDecoration(c,n+m,p,this._textWidths[f],!0),p+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(l,0,0,o,a,this._toRenderUnit(r),this._toRenderUnit(i),o,a),e.globalAlpha=1}_renderHaloEmulated(e,r,i){i+=this._baselinePosition;for(let n=0;n<this._lines.length;++n){const s=this._lines[n],o=this._getLineXOffset(n);for(const[a,l]of Uke)this._fillText(e,s,r+o+this._haloSize*a,i+this._haloSize*l);i+=this._lineSpacing}}_renderHaloNative(e,r,i){const n=2*this._haloSize;i+=this._baselinePosition;for(let s=0;s<this._lines.length;++s){const o=this._lines[s],a=this._getLineXOffset(s),l=5,c=.1;for(let h=0;h<l;h++){const p=1-(l-1)*c+h*c;e.lineWidth=this._toRenderUnit(p*n),this._strokeText(e,o,r+a,i)}i+=this._lineSpacing}}_setFontProperties(e,r){e.font=this._parameters.fontString(r),e.textAlign="left",e.textBaseline="alphabetic"}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,r,i,n){e.fillText(r,this._toRenderUnit(i),this._toRenderUnit(n))}_strokeText(e,r,i,n){e.strokeText(r,this._toRenderUnit(i),this._toRenderUnit(n))}_drawLine(e,r,i){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),e.lineTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),e.stroke()}_drawBox(e,r,i){const n=this._toRenderUnit(r[0]),s=this._toRenderUnit(r[1]),o=this._toRenderUnit(i[0]),a=this._toRenderUnit(i[1]),l=Math.floor(n)+.5,c=Math.ceil(n+o)-.5,h=Math.floor(s)+.5,p=Math.ceil(s+a)-.5;e.beginPath(),e.moveTo(l,h),e.lineTo(c,h),e.lineTo(c,p),e.lineTo(l,p),e.lineTo(l,h),e.stroke()}};const Uke=[];for(let e=0;e<360;e+=360/16)Uke.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);var Bb;function Rte(t,e,r){return t.canvas||(t.canvas=document.createElement("canvas")),t.canvas.width=e,t.canvas.height=r,t.canvas}(function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"})(Bb||(Bb={}));const bve={canvas:null},eOt=.2,z5=512,wve="rgb(255, 0, 255, 0.5)",tOt=(()=>{let t="";for(let e=32;e<127;e++)t+=String.fromCharCode(e);return t})();let rOt=class{constructor(e,r,i,n,s){this.paddingTop=e,this.paddingBottom=r,this.lineHeight=i,this.displayWidth=n,this.baselinePosition=s}},iOt=class{constructor(e,r){this.actualBoundingBoxAscent=e,this.actualBoundingBoxDescent=r}};const xve=new Map,nOt=Object.freeze({left:0,center:.5,right:1}),FU=Object.freeze({"bottom-left":Rr(0,0),bottom:Rr(.5,0),"bottom-right":Rr(1,0),left:Rr(0,.5),center:Rr(.5,.5),right:Rr(1,.5),"top-left":Rr(0,1),top:Rr(.5,1),"top-right":Rr(1,1)});function zke(t){switch(t){case"left":return Bb.Left;case"right":return Bb.Right;default:return Bb.Center}}function Tve(t){switch(t){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function sOt(t){switch(t){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function oOt(t,e){switch(e){case"bottom":return t==="left"?"bottom-left":t==="right"?"bottom-right":"bottom";case"center":return t;case"top":return t==="left"?"top-left":t==="right"?"top-right":"top"}}function aOt(t){return t==="middle"?"center":t}var il,Sve;function qM(t){return t!=null}function zE(t){return typeof t=="number"}function M7(t){return typeof t=="string"}function lOt(t){return t==null||M7(t)}function qs(t,e){t&&t.push(e)}function cOt(t,e,r,i=$e()){const n=t||0,s=e||0,o=r||0;return n!==0&&TO(i,i,-n/180*Math.PI),s!==0&&xO(i,i,s/180*Math.PI),o!==0&&K9(i,i,o/180*Math.PI),i}function Ov(t,e,r,i,n){const s=t.minSize,o=t.maxSize;if(t.expression)return qs(n,"Could not convert size info: expression not supported"),!1;if(t.useSymbolValue){const a=i.symbolSize[r];return e.minSize[r]=a,e.maxSize[r]=a,e.offset[r]=e.minSize[r],e.factor[r]=0,e.type[r]=il.DefinedSize,!0}if(qM(t.field))return qM(t.stops)?t.stops.length===2&&zE(t.stops[0].size)&&zE(t.stops[1].size)?(Eve(t.stops[0].size,t.stops[1].size,t.stops[0].value,t.stops[1].value,e,r),e.type[r]=il.DefinedSize,!0):(qs(n,"Could not convert size info: stops only supported with 2 elements"),!1):zE(s)&&zE(o)&&qM(t.minDataValue)&&qM(t.maxDataValue)?(Eve(s,o,t.minDataValue,t.maxDataValue,e,r),e.type[r]=il.DefinedSize,!0):OO[t.valueUnit]!=null?(e.minSize[r]=-1/0,e.maxSize[r]=1/0,e.offset[r]=0,e.factor[r]=1/OO[t.valueUnit],e.type[r]=il.DefinedSize,!0):t.valueUnit==="unknown"?(qs(n,"Could not convert size info: proportional size not supported"),!1):(qs(n,"Could not convert size info: scale-dependent size not supported"),!1);if(!qM(t.field)){if(t.stops&&t.stops[0]&&zE(t.stops[0].size))return e.minSize[r]=t.stops[0].size,e.maxSize[r]=t.stops[0].size,e.offset[r]=e.minSize[r],e.factor[r]=0,e.type[r]=il.DefinedSize,!0;if(zE(s))return e.minSize[r]=s,e.maxSize[r]=s,e.offset[r]=s,e.factor[r]=0,e.type[r]=il.DefinedSize,!0}return qs(n,"Could not convert size info: unsupported variant of sizeInfo"),!1}function Eve(t,e,r,i,n,s){const o=Math.abs(i-r)>0?(e-t)/(i-r):0;n.minSize[s]=o>0?t:e,n.maxSize[s]=o>0?e:t,n.offset[s]=t-r*o,n.factor[s]=o}function uOt(t,e,r,i){if(t.normalizationField||t.valueRepresentation)return qs(i,"Could not convert size info: unsupported property"),null;if(!lOt(t.field))return qs(i,"Could not convert size info: field is not a string"),null;if(e.size){if(t.field)if(e.size.field){if(t.field!==e.size.field)return qs(i,"Could not convert size info: multiple fields in use"),null}else e.size.field=t.field}else e.size={field:t.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[il.Undefined,il.Undefined,il.Undefined]};let n;switch(t.axis){case"width":return n=Ov(t,e.size,0,r,i),n?e:null;case"height":return n=Ov(t,e.size,2,r,i),n?e:null;case"depth":return n=Ov(t,e.size,1,r,i),n?e:null;case"width-and-depth":return n=Ov(t,e.size,0,r,i),n&&Ov(t,e.size,1,r,i),n?e:null;case null:case void 0:case"all":return n=Ov(t,e.size,0,r,i),n=n&&Ov(t,e.size,1,r,i),n=n&&Ov(t,e.size,2,r,i),n?e:null;default:return qs(i,`Could not convert size info: unknown axis "${t.axis}""`),null}}function hOt(t,e,r){for(let n=0;n<3;++n){let s=e.unitInMeters;t.type[n]===il.DefinedSize&&(s*=e.modelSize[n],t.type[n]=il.DefinedScale),t.minSize[n]=t.minSize[n]/s,t.maxSize[n]=t.maxSize[n]/s,t.offset[n]=t.offset[n]/s,t.factor[n]=t.factor[n]/s}let i;if(t.type[0]!==il.Undefined)i=0;else if(t.type[1]!==il.Undefined)i=1;else{if(t.type[2]===il.Undefined)return qs(r,"No size axis contains a valid size or scale"),!1;i=2}for(let n=0;n<3;++n)t.type[n]===il.Undefined&&(t.minSize[n]=t.minSize[i],t.maxSize[n]=t.maxSize[i],t.offset[n]=t.offset[i],t.factor[n]=t.factor[i],t.type[n]=t.type[i]);return!0}function Cve(t,e,r){t[4*e+0]=r.r/255,t[4*e+1]=r.g/255,t[4*e+2]=r.b/255,t[4*e+3]=r.a}function dOt(t,e,r){if(t.normalizationField)return qs(r,"Could not convert color info: unsupported property"),null;if(M7(t.field)){if(!t.stops)return qs(r,"Could not convert color info: missing stops or colors"),null;{if(t.stops.length>8)return qs(r,"Could not convert color info: too many color stops"),null;e.color={field:t.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};const i=t.stops;for(let n=0;n<8;++n){const s=i[Math.min(n,i.length-1)];e.color.values[n]=s.value,Cve(e.color.colors,n,s.color)}}}else{if(!(t.stops&&t.stops.length>=0))return qs(r,"Could not convert color info: no field and no colors/stops"),null;{const i=t.stops&&t.stops.length>=0&&t.stops[0].color;e.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let n=0;n<8;n++)e.color.values[n]=1/0,Cve(e.color.colors,n,i)}}return e}function pOt(t,e,r){if(t.normalizationField)return qs(r,"Could not convert opacity info: unsupported property"),null;if(M7(t.field)){if(!t.stops)return qs(r,"Could not convert opacity info: missing stops or opacities"),null;{if(t.stops.length>8)return qs(r,"Could not convert opacity info: too many opacity stops"),null;e.opacity={field:t.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};const i=t.stops;for(let n=0;n<8;++n){const s=i[Math.min(n,i.length-1)];e.opacity.values[n]=s.value,e.opacity.opacityValues[n]=s.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return qs(r,"Could not convert opacity info: no field and no opacities/stops"),null;{const i=t.stops&&t.stops.length>=0?t.stops[0].opacity:0;e.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let n=0;n<8;n++)e.opacity.values[n]=1/0,e.opacity.opacityValues[n]=i}}return e}function Jq(t,e,r){const i=r===2&&t.rotationType==="arithmetic";e.offset[r]=i?90:0,e.factor[r]=i?-1:1,e.type[r]=1}function fOt(t,e,r){if(!M7(t.field))return qs(r,"Could not convert rotation info: field is not a string"),null;if(e.rotation){if(t.field)if(e.rotation.field){if(t.field!==e.rotation.field)return qs(r,"Could not convert rotation info: multiple fields in use"),null}else e.rotation.field=t.field}else e.rotation={field:t.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(t.axis){case"tilt":return Jq(t,e.rotation,0),e;case"roll":return Jq(t,e.rotation,1),e;case null:case void 0:case"heading":return Jq(t,e.rotation,2),e;default:return qs(r,`Could not convert rotation info: unknown axis "${t.axis}""`),null}}function Vke(t,e,r){if(!t)return null;const i=!e.supportedTypes||!!e.supportedTypes.size,n=!e.supportedTypes||!!e.supportedTypes.color,s=!e.supportedTypes||!!e.supportedTypes.rotation,o=!!e.supportedTypes&&!!e.supportedTypes.opacity,a=t.reduce((l,c)=>{if(!l)return l;if(c.valueExpression)return qs(r,"Could not convert visual variables: arcade expressions not supported"),null;switch(c.type){case"size":return i?uOt(c,l,e,r):l;case"color":return n?dOt(c,l,r):l;case"opacity":return o?pOt(c,l,r):null;case"rotation":return s?fOt(c,l,r):l;default:return null}},{size:null,color:null,opacity:null,rotation:null});return!(t.length>0&&a)||a.size||a.color||a.opacity||a.rotation?a&&a.size&&!hOt(a.size,e,r)?null:a:null}function uce(t){return t&&t.size!=null}function kD(t,e){if(!t)return{enabled:!1};if(Qr.TESTS_DISABLE_FAST_UPDATES)return{enabled:!1};const r=Vke(t.visualVariables,e);return r?{enabled:!0,visualVariables:r,materialParameters:Bke(r,e),requiresShaderTransformation:uce(r)}:{enabled:!1}}function UD(t,e,r){if(!e||!t.enabled)return!1;const i=t.visualVariables,n=Vke(e.visualVariables,r);return!!n&&!!(V5(i.size,n.size,"size")&&V5(i.color,n.color,"color")&&V5(i.rotation,n.rotation,"rotation")&&V5(i.opacity,n.opacity,"opacity"))&&(t.visualVariables=n,t.materialParameters=Bke(n,r),t.requiresShaderTransformation=uce(n),!0)}function V5(t,e,r){if(!!t!=!!e||t&&t.field!==e.field)return!1;if(t&&r==="rotation"){const i=t,n=e;for(let s=0;s<3;s++)if(i.type[s]!==n.type[s]||i.offset[s]!==n.offset[s]||i.factor[s]!==n.factor[s])return!1}return!0}function Bke(t,e){const r={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},i=uce(t);return t&&t.size?(r.vvSizeEnabled=!0,r.vvSizeMinSize=t.size.minSize,r.vvSizeMaxSize=t.size.maxSize,r.vvSizeOffset=t.size.offset,r.vvSizeFactor=t.size.factor):t&&i&&(r.vvSizeValue=e.transformation.scale),t&&i&&(r.vvSymbolAnchor=e.transformation.anchor,r.vvSymbolRotationMatrix=vi(),Rp(eL),cOt(e.transformation.rotation[2],e.transformation.rotation[0],e.transformation.rotation[1],eL),Op(r.vvSymbolRotationMatrix,eL)),t&&t.color&&(r.vvColorEnabled=!0,r.vvColorValues=t.color.values,r.vvColorColors=t.color.colors),t&&t.opacity&&(r.vvOpacityEnabled=!0,r.vvOpacityValues=t.opacity.values,r.vvOpacityOpacities=t.opacity.opacityValues),r}function Ote(t,e,r){if(!t.vvSizeEnabled)return r;po(Mv,r);const i=t.vvSymbolRotationMatrix;_y(eL,i[0],i[1],i[2],0,i[3],i[4],i[5],0,i[6],i[7],i[8],0,0,0,0,1),Mn(Mv,Mv,eL);for(let n=0;n<3;++n){const s=t.vvSizeOffset[n]+e[0]*t.vvSizeFactor[n];Ave[n]=_e(s,t.vvSizeMinSize[n],t.vvSizeMaxSize[n])}return J9(Mv,Mv,Ave),Hc(Mv,Mv,t.vvSymbolAnchor),Mv}function mOt(t,e,r){if(!e.vvSizeEnabled)return he(t,1,1,1);for(let i=0;i<3;++i){const n=e.vvSizeOffset[i]+r[0]*e.vvSizeFactor[i];t[i]=_e(n,e.vvSizeMinSize[i],e.vvSizeMaxSize[i])}return t}(function(t){t[t.Undefined=0]="Undefined",t[t.DefinedSize=1]="DefinedSize",t[t.DefinedScale=2]="DefinedScale"})(il||(il={})),function(t){t[t.Undefined=0]="Undefined",t[t.DefinedAngle=1]="DefinedAngle"}(Sve||(Sve={}));const Mv=$e(),Ave=P(),eL=$e();let QO=class{constructor(e,r={}){this.geometry=e,this.boundingSphere=pr(),this.screenToWorldRatio=1,this._transformation=$e(),this._shaderTransformationDirty=!0,this.id=Vu(),this.layerUid=r.layerUid,this.graphicUid=r.graphicUid,this.boundingInfo=r.boundingInfo,this.shaderTransformer=r.shaderTransformer,this.castShadow=!!r.castShadow&&r.castShadow}get transformation(){return this._transformation}updateTransformation(e){e(this._transformation),this._shaderTransformationDirty=!0,this.computeBoundingSphere(this._transformation,this.boundingSphere)}shaderTransformationChanged(){this._shaderTransformationDirty=!0}computeBoundingSphere(e,r,i=p2(e)){R(this.boundingInfo)||(Ke(r,this.boundingInfo.center,e),r[3]=this.boundingInfo.radius*i)}get hasShaderTransformation(){return v(this.shaderTransformer)}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return R(this.shaderTransformer)?this.transformation:(this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=$e()),po(this._shaderTransformation,this.shaderTransformer(this.transformation)),this._shaderTransformationDirty=!1),this._shaderTransformation)}get indices(){return this.geometry.indices}get vertexAttributes(){return this.geometry.vertexAttributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}};const gOt=$e(),Rve=ke(0,0,1),yOt=16,_Ot=1.5,wS=Dle,vOt=[wS/2,wS/2,1-wS/2,1-wS/2],bOt=[RD*wS,RD*wS];let Mte=class jke extends Ty{getCachedSize(){return{size:this._getIconSize()}}constructor(e,r,i,n){super(e,r,i,n),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}async doLoad(e){this._validateOrThrow();const r=this._prepareMaterialParameters(),i=this._getPrimitive();if(v(i))this._prepareResourcesPrimitive(r,i);else{const n=Ctt(this.symbolLayer),s=f3(n);s&&s.mediaType==="application/json"?await this._prepareResourcesCIM(r,JSON.parse(s.data),e):await this._prepareResourcesHref(r,n,e)}}_validateOrThrow(){if(this._drivenProperties.size)return;const e=x7(this._getIconSize());if(e)throw new H("graphics3diconsymbollayer:invalid-size",e)}_getIconSize(){const e=this.symbolLayer,r=Math.round(e.size!=null?da(e.size):yOt);return this._drivenProperties.size?Math.max(r,64):r}_generateTextureCIM(e){const r=this._getGraphicHash(e);let i=r===""?null:this._cimSymbolTextures.get(r);if(!i){const n={scaleFactor:this._cimScaleFactorOrFunction},s=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol3D(this._cimLayers,e,"esriGeometryPoint",n,void 0,void 0);this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",s.anchorPosition);const o={width:s.imageData.width,height:s.imageData.height,powerOfTwoResizeMode:kb.PAD};i=new W2(s.imageData,o),this._cimSymbolTextures.set(r,i),this._context.stage.add(i)}return i}_computeSize(e,r){const i=e.width/e.height;return i>1?[r,Math.round(r/i)]:[Math.round(r*i),r]}_prepareMaterialParameters(){const e={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},r=this.symbol;if(wOt(r)){const{screenLength:i,minWorldLength:n,maxWorldLength:s}=r.verticalOffset;e.verticalOffset={screenLength:da(i),minWorldLength:n||0,maxWorldLength:v(s)?s:1/0}}return this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),e.occlusionTest=!0,e.hasSlicePlane=this._context.slicePlaneEnabled,e}_prepareResourcesPrimitive(e,r){const i=this._getOutlineSize();if(Kq(r)&&i===0)throw new Error("Nothing to render");if(this._outlineSize=i,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,v(this._context.sharedResources.textures)){const s=this._context.sharedResources.textures.fromData(`${r}-icon`,()=>R4e(r));this._texture=s.texture,this._releaseTexture=s,e.textureId=this._texture.id}e.textureIsSignedDistanceField=!0,e.distanceFieldBoundingBox=vOt;const n=this._getIconSize();this._size=[n,n],this._symbolTextureRatio=1/wS,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesHref(e,r,i){this._outlineSize=this._getOutlineSize(),e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,e.textureIsSignedDistanceField=!1;const n=this._getIconSize(),s=n*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;if(v(this._context.sharedResources.textures)){const o=await hm(this._context.sharedResources.textures.fromUrl(r,s,{signal:i}));if(o.ok===!1)throw Mu(o.error),new H("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${r})`);this._releaseTexture=o.value;const a=o.value.texture,l=a.params;this._size=this._computeSize(l,n),e.textureId=a.id}this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesCIM(e,r,i){const n=new d3({data:r});if(!this._context.sharedResources.cimSymbolRasterizer){const h=(await Q(()=>import("./CIMSymbolRasterizer-a254fa46.js"),["assets/CIMSymbolRasterizer-a254fa46.js","assets/cimAnalyzer-c61475d8.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/enums-4b2a86a0.js","assets/alignmentUtils-ae955d28.js","assets/definitions-3ddd14a8.js","assets/number-b10bd8f5.js","assets/Rect-ea14f53a.js","assets/CIMResourceManager-838fa5d5.js","assets/Rasterizer-4d37f68f.js","assets/_commonjsHelpers-2f3e7994.js","assets/rasterizingUtils-4ed124bb.js","assets/imageutils-d17d5606.js"])).CIMSymbolRasterizer;lr(i),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new h(this._context.renderCoordsHelper.spatialReference,!0))}const s=this._context.layer.fields?this._context.layer.fields.map(h=>h.toJSON()):null;let o,a;if(this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(n,s,this._context.renderer&&this._context.renderer.type==="dictionary"?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:i}),this._context.renderer&&this._context.renderer.type==="dictionary"&&this._context.renderer.scaleExpression){const h=this._context.renderer;if(isNaN(h.scaleExpression)){const p=h.scaleExpression,f=await cHe(p,this._context.layer.spatialReference,s);a=(m,g,_)=>{const b=ZRt(f,m,{$view:_},"esriGeometryPoint",g);return b!==null?b:1}}else o=Number(h.scaleExpression)}this._cimScaleFactorOrFunction=o||a||1;const l=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];lr(i);const c=this._context.layer.fieldsIndex;this._cimRequiredFields=l.map(h=>c.get(h).name),this._cimMaterialParametersInfo=e,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||dXe}_getOutlineSize(){let e=0;const r=this.symbolLayer;return v(r.outline)&&r.outline.size!=null?Math.max(da(r.outline.size),0):(e=Kq(this._getPrimitive())?_Ot:0,Math.max(e,0))}_getOutlineColor(){const e=this._getLayerOpacity(),r=this.symbolLayer,i=Xs(r,"outline","color");if(v(i)){const n=Xe.toUnitRGB(i),s=i.a*e;return[n[0],n[1],n[2],s]}return[0,0,0,0]}_getFillColor(){if(Kq(this._getPrimitive()))return QRt;const e=R(this._getPrimitive()),r=Xs(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(r,{hasIntrinsicColor:e})}_getAnchorPos(e,r){return e==="relative"?Rr((r.x||0)+.5,.5-(r.y||0)):e in FU?FU[e]:FU.center}_createMaterialAndAddToStage(e,r){if(this._cimLayers?this._fastUpdates={enabled:!1}:this._fastUpdates=kD(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled&&Object.assign(e,this._fastUpdates.materialParameters),this._cimLayers){let i=v(e.textureId)?this._cimSymbolMaterials.get(e.textureId):null;return i||(i=new JO(e),this._cimSymbolMaterials.set(Nt(e.textureId,0),i),r.add(i)),i}return this._material=new JO(e),r.add(this._material),this._material}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(e=>{e.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._material=null,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(e=>this._context.stage.remove(e)),this._cimSymbolTextures.clear(),this._releaseTexture=en(this._releaseTexture)}_getScaleFactor(e,r){if(this._drivenProperties.size&&e.size){for(let i=0;i<3;i++){const n=e.size[i];n&&n!=="symbol-value"&&n!=="proportional"&&(e.size[i]=da(n))}if(e.size[0]==="symbol-value")return 1;if(isFinite(+e.size[0]))return+e.size[0]/r;if(isFinite(+e.size[2]))return+e.size[2]/r}return 1}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry))return null;let i,n=[0,0];if(this._cimLayers){if(!this._cimLayers.length)return null;const p=this._generateTextureCIM(r),f={textureId:p.id,...this._cimMaterialParametersInfo};i=this._createMaterialAndAddToStage(f,this._context.stage),n=[p.params.width,p.params.height]}else n=this._size,i=this._material;const s=$D(r.geometry);if(R(s))return this.logger.warn(`unsupported geometry type for icon symbol: ${r.geometry.type}`),null;const o=e.renderingInfo,a=this._getVertexOpacityAndColor(o);let l=1;if(!this._fastUpdates.enabled||!this._fastUpdates.visualVariables.size){const p=n[0]>n[1]?n[0]:n[1];l=this._getScaleFactor(o,p)}l*=this._symbolTextureRatio;const c=Rr(n[0]*l,n[1]*l),h=this.setGraphicElevationContext(r,new Tm);return this.ensureDrapedStatus(h.mode==="on-the-ground")&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(r,s,i,a,c,e.layer.uid):this._createAs3DShape(r,s,i,a,c,h,r.uid)}layerOpacityChanged(){const e=this._getFillColor(),r=this._getOutlineColor();this._forEachMaterial(i=>{i.setParameters({color:e}),i.setParameters({outlineColor:r})})}layerElevationInfoChanged(e,r,i){const n=this._elevationContext.mode,s=ZN(jke.elevationModeChangeTypes,i,n);if(s!==Pn.UPDATE)return s;const o=$p(n)||n==="absolute-height";return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(e=>{e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!!this._getPrimitive()}skipHighSymbolLodsChanged(){return!0}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables"||!UD(this._fastUpdates,r,this._fastVisualVariableConvertOptions()))return Ys.Recreate_Symbol;v(this._material)&&this._material.setParameters(this._fastUpdates.materialParameters)}return Ys.Fast_Update}_defaultElevationInfoNoZ(){return xOt}_createAs3DShape(e,r,i,n,s,o,a){const l=this.getFastUpdateAttrValues(e),c=l?_=>Ote(this._fastUpdates.materialParameters,l,_):void 0,h=this._context.layer.uid,p=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:h}),f=Yee(i,Rve,null,n,s,TOt,null,l,p),m=qle(this._context,r,f,o,a,c);if(R(m))return null;const g=new xy(this,m.object,[f],null,null,PD,o);return g.alignedSampledElevation=m.sampledElevation,g.needsElevationUpdates=$p(o.mode)||o.mode==="absolute-height",g.getScreenSize=this._createScreenSizeGetter(s,c),g.calculateRelativeScreenBounds=_=>i.calculateRelativeScreenBounds(g.getScreenSize(),1,_),ID(g,r,this._context.elevationProvider),g}_createAsOverlay(e,r,i,n,s,o){i.renderPriority=this._renderPriority;const a=pr();Ba(r,a,this._context.overlaySR),a[2]=oce;const l=this._context.clippingExtent;if(v(l)&&!Mne(l,a))return null;const c=this.getFastUpdateAttrValues(e),h=c?_=>Ote(this._fastUpdates.materialParameters,c,_):void 0,p=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:e.uid,layerUid:this._context.layer.uid}),f=Yee(i,Rve,a,n,s,null,null,c,p),m=new QO(f,{layerUid:o,graphicUid:e.uid,shaderTransformer:h});a[3]=0,Vf(m.boundingSphere,a);const g=new O7(this,[m],null,this._context.drapeSourceRenderer);return g.getScreenSize=this._createScreenSizeGetter(s,h),g.calculateRelativeScreenBounds=_=>i.calculateRelativeScreenBounds(g.getScreenSize(),1,_),g}_createScreenSizeGetter(e,r){const i=this._outlineSize+2;if(this._fastUpdates.enabled){const n=e[0]/this._symbolTextureRatio,s=e[1]/this._symbolTextureRatio;return(o=Ne())=>{const a=r(gOt);return o[0]=a[0]*n+i,o[1]=a[5]*s+i,o}}{const n=e[0]/this._symbolTextureRatio+i,s=e[1]/this._symbolTextureRatio+i;return(o=Ne())=>(o[0]=n,o[1]=s,o)}}_fastVisualVariableConvertOptions(){const e=this._size[0]>this._size[1]?this._size[0]:this._size[1],r=ke(e,e,e),i=Cp(1),n=e*i;return{modelSize:r,symbolSize:ke(n,n,n),unitInMeters:i,transformation:{anchor:cl,scale:Lg,rotation:cl}}}_getGraphicHash(e){let r="";for(const i of this._cimRequiredFields)r+=i+e.attributes[i];return r}_forEachMaterial(e){v(this._material)&&e(this._material),this._cimSymbolMaterials.forEach(e)}test(){return{...super.test(),material:this._material}}};function wOt(t){return t&&t.type==="point-3d"&&t.hasVisibleVerticalOffset()}function Kq(t){return!R(t)&&(t==="cross"||t==="x")}Mte.PRIMITIVE_SIZE=bOt,Mte.elevationModeChangeTypes={definedChanged:Pn.UPDATE,staysOnTheGround:Pn.NONE,onTheGroundChanged:Pn.RECREATE};const xOt={mode:"relative-to-ground",offset:0},TOt=Zt(0,0,0,1);function Pte(t){switch(t){case"butt":return bp.BUTT;case"square":return bp.SQUARE;case"round":return bp.ROUND;default:return null}}function SOt(t){return t==="diamond"?"kite":t}function Ite(t,e,r=null){const i=[],n=[],s=e.mapPositions;EOt(e,n,i);const o=n[0][1].data,a=i[0][1].length,l=new Array(a).fill(0);return COt(e,n,i,l),OOt(e,n,i,l),AOt(e,n,i,l),ROt(e,n,i,l),MOt(e,n,i,l),POt(e,n,i,l),IOt(e,n,i,o),new As(t,n,i,s,Wn.Line,r)}function EOt(t,e,r){const{attributeData:{position:i},removeDuplicateStartEnd:n}=t,s=$Ot(i)&&n,o=i.length/3-(s?1:0),a=new Array(2*(o-1)),l=s?i.slice(0,i.length-3):i;let c=0;for(let h=0;h<o-1;h++)a[c++]=h,a[c++]=h+1;e.push([O.POSITION,new Qe(l,3,s)]),r.push([O.POSITION,a])}function COt(t,e,r,i){if(v(t.attributeData.colorFeature))return;const n=t.attributeData.color;e.push([O.COLOR,new Qe(Nt(n,op),4)]),r.push([O.COLOR,i])}function AOt(t,e,r,i){if(!v(t.attributeData.normal))return;const n=t.attributeData.normal;e.push([O.NORMAL,new Qe(n,3)]),r.push([O.NORMAL,i])}function ROt(t,e,r,i){const n=t.attributeData.colorFeature;R(n)||(e.push([O.COLORFEATUREATTRIBUTE,new Qe([n],1,!0)]),r.push([O.COLOR,i]))}function OOt(t,e,r,i){if(v(t.attributeData.sizeFeature))return;const n=t.attributeData.size;e.push([O.SIZE,new Qe([Nt(n,1)],1,!0)]),r.push([O.SIZE,i])}function MOt(t,e,r,i){const n=t.attributeData.sizeFeature;R(n)||(e.push([O.SIZEFEATUREATTRIBUTE,new Qe([n],1,!0)]),r.push([O.SIZEFEATUREATTRIBUTE,i]))}function POt(t,e,r,i){const n=t.attributeData.opacityFeature;R(n)||(e.push([O.OPACITYFEATUREATTRIBUTE,new Qe([n],1,!0)]),r.push([O.OPACITYFEATUREATTRIBUTE,i]))}function IOt(t,e,r,i){if(R(t.overlayInfo)||t.overlayInfo.renderCoordsHelper.viewingMode!==qe.Global||!t.overlayInfo.spatialReference.isGeographic)return;const n=Zu(i.length),s=ii(t.overlayInfo.spatialReference);for(let f=0;f<n.length;f+=3)sse(i,f,n,f,s);const o=i.length/3,a=us(o+1);let l=LOt,c=DOt,h=0,p=0;he(l,n[p++],n[p++],n[p++]),a[0]=0;for(let f=1;f<o+1;++f)f===o&&(p=0),he(c,n[p++],n[p++],n[p++]),h+=$Ie(l,c),a[f]=h,[l,c]=[c,l];e.push([O.DISTANCETOSTART,new Qe(a,1,!0)]),r.push([O.DISTANCETOSTART,r[0][1]])}function $Ot(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}const LOt=P(),DOt=P();function _Jt(t,e){if(R(t)||t.length===0)return[];const r=[];return t.forEach(i=>{const n=i.length,s=Zu(3*n);i.forEach((a,l)=>{s[3*l+0]=a[0],s[3*l+1]=a[1],s[3*l+2]=a[2]});const o={attributeData:{position:s,normal:e},removeDuplicateStartEnd:!1};r.push(o)}),r}function NOt(t,e,r,i){const n=t.type==="polygon"?py.CCW_IS_HOLE:py.NONE,s=t.type==="polygon"?t.rings:t.paths,{position:o,outlines:a}=QN(s,!!t.hasZ,n),l=Zu(o.length),c=l5e(o,t.spatialReference,0,l,0,o,0,o.length/3,e,r,i),h=c!=null;return{lines:h?Gke(a,o,l):[],projectionSuccess:h,sampledElevation:c}}function FOt(t,e){const r=t.type==="polygon"?py.CCW_IS_HOLE:py.NONE,i=t.type==="polygon"?t.rings:t.paths,{position:n,outlines:s}=QN(i,!1,r),o=$n(n,t.spatialReference,0,n,e,0,n.length/3);for(let a=2;a<n.length;a+=3)n[a]=oce;return{lines:o?Gke(s,n):[],projectionSuccess:o}}function Gke(t,e,r=null){const i=new Array;for(const{index:n,count:s}of t){if(s<=1)continue;const o=3*n,a=3*s;i.push({position:_p(e,3*n,3*s),mapPositions:v(r)?_p(r,o,a):void 0})}return i}function kOt(t){const e=new Br,r=t.hasMultipassTerrain&&(t.output===V.Color||t.output===V.Alpha),i=t.space===vp.World;t.hasTip&&i&&e.extensions.add("GL_OES_standard_derivatives"),e.include(F5e,t),e.include(G5e,t),t.output===V.Depth&&e.include(M_,t);const{vertex:n,fragment:s}=e;return s.include(Qu),Gu(n,t),e.attributes.add(O.POSITION,"vec3"),e.attributes.add(O.UV0,"vec2"),e.attributes.add(O.AUXPOS1,"vec3"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),e.varyings.add("vUV","vec2"),e.varyings.add("vSize","float"),pw(e),r&&e.varyings.add("depth","float"),t.hasTip&&e.varyings.add("vLineWidth","float"),n.uniforms.add([new Hr("nearFar",(o,a)=>a.camera.nearFar),new br("viewport",(o,a)=>a.camera.fullViewport)]),n.code.add(S`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),n.code.add(S`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`),i?(e.attributes.add(O.NORMAL,"vec3"),YO(n),n.constants.add("tiltThreshold","float",.7),n.code.add(S`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):n.code.add(S`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`),n.code.add(S`
      #define vecN ${i?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${i?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${t.anchor===T2.Tip?"pos -= 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `),t.space===vp.Screen&&(n.uniforms.add(new rn("inverseProjectionMatrix",(o,a)=>a.camera.inverseProjectionMatrix)),n.code.add(S`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),n.code.add(S`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),n.uniforms.add(new Ie("perScreenPixelRatio",(o,a)=>a.camera.perScreenPixelRatio)),n.code.add(S`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${t.hasCap?`
                if(prev.z > posLeft.z) {
                  vec2 diff = posLeft.xy - posRight.xy;
                  planeOrigin.xy += perpendicular(diff) / 2.0;
                }
              `:""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),n.uniforms.add(new Ie("pixelRatio",(o,a)=>a.camera.pixelRatio)),YB(e),n.code.add(S`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position.xyz, 1.0);
vec4 prev = view * vec4(auxpos1.xyz, 1.0);
clip(pos, prev);`),i?(t.hideOnShortSegments&&n.code.add(S`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),n.code.add(S`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(n.code.add(S`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),t.space===vp.Screen&&n.code.add(S`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`)),n.code.add(S`
        ${r?"depth = pos.z;":""}
        linearDepth = calculateLinearDepth(nearFar,pos.z);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${i?"":"vUV *= displacedPosScreen.w;"}

        ${t.hasTip?"vLineWidth = lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),r&&e.include(od,t),e.include(hs,t),s.uniforms.add([new br("intrinsicColor",o=>o.color),new Dt("tex",o=>o.texture)]),s.include(by),e.constants.add("texelSize","float",1/DD),s.code.add(S`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture2D(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`),t.hasTip&&(e.constants.add("relativeMarkerSize","float",Zle/DD),e.constants.add("relativeTipLineWidth","float",eAt),s.code.add(S`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${i?"halfTipLineWidth *= fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `)),e.constants.add("symbolAlphaCutoff","float",Fa),s.code.add(S`
  void main() {
    discardBySlice(vpos);
    ${r?"terrainDepthTest(gl_FragCoord, depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${i?"vec2 samplePos = vUV;":"vec2 samplePos = vUV * gl_FragCoord.w;"}

    ${t.hasTip?"finalColor.a *= max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *= markerAlpha(samplePos);"}

    ${t.output===V.ObjectAndLayerIdColor?S`finalColor.a = 1.0;`:""}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${t.output===V.Alpha?S`gl_FragColor = vec4(finalColor.a);`:""}
    ${t.output===V.Color?S`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===V.Color&&t.transparencyPassType===At.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${t.output===V.Highlight?S`gl_FragColor = vec4(1.0);`:""}
    ${t.output===V.Depth?S`outputDepth(linearDepth);`:""}
  }
  `),e}const UOt=Object.freeze(Object.defineProperty({__proto__:null,build:kOt},Symbol.toStringTag,{value:"Module"})),Hke=new Map([[O.POSITION,0],[O.UV0,2],[O.AUXPOS1,3],[O.NORMAL,4],[O.COLOR,5],[O.COLORFEATUREATTRIBUTE,5],[O.SIZE,6],[O.SIZEFEATUREATTRIBUTE,6],[O.OPACITYFEATUREATTRIBUTE,7]]);let qke=class Wke extends Wr{initializeProgram(e){return new Gr(e.rctx,Wke.shader.get().build(this.configuration),Hke)}_makePipelineState(e,r){const i=this.configuration,n=e===At.NONE;return Ht({blending:i.output===V.Color||i.output===V.Alpha?n?Qh:X_(e):null,depthTest:{func:kw(e)},depthWrite:n?i.writeDepth?Xc:null:_7(e),colorWrite:ir,stencilWrite:i.hasOccludees?fy:null,stencilTest:i.hasOccludees?r?ww:Uw:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=Ht({blending:Qh,depthTest:LV,depthWrite:null,colorWrite:ir,stencilWrite:null,stencilTest:W5e}),this._occluderPipelineOpaque=Ht({blending:Qh,depthTest:LV,depthWrite:null,colorWrite:ir,stencilWrite:H5e,stencilTest:q5e}),this._occluderPipelineMaskWrite=Ht({blending:null,depthTest:Jle,depthWrite:null,colorWrite:null,stencilWrite:fy,stencilTest:ww})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:this.configuration.occluder?e===Ee.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===Ee.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,r)}};qke.shader=new jr(UOt,()=>Q(()=>import("./LineMarker.glsl-9ea9210f.js"),[]));let zOt=class extends Fw{constructor(e){super(e,new BOt),this._vertexAttributeLocations=Hke,this._configuration=new Qo,this._layout=this.createLayout()}dispose(){}getConfiguration(e,r){return this._configuration.output=e,this._configuration.space=r.slot===Ee.DRAPED_MATERIAL?vp.Draped:this.parameters.worldSpace?vp.World:vp.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==bp.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.occluder=this.parameters.renderOccluded===vn.OccludeAndTransparentStencil,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}intersect(){}createLayout(){const e=mn().vec3f(O.POSITION).vec2f(O.UV0).vec3f(O.AUXPOS1);return this.parameters.worldSpace&&e.vec3f(O.NORMAL),this.parameters.vvSizeEnabled?e.f32(O.SIZEFEATUREATTRIBUTE):e.f32(O.SIZE),this.parameters.vvColorEnabled?e.f32(O.COLORFEATUREATTRIBUTE):e.vec4f(O.COLOR),this.parameters.vvOpacityEnabled&&e.f32(O.OPACITYFEATUREATTRIBUTE),e}createBufferWriter(){return new jOt(this._layout,this.parameters)}requiresSlot(e,r){return r===V.Color||r===V.Alpha||r===V.Highlight||r===V.Depth?e===Ee.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===vn.OccludeAndTransparentStencil?e===Ee.OPAQUE_MATERIAL||e===Ee.OCCLUDER_MATERIAL||e===Ee.TRANSPARENT_OCCLUDER_MATERIAL:r===V.Color||r===V.Alpha?e===(this.parameters.writeDepth?Ee.TRANSPARENT_MATERIAL:Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===Ee.OPAQUE_MATERIAL:!1}createGLMaterial(e){return new VOt(e)}},VOt=class extends Pae{_updateParameters(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(qke,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==V.Color&&this._output!==V.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},BOt=class extends Nle{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.placement="end",this.cap=bp.BUTT,this.anchor=T2.Center,this.hasTip=!1,this.worldSpace=!1,this.hideOnShortSegments=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1}},jOt=class{constructor(e,r){this.vertexBufferLayout=e,this._parameters=r}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(){return this._parameters.placement==="begin-end"?12:6}write(e,r,i,n,s){const o=i.vertexAttributes.get(O.POSITION).data,a=o.length/3;let l=[1,0,0];const c=i.vertexAttributes.get(O.NORMAL);this._parameters.worldSpace&&v(c)&&(l=c.data);let h=1,p=0;this._parameters.vvSizeEnabled?p=i.vertexAttributes.get(O.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(O.SIZE)&&(h=i.vertexAttributes.get(O.SIZE).data[0]);let f=[1,1,1,1],m=0;this._parameters.vvColorEnabled?m=i.vertexAttributes.get(O.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(O.COLOR)&&(f=i.vertexAttributes.get(O.COLOR).data);let g=0;this._parameters.vvOpacityEnabled&&(g=i.vertexAttributes.get(O.OPACITYFEATUREATTRIBUTE).data[0]);const _=new Float32Array(n.buffer);let b=s*(this.vertexBufferLayout.stride/4);const w=(C,A,I,M)=>{if(_[b++]=C[0],_[b++]=C[1],_[b++]=C[2],_[b++]=I[0],_[b++]=I[1],_[b++]=A[0],_[b++]=A[1],_[b++]=A[2],this._parameters.worldSpace&&(_[b++]=l[0],_[b++]=l[1],_[b++]=l[2]),this._parameters.vvSizeEnabled?_[b++]=p:_[b++]=h,this._parameters.vvColorEnabled)_[b++]=m;else{const D=Math.min(4*M,f.length-4);_[b++]=f[D+0],_[b++]=f[D+1],_[b++]=f[D+2],_[b++]=f[D+3]}this._parameters.vvOpacityEnabled&&(_[b++]=g)};let x;(function(C){C[C.ASCENDING=1]="ASCENDING",C[C.DESCENDING=-1]="DESCENDING"})(x||(x={}));const T=(C,A)=>{const I=he(GOt,o[3*C],o[3*C+1],o[3*C+2]),M=HOt;let D=C+A;do he(M,o[3*D],o[3*D+1],o[3*D+2]),D+=A;while(Xb(I,M)&&D>=0&&D<a);e&&(Ke(I,I,e),Ke(M,M,e)),w(I,M,[-1,-1],C),w(I,M,[1,-1],C),w(I,M,[1,1],C),w(I,M,[-1,-1],C),w(I,M,[1,1],C),w(I,M,[-1,1],C)},E=this._parameters.placement;E!=="begin"&&E!=="begin-end"||T(0,x.ASCENDING),E!=="end"&&E!=="begin-end"||T(a-1,x.DESCENDING)}};const GOt=P(),HOt=P(),Za={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},qOt={dash:Za.dash,"dash-dot":[...Za.dash,...Za.dot],dot:Za.dot,"long-dash":Za["long-dash"],"long-dash-dot":[...Za["long-dash"],...Za.dot],"long-dash-dot-dot":[...Za["long-dash"],...Za.dot,...Za.dot],none:null,"short-dash":Za["short-dash"],"short-dash-dot":[...Za["short-dash"],...Za["short-dot"]],"short-dash-dot-dot":[...Za["short-dash"],...Za["short-dot"],...Za["short-dot"]],"short-dot":Za["short-dot"],solid:null},WOt=8;function XOt(t,e=2){return R(t)?t:{pattern:t.slice(),pixelRatio:e}}function TJt(t,e=2){return{pattern:[t,t],pixelRatio:e}}function Xke(t){return v(t)&&t.type==="style"?YOt(t.style):null}function YOt(t){return v(t)?XOt(qOt[t],WOt):null}const ZOt=["polyline","polygon","extent"];let Yke=class Zke extends Ty{constructor(e,r,i,n){super(e,r,i,n)}async doLoad(){if(this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=kD(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1},!this._drivenProperties.size&&(this.symbolLayer.size!=null?this.symbolLayer.size:Cp(1))<0)throw new H("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._markerTexture=v(this.symbolLayer.marker)&&v(this._context.sharedResources.textures)?tAt(this._context.sharedResources.textures,SOt(this.symbolLayer.marker.style)):null}_getMaterialParameters(e,r=!1){var s;const i=this._getCombinedOpacityAndColor(r&&this._markerColor||this._materialColor);this._patternHidesLine&&!r&&(i[3]=0);const n={width:this._computeMaterialWidth((s=this.symbolLayer)==null?void 0:s.size),color:i,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:Pte(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:e,stipplePattern:Xke(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};return this._fastUpdates&&this._fastUpdates.visualVariables?{...n,...this._fastUpdates.materialParameters}:n}get _materialColor(){return Fo(this.symbolLayer.material,e=>e.color)}get _markerColor(){return Fo(this.symbolLayer.marker,e=>e.color)}get _lineMaterial(){return R(this._lineMaterialCached)&&(this._lineMaterialCached=new lR(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterialCached)),this._lineMaterialCached}get _ringMaterial(){return R(this._ringMaterialCached)&&(this._ringMaterialCached=new lR(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterialCached)),this._ringMaterialCached}get _wireframeLineMaterial(){return R(this._wireframeLineMaterialCached)&&(this._wireframeLineMaterialCached=new lR({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._wireframeLineMaterialCached)),this._wireframeLineMaterialCached}get _wireframeRingMaterial(){return R(this._wireframeRingMaterialCached)&&(this._wireframeRingMaterialCached=new lR({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._wireframeRingMaterialCached)),this._wireframeRingMaterialCached}get _markerMaterial(){return R(this._markerMaterialCached)&&v(this.symbolLayer.marker)&&v(this._markerTexture)&&(this._markerMaterialCached=new zOt({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,textureId:this._markerTexture.texture.id}),this._context.stage.add(this._markerMaterialCached)),this._markerMaterialCached}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._lineMaterialCached=null,this._ringMaterialCached=null,this._wireframeLineMaterialCached=null,this._wireframeRingMaterialCached=null,this._markerMaterialCached=null,this._markerTexture=en(this._markerTexture)}_getDrivenSize(e){return this._drivenProperties.size&&e.size?da(SCt(e.size)):1}_getSizeFeatureAttributeData(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?a_(this._fastUpdates.visualVariables.size.field,e):null}_getDrivenColor(e){const r=Zt(1,1,1,1);return this._drivenProperties.color&&e.color&&(r[0]=e.color[0],r[1]=e.color[1],r[2]=e.color[2],e.color.length>0&&(r[3]=e.color[3])),this._drivenProperties.opacity&&e.opacity&&(r[3]=e.opacity),r}_getColorFeatureAttributeData(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?a_(this._fastUpdates.visualVariables.color.field,e):null}_getOpacityFeatureAttributeData(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?a_(this._fastUpdates.visualVariables.opacity.field,e):null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,ZOt,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new Tm);return this.ensureDrapedStatus(i.mode==="on-the-ground"),this.draped?this._createAsOverlay(e,this._context.layer.uid):this._createAs3DShape(e,i,r.uid)}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables"||!UD(this._fastUpdates,r,this._vvConvertOptions))return Ys.Recreate_Symbol;this._forEachMaterial(n=>n.setParameters(this._fastUpdates.materialParameters))}return Ys.Fast_Update}prepareSymbolLayerPatch(e){var s,o;if(e.diff.type!=="partial")return;const r=e.diff.diff,i={};((s=r.size)==null?void 0:s.type)==="complete"&&(i.width=this._computeMaterialWidth(r.size.newValue),delete r.size),((o=r.cap)==null?void 0:o.type)==="complete"&&(i.cap=Pte(Nt(r.cap.newValue,"butt")),delete r.cap);const n=this._prepareMarkerPatch(e,r);this._prepareMaterialPatch(e,r,n),e.symbolLayerStatePatches.push(()=>this._forEachMaterial(a=>a.setParameters(i)))}layerOpacityChanged(){this._forEachMaterial((e,r)=>this._updateMaterialLayerOpacity(e,r))}_forEachMaterial(e){v(this._lineMaterialCached)&&e(this._lineMaterialCached),v(this._ringMaterialCached)&&e(this._ringMaterialCached),v(this._wireframeLineMaterialCached)&&e(this._wireframeLineMaterialCached),v(this._wireframeRingMaterialCached)&&e(this._wireframeRingMaterialCached),v(this._markerMaterialCached)&&e(this._markerMaterialCached,!0)}_updateMaterialLayerOpacity(e,r=!1){const i=e.parameters.color,n=Xs(this.symbolLayer,"material","color"),s=this._patternHidesLine&&!r?0:this._getCombinedOpacity(n),o=Zt(i[0],i[1],i[2],s);e.setParameters({color:o})}layerElevationInfoChanged(e,r,i){const n=this._elevationContext.mode,s=ZN(Zke.elevationModeChangeTypes,i,n);if(s!==Pn.UPDATE)return s;const o=$p(n);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){const e={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(r=>r.setParameters(e)),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_getGeometryAsPolygonOrPolyline(e){switch(e.type){case"extent":if(e instanceof ur)return Jl.fromExtent(e);break;case"polygon":case"polyline":return e}return null}_createAs3DShape(e,r,i){const n=e.graphic,s=this._getGeometryAsPolygonOrPolyline(n.geometry),o=s.type==="polygon"?s.rings:s.paths,a=new Array,l=Ks(),c=NOt(s,this._context.elevationProvider,this._context.renderCoordsHelper,r),h=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(c,o,h,"LineSymbol3DLayer");for(let m=0;m<c.lines.length;m++){const g=c.lines[m],_=g.position,b=g.mapPositions;if(v(this._context.clippingExtent)&&(ki(l),Wh(l,b),!jf(l,this._context.clippingExtent)))continue;const w=this._createGeometry(s.type==="polygon"?this._ringMaterial:this._lineMaterial,e,_,b,s.type,tL.ELEVATED,i);a.push(w),Qr.LINE_WIREFRAMES&&a.push(w.instantiate({material:s.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial})),v(this._markerMaterial)&&a.push(w.instantiate({material:this._markerMaterial}))}if(a.length===0)return null;const p=new Z_({geometries:a,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:i}}),f=new xy(this,p,a,null,null,LEt,r);return f.alignedSampledElevation=c.sampledElevation,f.needsElevationUpdates=$p(r.mode),f}_createGeometry(e,r,i,n,s,o,a){const l=s==="polygon",c=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color,h=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size,p=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:this._context.layer.uid});return Ite(e,{overlayInfo:o===tL.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,removeDuplicateStartEnd:l,mapPositions:n,attributeData:{position:i,size:h?null:this._getDrivenSize(r.renderingInfo),color:c?null:this._getDrivenColor(r.renderingInfo),sizeFeature:this._getSizeFeatureAttributeData(r.graphic),colorFeature:this._getColorFeatureAttributeData(r.graphic),opacityFeature:this._getOpacityFeatureAttributeData(r.graphic)}},p)}_createAsOverlay(e,r){const i=e.graphic,n=this._getGeometryAsPolygonOrPolyline(i.geometry),s=n.type==="polygon"?n.rings:n.paths,o=n.type==="polygon"?this._ringMaterial:this._lineMaterial;o.renderPriority=this._renderPriority;const a=Qr.LINE_WIREFRAMES?n.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial:null,l=this._markerMaterial;v(a)&&(a.renderPriority=this._renderPriority-.001),v(l)&&(l.renderPriority=this._renderPriority-.002);const c=new Array,h=Ks(),p=ki(),f=FOt(n,this._context.overlaySR),m=n.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(f,s,m,"LineSymbol3DLayer");for(const g of f.lines){if(ki(h),Wh(h,g.position),!jf(h,this._context.clippingExtent))continue;gO(p,h);const _=w=>{const x=this._createGeometry(w,e,g.position,void 0,n.type,tL.DRAPED,i.uid),T=new QO(x,{layerUid:r,graphicUid:i.uid});return c.push(T),T};if(v(l)){const w=_(l),x=this.symbolLayer.marker.placement;x!=="begin"&&x!=="begin-end"||Wh(h,g.position,0,1),x!=="end"&&x!=="begin-end"||Wh(h,g.position,g.position.length-3,1),this._updateBoundingSphere(w,h)}const b=_(o);if(this._updateBoundingSphere(b,h),Qr.LINE_WIREFRAMES){const w=_(a);this._updateBoundingSphere(w,h)}}return new O7(this,c,p,this._context.drapeSourceRenderer)}_updateBoundingSphere(e,r){ai(e.boundingSphere,.5*(r[0]+r[3]),.5*(r[1]+r[4]),0,.5*Math.sqrt((r[3]-r[0])*(r[3]-r[0])+(r[4]-r[1])*(r[4]-r[1])))}get _patternHidesLine(){const e=this.symbolLayer.pattern;return v(e)&&e.type==="style"&&e.style==="none"}_computeMaterialWidth(e){return e=Nt(e,Cp(1)),this._drivenProperties.size?this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?da(1):1:da(e)}_prepareMaterialPatch(e,r,i){var a;const n=r.material;if(R(n))return void(i.changed&&i.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._markerMaterialCached,e));if(n.type==="collection")return;const s=n.type==="complete"?Fo(n.newValue,l=>l.color):((a=n.diff.color)==null?void 0:a.type)==="complete"?n.diff.color.newValue:null,o=this._getCombinedOpacityAndColor(s);i.useMaterialColor&&this._patchMaterialColor(MN(o),this._markerMaterialCached,e),this._patternHidesLine&&(o[3]=0),this._patchMaterialColor(o,this._lineMaterialCached,e),delete r.material}_prepareMarkerPatch(e,r){const i=r.marker;if(R(i)||i.type!=="partial"||v(i.diff.style)||v(i.diff.placement)||v(i.diff.color)&&i.diff.color.type!=="complete")return{changed:!1,useMaterialColor:R(this._markerColor)};const n=i.diff.color;if(R(n))return delete r.marker,{changed:!1,useMaterialColor:R(this._markerColor)};const s=n.newValue;return R(s)?(delete r.marker,{changed:!0,useMaterialColor:!0}):(this._patchMaterialColor(this._getCombinedOpacityAndColor(s),this._markerMaterialCached,e),delete r.marker,{changed:!0,useMaterialColor:!1})}_patchMaterialColor(e,r,i){R(r)||i.symbolLayerStatePatches.push(()=>r.setParameters({color:e}))}};var tL;Yke.elevationModeChangeTypes={definedChanged:Pn.RECREATE,staysOnTheGround:Pn.NONE,onTheGroundChanged:Pn.RECREATE},function(t){t[t.DRAPED=0]="DRAPED",t[t.ELEVATED=1]="ELEVATED"}(tL||(tL={}));var dA;const Qq=new WeakMap;let JOt=0,ug=dA=class extends fe{constructor(t){super(t),this.wrap="repeat"}get url(){return this._get("url")||null}set url(t){this._set("url",t),t&&this._set("data",null)}get data(){return this._get("data")||null}set data(t){this._set("data",t),t&&this._set("url",null)}writeData(t,e,r,i){if(t instanceof HTMLImageElement){const n={type:"image-element",src:x_(t.src,i),crossOrigin:t.crossOrigin};e[r]=n}else if(t instanceof HTMLCanvasElement){const n=t.getContext("2d").getImageData(0,0,t.width,t.height),s={type:"canvas-element",imageData:this._encodeImageData(n)};e[r]=s}else if(t instanceof HTMLVideoElement){const n={type:"video-element",src:x_(t.src,i),autoplay:t.autoplay,loop:t.loop,muted:t.muted,crossOrigin:t.crossOrigin,preload:t.preload};e[r]=n}else if(t instanceof ImageData){const n={type:"image-data",imageData:this._encodeImageData(t)};e[r]=n}}readData(t){switch(t.type){case"image-element":{const e=new Image;return e.src=t.src,e.crossOrigin=t.crossOrigin,e}case"canvas-element":{const e=this._decodeImageData(t.imageData),r=document.createElement("canvas");return r.width=e.width,r.height=e.height,r.getContext("2d").putImageData(e,0,0),r}case"image-data":return this._decodeImageData(t.imageData);case"video-element":{const e=document.createElement("video");return e.src=t.src,e.crossOrigin=t.crossOrigin,e.autoplay=t.autoplay,e.loop=t.loop,e.muted=t.muted,e.preload=t.preload,e}default:return}}get transparent(){const t=this.data,e=this.url;if(t instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(t.getContext("2d").getImageData(0,0,t.width,t.height));if(t instanceof ImageData)return this._imageDataContainsTransparent(t);if(e){const r=e.substr(e.length-4,4).toLowerCase(),i=e.substr(0,15).toLocaleLowerCase();if(r===".png"||i==="data:image/png;")return!0}return!1}set transparent(t){this._overrideIfSome("transparent",t)}get contentHash(){const t=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",e=(r="")=>`d:${r},t:${this.transparent},w:${t}`;return this.url!=null?e(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?e(this.data.src):(Qq.has(this.data)||Qq.set(this.data,++JOt),e(Qq.get(this.data))):e()}clone(){const t={url:this.url,data:this.data,wrap:this._cloneWrap()};return new dA(t)}cloneWithDeduplication(t){const e=t.get(this);if(e)return e;const r=this.clone();return t.set(this,r),r}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(t){let e="";for(let r=0;r<t.data.length;r++)e+=String.fromCharCode(t.data[r]);return{data:btoa(e),width:t.width,height:t.height}}_decodeImageData(t){const e=atob(t.data),r=new Uint8ClampedArray(e.length);for(let i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return ift(r,t.width,t.height)}_imageDataContainsTransparent(t){for(let e=3;e<t.data.length;e+=4)if(t.data[e]!==255)return!0;return!1}static from(t){return typeof t=="string"?new dA({url:t}):t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData||t instanceof HTMLVideoElement?new dA({data:t}):sO(dA,t)}};u([d({type:String,json:{write:Jb}})],ug.prototype,"url",null),u([d({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),d()],ug.prototype,"data",null),u([De("data")],ug.prototype,"writeData",null),u([Me("data")],ug.prototype,"readData",null),u([d({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],ug.prototype,"transparent",null),u([d({json:{write:!0}})],ug.prototype,"wrap",void 0),u([d({readOnly:!0})],ug.prototype,"contentHash",null),ug=dA=u([$("esri.geometry.support.MeshTexture")],ug);const rL=ug;var $te;let vf=$te=class extends fe{constructor(t){super(t),this.color=null,this.colorTexture=null,this.normalTexture=null,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const r=v(t)?t.get(this):null;if(r)return r;const i=new $te(this.clonePropertiesWithDeduplication(e));return v(t)&&t.set(this,i),i}clonePropertiesWithDeduplication(t){return{color:v(this.color)?this.color.clone():null,colorTexture:v(this.colorTexture)?this.colorTexture.cloneWithDeduplication(t):null,normalTexture:v(this.normalTexture)?this.normalTexture.cloneWithDeduplication(t):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:v(this.colorTextureTransform)?this.colorTextureTransform:null,normalTextureTransform:v(this.normalTextureTransform)?this.normalTextureTransform:null}}};u([d({type:Xe,json:{write:!0}})],vf.prototype,"color",void 0),u([d({type:rL,json:{write:!0}})],vf.prototype,"colorTexture",void 0),u([d({type:rL,json:{write:!0}})],vf.prototype,"normalTexture",void 0),u([d({nonNullable:!0,json:{write:!0}})],vf.prototype,"alphaMode",void 0),u([d({nonNullable:!0,json:{write:!0}})],vf.prototype,"alphaCutoff",void 0),u([d({nonNullable:!0,json:{write:!0}})],vf.prototype,"doubleSided",void 0),u([d()],vf.prototype,"colorTextureTransform",void 0),u([d()],vf.prototype,"normalTextureTransform",void 0),vf=$te=u([$("esri.geometry.support.MeshMaterial")],vf);const hce=vf;var Lte;let Nd=Lte=class extends hce{constructor(t){super(t),this.emissiveColor=null,this.emissiveTexture=null,this.occlusionTexture=null,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const r=v(t)?t.get(this):null;if(r)return r;const i=new Lte(this.clonePropertiesWithDeduplication(e));return v(t)&&t.set(this,i),i}clonePropertiesWithDeduplication(t){return{...super.clonePropertiesWithDeduplication(t),emissiveColor:v(this.emissiveColor)?this.emissiveColor.clone():null,emissiveTexture:v(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(t):null,occlusionTexture:v(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(t):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:v(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.cloneWithDeduplication(t):null,occlusionTextureTransform:v(this.occlusionTextureTransform)?this.occlusionTextureTransform:null,emissiveTextureTransform:v(this.emissiveTextureTransform)?this.emissiveTextureTransform:null,metallicRoughnessTextureTransform:v(this.metallicRoughnessTextureTransform)?this.metallicRoughnessTextureTransform:null}}};u([d({type:Xe,json:{write:!0}})],Nd.prototype,"emissiveColor",void 0),u([d({type:rL,json:{write:!0}})],Nd.prototype,"emissiveTexture",void 0),u([d({type:rL,json:{write:!0}})],Nd.prototype,"occlusionTexture",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],Nd.prototype,"metallic",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],Nd.prototype,"roughness",void 0),u([d({type:rL,json:{write:!0}})],Nd.prototype,"metallicRoughnessTexture",void 0),u([d()],Nd.prototype,"occlusionTextureTransform",void 0),u([d()],Nd.prototype,"emissiveTextureTransform",void 0),u([d()],Nd.prototype,"metallicRoughnessTextureTransform",void 0),Nd=Lte=u([$("esri.geometry.support.MeshMaterialMetallicRoughness")],Nd);const Jke=Nd;var kU;const Kke="esri.geometry.support.MeshVertexAttributes",VE=re.getLogger(Kke);let _d=kU=class extends fe{constructor(t){super(t),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(t){return pA(t,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},VE)}castPosition(t){return t&&t instanceof Float32Array&&VE.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),pA(t,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},VE)}castUv(t){return pA(t,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},VE)}castNormal(t){return pA(t,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},VE)}castTangent(t){return pA(t,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},VE)}clone(){const t={position:se(this.position),uv:se(this.uv),normal:se(this.normal),tangent:se(this.tangent),color:se(this.color)};return new kU(t)}clonePositional(){const t={position:se(this.position),normal:se(this.normal),tangent:se(this.tangent),uv:this.uv,color:this.color};return new kU(t)}};function eW(t,e,r,i){const{loggerTag:n,stride:s}=e;return t.length%s!=0?(i.error(n,`Invalid array length, expected a multiple of ${s}`),new r([])):t}function pA(t,e,r,i,n){if(!t)return t;if(t instanceof e)return eW(t,i,e,n);for(const s of r)if(t instanceof s)return eW(new e(t),i,e,n);if(Array.isArray(t))return eW(new e(t),i,e,n);{const s=r.map(o=>`'${o.name}'`);return n.error(`Failed to set property, expected one of ${s}, but got ${t.constructor.name}`),new e([])}}function WM(t,e,r){e[r]=KOt(t)}function KOt(t){const e=new Array(t.length);for(let r=0;r<t.length;r++)e[r]=t[r];return e}u([d({json:{write:WM}})],_d.prototype,"color",void 0),u([cr("color")],_d.prototype,"castColor",null),u([d({nonNullable:!0,json:{write:WM}})],_d.prototype,"position",void 0),u([cr("position")],_d.prototype,"castPosition",null),u([d({json:{write:WM}})],_d.prototype,"uv",void 0),u([cr("uv")],_d.prototype,"castUv",null),u([d({json:{write:WM}})],_d.prototype,"normal",void 0),u([cr("normal")],_d.prototype,"castNormal",null),u([d({json:{write:WM}})],_d.prototype,"tangent",void 0),u([cr("tangent")],_d.prototype,"castTangent",null),_d=kU=u([$(Kke)],_d);var zI;const Qke="esri.geometry.support.MeshComponent",QOt=re.getLogger(Qke);let _0=zI=class extends fe{static from(t){return sO(zI,t)}constructor(t){super(t),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}castFaces(t){return pA(t,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},QOt)}castMaterial(t){return sO(t&&typeof t=="object"&&("metallic"in t||"roughness"in t||"metallicRoughnessTexture"in t)?Jke:hce,t)}clone(){return new zI({faces:se(this.faces),shading:this.shading,material:se(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(t,e){const r={faces:se(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(t,e):null,trustSourceNormals:this.trustSourceNormals};return new zI(r)}};u([d({json:{write:!0}})],_0.prototype,"faces",void 0),u([cr("faces")],_0.prototype,"castFaces",null),u([d({type:hce,json:{write:!0}})],_0.prototype,"material",void 0),u([cr("material")],_0.prototype,"castMaterial",null),u([d({type:String,json:{write:!0}})],_0.prototype,"shading",void 0),u([d({type:Boolean})],_0.prototype,"trustSourceNormals",void 0),_0=zI=u([$(Qke)],_0);const e3t=_0,P7=re.getLogger("esri.geometry.support.meshUtils.normalProjection");function t3t(t,e,r,i,n){return $7(i)?(I7(l_.TO_PCPF,Ui.fromTypedArray(t),ml.fromTypedArray(e),ml.fromTypedArray(r),i,Ui.fromTypedArray(n)),n):(P7.error("Cannot convert spatial reference to PCPF"),n)}function SJt(t,e,r,i,n){return $7(i)?(I7(l_.FROM_PCPF,Ui.fromTypedArray(t),ml.fromTypedArray(e),ml.fromTypedArray(r),i,Ui.fromTypedArray(n)),n):(P7.error("Cannot convert to spatial reference from PCPF"),n)}function EJt(t,e,r){return $n(t,e,0,r,BB(e),0,t.length/3),r}function CJt(t,e,r){return $n(t,BB(r),0,e,r,0,t.length/3),e}function r3t(t,e,r){if(R(t))return e;const i=ml.fromTypedArray(t),n=ml.fromTypedArray(e);return KN(n,i,r),e}function i3t(t,e,r){if(R(t))return e;kO(Ao,r);const i=Ui.fromTypedArray(t),n=Ui.fromTypedArray(e);return bw(n,i,Ao),Boe(Ao)||Wle(n,n),e}function n3t(t,e,r){if(R(t))return e;kO(Ao,r);const i=Ui.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),n=Ui.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT);if(bw(n,i,Ao),Boe(Ao)||Wle(n,n),t!==e)for(let s=3;s<t.length;s+=4)e[s]=t[s];return e}function s3t(t,e,r,i,n){if(!$7(i))return P7.error("Cannot convert spatial reference to PCPF"),n;I7(l_.TO_PCPF,Ui.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),ml.fromTypedArray(e),ml.fromTypedArray(r),i,Ui.fromTypedArray(n,4*Float32Array.BYTES_PER_ELEMENT));for(let s=3;s<t.length;s+=4)n[s]=t[s];return n}function AJt(t,e,r,i,n){if(!$7(i))return P7.error("Cannot convert to spatial reference from PCPF"),n;I7(l_.FROM_PCPF,Ui.fromTypedArray(t,16),ml.fromTypedArray(e),ml.fromTypedArray(r),i,Ui.fromTypedArray(n,16));for(let s=3;s<t.length;s+=4)n[s]=t[s];return n}function I7(t,e,r,i,n,s){if(!e)return;const o=r.count,a=BB(n);if(e6e(n))for(let l=0;l<o;l++)i.getVec(l,B5),e.getVec(l,Nm),um(a,B5,j5,a),Op(Ao,j5),t===l_.FROM_PCPF&&Xu(Ao,Ao),Gl(Nm,Nm,Ao),s.setVec(l,Nm);else for(let l=0;l<o;l++){i.getVec(l,B5),e.getVec(l,Nm),um(a,B5,j5,a),Op(Ao,j5);const c=q8(r.get(l,1));let h=Math.cos(c);t===l_.TO_PCPF&&(h=1/h),Ao[0]*=h,Ao[1]*=h,Ao[2]*=h,Ao[3]*=h,Ao[4]*=h,Ao[5]*=h,t===l_.FROM_PCPF&&Xu(Ao,Ao),Gl(Nm,Nm,Ao),we(Nm,Nm),s.setVec(l,Nm)}return s}function $7(t){return e6e(t)||o3t(t)}function e6e(t){return t.isWGS84||R2e(t)||my(t)||gy(t)}function o3t(t){return t.isWebMercator}var l_;(function(t){t[t.TO_PCPF=0]="TO_PCPF",t[t.FROM_PCPF=1]="FROM_PCPF"})(l_||(l_={}));const B5=P(),Nm=P(),j5=$e(),Ao=vi();let t6e=class{constructor(e){this.data=e,this.type="encoded-mesh-texture",this.encoding=F0.KTX2_ENCODING}};function zS(t){return(t==null?void 0:t.type)==="encoded-mesh-texture"}async function a3t(t){return new Promise((e,r)=>{const i=new Blob([t]),n=new FileReader;n.onload=()=>{const s=n.result;e(JSON.parse(s))},n.onerror=s=>{r(s)},n.readAsText(i)})}async function l3t(t,e){return e===F0.KTX2_ENCODING?new t6e(t):new Promise((r,i)=>{const n=new Blob([t],{type:e}),s=URL.createObjectURL(n),o=new Image,a=()=>{URL.revokeObjectURL(s),"decode"in o?o.decode().then(()=>r(o),()=>r(o)).then(c):(r(o),c())},l=h=>{URL.revokeObjectURL(s),i(h),c()},c=()=>{o.removeEventListener("load",a),o.removeEventListener("error",l)};o.addEventListener("load",a),o.addEventListener("error",l),o.src=s})}function Ig(t){if(R(t))return null;const e=v(t.offset)?t.offset:s$e,r=v(t.rotation)?t.rotation:0,i=v(t.scale)?t.scale:o$e,n=aU(1,0,0,0,1,0,e[0],e[1],1),s=aU(Math.cos(r),-Math.sin(r),0,Math.sin(r),Math.cos(r),0,0,0,1),o=aU(i[0],0,0,0,i[1],0,0,0,1),a=Bc();return lw(a,s,o),lw(a,n,a),a}function c3t(t){const e=new Br,{vertex:r,fragment:i}=e;return e.include(zc,t),e.include(X2,t),e.include(B5e,t),Gu(r,t),t.stippleEnabled&&(e.attributes.add(O.UV0,"vec2"),e.attributes.add(O.AUXPOS1,"vec3"),r.uniforms.add(new br("viewport",(n,s)=>s.camera.fullViewport))),e.attributes.add(O.POSITION,"vec3"),e.varyings.add("vpos","vec3"),r.code.add(S`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),t.stippleEnabled&&(r.code.add(S`vec4 vpos2 = transformPosition(proj, view, auxpos1);
vec2 ndcToPixel = viewport.zw * 0.5;
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),t.draped?r.uniforms.add(new Ie("worldToScreenRatio",(n,s)=>1/s.screenToPCSRatio)):r.code.add(S`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),r.code.add(S`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),t.draped?r.code.add(S`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):r.code.add(S`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),r.uniforms.add(new Ie("stipplePatternPixelSize",n=>Yle(n))),r.code.add(S`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`)),r.code.add(S`}`),t.output===V.Highlight&&e.include(W_,t),e.include(hs,t),i.uniforms.add(new Ie("alphaCoverage",(n,s)=>Math.min(1,n.width*s.camera.pixelRatio))),t.hasVertexColors||i.uniforms.add(new br("constantColor",n=>n.color)),i.code.add(S`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${t.hasVertexColors?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    ${t.output===V.ObjectAndLayerIdColor?S`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${S.float(Fa)}) {
      discard;
    }

    ${t.output===V.Color?S`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===V.Highlight?S`outputHighlight();`:""}
  }
  `),e}const u3t=Object.freeze(Object.defineProperty({__proto__:null,build:c3t},Symbol.toStringTag,{value:"Module"}));let r6e=class i6e extends Wr{get _stippleEnabled(){return this.configuration.stippleEnabled&&this.configuration.output!==V.Highlight}initializeConfiguration(e,r){r.hasWebGL2Context=e.rctx.type===Et.WEBGL2}initializeProgram(e){return new Gr(e.rctx,i6e.shader.get().build(this.configuration),Lr)}initializePipeline(){const e=this.configuration,r=mo(Ce.SRC_ALPHA,Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA,Ce.ONE_MINUS_SRC_ALPHA),i=(n,s=null,o=null)=>Ht({blending:s,depthTest:Jle,depthWrite:o,colorWrite:ir,stencilWrite:e.hasOccludees?fy:null,stencilTest:e.hasOccludees?n?ww:Uw:null});return e.output===V.Color?(this._occludeePipelineState=i(!0,e.transparent||this._stippleEnabled?r:null,Xc),i(!1,e.transparent||this._stippleEnabled?r:null,Xc)):i(!1)}get primitiveType(){return Ft.LINES}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};r6e.shader=new jr(u3t,()=>Q(()=>import("./NativeLine.glsl-fb563bd3.js"),[]));let vh=class extends Io{constructor(){super(...arguments),this.output=V.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}};u([j({count:V.COUNT})],vh.prototype,"output",void 0),u([j()],vh.prototype,"hasSlicePlane",void 0),u([j()],vh.prototype,"hasVertexColors",void 0),u([j()],vh.prototype,"transparent",void 0),u([j()],vh.prototype,"draped",void 0),u([j()],vh.prototype,"stippleEnabled",void 0),u([j()],vh.prototype,"stippleOffColorEnabled",void 0),u([j()],vh.prototype,"stipplePreferContinuous",void 0),u([j()],vh.prototype,"hasOccludees",void 0),u([j({constValue:!1})],vh.prototype,"stippleRequiresClamp",void 0),u([j({constValue:!1})],vh.prototype,"stippleScaleWithLineWidth",void 0),u([j({constValue:!1})],vh.prototype,"stippleRequiresStretchMeasure",void 0);var kV;(function(t){t[t.START=0]="START",t[t.END=1]="END"})(kV||(kV={}));let Ove=class extends Fw{constructor(e){super(e,new p3t),this._configuration=new vh}getConfiguration(e,r){this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.draped=r.slot===Ee.DRAPED_MATERIAL;const i=v(this.parameters.stipplePattern);return this._configuration.stippleEnabled=i,this._configuration.stippleOffColorEnabled=i&&v(this.parameters.stippleOffColor),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._configuration}intersect(e,r,i,n,s,o){if(!i.options.selectionMode||!e.visible)return;if(!xNe(r))return void re.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix");const a=e.vertexAttributes.get(O.POSITION).data,l=i.camera,c=m3t;Qs(c,i.point);const h=2;he(XM[0],c[0]-h,c[1]+h,0),he(XM[1],c[0]+h,c[1]+h,0),he(XM[2],c[0]+h,c[1]-h,0),he(XM[3],c[0]-h,c[1]-h,0);for(let _=0;_<4;_++)if(!l.unprojectFromRenderScreen(XM[_],By[_]))return;rl(l.eye,By[0],By[1],tW),rl(l.eye,By[1],By[2],rW),rl(l.eye,By[2],By[3],iW),rl(l.eye,By[3],By[0],nW);let p=Number.MAX_VALUE,f=0;for(let _=0;_<a.length-5;_+=3){if($l[0]=a[_]+r[12],$l[1]=a[_+1]+r[13],$l[2]=a[_+2]+r[14],Ll[0]=a[_+3]+r[12],Ll[1]=a[_+4]+r[13],Ll[2]=a[_+5]+r[14],Ri(tW,$l)<0&&Ri(tW,Ll)<0||Ri(rW,$l)<0&&Ri(rW,Ll)<0||Ri(iW,$l)<0&&Ri(iW,Ll)<0||Ri(nW,$l)<0&&Ri(nW,Ll)<0)continue;if(l.projectToRenderScreen($l,_x),l.projectToRenderScreen(Ll,vx),_x[2]<0&&vx[2]>0){ge(Fm,$l,Ll);const w=l.frustum,x=-Ri(w[Ai.NEAR],$l)/ve(Fm,w[Ai.NEAR]);le(Fm,Fm,x),me($l,$l,Fm),l.projectToRenderScreen($l,_x)}else if(_x[2]>0&&vx[2]<0){ge(Fm,Ll,$l);const w=l.frustum,x=-Ri(w[Ai.NEAR],Ll)/ve(Fm,w[Ai.NEAR]);le(Fm,Fm,x),me(Ll,Ll,Fm),l.projectToRenderScreen(Ll,vx)}else if(_x[2]<0&&vx[2]<0)continue;_x[2]=0,vx[2]=0;const b=uae(DS(_x,vx,Ive),c);b<p&&(p=b,ce(Mve,$l),ce(Pve,Ll),f=_/3)}const m=i.rayBegin,g=i.rayEnd;if(p<h*h){let _=Number.MAX_VALUE;if(vLe(DS(Mve,Pve,Ive),DS(m,g,f3t),yx)){ge(yx,yx,m);const b=Pe(yx);le(yx,yx,1/b),_=b/Pi(m,g)}o(_,yx,f,!1)}}intersectDraped(e,r,i,n,s,o){if(!i.options.selectionMode)return;const a=e.vertexAttributes.get(O.POSITION).data,l=e.vertexAttributes.get(O.SIZE),c=l?l.data[0]:0,h=n[0],p=n[1],f=((c+1)/2+4)*e.screenToWorldRatio;let m=Number.MAX_VALUE,g=0;for(let _=0;_<a.length-5;_+=3){const b=a[_],w=a[_+1],x=h-b,T=p-w,E=a[_+3]-b,C=a[_+4]-w,A=_e((E*x+C*T)/(E*E+C*C),0,1),I=E*A-x,M=C*A-T,D=I*I+M*M;D<m&&(m=D,g=_/3)}m<f*f&&s(o.dist,o.normal,g,!1)}requiresSlot(e,r){return!(r!==V.Color&&r!==V.Highlight&&r!==V.ObjectAndLayerIdColor||e!==Ee.OPAQUE_MATERIAL&&e!==Ee.DRAPED_MATERIAL)}createGLMaterial(e){return new h3t(e)}createBufferWriter(){const e=this.parameters.hasVertexColors?ske:AAt;return R(this.parameters.stipplePattern)?new G3(e):new d3t(e.clone().vec3f(O.AUXPOS1).vec2f(O.UV0))}},h3t=class extends Nw{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output===V.Color&&this._updateOccludeeState(e);const r=this._material.parameters.stipplePattern;return this._stipplePattern!==r&&(this._material.setParameters(this._stippleTextureRepository.swap(this._stipplePattern,r)),this._stipplePattern=r),this.ensureTechnique(r6e,e)}},d3t=class{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(O.POSITION).length}write(e,r,i,n,s){x4e(i,this.vertexBufferLayout,e,r,n,s),this._writeAuxpos1(e,i,n,s),this._writeUV0(e,i,n,s)}_writeAuxpos1(e,r,i,n){const s=i.getField(O.AUXPOS1,Ui),o=r.indices.get(O.POSITION),a=r.vertexAttributes.get(O.POSITION).data,l=e,c=s.typedBufferStride,h=s.typedBuffer;n*=c;for(let p=0;p<o.length-1;p+=2)for(const f of[1,0]){const m=3*o[p+f],g=a[m],_=a[m+1],b=a[m+2],w=l[0]*g+l[4]*_+l[8]*b+l[12],x=l[1]*g+l[5]*_+l[9]*b+l[13],T=l[2]*g+l[6]*_+l[10]*b+l[14];h[n]=w,h[n+1]=x,h[n+2]=T,n+=c}}_writeUV0(e,r,i,n){var T;const s=i.getField(O.UV0,q_),o=r.indices.get(O.POSITION),a=r.vertexAttributes.get(O.POSITION).data,l=(T=r.vertexAttributes.get(O.DISTANCETOSTART))==null?void 0:T.data,c=s.typedBufferStride,h=s.typedBuffer;let p=0;h[n*=c]=kV.START,h[n+1]=p,n+=c;const f=3*o[0],m=he($l,a[f],a[f+1],a[f+2]);e&&Ke(m,m,e);const g=Ll,_=o.length-1;let b=1;const w=l?(E,C,A)=>p=l[A]:(E,C,A)=>p+=Pi(E,C);for(let E=1;E<_;E+=2){const C=3*o[E];he(g,a[C],a[C+1],a[C+2]),e&&Ke(g,g,e),w(m,g,b++);for(let A=0;A<2;++A)h[n]=1-A,h[n+1]=p,n+=c;ce(m,g)}const x=3*o[_];he(g,a[x],a[x+1],a[x+2]),e&&Ke(g,g,e),w(m,g,b),h[n]=kV.END,h[n+1]=p}},p3t=class extends z3{constructor(){super(...arguments),this.color=op,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.stipplePreferContinuous=!0,this.hasOccludees=!1,this.stippleTexture=null}};const $l=P(),Ll=P(),Fm=P(),yx=P(),_x=La(),vx=La(),Mve=P(),Pve=P(),Ive=vm(),f3t=vm(),m3t=P(),XM=[La(),La(),La(),La()],By=[P(),P(),P(),P()],tW=Yr(),rW=Yr(),iW=Yr(),nW=Yr(),g3t=["mesh"];class y3t extends Ty{constructor(e,r,i,n){super(e,r,i,n),this._materials=new Map,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){Qr.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new Ove({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new Ove({color:[0,1,1,1]}))}destroy(){super.destroy(),this._context.stage.removeMany(Array.from(this._materials.values(),e=>e.material)),this._context.stage.removeMany(Array.from(this._textures.values())),this._materials.clear(),this._textures.clear()}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,g3t,"fill on mesh-3d"))return null;const i=this.setGraphicElevationContext(r,new Tm),n=e.renderingInfo;return this._createAs3DShape(r,n,i,r.uid)}layerOpacityChanged(e,r){const i=this._getLayerOpacity();this._materials.forEach(n=>{n.material.setParameters({layerOpacity:i});const s=n.material.parameters;this._setMaterialTransparentParameter(s,n),n.material.setParameters({transparent:s.transparent})}),e.forEach(n=>{const s=r(n);v(s)&&s.layerOpacityChanged(i,this._context.isAsync)})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,_w)}slicePlaneEnabledChanged(e,r){return this._materials.forEach(i=>{i.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),e.forEach(i=>{const n=r(i);v(n)&&n.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const e=this._usePBR();return this._materials.forEach(r=>r.material.setParameters({usePBR:e})),!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(e){return R(e)?"-":e instanceof Xe?e.toHex():e.contentHash}_materialPropertiesDefault(e,r){const i=this._requiresSymbolVertexColors(),n=!!e.vertexAttributes.color,s=!!e.vertexAttributes.tangent;return{hasSymbolVertexColors:i,hasVertexColors:n,hasVertexTangents:s,uid:`vc:${n},vt:${s},vct${r},svc:${i}`}}_materialProperties(e,r,i){const n=this._materialPropertiesDefault(e,i);if(!r.material)return n;const{color:s,colorTexture:o,normalTexture:a,doubleSided:l,alphaCutoff:c,alphaMode:h}=r.material,p=this._colorOrTextureUid(s),f=this._colorOrTextureUid(o),m=this._colorOrTextureUid(a);if(n.color=s,n.colorTexture=o,n.normalTexture=a,n.uid=`${n.uid},cmuid:${p},ctmuid:${f},ntmuid:${m},ds:${l},ac:${c},am:${h}`,r.material instanceof Jke){const{metallic:g,roughness:_,metallicRoughnessTexture:b,emissiveColor:w,emissiveTexture:x,occlusionTexture:T}=r.material,E=this._colorOrTextureUid(b),C=this._colorOrTextureUid(w),A=this._colorOrTextureUid(x),I=this._colorOrTextureUid(T);n.metallic=g,n.roughness=_,n.metallicRoughnessTexture=b,n.emissiveColor=w,n.emissiveTexture=x,n.occlusionTexture=T,n.colorTextureTransform=r.material.colorTextureTransform,n.normalTextureTransform=r.material.normalTextureTransform,n.emissiveTextureTransform=r.material.emissiveTextureTransform,n.occlusionTextureTransform=r.material.occlusionTextureTransform,n.metallicRoughnessTextureTransform=r.material.metallicRoughnessTextureTransform,n.uid=`${n.uid},mrm:${g},mrr:${_},mrt:${E},emuid:${C},etmuid:${A},otmuid:${I}`}return n}_setInternalColorValueParameters(e,r){r.diffuse=Xe.toUnitRGB(e),r.opacity=e.a}_getLoadableTextureResource(e){return e.data?e.data:e.url}_getInternalTextureId(e){const r=this._getInternalTexture(e,gi.Opaque);return v(r)?r.id:null}_getInternalTexture(e,r){const i=this._getLoadableTextureResource(e);if(!i)return null;const n=`${e.contentHash}/${r}`;let s=this._textures.get(n);return s||(s=new W2(zS(i)?i.data:i,{mipmap:!0,wrap:this._castTextureWrap(e.wrap),noUnpackFlip:!0,preMultiplyAlpha:!zS(i)&&r!==gi.Opaque,encoding:zS(i)&&v(i.encoding)?i.encoding:void 0}),this._textures.set(n,s),this._context.stage.add(s),this._context.stage.loadImmediate(s)),s}_castTextureWrap(e="repeat"){if(typeof e=="string"){const r=this._castTextureWrapIndividual(e);return{s:r,t:r}}return{s:this._castTextureWrapIndividual(e.horizontal),t:this._castTextureWrapIndividual(e.vertical)}}_castTextureWrapIndividual(e){switch(e){case"clamp":return $t.CLAMP_TO_EDGE;case"mirror":return $t.MIRRORED_REPEAT;default:return $t.REPEAT}}_setInternalMaterialParameters(e,r){if(v(e.color)&&this._setInternalColorValueParameters(e.color,r),v(e.colorTexture)){const i=this._getInternalTexture(e.colorTexture,r.textureAlphaMode);v(i)?(r.textureId=i.id,r.textureAlphaPremultiplied=!!i.params.preMultiplyAlpha):r.textureId=void 0}v(e.normalTexture)&&(r.normalTextureId=this._getInternalTextureId(e.normalTexture)),v(e.emissiveColor)&&(r.emissiveFactor=Xe.toUnitRGB(e.emissiveColor)),v(e.emissiveTexture)&&(r.emissiveTextureId=this._getInternalTextureId(e.emissiveTexture)),v(e.occlusionTexture)&&(r.occlusionTextureId=this._getInternalTextureId(e.occlusionTexture)),v(e.metallicRoughnessTexture)&&(r.metallicRoughnessTextureId=this._getInternalTextureId(e.metallicRoughnessTexture)),r.colorTextureTransformMatrix=Ig(e.colorTextureTransform),r.normalTextureTransformMatrix=Ig(e.normalTextureTransform),r.occlusionTextureTransformMatrix=Ig(e.occlusionTextureTransform),r.emissiveTextureTransformMatrix=Ig(e.emissiveTextureTransform),r.metallicRoughnessTextureTransformMatrix=Ig(e.metallicRoughnessTextureTransform)}_setExternalMaterialParameters(e){const r=this._drivenProperties.color;let i=v(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;if(r)e.externalColor=op;else{const n=v(this.symbolLayer.material)?this.symbolLayer.material.color:null;v(n)?e.externalColor=Xe.toUnitRGBA(n):(i=null,e.externalColor=op)}i&&(e.colorMixMode=i),e.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(e){const r=e.vertexAttributes.color;if(R(r))return!1;for(let i=3;i<r.length;i+=4)if(r[i]!==255)return!0;return!1}_getOrCreateMaterial(e,r){var g,_,b;const i=(g=r.material)==null?void 0:g.color,n=(_=r.material)==null?void 0:_.colorTexture,s=(b=r.material)==null?void 0:b.alphaMode,o=s==="blend",a=s!=="opaque"&&(this._hasTransparentVertexColors(e)||v(i)&&i.a<1||v(n)&&n.transparent||o),l=this._materialProperties(e,r,a),c=this._materials.get(l.uid);if(c)return c.material;const h={material:null,isComponentTransparent:a,alphaMode:r.material?r.material.alphaMode:"opaque"},p=l.metallicRoughnessTexture==null&&l.metallic==null&&l.roughness==null,f={usePBR:this._usePBR(),isSchematic:p,hasVertexColors:l.hasVertexColors,hasSymbolColors:l.hasSymbolVertexColors,hasVertexTangents:l.hasVertexTangents,ambient:cl,diffuse:Lg,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:Ii.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};p||(f.mrrFactors=[l.metallic!=null?l.metallic:1,l.roughness!=null?l.roughness:1,.5]),r.material&&(f.doubleSided=r.material.doubleSided,f.cullFace=r.material.doubleSided?Ii.None:Ii.Back,f.textureAlphaCutoff=r.material.alphaCutoff),this._setExternalMaterialParameters(f),this._setMaterialTransparentParameter(f,h),this._setInternalMaterialParameters(l,f);const m=new P_(f);return h.material=m,this._materials.set(l.uid,h),this._context.stage.add(m),m}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(e,r){e.transparent=this.needsDrivenTransparentPass||r.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,r.alphaMode==="auto"?e.textureAlphaMode=e.transparent?gi.MaskBlend:gi.Opaque:e.textureAlphaMode=r.alphaMode==="opaque"?gi.Opaque:r.alphaMode==="mask"?gi.Mask:gi.Blend}_addDebugNormals(e,r){const i=r.length,n=e.spatialReference.isGeographic?20015077/180:1,s=.1*Math.max(e.extent.width*n,e.extent.height*n,e.extent.zmax-e.extent.zmin),o=[],a=[],l=[],c=[];for(let m=0;m<i;m++){const g=r[m],_=g.vertexAttributes.get(O.POSITION),b=g.vertexAttributes.get(O.NORMAL),w=g.indices.get(O.POSITION),x=g.indices.get(O.NORMAL),T=_.data,E=b.data;for(let C=0;C<w.length;C++){const A=3*w[C],I=3*x[C];for(let M=0;M<3;M++)o.push(T[A+M]);for(let M=0;M<3;M++)o.push(T[A+M]+E[I+M]*s);if(a.push(a.length),a.push(a.length),C%3==0){this._calculateFaceNormal(T,w,C,GE),this._getFaceVertices(T,w,C,Ea,BE,jE),me(Ea,Ea,BE),me(Ea,Ea,jE),le(Ea,Ea,1/3);for(let M=0;M<3;M++)l.push(Ea[M]);for(let M=0;M<3;M++)l.push(Ea[M]+GE[M]*s);c.push(c.length),c.push(c.length)}}}const h=r[0].transformation,p=new As(this._debugVertexNormalMaterial,[[O.POSITION,new Qe(o,3,!0)]],[[O.POSITION,a]],null,Wn.Line);r.push(p),p.transformation=h;const f=new As(this._debugFaceNormalMaterial,[[O.POSITION,new Qe(l,3,!0)]],[[O.POSITION,c]],null,Wn.Line);f.transformation=h,r.push(f)}_createAs3DShape(e,r,i,n){const s=e.geometry;if(s.type!=="mesh")return null;const o=this._createGeometryInfo(s,r,n);if(R(o))return null;const{geometries:a,objectTransformation:l}=o;Qr.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(s,a);const c=new Z_({geometries:a,metadata:{layerUid:this._context.layer.uid,graphicUid:n}});c.transformation=l;const h=x5e(this.symbolLayer,{opacity:this._getLayerOpacity()}),p=v(h)?new VEt(a[0].material,[h],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null,f=new xy(this,c,a,null,null,PD,i,p);f.needsElevationUpdates=_w(i.mode),f.useObjectOriginAsAttachmentOrigin=!0,i.centerPointInElevationSR=this._getCenterPointInElevationSR(c);const{elevationProvider:m,renderCoordsHelper:g}=this._context,_=(b,w)=>j3(b,m,i,g,w);return f.alignedSampledElevation=PD(f,i,m.spatialReference,_,g),f}_getCenterPointInElevationSR(e){const r=Y_(0,0,0,v(this._context.elevationProvider.spatialReference)?this._context.elevationProvider.spatialReference:null);return BAe([e.transformation[12],e.transformation[13],e.transformation[14]],this._context.renderCoordsHelper.spatialReference,r),r}_createComponentNormals(e,r,i,n){switch(i.shading||"flat"){default:case"source":return this._createComponentNormalsSource(e,r,i,n);case"flat":return this._createComponentNormalsFlat(e,n);case"smooth":return this._createComponentNormalsSmooth(e,n)}}_createComponentNormalsSource(e,r,i,n){if(R(r))return this._createComponentNormalsFlat(e,n);let s=!1;if(!i.trustSourceNormals)for(let o=0;o<n.length;o+=3){this._calculateFaceNormal(e,n,o,GE);for(let a=0;a<3;a++){const l=3*n[o+a];Ea[0]=r[l+0],Ea[1]=r[l+1],Ea[2]=r[l+2],ve(GE,Ea)<0&&(r[l+0]=-r[l+0],r[l+1]=-r[l+1],r[l+2]=-r[l+2],s=!0)}}return new sW(r,n,s)}_createComponentNormalsFlat(e,r){const i=us(r.length),n=new Array(3*r.length);for(let s=0;s<r.length;s+=3){const o=this._calculateFaceNormal(e,r,s,GE);for(let a=0;a<3;a++)i[s+a]=o[a],n[s+a]=s/3}return new sW(i,n,!1)}_createComponentNormalsSmooth(e,r){const i={};for(let o=0;o<r.length;o+=3){const a=this._calculateFaceNormal(e,r,o,GE);for(let l=0;l<3;l++){const c=r[o+l];let h=i[c];h||(h={normal:P(),count:0},i[c]=h),me(h.normal,h.normal,a),h.count++}}const n=us(3*r.length),s=new Array(3*r.length);for(let o=0;o<r.length;o++){const a=i[r[o]];a.count!==1&&(we(a.normal,a.normal),a.count=1);for(let l=0;l<3;l++)n[3*o+l]=a.normal[l];s[o]=o}return new sW(n,s,!1)}_getFaceVertices(e,r,i,n,s,o){const a=3*r[i+0],l=3*r[i+1],c=3*r[i+2];n[0]=e[a+0],n[1]=e[a+1],n[2]=e[a+2],s[0]=e[l+0],s[1]=e[l+1],s[2]=e[l+2],o[0]=e[c+0],o[1]=e[c+1],o[2]=e[c+2]}_calculateFaceNormal(e,r,i,n){return this._getFaceVertices(e,r,i,Ea,BE,jE),ge(BE,BE,Ea),ge(jE,jE,Ea),vt(Ea,BE,jE),we(n,Ea),n}_getOrCreateComponents(e){return Nt(e.components,_3t)}_createPositionBuffer(e,r){let i=e.vertexAttributes.position;const n=r.reprojection===Sh.ECEF?r.transformBeforeProject:null;if(v(n)&&(i=r3t(i,new Float64Array(i.length),n)),r.reprojection===Sh.NONE)return r.needsBufferCopy?new Float64Array(i):i;const s=v(n)?i:new Float64Array(i.length);return $n(i,e.spatialReference,0,s,this._context.renderCoordsHelper.spatialReference,0,i.length/3),s}_createNormalBuffer(e,r,i){let n=e.vertexAttributes.normal;if(R(n))return null;const s=i.reprojection===Sh.ECEF?i.transformBeforeProject:null;if(v(s)&&(n=i3t(n,new Float32Array(n.length),s)),this._context.graphicsCoreOwner.view.viewingMode==="local"||i.reprojection===Sh.NONE)return i.needsBufferCopy&&e.vertexAttributes.normal===n?new Float32Array(n):n;const o=e.vertexAttributes.position,a=v(s)?n:new Float32Array(n.length);return t3t(n,o,r,e.spatialReference,a)}_createTangentBuffer(e,r,i){let n=e.vertexAttributes.tangent;if(R(n))return null;const s=i.reprojection===Sh.ECEF?i.transformBeforeProject:null;if(v(s)&&(n=n3t(n,new Float32Array(n.length),s)),this._context.graphicsCoreOwner.view.viewingMode==="local"||i.reprojection===Sh.NONE)return i.needsBufferCopy&&e.vertexAttributes.normal===n?new Float32Array(n):n;const o=e.vertexAttributes.position,a=v(s)?n:new Float32Array(n.length);return s3t(n,o,r,e.spatialReference,a)}_createColorBuffer(e){return e.vertexAttributes.color}_createSymbolColorBuffer(e){if(this._requiresSymbolVertexColors()){const r=this._getVertexOpacityAndColor(e),i=yRt(Xs(this.symbolLayer,"material","colorMixMode")),n=new Uint8Array(4);return Oke(r,i,n),n}return null}_createBuffers(e,r){const i=e.vertexAttributes&&e.vertexAttributes.position;if(!i)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const n=e.vertexAttributes.normal,s=e.vertexAttributes.uv,o=e.vertexAttributes.tangent;if(v(n)&&n.length!==i.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(v(o)&&o.length/4!=i.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(v(s)&&s.length/2!=i.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const a=this._computeReprojectionInfo(e),l=this._createPositionBuffer(e,a),c=this._createColorBuffer(e),h=this._createSymbolColorBuffer(r),p=this._createNormalBuffer(e,l,a),f=this._createTangentBuffer(e,l,a);return{positionBuffer:l,normalBuffer:p,tangentBuffer:f,uvBuffer:s,colorBuffer:c,symbolColorBuffer:h,objectTransformation:a.reprojection===Sh.NONE&&v(a.objectTransformation)?a.objectTransformation:this._transformOriginLocal(e,l,p,f),geometryTransformation:a.reprojection===Sh.NONE&&v(a.geometryTransformation)?a.geometryTransformation:$e()}}_computeReprojectionInfo(e){const r=v(e.transform),i=r&&e.transform.geographic||this._context.renderCoordsHelper.viewingMode===qe.Local?Sh.NONE:Sh.ECEF;if(r){if(i===Sh.NONE){const s=$e();return um(e.spatialReference,e.transform.origin,s,this._context.renderCoordsHelper.spatialReference),{reprojection:i,objectTransformation:s,geometryTransformation:zO(e.transform.localMatrix),needsBufferCopy:!1}}const n=Q9($e(),e.transform.origin);return Mn(n,n,e.transform.localMatrix),{reprojection:i,transformBeforeProject:n,needsBufferCopy:!0}}return{reprojection:i,needsBufferCopy:!0}}_transformOriginLocal(e,r,i,n){const s=this._context.renderCoordsHelper.spatialReference,o=e.anchor;G5[0]=o.x,G5[1]=o.y,G5[2]=o.z;const a=$e();um(e.spatialReference,G5,a,s);const l=ml.fromTypedArray(r);if(ya($ve,a),KN(l,l,$ve),v(i)||v(n)){if(Op(YM,a),Xu(YM,YM),v(i)){const c=Ui.fromTypedArray(i);bw(c,c,YM)}if(v(n)){const c=Ui.fromTypedArray(n,4*n.BYTES_PER_ELEMENT);bw(c,c,YM)}}return a}_validateFaces(e,r){const i=e.vertexAttributes.position.length/3,n=r.faces;if(n){let s=-1;for(let o=0;o<n.length;o++){const a=n[o];a>s&&(s=a)}if(i<=s)return this.logger.warn(`Vertex index ${s} is out of bounds of the mesh position buffer`),!1}else if(i%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(e,r){return r.faces?r.faces:HO(e.vertexAttributes.position.length/3)}_isOutsideClippingArea(e){if(!this._context.clippingExtent)return!1;const r=e.vertexAttributes&&e.vertexAttributes.position;if(!r)return!1;const i=this._context.elevationProvider.spatialReference;let n;const s=r.length/3;return v(i)&&!e.spatialReference.equals(i)?(n=new Float64Array(r.length),$n(e.vertexAttributes.position,e.spatialReference,0,n,i,0,s)):n=r,ki(oW),Wh(oW,n,0,s),!jf(oW,this._context.clippingExtent)}_createGeometryInfo(e,r,i){if(!cy(e.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(e))return null;const n=this._createBuffers(e,r);if(R(n))return null;const{positionBuffer:s,uvBuffer:o,colorBuffer:a,symbolColorBuffer:l,normalBuffer:c,tangentBuffer:h,objectTransformation:p,geometryTransformation:f}=n,m=this._getOrCreateComponents(e),g=new Array;let _=!1;for(const b of m){if(!this._validateFaces(e,b))return null;const w=this._getOrCreateFaces(e,b);if(w.length===0)continue;const x=this._createComponentNormals(s,c,b,w);x.didFlipNormals&&(_=!0);const T=[[O.POSITION,new Qe(s,3,!0)],[O.NORMAL,new Qe(x.normals,3,!0)]],E=[[O.POSITION,w],[O.NORMAL,x.indices]];v(a)&&(T.push([O.COLOR,new Qe(a,4,!0)]),E.push([O.COLOR,w])),v(l)&&(T.push([O.SYMBOLCOLOR,new Qe(l,4,!0)]),E.push([O.SYMBOLCOLOR,new Array(w.length).fill(0)])),v(o)&&(T.push([O.UV0,new Qe(o,2,!0)]),E.push([O.UV0,w])),v(h)&&(T.push([O.TANGENT,new Qe(h,4,!0)]),E.push([O.TANGENT,w]));const C=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:i,layerUid:this._context.layer.uid}),A=this._getOrCreateMaterial(e,b),I=new As(A,T,E,null,Wn.Mesh,C);I.transformation=f,g.push(I)}return _&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:g,objectTransformation:p}}}let sW=class{constructor(e,r,i){this.normals=e,this.indices=r,this.didFlipNormals=i}};const G5=P(),Ea=P(),BE=P(),jE=P(),GE=P(),$ve=$e(),YM=vi(),oW=Ks(),_3t=[new e3t];var Sh;(function(t){t[t.NONE=0]="NONE",t[t.ECEF=1]="ECEF"})(Sh||(Sh={}));let v3t=class{constructor(e,r,i,n){this.graphics3DSymbolLayer=e,this.instanceIndex=r,this.elevationAligner=i,this.elevationContext=n,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(e){const r=this._lodRenderer.instanceData;e!==r.getVisible(this.instanceIndex)&&r.setVisible(this.instanceIndex,e)}destroy(){this.instanceIndex!=null&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(e,r,i){if(this.elevationAligner){Ble(this.elevationContext.featureExpressionInfoContext,i);const n=(o,a)=>j3(o,e,this.elevationContext,r,a),s=this.elevationAligner(this,this.elevationContext,e.spatialReference,n,r);v(s)&&(this.alignedSampledElevation=s)}}getCenterObjectSpace(e=P()){return this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,km),Ke(e,this._lodRenderer.baseBoundingSphere.center,km)}getBoundingBoxObjectSpace(e=Ks()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,km);const r=this._lodRenderer.baseBoundingBox;ki(e);for(let i=0;i<8;++i)he(vd,1&i?r[3]:r[0],2&i?r[4]:r[1],4&i?r[5]:r[2]),Ke(vd,vd,km),ay(e,vd);return e}computeAttachmentOrigin(e){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,km),e.render.origin[0]+=km[12],e.render.origin[1]+=km[13],e.render.origin[2]+=km[14],e.render.num++}async getProjectedBoundingBox(e,r,i,n,s){const o=this.getBoundingBoxObjectSpace(s),a=b3t,l=Ine(o)?1:a.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,km);for(let h=0;h<l;h++){const p=a[h];vd[0]=o[p[0]],vd[1]=o[p[1]],vd[2]=o[p[2]],Ke(vd,vd,km),bx[3*h+0]=vd[0],bx[3*h+1]=vd[1],bx[3*h+2]=vd[2]}if(!e(bx,0,l))return null;ki(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let p=0;p<3;p++)o[p]=Math.min(o[p],bx[h+p]),o[p+3]=Math.max(o[p+3],bx[h+p]);c&&i.push({location:bx.slice(h,h+3),screenSpaceBoundingRect:c})}if(r&&(Bf(o,aW),this.elevationContext.mode!=="absolute-height")){let h;const p=Ule(o,r.service.spatialReference,r);try{h=await r.service.queryElevation(aW[0],aW[1],n,p,"ground")}catch{}v(h)&&gCe(o,0,0,-this.alignedSampledElevation+h)}return o}addObjectState(e,r){if(e===A_.Highlight){const i=new aV(e);this._addHighlightId(i),r.addExternal(n=>{this._removeHighlightId(n)},i)}}removeObjectState(e){this._highlights.forEach(r=>e.remove(r))}_addHighlightId(e){this._highlights.add(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(e){this._highlights.delete(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get _lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}};const bx=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],vd=P(),aW=P(),b3t=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],km=$e();function w3t(t){const e=new Array;return t.stageResources.geometries.forEach(r=>{const i=t.stageResources.textures;e.push(new v5e(r,i))}),{components:e,minScreenSpaceRadius:Nt(t.lodThreshold,0),pivotOffset:t.pivotOffset}}function x3t(t){return{levels:t.map(e=>w3t(e))}}function T3t(t,e,r){if(t.count!==e.count)return void T7.error("source and destination buffers need to have the same number of elements");const i=t.count,n=r[0],s=r[1],o=r[2],a=r[3],l=r[4],c=r[5],h=r[6],p=r[7],f=r[8],m=r[9],g=r[10],_=r[11],b=r[12],w=r[13],x=r[14],T=r[15],E=t.typedBuffer,C=t.typedBufferStride,A=e.typedBuffer,I=e.typedBufferStride;for(let M=0;M<i;M++){const D=M*C,U=M*I,z=A[U],B=A[U+1],ee=A[U+2],te=A[U+3];E[D]=n*z+l*B+f*ee+b*te,E[D+1]=s*z+c*B+m*ee+w*te,E[D+2]=o*z+h*B+g*ee+x*te,E[D+3]=a*z+p*B+_*ee+T*te}}function n6e(t,e,r){if(t.count!==e.count)return void T7.error("source and destination buffers need to have the same number of elements");const i=t.count,n=r[0],s=r[1],o=r[2],a=r[3],l=r[4],c=r[5],h=r[6],p=r[7],f=r[8],m=t.typedBuffer,g=t.typedBufferStride,_=e.typedBuffer,b=e.typedBufferStride;for(let w=0;w<i;w++){const x=w*g,T=w*b,E=_[T],C=_[T+1],A=_[T+2],I=_[T+3];m[x]=n*E+a*C+h*A,m[x+1]=s*E+l*C+p*A,m[x+2]=o*E+c*C+f*A,m[x+3]=I}}function S3t(t,e){const r=Math.min(t.count,e.count),i=t.typedBuffer,n=t.typedBufferStride,s=e.typedBuffer,o=e.typedBufferStride;for(let a=0;a<r;a++){const l=a*n,c=a*o,h=s[c],p=s[c+1],f=s[c+2],m=h*h+p*p+f*f;if(m>0){const g=1/Math.sqrt(m);i[l]=g*h,i[l+1]=g*p,i[l+2]=g*f}}}function Dte(t,e,r){const i=Math.min(t.count,e.count),n=t.typedBuffer,s=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;for(let l=0;l<i;l++){const c=l*s,h=l*a;n[c]=r*o[h],n[c+1]=r*o[h+1],n[c+2]=r*o[h+2],n[c+3]=r*o[h+3]}}function E3t(t,e,r){const i=Math.min(t.count,e.count),n=t.typedBuffer,s=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;for(let l=0;l<i;l++){const c=l*s,h=l*a;n[c]=o[h]>>r,n[c+1]=o[h+1]>>r,n[c+2]=o[h+2]>>r,n[c+3]=o[h+3]>>r}}Object.freeze(Object.defineProperty({__proto__:null,normalize:S3t,scale:Dte,shiftRight:E3t,transformMat3:n6e,transformMat4:T3t},Symbol.toStringTag,{value:"Module"}));function C3t(t,e,r){const i=t.typedBuffer,n=t.typedBufferStride,s=e.typedBuffer,o=e.typedBufferStride,a=r?r.count:e.count;let l=(r&&r.dstIndex?r.dstIndex:0)*n,c=(r&&r.srcIndex?r.srcIndex:0)*o;for(let h=0;h<a;++h){for(let p=0;p<9;++p)i[l+p]=s[c+p];l+=n,c+=o}}Object.freeze(Object.defineProperty({__proto__:null,copy:C3t},Symbol.toStringTag,{value:"Module"}));function A3t(t,e,r){const i=t.typedBuffer,n=t.typedBufferStride,s=e.typedBuffer,o=e.typedBufferStride,a=r?r.count:e.count;let l=(r&&r.dstIndex?r.dstIndex:0)*n,c=(r&&r.srcIndex?r.srcIndex:0)*o;for(let h=0;h<a;++h){for(let p=0;p<16;++p)i[l+p]=s[c+p];l+=n,c+=o}}Object.freeze(Object.defineProperty({__proto__:null,copy:A3t},Symbol.toStringTag,{value:"Module"}));function R3t(t,e,r){const i=t.typedBuffer,n=t.typedBufferStride,s=e.typedBuffer,o=e.typedBufferStride,a=r?r.count:e.count;let l=(r&&r.dstIndex?r.dstIndex:0)*n,c=(r&&r.srcIndex?r.srcIndex:0)*o;for(let h=0;h<a;++h)i[l]=s[c],l+=n,c+=o}function UU(t,e){const r=t.count;e||(e=new t.TypedArrayConstructor(r));for(let i=0;i<r;i++)e[i]=t.get(i);return e}Object.freeze(Object.defineProperty({__proto__:null,copy:R3t,makeDense:UU},Symbol.toStringTag,{value:"Module"}));function s6e(t,e,r){const i=t.typedBuffer,n=t.typedBufferStride,s=e.typedBuffer,o=e.typedBufferStride,a=r?r.count:e.count;let l=(r&&r.dstIndex?r.dstIndex:0)*n,c=(r&&r.srcIndex?r.srcIndex:0)*o;for(let h=0;h<a;++h)i[l]=s[c],i[l+1]=s[c+1],l+=n,c+=o}function o6e(t,e,r){const i=t.typedBuffer,n=t.typedBufferStride,s=e.typedBuffer,o=e.typedBufferStride,a=r?r.count:e.count;let l=(r&&r.dstIndex?r.dstIndex:0)*n,c=(r&&r.srcIndex?r.srcIndex:0)*o;if(fvt(e.elementType)){const h=mvt(e.elementType);if(pvt(e.elementType))for(let p=0;p<a;++p)i[l]=Math.max(s[c]/h,-1),i[l+1]=Math.max(s[c+1]/h,-1),l+=n,c+=o;else for(let p=0;p<a;++p)i[l]=s[c]/h,i[l+1]=s[c+1]/h,l+=n,c+=o}else s6e(t,e,r);return t}function O3t(t,e,r,i){const n=t.typedBuffer,s=t.typedBufferStride,o=(i==null?void 0:i.count)??t.count;let a=((i==null?void 0:i.dstIndex)??0)*s;for(let l=0;l<o;++l)n[a]=e,n[a+1]=r,a+=s}Object.freeze(Object.defineProperty({__proto__:null,copy:s6e,fill:O3t,normalizeIntegerBuffer:o6e},Symbol.toStringTag,{value:"Module"}));function L7(t,e,r){const i=t.typedBuffer,n=t.typedBufferStride,s=e.typedBuffer,o=e.typedBufferStride,a=r?r.count:e.count;let l=(r&&r.dstIndex?r.dstIndex:0)*n,c=(r&&r.srcIndex?r.srcIndex:0)*o;for(let h=0;h<a;++h)i[l]=s[c],i[l+1]=s[c+1],i[l+2]=s[c+2],l+=n,c+=o}function M3t(t,e,r,i,n){const s=t.typedBuffer,o=t.typedBufferStride,a=(n==null?void 0:n.count)??t.count;let l=((n==null?void 0:n.dstIndex)??0)*o;for(let c=0;c<a;++c)s[l]=e,s[l+1]=r,s[l+2]=i,l+=o}Object.freeze(Object.defineProperty({__proto__:null,copy:L7,fill:M3t},Symbol.toStringTag,{value:"Module"}));function a6e(t,e,r){const i=t.typedBuffer,n=t.typedBufferStride,s=e.typedBuffer,o=e.typedBufferStride,a=r?r.count:e.count;let l=(r&&r.dstIndex?r.dstIndex:0)*n,c=(r&&r.srcIndex?r.srcIndex:0)*o;for(let h=0;h<a;++h)i[l]=s[c],i[l+1]=s[c+1],i[l+2]=s[c+2],i[l+3]=s[c+3],l+=n,c+=o}function l6e(t,e,r,i,n,s){const o=t.typedBuffer,a=t.typedBufferStride,l=(s==null?void 0:s.count)??t.count;let c=((s==null?void 0:s.dstIndex)??0)*a;for(let h=0;h<l;++h)o[c]=e,o[c+1]=r,o[c+2]=i,o[c+3]=n,c+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:a6e,fill:l6e},Symbol.toStringTag,{value:"Module"}));function rS(t,e){return new t(new ArrayBuffer(e*t.ElementCount*vNe(t.ElementType)))}let c6e=class{constructor(e){this._streamDataRequester=e}async loadJSON(e,r){return this._load("json",e,r)}async loadBinary(e,r){return cd(e)?(lr(r),Une(e)):this._load("binary",e,r)}async loadImage(e,r){return this._load("image",e,r)}async _load(e,r,i){if(R(this._streamDataRequester))return(await ei(r,{responseType:P3t[e]})).data;const n=await hm(this._streamDataRequester.request(r,e,i));if(n.ok===!0)return n.value;throw Mu(n.error),new H("",`Request for resource failed: ${n.error}`)}};const P3t={image:"image",binary:"array-buffer",json:"json"};function I3t(t={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...t}}function $3t(t,e={}){return{data:t,parameters:{wrap:{s:$t.REPEAT,t:$t.REPEAT,...e.wrap},noUnpackFlip:!0,mipmap:!1,...e}}}let C2=class{constructor(e,r,i=""){this.major=e,this.minor=r,this._context=i}lessThan(e,r){return this.major<e||e===this.major&&this.minor<r}since(e,r){return!this.lessThan(e,r)}validate(e){if(this.major!==e.major){const r=this._context&&this._context+":",i=this._context&&this._context+" ";throw new H(r+"unsupported-version",`Required major ${i}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new C2(this.major,this.minor,this._context)}static parse(e,r=""){const[i,n]=e.split("."),s=/^\s*\d+\s*$/;if(!i||!i.match||!i.match(s))throw new H((r&&r+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!n||!n.match||!n.match(s))throw new H((r&&r+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});const o=parseInt(i,10),a=parseInt(n,10);return new C2(o,a,r)}},Lve=class{constructor(e){this._data=e,this._offset4=0,this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const e=this._offset4;return this._offset4+=1,this._dataUint32[e]}readUint8Array(e){const r=4*this._offset4;return this._offset4+=e/4,new Uint8Array(this._data,r,e)}remainingBytes(){return this._data.byteLength-4*this._offset4}};var iL,Dve;(function(t){t.SCALAR="SCALAR",t.VEC2="VEC2",t.VEC3="VEC3",t.VEC4="VEC4",t.MAT2="MAT2",t.MAT3="MAT3",t.MAT4="MAT4"})(iL||(iL={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(Dve||(Dve={}));const u6e={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},L3t={pbrMetallicRoughness:u6e,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},D3t={ESRI_externalColorMixMode:"tint"},Nve=(t={})=>{const e={...u6e,...t.pbrMetallicRoughness},r=N3t({...D3t,...t.extras});return{...L3t,...t,pbrMetallicRoughness:e,extras:r}};function N3t(t){switch(t.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:t.ESRI_externalColorMixMode,t.ESRI_externalColorMixMode="tint"}return t}const F3t={magFilter:it.LINEAR,minFilter:it.LINEAR_MIPMAP_LINEAR,wrapS:$t.REPEAT,wrapT:$t.REPEAT},k3t=t=>({...F3t,...t});function U3t(t){let e,r;return t.replace(/^(.*\/)?([^/]*)$/,(i,n,s)=>(e=n||"",r=s||"","")),{dirPart:e,filePart:r}}const H5={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};let z3t=class E1{constructor(e,r,i,n){if(this._context=e,this.uri=r,this.json=i,this._glbBuffer=n,this._bufferLoaders=new Map,this._textureLoaders=new Map,this._textureCache=new Map,this._materialCache=new Map,this._nodeParentMap=new Map,this._nodeTransformCache=new Map,this._supportedExtensions=["KHR_texture_basisu"],this._baseUri=U3t(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),i.scenes==null)throw new H("gltf-loader-unsupported-feature","Scenes must be defined.");if(i.meshes==null)throw new H("gltf-loader-unsupported-feature","Meshes must be defined");if(i.nodes==null)throw new H("gltf-loader-unsupported-feature","Nodes must be defined.");this._computeNodeParents()}static async load(e,r,i){if(cd(r)){const o=f3(r);if(o&&o.mediaType!=="model/gltf-binary")try{const l=JSON.parse(o.isBase64?atob(o.data):o.data);return new E1(e,r,l)}catch{}const a=Une(r);if(E1._isGLBData(a))return this._fromGLBData(e,r,a)}if(r.endsWith(".gltf")){const o=await e.loadJSON(r,i);return new E1(e,r,o)}const n=await e.loadBinary(r,i);if(E1._isGLBData(n))return this._fromGLBData(e,r,n);const s=await e.loadJSON(r,i);return new E1(e,r,s)}static _isGLBData(e){if(e==null)return!1;const r=new Lve(e);return r.remainingBytes()>=4&&r.readUint32()===H5.MAGIC}static async _fromGLBData(e,r,i){const n=await E1._parseGLBData(i);return new E1(e,r,n.json,n.binaryData)}static async _parseGLBData(e){const r=new Lve(e);if(r.remainingBytes()<12)throw new H("gltf-loader-error","GLB binary data is insufficiently large.");const i=r.readUint32(),n=r.readUint32(),s=r.readUint32();if(i!==H5.MAGIC)throw new H("gltf-loader-error","Magic first 4 bytes do not fit to expected GLB value.");if(e.byteLength<s)throw new H("gltf-loader-error","GLB binary data is smaller than header specifies.");if(n!==2)throw new H("gltf-loader-unsupported-feature","An unsupported GLB container version was detected. Only version 2 is supported.");let o,a,l=0;for(;r.remainingBytes()>=8;){const c=r.readUint32(),h=r.readUint32();if(l===0){if(h!==H5.CHUNK_TYPE_JSON)throw new H("gltf-loader-error","First GLB chunk must be JSON.");if(c<0)throw new H("gltf-loader-error","No JSON data found.");o=await a3t(r.readUint8Array(c))}else if(l===1){if(h!==H5.CHUNK_TYPE_BIN)throw new H("gltf-loader-unsupported-feature","Second GLB chunk expected to be BIN.");a=r.readUint8Array(c)}else re.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 GLB chunks detected. Skipping.");l+=1}if(!o)throw new H("gltf-loader-error","No GLB JSON chunk detected.");return{json:o,binaryData:a}}async getBuffer(e,r){const i=this.json.buffers[e];if(i.uri==null){if(this._glbBuffer==null)throw new H("gltf-loader-error","GLB buffer not present");return this._glbBuffer}const n=await this._getBufferLoader(e,r);if(n.byteLength!==i.byteLength)throw new H("gltf-loader-error","Buffer byte lengths should match.");return n}async _getBufferLoader(e,r){const i=this._bufferLoaders.get(e);if(i)return i;const n=this.json.buffers[e].uri,s=this._context.loadBinary(this._resolveUri(n),r).then(o=>new Uint8Array(o));return this._bufferLoaders.set(e,s),s}async getAccessor(e,r){if(!this.json.accessors)throw new H("gltf-loader-unsupported-feature","Accessors missing.");const i=this.json.accessors[e];if((i==null?void 0:i.bufferView)==null)throw new H("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(i.type in[iL.MAT2,iL.MAT3,iL.MAT4])throw new H("gltf-loader-unsupported-feature",`AttributeType ${i.type} is not supported`);const n=this.json.bufferViews[i.bufferView],s=await this.getBuffer(n.buffer,r),o=j3t[i.type],a=G3t[i.componentType],l=o*a,c=n.byteStride||l;return{raw:s.buffer,byteStride:c,byteOffset:s.byteOffset+(n.byteOffset||0)+(i.byteOffset||0),entryCount:i.count,isDenselyPacked:c===l,componentCount:o,componentByteSize:a,componentType:i.componentType,min:i.min,max:i.max,normalized:!!i.normalized}}async getIndexData(e,r){if(e.indices==null)return;const i=await this.getAccessor(e.indices,r);if(i.isDenselyPacked)switch(i.componentType){case ft.UNSIGNED_BYTE:return new Uint8Array(i.raw,i.byteOffset,i.entryCount);case ft.UNSIGNED_SHORT:return new Uint16Array(i.raw,i.byteOffset,i.entryCount);case ft.UNSIGNED_INT:return new Uint32Array(i.raw,i.byteOffset,i.entryCount)}else switch(i.componentType){case ft.UNSIGNED_BYTE:return UU(this._wrapAccessor(GO,i));case ft.UNSIGNED_SHORT:return UU(this._wrapAccessor(KB,i));case ft.UNSIGNED_INT:return UU(this._wrapAccessor(e7,i))}}async getPositionData(e,r){if(e.attributes.POSITION==null)throw new H("gltf-loader-unsupported-feature","No POSITION vertex data found.");const i=await this.getAccessor(e.attributes.POSITION,r);if(i.componentType!==ft.FLOAT)throw new H("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+ft[i.componentType]);if(i.componentCount!==3)throw new H("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+i.componentCount.toFixed());return this._wrapAccessor(Ui,i)}async getNormalData(e,r){if(e.attributes.NORMAL==null)throw new H("gltf-loader-error","No NORMAL vertex data found.");const i=await this.getAccessor(e.attributes.NORMAL,r);if(i.componentType!==ft.FLOAT)throw new H("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+ft[i.componentType]);if(i.componentCount!==3)throw new H("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+i.componentCount.toFixed());return this._wrapAccessor(Ui,i)}async getTangentData(e,r){if(e.attributes.TANGENT==null)throw new H("gltf-loader-error","No TANGENT vertex data found.");const i=await this.getAccessor(e.attributes.TANGENT,r);if(i.componentType!==ft.FLOAT)throw new H("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+ft[i.componentType]);if(i.componentCount!==4)throw new H("gltf-loader-unsupported-feature","TANGENT vertex attribute must have 4 components, but found "+i.componentCount.toFixed());return new Yu(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*i.entryCount)}async getTextureCoordinates(e,r){if(e.attributes.TEXCOORD_0==null)throw new H("gltf-loader-error","No TEXCOORD_0 vertex data found.");const i=await this.getAccessor(e.attributes.TEXCOORD_0,r);if(i.componentCount!==2)throw new H("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+i.componentCount.toFixed());if(i.componentType===ft.FLOAT)return this._wrapAccessor(q_,i);if(!i.normalized)throw new H("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return H3t(i)}async getVertexColors(e,r){if(e.attributes.COLOR_0==null)throw new H("gltf-loader-error","No COLOR_0 vertex data found.");const i=await this.getAccessor(e.attributes.COLOR_0,r);if(i.componentCount!==4&&i.componentCount!==3)throw new H("gltf-loader-unsupported-feature","COLOR_0 attribute must have 3 or 4 components, but found "+i.componentCount.toFixed());if(i.componentCount===4){if(i.componentType===ft.FLOAT)return this._wrapAccessor(Yu,i);if(i.componentType===ft.UNSIGNED_BYTE)return this._wrapAccessor(gl,i);if(i.componentType===ft.UNSIGNED_SHORT)return this._wrapAccessor(jN,i)}else if(i.componentCount===3){if(i.componentType===ft.FLOAT)return this._wrapAccessor(Ui,i);if(i.componentType===ft.UNSIGNED_BYTE)return this._wrapAccessor(bD,i);if(i.componentType===ft.UNSIGNED_SHORT)return this._wrapAccessor(QB,i)}throw new H("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+ft[i.componentType])}hasPositions(e){return e.attributes.POSITION!==void 0}hasNormals(e){return e.attributes.NORMAL!==void 0}hasVertexColors(e){return e.attributes.COLOR_0!==void 0}hasTextureCoordinates(e){return e.attributes.TEXCOORD_0!==void 0}hasTangents(e){return e.attributes.TANGENT!==void 0}async getMaterial(e,r,i){var s,o,a,l,c,h,p,f,m,g;let n=e.material?this._materialCache.get(e.material):void 0;if(!n){const _=e.material!=null?Nve(this.json.materials[e.material]):Nve(),b=_.pbrMetallicRoughness,w=this.hasVertexColors(e),x=this.getTexture(b.baseColorTexture,r),T=this.getTexture(_.normalTexture,r),E=i?this.getTexture(_.occlusionTexture,r):void 0,C=i?this.getTexture(_.emissiveTexture,r):void 0,A=i?this.getTexture(b.metallicRoughnessTexture,r):void 0,I=e.material!=null?e.material:-1;n={alphaMode:_.alphaMode,alphaCutoff:_.alphaCutoff,color:b.baseColorFactor,doubleSided:!!_.doubleSided,colorTexture:await x,normalTexture:await T,name:_.name,id:I,occlusionTexture:await E,emissiveTexture:await C,emissiveFactor:_.emissiveFactor,metallicFactor:b.metallicFactor,roughnessFactor:b.roughnessFactor,metallicRoughnessTexture:await A,hasVertexColors:w,ESRI_externalColorMixMode:_.extras.ESRI_externalColorMixMode,colorTextureTransform:(o=(s=b==null?void 0:b.baseColorTexture)==null?void 0:s.extensions)==null?void 0:o.KHR_texture_transform,normalTextureTransform:(l=(a=_.normalTexture)==null?void 0:a.extensions)==null?void 0:l.KHR_texture_transform,occlusionTextureTransform:(h=(c=_.occlusionTexture)==null?void 0:c.extensions)==null?void 0:h.KHR_texture_transform,emissiveTextureTransform:(f=(p=_.emissiveTexture)==null?void 0:p.extensions)==null?void 0:f.KHR_texture_transform,metallicRoughnessTextureTransform:(g=(m=b==null?void 0:b.metallicRoughnessTexture)==null?void 0:m.extensions)==null?void 0:g.KHR_texture_transform}}return n}async getTexture(e,r){if(!e)return;if((e.texCoord||0)!==0)throw new H("gltf-loader-unsupported-feature","Only TEXCOORD with index 0 is supported.");const i=e.index,n=this.json.textures[i],s=k3t(n.sampler!=null?this.json.samplers[n.sampler]:{}),o=this._getTextureSourceId(n),a=this.json.images[o],l=await this._loadTextureImageData(i,n,r);return kie(this._textureCache,i,()=>{const c=p=>p===33071||p===33648||p===10497,h=p=>{throw new H("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${p}`)};return{data:l,wrapS:c(s.wrapS)?s.wrapS:h(s.wrapS),wrapT:c(s.wrapT)?s.wrapT:h(s.wrapT),minFilter:s.minFilter,name:a.name,id:i}})}getNodeTransform(e){if(e===void 0)return V3t;let r=this._nodeTransformCache.get(e);if(!r){const i=this.getNodeTransform(this._getNodeParent(e)),n=this.json.nodes[e];n.matrix?r=Mn($e(),i,n.matrix):n.translation||n.rotation||n.scale?(r=zO(i),n.translation&&Hc(r,r,n.translation),n.rotation&&(q5[3]=Jae(q5,n.rotation),Du(r,r,q5[3],q5)),n.scale&&J9(r,r,n.scale)):r=zO(i),this._nodeTransformCache.set(e,r)}return r}_wrapAccessor(e,r){return new e(r.raw,r.byteOffset,r.byteStride,r.byteOffset+r.byteStride*(r.entryCount-1)+r.componentByteSize*r.componentCount)}_resolveUri(e){return Fc(e,this._baseUri)}_getNodeParent(e){return this._nodeParentMap.get(e)}_checkVersionSupported(){const e=C2.parse(this.json.asset.version,"glTF");B3t.validate(e)}_checkRequiredExtensionsSupported(){const e=this.json;if(e.extensionsRequired&&!e.extensionsRequired.every(r=>this._supportedExtensions.includes(r)))throw new H("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+e.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((e,r)=>{e.children&&e.children.forEach(i=>{this._nodeParentMap.set(i,r)})})}async _loadTextureImageData(e,r,i){const n=this._textureLoaders.get(e);if(n)return n;const s=this._createTextureLoader(r,i);return this._textureLoaders.set(e,s),s}_getTextureSourceId(e){if(e.extensions!==void 0&&e.extensions.KHR_texture_basisu!==null)return e.extensions.KHR_texture_basisu.source;if(e.source!==null)return e.source;throw new H("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.")}async _createTextureLoader(e,r){const i=this._getTextureSourceId(e),n=this.json.images[i];if(n.uri){if(n.uri.endsWith(".ktx2")){const l=await this._context.loadBinary(this._resolveUri(n.uri),r);return new t6e(new Uint8Array(l))}return this._context.loadImage(this._resolveUri(n.uri),r)}if(n.bufferView==null)throw new H("gltf-loader-unsupported-feature","Image bufferView must be defined.");if(n.mimeType==null)throw new H("gltf-loader-unsupported-feature","Image mimeType must be defined.");const s=this.json.bufferViews[n.bufferView],o=await this.getBuffer(s.buffer,r);if(s.byteStride!=null)throw new H("gltf-loader-unsupported-feature","byteStride not supported for image buffer");const a=o.byteOffset+(s.byteOffset||0);return l3t(new Uint8Array(o.buffer,a,s.byteLength),n.mimeType)}async getLoadedBuffersSize(){if(this._glbBuffer)return this._glbBuffer.byteLength;const e=await cY(Array.from(this._bufferLoaders.values())),r=await cY(Array.from(this._textureLoaders.values()));return e.reduce((i,n)=>i+((n==null?void 0:n.byteLength)??0),0)+r.reduce((i,n)=>i+(n?zS(n)?n.data.byteLength:n.width*n.height*4:0),0)}};const V3t=TAe($e(),Math.PI/2),B3t=new C2(2,0,"glTF"),q5=Dp(),j3t={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},G3t={[ft.BYTE]:1,[ft.UNSIGNED_BYTE]:1,[ft.SHORT]:2,[ft.UNSIGNED_SHORT]:2,[ft.FLOAT]:4,[ft.UNSIGNED_INT]:4};function H3t(t){switch(t.componentType){case ft.BYTE:return new t7(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case ft.UNSIGNED_BYTE:return new JB(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case ft.SHORT:return new r7(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case ft.UNSIGNED_SHORT:return new Wae(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case ft.UNSIGNED_INT:return new Xae(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case ft.FLOAT:return new q_(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount)}}let q3t=0;async function h6e(t,e,r={},i=!0){const n=await z3t.load(t,e,r),s="gltf_"+q3t++,o={lods:[],materials:new Map,textures:new Map,meta:W3t(n)},a=!(!n.json.asset.extras||n.json.asset.extras.ESRI_type!=="symbolResource"),l=new Map;await X3t(n,async(h,p,f,m)=>{const g=l.get(f)??0;l.set(f,g+1);const _=h.mode!==void 0?h.mode:Ft.TRIANGLES,b=_===Ft.TRIANGLES||_===Ft.TRIANGLE_STRIP||_===Ft.TRIANGLE_FAN?_:null;if(R(b))return void re.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+Ft[_]+"). Skipping primitive.");if(!n.hasPositions(h))return void re.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.");const w=n.getPositionData(h,r),x=n.getMaterial(h,r,i),T=n.hasNormals(h)?n.getNormalData(h,r):null,E=n.hasTangents(h)?n.getTangentData(h,r):null,C=n.hasTextureCoordinates(h)?n.getTextureCoordinates(h,r):null,A=n.hasVertexColors(h)?n.getVertexColors(h,r):null,I=n.getIndexData(h,r),M={transform:zO(p),attributes:{position:await w,normal:T?await T:null,texCoord0:C?await C:null,color:A?await A:null,tangent:E?await E:null},indices:await I,primitiveType:b,material:Z3t(o,await x,s)};let D=null;v(o.meta)&&v(o.meta.ESRI_lod)&&o.meta.ESRI_lod.metric==="screenSpaceRadius"&&(D=o.meta.ESRI_lod.thresholds[f]),o.lods[f]=o.lods[f]||{parts:[],name:m,lodThreshold:D},o.lods[f].parts[g]=M});for(const h of o.lods)h.parts=h.parts.filter(p=>!!p);const c=await n.getLoadedBuffersSize();return{model:o,meta:{isEsriSymbolResource:a,uri:n.uri},customMeta:{},size:c}}function W3t(t){const e=t.json;let r=null;return e.nodes.forEach(i=>{const n=i.extras;v(n)&&(n.ESRI_proxyEllipsoid||n.ESRI_lod)&&(r=n)}),r}async function X3t(t,e){const r=t.json,i=r.scenes[r.scene||0].nodes,n=i.length>1,s=[];for(const a of i){const l=r.nodes[a];s.push(o(a,0)),Y3t(l)&&!n&&l.extensions.MSFT_lod.ids.forEach((c,h)=>o(c,h+1))}async function o(a,l){const c=r.nodes[a],h=t.getNodeTransform(a);if(c.weights!=null&&re.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported."),c.mesh!=null){const p=r.meshes[c.mesh];for(const f of p.primitives)s.push(e(f,h,l,p.name))}for(const p of c.children||[])s.push(o(p,l))}await Promise.all(s)}function Y3t(t){return t.extensions&&t.extensions.MSFT_lod&&Array.isArray(t.extensions.MSFT_lod.ids)}function Z3t(t,e,r){const i=s=>{const o=`${r}_tex_${s&&s.id}${s&&s.name?"_"+s.name:""}`;if(s&&!t.textures.has(o)){const a=$3t(s.data,{wrap:{s:s.wrapS,t:s.wrapT},mipmap:J3t.includes(s.minFilter),noUnpackFlip:!0});t.textures.set(o,a)}return o},n=`${r}_mat_${e.id}_${e.name}`;if(!t.materials.has(n)){const s=I3t({color:[e.color[0],e.color[1],e.color[2]],opacity:e.color[3],alphaMode:e.alphaMode,alphaCutoff:e.alphaCutoff,doubleSided:e.doubleSided,colorMixMode:e.ESRI_externalColorMixMode,textureColor:e.colorTexture?i(e.colorTexture):void 0,textureNormal:e.normalTexture?i(e.normalTexture):void 0,textureOcclusion:e.occlusionTexture?i(e.occlusionTexture):void 0,textureEmissive:e.emissiveTexture?i(e.emissiveTexture):void 0,textureMetallicRoughness:e.metallicRoughnessTexture?i(e.metallicRoughnessTexture):void 0,emissiveFactor:[e.emissiveFactor[0],e.emissiveFactor[1],e.emissiveFactor[2]],colorTextureTransform:e.colorTextureTransform,normalTextureTransform:e.normalTextureTransform,occlusionTextureTransform:e.occlusionTextureTransform,emissiveTextureTransform:e.emissiveTextureTransform,metallicRoughnessTextureTransform:e.metallicRoughnessTextureTransform,metallicFactor:e.metallicFactor,roughnessFactor:e.roughnessFactor});t.materials.set(n,s)}return n}const J3t=[it.LINEAR_MIPMAP_LINEAR,it.LINEAR_MIPMAP_NEAREST];function K3t(t,e=HO){return typeof t=="number"?e(t):Iie(t)||VT(t)?new Uint32Array(t):t}function Q3t(t){const e=typeof t=="number"?t:t.length;if(e<3)return[];const r=e-2,i=ENe(r);if(typeof t=="number"){let n=0;for(let s=0;s<r;s+=1)s%2==0?(i[n++]=s,i[n++]=s+1,i[n++]=s+2):(i[n++]=s+1,i[n++]=s,i[n++]=s+2)}else{let n=0;for(let s=0;s<r;s+=1)if(s%2==0){const o=t[s],a=t[s+1],l=t[s+2];i[n++]=o,i[n++]=a,i[n++]=l}else{const o=t[s+1],a=t[s],l=t[s+2];i[n++]=o,i[n++]=a,i[n++]=l}}return i}function eMt(t){const e=typeof t=="number"?t:t.length;if(e<3)return new Uint16Array(0);const r=e-2,i=r<=65536?new Uint16Array(3*r):new Uint32Array(3*r);if(typeof t=="number"){let n=0;for(let s=0;s<r;++s)i[n++]=0,i[n++]=s+1,i[n++]=s+2;return i}{const n=t[0];let s=t[1],o=0;for(let a=0;a<r;++a){const l=t[a+2];i[o++]=n,i[o++]=s,i[o++]=l,s=l}return i}}let tMt=class{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}},rMt=class{constructor(e,r,i){this.name=e,this.lodThreshold=r,this.pivotOffset=i,this.stageResources=new tMt,this.numberOfVertices=0}};const v0=re.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function d6e(t,e){const r=await iMt(t,e),i=await lMt(r.textureDefinitions??{},e);let n=0;for(const s in i)if(i.hasOwnProperty(s)){const o=i[s];n+=o!=null&&o.image?o.image.width*o.image.height*4:0}return{resource:r,textures:i,size:n+uOe(r)}}async function iMt(t,e){const r=v(e)&&e.streamDataRequester;if(r)return nMt(t,r,e);const i=await hm(ei(t,e));if(i.ok===!0)return i.value.data;Mu(i.error),p6e(i.error)}async function nMt(t,e,r){const i=await hm(e.request(t,"json",r));if(i.ok===!0)return i.value;Mu(i.error),p6e(i.error.details.url)}function p6e(t){throw new H("",`Request for object resource failed: ${t}`)}function sMt(t){const e=t.params,r=e.topology;let i=!0;switch(e.vertexAttributes||(v0.warn("Geometry must specify vertex attributes"),i=!1),e.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const s=e.faces;if(s){if(e.vertexAttributes)for(const o in e.vertexAttributes){const a=s[o];a&&a.values?(a.valueType!=null&&a.valueType!=="UInt32"&&(v0.warn(`Unsupported indexed geometry indices type '${a.valueType}', only UInt32 is currently supported`),i=!1),a.valuesPerElement!=null&&a.valuesPerElement!==1&&(v0.warn(`Unsupported indexed geometry values per element '${a.valuesPerElement}', only 1 is currently supported`),i=!1)):(v0.warn(`Indexed geometry does not specify face indices for '${o}' attribute`),i=!1)}}else v0.warn("Indexed geometries must specify faces"),i=!1;break}default:v0.warn(`Unsupported topology '${r}'`),i=!1}t.params.material||(v0.warn("Geometry requires material"),i=!1);const n=t.params.vertexAttributes;for(const s in n)n[s].values||(v0.warn("Geometries with externally defined attributes are not yet supported"),i=!1);return i}function oMt(t,e){const r=new Array,i=new Array,n=new Array,s=new D3,o=t.resource,a=C2.parse(o.version||"1.0","wosr");uMt.validate(a);const l=o.model.name,c=o.model.geometries,h=o.materialDefinitions??{},p=t.textures;let f=0;const m=new Map;for(let g=0;g<c.length;g++){const _=c[g];if(!sMt(_))continue;const b=cMt(_),w=_.params.vertexAttributes,x=[];for(const z in w){const B=w[z],ee=B.values;x.push([z,new Qe(ee,B.valuesPerElement,!0)])}const T=[];if(_.params.topology!=="PerAttributeArray"){const z=_.params.faces;for(const B in z)T.push([B,z[B].values])}const E=b.texture,C=p&&p[E];if(C&&!m.has(E)){const{image:z,params:B}=C,ee=new W2(z,B);i.push(ee),m.set(E,ee)}const A=m.get(E),I=A?A.id:void 0,M=b.material;let D=s.get(M,E);if(R(D)){const z=h[M.substring(M.lastIndexOf("/")+1)].params;z.transparency===1&&(z.transparency=0);const B=C&&C.alphaChannelUsage,ee=z.transparency>0||B==="transparency"||B==="maskAndTransparency",te=C?f6e(C.alphaChannelUsage):void 0,K={ambient:$c(z.diffuse),diffuse:$c(z.diffuse),opacity:1-(z.transparency||0),transparent:ee,textureAlphaMode:te,textureAlphaCutoff:.33,textureId:I,initTextureTransparent:!0,doubleSided:!0,cullFace:Ii.None,colorMixMode:z.externalColorMixMode||"tint",textureAlphaPremultiplied:!!C&&!!C.params.preMultiplyAlpha};v(e)&&e.materialParamsMixin&&Object.assign(K,e.materialParamsMixin),D=new P_(K),s.set(M,E,D)}n.push(D);const U=new As(D,x,T);f+=T.position?T.position.length:0,r.push(U)}return{engineResources:[{name:l,stageResources:{textures:i,materials:n,geometries:r},pivotOffset:o.model.pivotOffset,numberOfVertices:f,lodThreshold:null}],referenceBoundingBox:aMt(r)}}function aMt(t){const e=ki();return t.forEach(r=>{const i=r.boundingInfo;v(i)&&(ay(e,i.bbMin),ay(e,i.bbMax))}),e}async function lMt(t,e){const r=[];for(const s in t){const o=t[s],a=o.images[0].data;if(!a){v0.warn("Externally referenced texture data is not yet supported");continue}const l=o.encoding+";base64,"+a,c="/textureDefinitions/"+s,h=o.channels==="rgba"?o.alphaChannelUsage||"transparency":"none",p={noUnpackFlip:!0,wrap:{s:$t.REPEAT,t:$t.REPEAT},preMultiplyAlpha:f6e(h)!==gi.Opaque},f=v(e)&&e.disableTextures?Promise.resolve(null):O_(l,e);r.push(f.then(m=>({refId:c,image:m,params:p,alphaChannelUsage:h})))}const i=await Promise.all(r),n={};for(const s of i)n[s.refId]=s;return n}function f6e(t){switch(t){case"mask":return gi.Mask;case"maskAndTransparency":return gi.MaskBlend;case"none":return gi.Opaque;default:return gi.Blend}}function cMt(t){const e=t.params;return{id:1,material:e.material,texture:e.texture,region:e.texture}}const uMt=new C2(1,2,"wosr"),HE=2.1;async function m6e(t,e){const r=g6e(Put(t));if(r.fileType==="wosr"){const p=await(e.cache?e.cache.loadWOSR(r.url,e):d6e(r.url,e)),{engineResources:f,referenceBoundingBox:m}=oMt(p,e);return{lods:f,referenceBoundingBox:m,isEsriSymbolResource:!1,isWosr:!0}}const i=await(e.cache?e.cache.loadGLTF(r.url,e,!!e.usePBR):h6e(new c6e(e.streamDataRequester),r.url,e,e.usePBR)),n=Xs(i.model.meta,"ESRI_proxyEllipsoid"),s=i.meta.isEsriSymbolResource&&v(n)&&i.meta.uri.includes("/RealisticTrees/");s&&!i.customMeta.esriTreeRendering&&(i.customMeta.esriTreeRendering=!0,mMt(i,n));const o=!!e.usePBR,a=i.meta.isEsriSymbolResource?{usePBR:o,isSchematic:!1,treeRendering:s,mrrFactors:[0,1,.2]}:{usePBR:o,isSchematic:!1,treeRendering:!1,mrrFactors:[0,1,.5]},l={...e.materialParamsMixin,treeRendering:s},{engineResources:c,referenceBoundingBox:h}=y6e(i,a,l,e.skipHighLods&&r.specifiedLodIndex==null?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:r.specifiedLodIndex});return{lods:c,referenceBoundingBox:h,isEsriSymbolResource:i.meta.isEsriSymbolResource,isWosr:!1}}function g6e(t){const e=t.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return e?{fileType:"gltf",url:e[1],specifiedLodIndex:e[4]!=null?Number(e[4]):null}:t.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:t,specifiedLodIndex:null}:{fileType:"unknown",url:t,specifiedLodIndex:null}}function y6e(t,e,r,i){const n=t.model,s=new Array,o=new Map,a=new Map,l=n.lods.length,c=ki();return n.lods.forEach((h,p)=>{const f=i.skipHighLods===!0&&(l>1&&p===0||l>3&&p===1)||i.skipHighLods===!1&&i.singleLodIndex!=null&&p!==i.singleLodIndex;if(f&&p!==0)return;const m=new rMt(h.name,h.lodThreshold,[0,0,0]);h.parts.forEach(g=>{const _=f?new P_({}):hMt(n,g,m,e,r,o,a),{geometry:b,vertexCount:w}=dMt(g,v(_)?_:new P_({})),x=b.boundingInfo;v(x)&&p===0&&(ay(c,x.bbMin),ay(c,x.bbMax)),v(_)&&(m.stageResources.geometries.push(b),m.numberOfVertices+=w)}),f||s.push(m)}),{engineResources:s,referenceBoundingBox:c}}function hMt(t,e,r,i,n,s,o){const a=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),l=t.materials.get(e.material),c=v(e.attributes.texCoord0),h=v(e.attributes.normal);if(R(l))return null;const p=pMt(l.alphaMode);if(!s.has(a)){if(c){const E=(C,A=!1)=>{if(v(C)&&!o.has(C)){const I=t.textures.get(C);if(v(I)){const M=I.data;o.set(C,new W2(zS(M)?M.data:M,{...I.parameters,preMultiplyAlpha:!zS(M)&&A,encoding:zS(M)&&v(M.encoding)?M.encoding:void 0}))}}};E(l.textureColor,p!==gi.Opaque),E(l.textureNormal),E(l.textureOcclusion),E(l.textureEmissive),E(l.textureMetallicRoughness)}const m=l.color[0]**(1/HE),g=l.color[1]**(1/HE),_=l.color[2]**(1/HE),b=l.emissiveFactor[0]**(1/HE),w=l.emissiveFactor[1]**(1/HE),x=l.emissiveFactor[2]**(1/HE),T=v(l.textureColor)&&c?o.get(l.textureColor):null;s.set(a,new P_({...i,transparent:p===gi.Blend,customDepthTest:f2.Lequal,textureAlphaMode:p,textureAlphaCutoff:l.alphaCutoff,diffuse:[m,g,_],ambient:[m,g,_],opacity:l.opacity,doubleSided:l.doubleSided,doubleSidedType:"winding-order",cullFace:l.doubleSided?Ii.None:Ii.Back,hasVertexColors:!!e.attributes.color,hasVertexTangents:!!e.attributes.tangent,normalType:h?ci.Attribute:ci.ScreenDerivative,castShadows:!0,receiveSSAO:!0,textureId:v(T)?T.id:void 0,colorMixMode:l.colorMixMode,normalTextureId:v(l.textureNormal)&&c?o.get(l.textureNormal).id:void 0,textureAlphaPremultiplied:v(T)&&!!T.params.preMultiplyAlpha,occlusionTextureId:v(l.textureOcclusion)&&c?o.get(l.textureOcclusion).id:void 0,emissiveTextureId:v(l.textureEmissive)&&c?o.get(l.textureEmissive).id:void 0,metallicRoughnessTextureId:v(l.textureMetallicRoughness)&&c?o.get(l.textureMetallicRoughness).id:void 0,emissiveFactor:[b,w,x],mrrFactors:[l.metallicFactor,l.roughnessFactor,i.mrrFactors[2]],isSchematic:!1,colorTextureTransformMatrix:Ig(l.colorTextureTransform),normalTextureTransformMatrix:Ig(l.normalTextureTransform),occlusionTextureTransformMatrix:Ig(l.occlusionTextureTransform),emissiveTextureTransformMatrix:Ig(l.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:Ig(l.metallicRoughnessTextureTransform),...n}))}const f=s.get(a);if(r.stageResources.materials.push(f),c){const m=g=>{v(g)&&r.stageResources.textures.push(o.get(g))};m(l.textureColor),m(l.textureNormal),m(l.textureOcclusion),m(l.textureEmissive),m(l.textureMetallicRoughness)}return f}function dMt(t,e){const r=t.attributes.position.count,i=fMt(t.indices||r,t.primitiveType),n=rS(Ui,r);KN(n,t.attributes.position,t.transform);const s=[[O.POSITION,new Qe(n.typedBuffer,n.elementCount,!0)]],o=[[O.POSITION,i]];if(v(t.attributes.normal)){const a=rS(Ui,r);kO(W5,t.transform),bw(a,t.attributes.normal,W5),s.push([O.NORMAL,new Qe(a.typedBuffer,a.elementCount,!0)]),o.push([O.NORMAL,i])}if(v(t.attributes.tangent)){const a=rS(Yu,r);kO(W5,t.transform),n6e(a,t.attributes.tangent,W5),s.push([O.TANGENT,new Qe(a.typedBuffer,a.elementCount,!0)]),o.push([O.TANGENT,i])}if(v(t.attributes.texCoord0)){const a=rS(q_,r);o6e(a,t.attributes.texCoord0),s.push([O.UV0,new Qe(a.typedBuffer,a.elementCount,!0)]),o.push([O.UV0,i])}if(v(t.attributes.color)){const a=rS(gl,r);if(t.attributes.color.elementCount===4)t.attributes.color instanceof Yu?Dte(a,t.attributes.color,255):t.attributes.color instanceof gl?a6e(a,t.attributes.color):t.attributes.color instanceof jN&&Dte(a,t.attributes.color,1/256);else{l6e(a,255,255,255,255);const l=new bD(a.buffer,0,4);t.attributes.color instanceof Ui?bte(l,t.attributes.color,255):t.attributes.color instanceof bD?L7(l,t.attributes.color):t.attributes.color instanceof QB&&bte(l,t.attributes.color,1/256)}s.push([O.COLOR,new Qe(a.typedBuffer,a.elementCount,!0)]),o.push([O.COLOR,i])}return{geometry:new As(e,s,o),vertexCount:r}}const W5=vi();function pMt(t){switch(t){case"BLEND":return gi.Blend;case"MASK":return gi.Mask;case"OPAQUE":case null:case void 0:return gi.Opaque}}function fMt(t,e){switch(e){case Ft.TRIANGLES:return K3t(t);case Ft.TRIANGLE_STRIP:return Q3t(t);case Ft.TRIANGLE_FAN:return eMt(t)}}function mMt(t,e){for(let r=0;r<t.model.lods.length;++r){const i=t.model.lods[r];for(const n of i.parts){const s=n.attributes.normal;if(R(s))return;const o=n.attributes.position,a=o.count,l=P(),c=P(),h=P(),p=rS(gl,a),f=rS(Ui,a),m=ya($e(),n.transform);for(let g=0;g<a;g++){o.getVec(g,c),s.getVec(g,l),Ke(c,c,n.transform),ge(h,c,e.center),K8(h,h,e.radius);const _=h[2],b=Pe(h),w=Math.min(.45+.55*b*b,1);K8(h,h,e.radius),m!==null&&Ke(h,h,m),we(h,h),r+1!==t.model.lods.length&&t.model.lods.length>1&&fs(h,h,l,_>-1?.2:Math.min(-4*_-3.8,1)),f.setVec(g,h),p.set(g,0,255*w),p.set(g,1,255*w),p.set(g,2,255*w),p.set(g,3,255)}n.attributes.normal=f,n.attributes.color=p}}}const VJt=Object.freeze(Object.defineProperty({__proto__:null,fetch:m6e,gltfToEngineResources:y6e,parseUrl:g6e},Symbol.toStringTag,{value:"Module"}));var Ji;function gMt(t){let e=mn().mat4f64(O.LOCALTRANSFORM).mat4f64(O.GLOBALTRANSFORM).vec4f64(O.BOUNDINGSPHERE).vec3f64(O.MODELORIGIN).mat3f(O.MODEL).mat3f(O.MODELNORMAL).vec2f(O.MODELSCALEFACTORS);return t.includes("color")&&(e=e.vec4f(O.COLOR)),t.includes("featureAttribute")&&(e=e.vec4f(O.FEATUREATTRIBUTE)),e=e.u8(O.STATE).u8(O.LODLEVEL),t.includes(O.OBJECTANDLAYERIDCOLOR)&&(e=e.vec4u8(O.OBJECTANDLAYERIDCOLOR)),e.alignTo(8),e}(function(t){t[t.ALLOCATED=1]="ALLOCATED",t[t.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",t[t.VISIBLE=4]="VISIBLE",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",t[t.REMOVE=32]="REMOVE",t[t.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",t[t.ACTIVE=18]="ACTIVE"})(Ji||(Ji={}));let yMt=class{constructor(e){this.localTransform=e.getField(O.LOCALTRANSFORM,vD),this.globalTransform=e.getField(O.GLOBALTRANSFORM,vD),this.modelOrigin=e.getField(O.MODELORIGIN,ml),this.model=e.getField(O.MODEL,fw),this.modelNormal=e.getField(O.MODELNORMAL,fw),this.modelScaleFactors=e.getField(O.MODELSCALEFACTORS,q_),this.boundingSphere=e.getField(O.BOUNDINGSPHERE,ZB),this.color=e.getField(O.COLOR,Yu),this.featureAttribute=e.getField(O.FEATUREATTRIBUTE,Yu),this.state=e.getField(O.STATE,GO),this.lodLevel=e.getField(O.LODLEVEL,GO),this.objectAndLayerIdColor=e.getField(O.OBJECTANDLAYERIDCOLOR,gl)}},fA=class extends be{constructor(e,r){super(e),this.events=new Sn,this._capacity=0,this._size=0,this._next=0,this._buffer=null,this._view=null,this._layout=gMt(r)}get capacity(){return this._capacity}get size(){return this._size}get buffer(){return this._buffer.buffer}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const e=this._findSlot();return this._view.state.set(e,Ji.ALLOCATED),this._size++,this.events.emit("instances-changed"),e}removeInstance(e){const r=this._view.state;wt(e>=0&&e<this._capacity&&(r.get(e)&Ji.ALLOCATED)!=0,"invalid instance handle"),this._getStateFlag(e,Ji.ACTIVE)?this._setStateFlags(e,Ji.REMOVE):this.freeInstance(e),this.events.emit("instances-changed")}freeInstance(e){const r=this._view.state;wt(e>=0&&e<this._capacity&&(r.get(e)&Ji.ALLOCATED)!=0,"invalid instance handle"),r.set(e,0),this._size--}setLocalTransform(e,r,i=!0){this._view.localTransform.setMat(e,r),i&&this.updateModelTransform(e)}getLocalTransform(e,r){this._view.localTransform.getMat(e,r)}setGlobalTransform(e,r,i=!0){this._view.globalTransform.setMat(e,r),i&&this.updateModelTransform(e)}getGlobalTransform(e,r){this._view.globalTransform.getMat(e,r)}updateModelTransform(e){const r=this._view,i=Pv,n=Yp;r.localTransform.getMat(e,Fve),r.globalTransform.getMat(e,lW);const s=Mn(lW,lW,Fve);he(i,s[12],s[13],s[14]),r.modelOrigin.setVec(e,i),Op(n,s),r.model.setMat(e,n);const o=nyt(Pv,s);o.sort(),r.modelScaleFactors.set(e,0,o[1]),r.modelScaleFactors.set(e,1,o[2]),Lw(n,n),Xu(n,n),r.modelNormal.setMat(e,n),this._setStateFlags(e,Ji.TRANSFORM_CHANGED),this.events.emit("instance-transform-changed",{index:e})}getModelTransform(e,r){const i=this._view;i.model.getMat(e,Yp),i.modelOrigin.getVec(e,Pv),r[0]=Yp[0],r[1]=Yp[1],r[2]=Yp[2],r[3]=0,r[4]=Yp[3],r[5]=Yp[4],r[6]=Yp[5],r[7]=0,r[8]=Yp[6],r[9]=Yp[7],r[10]=Yp[8],r[11]=0,r[12]=Pv[0],r[13]=Pv[1],r[14]=Pv[2],r[15]=1}applyShaderTransformation(e,r){v(this.shaderTransformation)&&this.shaderTransformation.applyTransform(this,e,r)}getCombinedModelTransform(e,r){return this.getModelTransform(e,r),v(this.shaderTransformation)&&this.shaderTransformation.applyTransform(this,e,r),r}getCombinedLocalTransform(e,r){return this._view.localTransform.getMat(e,r),v(this.shaderTransformation)&&this.shaderTransformation.applyTransform(this,e,r),r}getCombinedMaxScaleFactor(e){let r=this._view.modelScaleFactors.get(e,1);if(v(this.shaderTransformation)){const i=this.shaderTransformation.scaleFactor(Pv,this,e);r*=Math.max(i[0],i[1],i[2])}return r}getCombinedMedianScaleFactor(e){let r=this._view.modelScaleFactors.get(e,0);if(v(this.shaderTransformation)){const i=this.shaderTransformation.scaleFactor(Pv,this,e);r*=_Mt(i[0],i[1],i[2])}return r}getModel(e,r){this._view.model.getMat(e,r)}setFeatureAttribute(e,r){this._view.featureAttribute.setVec(e,r)}getFeatureAttribute(e,r){this._view.featureAttribute.getVec(e,r)}setColor(e,r){this._view.color.setVec(e,r)}setObjectAndLayerIdColor(e,r){this._view.objectAndLayerIdColor.setVec(e,r)}getColor(e,r){this._view.color.getVec(e,r)}setVisible(e,r){r!==this.getVisible(e)&&(this._setStateFlag(e,Ji.VISIBLE,r),this.events.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this._getStateFlag(e,Ji.VISIBLE)}setHighlight(e,r){r!==this.getHighlight(e)&&(this._setStateFlag(e,Ji.HIGHLIGHT,r),this.events.emit("instance-highlight-changed"))}getHighlight(e){return this._getStateFlag(e,Ji.HIGHLIGHT)}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let r=0;for(let i=0;i<this._capacity;++i)this.getState(i)&e&&++r;return r}_setStateFlags(e,r){const i=this._view.state;r=i.get(e)|r,i.set(e,r)}_clearStateFlags(e,r){const i=this._view.state;r=i.get(e)&~r,i.set(e,r)}_setStateFlag(e,r,i){i?this._setStateFlags(e,r):this._clearStateFlags(e,r)}_getStateFlag(e,r){return!!(this._view.state.get(e)&r)}_grow(){const e=Math.max(vMt,Math.floor(this._capacity*bMt)),r=this._layout.createBuffer(e);if(this._buffer){const i=new Uint8Array(this._buffer.buffer);new Uint8Array(r.buffer).set(i)}this._capacity=e,this._buffer=r,this._view=new yMt(this._buffer)}_findSlot(){const e=this._view.state;let r=this._next;for(;e.get(r)&Ji.ALLOCATED;)r=r+1===this._capacity?0:r+1;return this._next=r+1===this._capacity?0:r+1,r}};function _Mt(t,e,r){return Math.max(Math.min(t,e),Math.min(Math.max(t,e),r))}u([d({constructOnly:!0})],fA.prototype,"shaderTransformation",void 0),u([d()],fA.prototype,"_size",void 0),u([d({readOnly:!0})],fA.prototype,"size",null),fA=u([$("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],fA);const vMt=1024,bMt=2,Pv=P(),Yp=vi(),Fve=$e(),lW=$e();let wMt=class extends Xf{constructor(e,r){super(i=>this._instanceData.view.boundingSphere.getVec(i,this._tmpSphere),{maximumDepth:25}),this._tmpSphere=Os(),this._tmpMat4=$e(),this._instanceData=e,this._boundingSphere=r}addInstance(e){const r=this._instanceData.view.boundingSphere,i=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);Ke(this._tmpSphere,this._boundingSphere.center,i),this._tmpSphere[3]=this._boundingSphere.radius*p2(i),r.setVec(e,this._tmpSphere),this.add([e])}removeInstance(e){this.remove([e])}},xMt=class{constructor(e,r){this._worldSpaceRadius=e,this._minScreenSpaceRadii=r}selectLevel(e,r,i){const n=i.computeScreenPixelSizeAt(e),s=this._worldSpaceRadius*r/n;let o=0;for(let a=1;a<this._minScreenSpaceRadii.length;++a)s>=this._minScreenSpaceRadii[a]&&(o=a);return o}},TMt=class extends i7{constructor(e,r,i,n,s,o){super(e,r),this.layerUid=e,this.graphicUid=r,this.geometryId=i,this.triangleNr=n,this.baseBoundingSphere=s,this.numLodLevels=o}};function dce(t){return xm(t)&&t.intersector===pn.LOD&&!!t.target}let SMt=class{constructor(e,r){const i=e.renderContext.rctx,n=r.geometry;this._materialRepository=e.materialRepository,n.material.setParameters({instancedDoublePrecision:!0});const s=n.material.createBufferWriter(),o=s.vertexBufferLayout,a=s.elementCount(n),l=s.allocate(a);s.write(null,null,n,l,0),this.geometry=n,this.material=n.material,this.glMaterials=new rke(n.material,this._materialRepository),this.vertexBufferLayout=o,this.vbo=Kr.createVertex(i,zr.STATIC_DRAW,l.buffer),this.vao=new wm(i,Lr,{geometry:eh(o)},{geometry:this.vbo}),this.vertexCount=a}destroy(){this.glMaterials.destroy(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(e,r,i,n,s,o,a,l){const c=this.geometry.id;this.material.intersect(this.geometry,e.transform.transform,e,i,n,(h,p,f,m,g)=>{if(h>=0){if(r!=null&&!r(e.rayBegin,e.rayEnd,h))return;const _=new TMt(o.layerUid,o.graphicUid(s),c,f,a,l);if((e.results.min.drapedLayerOrder==null||g>=e.results.min.drapedLayerOrder)&&(e.results.min.dist==null||h<e.results.min.dist)&&e.results.min.set(pn.LOD,_,h,p,e.transform.transform,g),e.options.store!==ba.MIN&&(e.results.max.drapedLayerOrder==null||g>=e.results.max.drapedLayerOrder)&&(e.results.max.dist==null||h>e.results.max.dist)&&e.results.max.set(pn.LOD,_,h,p,e.transform.transform,g),e.options.store===ba.ALL){const b=nle(e.results.min.ray);b.set(pn.LOD,_,h,p,e.transform.transform,g),e.results.all.push(b)}}})}},EMt=class _6e{static async create(e,r,i){const n=await Promise.allSettled(r.components.map(o=>e.controller.schedule(()=>new SMt(e,o),i))),s=n.map(o=>o.status==="fulfilled"?o.value:null).filter(v);if(uo(i)||s.length!==n.length){s.forEach(o=>o.destroy()),lr(i);for(const o of n)if(o.status==="rejected")throw o.reason}return new _6e(r.minScreenSpaceRadius,s)}constructor(e,r){this.minScreenSpaceRadius=e,this.components=r}destroy(){this.components.forEach(e=>e.destroy())}intersect(e,r,i,n,s,o,a){this.components.forEach(l=>l.intersect(e,r,i,n,s,o,this.boundingSphere,a))}get boundingBox(){if(R(this._boundingBox)){const e=ki();this.components.forEach(r=>{v(r.boundingInfo)&&(ay(e,r.boundingInfo.bbMin),ay(e,r.boundingInfo.bbMax))}),this._boundingBox=e}return this._boundingBox}get boundingSphere(){if(R(this._boundingSphere)){const e=this.boundingBox,r=P();Bf(e,r),this._boundingSphere={center:r,radius:.5*mCe(e)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((e,r)=>e+r.triangleCount,0)}},CMt=class{constructor(e,r,i){this._elementSize=r,this._buffer=Kr.createVertex(e,zr.STATIC_DRAW),this.resize(i)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get memoryUsage(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}copyRange(e,r,i,n=0){const s=new Uint8Array(this.array,e*this.elementSize,(r-e)*this.elementSize);new Uint8Array(i.array,n*this.elementSize).set(s)}transferAll(){this._buffer.setData(this._array)}transferRange(e,r){const i=e*this._elementSize,n=r*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),i,i,n)}resize(e){const r=e*this._elementSize,i=new ArrayBuffer(r);this._array&&(e>=this._capacity?new Uint8Array(i).set(new Uint8Array(this._array)):new Uint8Array(i).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=i,this._buffer.setSize(r),this._capacity=e}},AMt=class{constructor(e){this.modelOriginHi=e.getField(O.MODELORIGINHI,Ui),this.modelOriginLo=e.getField(O.MODELORIGINLO,Ui),this.model=e.getField(O.MODEL,fw),this.modelNormal=e.getField(O.MODELNORMAL,fw),this.color=e.getField(O.INSTANCECOLOR,Yu),this.featureAttribute=e.getField(O.INSTANCEFEATUREATTRIBUTE,Yu),this.objectAndLayerIdColor=e.getField(O.OBJECTANDLAYERIDCOLOR_INSTANCED,gl)}},kve=class{constructor(e,r){this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=e,this._instanceBufferLayout=r,this._elementSize=r.stride,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const e=this._headIndex,r=this._tailIndex;return e>=r?e-r:e+this._capacity-r}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get memoryUsage(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){wt(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){wt(this._updating,"not updating"),this.size<OMt*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){wt(this._updating,"not updating"),this.isFull&&this._grow();const e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this._incrementHead(),wt(this._headIndex!==this._tailIndex,"invalid pointers"),e}freeTail(){wt(this._updating,"not updating"),wt(this.size>0,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}_grow(){const e=Math.max(Uve,Math.floor(this._capacity*RMt));this._resize(e)}_shrink(){const e=Math.max(Uve,Math.floor(this._capacity*MMt));this._resize(e)}_resize(e){if(wt(this._updating,"not updating"),e===this._capacity)return;const r=new CMt(this._rctx,this._elementSize,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const i=this.size,n=this._compactInstances(r);wt(n===i,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=n,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=r,this._view=new AMt(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(e){const r=this._headIndex,i=this._tailIndex;return i<r?(this._buffer.copyRange(i,r,e),r-i):i>r?(this._buffer.copyRange(i,this._capacity,e),r>0&&this._buffer.copyRange(0,r,e,this._capacity-i),r+(this._capacity-i)):0}_incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}_incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}_transferRange(e,r){e<r?this._buffer.transferRange(e,r):e>r&&(r>0&&this._buffer.transferRange(0,r),this._buffer.transferRange(e,this._capacity))}};const Uve=1024,RMt=2,OMt=.3,MMt=.5,PMt=t=>{const e=t.baseBoundingSphere.radius,r=t.levels.map(i=>i.minScreenSpaceRadius);return new xMt(e,r)};let Fd=class extends be{constructor(e,r){super(e),this.type=pn.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=[],this._highlightRenderInstanceData=[],this._instanceIndex=0,this._cycleStartIndex=0,this._slicePlane=!1,this._camera=new Pt,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.slots=[Ee.OPAQUE_MATERIAL,Ee.TRANSPARENT_MATERIAL],this.canRender=!0,this._instanceData=new fA({shaderTransformation:e.shaderTransformation},e.optionalFields),this._frameTask=r.registerTask(St.LOD_RENDERER,this)}initialize(){this._instanceBufferLayout=$Mt(this.optionalFields),this._glInstanceBufferLayout=eh(this._instanceBufferLayout,1),this._instanceData.events.on("instances-changed",()=>this._requestUpdateCycle()),this._instanceData.events.on("instance-transform-changed",({index:e})=>{this._requestUpdateCycle(),this.metadata.notifyGraphicGeometryChanged(e)}),this._instanceData.events.on("instance-visibility-changed",({index:e})=>{this._requestUpdateCycle(!0),this.metadata.notifyGraphicVisibilityChanged(e)}),this._instanceData.events.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0))}destroy(){this._frameTask.remove()}get _enableLevelSelection(){return this.symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get memoryUsage(){const e={cpu:0,gpu:0};return this._defaultRenderInstanceData.forEach(r=>{const i=r.memoryUsage;e.cpu+=i.cpu,e.gpu+=i.gpu}),this._highlightRenderInstanceData.forEach(r=>{const i=r.memoryUsage;e.cpu+=i.cpu,e.gpu+=i.gpu}),e}get renderStats(){const e=this._instanceData.size,r=[];return this._levels.forEach((i,n)=>{const s=this._defaultRenderInstanceData[n],o=this._highlightRenderInstanceData[n],a=s.size+o.size,l=i.triangleCount;r.push({renderedInstances:a,renderedTriangles:a*l,trianglesPerInstance:l})}),{totalInstances:e,renderedInstances:r.reduce((i,n)=>i+n.renderedInstances,0),renderedTriangles:r.reduce((i,n)=>i+n.renderedTriangles,0),levels:r}}async initializeRenderContext(e,r){this._context=e;const i=e.renderContext.rctx,n=await Promise.allSettled(this.symbol.levels.map(o=>(this._defaultRenderInstanceData.push(new kve(i,this._instanceBufferLayout)),this._highlightRenderInstanceData.push(new kve(i,this._instanceBufferLayout)),EMt.create(e,o,r)))),s=n.map(o=>o.status==="fulfilled"?o.value:null).filter(v);if(uo(r)||s.length!==n.length){s.forEach(o=>o.destroy()),lr(r);for(const o of n)if(o.status==="rejected")throw o.reason}this._levels=s,this._levelSelector=PMt(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(e=>e.destroy()),this._defaultRenderInstanceData.forEach(e=>e.destroy()),this._highlightRenderInstanceData.forEach(e=>e.destroy())}get needsTransparentPass(){return this._levels.some(e=>e.components.some(r=>r.material.requiresSlot(Ee.TRANSPARENT_MATERIAL,V.Color)))}get needsHighlight(){return this._highlightRenderInstanceData.some(e=>e.size>0)}prepareRender(e){if(!Qr.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const r=e.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(e.bindParameters.contentCamera),r||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(jl),this._needFullCycle=!1)}}render(e){!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleForOutput(e.output)||(e.rctx.bindVAO(),e.output!==V.Highlight&&e.output!==V.ShadowHighlight&&this._renderComponents(e,this._defaultRenderInstanceData),e.output!==V.ShadowExcludeHighlight&&this._renderComponents(e,this._highlightRenderInstanceData))}intersect(e,r,i,n){if(!this.baseMaterial.isVisible()||R(this._octree))return;const s=P();ge(s,n,i);const o=a=>{this._instanceData.getCombinedModelTransform(a,Bve),e.transform.set(Bve),Ke(jve,i,e.transform.inverse),Ke(Gve,n,e.transform.inverse);const l=this._instanceData.getState(a),c=this._instanceData.getLodLevel(a),h=this._levels.length;wt((l&Ji.ACTIVE)!=0,"invalid instance state"),wt(c>=0&&c<h,"invaid lod level"),this._levels[c].intersect(e,r,jve,Gve,a,this.metadata,h)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(o):this._octree.forEachAlongRay(i,s,o)}queryDepthRange(e){return this._queryDepthRangeOctree(e)}notifyShaderTransformationChanged(){this._invalidateOctree(),this._requestUpdateCycle()}get _octree(){var e;if(R(this._octreeCached)){const r=this._instanceData,i=(e=r.view)==null?void 0:e.state;if(!i)return null;this._octreeCached=new wMt(r,this.baseBoundingSphere);for(let n=0;n<r.capacity;++n)i.get(n)&Ji.ACTIVE&&this._octreeCached.addInstance(n)}return this._octreeCached}_invalidateOctree(){this._octreeCached=ze(this._octreeCached)}_queryDepthRangeOctree(e){if(R(this._octree))return{near:1/0,far:-1/0};const r=e.viewForward,i=this._octree.findClosest(r,Xf.DepthOrder.FRONT_TO_BACK,e.frustum),n=this._octree.findClosest(r,Xf.DepthOrder.BACK_TO_FRONT,e.frustum);if(i==null||n==null)return{near:1/0,far:-1/0};const s=e.eye,o=this._instanceData.view;o.boundingSphere.getVec(i,Um),ge(Um,Um,s);const a=ve(Um,r)-Um[3];o.boundingSphere.getVec(n,Um),ge(Um,Um,s);const l=ve(Um,r)+Um[3];return{near:Math.max(e.near,a),far:Math.min(e.far,l)}}_requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,e&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._defaultRenderInstanceData.forEach(e=>e.startUpdateCycle()),this._highlightRenderInstanceData.forEach(e=>e.startUpdateCycle())}get running(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}runTask(e){const{_enableLevelSelection:r,_camera:i,_levelSelector:n}=this;this._defaultRenderInstanceData.forEach(h=>h.beginUpdate()),this._highlightRenderInstanceData.forEach(h=>h.beginUpdate());const s=this._instanceData,o=s.view;let a=s.size;const l=s.capacity;let c=this._instanceIndex;for(let h=0;h<a&&!e.done;++h){c===this._cycleStartIndex&&this._startUpdateCycle();const p=o.state.get(c);let f=0;if(!(p&Ji.ALLOCATED)){c=c+1===l?0:c+1,a++;continue}const m=o.lodLevel.get(c);if(p&Ji.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[m].freeTail(),p&Ji.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[m].freeTail(),p&Ji.REMOVE)s.freeInstance(c);else if(p&Ji.VISIBLE){let g=0;r&&(o.modelOrigin.getVec(c,Vve),g=n.selectLevel(Vve,s.getCombinedMedianScaleFactor(c),i)),f=p&~(Ji.ACTIVE|Ji.TRANSFORM_CHANGED),g>=0&&(p&Ji.HIGHLIGHT?(zve(this._highlightRenderInstanceData[g],o,c),f|=Ji.HIGHLIGHT_ACTIVE):(zve(this._defaultRenderInstanceData[g],o,c),f|=Ji.DEFAULT_ACTIVE)),o.state.set(c,f),o.lodLevel.set(c,g)}else f=p&~(Ji.ACTIVE|Ji.TRANSFORM_CHANGED),o.state.set(c,f);if(v(this._octreeCached)){const g=!!(p&Ji.ACTIVE),_=!!(f&Ji.ACTIVE);!g&&_?this._octreeCached.addInstance(c):g&&!_?this._octreeCached.removeInstance(c):g&&_&&p&Ji.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(c),this._octreeCached.addInstance(c))}c=c+1===l?0:c+1,e.madeProgress()}this._instanceIndex=c,this._defaultRenderInstanceData.forEach(h=>h.endUpdate()),this._highlightRenderInstanceData.forEach(h=>h.endUpdate()),this._context.requestRender()}_renderComponents(e,r){this.levels.forEach((i,n)=>{const s=i.components.map(o=>this._beginComponent(e,r[n],o));i.components.forEach((o,a)=>this._renderComponent(e,s[a],r[n],o,n))})}_beginComponent(e,r,i){const{bindParameters:n,rctx:s,output:o}=e;if(r.size===0||!i.material.requiresSlot(n.slot,e.output))return null;const a=i.glMaterials.load(s,n.slot,o);return v(a)?a.beginSlot(n):null}_renderComponent(e,r,i,n,s){if(R(r))return;const{bindParameters:o,rctx:a}=e,l=a.bindTechnique(r,n.material.parameters,o);a.bindVAO(n.vao),r.ensureAttributeLocations(n.vao),l.bindDraw(LMt,o,n.material.parameters),Qr.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.output===V.Color&&(l.setUniform4fv("externalColor",Hve[Math.min(s,Hve.length-1)]),l.setUniform1i("colorMixMode",y4e.replace));const c=a.capabilities.instancing,h=i.capacity,p=i.headIndex,f=i.tailIndex,m=i.firstIndex,g=this._glInstanceBufferLayout,_=(b,w)=>{Aae(a,Lr,i.buffer,g,b),c.drawArraysInstanced(r.primitiveType,0,n.vertexCount,w-b),Rae(a,Lr,i.buffer,g)};n.material.parameters.transparent&&m!=null?p>f?(wt(m>=f&&m<=p,"invalid firstIndex"),_(m,p),_(f,m)):p<f&&(m<=p?(wt(m>=0&&m<=p,"invalid firstIndex"),_(m,p),_(f,h),_(0,m)):(wt(m>=f&&m<=h,"invalid firstIndex"),_(m,h),_(0,p),_(f,m))):p>f?_(f,p):p<f&&(_(0,p),_(f,h)),a.bindVAO(null)}};function zve(t,e,r){const i=t.allocateHead();IMt(e,r,t.view,i)}function IMt(t,e,r,i){Ovt(t.modelOrigin,e,r.modelOriginHi,r.modelOriginLo,i),r.model.copyFrom(i,t.model,e),r.modelNormal.copyFrom(i,t.modelNormal,e),t.color&&r.color&&r.color.copyFrom(i,t.color,e),t.objectAndLayerIdColor&&r.objectAndLayerIdColor&&r.objectAndLayerIdColor.copyFrom(i,t.objectAndLayerIdColor,e),t.featureAttribute&&r.featureAttribute&&r.featureAttribute.copyFrom(i,t.featureAttribute,e)}function $Mt(t){let e=mn().vec3f(O.MODELORIGINHI).vec3f(O.MODELORIGINLO).mat3f(O.MODEL).mat3f(O.MODELNORMAL);return v(t)&&t.includes("color")&&(e=e.vec4f(O.INSTANCECOLOR)),v(t)&&t.includes("featureAttribute")&&(e=e.vec4f(O.INSTANCEFEATUREATTRIBUTE)),v(t)&&t.includes("objectAndLayerIdColor")&&(e=e.vec4u8(O.OBJECTANDLAYERIDCOLOR_INSTANCED)),e}u([d({constructOnly:!0})],Fd.prototype,"symbol",void 0),u([d({constructOnly:!0})],Fd.prototype,"optionalFields",void 0),u([d({constructOnly:!0})],Fd.prototype,"metadata",void 0),u([d({constructOnly:!0})],Fd.prototype,"shaderTransformation",void 0),u([d()],Fd.prototype,"_instanceData",void 0),u([d()],Fd.prototype,"_cycleStartIndex",void 0),u([d({readOnly:!0})],Fd.prototype,"_enableLevelSelection",null),u([d()],Fd.prototype,"_updateCyclesWithStaticCamera",void 0),u([d({readOnly:!0})],Fd.prototype,"running",null),Fd=u([$("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],Fd);const Vve=P(),Um=pr(),Bve=$e(),jve=P(),Gve=P(),Hve=[Zt(1,0,1,1),Zt(0,0,1,1),Zt(0,1,0,1),Zt(1,1,0,1),Zt(1,0,0,1)],LMt=new MRt;let qve=class{constructor(e,r,i,n,s,o,a,l,c,h,p,f){this.lodResources=e,this.lodRenderer=r,this.stageResources=i,this.originalMaterialParameters=n,this.resourceSize=s,this.isEsriSymbolResource=o,this.isWosr=a,this.resourceBoundingBox=l,this.symbolSize=c,this.extentPadding=h,this.physicalBasedRenderingEnabled=p,this.pivotOffset=f}},DMt=class extends Ty{getCachedSize(){const[e,r,i]=v(this._resources)?this._resources.symbolSize:[1,1,1];return{width:e,depth:r,height:i}}constructor(e,r,i,n){super(e,r,i,n),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this._hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.ensureDrapedStatus(!1),this._hasLoadedPBRTextures=i.physicalBasedRenderingEnabled}async doLoad(e){if(!this._drivenProperties.size&&x7(this.symbolLayer))throw new Error;const r=this.symbolLayer;if(this._isPrimitive){const i=r.resource?r.resource.primitive:WCe;this._resources=await this._createResourcesForPrimitive(i,e)}else this._resources=await this._createResourcesForUrl(r.resource.href,e);this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return v(this._resources)?this._resources.extentPadding:0}get _isPrimitive(){return!(this.symbolLayer.resource&&this.symbolLayer.resource.href)}get lodRenderer(){return v(this._resources)?this._resources.lodRenderer:null}_setMaterialTransparencyParams(e,r=Xs(this.symbolLayer,"material","color")){const i=this._getCombinedOpacity(r),n=i<1||this.needsDrivenTransparentPass;return e.transparent=n,e.opacity=i,e.cullFace=n?Ii.None:Ii.Back,e}async _createResourcesForPrimitive(e,r){if(!jEt(e))throw new Error(`Unknown object symbol primitive: ${e}`);const i=this.symbolLayer,n=Ks(xWe(e)),s=$c(DF(n)),o=$c(Vj(s,i)),a=Pe(o),l=!1,c=!1,h={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,ambient:Lg,diffuse:Lg,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},p=!!h.usePBR;this._setMaterialTransparencyParams(h);const f=this.symbol;if(f.type==="point-3d"&&f.verticalOffset){const{screenLength:x,minWorldLength:T,maxWorldLength:E}=f.verticalOffset;h.verticalOffset={screenLength:da(x),minWorldLength:T||0,maxWorldLength:v(E)?E:1/0},h.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(h.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)h.externalColor=op;else{const x=v(i.material)?i.material.color:null,T=v(x)?Xe.toUnitRGBA(x):op;h.externalColor=T}this._fastUpdates=kD(this._context.renderer,this._fastVisualVariableConvertOptions(n,o,s,$x)),h.instanced=["transformation"],this._fastUpdates.enabled?(Object.assign(h,this._fastUpdates.materialParameters),h.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(h.instanced.push("color"),this._optionalFields.push("color")),ue("enable-feature:objectAndLayerId-rendering")&&(h.instanced.push("objectAndLayerIdColor"),this._optionalFields.push("objectAndLayerIdColor"));const m=new P_(h),g=w5e(e,m);if(!g)throw new Error(`Unknown object symbol primitive: ${e}`);const _=E5(g).map(x=>({opacity:1,transparent:x.parameters.transparent})),b=await this._createStageResources(g,p,r),w=await this._createLodRenderer(g,r);return new qve(g,w,b,_,s,l,c,n,o,a,p,$x)}async _createResourcesForUrl(e,r){const i=["transformation"],n={materialParamsMixin:{instanced:i,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=kD(this._context.renderer,this._fastVisualVariableConvertOptions($x,$x,$x,$x)),this._fastUpdates.enabled?(Object.assign(n.materialParamsMixin,this._fastUpdates.materialParameters),i.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(i.push("color"),this._optionalFields.push("color")),ue("enable-feature:objectAndLayerId-rendering")&&(i.push("objectAndLayerIdColor"),this._optionalFields.push("objectAndLayerIdColor"));const s=this.symbol;if(s.type==="point-3d"&&s.verticalOffset){const{screenLength:U,minWorldLength:z,maxWorldLength:B}=s.verticalOffset;n.materialParamsMixin.verticalOffset={screenLength:da(U),minWorldLength:z||0,maxWorldLength:v(B)?B:1/0},n.materialParamsMixin.castShadows=!1}n.signal=r,n.usePBR=this._context.physicalBasedRenderingEnabled,n.skipHighLods=this._context.skipHighSymbolLods;const o=n.usePBR,a=await m6e(e,n),l=a.isEsriSymbolResource,c=a.isWosr,h=x3t(a.lods);h.levels.sort((U,z)=>U.minScreenSpaceRadius-z.minScreenSpaceRadius);const p=this._context,f=this.symbolLayer.material,m=this._getExternalColorParameters(f),g=Xs(this.symbolLayer,"material","color"),_=this._getCombinedOpacity(g,{hasIntrinsicColor:!0}),b=this.needsDrivenTransparentPass,w=E5(h),x=E5(h).map(U=>({opacity:U.parameters.opacity||1,transparent:U.parameters.transparent}));w.forEach(U=>{const z=U.parameters;U.setParameters(m);const B=z.opacity*_,ee=B<1||b||z.transparent;U.setParameters({opacity:B,transparent:ee}),p.screenSizePerspectiveEnabled&&U.setParameters({screenSizePerspective:p.sharedResources.screenSizePerspectiveSettings})});const T=a.referenceBoundingBox,E=$c(DF(T)),C=$c(h.levels[0].pivotOffset),A=$c(Vj(E,this.symbolLayer)),I=Pe(A);UD(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions(T,A,E,C))&&w.forEach(U=>U.setParameters(this._fastUpdates.materialParameters));const M=await this._createStageResources(h,o,r),D=await this._createLodRenderer(h,r);return new qve(h,D,M,x,E,l,c,T,A,I,o,C)}_addDisposeResource(e){this._disposeResourceHandles.push(e)}async _createStageResources(e,r,i){const n=this._context.stage,s=E5(e);r!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),n.addMany(s),this._addDisposeResource(()=>n.removeMany(s));const o=g_e(e);n.addMany(o),this._addDisposeResource(()=>n.removeMany(o)),await n.load(o,i),lr(i);const a=y_e(e);return n.addMany(a),this._addDisposeResource(()=>n.removeMany(a)),{materials:s,textures:o,geometries:a}}async _createLodRenderer(e,r){const i=this._context.stage,n={layerUid:this._context.layer.uid,graphicUid:a=>this._instanceIndexToGraphicUid.get(a),notifyGraphicGeometryChanged:a=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(a)),notifyGraphicVisibilityChanged:a=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(a))},s=this._fastUpdates.enabled?{applyTransform:(a,l,c)=>{a.getFeatureAttribute(l,X5),po(c,Ote(this._fastUpdates.materialParameters,X5,c))},scaleFactor:(a,l,c)=>(l.getFeatureAttribute(c,X5),mOt(a,this._fastUpdates.materialParameters,X5))}:null,o=new Fd({symbol:e,optionalFields:this._optionalFields,metadata:n,shaderTransformation:s},this._context.scheduler);return o.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource(()=>{i.removeRenderPlugin(o),o.destroy()}),await i.addRenderPlugin(o.slots,o,r),o}_getExternalColorParameters(e){const r={};return this._drivenProperties.color?r.externalColor=op:v(e)&&v(e.color)?r.externalColor=Xe.toUnitRGBA(e.color):(r.externalColor=op,r.colorMixMode="ignore"),r}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(e=>e()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry))return null;const i=$D(r.geometry);if(R(i))return this.logger.warn(`unsupported geometry type for icon symbol: ${r.geometry.type}`),null;const n=this.setGraphicElevationContext(r,new Tm),s=e.renderingInfo;return this._createAs3DShape(r,i,s,n,r.uid,e.layer.uid)}notifyDestroyGraphicLayer(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(R(this._resources))return;const e=this._drivenProperties.opacity,r=!this._isPrimitive,i=this._resources.stageResources.materials,n=this._resources.originalMaterialParameters;for(let s=0;s<i.length;s++){const o=i[s],a=Xs(this.symbolLayer,"material","color"),l=n[s],c=this._getCombinedOpacity(a,{hasIntrinsicColor:r})*l.opacity,h=c<1||e||l.transparent;o.setParameters({opacity:c,transparent:h}),this._isPrimitive&&o.setParameters({cullFace:h?Ii.None:Ii.Back})}}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,_w)}slicePlaneEnabledChanged(){if(R(this._resources))return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const e of this._resources.stageResources.materials)e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(R(this._resources))return!0;const{stageResources:e,isWosr:r}=this._resources;for(const i of e.materials)this._isPrimitive?i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):r||i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return this._hasLoadedPBRTextures!==!1||this._context.physicalBasedRenderingEnabled!==!0||(this._hasLoadedPBRTextures=!0,!1)}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!1}applyRendererDiff(e,r){if(R(this._resources))return Ys.Recreate_Symbol;const{stageResources:{materials:i},lodRenderer:n,resourceBoundingBox:s,symbolSize:o,resourceSize:a,pivotOffset:l}=this._resources;for(const c in e.diff){if(c!=="visualVariables"||!UD(this._fastUpdates,r,this._fastVisualVariableConvertOptions(s,o,a,l)))return Ys.Recreate_Symbol;for(const h of i)h.setParameters(this._fastUpdates.materialParameters);n.notifyShaderTransformationChanged()}return Ys.Fast_Update}computeComplexity(){if(R(this._resources))return super.computeComplexity();const e=this._resources.lodResources,r=b5e(e.levels[0]).reduce((s,o)=>s+o.indices.get(O.POSITION).length,0)/3,i=s=>Array.from(s.vertexAttributes.values()).reduce((o,a)=>{var l;return o+(((l=a.data.buffer)==null?void 0:l.byteLength)??0)},0)+Array.from(s.indices.values()).reduce((o,a)=>o+(Array.isArray(a)?12*a.length:a.buffer.byteLength),0),n=g_e(e).reduce((s,o)=>s+(o.params.encoding&&o.params.encoding==="image/ktx2"?o.estimatedTexMemRequired:o.estimatedTexMemRequired/4),0)+y_e(e).reduce((s,o)=>s+i(o),0);return{primitivesPerFeature:r,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:{...S5e(this.symbol,this.symbolLayer),resourceBytes:n}}}_hasLodRenderer(){return v(this._resources)}_createAs3DShape(e,r,i,n,s,o){if(!this._hasLodRenderer()||R(this._resources))return null;const a=this.getFastUpdateAttrValues(e),l=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?Z$(i.color,i.opacity):null,c=this._context.clippingExtent;if(Ba(r,qE,this._context.elevationProvider.spatialReference),v(c)&&!Mne(c,qE))return null;const h=this._requiresTerrainElevation(n),p=this._computeGlobalTransform(r,n,cW,Y5),f=this._computeLocalTransform(this._resources,this.symbolLayer,i,Wve),m=this._resources.lodRenderer.instanceData,g=m.addInstance();this._instanceIndexToGraphicUid.set(g,s),m.setLocalTransform(g,f,!1),m.setGlobalTransform(g,p),a&&m.setFeatureAttribute(g,a),l&&m.setColor(g,l),v(this._context.stage.renderView.objectAndLayerIdRenderHelper)&&m.setObjectAndLayerIdColor(g,this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:s,layerUid:o}));const _=new v3t(this,g,$Et,n);return h&&(_.alignedSampledElevation=Y5.sampledElevation),_.needsElevationUpdates=_w(n.mode),ID(_,r,this._context.elevationProvider),_}_computeGlobalTransform(e,r,i,n){return j3(e,this._context.elevationProvider,r,this._context.renderCoordsHelper,n),qE[0]=e.x,qE[1]=e.y,qE[2]=n.z,um(e.spatialReference,qE,i,this._context.renderCoordsHelper.spatialReference),i}_computeLocalTransform(e,r,i,n){return Rp(n),this._applyObjectRotation(i,!1,n),this._applyObjectRotation(r,!0,n),this._applyObjectScale(e,i,n),this._applyAnchor(e,r,n),n}_applyObjectScale(e,r,i){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const n=this._drivenProperties.size&&r.size?r.size:e.symbolSize,s=f_e(n,e.symbolSize,e.resourceSize,this._context.renderCoordsHelper.unitInMeters);s[0]===1&&s[1]===1&&s[2]===1||J9(i,i,s)}prepareSymbolLayerPatch(e){if(e.diff.type!=="partial")return;const r=e.diff.diff;this._preparePatchTransform(e,r),this._preparePatchColor(e,r)}updateGeometry(e,r){if(R(this._resources))return!0;const i=r&&$D(r);if(R(i))return!1;const n=this.getGeometryElevationMode(r);return e.elevationContext.mode===n&&(this._computeGlobalTransform(i,e.elevationContext,cW,Y5),this._requiresTerrainElevation(e.elevationContext)&&(e.alignedSampledElevation=Y5.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,cW,!0),ID(e,i,this._context.elevationProvider),!0)}_preparePatchTransform(e,r){if(!(r.heading||r.tilt||r.roll||r.width||r.height||r.depth||r.anchor||r.anchorPosition)||R(this._resources))return;const i=(g,_,b)=>Nt(g!=null&&g.type==="complete"?g.newValue:_,b),n=i(r.heading,this.symbolLayer.heading,0),s=i(r.tilt,this.symbolLayer.tilt,0),o=i(r.roll,this.symbolLayer.roll,0),a=i(r.width,this.symbolLayer.width,void 0),l=i(r.height,this.symbolLayer.height,void 0),c=i(r.depth,this.symbolLayer.depth,void 0),h=i(r.anchor,this.symbolLayer.anchor,void 0),p=i(r.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete r.heading,delete r.tilt,delete r.roll,delete r.width,delete r.height,delete r.depth,delete r.anchor,delete r.anchorPosition;const f={heading:n,tilt:s,roll:o,anchor:h,anchorPosition:p},m=this._resources;this.loadStatus===Fh.LOADED&&e.symbolLayerStatePatches.push(()=>{m.symbolSize=$c(Vj(m.resourceSize,{width:a,height:l,depth:c,isPrimitive:this.symbolLayer.isPrimitive}))}),e.graphics3DGraphicPatches.push((g,_)=>{const b=this._computeLocalTransform(m,f,_,Wve),w=g.instanceIndex;m.lodRenderer.instanceData.setLocalTransform(w,b,!0)})}_preparePatchColor(e,r){if(!r.material||r.material.type!=="partial")return;const i=r.material.diff;if(!i.color||i.color.type!=="complete"||i.color.newValue==null||i.color.oldValue==null)return;const n=i.color.newValue,s=v(n)?Xe.toUnitRGBA(n):op;delete i.color;const o=this._resources;R(o)||e.graphics3DGraphicPatches.push(a=>{let l;this._hasPerInstanceColor()?(o.lodRenderer.instanceData.setColor(a.instanceIndex,s),l=this._setMaterialTransparencyParams({},n)):l=this._setMaterialTransparencyParams({externalColor:s},n);for(const c of o.stageResources.materials)c.setParameters(l)})}_requiresTerrainElevation(e){return e.mode!=="absolute-height"}_applyObjectRotation(e,r,i){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&r))return xEt(e.heading,e.tilt,e.roll,i)}_computeAnchor(e,r,i){const n=P();switch(i.anchor){case"center":ce(n,Bf(e)),ul(n,n);break;case"top":{const s=Bf(e);he(n,-s[0],-s[1],-e[5]);break}case"bottom":{const s=Bf(e);he(n,-s[0],-s[1],-e[2]);break}case"relative":{const s=Bf(e),o=DF(e),a=i.anchorPosition,l=a?ke(a.x,a.y,a.z):cl;N9(n,o,l),me(n,n,s),ul(n,n);break}default:v(r)?ul(n,r):ce(n,cl)}return n}_applyAnchor(e,r,i){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const n=this._computeAnchor(e.resourceBoundingBox,e.pivotOffset,r);n&&Hc(i,i,n)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(e,r,i,n){const s=v(e)?$c(DF(e)):Lg,o=v(e)?this._computeAnchor(e,n,this.symbolLayer):cl,a=this._context.renderCoordsHelper.unitInMeters,l=f_e(v(r)?r:void 0,r,i,a),c=ke(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:s,symbolSize:v(r)?r:Lg,unitInMeters:a,transformation:{anchor:o,scale:l,rotation:c}}}};const qE=P(),Wve=$e(),cW=$e(),X5=pr(),Y5=new JN;function NMt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function FMt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function Nte(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t}function kMt(t,e){if(t===e){const r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function UMt(t,e){const r=e[0],i=e[1],n=e[2],s=e[3];let o=r*s-n*i;return o?(o=1/o,t[0]=s*o,t[1]=-i*o,t[2]=-n*o,t[3]=r*o,t):null}function zMt(t,e){const r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t}function VMt(t){return t[0]*t[3]-t[2]*t[1]}function v6e(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=r[0],l=r[1],c=r[2],h=r[3];return t[0]=i*a+s*l,t[1]=n*a+o*l,t[2]=i*c+s*h,t[3]=n*c+o*h,t}function BMt(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+s*a,t[1]=n*l+o*a,t[2]=i*-a+s*l,t[3]=n*-a+o*l,t}function jMt(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=r[0],l=r[1];return t[0]=i*a,t[1]=n*a,t[2]=s*l,t[3]=o*l,t}function GMt(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=-r,t[3]=i,t}function HMt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function qMt(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function WMt(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2)}function XMt(t,e,r,i){return t[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-t[2]*r[1],[t,e,r]}function YMt(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function b6e(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function ZMt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function JMt(t,e){const r=t[0],i=t[1],n=t[2],s=t[3],o=e[0],a=e[1],l=e[2],c=e[3],h=yl();return Math.abs(r-o)<=h*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=h*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-l)<=h*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-c)<=h*Math.max(1,Math.abs(s),Math.abs(c))}function KMt(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function QMt(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t}const ePt=v6e,tPt=b6e;Object.freeze(Object.defineProperty({__proto__:null,LDU:XMt,add:YMt,adjoint:zMt,copy:NMt,determinant:VMt,equals:JMt,exactEquals:ZMt,frob:WMt,fromRotation:GMt,fromScaling:HMt,identity:FMt,invert:UMt,mul:ePt,multiply:v6e,multiplyScalar:KMt,multiplyScalarAndAdd:QMt,rotate:BMt,scale:jMt,set:Nte,str:qMt,sub:tPt,subtract:b6e,transpose:kMt},Symbol.toStringTag,{value:"Module"}));let rPt=class extends As{constructor(e,r,i,n,s,o,a,l){super(e,r,i,null,Wn.Mesh,l),this.path=n,this.geometrySR=s,this.upVectorAlignment=o,this.stencilWidth=a}};var jb;function w6e(t){return"upVectorAlignment"in t}(function(t){t[t.World=0]="World",t[t.Path=1]="Path"})(jb||(jb={}));function x6e(){return[1,0,0,1]}function iPt(t){return[t[0],t[1],t[2],t[3]]}function nPt(t,e,r,i){return[t,e,r,i]}function sPt(t,e){return new Float64Array(t,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:iPt,create:x6e,createView:sPt,fromValues:nPt},Symbol.toStringTag,{value:"Module"}));function T6e(){return{up:P(),right:P()}}function oPt(t,e,r){Ke(t.up,e.up,r),Ke(t.right,e.right,r)}function aPt(t,e,r){dt(t,ve(r,e.right),ve(r,e.up))}let lPt=class{constructor(){this.pos=P(),this.posES=P(),this.vLeft=P(),this.vRight=P(),this.vMinSiblingLength=0,this.frame=T6e(),this.rotationFrameUp=P(),this.rotationRight=Ne(),this.rotationAngle=0,this.miterStretch=x6e(),this.maxStretchDistance=0}setFrameFromUpVector(e){ce(this.frame.up,e),me(mA,this.vLeft,this.vRight),we(mA,mA),le(Fte,this.frame.up,ve(mA,this.frame.up)),ge(J5,mA,Fte),we(J5,J5),vt(this.frame.right,J5,this.frame.up)}},S6e=class{constructor(){this.vertices=[],this.vertexIndices=[],this.vertexNormals=[],this.poles=[],this.poleIndices=[]}addVertex(e,r){return this.vertices.push(hI(e)),this.vertexNormals.push(hI(r)),this.vertices.length-1}addPole(e,r=null){return this.poles.push({position:hI(e),normal:r?hI(r):null}),this.poles.length-1}addSegment(e,r=null){this.vertexIndices.push(e.v0),this.vertexIndices.push(e.v1),r&&(this.poleIndices.push(r.v0),this.poleIndices.push(r.v1))}get numSegments(){return this.vertexIndices.length/2}translate(e,r){for(const i of this.vertices)i[0]+=e,i[1]+=r;for(const i of this.poles)i.position[0]+=e,i.position[1]+=r}};function cPt(t=20){const r=new S6e,i={v0:0,v1:0};r.addPole(Rr(0,0));for(let s=0;s<t;++s){const o=2*s*Math.PI/t,a=Math.cos(o),l=Math.sin(o),c=Rr(a*.5,l*.5),h=Rr(a,l);r.addVertex(c,h)}for(let s=0;s<t-1;++s){const o={v0:s,v1:s+1};r.addSegment(o,i)}const n={v0:t-1,v1:0};return r.addSegment(n,i),r}function uPt(){const r=new S6e,i=Rr(.5*-1,.5*-1),n=Rr(.5*1,.5*-1),s=Rr(.5*1,.5*1),o=Rr(.5*-1,.5*1),a=Rr(0,-1),l=Rr(1,0),c=Rr(0,1),h=Rr(-1,0);return r.addPole(Rr(0,.5*1),c),r.addPole(Rr(0,.5*1)),r.addPole(Rr(0,.5*-1)),r.addPole(Rr(0,.5*-1),a),r.addVertex(i,a),r.addVertex(n,a),r.addSegment({v0:0,v1:1},{v0:3,v1:3}),r.addVertex(n,l),r.addVertex(s,l),r.addSegment({v0:2,v1:3},{v0:2,v1:1}),r.addVertex(s,c),r.addVertex(o,c),r.addSegment({v0:4,v1:5},{v0:0,v1:0}),r.addVertex(o,h),r.addVertex(i,h),r.addSegment({v0:6,v1:7},{v0:1,v1:2}),r}let hPt=class{constructor(e){this.vertices=e,this.offset=P(),this.xform=$e();const r=Math.floor((e.length-1)/2);ce(this.offset,this.vertices[r].pos);for(const i of this.vertices)ge(i.pos,i.pos,this.offset);Hc(this.xform,this.xform,this.offset),this.updatePathVertexInformation()}updatePathVertexInformation(){const e=this.vertices.length,r=this.vertices[0];r.index=0,r.vLeft=P(),ge(r.vRight,this.vertices[1].pos,r.pos);let i=Pe(r.vRight);r.vMinSiblingLength=i,we(r.vRight,r.vRight);let n=r;for(let s=1;s<e;++s){const o=this.vertices[s];if(o.index=s,o.vLeft=n.vRight,s<e-1){ge(o.vRight,this.vertices[s+1].pos,o.pos);const a=Pe(o.vRight);o.vMinSiblingLength=Math.min(i,a),i=a,we(o.vRight,o.vRight)}else ce(o.vRight,o.vLeft),o.vMinSiblingLength=i;n=o}}};function dPt(t,e){let r=null;const i=t.vertices.length,n=.99619469809,s=P(),o=P(),a=P(),l=P(),c=P(),h=P(),p=Yr();let f=t.vertices[0];ce(o,e),he(s,0,1,0),lV(f.vRight,o,s,s,a,o,n),ce(f.frame.up,o),ce(f.frame.right,a),r=f;for(let m=1;m<i;++m){f=t.vertices[m],me(c,f.vLeft,f.vRight);let g=Pe(c);g>0?(g=1/Math.sqrt(g),c[0]=c[0]*g,c[1]=c[1]*g,c[2]=c[2]*g):(c[0]=f.vRight[0],c[1]=f.vRight[1],c[2]=f.vRight[2]),me(h,r.pos,r.frame.up),UN(f.pos,c,p),j2(p,nd(h,f.vLeft),l)?(ge(l,l,f.pos),we(o,l),vt(a,c,o),we(a,a)):lV(c,r.frame.up,r.frame.right,s,a,o,n),ce(f.frame.up,o),ce(f.frame.right,a),r=f}}let pPt=class{numProfilesPerJoin(){return 1}extrude(e,r,i){for(let n=0;n<r.vertices.length;++n)i(e.index,e.frame,r.vertices[n],r.vertexNormals[n],!1)}},uW=class{constructor(e=.8*Math.PI,r=1){this.cutoffAngle=e,this.numBendSubdivisions=r}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(e,r,i){const n=bPt;if(Math.abs(e.rotationAngle)>=this.cutoffAngle)for(let s=0;s<this.numBendSubdivisions+1;++s){rd(Zve,.5*-e.rotationAngle+s*e.rotationAngle/this.numBendSubdivisions,e.rotationFrameUp),oPt(n,e.frame,Zve);for(let o=0;o<r.vertices.length;++o)Ss(r.vertices[o],e.rotationRight)*e.rotationAngle>=0?i(e.index,n,r.vertices[o],r.vertexNormals[o],!1):(pQ(xS,r.vertices[o],e.miterStretch),i(e.index,e.frame,xS,r.vertexNormals[o],!0))}else for(let s=0;s<this.numBendSubdivisions+1;++s)for(let o=0;o<r.vertices.length;++o){const a=Ss(r.vertices[o],e.rotationRight)*e.rotationAngle>=0;pQ(xS,r.vertices[o],e.miterStretch),i(e.index,e.frame,xS,r.vertexNormals[o],!a)}}},pce=class{rebuildConnectingProfileGeometry(e,r,i){for(let n=0;n<r.vertices.length;++n)i(e.index,e.frame,r.vertices[n],r.vertexNormals[n],0,0)}},Xve=class extends pce{constructor(){super()}getNumVertices(){return 0}getNumIndices(){return 0}rebuildCapGeometry(){}buildTopology(){}},Z5=class extends pce{constructor(e,r=0,i=!1){super(),this.profile=e,this.profilePlaneOffset=r,this.flip=i}getNumVertices(){return this.profile.vertices.length}getNumIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(e,r,i){for(let n=0;n<r.vertices.length;++n)i(e.index,e.frame,r.vertices[n],r.vertexNormals[n],this.profilePlaneOffset,0)}rebuildCapGeometry(e,r){const i=fce;dt(i,0,0);const n=this.flip?1:-1;for(let s=0;s<this.profile.vertices.length;++s)r(e.index,e.frame,this.profile.vertices[s],i,this.profilePlaneOffset,n)}buildTopology(e,r){const i=this.vertexBufferStart+this.profile.vertexIndices[0];for(let n=1;n<this.profile.numSegments;++n){const s=this.profile.vertexIndices[2*n+0],o=this.profile.vertexIndices[2*n+1],a=this.vertexBufferStart+s,l=this.vertexBufferStart+o;this.flip?r(l,a,i):r(i,a,l)}}},Yve=class extends pce{constructor(e){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=e.profile,this.flip=e.flip,this.sign=this.flip?1:-1,this.breakNormals=e.breakNormals,this.numSegments=e.subdivisions}getNumVertices(){let e=0;return e=this.profile.vertices.length*(this.numSegments-1),this.breakNormals&&(e+=this.profile.vertices.length),e+=this.profile.poles.length,e}getNumIndices(){let e=0;e+=2*this.profile.numSegments*(this.numSegments-1);for(let r=0;r<this.profile.numSegments;++r){const i=this.profile.vertexIndices[2*r+0],n=this.profile.vertexIndices[2*r+1];this.profile.poleIndices[i]===this.profile.poleIndices[n]?e+=1:e+=2}return 3*e}rebuildCapGeometry(e,r){const i=e.frame,n=.5*this.sign,s=xS,o=fce;dt(o,0,0);for(let a=0;a<this.profile.poles.length;++a){const l=this.profile.poles[a];l.normal?r(e.index,i,l.position,l.normal,n,0):r(e.index,i,l.position,o,n,this.sign)}if(this.breakNormals)for(let a=0;a<this.profile.vertices.length;++a)r(e.index,i,this.profile.vertices[a],this.profile.vertexNormals[a],0,0);for(let a=0;a<this.numSegments-1;++a){const l=(1-(a+1)/this.numSegments)*Math.PI*.5,c=Math.sin(l),h=Math.cos(l);for(let p=0;p<this.profile.vertices.length;++p){const f=this.profile.poles[this.profile.poleIndices[p]];jh(s,this.profile.vertices[p],f.position),sl(s,s,c),f.normal?(qd(s,s,f.position),r(e.index,i,s,f.normal,n*h,0)):(d2(o,s),sl(o,o,c),qd(s,s,f.position),r(e.index,i,s,o,n*h,this.sign*h))}}}buildTopology(e,r){const i=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex,n=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length;for(let s=0;s<this.profile.numSegments;++s){const o=this.profile.vertexIndices[2*s+0],a=this.profile.vertexIndices[2*s+1],l=this.vertexBufferStart+this.profile.poleIndices[o],c=this.vertexBufferStart+this.profile.poleIndices[a];let h=i+o,p=i+a;for(let f=0;f<this.numSegments-1;++f){const m=n+f*this.profile.vertices.length+o,g=n+f*this.profile.vertices.length+a;this.flip?(r(m,p,h),r(p,m,g)):(r(h,p,m),r(g,m,p)),h=m,p=g}this.flip?(r(l,p,h),l!==c&&r(l,c,p)):(r(h,p,l),l!==c&&r(p,c,l))}}},fPt=class{constructor(e,r,i,n,s,o={}){this.options=o,this._extrusionVertexCount=0,this.numExtrusionProfiles=0,this.numVerticesTotal=0,this.numNormalsTotal=0,this.profile=r,this.path=e,this.extruder=i,this.startCap=n,this.endCap=s;const a=this.path.vertices.length-2;this.numExtrusionProfiles=i.numProfilesPerJoin()*a+2,this.numVerticesTotal=r.vertices.length*this.numExtrusionProfiles,this.numNormalsTotal=this.numVerticesTotal,this.startCap.vertexBufferStart=this.numVerticesTotal;const l=this.startCap.getNumVertices();this.numVerticesTotal+=l,this.numNormalsTotal+=l,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.getNumVertices();this.numVerticesTotal+=c,this.numNormalsTotal+=c,this.pathVertexData=us(1*this.numVerticesTotal),this.profileRightAxisData=us(4*this.numVerticesTotal),this.profileUpAxisData=us(4*this.numVerticesTotal),this.profileVertexAndNormalData=us(4*this.numVerticesTotal),this.originData=us(3*this.path.vertices.length),this._rebuildGeometry(),this.buildTopology()}emitVertex(e,r,i,n,s){if(this.profileRightAxisData[4*this._extrusionVertexCount+0]=r.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=r.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=r.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=r.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=r.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=r.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=i[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=i[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=n[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=n[1],this.pathVertexData[this._extrusionVertexCount]=e,s){const o=this.path.vertices[e];this.profileRightAxisData[4*this._extrusionVertexCount+3]=o.rotationRight[0]*o.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=o.rotationRight[1]*o.maxStretchDistance}else this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0;++this._extrusionVertexCount}emitCapVertex(e,r,i,n,s,o){this.profileRightAxisData[4*this._extrusionVertexCount+0]=r.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=r.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=r.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=r.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=r.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=r.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=i[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=i[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=n[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=n[1],this.pathVertexData[this._extrusionVertexCount]=e,this.profileRightAxisData[4*this._extrusionVertexCount+3]=s,this.profileUpAxisData[4*this._extrusionVertexCount+3]=o,++this._extrusionVertexCount}_rebuildGeometry(){const e=(i,n,s,o,a)=>this.emitVertex(i,n,s,o,a),r=(i,n,s,o,a,l)=>this.emitCapVertex(i,n,s,o,a,l);this._extrusionVertexCount=0;for(const i of this.path.vertices)this.originData[3*i.index+0]=i.pos[0],this.originData[3*i.index+1]=i.pos[1],this.originData[3*i.index+2]=i.pos[2];this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,r);for(let i=1;i<this.path.vertices.length-1;++i)this.extruder.extrude(this.path.vertices[i],this.profile,e);this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,r),this.startCap.rebuildCapGeometry(this.path.vertices[0],r),this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],r)}buildTopology(){const e=this.profile.vertices.length,r=this.profile.numSegments,i=this.numExtrusionProfiles-1;let n=3*(2*(r*i));this.startCap.indexBufferStart=n,this.startCap.firstProfileVertexIndex=0,n+=this.startCap.getNumIndices(),this.endCap.indexBufferStart=n,this.endCap.firstProfileVertexIndex=e*(this.numExtrusionProfiles-1);const s=new Array,o=new Array,a=new Array,l=(c,h,p)=>{s.push(c),s.push(h),s.push(p),o.push(c),o.push(h),o.push(p),a.push(this.pathVertexData[c]),a.push(this.pathVertexData[h]),a.push(this.pathVertexData[p])};for(let c=0;c<r;++c){const h=this.profile.vertexIndices[2*c],p=this.profile.vertexIndices[2*c+1];for(let f=0;f<i;++f){const m=f*e+h,g=(f+1)*e+p,_=f*e+p;l(m,(f+1)*e+h,g),l(m,g,_)}}this.startCap.buildTopology(this.path.vertices[0],l),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],l),this.vertexIndices=NR(s),this.normalIndices=NR(o),this.pathVertexIndices=NR(a)}onPathChanged(){this._rebuildGeometry()}},E6e=class{constructor(e){this.builder=e}get xform(){return this.builder.path.xform}onPathChanged(){this.builder.onPathChanged()}},C6e=class extends E6e{constructor(e){super(e),this.vertexAttributePosition=null,this.vertexAttributeNormal=null,this.vertexAttributeColor=null,this.vertexAttributePosition=us(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=us(3*this.builder.numNormalsTotal),this.vertexAttributeColor=new Uint8Array(4),this.vertexAttributeColor[0]=255,this.vertexAttributeColor[1]=255,this.vertexAttributeColor[2]=255,this.vertexAttributeColor[3]=255}bakeVertexColors(e){this.vertexAttributeColor[0]=255*e[0],this.vertexAttributeColor[1]=255*e[1],this.vertexAttributeColor[2]=255*e[2],this.vertexAttributeColor[3]=255*(e.length>3?e[3]:1)}bake(e){this.size=e;for(let r=0;r<this.builder.numVerticesTotal;++r){let i=this.builder.pathVertexData[r];const n=i===0||i===this.builder.path.vertices.length-1;i*=3;const s=gPt;he(s,this.builder.originData[i++],this.builder.originData[i++],this.builder.originData[i]);const o=4*r,a=Fte,l=xS,c=mA,h=_Pt,p=vPt;let f=0,m=0;if(he(h,this.builder.profileRightAxisData[o],this.builder.profileRightAxisData[o+1],this.builder.profileRightAxisData[o+2]),he(p,this.builder.profileUpAxisData[o],this.builder.profileUpAxisData[o+1],this.builder.profileUpAxisData[o+2]),dt(l,this.builder.profileVertexAndNormalData[o]*e[0],this.builder.profileVertexAndNormalData[o+1]*e[1]),n)vt(c,p,h),f=this.builder.profileRightAxisData[o+3]*e[0],m=this.builder.profileUpAxisData[o+3];else{const _=fce,b=yPt;dt(_,this.builder.profileRightAxisData[o+3],this.builder.profileUpAxisData[o+3]);const w=lD(_);d2(_,_);const x=Ss(l,_);if(Math.abs(x)>w){dt(b,-_[1],_[0]);const T=Ss(l,b);sl(_,_,w*Math.sign(x)),sl(b,b,T),qd(l,_,b)}he(c,0,0,0)}he(a,h[0]*l[0]+p[0]*l[1],h[1]*l[0]+p[1]*l[1],h[2]*l[0]+p[2]*l[1]),this.vertexAttributePosition[3*r+0]=s[0]+a[0]+c[0]*f,this.vertexAttributePosition[3*r+1]=s[1]+a[1]+c[1]*f,this.vertexAttributePosition[3*r+2]=s[2]+a[2]+c[2]*f;const g=xS;dt(g,this.builder.profileVertexAndNormalData[o+2],this.builder.profileVertexAndNormalData[o+3]),this.vertexAttributeNormal[3*r+0]=h[0]*g[0]+p[0]*g[1]+c[0]*m,this.vertexAttributeNormal[3*r+1]=h[1]*g[0]+p[1]*g[1]+c[1]*m,this.vertexAttributeNormal[3*r+2]=h[2]*g[0]+p[2]*g[1]+c[2]*m}}createGeometryData(){const e=[[O.POSITION,this.builder.vertexIndices],[O.NORMAL,this.builder.normalIndices]],r=[[O.POSITION,new Qe(this.vertexAttributePosition,3,!0)],[O.NORMAL,new Qe(this.vertexAttributeNormal,3,!0)]];if(this.vertexAttributeColor){const i=this.builder.vertexIndices.length;e.push([O.COLOR,new Array(i).fill(0)]),r.push([O.COLOR,new Qe(this.vertexAttributeColor,4)])}return{vertexAttributes:r,indices:e}}onPathChanged(){super.onPathChanged(),this.bake(this.size)}intersect(e,r,i){const n=this.builder.vertexIndices,s=new Qe(this.vertexAttributePosition,3),o=n.length/3;XN(e,r,0,o,n,s,void 0,void 0,i)}},mPt=class extends E6e{constructor(e,r,i,n){super(e),this.sizeAttributeValue=r,this.colorAttributeValue=i,this.opacityAttributeValue=n,this.vvData=null,this.baked=new C6e(e),this.vvData=us(4*this.builder.path.vertices.length);for(let s=0;s<this.builder.path.vertices.length;++s){this.vvData[4*s+0]=r,this.vvData[4*s+1]=i,this.vvData[4*s+2]=n;const o=s===0||s===this.builder.path.vertices.length-1;this.vvData[4*s+3]=o?1:0}}createGeometryData(){return{vertexAttributes:[[O.POSITION,new Qe(this.builder.originData,3,!0)],[O.PROFILERIGHT,new Qe(this.builder.profileRightAxisData,4,!0)],[O.PROFILEUP,new Qe(this.builder.profileUpAxisData,4,!0)],[O.PROFILEVERTEXANDNORMAL,new Qe(this.builder.profileVertexAndNormalData,4,!0)],[O.FEATUREVALUE,new Qe(this.vvData,4,!0)]],indices:[[O.POSITION,this.builder.pathVertexIndices],[O.PROFILERIGHT,this.builder.vertexIndices],[O.PROFILEUP,this.builder.vertexIndices],[O.PROFILEVERTEXANDNORMAL,this.builder.vertexIndices],[O.FEATUREVALUE,this.builder.pathVertexIndices]]}}};const gPt=P(),xS=Ne(),fce=Ne(),yPt=Ne(),Fte=P(),mA=P(),_Pt=P(),vPt=P(),J5=P(),bPt=T6e(),Zve=$e(),hW=8;function wPt(t,e){const r=O.FEATUREVALUE;t.attributes.add(r,"vec4");const i=t.vertex;i.code.add(S`
  bool isCapVertex() {
    return ${r}.w == 1.0;
  }
  `),i.uniforms.add(new Hr("size",n=>n.size)),e.vvSize?(i.uniforms.add(new Jt("vvSizeMinSize",n=>n.vvSizeMinSize)),i.uniforms.add(new Jt("vvSizeMaxSize",n=>n.vvSizeMaxSize)),i.uniforms.add(new Jt("vvSizeOffset",n=>n.vvSizeOffset)),i.uniforms.add(new Jt("vvSizeFactor",n=>n.vvSizeFactor)),i.code.add(S`
    vec2 getSize() {
      return size * clamp(vvSizeOffset + ${r}.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):i.code.add(S`vec2 getSize(){
return size;
}`),e.vvOpacity?(i.constants.add("vvOpacityNumber","int",hW),i.uniforms.add([new ol("vvOpacityValues",n=>n.vvOpacityValues,hW),new ol("vvOpacityOpacities",n=>n.vvOpacityOpacities,hW)]),i.code.add(S`
    vec4 applyOpacity(vec4 color) {
      float value = ${r}.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):i.code.add(S`vec4 applyOpacity(vec4 color){
return color;
}`),e.vvColor?(i.constants.add("vvColorNumber","int",nm),i.uniforms.add([new ol("vvColorValues",n=>n.vvColorValues,nm),new y7("vvColorColors",n=>n.vvColorColors,nm)]),i.code.add(S`
    vec4 getColor() {
      float value = ${r}.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):i.code.add(S`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),t.include(BN),t.attributes.add(O.PROFILERIGHT,"vec4"),t.attributes.add(O.PROFILEUP,"vec4"),t.attributes.add(O.PROFILEVERTEXANDNORMAL,"vec4"),i.code.add(S`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),i.code.add(S`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),i.code.add(S`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),i.code.add(S`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}let xPt=class extends Nle{constructor(){super(...arguments),this.size=Rr(1,1)}};function TPt(t){const e=new Br,{vertex:r,fragment:i}=e;switch(Gu(r,t),e.varyings.add("vpos","vec3"),e.include(wPt,t),t.output!==V.Color&&t.output!==V.Alpha||(e.include(zc,t),e.include(S2,t),e.include(L3,t),e.varyings.add("vnormal","vec3"),e.varyings.add("vcolor","vec4"),t.hasMultipassTerrain&&e.varyings.add("depth","float"),r.code.add(S`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${t.output===V.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),e.include(od,t),t.output){case V.Alpha:e.include(hs,t),i.uniforms.add(new Ie("opacity",n=>n.opacity)),i.code.add(S`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        gl_FragColor = vec4(combinedOpacity);
      }
    `);break;case V.Color:e.include(hs,t),e.include(E2,t),e.include(rF,t),e.include(S2,t),e.include(Cke,t),mm(i,t),iF(i),H3(i),i.uniforms.add([r.uniforms.get("localOrigin"),new Jt("ambient",n=>n.ambient),new Jt("diffuse",n=>n.diffuse),new Jt("specular",n=>n.specular),new Ie("opacity",n=>n.opacity)]),i.include(by),vy(i),i.code.add(S`
        void main() {
          discardBySlice(vpos);
          ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          gl_FragColor = vec4(shadedColor, combinedOpacity);
          gl_FragColor = highlightSlice(gl_FragColor, vpos);
          ${t.transparencyPassType===At.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
        }
      `);break;case V.Depth:case V.Shadow:case V.ShadowHighlight:case V.ShadowExcludeHighlight:e.include(zc,t),_2(e),e.varyings.add("depth","float"),r.code.add(S`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),e.include(hs,t),e.include(M_,t),i.code.add(S`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case V.Normal:e.include(zc,t),e.include(ND,t),YO(r),e.varyings.add("vnormal","vec3"),r.code.add(S`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(hs,t),i.code.add(S`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case V.Highlight:e.include(zc,t),e.include(ND,t),e.varyings.add("vnormal","vec3"),r.code.add(S`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(hs,t),e.include(W_,t),i.code.add(S`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return e}const SPt=Object.freeze(Object.defineProperty({__proto__:null,build:TPt},Symbol.toStringTag,{value:"Module"})),A6e=new Map([[O.POSITION,0],[O.PROFILERIGHT,1],[O.PROFILEUP,2],[O.PROFILEVERTEXANDNORMAL,3],[O.FEATUREVALUE,4]]);let EPt=class extends xPt{constructor(){super(...arguments),this.ambient=ke(.2,.2,.2),this.diffuse=ke(.8,.8,.8),this.specular=ke(0,0,0),this.opacity=1}},R6e=class O6e extends Wr{initializeConfiguration(e,r){r.hasWebGL2Context=e.rctx.type===Et.WEBGL2,r.spherical=e.viewingMode===qe.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Gr(e.rctx,O6e.shader.get().build(this.configuration),A6e)}initializePipeline(){const e=this.configuration.transparencyPassType,r=this.configuration,i=e===At.NONE,n=e===At.FrontFace;return Ht({blending:r.output!==V.Color&&r.output!==V.Alpha||!r.transparent?null:i?Qh:X_(e),culling:r.hasSlicePlane&&!r.transparent&&r.doubleSidedMode!==Tn.None?cDe:null,depthTest:{func:kw(e)},depthWrite:i||n?Xc:null,colorWrite:ir,stencilWrite:r.hasOccludees?fy:null,stencilTest:r.hasOccludees?Uw:null,polygonOffset:i||n?null:b7})}};R6e.shader=new jr(SPt,()=>Q(()=>import("./Path.glsl-5bba4d6a.js"),[]));let So=class extends Io{constructor(){super(...arguments),this.output=V.Color,this.doubleSidedMode=Tn.None,this.transparencyPassType=At.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1}};u([j({count:V.COUNT})],So.prototype,"output",void 0),u([j({count:Tn.COUNT})],So.prototype,"doubleSidedMode",void 0),u([j({count:At.COUNT})],So.prototype,"transparencyPassType",void 0),u([j()],So.prototype,"spherical",void 0),u([j()],So.prototype,"receiveShadows",void 0),u([j()],So.prototype,"receiveAmbientOcclusion",void 0),u([j()],So.prototype,"vvSize",void 0),u([j()],So.prototype,"vvColor",void 0),u([j()],So.prototype,"vvOpacity",void 0),u([j()],So.prototype,"hasSlicePlane",void 0),u([j()],So.prototype,"transparent",void 0),u([j()],So.prototype,"hasOccludees",void 0),u([j()],So.prototype,"hasMultipassTerrain",void 0),u([j()],So.prototype,"cullAboveGround",void 0),u([j()],So.prototype,"doublePrecisionRequiresObfuscation",void 0),u([j({constValue:_t.Disabled})],So.prototype,"pbrMode",void 0),u([j({constValue:!0})],So.prototype,"hasVvInstancing",void 0),u([j({constValue:!1})],So.prototype,"useCustomDTRExponentForWater",void 0),u([j({constValue:!1})],So.prototype,"useFillLights",void 0);let CPt=class M6e extends Fw{constructor(e){super(e,new RPt),this.supportsEdges=!0,this._vertexAttributeLocations=A6e,this._configuration=new So,this._vertexBufferLayout=M6e.getVertexBufferLayout()}getConfiguration(e,r){return this._configuration.output=e,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,e!==V.Color&&e!==V.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Tn.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Tn.WindingOrder:Tn.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=!!r.ssaoHelper.active&&this.parameters.receiveSSAO),this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}isVisibleForOutput(e){return e!==V.Shadow&&e!==V.ShadowExcludeHighlight&&e!==V.ShadowHighlight||this.parameters.castShadows}isVisible(){return super.isVisible()&&this.parameters.opacity>0}intersect(e,r,i,n,s,o){const a=e;if(!w6e(a))return;const l=a.path,c=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSizeEnabled){const b=this.parameters.vvSizeOffset,w=this.parameters.vvSizeFactor,x=this.parameters.vvSizeMinSize,T=this.parameters.vvSizeMaxSize,E=l.sizeAttributeValue;c[0]*=_e(b[0]+E*w[0],x[0],T[0]),c[1]*=_e(b[2]+E*w[2],x[2],T[2])}const h=Math.max(c[0],c[1]),p=e.boundingInfo;if(R(p))return void this._intersectTriangles(l,c,n,s,o);const f=r2(p.bbMin[0]-h,p.bbMin[1]-h,p.bbMin[2]-h,p.bbMax[0]+h,p.bbMax[1]+h,p.bbMax[2]+h),m=[s[0]-n[0],s[1]-n[1],s[2]-n[2]],g=Math.sqrt(m[0]*m[0]+m[1]*m[1]+m[2]*m[2]),_=[g/m[0],g/m[1],g/m[2]];Rle(f,n,_,i.tolerance)&&this._intersectTriangles(l,c,n,s,o)}_intersectTriangles(e,r,i,n,s){e.baked.size&&e.baked.size[0]===r[0]&&e.baked.size[1]===r[1]||e.baked.bake(r),e.baked.intersect(i,n,s)}createBufferWriter(){return new G3(this._vertexBufferLayout)}requiresSlot(e,r){switch(r){case V.Shadow:case V.ShadowHighlight:case V.ShadowExcludeHighlight:if(!this.parameters.castShadows)return!1;case V.Color:case V.Alpha:case V.Depth:case V.Normal:case V.Highlight:case V.ObjectAndLayerIdColor:return e===(this.parameters.transparent?Ee.TRANSPARENT_MATERIAL:Ee.OPAQUE_MATERIAL)||e===Ee.DRAPED_MATERIAL;default:return!1}}createGLMaterial(e){return new APt(e)}static getVertexBufferLayout(){return mn().vec3f(O.POSITION).vec4f(O.PROFILERIGHT).vec4f(O.PROFILEUP).vec4f(O.PROFILEVERTEXANDNORMAL).vec4f(O.FEATUREVALUE)}},APt=class extends Nw{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}_updateShadowState(e){(R(this.technique)||e.shadowMap.enabled!==this.technique.configuration.receiveShadows)&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}beginSlot(e){return this._output!==V.Color&&this._output!==V.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e)),this.ensureTechnique(R6e,e)}},RPt=class extends EPt{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveSSAO=!0,this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}};const OPt=["polyline"];let MPt=class extends Ty{constructor(e,r,i,n){super(e,r,i,n),this._intrinsicSize=Rr(1,1),this._upVectorAlignment=jb.Path,this._stencilWidth=.1,this.ensureDrapedStatus(!1)}async doLoad(){const e=v(this.symbolLayer.width)?this.symbolLayer.width:this.symbolLayer.height,r=v(this.symbolLayer.height)?this.symbolLayer.height:e;this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[e,1,r],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=kD(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1};const i=this.symbolLayer.anchor||"center";this._upVectorAlignment=this.symbolLayer.profileRotation==="heading"?jb.World:jb.Path;const n=this.symbolLayer.profile||"circle";switch(n){default:case"circle":this._profile=cPt(_5e);break;case"quad":this._profile=uPt()}let s=[0,0];switch(i!=="center"&&(s={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[i],this._profile.translate(s[0],s[1])),this.symbolLayer.join){case"round":this._extruder=new uW(0,y5e);break;case"bevel":this._extruder=new uW(0,1);break;case"miter":this._extruder=new uW(.8*Math.PI,1);break;default:this._extruder=new pPt}const o=this.symbolLayer.cap||"butt";switch(o){case"none":this._startCap=new Xve,this._endCap=new Xve;break;case"butt":default:this._startCap=new Z5(this._profile,0),this._endCap=new Z5(this._profile,0,!0);break;case"square":this._startCap=new Z5(this._profile,-.5),this._endCap=new Z5(this._profile,.5,!0);break;case"round":{const m=n==="quad";this._startCap=new Yve({profile:this._profile,flip:!1,breakNormals:m,subdivisions:_te}),this._endCap=new Yve({profile:this._profile,flip:!0,breakNormals:m,subdivisions:_te});break}}const a=Xs(this.symbolLayer,"material","color"),l=this._getCombinedOpacityAndColor(a),c=$c(l),h=l[3],p=h<1||this.needsDrivenTransparentPass,f={diffuse:c,ambient:c,opacity:h,transparent:p,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:p||o==="none"?Ii.None:Ii.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(dt(this._intrinsicSize,e,r),!MV(this._intrinsicSize[0])||!MV(this._intrinsicSize[1])))throw new H("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if(this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||sl(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates.enabled){const m={...f,...this._fastUpdates.materialParameters,size:LIe(this._intrinsicSize)};this._material=new CPt(m)}else f.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new P_(f);this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,OPt,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new Tm),n=e.renderingInfo;return this._createAs3DShape(r,n,i,r.uid)}layerOpacityChanged(){const e=Xs(this.symbolLayer,"material","color"),r=this._getCombinedOpacity(e),i=r<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:r,transparent:i})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,_w)}slicePlaneEnabledChanged(){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables"||!UD(this._fastUpdates,r,this._vvConvertOptions))return Ys.Recreate_Symbol;this._material.setParameters(this._fastUpdates.materialParameters)}return Ys.Fast_Update}_getVertexData(e){let r=0;const i=e.paths,n=[],s=e.spatialReference,o=this._context.elevationProvider.spatialReference,a=this._context.renderCoordsHelper.spatialReference;for(const f of i)r+=f.length;const l=Zu(3*r),c=Zu(3*r);let h=0;for(const f of i){n.push({index:h,numVertices:f.length});for(const m of f)l[h++]=m[0],l[h++]=m[1],l[h++]=e.hasZ?m[2]:0}let p=!0;return v(o)&&!s.equals(o)&&(p=$n(l,s,0,l,o,0,r)),v(o)&&!o.equals(a)?$n(l,o,0,c,a,0,r):this._copyVertices(l,0,c,0,r),{pathVertexDataInfos:n,vertexDataES:l,vertexDataRS:c,projectionSuccess:p,terrainElevation:0}}_copyVertices(e,r,i,n,s){r*=3,n*=3;for(let o=0;o<s;++o)i[n++]=e[r++],i[n++]=e[r++],i[n++]=e[r++]}_createAs3DShape(e,r,i,n){const s=e.geometry,o=new Array,a=s.spatialReference,l=Ks(),c=this._context.renderCoordsHelper;I6e.spatialReference=a;const h=this._getVertexData(s);if(!h.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(h.pathVertexDataInfos.length===0)return s.paths.length!==0&&s.paths.some(g=>g.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;for(const g of h.pathVertexDataInfos){const _=g.index,b=g.numVertices;if(b<2||v(this._context.clippingExtent)&&(ki(l),Wh(l,h.vertexDataES,3*_,b),!jf(l,this._context.clippingExtent)))continue;const w=[];for(let D=_;D<_+3*b;){const U=D++,z=D++,B=D++,ee=new lPt;he(ee.posES,h.vertexDataES[U],h.vertexDataES[z],h.vertexDataES[B]);const te=TEt(ee.posES,this._context.elevationProvider,i,c);he(Zi,h.vertexDataRS[U],h.vertexDataRS[z],h.vertexDataRS[B]),c.setAltitude(Zi,te),ce(ee.pos,Zi),w.push(ee)}const x=new hPt(w);P6e(x,this._upVectorAlignment,this._context.renderCoordsHelper);const T=new fPt(x,this._profile,this._extruder,this._startCap,this._endCap);let E=null;if(this._fastUpdates.enabled){const D=this._fastUpdates.visualVariables,U=D.size?a_(D.size.field,e):0,z=D.color?a_(D.color.field,e):0,B=D.opacity?a_(D.opacity.field,e):0;E=new mPt(T,U,z,B)}else{const D=[this._intrinsicSize[0],this._intrinsicSize[1]];if(this._drivenProperties.size){const B=r.size;D[0]*=Jve(B[0],B[2]==="symbol-value"?this.symbolLayer.height||0:B[2],this.symbolLayer.width||0),D[1]*=Jve(B[2],B[0]==="symbol-value"?this.symbolLayer.width||0:B[0],this.symbolLayer.height||0)}let U;this._drivenProperties.color&&(U=r.color),this._drivenProperties.opacity&&r.opacity!=null&&(U=U?[U[0],U[1],U[2],r.opacity]:[1,1,1,r.opacity]);const z=new C6e(T);z.bake(D),U&&z.bakeVertexColors(U),E=z}const{vertexAttributes:C,indices:A}=E.createGeometryData(),I=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:this._context.layer.uid}),M=new rPt(this._material,C,A,E,a,this._upVectorAlignment,this._stencilWidth,I);M.transformation=E.xform,o.push(M)}if(o.length===0)return null;const p={layerUid:this._context.layer.uid,graphicUid:n},f=new Z_({geometries:o,metadata:p}),m=new xy(this,f,o,null,null,IPt,i);return m.alignedSampledElevation=h.terrainElevation,m.needsElevationUpdates=_w(i.mode),m}};function P6e(t,e,r){switch(e){default:case jb.World:for(const i of t.vertices){me(Zi,i.pos,t.offset),r.worldUpAtPosition(Zi,Zi),i.setFrameFromUpVector(Zi),i.rotationFrameUp=i.frame.up,dt(i.rotationRight,1,0),le(Zi,i.frame.up,ve(i.frame.up,i.vLeft)),ge(Zi,i.vLeft,Zi),ul(Zi,Zi),we(Zi,Zi),le(Iv,i.frame.up,ve(i.frame.up,i.vRight)),ge(Iv,i.vRight,Iv),we(Iv,Iv),vt(Kve,i.rotationFrameUp,i.vLeft);const n=Math.sign(ve(Kve,i.vRight));if(i.rotationAngle=n*(Math.PI-Js(ve(Zi,Iv))),Math.abs(i.rotationAngle)>0){const o=Nj(Math.cos(.5*i.rotationAngle));Nte(i.miterStretch,o-1+1,0,0,1)}const s=Math.PI-i.rotationAngle;i.maxStretchDistance=Math.abs(i.vMinSiblingLength/Math.cos(.5*s))}break;case jb.Path:me(Zi,t.vertices[0].pos,t.offset),r.worldUpAtPosition(Zi,Zi),dPt(t,Zi);for(const i of t.vertices){const n=Math.sign(ve(i.frame.right,i.vRight));vt(i.rotationFrameUp,i.vRight,i.vLeft),le(i.rotationFrameUp,i.rotationFrameUp,n),we(i.rotationFrameUp,i.rotationFrameUp);const s=ve(i.rotationFrameUp,i.frame.up),o=ve(i.rotationFrameUp,i.frame.right);if(le(Zi,i.frame.up,-o),le(Iv,i.frame.right,s),me(Zi,Zi,Iv),we(Zi,Zi),aPt(i.rotationRight,i.frame,Zi),ul(Zi,i.vLeft),i.rotationAngle=-n*(Math.PI-Js(ve(Zi,i.vRight))),Math.abs(i.rotationAngle)>0){const l=Nj(Math.cos(.5*i.rotationAngle));Nte(i.miterStretch,1+(l-1)*i.rotationRight[0]*i.rotationRight[0],(l-1)*i.rotationRight[0]*i.rotationRight[1],(l-1)*i.rotationRight[0]*i.rotationRight[1],1+(l-1)*i.rotationRight[1]*i.rotationRight[1])}const a=Math.PI-i.rotationAngle;i.maxStretchDistance=Math.abs(i.vMinSiblingLength*Nj(Math.cos(.5*a)))}}}function Jve(t,e,r){switch(t){case"symbol-value":return r;case"proportional":return e;default:return t}}function PPt(t,e,r,i){let n=0;for(const s of t.vertices)r(s.posES,dW),n+=dW.sampledElevation,me(Zi,s.pos,t.offset),i.setAltitude(Zi,dW.z),ge(s.pos,Zi,t.offset);return t.updatePathVertexInformation(),n/t.vertices.length}function IPt(t,e,r,i,n){const s=t.stageObject,o=s.geometries;let a=0;$Pt.spatialReference=n.spatialReference;for(const l of o){if(!w6e(l))continue;const c=l.path,h=c.builder.path,p=l.geometrySR;I6e.spatialReference=p,a+=PPt(h,e,i,n),l.upVectorAlignment!==jb.World&&P6e(h,l.upVectorAlignment,n),c.onPathChanged(),l.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(l)}return a/o.length}const $Pt=Y_(0,0,0,null),I6e=Y_(0,0,0,null),Zi=P(),Iv=P(),Kve=P(),dW=new JN;function LPt(t,e,r,i,n=1){if(r.isGeographic&&i===qe.Global){const c=Zu(e.length),h=e.length,p=ii(r);for(let f=0;f<h;f+=3)sse(e,f,c,f,p);e=c}dt(zs,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let c=0;c<e.length;c+=3)zs[0]=Math.min(zs[0],e[c]),zs[1]=Math.min(zs[1],e[c+1]);const s=zs[0]%n,o=zs[1]%n,a=zs[0]-s,l=zs[1]-o;for(let c=0;c<e.length;c+=3){const h=c/3*4;t[h]=(e[c]-a)/n,t[h+1]=(e[c+1]-l)/n,t[h+2]=a/n,t[h+3]=l/n}}function $6e(t,e,r,i,n=1){he(wx,1,0,0),he(xx,0,1,0),he(XE,0,0,1),FPt(pW,r),DPt(r,Qve)&&NPt(Qve,wx,xx,XE,i,pW),dt(zs,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),dt(Tx,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let h=0;h<r.length;h+=3){he(WE,r[h],r[h+1],r[h+2]);const p=ve(wx,WE),f=ve(xx,WE);zs[0]=Math.min(zs[0],p),zs[1]=Math.min(zs[1],f),Tx[0]=Math.max(Tx[0],p),Tx[1]=Math.max(Tx[1],f)}const s=ve(XE,pW);mW($v,zs[0],zs[1],s,wx,xx,XE),mW(Sx,Tx[0],zs[1],s,wx,xx,XE),mW(Ex,zs[0],Tx[1],s,wx,xx,XE),ge(Sx,Sx,$v),le(Sx,Sx,.5),ge(Ex,Ex,$v),le(Ex,Ex,.5),me($v,$v,Sx),me($v,$v,Ex);const o=zs[0]%n,a=zs[1]%n,l=zs[0]-o,c=zs[1]-a;for(let h=0;h<r.length;h+=3){he(WE,r[h],r[h+1],r[h+2]);const p=h/3,f=4*p;t[f]=(ve(wx,WE)-l)/n,t[f+1]=(ve(xx,WE)-c)/n,t[f+2]=l/n,t[f+3]=c/n;const m=9*p;for(let g=0;g<3;g++)e[m+g]=$v[g],e[m+g+3]=Sx[g],e[m+g+6]=Ex[g]}}const pW=P(),WE=P(),Qve=Yr(),wx=P(),xx=P(),XE=P(),zs=Ne(),Tx=Ne(),$v=P(),Sx=P(),Ex=P();function DPt(t,e){const r=t.length/3-1;return ILe(t,e,0,Math.floor(r/3),Math.floor(r*(2/3)))}function NPt(t,e,r,i,n,s){v(n)?(n.basisMatrixAtPosition(s,zm),he(K5,zm[0],zm[1],zm[2]),he(Q5,zm[4],zm[5],zm[6]),he(fW,zm[8],zm[9],zm[10])):(he(K5,1,0,0),he(Q5,0,1,0),he(fW,0,0,1));const o=t;ve(o,fW)<0&&le(o,o,-1),ce(i,o);const a=ve(o,Q5),l=ve(o,K5);Math.abs(a)<Math.abs(l)?(hS(e,K5,o,-l),we(e,e),vt(r,e,o),we(r,r),le(r,r,-1)):(hS(r,Q5,o,-a),we(r,r),vt(e,r,o),we(e,e))}const zm=$e(),K5=P(),Q5=P(),fW=P();function FPt(t,e){he(ZM,0,0,0);for(let r=0;r<e.length-3;r+=3)ZM[0]+=e[r],ZM[1]+=e[r+1],ZM[2]+=e[r+2];le(t,ZM,1/(e.length/3-1))}const ZM=P();function mW(t,e,r,i,n,s,o){he(t,e*n[0]+r*s[0]+i*o[0],e*n[1]+r*s[1]+i*o[1],e*n[2]+r*s[2]+i*o[2])}function kPt(t){const e=new Br,{vertex:r,fragment:i}=e,n=t.output===V.Depth,s=t.hasMultipassTerrain&&(t.output===V.Color||t.output===V.Alpha);return Gu(r,t),e.include(zc,t),e.include(X2,t),e.include(g7,t),e.attributes.add(O.POSITION,"vec3"),e.varyings.add("vpos","vec3"),s&&e.varyings.add("depth","float"),n&&(e.include(M_,t),_2(e),pw(e)),r.code.add(S`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();
      ${s?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${n?S`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:S`transformPosition(proj, view, vpos);`}
    }
  `),e.include(hs,t),s&&e.include(od,t),i.include(by),i.uniforms.add(new br("eColor",o=>o.color)),t.output===V.Highlight&&e.include(W_,t),i.code.add(S`
  void main() {
    discardBySlice(vpos);
    ${s?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = ${t.hasVertexColors?"vColor * eColor;":"eColor;"}

    ${t.output===V.ObjectAndLayerIdColor?S`fColor.a = 1.0;`:""}

    if (fColor.a < ${S.float(Fa)}) {
      discard;
    }

    ${t.output===V.Alpha?S`gl_FragColor = vec4(fColor.a);`:""}

    ${t.output===V.Color?S`gl_FragColor = highlightSlice(fColor, vpos); ${t.transparencyPassType===At.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    ${t.output===V.Highlight?S`outputHighlight();`:""};
    ${t.output===V.Depth?S`outputDepth(linearDepth);`:""};
    ${t.output===V.ObjectAndLayerIdColor?S`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const UPt=Object.freeze(Object.defineProperty({__proto__:null,build:kPt},Symbol.toStringTag,{value:"Module"}));let L6e=class D6e extends Wr{initializeConfiguration(e,r){r.hasWebGL2Context=e.rctx.type===Et.WEBGL2}initializeProgram(e){return new Gr(e.rctx,D6e.shader.get().build(this.configuration),Lr)}_createPipeline(e,r){const i=this.configuration,n=e===At.NONE,s=e===At.FrontFace;return Ht({blending:i.output!==V.Color&&i.output!==V.Alpha||!i.transparent?null:n?Qh:X_(e),culling:qB(i.cullFace),depthTest:{func:kw(e)},depthWrite:(n||s)&&i.writeDepth?Xc:null,colorWrite:ir,stencilWrite:i.hasOccludees?fy:null,stencilTest:i.hasOccludees?r?ww:Uw:null,polygonOffset:n||s?i.polygonOffset?zPt:null:w7(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};L6e.shader=new jr(UPt,()=>Q(()=>import("./ColorMaterial.glsl-7d9cf3fb.js"),[]));const zPt={factor:1,units:1};let gu=class extends Io{constructor(){super(...arguments),this.output=V.Color,this.cullFace=Ii.None,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=At.NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1}};u([j({count:V.COUNT})],gu.prototype,"output",void 0),u([j({count:Ii.COUNT})],gu.prototype,"cullFace",void 0),u([j()],gu.prototype,"hasSlicePlane",void 0),u([j()],gu.prototype,"hasVertexColors",void 0),u([j()],gu.prototype,"transparent",void 0),u([j()],gu.prototype,"polygonOffset",void 0),u([j()],gu.prototype,"enableOffset",void 0),u([j()],gu.prototype,"writeDepth",void 0),u([j()],gu.prototype,"hasOccludees",void 0),u([j({count:At.COUNT})],gu.prototype,"transparencyPassType",void 0),u([j()],gu.prototype,"hasMultipassTerrain",void 0),u([j()],gu.prototype,"cullAboveGround",void 0),u([j()],gu.prototype,"objectAndLayerIdColorInstanced",void 0);let e1e=class extends ece{constructor(e){super(e,new BPt),this.supportsEdges=!0,this._configuration=new gu}getConfiguration(e,r){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<v7,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}requiresSlot(e,r){return r===V.Color||r===V.Alpha||r===V.Highlight||r===V.Depth&&this.parameters.writeLinearDepth||r===V.ObjectAndLayerIdColor?e===Ee.DRAPED_MATERIAL?!0:r===V.Highlight?e===Ee.OPAQUE_MATERIAL:e===(this.parameters.transparent?this.parameters.writeDepth?Ee.TRANSPARENT_MATERIAL:Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:Ee.OPAQUE_MATERIAL):!1}createGLMaterial(e){return new VPt(e)}createBufferWriter(){return new G3(ue("enable-feature:objectAndLayerId-rendering")?OAt:ske)}},VPt=class extends Nw{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==V.Color&&this._output!==V.Alpha||this._updateOccludeeState(e),this.ensureTechnique(L6e,e)}},BPt=class extends z3{constructor(){super(...arguments),this.color=Wg,this.transparent=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Ii.None,this.hasOccludees=!1}};var la;(function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.Cross=2]="Cross",t[t.ForwardDiagonal=3]="ForwardDiagonal",t[t.BackwardDiagonal=4]="BackwardDiagonal",t[t.DiagonalCross=5]="DiagonalCross",t[t.COUNT=6]="COUNT"})(la||(la={}));const kte=.70710678118,t1e=kte,jPt=.08715574274;function GPt(t){const e=new Br,r=t.hasMultipassTerrain&&(t.output===V.Color||t.output===V.Alpha);t.draped||e.extensions.add("GL_OES_standard_derivatives");const{vertex:i,fragment:n}=e;Gu(i,t),e.include(zc,t),e.include(X2,t),t.draped?i.uniforms.add(new Ie("worldToScreenRatio",(a,l)=>1/l.screenToPCSRatio)):e.attributes.add(O.BOUNDINGRECT,"mat3"),e.attributes.add(O.POSITION,"vec3"),e.attributes.add(O.UVMAPSPACE,"vec4"),e.varyings.add("vpos","vec3"),e.varyings.add("vuv","vec2"),r&&e.varyings.add("depth","float");const s=t.style===la.ForwardDiagonal||t.style===la.BackwardDiagonal||t.style===la.DiagonalCross;s&&i.code.add(S`
      const mat2 rotate45 = mat2(${S.float(kte)}, ${S.float(-t1e)},
                                 ${S.float(t1e)}, ${S.float(kte)});
    `),t.draped||(mm(i,t),i.uniforms.add(new Ie("worldToScreenPerDistanceRatio",(a,l)=>1/l.camera.perScreenPixelRatio)),i.code.add(S`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),i.code.add(S`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),i.code.add(S`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${S.float(jPt)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),i.code.add(S`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${s?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${s?" * rotate45":""};

      ${t.draped?"":S`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${S.float(t.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `);const o=t.output===V.Depth;return o&&(e.include(M_,t),_2(e),pw(e)),i.code.add(S`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${r?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      gl_Position = ${o?S`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:S`transformPosition(proj, view, vpos);`}
    }
  `),e.include(hs,t),n.include(by),t.draped&&n.uniforms.add(new Ie("texelSize",(a,l)=>1/l.camera.pixelRatio)),t.output===V.Highlight&&e.include(W_,t),r&&e.include(od,t),t.output!==V.Highlight&&(n.code.add(S`
      const float lineWidth = ${S.float(t.lineWidth)};
      const float spacing = ${S.float(t.patternSpacing)};
      const float spacingINV = ${S.float(1/t.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),t.draped||n.code.add(S`const int maxSamples = 5;
float sample(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),n.uniforms.add(new br("uColor",a=>a.color)),n.code.add(S`
    void main() {
      discardBySlice(vpos);
      ${r?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = ${t.hasVertexColors?"vColor * uColor;":"uColor;"}
      color = highlightSlice(color, vpos);

      ${t.output!==V.Highlight?S`color.a *= ${HPt(t)};`:""}

      ${t.output===V.ObjectAndLayerIdColor?S`color.a = 1.0;`:""}

      if (color.a < ${S.float(Fa)}) {
        discard;
      }

      ${t.output===V.Alpha?S`gl_FragColor = vec4(color.a);`:""}

      ${t.output===V.Color?S`gl_FragColor = color; ${t.transparencyPassType===At.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
      ${t.output===V.Highlight?S`outputHighlight();`:""}
      ${t.output===V.Depth?S`outputDepth(linearDepth);`:""};
    }
  `),e}function HPt(t){function e(r){return t.draped?S`coverage(vuv.${r}, texelSize)`:S`sample(vuv.${r})`}switch(t.style){case la.ForwardDiagonal:case la.Horizontal:return e("y");case la.BackwardDiagonal:case la.Vertical:return e("x");case la.DiagonalCross:case la.Cross:return S`
        1.0 - (1.0 - ${e("x")}) * (1.0 - ${e("y")})
      `;default:return"0.0"}}const qPt=Object.freeze(Object.defineProperty({__proto__:null,build:GPt},Symbol.toStringTag,{value:"Module"}));let N6e=class F6e extends Wr{initializeConfiguration(e,r){r.hasWebGL2Context=e.rctx.type===Et.WEBGL2}initializeProgram(e){return new Gr(e.rctx,F6e.shader.get().build(this.configuration),k6e)}_setPipelineState(e,r){const i=this.configuration,n=e===At.NONE,s=e===At.FrontFace;return Ht({blending:i.output===V.Color||i.output===V.Alpha?n?Qh:X_(e):null,culling:qB(i.cullFace),depthTest:{func:kw(e)},depthWrite:n?i.writeDepth?Xc:null:_7(e),colorWrite:ir,stencilWrite:i.hasOccludees?fy:null,stencilTest:i.hasOccludees?r?ww:Uw:null,polygonOffset:n||s?i.polygonOffset?WPt:null:w7(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};N6e.shader=new jr(qPt,()=>Q(()=>import("./Pattern.glsl-b20f4cce.js"),[]));const WPt={factor:1,units:1};let Dl=class extends Io{constructor(){super(...arguments),this.output=V.Color,this.cullFace=Ii.None,this.transparencyPassType=At.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.writeDepth=!0,this.hasOccludees=!1,this.enableOffset=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}};u([j({count:V.COUNT})],Dl.prototype,"output",void 0),u([j({count:Ii.COUNT})],Dl.prototype,"cullFace",void 0),u([j({count:la.COUNT})],Dl.prototype,"style",void 0),u([j({count:At.COUNT})],Dl.prototype,"transparencyPassType",void 0),u([j()],Dl.prototype,"hasSlicePlane",void 0),u([j()],Dl.prototype,"hasVertexColors",void 0),u([j()],Dl.prototype,"polygonOffset",void 0),u([j()],Dl.prototype,"writeDepth",void 0),u([j()],Dl.prototype,"hasOccludees",void 0),u([j()],Dl.prototype,"patternSpacing",void 0),u([j()],Dl.prototype,"lineWidth",void 0),u([j()],Dl.prototype,"enableOffset",void 0),u([j()],Dl.prototype,"draped",void 0),u([j()],Dl.prototype,"hasMultipassTerrain",void 0),u([j()],Dl.prototype,"cullAboveGround",void 0);const k6e=new Map([[O.POSITION,0],[O.COLOR,3],[O.UVMAPSPACE,4],[O.BOUNDINGRECT,5]]);let mce=class extends ece{constructor(e){super(e,new ZPt),this.supportsEdges=!0,this._vertexAttributeLocations=k6e,this._configuration=new Dl}getConfiguration(e,r){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.style=this.parameters.style,this._configuration.patternSpacing=this.parameters.patternSpacing,this._configuration.lineWidth=this.parameters.lineWidth,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<v7,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}requiresSlot(e,r){return r===V.Color||r===V.Alpha||r===V.Highlight||r===V.Depth&&this.parameters.writeLinearDepth?e===Ee.DRAPED_MATERIAL?!0:r===V.Highlight?e===Ee.OPAQUE_MATERIAL:e===(this.parameters.writeDepth?Ee.TRANSPARENT_MATERIAL:Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):!1}createGLMaterial(e){return new XPt(e)}createBufferWriter(){const e=mn().vec3f(O.POSITION).vec4u8(O.COLOR).vec4f(O.UVMAPSPACE);return this.parameters.draped||e.mat3f(O.BOUNDINGRECT),new YPt(e)}},XPt=class extends Nw{_updateParameters(e){return this.ensureTechnique(N6e,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==V.Color&&this._output!==V.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},YPt=class extends G3{write(e,r,i,n,s){for(const o of this.vertexBufferLayout.fieldNames){const a=i.vertexAttributes.get(o),l=i.indices.get(o);if(a&&l)switch(o){case O.POSITION:{wt(a.size===3);const c=n.getField(o,Ui);c&&m7(l,a.data,e,c,s);break}case O.COLOR:{wt(a.size===3||a.size===4);const c=n.getField(o,gl);c&&Ple(l,a.data,a.size,c,s);break}case O.UVMAPSPACE:{wt(a.size===4);const c=n.getField(o,Yu);c&&ZO(l,a.data,c,s);break}case O.BOUNDINGRECT:{wt(a.size===9);const c=n.getField(o,fw);c&&this.writeBoundingRect(l,a.data,e,c,s);break}}}}writeBoundingRect(e,r,i,n,s){const o=i,a=n.typedBuffer,l=n.typedBufferStride,c=e.length;s*=l;for(let h=0;h<c;++h){const p=9*e[h],f=r[p],m=r[p+1],g=r[p+2];a[s]=o[0]*f+o[4]*m+o[8]*g+o[12],a[s+1]=o[1]*f+o[5]*m+o[9]*g+o[13],a[s+2]=o[2]*f+o[6]*m+o[10]*g+o[14];for(let _=3;_<9;++_)a[s+_]=r[p+_];s+=l}}},ZPt=class extends z3{constructor(){super(...arguments),this.color=Zt(1,1,1,1),this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Ii.None,this.hasOccludees=!1,this.style=la.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}};function JPt(t,e,r){return QPt(KPt(t),e,r)}function KPt(t){return t&&t.pattern||null}function QPt(t,e,r){return v(t)?t.style==="none"||t.style==="solid"?(t.style==="none"&&(e.color=Zt(0,0,0,0),e.transparent=!0),new e1e(e)):(e.style=eIt(t.style),e.draped=r.isDraped,new mce(e)):new e1e(e)}function eIt(t){switch(t){case"horizontal":return la.Horizontal;case"vertical":return la.Vertical;case"cross":return la.Cross;case"forward-diagonal":return la.ForwardDiagonal;case"backward-diagonal":return la.BackwardDiagonal;case"diagonal-cross":return la.DiagonalCross;default:return}}function tIt(t){return t.material instanceof mce&&!t.material.parameters.draped}function rIt(t,e){if(tIt(t)){const r=t.vertexAttributes.get(O.POSITION).data,i=t.getMutableAttribute(O.UVMAPSPACE).data,n=t.getMutableAttribute(O.BOUNDINGRECT).data;$6e(i,n,r,e)}}function iIt(t,e,r,i,n){const s=c5e(t,e,r,i,n),o=t.stageObject.geometries;for(const a of o)rIt(a,n);return s}const nIt=["polyline","polygon","extent"];let U6e=class z6e extends Ty{constructor(e,r,i,n){super(e,r,i,n),this._needsUV=!1,this._hasOutline=!1}async doLoad(){}_ensureMaterials(){this._ensureFillMaterial(),this._ensureOutlineMaterial()}_ensureFillMaterial(){if(v(this._material))return;const e=Xs(this.symbolLayer,"material","color"),r=this._getCombinedOpacityAndColor(e);this._material=JPt(this.symbolLayer,{color:r,transparent:r[3]<1||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,hasSlicePlane:this._context.slicePlaneEnabled},{isDraped:this.draped}),this._needsUV=this._material instanceof mce,this._context.stage.add(this._material)}_ensureOutlineMaterial(){const e=this.symbolLayer.outline;if(v(this._outlineMaterial)||!this._isValidOutline(e))return;this._hasOutline=!0;const r=i=>{const n=Xke(e.pattern);return new lR({width:i,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:n,stippleScaleWithLineWidth:!0,cap:Pte(e.patternCap||"butt")})};this._outlineMaterial=r(da(e.size)),this._context.stage.add(this._outlineMaterial)}_isValidOutline(e){return v(e)&&e.size!=null&&e.size>0&&v(e.color)&&(R(e.pattern)||e.pattern.type!=="style"||e.pattern.style!=="none")}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null,this._context.stage.remove(this._outlineMaterial),this._outlineMaterial=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,nIt,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(e.renderingInfo,255),n=this.setGraphicElevationContext(r,new Tm);return this.ensureDrapedStatus(n.mode==="on-the-ground"),this._ensureMaterials(),this.draped?this._createAsOverlay(r,i):this._createAs3DShape(r,i,n)}layerOpacityChanged(){if(v(this._material)){const e=this._material.parameters.color,r=Xs(this.symbolLayer,"material","color"),i=this._getCombinedOpacity(r);this._material.setParameters({color:[e[0],e[1],e[2],i],transparent:i<1||this.needsDrivenTransparentPass})}if(v(this._outlineMaterial)){const e=this._outlineMaterial.parameters.color;this._outlineMaterial.setParameters({color:[e[0],e[1],e[2],this._getOutlineOpacity()]})}}layerElevationInfoChanged(e,r,i){const n=this._elevationContext.mode,s=ZN(z6e.elevationModeChangeTypes,i,n);if(s!==Pn.UPDATE)return s;const o=$p(n);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){if(v(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),v(this._outlineMaterial)){const e={hasSlicePlane:this._context.slicePlaneEnabled};this._outlineMaterial.setParameters(e)}return!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_createAs3DShape(e,r,i){var h;const n=LD(e.geometry);if(R(n))return null;const s=ace(n,this._context.elevationProvider,this._context.renderCoordsHelper,i),o=new sIt(s,r,this._context.layer.uid,e.uid),a=o.renderData.position.length/3;if(this._needsUV&&(o.uvMapSpace=us(4*a,!0),o.boundingRect=Zu(9*a,!0),$6e(o.uvMapSpace,o.boundingRect,o.renderData.position,this._context.renderCoordsHelper)),o.objectAndLayerIdColor=(h=this._context.stage.renderView)==null?void 0:h.getObjectAndLayerIdColor(o),this._createAs3DShapeFill(o),this._hasOutline&&this._createAs3DShapeOutline(o),this._logGeometryCreationWarnings(o.renderData,n.rings,"rings","FillSymbol3DLayer"),o.outGeometries.length===0)return null;const l=new Z_({geometries:o.outGeometries,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:e.uid}}),c=new xy(this,l,o.outGeometries,null,null,iIt,i);return c.alignedSampledElevation=o.renderData.sampledElevation,c.needsElevationUpdates=$p(i.mode),c}_createAs3DShapeFill(e){const r=e.renderData.polygons;for(const{position:i,mapPositions:n,holeIndices:s,index:o,count:a}of r){if(v(this._context.clippingExtent)&&(ki(bd),Wh(bd,n),!jf(bd,this._context.clippingExtent)))continue;const l=vw(n,s,3);if(l.length===0)continue;const c=I_e({material:this._material,indices:l,mapPositions:n,attributeData:{position:i,color:e.color,uvMapSpace:this._needsUV?$ye(e.uvMapSpace,4*o,4*a):null,boundingRect:this._needsUV?_p(e.boundingRect,9*o,9*a):null,objectAndLayerIdColor:e.objectAndLayerIdColor}});e.outGeometries.push(c)}}_createAs3DShapeOutline(e){if(!this._hasOutline)return;const r=e.renderData.outlines;for(let i=0;i<r.length;++i){const{mapPositions:n,position:s}=r[i];if(v(this._context.clippingExtent)&&(ki(bd),Wh(bd,n),!jf(bd,this._context.clippingExtent)))continue;const o=Ite(this._outlineMaterial,{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:n,attributeData:{position:s}},e.objectAndLayerIdColor),a=o.vertexAttributes.get(O.POSITION);a.data===s&&(a.data=yvt(s)),e.outGeometries.push(o)}}_createAsOverlay(e,r){var a;const i=LD(e.geometry);if(R(i))return null;this._material.renderPriority=this._renderPriority+this._renderPriorityStep/2,v(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority);const n=xke(i,this._context.overlaySR),s=new oIt(n,r,this._context.layer.uid,e.uid),o=s.renderData.position.length/3;return this._needsUV&&(s.uvMapSpace=us(4*o,!0),LPt(s.uvMapSpace,s.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode)),s.outBoundingBox=ki(),s.objectAndLayerIdColor=(a=this._context.stage.renderView)==null?void 0:a.getObjectAndLayerIdColor(s),this._createAsOverlayFill(s),this._hasOutline&&this._createAsOverlayOutline(s),this._logGeometryCreationWarnings(s.renderData,i.rings,"rings","FillSymbol3DLayer"),s.outGeometries.length===0?null:new O7(this,s.outGeometries,s.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayFill(e){const r=e.renderData.polygons;for(const{position:i,holeIndices:n,index:s,count:o}of r){const a=ki(bd);if(Wh(a,i),!jf(a,this._context.clippingExtent))continue;const l=vw(i,n,3);if(l.length===0)continue;gO(e.outBoundingBox,a);const c=I_e({material:this._material,indices:l,attributeData:{position:i,color:e.color,uvMapSpace:this._needsUV?$ye(e.uvMapSpace,4*s,4*o):null,objectAndLayerIdColor:e.objectAndLayerIdColor}}),h=new QO(c,e);ai(h.boundingSphere,.5*(a[0]+a[3]),.5*(a[1]+a[4]),0,.5*Math.sqrt((a[3]-a[0])*(a[3]-a[0])+(a[4]-a[1])*(a[4]-a[1]))),e.outGeometries.push(h)}}_createAsOverlayOutline(e){if(!this._hasOutline)return;const r=e.renderData.outlines;for(let i=0;i<r.length;++i){const{position:n}=r[i];if(ki(bd),Wh(bd,n),!jf(bd,this._context.clippingExtent))continue;gO(e.outBoundingBox,bd);const s=Ite(this._outlineMaterial,{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:n}},e.objectAndLayerIdColor),o=new QO(s,e),a=bd;ai(o.boundingSphere,.5*(a[0]+a[3]),.5*(a[1]+a[4]),0,.5*Math.sqrt((a[3]-a[0])*(a[3]-a[0])+(a[4]-a[1])*(a[4]-a[1]))),e.outGeometries.push(o)}}_getOutlineOpacity(){const e=Xs(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*(v(e)?e.a:0)}_getOutlineColor(){const e=Xs(this.symbolLayer,"outline","color"),r=this._getOutlineOpacity();return Z$(v(e)?Xe.toUnitRGB(e):null,r)}test(){return{...super.test(),createAsOverlay:(e,r)=>this._createAsOverlay(e,r),createAs3DShape:(e,r,i)=>this._createAs3DShape(e,r,i)}}};U6e.elevationModeChangeTypes={definedChanged:Pn.RECREATE,staysOnTheGround:Pn.NONE,onTheGroundChanged:Pn.RECREATE};const bd=Ks();let sIt=class extends E7{constructor(e,r,i,n){super(e,i,n),this.color=r}},oIt=class extends E7{constructor(e,r,i,n){super(e,i,n),this.color=r}},V6e=class B6e{constructor(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.textStyle=this._colorToRGBA(e.color),this.haloStyle=this._colorToRGB(e.halo.color),this.backgroundStyle=e.background.color[3]!==0?this._colorToRGBA(e.background.color):null}fontString(e){const r=this.definition.font;return`${r.style} ${r.weight} ${e}px ${r.family}, sans-serif`}_colorToRGB(e){return`rgb(${e.slice(0,3).map(r=>Math.floor(255*r)).toString()})`}_colorToRGBA(e){return`rgba(${e.slice(0,3).map(r=>Math.floor(255*r)).toString()},${e[3]})`}static async fromSymbol(e,r){const i=Xs(e,"material","color"),n=kh(i,Wg,Xe.toUnitRGBA),s=kh(e.size,12,da),o=e.lineHeight,a=v(e.background)?Xe.toUnitRGBA(e.background.color):Wg,l={family:kh(e.font,"sans-serif",m=>m.family),decoration:kh(e.font,"none",m=>m.decoration),weight:kh(e.font,"normal",m=>m.weight),style:kh(e.font,"normal",m=>m.style)},c=e.halo,h=v(c)&&v(c.color)&&c.size>0?{size:da(c.size),color:Xe.toUnitRGBA(c.color)}:{size:0,color:Wg},p=new B6e({color:n,size:s,background:{color:a,padding:v(e.background)?[.65*s,.5*s]:[0,0],borderRadius:v(e.background)?s*(6/16):0},lineSpacingFactor:o,font:l,halo:h,pixelRatio:r}),f=p.fontString(s);try{await document.fonts.load(f)}catch{re.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${f}'. Some text symbology may be rendered using the default browser font.`)}return p}},aIt=class{constructor(e,r,i){this._renderer=new kke(e,r,i)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const e=Rte(lIt,this._renderer.renderedWidth,this._renderer.renderedHeight),r=e.getContext("2d");return r.save(),this._renderer.render(r,0,0),r.restore(),new W2(e,{wrap:{s:$t.CLAMP_TO_EDGE,t:$t.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0,powerOfTwoResizeMode:kb.PAD})}};const lIt={canvas:null},cIt=[0,0,1];let uIt=class extends Ty{constructor(e,r,i,n){super(e,r,i,n),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=x7(this.symbolLayer.size);if(e)throw new H("graphics3dtextsymbollayer:invalid-size",e)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const e=this._context.graphicsCoreOwner.view.state.rasterPixelRatio;this._textRenderParameters=await V6e.fromSymbol(this.symbolLayer,e)}destroy(){super.destroy()}createGraphics3DGraphic(e){const r=e.graphic,i=$D(r.geometry);if(R(i))return this.logger.warn(`unsupported geometry type for text symbol: ${r.geometry.type}`),null;const n=this.symbolLayer.text;if(R(n)||n==="")return null;const s=Zne(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(v(s)&&!QCe(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const o=new o5e(s,this.symbolLayer.horizontalAlignment,aOt(this.symbolLayer.verticalAlignment));return this._createAs3DShape(r,i,n,o)}createLabel(e,r,i,n){const s=e.graphic,o=$D(s.geometry);if(R(o))return this.logger.warn(`unsupported geometry type for label: ${s.geometry.type}`),null;const a=r.text;return!a||/^\s+$/.test(a)?null:this._createAs3DShape(s,o,a,r,i,n)}setGraphicElevationContext(e,r,i=0){const n=super.setGraphicElevationContext(e,r);return n.addOffsetRenderUnits(i),n}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(e,r){return r1e(e,r,(i,n)=>{this.updateGraphicElevationContext(n,i)}),Pn.UPDATE}slicePlaneEnabledChanged(e,r){return r1e(e,r,i=>{for(const n of i.stageObject.geometries)n.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!1}skipHighSymbolLodsChanged(){return!0}updateGraphicElevationContext(e,r){const i=r.elevationContext;this.setGraphicElevationContext(e,i,v(r.metadata)?r.metadata.elevationOffset:0),r.needsElevationUpdates=$p(i.mode)||i.mode==="absolute-height"}_defaultElevationInfoNoZ(){return dIt}_createAs3DShape(e,r,i,n,s,o){const a=this.setGraphicElevationContext(e,new Tm,n.elevationOffset),l=Xs(e.geometry,"type")==="polyline",c=e.uid;let h=null,p=null;if(R(o)){const M=zke(n.horizontalPlacement);h=new aIt(i,M,this._textRenderParameters);let D=null;if(v(this._context.sharedResources.textures)){p=this._context.sharedResources.textures.fromData(h.key,()=>h.create(),()=>{v(D)&&D.release()});const U=this._context.stage.renderView.textureRepository.acquire(p.texture.id);if(R(U)||Ju(U))return p.release(),null;D=U}}const f=hIt(h,n),m={occlusionTest:!0,screenOffset:n.screenOffset,anchorPosition:f,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:n.centerOffsetUnits,drawInSecondSlot:!0};if(v(o)?m.textureId=o.id:v(p)&&(m.textureId=p.texture.id),v(n.verticalOffset)){const{screenLength:M,minWorldLength:D,maxWorldLength:U}=n.verticalOffset;m.verticalOffset={screenLength:da(M),minWorldLength:D||0,maxWorldLength:v(U)?U:1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:M,screenSizePerspectiveSettingsLabels:D}=this._context.sharedResources;m.screenSizePerspective=D.overridePadding(this._textRenderParameters.haloSize+this._textRenderParameters.definition.background.padding[0]),m.screenSizePerspectiveAlignment=M}let g;if(l&&(m.shaderPolygonOffset=1e-4),m.hasSlicePlane=this._context.slicePlaneEnabled,v(s)){const M=JSON.stringify(m);g=s.get(M),R(g)&&(g=new JO(m),s.add(M,g))}else g=new JO(m);const _=n.translation,b=v(h)?Rr(h.displayWidth,h.displayHeight):Wc,w=n.centerOffset,x=Yee(g,cIt,_,null,b,w,[0,0],null),T=qle(this._context,r,x,a,c);if(R(T))return null;const E=new xy(this,T.object,[x],R(s)?[g]:null,p,PD,a);E.alignedSampledElevation=T.sampledElevation,E.needsElevationUpdates=$p(a.mode)||a.mode==="absolute-height";const{displayWidth:C,displayHeight:A}=v(h)?h:n;E.getScreenSize=(M=Ne())=>(M[0]=C,M[1]=A,M);const I=new g5e(n.elevationOffset,i);return E.metadata=I,ID(E,r,this._context.elevationProvider),E}};function r1e(t,e,r){t&&t.forEach(i=>{const n=e(i);v(n)&&r(n,i.graphic)})}function hIt(t,e){if(e.verticalPlacement==="baseline"){const i=nOt[e.horizontalPlacement],n=v(t)?t.baselineAnchorY:0;return Rr(i,n)}const r=oOt(e.horizontalPlacement,e.verticalPlacement);return FU[r]}const dIt={mode:"relative-to-ground",offset:0},pIt={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},fIt=["polyline","polygon","extent"];let Ute=class OT extends Ty{constructor(e,r,i,n){super(e,r,i,n)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,fIt,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new Tm);return this.ensureDrapedStatus(i.mode==="on-the-ground"),this.ensureMaterial(),this.draped?this._createAsOverlay(r):this._createAs3DShape(r,i,r.uid)}ensureMaterial(){if(v(this._material))return;const e=new dke,r=this.symbolLayer.color;v(r)&&(e.color=Xe.toUnitRGBA(r));const i=this._getCombinedOpacity(r,{hasIntrinsicColor:!0});e.color=[e.color[0],e.color[1],e.color[2],i],e.transparent=i<1||this.needsDrivenTransparentPass,e.waveDirection=v(this.symbolLayer.waveDirection)?OT.headingVectorFromAngle(this.symbolLayer.waveDirection):Rr(0,0);const n=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,s=pIt[n];e.waveStrength=s.waveStrength,e.waveTextureRepeat=s.textureRepeat,e.waveVelocity=s.waveVelocity,e.flowStrength=s.perturbationStrength,e.hasSlicePlane=this._context.slicePlaneEnabled,e.isDraped=this.draped,this._material=new hke(e),this._context.stage.add(this._material)}layerOpacityChanged(){if(R(this._material))return;const e=this._material.parameters.color,r=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),i=r<1||this.needsDrivenTransparentPass;this._material.setParameters({color:[e[0],e[1],e[2],r],transparent:i})}layerElevationInfoChanged(e,r,i){const n=this._elevationContext.mode,s=ZN(OT.elevationModeChangeTypes,i,n);if(s!==Pn.UPDATE)return s;const o=$p(n);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){return v(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_createAs3DShape(e,r,i){const n=LD(e.geometry);if(R(n))return null;const s=ace(n,this._context.elevationProvider,this._context.renderCoordsHelper,r),o=s.position.length/3,a=Zu(2*o);this._createUVCoordsFromVertices(a,s.mapPositions,o,this._context.elevationProvider.spatialReference);const l=new mIt(s,a);if(this._create3DShapeGeometries(l),this._logGeometryCreationWarnings(l.renderData,n.rings,"rings","WaterSymbol3DLayer"),l.outGeometries.length===0)return null;const c=new Z_({geometries:l.outGeometries,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:i}}),h=new xy(this,c,l.outGeometries,null,null,c5e,r);return h.alignedSampledElevation=l.renderData.sampledElevation,h.needsElevationUpdates=$p(r.mode),h}_createUVCoordsFromVertices(e,r,i,n){const s=Kl(n);td(Lv);for(let l=0;l<i;l++)dt(i1e,r[3*l],r[3*l+1]),Rne(Lv,i1e);h3(Lv,Lv,s);const o=Lv[0]%OT.unitSizeOfTexture,a=Lv[1]%OT.unitSizeOfTexture;ek[0]=Lv[0]-o,ek[1]=Lv[1]-a;for(let l=0;l<i;l++)e[2*l]=(r[3*l]*s-ek[0])/OT.unitSizeOfTexture,e[2*l+1]=(r[3*l+1]*s-ek[1])/OT.unitSizeOfTexture}_create3DShapeGeometries(e){const r=e.renderData.polygons,i=e.uvCoords;for(const{count:n,index:s,position:o,mapPositions:a,holeIndices:l}of r){if(v(this._context.clippingExtent)&&(ki(Dv),Wh(Dv,a),!jf(Dv,this._context.clippingExtent)))continue;const c=vw(a,l,3);if(c.length===0)continue;const h=_p(i,2*s,2*n),p=$_e({material:this._material,indices:c,mapPositions:a,attributeData:{position:o,uv0:h}});e.outGeometries.push(p)}}_createAsOverlay(e){const r=LD(e.geometry);if(R(r))return null;this._material.renderPriority=this._renderPriority;const i=xke(r,this._context.overlaySR),n=i.position.length/3,s=Zu(2*n);this._createUVCoordsFromVertices(s,i.position,n,this._context.overlaySR);const o=new gIt(i,s,this._context.layer.uid,e.uid);return o.outBoundingBox=ki(),this._createAsOverlayWater(o),this._logGeometryCreationWarnings(o.renderData,r.rings,"rings","WaterSymbol3DLayer"),o.outGeometries.length===0?null:new O7(this,o.outGeometries,o.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayWater(e){const r=e.uvCoords,i=e.renderData.polygons;for(const{position:n,holeIndices:s,index:o,count:a}of i){if(ki(Dv),Wh(Dv,n),!jf(Dv,this._context.clippingExtent))continue;gO(e.outBoundingBox,Dv);const l=vw(n,s,3);if(l.length===0)continue;const c=_p(r,2*o,2*a),h=$_e({material:this._material,indices:l,attributeData:{position:n,uv0:c}}),p=new QO(h,e),f=Dv;ai(p.boundingSphere,.5*(f[0]+f[3]),.5*(f[1]+f[4]),0,.5*Math.sqrt((f[3]-f[0])*(f[3]-f[0])+(f[4]-f[1])*(f[4]-f[1]))),e.outGeometries.push(p)}}static headingVectorFromAngle(e){const r=Ne(),i=gN(e);return r[0]=Math.sin(i),r[1]=Math.cos(i),r}test(){return{...super.test(),create3DShape:e=>this._createAs3DShape(e.graphic,e.elevationContext,e.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}};Ute.unitSizeOfTexture=100,Ute.elevationModeChangeTypes={definedChanged:Pn.RECREATE,staysOnTheGround:Pn.NONE,onTheGroundChanged:Pn.RECREATE};const ek=Ne(),Lv=Kt(),i1e=Ne(),Dv=Ks();let mIt=class extends E7{constructor(e,r){super(e,null,null),this.uvCoords=r}},gIt=class extends E7{constructor(e,r,i,n){super(e,i,n),this.uvCoords=r}};function yIt(t,e,r,i){const n=n1e[t.type]&&n1e[t.type][e.type]||_It[e.type];return n?new n(t,e,r,i):(re.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",`unknown symbol type ${e.type}`),null)}const _It={icon:Mte,object:DMt,line:Yke,path:MPt,fill:U6e,extrude:jRt,text:uIt,water:Ute},n1e={"mesh-3d":{fill:y3t}};let vIt=class extends jle{set symbol(e){this._symbol=e,e.symbolLayers.forEach((r,i)=>{const n=this.symbolLayers[i];v(n)&&(n.symbol=e,n.symbolLayer=r)})}get symbol(){return this._symbol}constructor(e,r,i){super(r.schedule),this._symbol=e,this._context=r,this._backgroundLayers=i,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(e){let r=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(r=this._backgroundLayers.concat(r));const i=r.length;for(;this.symbolLayers.length<r.length;)this.symbolLayers.push(null);this.symbolLayers.length=r.length;const n=[];for(let s=0;s<i;s++){const o=r.getItemAt(s);if(o.enabled===!1)continue;tk.renderPriority=1-(1+s)/i,tk.renderPriorityStep=1/i,tk.ignoreDrivers=o._ignoreDrivers;const a=yIt(this.symbol,o,this._context,tk),l=E9(e,()=>{this.symbolLayers[s]=null,a.destroy()});l&&n.push(l),this.symbolLayers[s]=a}if(await pB(this.symbolLayers,async(s,o)=>{if(v(s))try{await s.load(),this._extentPadding+=Math.max(this._extentPadding,s.extentPadding)}catch{this.symbolLayers[o]=null}}),n.forEach(s=>s.remove()),lr(e),this.symbolLayers.length&&!this.symbolLayers.some(s=>!!s))throw new Error}getSymbolLayerSize(e){const r=this.symbolLayers[e];return v(r)?r.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(e=>v(e)&&e.queryForSnapping)}createGraphics3DGraphic(e,r){const i=e.graphic,n=new Array(this.symbolLayers.length);for(let o=0;o<this.symbolLayers.length;o++){const a=this.symbolLayers[o];n[o]=v(a)?a.createGraphics3DGraphic(e):null}const s=this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null;return new gCt(i,r||this,n,e.layer,s)}get complexity(){return Hle(this.symbolLayers.map(e=>Xs(e,"complexity")))}globalPropertyChanged(e,r){const i=this.symbolLayers.length;for(let n=0;n<i;n++){const s=this.symbolLayers[n],o=a=>{const l=a.layers[n];return l instanceof xy?l:null};if(v(s)&&!s.globalPropertyChanged(e,r,o))return!1}return!0}applyRendererDiff(e,r){return this.loadStatus!==Fh.LOADED?Ys.Recreate_Symbol:this.symbolLayers.reduce((i,n)=>i!==Ys.Recreate_Symbol&&v(n)?Math.min(i,n.applyRendererDiff(e,r)):i,Ys.Fast_Update)}prepareSymbolPatch(e){if(this.loadStatus===Fh.FAILED||e.diff.type!=="partial")return;const r=e.diff.diff;if(!r.symbolLayers||r.symbolLayers.type!=="partial")return;const i=r.symbolLayers.diff;this.symbolLayers.forEach((n,s)=>{if(R(n))return;const o=i[s];if(o){const a={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};n.prepareSymbolLayerPatch(a),e.symbolStatePatches.push(...a.symbolLayerStatePatches),a.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((l,c)=>{const h=l.layers[s];v(h)&&a.graphics3DGraphicPatches.forEach(p=>p(h,c))})}})}updateGeometry(e,r){for(let i=0;i<this.symbolLayers.length;i++){const n=this.symbolLayers[i];if(R(n))continue;const s=e.layers[i];if(R(s)||!n.updateGeometry(s,r))return!1}return!0}onRemoveGraphic(e){for(let r=0;r<this.symbolLayers.length;r++){const i=this.symbolLayers[r];if(R(i))continue;const n=e.layers[r];v(n)&&i.onRemoveGraphic(n)}}getFastUpdateStatus(){let e=0,r=0,i=0;return this.symbolLayers.forEach(n=>{R(n)||(n.loadStatus===Fh.LOADING?e++:n.isFastUpdatesEnabled()?i++:r++)}),{loading:e,slow:r,fast:i}}async queryForSnapping(e,r,i,n){const s=this.symbolLayers.filter(v).filter(a=>v(a.queryForSnapping)).map(a=>a.queryForSnapping(e,r,i,n)),o=await Promise.all(s);return lr(n),o.flat()}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const e of this.symbolLayers)v(e)&&e.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}};const tk={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1};let bIt=class extends jle{constructor(e,r,i){super(r),this.symbol=e,this._convert=i,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return v(this.graphics3DSymbol)?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return v(this.graphics3DSymbol)?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return v(this.graphics3DSymbol)?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const r=await this.symbol.fetchSymbol({signal:e});r.id=this.symbol.id,this.graphics3DSymbol=this._convert(r),v(this.graphics3DSymbol)&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return v(this.graphics3DSymbol)?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return v(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:Gle}globalPropertyChanged(e,r){return!!v(this.graphics3DSymbol)&&this.graphics3DSymbol.globalPropertyChanged(e,r)}applyRendererDiff(e,r){return v(this.graphics3DSymbol)?this.graphics3DSymbol.applyRendererDiff(e,r):Ys.Recreate_Symbol}prepareSymbolPatch(e){v(this.graphics3DSymbol)&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,r){return!!v(this.graphics3DSymbol)&&this.graphics3DSymbol.updateGeometry(e,r)}onRemoveGraphic(){}getFastUpdateStatus(){return v(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){v(this.graphics3DSymbol)&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}};function gce(t){return t instanceof bIt?t.graphics3DSymbol:t instanceof vIt?t:null}const zD=re.getLogger("esri.views.3d.layers.graphics.labelPlacement");function wIt(t){const e=MIt(t);if(R(e))return null;const r=xIt(t,e);if(R(r))return null;const i=r.anchor,n=!!e.hasLabelVerticalOffset;return SIt({anchor:i,verticalOffset:e.verticalOffset,screenOffset:Ne(),centerOffset:Zt(0,0,0,-1),centerOffsetUnits:"world",translation:P(),elevationOffset:0,hasLabelVerticalOffset:n},r,t)}function xIt(t,e){if(e.anchor)return e;const r=t.labelClass.labelPlacement,i=Yf[r],n=i||UV(t);return r&&!i&&zD.warnOncePerTick(`the requested label placement '${r}' is currently unsupported in SceneView.`),TIt(n,t)}function yce(t){const e=t.graphics3DGraphic.graphics3DSymbol,r=gce(e);return v(r)?r.symbol.symbolLayers.getItemAt(0):null}function TIt(t,e){const r=e.graphics3DGraphic.graphic.geometry;if(R(r))return null;if(v(e.disablePlacement))return e.labelClass.labelPlacement?(zD.warnOncePerTick(s1e(t.placement,e.disablePlacement.logEntityDescription)),UV(e)):t;const i=r.type;switch(i){case"polyline":case"polygon":case"extent":case"multipoint":if(e.labelClass.labelPlacement)return zD.warnOncePerTick(s1e(t.placement,`'${i}' geometries`)),UV(e);break;case"point":case"mesh":return t}return t}function s1e(t,e){return`the requested label placement '${t}' is currently unsupported for ${e} in SceneView.`}function UV(t){const e=t.graphics3DGraphic.graphic.geometry;if(R(e))return null;switch(e.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case"polygon":{const r=yce(t);return v(r)&&r.type==="extrude"?Yf["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"}}case"point":case"mesh":return Yf["above-center"];default:return}}function SIt(t,e,r){const i=r.graphics3DGraphic.graphic.geometry;if(R(i))return null;switch(i.type){case"point":CIt(t,e,r);break;case"polygon":EIt(t,e,r);break;case"mesh":_ce(t,e,r.graphics3DGraphic.layers[0])}return t}function EIt(t,e,r){const i=yce(r);if(!R(i))switch(i.type){case"extrude":{const n=r.graphics3DGraphic.layers[0];v(n)?(n.getBoundingBoxObjectSpace(nL),Bf(nL,t.translation),t.translation[2]=Ow(nL)/2):he(t.translation,0,0,0),_ce(t,e,n);break}}}function CIt(t,e,r){const i=yce(r);if(R(i))return;const n=r.graphics3DGraphic.layers[0];switch(v(n)?n.getCenterObjectSpace(t.translation):he(t.translation,0,0,0),i.type){case"icon":case"text":AIt(t,e,r,n);break;case"object":_ce(t,e,n)}}function AIt(t,e,r,i){const{graphics3DGraphic:n}=r,s=v(i)?i.getScreenSize():null;if(!n.isDraped&&v(s)){const o=RIt(r);JM[0]=s[0]/2*(e.normalizedOffset[0]-o[0]),JM[1]=s[1]/2*(e.normalizedOffset[1]-o[1]),t.screenOffset[0]=JM[0],t.hasLabelVerticalOffset?(t.centerOffset[1]=JM[1],t.centerOffsetUnits="screen"):t.screenOffset[1]=JM[1]}else t.hasLabelVerticalOffset||t.anchor==="center"||(Yf[r.labelClass.labelPlacement]&&zD.warnOncePerTick(`the requested placement '${e.placement}' is currently unsupported for draped graphics`),t.anchor="center")}function RIt(t,e=PIt){const{graphics3DGraphic:r}=t,i=r.layers[0],n=v(i)?i.stageObject.geometries[0].material:null;if(n&&n instanceof JO){const s=n.parameters.anchorPosition;e[0]=2*(s[0]-.5),e[1]=2*(s[1]-.5)}else e[0]=0,e[1]=0;return e}function _ce(t,e,r){const i=v(r)?r.getBoundingBoxObjectSpace(nL):nL,n=ke(i[3]-i[0],i[4]-i[1],i[5]-i[2]),s=Math.sqrt(n[0]*n[0]+n[1]*n[1]);t.centerOffset[0]=s/2*e.normalizedOffset[0];const o=t.translation[2],a=n[2]/2*e.normalizedOffset[1];t.translation[2]=0,t.elevationOffset=o+a;const l=Pe(n);t.centerOffset[2]=l/2*e.normalizedOffset[2]}function OIt(t){return t==="above-center"}function MIt(t){const e=t.labelClass.labelPlacement,{labelSymbol:r,graphics3DGraphic:i}=t,n=gce(i.graphics3DSymbol),s=Fo(n,a=>a.symbol.type==="point-3d"?a.symbol:null),o=Yf[e]||UV(t);return v(s)&&s.supportsCallout()&&s.hasVisibleVerticalOffset()&&!i.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:o1e(s.verticalOffset),anchor:null,normalizedOffset:null}:r&&r.hasVisibleVerticalOffset()&&(R(s)||!s.supportsCallout()||!s.verticalOffset||i.isDraped)?OIt(o.placement)?{placement:"above-center",verticalOffset:o1e(r.verticalOffset),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(zD.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+e+" placement)"),null):{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function o1e(t){const{screenLength:e,minWorldLength:r,maxWorldLength:i}=t;return{screenLength:e,minWorldLength:r,maxWorldLength:i}}const Yf={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},a1e={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const t in a1e){const e=a1e[t],r=Yf[t];e.forEach(i=>{Yf[i]=r})}Object.freeze&&(Object.freeze(Yf),Object.keys(Yf).forEach(t=>{Object.freeze(Yf[t]),Object.freeze(Yf[t].normalizedOffset)}));const JM=[0,0],PIt=[0,0],nL=Ks();let l1e=class{constructor(e){this._stage=e,this._materials=new Map}get(e){return this._materials.get(e)}add(e,r){this._materials.set(e,r),this._stage.add(r)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}};const gW=512,yW=4096,IIt=.85,$It=.95;let LIt=class{constructor(){this.offset={x:0,y:0},this.uvMinMax=pr()}},DIt=class{constructor(e,r){this.textId=e,this.textRenderer=r,this.placement=new LIt,this.rendered=!1}},VI=class extends be{constructor(e){super(e),this.type=Wn.Texture,this.id=Vu(),this.events=new Sn,this._glTexture=null,this._needsClear=!1,this._elementsToAddOrUpdate=new Map,this._elementsToRemove=new Map,this._elementsToRender=new Map,this._elements=new Map,this._stageObjects=new Map,this.updating=!1}initialize(){this._stage=this.view._stage,this._canvas=this._create2DCanvas(),this._ctx=this._canvas.getContext("2d"),this._stage.add(this);const e=this._computeAtlasResolution(this.view.width,this.view.height);this._createAtlasRegion(e),this._update2DCanvasSize(),this._resetAtlasCursor()}unload(){this._glTexture=rt(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get width(){return this._atlas.size.width}get height(){return this._atlas.size.height}get requiresFrameUpdates(){return!1}_createDescriptor(e){return{target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE,flipped:!0,samplingMode:it.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:e.parameters.maxMaxAnisotropy}}get glTexture(){return this._glTexture}load(e){return v(this._glTexture)||(this._glTexture=new mt(e,this._createDescriptor(e),this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(St.TEXT_TEXTURE_ATLAS,this),this.setDirty()),this._glTexture}dispose(){this._elements=null,this._elementsToAddOrUpdate=null,this._elementsToRemove=null,this._elementsToRender=null,this._frameWorker=$i(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=rt(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_create2DCanvas(){const e=document.createElement("canvas");return e.setAttribute("id","canvas2d"),e.setAttribute("style","display:none"),e.setAttribute("width",gW.toString()),e.setAttribute("height",gW.toString()),e}_update2DCanvasSize(){this._canvas.setAttribute("width",this._atlas.size.width.toString()),this._canvas.setAttribute("height",this._atlas.size.height.toString())}_createAtlasRegion(e=gW){this._atlas={size:{width:e,height:e},cursor:{x:0,y:0},lineHeight:0}}_computeAtlasResolution(e,r){let i=Math.max(e,r);return i+=256,i=fO(i),i=Math.min(i,yW),i}_resizeAtlas(e,r){r=r||e;const i=this._atlas;i.size.width=e,i.size.height=r,v(this._glTexture)&&this._glTexture.resize(e,r),this._update2DCanvasSize()}_resetAtlasCursor(){const e=this._atlas;e.cursor.x=KM,e.cursor.y=KM+c1e,e.lineHeight=0,this._needsClear=!0}_getAtlasUsage(){const e=this._atlas;return(e.cursor.x+e.cursor.y*e.size.width)/(e.size.width*e.size.height)}_getExpectedAtlasUsage(){const e=this._elementsToRemove.size,r=this._elementsToAddOrUpdate.size,i=this._elements.size;return this._getAtlasUsage()/i*(i+r-e)}_addAtlasElement(e,r,i,n){const s=this._atlas,{renderedWidth:o,renderedHeight:a}=e.textRenderer;e.placement.offset.x=s.cursor.x,e.placement.offset.y=s.cursor.y,ai(e.placement.uvMinMax,e.placement.offset.x/s.size.width,1-(e.placement.offset.y+a)/s.size.height,(e.placement.offset.x+o)/s.size.width,1-e.placement.offset.y/s.size.height),s.cursor.x+=i,s.lineHeight=Math.max(s.lineHeight,n),this._elements.set(r,e)}_removeAtlasElement(e){if(e&&this._elements.has(e.textId)){const r=e.placement.offset;this._ctx.clearRect(r.x,r.y,e.textRenderer.renderedWidth,e.textRenderer.renderedHeight),this._elements.delete(e.textId)}}_ensureStageObjects(e){const r=this._stageObjects.get(e);if(r)return r;const i=new Set;return this._stageObjects.set(e,i),i}_addStageObject(e,r){this._ensureStageObjects(e).add(r)}_removeStageObject(e,r){const i=this._stageObjects.get(e);i&&i.delete(r)&&(r.geometries[0].vertexAttributes.get(O.SIZE).data=[0,0],r.geometryVertexAttrsUpdated(r.geometries[0]))}_processAddition(e,r){const i=this._atlas,n=e.textId,s=e.textRenderer.renderedWidth,o=e.textRenderer.renderedHeight,a=s+KM,l=o+KM+c1e;if(i.cursor.x+a<i.size.width&&i.cursor.y+l<i.size.height)this._addAtlasElement(e,n,a,l),this._elementsToRender.set(n,e),this._elementsToAddOrUpdate.delete(n);else{if(!(i.cursor.y+l+i.lineHeight<i.size.height)){const c=this._getExpectedAtlasUsage(),h=c>IIt&&i.size.width<yW;return h&&this._resizeAtlas(2*i.size.width,2*i.size.height),!r||!h&&c>$It&&i.size.width===yW?(this._processRemovals(),cR.OK):(this._repack(),cR.REPACK)}i.cursor.x=KM,i.cursor.y+=i.lineHeight,i.lineHeight=0,this._addAtlasElement(e,n,a,l),this._elementsToRender.set(n,e),this._elementsToAddOrUpdate.delete(n)}return cR.OK}_processRemovals(){this._elementsToRemove.forEach((e,r)=>{const i=this._stageObjects.get(r);i&&i.size!==0||this._removeAtlasElement(e),i&&i.size===0&&this._stageObjects.delete(r)}),this._elementsToRemove.clear()}_repack(){this._processRemovals(),this._elements.forEach((e,r)=>{e.rendered=!1,this._elementsToAddOrUpdate.set(r,e)}),this._elements.clear(),this._resetAtlasCursor(),this._elementsToRender.clear()}_processRenderingRequest(e){this._ctx.clearRect(e.placement.offset.x,e.placement.offset.y,e.textRenderer.renderedWidth,e.textRenderer.renderedHeight),e.textRenderer.render(this._ctx,e.placement.offset.x,e.placement.offset.y);const r=this._stageObjects.get(e.textId);r&&r.forEach(i=>{i.geometries[0].vertexAttributes.get(O.UV0).data=new Float32Array(e.placement.uvMinMax),i.geometries[0].vertexAttributes.get(O.SIZE).data=[e.textRenderer.displayWidth,e.textRenderer.displayHeight],i.geometryVertexAttrsUpdated(i.geometries[0])}),e.rendered=!0}get running(){return this.updating}runTask(e,r=!0){if(R(this._glTexture))return za.YIELD;let i=!1;if(ca(this._elementsToAddOrUpdate,(s,o)=>{const a=this._elements.get(o);if(a&&a.rendered){const l=this._stageObjects.get(o);return l&&l.forEach(c=>{const h=c.geometries[0].vertexAttributes,p=this._elements.get(o);h.get(O.UV0).data=p.placement.uvMinMax,h.get(O.SIZE).data=[p.textRenderer.displayWidth,p.textRenderer.displayHeight],c.geometryVertexAttrsUpdated(c.geometries[0])}),this._elementsToAddOrUpdate.delete(o),e.madeProgress(),!1}return this._processAddition(this._elementsToAddOrUpdate.get(o),r)===cR.REPACK&&(i=!0,!0)}),i)return this.runTask(jl,!1),void e.madeProgress();let n=!1;this._elementsToRender.size>0&&this._needsClear&&(this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._needsClear=!1),ca(this._elementsToRender,(s,o)=>(this._processRenderingRequest(s),this._elementsToRender.delete(o),n=!0,e.madeProgress(),e.done)),n&&this._glTexture.setData(this._canvas),this.updating=this._elementsToRender.size>0,!this.updating&&FCt.orderedRepackingEnabled&&(this.repackOrdered(),e.madeProgress())}addTextTexture(e,r){const i=e.key;this._elementsToAddOrUpdate.has(i)||this._elementsToAddOrUpdate.set(i,new DIt(i,e)),this._addStageObject(i,r),this._elementsToRemove.delete(i),this.setDirty()}removeTextTexture(e,r){const i=e.key;this._elementsToRemove.set(i,this._elements.get(i)),this._removeStageObject(i,r)}setDirty(){this._glTexture&&(this.updating=!0)}repackOrdered(){if(this._elements.size===0)return;const e=[];this._elements.forEach((i,n)=>e.push({element:i,key:n}));let r=!0;for(let i=0;i<e.length-1;i++)if(e[i].key.localeCompare(e[i+1].key)>0){r=!1;break}if(!r||this._elementsToRemove.size){e.sort((i,n)=>i.key.localeCompare(n.key)),this._elements.clear();for(const{element:i,key:n}of e)this._elements.set(n,i);this._repack(),this.setDirty()}}get test(){const{_elements:e,_stageObjects:r,_elementsToRemove:i,_atlas:n}=this,s=this;return{elements:e,stageObjects:r,elementsToRemove:i,atlas:n,resizeAtlas:(o,a)=>s._resizeAtlas(o,a),run:(o,a)=>s.runTask(o,a)}}};u([d({constructOnly:!0})],VI.prototype,"view",void 0),u([d({type:Boolean})],VI.prototype,"updating",void 0),VI=u([$("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],VI);const KM=2,c1e=2;var cR;(function(t){t[t.OK=0]="OK",t[t.REPACK=1]="REPACK"})(cR||(cR={}));let u1e=class{constructor(e,r){this.labelingContext=e,this.graphics3DGraphic=r,this.hasGraphics3DResources=!1,this.visible=!1,this.rendered=!1,this.textInitialized=!1,this.textRenderers=new Array,this.textLabelPlacements=new Array}},NIt=class{constructor(e,r,i,n,s){this.labelClass=e,this.graphics3DSymbol=r,this.graphics3DCalloutSymbolLayer=i,this.textRenderParameters=n,this.labelFunction=s,this.calloutSymbolLayerIndex=0}},FIt=class{constructor(e,r,i,n,s,o,a){this.layer=e,this.graphics3DCore=r,this.scaleVisibility=i,this.emptySymbolLabelSupported=n,this.elevationInfoOverride=s,this.disablePlacement=o,this.active=a,this.labelClassAbortController=new AbortController,this.labelClassContexts=new Array,this.graphics=new Map,this.labelsToInitialize=new Map,this.stageLayer=new N5e({pickable:!0,disableOctree:!0},e.uid)}},MT=class extends be{constructor(e){super(e),this._dirty=!1,this._labels=new Map,this._labelsToAdd=new Map,this._labelsToRemove=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this._handles=new qr,this._handles.add([ne(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this.setDirty()),ne(()=>{var e;return(e=this.view.state)==null?void 0:e.rasterPixelRatio},()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(St.LABELER,this)]),this._textTextureAtlas=new VI({view:this.view}),this._hudMaterialCollection=new l1e(this.view._stage),this._calloutMaterialCollection=new l1e(this.view._stage)}dispose(){this._handles=ze(this._handles),this._textTextureAtlas=rt(this._textTextureAtlas),this._hudMaterialCollection=rt(this._hudMaterialCollection),this._calloutMaterialCollection=rt(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear(),this._labelsToAdd.clear(),this._labelsToRemove.clear()}_activateLabelingContext(e){e.graphics.forEach((r,i)=>{const n=new u1e(e,r);this._labels.set(i,n),e.labelsToInitialize.set(i,n),r.setVisibilityFlag(Iu.USER_SETTING,!0,aa.LABEL)}),e.active=!0}_deactivateLabelingContext(e){e.graphics.forEach((r,i)=>{r.setVisibilityFlag(Iu.USER_SETTING,!1,aa.LABEL),this.setLabelGraphicVisibility(r,!1),this._labels.delete(i)}),e.active=!1}_addLabelTextureToAtlas(e){for(const r of e.graphics3DGraphic.labelLayers){if(!r._labelClass)continue;const i=e.textRenderers[r._labelIndex];v(i)&&this._textTextureAtlas.addTextTexture(i,r.stageObject)}e.rendered=!0}_removeLabelTextureFromAtlas(e){for(const r of e.graphics3DGraphic.labelLayers){if(!r._labelClass)continue;const i=e.textRenderers[r._labelIndex];v(i)&&this._textTextureAtlas.removeTextTexture(i,r.stageObject)}e.rendered=!1}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(e){return this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e),za.YIELD}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const r of this._labelingContexts)if(r.active){if(!h1e(r)){if(kIt(r)){this._deactivateLabelingContext(r);continue}if(this._createLabelClassContext(r),_W(r)){this._dirty=!0;continue}if(!h1e(r))continue}ca(r.labelsToInitialize,(i,n)=>(this._ensureGraphics3DResources(i)&&(this._labels.set(n,i),this.deconflictor.setDirty(),e.madeProgress()),(i.visible&&i.textInitialized||!i.visible&&i.hasGraphics3DResources)&&(r.labelsToInitialize.delete(n),e.madeProgress()),e.done))&&(this._dirty=!0)}this._labelsToRemove.forEach(r=>this._removeLabelTextureFromAtlas(r)),this._labelsToAdd.forEach(r=>this._addLabelTextureToAtlas(r)),this._labelsToRemove.clear(),this._labelsToAdd.clear(),this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){var o,a,l;const r=(o=e.labelClassAbortController)==null?void 0:o.signal;await((l=(a=e.layer).when)==null?void 0:l.call(a)),lr(r),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive();const i=e.graphics3DCore,n=i.layer,s=n.labelingInfo&&n.labelingInfo.filter(c=>!!c.symbol);!s||s.length===0||(await pB(s,async(c,h)=>{const p=c.symbol,f=gce(i.getOrCreateGraphics3DSymbol(p));if(R(f))return void re.getLogger(this.declaredClass).error("Failed to create Graphics3DSymbol for label");await f.load(),lr(r);let m=null;Zne(p)&&p.hasVisibleCallout()&&(m=pCt(p,i.symbolCreationContext),await m.load(),lr(r));const g=await hm(n5e(c,e.layer.fieldsIndex,this.view.spatialReference));if(lr(r),g.ok===!0){const _=await this._createTextRenderParameters(f.symbol);lr(r),e.labelClassContexts[h]=new NIt(c,f,m,_,g.value)}else re.getLogger(this.declaredClass).error(`Label expression failed to evaluate: ${g.error}`)}),lr(r))}async _createLabelClassContext(e){return R(e.labelClassPromise)&&(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(r=>{if(ps(r))throw r;e.labelClassContexts.length=0}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const r=e.symbolLayers.getItemAt(0);return r&&r.type==="text"?V6e.fromSymbol(r,this.view.state.rasterPixelRatio):null}_destroyLabelClassContext(e){for(const i of e.labelClassContexts)--i.graphics3DSymbol.referenced;const r=e.labelClassAbortController;e.labelClassAbortController=new AbortController,Tp(r),e.labelClassContexts.length=0,e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,r,i,n,s){const o=new o5e(i.verticalOffset,Tve(i.anchor),sOt(i.anchor),e.text,i.translation,i.elevationOffset,i.centerOffset,i.screenOffset,i.centerOffsetUnits,e.displayWidth,e.displayHeight);return Nv.graphic=r,Nv.renderingInfo=null,Nv.layer=n,s.createLabel(Nv,o,this._hudMaterialCollection,this._textTextureAtlas)}_createLineCalloutGraphic(e,r,i,n,s){return Nv.graphic=e,Nv.layer=s,Nv.renderingInfo=new hCt(null,r,n.translation,n.centerOffset,n.screenOffset,n.centerOffsetUnits,n.elevationOffset,this._calloutMaterialCollection),i.createGraphics3DGraphic(Nv)}_ensureGraphics3DResources(e){if(e.hasGraphics3DResources)return!1;const r=e.graphics3DGraphic;if(r.destroyed)return!1;this._ensureTextTextureResources(e);const i=e.labelingContext,n=i.labelClassContexts;if(!n||n.length===0||!i.emptySymbolLabelSupported&&r.layers.length===0)return!1;let s=!1;const o=r.graphic,a=i.layer,l=rk(i.layer),c=this.view._stage;for(let h=0;h<n.length;h++){const p=e.textRenderers[h],f=e.textLabelPlacements[h];if(R(p)||R(f))continue;const m=n[h],g=m.graphics3DSymbol,_=g.symbol&&g.symbol.type==="label-3d"?g.symbol:null,b=g.symbolLayers[0];if(!b)continue;b.setElevationInfoOverride(i.elevationInfoOverride);const w=this._createTextSymbolGraphic(p,o,f,a,b);if(R(w))return!1;w._labelClass=m.labelClass,w._labelIndex=h,r.addLabelGraphic(w,c,i.stageLayer),r.setVisibilityFlag(Iu.USER_SETTING,l,aa.LABEL),r.clearVisibilityFlag(Iu.SCALE_RANGE,aa.LABEL),r.setVisibilityFlag(Iu.DECONFLICTION,!1,aa.LABEL),s=!0;const x=m.graphics3DCalloutSymbolLayer;if(x&&f.hasLabelVerticalOffset){x.setElevationInfoOverride(i.elevationInfoOverride);const T=this._createLineCalloutGraphic(o,_,x,f,a);v(T)&&(m.calloutSymbolLayerIndex=r.labelLayers.length,r.addLabelGraphic(T,c,i.stageLayer))}break}return i.scaleVisibility&&s&&i.scaleVisibility.updateGraphicLabelScaleVisibility(r),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const r=e.labelingContext.labelClassContexts;for(const i of e.graphics3DGraphic.labelLayers){if(i._labelClass==null)continue;const n=r[i._labelIndex].graphics3DSymbol.symbolLayers[0];n!=null&&n.onRemoveGraphic(i)}e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){var s;if(e.textInitialized)return;const r=e.labelingContext,i=r.labelClassContexts;if(!i||i.length===0)return;const n=e.graphics3DGraphic.graphic;for(let o=0;o<i.length;o++){const a=i[o];if(e.textRenderers[o]=null,e.textLabelPlacements[o]=null,!a.textRenderParameters)continue;const l=a.labelFunction;let c;if(l.type==="arcade")try{const x=l.needsHydrationToEvaluate()?fEt(n,r.layer):n;c=l.evaluate(x)}catch{c=null}else c=l.evaluate(n);if(R(c)||c===""||/^\s+$/.test(c))continue;const h=a.graphics3DSymbol,p=((s=h.symbol)==null?void 0:s.type)==="label-3d"?h.symbol:null;if(!h.symbolLayers[0])continue;const f=e.graphics3DGraphic,m=a.labelClass,g=r.disablePlacement,_=wIt({graphics3DGraphic:f,labelSymbol:p,labelClass:m,disablePlacement:g});if(R(_))continue;const b=Tve(_.anchor),w=zke(b);e.textRenderers[o]=new kke(c,w,a.textRenderParameters),e.textLabelPlacements[o]=_}e.textInitialized=!0}_destroyTextTextureResources(e){e.textInitialized=!1,e.textRenderers.length=0,e.textLabelPlacements.length=0}_addGraphic(e,r){const i=r.graphic.uid;if(e.graphics.set(i,r),e.active){const n=new u1e(e,r);this._labels.set(i,n),e.labelsToInitialize.set(i,n)}this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(e,r){const i=r.graphic.uid,n=this._labels.get(i);e.graphics.delete(i),n&&(this._destroyGraphic(n,i),e.labelsToInitialize.delete(i),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,r){this._labels.has(r)&&(this._labels.delete(r),this._labelsToAdd.delete(r),this._labelsToRemove.delete(r)),e.textInitialized&&(this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e)),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,r){if(!r)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const i of r){const n=e.graphics.get(i);n&&(this._removeGraphic(e,n),this._addGraphic(e,n))}}_globalPropertyChanged(e,r){for(const i of r.labelClassContexts){const n=new Map;r.graphics.forEach(o=>n.set(o.graphic.uid,o));const s=o=>o.labelLayers[0];if(i.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,n,s),i.graphics3DCalloutSymbolLayer){const o=a=>a.labelLayers[i.calloutSymbolLayerIndex];i.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,n,o)}}}_visibilityInfoChange(e){const r=rk(e.layer);r&&!e.active&&this._activateLabelingContext(e),!r&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.graphics.forEach((r,i)=>{const n=this._labels.get(i);n&&(this._destroyGraphic(n,i),n.visible=!1,n.rendered=!1,e.labelsToInitialize.set(i,n))}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const r of this._labelingContexts)if(r.graphics3DCore===e)return r;return null}addGraphicsOwner(e,r,i){const n=i&&i.emptySymbolLabelSupported||!1,s=i&&i.elevationInfoOverride||null,o=i&&i.disablePlacement||null;if(this._findLabelingContext(e))return;const a=e.layer,l=new FIt(a,e,r,n,s,o,rk(a));return this.view._stage.add(l.stageLayer),this._labelingContexts.push(l),this.setDirty(),{addGraphic:c=>this._addGraphic(l,c),removeGraphic:c=>this._removeGraphic(l,c),featureReductionChange:()=>{},layerLabelsEnabled:()=>rk(l.layer),labelingInfoChange:c=>this._labelingInfoChange(l,c),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",l),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",l),visibilityInfoChange:()=>this._visibilityInfoChange(l),reset:()=>this._resetLabels(l),clear:()=>{}}}removeGraphicsOwner(e){const r=this._findLabelingContext(e);if(!r)return;const i=this._labelingContexts.indexOf(r);this._labelingContexts.splice(i,1),r.graphics.forEach(n=>this._removeGraphic(r,n)),this.view._stage.remove(r.stageLayer),this.setDirty()}setLabelGraphicVisibility(e,r){const i=e.graphic.uid,n=this._labels.get(i);n&&n.visible!==r&&(r&&!n.rendered?(this._labelsToAdd.set(i,n),this._labelsToRemove.delete(i),n.textInitialized||n.labelingContext.labelsToInitialize.set(i,n)):!r&&n.rendered&&(this._labelsToRemove.set(i,n),this._labelsToAdd.delete(i)),n.visible=r,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){var e;return this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.updating||this._labelingContexts.some(r=>_W(r))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((r,i)=>r+(_W(i)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function _W(t){return!!t.labelClassPromise&&!!t.labelClassAbortController}function h1e(t){return t.labelClassContexts&&t.labelClassContexts.length}function kIt(t){return t.labelClassContexts===null}function rk(t){var e;return t.labelsVisible===!0&&!!((e=t.labelingInfo)!=null&&e.some(r=>!!r.symbol))}u([d({constructOnly:!0})],MT.prototype,"view",void 0),u([d({constructOnly:!0})],MT.prototype,"deconflictor",void 0),u([d()],MT.prototype,"_textTextureAtlas",void 0),u([d({type:Boolean,readOnly:!0})],MT.prototype,"updating",null),MT=u([$("esri.views.3d.layers.graphics.Labeler")],MT);const Nv=new dCt(null,null,null);let BI=class gA{constructor(e,r,i,n=null){this.lij=[0,0,0],this.extent=Kt(),this.resolution=0,this.loadPriority=0,this.measures={visibility:el.VISIBLE_ON_SURFACE,screenRect:Kt(),distance:0,shouldSplit:!1},this.used=!1,n&&this.acquire(e,r,i,n)}acquire(e,r,i,n){this.tilingScheme=n,this.id=gA.id(e,r,i),this.lij[0]=e,this.lij[1]=r,this.lij[2]=i,n.getExtent(e,r,i,this.extent),this.resolution=n.resolutionAtLevel(e)}release(){this.tilingScheme=null}getChildren(e){const r=this.lij[0]+1,i=2*this.lij[1],n=2*this.lij[2];return e?(e[0].acquire(r,i,n,this.tilingScheme),e[1].acquire(r,i+1,n,this.tilingScheme),e[2].acquire(r,i,n+1,this.tilingScheme),e[3].acquire(r,i+1,n+1,this.tilingScheme),e):[new gA(r,i,n,this.tilingScheme),new gA(r,i+1,n,this.tilingScheme),new gA(r,i,n+1,this.tilingScheme),new gA(r,i+1,n+1,this.tilingScheme)]}copyMeasurementsFrom(e){this.measures.visibility=e.measures.visibility,this.measures.shouldSplit=e.measures.shouldSplit,this.measures.distance=e.measures.distance,w_(e.measures.screenRect,this.measures.screenRect)}static id(e,r,i){return`${e}/${r}/${i}`}};var el;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",t[t.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(el||(el={}));const j6e=.5*Math.PI,UIt=j6e/Math.PI*180;let zIt=class{constructor(e){this._renderCoordsHelper=e.renderCoordsHelper,this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:P(),direction:P()};for(let r=0;r<4;r++)this._extent[r]={origin:P(),direction:P(),cap:{next:null,direction:P()}},this._planes[r]=Yr();this._planes[Ai.NEAR]=Yr(),this._planes[Ai.FAR]=Yr(),this._planesWithoutFar=this._planes.slice(0,5)}update(e,r,i,n=!0){const s=this._extent;this._toRenderBoundingExtent(e,r,i),me(this._center.origin,s[0].origin,s[2].origin),le(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),n||le(this._center.direction,this._center.direction,-1);for(let o=0;o<4;o++){const a=s[o];this._renderCoordsHelper.worldUpAtPosition(a.origin,a.direction);const l=s[o===3?0:o+1];a.cap.next=l.origin,L_(a.cap.direction,a.origin,l.origin),dD(a.direction,a.cap.direction,a.origin,this._planes[o]),n||le(a.direction,a.direction,-1)}dD(s[0].cap.direction,s[1].cap.direction,s[0].origin,this._planes[Ai.NEAR]),n?FQ(this._planes[Ai.NEAR],this._planes[Ai.FAR]):(kB(this._planes[Ai.FAR],this._planes[Ai.NEAR]),FQ(this._planes[Ai.NEAR],this._planes[Ai.NEAR])),this._maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this._maxSpanSpatialReference=r,this._minGlobalAltitude=.9*ii(this._maxSpanSpatialReference).radius}isVisibleInFrustum(e,r,i=!1){if(e==null)return!1;if(this._renderCoordsHelper.viewingMode===qe.Global){const s=this._maxSpanSpatialReference.isGeographic?UIt:j6e*r;if(this._maxSpan>s)return!0;if(e.altitude!=null&&e.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(e)}if(this._maxSpan===0){const s=this._extent[0];return!(i||!e.intersectsRay(nd(s.origin,s.direction)))}for(let s=0;s<this._extent.length;s++){const o=this._extent[s];if(!i&&e.intersectsRay(nd(o.origin,o.direction))||e.intersectsLineSegment(DS(o.origin,o.cap.next,BIt),o.cap.direction))return!0}const n=i?this._planes:this._planesWithoutFar;for(let s=0;s<e.lines.length;s++){const o=e.lines[s];if(Cbt(n,o.origin,o.endpoint,o.direction))return!0}return!1}_toRenderBoundingExtentGlobal(e,r,i){One(e,Zp),Zp[2]=i,um(r,Zp,vW,this._renderCoordsHelper.spatialReference),ya(d1e,vW),ki(iu);for(const{x0:s,x1:o,y0:a,y1:l}of VIt)for(let c=0;c<5;c++){const h=c/4;Zp[0]=Bt(e[s],e[o],h),Zp[1]=Bt(e[a],e[l],h),Zp[2]=i,zo(Zp,r,Zp,this._renderCoordsHelper.spatialReference),Ke(Zp,Zp,d1e),ay(iu,Zp)}he(this._extent[0].origin,iu[0],iu[1],iu[2]),he(this._extent[1].origin,iu[3],iu[1],iu[2]),he(this._extent[2].origin,iu[3],iu[4],iu[2]),he(this._extent[3].origin,iu[0],iu[4],iu[2]);for(let s=0;s<4;++s)Ke(this._extent[s].origin,this._extent[s].origin,vW)}_toRenderBoundingExtentLocal(e,r,i){rB(e,r,jy,this._renderCoordsHelper.spatialReference),he(this._extent[0].origin,jy[0],jy[1],i),he(this._extent[1].origin,jy[2],jy[1],i),he(this._extent[2].origin,jy[2],jy[3],i),he(this._extent[3].origin,jy[0],jy[3],i)}_toRenderBoundingExtent(e,r,i){switch(this._renderCoordsHelper.viewingMode){case qe.Global:this._toRenderBoundingExtentGlobal(e,r,i);break;case qe.Local:this._toRenderBoundingExtentLocal(e,r,i);break;default:this._renderCoordsHelper.viewingMode}}_isVisibleInFrustumGlobal(e){if(Ri(e.planes[Ai.NEAR],this._center.origin)<0&&ve(this._center.direction,e.direction)<0)return!0;for(let r=0;r<4;r++){const i=this._extent[r];if(Ri(e.planes[Ai.NEAR],i.origin)<0&&ve(i.direction,e.direction)<0)return!0}return!1}};const VIt=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],Zp=P(),vW=$e(),d1e=$e(),iu=Ks(),jy=Kt(),BIt=vm();let jIt=class{constructor(e){this._renderCoordsHelper=e,this._surfaceElevation=0,this._cache=new Map,this._frustum=new J1(e),this._extendedFrustum=new J1(e),this._intersector=new zIt({renderCoordsHelper:e}),this._renderCoordsHelper=e}begin(e,r){this._surfaceElevation=r,this._aboveGround=this._renderCoordsHelper.getAltitude(e.eye)>r,this._frustum.update(e),this._shortenFrustumFarPlane(this._frustum),this._updateExtendedFrustum(e)}end(){this._cache.clear()}calculate(e){if(this._allTilesInvisible)return el.INVISIBLE;const r=this._renderCoordsHelper.viewingMode===qe.Global&&e.lij[0]>=GIt&&e.lij[0]<HIt,i=this._getOrCalculateSingleTileVisibility(e,!r);return i!==el.INVISIBLE&&r?this._calculateAggregatedChildrenVisibility(e):i}_shortenFrustumFarPlane(e){const r=J1.nearFarLineIndices,i=e.mutablePoints;for(const n of r){const[s,o]=n,a=i[s],l=i[o];ge(hh,l,a),le(hh,hh,WIt),me(i[o],a,hh)}e.updatePoints(i)}_calculateAggregatedChildrenVisibility(e){let r=el.INVISIBLE;const i=this._cache.get(e.id);if(i!=null)return i;const n=g1e.acquire();e.getChildren(n);for(const s of n){const o=this.calculate(s);if(o!==el.INVISIBLE&&(r=o,o===el.VISIBLE_ON_SURFACE))break}return g1e.release(n),this._cache.set(e.id,r),r}_getOrCalculateSingleTileVisibility(e,r){const i=this._cache.get(e.id);if(i!=null)return i;const n=this._calculateSingleTileVisibility(e);return r&&this._cache.set(e.id,n),n}_calculateSingleTileVisibility(e){return!this._aboveGround&&this._renderCoordsHelper.viewingMode===qe.Global&&e.lij[0]<qIt?this._calculateSingleTileVisibilitySided(e,!1)===el.INVISIBLE?this._calculateSingleTileVisibilitySided(e,!0):void 0:this._calculateSingleTileVisibilitySided(e,this._aboveGround)}_calculateSingleTileVisibilitySided(e,r){this._intersector.update(e.extent,e.tilingScheme.spatialReference,this._surfaceElevation,r);const i=ii(e.tilingScheme.spatialReference).radius;return this._intersector.isVisibleInFrustum(this._extendedFrustum,i)?this._intersector.isVisibleInFrustum(this._frustum,i,!0)?el.VISIBLE_ON_SURFACE:el.VISIBLE_WHEN_EXTENDED:el.INVISIBLE}_updateExtendedFrustum(e){this._extendedFrustum.update(e),this._shortenFrustumFarPlane(this._extendedFrustum);const r=this._renderCoordsHelper.worldUpAtPosition(e.eye,hh);this._aboveGround||ul(r,r);const i=Js(-ve(r,e.viewForward));if(this._allTilesInvisible=i>(Math.PI+e.fovY)/2,this._allTilesInvisible||(this._hasExtendedFrustum=i>e.fovY/2,!this._hasExtendedFrustum))return;const n=this._extendedFrustumParameters(),s=this._extendedFrustum.mutablePoints;for(let o=0;o<4;o++){const a=n.pointIndices[o],l=s[a],c=this._renderCoordsHelper.getAltitude(l);if(n.needsAltitudeAdjustment(c)){switch(this._renderCoordsHelper.worldUpAtPosition(l,hh),a){case lt.FAR_BOTTOM_LEFT:case lt.FAR_TOP_LEFT:case lt.NEAR_BOTTOM_LEFT:case lt.NEAR_TOP_LEFT:kQ(this._extendedFrustum.planes[Ai.LEFT],hh,hh);break;case lt.FAR_BOTTOM_RIGHT:case lt.FAR_TOP_RIGHT:case lt.NEAR_BOTTOM_RIGHT:case lt.NEAR_TOP_RIGHT:kQ(this._extendedFrustum.planes[Ai.RIGHT],hh,hh)}le(hh,hh,n.direction),this._renderCoordsHelper.intersectInfiniteManifold(nd(l,hh),n.zWithMargin,l)}}if(this._extendedFrustum.updatePoints(s),rl(s[lt.NEAR_BOTTOM_LEFT],s[lt.NEAR_BOTTOM_RIGHT],s[lt.NEAR_TOP_RIGHT],f1e),rl(s[lt.NEAR_BOTTOM_RIGHT],s[lt.NEAR_TOP_RIGHT],s[lt.NEAR_TOP_LEFT],m1e),ve(f1e,m1e)<0){const o=this._extendedFrustum.mutablePoints;this._aboveGround?[o[lt.NEAR_BOTTOM_LEFT],o[lt.NEAR_BOTTOM_RIGHT]]=[o[lt.NEAR_BOTTOM_RIGHT],o[lt.NEAR_BOTTOM_LEFT]]:[o[lt.NEAR_TOP_LEFT],o[lt.NEAR_TOP_RIGHT]]=[o[lt.NEAR_TOP_RIGHT],o[lt.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(o)}}_extendedFrustumParameters(){return this._aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const e=this._surfaceElevation-p1e;return{zWithMargin:e,pointIndices:J1.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:r=>r>e}}_extendedFrustumParametersBelowSurface(){const e=this._surfaceElevation+p1e;return{zWithMargin:e,pointIndices:J1.planePointIndices.top,direction:1,needsAltitudeAdjustment:r=>r<e}}};const GIt=2,HIt=6,qIt=12,WIt=.95,p1e=1,hh=P(),f1e=Yr(),m1e=Yr(),g1e=new ko(Array,t=>{t.length!==4&&(t[0]=new BI,t[1]=new BI,t[2]=new BI,t[3]=new BI)},t=>{t[0].release(),t[1].release(),t[2].release(),t[3].release()});let XIt=class{constructor(e){this._camera=new Pt,this._focusOnMap=[0,0],this._screenRect=Kt(),this._tileSize=e.tileSize,this._renderCoordsHelper=e.renderCoordsHelper,this._tilingScheme=e.tilingScheme,this._visibility=new jIt(e.renderCoordsHelper)}begin(e,r,i){this._camera.copyFrom(e),this._surfaceElevation=i,this._focusOnMap[0]=r.x,this._focusOnMap[1]=r.y,Ane(0,0,e.fullWidth,e.fullHeight,this._screenRect),this._visibility.begin(this._camera,i)}end(){this._visibility.end()}updateTile(e){e.measures.visibility=this._visibility.calculate(e),e.measures.distance=uWe(e.extent,this._focusOnMap),e.measures.visibility!==el.INVISIBLE&&this._updateScreenMeasure(e)}_updateScreenMeasure(e){const r=YIt,i=1<<r,n=e.measures.screenRect;td(n);let s=0;const o=e.lij[0]+r,a=e.lij[1]<<r,l=e.lij[2]<<r,c=this._tileSizeWithBias(e),h=c*c;for(let p=0;p<i;p++)for(let f=0;f<i;f++)if(s+=this._computeScreenArea(e,o,a+p,l+f,n),s>h)return void(e.measures.shouldSplit=!0);e.measures.shouldSplit=!1}_tileSizeWithBias(e){return e.measures.visibility===el.VISIBLE_WHEN_EXTENDED?this._tileSize*ZIt:this._tileSize}_computeScreenArea(e,r,i,n,s){const o=e.measures.visibility===el.VISIBLE_WHEN_EXTENDED;this._projectToScreen(r,i,n,o,Fv),td(bW);for(let a=0;a<4;a++)Rne(bW,Fv[a]);return $b(s,bW,s),Nye(Fv[0],Fv[1],Fv[2])+Nye(Fv[0],Fv[2],Fv[3])}_projectToScreen(e,r,i,n,s){this._tilingScheme.ensureMaxLod(e),this._tilingScheme.getExtent(e,r,i,QM),this._toRenderCoords(QM,0,3,kv[0]),this._toRenderCoords(QM,2,3,kv[1]),this._toRenderCoords(QM,2,1,kv[2]),this._toRenderCoords(QM,0,1,kv[3]),n&&(this._projectToPlane(kv,this._camera.frustum[Ai.NEAR]),this._projectToPlane(kv,this._camera.frustum[Ai.TOP]),this._projectToPlane(kv,this._camera.frustum[Ai.BOTTOM]));for(let o=0;o<4;o++)this._camera.projectToRenderScreen(kv[o],y1e),this._camera.renderToScreen(y1e,s[o])}_projectToPlane(e,r){for(let n=0;n<4;n++)tP[n]=Ri(r,e[n]);const i=Math.max(tP[0],tP[1],tP[2],tP[3]);if(i>0){const n=le(eP,r,-i);for(let s=0;s<4;s++)me(e[s],e[s],n)}}_toRenderCoords(e,r,i,n){return eP[0]=e[r],eP[1]=e[i],eP[2]=this._surfaceElevation,this._renderCoordsHelper.toRenderCoords(eP,this._tilingScheme.spatialReference,n),n}};const bW=Kt(),YIt=2,ZIt=5,Fv=[wn(),wn(),wn(),wn()],QM=Kt(),eP=P(),kv=[P(),P(),P(),P()],tP=[0,0,0,0],y1e=La();function XKt(t,e,r){if(R(t)||R(r))return!1;let i=!0;return Us[0]=t.xmin!=null?t.xmin:0,Us[1]=t.ymin!=null?t.ymin:0,Us[2]=t.zmin!=null?t.zmin:0,i=i&&$n(Us,t.spatialReference,0,e,r,0,1),Us[0]=t.xmax!=null?t.xmax:0,Us[1]=t.ymax!=null?t.ymax:0,Us[2]=t.zmax!=null?t.zmax:0,i=i&&$n(Us,t.spatialReference,0,e,r,3,1),t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.zmin==null&&(e[2]=-1/0),t.xmax==null&&(e[3]=1/0),t.ymax==null&&(e[4]=1/0),t.zmax==null&&(e[5]=1/0),i}function G6e(t,e,r){if(R(t)||R(r))return!1;let i=!0;return Us[0]=t.xmin!=null?t.xmin:0,Us[1]=t.ymin!=null?t.ymin:0,Us[2]=t.zmin!=null?t.zmin:0,i=i&&$n(Us,t.spatialReference,0,Us,r,0,1),e[0]=Us[0],e[1]=Us[1],Us[0]=t.xmax!=null?t.xmax:0,Us[1]=t.ymax!=null?t.ymax:0,Us[2]=t.zmax!=null?t.zmax:0,i=i&&$n(Us,t.spatialReference,0,Us,r,0,1),e[2]=Us[0],e[3]=Us[1],t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.xmax==null&&(e[2]=1/0),t.ymax==null&&(e[3]=1/0),i}const Us=P();let na=class extends be{get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(v(e)&&!e.spatialReference.equals(this.viewState.spatialReference))return void re.getLogger(this.declaredClass).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const r=this._get("filterExtent");if(r===e||v(r)&&e&&r.equals(e))return;const i=v(e)?e.clone():null;this._set("filterExtent",i),this._setDirty()}get _filterExtentRect(){if(R(this.filterExtent))return null;const e=Kt();return G6e(this.filterExtent,e,this.tilingScheme.spatialReference),e}get _rootTileIds(){const{tilingScheme:e}=this;return this._filterExtentRect&&e?e.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}constructor(e){super(e),this.tiles=new ct,this.tileSize=512,this._idToTile=new Map,this._handles=new qr,this._clients=new Set,this._dirty=!1,this._pendingTiles=null,this._newTiles=new Wt}initialize(){this._handles.add([ne(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),Zr),ne(()=>{var e,r,i;return[this.tileSize,(e=this.cameraOnSurface)==null?void 0:e.location,this.tilingScheme,(r=this.viewState)==null?void 0:r.contentCamera,(i=this.focus)==null?void 0:i.location]},()=>this._setDirty(),Wi)]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(St.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=$i(this._frameWorker),this._handles=ze(this._handles)}addClient(){const e=KIt();return this._clients.add(e),this._clients.size===1&&this._setDirty(),{remove:()=>this._removeClient(e)}}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(jl))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),v(this._frameWorker)&&(this._frameWorker.priority=St.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),!this._pendingTiles&&v(this._frameWorker)&&(this._frameWorker.priority=St.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new XIt({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){const{tilingScheme:e}=this;return this._rootTileIds.map(r=>new BI(r[0],r[1],r[2],e))}_purgeHorizonTiles(e){e.sort((r,i)=>{const n=r.measures.screenRect,s=i.measures.screenRect;return n[1]+n[3]-(s[1]+s[3])}),td(ik);for(let r=0;r<e.length;r++)if($b(ik,e.data[r].measures.screenRect,ik),cm(ik)>QIt)return e.data.slice(r,e.length);return[]}_subdivideTilesForView(e){if(!this._pendingTiles)return;const{tilingScheme:r}=this;for(;this._pendingTiles.length>0&&!e.done;){const i=this._pendingTiles.pop();e.madeProgress(),this._filterExtentRect&&!V9(this._filterExtentRect,i.extent)||(this._tileMeasurements.updateTile(i),i.measures.visibility!==el.INVISIBLE&&(i.measures.shouldSplit?(r.ensureMaxLod(i.lij[0]+1),this._pendingTiles.push(...i.getChildren())):this._newTiles.push(i)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}_updateTiles(e){for(const n of this.tiles.items)n.used=!1;const r=e.filter(n=>{const s=this._idToTile.get(n.id);return s?(s.copyMeasurementsFrom(n),s.used=!0):this._idToTile.set(n.id,n),!s}),i=this.tiles.items.filter(n=>!n.used&&(this._idToTile.delete(n.id),!0));this.tiles.removeMany(i),this.tiles.addMany(r),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,r)=>e.measures.visibility!==r.measures.visibility?e.measures.visibility===el.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-r.measures.distance),this.tiles.forEach((e,r)=>e.loadPriority=r)}};u([d({constructOnly:!0})],na.prototype,"scheduler",void 0),u([d({constructOnly:!0})],na.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],na.prototype,"tilingSchemeOwner",void 0),u([d({constructOnly:!0})],na.prototype,"cameraOnSurface",void 0),u([d({constructOnly:!0})],na.prototype,"focus",void 0),u([d({constructOnly:!0})],na.prototype,"viewState",void 0),u([d({constructOnly:!0})],na.prototype,"terrain",void 0),u([d()],na.prototype,"tiles",void 0),u([d()],na.prototype,"tileSize",void 0),u([d({readOnly:!0})],na.prototype,"tilingScheme",null),u([d()],na.prototype,"filterExtent",null),u([d({readOnly:!0})],na.prototype,"_filterExtentRect",null),u([d({readOnly:!0})],na.prototype,"_rootTileIds",null),u([d({value:!1})],na.prototype,"suspended",null),u([d({readOnly:!0})],na.prototype,"updating",null),na=u([$("esri.views.3d.layers.support.FeatureTileTree3D")],na);let JIt=0;function KIt(){return JIt++}const ik=Kt(),QIt=10;let Ns=class extends be{constructor(){super(...arguments),this._propertiesPool=new S_({camera:Pt},this),this._lastSeenCameraProjectionValues=new Pt,this.mode=Mr.ANIMATING,this.rasterPixelRatio=1,this.contentPixelRatio=1,this.events=new Sn,this.viewingMode=qe.Global,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}init(e,r){this._set("viewingMode",e),this._set("spatialReference",r),this._set("constraints",new g0({mode:this.viewingMode}))}exit(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new S_({camera:Pt},this)}createInitialCamera(){if(this.viewingMode===qe.Global){const e=ii(this.spatialReference).radius;this.camera=new Pt({eye:ke(4*e,0,0),center:ke(e,0,0),up:ke(0,0,1)})}else this.camera=new Pt({eye:ke(0,0,100),center:ke(0,0,0),up:ke(0,1,0)})}get animation(){return this.cameraController instanceof TD&&v(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null}get camera(){return this._get("camera")}set camera(e){e!==wd&&wd.copyFrom(e),wd.computeUp(this.viewingMode),this.events.emit("before-camera-change",wd);const r=this._get("camera");if(this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,wd)&&(this._lastSeenCameraProjectionValues.copyFrom(wd),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues)),(!r||!r.equals(wd))&&(this._set("camera",this._propertiesPool.get("camera").copyFrom(wd)),this._cameraChanged=!r||!r.almostEquals(wd),this._cameraChanged)){const i=m2e(()=>{this._cameraChanged=!1,i.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get contentCamera(){return Nt(this._contentCamera,this.camera)}set contentCamera(e){this._contentCamera=v(e)?e.clone():null}get fixedContentCamera(){return v(this._contentCamera)}get isGlobal(){return this.viewingMode===qe.Global}get isLocal(){return this.viewingMode===qe.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){this.stopActiveCameraController()?(e&&(this.removeHandles(_1e),this.addHandles(fo(()=>e.state===bn.Finished||e.state===bn.Stopped,()=>{this._set("cameraController",null),this.updateCamera(r=>e.onControllerEnd(r))},{sync:!0,once:!0}),_1e),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=bn.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==bn.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this._updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this._updateQueue.length===0||this._processingUpdates)return;this._processingUpdates=!0;const e=this._updateQueue.shift();wd.copyFrom(this._get("camera")),e(wd),this.camera=wd,this._processingUpdates=!1,this._processUpdateQueue()}_cameraProjectionChanged(e,r){return e.fov!==r.fov||e.fullViewport[0]!==r.fullViewport[0]||e.fullViewport[1]!==r.fullViewport[1]||e.fullViewport[2]!==r.fullViewport[2]||e.fullViewport[3]!==r.fullViewport[3]||e.padding[yr.TOP]!==r.padding[yr.TOP]||e.padding[yr.RIGHT]!==r.padding[yr.RIGHT]||e.padding[yr.BOTTOM]!==r.padding[yr.BOTTOM]||e.padding[yr.LEFT]!==r.padding[yr.LEFT]}};u([d()],Ns.prototype,"mode",void 0),u([d({readOnly:!0,type:E_})],Ns.prototype,"animation",null),u([d({type:Pt})],Ns.prototype,"camera",null),u([d({readOnly:!0})],Ns.prototype,"pixelRatio",null),u([d()],Ns.prototype,"rasterPixelRatio",void 0),u([d()],Ns.prototype,"contentPixelRatio",void 0),u([d({})],Ns.prototype,"_contentCamera",void 0),u([d({type:Pt})],Ns.prototype,"contentCamera",null),u([d({readOnly:!0})],Ns.prototype,"fixedContentCamera",null),u([d({readOnly:!0})],Ns.prototype,"constraints",void 0),u([d({readOnly:!0})],Ns.prototype,"events",void 0),u([d({readOnly:!0})],Ns.prototype,"isGlobal",null),u([d({readOnly:!0})],Ns.prototype,"isLocal",null),u([d({readOnly:!0})],Ns.prototype,"viewingMode",void 0),u([d({readOnly:!0})],Ns.prototype,"spatialReference",void 0),u([d()],Ns.prototype,"navigating",null),u([d()],Ns.prototype,"stationary",null),u([d()],Ns.prototype,"_cameraChanged",void 0),u([d()],Ns.prototype,"cameraController",null),Ns=u([$("esri.views.3d.state.ViewState")],Ns);const e$t=Ns,wd=new Pt,_1e="ViewStateHandles";let t$t=class{constructor(e,r,i){this.viewingMode=e,this._forEachLayer=r,this._view=i,this._externalIntersectionHandlers=new Wt,this._tolerance=qO,this._tmpRay=Do(),this._tmpRegion=Kt(),this._validateHUDIntersector=Pp(this.viewingMode),this._validateHUDIntersector.options.hud=!1}intersectScreen(e,r,i){return this.intersectRay(this._getPickRay(e,this._tmpRay),v1e(this.viewingMode),r,i)}intersectScreenFreePointFallback(e,r,i){return this.intersectRayFreePointFallback(this._getPickRay(e,this._tmpRay),r,i)}intersectRayFreePointFallback(e,r,i){return this.intersectRay(e,v1e(this.viewingMode),r,i)||this._intersectRayFreePointLocal(e,r)}intersectRay(e,r,i,n){return r.options.selectionMode=!1,r.options.store=ba.MIN,this.computeIntersection(e,r,n),!!r.results.min&&r.results.min.getIntersectionPoint(i)}getCenterRayWithSubpixelOffset(e,r,i=.5,n=.5){return e.getRenderCenter(ok,i,n),ok[0]+=.0466,ok[1]-=.0123,fle(e,ok,r)}intersectIntersectorScreen(e,r,i){this.computeIntersection(this._getPickRay(e,this._tmpRay),r,i)}intersectToolIntersectorScreen(e,r,i){const n=this._getPickRay(e,this._tmpRay);this.intersectToolIntersectorRay(n,r,i)}intersectToolIntersectorRay(e,r,i){r.options.selectionMode=!0,this.computeIntersection(e,r,i);const n=r.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||xm(n)&&n.intersector!==pn.TERRAIN||(r.options.selectionMode=!1,this.computeIntersection(e,r,i))}setTolerance(e=qO){this._tolerance=e}addIntersectionHandler(e){this._externalIntersectionHandlers.push(e),this._externalIntersectionHandlers.sort((r,i)=>r.type===pn.TERRAIN?1:i.type===pn.TERRAIN?-1:0)}removeIntersectionHandler(e){this._externalIntersectionHandlers.removeUnordered(e)!=null&&this._externalIntersectionHandlers.sort((r,i)=>r.type===pn.TERRAIN?1:i.type===pn.TERRAIN?-1:0)}_getPickRay(e,r){const i=this._view.state.camera;return rFe(i,e,r)}_intersectRayFreePointLocal(e,r){return this.viewingMode!==qe.Local||R(e)||me(r,e.origin,we(Ye.get(),e.direction)),!1}intersectElevationFromScreen(e,r,i=0,n=null){return this._intersectElevation(this._getPickRay(e,this._tmpRay),r,i,n)}_intersectElevation(e,r,i=0,n=null){if(R(e))return null;const s=v(r)?r.mode:"absolute-height",o=v(r)?Nt(r.offset,0):0,a=s!=="on-the-ground"?o+i:0,l=a/this._view.renderCoordsHelper.unitInMeters;if(s==="absolute-height"){if(this._view.renderCoordsHelper.intersectInfiniteManifold(e,a,sk)){const x=this._view.computeMapPointFromVec3d(sk);return x.z??(x.z=0),x.z-=o,x}return null}const c=this._view.state.camera,h=Ye.get();c.projectToRenderScreen(e.origin,h);const p=new b1e(null,this._forEachLayer),f=this._view.slicePlane,m=v(f)?g0e(f):null,g=Pp(this.viewingMode);g.options.store=ba.MIN,g.options.verticalOffset=l;const _=e.origin,b=me(Ye.get(),_,e.direction);g.reset(_,b,c),g.point=h;const w=v(n)?"type"in n&&n.type==="graphics"?x=>{var T;return((T=x.metadata)==null?void 0:T.layerUid)!==n.uid}:x=>{var T;return((T=x.metadata)==null?void 0:T.graphicUid)!==n.uid}:null;switch(s){case"relative-to-scene":{const x=T=>{var E;return(R(w)||w(T))&&!!((E=T.metadata)!=null&&E.isElevationSource)};g.intersect(p.layers,h,this._tolerance,null,x),this._externalIntersectionHandlers.forAll(T=>{if(T.type===pn.I3S||T.type===pn.TERRAIN){const E=T.slicePlaneEnabled?m:null;T.intersect(g,E,g.rayBegin,g.rayEnd,h)}});break}case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll(x=>{if(x.isGround){const T=x.slicePlaneEnabled?m:null;x.intersect(g,T,g.rayBegin,g.rayEnd,h)}})}if(g.results.min.getIntersectionPoint(sk)){const x=this._view.computeMapPointFromVec3d(sk);return x.z=i,x}return null}computeIntersection(e,r,i){var g;if(R(e))return;const n=this._view.state.camera,s=Ye.get();n.projectToRenderScreen(e.origin,s);const o=new b1e(i,this._forEachLayer);r.options.selectOpaqueTerrainOnly=!i||!("include"in i||"exclude"in i);const a=e.origin,l=me(Ye.get(),e.origin,e.direction);r.reset(a,l,n),r.intersect(o.layers,s,this._tolerance);const c=this._view.slicePlane,h=v(c)?g0e(c):null;r.intersect(o.sliceableLayers,s,this._tolerance,h);const p=i&&(i.requiresGroundFeedback||i.enableDraped);this._externalIntersectionHandlers.forAll(_=>{const b=_.layerUid,w=Array.isArray(b),x=w?b:[b];w&&(r.options.filteredLayerUids=[]);let T=!1;for(const E of x)o.filterLayerUid(E)?T=!0:w&&r.options.filteredLayerUids.push(E);if(r.options.isFiltered=!T,_.isGround&&p||!r.options.isFiltered){const E=_.slicePlaneEnabled?h:null;_.intersect(r,E,a,l,s)}});const f=Ye.get(),m=this._view.basemapTerrain;if(i&&i.enableDraped&&v(m.spatialReference)&&r.results.ground.getIntersectionPoint(f)){const _=m.overlayManager.renderer,b=this._view.renderCoordsHelper.spatialReference,w=Ye.get();this._view.renderCoordsHelper.fromRenderCoords(f,w,m.spatialReference),w[2]=Nt((g=this._view.elevationProvider)==null?void 0:g.getElevation(f[0],f[1],f[2],b,"ground"),0),_.intersect(r,w,r.results.ground,x=>o.filterRenderGeometry(x))}r.sortResults(),this._processHUDResults(r)}_processHUDResults(e){const r=e.results.hud;w_(this._tmpRegion,dZ);const i=this._view.state.camera,n=[],s=this._tmpRegion,o=w=>{const x=new i$t(w);i.projectToRenderScreen(w.target.center,x.screenPoint),x.screenPoint[0]=Math.floor(x.screenPoint[0]),x.screenPoint[1]=Math.floor(x.screenPoint[1]),n.push(x),Rne(s,x.screenPoint)};e.sortResults(r.all),v(r.min.dist)&&o(r.min);for(const w of r.all)r.min.target.object!==w.target.object&&r.max.target.object!==w.target.object&&o(w);if(v(r.max.dist)&&r.max.target.object!==r.min.target.object&&o(r.max),!n.length)return;s[0]===s[2]&&(s[2]+=1),s[1]===s[3]&&(s[3]+=1);const a=i.fullWidth,l=i.fullHeight,c=Math.max(0,s[0]-jI),h=Math.max(0,s[1]-jI),p=Math.min(Bh(s)+2*jI,a-c),f=Math.min(cm(s)+2*jI,l-h),m=new Uint8Array(p*f*4);this._view._stage.renderer.readHUDVisibility(c,h,p,f,m);let g=!0;const _=R(e.results.max.dist);let b=0;for(const w of n)for(const x of r$t)if(m[4*(Math.min(w.screenPoint[0]+x[0],a)-s[0]+(Math.min(w.screenPoint[1]+x[1],l)-s[1])*p)]){g&&(e.results.min.copy(w.result),g=!1),_&&e.results.max.copy(w.result),e.options.store===ba.ALL&&e.results.all.splice(b++,0,w.result);break}}};const jI=1,r$t=(()=>{const t=[],e=jI;for(let r=-e;r<=e;r++)for(let i=-e;i<=e;i++)t.push([i+e,r+e]);return t})();let i$t=class{constructor(e){this.result=e,this.screenPoint=La()}},nk;function v1e(t){return nk&&nk.viewingMode===t||(nk=Pp(t)),nk}let b1e=class{constructor(e,r){this.layers=new Array,this.sliceableLayers=new Array,this.include=e==null?void 0:e.include,this.exclude=e==null?void 0:e.exclude,r(i=>{i.pickable&&this.filterLayerUid(i.apiLayerUid)&&(i.sliceable?this.sliceableLayers:this.layers).push(i)})}filterLayerUid(e){const{include:r,exclude:i}=this;return R(e)?r==null&&i==null:(r==null||r.has(e))&&(i==null||!i.has(e))}filterRenderGeometry(e){return this.filterLayerUid(e.layerUid)}};function w1e(t){return typeof t=="object"&&"intersect"in t}const sk=P(),ok=La();let eQt=class{constructor(e,r){this.spatialReference=e,this._view=r}getElevation(e,r,i){return this._view.elevationProvider.getElevation(e,r,0,this.spatialReference,i)}async queryElevation(e,r,i,n,s){return this._view.elevationProvider.queryElevation(e,r,0,this.spatialReference,s,i,n)}},n$t=class{constructor(e,r,i,n){this.spatialReference=r,this._getElevationQueryProvider=i,this._queries=new Array,this._queryOptions={...n,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(St.ELEVATION_QUERY,this)}destroy(){this._frameTask.remove()}queryElevation(e,r,i,n=0){return new Promise((s,o)=>{const a={x:e,y:r,minDemResolution:n,result:{resolve:s,reject:o},signal:i};this._queries.push(a),Ua(i,()=>{Pie(this._queries,a),o(Vr())})})}get running(){return this._queries.length>0}runTask(e){const r=this._queries;this._queries=[];const i=this._getElevationQueryProvider();if(!i)return r.forEach(h=>h.result.reject()),void e.madeProgress();const n=r.map(h=>[h.x,h.y]),s=r.reduce((h,p)=>Math.min(h,p.minDemResolution),1/0),o=new uN({points:n,spatialReference:this.spatialReference}),a=r.length>1&&r.some(h=>!!h.signal)?new AbortController:null,l=v(a)?a.signal:r[0].signal;if(v(a)){let h=0;r.forEach(p=>Ua(p.signal,()=>{h++,p.result.reject(Vr()),h===r.length&&a.abort()}))}const c={...this._queryOptions,minDemResolution:s,signal:l};i.queryElevation(o,c).then(h=>{r.forEach((p,f)=>{v(p.signal)&&p.signal.aborted?p.result.reject(Vr()):p.result.resolve(h.geometry.points[f][2])})}).catch(h=>{r.forEach(p=>p.result.reject(h))}),e.madeProgress()}get test(){const e=this;return{update:()=>e._queries.length>0&&e.runTask(jl)}}},GI=class extends Sn.EventedMixin(be){get spatialReference(){var e,r;return(r=(e=this.view)==null?void 0:e.basemapTerrain)==null?void 0:r.spatialReference}constructor(e){super(e),this._im=new Array,this._ground=new Array,this._scene=new Array,this._handles=new Map,this.lastElevationQuery=null,this.elevationCacheEnabled=!1}destroy(){this._elevationQueryCached=ze(this._elevationQueryCached)}get _elevationQuery(){return R(this._elevationQueryCached)&&(this._elevationQueryCached=new n$t(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4})),this._elevationQueryCached}enableElevationCache(e){e||(this.lastElevationQuery=null),this.elevationCacheEnabled=e}getElevation(e,r,i,n,s){if(this.elevationCacheEnabled&&this.lastElevationQuery!=null){const a=this.lastElevationQuery;if(e===a.x&&r===a.y&&i===a.z&&In(n,a.spatialReference)&&s===a.queryContext)return a.result}let o=null;return o=ak(o,this._im,e,r,i,n,s),R(o)&&(o=ak(o,this._ground,e,r,i,n,s)),s==="scene"&&(o=ak(o,this._scene,e,r,i,n,s)),this.elevationCacheEnabled&&(this.lastElevationQuery={x:e,y:r,z:i,spatialReference:n,queryContext:s,result:o}),o}queryElevation(e,r,i,n,s,o=null,a=0){const l=qb();return this._elevationQuery.queryElevation(e,r,o,a).then(c=>{s==="scene"&&(c=ak(c,this._scene,e,r,i,n,s)),l.resolve(c)}).catch(c=>{ps(c)?l.reject(c):l.resolve(this.getElevation(e,r,i,n,s))}),l.promise}register(e,r){this._handles.set(r,r.on("elevation-change",i=>this.emit("elevation-change",i))),this._providersFromContext(e).push(r)}unregister(e){var r;this._handles.has(e)&&((r=this._handles.get(e))==null||r.remove(),this._handles.delete(e));for(const i of[this._im,this._ground,this._scene]){const n=i.indexOf(e);n>-1&&i.splice(n,1)}}_providersFromContext(e){switch(e){case"ground":return this._ground;case"im":return this._im;case"scene":return this._scene}}};function ak(t,e,r,i,n,s,o){for(const a of e){const l=a.getElevation(r,i,n,s,o);v(l)&&(t=v(t)?Math.max(l,t):l)}return t}u([d({constructOnly:!0})],GI.prototype,"view",void 0),u([d()],GI.prototype,"spatialReference",null),GI=u([$("esri.views.3d.support.CombinedElevationProvider")],GI);let HI=class zte{static isValidProfile(e){return e in zte.profiles}static getDefaultProfile(){return ue("esri-iPhone")?"low":"medium"}static apply(e,r){const i=zte.profiles[e];r.graphics3D.maxTotalNumberOfFeatures=i.graphics3D.maxTotalNumberOfFeatures,r.graphics3D.maxTotalNumberOfPrimitives=i.graphics3D.maxTotalNumberOfPrimitives,r.graphics3D.polygonLodFactor=i.graphics3D.polygonLodFactor,r.graphics3D.polylineLodFactor=i.graphics3D.polylineLodFactor,r.graphics3D.snapshotAvailable=i.graphics3D.snapshotAvailable,r.graphics3D.skipHighSymbolLods=i.graphics3D.skipHighSymbolLods;const n=r.sceneService.object,s=i.sceneService.object;n.lodFactor=s.lodFactor,n.lodCrossfadeinDuration=s.lodCrossfadeinDuration,n.lodCrossfadeoutDuration=s.lodCrossfadeoutDuration,n.lodCrossfadeUncoveredDuration=s.lodCrossfadeUncoveredDuration,r.sceneService.point.lodFactor=i.sceneService.point.lodFactor,r.sceneService.integratedMesh.lodFactor=i.sceneService.integratedMesh.lodFactor,r.sceneService.pointCloud.lodFactor=i.sceneService.pointCloud.lodFactor,r.sceneService.uncompressedTextureDownsamplingEnabled=i.sceneService.uncompressedTextureDownsamplingEnabled,r.tiledSurface.lodBias=i.tiledSurface.lodBias,r.tiledSurface.angledSplitBias=i.tiledSurface.angledSplitBias,r.tiledSurface.reduceTileLevelDifferences=i.tiledSurface.reduceTileLevelDifferences,r.tiledSurface.textureFadeDuration=i.tiledSurface.textureFadeDuration,r.heatmap.pixelRatio=i.heatmap.pixelRatio,r.heatmap.maxTotalNumberOfFeatures=i.heatmap.maxTotalNumberOfFeatures,r.fadeDuration=i.fadeDuration,r.antialiasingEnabled=i.antialiasingEnabled,r.physicallyBasedRenderingEnabled=i.physicalBasedRenderingEnabled,r.highQualityTransparency=i.highQualityTransparency,r.memoryLimit=i.memoryLimit,r.additionalCacheMemory=i.additionalCacheMemory,r.frameRate=i.frameRate,r.maximumPixelRatio=i.maximumPixelRatio}};function x1e(){const t=!!ue("esri-mobile"),e=!!ue("ios"),r=400;return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxTotalNumberOfPrimitives:85e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25e3},sceneService:{object:{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},fadeDuration:0,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:t?.8:1,polylineLodFactor:t?1.2:1.5,snapshotAvailable:!e,skipHighSymbolLods:!1},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:r},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:t},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!ue("disable-feature:reduce-map-tile-levels"),textureFadeDuration:r},fadeDuration:r,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:t?600:750,additionalCacheMemory:t?0:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:t?1.2:2,polylineLodFactor:t?1.2:2,snapshotAvailable:!e,skipHighSymbolLods:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:r},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!ue("disable-feature:reduce-map-tile-levels"),textureFadeDuration:r},fadeDuration:r,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:t?900:1500,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:t?1:1/0}}}HI.test={reset(){const t=x1e();for(const e in t)HI.profiles[e]=t[e]}},function(t){t.profiles=x1e()}(HI||(HI={}));const zU=HI;function H6e(){return new Float32Array(4)}function s$t(t){const e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function gm(t,e,r,i){const n=new Float32Array(4);return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n}function o$t(t,e){return new Float32Array(t,e,4)}function q6e(){return H6e()}function W6e(){return gm(1,1,1,1)}function X6e(){return gm(1,0,0,0)}function Y6e(){return gm(0,1,0,0)}function Z6e(){return gm(0,0,1,0)}function J6e(){return gm(0,0,0,1)}const a$t=q6e(),l$t=W6e(),c$t=X6e(),u$t=Y6e(),h$t=Z6e(),d$t=J6e();Object.freeze(Object.defineProperty({__proto__:null,ONES:l$t,UNIT_W:d$t,UNIT_X:c$t,UNIT_Y:u$t,UNIT_Z:h$t,ZEROS:a$t,clone:s$t,create:H6e,createView:o$t,fromValues:gm,ones:W6e,unitW:J6e,unitX:X6e,unitY:Y6e,unitZ:Z6e,zeros:q6e},Symbol.toStringTag,{value:"Module"}));const T1e=new Xe([0,255,255]),S1e=new Xe([0,0,0]),E1e=1,C1e=.25,A1e=.4,R1e=.2;let hg=class extends be{constructor(){super(...arguments),this.color=T1e.clone(),this.haloColor=null,this.haloOpacity=E1e,this.fillOpacity=C1e,this.shadowOpacity=A1e,this.shadowColor=S1e.clone(),this.shadowDifference=R1e}static toEngineOptions(e){const r=Xe.toUnitRGBA(e.color??T1e),i=v(e.haloColor)?Xe.toUnitRGBA(e.haloColor):r,n=Xe.toUnitRGBA(e.shadowColor??S1e),s=e.haloOpacity??E1e,o=e.fillOpacity??C1e,a=e.shadowOpacity??A1e,l=e.shadowDifference??R1e;return{color:gm(r[0],r[1],r[2],r[3]),haloColor:gm(i[0],i[1],i[2],i[3]),haloOpacity:s,haloOpacityOccluded:.25*s,fillOpacity:o,fillOpacityOccluded:.25*o,shadowOpacity:a,shadowColor:Zt(n[0],n[1],n[2],n[3]),occludedShadowOpacity:a*(1-l)}}};u([d({type:Xe})],hg.prototype,"color",void 0),u([d({type:Xe})],hg.prototype,"haloColor",void 0),u([d()],hg.prototype,"haloOpacity",void 0),u([d()],hg.prototype,"fillOpacity",void 0),u([d()],hg.prototype,"shadowOpacity",void 0),u([d({type:Xe})],hg.prototype,"shadowColor",void 0),u([d()],hg.prototype,"shadowDifference",void 0),hg=u([$("esri.views.3d.support.HighlightOptions")],hg);const Vte=hg;let PT=class extends fe{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(n=>n.toJSON()),r=this.geometries[0],i={};return i.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),i.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference.toJSON()),i.geometries=JSON.stringify({geometryType:l3(r),geometries:e}),this.transformation&&(i.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(i.transformForward=this.transformForward),i}};u([d()],PT.prototype,"geometries",void 0),u([d({json:{read:{source:"outSR"}}})],PT.prototype,"outSpatialReference",void 0),u([d()],PT.prototype,"transformation",void 0),u([d()],PT.prototype,"transformForward",void 0),PT=u([$("esri.rest.support.ProjectParameters")],PT);const VD=PT,p$t=bs(VD);async function zV(t,e,r){e=p$t(e);const i=kse(t),n={...i.query,f:"json",...e.toJSON()},s=e.outSpatialReference,o=l3(e.geometries[0]),a=trt(n,r);return ei(i.path+"/project",a).then(({data:{geometries:l}})=>KOe(l,o,s))}async function vce(t=null,e){var n,s;if(ri.geometryServiceUrl)return ri.geometryServiceUrl;if(!t)throw new H("internal:geometry-service-url-not-configured");let r;r="portal"in t?t.portal||pa.getDefault():t,await r.load({signal:e});const i=(s=(n=r.helperServices)==null?void 0:n.geometry)==null?void 0:s.url;if(!i)throw new H("internal:geometry-service-url-not-configured");return i}async function f$t(t,e,r=null,i){const n=await vce(r,i),s=new VD;s.geometries=[t],s.outSpatialReference=e;const o=await zV(n,s,{signal:i});if(o&&Array.isArray(o)&&o.length===1)return o[0];throw new H("internal:geometry-service-projection-failed")}const Bte=Object.freeze(Object.defineProperty({__proto__:null,getGeometryServiceURL:vce,projectGeometry:f$t},Symbol.toStringTag,{value:"Module"}));let m$t=class{constructor(e,r){this.spatialReference=r,this.unitInMeters=Kl(this.spatialReference,ii(this.spatialReference).metersPerDegree),this._geometryServiceURLPromise=vce(e&&e.get("portalItem")).catch(()=>{throw new H("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(e){const r=await this._geometryServiceURLPromise;let i,n=!0;Array.isArray(e[0])&&typeof e[0]!="number"?i=e:(i=[e],n=!1);const s=i.map(l=>l instanceof Ue?l:new Ue(l,this.spatialReference)),o=new VD({geometries:s,outSpatialReference:Je.WGS84}),a=(await zV(r,o)).map(l=>l.type==="point"?[l.x,l.y]:void 0).filter(l=>!!l);return n?a:a[0]}},Cf=class extends be{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxTotalNumberOfPrimitives=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1}};u([d()],Cf.prototype,"minTotalNumberOfFeatures",void 0),u([d()],Cf.prototype,"maxTotalNumberOfFeatures",void 0),u([d()],Cf.prototype,"maxTotalNumberOfPrimitives",void 0),u([d()],Cf.prototype,"snapshotAvailable",void 0),u([d()],Cf.prototype,"polygonLodFactor",void 0),u([d()],Cf.prototype,"polylineLodFactor",void 0),u([d()],Cf.prototype,"skipHighSymbolLods",void 0),Cf=u([$("esri.views.3d.support.QualitySettings.Graphics3DSettings")],Cf);let Jg=class extends be{constructor(){super(...arguments),this.lodFactor=1}};u([d()],Jg.prototype,"lodFactor",void 0),Jg=u([$("esri.views.3d.support.QualitySettings.LoDFactorSettings")],Jg);let VV=class extends Jg{constructor(){super(...arguments),this.lodCrossfadeinDuration=0,this.lodCrossfadeoutDuration=0,this.lodCrossfadeUncoveredDuration=0}};VV=u([$("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],VV);let O0=class extends be{constructor(){super(...arguments),this.object=new VV,this.point=new Jg,this.integratedMesh=new Jg,this.pointCloud=new Jg,this.uncompressedTextureDownsamplingEnabled=!1}};u([d({type:VV})],O0.prototype,"object",void 0),u([d({type:Jg})],O0.prototype,"point",void 0),u([d({type:Jg})],O0.prototype,"integratedMesh",void 0),u([d({type:Jg})],O0.prototype,"pointCloud",void 0),u([d()],O0.prototype,"uncompressedTextureDownsamplingEnabled",void 0),O0=u([$("esri.views.3d.support.QualitySettings.SceneServiceSettings")],O0);let z1=class extends be{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.reduceTileLevelDifferences=!0,this.textureFadeDuration=400}};u([d()],z1.prototype,"lodBias",void 0),u([d()],z1.prototype,"angledSplitBias",void 0),u([d()],z1.prototype,"reduceTileLevelDifferences",void 0),u([d()],z1.prototype,"textureFadeDuration",void 0),z1=u([$("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],z1);let uR=class extends be{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};u([d()],uR.prototype,"pixelRatio",void 0),u([d()],uR.prototype,"maxTotalNumberOfFeatures",void 0),uR=u([$("esri.views.3d.support.QualitySettings.HeatmapSettings")],uR);let Tc=class extends be{constructor(){super(...arguments),this.graphics3D=new Cf,this.sceneService=new O0,this.tiledSurface=new z1,this.heatmap=new uR,this.fadeDuration=400,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.memoryLimit=void 0,this.additionalCacheMemory=void 0,this.frameRate=void 0,this.maximumPixelRatio=1/0}};u([d({type:Cf})],Tc.prototype,"graphics3D",void 0),u([d({type:O0})],Tc.prototype,"sceneService",void 0),u([d({type:z1})],Tc.prototype,"tiledSurface",void 0),u([d({type:uR})],Tc.prototype,"heatmap",void 0),u([d()],Tc.prototype,"fadeDuration",void 0),u([d()],Tc.prototype,"antialiasingEnabled",void 0),u([d()],Tc.prototype,"physicallyBasedRenderingEnabled",void 0),u([d()],Tc.prototype,"highQualityTransparency",void 0),u([d()],Tc.prototype,"memoryLimit",void 0),u([d()],Tc.prototype,"additionalCacheMemory",void 0),u([d()],Tc.prototype,"frameRate",void 0),u([d()],Tc.prototype,"maximumPixelRatio",void 0),Tc=u([$("esri.views.3d.support.QualitySettings.QualitySettings")],Tc);const O1e=Tc;function g$t(t){return Lie(t)&&t.length>=3}function y$t(t){return(Die(t)||Array.isArray(t))&&t.length>=3}function _$t(t){return g$t(t)||y$t(t)}let v$t=class jte{constructor(e,r,i,n){this.viewingMode=e,this.spatialReference=r,this.unitInMeters=i,this._coordinateSystem=n,this._tmpCoordinateSystem=Iyt(n)}set extent(e){e&&$yt(this._coordinateSystem,e,this._coordinateSystem)}getAltitude(e){return Vyt(this._coordinateSystem,e)}setAltitude(e,r,i=e){return WLe(this._coordinateSystem,i,r,e)}setAltitudeOfTransformation(e,r){Byt(this._coordinateSystem,r,e,r)}worldUpAtPosition(e,r){return Fyt(this._coordinateSystem,e,r)}worldBasisAtPosition(e,r,i){return kyt(this._coordinateSystem,e,r,i)}basisMatrixAtPosition(e,r){const i=this.worldBasisAtPosition(e,Nu.X,Ye.get()),n=this.worldBasisAtPosition(e,Nu.Y,Ye.get()),s=this.worldBasisAtPosition(e,Nu.Z,Ye.get());return _y(r,i[0],i[1],i[2],0,n[0],n[1],n[2],0,s[0],s[1],s[2],0,0,0,0,1),r}headingAtPosition(e,r){const i=this.worldUpAtPosition(e,Ye.get()),n=this.worldBasisAtPosition(e,Nu.Y,Ye.get()),s=xLe(r,n,i);return dl(s)}intersectManifoldClosestSilhouette(e,r,i){return MH(this._coordinateSystem,r,this._tmpCoordinateSystem),zyt(this._tmpCoordinateSystem,e,i),i}intersectManifold(e,r,i){MH(this._coordinateSystem,r,this._tmpCoordinateSystem);const n=Ye.get();return Uyt(this._tmpCoordinateSystem,e,n)?ce(i,n):null}intersectInfiniteManifold(e,r,i){if(this.viewingMode===qe.Global)return this.intersectManifold(e,r,i);MH(this._coordinateSystem,r,this._tmpCoordinateSystem);const n=this._tmpCoordinateSystem.value,s=Ye.get();return j2(n.plane,e,s)?ce(i,s):null}toRenderCoords(e,r,i){return vV(e)?Ba(e,r,this.spatialReference):zo(e,r,i,this.spatialReference)}fromRenderCoords(e,r,i=null){return vV(r)?(v(i)&&(r.spatialReference=i),BAe(e,this.spatialReference,r)):_$t(r)?zo(e,this.spatialReference,r,i)?r:null:iw(e,this.spatialReference,r)}static create(e,r){switch(e){case qe.Local:return new jte(qe.Local,r,Kl(r),Nyt());case qe.Global:return new jte(qe.Global,r,1,Dyt(r))}}static renderUnitScaleFactor(e,r){return M1e(e)/M1e(r)}};function M1e(t){if(bV(t,qe.Global))return 1;const e=XLe(!1,t);return Kl(e)}var $g;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.BASEMAP=1]="BASEMAP",t[t.I3S_INDEX=2]="I3S_INDEX",t[t.I3S_DATA=3]="I3S_DATA",t[t.SYMBOLOGY=4]="SYMBOLOGY"})($g||($g={}));const b$t=(()=>{const t=new Array;return t[$g.ELEVATION]=10,t[$g.BASEMAP]=10,t[$g.I3S_INDEX]=10,t[$g.I3S_DATA]=10,t[$g.SYMBOLOGY]=5,t})(),w$t=30;function K6e(t){return typeof t.getUsedMemory=="function"}function x$t(t){return new Sc({view:t})}const lk=1,wW=1,T$t=.75,S$t=.6,P1e=1.3;let Sc=class extends be{constructor(e){super(e),this._quality=1,this._memoryUsed=0,this._updating=!1,this.minQuality=.1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new Dse,this._warnMemoryUsage=null,this._numQualityChanges=0,this._maxMemory=500,this._additionalCacheMemory=100}destroy(){this._cacheStorage.destroy()}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(lk),this._maxMemory=e)}get maxMemory(){return this._maxMemory}set additionalCacheMemory(e){e!=null&&e>=0&&(this._additionalCacheMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._memoryUsed}newCache(e,r){return new Ttt(e,this._cacheStorage,r)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._updateMemory(),this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();if(this._memoryPredicted<S$t&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(lk);else if(e)(this._memoryPredicted>1.1*wW||this._memoryUsed>wW)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/P1e),this._downscaleMemoryUsed=this._memoryUsed,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._memoryUsed>wW)this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/P1e),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._memoryUsed<T$t&&this._quality<lk){this._stableQuality=this._quality;const r=.05;e=this._updateQuality(this._quality+r)}else this._quality<1&&(this._canFastRecover=!0);this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,this.minQuality),lk))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){let e=0,r=0;this.view.basemapTerrain&&this.view.basemapTerrain.getUsedMemory&&(e+=this.view.basemapTerrain.getUsedMemory());const i=this.view._stage&&this.view._stage.renderView&&this.view._stage.renderer.edgeView;v(i)&&(e+=i.usedMemory),this.view.allLayerViews&&this.view.allLayerViews.forEach(a=>{if(K6e(a)){const l=a.ignoresMemoryFactor()?this._quality:1;e+=a.getUsedMemory()*l,r+=a.getUnloadedMemory()*l}});const n=R(this._warnMemoryUsage)||Math.round(10*e)!==Math.round(10*this._warnMemoryUsage),s=1048576*this.maxMemory;if(e>s&&n){this._warnMemoryUsage=e;const a=c=>(c/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",l=Math.round(100*this._quality);re.getLogger(this.declaredClass).warn(`Memory Limit exceeded! Limit: ${a(s)} Current: ${a(e)} Projected: ${a(e+r)} Quality: ${l}%`)}this._memoryUsed=e/s,this._memoryPredicted=(e+r)/s;const o=s-e;this._cacheStorage.maxSize=Math.max(0,o+1048576*this.additionalCacheMemory)}get test(){const e=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const r=e._numQualityChanges;return e._numQualityChanges=0,r}}}};u([d({constructOnly:!0})],Sc.prototype,"view",void 0),u([d()],Sc.prototype,"maxMemory",null),u([d()],Sc.prototype,"additionalCacheMemory",null),u([d()],Sc.prototype,"memoryFactor",null),u([d()],Sc.prototype,"updating",null),u([d()],Sc.prototype,"usedMemory",null),u([d()],Sc.prototype,"_quality",void 0),u([d()],Sc.prototype,"_memoryUsed",void 0),u([d()],Sc.prototype,"_updating",void 0),u([d()],Sc.prototype,"_stableQuality",void 0),u([d()],Sc.prototype,"_maxMemory",void 0),u([d()],Sc.prototype,"_additionalCacheMemory",void 0),Sc=u([$("esri.views.3d.support.MemoryController")],Sc);let E$t=class{constructor(e){this.client=e,this._cancelled=!1,this.size=0,this.duration=0}},C$t=class{constructor(e){this.typeWorkerQuota=e,this.tasks=new Array,this.numWorkers=0,this.statistics=new A$t}},A$t=class{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}},R$t=class{constructor(e,r,i,n){this._workerFunc=e,this._callbackFunc=r,this._maxTotalNumWorkers=i,this._totalNumWorkers=0,this._clients=n.map(s=>new C$t(s))}destroy(){this._clients.length=0}hasQuota(e){const r=this._clients[e];return!!r&&(this._totalNumWorkers<this._maxTotalNumWorkers||r.numWorkers+r.tasks.length<r.typeWorkerQuota)}push(e){const r=this._clients[e.client];r&&(this._totalNumWorkers<this._maxTotalNumWorkers?(r.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,(i,n)=>this._taskCallback(i,n))):r.tasks.push(e))}cancel(e){this._taskFinished(e),e._cancelled=!0}_taskFinished(e){const r=this._clients[e.client];this._totalNumWorkers--,r.numWorkers--,r.statistics.requests++,r.statistics.size+=e.size||0,r.statistics.duration+=e.duration||0,r.statistics.speed=r.statistics.duration>0?r.statistics.size/r.statistics.duration:0,wt(r.numWorkers>=0),this._next()}_next(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))return}_processQueue(e){for(;e.tasks.length>0;)if(this._workerFunc(e.tasks.shift(),(r,i)=>this._taskCallback(r,i)))return e.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(e,r){e._cancelled||(this._callbackFunc(e,r),this._taskFinished(e))}getStatsForType(e){const r=this._clients[e];return r?{quota:r.typeWorkerQuota,workers:r.numWorkers,queueSize:r.tasks.length,requestStats:r.statistics}:null}get test(){const e=this;return{set workerFunc(r){e._workerFunc=r}}}},VU=class extends be{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,r,i){this._loadQueue=new R$t((n,s)=>this._startLoading(n,s),(n,s)=>this._doneLoadingCB(n,s),e,r),i&&(this._frameTask=i.registerTask(St.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=$i(this._frameTask),this._tasks.forEach(e=>Tp(e.abortController)),this._loadQueue=ze(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,r,i,n={}){const s=qb();s.__signal=v(n)?n.signal:null;const o=this._createOrUpdateTask(e,r,i,n,s);return Ua(n,()=>this._cancelRequest(o,s)),s.promise}_createTask(e,r,i,n,s,o){const a=new P$t(e,r,i,n,s);return this._updateTask(a,o),this._tasks.set(s,a),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(a),a}_cancelRequest(e,r){var i;PL(e.resolvers,r),r.reject(Vr()),e.resolvers.length===0&&(e.status===zd.DOWNLOADING&&(e.status=zd.CANCELLED,this._loadQueue.cancel(e),(i=e.abortController)==null||i.abort(),e.request=null,e.abortController=null),e.status=zd.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,r){e.resolvers.push(r)}_createOrUpdateTask(e,r,i,n,s){const o=I$t(v(n)&&n.uid||e,r,i),a=this._tasks.get(o);return a?(this._updateTask(a,s),a):this._createTask(e,n,r,i,o,s)}_doneLoadingCB(e,r){this._loadQueue&&(wt(e.status===zd.DOWNLOADING),e.status=zd.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:r}):this._doneLoading(e,r))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const r=this._onLoadQueue.shift();lr(r.task.abortController),r.task.abortController=null,r.callback(r.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const r=this._doneQueue.shift();r.task.status!==zd.DOWNLOADED&&(r.err=r.err||Vr()),this._doneLoading(r.task,r.err),e.madeProgress()}}_doneLoading(e,r){if(r&&!ps(r)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let i=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const n of e.resolvers)if(r)ps(r)?n.reject(r):n.reject(new H("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${r}`,{url:e.url,error:r}));else{--i;const s=i<=0?e.result:se(e.result);n.resolve(s)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,r){if(e.status===zd.CANCELLED)return!1;let i,n;switch(e.startTime=performance.now(),e.status=zd.DOWNLOADING,e.docType){case"binary":n="array-buffer",i=0;break;case"image":n="image";break;case"image+type":n="array-buffer";break;default:n="json"}e.abortController=new AbortController;const s=e.abortController.signal;e.request=ei(e.url,{...e.options,responseType:n,timeout:i,signal:s});let o=()=>{};const a=c=>{e.duration=performance.now()-e.startTime,e.size=c instanceof ArrayBuffer?c.byteLength:e.size||0,e.result=c,this._frameTask?this._onLoadQueue.push({callback:r,task:e}):(e.abortController=null,r(e))},l=c=>{e.status===zd.DOWNLOADING&&r(e,c),o()};return e.docType!=="image+type"?(e.request.then(c=>a(c.data),l),!0):(e.request.then(c=>{const h=c.data,p=M$t(h);if(n="image",e.size=h.byteLength,p==="unknown")return e.request=ei(e.url,{responseType:n,timeout:i,signal:s}),void e.request.then(g=>a(g.data),l);const f=new Blob([h],{type:p}),m=window.URL.createObjectURL(f);o=()=>window.URL.revokeObjectURL(m),e.request=ei(m,{responseType:n,timeout:i,signal:s}),e.request.then(g=>a(new D7(g.data,p,o)),l)},l),!0)}get test(){return{loadQueue:this._loadQueue}}};u([d({readOnly:!0})],VU.prototype,"updating",void 0),VU=u([$("esri.views.3d.support.StreamDataLoader")],VU);const O$t={numRetries:0};function M$t(t){if(t.byteLength<2)return"unknown";const e=new Uint8Array(t,0,t.byteLength);return e[0]===137&&e[1]===80?"image/png":e[0]===71&&e[1]===73?"image/gif":e[0]===66&&e[1]===77?"image/bmp":e[0]===255&&e[1]===216?"image/jpeg":"unknown"}let D7=class{constructor(e,r,i){this.image=e,this.type=r,this.release=i}get isOpaque(){return this.type==="image/jpeg"}},P$t=class extends E$t{constructor(e,r,i,n,s){super(n),this.url=e,this.options=r,this.docType=i,this.key=s,this.result=null,this.status=zd.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=O$t.numRetries}};function I$t(t,e,r){return`${t}:${e}:${r}`}var zd;(function(t){t[t.QUEUED=1]="QUEUED",t[t.DOWNLOADING=2]="DOWNLOADING",t[t.DOWNLOADED=3]="DOWNLOADED",t[t.CANCELLED=4]="CANCELLED"})(zd||(zd={}));let BU=class extends be{constructor(){super(...arguments),this.updating=!1}};function $$t(t){return new dg({view:t})}u([d({readOnly:!0})],BU.prototype,"updating",void 0),BU=u([$("esri.views.3d.support.ResourceControllerMain")],BU);let dg=class extends BU{constructor(){super(...arguments),this._immediateTask=NO,this._normalTask=NO,this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=Rht(),this._memoryController=x$t(this.view),this._streamDataLoader=new VU,this._streamDataLoader.setup(w$t,b$t,this._scheduler),this.addHandles([ne(()=>{var e;return(e=this.view.state)==null?void 0:e.mode},e=>{e!=null&&(this._scheduler.state=e)},Zr),ne(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=v_({update:e=>this._frame(e)}),this._immediateTask=this._scheduler.registerTask(St.RESOURCE_CONTROLLER_IMMEDIATE),this._normalTask=this._scheduler.registerTask(St.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove(),this._normalTask.remove(),this._frameTask=$i(this._frameTask),this._streamDataLoader=ze(this._streamDataLoader),this._memoryController=ze(this._memoryController),this._scheduler=ze(this._scheduler)}get updating(){var e,r,i;return!!((e=this._memoryController)!=null&&e.updating||(r=this._streamDataLoader)!=null&&r.updating||(i=this._immediateTask)!=null&&i.updating)}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(e){const r=this._streamDataLoader;return{request:(i,n,s)=>r.request(i,n,e,s),get busy(){return!r.hasDownloadSlots(e)}}}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(qie(e.deltaTime)),!this._scheduler)||(this._scheduler.updateBudget(e)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update())}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){return{getQueueStats:e=>this._streamDataLoader.test.loadQueue.getStatsForType(e)}}};u([d({constructOnly:!0})],dg.prototype,"view",void 0),u([d()],dg.prototype,"_scheduler",void 0),u([d()],dg.prototype,"_memoryController",void 0),u([d()],dg.prototype,"_streamDataLoader",void 0),u([d()],dg.prototype,"_immediateTask",void 0),u([d()],dg.prototype,"_normalTask",void 0),u([d({readOnly:!0})],dg.prototype,"updating",null),dg=u([$("esri.views.3d.support.ResourceControllerImpl")],dg);function L$t(t){return"performanceInfo"in t}const YE=P(),D$t=P(),Gy=P(),Hy=P();function N$t(t,e,r=0){const i=t.extent;if(R(i))return!1;if(r===0)return fCe(i,e);const n=Math.min(i[2]-i[0],i[3]-i[1]);return cWe(i,e,r*n)}function ck(t,e,r,i){ce(YE,r),YE[i]=e[i];const n=ge(YE,YE,e),s=ge(D$t,t,e),o=ve(s,n),a=ve(n,n);let l;l=o<=0?e:a<=o?r:me(YE,e,le(n,n,o/a));const c=ge(YE,t,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function F$t(t,e,r){const i=t.extent;if(R(i))return 0;Gy[0]=i[0],Gy[1]=i[1],Gy[2]=r,Hy[0]=i[2],Hy[1]=i[3],Hy[2]=r;let n=1/0,s=1/0;return e[0]<Gy[0]?n=ck(e,Gy,Hy,0):e[0]>Hy[0]&&(n=ck(e,Hy,Gy,0)),e[1]<Gy[1]?s=ck(e,Gy,Hy,1):e[1]>Hy[1]&&(s=ck(e,Hy,Gy,1)),Math.min(n,s)}function k$t(t,e,r){if(R(t))return xae();if(t.spatialReference.isGeographic&&!o2(t.spatialReference))return new H("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const i=Pu.checkUnsupported(t);if(v(i))return i;if(R(r))return new H("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const n=U$t(t,r);if(n)return n;const s=t.spatialReference;return v(e)&&!(s.equals(e)||e.isWGS84&&s.isWebMercator)?new H("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}function U$t(t,e){const r=t.lods,i=r[0].resolution*2**r[0].level,n=[i*t.size[0],i*t.size[1]],s=[t.origin.x,t.origin.y],o=HL(e),a=Kt();Pu.computeRowColExtent(o,n,s,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>eR){const c=r[0].scale*2**r[0].level;let h=Math.max((o[3]-o[1])/t.size[1],(o[2]-o[0])/t.size[0])*c/i;const p=Math.floor(Math.log(h)/Math.log(10));return h=Math.ceil(h/10**p)*10**p,new H("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+h.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:h,requiredNumRootTiles:l,allowedNumRootTiles:eR})}return null}const z$t=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:k$t,isInsideExtent:N$t,tiltToExtentEdge:F$t},Symbol.toStringTag,{value:"Module"}));function V$t(){return!0}function B$t(){return 0}function j$t(t,e){if(R(t))return xae();const r=t.lods.length-1,i=t.spatialReference,n=o2(i)||my(i)||gy(i);if(i.isWebMercator){if(!Pu.makeWebMercatorAuxiliarySphere(r).compatibleWith(t))return new H("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!n)return new H("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!Pu.makeGCSWithTileSize(t.spatialReference,t.size[0],r).compatibleWith(t))return t.spatialReference.isWGS84?new H("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new H("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return v(e)&&!t.spatialReference.equals(e)?new H("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene"):void 0}const G$t=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:j$t,isInsideExtent:V$t,tiltToExtentEdge:B$t},Symbol.toStringTag,{value:"Module"})),H$t={[qe.Global]:G$t,[qe.Local]:z$t};function Cg(t,e){t||console.warn("Terrain: "+e)}let Zs=!1,BV=!1;function q$t(t){BV=t,Zs=Zs||t}function W$t(t){Zs=t}function Re(t,e){var r;if(Zs&&!t){const i=(r=new Error().stack)==null?void 0:r.slice(5);throw console.warn("Terrain internal: "+(e||"")+" at "+i),new Error("Assertion failed"+(e?": "+e:""))}}function Gte(t){return N7(t)?{fullExtent:t.fullExtent,minScale:t.layer.minScale,maxScale:t.layer.maxScale,tilemapCache:null}:t.layer}function jV(t){return(t==null?void 0:t.type)==="imagery-tile"||(t==null?void 0:t.type)==="wcs"}function N7(t){return(t==null?void 0:t.type)==="imagery-tile-3d"}function bce(t){return(t==null?void 0:t.type)==="tile-3d"}function BD(t){return(t==null?void 0:t.type)==="vector-tile-3d"}function Q6e(t){return(t==null?void 0:t.type)==="wmts-3d"}function Hte(t){return(t==null?void 0:t.type)==="elevation-3d"}function rP(t){return(t==null?void 0:t.type)==="group"}function GV(t){return t&&(bce(t)||Q6e(t)||N7(t)||BD(t))}function qte(t){return t&&(bce(t)||N7(t)||BD(t)||Q6e(t))}function jD(t){return qte(t)||Hte(t)}function X$t(t){var r;const e=(r=t==null?void 0:t.sourceLayerInfo)==null?void 0:r.data;return v(e)&&"type"in e&&e.type==="raster-tile"}function Y$t(t){var r;const e=(r=t==null?void 0:t.sourceLayerInfo)==null?void 0:r.data;return v(e)&&"type"in e&&e.type==="vector-tile"}function Z$t(t){var r;const e=(r=t==null?void 0:t.sourceLayerInfo)==null?void 0:r.data;return v(e)&&"type"in e&&e.type==="tile-texture"}function J$t(t){var r;const e=(r=t==null?void 0:t.sourceLayerInfo)==null?void 0:r.data;return e instanceof HTMLImageElement||e instanceof D7||e instanceof HTMLCanvasElement||e instanceof ImageData}function HR(t){return v(t)&&"release"in t&&t.release(),null}function I1e(t){return t.fetchTile&&t.hasOverriddenFetchTile!==!1}function wce(t,e,r,i){return H$t[i].checkIfTileInfoSupportedForViewSR(t,r,e)}function F7(t,e,r){let i=null,n=null;if((t==null?void 0:t.type)==="wmts"){const s=K$t(t,e,r);i=s.tileInfo,n=s.fullExtent}else{n=jV(t)?t.getCompatibleFullExtent(e):t.fullExtent;const s=r===qe.Local;if(jV(t))i=t.getCompatibleTileInfo(e,n,s);else if((t==null?void 0:t.type)==="vector-tile"){const o=s&&!Q$t(e)||eLt.force512VTL,a=t.tileInfo.spatialReference.isGeographic;i=o?t.tileInfo:t.tileInfo.getOrCreateCompatible(256,a?1:2)}else i=t.tileInfo}return v(i)&&v(n)&&wce(i,n,e,r)==null?{tileInfo:i,fullExtent:n}:null}function K$t(t,e,r){const i=$Qe(t);if(v(i)){if(!ct.isCollection(i))return{tileInfo:i.tileInfo,fullExtent:i.fullExtent};{const n=i.find(s=>wce(s.tileInfo,s.fullExtent,e,r)==null);if(n)return{tileInfo:n.tileInfo,fullExtent:n.fullExtent}}}return{tileInfo:null,fullExtent:null}}function Q$t(t){return t.isWGS84||t.isWebMercator||R2e(t)||!NL(t)}const eLt={force512VTL:!1};function $1e(t){return"["+t[0]+","+t[1]+","+t[2]+"]"}function qy(t){return"("+t[0]+","+t[1]+","+t[2]+")"}function rp(t,e,r=iLt){return Math.abs(t-e)<r}function Wte(t){return t===It.NORTH_EAST?It.SOUTH_WEST:t===It.NORTH_WEST?It.SOUTH_EAST:t===It.SOUTH_WEST?It.NORTH_EAST:It.NORTH_WEST}function HV(t){return t===It.NORTH?It.SOUTH:t===It.EAST?It.WEST:t===It.SOUTH?It.NORTH:It.EAST}function tLt(t){return t===It.NORTH_WEST||t===It.SOUTH_WEST}function rLt(t){return t===It.NORTH_WEST||t===It.NORTH_EAST}function L1e(t){return t===It.NORTH_WEST||t===It.WEST||t===It.SOUTH_WEST}function D1e(t){return t===It.NORTH_EAST||t===It.EAST||t===It.SOUTH_EAST}function N1e(t){return t===It.SOUTH_EAST||t===It.SOUTH||t===It.SOUTH_WEST}function F1e(t){return t===It.NORTH_EAST||t===It.NORTH||t===It.NORTH_WEST}const Ug=[It.NORTH,It.EAST,It.SOUTH,It.WEST],qV=[It.NORTH_EAST,It.SOUTH_EAST,It.SOUTH_WEST,It.NORTH_WEST],iLt=1e-5;let nLt=class{constructor(e,r){if(this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=e.layer,this.memory=jD(e)?r.basemapTerrain.getUsedMemoryForLayerView(e):e.getUsedMemory(),L$t(e)){const i=e.performanceInfo;this.displayedNumberOfFeatures=i.displayedNumberOfFeatures,this.maximumNumberOfFeatures=i.maximumNumberOfFeatures,this.totalNumberOfFeatures=i.totalNumberOfFeatures}}},sLt=class{constructor(e){var i;if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,v(e.resourceController)){const n=e.resourceController.memoryController;this.totalMemory=(n.maxMemory??0)*CO.MEGABYTES,this.usedMemory=Math.round(n.usedMemory*this.totalMemory),this.quality=n.memoryFactor,this.load=e.resourceController.scheduler.load}this.terrainMemory=((i=e.basemapTerrain)==null?void 0:i.getUsedMemory())??0;const r=e._stage&&e._stage.renderView&&e._stage.renderer.edgeView;this.edgesMemory=v(r)?r.usedMemory:0,e.allLayerViews.items.forEach(n=>{(K6e(n)||jD(n))&&this.layerPerformanceInfos.push(new nLt(n,e))}),this.layerPerformanceInfos.sort((n,s)=>s.memory-n.memory)}},oLt=class{constructor(e){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=e("gltf-resources",()=>{}),this._wosrMemCache=e("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(e=>e.abortController.abort()),this._wosrLoading.forEach(e=>e.abortController.abort()),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()}loadGLTF(e,r,i){const n=i?`gltfPBR:${e}`:`gltf:${e}`,s=this._gltfMemCache.get(n);return v(s)?Promise.resolve(s):this._loadOnce(this._gltfLoading,this._gltfMemCache,n,o=>h6e(new c6e(o.streamDataRequester),e,o,i),r)}loadWOSR(e,r){const i=`wosr:${e}:${r.disableTextures}`,n=this._wosrMemCache.get(i);return v(n)?Promise.resolve(n):this._loadOnce(this._wosrLoading,this._wosrMemCache,i,s=>d6e(e,s),r)}async _loadOnce(e,r,i,n,s){lr(s);const o=Ua(s,()=>this._abortLoad(e,i));let a=e.get(i);if(a)a.refCount++;else{const l=new AbortController;a={refCount:1,abortController:l,promise:n({...s,signal:l.signal})},e.set(i,a)}try{const l=await a.promise;return r.put(i,l,l.size),e.delete(i),lr(s),l}finally{$i(o)}}_abortLoad(e,r){const i=e.get(r);v(i)&&--i.refCount>0||(e.delete(r),v(i)&&i.abortController.abort())}},aLt=class extends KA{constructor(e,r,i,n){super(r,n),this._streamDataRequester=e,this._parameters=i}async fromUrl(e,r,i){lr(i);const n=v(i)?i.signal:null,s=this.makeUid(e,r);let o=this._textureRequests.get(s);if(!o){const a=new AbortController,l=this._streamDataRequester.request(e,"image",{uid:s,signal:a.signal});o={referenceCount:0,texture:null,textureAsync:null,abortController:a};const c=o;this._textureRequests.set(s,o),o.textureAsync=l.then(async h=>{const p=this._createTexture(e,h,r);return c.texture=p,c.abortController=null,this._stage.add(p),await this._stage.load(p),{uid:s,texture:p,release:()=>this._release(s)}},h=>{throw c.abortController=null,h})}o.referenceCount++;try{return await Hie(o.textureAsync,n)}catch(a){throw this._release(s),a}}_createTexture(e,r,i){var s;const n={...this._parameters,powerOfTwoResizeMode:kb.PAD};if(ICe(e)){if(i||r.width===0&&r.height===0){const o=r.width?r.height/r.width:1;i=i||64,o>1?(r.width=Math.round(i/o),r.height=i):(r.width=i,r.height=Math.round(i*o))}(s=this._stage.renderView)!=null&&s.renderingContext.driverTest.svgPremultipliesAlpha.result&&(n.preMultiplyAlpha=!1)}return n.width=r.width,n.height=r.height,new W2(r,n)}},lLt=class{constructor(e){this.textures=null,this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=e.viewState,this._view=e.view,this._pointsOfInterest=e.pointsOfInterest,this.streamDataRequester=e.resourceController.createStreamDataRequester($g.SYMBOLOGY),this.objectResourceCache=new oLt((i,n)=>e.resourceController.memoryController.newCache(i,n)),this.textures=new aLt(this.streamDataRequester,e.view._stage,{preMultiplyAlpha:!0,wrap:{s:$t.CLAMP_TO_EDGE,t:$t.CLAMP_TO_EDGE}},e.resourceController.scheduler);const r=ii(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=KFe(e.viewingMode,r),this.screenSizePerspectiveSettingsLabels=dSt(e.viewingMode,r)}destroy(){ze(this.textures),this.textures=null,this.streamDataRequester=null}addGraphicsOwner(e){if(!e)return am();this._graphicsOwners.push(e);const r=ne(()=>{var i;return(i=e.layer)==null?void 0:i.screenSizePerspectiveEnabled},()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),am(()=>{r.remove(),PL(this._graphicsOwners,e),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const e=this._graphicsOwners.some(r=>{var i;return((i=r.layer)==null?void 0:i.screenSizePerspectiveEnabled)===!0});if(e&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new qr;const r=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([ne(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,r,Zr),this._viewState.events.on("camera-projection-changed",r)]),this._updateScreenSizePerspectiveSettings()}else e||(this._screenSizePerspectiveHandles=ze(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){const e=this._pointsOfInterest;uk.distance=e.centerOnSurfaceInfrequent.distance,uk.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(uk),this.screenSizePerspectiveSettingsLabels.update(uk),this._view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this._screenSizePerspectiveHandles}}};const uk={distance:0,fovY:0};let yA=class{constructor(e,r,i=""){this.graphics=e,this._symbol=new lb({symbolLayers:[new ab({material:{color:r},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new U2({text:i,halo:{color:"white",size:1/.75},material:{color:r},size:12})]})}show(e,r){if(R(r))return;this.hide();const i=new Ue({x:e[0],y:e[1],z:e[2],spatialReference:r});this._graphic=new Va({geometry:i,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){v(this._graphic)&&(this.graphics.remove(this._graphic),this._graphic=null)}},Q1=class extends be{constructor(e){super(e),this.handles=new qr}destroy(){this.handles.destroy()}};u([d({constructOnly:!0})],Q1.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],Q1.prototype,"surface",void 0),u([d({constructOnly:!0})],Q1.prototype,"state",void 0),Q1=u([$("esri.views.3d.support.PointOfInterest")],Q1);const cLt=Array;let bf=class extends Q1{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new S_({location:Ue,renderLocation:cLt},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.renderLocation=P(),this._tmpPoint=new Ue}initialize(){if(this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.handles.add(Yn(()=>{var r,i;return(i=(r=this.map)==null?void 0:r.ground)==null?void 0:i.layers},"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool=ze(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get scale(){const e=this._camera,r=Pi(e.eye,this.renderLocation),i={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return w2(i,r,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map||!this.map.ground)return this._updateSurfaceAltitude(0),za.YIELD;const e=this.state.spatialReference;this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint,e);const r=(this._tmpPoint.z??0)>uLt&&this.renderCoordsHelper.viewingMode===qe.Global&&(e.isWGS84||e.isWebMercator);let i=new AbortController;return this.map.ground.queryElevation(this._tmpPoint,{signal:i.signal,cache:this.cache,minDemResolution:r?hLt:0}).then(n=>this._updateSurfaceAltitude(n.geometry.z??0)).catch(n=>{ps(n)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===i&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),i=null}),this._pendingElevationQueryController=i,za.YIELD}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(xW,this._estimatedSurfaceAltitude,this._camera.eye),Hl(this._get("renderLocation"),xW)||(this._set("renderLocation",ce(this._propertiesPool.get("renderLocation"),xW)),this.notifyChange("renderLocation"))}};u([d({constructOnly:!0})],bf.prototype,"scheduler",void 0),u([d({constructOnly:!0})],bf.prototype,"cache",void 0),u([d({constructOnly:!0})],bf.prototype,"task",void 0),u([d({readOnly:!0})],bf.prototype,"location",null),u([d({constructOnly:!0})],bf.prototype,"map",void 0),u([d({readOnly:!0})],bf.prototype,"renderLocation",void 0),u([d({readOnly:!0})],bf.prototype,"scale",null),u([d({readOnly:!0})],bf.prototype,"updating",null),bf=u([$("esri.views.3d.support.CameraOnSurface")],bf);const xW=P(),uLt=1e5,hLt=1e6,dLt=Array;let Vd=class extends Q1{constructor(e){super(e),this._propertiesPool=new S_({location:Ue,renderLocation:dLt},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=P(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=$i(this._frameWorker),this._propertiesPool=ze(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){return this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1,za.YIELD}_updateRenderLocation(){const e=fLt;let r=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const i=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!r&&i&&(r=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),r&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const n=mLt;r&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,n)&&(ce(e,n),this._currentSurfaceAltitude=this._latestSurfaceAltitude),r?this.distance=Pi(this._camera.eye,e):(le(e,this._camera.viewForward,this._get("distance")),me(e,e,this._camera.eye)),Hl(this._get("renderLocation"),e)||this._set("renderLocation",ce(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,r){var n,s;const i=this._camera;if(!this.renderCoordsHelper.intersectManifold(i.ray,e,r))return!1;if(this.state.isGlobal){const o=ii(this.renderCoordsHelper.spatialReference).radius,a=o+e,l=nl(i.eye),c=l<a*a,h=Pi(i.eye,r);if(c&&h>o/4){const p=a-Math.sqrt(l);return le(r,i.viewForward,p),me(r,r,i.eye),!0}}else{const o=(n=this.surface)!=null&&n.ready?this.surface.extent:null;v(o)&&rB(o,(s=this.surface)==null?void 0:s.spatialReference,iP,this.renderCoordsHelper.spatialReference)&&(r[0]=_e(r[0],iP[0],iP[2]),r[1]=_e(r[1],iP[1],iP[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,r){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,r)){if(Qr.TESTS_DISABLE_OPTIMIZATIONS)return!0;const i=this._camera.eye,n=Pi(i,e),s=Pi(i,r);if(Math.abs(s-n)/n>pLt)return!0}return!1}};u([d({constructOnly:!0})],Vd.prototype,"scheduler",void 0),u([d({constructOnly:!0})],Vd.prototype,"task",void 0),u([d()],Vd.prototype,"distance",void 0),u([d({constructOnly:!0})],Vd.prototype,"estimateSurfaceAltitudeAtCenter",void 0),u([d({readOnly:!0})],Vd.prototype,"location",null),u([d({readOnly:!0})],Vd.prototype,"renderLocation",void 0),u([d()],Vd.prototype,"updating",void 0),Vd=u([$("esri.views.3d.support.CenterOnSurface")],Vd);const pLt=.05,fLt=P(),mLt=P(),iP=Kt();let gLt=class{constructor(e){this._handles=new qr,this.events=new Sn,this._contentLayerViews=e.contentLayerViews,this._handles.add(this._contentLayerViews.on("change",r=>this._layerViewsChanged(r))),this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=ze(this._handles)}_layerViewsChanged(e){e.added.forEach(r=>{r.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this._handles.add(r.on("visible-geometry-changed",()=>this._contentChanged()),r.uid)}),e.removed.forEach(r=>this._handles.remove(r.uid))}_contentChanged(){this.events.emit("request-update",yLt)}};const yLt={},_Lt=Array;let pg=class extends Q1{constructor(e){super(e),this._propertiesPool=new S_({location:Ue,renderLocation:_Lt},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.handles.add([ne(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),ne(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.handles.add(this.scheduler.registerTask(St.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool=ze(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),r=this.centerOnSurface.renderLocation,i=this.renderCoordsHelper,n=this.state.contentCamera;this._dirty=!1,i.worldUpAtPosition(r,k1e);const s=Math.max(0,(Math.acos(ve(k1e,n.viewForward))-.5*Math.PI)*(n.aboveGround?1:-1));if(Number.isNaN(s)){if(!e||!Xb(e,r)){const c=this._propertiesPool.get("renderLocation");ce(c,r),this._set("renderLocation",c)}return za.YIELD}const o=1-_e(s/(.5*Math.PI),0,1),a=o*o*o;this._calculateScreenHorizontalEdgeOnSurface(U1e);const l=this._propertiesPool.get("renderLocation");return fs(l,r,U1e,a),e&&Xb(e,l)||this._set("renderLocation",l),za.YIELD}_calculateScreenHorizontalEdgeOnSurface(e){const r=this.state.contentCamera,i=r.getRenderCenter(La());if(i[1]=r.aboveGround?r.padding[yr.BOTTOM]:r.fullHeight-r.padding[yr.TOP],this.estimateSurfaceIntersectionAtRenderPoint(i,e))return e;const n=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(r.unprojectFromRenderScreen(i,nP)){ge(nP,nP,r.eye);const s=we(nP,nP);if(this.renderCoordsHelper.intersectManifold(nd(r.eye,s),n,e))return e}return this.renderCoordsHelper.setAltitude(e,n,r.eye)}updateRenderLocation(){this._dirty=!0}};u([d()],pg.prototype,"_dirty",void 0),u([d({constructOnly:!0})],pg.prototype,"scheduler",void 0),u([d({constructOnly:!0})],pg.prototype,"centerOnSurface",void 0),u([d({constructOnly:!0})],pg.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),u([d({readOnly:!0})],pg.prototype,"updating",null),u([d({readOnly:!0})],pg.prototype,"location",null),u([d({readOnly:!0})],pg.prototype,"renderLocation",void 0),pg=u([$("esri.views.3d.support.pointsOfInterest.Focus")],pg);const k1e=P(),nP=P(),U1e=P();let b0=class extends be{get surface(){var e;return(e=this.view.map)==null?void 0:e.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const e=P();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}constructor(e){super(e),this.location=null,this._updateController=null,this._handles=new qr}initialize(){this.view.state.isLocal&&(this._handles.add([ne(()=>{var e,r;return[(e=this.surfaceView)==null?void 0:e.spatialReference,(r=this.surfaceView)==null?void 0:r.extent]},()=>this._update()),Yn(()=>{var e;return(e=this.surface)==null?void 0:e.layers},"change",()=>this._update())]),this._update())}destroy(){this._handles.destroy()}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),!this.surfaceView||R(this.surfaceView.extent)||R(this.surfaceView.spatialReference))return void this._set("location",null);const e=One(this.surfaceView.extent),r=new Ue({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(r,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(i=>{this._updateController=null,this._set("location",i.geometry)}).catch(i=>{ps(i)||i&&i.name==="elevation-query:invalid-layer"||console.error("StableSurfaceCenter failed to update: ",i)})):this._set("location",r)}};u([d({constructOnly:!0})],b0.prototype,"view",void 0),u([d({constructOnly:!0})],b0.prototype,"cache",void 0),u([d()],b0.prototype,"surface",null),u([d()],b0.prototype,"surfaceView",null),u([d({readOnly:!0})],b0.prototype,"location",void 0),u([d({readOnly:!0})],b0.prototype,"renderLocation",null),b0=u([$("esri.views.3d.terrain.StableSurfaceCenter")],b0);let w0=class extends be{constructor(e){super(e),this._tileGeometryUpdateExtent=td(),this._tileGeometryUpdateSpatialReference=null,this.events=new Sn,this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(St.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){return this.updating&&(this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",vLt),td(this._tileGeometryUpdateExtent),this._set("updating",!1)),za.YIELD}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,$b(this._tileGeometryUpdateExtent,e.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let r=1;r<this.centerOnSurfaces.length;r++){const i=this.centerOnSurfaces[r];i.distance>e.distance&&(e=i)}return e}_centerIntersectsExtent(e,r){const i=this.state.contentCamera.eye,n=bLt,s=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(i,Cx,r),this.renderCoordsHelper.fromRenderCoords(s.renderLocation,Ax,r),Cx[0]<Ax[0]?(n[0]=Cx[0],n[2]=Ax[0]):(n[0]=Ax[0],n[2]=Cx[0]),Cx[1]<Ax[1]?(n[1]=Cx[1],n[3]=Ax[1]):(n[1]=Ax[1],n[3]=Cx[1]),V9(n,e)}};u([d({constructOnly:!0})],w0.prototype,"state",void 0),u([d({constructOnly:!0})],w0.prototype,"centerOnSurfaces",void 0),u([d({constructOnly:!0})],w0.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],w0.prototype,"scheduler",void 0),u([d({constructOnly:!0})],w0.prototype,"surface",void 0),u([d({readOnly:!0})],w0.prototype,"updating",void 0),w0=u([$("esri.views.3d.support.SurfaceGeometryUpdates")],w0);const vLt={},Cx=P(),Ax=P(),bLt=td();let Ac=class extends be{constructor(e){super(e),this._handles=new qr,this._tmpRay=Do(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new S_({renderPointOfView:wLt},this),this.renderPointOfView=P(),this._pois=new Array,this._debugCenters=new Map}initialize(){var h;const{state:e,basemapTerrain:r,renderCoordsHelper:i,map:n}=this.view;this._surfaceIntersector=Pp(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=ba.MIN,this._contentIntersector=Pp(e.viewingMode);const s=()=>this._estimateSurfaceAltitudeAtCenter(),o=this.view.resourceController.scheduler,a=(h=this.view.basemapTerrain)==null?void 0:h.elevationQueryCache,l={state:e,scheduler:o,surface:r,renderCoordsHelper:i};this._set("centerOnSurfaceInfrequent",new Vd({...l,task:St.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:s})),this._set("centerOnSurfaceFrequent",new Vd({...l,task:St.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:s})),this._set("centerOnContent",new Vd({...l,task:St.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new bf({...l,cache:a,task:St.POINT_OF_INTEREST_INFREQUENT,map:n})),this._set("surfaceGeometryUpdates",new w0({...l,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new gLt({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:i})),this._set("surfaceOrigin",new b0({cache:a,view:this.view})),this._set("focus",new pg({state:e,scheduler:o,surface:r,renderCoordsHelper:i,centerOnSurface:this.centerOnSurfaceInfrequent,estimateSurfaceIntersectionAtRenderPoint:(p,f)=>this._estimateSurfaceIntersectionAtRenderPoint(p,this.view.state.contentCamera,f)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus);const c=this.view.graphics;this._debugCenters.set(this.centerOnContent,new yA(c,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new yA(c,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new yA(c,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new yA(c,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new yA(c,"green","Focus")),this._handles.add([ne(()=>e.contentCamera,p=>this._cameraChanged(p),Zr),ne(()=>r.extent,()=>this._updateCenterPointsOfInterest()),fo(()=>!r.updating,()=>this._updateCenterPointsOfInterest(),Zr),Yn(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),Yn(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),fo(()=>Qr.SHOW_POI,p=>this._setDebug(p),Vt)]),this._cameraChanged(this.view.state.contentCamera);for(const p of this._pois)p.runTask()}destroy(){this._setDebug(!1),this._handles.destroy(),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){var e;return!(!((e=this.surfaceGeometryUpdates)!=null&&e.updating)&&!this._pois.some(r=>r.updating))}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this._centerRay;return R(e)||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,ZE,TLt)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(ZE):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this._centerRay;if(R(e))return this._surfaceAltitudeAtCenter;const r=e.origin,i=me(ZE,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.contentCamera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,r,i),this._surfaceIntersector.results.min.getIntersectionPoint(ZE)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(ZE)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,r,i){const n=fle(r,e,xLt);if(R(n))return null;const s=n.origin,o=me(ZE,n.origin,n.direction);return this._surfaceIntersector.resetWithRay(n,r),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,s,o),this._surfaceIntersector.results.min.getIntersectionPoint(i)?i:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const r=e.eye;Hl(this.renderPointOfView,r)||this._set("renderPointOfView",ce(this._propertiesPool.get("renderPointOfView"),r))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(r=>r.hide()),void this._handles.remove("debug");for(const r of this._pois)this._handles.add(ne(()=>r.renderLocation,i=>{var n;return(n=this._debugCenters.get(r))==null?void 0:n.show(i,r.renderCoordsHelper.spatialReference)},Vt),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};u([d({readOnly:!0})],Ac.prototype,"centerOnContent",void 0),u([d({readOnly:!0})],Ac.prototype,"centerOnSurfaceFrequent",void 0),u([d({readOnly:!0})],Ac.prototype,"centerOnSurfaceInfrequent",void 0),u([d({readOnly:!0})],Ac.prototype,"cameraOnSurface",void 0),u([d({readOnly:!0})],Ac.prototype,"focus",void 0),u([d({readOnly:!0})],Ac.prototype,"renderPointOfView",void 0),u([d({readOnly:!0})],Ac.prototype,"surfaceOrigin",void 0),u([d({readOnly:!0})],Ac.prototype,"contentGeometryUpdates",void 0),u([d({readOnly:!0})],Ac.prototype,"surfaceGeometryUpdates",void 0),u([d({constructOnly:!0})],Ac.prototype,"view",void 0),u([d({readOnly:!0})],Ac.prototype,"updating",null),Ac=u([$("esri.views.3d.support.PointsOfInterest")],Ac);const wLt=Array,ZE=P(),xLt=Do(),TLt={exclude:new Set([Y1])};let SLt=class{constructor(e){this._store=e}destroy(){this._store.destroy()}get(e){return this._store.get(e)}put(e,r){this._store.put(e,r,r.values.byteLength+256)}},ELt=class{constructor(e,r,i,n){this._hasNoDataValues=null,this._minValue=null,this._maxValue=null,"pixelData"in e?(this.values=e.pixelData,this.width=e.width,this.height=e.height,this.noDataValue=e.noDataValue):(this.values=e,this.width=r,this.height=i,this.noDataValue=n)}get hasNoDataValues(){if(R(this._hasNoDataValues)){const e=this.noDataValue;this._hasNoDataValues=this.values.includes(e)}return this._hasNoDataValues}get minValue(){return this._ensureBounds(),this._minValue}get maxValue(){return this._ensureBounds(),this._maxValue}_ensureBounds(){if(v(this._minValue))return;const{noDataValue:e,values:r}=this;let i=1/0,n=-1/0,s=!0;for(const o of r)o===e?this._hasNoDataValues=!0:(i=o<i?o:i,n=o>n?o:n,s=!1);s?(this._minValue=0,this._maxValue=0):(this._minValue=i,this._maxValue=n>-3e38?n:0)}},eUe=class{constructor(e,r,i,n,s={}){this._mainMethod=r,this._transferLists=i,this._listeners=[],this._promise=wAe(e,{...s,schedule:n}).then(o=>{if(this._thread===void 0){this._thread=o,this._promise=null,s.hasInitialize&&this.broadcast({},"initialize");for(const a of this._listeners)this._connectListener(a)}else o.close()}),this._promise.catch(o=>re.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${e} worker: ${o}`))}on(e,r){const i={removed:!1,eventName:e,callback:r,threadHandle:null};return this._listeners.push(i),this._connectListener(i),am(()=>{i.removed=!0,Pie(this._listeners,i),this._thread&&v(i.threadHandle)&&i.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null}invoke(e,r){return this.invokeMethod(this._mainMethod,e,r)}invokeMethod(e,r,i){if(this._thread){const n=this._transferLists[e],s=n?n(r):[];return this._thread.invoke(e,r,{transferList:s,signal:i})}return this._promise?this._promise.then(()=>(lr(i),this.invokeMethod(e,r,i))):Promise.reject(null)}broadcast(e,r){return this._thread?Promise.all(this._thread.broadcast(r,e)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(e,r)):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then(r=>{e.removed||(e.threadHandle=r)})}},z1e=class extends eUe{constructor(e=null){super("LercWorker","_decode",{_decode:r=>[r.buffer]},e,{strategy:"dedicated"}),this.schedule=e,this.ref=0}decode(e,r,i){return e&&e.byteLength!==0?this.invoke({buffer:e,options:r},i):Promise.resolve(null)}release(){--this.ref<=0&&(sL.forEach((e,r)=>{e===this&&sL.delete(r)}),this.destroy())}};const sL=new Map;function CLt(t=null){let e=sL.get(t);return e||(v(t)?(e=new z1e(r=>t.immediate.schedule(r)),sL.set(t,e)):(e=new z1e,sL.set(null,e))),++e.ref,e}var Ru,V1e,B1e;(function(t){t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(Ru||(Ru={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.OUTLINE=2]="OUTLINE",t[t.LINE=3]="LINE",t[t.ICON=4]="ICON",t[t.CIRCLE=5]="CIRCLE",t[t.TEXT=6]="TEXT",t[t.TILEINFO=7]="TILEINFO"}(V1e||(V1e={})),function(t){t[t.PAINTER_CHANGED=0]="PAINTER_CHANGED",t[t.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",t[t.LAYER_CHANGED=2]="LAYER_CHANGED",t[t.LAYER_REMOVED=3]="LAYER_REMOVED",t[t.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(B1e||(B1e={}));let ALt=class{constructor(e){this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}},jQt=class{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}};function HQt(t,e,r,i,n,s){const o=r-n;if(o>=0)return(e>>o)+(i-(s<<o))*(t>>o);const a=-o;return e-(s-(i<<a))*(t>>a)<<a}let qQt=class{constructor(e,r,i){this._rows=Math.ceil(r/i),this._columns=Math.ceil(e/i),this._cellSize=i,this.cells=new Array(this._rows);for(let n=0;n<this._rows;n++){this.cells[n]=new Array(this._columns);for(let s=0;s<this._columns;s++)this.cells[n][s]=[]}}getCell(e,r){const i=Math.min(Math.max(Math.floor(r/this._cellSize),0),this._rows-1),n=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[i]&&this.cells[i][n]||null}getCellSpan(e,r,i,n){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(n/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}};function RLt(t,e,r,i,n,s){const o=e[i++];for(let a=0;a<o;a++){const l=new ALt(s);l.xTile=e[i++],l.yTile=e[i++],l.hash=e[i++],l.priority=e[i++];const c=e[i++];for(let f=0;f<c;f++){const m=e[i++],g=e[i++],_=e[i++],b=e[i++],w=!!e[i++],x=e[i++],T=r[i++],E=r[i++],C=e[i++],A=e[i++];l.colliders.push({xTile:m,yTile:g,dxPixels:_,dyPixels:b,hard:w,partIndex:x,width:C,height:A,minLod:T,maxLod:E})}const h=t[i++];for(let f=0;f<h;f++)l.textVertexRanges.push([t[i++],t[i++]]);const p=t[i++];for(let f=0;f<p;f++)l.iconVertexRanges.push([t[i++],t[i++]]);n.push(l)}return i}function XQt(t,e,r){for(const[i,n]of t.symbols)OLt(t,e,r,n,i)}function OLt(t,e,r,i,n){const s=t.layerData.get(n);if(s.type===Ru.SYMBOL){for(const o of i){const a=o.unique;let l;if(o.selectedForRendering){const c=a.parts[0],h=c.startOpacity,p=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&p===0;const f=r?Math.floor(127*h)|p<<7:p?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of o.iconVertexRanges)for(let p=c;p<c+h;p+=4)s.iconOpacity[p/4]=l;if(o.selectedForRendering){const c=a.parts[1],h=c.startOpacity,p=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&p===0;const f=r?Math.floor(127*h)|p<<7:p?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of o.textVertexRanges)for(let p=c;p<c+h;p+=4)s.textOpacity[p/4]=l}s.lastOpacityUpdate=e,s.opacityChanged=!0}}let k7=class{constructor(e,r){this.layerUIDs=[],this.isDestroyed=!1,this._data=e,this.memoryUsed=e.byteLength;let i=1;const n=new Uint32Array(e);this.layerUIDs=[];const s=n[i++];for(let o=0;o<s;o++)this.layerUIDs[o]=n[i++];this.bufferDataOffset=i,r&&(this.layer=r.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return R(this._data)}get offset(){return this.bufferDataOffset}destroy(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}prepareForRendering(e){R(this._data)||(this.doPrepareForRendering(e,this._data,this.bufferDataOffset),this._data=null)}},MLt=class extends k7{constructor(e,r){super(e,r),this.type=Ru.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const i=new Uint32Array(e);let n=this.bufferDataOffset;this.lineIndexStart=i[n++],this.lineIndexCount=i[n++];const s=i[n++];if(s>0){const o=new Map;for(let a=0;a<s;a++){const l=i[n++],c=i[n++],h=i[n++];o.set(l,[c,h])}this.patternMap=o}this.bufferDataOffset=n}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){v(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose(),v(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose(),v(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose(),this.lineVertexArrayObject=null,this.lineVertexBuffer=null,this.lineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(e,r,i){const n=new Uint32Array(r),s=new Int32Array(n.buffer),o=n[i++];this.lineVertexBuffer=Kr.createVertex(e,zr.STATIC_DRAW,new Int32Array(s.buffer,4*i,o)),i+=o;const a=n[i++];this.lineIndexBuffer=Kr.createIndex(e,zr.STATIC_DRAW,new Uint32Array(n.buffer,4*i,a)),i+=a;const l=this.layer.lineMaterial;this.lineVertexArrayObject=new Mp(e,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)}},PLt=class extends k7{constructor(e,r){super(e,r),this.type=Ru.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const i=new Uint32Array(e);let n=this.bufferDataOffset;this.fillIndexStart=i[n++],this.fillIndexCount=i[n++],this.outlineIndexStart=i[n++],this.outlineIndexCount=i[n++];const s=i[n++];if(s>0){const o=new Map;for(let a=0;a<s;a++){const l=i[n++],c=i[n++],h=i[n++];o.set(l,[c,h])}this.patternMap=o}this.bufferDataOffset=n}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){v(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose(),v(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose(),v(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose(),this.fillVertexArrayObject=null,this.fillVertexBuffer=null,this.fillIndexBuffer=null,v(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose(),v(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose(),v(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose(),this.outlineVertexArrayObject=null,this.outlineVertexBuffer=null,this.outlineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(e,r,i){const n=new Uint32Array(r),s=new Int32Array(n.buffer),o=n[i++];this.fillVertexBuffer=Kr.createVertex(e,zr.STATIC_DRAW,new Int32Array(s.buffer,4*i,o)),i+=o;const a=n[i++];this.fillIndexBuffer=Kr.createIndex(e,zr.STATIC_DRAW,new Uint32Array(n.buffer,4*i,a)),i+=a;const l=n[i++];this.outlineVertexBuffer=Kr.createVertex(e,zr.STATIC_DRAW,new Int32Array(s.buffer,4*i,l)),i+=l;const c=n[i++];this.outlineIndexBuffer=Kr.createIndex(e,zr.STATIC_DRAW,new Uint32Array(n.buffer,4*i,c)),i+=c;const h=this.layer,p=h.fillMaterial,f=h.outlineMaterial;this.fillVertexArrayObject=new Mp(e,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer),this.outlineVertexArrayObject=new Mp(e,f.getAttributeLocations(),f.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)}},ILt=class extends k7{constructor(e,r,i){super(e,r),this.type=Ru.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const n=new Uint32Array(e),s=new Int32Array(e),o=new Float32Array(e);let a=this.bufferDataOffset;this.isIconSDF=!!n[a++];const l=n[a++];for(let f=0;f<l;f++){const m=n[a++],g=n[a++],_=n[a++];this.iconPerPageElementsMap.set(m,[g,_])}const c=n[a++];for(let f=0;f<c;f++){const m=n[a++],g=n[a++],_=n[a++];this.glyphPerPageElementsMap.set(m,[g,_])}const h=n[a++],p=n[a++];this.iconOpacity=new Int32Array(h),this.textOpacity=new Int32Array(p),a=RLt(n,s,o,a,this.symbols,i),this.bufferDataOffset=a}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let e=0;for(const[r,i]of this.iconPerPageElementsMap)e+=i[1];for(const[r,i]of this.glyphPerPageElementsMap)e+=i[1];return e/3}doDestroy(){v(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose(),v(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose(),v(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose(),v(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose(),this.iconVertexArrayObject=null,this.iconVertexBuffer=null,this.iconOpacityBuffer=null,this.iconIndexBuffer=null,v(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose(),v(this.textVertexBuffer)&&this.textVertexBuffer.dispose(),v(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose(),v(this.textIndexBuffer)&&this.textIndexBuffer.dispose(),this.textVertexArrayObject=null,this.textVertexBuffer=null,this.textOpacityBuffer=null,this.textIndexBuffer=null,this.memoryUsed=0}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const e=this.iconOpacity,r=this.iconOpacityBuffer;e.length>0&&e.byteLength===r.size&&r.setSubData(e,0,0,e.length);const i=this.textOpacity,n=this.textOpacityBuffer;i.length>0&&i.byteLength===n.size&&n.setSubData(i,0,0,i.length)}doPrepareForRendering(e,r,i){const n=new Uint32Array(r),s=new Int32Array(n.buffer),o=n[i++];this.iconVertexBuffer=Kr.createVertex(e,zr.STATIC_DRAW,new Int32Array(s.buffer,4*i,o)),i+=o;const a=n[i++];this.iconIndexBuffer=Kr.createIndex(e,zr.STATIC_DRAW,new Uint32Array(n.buffer,4*i,a)),i+=a;const l=n[i++];this.textVertexBuffer=Kr.createVertex(e,zr.STATIC_DRAW,new Int32Array(s.buffer,4*i,l)),i+=l;const c=n[i++];this.textIndexBuffer=Kr.createIndex(e,zr.STATIC_DRAW,new Uint32Array(n.buffer,4*i,c)),i+=c,this.iconOpacityBuffer=Kr.createVertex(e,zr.STATIC_DRAW,this.iconOpacity.buffer),this.textOpacityBuffer=Kr.createVertex(e,zr.STATIC_DRAW,this.textOpacity.buffer);const h=this.layer,p=h.iconMaterial,f=h.textMaterial;this.iconVertexArrayObject=new Mp(e,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer),this.textVertexArrayObject=new Mp(e,f.getAttributeLocations(),f.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)}},$Lt=class extends k7{constructor(e,r){super(e,r),this.type=Ru.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const i=new Uint32Array(e);let n=this.bufferDataOffset;this.circleIndexStart=i[n++],this.circleIndexCount=i[n++],this.bufferDataOffset=n}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){v(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose(),v(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose(),v(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose(),this.circleVertexArrayObject=null,this.circleVertexBuffer=null,this.circleIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(e,r,i){const n=new Uint32Array(r),s=new Int32Array(n.buffer),o=n[i++];this.circleVertexBuffer=Kr.createVertex(e,zr.STATIC_DRAW,new Int32Array(s.buffer,4*i,o)),i+=o;const a=n[i++];this.circleIndexBuffer=Kr.createIndex(e,zr.STATIC_DRAW,new Uint32Array(n.buffer,4*i,a)),i+=a;const l=this.layer.circleMaterial;this.circleVertexArrayObject=new Mp(e,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)}};const eer=!0,ter=32,rer=1.5,j1e=200,LLt=1/ue("mapview-transitions-duration");let DLt=class extends Sn{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}get stage(){return this._stage}set stage(e){var i;if(this._stage===e)return;const r=this._stage;this._stage=e,e?(i=this._stage)!=null&&i.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):r==null||r.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return R(this._transforms)&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.requestRender())}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.opacity=1,this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=qb(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=qb(),this.requestRender()),this._fadeOutResolver.promise}endTransitions(){var e,r;(e=this._fadeInResolver)==null||e.call(this),this._fadeInResolver=null,(r=this._fadeOutResolver)==null||r.call(this),this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0,this.requestRender()}beforeRender(e){this.updateTransitionProperties(e.deltaTime,e.state.scale)}afterRender(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var e;(e=this.parent)==null||e.removeChild(this)}setTransform(e){}processRender(e){this.stage&&this.computedVisible&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(e,r){if(this.fadeTransitionEnabled){const i=this._fadeOutResolver||!this.visible?0:this.opacity,n=this.computedOpacity;if(n===i)this.computedVisible=this.visible;else{const s=e*LLt;this.computedOpacity=n>i?Math.max(i,n-s):Math.min(i,n+s),this.computedVisible=this.computedOpacity>0;const o=i===this.computedOpacity;this.inFadeTransition=!o,o||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}},NLt=class extends DLt{constructor(e,r,i,n,s,o,a=s,l=o){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new cw(e),this.resolution=r,this.x=i,this.y=n,this.width=s,this.height=o,this.rangeX=a,this.rangeY=l}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(e){const r=this.resolution/(e.resolution*e.pixelRatio),i=this.transforms.tileMat3,[n,s]=e.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*r,a=this.height/this.rangeY*r;cD(i,o,0,0,0,a,0,n,s,1),lw(this.transforms.dvs,e.displayViewMat3,i)}},TW=class tUe extends NLt{constructor(e,r,i,n,s,o,a,l=null){super(e,r,i,n,s,o,4096,4096),this._memCache=l,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.layerCount=0,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.invalidating=!1,this.parentTile=null,this.childrenTiles=new Set,this._processed=!1,this._referenced=1,this.styleRepository=a,this.id=e.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<j1e}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<j1e)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}deleteLayerData(e){let r=!1;for(const i of e)if(this.layerData.has(i)){const n=this.layerData.get(i);this._memoryUsedByLayerData-=n.memoryUsed,n.type===Ru.SYMBOL&&this.symbols.has(i)&&(this.symbols.delete(i),r=!0),n.destroy(),this.layerData.delete(i),this.layerCount--}v(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData),r&&this.emit("symbols-changed"),this.requestRender()}processed(){return this._processed}hasData(){return this.layerCount>0}dispose(){this.status!=="unloaded"&&(rUe.delete(this),tUe._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return--this._referenced==0&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsage(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}changeDataImpl(e){let r=!1;if(e){const{bucketsWithData:i,emptyBuckets:n}=e,s=this._createRenderBuckets(i);if(n&&n.byteLength>0){const o=new Uint32Array(n);for(const a of o)this._deleteLayerData(a)}for(const[o,a]of s)this._deleteLayerData(o),a.type===Ru.SYMBOL&&(this.symbols.set(o,a.symbols),r=!0),this._memoryUsedByLayerData+=a.memoryUsed,this.layerData.set(o,a),this.layerCount++;v(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=!1;for(const[i,n]of this.layerData)n.type===Ru.SYMBOL&&(this._hasSymbolBuckets=!0);r&&this.emit("symbols-changed")}attachWithContext(e){this.stage={context:e,trashDisplayObject(r){r.processDetach()},untrashDisplayObject:()=>!1}}setTransform(e){super.setTransform(e);const r=this.resolution/(e.resolution*e.pixelRatio),i=this.width/this.rangeX*r,n=this.height/this.rangeY*r,s=[0,0];e.toScreen(s,[this.x,this.y]);const o=this.transforms.tileUnitsToPixels;Foe(o),Gz(o,o,s),Uoe(o,o,Math.PI*e.rotation/180),zoe(o,o,[i,n,1])}_createTransforms(){return{dvs:Bc(),tileMat3:Bc(),tileUnitsToPixels:Bc()}}static _destroyRenderBuckets(e){if(!e)return;const r=new Set;e.forEach(i=>{r.has(i)||(i.destroy(),r.add(i))}),e.clear()}_createRenderBuckets(e){const r=new Map,i=new Map;for(const n of e){const s=this._deserializeBucket(n,i);for(const o of s.layerUIDs)r.set(o,s)}return r}_deserializeBucket(e,r){let i=r.get(e);if(i)return i;switch(new Uint32Array(e)[0]){case Ru.FILL:i=new PLt(e,this.styleRepository);break;case Ru.LINE:i=new MLt(e,this.styleRepository);break;case Ru.SYMBOL:i=new ILt(e,this.styleRepository,this);break;case Ru.CIRCLE:i=new $Lt(e,this.styleRepository)}return r.set(e,i),i}_deleteLayerData(e){if(!this.layerData.has(e))return;const r=this.layerData.get(e);this._memoryUsedByLayerData-=r.memoryUsed,r.destroy(),this.layerData.delete(e),this.layerCount--}};const rUe=new Map;function FLt(){rUe.forEach((t,e)=>{console.log(`
${e.key}:`),t[0].forEach(r=>console.log(r)),console.log("========"),t[1].forEach(r=>console.log(r))})}const ser={value:.5,readOnly:!0},kLt={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};let hR=class{constructor(e=0,r=0){this.min=e,this.max=r,this.level=0,this.hasNoDataValues=!1}copyFrom(e){this.min=e.min,this.max=e.max,this.level=e.level,this.hasNoDataValues=e.hasNoDataValues}},ULt=class{constructor(e,r){this.data=e,this.safeWidth=.99999999*(e.width-1),this.dx=(e.width-1)/(r[2]-r[0]),this.dy=(e.width-1)/(r[3]-r[1]),this.x0=r[0],this.y1=r[3]}},zLt=class{constructor(e,r,i){this.type="elevation",this.level=e[0],this.i=e[1],this.j=e[2],this.extent=r,this.samplerData=new ULt(i,r)}computeMinMaxValue(e,r,i,n){n.min=1/0,n.max=-1/0,n.hasNoDataValues=!1;const s=e-this.level;if(s<=0)return n;const o=2**s;if(!(Math.floor(r/o)===this.i&&Math.floor(i/o)===this.j))return n;let a=1/0,l=-1/0;const c=this.samplerData.data.width,h=this.samplerData.data.values,p=.5*pD;let f=(c-1)/o,m=(i-this.j*o)*f,g=(r-this.i*o)*f;if(f<1){const _=Math.floor(m),b=Math.floor(g),w=_+b*c,x=h[w],T=h[w+1],E=h[w+c],C=h[w+c+1];if(x+T+E+C<p){const A=m-_,I=g-b,M=F4(x,T,E,C,A,I),D=F4(x,T,E,C,A+f,I),U=F4(x,T,E,C,A,I+f),z=F4(x,T,E,C,A+f,I+f);return n.min=Math.min(M,D,U,z),n.max=Math.max(M,D,U,z),n}m=_,g=b,f=1}else m=Math.floor(m),g=Math.floor(g),f=Math.ceil(f);for(let _=m;_<=m+f;_++)for(let b=g;b<=g+f;b++){const w=h[_+b*c];w<p?(a=Math.min(a,w),l=Math.max(l,w)):n.hasNoDataValues=!0}return n.min=a,n.max=l,n}};const VLt=.5*pD;function tn(t,e,r){if(R(r))return null;for(const i of r){if(!i)continue;const n=i.safeWidth;let s=_e(i.dy*(i.y1-e),0,n),o=_e(i.dx*(t-i.x0),0,n);const a=Math.floor(s),l=Math.floor(o),c=i.data.width,h=a*c+l,p=i.data.values,f=p[h],m=p[h+1],g=h+c,_=p[g],b=p[g+1];if(f+_+m+b<VLt){s-=a,o-=l;const w=f+(m-f)*o;return w+(_+(b-_)*o-w)*s}}return null}let Ud=class extends be{constructor(e){super(e),this._handles=new qr}initialize(){this._handles.add([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){this._handles=ze(this._handles)}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(r=>{const i=r.layer;if(i.operationalLayerType==="IntegratedMeshLayer"&&this.viewSpatialReference!=null){const n=iUe(i.fullExtent,this.viewSpatialReference);v(n)&&e.push(HL(n))}}),e}};function BLt(t,e){return t===qe.Global?new Xte(e):new Yte(e)}u([d({readOnly:!0})],Ud.prototype,"layerViewsExtent",null),u([d({readOnly:!0})],Ud.prototype,"tiledLayersExtent",null),u([d({readOnly:!0})],Ud.prototype,"stencilEnabledExtents",null),u([d()],Ud.prototype,"viewSpatialReference",void 0),u([d()],Ud.prototype,"tilingScheme",void 0),u([d()],Ud.prototype,"defaultTiledLayersExtent",void 0),u([d({constructOnly:!0})],Ud.prototype,"layers",void 0),u([d({constructOnly:!0})],Ud.prototype,"layerViews",void 0),Ud=u([$("esri.views.3d.terrain.ExtentHelper")],Ud);let Xte=class extends Ud{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?QLe:Kyt}};Xte=u([$("esri.views.3d.terrain.ExtentHelperGlobal")],Xte);let Yte=class extends Ud{_computeLayerViewsExtent(){const e=td(),r=this.viewSpatialReference;this.layerViews.forEach(s=>{const o=s.layer;if(s.isResolved()&&(o.type!=="graphics"||!o.internal)){const a=iUe("fullExtentInLocalViewSpatialReference"in s&&s.fullExtentInLocalViewSpatialReference||s.layer.fullExtent,r);$b(e,a,e)}});const i=lZ(e)?e:null,n=this._get("layerViewsExtent");return AS(i,n)?n:i}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const r=this.viewSpatialReference,i=td();this.layers.forEach(o=>{if(o.loaded&&E$(o)){const a=F7(o,r,qe.Local);if(R(a))return;const{tileInfo:l,fullExtent:c}=a;v(l)&&v(c)&&(jV(o)||e.compatibleWith(l)&&c.spatialReference.equals(e.spatialReference))&&$b(i,c,i)}}),$b(i,this.defaultTiledLayersExtent,i);const n=lZ(i)?i:null,s=this._get("tiledLayersExtent");return AS(n,s)?s:n}};function iUe(t,e){return v(t)&&!t.spatialReference.equals(e)?UAe(t,t.spatialReference,e):t}Yte=u([$("esri.views.3d.terrain.ExtentHelperLocal")],Yte);var vr;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.MAP=1]="MAP"})(vr||(vr={}));const IT=[vr.ELEVATION,vr.MAP];function nUe(){var e;const t=(e=globalThis.require)==null?void 0:e.modules;if(t){const r=Object.keys(t);for(const i of r)i.search(".glsl")!==-1&&delete t[i]}}const jLt=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let Uv,Ec=class extends be{get running(){return this._placementDirty&&(this._drapeSources.size>0||this._view.graphics.length>0||Qr.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this._view.state.isGlobal}get _worldToPCSRatio(){return v(this._spatialReference)&&this._spatialReference.isGeographic&&!this._view.state.isLocal?ii(this._spatialReference).metersPerDegree:1}get _view(){return this.surface.view}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get hasHighlights(){return this.renderer.hasHighlights}get rendersOccluded(){return this.renderer.rendersOccluded}constructor(e){super(e),this._handles=new qr,this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._hasUnusedRenderTargets=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=ue("esri-mobile")?2048:4096,this._animationTimeLast=0}initialize(){var r;const e=this._view;this.renderer=new _f({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference}),this._groundIntersector=Pp(this._view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this._handles.add([this.renderer.events.on("has-highlights",()=>{this.setDrawTexturesDirty(),this.notifyChange("hasHighlights")}),this.renderer.events.on("has-water",i=>{var n;return(n=e._stage)==null?void 0:n.renderer.setParameters({hasOverlayWater:i})}),this.renderer.events.on("renders-occluded",()=>{this.setDrawTexturesDirty(),this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",()=>this.setDrawTexturesDirty()),this.renderer.events.on("textures-disposed",()=>this.updateOverlayResult()),ne(()=>{var i,n,s;return[(i=e.pointsOfInterest)==null?void 0:i.renderPointOfView,(s=(n=e.pointsOfInterest)==null?void 0:n.centerOnSurfaceFrequent)==null?void 0:s.location]},()=>this.setPlacementDirty()),ne(()=>{var i,n;return[(i=e.state)==null?void 0:i.pixelRatio,(n=e.state)==null?void 0:n.contentPixelRatio]},()=>this.setPlacementDirty(),Zr),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),e.resourceController.scheduler.registerTask(St.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",i=>{this._updateOverlays(jl,i,Gn.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays,Gn.BACKGROUND,i.pixelRatio)})]),(r=e._stage)==null||r.renderer.setParameters({renderOverlay:i=>{this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays&&(this._dispatchAnimationUpdate(i),this._drawOverlayTextures(this.renderer.overlays,Gn.UPDATE)),this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}})}destroy(){this._handles=ze(this._handles),v(Uv)&&(Uv.hide(),Uv=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const r=this._view.renderSpatialReference;v(e)&&v(r)?(this._renderSR=r,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new Qb(-20037508342787e-6,20037508342787e-6):new Qb(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}get gpuMemoryUsage(){return this.renderer.gpuMemoryUsage}registerDrapeSource(e,r,i){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const n=this.renderer.createDrapeSourceRenderer(e,r,i);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),n}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,Th)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&v(e.setDrapingExtent)&&v(this._spatialReference)&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}updateOverlayResult(){var e;(e=this._view._stage)==null||e.renderer.setParameters({overlays:this.renderer.overlays})}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(e){return this._updateOverlays(e,this._view.state.contentCamera,Gn.UPDATE)}_updateOverlays(e,r,i){if(!this._spatialReference)return za.YIELD;const n=this._computeOverlayResolution(r);this._computeOverlayExtents(r,n,Wy);const s=Bh(Wy.inner)/Bh(Wy.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const o=this._updateOverlay(dn.INNER,Wy.inner,n,1*Wy.pixelRatioAdjustment,Wy.mapUnitsPerPixel),a=this._updateOverlay(dn.OUTER,Wy.outer,n,s*Wy.pixelRatioAdjustment,Wy.mapUnitsPerPixel);o!==Tg.EXTENT&&a!==Tg.EXTENT||(this._drapeSources.forEach(l=>this._updateDrapeSourceExtent(l)),this.surface.updateTileOverlayParams(i)),o===Tg.NONE&&a===Tg.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1,e.madeProgress()}_computeOverlayResolution(e){const r=this._view.state.contentPixelRatio,i=e.fullWidth/e.pixelRatio*r,n=e.fullHeight/e.pixelRatio*r;return Math.min(fO(Math.max(i,n)+256),this._maxResolution)}_updateOverlay(e,r,i,n,s){if(this.renderer.overlays.length===0)return Tg.NONE;const o=this.renderer.overlays[e],a=o.mapUnitsPerPixel;if(o.mapUnitsPerPixel=s,o.pixelRatio=n,GLt(r,o.extent)&&i===o.resolution)return a===s?Tg.NONE:Tg.RERENDER_ONLY;w_(o.extent,r),o.resolution=i;const l=One(o.extent);return o.renderLocalOrigin=Q$(l[0],l[1],0,"OV_"+this._latestOriginId++),Tg.EXTENT}setTileParameters(e){const r=e.renderData.overlay;if(this.renderer.overlays.length>0){const i=this.renderer.overlays[dn.INNER],n=this.renderer.overlays[dn.OUTER],s=e.extent;this._rectInsideRect(i.extent,s)||this._rectanglesOverlap(s,i.extent)||this._rectanglesOverlap(s,n.extent)?(this._setTileOverlayData(s,dn.INNER,r),this._setTileOverlayData(s,dn.OUTER,r)):(this._clearTileOverlayData(dn.INNER,r),this._clearTileOverlayData(dn.OUTER,r))}else this._clearTileOverlayData(dn.INNER,r),this._clearTileOverlayData(dn.OUTER,r)}overlayPixelSizeInMapUnits(e){if(this.renderer.overlays.length===0)return 0;const r=this.renderer.overlays[dn.INNER],i=this.renderer.overlays[dn.OUTER],n=this._pointIsInExtent(e,r.extent)?r:i;return(n.extent[2]-n.extent[0])/n.resolution}_setTileOverlayData(e,r,i){if(this.renderer.overlays.length===0)return;const n=this.renderer.overlays[r].extent,s=Bh(n),o=cm(n);let a=e[0];if(this._longitudeCyclical){a=this._longitudeCyclical.minimalMonotonic(n[0],a);const l=this._longitudeCyclical.minimalMonotonic(n[0],e[2]);a>l&&(a=l-(e[2]-e[0]))}i.setScale(r,Bh(e)/s,cm(e)/o),i.setOffset(r,(a-n[0])/s,(e[1]-n[1])/o)}_clearTileOverlayData(e,r){r.setScale(e,-1,-1),r.setOffset(e,-1,-1)}async reloadShaders(){nUe(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask(jl)}_dispatchAnimationUpdate(e){const r=e-this._animationTimeLast;if(r>=this.surface.view._stage.renderer.animationTimestep||v(this._view.state.forcedAnimationTime)||this._drawTexturesDirty||this._drawTexturesAnimateDirty){const i=r/this.surface.view._stage.renderer.animationTimeDilation,n=new _4e(this._view.state.camera,i,this._view.state.forcedAnimationTime);this.renderer.updateAnimation(n)&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e}}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0,this._view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(e,r,i,n){const s=this._view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,WLt,r,i);if(R(s))return!1;const o=s.origin,a=me(hk,s.origin,s.direction);return this._groundIntersector.reset(o,a,e),this._groundIntersector.intersect([]),this._view.basemapTerrain.intersect(this._groundIntersector,null,o,a),this._groundIntersector.results.min.getIntersectionPoint(n)}_findHorizonBasedPointOfInterest(e,r){let i=.5;const n=.55,s=this._view.renderCoordsHelper.getAltitude(e.eye),o=this._view.pointsOfInterest.centerOnSurfaceFrequent,a=1e-5,l=_e(o.estimatedSurfaceAltitude,e.aboveGround?-1/0:s+a,e.aboveGround?s-a:1/0),c=e.aboveGround;if(this._view.viewingMode==="global"){const h=hk;I3(NB(FB,ii(this._view.spatialReference).radius+l),nd(e.eye,e.viewForward),h),ge(h,h,e.eye);const p=ew.normalize(xLe(e.viewForward,h,e.viewRight))/e.fovY+.5,f=p<=0||p>=1?.5:n;i=c?f*p:p+f*(1-p)}else{const h=.5*Math.PI-Math.acos(-e.viewForward[2]),p=Math.tan(h),f=Zt(0,p,1,0),m=qh(f,f,e.projectionMatrix)[1],g=_e(.5+.5*m,0,1);i=g===1||g===0?.5:c?g*n:1-(1-g)*n}return!!this._intersectGroundFromView(e,.5,i,r)&&bne(r,e.eye)<o.distance*o.distance}_computeOverlayExtents(e,r,i){const n=this._view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s=P();this._findHorizonBasedPointOfInterest(e,s)||ce(s,n);const o=Math.max(.1,Pi(e.eye,s)),a=gw(this._view.renderCoordsHelper,n,e.eye),l=Math.PI/2-Math.abs(a-Math.PI/2);Qr.OVERLAY_SHOW_CENTER?(R(Uv)&&(Uv=new yA(this._view.graphics,"red")),Uv.show(s,this._renderSR)):v(Uv)&&Uv.hide(),this._overlaySREqualsRenderSR||zo(s,this._renderSR,s,this._spatialReference);const c=this.surface.extent,h=!this._isSpherical&&v(this._spatialReference)&&this._spatialReference.isGeographic,p=h&&v(this._spatialReference)?1/ii(this._spatialReference).metersPerDegree:1,f=this._view.state.contentPixelRatio,m=e.perScreenPixelRatio/f*o*p;i.mapUnitsPerPixel=m/this._worldToPCSRatio;let g=r*m/2,_=!1,b=h?90:1/0;this._isSpherical&&v(c)&&v(this._spatialReference)&&(this._spatialReference.isWebMercator?(g/=Math.cos(q8(s[1])),b=c[3]):(_=!0,g/=ii(this._spatialReference).metersPerDegree,b=90),g>=b&&(g=b,s[1]=0,this._spatialReference.isWebMercator&&(s[0]=0)));let w=1;_&&(w=1/Math.max(.2,Math.cos(Math.abs(Xt(s[1])))),g*w>180&&(w=180/g),i.mapUnitsPerPixel*=w);const x=Math.log(2)/12;g=Math.exp(Math.round(Math.log(g)/x)*x);const T=g*w,E=32,C=.5*r/(E*T),A=.5*r/(E*g);s[0]=Math.round(s[0]*C)/C,s[1]=Math.round(s[1]*A)/A;const I=i.inner;I[0]=s[0]-T,I[1]=s[1]-g,I[2]=s[0]+T,I[3]=s[1]+g,this._isSpherical&&this._shiftExtentToFitBounds(I,1/0,b);const M=i.outer;if(6*T>Bh(c))w_(M,c);else if(l<=.25*Math.PI)M[0]=I[0]-T,M[1]=I[1]-g,M[2]=I[2]+T,M[3]=I[3]+g;else{zo(e.eye,this._renderSR,hk,this._spatialReference),jh(Rx,s,hk);let U=-Math.atan2(Rx[1],Rx[0])+.125*Math.PI;U<0&&(U+=2*Math.PI);const z=Math.floor(U/(.25*Math.PI));h3(Rx,jLt[z],2*g),Rx[0]*=w,Rx[2]*=w,wne(M,I,Rx)}if(this._isSpherical)M[0]=this._longitudeCyclical.clamp(M[0]),M[2]=this._longitudeCyclical.clamp(M[2]),M[1]=Math.max(M[1],-b),M[3]=Math.min(M[3],b);else{const U=uZ(I,c,HLt),z=uZ(M,c,qLt);cZ(U,z)&&(M[2]=M[0],M[3]=M[1])}const D=Math.abs(I[2]-I[0])/r;i.mapUnitsPerPixel=Math.max(i.mapUnitsPerPixel,D),i.pixelRatioAdjustment=i.mapUnitsPerPixel/D}_drawOverlayTextures(e,r,i=this._view.state.contentPixelRatio){if(e.length===0||!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return;const n=this._drawTexturesDirty;this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1;const s=this._drawOverlay(e[dn.INNER],i),o=this._drawOverlay(e[dn.OUTER],i);s!==jO.CHANGED&&o!==jO.CHANGED||this.surface.updateTileOverlayParams(Gn.UPDATE),this._collectUnusedRenderTargetMemory(),this.updateOverlayResult(),n?(this.surface.requestRender(r),r===Gn.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(Gn.BACKGROUND)}_drawOverlay(e,r){return this._longitudeCyclical?e.setupGeometryViewsCyclical(this._longitudeCyclical):e.setupGeometryViewsDirect(),e.draw(this.renderer,r)}_collectUnusedRenderTargetMemory(){if(this._hasUnusedRenderTargets=!1,this.renderer.hasOverlays){const e=performance.now();this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory(e)}}_rectanglesOverlap(e,r){return!R(e)&&(this._longitudeCyclical?(this._longitudeCyclical.contains(r[0],r[2],e[0])||this._longitudeCyclical.contains(r[0],r[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],r[0]))&&!(e[1]>r[3]||e[3]<r[1]):V9(e,r))}_rectInsideRect(e,r){return!R(r)&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],r[0])&&this._longitudeCyclical.contains(e[0],e[2],r[2])&&r[1]>e[1]&&r[3]<e[3]:cZ(e,r))}_pointIsInExtent(e,r){if(this._longitudeCyclical)return this._longitudeCyclical.contains(r[0],r[2],e.x)&&e.y>=r[1]&&e.y<=r[3];const i=e.x,n=e.y;return i>r[0]&&i<r[2]&&n>r[1]&&n<r[3]}_shiftExtentToFitBounds(e,r,i){let n=0,s=0;e[0]<-r?n=e[0]+r:e[2]>r&&(n=r-e[2]),e[1]<-i?s=e[1]+i:e[3]>i&&(s=i-e[3]),tz(e,n,s)}get test(){return{renderer:this.renderer,update:()=>this.runTask(jl)}}};function GLt(t,e){const i=Qr.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(t[2]-t[0],t[3]-t[1],e[2]-e[0],e[3]-e[1]);return Math.abs(e[0]-t[0])<=i&&Math.abs(e[1]-t[1])<=i&&Math.abs(e[2]-t[2])<=i&&Math.abs(e[3]-t[3])<=i}u([d()],Ec.prototype,"_spatialReference",void 0),u([d({readOnly:!0})],Ec.prototype,"running",null),u([d()],Ec.prototype,"_placementDirty",void 0),u([d()],Ec.prototype,"_contentUpdated",void 0),u([d()],Ec.prototype,"_isSpherical",null),u([d()],Ec.prototype,"_worldToPCSRatio",null),u([d({autoDestroy:!0})],Ec.prototype,"renderer",void 0),u([d({constructOnly:!0})],Ec.prototype,"surface",void 0),u([d()],Ec.prototype,"suspended",null),u([d()],Ec.prototype,"updating",null),u([d({type:Boolean})],Ec.prototype,"hasHighlights",null),u([d({type:Boolean})],Ec.prototype,"rendersOccluded",null),Ec=u([$("esri.views.3d.terrain.OverlayManager")],Ec);const Rx=pr(),hk=P(),Wy={inner:Kt(),outer:Kt(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},HLt=Kt(),qLt=Kt(),WLt=Do();var Tg;(function(t){t[t.NONE=0]="NONE",t[t.EXTENT=1]="EXTENT",t[t.RERENDER_ONLY=2]="RERENDER_ONLY"})(Tg||(Tg={}));let sUe=class Zte{constructor(e,r){this._factoryCallback=e,this._lengthCallback=r,this._pool=new Map}acquire(e){if(!Zte.test.disabled){const r=this._pool.get(e);if(r&&r.length!==0)return r.pop()}try{return this._factoryCallback(e)}catch(r){const i=window.performance&&window.performance.memory;let n="";throw i&&(n=`
  totalJSHeapSize: ${i.totalJSHeapSize}, usedJSHeapSize: ${i.usedJSHeapSize}, jsHeapSizeLimit: ${i.jsHeapSizeLimit}`),console.log("Array allocation of size "+e+" failed: "+r+n),r}}release(e){if(Zte.test.disabled)return;const r=this._lengthCallback(e);let i=this._pool.get(r);i||(i=new Wt({shrink:!0}),this._pool.set(r,i)),i.push(e)}clear(){this._pool.clear()}get test(){return{size:this._pool.size}}};sUe.test={disabled:!1};let XLt=class{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=ki(),this.indexCount=0,this.numVerticesPerSide=0,this.uvRange=[0,0,1,1],this.outerEdges=[null,null,null,null],this.innerEdges=[null,null,null,null]}},G1e=class{constructor(e,r,i,n,s){this.attributes=e,this.localOrigin=r,this.index0=i,this.stride=n,this.count=s}getVertexIndex(e){return this.getAttributeIndex(e)}getAttributeIndex(e){return Re(0<=e&&e<this.count),this.index0+this.stride*e}_getVertexRaw(e,r){this.attributes.position.getVec(e,r)}_getNormalRaw(e,r){this.attributes.normalCompressed.getVec(e,r)}getVertexPos(e,r){this._getVertexRaw(this.getAttributeIndex(r),e),me(e,e,this.localOrigin)}getNormal(e,r){const i=Ne();this._getNormalRaw(this.getAttributeIndex(r),i),KLt(e,i)}_setNormal(e,r,i,n){GD(this.attributes.normalCompressed,e,r,i,n)}_setUV(e,r,i){Hu(this.attributes.uv0,e,r,i)}setNormalFromValues(e,r,i,n){this._setNormal(this.getAttributeIndex(e),r,i,n)}setVertexFromValuesRawPositionUV(e,r,i,n,s,o){const a=this.getAttributeIndex(e);this.attributes.position.setValues(a,r,i,n),this._setUV(a,s,o)}setVertexFromValuesRawPositionUVNormal(e,r,i,n,s,o,a,l,c){const h=this.getAttributeIndex(e);this.attributes.position.setValues(h,r,i,n),this._setUV(h,s,o),this._setNormal(h,a,l,c)}};const YLt=mn().vec3f(O.POSITION).vec2i16(O.UV0).vec2i16(O.NORMALCOMPRESSED,{glNormalized:!0}),xce=new sUe(t=>YLt.createBuffer(t),t=>t.count);function ZLt(){xce.clear()}function oUe(t){return xce.acquire(t)}function JLt(t){xce.release(t.vertexAttributes),t.vertexAttributes=null,t.indices=null}function GD(t,e,r,i,n){const s=1/(Math.abs(r)+Math.abs(i)+Math.abs(n)),o=r*s,a=i*s,l=n<=0?(o>=0?1:-1)*(1-Math.abs(a)):o,c=n<=0?(a>=0?1:-1)*(1-Math.abs(o)):a;t.setValues(e,q1e(l),q1e(c))}function KLt(t,e){const r=W1e(e[0]),i=W1e(e[1]),n=1-Math.abs(r)-Math.abs(i);t[2]=n,n<0?(t[0]=(r>=0?1:-1)*(1-Math.abs(i)),t[1]=(i>=0?1:-1)*(1-Math.abs(r))):(t[0]=r,t[1]=i),we(t,t)}const H1e=16384;function Hu(t,e,r,i){t.setValues(e,r*H1e,i*H1e)}function q1e(t){return _e(Math.round(32767*t),-32767,32767)}function W1e(t){return _e(t/32767,-1,1)}function Xl(t,e,r,i){t<i[0]?i[0]=t:t>i[3]&&(i[3]=t),e<i[1]?i[1]=e:e>i[4]&&(i[4]=e),r<i[2]?i[2]=r:r>i[5]&&(i[5]=r)}let QLt=class{constructor(){this.sinLonLUT=new Array(xI+1),this.cosLonLUT=new Array(xI+1),this.sinLatLUT=new Array(xI+1),this.cosLatLUT=new Array(xI+1)}update(e,r,i){const n=r[0],s=r[2];for(let o=0;o<=e;o++){const a=o/e,l=n*(1-a)+s*a;this.sinLonLUT[o]=Math.sin(l),this.cosLonLUT[o]=Math.cos(l);const c=i(a);this.sinLatLUT[o]=Math.sin(c),this.cosLatLUT[o]=Math.cos(c)}}},dk=class{constructor(){this.cornerTiles=[null,null,null,null],this.cornerTileSamplerVersions=[-1,-1,-1,-1]}},eDt=class{constructor(){this.cornerNeighborData=[new dk,new dk,new dk,new dk],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1],this.cornerPeerNeighbors=[null,null,null,null]}},tDt=class{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.clippingArea=null,this.wireframe=!1,this.shading=!1,this.samplerDataVersion=0,this.neighborData=new eDt}},aUe=class jU{constructor(e){this._getFadeDuration=e,this._fadeStart=0,this._delayedTime=0}clear(){this._current=ze(this._current),this._next=ze(this._next),this._waiting=ze(this._waiting),this._delayed=ze(this._delayed)}get current(){if(R(this._current))return null;if(!this._isFadingEnabled){const r=this._delayed||this._waiting||this._next||this._current;r!==this._current&&(this._current=null,this.clear(),this._current=r)}let e=jU.test.fadeMoment;if(v(this._delayed)&&(e=e||performance.now(),e>=this._delayedTime&&(this._push(this._delayed,c_.Immediate),this._delayed=null)),v(this._next)){e=e||performance.now();const r=this._fadeDuration,i=v(this._current)&&this._next.texture===this._current.texture,n=this._next.type!==js.FADING,s=e-this._fadeStart>=r;(i||n||s)&&(ze(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(e))}return this._current}get next(){return this._next}get fadeFactor(){if(R(this._next))return 1;const e=jU.test.fadeMoment||performance.now(),r=Math.max(0,e-this._fadeStart),i=this._fadeDuration;return r>i?0:1-r/i}get isFading(){return v(this._next)||v(this._delayed)}push(e,r=c_.Immediate){this._delayed=ze(this._delayed),this._push(e,r)}_push(e,r){if(this._isFadingEnabled||this.clear(),R(this._current))return void(this._current=e);const i=jU.test.fadeMoment||performance.now();return r!==c_.Immediate?(this._delayed=e,void(this._delayedTime=i+r)):R(this._next)?(this._next=e,void(this._fadeStart=this._alignFadeStart(i))):void(R(e)||(ze(this._waiting),this._waiting=e))}get _fadeDuration(){return R(this._waiting)?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(e){const r=this._getFadeDuration();return e+r-e%r}get _isFadingEnabled(){return this._getFadeDuration()>0}};var c_;aUe.test={fadeMoment:0},function(t){t[t.Immediate=0]="Immediate",t[t.Delayed=5e3]="Delayed"}(c_||(c_={}));var e3;(function(t){t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT",t[t.NONE=0]="NONE",t[t.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(e3||(e3={}));let lUe=class{constructor(){this._queue=new Wt,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(e){this._queue.clear(),this._queue.push(e),this._last=void 0}reset(e=null){this._queue.clear(),v(e)&&this._queue.pushArray(e),this._last=void 0}skipSubtree(){this._last=void 0}next(){var r;const e=(r=this._last)==null?void 0:r.children;return e&&e[0]&&this._queue.pushArray(e),this._last=this._queue.pop(),this._last}},rDt=class{constructor(){this._q=new Wt}get done(){return this._q.length===0}reset(e){if(this._q.clear(),!R(e)){this._q.pushArray(e);for(let r=0;r<this._q.length;++r){const i=this._q.data[r];i.isLeaf||this._q.pushArray(i.children)}}}next(){return this._q.pop()}};function oL(t,e,r){if(R(e)||R(e.fullExtent))return!1;const i=e.fullExtent,n=t.extent;if(r){if(n[0]<i.xmin||n[1]<i.ymin||n[2]>i.xmax||n[3]>i.ymax)return!1}else if(i.xmin>n[2]||i.ymin>n[3]||i.xmax<n[0]||i.ymax<n[1])return!1;const s=t.surface.tilingScheme.levels[t.level].scale,o=e.minScale;if(o>0&&s>1.00000001*o)return!1;const a=e.maxScale;return!(a>0&&s<.99999999*a)}function u_(t,e){const r=t.lij,i=e.lij;return r[0]-i[0]||r[1]-i[1]||r[2]-i[2]}function cUe(t,e,r=null){R(r)||r.length===0?t===e3.BACK_TO_FRONT?e.sort(iDt):e.sort(nDt):e.sort((i,n)=>sDt(i,n,t,r))}function iDt(t,e){const r=e.screenDepth-t.screenDepth;if(r!==0)return r;const i=t.lij,n=e.lij;return i[0]-n[0]||i[1]-n[1]||i[2]-n[2]}function nDt(t,e){const r=t.screenDepth-e.screenDepth;if(r!==0)return r;const i=t.lij,n=e.lij;return i[0]-n[0]||i[1]-n[1]||i[2]-n[2]}function uUe(t,e,r){const i=t.screenDepth,n=e.screenDepth;return i<n?-r:i>n?r:u_(t,e)}function sDt(t,e,r,i){return X1e(t,i)===X1e(e,i)?uUe(t,e,r):t?r:-r}function X1e(t,e){for(const r of e)if(t.intersectsExtent(r))return!0;return!1}function oDt(t,e){const r=t.distanceToPOI-e.distanceToPOI;if(r!==0)return r;const i=t.lij,n=e.lij;return i[0]-n[0]||i[1]-n[1]||i[2]-n[2]}function aDt(t,e){const r=t.length;for(let i=0;i<r;++i)t.getItemAt(i).updateDistanceToPOI(e);t.sort(oDt)}function lDt(t,e,r){let i=1,n=0,s=0;for(;t!==e;)if(i*=.5,n*=.5,s*=.5,1&t.lij[2]&&(n+=.5),!(1&t.lij[1])&&(s+=.5),(t=t.parent)==null)throw new Error("tile was not a descendant of upsampleTile");r.init(e,n,s,i)}function cDt(t){for(let e=0;e<t.length;e++){const r=t[e],i=r.parent;if(i)for(let n=0;n<4;n++){const s=i.children[n];if(s&&s!==r)return!0}}return!1}function wer(t,e){if(!t||!e||t[0]===e[0])return!1;const r=t[0]<e[0],i=r?t:e,n=r?e:t,s=1<<n[0]-i[0];return Math.floor(n[1]/s)===i[1]&&Math.floor(n[2]/s)===i[2]}let Tce=class{get updating(){return!!this._tileRequested}init(e,r,i,n){this.tile=e,this._layerIdx=r,this._layerClass=i,this._suspended=n,this._tileLayerInfo=e.getLayerInfo(r,i),this._tileRequested=null;const s=this._findAncestorWithData();this._setUpsampleTile(s)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(e){e!==this._suspended&&(this._suspended=e,e?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const e=this._findAncestorWithData();return this._setUpsampleTile(e),this._requestNext()}dataArrived(e){this._setUpsampleTile(e),this._tileRequested=null,e===this.tile?this.tile.updateRenderData(this._layerClass,js.FADING):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return v(e)?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone(),!!this._tileRequested}_findNextDownload(){const e=this._layerIdx,r=this._layerClass,i=this.tile.surface.layerViewByIndex(e,r),n=Gte(i),{minLevel:s,maxLevel:o}=i.dataLevelRange,a=this._desiredMinLevelDelta,l=this._progressiveLevelModulo+a,c=this._scaleRangeEnabled?oL:()=>!0;let h=this.tile;const p=h.level;let f;const m=this._tileLayerInfo.upsampleInfo,g=v(m)?m.tile.level:-1,_=!!v(m)&&g-p>=a,b=Xs(n,"tilemapCache");for(;h&&c(h,n,!1)&&h.level>=s;){const w=h.level,x=p-w,T=h.layerInfo[r][e];if(T.data&&x>=a){(!_||w>g)&&this._setUpsampleTile(h),T.dataInvalidated&&(f=h);break}if((R(b)||b.getAvailability(h.lij[0],h.lij[1],h.lij[2])!=="unavailable")&&w<=o&&!T.data&&!T.dataMissing&&((R(f)||h.level===s||w%KLe==0||p-f.level<a)&&(f=h),x>=l))break;h=h.parent}return v(f)&&p-f.level<a&&this._tileLayerInfo.upsampleInfo&&(f=null),f}_findAncestorWithData(){const e=this.tile.vlevel,r=this._desiredMinLevelDelta;let i;for(let n=this.tile;n;n=n.parent)if(n.hasLayerData(this._layerIdx,this._layerClass)){if(e-n.level>=r)return n;i=n}return i}_setUpsampleTile(e){this._tileLayerInfo.setUpsampleInfo(this.tile,e),this.tile.updateRenderData(this._layerClass,js.FADING)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}},uDt=class extends Tce{get _desiredMinLevelDelta(){throw Y1e}get _progressiveLevelModulo(){throw Y1e}dispose(){}};const Y1e=new Error("Abstract method called on TileAgent"),nu=new uDt;let hUe=class extends Tce{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return zQ(this.tile.level)-(this.tile.vlevel-this.tile.level)}get _progressiveLevelModulo(){return 0}},dUe=class extends Tce{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return KLe}};var VS,A2;(function(t){t[t.Stretch=0]="Stretch",t[t.Lut=1]="Lut",t[t.Hillshade=2]="Hillshade",t[t.COUNT=3]="COUNT"})(VS||(VS={})),function(t){t[t.Noop=0]="Noop",t[t.PerBand=1]="PerBand",t[t.COUNT=2]="COUNT"}(A2||(A2={}));function hDt(t,e){t.fragment.uniforms.add([new Dt("u_colormap",r=>r.u_colormap),new Ie("u_colormapOffset",r=>r.colormap.u_colormapOffset),new Ie("u_colormapMaxIndex",r=>r.colormap.u_colormapMaxIndex),new Ie("u_opacity",r=>r.common.u_opacity)]),t.fragment.code.add(S`
    vec4 colormap(vec4 currentPixel, bool isFloat) {
      float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
      vec4 result;
      // handle no data and out of range pixels
      if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
        result = vec4(0.0, 0.0, 0.0, 0.0);
      } else {
        // colormap lookup
        vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
        result = ${Wl(e,"u_colormap","texelCoordinates","(1.0 / vec2(u_colormapMaxIndex + 1.0, 1.0))")};
      }
      return result;
    }
  `)}function dDt(t,e){t.fragment.uniforms.add(rm("u_transformGrid",r=>r.u_transformGrid,e.hasWebGL2Context?oi.None:oi.InvSize)),t.fragment.uniforms.add(new Hr("u_transformSpacing",r=>r.common.u_transformSpacing)),t.fragment.uniforms.add(new Hr("u_targetImageSize",r=>r.common.u_targetImageSize)),t.fragment.code.add(S`
    vec2 projectPixelLocation(vec2 coords) {
      // Pixel index in row/column, corresponds to upperleft corner, e.g. [100, 20]
      vec2 index_image = floor(coords * u_targetImageSize);

      // Pixel's corresponding cell index in transform grid
      // Each transform cell corresponds to 4 pixels: 6 coefficients from lowerleft triangle followed by 6 coefficients from upperright triangle
      vec2 oneTransformPixel = vec2(4.0, 1.0);
      vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;

      // Correspoding position in transform grid cell, cell center coordinates
      vec2 pos = fract((index_image + 0.5) / u_transformSpacing);

      // Pixel's corresponding transform cell location, cell center coordinates
      vec2 transform_location = index_transform + 0.5;

      vec2 srcLocation;

      // Use lower triangle or upper triangle
      if (pos.s <= pos.t) {
        vec3 ll_abc = ${Wl(e,"u_transformGrid","transform_location")}.rgb;
        vec3 ll_def = ${Wl(e,"u_transformGrid","vec2(transform_location.s + 1.0, transform_location.t)")}.rgb;
        srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
        srcLocation.t = dot(ll_def, vec3(pos, 1.0));
      } else {
        vec3 ur_abc = ${Wl(e,"u_transformGrid","vec2(transform_location.s + 2.0, transform_location.t)")}.rgb;
        vec3 ur_def = ${Wl(e,"u_transformGrid","vec2(transform_location.s + 3.0, transform_location.t)")}.rgb;
        srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
        srcLocation.t = dot(ur_def, vec3(pos, 1.0));
      }

      return srcLocation;
    }
  `)}let pUe=class extends wi{constructor(){super(...arguments),this.scale=1,this.offset=Wc}};function fUe(t){t.attributes.add(O.POSITION,"vec2"),t.attributes.add(O.UV0,"vec2"),t.vertex.uniforms.add(new Ie("scale",e=>e.scale)),t.vertex.uniforms.add(new Hr("offset",e=>e.offset)),t.varyings.add("uv","vec2"),t.varyings.add("vuv","vec2"),t.vertex.code.add(S`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}let pDt=class extends pUe{constructor(e,r,i){super(),this.common=e,this.u_image=r,this.u_transformGrid=i}};function fDt(t,e){t.include(dDt,e),t.fragment.uniforms.add([new Dt("u_image",r=>r.u_image),new s_("u_flipY",r=>r.common.u_flipY),new s_("u_applyTransform",r=>r.common.u_applyTransform)]),t.fragment.code.add(S`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}
vec4 getPixel(vec2 pixelLocation) {
return texture2D(u_image, pixelLocation);
}`)}var Be;(function(t){t[t.Normal=0]="Normal",t[t.Average=1]="Average",t[t.Lighten=2]="Lighten",t[t.Lighter=3]="Lighter",t[t.Plus=4]="Plus",t[t.Screen=5]="Screen",t[t.ColorDodge=6]="ColorDodge",t[t.Darken=7]="Darken",t[t.Multiply=8]="Multiply",t[t.ColorBurn=9]="ColorBurn",t[t.Overlay=10]="Overlay",t[t.SoftLight=11]="SoftLight",t[t.HardLight=12]="HardLight",t[t.VividLight=13]="VividLight",t[t.Hue=14]="Hue",t[t.Saturation=15]="Saturation",t[t.Luminosity=16]="Luminosity",t[t.Color=17]="Color",t[t.DestinationOver=18]="DestinationOver",t[t.DestinationAtop=19]="DestinationAtop",t[t.DestinationIn=20]="DestinationIn",t[t.DestinationOut=21]="DestinationOut",t[t.SourceAtop=22]="SourceAtop",t[t.SourceIn=23]="SourceIn",t[t.SourceOut=24]="SourceOut",t[t.Xor=25]="Xor",t[t.Difference=26]="Difference",t[t.Exclusion=27]="Exclusion",t[t.Minus=28]="Minus",t[t.Invert=29]="Invert",t[t.Reflect=30]="Reflect",t[t.COUNT=31]="COUNT"})(Be||(Be={}));const Jte={normal:Be.Normal,average:Be.Average,lighten:Be.Lighten,lighter:Be.Lighter,screen:Be.Screen,plus:Be.Plus,"color-dodge":Be.ColorDodge,darken:Be.Darken,multiply:Be.Multiply,"color-burn":Be.ColorBurn,overlay:Be.Overlay,"soft-light":Be.SoftLight,"hard-light":Be.HardLight,"vivid-light":Be.VividLight,hue:Be.Hue,saturation:Be.Saturation,luminosity:Be.Luminosity,color:Be.Color,difference:Be.Difference,exclusion:Be.Exclusion,minus:Be.Minus,invert:Be.Invert,reflect:Be.Reflect,"destination-over":Be.DestinationOver,"destination-atop":Be.DestinationAtop,"destination-in":Be.DestinationIn,"destination-out":Be.DestinationOut,"source-atop":Be.SourceAtop,"source-in":Be.SourceIn,"source-out":Be.SourceOut,xor:Be.Xor};function mDt(t){return t===Be.DestinationOver||t===Be.DestinationAtop||t===Be.DestinationIn||t===Be.DestinationOut||t===Be.SourceAtop||t===Be.SourceIn||t===Be.SourceOut||t===Be.Xor}function Sce(t){t.code.add(S`
    float lineFactorAtPosition(float value) {
      float pos = value * ${S.float(257)};
      if(pos < 0.5 || pos > ${S.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)}function gDt(t,e){const r=e.blendMode;r!==Be.Normal&&(r===Be.Reflect&&t.code.add(S`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),r!==Be.ColorDodge&&r!==Be.VividLight||t.code.add(S`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),r!==Be.ColorBurn&&r!==Be.VividLight||t.code.add(S`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),r===Be.Overlay&&t.code.add(S`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),r===Be.HardLight&&t.code.add(S`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),r===Be.SoftLight&&t.code.add(S`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),r===Be.VividLight&&t.code.add(S`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),r!==Be.Hue&&r!==Be.Saturation&&r!==Be.Color&&r!==Be.Luminosity||(t.code.add(S`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),r!==Be.Hue&&r!==Be.Saturation||t.code.add(S`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),t.code.add(S`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${r===Be.Multiply?S`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Be.Average?S`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Be.Lighten?S`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Be.Darken?S`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Be.Lighter?S`return vec4(cl * ol + cb * ob, ol + ob);`:r===Be.Plus?S`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:r===Be.Minus?S`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:r===Be.Screen?S`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Be.Difference?S`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Be.Invert?S`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:r===Be.DestinationOver?S`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:r===Be.DestinationAtop?S`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:r===Be.DestinationOut?S`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:r===Be.SourceAtop?S`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:r===Be.SourceOut?S`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:r===Be.Xor?S`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:r===Be.DestinationIn?S`return vec4(cb * ob * ol, ol * ob);`:r===Be.SourceIn?S`return vec4(cl * ol * ob, ol * ob);`:r===Be.Hue?S`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Be.Saturation?S`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Be.Color?S`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Be.Luminosity?S`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Be.Exclusion?S`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Be.Reflect?S`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Be.ColorDodge?S`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Be.ColorBurn?S`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Be.Overlay?S`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Be.SoftLight?S`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Be.HardLight?S`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Be.VividLight?S`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:S``}
    }
  `))}var ao,Zf,Lf;(function(t){t[t.Composite=0]="Composite",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.GroupBackgroundComposite=3]="GroupBackgroundComposite",t[t.COUNT=4]="COUNT"})(ao||(ao={})),function(t){t[t.NotRequired=0]="NotRequired",t[t.Required=1]="Required",t[t.COUNT=2]="COUNT"}(Zf||(Zf={})),function(t){t[t.Off=0]="Off",t[t.On=1]="On",t[t.COUNT=2]="COUNT"}(Lf||(Lf={}));function mUe(t,e){const r=e.output===ao.GridComposite,i=e.output===ao.ColorComposite,n=e.output===ao.GroupBackgroundComposite,s=e.output===ao.Composite;r&&(t.extensions.add("GL_OES_standard_derivatives"),t.fragment.include(Sce)),i&&t.fragment.uniforms.add(new Jt("backgroundColor",c=>c.backgroundColor));const o=e.baseOpacityMode===Zf.Required;if(o&&t.fragment.uniforms.add(new Ie("baseOpacity",c=>c.baseOpacity)),s){const c=e.hasWebGL2Context?oi.None:oi.InvSize;t.fragment.uniforms.add(rm("fboColor",h=>h.fboTexture,c))}const a=e.blendMode!==Be.Normal,l=e.premultipliedSource===Lf.On;t.fragment.include(gDt,e),t.fragment.code.add(S`
    vec4 getBackground(vec2 uv) {
      return ${o?S`baseOpacity *`:""} ${n?S`vec4(0.0, 0.0, 0.0, 0.0)`:i?S`vec4(backgroundColor, 1.0)`:r?S`vec4(gridColor(uv), 1.0)`:S`${Wl(e,"fboColor","gl_FragCoord.xy")}`};
    }

    vec4 blendLayers(vec4 bgColor, vec4 colorLayer, float opacity) {
      ${a?S`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:S`
          float composeAlpha = colorLayer.a * opacity;
          return ${!l&&(s&&!o||n)?S`colorLayer * opacity;`:S`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)}let U7=class extends pDt{constructor(e,r,i,n,s,o){super(e,n,s),this.colormap=r,this.symbolizer=i,this.u_colormap=o,this.backgroundColor=cl,this.fboTexture=null,this.baseOpacity=1}},yDt=class extends U7{},_Dt=class extends U7{};function vDt(t){const e=new Br;return e.include(fUe),e.include(fDt,t),e.include(hDt,t),e.include(mUe,t),e.fragment.code.add(S`vec4 applyBackgroundBlend(vec4 layerColor) {
vec4 bgColor = getBackground(vuv);
return blendLayers(bgColor, layerColor, u_opacity);
}`),t.colorizerType===VS.Stretch?wDt(e,t):t.colorizerType===VS.Lut?bDt(e):t.colorizerType===VS.Hillshade&&xDt(e,t),e}function bDt(t){t.fragment.code.add(S`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
gl_FragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}function wDt(t,e){t.fragment.uniforms.add([new tF("u_bandCount",i=>i.symbolizer.u_bandCount),new ol("u_minCutOff",i=>i.symbolizer.u_minCutOff,3),new ol("u_maxCutOff",i=>i.symbolizer.u_maxCutOff,3),new ol("u_factor",i=>i.symbolizer.u_factor,3),new Ie("u_minOutput",i=>i.symbolizer.u_minOutput),new Ie("u_maxOutput",i=>i.symbolizer.u_maxOutput),new s_("u_useGamma",i=>i.symbolizer.u_useGamma),new ol("u_gamma",i=>i.symbolizer.u_gamma,3),new ol("u_gammaCorrection",i=>i.symbolizer.u_gammaCorrection,3),new Ie("u_opacity",i=>i.common.u_opacity)]),t.fragment.code.add(S`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const r=e.applyColormap?S`gl_FragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:S`gl_FragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;t.fragment.code.add(S`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${e.stretchType===A2.Noop?S`
        gl_FragColor = applyBackgroundBlend(currentPixel);`:S`
        if (currentPixel.a == 0.0) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${r}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          gl_FragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function xDt(t,e){const r=t.fragment;r.uniforms.add([new Dt("u_image",n=>n.u_image),new tF("u_hillshadeType",n=>n.symbolizer.u_hillshadeType),new ol("u_sinZcosAs",n=>n.symbolizer.u_sinZcosAs,6),new ol("u_sinZsinAs",n=>n.symbolizer.u_sinZsinAs,6),new ol("u_cosZs",n=>n.symbolizer.u_cosZs,6),new ol("u_weights",n=>n.symbolizer.u_weights,6),new Hr("u_factor",n=>n.symbolizer.u_factor),new Ie("u_minValue",n=>n.symbolizer.u_minValue),new Ie("u_maxValue",n=>n.symbolizer.u_maxValue),new Hr("u_srcImageSize",n=>n.common.u_srcImageSize)]),r.include(by),r.code.add(S`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`),r.code.add(S`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const i=e.applyColormap?S`gl_FragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:S`hillshade *= alpha;
gl_FragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;r.code.add(S`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture2D(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture2D(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture2D(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture2D(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture2D(u_image, pixelLocation);
      vec4 vf = texture2D(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture2D(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture2D(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture2D(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${i}
    }
  `)}const TDt=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:_Dt,ColorizerStretchUniforms:yDt,ColorizerUniforms:U7,build:vDt},Symbol.toStringTag,{value:"Module"}));function SDt(t,e,r="nearest",i=!1){var c;const n=!(i&&e.pixelType==="u8"),s=n?kt.FLOAT:kt.UNSIGNED_BYTE,o=e.pixels==null||e.pixels.length===0?null:n?e.getAsRGBAFloat():e.getAsRGBA(),a=(c=t.capabilities.textureFloat)==null?void 0:c.textureFloatLinear,l={width:e.width,height:e.height,target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,internalFormat:t.type===Et.WEBGL2&&n?Ot.RGBA32F:Ge.RGBA,samplingMode:!a||r!=="bilinear"&&r!=="cubic"?it.NEAREST:it.LINEAR,dataType:s,wrapMode:$t.CLAMP_TO_EDGE,flipped:!1};return new mt(t,l,o)}function EDt(t,e){const{spacing:r,offsets:i,coefficients:n,size:[s,o]}=e,a=r[0]>1,l={width:a?4*s:s,height:o,target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,internalFormat:t.type===Et.WEBGL2?Ot.RGBA32F:Ge.RGBA,dataType:kt.FLOAT,samplingMode:it.NEAREST,wrapMode:$t.CLAMP_TO_EDGE,flipped:!1},c=new Float32Array(a?s*o*16:2*i.length);if(a&&n!=null)for(let h=0,p=0;h<n.length;h++)c[p++]=n[h],h%3==2&&(c[p++]=1);else for(let h=0;h<o;h++)for(let p=0;p<s;p++){const f=4*(h*s+p),m=2*(p*o+h);c[f]=i[m],c[f+1]=i[m+1],c[f+3]=i[m]===-1?0:1}return new mt(t,l,c)}function Z1e(t,e){const r={width:e.length/4,height:1,target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,internalFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:it.NEAREST,wrapMode:$t.CLAMP_TO_EDGE,flipped:!1};return new mt(t,r,e)}function CDt(t,e,r,i=1,n=!0){return{u_flipY:n,u_applyTransform:!!t,u_opacity:i,u_transformSpacing:t?t.spacing:Wc,u_transformGridSize:t?t.size:Wc,u_targetImageSize:e,u_srcImageSize:r}}function ADt(t,e){return{u_colormapOffset:e||0,u_colormapMaxIndex:t?t.length/4-1:0}}function Per(t,e){return{u_scale:t,u_offset:e}}function RDt(t){return{u_bandCount:t.bandCount,u_minOutput:t.outMin,u_maxOutput:t.outMax,u_minCutOff:t.minCutOff,u_maxCutOff:t.maxCutOff,u_factor:t.factor,u_useGamma:t.useGamma,u_gamma:t.gamma,u_gammaCorrection:t.gammaCorrection}}function ODt(t){return{u_hillshadeType:t.hillshadeType,u_sinZcosAs:t.sinZcosAs,u_sinZsinAs:t.sinZsinAs,u_cosZs:t.cosZs,u_weights:t.weights,u_factor:t.factor,u_minValue:t.minValue,u_maxValue:t.maxValue}}function Ier(t,e){const r=t.gl,i=e.glName,n=new Map;if(R(i))return n;const s=r.getProgramParameter(i,r.ACTIVE_UNIFORMS);let o;for(let a=0;a<s;a++)o=r.getActiveUniform(i,a),o&&n.set(o.name,{location:r.getUniformLocation(i,o.name),info:o});return n}function $er(t,e,r){Object.keys(r).forEach(i=>{const n=e.get(i)||e.get(i+"[0]");n&&MDt(t,i,r[i],n)})}function Ler(t,e,r,i){r.length===i.length&&(i.some(n=>n==null)||r.some(n=>n==null)||r.forEach((n,s)=>{e.setUniform1i(n,s),t.bindTexture(i[s],s)}))}function MDt(t,e,r,i){if(i===null||r==null)return!1;const{info:n}=i;switch(n.type){case Nl.FLOAT:n.size>1?t.setUniform1fv(e,r):t.setUniform1f(e,r);break;case Nl.FLOAT_VEC2:t.setUniform2fv(e,r);break;case Nl.FLOAT_VEC3:t.setUniform3fv(e,r);break;case Nl.FLOAT_VEC4:t.setUniform4fv(e,r);break;case Nl.FLOAT_MAT3:t.setUniformMatrix3fv(e,r);break;case Nl.FLOAT_MAT4:t.setUniformMatrix4fv(e,r);break;case Nl.INT:n.size>1?t.setUniform1iv(e,r):t.setUniform1i(e,r);break;case Nl.BOOL:t.setUniform1i(e,r?1:0);break;case Nl.INT_VEC2:case Nl.BOOL_VEC2:t.setUniform2iv(e,r);break;case Nl.INT_VEC3:case Nl.BOOL_VEC3:t.setUniform3iv(e,r);break;case Nl.INT_VEC4:case Nl.BOOL_VEC4:t.setUniform4iv(e,r);break;default:return!1}return!0}const J1e={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};let PDt=class{constructor(e,r,i=null,n=null){this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.opacity=1,this.lij=e,this.source=r,this.width=i||r.width,this.height=n||r.height}get source(){return this._source}set source(e){this._source=e,this._rasterTexture=rt(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?{...J1e,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||J1e}set symbolizerParameters(e){this._symbolizerParameters=e}get bandIds(){return this._bandIds}set bandIds(e){v(e)&&e.length>0?this._bandIds&&e.every((r,i)=>{var n;return!!((n=this._bandIds)!=null&&n[i])&&r===this._bandIds[i]})||(this._bandIds=e,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(e){if(this._interpolation=e,v(this._rasterTexture)){const r=this._getRasterTextureInterpolation(e);this._rasterTexture.setSamplingMode(r==="bilinear"?it.LINEAR:it.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(e){this._transformGrid=e,this._transformGridTexture=rt(this._transformGridTexture),this._memoryUsed=null}bind(e){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&((R(this._rasterTexture)||this._dirty)&&this._updateRasterTexture(e,this.bandIds),v(this._rasterTexture)&&(this._updateColormapTexture(e),this.transformGrid&&R(this._transformGridTexture)&&(this._transformGridTexture=EDt(e,this.transformGrid))),!0)}getUniforms(){const{symbolizerParameters:e,transformGrid:r,width:i,height:n,opacity:s}=this,o=CDt(r,[i,n],[this.source.width,this.source.height],s),a=ADt(e.colormap,e.colormapOffset),l=this.symbolizerParameters.type==="stretch"?RDt(this.symbolizerParameters):null,c=this.symbolizerParameters.type==="hillshade"?ODt(this.symbolizerParameters):null;return new U7(o,a,l||c,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get memoryUsage(){if(R(this._memoryUsed)){const e=[this._rasterTexture,this._transformGridTexture,this._colormapTexture];this._memoryUsed=e.map(r=>v(r)?r.descriptor.width*r.descriptor.height*4:0).reduce((r,i)=>r+i,0)}return this._memoryUsed}release(){return this._rasterTexture=rt(this._rasterTexture),this._transformGridTexture=rt(this._transformGridTexture),this._colormapTexture=rt(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(e,r){const i=this.source?this.source.extractBands(r):null;if(!(i&&i.pixels&&i.pixels.length>0))return void(this._rasterTexture=rt(this._rasterTexture));const n=R(r)&&R(this.bandIds)||v(r)&&v(this.bandIds)&&r.join("")===this.bandIds.join("");if(v(this._rasterTexture)&&n)return;this._rasterTexture=rt(this._rasterTexture);const s=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=SDt(e,i,s,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&this.symbolizerParameters.stretchType==="none"&&!this.symbolizerParameters.useGamma&&this.source.pixelType==="u8"}_getRasterTextureInterpolation(e){return this.symbolizerParameters.type==="lut"||e==="nearest"||e==="majority"?"nearest":"bilinear"}_updateColormapTexture(e){const r=this._colormap,i=this.symbolizerParameters.colormap;return i?r?i.length!==r.length||i.some((n,s)=>n!==r[s])?(this._colormapTexture=rt(this._colormapTexture),this._colormapTexture=Z1e(e,i),void(this._colormap=i)):void 0:(this._colormapTexture=Z1e(e,i),void(this._colormap=i)):(this._colormapTexture=rt(this._colormapTexture),void(this._colormap=null))}},GU=class{constructor(){this.waitingAgents=new Wt,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(e){const r=SW.acquire();return r._init(e),r}release(){this.dispose(),HU.delete(this),SW.release(this)}dispose(){this.loadingAgent=rt(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=HR(this._data)}static prune(){SW.prune(0)}_init(e){this.waitingAgents.clear(),this._data=HR(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=e,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=Tp(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){v(this._upsampleInfo)&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(e,r){if(e===r||R(r))this._unsetUpsampleInfo();else{if(R(this._upsampleInfo))this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===r)return;this._upsampleInfo.tile.unrefMapData()}r.refMapData(),lDt(e,r,this._upsampleInfo)}}get data(){return this._data}set data(e){HR(this._data),this._data=e}};const SW=new ko(GU,null,()=>{}),HU=new Map;function IDt(){HU.size>0&&(console.log(`${HU.size} live TilePerLayerInfo allocations:`),HU.forEach(t=>console.log(t,`
`)))}let _A=class{constructor(e){this._texture=e,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){--this._refCount,this._refCount===0&&this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}};var Mt;(function(t){t[t.NONE=0]="NONE",t[t.NONE_HIT_MAXLOD=1]="NONE_HIT_MAXLOD",t[t.SPLIT=2]="SPLIT",t[t.VSPLITMERGE=4]="VSPLITMERGE",t[t.MERGE=8]="MERGE",t[t.RENDERDATA=16]="RENDERDATA",t[t.GEOMETRY=32]="GEOMETRY",t[t.TEXTURE_NOFADING=64]="TEXTURE_NOFADING",t[t.TEXTURE_FADING=128]="TEXTURE_FADING"})(Mt||(Mt={}));const EW=P(),JE=P(),Go=P(),$Dt=.1;let Ece=class{constructor(){this.lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this.renderData=null,this._dirty=!0,this._previouslyRendered=!1,this.extent=Kt(),this._elevationBounds=Ne(),this.layerInfo=[[],[]],this.extentInRadians=Kt(),this.centerAtSeaLevel=P(),this._center=[P(),Os(),P()],this.up=_ne(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemoryInternal=0,this._mapDataRefCount=0,this.screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.extentMidX=0,this.extentMidY=0,this.distanceToPOI=-1,this._lastPOI=P()}static prune(){Cce.prune(0),Ace.prune(0),GU.prune()}get _isCached(){return!this.shouldLoad&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get key(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[ys.MIDDLE][3]}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){var i;this._dirty=!1;const e=((i=this.parent)==null?void 0:i.frustumVisibility)??tl.INTERSECTS;this._frustumVisibility=e===tl.INSIDE?tl.INSIDE:e===tl.OUTSIDE?tl.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);const r=this._frustumVisibility!==tl.OUTSIDE&&this._intersectsClippingArea;r!==this._visible&&(this._visible=r,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const e=!!this.renderData;return e!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=e,this._surface.renderer.setDirty()),e}get shouldLoad(){const e=this._surface.snapLevel;if(v(e)){const r=this.level-e;if(r===0)return!0;if(r===1)return!1}return this.isLeaf}init(e,r,i){this.lij[0]=e[0],this.lij[1]=e[1],this.lij[2]=e[2],this.ellipsoid=ii(i.tilingScheme.spatialReference),i.tilingScheme.getExtent(e[0],e[1],e[2],this.extent),i.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,i.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[ys.MIDDLE][3]=0,this.vlevel=e?e[0]:0,r&&r.elevationBounds?Qs(this._elevationBounds,r.elevationBounds):dt(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this.screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=r,this.unsetChildren(),this._surface=i,this.updateVisibility();for(const n of IT){const s=i.numLayers(n),o=this.layerInfo[n];for(const a of o)a.release();o.length=s;for(let a=0;a<s;a++)o[a]=GU.acquire(this._surface.upsampleInfoPool),n===vr.ELEVATION&&this.findElevationBoundsForLayer(a,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(i.tilingScheme.pixelSize,xI)}release(){Cg(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const e of IT){for(const r of this.layerInfo[e])r.release();this.layerInfo[e].length=0}this._parent=null;for(let e=0;e<4;++e)this._children[e]=null;this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this._isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this._isCached){this.setMemoryDirty();const e=this._cachedMemory;e>0&&this._surface.upsampleMapCache.put(this.key,this,e)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}get _cachedMemory(){return this._isCached?this._mapTileMemory:0}get _mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[vr.MAP].reduce((e,r)=>e+(r instanceof TW?r.memoryUsage:0),this._mapTileMemoryInternal)}get _cpuImageMemorySize(){const r=this._surface.tilingScheme.pixelSize;return r*r*4}_ensureUsedMemory(){if(v(this._usedMemory))return this._usedMemory;this._usedMemory=0,this._mapTileMemoryInternal=0;let e=0;for(const{data:i}of this.layerInfo[vr.MAP])i instanceof TW?e+=this._getTerrainDataMemory(i):this._mapTileMemoryInternal+=this._getTerrainDataMemory(i);const r=this._cpuImageMemorySize;for(const i of this.layerInfo[vr.ELEVATION])this._usedMemory+=i.data?r:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemoryInternal+=g2(this.renderData.textureDescriptor)),this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+e),this._usedMemory}getUsedMemoryForLayer(e,r){const i=this.layerInfo[e][r];return i!=null&&i.data?e===vr.MAP?this._isCached?0:this._getTerrainDataMemory(i.data):e===vr.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(e){return e instanceof _A?g2(e.texture):e instanceof HTMLImageElement||e instanceof D7?this._cpuImageMemorySize:e instanceof TW||e instanceof PDt?e.memoryUsage:0}updateScreenDepth(e){const r=this._center[ys.MIDDLE],i=e,n=r[0],s=r[1],o=r[2],a=i[2]*n+i[6]*s+i[10]*o+i[14];this.screenDepth=a<0?0:a/(i[3]*n+i[7]*s+i[11]*o+i[15])}shouldSplit(e,r,i){if(!this.visible||v(e.frustum)&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(e.frustum)===tl.OUTSIDE))return Mt.NONE;const n=this.level;ge(EW,this._center[ys.MIDDLE],r);let s=nl(EW),o=ys.MIDDLE;ge(JE,this._center[ys.TOP],r);const a=nl(JE);a<s&&(s=a,o=ys.TOP),ge(JE,this._center[ys.BOTTOM],r);const l=nl(JE);if(l<s&&(s=l,o=ys.BOTTOM),this._edgeLen2>s&&n<e.maxLod)return Mt.SPLIT;const c=Math.sqrt(s),h=e.fovX*c*2,p=this._edgeLen/h,f=()=>{const b=n+Math.ceil(-Math.log2(e.relativeWidthLimit/p));return b!==this.vlevel?(this.vlevel=b,Mt.VSPLITMERGE):Mt.NONE_HIT_MAXLOD};if(v(i)&&i-n===1)return n>=e.maxLod?f():Mt.SPLIT;const m=ve(this.up,EW),g=this._elevationBounds[1]-this._elevationBounds[0],_=g/this.edgeLen;if(e.aboveGround&&m>0&&_<.001&&m/c-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-_>0)return Mt.NONE;if(p<e.relativeWidthLimit)return this.vlevel!==this.level?(this.vlevel=this.level,Mt.VSPLITMERGE):Mt.NONE;if(n>=e.maxLod)return f();if(n>6){ge(JE,this._center[o],r),le(Go,this.up,m),ge(Go,Go,JE);const b=nl(Go);if(b>this.radius*this.radius){le(Go,Go,this.radius/Math.sqrt(b)),me(Go,Go,this._center[o]),ge(Go,r,Go);const w=Math.min(1,(Math.abs(ve(Go,this.up))+.5*g+this._curvatureHeight)/Pe(Go)),x=$Dt/e.angledSplitBias,T=e.fovY*c*2;if(w*(this._edgeLen/T)<x*e.relativeHeightLimit)return Mt.NONE}}return Mt.SPLIT}setChildren(e,r,i,n){Cg(!!(e&&r&&i&&n),"Null child passed"),this._children[0]=e,this._children[1]=r,this._children[2]=i,this._children[3]=n}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){var e;return((e=this.renderData)==null?void 0:e.hasGeometry)??!1}load(){this.refMapData();for(const e of IT)this._createOrUpdateAgents(0,e);this.surface.renderer.loadTile(this)}unload(e){e.unloadTile(this);for(const r of IT){const i=this.layerInfo[r];for(const n of i)n.loadingAgent&&n.loadingAgent!==nu&&(pk(n.loadingAgent),n.loadingAgent=null),n.pendingUpdates=0}this.resetPendingUpdate(Mt.GEOMETRY),this.resetPendingUpdate(Mt.TEXTURE_NOFADING),this.resetPendingUpdate(Mt.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const e=this.layerInfo[vr.MAP];for(const r of e)r.loadingAgent&&r.loadingAgent!==nu&&(pk(r.loadingAgent),r.loadingAgent=null),r.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(e){if(AS(e,this._clippingArea))return!1;const r=this._intersectsClippingArea,i=this._isWithinClippingArea;v(e)?(this._intersectsClippingArea=this.intersectsExtent(e),this._isWithinClippingArea=this._isWithinExtent(e)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=e,this.updateVisibility();const n=i&&this._isWithinClippingArea,s=!(i||r||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||n||s||this.setPendingUpdate(Mt.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(e,r){return this.layerInfo[r][e]}hasLayerData(e,r){const i=this.layerInfo[r][e];return!(!i||!i.data||i.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const e of IT){const r=this.layerInfo[e];for(const i of r)if(i.loadingAgent&&i.loadingAgent!==nu&&i.loadingAgent.updating)return!0}return!1}_isSuspended(e){return!!this.hasPendingUpdate(Mt.SPLIT)||e!==vr.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(e){return(this._pendingUpdates&e)===e}setPendingUpdate(e){this._pendingUpdates|=e,e===Mt.SPLIT||e===Mt.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(e){return!!this.hasPendingUpdate(e)&&(this._pendingUpdates&=~e,!0)}requestLayerData(e,r,i){const n=this.layerInfo[r][e];if(n.waitingAgents.has(i))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),i.tile.lij.toString(),r,e),!0;if(n.waitingAgents.push(i),n.data&&!n.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),i.tile.lij.toString(),r,e),i.dataArrived(this),!0;if(n.requestPromise)return!0;Tp(n.requestAbort),n.requestAbort=new AbortController;const s=this._surface.requestTileData(this,e,r,n.requestAbort);if(!s)return n.requestAbort=null,!1;const o=()=>{n.requestPromise===s&&(n.requestPromise=null,n.requestAbort=null)};return n.requestPromise=s,s.then(o,o),!0}get isLeaf(){return this._children[0]==null}hasLij(e){return this.lij[0]===e[0]&&this.lij[1]===e[1]&&this.lij[2]===e[2]}findByLij(e){if(this.hasLij(e))return this;const r=this._children;return r[0]?r[0].findByLij(e)||r[1].findByLij(e)||r[2].findByLij(e)||r[3].findByLij(e):null}distanceToSquared(e){return nl(ge(Go,this._center[ys.MIDDLE],e))}containsPoint(e){const r=this.extent;return e[0]>=r[0]&&e[1]>=r[1]&&e[0]<=r[2]&&e[1]<=r[3]}containsPointXY(e,r){const i=this.extent;return e>=i[0]&&r>=i[1]&&e<=i[2]&&r<=i[3]}unrequestLayerData(e,r,i){const n=this.layerInfo[r][e],s=n.waitingAgents,o=s.removeUnordered(i)!=null;Cg(o,"agent has not requested this piece of map data"),s.length<1&&(n.abortRequest(),this.setMemoryDirty())}dataArrived(e,r,i){const n=this.layerInfo[r][e];n.data=i,n.dataInvalidated=!1,n.waitingAgents.forAll(s=>s.dataArrived(this)),n.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(e,r,i){i.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${r}/${e} error ${i}`);const n=this.layerInfo[r][e];n.dataMissing=!0,n.waitingAgents.forAll(s=>s.dataMissing()),n.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(e,r){switch(e){case vr.MAP:return this._updateTexture(r);case vr.ELEVATION:return this._updateGeometry()}}_updateTexture(e){this.renderData&&(this.resetPendingUpdate(e===js.FADING?Mt.TEXTURE_NOFADING:Mt.TEXTURE_FADING),this.setPendingUpdate(e===js.FADING?Mt.TEXTURE_FADING:Mt.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(Mt.GEOMETRY);for(const e of this.layerInfo[vr.ELEVATION])e.pendingUpdates|=Mt.GEOMETRY}invalidateLayerData(e,r){this.layerInfo[r][e].invalidateSourceData(),this.restartAgents(r)}computeElevationBounds(){const e=this._elevationBounds,r=e[0],i=e[1];dt(e,1/0,-1/0);const n=this.layerInfo[vr.ELEVATION];let s=!0;for(const o of n)v(o.elevationBounds)&&(e[0]=Math.min(e[0],o.elevationBounds.min),e[1]=Math.max(e[1],o.elevationBounds.max),o.elevationBounds.hasNoDataValues||(s=!1));s&&(e[0]=Math.min(e[0],0),e[1]=Math.max(e[1],0)),r===e[0]&&i===e[1]||(this.updateRadiusAndCenter(),this._surface.setTileTreeDirty())}_updateCenter(){const e=this._elevationBounds,r=.5*(e[0]+e[1]),i=this._center;le(Go,this.up,r),me(i[ys.MIDDLE],this.centerAtSeaLevel,Go),le(Go,this.up,e[0]),me(i[ys.TOP],this.centerAtSeaLevel,Go),le(Go,this.up,e[1]),me(i[ys.BOTTOM],this.centerAtSeaLevel,Go)}findElevationBoundsForLayer(e,r){const i=this.layerInfo[vr.ELEVATION][e],n=zQ(this.level),s=Math.max(this.vlevel-n,0),o=i.elevationBounds;if(v(o)&&o.level>=r&&o.level<=s)return;const a=this._surface.layerViewByIndex(e,vr.ELEVATION),l=Gte(a);if(!oL(this,l,!1))return;const c=DDt;let h=!1;const p=i.data;if(p&&p.level<=s){const f=i.data;c.min=f.samplerData.data.minValue,c.max=f.samplerData.data.maxValue,c.hasNoDataValues=f.samplerData.data.hasNoDataValues,c.level=this.level,h=!0}else{let f,m,g=0;for(let _=this._parent;_&&(!m||g<n)&&(g=this.vlevel-_.level,f=m||f,m=_.layerInfo[vr.ELEVATION][e].data,!(!m&&f&&_.level<=s));_=_.parent);m=m||f,m&&(m.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],c),c.min!==1/0&&(c.level=m.level,h=!0))}h&&(R(i.elevationBounds)&&(i.elevationBounds=new hR),i.elevationBounds.copyFrom(c))}modifyLayers(e,r,i){const n=this.layerInfo[i];for(const a of n)a.loadingAgent&&a.loadingAgent!==nu&&(pk(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<n.length;++a)e[a]===void 0&&n[a].release();const s=new Array(...n),o=r.length;n.length=o;for(let a=0;a<o;a++){const l=r[a];n[a]=l>-1?s[l]:GU.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(e){this.renderData&&(this._createOrUpdateAgents(0,e),this.updateRenderData(e,js.FADING))}updateAgents(e){if(this.renderData){const r=this.layerInfo[e];for(const i of r)i.loadingAgent===nu&&(i.loadingAgent=null);this._createOrUpdateAgents(0,e)}}updateAgentSuspension(){for(const e of IT){const r=this._isSuspended(e);for(const i of this.layerInfo[e])i.loadingAgent&&i.loadingAgent!==nu&&(i.loadingAgent.setSuspension(r),i.loadingAgent===nu&&this.updateRenderData(e,js.FADING))}}removeLayerAgent(e,r){const i=this.layerInfo[r][e];i.loadingAgent&&i.loadingAgent!==nu&&i.loadingAgent.dispose(),i.loadingAgent=null}agentDone(e,r){const i=this.layerInfo[r][e];i.loadingAgent=nu,!i.data&&R(i.upsampleInfo)&&this._createOrUpdateAgents(e+1,r)}_hasBlendableAncestor(e){return e.blendMode!=="normal"||AO(e.parent)&&this._hasBlendableAncestor(e.parent)}_hasBlendModes(e,r,i){var n,s,o;for(let a=e;a<r;++a){const l=this._surface.layerViewByIndex(a,i);if(GV(l)&&((n=l==null?void 0:l.layer)==null?void 0:n.blendMode)!=="normal"||AO((s=l==null?void 0:l.layer)==null?void 0:s.parent)&&this._hasBlendableAncestor((o=l==null?void 0:l.layer)==null?void 0:o.parent))return!0}return!1}_createOrUpdateAgents(e,r){const i=this.layerInfo[r];if(i.length===0)return;const n=this._isSuspended(r);for(let s=e;s<i.length;++s){const o=i[s];let a=!1;const l=this._surface.layerViewByIndex(s,r),c=Gte(l);if(o.loadingAgent?oL(this,c,!1)?(o.loadingAgent!==nu&&o.loadingAgent.setSuspension(n),o.loadingAgent!==nu&&(a=o.loadingAgent.update())):o.dispose():oL(this,c,!1)&&(o.loadingAgent=LDt(this,s,r,n),a=o.loadingAgent.startLoading(),a?o.loadingAgent===nu&&this.setPendingUpdate(Mt.GEOMETRY):(pk(o.loadingAgent),o.loadingAgent=nu)),o.loadingAgent===nu&&this.updateRenderData(r,js.FADING),!this._hasBlendModes(e,i.length,r)&&a&&l.isOpaque)return}}_isWithinExtent(e){const r=this.extent;return r[0]>=e[0]&&e[2]>=r[2]&&r[1]>=e[1]&&e[3]>=r[3]}intersectsExtent(e){const r=this.extent;return r[2]>=e[0]&&e[2]>=r[0]&&r[3]>=e[1]&&e[3]>=r[1]}getElevationVerticesPerSide(e){const r=this.vlevel-this.level,i=Math.max(this.level-e,zQ(this.level)-r),n=_e(1+(this.maxTesselation>>i),2,this.maxTesselation+1),s=this.getDefaultVerticesPerSide();return Math.max(n,s)}get test(){return{cachedMemory:this._cachedMemory}}_findLIJ(e,r){if(!e)return null;const i=this.surface.rootTiles;if(v(i)){for(const n of i)if(NDt(n,e)){let s=n,o=e[0]-s.level-1;for(;o>=0&&!s.isLeaf&&!r(s);){const a=e[1]>>o&1,l=e[2]>>o&1;s=s.children[2*a+l],o--}return r(s)?s:null}}return null}findNeighborTile(e,r){const i=this.lij,n=this.getNeighborLIJ(i,e);return n?FDt(i,n)?r(this)?this:null:this._findLIJ(n,r):null}findCorner(e,r){const i=e===It.NORTH_EAST?1:e===It.NORTH_WEST?0:e===It.SOUTH_WEST?2:3;let n=this;for(;n.children[0]&&(!r||!r(n));)n=n.children[i];return n}findNeighborCornerTileExact(e,r){var i;return((i=this.findNeighborTile(e,n=>r(n)||n.level===this.level))==null?void 0:i.findCorner(Wte(e),r))||null}forAllSubtreeOnSide(e,r){const i=e===It.NORTH?[0,1]:e===It.NORTH_EAST?[1]:e===It.EAST?[1,3]:e===It.SOUTH_EAST?[3]:e===It.SOUTH?[2,3]:e===It.SOUTH_WEST?[2]:e===It.WEST?[0,2]:[0],n=s=>{const o=s.children;!r(s)&&o[0]&&i.forEach(a=>n(o[a]))};n(this)}forallNeighbors(e){qV.forEach(r=>this.findNeighborCornerTileExact(r,e)),Ug.forEach(r=>{var i;return(i=this.findNeighborTile(r,n=>n.level===this.level||e(n)))==null?void 0:i.forAllSubtreeOnSide(HV(r),e)})}getNeighborEdgeStartVertexIndex(e,r){if(!r)return 0;const i=this.level-r.level;if(Re(!Zs||i>=0),i===0)return 0;const n=2**i,s=(1&e)==1,o=s?0:1,a=r.lij[o+1]*n,l=this.lij[o+1],c=l-a,h=s?n-1-c:c;return Zs&&(Re(a<=l&&l<a+n),Re(0<=h&&h<n)),h}forEachLoadedNeighbor(e){const r=this.level,i=n=>n.level===r||n.isLoaded;Ug.forEach(n=>{const s=this.findNeighborTile(n,i);s!=null&&s!==this&&s.forAllSubtreeOnSide(HV(n),o=>!!o.isLoaded&&(e(o,n),!0))}),qV.forEach(n=>{var o;const s=(o=this.findNeighborTile(n,i))==null?void 0:o.findCorner(Wte(n),a=>a.isLoaded);Re(!s||Kte(this,s,n)),s!=null&&s.isLoaded&&e(s,n)})}getNeighborLIJ(e,r){const i=F1e(r)?-1:N1e(r)?1:0,n=L1e(r)?-1:D1e(r)?1:0,s=[e[0],e[1]+i,e[2]+n];return s[1]<0?null:this.surface.isGlobal?this.wrapLIJ(s):s[2]<0?null:s}wrapLIJ(e){return!e||e[1]<0||e[1]>=2**e[0]?null:this.surface.wrapEastWest(e)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return this.lij[2]===0}get isNorthEnd(){return this.lij[1]===0}get isSouthEnd(){return this.extent[1]+yl()>=this.surface.extent[1]}checkGeometryWaterproofness(){var e;BV&&(Re(this.isLoaded),(e=this.renderData)==null||e.checkGeometryWaterproofness())}shouldHaveNeighbor(e){const r=this.extent,i=this.surface.rootTilesExtent,n=.25*(r[2]-r[0]);if(F1e(e)&&r[3]+n>=i[3]||N1e(e)&&r[1]-n<=i[1])return!1;const s=this.surface.isGlobal;return!(!s&&L1e(e)&&r[0]-n<=i[0])&&!(!s&&D1e(e)&&r[2]+n>=i[2])}updateDistanceToPOI(e){const r=this._lastPOI;if(this.distanceToPOI>=0&&r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2])return;ce(this._lastPOI,e);const i=this._center[ys.MIDDLE],n=e[0]-i[0],s=e[1]-i[1],o=e[2]-i[2];this.distanceToPOI=n*n+s*s+o*o}};function LDt(t,e,r,i){const n=r===vr.ELEVATION?Ace.acquire():Cce.acquire();return n.init(t,e,r,i),n}function pk(t){t.dispose(),t instanceof hUe?Ace.release(t):t instanceof dUe&&Cce.release(t)}const Cce=new ko(dUe),Ace=new ko(hUe),DDt=new hR;var ys;function NDt(t,e){const r=t.level,i=e[0];if(r>i)return!1;const n=i-r,s=Math.floor(e[1]/2**n),o=Math.floor(e[2]/2**n);return s===t.lij[1]&&o===t.lij[2]}function FDt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function kDt(t,e,r){if(R(t)||R(e))return!1;if(t.level===0&&e.level===0&&(t.isEastEnd&&e.isWestEnd&&r===It.EAST||t.isWestEnd&&e.isEastEnd&&r===It.WEST))return!0;const i=Math.max(1e-6*(t.extent[2]-t.extent[0]),1);switch(r){case It.NORTH:return rp(t.extent[3],e.extent[1],i);case It.SOUTH:return rp(t.extent[1],e.extent[3],i);case It.EAST:return rp(t.extent[2],e.extent[0],i)||rp(t.extent[2],-e.extent[0],i);case It.WEST:return rp(t.extent[0],e.extent[2],i)||rp(t.extent[0],-e.extent[2],i)}}function Kte(t,e,r){return!R(t)&&!R(e)&&e!==t&&(t.level>=e.level?K1e(t,e,r):K1e(e,t,Wte(r)))}function K1e(t,e,r){Re(t.level>=e.level);const i=tLt(r),n=rLt(r),s=t.extent,o=e.extent,a=[i?s[0]:s[2],n?s[3]:s[1]],l=[i?o[2]:o[0],n?o[1]:o[3]],c=1e-5*(s[2]-s[0]),h=rp(a[0],l[0],c)||t.surface.isGlobal&&rp(a[0],-l[0],c),p=rp(a[1],l[1],c);if(h&&p)return!0;if(t.level===e.level||!h&&!p)return Re(!1),!1;const f=h?Q1e(o[1],o[3],s[1],s[3],c):Q1e(o[0],o[2],s[0],s[2],c);return Re(f),f}function Q1e(t,e,r,i,n=yl()){return t-n<=r&&r<=i&&i<=e+n}(function(t){t[t.TOP=0]="TOP",t[t.MIDDLE=1]="MIDDLE",t[t.BOTTOM=2]="BOTTOM"})(ys||(ys={}));let UDt=class{constructor(){this._scales=Zt(-1,-1,-1,-1),this._offsets=Zt(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(e,r,i){this._scales[2*e]=r,this._scales[2*e+1]=i}setOffset(e,r,i){this._offsets[2*e]=r,this._offsets[2*e+1]=i}get scales(){return this._scales}get offsets(){return this._offsets}};function zDt(t,e){t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),e.spherical?t.vertex.code.add(S`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):t.vertex.code.add(S`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),t.fragment.code.add(S`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}let Rce=class extends ike{constructor(){super(...arguments),this.slicePlaneLocalOrigin=P(),this.origin=this.slicePlaneLocalOrigin}};var $u;(function(t){t[t.Material=0]="Material",t[t.ShadowMap=1]="ShadowMap",t[t.Highlight=2]="Highlight"})($u||($u={}));let VDt=class extends Rce{constructor(){super(...arguments),this.identifier=$u.Material,this.output=V.Color,this.transparent=!1,this.integratedMesh=!1}},BDt=class extends Rce{constructor(){super(...arguments),this.identifier=$u.ShadowMap}},jDt=class extends Rce{constructor(){super(...arguments),this.identifier=$u.Highlight}},WV=class extends Ln{constructor(e,r){super(e,"vec4",_i.Draw,(i,n,s)=>i.setUniform4fv(e,r(n,s)))}};var h_;function GDt(t,e){const{vertex:r,fragment:i}=t;r.uniforms.add([new WV("overlayTexOffset",(n,s)=>HDt(n,s)),new WV("overlayTexScale",(n,s)=>qDt(n,s))]),i.constants.add("overlayOpacity","float",1),i.uniforms.add(new Dt("ovColorTex",(n,s)=>Qte(n,s))),gUe(t,e)}function gUe(t,e){t.extensions.add("GL_OES_standard_derivatives"),e.pbrMode!==_t.Water&&e.pbrMode!==_t.WaterOnIntegratedMesh&&e.pbrMode!==_t.TerrainWithWater||t.include(lke,e);const{vertex:r,fragment:i}=t;t.varyings.add("vtcOverlay","vec4"),r.code.add(S`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),i.code.add(S`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture2D(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture2D(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),i.code.add(S`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),i.code.add(S`
    vec4 getOverlayColorTexel(vec4 texCoords) {
          vec2 texDim =  ${yp(e,"ovColorTex")};

          vec4 color0 = ${Wl(e,"ovColorTex","vec2(texCoords.x * 0.5, texCoords.y)*texDim")};
          vec4 color1 = ${Wl(e,"ovColorTex","vec2(texCoords.z * 0.5 + 0.5, texCoords.w)*texDim")};

          bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
          bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));

          return mix(color1 * float(isValid1), color0, float(isValid0));
    }
  `),e.pbrMode!==_t.Water&&e.pbrMode!==_t.WaterOnIntegratedMesh&&e.pbrMode!==_t.TerrainWithWater||(U_(i),vy(i),i.code.add(S`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function Qte(t,e){return e.overlays.length===0?null:t.identifier===$u.Material&&t.output===V.Color?e.overlays[dn.INNER].getColorTextureNoRasterImage():t.identifier===$u.Material&&t.output===V.ObjectAndLayerIdColor?e.overlays[dn.INNER].getColorTexture(Pc.ObjectAndLayerIdColor):t.identifier===$u.Highlight?e.overlays[dn.INNER].getValidTexture(Rn.Highlight):null}function HDt(t,e){for(const r of e.overlays){const{index:i,extent:n}=r;pCe(n)>0&&(qR[2*i]=t.toMapSpace[0]/Bh(n)-n[0]/Bh(n),qR[2*i+1]=t.toMapSpace[1]/cm(n)-n[1]/cm(n))}return qR}function qDt(t,e){for(const r of e.overlays){const{index:i,extent:n}=r;pCe(n)>0&&(qR[2*i]=t.toMapSpace[2]/Bh(n),qR[2*i+1]=t.toMapSpace[3]/cm(n))}return qR}(function(t){t[t.Disabled=0]="Disabled",t[t.Enabled=1]="Enabled",t[t.EnabledWithWater=2]="EnabledWithWater",t[t.COUNT=3]="COUNT"})(h_||(h_={}));const qR=pr();var zg;(function(t){t[t.LayerOnly=0]="LayerOnly",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.COUNT=3]="COUNT"})(zg||(zg={}));let WDt=class extends wi{constructor(){super(...arguments),this.overlayOpacity=1}};function sP(t,e){t.vertex.uniforms.add([new XV("overlayTexOffset"),new XV("overlayTexScale")]),t.fragment.uniforms.add([new Ie("overlayOpacity",r=>r.overlayOpacity),new Dt("ovColorTex",(r,i)=>i.overlays.length===0?null:i.overlays[dn.INNER].getColorTexture(r.overlaySource))]),gUe(t,e)}function XDt(t,e){const{vertex:r,fragment:i,varyings:n}=t;n.add("vtc","vec2"),r.uniforms.add(new XV("texOffsetAndScale")),i.uniforms.add(new ebe("tex")),i.uniforms.add(new CW("textureOpacities"));const s=e.textureFadingEnabled&&!e.renderOccluded;s&&(r.uniforms.add(new XV("nextTexOffsetAndScale")),n.add("nvtc","vec2"),i.uniforms.add(new ebe("texNext")),i.uniforms.add(new CW("nextTexOpacities")),i.uniforms.add(new YDt("fadeFactor")));const o=e.tileBlendInput===zg.ColorComposite,a=e.tileBlendInput===zg.GridComposite;a&&i.include(Sce),o&&i.uniforms.add(new CW("backgroundColor")),r.code.add(S`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${s?S`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:S``}
  }`),i.code.add(S`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${a||o?S`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${o?S`backgroundColor`:S`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:S`return color;`}
    }`),s?i.code.add(S`vec4 getTileColor() {
vec4 color = getColor(texture2D(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture2D(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):i.code.add(S`vec4 getTileColor() {
return getColor(texture2D(tex, vtc), vtc, textureOpacities);
}`)}let YDt=class extends Ln{constructor(e){super(e,"float")}},CW=class extends Ln{constructor(e){super(e,"vec3")}},XV=class extends Ln{constructor(e){super(e,"vec4")}},ebe=class extends Ln{constructor(e){super(e,"sampler2D")}},yUe=class extends WDt{};function ZDt(t){const e=new Br,{vertex:r,fragment:i,varyings:n}=e;e.include(BN),e.include(eF,t),e.include(Zg,t);const s=()=>{e.include(ND,t),r.code.add(S`
      vec3 decodeNormalTerrain(vec2 e) {
        float z = 1.0 - abs(e.x) - abs(e.y);
        vec3 n = vec3(e + vec2(e.x >= 0.0 ? 1.0 : -1.0, e.y >= 0.0 ? 1.0 : -1.0) * min(z,0.0),z);
        return normalize(n);
      }

      vec3 getNormal() {
        return  ${t.shading?S`decodeNormalTerrain(normalCompressed)`:S`getLocalUp(position, localOrigin)`};
      }
  `)};Gu(r,t),e.include(zc,t);const o=t.overlayMode!==h_.Disabled;switch(t.output){case V.Color:{e.include(XDt,t),e.include(E2,t),o&&e.include(sP,{...t,pbrMode:t.pbrMode===_t.Terrain?_t.TerrainWithWater:_t.Water});const a=t.overlayMode===h_.EnabledWithWater;a&&e.include(zDt,t),n.add("vnormal","vec3"),n.add("vpos","vec3"),n.add("vup","vec3"),s(),(t.atmosphere||t.screenSizePerspective)&&YO(r);const l=t.receiveShadows&&!t.renderOccluded;l&&e.include(L3,t),t.atmosphere&&n.add("wnormal","vec3"),t.screenSizePerspective&&(n.add("screenSizeDistanceToCamera","float"),n.add("screenSizeCosAngle","float")),r.code.add(S`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          //Up
          vup = getLocalUp(position, localOrigin);

          ${a?S`forwardVertexTangent(vnormal);`:S``}

          ${t.atmosphere?S`wnormal = normalize((viewNormal * vec4(normalize(positionWorld), 1.0)).xyz);`:""}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${o?S`setOverlayVTC(uv);`:""}
          ${t.tileBorders?S`forwardTextureCoordinates();`:""}

          ${t.screenSizePerspective?S`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${l?S`forwardLinearDepth();`:""}

        }
      `),e.extensions.add("GL_OES_standard_derivatives"),e.extensions.add("GL_EXT_shader_texture_lod"),e.include(hs,t),e.include(E2,t),e.include(rF,t),e.include(S2,t),mm(i,t),iF(i),H3(i),i.uniforms.add([r.uniforms.get("localOrigin"),new Jt("viewDirection",(c,h)=>we(tbe,he(tbe,h.camera.viewMatrix[12],h.camera.viewMatrix[13],h.camera.viewMatrix[14])))]),a&&i.uniforms.add([new Dt("ovWaterTex",(c,h)=>h.overlays.length===0?null:h.overlays[dn.INNER].getNormalTexture(c.overlaySource)),new o4e("view",(c,h)=>Hc(JDt,h.camera.viewMatrix,c.origin))]),i.code.add(S`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),U_(i),vy(i),i.code.add(S`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${t.receiveShadows&&!t.renderOccluded?"readShadowMap(vpos, linearDepth)":t.spherical&&t.shading?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${o?S`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${t.invisible?S`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a <= 0.0) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= sliceOpacity;
          }
          ${t.atmosphere?S`
              float ndotl = clamp(vndl, 0.0, 1.0);
              vec3 atm = vec3(clamp(1.0 - dot(-viewDirection, wnormal), 0.0, 1.0));
              atm *= clamp(1.0 - lum(tileColor.rgb) * 1.5, 0.0, 1.0); // avoid atmosphere on bright base maps
              atm *= clamp(ndotl * 2.0, 0.0, 1.0); // avoid atmosphere on dark side of the globe
              atm *= tileColor.a; // premultiply with tile alpha`:""}

          vec3 albedo = ${t.atmosphere?S`atm + tileColor.rgb;`:S`tileColor.rgb;`}

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${t.pbrMode===_t.Terrain||t.pbrMode===_t.TerrainWithWater?S`gl_FragColor = vec4(evaluateTerrainLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:S`gl_FragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${a?S`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                float opacity = sliced ? sliceOpacity : 1.0;
                // un-gamma the ground color to mix in linear space
                gl_FragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
              }`:""}
          ${t.screenSizePerspective?S`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              gl_FragColor = mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${t.visualizeNormals?t.spherical?S`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  gl_FragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:S`
                  vec3 tNormal = normalize(normal);
                  gl_FragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:""}
          ${t.tileBorders?S`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          gl_FragColor = highlightSlice(gl_FragColor, vpos);
        }
      `)}break;case V.Depth:o&&e.include(sP,t),e.include(M_,t),pw(e),_2(e),r.code.add(S`
              void main(void) {
                ${o?S`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
              }
          `),i.code.add(S`
              void main() {
                ${o&&t.invisible?S`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
                outputDepth(linearDepth);
              }
          `);break;case V.Shadow:case V.ShadowHighlight:case V.ShadowExcludeHighlight:e.include(M_,t),pw(e),_2(e),r.code.add(S`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),i.code.add(S`void main() {
outputDepth(linearDepth);
}`);break;case V.Normal:o&&e.include(sP,t),n.add("vnormal","vec3"),YO(r),s(),r.code.add(S`
            void main(void) {
              ${o?S`setOverlayVTC(getUV0());`:""}
              gl_Position = transformPosition(proj, view, position);
              vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);
            }
        `),i.code.add(S`
            void main() {
              ${o&&t.invisible?S`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
              vec3 normal = normalize(vnormal);
              if (gl_FrontFacing == false) {
                normal = -normal;
              }
              gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
            }
        `);break;case V.Highlight:o&&e.include(sP,t),r.code.add(S`
          void main() {
            ${o?S`setOverlayVTC(getUV0());`:""}
            gl_Position = transformPosition(proj, view, position);
          }
        `),e.include(W_,t),i.code.add(S`
          void main() {
            ${o?S`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
            outputHighlight();
          }
        `)}return t.output===V.ObjectAndLayerIdColor&&(e.include(sP,{...t,pbrMode:_t.Disabled}),r.code.add(S`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),i.code.add(S`void main() {
gl_FragColor = getOverlayColorTexel(vtcOverlay);
}`)),e}const JDt=$e(),tbe=P(),KDt=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:yUe,build:ZDt},Symbol.toStringTag,{value:"Module"}));let _Ue=class vUe extends Wr{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(e,r){r.hasWebGL2Context=e.rctx.type===Et.WEBGL2,r.spherical=e.viewingMode===qe.Global}initializeProgram(e){return new Gr(e.rctx,vUe.shader.get().build(this.configuration),bUe)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(e){const r=this.configuration,i=r.backfaceCullingEnabled&&!r.renderOccluded;return Ht({blending:r.renderOccluded?bm(Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA):null,culling:i?Eae:null,depthTest:r.renderOccluded?null:{func:zi.LESS},depthWrite:r.renderOccluded?null:Xc,colorWrite:ir,stencilTest:e?nAt(jc.IntegratedMeshMaskExcluded):null})}getPipelineState(e,r){return this.useStencil?this._stencilPipelineState:super.getPipelineState(e,r)}};_Ue.shader=new jr(KDt,()=>Q(()=>import("./Terrain.glsl-589cfd21.js"),[]));const bUe=new Map([[O.POSITION,0],[O.UV0,1],[O.NORMALCOMPRESSED,2]]);let QDt=class{constructor(){this.geometryInfo=new XLt,this.intersectionData=null,this.geometryState=null,this._textureRef=new aUe(()=>this.tile.surface.textureFadeDuration),this.overlay=new UDt,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1,this._shadingChanged=!1,this._dirtyEdgeResolutions=15,this._dirtyEdges=15,this._dirtyCorners=15}get tile(){return this._tile}init(e){this.clear(),this._tile=e;const r=this.geometryInfo;r.indices=null,r.vertexAttributes=null,ki(r.boundingBox),r.indexCount=0,r.numVerticesPerSide=0,this.intersectionData=null,this.geometryState=new tDt,this.localOrigin=null,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(e){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this._wireframeChanged||this._shadingChanged||this._clippingAreaChanged||this._samplerDataChanged||this._numVerticesPerSideChanged||this._dirtyCorners||this._dirtyEdgeResolutions||this._dirtyEdges)&&(this._updateGeometry(e),this._geometryStateChangedSinceLastUpdate=!1),Zs&&this.tile.intersectsClippingArea)for(let r=0;r<4;++r)Re(this.geometryInfo.outerEdges[r].count===this.geometryState.neighborData.edgeResolutions[r]+1)}_calculateEdgeResolution(e,r){var l;const i=this.tile,n=this.geometryState.numVerticesPerSide-1;if(!i.surface.isGlobal){const c=i.surface.extent;if(v(c)&&(e===0&&i.extent[3]>c[3]||e===1&&i.extent[2]>c[2]||e===2&&i.extent[1]<c[1]||e===3&&i.extent[0]<c[0]))return n}const s=i.level,o=Ug[e];if(!r)return Re(R((l=i.surface)==null?void 0:l.rootTiles)||i.surface.updatingRootTiles||!i.shouldHaveNeighbor(o)),n;if(r.isLoaded){const c=r,h=c.renderData.geometryState,p=s-c.level;if(Re(p>=0),p===0){const g=h.numVerticesPerSide-1;return Math.max(g,n)}const f=2**p,m=h.neighborData.edgeResolutions[(e+2)%4]/f;return Math.max(1,m)}Re(!r.isLeaf);let a=n;return r.forAllSubtreeOnSide(HV(o),c=>c===i||(c.isLoaded?(a=Math.max(a,2**(c.level-s)),!0):(Re(!c.isLeaf),!1))),a}updateNeighborData(){var a;const e=this.tile;if(!e.intersectsClippingArea)return;const r=e.renderData.geometryState.neighborData,i=l=>(l.isLoaded||l.level===e.level)&&(l==null?void 0:l.intersectsClippingArea),n=r.edgePeerNeighbors,s=r.edgePeerNeighborSamplerVersions;for(let l=0;l<4;++l){const c=e.findNeighborTile(Ug[l],i),h=iS(e,c),p=((a=h==null?void 0:h.renderData)==null?void 0:a.geometryState.samplerDataVersion)??-1,f=n[l],m=h!==iS(e,f),g=s[l]!==p;n[l]=c,(m||g)&&(s[l]=p,this._markEdgeDirty(l));const _=r.edgeResolutions[l],b=this._calculateEdgeResolution(l,c);Re(lm(b)),Re(b>=1),r.edgeResolutions[l]=b,_!==b&&this._markEdgeResolutionDirty(l)}const o=r.cornerPeerNeighbors;for(let l=0;l<4;++l){const c=e.findNeighborTile(qV[l],i);o[l]=c;const h=iS(e,n[l]),p=iS(e,n[(l+1)%4]),f=iS(e,c);Jp[l]=f,Jp[(l+1)%4]=p,Jp[(l+2)%4]=e,Jp[(l+3)%4]=h,Re(Jp.some(b=>(b==null?void 0:b.isLoaded)||b===e));const m=Jp.reduce((b,w)=>Math.min(b,(w==null?void 0:w.level)??1/0),1/0);Jp.forEach((b,w)=>{b&&(b==null?void 0:b.level)>m&&(Jp[w]=null)}),Re(Jp.some(b=>(b==null?void 0:b.isLoaded)||b===e));const g=r.cornerNeighborData[l].cornerTiles,_=r.cornerNeighborData[l].cornerTileSamplerVersions;for(let b=0;b<4;++b){const w=Jp[b],x=(w==null?void 0:w.renderData.geometryState.samplerDataVersion)??-1,T=g[b]!==w,E=!T&&_[b]!==x;(T||E)&&(g[b]=w,_[b]=x,this._markCornerDirty(l))}Re(g.some(b=>(b==null?void 0:b.isLoaded)||b===e))}Zs&&Re(this.geometryState.neighborData.edgeResolutions.every(l=>l>0));for(let l=0;l<4;++l)Jp[l]=null}_updateGeometry(e){if(!this.tile.intersectsClippingArea)return;Zs&&Re(!this.tile.intersectsClippingArea||this.geometryState.neighborData.edgeResolutions.every(l=>l>0)),this.intersectionData=null;const r=this.tile,i=this._vao,n=this.geometryInfo.vertexAttributes,s=!i||!n||this._wireframeChanged||this._shadingChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||this._dirtyEdgeResolutions,o=!s&&(this._dirtyEdges!==0||this._dirtyEdgeResolutions!==0),a=!o&&this._dirtyCorners!==0;s?(this.releaseGeometry(),this._createGeometry(e)):o||a?r.updateEdgeElevations():a?r.updateCornerElevations():console.warn("Update for no reason?"),this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._dirtyEdgeResolutions=0,this._dirtyEdges=0,this._dirtyCorners=0,this._clippingAreaChanged=!1,this._wireframeChanged=!1,this._shadingChanged=!1}get hasGeometry(){return this._hasGeometry}releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao.dispose(),this._vao=null,JLt(this.geometryInfo),!0)}ensureTexture(e,r){return v(this._texture)&&this._texture.descriptor.width!==e&&this.releaseTexture(),R(this._texture)&&(this._texture=r(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){v(this._texture)&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}_markCornerDirty(e){const r=1<<e;this._dirtyCorners|=r}_markEdgeDirty(e){const r=1<<e;this._dirtyEdges|=r}_markEdgeResolutionDirty(e){const r=1<<e;this._dirtyEdgeResolutions|=r,this._dirtyEdges|=r}_markAllEdgesAndCornersDirty(){this._dirtyCorners=15,this._dirtyEdges=15,this._dirtyEdgeResolutions=15}updateGeometryState(){const e=this._getElevationInfo(),r=this.tile,i=e.samplerData?r.getElevationVerticesPerSide(e.maxTileLevel):r.getDefaultVerticesPerSide(),n=Math.max(i,5);let s=r.clippingArea;r.intersectsClippingArea&&!r.isWithinClippingArea||(s=null);const o=this.geometryState;let a=!1;o.numVerticesPerSide!==n&&(this._numVerticesPerSideChanged=!0,o.numVerticesPerSide=n,o.samplerDataVersion++,a=!0),e.changed&&(this._samplerDataChanged=!0,o.samplerData=e.samplerData,o.samplerDataVersion++,a=!0),g_(o.clippingArea,s)||(this._clippingAreaChanged=!0,o.clippingArea=s,a=!0);const l=r.surface,c=l.wireframe;o.wireframe!==c&&(this._wireframeChanged=!0,o.wireframe=c,a=!0);const h=l.shading;return o.shading!==h&&(this._shadingChanged=h,o.shading=h,a=h),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=a),a&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(e){this.tile.createGeometry();const r=this.geometryInfo.vertexAttributes,i=this.geometryInfo.indices,n=e.gl;this._vao=new wm(e,bUe,{geometry:eh(r.layout)},{geometry:Kr.createVertex(e,n.STATIC_DRAW,r.buffer)},Kr.createIndex(e,n.STATIC_DRAW,i)),this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(e,r=c_.Immediate){v(e)&&e.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(e,r)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const e=this.geometryState.samplerData,r=this.tile.layerInfo[vr.ELEVATION],i=r.length,n=new Array(i);let s=0,o=0,a=!1;for(let h=0;h<i;h++){const p=r[h];if(v(p.upsampleInfo)){const f=p.upsampleInfo.tile,m=f.layerInfo[vr.ELEVATION][h].data,g=m&&m.samplerData;e&&e[s]===g||(a=!0),n[s++]=g,o=Math.max(o,f.lij[0])}else if(p.data){const f=this.tile.surface.layerViewByIndex(h,vr.ELEVATION);if(oL(this.tile,f.layer,!1)){const m=p.data;e&&e[s]===m.samplerData||(a=!0),n[s++]=m.samplerData,o=this.tile.level}}}v(e)&&e.length!==s&&(a=!0);const l=s>0,c=l?n:null;return l&&(n.length=s),{changed:a,samplerData:c,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){var r,i;const e=kh(this.intersectionData,0,n=>n.estimatedMemoryUsage);return(((r=this.geometryInfo.indices)==null?void 0:r.byteLength)??0)+(((i=this.geometryInfo.vertexAttributes)==null?void 0:i.byteLength)??0)+e}get textureDescriptor(){return v(this._texture)?this._texture.descriptor:null}get test(){return{hasTexture:this._texture!=null}}checkGeometryWaterproofness(){if(!Zs)return;const e=this.tile;if(Re(e==null?void 0:e.isLoaded),!e.isLoaded||!e.intersectsClippingArea)return;const r=e.renderData;if(e.level===0)return;const i=e.surface.extent;if(v(i)&&!e.intersectsExtent(i))return;const n=Ug.map((l,c)=>!!v(i)&&(c<2?-1:1)*(e.extent[3-c]-i[3-c])<0),s=e.level;Re(this._dirtyCorners===0),Re(this._dirtyEdges===0),Re(this._dirtyEdgeResolutions===0),Re(!this._numVerticesPerSideChanged),Re(!this._samplerDataChanged),Re(!this._clippingAreaChanged),Re(!this._wireframeChanged);const o=qV.map(l=>e.findNeighborCornerTileExact(l,c=>!c.intersectsClippingArea||c.isLoaded||c.level===e.level)??null).map(l=>l!=null&&l.intersectsClippingArea?l:null),a=this.geometryState.neighborData;for(let l=0;l<4;++l){const c=a.cornerPeerNeighbors[l],h=o[l];Re(h===c,`Tile[${e.lij}].corner[${l}] out of date: cur=[${c==null?void 0:c.lij}] exp=[${h==null?void 0:h.lij}]`)}Ug.forEach((l,c)=>{if(n[c])return;const h=e.findNeighborTile(l,L=>(L.level===s||(L==null?void 0:L.isLoaded))&&(L==null?void 0:L.intersectsClippingArea));if(!h){const L=!e.surface.updatingRootTiles&&v(e.surface.rootTiles)&&e.surface.rootTiles.length>0&&e.shouldHaveNeighbor(l);return void Re(!L)}Re(h.isLoaded||h.level===e.level),Re(h===this.geometryState.neighborData.edgePeerNeighbors[c]);const p=s-h.level;if(!h.isLoaded)return Re(!h.isLeaf),void Re(p===0);const f=h.renderData;Re(kDt(e,h,l)),Re(p>=0);const m=2**p;if(p<0)return void Re(!1);const g=r.geometryInfo,_=g.outerEdges[c],b=g.numVerticesPerSide-1,w=f.geometryInfo;if(!w)return void Re(!1);{const L=this.geometryState.neighborData.edgePeerNeighbors[c];if(L!=null&&L.isLoaded){const F=L.renderData;Re(L==L),Re(r.geometryState.neighborData.edgePeerNeighborSamplerVersions[c]===F.geometryState.samplerDataVersion),Re(this.geometryState.neighborData.edgePeerNeighborSamplerVersions[c]===F.geometryState.samplerDataVersion)}}const x=(c+2)%4,T=w.outerEdges[x],E=_.count-1,C=T.count-1;Re(E*m===C,`Tile[${e.lij}]:e${c},res=${E} edgeRes mismatch with Neighbor[${h.lij}]:e${x},res=${C} (expected:${E*m})`);const A=e.extent,I=l===It.NORTH||l===It.SOUTH,M=T.count-1,D=M/2**p,U=_.count-1;if(D<1)return void Re(U===1);Re(D===U),Re(lm(D));const z=w.numVerticesPerSide-1;Re(p>0||D===Math.max(z,b));const B=e.getNeighborEdgeStartVertexIndex(c,h);Re(0<=B&&B<m);const ee=B*D;Re(0<=ee&&ee<=M-D);let te=0,K=ee;_.getVertexPos(Vm,0),_.getVertexPos(Bm,_.count-1);const W=Pi(Vm,Bm),N=Math.max(eNt,1e-4*W);for(let L=0;L<=D;++L){_.getVertexPos(Vm,te),T.getVertexPos(Bm,K);const F=L/D,G=I?A[0]+F*(A[2]-A[0]):l===It.WEST?A[0]:A[2],q=I?l===It.SOUTH?A[1]:A[3]:A[1]+F*(A[3]-A[1]),Z=e.surface.extent;if(R(Z)||z9(Z,G,q)){const X=yN(Vm,Bm),oe=Tu(Vm)-Cr.radius,pe=Tu(Bm)-Cr.radius,ye=X<N;if(!ye){console.warn(`Tile edge vertex position mismatch: between [${e.lij}].edge${c}[${te}/${_.count}] and [${h.lij}].edge${x}[${K}/${T.count}]`),v(Z)&&console.warn("  surface extent= ",Z," x,y=",G,",",q);const Se=P();ge(Se,r.localOrigin,f.localOrigin),Tu(Se)>0&&console.warn(`   localOrigins: ${r.localOrigin} vs ${f.localOrigin} d=${Tu(Se)} [${Se}]`),(()=>{const He=On(Vm),Le=On(Bm);e.updateEdgeElevations(),h.updateEdgeElevations(),_.getVertexPos(Vm,te),T.getVertexPos(Bm,K);const Te=P();Lo(Te,Vm,He),Tu(Te)>0&&console.warn(`  XXX Tile[${e.lij}] edge out of date: ${He} vs ${Vm} d=${Tu(Te)} [${Te}]`),Lo(Te,Bm,Le),Tu(Te)>0&&console.warn(`  XXX Neighbor[${h.lij}] edge out of date: ${Le} vs ${Bm} d=${Tu(Te)} [${Te}]`)})(),Re(ye,`Mismatch in tile [${e.lij}].edge[${c}][${te}/${_.count}] vs neighbor [${h.lij}].edge[${x}][${K}/${T.count}] ${qy(Vm)} vs ${qy(Bm)}  dist=${X} h(t|n|d)=${oe}|${pe}|${pe-oe}`)}if(e.surface.shading){_.getNormal(KE,te),T.getNormal(QE,K),we(rbe,KE),we(ibe,QE);const Se=ve(rbe,ibe),He=1-Se<.01||!1||e===h;if(!He){const Le=P();Lo(Le,KE,QE);const Te=()=>`Mismatch in tile edge normal ${$1e(e.lij)} (${te}/${_.count-1}) edge ${c} vs neighbor ${$1e(h.lij)}  (${K}/${T.count-1}) nedge ${x} :${qy(KE)} vs ${qy(QE)}  dot = ${Se} : ${qy(Le)}`;console.warn("Mismatch in tile edge normal: ",Te());{e.updateEdgeElevations(),h.updateEdgeElevations();const Fe=P(),Ve=P();_.getNormal(Fe,te),T.getNormal(Ve,K),Xb(KE,Fe)||console.warn("Missing update in tile normal: ",qy(KE)," => ",qy(Fe)),Xb(QE,Ve)||console.warn("Missing update in neighbor normal: ",qy(QE)," => ",qy(Ve))}Re(He,Te())}}}te+=1,K+=1}})}};const Vm=P(),Bm=P(),KE=P(),QE=P(),rbe=P(),ibe=P(),eNt=1,Jp=[null,null,null,null];function iS(t,e){return e!=null&&e.isLoaded||e===t?e:null}const tNt=65536;function rNt(t,e){const r=t.tile,{extent:i,extentInRadians:n,surface:s}=r,o=t.localOrigin,a=t.geometryState,l=s.isWebMercator,c=s.shading||R2,h=a.numVerticesPerSide,p=h-1,f=(h-2)**2,m=l&&(e===tp.HAS_SOUTH_POLE||e===tp.HAS_BOTH_POLES),g=l&&(e===tp.HAS_NORTH_POLE||e===tp.HAS_BOTH_POLES),_=6,b=((m?1:0)+(g?1:0))*_*(p+1),w=a.neighborData,x=w.edgeResolutions.reduce((M,D)=>M+D+1,0),T=oUe(f+b+x),E=t.geometryInfo;E.numVerticesPerSide=a.numVerticesPerSide,E.vertexAttributes=T;const C=E.boundingBox;ki(C);const A=Oce(t);Ts.update(p,n,A),iNt(t),OUe(t,f),wUe(t);const I=[];if((()=>{let M=f+x;const D=o[0],U=o[1],z=o[2],B=r.ellipsoid.radius,ee=i[1],te=i[3],K=(W,N)=>{const L=N*h;Xl(-D,-U,W*B-z,C),I.push({connectedRowOffset:L,connectedOuterEdgeOffset:W===1?0:2,rowOffset:M,latitudeResolution:_});const F=SUe(W===-1?ee:te,B),G=W*Math.PI/2-F,q=.99*(W===1?1:-1),Z=B+0,X=T.position,oe=T.uv0,pe=T.normalCompressed;for(let ye=1;ye<=_;++ye){const Se=F+G*(ye/_),He=Math.cos(Se),Le=Math.sin(Se);for(let Te=0;Te<=p;Te++){const Fe=Te/p,Ve=Ts.sinLonLUT[Te],bt=Ts.cosLonLUT[Te]*He,tt=Ve*He,jt=Le,Qt=bt*Z-D,nr=tt*Z-U,er=jt*Z-z;Xl(Qt,nr,er,C),X.setValues(M,Qt,nr,er),Hu(oe,M,Fe,q),c&&GD(pe,M,bt,tt,jt),++M}}};m&&K(-1,0),g&&K(1,p)})(),RUe(E,a.numVerticesPerSide,I,[0,h-1],[0,h-1],a.wireframe),t.intersectionData=null,Zs)for(let M=0;M<4;++M)Re(E.outerEdges[M].count===w.edgeResolutions[M]+1)}function iNt(t){const e=t.tile;e.intersectsClippingArea&&(e.surface.shading||R2?sNt(t):nNt(t))}function nNt(t){const e=t.geometryState,r=e.numVerticesPerSide,i=r-2,n=r-1,s=t.geometryInfo,o=s.vertexAttributes,a=o.position,l=o.uv0,c=t.tile,h=c.extent,p=h[0],f=h[2],m=h[1],g=h[3],_=c.ellipsoid.radius,b=e.samplerData,w=t.localOrigin,x=w[0],T=w[1],E=w[2],C=s.boundingBox,A=a.typedBuffer,I=a.typedBufferStride;let M=0;for(let D=1;D<=i;D++){const U=D/n,z=m*(1-U)+g*U,B=Ts.sinLatLUT[D],ee=Ts.cosLatLUT[D];for(let te=1;te<=i;te++){const K=te/n,W=p*(1-K)+f*K,N=Ts.sinLonLUT[te],L=Ts.cosLonLUT[te],F=_+tn(W,z,b),G=L*ee*F-x,q=N*ee*F-T,Z=B*F-E;Xl(G,q,Z,C);const X=M*I;A[X]=G,A[X+1]=q,A[X+2]=Z,Hu(l,M,K,U),++M}}}function sNt(t){const e=t.geometryState,r=e.numVerticesPerSide,i=r-2,n=r-1,s=t.geometryInfo,o=s.vertexAttributes,a=o.position,l=o.uv0,c=o.normalCompressed,h=t.tile,p=h.extent,f=p[0],m=p[2],g=p[1],_=p[3],b=h.ellipsoid.radius,w=e.samplerData,x=t.localOrigin,T=x[0],E=x[1],C=x[2],A=a.typedBuffer,I=a.typedBufferStride,M=1/n,D=s.boundingBox;let U=0;if(1<=i){const z=M,B=g*(1-z)+_*z,ee=Ts.sinLatLUT[1],te=Ts.cosLatLUT[1];for(let K=1;K<=i;K++){const W=K*M,N=f*(1-W)+m*W,L=Ts.sinLonLUT[K],F=Ts.cosLonLUT[K],G=b+tn(N,B,w),q=G*F*te-T,Z=G*L*te-E,X=G*ee-C;Xl(q,Z,X,D);const oe=(K-1)*I;A[oe]=q,A[oe+1]=Z,A[oe+2]=X,Hu(l,K-1,W,z)}}for(let z=1;z<=i;z++){const B=z*M,ee=g*(1-B)+_*B,te=Ts.sinLatLUT[z],K=Ts.cosLatLUT[z],W=z+1,N=W*M,L=g*(1-N)+_*N,F=Ts.sinLatLUT[W],G=Ts.cosLatLUT[W],q=Ts.sinLonLUT[0],Z=Ts.cosLonLUT[0],X=b+tn(f,ee,w);let oe=Z*K*X-T,pe=q*K*X-E,ye=te*X-C;const Se=U*I;let He=A[Se],Le=A[Se+1],Te=A[Se+2];for(let Fe=1;Fe<=i;Fe++){const Ve=Fe*M,bt=f*(1-Ve)+m*Ve,tt=Ts.sinLonLUT[Fe],jt=Ts.cosLonLUT[Fe];let Qt=jt*K,nr=tt*K,er=te,wr=0,ni=0,Pr=0;{let ot=0,et=0,pt=0;if(Fe<i){const Dr=(U+1)*I;ot=A[Dr],et=A[Dr+1],pt=A[Dr+2]}else{const Dr=Ts.sinLonLUT[n],Nr=Ts.cosLonLUT[n],Fr=b+tn(m,ee,w);ot=Nr*K*Fr-T,et=Dr*K*Fr-E,pt=te*Fr-C}const gt=oe,Rt=pe,Yt=ye;oe=He,pe=Le,ye=Te,He=ot,Le=et,Te=pt,wr=ot-gt,ni=et-Rt,Pr=pt-Yt}{let ot=0,et=0,pt=0;if(z>1){const gt=(U-i)*I;ot=A[gt],et=A[gt+1],pt=A[gt+2]}else{const gt=Ts.sinLatLUT[0],Rt=Ts.cosLatLUT[0],Yt=b+tn(bt,g,w);ot=jt*Rt*Yt-T,et=tt*Rt*Yt-E,pt=gt*Yt-C}{const gt=b+tn(bt,L,w),Rt=jt*G*gt-T,Yt=tt*G*gt-E,Dr=F*gt-C;if(z<i){const Li=U+i,hr=Li*I;A[hr]=Rt,A[hr+1]=Yt,A[hr+2]=Dr,Xl(Rt,Yt,Dr,D),Hu(l,Li,Ve,N)}const Nr=ot-Rt,Fr=et-Yt,kr=pt-Dr;er*er<.999&&(Qt=Pr*Fr-ni*kr,nr=wr*kr-Pr*Nr,er=ni*Nr-wr*Fr)}}const Or=1/Math.sqrt(Qt*Qt+nr*nr+er*er);GD(c,U,Qt*Or,nr*Or,er*Or),++U}}}function oNt(t){t.tile.intersectsClippingArea&&(wUe(t),z7(t))}function aNt(t){t.tile.intersectsClippingArea&&(TUe(t),xUe(t,!0),z7(t))}function wUe(t){t.tile.intersectsClippingArea&&(TUe(t),xUe(t))}function xUe(t,e=!1){const r=t.geometryState,i=t.geometryInfo,n=r.neighborData,s=t.tile,o=s.level,a=s.extent,l=s.ellipsoid.radius,c=s.extentInRadians,h=c[0],p=c[2],f=c[1],m=c[3],g=r.samplerData,_=a[0],b=a[2],w=a[1],x=a[3],T=Oce(t),E=i.boundingBox,C=t.localOrigin,A=C[0],I=C[1],M=C[2],D=s.surface.shading||R2,U=i.vertexAttributes,z=U.position,B=z.typedBuffer,ee=z.typedBufferStride,te=U.uv0;for(let K=0;K<4;++K){const W=K===1||K===3,N=n.edgeResolutions[K];Re(lm(N));const L=N+1,F=iS(s,n.edgePeerNeighbors[K]);if(IUe(s,F,K)){MUe(t,K,F);continue}const G=v(F);Re(!G||F.level===s.level),Re(!G||u_(s,F)<=0);const q=F==null?void 0:F.renderData,Z=q==null?void 0:q.geometryState;if(Zs){const et=s.surface;if(!F&&et&&!et.updatingRootTiles){const pt=Ug[K],gt=s.findNeighborTile(pt,Rt=>Rt.isLoaded||Rt.isLeaf||Rt.level===s.level);gt?gt.intersectsClippingArea&&(Re(!gt.isLoaded),Re(!gt.isLeaf),Re(gt.level===o)):Re(R(et==null?void 0:et.rootTiles)||!s.shouldHaveNeighbor(pt))}}const X=K===1?a[2]:a[0],oe=F==null?void 0:F.extent,pe=oe&&W?K===1?oe[0]:oe[2]:X,ye=K===0?a[3]:a[1],Se=K===1?1:0,He=K===0?1:0,Le=K===1?p:h,Te=K===0?m:f,Fe=Math.sin(Le),Ve=Math.cos(Le),bt=Math.sin(Te),tt=Math.cos(Te),jt=Z==null?void 0:Z.samplerData,Qt=G?(et,pt,gt)=>.5*(tn(et,pt,g)+tn(gt,pt,jt)):(et,pt,gt)=>tn(et,pt,g),nr=i.outerEdges[K],er=e&&L>3?L-3:1,wr=v(g)&&g.some(et=>et!=null),ni=v(jt)&&jt.some(et=>et!=null),Pr=wr||ni,Or=1/N,ot=nr.index0;D?(Re(!oe||rp(oe[2]-oe[0],a[2]-a[0])),(()=>{const et=K===1?-1:K===3?1:0,pt=K===0?-1:K===2?1:0,gt=(a[2]-a[0])*Or,Rt=et*gt,Yt=pt*gt,Dr=W?et*((p-h)*Or):0,Nr=W?0:pt*Or,Fr=He,kr=W?Le+Dr:Le,Li=W?Math.sin(kr):Fe,hr=W?Math.cos(kr):Ve,Ar=W?Le-Dr:Le,xr=W?Math.sin(Ar):Fe,Dn=W?Math.cos(Ar):Ve,hi=W?Te:T(Fr+Nr),sn=W?bt:Math.sin(hi),Di=W?tt:Math.cos(hi),Yi=W?Te:T(Fr-Nr),En=W?bt:Math.sin(Yi),Kn=W?tt:Math.cos(Yi);let Bo=0,go=0,Nn=0;{const di=0*Or,wa=W?X:_*(1-di)+b*di,Ql=W?pe:wa,de=W?w*(1-di)+x*di:ye,Si=W?Le:h*(1-di)+p*di,Up=W?Fe:Math.sin(Si),Ha=W?Ve:Math.cos(Si),th=W?T(di):Te,yt=W?Math.sin(th):bt,Jc=W?Math.cos(th):tt,gn=l+Qt(wa,de,Ql);Bo=Ha*Jc*gn,go=Up*Jc*gn,Nn=yt*gn}let on=0,an=0,Fn=0;{const di=1*Or,wa=W?X:_*(1-di)+b*di,Ql=W?pe:wa,de=W?w*(1-di)+x*di:ye,Si=W?Le:h*(1-di)+p*di,Up=W?Fe:Math.sin(Si),Ha=W?Ve:Math.cos(Si),th=W?T(di):Te,yt=W?Math.sin(th):bt,Jc=W?Math.cos(th):tt,gn=l+Qt(wa,de,Ql);on=Ha*Jc*gn,an=Up*Jc*gn,Fn=yt*gn}for(let di=1;di<L-1;di+=er){let wa=0,Ql=0,de=0;{const xa=(di+1)*Or,ud=W?X:_*(1-xa)+b*xa,hd=W?pe:ud,pi=W?w*(1-xa)+x*xa:ye,Sm=W?Le:h*(1-xa)+p*xa,Ay=W?Fe:Math.sin(Sm),Y2=W?Ve:Math.cos(Sm),Vw=W?T(xa):Te,Z2=W?Math.sin(Vw):bt,Bw=W?Math.cos(Vw):tt,ev=l+Qt(ud,pi,hd);wa=Y2*Bw*ev,Ql=Ay*Bw*ev,de=Z2*ev}const Si=wa,Up=Ql,Ha=de,th=on,yt=an,Jc=Fn;on=Si,an=Up,Fn=Ha;{const xa=ot+di,ud=xa*ee,hd=th-A,pi=yt-I,Sm=Jc-M;B[ud]=hd,B[ud+1]=pi,B[ud+2]=Sm,Xl(hd,pi,Sm,E);const Ay=di*Or;Hu(te,xa,W?Se:Ay,W?Ay:He)}const gn=Bo,zw=go,q7=Nn;Bo=th,go=yt,Nn=Jc;const ec=th,J_=yt,Ey=Jc,sr=1/Math.sqrt(ec*ec+J_*J_+Ey*Ey),oF=Ey*sr;let Cy=0,K_=0,Q_=0;if(Pr&&oF*oF<.999){let xa=0,ud=0,hd=0;{const pi=K===0?-1:1;xa=pi*(Si-gn),ud=pi*(Up-zw),hd=pi*(Ha-q7)}{const pi=di*Or,Sm=W?X:_*(1-pi)+b*pi,Ay=W?pe:Sm,Y2=W?w*(1-pi)+x*pi:ye,Vw=W?Le:h*(1-pi)+p*pi,Z2=W?Fe:Math.sin(Vw),Bw=W?Ve:Math.cos(Vw),ev=W?T(pi):Te,tc=W?Math.sin(ev):bt,aF=W?Math.cos(ev):tt;let q3=ec,Y=J_,xe=Ey;if(G){const Oe=l+tn(Ay-Rt,Y2-Yt,jt),_r=W?aF:Kn;q3=(W?Dn:Bw)*_r*Oe,Y=(W?xr:Z2)*_r*Oe,xe=(W?tc:En)*Oe}{const Oe=l+tn(Sm+Rt,Y2+Yt,g),_r=W?aF:Di,yo=(W?hr:Bw)*_r*Oe,kn=(W?Li:Z2)*_r*Oe,rc=(W?tc:sn)*Oe;G||(q3=2*ec-yo,Y=2*J_-kn,xe=2*Ey-rc);const tv=K===3?-1:1,Uce=tv*(q3-yo),zce=tv*(Y-kn),Vce=tv*(xe-rc);Cy=hd*zce-ud*Vce,K_=xa*Vce-hd*Uce,Q_=ud*Uce-xa*zce;const W7=1/Math.sqrt(Cy*Cy+K_*K_+Q_*Q_);Cy*=W7,K_*=W7,Q_*=W7}}}else Cy=ec*sr,K_=J_*sr,Q_=Ey*sr;nr.setNormalFromValues(di,Cy,K_,Q_)}})()):(()=>{for(let et=1;et<L-1;et+=er){const pt=et*Or,gt=W?Se:pt,Rt=W?pt:He,Yt=W?X:_*(1-pt)+b*pt,Dr=W?w*(1-pt)+x*pt:ye,Nr=W?pe:Yt,Fr=W?Le:h*(1-pt)+p*pt,kr=W?Fe:Math.sin(Fr),Li=W?Ve:Math.cos(Fr),hr=W?T(pt):Te,Ar=W?Math.sin(hr):bt,xr=W?Math.cos(hr):tt,Dn=Qt(Yt,Dr,Nr),hi=l+Dn,sn=Li*xr*hi-A,Di=kr*xr*hi-I,Yi=Ar*hi-M;Xl(sn,Di,Yi,E);const En=ot+et,Kn=En*ee;B[Kn]=sn,B[Kn+1]=Di,B[Kn+2]=Yi,Hu(te,En,gt,Rt)}})()}}function TUe(t){PUe(t)}function SUe(t,e){return Math.PI/2-2*Math.atan(Math.exp(-t/e))}function lNt(t,e,r,i){return SUe(t*(1-i)+e*i,r)}function cNt(t,e,r){return t*(1-r)+e*r}function Oce(t){const e=t.tile;if(e.surface.isWebMercator){const i=e.extent,n=e.ellipsoid.radius;return s=>lNt(i[1],i[3],n,s)}const r=e.extentInRadians;return i=>cNt(r[1],r[3],i)}function uNt(t,e){const r=t.tile.extent,i=t.geometryState,n=r[0],s=r[1],o=r[2]-n,a=r[3]-s,l=i.clippingArea,c=v(l)?Math.max(0,(l[0]-n)/o):0,h=v(l)?Math.max(0,(l[1]-s)/a):0,p=v(l)?Math.min(1,(l[2]-n)/o):1,f=v(l)?Math.min(1,(l[3]-s)/a):1,m=i.numVerticesPerSide,g=(m-2)**2,_=i.neighborData.edgeResolutions.reduce((T,E)=>T+E+1,0),b=oUe(g+_),w=t.geometryInfo,x=w.boundingBox;ki(x),w.numVerticesPerSide=i.numVerticesPerSide,w.vertexAttributes=b,ai(w.uvRange,c,h,p,f),hNt(t),OUe(t,g),EUe(t),RUe(w,i.numVerticesPerSide,[],[0,m-1],[0,m-1],i.wireframe),t.intersectionData=null}function hNt(t){const e=t.tile;e.intersectsClippingArea&&(e.surface.shading?pNt(t):dNt(t))}function dNt(t){const e=t.geometryState,r=e.samplerData,i=t.tile,n=i.surface,s=t.localOrigin,o=n.isWebMercatorOnPlateeCarree,a=e.clippingArea,l=v(a)?a:V7,c=i.extent,h=c[0],p=c[1],f=c[2],m=c[3],g=Math.max(h,l[0]),_=Math.min(f,l[2]),b=Math.max(p,l[1]),w=Math.min(m,l[3]),x=s[0],T=s[1],E=s[2],C=i.ellipsoid.radius,A=i.horizontalScale,I=Mce(o,C,A),M=e.numVerticesPerSide,D=M-1,U=M-2,z=t.geometryInfo,B=z.uvRange,ee=B[0],te=B[1],K=B[2],W=B[3],N=z.boundingBox,L=z.vertexAttributes,F=L.position,G=L.uv0;let q=0;for(let Z=1;Z<=U;Z++){const X=Z/D,oe=_e(p*(1-X)+m*X,b,w),pe=_e(X,te,W),ye=I(oe)-T;for(let Se=1;Se<=U;Se++){const He=Se/D,Le=_e(h*(1-He)+f*He,g,_),Te=_e(He,ee,K),Fe=Le*A-x,Ve=tn(Le,oe,r)-E;Xl(Fe,ye,Ve,N),F.setValues(q,Fe,ye,Ve),Hu(G,q,Te,pe),++q}}}function pNt(t){const e=t.tile,r=e.surface;if(!(r.shading||R2))return;const i=t.geometryState,n=i.samplerData,s=t.localOrigin,o=r.isWebMercatorOnPlateeCarree,a=i.clippingArea,l=v(a)?a:V7,c=e.extent,h=c[0],p=c[1],f=c[2],m=c[3],g=Math.max(h,l[0]),_=Math.min(f,l[2]),b=Math.max(p,l[1]),w=Math.min(m,l[3]),x=e.ellipsoid.radius,T=e.horizontalScale,E=i.numVerticesPerSide,C=E-1,A=E-2,I=t.geometryInfo,M=I.vertexAttributes,D=M.position,U=M.uv0,z=M.normalCompressed,B=I.uvRange,ee=B[0],te=B[1],K=B[2],W=B[3],N=I.boundingBox,L=s[0],F=s[1],G=s[2],q=D.typedBuffer,Z=D.typedBufferStride;let X=0;const oe=_e(p,b,w),pe=o?(Math.PI/2-2*Math.atan(Math.exp(-oe/x)))*x:oe*T,ye=1/C,Se=_e(p*(1-ye)+m*ye,b,w);let He=pe,Le=o?(Math.PI/2-2*Math.atan(Math.exp(-Se/x)))*x:Se*T;for(let Te=1;Te<=A;Te++){const Fe=Te/C,Ve=_e(p*(1-Fe)+m*Fe,b,w),bt=_e(Fe,te,W),tt=Le,jt=(Te-1)/C,Qt=_e(p*(1-jt)+m*jt,b,w),nr=He,er=(Te+1)/C,wr=_e(p*(1-er)+m*er,b,w),ni=o?(Math.PI/2-2*Math.atan(Math.exp(-wr/x)))*x:wr*T,Pr=_e(er,te,W);He=Le,Le=ni;const Or=_e(h,g,_);let ot=Or*T,et=tn(Or,Ve,n);const pt=1/C,gt=_e(pt,ee,K),Rt=_e(h*(1-gt)+f*gt,g,_);let Yt=gt,Dr=Rt,Nr=Rt*T,Fr=tn(Rt,Ve,n);if(Te===1){const kr=Nr-L,Li=He-F,hr=Fr-G,Ar=0*Z;q[Ar]=kr,q[Ar+1]=Li,q[Ar+2]=hr,Xl(kr,Li,hr,N);const xr=_e(pt,ee,K);Hu(U,X,xr,bt)}for(let kr=1;kr<=A;kr++){const Li=Nr,hr=Fr,Ar=(kr+1)/C,xr=_e(Ar,ee,K),Dn=_e(h*(1-Ar)+f*Ar,g,_),hi=Dr;Dr=Dn;{const Nn=X+1,on=Nn*Z;if(Te===1||kr===A){const an=Dn*T,Fn=tn(Dn,Ve,n);if(Te===1&&kr<A){const di=an-L,wa=tt-F,Ql=Fn-G;q[on]=di,q[on+1]=wa,q[on+2]=Ql,Xl(di,wa,Ql,N),Hu(U,Nn,xr,bt)}Nr=an,Fr=Fn}else Nr=q[on]+L,Fr=q[on+2]+G}const sn=Nr,Di=Fr,Yi=ot,En=et;ot=Li,et=hr;const Kn=(X-A)*Z,Bo=Te===1?tn(hi,Qt,n):q[Kn+2]+G,go=tn(hi,wr,n);if(Te<A){const Nn=X+A,on=Nn*Z,an=Li-L,Fn=ni-F,di=go-G;q[on]=an,q[on+1]=Fn,q[on+2]=di,Xl(an,Fn,di,N);const wa=Yt;Yt=xr,Hu(U,Nn,wa,Pr)}{const Nn=sn-Yi,on=nr-ni,an=on*(Di-En),Fn=Nn*(Bo-go),di=-on*Nn,wa=an*an+Fn*Fn+di*di;if(wa===0)GD(z,X,0,0,1);else{const Ql=1/Math.sqrt(wa);GD(z,X,an*Ql,Fn*Ql,di*Ql)}}++X}}}function fNt(t,e){t.tile.intersectsClippingArea&&(AUe(t),CUe(t,!0),z7(t))}function mNt(t,e){t.tile.intersectsClippingArea&&(EUe(t),z7(t))}function EUe(t,e){t.tile.intersectsClippingArea&&(AUe(t),CUe(t,!1))}function CUe(t,e){const r=t.geometryState,i=r.neighborData,n=t.tile,s=n.surface,o=s.shading||R2,a=n.extent,l=r.clippingArea,c=v(l)?l:V7,h=a[0],p=a[2],f=a[1],m=a[3],g=[m>c[3],p>c[2],f<c[1],h<c[0]],_=t.geometryInfo,b=n.horizontalScale,w=Mce(s.isWebMercatorOnPlateeCarree,n.ellipsoid.radius,b),x=_.boundingBox,T=_.uvRange[0],E=_.uvRange[1],C=_.uvRange[2],A=_.uvRange[3],I=Math.max(h,c[0]),M=Math.min(p,c[2]),D=Math.max(f,c[1]),U=Math.min(m,c[3]),z=t.localOrigin,B=z[0],ee=z[1],te=z[2],K=r.samplerData;for(let W=0;W<4;++W){const N=W===1||W===3,L=i.edgeResolutions[W];Re(lm(L));const F=L+1,G=g[W],q=iS(n,i.edgePeerNeighbors[W]);if(!G&&IUe(n,q,W)){MUe(t,W,q);continue}const Z=v(q)&&!G,X=q==null?void 0:q.renderData,oe=X==null?void 0:X.geometryState;if(Zs&&(Re(!Z||q.level===n.level),Re(!Z||u_(n,q)<=0),n&&!q&&!s.updatingRootTiles)){const bt=Ug[W],tt=n.findNeighborTile(bt,jt=>jt.isLoaded||jt.isLeaf||jt.level===n.level);s.updatingRootTiles||(tt?tt.intersectsClippingArea&&(Re(!tt.isLoaded),Re(!tt.isLeaf),Re(tt.level===n.level)):Re(R(s==null?void 0:s.rootTiles)||!n.shouldHaveNeighbor(bt)))}const pe=_e(W===1?p:h,I,M),ye=_e(W===0?m:f,D,U),Se=oe==null?void 0:oe.samplerData,He=_.outerEdges[W],Le=e&&F>3?F-3:1,Te=_e(W===1?1:0,T,C),Fe=_e(W===0?1:0,E,A),Ve=Z?(bt,tt)=>.5*(tn(bt,tt,Se)+tn(bt,tt,K)):(bt,tt)=>tn(bt,tt,K);if(o){const bt=(p-h)/L,tt=N?W===1?bt:-bt:0,jt=N?0:W===0?bt:-bt,Qt=-tt,nr=-jt;let er=0,wr=0,ni=0;{const et=0/L,pt=N?pe:_e(h*(1-et)+p*et,I,M),gt=N?_e(f*(1-et)+m*et,D,U):ye,Rt=Ve(pt,gt);er=pt*b,wr=w(gt),ni=Rt}let Pr=0,Or=0,ot=0;{const et=1/L,pt=N?pe:_e(h*(1-et)+p*et,I,M),gt=N?_e(f*(1-et)+m*et,D,U):ye,Rt=Ve(pt,gt);Pr=pt*b,Or=w(gt),ot=Rt}for(let et=1;et<F-1;et+=Le){const pt=et/L,gt=Pr,Rt=Or,Yt=ot;{const hi=N?Te:_e(pt,T,C),sn=N?_e(pt,E,A):Fe,Di=gt-B,Yi=Rt-ee,En=Yt-te;Xl(gt,Yi,En,x),He.setVertexFromValuesRawPositionUV(et,Di,Yi,En,hi,sn)}{const hi=(et+1)/L,sn=N?pe:_e(h*(1-hi)+p*hi,I,M),Di=N?_e(f*(1-hi)+m*hi,D,U):ye,Yi=Ve(sn,Di);Pr=sn*b,Or=w(Di),ot=Yi}const Dr=Pr,Nr=ot,Fr=er,kr=wr,Li=ni;er=gt,wr=Rt,ni=Yt;let hr=0,Ar=0,xr=0;if(N){const hi=Or-Rt,sn=Nr-Yt,Di=kr-Rt,Yi=Li-Yt,En=_e(f*(1-pt)+m*pt,D,U),Kn=pe+Qt,Bo=Kn*b-gt,go=tn(Kn,En,K)-Yt,Nn=W===3?-1:1;if(hr=Nn*(-Di+hi)*go,Ar=Nn*Bo*(-Yi+sn),xr=-Nn*Bo*(-Di+hi),Z){const on=pe+tt,an=on*b-gt;hr=(-Di+hi)*(go-(tn(on,En,Se)-Yt)),Ar=(Bo-an)*(-Yi+sn),xr=-(Bo-an)*(-Di+hi)}}else{const hi=Dr-gt,sn=Nr-Yt,Di=Fr-gt,Yi=Li-Yt,En=_e(h*(1-pt)+p*pt,I,M),Kn=ye+nr,Bo=tn(En,Kn,K)-Yt,go=w(Kn)-Rt,Nn=W===2?-1:1;if(hr=Nn*go*(-Yi+sn),Ar=Nn*(-Di+hi)*Bo,xr=-Nn*go*(-Di+hi),Z){const on=En,an=ye+jt,Fn=w(an)-Rt;hr=(-go+Fn)*(-Yi+sn),Ar=(-Di+hi)*(-Bo+(tn(on,an,Se)-Yt)),xr=-(-go+Fn)*(-Di+hi)}}const Dn=1/Math.sqrt(hr*hr+Ar*Ar+xr*xr);He.setNormalFromValues(et,hr*Dn,Ar*Dn,xr*Dn)}}else for(let bt=1;bt<F-1;bt+=Le){const tt=bt/L,jt=N?pe:_e(h*(1-tt)+p*tt,I,M),Qt=N?_e(f*(1-tt)+m*tt,D,U):ye,nr=N?Te:_e(tt,T,C),er=N?_e(tt,E,A):Fe,wr=Ve(jt,Qt),ni=jt*b-B,Pr=w(Qt)-ee,Or=wr-te;Xl(ni,Pr,Or,x),He.setVertexFromValuesRawPositionUV(bt,ni,Pr,Or,nr,er)}}}function AUe(t,e){PUe(t)}function gNt(t,e){return(Math.PI/2-2*Math.atan(Math.exp(-t/e)))*e}function yNt(t,e){return t*e}function Mce(t,e,r){return t?i=>gNt(i,e):i=>yNt(i,r)}function RUe(t,e,r,i,n,s){const o=e-1,a=t.vertexAttributes.count,l=2*(Math.min(e-2,i[1])-Math.max(1,i[0]))*(Math.min(e-2,n[1])-Math.max(1,n[0])),c=Ug.map((T,E)=>E===0&&n[1]<e-2||E===1&&i[1]<e-2||E===2&&n[0]>1||E===3&&i[0]>1),h=t.outerEdges.reduce((T,E,C)=>T+(c[C]?0:o-2+E.count-1),0),p=r.reduce((T,E)=>T+o*(2*(E.latitudeResolution-1)+1),0),f=s?2:1,m=3*(l+h+p)*f,g=a>=tNt?new Uint32Array(m):new Uint16Array(m);let _=0;const b=e-2,w=o-2;Re(w>=0);const x=(T,E,C,A,I,M)=>{const D=T*I,U=M[D],z=M[D+1],B=M[D+2],ee=E*I,te=M[ee],K=M[ee+1],W=M[ee+2],N=C*I,L=M[N],F=M[N+1],G=M[N+2],q=A*I,Z=M[q],X=M[q+1],oe=M[q+2];return(te-Z)*(te-Z)+(K-X)*(K-X)+(W-oe)*(W-oe)>(U-L)*(U-L)+(z-F)*(z-F)+(B-G)*(B-G)};if(s){const T=(C,A,I)=>{g[_++]=C,g[_++]=A,g[_++]=A,g[_++]=I,g[_++]=I,g[_++]=C,Zs&&(Re(C<a),Re(A<a),Re(I<a),Re(_<=m))};(()=>{for(let C=Math.max(n[0],1)-1;C<Math.min(n[1],e-2)-1;++C){const A=C*b;for(let I=Math.max(i[0],1)-1;I<Math.min(i[1],e-2)-1;++I){const M=C*b+I,D=M+1,U=D+b,z=U-1,B=A+I,ee=B+1,te=ee+b,K=te-1,W=t.vertexAttributes.position.typedBuffer,N=t.vertexAttributes.position.typedBufferStride;x(B,ee,te,K,N,W)?(T(M,D,U),T(U,z,M)):(T(M,D,z),T(z,U,D))}}})(),Re(_===3*l*f),(()=>{for(let C=0;C<4;++C){const A=_;if(c[C])continue;const I=t.outerEdges[C],M=t.innerEdges[C];let D=0,U=0;const z=I.count,B=M.count;Re(B===o-1);let ee=0;const te=C===1||C===2?(K,W,N)=>T(K,W,N):(K,W,N)=>T(K,N,W);for(;D<z-1||U<B-1;){const K=M.getVertexIndex(U),W=I.getVertexIndex(D),N=D<z-1,L=U<B-1;N&&(!L||(N?0+o*(D+.5)/(z-1):0)<=(L?1+w*(U+.5)/(B-1):0))?(++D,Zs&&Re(D<z),te(K,W,I.getVertexIndex(D)),ee++):(++U,Zs&&Re(U<B),te(K,W,M.getVertexIndex(U)),ee++)}Zs&&(Re(D===z-1),Re(U===B-1),Re(ee===z+B-2),Re(ee===o-2+I.count-1),Re(_===A+3*ee*f))}})(),Re(_===3*(l+h)*f);const E=C=>{const A=t.outerEdges[C.connectedOuterEdgeOffset];let I=A.getVertexIndex(0),M=A.stride;for(let D=0;D<C.latitudeResolution;++D){const U=D===0?C.rowOffset:I+e;for(let z=0;z<o;z++)T(I,I+1,U+z),D<C.latitudeResolution-1&&T(I+1,U+z+1,U+z),I+=M;I=U,M=1}};r.forEach(E)}else{(()=>{const E=Math.max(n[0],1)-1,C=Math.min(n[1],e-2)-1,A=Math.max(i[0],1)-1,I=Math.min(i[1],e-2)-1;for(let M=E;M<C;++M){const D=M*b;for(let U=A;U<I;++U){const z=D+U,B=z+1,ee=B+b,te=ee-1,K=t.vertexAttributes.position.typedBuffer,W=t.vertexAttributes.position.typedBufferStride;x(z,B,ee,te,W,K)?(g[_]=z,g[_+1]=B,g[_+2]=ee,g[_+3]=ee,g[_+4]=te,g[_+5]=z):(g[_]=z,g[_+1]=B,g[_+2]=te,g[_+3]=te,g[_+4]=B,g[_+5]=ee),_+=6}}})(),Re(_===3*l*f),(()=>{for(let E=0;E<4;++E){if(c[E])continue;const C=t.outerEdges[E],A=t.innerEdges[E];let I=0,M=0;const D=C.count,U=A.count;Re(U===o-1);const z=E===1||E===2,B=z?1:2,ee=z?2:1,te=C.index0,K=C.stride,W=A.index0,N=A.stride;for(;I<D-1||M<U-1;){const L=W+M*N,F=te+I*K,G=I<D-1,q=M<U-1,Z=G&&(!q||(G?0+o*(I+.5)/(D-1):0)<=(q?1+w*(M+.5)/(U-1):0));Z?++I:++M;const X=Z?F+K:L+N;g[_]=L,g[_+B]=F,g[_+ee]=X,_+=3}}})(),Re(_===3*(l+h)*f);const T=E=>{const C=t.outerEdges[E.connectedOuterEdgeOffset];let A=C.getVertexIndex(0),I=C.stride;for(let M=0;M<E.latitudeResolution;++M){const D=M===0?E.rowOffset:A+e;for(let U=0;U<o;U++){const z=D+U;g[_]=A,g[_+1]=A+1,g[_+2]=z,M<E.latitudeResolution-1?(g[_+3]=A+1,g[_+4]=z+1,g[_+5]=z,_+=6):_+=3,A+=I}A=D,I=1}};r.forEach(T)}Re(_===m),t.indices=g,t.indexCount=m}function OUe(t,e){const r=t.localOrigin,i=t.geometryInfo,n=t.geometryState.neighborData.edgeResolutions,s=i.numVerticesPerSide-2,o=i.vertexAttributes;let a=e;for(let l=0;l<4;++l){{const c=l===0||l===2,h=(l===0?s-1:0)*s+(l===1?s-1:0),p=(c?0:1)*s+(c?1:0);i.innerEdges[l]=new G1e(o,r,h,p,s)}{const c=a,h=n[l]+1;i.outerEdges[l]=new G1e(o,r,c,1,h),a+=h}}}function MUe(t,e,r){const i=(e+2)%4,n=t.geometryState,s=t.tile,o=n.neighborData,a=s.level-r.level,l=e===1||e===3,c=o.edgeResolutions[e];Re(lm(c));const h=c+1,p=t.geometryInfo,f=p.boundingBox,m=p.outerEdges[e],g=p.uvRange[0],_=p.uvRange[1],b=p.uvRange[2],w=p.uvRange[3],x=_e(e===1?1:0,g,b),T=_e(e===0?1:0,_,w),E=r.renderData,C=E.geometryState,A=E.geometryInfo.outerEdges[i],I=s.getNeighborEdgeStartVertexIndex(e,r)*c,M=c*2**a;Re(C.neighborData.edgeResolutions[i]===M),Re(A.count-1===M);const D=E.localOrigin[0]-t.localOrigin[0],U=E.localOrigin[1]-t.localOrigin[1],z=E.localOrigin[2]-t.localOrigin[2],B=m.attributes,ee=m.index0,te=m.stride,K=B.position.typedBuffer,W=B.position.typedBufferStride,N=B.normalCompressed.typedBuffer,L=B.normalCompressed.typedBufferStride,F=B.uv0,G=A.attributes,q=A.index0,Z=A.stride,X=G.position.typedBuffer,oe=G.position.typedBufferStride,pe=G.normalCompressed.typedBuffer,ye=G.normalCompressed.typedBufferStride;for(let Se=1;Se<h-1;++Se){const He=ee+te*Se,Le=q+Z*(I+Se),Te=He*W,Fe=Le*oe,Ve=X[Fe]+D,bt=X[Fe+1]+U,tt=X[Fe+2]+z;K[Te]=Ve,K[Te+1]=bt,K[Te+2]=tt,Xl(Ve,bt,tt,f);const jt=He*L,Qt=Le*ye;N[jt]=pe[Qt],N[jt+1]=pe[Qt+1];const nr=Se/c,er=l?x:_e(nr,g,b),wr=l?_e(nr,_,w):T;Hu(F,He,er,wr)}}function PUe(t){var Fe;const e=t.geometryState,r=e.neighborData,i=t.localOrigin,n=r.cornerNeighborData,s=t.geometryInfo,o=s.outerEdges,a=s.boundingBox,l=t.tile,c=((Fe=t.tile.surface.view)==null?void 0:Fe.viewingMode)==="local",h=l.ellipsoid.radius,p=l.extentInRadians,f=l.horizontalScale;let m=0,g=0,_=0;const b=(Ve,bt,tt)=>{const jt=p[bt===0?1:3],Qt=p[Ve===0?0:2],nr=Math.cos(jt),er=Math.sin(jt),wr=Math.sin(Qt),ni=Math.cos(Qt),Pr=h+tt;m=ni*nr*Pr,g=wr*nr*Pr,_=er*Pr},w=c?(()=>{const Ve=t.geometryState.clippingArea,bt=l.extent,tt=v(Ve)&&(bt[3]>Ve[3]||bt[2]>Ve[2]||bt[1]<Ve[1]||bt[0]<Ve[0]),jt=Mce(l.surface.isWebMercatorOnPlateeCarree,l.ellipsoid.radius,f);return(Qt,nr,er)=>{const wr=Qt===0?ee[0]:ee[2],ni=nr===0?ee[1]:ee[3],Pr=tt?_e(wr,Ve[0],Ve[2]):wr,Or=tt?_e(ni,Ve[1],Ve[3]):ni,ot=er;m=Pr*f,g=jt(Or),_=ot}})():b;let x=0,T=0,E=0,C=0,A=0,I=0,M=0,D=0,U=0;const z=c&&t.tile.surface.isWebMercatorOnPlateeCarree,B=(Ve,bt,tt,jt,Qt)=>{let nr=0,er=0,wr=0;if(c){const ni=bt*f,Pr=z?(Math.PI/2-2*Math.atan(Math.exp(-tt/h)))*h:tt*f;nr=ni-m,er=Pr-g,wr=jt-_}else{const ni=Oce(Ve),Pr=Ve.tile,Or=Pr.extent,ot=Pr.extentInRadians,et=(bt-Or[0])/(Or[2]-Or[0]),pt=(tt-Or[1])/(Or[3]-Or[1]),gt=ot[0]*(1-et)+ot[2]*et,Rt=ni(pt),Yt=Math.cos(Rt),Dr=Math.sin(Rt),Nr=Math.sin(gt),Fr=Math.cos(gt),kr=h+jt;nr=Fr*Yt*kr-m,er=Nr*Yt*kr-g,wr=Dr*kr-_}switch(Qt){case 0:M+=nr,D+=er,U+=wr;break;case 1:C-=nr,A-=er,I-=wr;break;case 2:M-=nr,D-=er,U-=wr;break;case 3:C+=nr,A+=er,I+=wr}},ee=l.extent,te=e.clippingArea,K=v(te)?te:V7,W=ee[0],N=ee[2],L=ee[1],F=ee[3],G=[F>K[3],N>K[2],L<K[1],W<K[0]],q=Math.max(W,K[0]),Z=Math.min(N,K[2]),X=Math.max(L,K[1]),oe=Math.min(F,K[3]),pe=s.uvRange[0],ye=s.uvRange[1],Se=s.uvRange[2],He=s.uvRange[3],Le=l.surface.shading||R2,Te=Ve=>{var Or;const bt=n[Ve].cornerTiles;x=0,T=0,E=1;let tt=1/0;for(let ot=0;ot<4;++ot)tt=Math.min(tt,((Or=bt[ot])==null?void 0:Or.level)??1/0);for(let ot=0;ot<4;++ot){const et=bt[ot];oP[ot]=(et==null?void 0:et.level)===tt?et:null}let jt=1,Qt=0;for(let ot=0;ot<4;++ot){const et=oP[ot];et&&(jt=Math.max(jt,et==null?void 0:et.renderData.geometryState.numVerticesPerSide),Qt=et.extent[2]-et.extent[0])}const nr=Qt,er=jt;Re(er>1);const wr=nr/er;for(let ot=0;ot<4;++ot){const et=oP[(ot+3)%4],pt=oP[ot%4];if(!et&&!pt)continue;const gt=ot===0?1:ot===1?2:ot===2?3:0,Rt=ot===0?2:ot===1?3:ot===2?0:1;if(et&&pt){const Yt=AW[ot][0]*wr,Dr=AW[ot][1]*wr,Nr=et.extent,Fr=Nr[gt===0||gt===1?2:0]+Yt,kr=Nr[gt===0||gt===3?3:1]+Dr,Li=pt.extent,hr=Li[Rt===0||Rt===1?2:0]+Yt,Ar=Li[Rt===0||Rt===3?3:1]+Dr,xr=et.renderData,Dn=pt.renderData,hi=tn(Fr,kr,xr.geometryState.samplerData),sn=tn(hr,Ar,Dn.geometryState.samplerData);B(xr,Fr,kr,.5*(hi+sn),ot)}else{const Yt=et??pt,Dr=et?gt:Rt,Nr=Yt.extent,Fr=AW[ot],kr=Nr[Dr===0||Dr===1?2:0]+Fr[0]*wr,Li=Nr[Dr===0||Dr===3?3:1]+Fr[1]*wr,hr=Yt.renderData,Ar=tn(kr,Li,hr.geometryState.samplerData);B(hr,kr,Li,Ar,ot)}}if(!c){const ot=Math.sqrt(m*m+g*g+_*_);x=m/ot,T=g/ot,E=_/ot}const ni=Math.sqrt(C*C+A*A+I*I);C/=ni,A/=ni,I/=ni;const Pr=Math.sqrt(M*M+D*D+U*U);if(M/=Pr,D/=Pr,U/=Pr,c||E*E<.999){x=I*D-A*U,T=C*U-I*M,E=A*M-C*D;const ot=1/Math.sqrt(x*x+T*T+E*E);x*=ot,T*=ot,E*=ot}};for(let Ve=0;Ve<4;++Ve){const bt=Ve,tt=(Ve+1)%4,jt=Ve===0||Ve===1?1:0,Qt=Ve===0||Ve===3?1:0,nr=_e(jt,pe,Se),er=_e(Qt,ye,He),wr=o[bt],ni=Ve===0||Ve===3?wr.count-1:0,Pr=o[tt],Or=Ve===0||Ve===1?Pr.count-1:0,ot=n[Ve].cornerTiles;let et=-1;for(let Rt=0;Rt<4;++Rt){const Yt=ot[Rt];Yt&&(et===-1||u_(ot[et],Yt)>0)&&(et=Rt)}const pt=et,gt=ot[pt];if(x=0,T=0,E=1,gt!==l){const Rt=l.level-gt.level,Yt=2**Rt,Dr=[gt.lij[0]+Rt,gt.lij[1]*Yt,gt.lij[2]*Yt],Nr=[Dr[1]+Yt===l.lij[1],Ve===0&&(pt===1||pt===0&&gt!==ot[3])||Ve===1&&(pt===0||pt===1&&gt!==ot[2]),Dr[1]===l.lij[1]+1,Ve===2&&(pt===3||pt===2&&gt!==ot[1])||Ve===3&&(pt===2||pt===3&&gt!==ot[0])],Fr=Nr.reduce((xr,Dn)=>xr+(Dn?1:0),0);Re(Fr===1||Fr===2);let kr=-1,Li=-1;const hr=gt.renderData;if(Fr===1){const xr=Nr.findIndex(hi=>hi);Re(0<=xr&&xr<=3),kr=(xr+2)%4;const Dn=t.geometryState.neighborData.edgeResolutions[xr];Li=l.getNeighborEdgeStartVertexIndex(xr,gt)*Dn+Dn*(xr===0&&Ve===0||xr===1&&Ve===0||xr===2&&Ve===1||xr===3&&Ve===3?1:0)}else{Re(Nr[1]||Nr[3]),kr=Nr[1]?3:1;const xr=hr.geometryState.neighborData.edgeResolutions[kr];Li=Ve===0||Ve===3?0:xr}const Ar=hr.geometryInfo.outerEdges[kr];{const xr=wr.index0+ni*wr.stride,Dn=Pr.index0+Or*Pr.stride,hi=Ar.index0+Li*Ar.stride;{const sn=Ar.attributes.position,Di=sn.typedBuffer,Yi=hi*sn.typedBufferStride,En=t.localOrigin,Kn=Ar.localOrigin,Bo=Di[Yi]+Kn[0]-En[0],go=Di[Yi+1]+Kn[1]-En[1],Nn=Di[Yi+2]+Kn[2]-En[2];Xl(Bo,go,Nn,a);{const on=wr.attributes.position,an=on.typedBuffer,Fn=xr*on.typedBufferStride;an[Fn]=Bo,an[Fn+1]=go,an[Fn+2]=Nn}{const on=Pr.attributes.position,an=on.typedBuffer,Fn=Dn*on.typedBufferStride;an[Fn]=Bo,an[Fn+1]=go,an[Fn+2]=Nn}}Hu(wr.attributes.uv0,xr,nr,er),Hu(Pr.attributes.uv0,Dn,nr,er);{const sn=Ar.attributes.normalCompressed.typedBuffer,Di=hi*Ar.attributes.normalCompressed.typedBufferStride;{const Yi=wr.attributes.normalCompressed,En=Yi.typedBuffer,Kn=xr*Yi.typedBufferStride;En[Kn]=sn[Di],En[Kn+1]=sn[Di+1]}{const Yi=Pr.attributes.normalCompressed,En=Yi.typedBuffer,Kn=Dn*Yi.typedBufferStride;En[Kn]=sn[Di],En[Kn+1]=sn[Di+1]}}}}else{const Rt=G[bt],Yt=G[tt];let Dr;if(Rt||Yt){const Li=_e(W*(1-jt)+N*jt,q,Z),hr=_e(L*(1-Qt)+F*Qt,X,oe),Ar=e.samplerData;Dr=tn(Li,hr,Ar)}else Dr=_Nt(ot);w(jt,Qt,Dr),(Le||R2)&&Te(Ve);const Nr=m-i[0],Fr=g-i[1],kr=_-i[2];Xl(Nr,Fr,kr,a),wr.setVertexFromValuesRawPositionUVNormal(ni,Nr,Fr,kr,nr,er,x,T,E),Pr.setVertexFromValuesRawPositionUVNormal(Or,Nr,Fr,kr,nr,er,x,T,E)}}for(let Ve=0;Ve<4;++Ve)oP[Ve]=null}function _Nt(t){var s,o;const e=t.reduce((a,l)=>Math.min(a,(l==null?void 0:l.level)??1/0),1/0);Zs&&(Re(!t[0]||!t[2]||Kte(t[0],t[2],It.SOUTH_WEST)),Re(!t[1]||!t[3]||Kte(t[1],t[3],It.NORTH_WEST)));let r=0,i=0;for(let a=0;a<4;++a){const l=t[a];if(l&&l.level===e){const c=a===0||a===1,h=a===0||a===3,p=l.extent,f=p[c?0:2],m=p[h?1:3],g=(o=(s=l.renderData)==null?void 0:s.geometryState)==null?void 0:o.samplerData;i+=tn(f,m,g),r++}}const n=r?i/r:0;return Re(n!=null),n}function z7(t){const e=t.vao,r=t.geometryInfo.vertexAttributes.position.typedBuffer;e.vertexBuffers.geometry.setSubData(r,0,0,r.length)}const AW=[[0,1],[1,0],[0,-1],[-1,0]],Ts=new QLt,V7=Ane(-1/0,-1/0,1/0,1/0),oP=[null,null,null,null];function IUe(t,e,r){if(!e)return!1;const i=u_(t,e);return i>0||i===0&&r>=2}const R2=!0;let vNt=class extends Ece{get horizontalScale(){return this._horizontalScaleFactor}constructor(e,r,i){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=Kt(),e!==void 0&&this.init(e,r,i)}init(e,r,i){super.init(e,r,i);const n=i.view.renderSpatialReference,s=i.spatialReference,o=v(n)&&Xie(n)&&v(s)&&s.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=o;const a=this.surface.isWebMercatorOnPlateeCarree,l=this._extentInRenderSR,c=this.extent;if(a){const h=ke(c[0],c[1],0);zo(h,Je.WebMercator,h,Je.PlateCarree);const p=ke(c[2],c[3],0);zo(p,Je.WebMercator,p,Je.PlateCarree),l[0]=h[0],l[1]=h[1],l[2]=p[0],l[3]=p[1]}else for(let h=0;h<4;++h)l[h]=c[h]*o;this.centerAtSeaLevel[0]=.5*(l[0]+l[2]),this.centerAtSeaLevel[1]=.5*(l[1]+l[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(l[2]-l[0],l[3]-l[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const e=this._extentInRenderSR,r=.5*(e[2]-e[0]),i=.5*(e[3]-e[1]),n=Math.sqrt(r*r+i*i),s=.5*(this.elevationBounds[0]-this.elevationBounds[1]),o=Math.max(n,s);this._center[ys.MIDDLE][3]=o}_calculateFrustumVisibilityStatus(e){const r=this._aabb(),i=r[0],n=r[1],s=r[2],o=r[3],a=r[4],l=r[5];let c=!0;for(let h=0;h<6;h++){const p=e[h],f=p[0],m=p[1],g=p[2],_=p[3];if(f*(f>0?i:o)+m*(m>0?n:a)+g*(g>0?s:l)+_>=0)return tl.OUTSIDE;c=c&&f*(f<0?i:o)+m*(m<0?n:a)+g*(g<0?s:l)+_<=0}return c?tl.INSIDE:tl.INTERSECTS}_aabb(){const e=this._extentInRenderSR;return yWe(e[0],e[1],this.elevationBounds[0],e[2],e[3],this.elevationBounds[1])}intersectsRay(e,r,i,n){return fk[0]=1/r[0],fk[1]=1/r[1],fk[2]=1/r[2],Ole(this._aabb(),e,fk,i,n)}createGeometry(){uNt(this.renderData,this._horizontalScaleFactor),this.setMemoryDirty()}getDefaultVerticesPerSide(){return this.level<9?3:2}updateCornerElevations(){fNt(this.renderData,this._horizontalScaleFactor)}updateEdgeElevations(){mNt(this.renderData,this._horizontalScaleFactor)}};const fk=P();let bNt=class{constructor(){this.extent=pr(),this.minLevel=0,this.maxLevel=0,this.callback=null}},qU=class extends be{constructor(){super(...arguments),this._queries=new Wt({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new Wt({initialSize:30}),this._queryPool=new ko(bNt)}queryVisibleLevelRange(e,r,i,n){const s=this._queryPool.acquire();Vf(s.extent,e),s.minLevel=r??-Number.MAX_VALUE,s.maxLevel=i??Number.MAX_VALUE,s.callback=n,this._queryQueue.push(s),this.notifyChange("updating")}get updating(){return this._queryQueue.length!==0}prepare(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}process(){for(let e=0;e<this._queries.length;e++){const r=this._queries.data[e];this._queryPool.release(r),r.callback(e>=this._queriesInvPtr),r.callback=null}this._queries.clear(),this.notifyChange("updating")}queriesForTile(e){const r=e.level;let i=0;for(;i<this._queriesInvPtr;){const n=this._queries.data[i],s=n.extent;r>=n.minLevel&&r<=n.maxLevel&&s[0]<=e.extent[2]&&s[2]>=e.extent[0]&&s[1]<=e.extent[3]&&s[3]>=e.extent[1]?(this._queries.swapElements(i,this._queriesInvPtr-1),this._queriesInvPtr--):i++}}};u([d()],qU.prototype,"updating",null),qU=u([$("esri.views.3d.terrain.ScaleRangeQueries")],qU);let wNt=class extends Ece{get convexHull(){return this._convexHull}constructor(e,r,i){super(),this._convexHull=new Array(24),this._boundingSphere=Os(),e!==void 0&&this.init(e,r,i)}init(e,r,i){super.init(e,r,i);const n=this.ellipsoid.radius,s=this.extentInRadians[0],o=this.extentInRadians[1],a=this.extentInRadians[2],l=this.extentInRadians[3],c=e[0],h=Bt(o,l,.5),p=Bt(s,a,.5),f=c===0?0:Math.min(Math.abs(o),Math.abs(l));this._edgeLen=(a-s)*Math.cos(f)*n,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=n-Math.sqrt(n*n-this._edgeLen2/4),OZe(this.centerAtSeaLevel,p,h,this.ellipsoid.radius);const m=$c(this.centerAtSeaLevel);we(m,m),this.up=m,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const e=this._center;if(this.lij[0]===0)he(e[ys.MIDDLE],0,0,0),he(e[ys.TOP],0,0,0),he(e[ys.BOTTOM],0,0,0),e[ys.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const r=e[ys.MIDDLE],i=this.convexHull;let n=0;for(let s=0;s<8;++s)n=Math.max(n,xNt(r,i,3*s));e[ys.MIDDLE][3]=Math.sqrt(n)}}_calculateFrustumVisibilityStatus(e){if(!bb(e,this._boundingSphere))return tl.OUTSIDE;if(this.lij[0]<10)return tl.INTERSECTS;const r=this.convexHull,i=this.surface.view.state.camera.near;let n=!0;for(let s=0;s<dw.NUM;s++){const o=s===Ai.NEAR,a=e[s],l=a[0],c=a[1],h=a[2],p=a[3]-(o?i:0);let f=!1;for(let m=0;m<8;++m){const g=3*m;if(l*r[g+0]+c*r[g+1]+h*r[g+2]+p<0){if(f=!0,!n)break}else n=!1}if(!f)return tl.OUTSIDE}return n?tl.INSIDE:tl.INTERSECTS}computeElevationBounds(){super.computeElevationBounds(),this._updateBoundingVolumes()}createGeometry(){rNt(this.renderData,this._getPatchType()),this._updateBoundingVolumes(),this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull(),this._updateBoundingSphere(),Zs&&this._checkBVs()}_updateBoundingSphere(){const e=this._boundingSphere,r=e,i=this.elevationBounds,n=this.ellipsoid.radius,s=i[1];if(this.level===0)he(r,0,0,0),e[3]=n+s;else{const o=this.extentInRadians,a=.5*(o[0]+o[2]),l=o[1],c=o[3];Ox(obe,a,l,n),Ox(abe,a,c,n),me(r,obe,abe);const h=.5*(i[0]+i[1]);le(r,r,(n+h)/Tu(r));const p=this.convexHull;let f=0;const m=(_,b)=>{const w=_[0]-p[3*b+0],x=_[1]-p[3*b+1],T=_[2]-p[3*b+2];return Math.sqrt(w*w+x*x+T*T)};for(let _=0;_<8;++_){const b=m(r,_);f=Math.max(f,b)}const g=f;e[3]=g+2}}_updateConvexHull(){const e=this.extentInRadians,r=this.ellipsoid.radius;if(this.level===0)return;const i=this.elevationBounds,n=this._getPatchType(),s=this.surface.isWebMercator,o=s&&n===tp.HAS_NORTH_POLE,a=s&&n===tp.HAS_SOUTH_POLE,l=a||o,c=Math.PI/2,h=e[0],p=e[2],f=a?-c:e[1],m=o?c:e[3],g=.5*(h+p),_=i[0],b=r+(l?Math.min(0,_-1):_),w=(W,N,L)=>Ox(W,N,L,b),x=P(),T=P(),E=P(),C=P();w(x,h,f),w(T,h,m),w(E,p,m),w(C,p,f);const A=(W,N)=>{for(let L=0;L<3;++L)this._convexHull[3*N+L]=W[L]};A(x,0),A(T,1),A(E,2),A(C,3);const I=i[1],M=r+(l?Math.max(0,I+1):I),D=P(),U=P(),z=P();Ox(U,g,m,b),Ox(z,g,f,b),me(D,U,z),we(D,D);const B=P(),ee=P(),te=(W,N)=>{Lo(ee,W,N),we(ee,ee);const L=-ve(W,B)/ve(ee,B);Re(L>=0),le(ee,ee,L),me(W,W,ee)};if(2**this.lij[0]>2*this.lij[1]){const W=z,N=P();vt(N,sbe,W),we(N,N),vt(B,W,N),we(B,B),Re(rp(ve(B,W)/Tu(W),0)),te(x,T),te(C,E),A(x,0),A(C,3)}else if(2**this.lij[0]!==2*this.lij[1]){const W=U,N=P();vt(N,sbe,W),we(N,N),vt(B,N,W),we(B,B),te(T,x),te(E,C),A(T,1),A(E,2)}const K=(W,N)=>{const L=M/ve(N,D);for(let F=0;F<3;++F)this._convexHull[3*W+F]=N[F]*L};K(4,x),K(5,T),K(6,E),K(7,C)}_getPatchType(){const e=this.lij[1],r=e===0,i=e===(1<<this.level)-1;return r?i?tp.HAS_BOTH_POLES:tp.HAS_NORTH_POLE:i?tp.HAS_SOUTH_POLE:tp.REGULAR}intersectsRay(e,r,i,n){const s=this._boundingSphere,o=s[3]+i,a=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],l=s[0]-e[0],c=s[1]-e[1],h=s[2]-e[2],p=(l*r[0]+c*r[1]+h*r[2])/a,f=r[0]*p-l,m=r[1]*p-c,g=r[2]*p-h;return f*f+m*m+g*g<o*o}getDefaultVerticesPerSide(){return this.level<nbe.length?nbe[this.level]+1:2}updateCornerElevations(){aNt(this.renderData),this._updateBoundingVolumes()}updateEdgeElevations(){oNt(this.renderData),this._updateBoundingVolumes()}_checkBVs(){var oe;if(!Zs||this.level<=2)return;const e=this._boundingSphere,r=e[3],i=e,n=P(),s=this.ellipsoid.radius,o=this.elevationBounds;o[1],o[0];const a=s+o[0],l=1,c=0,h=this._center[ys.MIDDLE][3],p=this.convexHull,f=(pe,ye)=>{for(let Se=0;Se<3;++Se)pe[Se]=p[3*ye+Se]};{const pe=P(),ye=P(),Se=P(),He=P(),Le=P(),Te=(Fe,Ve,bt,tt)=>{f(ye,Fe),f(Se,Ve),f(He,bt),Lo(ye,ye,Se),Lo(He,He,Se),vt(pe,ye,He),we(pe,pe);const jt=ve(pe,Se);f(Le,tt);const Qt=ve(pe,Le),nr=Math.abs(Qt-jt);Re(rp(nr,0),`Non coplanar ${Fe},${Ve},${bt},${tt} diff = ${nr}`)};Te(0,1,2,3),Te(4,5,6,7),Te(0,1,4,5),Te(1,2,5,6),Te(2,3,6,7),Te(3,0,7,4)}const m=Zu(24),g=(pe,ye,Se)=>{const He=4*pe;for(let Le=0;Le<3;++Le)m[He+Le]=ye[Le];m[He+3]=Se},_=P(),b=P(),w=P(),x=P(),T=(pe,ye,Se,He)=>{f(_,ye),f(b,Se),f(w,He),Lo(_,_,b),we(_,_),Lo(w,w,b),we(w,w),vt(x,_,w),we(x,x);const Le=ve(x,b);g(pe,x,Le)};T(0,0,1,2),T(1,1,0,4),T(2,1,5,2),T(3,3,2,6),T(4,4,0,3),T(5,4,6,5);const E=1,C=(pe,ye,Se,He)=>{const Le=4*pe;return m[Le+0]*ye+m[Le+1]*Se+m[Le+2]*He-m[Le+3]},A=(pe,ye,Se,He)=>C(pe,ye,Se,He)>=-E,I=(pe,ye)=>A(pe,ye[0],ye[1],ye[2]),M=2**this.lij[0]>2*this.lij[1],D=(pe,ye,Se)=>Math.sqrt($Ue(pe,ye,Se,i[0],i[1],i[2]))<r,U=pe=>D(pe[0],pe[1],pe[2]),z=(pe,ye)=>D(pe[ye+0],pe[ye+1],pe[ye+2]),B=this.extentInRadians,ee=.5*(B[0]+B[2]),te=B[1],K=B[3],W=P(),N=P();Ox(W,ee,K,a),Ox(N,ee,te,a);const L=M?"Upper":"Lower";let F=!0;for(let pe=0;pe<6;++pe){for(let ye=0;ye<8;++ye){const Se=3*ye,He=A(pe,p[Se+0],p[Se+1],p[Se+2]);F&&(F=He),Re(He,`Tile[${this.lij}] Convex hull point ${ye} outside of plane ${pe}`)}Re(I(pe,N),`Tile[${this.lij}] (${L}) bottom mid outside of plane ${pe}`),Re(I(pe,W),`Tile[${this.lij}] (${L}) top mid outside of plane ${pe}`)}Re(F,"Not all convex hull points are inside  convex hull polyhedron"),Re(U(N),`Tile[${this.lij}] (${L}) bottom mid outside of bounding sphere`),Re(U(W),`Tile[${this.lij}] (${L}) top mid outside of bounding sphere`);for(let pe=0;pe<8;++pe){const ye=z(p,3*pe);Re(ye,`Tile[${this.lij}] Convex hull point ${pe} outside of bounding sphere`)}for(let pe=0;pe<6;++pe)for(let ye=0;ye<8;++ye){const Se=3*ye;A(pe,p[Se+0],p[Se+1],p[Se+2])||console.error(`Tile[${this.lij}] Convex hull point ${ye} outside of plane ${pe}`)}const G=this.extentInRadians,q=Math.max(G[2]-G[0],G[3]-G[1]),Z=Math.round(q*s),X=this.renderData;if(X){const pe=X.geometryInfo,ye=X.localOrigin,Se=(oe=pe.vertexAttributes)==null?void 0:oe.position;if(!Se)return;const He=Se.count,Le=P(),Te=pe.numVerticesPerSide-2,Fe=Te*Te,Ve=X.geometryState.neighborData,bt=Ve.edgeResolutions.reduce((tt,jt)=>tt+jt+1,0);for(let tt=0;tt<He;++tt){const jt=tt<Fe,Qt=!jt&&tt<Fe+bt;let nr=!1,er=-1;if(Qt){let hr=Fe;for(let Ar=0;Ar<4;++Ar){const xr=Ve.edgeResolutions[Ar];if(tt===hr||tt===hr+xr-1){nr=!0;break}if(hr+=xr,tt<hr){er=Ar;break}}}const wr=er,ni=nr,Pr=Qt&&!ni,Or=Qt?Ve.edgePeerNeighbors[wr]:null,ot=Qt&&Or&&u_(this,Or)>0,et=jt?"internal":Pr?"edge":ni?"corner":"pole";Se.getVec(tt,n),me(Le,n,ye);const pt=Tu(Le)-s;let gt=0,Rt=!1;const Yt=o[0]-pt,Dr=pt-o[1],Nr=Yt>l,Fr=Dr>l,kr=Nr||Fr,Li=`Tile[${this.lij}].vertex[${tt}]:${et}`+(Nr?"(below)":Fr?"(above)":"")+(ot?"(Neighbor)":"");{const hr=yN(Le,i);if(hr>=r+c){const Ar=hr-r;kr||(console.error(`${Li} is out of the bounding sphere by ${Ar.toFixed(0)} / ${r.toFixed(0)}[tol=${c}] h=${pt.toFixed(0)} / [${o[0].toFixed(0)}..${o[1].toFixed(0)}] (${(Ar/r).toFixed(0)})`),Rt=!0)}}for(let hr=0;hr<6;++hr)if(!A(hr,Le[0],Le[1],Le[2])){const Ar=C(hr,Le[0],Le[1],Le[2]),xr=tt%Te,Dn=(tt-xr)/Te;hr===0&&Yt||hr===5&&Dr||(console.error(`${Li} (${xr},${Dn})|${Te}] is out of the bounding trapezoid plane ${hr} h=${Math.round(pt)} / [${Math.round(o[0])}..${Math.round(o[1])}] dist=${Math.round(Ar)} radii = ${Math.round(r)}/${Math.round(h)}} : maxL = ${Z}`),++gt)}if(Rt||gt>0)break}}}};const nbe=[128,64,64,32,16,8,8,4];function xNt(t,e,r){return $Ue(t[0],t[1],t[2],e[r+0],e[r+1],e[r+2])}function $Ue(t,e,r,i,n,s){const o=i-t,a=n-e,l=s-r;return o*o+a*a+l*l}const Ox=(t,e,r,i)=>{const n=Math.cos(e),s=Math.sin(e),o=Math.cos(r),a=Math.sin(r);t[0]=i*o*n,t[1]=i*o*s,t[2]=i*a},sbe=[0,0,1],obe=P(),abe=P();let TNt=class{constructor(){this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}},LUe=class extends _l{constructor(){super(...arguments),this.blendMode=Be.Normal}};u([j({count:Be.COUNT})],LUe.prototype,"blendMode",void 0);let dR=class extends LUe{constructor(){super(...arguments),this.output=ao.Composite,this.baseOpacityMode=Zf.NotRequired,this.premultipliedSource=Lf.Off,this.hasWebGL2Context=!1}};u([j({count:ao.COUNT})],dR.prototype,"output",void 0),u([j({count:Zf.COUNT})],dR.prototype,"baseOpacityMode",void 0),u([j()],dR.prototype,"premultipliedSource",void 0),u([j()],dR.prototype,"hasWebGL2Context",void 0);var O2;function SNt(t){const e=new Br;if(e.include(fUe),t.background===O2.Only){const r=t.output===ao.ColorComposite;return r?e.fragment.uniforms.add(new Jt("backgroundColor",i=>i.backgroundColor)):(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.include(Sce)),e.fragment.code.add(S`
    void main() {
      gl_FragColor = vec4(${r?S`backgroundColor`:S`gridColor(uv)`}, 1.0);
    }
  `),e}return e.include(mUe,t),e.fragment.uniforms.add(new Dt("tex",r=>r.texture)),e.fragment.uniforms.add(new Ie("opacity",r=>r.opacity)),e.fragment.code.add(S`void main() {
vec4 bgColor = getBackground(uv);
gl_FragColor = blendLayers(bgColor, texture2D(tex, uv), opacity);
}`),e}(function(t){t[t.BelowLayer=0]="BelowLayer",t[t.Only=1]="Only",t[t.COUNT=2]="COUNT"})(O2||(O2={}));const ENt=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return O2},build:SNt},Symbol.toStringTag,{value:"Module"}));let CNt=class extends pUe{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=cl}},DUe=class NUe extends Wr{initializeConfiguration(e,r){r.hasWebGL2Context=e.rctx.type===Et.WEBGL2}initializeProgram(e){return new Gr(e.rctx,NUe.shader.get().build(this.configuration),Lr)}initializePipeline(){return Ht({blending:bm(Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA),colorWrite:ir})}};DUe.shader=new jr(ENt,()=>Q(()=>import("./BlendLayers.glsl-1330b4fe.js"),[]));let FUe=class extends dR{constructor(){super(...arguments),this.background=O2.BelowLayer}};u([j()],FUe.prototype,"background",void 0);let RW=class{constructor(e,r,i,n,s,o){this.texture=e,this.type=r,e.retain(),this.offsetAndScale=Zt(i.offset[0],i.offset[1],i.scale,i.scale),this.opacities=ke(n,s,o)}destroy(){this.texture.release()}};const ANt=.125;let RNt=class{constructor(){this._renderParams={context:null,drawPhase:1,state:new vQ({viewpoint:new Xn({targetGeometry:new Ue(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null}}dispose(){this._renderParams=null}render(e,r,i,n,s,o,a,l,c,h){const p=o.adjustLevel(r[0]),f=this._renderParams;f.context=e,f.painter=n,f.glyphMosaic=n.glyphMosaic,f.spriteMosaic=n.spriteMosaic,f.pixelRatio=h,f.displayLevel=p,f.requiredLevel=p;const m=o.getScale(r[0]),[g,_]=o.getShift(r,a*m),b=ANt*a*m/c,w=i.transforms.dvs;w[0]=b,w[4]=-b,w[6]=-1-g-l[0]*a*2,w[7]=1+_+(1-l[1])*a*2-2,f.state.size[0]=c,f.state.size[1]=c,i.stage||i.attachWithContext(e),i.triangleCount=0,n.drawTile(f,i,s)}},kUe=class UUe extends Wr{initializeConfiguration(e,r){r.hasWebGL2Context=e.rctx.type===Et.WEBGL2}initializeProgram(e){return new Gr(e.rctx,UUe.shader.get().build(this.configuration),Lr)}initializePipeline(){return Ht({blending:bm(Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA),colorWrite:ir})}};kUe.shader=new jr(TDt,()=>Q(()=>import("./RasterColorizer.glsl-69ee81a5.js"),[]));let WU=class extends dR{constructor(){super(...arguments),this.colorizerType=VS.Stretch,this.stretchType=A2.Noop,this.applyColormap=!0}};u([j({count:VS.COUNT})],WU.prototype,"colorizerType",void 0),u([j({count:A2.COUNT})],WU.prototype,"stretchType",void 0),u([j()],WU.prototype,"applyColormap",void 0);let lbe=class{constructor(e){this._rctx=e,this._fbos=new Map}get(e){return this._getPool(e)}dispose(){this._fbos.forEach(e=>e.dispose()),this._fbos.clear()}_getPool(e){const r=this._fbos.get(e);if(r)return r;const i=new Jn(this._rctx,{colorTarget:xn.TEXTURE,depthStencilTarget:Ur.DEPTH_RENDER_BUFFER,width:e,height:e});return this._fbos.set(e,i),i}};const ONt=re.getLogger("esri.views.3d.terrain");let MNt=class{constructor(e,r){this._rctx=e,this._techniqueRepository=r,this._fbos=[],this._vectorTileHelper=new RNt,this._bindParameters=new XB(null,null,null),this._blendLayersTechniqueConfig=new FUe,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vaoQuad=vl(this._rctx,$3)}dispose(){this._fbos.forEach(rt),this._fbos=null,this._vtFBO=rt(this._vtFBO),this._vaoQuad=rt(this._vaoQuad),this._vectorTileHelper=rt(this._vectorTileHelper),this._backgroundTechnique=en(this._backgroundTechnique),this._applyOpacityTechnique=en(this._applyOpacityTechnique),this._blendLayersTechnique=en(this._blendLayersTechnique)}_getBlendLayersTechnique(e,r,i,n=Lf.Off,s=O2.BelowLayer){return this._blendLayersTechniqueConfig.output=r,this._blendLayersTechniqueConfig.blendMode=e,this._blendLayersTechniqueConfig.baseOpacityMode=i,this._blendLayersTechniqueConfig.premultipliedSource=n,this._blendLayersTechniqueConfig.background=s,this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(DUe,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(e,r){const i=this._getBlendLayersTechnique(Be.Normal,r?ao.ColorComposite:ao.GridComposite,Zf.NotRequired,Lf.Off,O2.Only),n=this._rctx.bindTechnique(i,e,this._bindParameters);this._render(n)}_render(e){this._rctx.bindVAO(this._vaoQuad),e.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(Ft.TRIANGLE_STRIP,0,Da(this._vaoQuad,"geometry"))}drawGroup(e,r,i,n,s,o=Lf.On){r===ao.Composite&&(e.fboTexture=this._fbos[this.getLastOnHoldId()].get(i).colorTexture),e.texture=this.currentFBO(i).colorTexture,this.closeGroup(i);const a=this._getBlendLayersTechnique(n,r,s,o),l=this._rctx.bindTechnique(a,e,this._bindParameters);this._render(l)}drawRasterData(e,r,i,n,s,o=Lf.Off){if(R(e.texture))return;e.fboTexture=r===ao.GroupBackgroundComposite||n===Be.Normal&&s===Zf.NotRequired&&o===Lf.Off?null:this.switch(i).colorTexture;const a=this._getBlendLayersTechnique(n,r,s,o),l=this._rctx.bindTechnique(a,e,this._bindParameters);this._render(l)}drawImageryTileData(e,r,i,n,s,o){const a=o.sourceLayerInfo.data;if(!a.source||(o.tile.surface.layerViewByIndex(o.layerIndex,vr.MAP).ensureSymbolizerParameters(a),!a.bind(this._rctx)))return;e.fboTexture=n===Be.Normal&&s===Zf.NotRequired?null:this.switch(i).colorTexture;const l=this._getRasterColorizerTechnique(a,r,n,s);a.opacity=e.opacity;const c=a.getUniforms();c.scale=o.scale,c.offset=o.offset,c.backgroundColor=e.backgroundColor,c.fboTexture=e.fboTexture,c.baseOpacity=e.baseOpacity;const h=this._rctx.bindTechnique(l,c,null);this._render(h)}_getRasterColorizerTechnique(e,r,i,n){const s=e.symbolizerParameters,o=["stretch","lut","hillshade"].indexOf(s.type);return R(this._rasterColorizerConfig)&&(this._rasterColorizerConfig=new WU,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.output=r,this._rasterColorizerConfig.blendMode=i,this._rasterColorizerConfig.baseOpacityMode=n,this._rasterColorizerConfig.colorizerType=o,this._rasterColorizerConfig.applyColormap=!!s.colormap,this._rasterColorizerConfig.stretchType=e.hasStretchTypeNone()?A2.Noop:A2.PerBand,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(kUe,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(e,r,i,n,s,o,a,l,c){const h=this._rctx,p=o.sourceLayerInfo.data,f=o.tile.surface.layerViewByIndex(o.layerIndex,vr.MAP),m=s===Zf.Required||e.opacity<1||n!==Be.Normal||r!==ao.Composite,g=m?Lf.On:Lf.Off;this._getBlendLayersTechnique(n,r,s,g).bindPipelineState(h);let _=null,b=null;m?(b=this.currentFBO(i),R(this._vtFBO)&&(this._vtFBO=new lbe(this._rctx)),_=this._vtFBO.get(i),h.bindFramebuffer(_),this._clearCurrentFBO()):c&&h.clearSafe(Hi.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.render(h,o.sourceLod,p,f.painter,f.layer.styleRepository,f.schemaHelper,Math.round(1/o.scale),o.offset,l,a)}catch(w){ONt.warnOnce("A render call containing vector tiles did not resolve correctly.",w)}return!v(_)||(h.bindFramebuffer(b),e.texture=_.colorTexture,e.offset=Wc,e.scale=1,this.drawRasterData(e,r,i,n,s,g),c)}copyFBOToTexture(e){const r=this._rctx,i=r.bindTexture(e.texture,mt.TEXTURE_UNIT_FOR_UPDATES),n=e.descriptor;r.gl.copyTexImage2D(Ct.TEXTURE_2D,0,n.pixelFormat,0,0,n.width,n.height,0),e.generateMipmap(),r.bindTexture(i,mt.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.clearSafe(Hi.COLOR_BUFFER_BIT|Hi.DEPTH_BUFFER_BIT)}_initFBO(e,r,i){this._rctx.bindFramebuffer(e),i&&(this._rctx.setViewport(0,0,r,r),this._clearCurrentFBO())}ensureBuffer(e){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(e)}bind(e,r=0,i=!0){if(this._current=r,r>=this._fbos.length)for(let n=this._fbos.length;n<=r;n++)this._fbos.push(new lbe(this._rctx));this._initFBO(this._fbos[r].get(e),e,i)}_bindNextFreeBuffer(e){this._lastUsedIds.length>0?this.bind(e,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(e,this._lastCreatedBufferId))}openGroup(e){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(e)}switch(e){const r=this.currentFBO(e),i=this._current;return this._bindNextFreeBuffer(e),this._lastUsedIds.push(i),r}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(e){const r=this._current;this._bindNextFreeBuffer(e),this._lastUsedIds.push(r),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(e){return this._fbos[this._current].get(e)}},PNt=class{constructor(e,r,i,n){this.start=e,this.end=r,this.blendMode=i,this.opacity=n}},INt=class{constructor(e,r,i){this._rctx=e,this.tileSize=r,this._techniqueRepository=i,this._passParameters=new CNt,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._blackTex=null,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._composition=new MNt(this._rctx,this._techniqueRepository),this._blackTex=new _A(l_t(this._rctx,[0,0,0,1])),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=rt(this._composition),this._backgroundTexture=en(this._backgroundTexture),this._blackTex=en(this._blackTex)}get backgroundIsGrid(){return R(this._backgroundColor)}get backgroundColor(){return this._backgroundColor}updateTileTexture(e,r){if(!e.renderData)return;const i=e.surface,n=i.baseOpacity;let s=0,o=0,a=this.tileSize,l=!1;const c=i.view.state.contentPixelRatio;let h=!1;YV.clear(),eC.length=0;const p=e.layerInfo[vr.MAP];let f=p.length,m=0;for(;m<p.length;m++){const b=i.layerViewByIndex(m,vr.MAP),w=b.layer.opacity;cbe[m]=w;const x=b.fullOpacity;if(ube[m]=x,mOe(b.layer)&&f>=p.length&&(f=m),GV(b)){hbe[m]=b.layer.blendMode;let E=b.layer.blendMode!=="normal";if(AO(b.layer.parent)){const C=ere(b.layer.parent);v(C)&&C!==""&&(E=zUe(b.layer.parent)||E)}E&&(h=E,l=!1)}if(w===0&&!h){p[m].pendingUpdates&=~(Mt.TEXTURE_NOFADING&Mt.TEXTURE_FADING);continue}++o;const T=OW(e,m);if(T){if(p[m].pendingUpdates&=~(Mt.TEXTURE_NOFADING&Mt.TEXTURE_FADING),AO(b.layer.parent)){const E=ere(b.layer.parent);v(E)&&E!==""&&VUe(b.layer.parent,m)}BD(b)?a=Math.max(a,this.tileSize*c):n===1&&x===1&&(b.isOpaque||this._dataToTexture(T)&&T.sourceLayerInfo.data.descriptor.isOpaque)&&(l=!0),++s}}this._rctx.type===Et.WEBGL1&&(a=$Nt(a));const g=a/this.tileSize,_=m-1;this._ensureBackgroundTexture(this.tileSize),s!==0?s===1&&!h&&this._useLayerTexture(e,_,f,ube[_])||this._composeMapLayers(e,r,_,f,cbe,hbe,a,g,!l||h,YV,h):this._useBackgroundTexture(e,o)}_ensureBackgroundTexture(e){R(this._backgroundTexture)&&(this._backgroundTexture=this._buildTexture(e),this._backgroundDirty=!0),this._backgroundDirty&&(this._composition.bind(e),this._passParameters.offset=Wc,this._passParameters.scale=1,this._passParameters.opacity=1,v(this.backgroundColor)&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,v(this.backgroundColor)),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.unbind(),this._backgroundDirty=!1)}_useBackgroundTexture(e,r){let i=c_.Immediate;(e.surface.view.layerViewManager.updating||r>0)&&(i=c_.Delayed);const n=e.renderData;this._backgroundTexture&&R(n.textureReference)&&(i=c_.Immediate),n.setTextureReference(v(this._backgroundTexture)?new RW(this._backgroundTexture,js.FADING,dbe,e.surface.baseOpacity,0,1):null,i)}_useLayerTexture(e,r,i,n){const s=r<i,o=s?1:e.surface.baseOpacity,a=s?e.surface.baseOpacity:1,l=OW(e,r);return!!this._dataToTexture(l)&&(e.renderData.setTextureReference(new RW(l.sourceLayerInfo.data,js.FADING,l,o,a,n)),!0)}_composeMapLayers(e,r,i,n,s,o,a,l,c,h,p){this._composition.ensureBuffer(a);const f=e.surface.baseOpacity;let m=!1,g=it.LINEAR_MIPMAP_LINEAR,_=!1,b=0;for(let T=i;T>=0;T--){const E=OW(e,T);if(!E||s[T]===0&&!p)continue;const C=T<n&&f<1&&!m;this._passParameters.baseOpacity=C?f:1;const A=this._passParameters.baseOpacity<1?Zf.Required:Zf.NotRequired;C&&(m=!0);let I=!1;h.forEach(z=>{z.start===T&&(eC.push(z),this._composition.openGroup(a),I=!0)});const M=b===0,D=I?ao.GroupBackgroundComposite:c&&M?this.backgroundIsGrid?ao.GridComposite:ao.ColorComposite:ao.Composite,U=Jte[o[T]];for(Y$t(E)?(this._passParameters.opacity=s[T],_=this._composition.drawVectorData(this._passParameters,D,a,U,A,E,l,this.tileSize,_)):X$t(E)?(this._passParameters.opacity=s[T],this._composition.drawImageryTileData(this._passParameters,D,a,U,A,E),this._hasNearestInterpolation(E)&&(g=it.NEAREST)):this._dataToTexture(E)&&(this._passParameters.texture=E.sourceLayerInfo.data.texture,this._passParameters.offset=E.offset,this._passParameters.scale=E.scale,this._passParameters.opacity=s[T],this._composition.drawRasterData(this._passParameters,D,a,U,A));eC.length>0&&eC[eC.length-1].end===T;){const z=eC.pop();this._passParameters.opacity=z.opacity,this._passParameters.offset=Wc,this._passParameters.scale=1;const B=c&&M?this.backgroundIsGrid?ao.GridComposite:ao.ColorComposite:ao.Composite;this._composition.drawGroup(this._passParameters,B,a,Jte[z.blendMode],A)}b++}const w=e.renderData,x=w.ensureTexture(a,()=>this._buildTexture(a,g));this._composition.copyFBOToTexture(x),this._composition.unbind(),w.setTextureReference(new RW(x,r,dbe,m?1:f,0,1))}_hasNearestInterpolation(e){const r=e.sourceLayerInfo.data;return!!r.source&&r.interpolation==="nearest"}_dataToTexture(e){if(J$t(e)){const r=e.sourceLayerInfo;r.data=this._buildTexture(r.data),e.tile.setMemoryDirty()}return Z$t(e)}setBackground(e){this._backgroundColor!==e&&(this._backgroundColor=e,this._backgroundDirty=!0)}_buildTexture(e,r=it.LINEAR_MIPMAP_LINEAR){if(R(e))return null;const i={target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE,samplingMode:r,maxAnisotropy:this._maxAnisotropy,preMultiplyAlpha:!0,flipped:!0,hasMipmap:!0},n=this._rctx;let s;if(typeof e=="number")i.width=i.height=e,s=new _A(new mt(n,i));else if(e instanceof D7)i.isOpaque=e.isOpaque,s=new _A(new mt(n,i,e.image)),e.release();else try{i.width=e.width,i.height=e.height,s=new _A(new mt(n,i,e))}catch{s=new _A(xDe(n)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const o=n.bindTexture(s.texture,mt.TEXTURE_UNIT_FOR_UPDATES);return s.generateMipmap(),n.bindTexture(o,mt.TEXTURE_UNIT_FOR_UPDATES),s}get test(){return{backgroundTexture:this._backgroundTexture}}};function $Nt(t){const e=fO(t),r=e*e,i=t*t;if(r===i)return t;const n=e/2;return r-i<i-n*n?e:n}function OW(t,e){dh.layerIndex=e;const r=t.layerInfo[vr.MAP][e];if(v(r.data))return dt(dh.offset,0,0),dh.tile=t,dh.scale=1,dh.sourceLod=t.lij,dh.sourceLayerInfo=r,dh;const i=r.upsampleInfo;if(v(i)){const n=i.tile.layerInfo[vr.MAP][e];return dh.tile=i.tile,Qs(dh.offset,i.offset),dh.scale=i.scale,dh.sourceLod=i.tile.lij,dh.sourceLayerInfo=n,dh}return null}function ere(t){return t.get("uid")}function zUe(t){let e=t.blendMode!=="normal";return AO(t.parent)&&(e=zUe(t.parent)||e),e}function VUe(t,e){AO(t.parent)&&VUe(t.parent,e);const r=ere(t);if(v(r)&&r!==""){const i=YV.get(r);i?i.start=e:YV.set(r,new PNt(e,e,t.blendMode,t.opacity))}}const cbe=new Array,ube=new Array,hbe=new Array,YV=new Map,eC=new Array,dh={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIndex:0},dbe={offset:[0,0],scale:1},BUe=200,MW=40,LNt=.8,DNt=10,qI=1e-6;function NNt(t,e,r){const i=e,n=r;let s=0,o=1/0;for(let a=0;a<3;++a){{const l=t[a];if(i[a]<l){if(n[a]<=qI)return!1;const c=(l-i[a])/n[a];s=Math.max(s,c)}else if(n[a]<=-qI){const c=(l-i[a])/n[a];o=Math.min(o,c)}if(s>o)return!1}{const l=t[a+3];if(i[a]>l){if(n[a]>=-qI)return!1;const c=(l-i[a])/n[a];s=Math.max(s,c)}else if(n[a]>=qI){const c=(l-i[a])/n[a];o=Math.min(o,c)}if(s>o)return!1}}return!0}let pbe=class{constructor(e,r,i,n,s){this.aabb=e,this.axis=r,this.d=i,this.midStartIndex=n,this.rightStartIndex=s}},Pce=class tre{constructor(e,r,i,n){this.globalTriangleVertexIndices=e,this.firstTriangleIndex=r,this.positionAttribute=n,this._rayDirection=P(),this.bspNodeTree=new Array;const s=i-r,o=s<=jUe?new Uint16Array(s):new Uint32Array(s);this.indices=o;for(let a=0;a<s;++a)o[a]=a;{const a=VNt(e,r,i,n.data,n.stride),l=_e(Math.log2(s/MW),2,DNt),c=(h,p,f)=>{const m=UNt(o,a,h,p),g=p-h;if(g<=MW){const E=new pbe(m,void 0,0,h,p);return this.bspNodeTree.push(E),E}const{axis:_,midValue:b}=zNt(m),w=kNt(o,a,h,p,_,b),x=(E,C)=>{if(f>l)return;const A=C-E;return A<MW||A>=LNt*g?void 0:c(E,C,f+1)},T=new pbe(m,_,b,w.next,w.mid);return this.bspNodeTree.push(T),T.leftNode=x(h,w.next),T.rightNode=x(w.mid,p),T};c(0,s,0),this.triangleVertexIndices=BNt(o,e,r,i)}}intersectRayTriangleRange(e,r){{if(e>=r)return;const i=this.triangleVertexIndices,n=this.positionAttribute.data,s=this.positionAttribute.stride,o=this._rayOrigin,a=o[0],l=o[1],c=o[2],h=this._rayDirection,p=h[0],f=h[1],m=h[2];for(let g=e,_=3*e;g<r;++g){let b=i[_++]*s;const w=n[b++],x=n[b++],T=n[b];b=i[_++]*s;const E=n[b++],C=n[b++],A=n[b];b=i[_++]*s;const I=E-w,M=C-x,D=A-T,U=n[b++]-w,z=n[b++]-x,B=n[b]-T,ee=f*B-z*m,te=m*U-B*p,K=p*z-U*f,W=I*ee+M*te+D*K;if(Math.abs(W)<=Number.EPSILON)continue;const N=a-w,L=l-x,F=c-T,G=N*ee+L*te+F*K;if(W>0){if(G<0||G>W)continue}else if(G>0||G<W)continue;const q=L*D-M*F,Z=F*I-D*N,X=N*M-I*L,oe=p*q+f*Z+m*X;if(W>0){if(oe<0||G+oe>W)continue}else if(oe>0||G+oe<W)continue;const pe=(U*q+z*Z+B*X)/W;if(pe>=0){const ye=this.indices[g]+this.firstTriangleIndex,Se=Ale(I,M,D,U,z,B,FNt);this._callback(pe,Se,ye,!1)}}}tre.numFacesTested+=r-e}intersectRay(e,r){tre.numFacesTested=0;const i=ke(e.r0[0],e.r0[1],e.r0[2]),n=ke(e.r1[0],e.r1[1],e.r1[2]),s=n[0]-i[0],o=n[1]-i[1],a=n[2]-i[2];if(s*s+o*o+a*a<qI)return;this._rayOrigin=i;const l=this._rayDirection;l[0]=s,l[1]=o,l[2]=a;const c=this.triangleVertexIndices.length/3;this._callback=r;const h=this.bspNodeTree[0];this.intersectRayBSP(h,0,c)}intersectRayBSP(e,r,i){const n=this._rayOrigin,s=this._rayDirection;if(!NNt(e.aabb,n,s))return;const o=e.axis,a=e.d;if(n[o]<a||s[o]<0){const l=r,c=e.midStartIndex;if(l<c){const h=e.leftNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(e.midStartIndex,e.rightStartIndex),n[o]>a||s[o]>0){const l=e.rightStartIndex,c=i;if(l<c){const h=e.rightNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}};Pce.numFacesTested=0;const FNt=P(),tC=[1/0,1/0,1/0],rC=[-1/0,-1/0,-1/0];function kNt(t,e,r,i,n,s){let o=r,a=i;for(;o<a;){const c=t[o];e[6*c+n+3]<=s?++o:(--a,t[o]=t[a],t[a]=c)}let l=o;for(a=i;l<a;){const c=t[a-1];e[6*c+n]>=s?--a:(t[a-1]=t[l],t[l]=c,++l)}return{next:o,mid:l}}function UNt(t,e,r,i){if(i<=r)return r2(NaN,NaN,NaN,NaN,NaN,NaN);{const n=6*t[r];for(let s=0;s<3;++s)tC[s]=e[n+0+s],rC[s]=e[n+3+s]}for(let n=r+1;n<i;++n){const s=6*t[n];for(let o=0;o<3;++o)tC[o]=Math.min(tC[o],e[s+0+o]),rC[o]=Math.max(rC[o],e[s+3+o])}return r2(tC[0],tC[1],tC[2],rC[0],rC[1],rC[2])}function zNt(t){const e=t[3]-t[0],r=t[4]-t[1],i=t[5]-t[2],n=e>r?e>i?0:r>i?1:2:r>i?1:i>e?2:0;return{axis:n,midValue:(t[n]+t[n+3])/2}}function VNt(t,e,r,i,n){const s=r-e,o=new Float32Array(6*s);for(let a=0;a<s;++a){const l=3*(a+e),c=t[l+0]*n,h=t[l+1]*n,p=t[l+2]*n;for(let f=0;f<3;++f){const m=i[c+f],g=i[h+f],_=i[p+f];o[6*a+f]=Math.min(m,g,_),o[6*a+3+f]=Math.max(m,g,_)}}return o}function BNt(t,e,r,i){const n=i-r;let s=0;for(let a=r;a<i;++a)for(let l=0;l<3;++l)s=Math.max(e[3*a+l],s);const o=s<=jUe?new Uint16Array(3*n):new Uint32Array(3*n);for(let a=0;a<n;++a){const l=3*(t[a]+r);for(let c=0;c<3;++c){const h=e[l+c];o[3*a+c]=h}}return o}const jUe=65535;let yn=class extends Io{constructor(){super(...arguments),this.output=V.Color,this.overlayMode=h_.Disabled,this.tileBlendInput=zg.LayerOnly,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.atmosphere=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.stencilEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.shading=!Qr.TERRAIN_USE_LEGACY_SHADING,this.useLegacyTerrainShading=Qr.TERRAIN_USE_LEGACY_SHADING,this.invisible=!1,this.tileBorders=!1,this.visualizeNormals=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.pbrMode=_t.Terrain}};u([j({count:V.COUNT})],yn.prototype,"output",void 0),u([j({count:h_.COUNT})],yn.prototype,"overlayMode",void 0),u([j({count:zg.COUNT})],yn.prototype,"tileBlendInput",void 0),u([j()],yn.prototype,"spherical",void 0),u([j()],yn.prototype,"doublePrecisionRequiresObfuscation",void 0),u([j()],yn.prototype,"atmosphere",void 0),u([j()],yn.prototype,"receiveShadows",void 0),u([j()],yn.prototype,"hasSlicePlane",void 0),u([j()],yn.prototype,"backfaceCullingEnabled",void 0),u([j()],yn.prototype,"stencilEnabled",void 0),u([j()],yn.prototype,"textureFadingEnabled",void 0),u([j()],yn.prototype,"renderOccluded",void 0),u([j()],yn.prototype,"hasScreenSpaceReflections",void 0),u([j()],yn.prototype,"hasCloudsReflections",void 0),u([j()],yn.prototype,"shading",void 0),u([j()],yn.prototype,"useLegacyTerrainShading",void 0),u([j()],yn.prototype,"invisible",void 0),u([j()],yn.prototype,"tileBorders",void 0),u([j()],yn.prototype,"visualizeNormals",void 0),u([j()],yn.prototype,"screenSizePerspective",void 0),u([j()],yn.prototype,"receiveAmbientOcclusion",void 0),u([j({count:_t.COUNT})],yn.prototype,"pbrMode",void 0),u([j({constValue:ci.CompressedAttribute})],yn.prototype,"normalType",void 0),u([j({constValue:cs.Compressed})],yn.prototype,"textureCoordinateType",void 0),u([j({constValue:!1})],yn.prototype,"highStepCount",void 0),u([j({constValue:!1})],yn.prototype,"useCustomDTRExponentForWater",void 0),u([j({constValue:!1})],yn.prototype,"useFillLights",void 0);const PW=7,jNt=10,IW=Ks();var no;(function(t){t[t.Opaque=0]="Opaque",t[t.Semitransparent=1]="Semitransparent",t[t.TransparentWithDraped=2]="TransparentWithDraped",t[t.Empty=3]="Empty"})(no||(no={}));let yu=class extends be{get _isGlobal(){return this._stage.viewingMode===qe.Global}get shading(){return this._techniqueConfiguration.shading}set shading(e){this._techniqueConfiguration.shading=e}constructor(e){super(e),this.type=pn.TERRAIN,this.isGround=!0,this._tileSize=256,this._techniqueConfiguration=new yn,this._passParameters=new yUe,this._rctx=null,this._renderDataPool=new ko(QDt),this._patchGroups=new Map,this._patchGroupsDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new lUe,this._highestVisibleLODTile=null,this._visible=!0,this._transparencyState=no.Opaque,this._velvetOverground=!0,this._castShadows=!0,this._emptyTex=null,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.needsHighlight=!1,this.renderOccludedFlags=vn.Occlude}initialize(){const e=[Ee.OPAQUE_TERRAIN,Ee.TRANSPARENT_TERRAIN,Ee.OCCLUDED_TERRAIN];this._stage.addRenderPlugin(e,this)}destroy(){this._stage.removeRenderPlugin(this),ZLt()}get canRender(){return this._visible&&!!this._rootTiles&&!this.renderingDisabled}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setDirty()}set transparency(e){this._transparencyState!==e&&(this._techniqueConfiguration.invisible=e===no.TransparentWithDraped||e===no.Empty,this._transparencyState=e,this.setNeedsRender())}get transparency(){return this._transparencyState}get needsLinearDepth(){return this._overlayRenderer.hasWater}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return!!this._techniqueConfiguration.visualizeNormals}set visualizeNormals(e){this._techniqueConfiguration.visualizeNormals!==e&&(this._techniqueConfiguration.visualizeNormals=e,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this._setSortingDirty()}set velvetOverground(e){this._velvetOverground!==e&&(this._velvetOverground=e,this.setNeedsRender())}get layerUid(){return Y1}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender())}set pbrMode(e){this._techniqueConfiguration.pbrMode!==e&&(this._techniqueConfiguration.pbrMode=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender())}setRootTiles(e){this._rootTiles=e,this.setDirty()}setNeedsHighlight(e){this.needsHighlight=e,this.setNeedsRender()}setRenderOccludedOverlay(e){this.renderOccludedFlags=e?NV:vn.Occlude,this.setNeedsRender()}setStencilEnabledLayerExtents(e){this._stencilEnabledLayerExtents=e,this._setSortingDirty()}setTileSize(e){this._tileSize=e,v(this._tileRenderer)&&(this._tileRenderer.tileSize=e),this.setDirty()}_prepareTileForLoading(e){e.renderData||(e.renderData=this._renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e))}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometryState(e),this.updateTileTexture(e,Mt.TEXTURE_FADING)}updateTileTexture(e,r){v(this._tileRenderer)&&(this._tileRenderer.updateTileTexture(e,r===Mt.TEXTURE_FADING?js.FADING:js.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(r))}updateTileGeometryState(e){for(const i of e.layerInfo[vr.ELEVATION])i.pendingUpdates&=~Mt.GEOMETRY;e.resetPendingUpdate(Mt.GEOMETRY);const r=e.renderData.updateGeometryState();return r&&this.setDirty(),r}updateGeometryIfNeeded(e){e.isLoaded&&e.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(e){const r=e.renderData;r&&(r.releaseGeometry(),this._renderDataPool.release(r),r.clear(),e.renderData=null,e.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(e){const r=jNt-PW,i=Math.max(0,Math.floor((e.level-r)/PW)*PW);if(this._isGlobal&&i===0)return cl;for(;e.parent&&e.level>i;)e=e.parent;return e.centerAtSeaLevel}setVisibility(e){this._visible=e,this.setDirty()}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.setNeedsRender())}setDirty(e=Gn.UPDATE){this._patchGroupsDirty=!0,this._context.requestRender(e)}_setSortingDirty(e=Gn.UPDATE){this._patchSortingDirty=!0,this._context.requestRender(e)}setNeedsRender(e=Gn.UPDATE){this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this._rctx=e.renderContext.rctx,this._techniqueRepository=e.techniqueRepository,this._tileRenderer=new INt(this._rctx,this._tileSize,this._techniqueRepository),this.updateTileBackground(),this._emptyTex=xDe(this._rctx)}uninitializeRenderContext(){this._emptyTex=rt(this._emptyTex),this._tileRenderer=rt(this._tileRenderer)}intersect(e,r,i,n){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&this.transparency!==no.Opaque)return;const s=GNt,o=HNt;ge(s,n,i),he(o,1/s[0],1/s[1],1/s[2]);const a=e.results.min,l=e.results.max,c=e.results.ground,h=e.options.store===ba.MIN,p=!!e.results.ground.target,f=rwt(e.verticalOffset),m=e.tolerance;let g,_=h&&v(a.dist)?a.dist:1/0;const b=x=>{const T=x.renderData;if(!(T!=null&&T.vao))return;const E=T.geometryInfo;B9(IW,E.boundingBox);const C=T.localOrigin;v(f)&&(f.localOrigin=C,f.applyToAabb(IW));const A=IW;if(iC[0]=i[0]-C[0],iC[1]=i[1]-C[1],iC[2]=i[2]-C[2],!Ole(A,iC,o,m,_))return;const I=(K,W,N)=>{K.set(this.type,x,W,N,id),_=h&&v(a.dist)?a.dist:1/0},M=(K,W)=>{if(v(W)&&K>=0&&(e.options.backfacesTerrain||ve(W,s)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||r==null||r(i,n,K))){if((c.dist==null||K<c.dist)&&I(c,K,W),e.options.isFiltered)return;e.options.store===ba.ALL&&(R(g)?(g=nle(e.ray),I(g,K,W),e.results.all.push(g)):K<g.dist&&I(g,K,W)),(a.dist==null||K<a.dist)&&I(a,K,W),e.options.store!==ba.MIN&&(l.dist==null||K>l.dist)&&I(l,K,W)}},D=qNt;ge(D,n,C);const U=E.indices,z=E.vertexAttributes,B=z.getField(O.POSITION,Ui),ee=new Qe(B.typedBuffer,3,!1,z.stride/4),te=E.indexCount/3;if(R(f)&&te>BUe){const K=x.renderData;R(K.intersectionData)&&(K.intersectionData=new Pce(U,0,te,ee)),K.intersectionData.intersectRay({r0:iC,r1:D},M)}else XN(iC,D,0,te,U,ee,null,f,M)},w=this._rootTiles;v(w)&&(()=>{const x=this._tileIterator;x.reset(w);const T=e.options.invisibleTerrain;for(let E=x.next();E;E=x.next())!(E.visible||T&&E.intersectsClippingArea)||!v(f)&&!E.intersectsRay(i,s,m,_)||p&&this._useStencilForTile(E)?x.skipSubtree():b(E)})()}processScaleRangeQueries(e,r){var i;if(!r.done)for(this._updatePatchGroups();e.updating&&!r.done;){e.prepare();for(const n of this._patchGroups.values())for(const s of n)v((i=s.renderData)==null?void 0:i.textureReference)&&e.queriesForTile(s);e.process(),r.madeProgress()}}prepareTechnique(e){if(e.bindParameters.slot===Ee.OCCLUDED_TERRAIN){if(!(e.renderOccludedMask&NV))return null}else{const r=this.transparency===no.Opaque?Ee.OPAQUE_TERRAIN:Ee.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==r)return null}switch(e.output){case V.Color:return this.transparency===no.Empty?null:(this._techniqueConfiguration.hasScreenSpaceReflections=e.bindParameters.ssr.enabled,this._techniqueConfiguration.hasCloudsReflections=v(e.bindParameters.cloudsFade.data),this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=e.bindParameters.ssaoHelper.active,this._techniqueConfiguration.overlayMode=this._overlayRenderer.isEmpty?h_.Disabled:this._overlayRenderer.hasWater?h_.EnabledWithWater:h_.Enabled,this._updateTechnique(V.Color,e.bindParameters.slot===Ee.OCCLUDED_TERRAIN));case V.Shadow:case V.ShadowExcludeHighlight:return this._castShadows&&e.bindParameters.lighting.globalFactor===1?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(V.Shadow,!1)):null;case V.Depth:return this.transparency===no.Empty?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(V.Depth,!1));case V.Normal:return this.transparency===no.Empty?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(V.Normal,!1));case V.ObjectAndLayerIdColor:return this.transparency===no.Empty?null:this._updateTechnique(V.ObjectAndLayerIdColor,!1);case V.Highlight:return this.transparency!==no.Empty&&this.needsHighlight?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(V.Highlight,!1)):null}return null}render(e,r){const i=e.bindParameters.lighting.globalFactor===1;switch(this._updatePatchGroups(),r.useStencil=!1,e.output){case V.Color:{const n=e.bindParameters.slot===Ee.OCCLUDED_TERRAIN?Pc.Occluded:Pc.ColorAndWater;this.transparency===no.Opaque?this._renderMaterialPass(e,r,n):e.offscreenRenderingHelper.renderToTargets(()=>this._renderMaterialPass(e,r,n),e.offscreenRenderingHelper.tmpColor,e.offscreenRenderingHelper.mainDepth,[0,0,0,0]);break}case V.Depth:case V.Normal:this._renderAuxiliaryPass(e,r,Pc.None);break;case V.Highlight:this.needsHighlight&&this._renderAuxiliaryPass(e,r,Pc.Highlight);break;case V.Shadow:case V.ShadowExcludeHighlight:this._castShadows&&i&&this._renderAuxiliaryPass(e,r,Pc.None);break;case V.ObjectAndLayerIdColor:this._renderAuxiliaryPass(e,r,Pc.ObjectAndLayerIdColor)}}_renderMaterialPass(e,r,i){const{rctx:n}=e;this._passParameters.overlaySource=i,n.bindTechnique(r,this._passParameters,e.bindParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this._renderPatchGroups(e,r,i)}_renderAuxiliaryPass(e,r,i){const n=e.rctx;this._passParameters.overlaySource=i,n.bindTechnique(r,this._passParameters,e.bindParameters),this._renderPatchGroupsAuxiliary(e,r,i)}updateTileBackground(e=null){if(R(this._tileRenderer))return;const r=this._tileRenderer;let i=null;if(v(e)){const n=Xe.toUnitRGBA(e);i=ke(n[0]||0,n[1]||0,n[2]||0)}r.setBackground(i),this._allTiles.forAll(n=>r.updateTileTexture(n,js.FADING)),this._techniqueConfiguration.tileBlendInput=r.backgroundIsGrid?zg.GridComposite:v(r.backgroundColor)?zg.ColorComposite:zg.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this._patchGroupsDirty&&(this._highestVisibleLODTile=null,this._rebuildPatchGroups(),this._patchGroupsDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty&&this.renderOrder!==e3.NONE){const e=Array.from(this._patchGroups.values()),r=this._stencilEnabledLayerExtents;for(const i of e)cUe(this.renderOrder,i,r);e.sort((i,n)=>uUe(i[0],n[0],this.renderOrder)),this._patchGroups=new Map(e.map(i=>[i[0].renderData.localOrigin,i])),this._patchSortingDirty=!1}}_rebuildPatchGroups(){var r;const e=this._rootTiles;if(!R(e)){(r=e[0])==null||r.surface.checkAllTilesWaterproofness(),this._patchGroups.clear();for(const i of e)this._rebuildPatchGroupsForRootTile(i)}}_rebuildPatchGroupsForRootTile(e){const r=this._tileIterator;for(r.resetOne(e);!r.done;){const i=r.next(),n=i.renderData;if(!n){this._numTilesCulled++;continue}if(!i.visible){this._numTilesCulled++,r.skipSubtree();continue}const s=n.localOrigin;let o=this._patchGroups.get(s);o||(o=new Array,this._patchGroups.set(s,o)),o.push(i),(!this._highestVisibleLODTile||i.vlevel>this._highestVisibleLODTile.vlevel)&&(this._highestVisibleLODTile=i),r.skipSubtree()}}_useStencilForTile(e){for(const r of this._stencilEnabledLayerExtents)if(e.intersectsExtent(r))return!0;return!1}_renderPatchGroupsAuxiliary(e,r,i){const n=this._stencilEnabledLayerExtents.length>0;this._patchGroups.forEach(s=>{const o=s[0].renderData.localOrigin;r.program.bindDraw(new Ate(o),e.bindParameters,this._passParameters);for(let a=0;a<s.length;a++)this._renderPatch(e,r,s[a],Ft.TRIANGLES,n,i)}),e.rctx.bindVAO(null)}_renderPatchGroups(e,r,i){const n=e.bindParameters.camera,s=r.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const p=KFe(this._stage.viewingMode,this._ellipsoidRadius),f=this.pointsOfInterest.centerOnSurfaceFrequent.distance;p.update({distance:f,fovY:n.fovY})}const o=this._stencilEnabledLayerExtents.length>0,a=i===Pc.Occluded;a&&(s.bindTexture("tex",this._emptyTex),s.setUniform3fv("textureOpacities",cl),s.setUniform4fv("texOffsetAndScale",Wg));const l=v(this._tileRenderer)&&v(this._tileRenderer.backgroundColor)?this._tileRenderer.backgroundColor:cl;this._techniqueConfiguration.tileBlendInput===zg.ColorComposite&&s.setUniform3fv("backgroundColor",l);const c=this.wireframe?Ft.LINES:Ft.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&s.bindTexture("texNext",this._emptyTex);const h=this._patchGroups;for(const p of h.values()){const f=p[0].renderData.localOrigin;r.program.bindDraw(new Ate(f),e.bindParameters,this._passParameters),this._numOriginsRendered++;for(const m of p){const g=m.renderData,_=g.textureReference;if(!R(_)){if(!a){s.setUniform4fv("texOffsetAndScale",_.offsetAndScale),s.bindTexture("tex",_.texture.texture);const b=g.textureFadeFactor,w=b<1?g.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&v(w)&&b<1?(s.setUniform1f("fadeFactor",b),s.setUniform4fv("nextTexOffsetAndScale",w.offsetAndScale),s.setUniform3fv("nextTexOpacities",w.opacities),s.bindTexture("texNext",w.texture.texture)):s.setUniform1f("fadeFactor",1),g.textureIsFading&&this.setNeedsRender(),s.setUniform3fv("textureOpacities",_.opacities)}this._renderPatch(e,r,m,c,o,i),m.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}e.rctx.bindVAO(null)}_renderPatch(e,r,i,n,s,o){const a=i.renderData,l=a.vao,c=l.indexBuffer;if(R(c))return void(Zs&&console.error("Rendered tile with no indices: ",i.lij," : ",a));const h=r.program;o===Pc.None||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(h,a.overlay),s&&(r.useStencil=this._useStencilForTile(i),r.bindPipelineState(e.rctx,e.bindParameters.slot));const p=a.geometryInfo.indexCount;e.rctx.bindVAO(l),h.assertCompatibleVertexAttributeLocations(l),e.rctx.drawElements(n,p,c.indexType,0)}_bindOverlayPatchData(e,r){e.setUniform4fv("overlayTexOffset",r.offsets),e.setUniform4fv("overlayTexScale",r.scales)}_updateTechnique(e,r){return this._techniqueConfiguration.output=e,e===V.Color&&(this._techniqueConfiguration.atmosphere=this._isGlobal&&this._velvetOverground),this._techniqueConfiguration.renderOccluded=r,this._techniqueConfiguration.stencilEnabled=!1,this._shaderTechnique=this._techniqueRepository.releaseAndAcquire(_Ue,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){return{tileRenderer:this._tileRenderer}}};u([d({constructOnly:!0})],yu.prototype,"_overlayRenderer",void 0),u([d({constructOnly:!0})],yu.prototype,"_stage",void 0),u([d({readOnly:!0})],yu.prototype,"_isGlobal",null),u([d({constructOnly:!0})],yu.prototype,"_allTiles",void 0),u([d({constructOnly:!0})],yu.prototype,"_ellipsoidRadius",void 0),u([d({value:!1})],yu.prototype,"renderingDisabled",null),u([d()],yu.prototype,"renderPatchBorders",null),u([d()],yu.prototype,"visualizeNormals",null),u([d()],yu.prototype,"cullBackFaces",null),u([d({value:e3.FRONT_TO_BACK})],yu.prototype,"renderOrder",null),u([d()],yu.prototype,"wireframe",null),yu=u([$("esri.views.3d.terrain.TerrainRenderer")],yu);const GNt=P(),HNt=P(),iC=P(),qNt=P();let WNt=class{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}},fg=class extends be{constructor(e){super(e),this._handles=new qr}initialize(){this._handles.add(this.layers.on("change",()=>this._update())),this._handles.add(ne(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._handles=ze(this._handles),this._waitTask=null}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(r=>!(!E$(r)||r.isRejected())&&!(r.isFulfilled()&&!XNt(r,this.viewSpatialReference,this.viewingMode))&&(e=r,!((r==null?void 0:r.type)==="vector-tile"||jV(r)))),e)if(e.isResolved()){const r=F7(e,this.viewSpatialReference,this.viewingMode);if(v(r)){const i=new Pu(r.tileInfo);this._lockTilingScheme(i)}}else this._updateWhen(e)}_updateWhen(e){const r=e.when().catch(()=>{}).then(()=>{r!==this._waitTask||this.destroyed||this._update()});this._waitTask=r}_lockTilingScheme(e){if(this.viewingMode===qe.Global){const r=e.levels.length-1;e.spatialReference.isWebMercator?e=Pu.makeWebMercatorAuxiliarySphere(r):o2(e.spatialReference)&&(e=Pu.makeGCSWithTileSize(e.spatialReference,e.pixelSize,r))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this._handles.removeAll(),this._handles.add(ne(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===qe.Global){const e=this.extentHelper.viewSpatialReference,r=o2(e)||my(e)||gy(e);e.isWebMercator?this.tilingScheme=Pu.WebMercatorAuxiliarySphere:r&&(this.tilingScheme=Pu.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;v(e)&&!AS(e,this.extent)&&(this.tilingScheme=Pu.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){return{lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};function XNt(t,e,r){return v(F7(t,e,r))}u([d()],fg.prototype,"tilingScheme",void 0),u([d({readOnly:!0})],fg.prototype,"extent",void 0),u([d({value:!1})],fg.prototype,"tilingSchemeLocked",void 0),u([d({constructOnly:!0})],fg.prototype,"viewSpatialReference",void 0),u([d({constructOnly:!0})],fg.prototype,"layers",void 0),u([d({constructOnly:!0})],fg.prototype,"extentHelper",void 0),u([d({constructOnly:!0})],fg.prototype,"viewingMode",void 0),fg=u([$("esri.views.3d.terrain.TilingSchemeLogic")],fg);let YNt=class{constructor(){this.offset=Ne(),this.scale=0,this.tile=null}init(e,r,i,n){this.tile=e,this.offset[0]=r,this.offset[1]=i,this.scale=n}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}},or=class extends Sn.EventedMixin(be){constructor(e){var r,i;super(e),this._scaleRangeQueries=new qU,this._iteratorPool=new ko(lUe,n=>n.remove=()=>this._iteratorPool.release(n)),this._postorderIterator=new rDt,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._visibleCached=!1,this._usedMemory=null,this._performanceInfo=new WNt,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=P(),this._eyePosSurfaceSR=P(),this._splitLimits=new TNt,this._frustum=_D(),this._viewProjectionMatrix=$e(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._handles=new qr,this._watchUpdatingTracking=new Hg,this._frameTask=NO,this._allTiles=new Wt,this._upsampleInfoPool=new ko(YNt),this._rootTilesExtent=Kt(),this.updatingProgress=0,this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=Je.WebMercator,this.visibleElevationBounds=new hR(1/0,-1/0),this.rootTileElevationBounds=new hR(1/0,-1/0),this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this.oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this._shading=!0,this._isWebMercator=!1,this._isWebMercatorOnPlateeCarree=!1,this._isGlobal=!((i=(r=e.view)==null?void 0:r.state)!=null&&i.isLocal)}initialize(){this._lercDecoder=CLt(this.view.resourceController),this._tilePool=this.view.state.isLocal?new ko(vNt):new ko(wNt);const e=this.view.resourceController.memoryController;this._upsampleMapCache=e.newCache("esri.views.3d.terrain.upsample",o=>o.unloadMapData()),this._elevationQueryCache=new SLt(e.newCache("elevation-query")),this._set("overlayManager",new Ec({surface:this})),this._handles.add([ne(()=>this.overlayManager.hasHighlights,o=>this._renderer.setNeedsHighlight(o)),ne(()=>this.overlayManager.rendersOccluded,o=>this._renderer.setRenderOccludedOverlay(o)),ne(()=>this.overlayManager.renderer.isEmpty,()=>this._evaluateTransparency())],"overlayManager"),this._renderer=new yu({_overlayRenderer:this.overlayManager.renderer,_ellipsoidRadius:ii(this.view.spatialReference).radius,_stage:this.view._stage,_allTiles:this._allTiles}),this._handles.add([ne(()=>this.baseOpacity,()=>{this._handleLayerViewChanges(),this._updateTileTextures(this._evaluateTransparency()?js.UNFADED:js.IMMEDIATE)},Wi),ne(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?js.UNFADED:js.IMMEDIATE),Wi),ne(()=>this.renderingDisabled,()=>{var o,a;return(a=(o=this.view)==null?void 0:o._stage)==null?void 0:a.renderer.setParameters({terrainRenderingEnabled:!this.renderingDisabled})},Zr),ne(()=>this.backgroundColor,o=>{this._handleLayerViewChanges(),this._renderer.updateTileBackground(o)},Wi),ne(()=>this.snapLevel,()=>this._viewChanged=!0,Zr),ne(()=>this.view.pointsOfInterest,o=>{this._renderer.pointsOfInterest=o,this._watchUpdatingTracking.removeAll(),o&&this._watchUpdatingTracking.add(()=>o.focus.renderLocation,()=>this._allTilesSorted=!1)}),ne(()=>Qr.TERRAIN_TILE_TREE_SHOW_TILES,o=>{o&&!this._treeDebugger?Q(()=>import("./TerrainTileTree3DDebugger-9932c702.js"),["assets/TerrainTileTree3DDebugger-9932c702.js","assets/TileTreeDebugger-197583c7.js"]).then(({TerrainTileTree3DDebugger:a})=>{!this._treeDebugger&&Qr.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new a({view:this.view}))}):o||(this._treeDebugger=ze(this._treeDebugger))},Vt)]);const{spatialReference:r}=this.view;this._extentHelper=BLt(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:r});const i=new wO({getCollections:()=>{var o,a,l;return(l=(a=(o=this.view)==null?void 0:o.defaultsFromMap)==null?void 0:a.mapCollections)==null?void 0:l.map(({layers:c})=>c)},getChildrenFunction:o=>o&&"layers"in o?o.layers:null}),n=new fg({layers:i,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:r});this._set("tilingSchemeLogic",n),this._updateTilingScheme(),this._elevationDataRequester=this.view.resourceController.createStreamDataRequester($g.ELEVATION),this._mapDataRequester=this.view.resourceController.createStreamDataRequester($g.BASEMAP);const s=this.view.resourceController.scheduler;this._frameTask=s.registerTask(St.TERRAIN_SURFACE,this),this._handles.add([ne(()=>this._extentHelper.stencilEnabledExtents,o=>this._renderer.setStencilEnabledLayerExtents(o),Vt),ne(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),Zr),ne(()=>this.extent,()=>this._updateRootTiles(),Vt),this.view.on("resize",()=>this._viewChangeUpdate()),ne(()=>{var l,c;const o=this.view,a=o.state;return[this._lodBias,this.lodSnapping,(c=(l=o.resourceController)==null?void 0:l.memoryController)==null?void 0:c.memoryFactor,a.camera,a.contentCamera,a.fixedContentCamera]},()=>this._viewChangeUpdate(),Wi),ne(()=>{var o,a;return(a=(o=this.view.qualitySettings)==null?void 0:o.tiledSurface)==null?void 0:a.textureFadeDuration},o=>this._renderer.textureFadingEnabled=o>0,Vt),ne(()=>{var o;return(o=this.view.qualitySettings)==null?void 0:o.physicallyBasedRenderingEnabled},o=>this._renderer.pbrMode=o?_t.Terrain:_t.Disabled,Vt),ne(()=>this._userClippingExtent,()=>this._updateClippingExtent(),Zr)]),this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._handles.add([ne(()=>{var o;return(o=this.view)==null?void 0:o.map.ground.shading},()=>{this._updateShadingIfChanged()})]),this._updateShading(),this._layerViewsDirty=!0,this._handleLayerViewChanges()}destroy(){this._frameTask.remove(),this._handles.destroy(),this._watchUpdatingTracking.destroy(),this._lercDecoder=en(this._lercDecoder),this._removeAllTiles(),this._upsampleMapCache=ze(this._upsampleMapCache),this._elevationQueryCache=ze(this._elevationQueryCache);const e=this.tilingSchemeLogic.layers;this._set("tilingSchemeLogic",ze(this.tilingSchemeLogic)),e.destroy(),this._basemapLayerViewHandles.forEach((r,i)=>this._unregisterTiledLayerView(i)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",ze(this.overlayManager)),this._tilePool=ze(this._tilePool),Ece.prune(),this._treeDebugger=ze(this._treeDebugger),this._renderer=ze(this._renderer),this._iteratorPool=ze(this._iteratorPool),this._set("view",null),this._upsampleInfoPool=ze(this._upsampleInfoPool),FLt(),IDt()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){var e,r;if(this.lodSnapping===K$.ON){const i=this.view,n=this.tilingScheme,s=(r=(e=i.pointsOfInterest)==null?void 0:e.cameraOnSurface)==null?void 0:r.scale;if(s&&n){const o=i.state.contentCamera;let a=h7(i,o.eye,o.viewForward,o.up).tilt;a>90&&(a=180-a);const l=2*(a/90)**2,c=n.levelAtScale(s)-l;return Math.round(c)}}return null}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?K$.ON:K$.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:e}=this,{clippingArea:r}=this.view;if(R(r)||R(e))return null;const i=Kt(),n=G6e(r,i,e)?i:null,s=this._get("extent");return AS(n,s)?s:n}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const e=uZ(this.groundExtent,this._userClippingExtent,Kt()),r=this._get("extent");return AS(e,r)?r:e}get groundExtent(){return v(this._tilingSchemeExtent)?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){var e;return(e=this.tilingSchemeLogic)==null?void 0:e.extent}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this.running||this._watchUpdatingTracking.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||this.overlayManager.updating)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){return this.view.map.ground.opacity}set baseOpacity(e){this.view.map.ground.opacity=e}get viewingMode(){return this.view.state.viewingMode}get ready(){return v(this._rootTiles)}set renderOrder(e){this._renderer.renderOrder=e,this._set("renderOrder",e)}get rootTiles(){return this._rootTiles}get spatialReference(){var e;return((e=this.tilingScheme)==null?void 0:e.spatialReference)??null}get backgroundColor(){return this.view.map.ground.surfaceColor}set backgroundColor(e){this.view.map.ground.surfaceColor=e}set slicePlaneEnabled(e){this._renderer.slicePlaneEnabled=e,this._set("slicePlaneEnabled",e),this._evaluateTransparency()}get tilingSchemeLocked(){var e;return((e=this.tilingSchemeLogic)==null?void 0:e.tilingSchemeLocked)??!1}set velvetOverground(e){this._renderer.velvetOverground=e,this._set("velvetOverground",e)}get wireframe(){return this._renderer.wireframe}set wireframe(e){e!==this._renderer.wireframe&&(this._renderer.wireframe=e,this._updateAllTileGeometries())}set _visible(e){e!==this._visibleCached&&(this._visibleCached=e,this._renderer.setVisibility(e),this.suspended=!e)}get opaque(){return this._renderer.transparency===no.Opaque}set suspended(e){this._set("suspended",e),this._viewChangeUpdate()}get textureFadeDuration(){return this.view.qualitySettings.tiledSurface.textureFadeDuration??0}intersect(e,r,i,n){this._renderer.intersect(e,r,i,n)}getElevation(e,r,i,n){const s=this._rootTiles;if(R(s)||!s.length||s[0].layerInfo[vr.ELEVATION].length===0)return null;const o=fc;return o[0]=e,o[1]=r,o[2]=i,zo(o,n,o,this._spatialReference)?mbe(s,o[0],o[1]):(re.getLogger(this.declaredClass).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null)}getElevations(e,r,i){const n=this._rootTiles,s=n?n[0].layerInfo[vr.ELEVATION].length:0;if(!R(n)&&n.length&&s!==0)for(let o=0;o<r;++o){const a=3*o;i(o,mbe(n,e[a+0],e[a+1]))}else for(let o=0;o<r;++o)i(o,null)}getScale(e){if(!this.tilingScheme)return null;if(!Ba(e,fc,this.spatialReference))return re.getLogger(this.declaredClass).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const r=this._rootTiles;if(v(r)){for(const i of r)if(i!=null&&i.containsPoint(fc)){let n=i;for(;n.children[0]&&!n.rendered;){const s=n.children[0].extent;let o=0;fc[0]>s[2]&&(o+=1),fc[1]<s[1]&&(o+=2),n=n.children[o]}return this._getLodBiasCorrectedScale(n.level)}}return 1/0}getSphereElevationBounds(e,r,i,n,s){var h;if(fc[0]=e,fc[1]=r,fc[2]=i,fc[3]=n,!zo(fc,s,fc,(h=this.tilingScheme)==null?void 0:h.spatialReference))return re.getLogger(this.declaredClass).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let o=1/0,a=-1/0;const l=p=>{if(p&&Zhe(p.extent,fc))if(p.isLeaf||p.rendered)o=Math.min(o,p.elevationBounds[0]),a=Math.max(a,p.elevationBounds[1]);else for(const f of p.children)l(f)},c=this._rootTiles;if(v(c))for(const p of c)l(p);return{min:o,max:a}}getSphereScale(e,r){if(!this.tilingScheme)return null;if(!Ba(e,fc,this.spatialReference))return re.getLogger(this.declaredClass).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;fc[3]=r;let i=null;const n=o=>{if(o&&Zhe(o.extent,fc)){const a=o.children;if(a[0]&&!o.rendered)for(const l of a)n(l);else{const l=this._getLodBiasCorrectedScale(o.level);i=i==null?l:Math.min(i,l)}}},s=this._rootTiles;if(v(s))for(const o of s)n(o);return i}queryVisibleScaleRange(e,r,i,n){const s=r?this.tilingScheme.levelAtScale(r):0,o=i?this.tilingScheme.levelAtScale(i):1/0,a=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(e,s+a,o+a,n)}_evaluateTransparency(){var o,a;const e=this.baseOpacity,r=this.overlayManager.renderer.isEmpty,i=this._renderer.transparency,n=this._allSurfaceLayersTransparent()?r?no.Empty:no.TransparentWithDraped:e>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?no.Opaque:no.Semitransparent,s=i!==n;return s&&(this._renderer.transparency=n,(a=(o=this.view)==null?void 0:o._stage)==null||a.renderer.setParameters({terrainTransparency:this._renderer.transparency})),s}_updateTilingScheme(){var i,n,s;const e=this.tilingSchemeLogic.tilingScheme;if(e===this.tilingScheme)return;Cg(!!e,"tiling scheme cannot be reset to undefined"),this._isGlobal=!((n=(i=this.view)==null?void 0:i.state)!=null&&n.isLocal),this.tilingScheme&&this._removeAllTiles();const r=(e==null?void 0:e.spatialReference)??Je.WebMercator;this._spatialReference=r,this._isWebMercator=!!(r!=null&&r.isWebMercator),this._isWebMercatorOnPlateeCarree=this._isWebMercator&&Xie((s=this.view)==null?void 0:s.renderSpatialReference),this._set("tilingScheme",e),this._updateClippingExtent(),e&&(this._updateTiledLayers(),this._renderer.setTileSize(e.pixelSize),this.overlayManager.setSpatialReference(e.spatialReference),this._updateRootTiles())}_acquireTile(e,r,i,n){const s=this._tilePool.acquire();return mk[0]=e,mk[1]=r,mk[2]=i,s.init(mk,n,this),s}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:e,tilingScheme:r}=this;if(!r)return;const i=KNt;let n=r.rootTilesInExtent(e,i,5*eR);if(v(this._rootTiles)){if(n.length>eR)return void re.getLogger(this.declaredClass).warn(Qyt);const s=this._rootTiles.map(a=>a.lij),o=WBe(s,n,fbe);if(this._updatingRootTiles=!0,o.removed.length>0||o.added.length>0){const a=this._rootTiles.filter(l=>!(o.removed.findIndex(c=>fbe(c,l.lij))>-1)||(this._purgeTile(l),!1));o.added.forEach(l=>a.push(this._newRootTile(l))),this._setRootTiles(a)}}else this._updatingRootTiles=!0,n.length>eR&&(re.getLogger(this.declaredClass).warn(e0t),n=r.rootTilesInExtent(e,i,eR)),this._setRootTiles(n.map(s=>this._newRootTile(s)));AS(i,this._rootTilesExtent)||(this._rootTilesExtent=Kt(i)),this._visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){const e=this._allTiles.filter(r=>r.isLoaded&&r.intersectsClippingArea);e.forEach(r=>this._renderer.updateTileGeometryState(r)),e.forEach(r=>r.renderData.updateNeighborData()),this._updateTilesGeometries(e),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(e){if(e.length===0)return;e.sort(u_);const r=this.renderer;e.forEach(i=>r.updateGeometryIfNeeded(i)),e.forEach(i=>this._pendingTilesForElevationUpdateEvent.add(i))}_shouldSplit(e){return e.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===Mt.SPLIT}_newRootTile(e){const r=this._acquireTile(0,e[1],e[2],null);return this._shouldSplit(r)&&r.setPendingUpdate(Mt.SPLIT),this._loadTile(r),this._markTileToUpdate(r),this._updateRootTileElevationBounds(),r}_setRootTiles(e){if(this._rootTiles=e,this._allTiles.clear(),v(e)){const r=this._iteratorPool.acquire();for(r.reset(e);!r.done;)this._allTiles.push(r.next());r.remove()}this._renderer.setRootTiles(this._rootTiles),this._updateTilesVisibility(e)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this._visibleCached&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(e){e.updateClippingStatus(this.extent)&&e.resetPendingUpdate(Mt.GEOMETRY)&&this._updateTileGeometryState(e)}_updateTilesVisibility(e){if(R(e))return;const r=cDt(e),i=this.visibleElevationBounds;let n=r?i.min:1/0,s=r?i.max:-1/0;const o=this.extent,a=this._viewProjectionMatrix;this.setTileTreeDirty();const l=this._iteratorPool.acquire();for(l.reset(e);!l.done;){const c=l.next();c.updateClippingStatus(o)&&c.resetPendingUpdate(Mt.GEOMETRY)&&this._updateTileGeometryState(c),c.setPendingUpdate(Mt.RENDERDATA),c.computeVisibility(),c.updateScreenDepth(a),c.renderData&&(n=Math.min(c.elevationBounds[0],n),s=Math.max(c.elevationBounds[1],s))}l.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._batchUpdatePendingTileGeometries(),isFinite(n)&&isFinite(s)&&(i.min!==n||i.max!==s)&&(this.visibleElevationBounds=new hR(n,s))}_updateRootTileElevationBounds(){let e=1/0,r=-1/0;const i=this._rootTiles;v(i)&&i.forEach(({elevationBounds:s})=>{e=Math.min(e,s[0]),r=Math.max(r,s[1])});const n=this.rootTileElevationBounds;n.min===e&&n.max===r||(this.rootTileElevationBounds=new hR(e,r))}_updateViewDependentParameters(){const{camera:e,contentCamera:r}=this.view.state,i=Math.tan(.5*r.fovX),n=Math.tan(.5*r.fovY),s=this.tilingScheme.pixelSize,o=2**-this._lodBias*e.pixelRatio;this._splitLimits.aboveGround=e.aboveGround,this._splitLimits.fovX=i,this._splitLimits.fovY=n,this._splitLimits.relativeWidthLimit=s/e.width*this.maxTextureScale*o,this._splitLimits.relativeHeightLimit=s/e.height*this.maxTextureScale*o,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?(R(this._splitLimits.frustum)&&(this._splitLimits.frustum=_D()),iV(this._splitLimits.frustum,r.frustum)):this._splitLimits.frustum=null,iV(this._frustum,e.frustum),Mn(this._viewProjectionMatrix,r.projectionMatrix,r.viewMatrix),ce(this._eyePosRenderSR,r.eye),zo(e.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateRenderData(e){e.rendered&&!e.shouldLoad&&(GUe(e)?this._loadChildren(e):JNt(e)&&this._loadParent(e))}_updateTileGeometryState(e){e.updateVisibility(),this._renderer.updateTileGeometryState(e)&&this._markTileToUpdate(e),this._usedMemory=null}_markAllTileNeighborsForGeometryUpdate(e){const r=this._pendingTilesToUpdate;e.forEachLoadedNeighbor(i=>{r.add(i)})}_updateTileTexture(e,r){const i=e.resetPendingUpdate(Mt.TEXTURE_FADING)?Mt.TEXTURE_FADING:!!e.resetPendingUpdate(Mt.TEXTURE_NOFADING)&&Mt.TEXTURE_NOFADING;i&&(this._renderer.updateTileTexture(e,i),this._usedMemory=null,r.madeProgress())}_emitElevationUpdateEventForTiles(){const e=LW.extent;td(e),this._pendingTilesForElevationUpdateEvent.forEach(r=>$b(e,r.extent,e)),this._pendingTilesForElevationUpdateEvent.clear(),LW.spatialReference=this.spatialReference,this.emit("elevation-change",LW)}runTask(e){this._handleLayerViewChanges(e),this._frameTask.processQueue(e),this.renderer.processScaleRangeQueries(this._scaleRangeQueries,e),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(e),this._sortTiles(e);const r=!this.view.state.fixedContentCamera;this._mergeAndSplit(e,r),this._updateElevation(e),this._updateTextures(e),r||this._mergeAndSplit(e,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._batchUpdatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),e.done&&e.hasProgressed?this.requestUpdate():this.getUsedMemory(),this.notifyChange("updatingProgressValue")}_updateAllTilesStatus(e){if(!this._viewChanged||!this._rootTiles||e.done)return;this._viewChanged=!1;const r=this._iteratorPool.acquire();r.reset(this._rootTiles);const i=this.snapLevel,n=this._splitLimits,s=this._eyePosRenderSR;for(;!r.done;){const o=r.next(),a=o.shouldSplit(n,s,i);if(a!==Mt.SPLIT){if(o.resetPendingUpdate(Mt.SPLIT)&&o.updateAgentSuspension(),a===Mt.VSPLITMERGE&&o.updateAgents(vr.ELEVATION),r.skipSubtree(),!o.isLeaf){o.setPendingUpdate(Mt.MERGE),o.resetPendingUpdate(Mt.SPLIT);const l=this._iteratorPool.acquire();l.resetOne(o);const c=this._viewProjectionMatrix;for(let h=l.next();!l.done;h=l.next())this._updateClippingStatus(h),h.updateVisibility(),h.updateScreenDepth(c);l.remove()}}else o.resetPendingUpdate(Mt.MERGE),o.isLeaf&&(o.setPendingUpdate(Mt.SPLIT),r.skipSubtree()),o.rendered&&o.setPendingUpdate(Mt.RENDERDATA)}r.remove(),this.requestUpdate(),(this.shortBatches||!this.oneBatchPerFrameTask)&&this._batchUpdatePendingTileGeometries(),e.madeProgress()}_sortTiles(e){e.done||this._allTilesSorted||(aDt(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),e.madeProgress())}_markTileToUpdate(e){Re(e.isLoaded),e.intersectsClippingArea&&(this._pendingTilesToUpdate.add(e),this._markAllTileNeighborsForGeometryUpdate(e))}_batchUpdatePendingTileGeometries(){const e=this._pendingTilesToUpdate;if(e.size===0)return;const r=Array.from(this._pendingTilesToUpdate.keys()).filter(s=>s.isLoaded&&s.intersectsClippingArea),i=(s,o)=>{!(o!=null&&o.isLoaded)||!o.intersectsClippingArea||o.level<s.level||e.has(o)||(e.add(o),r.push(o),o.renderData.updateNeighborData())};r.sort(u_);const n=r.length;for(let s=0;s<n;++s){const o=r[s];Re(o.isLoaded),Re(o.intersectsClippingArea);const a=o.renderData;a.updateNeighborData();const l=a._dirtyEdgeResolutions,c=a.geometryState.neighborData;for(let h=0;h<4;++h)if(l&1<<h){const p=a.geometryState.neighborData.edgePeerNeighbors[h];p&&(p==null?void 0:p.level)>=o.level&&p.forAllSubtreeOnSide(HV(Ug[h]),f=>!(!f.isLoaded||!f.intersectsClippingArea)&&(Re(e.has(f)||u_(o,f)<0),i(o,f),!0)),i(o,c.cornerPeerNeighbors[h]),i(o,c.cornerPeerNeighbors[(h+1)%4])}}e.clear(),this._updateTilesGeometries(r),Zs&&BV&&this.checkAllTilesWaterproofness()}_mergeAndSplit(e,r){if(this.suspended||e.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let i=!1;const n=this.view.state.fixedContentCamera;let s=!1;for(;!e.done;){s=!0;let o=!1;const a=!this._allTiles.some(l=>{var h;if(!i&&!n&&!l.visible)return e.done;let c=l;if(l.resetPendingUpdate(Mt.MERGE)){if(!r)return l.setPendingUpdate(Mt.MERGE),e.done;for(;(h=c.parent)!=null&&h.resetPendingUpdate(Mt.MERGE);)c=c.parent;this._mergeTile(c),o=!0,e.madeProgress()}else l.resetPendingUpdate(Mt.SPLIT)&&(this._splitTile(l),o=!0,e.madeProgress());return!e.done&&c===l&&l.resetPendingUpdate(Mt.RENDERDATA)&&(this._updateRenderData(l),e.madeProgress()),e.done});if(o&&(this._allTilesSorted=!1,this._allTilesDirty=!0),a){if(!i){i=!0;continue}if(!o)break}else this._allTilesDirty=!0}s?e.madeProgress():this._allTilesDirty=!0,!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries(),this._sortTiles(e)}_updateElevation(e){e.done||(this._allTiles.some(r=>(r.resetPendingUpdate(Mt.GEOMETRY)&&(this._updateTileGeometryState(r),this._updateTileTexture(r,e),this.shortBatches&&this._batchUpdatePendingTileGeometries(),e.madeProgress()),e.done)),!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries())}_updateTextures(e){e.done||this._allTiles.some(r=>(this._updateTileTexture(r,e),e.done))}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(Gn.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){const e=this.view.resourceController.memoryController.memoryFactor;return this.view.qualitySettings.tiledSurface.lodBias-(1-e)*Jyt}_getLodBiasCorrectedScale(e){const r=this.tilingScheme.levels,i=_e(e-this._lodBias,0,r.length-1),n=i-Math.floor(i);return r[Math.floor(i)].scale*(1-n)+r[Math.ceil(i)].scale*n}_removeAllTiles(){v(this._rootTiles)&&(this._rootTiles.forEach(e=>this._purgeTile(e)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this._visible=!1}_purgeDescendantTiles(e){if(!e.children[0])return!1;let r=!1;for(let i=0;i<4;++i)r=this._purgeTile(e.children[i])||r;return e.unsetChildren(),r}_purgeTile(e){const r=this._purgeDescendantTiles(e)||e.rendered;return this._allTiles.removeUnordered(e),this._unloadTile(e),this._tilePool.release(e),r}_unloadTile(e){this._pendingTilesToUpdate.delete(e),this._pendingTilesForElevationUpdateEvent.delete(e),e.unload(this._renderer)}_splitTile(e){Cg(e.isLeaf,"tile that is already split should not be split again!");const r=e.level+1,i=2*e.lij[1],n=2*e.lij[2];e.setChildren(this._createTile(r,i,n,e),this._createTile(r,i,n+1,e),this._createTile(r,i+1,n,e),this._createTile(r,i+1,n+1,e)),e.setPendingUpdate(Mt.RENDERDATA),e.updateAgentSuspension(),this._allTiles.pushArray(e.children),this._allTilesDirty=!0,++this._performanceInfo.numSplit}_emitTileScaleChange(e,r=e.level){gk.spatialReference=this.spatialReference,gk.extent=e.extent,gk.scale=this._getLodBiasCorrectedScale(r),this.emit("scale-change",gk)}_createTile(e,r,i,n){Cg(!!n,"_createTile sanity check");const s=this._acquireTile(e,r,i,n);return s.updateClippingStatus(this.extent),s.updateScreenDepth(this._viewProjectionMatrix),this._shouldSplit(s)&&s.setPendingUpdate(Mt.SPLIT),s}get shortBatches(){return this.view.state.mode!==Mr.IDLE}_mergeTile(e){Cg(!e.hasPendingUpdate(Mt.SPLIT),"_mergeTile sanity check"),this._purgeDescendantTiles(e)&&(Cg(!e.renderData,"_mergeTile sanity check"),this._loadTile(e),this._markTileToUpdate(e),this._emitTileScaleChange(e),this.shortBatches&&this._batchUpdatePendingTileGeometries()),this._allTilesDirty=!0,++this._performanceInfo.numMerged}_loadChildren(e){Cg(e.rendered,"parent should be rendered"),this._unloadTile(e);const r=e.children;r.forEach(i=>this._loadTile(i)),r.forEach(i=>this._pendingTilesToUpdate.add(i)),this._markAllTileNeighborsForGeometryUpdate(e),this._emitTileScaleChange(e,e.level+1),this.shortBatches&&this._batchUpdatePendingTileGeometries()}_loadParent(e){const r=e.parent;this._unloadChildren(r),this._loadTile(r),this._markTileToUpdate(r),this._emitTileScaleChange(r,r.level),this.shortBatches&&this._batchUpdatePendingTileGeometries()}_unloadChildren(e){const r=e.children;if(r[0])for(let i=0;i<4;++i){const n=r[i];this._unloadChildren(n),this._unloadTile(n)}}_loadTile(e){e.load(),e.setPendingUpdate(Mt.RENDERDATA),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(e)}_elevationDataArrived(e,r,i){const n=new zLt(e.lij,e.extent,i);e.dataArrived(r,vr.ELEVATION,n);const s=[e],o=e.level,a=this._iteratorPool.acquire();for(a.reset(s);!a.done;){const l=a.next();l.findElevationBoundsForLayer(r,o),l.computeElevationBounds()}o===0&&this._updateRootTileElevationBounds(),a.remove(),this._updateTilesVisibility(s)}_handleLayerViewChanges(e=jl){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let r=!1;const i=new Set;let n=-1;for(const s of this.view.allLayerViews.items)if(i.add(s.uid),jD(s)||rP(s))if(this._basemapLayerViewHandles.has(s.uid)&&!rP(s)){const o=this._layerClassFromLayerView(s),a=this._getLayerIdxByUID(o,s.uid);v(a)&&((a<n||R(n))&&(r=!0),n=a)}else this._registerTiledLayerView(s),s.layer.loaded&&(r=!0);this._basemapLayerViewHandles.forEach((s,o)=>{i.has(o)||(this._unregisterTiledLayerView(o),r=!0)}),r&&this._updateTiledLayers(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._evaluateTransparency(),e.madeProgress()}_allSurfaceLayersTransparent(){var r,i;let e=((i=(r=this.view.map)==null?void 0:r.ground)==null?void 0:i.opacity)===0;for(const n of this.view.allLayerViews.items)if(qte(n)&&!mOe(n.layer)&&n.fullOpacity!==0)return e=!1,e;return e}_hasCompositeBlendMode(){for(const e of this.view.allLayerViews.items)if((GV(e)||rP(e))&&mDt(Jte[e.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(e){return Hte(e)?vr.ELEVATION:vr.MAP}_registerTiledLayerView(e){const r=[];if((GV(e)||rP(e))&&r.push(ne(()=>e.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(js.UNFADED)})),rP(e))return;const i=this._layerClassFromLayerView(e);r.push(ne(()=>e.suspended,()=>this._updateTiledLayers())),r.push(ne(()=>e.fullOpacity,()=>this._updateTileTextures(js.UNFADED))),r.push(ne(()=>"effectiveScaleRange"in e.layer?e.layer.effectiveScaleRange:null,()=>this._restartAllAgents(i))),e.on("data-changed",()=>{const n=this._getLayerIdxByUID(i,e.uid);v(n)&&this._invalidateLayerData(n,i)}),this._basemapLayerViewHandles.set(e.uid,r)}_unregisterTiledLayerView(e){const r=this._basemapLayerViewHandles.get(e);if(r){for(let i=0;i<r.length;i++)r[i].remove();this._basemapLayerViewHandles.delete(e)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const e=this.view.allLayerViews,r=[[],[]];let i=null;e.forEach(n=>{if(!n.layer||n.suspended||!jD(n)||!n.fullExtent)return;const s=this._layerClassFromLayerView(n);if(s===vr.MAP){const o=n.displayLevelRange.maxLevel;o!==1/0&&(i===null||o>i)&&(i=o)}r[s].push(n)});for(const n of IT){const s=this._layerViews[n],o=r[n];o.reverse();const a=o.length;let l=s.length!==a;const c=new Array(a),h=new Array(s.length);this._layerIndexByUid[n].clear();for(let p=0;p<a;p++){const f=o[p].uid;this._layerIndexByUid[n].set(f,p);const m=s.indexOf(o[p]);c[p]=m,p!==m&&(l=!0),m>-1&&(h[m]=p)}if(l){const p=this._postorderIterator;for(p.reset(this._rootTiles);!p.done;)p.next().modifyLayers(h,c,n);this._layerViews[n]=o,this._restartAllAgents(n),this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(i)&&this._viewChangeUpdate()}_restartAllAgents(e){const r=this._postorderIterator;for(r.reset(this._rootTiles);!r.done;){const i=r.next();i.restartAgents(e),e===vr.ELEVATION&&i.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(e,r){return this._layerViews[r][e]}numLayers(e){return this._layerViews[e].length}_updateTileTextures(e){this._allTiles.forAll(r=>{r.updateAgents(vr.MAP),e===js.IMMEDIATE?this.renderer.updateTileTexture(r,Mt.TEXTURE_NOFADING):r.updateRenderData(vr.MAP,e)}),this._evaluateTransparency()}_invalidateLayerData(e,r){this._allTiles.forAll(i=>i.removeLayerAgent(e,r)),this._allTiles.forAll(i=>i.invalidateLayerData(e,r))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(e=Gn.UPDATE){this.renderer.setNeedsRender(e)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(e,r,i,n){const s=this.layerViewByIndex(r,i),o=s.layer;return!o.tilemapCache||BD(s)?this._requestTileData(e,i,s,n):(++this._asyncWorkItems,o.tilemapCache.fetchAvailability(e.lij[0],e.lij[1],e.lij[2],{...n,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(a=>{throw--this._asyncWorkItems,lr(n),ps(a)||this._dataMissing(e,i,s,{notInTilemap:!0}),a}).then(()=>this._frameTask.schedule(()=>this._requestTileData(e,i,s,n),n.signal)))}_requestTileData(e,r,i,n){return r===vr.ELEVATION?Hte(i)?this._requestElevationTileData(e,i,n):Promise.reject():qte(i)?this._requestMapTileData(e,i,n):Promise.reject()}_requestElevationTileData(e,r,i){++this._asyncWorkItems;const n=a=>{if(uo(i))return;const l=this._layerIndexByUid[vr.ELEVATION].get(r.uid);l!=null?(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(e,l,a)):re.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer %d %s",vr.ELEVATION,e.lij.toString())},s=a=>{ps(a)||(this._dataMissing(e,vr.ELEVATION,r,a),this.requestUpdate())};if(I1e(r.layer))return r.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],{noDataValue:pD,signal:i.signal}).then(a=>{if(!uo(i))return this._frameTask.schedule(()=>n(a),i.signal,s);re.getLogger(this.declaredClass).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.")},s).finally(()=>{--this._asyncWorkItems});const o=r.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);return this._elevationDataRequester.request(o,"binary",i).then(a=>this._lercDecoder.decode(a,{noDataValue:pD},i.signal)).then(a=>{a?n(new ELt(a)):s(new Error("LERC decoding failed"))},s).finally(()=>{--this._asyncWorkItems})}_requestMapTileData(e,r,i){++this._asyncWorkItems;const n=(h,p)=>{--this._asyncWorkItems,HR(p),uo(i)||(this._dataMissing(e,vr.MAP,r,h),this.requestUpdate())},s=h=>p=>n(p,h),o=h=>this._frameTask.schedule(()=>{--this._asyncWorkItems,this.requestUpdate(),uo(i)?HR(h):this._mapTileDataArrived(e,r,h)},i.signal,s(h)).catch(s(h)),a=(h,p=null)=>this._frameTask.schedule(()=>n(h,p));if(BD(r)){const h=r.schemaHelper.getLevelRowColumn(e.lij);return r.fetchTile(h[0],h[1],h[2],i).then(o,a)}if(N7(r))return r.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(o,a);if(bce(r)&&I1e(r.layer))return r.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(h=>{if(uo(i))return re.getLogger(this.declaredClass).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void a(Vr());o(h)},a);let l=r.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);gct(r.layer)&&r.layer.refreshTimestamp&&(l+=`${l.includes("?")?"&":"?"}_ts=${r.layer.refreshTimestamp}`);const c=r.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(l,c,i).then(o,a)}_mapTileDataArrived(e,r,i){const n=this._getLayerIdxByUID(vr.MAP,r.uid);v(n)?e.dataArrived(n,vr.MAP,i):(HR(i),re.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(e,r){return this._layerIndexByUid[e].get(r)}_dataMissing(e,r,i,n){const s=this._getLayerIdxByUID(r,i.uid);v(s)?e.dataMissing(s,r,n):re.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(e){this._rootTiles&&this.overlayManager&&(this._allTiles.forAll(r=>{r.renderData&&this.overlayManager.setTileParameters(r)}),this._renderer.setNeedsRender(e))}get performanceInfo(){const e=this._performanceInfo;return e.numNodes=this._allTiles.length,e.numLeaves=e.numVisible=e.numRendered=e.numLoadedPerLevel.length=e.numRenderedPerLevel.length=0,this._allTiles.forAll(r=>{r.isLeaf&&e.numLeaves++;const i=r.level;r.renderData&&(e.numLoadedPerLevel[i]=(e.numLoadedPerLevel[i]||0)+1),r.visible&&(e.numVisible++,r.rendered&&(e.numRenderedPerLevel[i]=(e.numRenderedPerLevel[i]||0)+1,e.numRendered++))}),e}getUsedMemory(){return this.tilingScheme?(R(this._usedMemory)&&(this._usedMemory=this._recalculateUsedMemory()),v(this._usedMemory)?this._usedMemory:0):0}_recalculateUsedMemory(){return this.tilingScheme?this._allTiles.reduce((e,r)=>e+r.usedMemory,0):null}getUsedMemoryForLayerView(e){let r=0;const i=this._layerClassFromLayerView(e),n=this._getLayerIdxByUID(i,e.uid);return v(n)&&this._allTiles.forAll(s=>r+=s.getUsedMemoryForLayer(i,n)),r}getTile(e){if(R(e)||R(this._rootTiles))return null;const r=e.split("/").map(a=>+a);if(r[0]===0)return this._rootTiles.find(a=>a.lij[1]===r[1]&&a.lij[2]===r[2]);const i=2**r[0],n=Math.floor(r[1]/i),s=Math.floor(r[2]/i);let o;if(this._rootTiles.some(a=>a.lij[1]===n&&a.lij[2]===s&&(o=a,!0)),o){let a=1<<r[0]-1;for(;o.lij[0]<r[0];){let l=r[1]&a?2:0;if((r[2]&a)>0&&l++,!o.children[l])return null;o=o.children[l],a>>=1}return Cg(o.lij[0]===r[0]&&o.lij[1]===r[1]&&o.lij[2]===r[2],"not the right tile?"),o}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(e){this._renderer.renderPatchBorders=e}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(e){this._renderer.visualizeNormals=e}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(e){this._renderer.renderingDisabled=e}get test(){const e=this;return{renderer:e._renderer,lercDecoder:e._lercDecoder,forceReload:()=>{v(e._rootTiles)&&e._rootTiles.length>0&&(e._mergeTile(e._rootTiles[0]),e._viewChangeUpdate())},getTiles:()=>e._allTiles.toArray(),getRenderedTiles(){$W.clear(),e._allTiles.forAll(i=>{i.visible&&i.rendered&&$W.push(i)});const r=$W.toArray();return cUe(e.renderOrder,r),r},lockTilingScheme(r,i){e._extentHelper.defaultTiledLayersExtent=i,e.tilingSchemeLogic.test.lockTilingScheme(r)}}}checkAllTilesWaterproofness(){if(!BV)return;const e=this._rootTiles;if(R(e))return;const r=o=>{var a,l,c;return((c=(l=(a=o==null?void 0:o.renderData)==null?void 0:a.geometryInfo)==null?void 0:l.indices)==null?void 0:c.length)>0},i=(o,a)=>{r(o)&&console.error("Tile[",o.lij,"] has geometry although parent[",a.lij,"] has geom")},n=o=>{var a,l;if(o.intersectsClippingArea)if(o.renderData&&!o.renderData.geometryState&&console.error("Tile[",o.lij,"] has renderData but not geometryState"),o.renderData&&!o.renderData.geometryInfo&&console.error("Tile[",o.lij,"] has renderData but not geometryInfo"),!((a=o.renderData)!=null&&a.geometryInfo)||(((l=o.renderData.geometryInfo.indices)==null?void 0:l.length)??0)>0||console.error("Tile[",o.lij,"] has renderData but no indices - geometryInfo: ",o.renderData.geometryInfo),r(o)){o.checkGeometryWaterproofness();for(const c of o.children)i(c,o)}else if(o.isLeaf)console.error("Tile[",o.lij,"] has no geometry and no children, from root to leaf");else for(const c of o.children)n(c)},s=o=>{var h;const a=((h=o.parent)==null?void 0:h.visible)??!0,l=o.visible;o.computeVisibility();const c=o.visible;if(l!==c&&a&&console.error(" Tile[",o.lij,"] has out of date visibility: ",l," instead of ",c),!o.isLeaf)for(const p of o.children)s(p)};for(const o of e)n(o),s(o)}get isGlobal(){return this._isGlobal}get shading(){return this._shading}_updateShadingIfChanged(){var r,i,n;((n=(i=(r=this.view)==null?void 0:r.map)==null?void 0:i.ground)==null?void 0:n.shading)!==this._shading&&this._updateShading()}_updateShading(){var r,i,n;const e=(n=(i=(r=this.view)==null?void 0:r.map)==null?void 0:i.ground)==null?void 0:n.shading;this._shading=e,this.renderer&&(this.renderer.shading=e,this.renderer.setNeedsRender()),this._updateAllTileGeometries()}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateeCarree(){return this._isWebMercatorOnPlateeCarree}isEastEndWrap(e){return this.isGlobal&&e[2]===this.lijEastEnd(e[0])-1}isWestEndWrap(e){return this.isGlobal&&e[2]===0}lijEastEnd(e){return 2**(e+(v(this.spatialReference)&&this.spatialReference.isGeographic?1:0))}wrapEastWest(e){const r=this.lijEastEnd(e[0]),i=e[2];if(0<=i&&i<r)return e;if(!this.isGlobal)return null;const n=(i+(i<0?r:0))%r;return[e[0],e[1],n]}enableInternalChecks(e){W$t(e)}enableWaterproofnessChecks(e){q$t(e)}};u([d()],or.prototype,"_renderer",void 0),u([d({constructOnly:!0})],or.prototype,"_scaleRangeQueries",void 0),u([d()],or.prototype,"_hasPendingUpdates",void 0),u([d()],or.prototype,"_asyncWorkItems",void 0),u([d()],or.prototype,"_allTilesDirty",void 0),u([d()],or.prototype,"_allTilesSorted",void 0),u([d()],or.prototype,"_viewChanged",void 0),u([d({readOnly:!0})],or.prototype,"_watchUpdatingTracking",void 0),u([d()],or.prototype,"_frameTask",void 0),u([d({readOnly:!0})],or.prototype,"snapLevel",null),u([d({readOnly:!0})],or.prototype,"lodSnapping",null),u([d({constructOnly:!0})],or.prototype,"view",void 0),u([d()],or.prototype,"_userClippingExtent",null),u([d()],or.prototype,"_rootTilesExtent",void 0),u([d({readOnly:!0})],or.prototype,"extent",null),u([d({readOnly:!0})],or.prototype,"groundExtent",null),u([d({readOnly:!0})],or.prototype,"_tilingSchemeExtent",null),u([d({readOnly:!0})],or.prototype,"updating",null),u([d({readOnly:!0})],or.prototype,"running",null),u([d(kLt)],or.prototype,"updatingProgress",void 0),u([d({readOnly:!0})],or.prototype,"updatingProgressValue",null),u([d()],or.prototype,"_maxNumUpdating",void 0),u([d()],or.prototype,"baseOpacity",null),u([d()],or.prototype,"hasCompositeBlendMode",void 0),u([d({readOnly:!0})],or.prototype,"overlayManager",void 0),u([d({readOnly:!0})],or.prototype,"viewingMode",null),u([d()],or.prototype,"maxTextureScale",void 0),u([d({readOnly:!0})],or.prototype,"ready",null),u([d({value:e3.FRONT_TO_BACK})],or.prototype,"renderOrder",null),u([d({readOnly:!0})],or.prototype,"rootTiles",null),u([d()],or.prototype,"_rootTiles",void 0),u([d({readOnly:!0})],or.prototype,"spatialReference",null),u([d({type:Xe})],or.prototype,"backgroundColor",null),u([d({value:!1})],or.prototype,"slicePlaneEnabled",null),u([d({readOnly:!0})],or.prototype,"tilingScheme",void 0),u([d({readOnly:!0})],or.prototype,"tilingSchemeLocked",null),u([d({readOnly:!0})],or.prototype,"tilingSchemeLogic",void 0),u([d({value:!0})],or.prototype,"velvetOverground",null),u([d()],or.prototype,"wireframe",null),u([d({value:!1})],or.prototype,"suspended",null),u([d()],or.prototype,"textureFadeDuration",null),u([d()],or.prototype,"visibleElevationBounds",void 0),u([d()],or.prototype,"rootTileElevationBounds",void 0),u([d()],or.prototype,"_layerViewsDirty",void 0),u([d()],or.prototype,"renderPatchBorders",null),u([d()],or.prototype,"visualizeNormals",null),u([d()],or.prototype,"renderingDisabled",null),or=u([$("esri.views.3d.terrain.TerrainSurface")],or);const ZNt=or;function fbe(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function GUe(t){const e=t.children;if(!e[0])return!1;for(const r of e)if(r.shouldLoad)return!0;for(const r of e)if(GUe(r))return!0;return!1}function JNt(t){var e;return t.isLeaf&&(((e=t.parent)==null?void 0:e.shouldLoad)??!1)}const fc=pr(),KNt=Kt(),mk=[0,0,0],$W=new Wt,LW={spatialReference:null,extent:Kt(),context:"ground"},gk={spatialReference:null,extent:null,scale:0};function mbe(t,e,r){var i;for(const n of t){if(!n.containsPointXY(e,r))continue;let s=n;for(;s&&!s.renderData;){const a=(e>s.extentMidX?1:0)+(r<s.extentMidY?2:0);s=s.children[a]}const o=((i=s==null?void 0:s.renderData)==null?void 0:i.geometryState.samplerData)??null;return tn(e,r,o)}return null}let QNt=class{constructor(e,r,i){this.operation=e,this.geometry=r,this.states=i}},WI=class extends be{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commitLayer(e,r){const i=this._dirtyGeomRecords.get(e);i&&(i.forEach((n,s)=>{const o=this._ensureGeomRecord(e,s);n.forEach(({geometry:a,operation:l,states:c},h)=>{let p=!1;if(l===_n.UPDATE){const f=o.get(h);if(f){if(c&oo.TRANSFORMATION){const m=this.model.getObject(s);this.model.updateRenderGeometryTransformation(m,a,f)&&(p=!0)}p||r.updates.push({renderGeometry:f,updateType:c})}else wt(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(l===_n.REMOVE||p){const f=o.get(h);f?(r.removes.push(f),o.delete(h)):l===_n.REMOVE&&wt(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove")}if(l===_n.ADD||p){const f=this.model.getObject(s);if(v(f)){const m=this.model.getRenderGeometry(f,a);r.adds.push(m),o.set(h,m)}}}),o.size===0&&this._residentGeomRecords.get(e).delete(s)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e),this.dirty=this._hasDirtyGeometryRecords)}getResidentRenderGeometries(e,r){const i=this._residentGeomRecords.get(e);i&&i.forEach(n=>n.forEach(s=>r.push(s)))}_objectStateChanged(e,r){for(const i of r.geometries)this._updateOrCreateDirtyRecord(r,i,null,_n.UPDATE,e)}visibilityChanged(e){this._objectStateChanged(oo.VISIBILITY,e)}highlightChanged(e){this._objectStateChanged(oo.HIGHLIGHT,e)}occlusionChanged(e){this._objectStateChanged(oo.OCCLUDEE,e)}objectGeometryUpdated(e){this._updateOrCreateDirtyRecord(e.object,e.geometry,null,_n.UPDATE,oo.GEOMETRY)}layerAdded(e){e.objects.forAll(r=>this._layerObjectAdded(e,r))}layerRemoved(e){e.objects.forAll(r=>this._layerObjectRemoved(e,r))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,r){const i=e.id;for(const n of r.geometries)this._objectGeometryAdded(r,n,i)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const r of e.objects)this._layerObjectAdded(e.layer,r)}layerObjectsRemoved(e){for(const r of e.objects)this._layerObjectRemoved(e.layer,r)}_layerObjectRemoved(e,r){const i=e.id;for(const n of r.geometries)this._objectGeometryRemoved(r,n,i)}shaderTransformationChanged(e){const r=this._residentGeomRecords.get(e.id);r&&r.forEach((i,n)=>{const s=this.model.getObject(n);s&&s.hasVolativeTransformation()&&i.forEach(o=>o.shaderTransformationChanged())})}objectTransformation(e){const r=this._getParentLayerId(e),i=e.id;this._ensureGeomRecord(r,i).forEach(n=>{this._updateOrCreateDirtyRecord(e,n.geometry,r,_n.UPDATE,oo.TRANSFORMATION)})}objectGeometryAdded(e){this._objectGeometryAdded(e.object,e.geometry)}_objectGeometryAdded(e,r,i=null){this._updateOrCreateDirtyRecord(e,r,i,_n.ADD)}objectGeometryRemoved(e){this._objectGeometryRemoved(e.object,e.geometry)}_objectGeometryRemoved(e,r,i=null){this._updateOrCreateDirtyRecord(e,r,i,_n.REMOVE)}_updateOrCreateDirtyRecord(e,r,i,n,s=oo.NONE){i=Nt(i,this._getParentLayerId(e));const o=e.id,a=r.id,l=this._ensureDirtyRecord(i,o),c=l.get(a);if(c){const h=c.operation;h===_n.REMOVE&&n===_n.ADD&&c.states!==oo.NONE?c.operation=_n.UPDATE:h===_n.REMOVE&&n===_n.ADD||h===_n.ADD&&n===_n.REMOVE?l.delete(a):h!==_n.UPDATE||n!==_n.REMOVE&&n!==_n.UPDATE?(wt((h===_n.REMOVE||h===_n.ADD)&&n===_n.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"),c.states|=s):(c.operation=n,c.states|=s)}else l.set(a,new QNt(n,r,s));this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(e,r){let i=this._residentGeomRecords.get(e);i||(i=new Map,this._residentGeomRecords.set(e,i));let n=i.get(r);return n||(n=new Map,i.set(r,n)),n}get _hasDirtyGeometryRecords(){return ca(this._dirtyGeomRecords,e=>ca(e,r=>r&&r.size>0))}_ensureDirtyRecord(e,r){let i=this._dirtyGeomRecords.get(e);i||(i=new Map,this._dirtyGeomRecords.set(e,i));let n=i.get(r);return n||(n=new Map,i.set(r,n)),n}_getParentLayerId(e){return v(e.parentLayer)?e.parentLayer.id:wje}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let r="";return this._dirtyGeomRecords.forEach((i,n)=>{i.forEach((s,o)=>{r.length>0&&(r+=`
`),r+=n+"."+o;const a=[];s.forEach(l=>{const c=l.operation;a[c]||(a[c]=[]),a[c].push(l.geometry.id)});for(let l=0;l<a.length;l++)if(a[l]){r+=" "+e[l-1]+": ";for(let c=0;c<a[l].length;c++)r+=a[l][c]+", "}})}),r}get test(){const e=this;return{get residentLayerCount(){return e._residentGeomRecords.size},get residentObjectCount(){return Array.from(e._residentGeomRecords.values()).reduce((r,i)=>r+i.size,0)},commit:r=>e._dirtyGeomRecords.forEach((i,n)=>e.commitLayer(n,r))}}};u([d({constructOnly:!0})],WI.prototype,"model",void 0),u([d()],WI.prototype,"dirty",void 0),WI=u([$("esri.views.3d.webgl-engine.lib.ModelDirtySet")],WI);const eFt=WI;let XU=class extends be{constructor(){super(...arguments),this.dirtySet=new eFt({model:this}),this._content=new Map,this._originFactory=new Kle(null)}getObject(e){return this._content.get(e)}add(e){const r=e.id;wt(!this._content.has(r),"Model/Stage already contains object to be added"),this._content.set(r,e),IV(e)&&this.dirtySet.layerAdded(e)}remove(e){wt(this._content.has(e.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(e.id),e.unload(),IV(e)&&this.dirtySet.layerRemoved(e)}addMany(e){for(const r of e)v(r)&&(wt(!this._content.has(r.id),"Model/Stage already contains object to be added"),this._content.set(r.id,r))}removeMany(e){for(const r of e)wt(this._content.has(r.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(r.id),r.unload()}has(e){return this._content.has(e.id)}forEachOfType(e,r){this._content.forEach(i=>{i.type===e&&r(i)})}getRenderGeometry(e,r){const{shaderTransformer:i,localOrigin:n}=r,s=new QO(r,{boundingInfo:r.boundingInfo,shaderTransformer:i,castShadow:e.castShadow});return s.updateTransformation(o=>e.getCombinedStaticTransformation(r,o)),s.localOrigin=v(n)?n:this._originFactory.getOrigin(s.boundingSphere),s}updateRenderGeometryTransformation(e,r,i){if(R(e))return!1;i.updateTransformation(s=>e.getCombinedStaticTransformation(r,s));const n=this._originFactory.getOrigin(i.boundingSphere);return i.localOrigin!==n}getStats(){const e={},r=Array.from(this._content.values());for(let i=0;i<Wn.COUNT;++i)e[i]=r.filter(n=>n.type===i).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};u([d({constructOnly:!0})],XU.prototype,"dirtySet",void 0),XU=u([$("esri.views.3d.webgl-engine.parts.Model")],XU);function tFt(){const t=new Float32Array(4);return t[3]=1,t}function HUe(t){const e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function rFt(t,e,r,i){const n=new Float32Array(4);return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n}function qUe(t,e){return new Float32Array(t,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:HUe,create:tFt,createView:qUe,fromValues:rFt},Symbol.toStringTag,{value:"Module"}));const t3=1e-6,aP=[0,0,0],yk=[0,0,0];function iFt(t,e){const{data:r,size:i}=t,n=r.length/i;if(n<=0)return;const s=new dFt(t);YU(aP,s.minProj,s.maxProj),nS(aP,aP,.5),ip(yk,s.maxProj,s.minProj);const o=rre(yk),a=new pFt;a.quality=o,n<14&&(t=new Qe(new Float64Array(s.buffer,112,42),3));const l=[0,0,0],c=[0,0,0],h=[0,0,0],p=[0,0,0],f=[0,0,0],m=[0,0,0],g=[0,0,0];switch(nFt(s,t,g,l,c,h,p,f,m,a)){case 1:return void vbe(aP,yk,e);case 2:return void hFt(t,p,e)}sFt(t,g,l,c,h,p,f,m,a),WUe(t,a.b0,a.b1,a.b2,XR,YR);const _=[0,0,0];ip(_,YR,XR),a.quality=rre(_),a.quality<o?XUe(a.b0,a.b1,a.b2,XR,YR,_,e):vbe(aP,yk,e)}function nFt(t,e,r,i,n,s,o,a,l,c){return oFt(t,i,n),ire(i,n)<t3?1:(ip(o,i,n),Ra(o,o),aFt(e,i,o,s)<t3?2:(ip(a,n,s),Ra(a,a),ip(l,s,i),Ra(l,l),np(r,a,o),Ra(r,r),$T(e,r,o,a,l,c),0))}const lP=[0,0,0],cP=[0,0,0],xd=[0,0,0],Td=[0,0,0],Sd=[0,0,0],zv=[0,0,0],Vv=[0,0,0],Bv=[0,0,0];function sFt(t,e,r,i,n,s,o,a,l){lFt(t,e,r,lP,cP),lP[0]!==void 0&&(ip(xd,lP,r),Ra(xd,xd),ip(Td,lP,i),Ra(Td,Td),ip(Sd,lP,n),Ra(Sd,Sd),np(zv,Td,s),Ra(zv,zv),np(Vv,Sd,o),Ra(Vv,Vv),np(Bv,xd,a),Ra(Bv,Bv),$T(t,zv,s,Td,xd,l),$T(t,Vv,o,Sd,Td,l),$T(t,Bv,a,xd,Sd,l)),cP[0]!==void 0&&(ip(xd,cP,r),Ra(xd,xd),ip(Td,cP,i),Ra(Td,Td),ip(Sd,cP,n),Ra(Sd,Sd),np(zv,Td,s),Ra(zv,zv),np(Vv,Sd,o),Ra(Vv,Vv),np(Bv,xd,a),Ra(Bv,Bv),$T(t,zv,s,Td,xd,l),$T(t,Vv,o,Sd,Td,l),$T(t,Bv,a,xd,Sd,l))}function oFt(t,e,r){let i=ire(t.maxVert[0],t.minVert[0]),n=0;for(let s=1;s<7;++s){const o=ire(t.maxVert[s],t.minVert[s]);o>i&&(i=o,n=s)}Fu(e,t.minVert[n]),Fu(r,t.maxVert[n])}const Ed=[0,0,0];function aFt(t,e,r,i){const{data:n,size:s}=t;let o=Number.NEGATIVE_INFINITY,a=0;for(let l=0;l<n.length;l+=s){Ed[0]=n[l]-e[0],Ed[1]=n[l+1]-e[1],Ed[2]=n[l+2]-e[2];const c=r[0]*Ed[0]+r[1]*Ed[1]+r[2]*Ed[2],h=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],p=Ed[0]*Ed[0]+Ed[1]*Ed[1]+Ed[2]*Ed[2]-c*c/h;p>o&&(o=p,a=l)}return Fu(i,n,a),o}const so=[0,0];function lFt(t,e,r,i,n){uFt(t,e,so,n,i);const s=ZUe(r,e);so[1]-t3<=s&&(i[0]=void 0),so[0]+t3>=s&&(n[0]=void 0)}const gbe=[0,0,0],ybe=[0,0,0],_be=[0,0,0],nC=[0,0,0],sC=[0,0,0],_k=[0,0,0];function $T(t,e,r,i,n,s){if(YUe(e)<t3)return;np(gbe,r,e),np(ybe,i,e),np(_be,n,e),WR(t,e,so),sC[1]=so[0],nC[1]=so[1],_k[1]=nC[1]-sC[1];const o=[r,i,n],a=[gbe,ybe,_be];for(let l=0;l<3;++l){WR(t,o[l],so),sC[0]=so[0],nC[0]=so[1],WR(t,a[l],so),sC[2]=so[0],nC[2]=so[1],_k[0]=nC[0]-sC[0],_k[2]=nC[2]-sC[2];const c=rre(_k);c<s.quality&&(Fu(s.b0,o[l]),Fu(s.b1,e),Fu(s.b2,a[l]),s.quality=c)}}const cFt=[0,0,0];function WR(t,e,r){const{data:i,size:n}=t;r[0]=Number.POSITIVE_INFINITY,r[1]=Number.NEGATIVE_INFINITY;for(let s=0;s<i.length;s+=n){const o=i[s]*e[0]+i[s+1]*e[1]+i[s+2]*e[2];r[0]=Math.min(r[0],o),r[1]=Math.max(r[1],o)}}function uFt(t,e,r,i,n){const{data:s,size:o}=t;Fu(i,s),Fu(n,i),r[0]=ZUe(cFt,e),r[1]=r[0];for(let a=o;a<s.length;a+=o){const l=s[a]*e[0]+s[a+1]*e[1]+s[a+2]*e[2];l<r[0]&&(r[0]=l,Fu(i,s,a)),l>r[1]&&(r[1]=l,Fu(n,s,a))}}function vbe(t,e,r){Fu(r.center,t),nS(r.halfSize,e,.5),r.quaternion[0]=0,r.quaternion[1]=0,r.quaternion[2]=0,r.quaternion[3]=1}const Xy=[0,0,0],oC=[0,0,0],uP=[0,0,0],XR=[0,0,0],YR=[0,0,0],bbe=[0,0,0];function hFt(t,e,r){Fu(Xy,e),Math.abs(e[0])>Math.abs(e[1])&&Math.abs(e[0])>Math.abs(e[2])?Xy[0]=0:Math.abs(e[1])>Math.abs(e[2])?Xy[1]=0:Xy[2]=0,YUe(Xy)<t3&&(Xy[0]=Xy[1]=Xy[2]=1),np(oC,e,Xy),Ra(oC,oC),np(uP,e,oC),Ra(uP,uP),WUe(t,e,oC,uP,XR,YR),ip(bbe,YR,XR),XUe(e,oC,uP,XR,YR,bbe,r)}function WUe(t,e,r,i,n,s){WR(t,e,so),n[0]=so[0],s[0]=so[1],WR(t,r,so),n[1]=so[0],s[1]=so[1],WR(t,i,so),n[2]=so[0],s[2]=so[1]}const vk=[0,0,0],jm=[1,0,0,0,1,0,0,0,1],aC=[0,0,0];function XUe(t,e,r,i,n,s,o){jm[0]=t[0],jm[1]=t[1],jm[2]=t[2],jm[3]=e[0],jm[4]=e[1],jm[5]=e[2],jm[6]=r[0],jm[7]=r[1],jm[8]=r[2],fFt(o.quaternion,jm),YU(aC,i,n),nS(aC,aC,.5),nS(o.center,t,aC[0]),nS(vk,e,aC[1]),YU(o.center,o.center,vk),nS(vk,r,aC[2]),YU(o.center,o.center,vk),nS(o.halfSize,s,.5)}const ph=7;let dFt=class{constructor(e){this.minVert=new Array(ph),this.maxVert=new Array(ph);const r=64*ph;this.buffer=new ArrayBuffer(r);let i=0;this.minProj=new Float64Array(this.buffer,i,ph),i+=8*ph,this.maxProj=new Float64Array(this.buffer,i,ph),i+=8*ph;for(let l=0;l<ph;++l)this.minVert[l]=new Float64Array(this.buffer,i,3),i+=24;for(let l=0;l<ph;++l)this.maxVert[l]=new Float64Array(this.buffer,i,3),i+=24;for(let l=0;l<ph;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const n=new Array(ph),s=new Array(ph),{data:o,size:a}=e;for(let l=0;l<o.length;l+=a){let c=o[l];c<this.minProj[0]&&(this.minProj[0]=c,n[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,s[0]=l),c=o[l+1],c<this.minProj[1]&&(this.minProj[1]=c,n[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,s[1]=l),c=o[l+2],c<this.minProj[2]&&(this.minProj[2]=c,n[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,s[2]=l),c=o[l]+o[l+1]+o[l+2],c<this.minProj[3]&&(this.minProj[3]=c,n[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,s[3]=l),c=o[l]+o[l+1]-o[l+2],c<this.minProj[4]&&(this.minProj[4]=c,n[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,s[4]=l),c=o[l]-o[l+1]+o[l+2],c<this.minProj[5]&&(this.minProj[5]=c,n[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,s[5]=l),c=o[l]-o[l+1]-o[l+2],c<this.minProj[6]&&(this.minProj[6]=c,n[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,s[6]=l)}for(let l=0;l<ph;++l){let c=n[l];Fu(this.minVert[l],o,c),c=s[l],Fu(this.maxVert[l],o,c)}}},pFt=class{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}};function rre(t){return t[0]*t[1]+t[0]*t[2]+t[1]*t[2]}function YU(t,e,r){t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2]}function ip(t,e,r){t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2]}function nS(t,e,r){t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r}function Fu(t,e,r=0){t[0]=e[r+0],t[1]=e[r+1],t[2]=e[r+2]}function np(t,e,r){const i=e[0],n=e[1],s=e[2],o=r[0],a=r[1],l=r[2];t[0]=n*l-s*a,t[1]=s*o-i*l,t[2]=i*a-n*o}function Ra(t,e){const r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(r>0){const i=1/Math.sqrt(r);t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}}function YUe(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function ire(t,e){const r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return r*r+i*i+n*n}function ZUe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function fFt(t,e){const r=e[0]+e[4]+e[8];if(r>0){let i=Math.sqrt(r+1);t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i}else{let i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);const n=(i+1)%3,s=(i+2)%3;let o=Math.sqrt(e[3*i+i]-e[3*n+n]-e[3*s+s]+1);t[i]=.5*o,o=.5/o,t[3]=(e[3*n+s]-e[3*s+n])*o,t[n]=(e[3*n+i]+e[3*i+n])*o,t[s]=(e[3*s+i]+e[3*i+s])*o}}const aL=Dp(),TS=P(),mFt=P(),gFt=vi();let Ctr=class{constructor(e){const o=e*56;this.buffer=new ArrayBuffer(o),this.obbs=new Array(e);for(let a=0;a<e;a++)this.obbs[a]={center:yne(this.buffer,56*a+0),halfSize:SDe(this.buffer,56*a+24),quaternion:qUe(this.buffer,56*a+36)}}};function JUe(t=[0,0,0],e=[-1,-1,-1],r=Dp()){return{center:On(t),halfSize:rV(e),quaternion:HUe(r)}}function wbe(t){return JUe(t.center,t.halfSize,t.quaternion)}function Rtr(t,e){ce(e.center,t.center),ce(e.halfSize,t.halfSize),Qae(e.quaternion,t.quaternion)}function Otr(t,e){return e=e||JUe(),iFt(t,e),e}function LT(t,e){const r=Ri(e,t.center),i=B7(t,e);return r>i?1:r<-i?-1:0}function Mtr(t,e){e||(e=Ks());const r=Voe(gFt,t.quaternion),i=t.halfSize[0]*Math.abs(r[0])+t.halfSize[1]*Math.abs(r[3])+t.halfSize[2]*Math.abs(r[6]),n=t.halfSize[0]*Math.abs(r[1])+t.halfSize[1]*Math.abs(r[4])+t.halfSize[2]*Math.abs(r[7]),s=t.halfSize[0]*Math.abs(r[2])+t.halfSize[1]*Math.abs(r[5])+t.halfSize[2]*Math.abs(r[8]);return e[0]=t.center[0]-i,e[1]=t.center[1]-n,e[2]=t.center[2]-s,e[3]=t.center[0]+i,e[4]=t.center[1]+n,e[5]=t.center[2]+s,e}function Ptr(t,e){return Ri(e,t.center)-B7(t,e)}function Itr(t,e){return Ri(e,t.center)+B7(t,e)}function $tr(t,e){return LT(t,e[0])<=0&&LT(t,e[1])<=0&&LT(t,e[2])<=0&&LT(t,e[3])<=0&&LT(t,e[4])<=0&&LT(t,e[5])<=0}function Ltr(t,e,r,i=0){v2(aL,t.quaternion),ge(TS,e,t.center);const n=Qf(TS,TS,aL),s=Qf(mFt,r,aL);let o=-1/0,a=1/0;for(let l=0;l<3;l++)if(Math.abs(s[l])>1e-6){const c=(i+t.halfSize[l]-n[l])/s[l],h=(-i-t.halfSize[l]-n[l])/s[l];o=Math.max(o,Math.min(c,h)),a=Math.min(a,Math.max(c,h))}else if(n[l]>t.halfSize[l]+i||n[l]<-t.halfSize[l]-i)return!1;return o<=a}(()=>{const t=new Int8Array(162);let e=0;const r=i=>{for(let n=0;n<i.length;n++)t[e+n]=i[n];e+=6};return r([6,2,3,1,5,4]),r([0,2,3,1,5,4]),r([0,2,3,7,5,4]),r([0,1,3,2,6,4]),r([0,1,3,2,0,0]),r([0,1,5,7,3,2]),r([0,1,3,7,6,4]),r([0,1,3,7,6,2]),r([0,1,5,7,6,2]),r([0,1,5,4,6,2]),r([0,1,5,4,0,0]),r([0,1,3,7,5,4]),r([0,2,6,4,0,0]),r([0,0,0,0,0,0]),r([1,3,7,5,0,0]),r([2,3,7,6,4,0]),r([2,3,7,6,0,0]),r([2,3,1,5,7,6]),r([0,1,5,7,6,2]),r([0,1,5,7,6,4]),r([0,1,3,7,6,4]),r([4,5,7,6,2,0]),r([4,5,7,6,0,0]),r([4,5,1,3,7,6]),r([0,2,3,7,5,4]),r([6,2,3,7,5,4]),r([6,2,3,1,5,4]),t})();function B7(t,e){v2(aL,t.quaternion),Qf(TS,e,aL);const r=t.halfSize;return Math.abs(TS[0]*r[0])+Math.abs(TS[1]*r[1])+Math.abs(TS[2]*r[2])}function Dtr(t,e){for(let r=0;r<8;++r){const i=e[r];i[0]=1&r?-t.halfSize[0]:t.halfSize[0],i[1]=2&r?-t.halfSize[1]:t.halfSize[1],i[2]=4&r?-t.halfSize[2]:t.halfSize[2],Qf(i,i,t.quaternion),me(i,i,t.center)}}function yFt(t){return Tu(t.halfSize)}function _Ft(t,e,r,i,n){if(Qae(n.quaternion,t.quaternion),i===qe.Global){v2(bk,t.quaternion),Qf(jv,t.center,bk),YY(lC,jv),WEe(cC,lC,t.halfSize),Lo(cC,lC,cC);const s=Pe(cC);me(cC,lC,t.halfSize);const o=Pe(cC);if(s<r)ce(n.center,t.center),he(jv,r,r,r),me(n.halfSize,t.halfSize,jv);else{const a=o>0?1+e/o:1,l=s>0?1+r/s:1,c=(l+a)/2,h=(l-a)/2;le(n.halfSize,lC,h),hS(n.halfSize,n.halfSize,t.halfSize,c),le(n.center,lC,c),hS(n.center,n.center,t.halfSize,h),qEe(jv,jv),N9(n.center,n.center,jv),Qf(n.center,n.center,n.quaternion)}}else{const s=he(jv,0,0,1);hS(n.center,t.center,s,(r+e)/2),v2(bk,t.quaternion),Qf(s,s,bk),YY(s,s),hS(n.halfSize,t.halfSize,s,(r-e)/2)}return n}const jv=P(),lC=P(),cC=P(),bk=Dp();let vFt=class{constructor(e){this._totalCount=e,this._indexRanges=[0,e]}allVisible(){return this.componentCount()===this._totalCount}allInvisible(){return this._indexRanges.length===0}componentCount(){const e=this._indexRanges;let r=0;for(let i=0;i<e.length;i+=2)r+=e[i+1];return r}reset(e){e==="all"||e.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=bFt(e)}forEachComponent(e){const r=this._indexRanges;for(let i=0;i<r.length;i+=2){const n=r[i],s=n+r[i+1];for(let o=n;o<s;o++)if(!e(o))return!1}return!0}forEachComponentRange(e){const r=this._indexRanges;for(let i=0;i<r.length;i+=2){const n=r[i];if(!e(n,n+r[i+1]))return!1}return!0}computeOffsetRanges(e){const r=new Array(this._indexRanges.length),i=this._indexRanges;for(let n=0;n<i.length;n+=2){const s=i[n],o=s+i[n+1],a=e[s],l=e[o];r[n]=a,r[n+1]=l-a}return r}};function bFt(t){const e=new Array;if(t.length===0)return e;let r=t[0],i=1;for(let n=1;n<t.length;n++){const s=t[n];r+i===s?i+=1:(e.push(r),e.push(i),r=s,i=1)}return e.push(r),e.push(i),e}let wFt=class{constructor(e,r){this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null,this.offsets=r.slice();const i=this.count;this.visibility=new vFt(i),this.materialDataBuffer=e.getBuffer(i),this.materialDataIndices=new Uint16Array(i);for(let n=0;n<i;n++)this.materialDataIndices[n]=this.materialDataBuffer.acquireIndex()}destroy(){for(let e=0;e<this.count;e++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[e])}get count(){return this.offsets.length-1}get geometryRanges(){return R(this.cachedGeometryRanges)&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return R(this.highlightCounts)?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return R(this.highlightCounts)?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((R(this.cachedHighlightRanges)||R(this.cachedDefaultRanges))&&v(this.highlightCounts)){const{highlightRanges:e,defaultRanges:r}=xFt(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=e,this.cachedDefaultRanges=r}}};function xFt(t,e,r){const i=[],n=[];let s=r.length,o=r.length;return e.forEachComponent(a=>(t[a]>0?(s!==a-1&&(i.length&&i.push(r[s+1]-i[i.length-1]),i.push(r[a])),s=a):(o!==a-1&&(n.length&&n.push(r[o+1]-n[n.length-1]),n.push(r[a])),o=a),!0)),i.length&&i.push(r[s+1]-i[i.length-1]),n.length&&n.push(r[o+1]-n[n.length-1]),{highlightRanges:i,defaultRanges:n}}let XI=class extends be{constructor(){super(...arguments),this.visible=ZR.Hidden}};var ZR;u([d({autoDestroy:!0})],XI.prototype,"renderable",void 0),u([d({autoDestroy:!0})],XI.prototype,"components",void 0),XI=u([$("esri.views.3d.webgl-engine.collections.Component.ComponentObject")],XI),function(t){t[t.Hidden=0]="Hidden",t[t.Visible=1]="Visible"}(ZR||(ZR={}));function TFt(t,e,r,i){if(r>=e)return t;t==null&&(t=SFt());const n=t.isVisibleBit;let s=t.data;const o=QUe(s),a=r/o|0,l=r-o*a,c=(e-1)/o|0,h=s,p=i===n;if(!(r<h.length*o)&&p){const m=a+1,g=Math.ceil(h.length*1.5),_=c+1;let b=Math.max(m,g);b=Math.min(b,_),s=new Uint32Array(b),s.set(h)}return a<s.length&&(s[a]=CFt(s[a],l,p)),t.data=s,t}function KUe(t,e){if(t==null)return!0;const{isVisibleBit:r,data:i}=t,n=QUe(i);return e<i.length*n?EFt(r,i,e,n):!t.isVisibleBit}function SFt(t=!0){return{isVisibleBit:!t,data:new Uint32Array(0)}}function EFt(t,e,r,i){const n=r/i|0,s=r-n*i;return AFt(e[n],s)===t}function QUe(t){return t.BYTES_PER_ELEMENT*8}function CFt(t,e,r){return t&~(1<<e)|(r?1:0)<<e}function AFt(t,e){return(t&1<<e)!=0}let RFt=class{constructor(e,r){this._indices=v(e.indices)?e.indices:HO(e.positions.length/3),this._positions=new Ui(e.positions),this._components=r,this._componentIntersectionData=new Array(r.count)}getComponentAabb(e,r){if(v(this._perComponentAabbs)){for(let i=0;i<6;i++)r[i]=this._perComponentAabbs[6*e+i];return r}return this._computePerComponentAabbs(),this.getComponentAabb(e,r)}getComponentPositions(e,r){r.indices=this._indices,r.data=this._positions.typedBuffer,r.stride=this._positions.typedBufferStride,r.startIndex=this._components.offsets[e],r.endIndex=this._components.offsets[e+1]}intersect(e,r,i,n,s,o,a){const l=new Qe(this._positions.typedBuffer,3,!1,this._positions.typedBufferStride),c=this._indices,h=this._components.offsets,p=f4e(e,r,OFt),f=e[2],m=r[2];this._components.visibility.forEachComponent(g=>{if(!KUe(this._components.pickability,g))return!0;const _=this.getComponentAabb(g,MFt);if(v(o)){const E=o[g];v(s)?s.componentOffset=E:(e[2]=f-E,r[2]=m-E)}if(v(s)&&s.applyToAabb(_),!Rle(_,e,p,i))return!0;const b=h[g]/3,w=h[g+1]/3,x=w-b,T=(E,C,A)=>a(g,E,Gl(C,C,n),A);return R(s)&&x>BUe?(this._componentIntersectionData[g]==null&&(this._componentIntersectionData[g]=new Pce(this._indices,b,w,l)),this._componentIntersectionData[g].intersectRay({r0:e,r1:r},T)):XN(e,r,b,w,c,l,void 0,s,T),!0})}_computePerComponentAabbs(){const e=this._components.count;this._perComponentAabbs=new Float32Array(6*e);const r=this._indices,i=this._positions.typedBuffer,n=this._positions.typedBufferStride,s=this._components.offsets;let o=0;for(let a=0;a<e;a++){const l=s[a],c=s[a+1];let h=1/0,p=1/0,f=1/0,m=-1/0,g=-1/0,_=-1/0;for(let b=l;b<c;b++){const w=r[b]*n,x=i[w],T=i[w+1],E=i[w+2];h=Math.min(h,x),p=Math.min(p,T),f=Math.min(f,E),m=Math.max(m,x),g=Math.max(g,T),_=Math.max(_,E)}this._perComponentAabbs[o++]=h,this._perComponentAabbs[o++]=p,this._perComponentAabbs[o++]=f,this._perComponentAabbs[o++]=m,this._perComponentAabbs[o++]=g,this._perComponentAabbs[o++]=_}}get positions(){return this._positions}get indices(){return this._indices}};const OFt=P(),MFt=Ks();let PFt=class{constructor(e,r,i){this.material=e,this.geometry=r,this.meta=i}destroy(){this.material.dispose(),this.geometry.dispose()}},IFt=class{constructor(e,r,i,n){this.vao=e,this.primitiveType=r,this.parameters=i,this.indexed=n}dispose(){this.vao.dispose()}},$Ft=class{constructor(){this.near=Number.MAX_VALUE,this.far=-Number.MAX_VALUE}};function LFt(t,e){return{near:t,far:e}}function nF(t){return t?HD(t,1/0,-1/0):LFt(1/0,-1/0)}function HD(t,e,r){return t.near=e,t.far=r,t}function r3(t,e,r=t){return e!=null&&(r.near=Math.min(t.near,e.near),r.far=Math.max(t.far,e.far)),r}function wk(t,e){return t.near<=e&&e<=t.far}const nre={near:0,far:0};function DFt(t,e){const r=nF(),{eye:i,frustum:n,viewForward:s}=t;e.forAll(o=>{const a=v(o.offsetObb)?o.offsetObb:o.obb,l=ve(Lo(bh,a.center,i),s),c=B7(a,s);if(wk(r,l-c)&&wk(r,l+c))return;const h=zFt(a,n);if(h===-1)return;if(h===0)return Yy.far=l+c,Yy.near=l-c,void r3(r,Yy);const p=xk.pushNew();p.near=l-c,p.far=l+c,p.mask=h,p.object=o});for(let o=0;o<xk.length;o++){const a=xk.data[o];if(wk(r,a.near)&&wk(r,a.far))continue;Yy.far=a.far,Yy.near=1/0,UFt(v(a.object.offsetObb)?a.object.offsetObb:a.object.obb,i,NFt,c=>{let h=FFt;for(let p=0;p<e8e&&c.length>0;p++){if(!(a.mask&1<<p))continue;kFt(n[p],c,h);const f=c;c=h,h=f}for(let p=0;p<c.length;p+=3){he(Rc,c.data[p+0],c.data[p+1],c.data[p+2]);const f=ve(Lo(Rc,Rc,i),s);Yy.near=Math.min(Yy.near,f)}})===0&&(Yy.near=0),r3(r,Yy)}return xk.length=0,r}const xk=new Wt({allocator:t=>t||{near:1/0,far:-1/0,mask:0,object:null},deallocator:t=>(t.object=XS(t.object),t)}),Yy=nF(),Rc=P(),Mx=P(),NFt=new Wt({deallocator:null}),FFt=new Wt({deallocator:null});function kFt(t,e,r){r.length=0;const i=e.length-3;DW(Rc,e,i);const n=Ri(t,Rc);n<=0&&(r.push(Rc[0]),r.push(Rc[1]),r.push(Rc[2]));let s=0,o=n;for(;s<i;s+=3){DW(Mx,e,s);const a=Ri(t,Mx);o*a<0&&(fs(Rc,Mx,Rc,a/(a-o)),Oc(r,Rc)),a<=0&&Oc(r,Mx),o=a,ce(Rc,Mx)}o*n<0&&(DW(Mx,e,i),fs(Rc,Mx,Rc,n/(n-o)),Oc(r,Rc))}function DW(t,e,r){return he(t,e.data[r+0],e.data[r+1],e.data[r+2])}function Oc(t,e){t.push(e[0]),t.push(e[1]),t.push(e[2])}function UFt(t,e,r,i){v2(Tbe,t.quaternion),Lo(bh,e,t.center),Qf(bh,bh,Tbe);const n=8*((bh[0]<-t.halfSize[0]?-1:bh[0]>t.halfSize[0]?1:0)+3*(bh[1]<-t.halfSize[1]?-1:bh[1]>t.halfSize[1]?1:0)+9*(bh[2]<-t.halfSize[2]?-1:bh[2]>t.halfSize[2]?1:0)+13),s=xbe[n];if(s===0)return s;Voe(Tk,t.quaternion),zoe(Tk,Tk,t.halfSize);const o=(a,l)=>{const c=xbe[n+l+1];return he(a,((1&c)<<1)-1,(2&c)-1,((4&c)>>1)-1),Gl(a,a,Tk),me(a,t.center,a)};return r.length=0,Oc(r,o(NW,0)),Oc(r,o(Sbe,1)),Oc(r,o(bh,2)),Oc(r,o(Ebe,3)),i(r),s===1||(r.length=0,Oc(r,NW),Oc(r,Ebe),Oc(r,o(bh,4)),Oc(r,o(Cbe,5)),i(r),s===2||(r.length=0,Oc(r,NW),Oc(r,Cbe),Oc(r,o(bh,6)),Oc(r,Sbe),i(r))),s}const xbe=(()=>{const t=new Int8Array(216);let e=0;const r=i=>{for(let n=0;n<i.length;n++)t[e+n]=i[n];e+=8};return r([3,0,6,2,3,1,5,4]),r([2,0,2,3,1,5,4,0]),r([3,1,0,2,3,7,5,4]),r([2,0,1,3,2,6,4,0]),r([1,0,1,3,2,0,0,0]),r([2,1,5,7,3,2,0,0]),r([3,2,0,1,3,7,6,4]),r([2,2,0,1,3,7,6,0]),r([3,3,0,1,5,7,6,2]),r([2,0,1,5,4,6,2,0]),r([1,0,1,5,4,0,0,0]),r([2,1,3,7,5,4,0,0]),r([1,0,2,6,4,0,0,0]),r([0,0,0,0,0,0,0,0]),r([1,1,3,7,5,0,0,0]),r([2,2,3,7,6,4,0,0]),r([1,2,3,7,6,0,0,0]),r([2,3,1,5,7,6,2,0]),r([3,4,0,1,5,7,6,2]),r([2,5,7,6,4,0,1,0]),r([3,5,0,1,3,7,6,4]),r([2,4,5,7,6,2,0,0]),r([1,4,5,7,6,0,0,0]),r([2,5,1,3,7,6,4,0]),r([3,6,0,2,3,7,5,4]),r([2,6,2,3,7,5,4,0]),r([3,7,6,2,3,1,5,4]),t})(),e8e=4;function zFt(t,e){let r=0;for(let i=0;i<e8e;i++){const n=LT(t,e[i]);if(n>0)return-1;n===0&&(r|=1<<i)}return r}const Tk=vi(),Tbe=Dp(),bh=P(),NW=P(),Sbe=P(),Ebe=P(),Cbe=P();let VFt=class{constructor(e){this._objects=e}submit(e,r){this._objects.preSubmit(r),this._objects.visibleObjects.forAll(i=>i.renderable.material.submit(e,r,i))}queryShadowCasterDepthRange(e){return this._objects.visibleObjects.length?DFt(e,this._objects.visibleObjects):null}};function BFt(t){const e=mn().vec3f(O.POSITION);return t.normals&&e.vec2i16(O.NORMALCOMPRESSED,{glNormalized:!0}),t.textureCoordinates===cs.Default?e.vec2f(O.UV0):t.textureCoordinates===cs.Atlas&&(e.vec2f(O.UV0),e.vec4u16(O.UVREGION,{glNormalized:!0})),t.colors&&e.vec4u8(O.COLOR,{glNormalized:!0}),e.alignTo(4)}let jFt=class{constructor(){this.externalColor=pr(),this.externalColorMixMode=Hs.Multiply,this.castShadows=!0,this.pickable=!0,this.elevationOffset=0}},GFt=class extends Ln{constructor(e,r){super(e,"int",_i.Draw,(i,n,s)=>i.setUniform1i(e,r(n,s)))}};var Kg;(function(t){t[t.Uniform=0]="Uniform",t[t.Varying=1]="Varying",t[t.COUNT=2]="COUNT"})(Kg||(Kg={}));const Ice=429496.7296;function t8e(t,e){AD(t/Ice*.5+.5,e)}function HFt(t,e){switch(e.componentData){case Kg.Varying:return qFt(t,e);case Kg.Uniform:return WFt(t);case Kg.COUNT:return;default:e.componentData}}function qFt(t,e){const{vertex:r,fragment:i}=t;r.include(Qu),r.uniforms.add(Ub("componentColorTex",s=>s.componentParameters.texture.texture,e.hasWebGL2Context?oi.None:oi.Size)),t.attributes.add(O.COMPONENTINDEX,"float"),t.varyings.add("vExternalColorMixMode","mediump float"),t.varyings.add("vExternalColor","vec4");const n=e.output===V.ObjectAndLayerIdColor;n&&t.varyings.add("vObjectAndLayerIdColor","vec4"),t.include(Mke),r.constants.add("elevationScale","float",2*Ice),r.constants.add("stride","float",ue("enable-feature:objectAndLayerId-rendering")?3:2),r.code.add(S`
  vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
    vec2 textureSize = ${yp(e,"componentColorTex")};

    float index = componentIndex * stride + typeOffset;
    float coordX = mod(index, textureSize.x);
    float coordY = floor(index / textureSize.x);

    return vec2(coordX, coordY) + 0.5;
  }
  `),r.code.add(S`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return ${Wl(e,"componentColorTex","textureCoordinates","1.0 / componentColorTexSize")};
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = ${Wl(e,"componentColorTex","textureCoordinates","1.0 / componentColorTexSize")};
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${n?S`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = ${Wl(e,"componentColorTex","textureCoordinates","1.0 / componentColorTexSize")};
          }`:S`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),i.code.add(S`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${n?S`gl_FragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function WFt(t){const{vertex:e,fragment:r}=t;e.uniforms.add(new WV("externalColor",i=>i.componentParameters.externalColor)),r.uniforms.add(new GFt("externalColorMixMode",i=>i.componentParameters.externalColorMixMode)),t.varyings.add("vExternalColor","vec4"),e.code.add(S`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`),r.code.add(S`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}
void outputObjectAndLayerIdColor() {
gl_FragColor = vec4(1.0,0.0,0.0,0.0);
}`)}var ap;function XFt(t,e){const r=t.vertex;switch(r.code.add(S`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),e.vertexDiscardMode){case ap.None:r.code.add(S`#define vertexDiscardByOpacity(_opacity_) {}`);break;case ap.Opaque:r.code.add(S`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case ap.Transparent:r.code.add(S`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}}(function(t){t[t.None=0]="None",t[t.Transparent=1]="Transparent",t[t.Opaque=2]="Opaque",t[t.COUNT=3]="COUNT"})(ap||(ap={}));var Qg;function qtr(t){return t&&my(t)?Qg.Mars:t&&gy(t)?Qg.Moon:Qg.Earth}(function(t){t[t.Earth=1]="Earth",t[t.Mars=2]="Mars",t[t.Moon=3]="Moon",t[t.COUNT=4]="COUNT"})(Qg||(Qg={}));var zh;(function(t){t[t.None=0]="None",t[t.NoOverlay=1]="NoOverlay",t[t.ColorOverlay=2]="ColorOverlay",t[t.ColorOverlayWithWater=3]="ColorOverlayWithWater",t[t.COUNT=4]="COUNT"})(zh||(zh={}));let Sr=class extends _l{constructor(){super(...arguments),this.output=V.Color,this.textureCoordinateType=cs.None,this.componentData=Kg.Uniform,this.cullFace=Ii.Back,this.vertexDiscardMode=ap.None,this.doubleSidedMode=Tn.WindingOrder,this.alphaDiscardMode=gi.Opaque,this.integratedMeshMode=zh.None,this.transparencyPassType=At.NONE,this.ellipsoidMode=Qg.Earth,this.pbrMode=_t.Disabled,this.normalType=ci.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasBaseColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.useLegacyTerrainShading=!1,this.hasCloudsReflections=!0,this.snowCover=!1,this.objectAndLayerIdColor=!1,this.hasWebGL2Context=!1}};u([j({count:V.COUNT})],Sr.prototype,"output",void 0),u([j({count:cs.COUNT})],Sr.prototype,"textureCoordinateType",void 0),u([j({count:Kg.COUNT})],Sr.prototype,"componentData",void 0),u([j({count:Ii.COUNT})],Sr.prototype,"cullFace",void 0),u([j({count:ap.COUNT})],Sr.prototype,"vertexDiscardMode",void 0),u([j({count:Tn.COUNT})],Sr.prototype,"doubleSidedMode",void 0),u([j({count:gi.COUNT})],Sr.prototype,"alphaDiscardMode",void 0),u([j({count:zh.COUNT})],Sr.prototype,"integratedMeshMode",void 0),u([j({count:At.COUNT})],Sr.prototype,"transparencyPassType",void 0),u([j({count:Qg.COUNT})],Sr.prototype,"ellipsoidMode",void 0),u([j({count:_t.COUNT})],Sr.prototype,"pbrMode",void 0),u([j({count:ci.COUNT})],Sr.prototype,"normalType",void 0),u([j()],Sr.prototype,"spherical",void 0),u([j()],Sr.prototype,"doublePrecisionRequiresObfuscation",void 0),u([j()],Sr.prototype,"hasVertexColors",void 0),u([j()],Sr.prototype,"hasNormals",void 0),u([j()],Sr.prototype,"hasSlicePlane",void 0),u([j()],Sr.prototype,"hasBaseColorTexture",void 0),u([j()],Sr.prototype,"receiveAmbientOcclusion",void 0),u([j()],Sr.prototype,"receiveShadows",void 0),u([j()],Sr.prototype,"blendingEnabled",void 0),u([j()],Sr.prototype,"hasScreenSpaceReflections",void 0),u([j()],Sr.prototype,"hasPolygonOffset",void 0),u([j()],Sr.prototype,"hasMetallicRoughnessTexture",void 0),u([j()],Sr.prototype,"hasEmissionTexture",void 0),u([j()],Sr.prototype,"hasOcclusionTexture",void 0),u([j()],Sr.prototype,"hasNormalTexture",void 0),u([j()],Sr.prototype,"hasOccludees",void 0),u([j()],Sr.prototype,"hasMultipassTerrain",void 0),u([j()],Sr.prototype,"cullAboveGround",void 0),u([j()],Sr.prototype,"useLegacyTerrainShading",void 0),u([j()],Sr.prototype,"hasCloudsReflections",void 0),u([j()],Sr.prototype,"snowCover",void 0),u([j()],Sr.prototype,"objectAndLayerIdColor",void 0),u([j()],Sr.prototype,"hasWebGL2Context",void 0),u([j({constValue:_i.Draw})],Sr.prototype,"pbrTextureBindType",void 0),u([j({constValue:!0})],Sr.prototype,"hasSliceHighlight",void 0),u([j({constValue:!1})],Sr.prototype,"hasSliceInVertexProgram",void 0),u([j({constValue:!1})],Sr.prototype,"useCustomDTRExponentForWater",void 0),u([j({constValue:!1})],Sr.prototype,"hasVertexTangents",void 0),u([j({constValue:!0})],Sr.prototype,"supportsTextureAtlas",void 0),u([j({constValue:!1})],Sr.prototype,"highStepCount",void 0),u([j({constValue:!1})],Sr.prototype,"instancedDoublePrecision",void 0),u([j({constValue:!0})],Sr.prototype,"useFillLights",void 0),u([j({constValue:!1})],Sr.prototype,"objectAndLayerIdColorInstanced",void 0);function Abe(t,e){t.include(X2,e),t.fragment.include(FD);const r=t.fragment;r.uniforms.add(new WV("baseColor",i=>i.baseColor)),r.uniforms.add(new kS("objectOpacity",i=>i.objectOpacity)),e.hasVertexColors?r.code.add(S`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):r.code.add(S`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),r.code.add(S`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function Rbe(t,e){const r=t.fragment;switch(e.doubleSidedMode){case Tn.None:r.code.add(S`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case Tn.View:t.include(DR,e),r.code.add(S`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case Tn.WindingOrder:r.code.add(S`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:e.doubleSidedMode;case Tn.COUNT:}switch(e.normalType){case ci.Attribute:case ci.CompressedAttribute:t.include(C7,e),r.code.add(S`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case ci.ScreenDerivative:t.extensions.add("GL_OES_standard_derivatives"),t.include(DR,e),r.code.add(S`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case ci.Ground:e.spherical?(t.include(DR,e),r.code.add(S`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):r.code.add(S`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),t.extensions.add("GL_OES_standard_derivatives"),r.code.add(S`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:e.normalType;case ci.COUNT:}}function YFt(t,e){const r=t.fragment;if(e.hasBaseColorTexture&&(e.output===V.Color||e.alphaDiscardMode!==gi.Opaque)){t.include(Mae,e);const i=e.textureCoordinateType===cs.Atlas;r.uniforms.add(Ub("baseColorTexture",n=>n.texture,i?e.hasWebGL2Context?oi.None:oi.Size:oi.None)),i?(t.include(ODe),r.code.add(S`
        vec4 readBaseColorTexture() {
          vec2 textureSize = ${yp(e,"baseColorTexture")};
          return textureAtlasLookup(baseColorTexture, textureSize, vuv0, vuvRegion);
        }
      `)):r.code.add(S`vec4 readBaseColorTexture() {
return texture2D(baseColorTexture, vuv0);
}`)}else r.code.add(S`vec4 readBaseColorTexture() { return vec4(1.0); }`)}function ZFt(t){const e=new Br;e.include(DR,t),e.include(C7,t),e.include(X2,t),e.include(Zg,t),e.include(L3,t),e.include(HFt,t),e.include(wRt,t),e.include(p2t,t),e.include(YFt,t),e.include(XFt,t);const{vertex:r,fragment:i}=e;t.pbrMode!==_t.Normal&&t.pbrMode!==_t.Schematic||(e.include(Iae,t),t.hasNormalTexture&&e.include(Lke,t));const n=t.output===V.Shadow||t.output===V.ShadowHighlight||t.output===V.ShadowExcludeHighlight;n&&t.componentData===Kg.Varying?r.code.add(S`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):r.code.add(S`#define discardShadows(castShadows) {}`);const s=t.integratedMeshMode===zh.ColorOverlay||t.integratedMeshMode===zh.ColorOverlayWithWater,o=s&&t.output===V.Color&&t.pbrMode===_t.WaterOnIntegratedMesh;return s&&(e.include(E2,t),e.include(GDt,t),t.spherical?r.code.add(S`
      const float invEllipsoidRadius = ${S.float(1/(t.ellipsoidMode===Qg.Earth?Cr.radius:t.ellipsoidMode===Qg.Mars?jg.radius:b_.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):r.code.add(S`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),o&&(e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),e.varyings.add("groundNormal","vec3")),r.code.add(S`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      ${t.output===V.ObjectAndLayerIdColor?S`externalColor.a = 1.0;`:""}

      if (externalColor.a < ${S.float(Fa)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${t.output===V.ObjectAndLayerIdColor?S`forwardObjectAndLayerIdColor();`:""}
      ${o?t.spherical?S`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:S`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${s?S`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),t.output===V.Alpha&&(i.include(sd),e.include(od,t),e.include(Abe,t),s&&i.uniforms.add(new Dt("ovColorTex",(a,l)=>Qte(a,l))),i.code.add(S`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.hasMultipassTerrain?S`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${s?S`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        gl_FragColor = vec4(materialColor.a);
      }
    `)),t.output===V.Color&&(i.include(sd),e.include(od,t),e.include(Abe,t),e.include(Rbe,t),e.include(E2,t),t.receiveShadows?(e.include(A7,t),i.code.add(S`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):i.code.add(S`float evaluateShadow() { return 0.0; }`),s&&i.uniforms.add(new Dt("ovColorTex",(a,l)=>Qte(a,l))),i.code.add(S`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.hasMultipassTerrain?S`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${s?S`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),t.pbrMode===_t.Normal||t.pbrMode===_t.Schematic?(vy(i),i.code.add(S`
        ${t.pbrMode===_t.Normal?S`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),t.hasNormalTexture?i.code.add(S`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):i.code.add(S`vec3 shadingNormal = normalVertex;`),i.code.add(S`${t.spherical?S`vec3 normalGround = normalize(positionWorld());`:S`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),i.code.add(S`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());

        ${t.snowCover?S`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${s?S` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(t.receiveShadows?i.code.add(S`float shadow = evaluateShadow();`):t.spherical?(H3(i),i.code.add(S`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):i.code.add(S`float shadow = 0.0;`),o&&i.uniforms.add(new Dt("ovNormalTex",(a,l)=>$ce(l))),t.snowCover&&(e.extensions.add("GL_OES_standard_derivatives"),i.code.add(S`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`)),i.code.add(S`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${s?S` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${o?S`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),i.code.add(S`
        gl_FragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${t.transparencyPassType===At.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),(t.output===V.Depth||n)&&(e.include(M_,t),i.code.add(S`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),t.output===V.Normal&&(e.include(Rbe,t),i.code.add(S`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${t.normalType===ci.Ground?"0.0":"1.0"};
        gl_FragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),t.output===V.ObjectAndLayerIdColor&&e.fragment.code.add(S`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${s?S`gl_FragColor = getOverlayColorTexel(vtcOverlay);`:"outputObjectAndLayerIdColor();"}
      }
    `),t.output===V.Highlight&&(e.include(W_,t),i.code.add(S`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${s?S`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  gl_FragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),e}function $ce(t){return t.overlays.length===0?null:t.overlays[dn.INNER].getValidTexture(Rn.Water)}const JFt=Object.freeze(Object.defineProperty({__proto__:null,build:ZFt,getOverlayNormalTexture:$ce},Symbol.toStringTag,{value:"Module"}));let r8e=class i8e extends Wr{initializeConfiguration(e,r){r.hasWebGL2Context=e.rctx.type===Et.WEBGL2,r.spherical=e.viewingMode===qe.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Gr(e.rctx,i8e.shader.get().build(this.configuration),n8e)}_setPipelineState(e){const r=this.configuration,i=r.integratedMeshMode!==zh.None,n=e===At.NONE,s=e===At.FrontFace;return Ht({blending:r.output!==V.Color&&r.output!==V.Alpha||!r.blendingEnabled?null:n?Qh:X_(e),culling:qB(r.cullFace),depthTest:{func:kw(e)},depthWrite:n||s?Xc:null,colorWrite:ir,stencilWrite:i||r.hasOccludees?fy:null,stencilTest:i?sAt(jc.IntegratedMeshMaskExcluded):r.hasOccludees?Uw:null,polygonOffset:n||s?r.hasPolygonOffset?{factor:2,units:2}:null:b7})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};r8e.shader=new jr(JFt,()=>Q(()=>import("./ComponentShader.glsl-bf37bcb0.js"),[]));const n8e=new Map([[O.POSITION,0],[O.NORMAL,1],[O.NORMALCOMPRESSED,1],[O.COLOR,2],[O.UV0,3],[O.UVREGION,4],[O.COMPONENTINDEX,5]]);let KFt=class extends wi{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const e of this._parameterBlocks)this[e]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const e of this._parameterBlocks)if(this[e].dirty)return!0;return!1}},Lce=class{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}};function Cn(t={}){return(e,r)=>{const i=e._parameterCount??0;if(e._parameterCount=i+1,t.vectorOps){const n=t.vectorOps;Object.defineProperty(e,r,{get(){return this[i]},set(s){const o=this[i];if(o==null)this[i]=s;else{if(n.equals(o,s))return;n.copy(o,s)}this._setDirty()}})}else Object.defineProperty(e,r,{get(){return this[i]},set(n){this[i]!==n&&(t.dispose&&this[i]&&this[i].dispose(),this[i]=n,this._setDirty())}})}}function Obe(){return(t,e)=>{const r=t._parameterCount??0;t._parameterCount=r+1,t._parameterBlocks=t._parameterBlocks||[],t._parameterBlocks.push(r),Object.defineProperty(t,e,{get(){return this[r]},set(i){this[r]!==i&&(this[r]=i,this._setDirty())}})}}let j7=class{constructor(e){this._low=Ki(),this._high=Ki(),e&&this.set(e)}get low(){return this._low}get high(){return this._high}set(e){const r=this._low,i=this._high;ce(r,e),Lo(i,e,r)}setElements(e,r,i){he(Mbe,e,r,i),this.set(Mbe)}get(e){return me(e,this._low,this._high)}getLowScaled(e){return le(e,this._low,1)}};const Mbe=P();let Eo=class extends KFt{constructor(e,r){super(),this.toMapSpace=r,this.baseColor=gm(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=ti(1,1,.5),this.emissiveFactor=ti(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new ZU,this.componentParameters=new lL,this.textureAlphaCutoff=RV,this.alphaDiscardMode=gi.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=Qg.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new Sr;const i=new j7(e.position),n=e$e(e.rotationScale);Lw(n,n),this.transformNormalGlobalFromModel=Xu(n,n),this.transformWorldFromModelTL=i.low,this.transformWorldFromModelTH=i.high,this.transformWorldFromModelRS=e.rotationScale}dispose(){this._technique=en(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return v(this.baseColorTexture)?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return v(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return v(this.emissionTexture)?this.emissionTexture.glTexture:null}get textureOcclusion(){return v(this.occlusionTexture)?this.occlusionTexture.glTexture:null}get textureNormal(){return v(this.normalTexture)?this.normalTexture.glTexture:null}prepareTechnique(e,r,i,n){const s=this._techniqueConfiguration;s.hasVertexColors=n.colors,s.hasNormals=n.normals,s.textureCoordinateType=n.textureCoordinates,s.hasMetallicRoughnessTexture=v(this.metallicRoughnessTexture),s.hasEmissionTexture=v(this.emissionTexture),s.hasOcclusionTexture=v(this.occlusionTexture),s.hasNormalTexture=v(this.normalTexture),s.transparencyPassType=r.identifier===$u.Material&&i.transparencyPassType!=null?i.transparencyPassType:At.NONE,s.hasMultipassTerrain=r.identifier===$u.Material&&i.multipassTerrain!=null&&i.multipassTerrain.enabled,s.cullAboveGround=r.identifier===$u.Material&&i.multipassTerrain!=null&&i.multipassTerrain.cullAboveGround,s.ellipsoidMode=this.ellipsoidMode,s.componentData=this.componentParameters.type,s.cullFace=this.commonMaterialParameters.cullFace,s.doubleSidedMode=this.commonMaterialParameters.doubleSided?Tn.View:Tn.None,s.hasBaseColorTexture=v(this.baseColorTexture);const o=this._computeWhichMaterialPass();s.blendingEnabled=o===Fl.Transparent||o===Fl.OpaqueAndTransparent,s.alphaDiscardMode=this.alphaDiscardMode,s.integratedMeshMode=this.isIntegratedMesh?e4t(i)?$ce(i)?zh.ColorOverlayWithWater:zh.ColorOverlay:zh.NoOverlay:zh.None,s.useLegacyTerrainShading=this.isIntegratedMesh&&Qr.TERRAIN_USE_LEGACY_SHADING,s.hasPolygonOffset=this.polygonOffsetEnabled;const a=this.hasParametersFromSource&&R(this.baseColorTexture);if(s.pbrMode=s.integratedMeshMode===zh.ColorOverlayWithWater?_t.WaterOnIntegratedMesh:this.usePBR?a?_t.Schematic:_t.Normal:_t.Disabled,s.normalType=s.integratedMeshMode===zh.None?s.hasNormals?ci.CompressedAttribute:ci.ScreenDerivative:ci.Ground,s.hasSlicePlane=v(i.slicePlane)&&this.commonMaterialParameters.hasSlicePlane,r.identifier===$u.ShadowMap)s.output=V.Shadow,s.vertexDiscardMode=ap.None;else if(r.identifier===$u.Highlight)s.output=V.Highlight,s.vertexDiscardMode=ap.None;else{switch(this._computeWhichMaterialPass()===Fl.OpaqueAndTransparent?s.vertexDiscardMode=r.transparent?ap.Opaque:ap.Transparent:s.vertexDiscardMode=ap.None,s.output=r.output,s.receiveAmbientOcclusion=!1,s.receiveShadows=!1,r.output){case V.Color:s.receiveAmbientOcclusion=i.ssaoHelper.active,s.hasOccludees=i.hasOccludees,s.receiveShadows=i.shadowMap.ready,s.hasScreenSpaceReflections=i.ssr.enabled,s.hasCloudsReflections=v(i.cloudsFade.data);break;case V.Alpha:s.hasOccludees=i.hasOccludees;break;case V.ObjectAndLayerIdColor:s.objectAndLayerIdColor=!0}s.snowCover=this.hasSnowCover(i)}return this._technique=e.releaseAndAcquire(r8e,s,this._technique),this._setClean(),this._technique}hasSnowCover(e){return v(e.weather)&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}submit(e,r,i){if(this.objectOpacity===0)return;const n=i.renderable.geometry,s=i.components,o=i.renderable.meta.cameraDepthSquared,a=s.geometryRanges,l=s.highlightRanges,c=s.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case Fl.Opaque:e.materialOpaque.submitDraw(this,n,a,o);break;case Fl.Transparent:e.materialTransparent.submitDraw(this,n,a,o);break;case Fl.OpaqueAndTransparent:e.materialOpaque.submitDraw(this,n,a,o),e.materialTransparent.submitDraw(this,n,a,o);break;case Fl.IntegratedMesh:e.materialIntegratedMesh.submitDraw(this,n,a,o),QFt(r)&&e.highlightIntegratedMesh.submitDraw(this,n,a,o)}const h=this.componentParameters.castShadows!==lo.None;h&&e.shadowMap.submitDraw(this,n,a,o),v(l)&&(e.highlight.submitDraw(this,n,l,o),h&&e.highlightShadowMap.submitDraw(this,n,l,o)),h&&v(c)&&e.defaultShadowMap.submitDraw(this,n,c,o)}_computeWhichMaterialPass(){return this.isIntegratedMesh?Fl.IntegratedMesh:this.objectOpacity<1?Fl.Transparent:this.componentParameters.opaqueOverride===lo.All?Fl.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===gi.Blend||this.alphaDiscardMode===gi.MaskBlend?Fl.Transparent:this.componentParameters.transparent===lo.None?Fl.Opaque:this.componentParameters.transparent===lo.All?Fl.Transparent:Fl.OpaqueAndTransparent}};var Fl,lo;u([Cn({vectorOps:tCe})],Eo.prototype,"baseColor",void 0),u([Cn()],Eo.prototype,"usePBR",void 0),u([Cn()],Eo.prototype,"hasParametersFromSource",void 0),u([Cn({vectorOps:qhe})],Eo.prototype,"mrrFactors",void 0),u([Cn({vectorOps:qhe})],Eo.prototype,"emissiveFactor",void 0),u([Cn({dispose:!0})],Eo.prototype,"baseColorTexture",void 0),u([Cn({dispose:!0})],Eo.prototype,"metallicRoughnessTexture",void 0),u([Cn({dispose:!0})],Eo.prototype,"emissionTexture",void 0),u([Cn({dispose:!0})],Eo.prototype,"occlusionTexture",void 0),u([Cn({dispose:!0})],Eo.prototype,"normalTexture",void 0),u([Cn()],Eo.prototype,"objectOpacity",void 0),u([Obe()],Eo.prototype,"commonMaterialParameters",void 0),u([Obe()],Eo.prototype,"componentParameters",void 0),u([Cn()],Eo.prototype,"textureAlphaCutoff",void 0),u([Cn()],Eo.prototype,"alphaDiscardMode",void 0),u([Cn()],Eo.prototype,"isIntegratedMesh",void 0),u([Cn()],Eo.prototype,"polygonOffsetEnabled",void 0),u([Cn()],Eo.prototype,"ellipsoidMode",void 0),u([Cn()],Eo.prototype,"hasOccludees",void 0),function(t){t[t.Opaque=0]="Opaque",t[t.Transparent=1]="Transparent",t[t.OpaqueAndTransparent=2]="OpaqueAndTransparent",t[t.IntegratedMesh=3]="IntegratedMesh"}(Fl||(Fl={}));let ZU=class extends Lce{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=Ii.Back,this.hasSlicePlane=!0}};u([Cn()],ZU.prototype,"doubleSided",void 0),u([Cn()],ZU.prototype,"cullFace",void 0),u([Cn()],ZU.prototype,"hasSlicePlane",void 0);let lL=class extends Lce{constructor(){super(...arguments),this.externalColor=Zt(1,1,1,1),this.externalColorMixMode=Hs.Multiply,this.castShadows=lo.All}get transparent(){return this.externalColor[3]<1?lo.All:lo.None}get opaqueOverride(){return this.externalColorMixMode===Hs.Replace&&this.externalColor[3]===1?lo.All:lo.None}get visible(){return this.externalColor[3]>0?lo.All:lo.None}get type(){return Kg.Uniform}};u([Cn({vectorOps:tCe})],lL.prototype,"externalColor",void 0),u([Cn()],lL.prototype,"externalColorMixMode",void 0),u([Cn()],lL.prototype,"castShadows",void 0),function(t){t[t.All=0]="All",t[t.Some=1]="Some",t[t.None=2]="None"}(lo||(lo={}));let YI=class extends Lce{constructor(){super(...arguments),this.texture=null,this.transparent=lo.None,this.opaqueOverride=lo.None,this.castShadows=lo.None}get type(){return Kg.Varying}};function QFt(t){return t.overlays.length!==0&&v(t.overlays[dn.INNER].getValidTexture(Rn.Highlight))}function e4t(t){return t.overlays.length!==0&&v(t.overlays[dn.INNER].getColorTextureNoRasterImage())}u([Cn()],YI.prototype,"texture",void 0),u([Cn()],YI.prototype,"transparent",void 0),u([Cn()],YI.prototype,"opaqueOverride",void 0),u([Cn()],YI.prototype,"castShadows",void 0);const ZV=mn().vec3f(O.POSITION).u16(O.COMPONENTINDEX).u16(O.U16PADDING),s8e=mn().vec2u8(O.SIDENESS),t4t=eh(s8e),o8e=mn().vec3f(O.POSITION0).vec3f(O.POSITION1).u16(O.COMPONENTINDEX).u8(O.VARIANTOFFSET,{glNormalized:!0}).u8(O.VARIANTSTROKE).u8(O.VARIANTEXTENSION,{glNormalized:!0}).u8(O.U8PADDING,{glPadding:!0}).u16(O.U16PADDING,{glPadding:!0}),sre=o8e.clone().vec3f(O.NORMAL),ore=o8e.clone().vec3f(O.NORMALA).vec3f(O.NORMALB),a8e=new Map([[O.POSITION0,0],[O.POSITION1,1],[O.COMPONENTINDEX,2],[O.VARIANTOFFSET,3],[O.VARIANTSTROKE,4],[O.VARIANTEXTENSION,5],[O.NORMAL,6],[O.NORMALA,6],[O.NORMALB,7],[O.SIDENESS,8]]);function Pbe(t,e,r){const i=e/3,n=new Uint32Array(r+1),s=new Uint32Array(r+1),o=(w,x)=>{w<x?n[w+1]++:s[x+1]++};for(let w=0;w<i;w++){const x=t[3*w],T=t[3*w+1],E=t[3*w+2];o(x,T),o(T,E),o(E,x)}let a=0,l=0;for(let w=0;w<r;w++){const x=n[w+1],T=s[w+1];n[w+1]=a,s[w+1]=l,a+=x,l+=T}const c=new Uint32Array(6*i),h=n[r],p=(w,x,T)=>{if(w<x){const E=n[w+1]++;c[2*E]=x,c[2*E+1]=T}else{const E=s[x+1]++;c[2*h+2*E]=w,c[2*h+2*E+1]=T}};for(let w=0;w<i;w++){const x=t[3*w],T=t[3*w+1],E=t[3*w+2];p(x,T,w),p(T,E,w),p(E,x,w)}const f=(w,x)=>{const T=2*w,E=x-w;for(let C=1;C<E;C++){const A=c[T+2*C],I=c[T+2*C+1];let M=C-1;for(;M>=0&&c[T+2*M]>A;M--)c[T+2*M+2]=c[T+2*M],c[T+2*M+3]=c[T+2*M+1];c[T+2*M+2]=A,c[T+2*M+3]=I}};for(let w=0;w<r;w++)f(n[w],n[w+1]),f(h+s[w],h+s[w+1]);const m=new Int32Array(3*i),g=(w,x)=>w===t[3*x]?0:w===t[3*x+1]?1:w===t[3*x+2]?2:-1,_=(w,x)=>{const T=g(w,x);m[3*x+T]=-1},b=(w,x,T,E)=>{const C=g(w,x);m[3*x+C]=E;const A=g(T,E);m[3*E+A]=x};for(let w=0;w<r;w++){let x=n[w];const T=n[w+1];let E=s[w];const C=s[w+1];for(;x<T&&E<C;){const A=c[2*x],I=c[2*h+2*E];A===I?(b(w,c[2*x+1],I,c[2*h+2*E+1]),x++,E++):A<I?(_(w,c[2*x+1]),x++):(_(I,c[2*h+2*E+1]),E++)}for(;x<T;)_(w,c[2*x+1]),x++;for(;E<C;)_(c[2*h+2*E],c[2*h+2*E+1]),E++}return m}let l8e=class{updateSettings(e){this.settings=e,this._edgeHashFunction=e.reducedPrecision?i4t:r4t}write(e,r,i){const n=this._edgeHashFunction(i);Ek.seed=n;const s=Ek.getIntRange(0,255),o=Ek.getIntRange(0,this.settings.variants-1),a=.7,l=Ek.getFloat(),c=255*(.5*n4t(-(1-Math.min(l/a,1))+Math.max(0,l-a)/(1-a),1.2)+.5);e.position0.setVec(r,i.position0),e.position1.setVec(r,i.position1),e.componentIndex.set(r,i.componentIndex),e.variantOffset.set(r,s),e.variantStroke.set(r,o),e.variantExtension.set(r,c)}trim(e,r){return e.slice(0,r)}};const Dce=new Float32Array(6),JV=new Uint32Array(Dce.buffer),xb=new Uint32Array(1);function r4t(t){const e=Dce;e[0]=t.position0[0],e[1]=t.position0[1],e[2]=t.position0[2],e[3]=t.position1[0],e[4]=t.position1[1],e[5]=t.position1[2],xb[0]=5381;for(let r=0;r<JV.length;r++)xb[0]=31*xb[0]+JV[r];return xb[0]}function i4t(t){const e=Dce;e[0]=uC(t.position0[0]),e[1]=uC(t.position0[1]),e[2]=uC(t.position0[2]),e[3]=uC(t.position1[0]),e[4]=uC(t.position1[1]),e[5]=uC(t.position1[2]),xb[0]=5381;for(let r=0;r<JV.length;r++)xb[0]=31*xb[0]+JV[r];return xb[0]}const Ibe=1e4;function uC(t){return Math.round(t*Ibe)/Ibe}function n4t(t,e){const r=t<0?-1:1;return Math.abs(t)**e*r}let KV=class{constructor(){this._commonWriter=new l8e}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return sre.createBuffer(e)}write(e,r,i){this._commonWriter.write(e,r,i),me(Sk,i.faceNormal0,i.faceNormal1),we(Sk,Sk),e.normal.setVec(r,Sk)}trim(e,r){return this._commonWriter.trim(e,r)}};KV.Layout=sre,KV.glLayout=eh(sre,1);let QV=class{constructor(){this._commonWriter=new l8e}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return ore.createBuffer(e)}write(e,r,i){this._commonWriter.write(e,r,i),e.normalA.setVec(r,i.faceNormal0),e.normalB.setVec(r,i.faceNormal1)}trim(e,r){return this._commonWriter.trim(e,r)}};QV.Layout=ore,QV.glLayout=eh(ore,1);const Sk=P(),Ek=new p$,DT=-1;var e9;function s4t(t,e,r,i=h4t){const n=t.vertices.position,s=t.vertices.componentIndex,o=Xt(i.anglePlanar),a=Xt(i.angleSignificantEdge),l=Math.cos(a),c=Math.cos(o),h=are.edge,p=h.position0,f=h.position1,m=h.faceNormal0,g=h.faceNormal1,_=u4t(t),b=c4t(t),w=b.length/4,x=e.allocate(w);let T=0;const E=w,C=r.allocate(E);let A=0,I=0,M=0;const D=ZBe(0,w),U=new Float32Array(w);U.forEach((K,W,N)=>{n.getVec(b[4*W+0],p),n.getVec(b[4*W+1],f),N[W]=Pi(p,f)}),D.sort((K,W)=>U[W]-U[K]);const z=new Array,B=new Array;for(let K=0;K<w;K++){const W=D[K],N=U[W],L=b[4*W+0],F=b[4*W+1],G=b[4*W+2],q=b[4*W+3],Z=q===DT;if(n.getVec(L,p),n.getVec(F,f),Z)he(m,_[3*G+0],_[3*G+1],_[3*G+2]),ce(g,m),h.componentIndex=s.get(L),h.cosAngle=ve(m,g);else{if(he(m,_[3*G+0],_[3*G+1],_[3*G+2]),he(g,_[3*q+0],_[3*q+1],_[3*q+2]),h.componentIndex=s.get(L),h.cosAngle=ve(m,g),a4t(h,c))continue;h.cosAngle<-.9999&&ce(g,m)}I+=N,M++,Z||o4t(h,l)?(e.write(x,T++,h),z.push(N)):l4t(h,o)&&(r.write(C,A++,h),B.push(N))}const ee=new Float32Array(z.reverse()),te=new Float32Array(B.reverse());return{regular:{instancesData:e.trim(x,T),lodInfo:{lengths:ee}},silhouette:{instancesData:r.trim(C,A),lodInfo:{lengths:te}},averageEdgeLength:I/M}}function o4t(t,e){return t.cosAngle<e}function a4t(t,e){return t.cosAngle>e}function l4t(t,e){const r=Js(t.cosAngle),i=are.fwd,n=are.ortho;return L_(i,t.position1,t.position0),r*(ve(vt(n,t.faceNormal0,t.faceNormal1),i)>0?-1:1)>e}function c4t(t){const e=t.faces.length/3,r=t.faces,i=t.neighbors;let n=0;for(let a=0;a<e;a++){const l=i[3*a+0],c=i[3*a+1],h=i[3*a+2],p=r[3*a+0],f=r[3*a+1],m=r[3*a+2];n+=l===DT||p<f?1:0,n+=c===DT||f<m?1:0,n+=h===DT||m<p?1:0}const s=new Int32Array(4*n);let o=0;for(let a=0;a<e;a++){const l=i[3*a+0],c=i[3*a+1],h=i[3*a+2],p=r[3*a+0],f=r[3*a+1],m=r[3*a+2];(l===DT||p<f)&&(s[o++]=p,s[o++]=f,s[o++]=a,s[o++]=l),(c===DT||f<m)&&(s[o++]=f,s[o++]=m,s[o++]=a,s[o++]=c),(h===DT||m<p)&&(s[o++]=m,s[o++]=p,s[o++]=a,s[o++]=h)}return s}function u4t(t){const e=t.faces.length/3,r=t.vertices.position,i=t.faces,n=FW.v0,s=FW.v1,o=FW.v2,a=new Float32Array(3*e);for(let l=0;l<e;l++){const c=i[3*l+0],h=i[3*l+1],p=i[3*l+2];r.getVec(c,n),r.getVec(h,s),r.getVec(p,o),ge(s,s,n),ge(o,o,n),vt(n,s,o),we(n,n),a[3*l+0]=n[0],a[3*l+1]=n[1],a[3*l+2]=n[2]}return a}(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH"})(e9||(e9={}));const are={edge:{position0:P(),position1:P(),faceNormal0:P(),faceNormal1:P(),componentIndex:0,cosAngle:0},ortho:P(),fwd:P()},FW={v0:P(),v1:P(),v2:P()},h4t={anglePlanar:4,angleSignificantEdge:35};function d4t(t){const e=p4t(t.data,t.skipDeduplicate,t.indices,t.indicesLength);return $be.updateSettings(t.writerSettings),Lbe.updateSettings(t.writerSettings),s4t(e,$be,Lbe)}function p4t(t,e,r,i){if(e){const o=Pbe(r,i,t.count);return new f4t(r,i,o,t)}const n=wte(t.buffer,t.stride/4,{originalIndices:r,originalIndicesLength:i}),s=Pbe(n.indices,i,n.uniqueCount);return{faces:n.indices,facesLength:n.indices.length,neighbors:s,vertices:ZV.createView(n.buffer)}}let f4t=class{constructor(e,r,i,n){this.faces=e,this.facesLength=r,this.neighbors=i,this.vertices=n}};const $be=new KV,Lbe=new QV,srr=mn().vec3f(O.POSITION0).vec3f(O.POSITION1),m4t=mn().vec3f(O.POSITION0).vec3f(O.POSITION1).u16(O.COMPONENTINDEX).u16(O.U16PADDING,{glPadding:!0});let g4t=class{constructor(e){this._maxCount=e,this._nextIndex=0,this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){return this._recycledIndices.length>0?this._recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(e){this._recycledIndices.push(e)}},y4t=class{constructor(e,r=1){this._rctx=e,this._fieldCount=r,this.textureWidth=4096,this._dirty=!0,this._texture=new mt(this._rctx,{target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:it.NEAREST,wrapMode:$t.CLAMP_TO_EDGE,width:this.textureWidth,height:1,flipped:!1}),this._data=new gl(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose(),this._texture=void 0,this._data=void 0}setData(e,r,i,n,s,o){const a=e*this._fieldCount+r;this._dirty=!0,this._data.set(a,0,i),this._data.set(a,1,n),this._data.set(a,2,s),this._data.set(a,3,o)}setDataElement(e,r,i,n){const s=e*this._fieldCount+r;this._dirty=!0,this._data.set(s,i,n)}resizeToFit(e){const r=e*this._fieldCount;if(r>=this._data.count){const i=Math.ceil((r+1)/this.textureWidth)*this.textureWidth,n=new gl(new ArrayBuffer(4*i));n.typedBuffer.set(this._data.typedBuffer),this._data=n}}updateTexture(){if(!this._dirty)return;const e=this._texture.descriptor.width,r=this._texture.descriptor.height;this._data.count>e*r&&this._texture.resize(e,this._data.count/e),this._texture.setData(this._data.typedBuffer),this._dirty=!1}get texture(){return this._texture}};const c8e=65536;let _4t=class{constructor(e,r=1){this.textureBuffer=new y4t(e,r),this._indexManager=new g4t(c8e)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const e=this._indexManager.acquire();return this.textureBuffer.resizeToFit(e),e}releaseIndex(e){this._indexManager.release(e)}},u8e=class{constructor(e,r=1){this._rctx=e,this._fieldCount=r,this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(e=>e.activeCount!==0||(e.dispose(),!1))}destroy(){this._buffers.forEach(e=>e.dispose()),this._buffers=[]}getBuffer(e){for(const i of this._buffers)if(i.availableCount>=e)return i;if(e>c8e)return null;const r=new _4t(this._rctx,this._fieldCount);return this._buffers.push(r),r}updateTextures(){for(const e of this._buffers)e.textureBuffer.updateTexture()}};const Dbe=re.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");class v4t{constructor(e,r){this._renderManager=e,this._viewingMode=r,this._objects=[new Wt,new Wt],this._renderSubmit=new VFt(this),this._renderManager.register(this._renderSubmit),this._hasObjectAndLayerId=ue("enable-feature:objectAndLayerId-rendering"),this._componentBufferManager=new u8e(e.rctx,2+(this._hasObjectAndLayerId?1:0))}destroy(){wt(this._objects[ZR.Hidden].length===0&&this._objects[ZR.Visible].length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy()}createObject(e){const r=new XI;return r.toMapSpace=e.toMapSpace,r.transform=e.transform,r.obb=wbe(e.obb),r.components=new wFt(this._componentBufferManager,e.geometry.componentOffsets),r.renderable=this._createRenderable(e,r.components),r.intersectionGeometry=new RFt(e.geometry.positionData,r.components),this._objects[r.visible].push(r),r}destroyObject(e){const r=e;this._objects[r.visible].removeUnordered(r),r.destroy(),this._notifyDirty()}setObjectVisibility(e,r){const i=e;r!==i.visible&&(this._objects[i.visible].removeUnordered(i),this._objects[r].push(i),i.visible=r,this._notifyDirty())}preSubmit(e){const r=e.camera.eye;this.visibleObjects.forAll(i=>i.renderable.meta.cameraDepthSquared=ga(r,i.obb.center))}getMaterial(e){return e.renderable.material}updateMaterial(e,r){const i=e.renderable.material;r(i),i.dirty&&this._notifyDirty()}setAllComponentVisibilities(e,r){const i=e;i.components.visibility.reset(r),i.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(e,r){return e.components.visibility.forEachComponent(r)}getComponentCount(e){const r=e,i=r.components.visibility.componentCount();return{visible:i,invisible:r.components.count-i}}setComponentData(e,r){const i=e,n=i.renderable.material,s=i.components,o=s.materialDataBuffer,a=s.materialDataIndices,l=new jFt,c=o.textureBuffer,h=new Uint8Array(4),p=new Uint32Array(h.buffer);let f=0,m=0,g=0,_=s.verticalOffsets,b=1/0,w=-1/0,x=!1,T=!1,E=0;for(let C=0;C<s.count;C++){r(C,l),f+=+(l.externalColor[3]<1),m+=+(l.externalColorMixMode===Hs.Replace&&l.externalColor[3]===1),g+=+l.castShadows,Oke(l.externalColor,l.externalColorMixMode,h),h[2]=254&h[2]|+l.castShadows,c.setData(a[C],0,h[0],h[1],h[2],h[3]),x||(x=C>0&&E!==p[0]),E=p[0],T||(T=l.elevationOffset!==0),T&&R(_)&&(_=new Array(C).fill(0)),v(_)&&(_[C]=l.elevationOffset),b=Math.min(b,l.elevationOffset),w=Math.max(w,l.elevationOffset),t8e(l.elevationOffset,h),c.setData(a[C],1,h[0],h[1],h[2],h[3]);const A=l.objectAndLayerIdColor;v(A)&&c.setData(a[C],2,A[0],A[1],A[2],A[3]),l.pickable!==KUe(s.pickability,C)&&(s.pickability=TFt(s.pickability,s.count,C,l.pickable))}s.verticalOffsets=T?_:null,i.offsetObb=T?_Ft(i.obb,b,w,this._viewingMode,v(i.offsetObb)?i.offsetObb:wbe(i.obb)):null,x||T||this._hasObjectAndLayerId?(n.componentParameters=new YI,n.componentParameters.castShadows=kW(g,s.count),n.componentParameters.transparent=kW(f,s.count),n.componentParameters.opaqueOverride=kW(m,s.count),n.componentParameters.texture=c,c.updateTexture()):(n.componentParameters=new lL,n.componentParameters.castShadows=l.castShadows?lo.All:lo.None,n.componentParameters.externalColor=l.externalColor,n.componentParameters.externalColorMixMode=l.externalColorMixMode),this._notifyDirty()}getComponentAabb(e,r,i,n=!1){e.intersectionGeometry.getComponentAabb(r,i);const s=e,o=s.components.verticalOffsets;if(n||R(o))return i;const a=o[r];if(this._viewingMode===qe.Local||a===0)return i[2]+=a,i[5]+=a,i;const l=twt(a);return l.localOrigin=s.transform.position,l.applyToAabb(i)}getComponentObb(e){return e.obb}getObjectTransform(e){return e.transform}getComponentPositions(e,r,i){return e.intersectionGeometry.getComponentPositions(r,i)}intersect(e,r,i,n,s,o){const a=e;v(s)&&(s.localOrigin=a.transform.position);const l=Lw(Nbe,a.transform.rotationScale);Lo(Ck,r,a.transform.position),Lo(Ak,i,a.transform.position),Gl(Ck,Ck,l),Gl(Ak,Ak,l);const c=Xu(Nbe,l);return a.intersectionGeometry.intersect(Ck,Ak,n,c,s,a.components.verticalOffsets,o)}addEdges(e,r,i,n){const s=e,{indices:o,positions:a}=s.intersectionGeometry,l=s.components.offsets;return r.addComponentObject(e,s.transform,{center:s.obb.center,radius:yFt(s.obb)},a,o,l,i,n)}async extractEdgeInformation(e,r,i){const n=e,s=n.components.visibility;if(s.allInvisible())return{buffer:m4t.createBuffer(0),origin:[0,0,0]};const{indices:o,positions:a}=n.intersectionGeometry,l=n.components.offsets,c=ZV.createBuffer(a.count);L7(c.position,a),bw(c.position,c.position,n.transform.rotationScale),this._setComponentIndices(c.componentIndex,o,l);const h=c.count,p=this._computeVisibilityIndices(o,s,l,h);return{origin:On(n.transform.position),buffer:await r.extractComponentsEdgeLocations({indices:p,indicesLength:p.length,skipDeduplicate:!0,data:c,writerSettings:{reducedPrecision:!1,variants:0}},i)}}_setComponentIndices(e,r,i){let n=0;for(let s=0;s<i.length-1;s++){const o=i[s],a=i[s+1];for(let l=o;l<a;l++){const c=r?r[l]:l;e.set(c,n)}n++}}_computeVisibilityIndices(e,r,i,n){if(e&&r.allVisible())return e;let s=0;r.forEachComponentRange((l,c)=>(s+=i[c]-i[l],!0));const o=Array.isArray(e)?new Array(s):(e==null?void 0:e.BYTES_PER_ELEMENT)===2||n<=65536?new Uint16Array(s):new Uint32Array(s);let a=0;return r.forEachComponentRange((l,c)=>{const h=i[l],p=i[c];for(let f=h;f<p;f++)o[a++]=e?e[f]:f;return!0}),o}addComponentHighlight(e,r){const i=e.components;R(i.highlightCounts)&&(i.highlightCounts=new Uint32Array(i.count+1)),i.highlightCounts[r]++===0&&(i.highlightsDirty(),this._notifyDirty()),i.highlightCounts[i.count]++}removeComponentHighlight(e,r){const i=e.components;if(R(i.highlightCounts))return void Dbe.warn("Removing non-existing highlight.");const n=i.highlightCounts[r],s=i.highlightCounts[i.count];if(n!==0){if(n>1)return i.highlightCounts[r]=n-1,void(i.highlightCounts[i.count]=s-1);i.highlightCounts[r]=0,i.highlightsDirty(),this._notifyDirty(),s===1?i.highlightCounts=null:i.highlightCounts[i.count]=s-1}else Dbe.warn("Removing non-existing highlight.")}clearHighlights(e){const r=e.components;v(r.highlightCounts)&&(r.highlightCounts=null,r.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(e){return e.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects[ZR.Visible]}_createRenderable(e,r){const i=this._renderManager.rctx,n=e.geometry,s=n.vertices.layoutParameters,o=Kr.createVertex(i,zr.STATIC_DRAW,n.vertices.data),a=Fo(n.indices,_=>Kr.createIndex(i,zr.STATIC_DRAW,_)),l=eh(BFt(s)),c=new Uint16Array(n.vertices.count);for(let _=0;_<r.count;_++){const b=r.offsets[_],w=r.offsets[_+1],x=r.materialDataIndices[_];if(v(n.indices))for(let T=b;T<w;T++)c[n.indices[T]]=x;else for(let T=b;T<w;T++)c[T]=x}const h=Kr.createVertex(i,zr.STATIC_DRAW,c.buffer),p=new Eo(e.transform,e.toMapSpace),f=new Mp(i,n8e,{data:l,componentIndices:b4t},{data:o,componentIndices:h},a),m=new IFt(f,Ft.TRIANGLES,s,v(a)),g={cameraDepthSquared:.5,gpuMemoryEstimate:o.byteSize+h.byteSize+(v(a)?a.byteSize:0)};return new PFt(p,m,g)}_notifyDirty(){this._renderManager.notifyDirty()}}const b4t=eh(mn().u16(O.COMPONENTINDEX));function kW(t,e){return t===e?lo.All:t===0?lo.None:lo.Some}const Nbe=Bc(),Ck=P(),Ak=P();let h8e=class extends wi{constructor(){super(...arguments),this.opacity=1}};function w4t(t){const e=new Br;return e.include(Np),e.fragment.uniforms.add(new Dt("tex",r=>r.texture)),t.hasOpacityFactor&&e.fragment.uniforms.add(new Ie("opacity",r=>r.opacity)),e.fragment.code.add(S`
    void main() {
      gl_FragColor = texture2D(tex, uv) ${t.hasOpacityFactor?"* opacity":""};
    }`),e}const x4t=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:h8e,build:w4t},Symbol.toStringTag,{value:"Module"}));var al;(function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.PremultipliedAlpha=2]="PremultipliedAlpha",t[t.COUNT=3]="COUNT"})(al||(al={}));let lre=class extends _l{constructor(){super(...arguments),this.alphaMode=al.None,this.hasOpacityFactor=!1}};u([j({count:al.COUNT})],lre.prototype,"alphaMode",void 0),u([j()],lre.prototype,"hasOpacityFactor",void 0);let d8e=class p8e extends Wr{initializeProgram(e){return new Gr(e.rctx,p8e.shader.get().build(this.configuration),Lr)}initializePipeline(){switch(this.configuration.alphaMode){case al.None:return Ht({colorWrite:ir});case al.Alpha:return Ht({blending:mo(Ce.SRC_ALPHA,Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA,Ce.ONE_MINUS_SRC_ALPHA),colorWrite:ir});case al.PremultipliedAlpha:case al.COUNT:return Ht({blending:bm(Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA),colorWrite:ir})}}};d8e.shader=new jr(x4t,()=>Q(()=>import("./Compositing.glsl-16aef408.js"),[]));let f8e=class extends wi{};function T4t(){const t=new Br;return t.include(Np),t.fragment.uniforms.add(new Dt("tex",e=>e.texture)),t.fragment.code.add(S`void main() {
gl_FragColor = vec4(1.0 - texture2D(tex, uv).a);
}`),t}const S4t=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:f8e,build:T4t},Symbol.toStringTag,{value:"Module"}));let m8e=class g8e extends Wr{initializeProgram(e){return new Gr(e.rctx,g8e.shader.get().build(),Lr)}initializePipeline(){return Ht({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}};m8e.shader=new jr(S4t,()=>Q(()=>import("./HUDCompositing.glsl-a85c0ffb.js"),[]));let y8e=class extends wi{};function E4t(){const t=new Br;return t.include(Np),t.fragment.uniforms.add([new Dt("colorTexture",e=>e.colorTexture),new Dt("alphaTexture",e=>e.alphaTexture),new Dt("frontFaceTexture",e=>e.frontFaceTexture)]),t.fragment.code.add(S`void main() {
vec4 srcColor = texture2D(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture2D(alphaTexture, uv).r;
vec4 frontFace = texture2D(frontFaceTexture, uv);
gl_FragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`),t}const C4t=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:y8e,build:E4t},Symbol.toStringTag,{value:"Module"}));let _8e=class v8e extends Wr{initializeProgram(e){return new Gr(e.rctx,v8e.shader.get().build(),Lr)}initializePipeline(){return Ht({blending:mo(Ce.SRC_ALPHA,Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA,Ce.ONE_MINUS_SRC_ALPHA),colorWrite:ir})}};_8e.shader=new jr(C4t,()=>Q(()=>import("./OITCompositing.glsl-c0bfe335.js"),[]));let b8e=class extends wi{constructor(){super(...arguments),this.overlayIndex=dn.INNER,this.opacity=1}};function A4t(){const t=new Br;return t.include(Np),t.fragment.uniforms.add(new Dt("tex",e=>e.texture)),t.fragment.uniforms.add(new tF("overlayIdx",e=>e.overlayIndex)),t.fragment.uniforms.add(new Ie("opacity",e=>e.opacity)),t.fragment.code.add(S`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
gl_FragColor = texture2D(tex, overlayUV) * opacity;
}`),t}const R4t=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:b8e,build:A4t},Symbol.toStringTag,{value:"Module"}));let w8e=class x8e extends Wr{initializeProgram(e){return new Gr(e.rctx,x8e.shader.get().build(),Lr)}initializePipeline(){return Ht({blending:bm(Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA),colorWrite:ir})}};w8e.shader=new jr(R4t,()=>Q(()=>import("./OverlayCompositing.glsl-8ef93ac0.js"),[]));let O4t=class{constructor(e,r){this._rctx=e,this._techniqueRepository=r,this._configuration=new lre,this._passParameters=new h8e,this._oitParameters=new y8e,this._hudParameters=new f8e,this._overlayParameters=new b8e}destroy(){this._vao=rt(this._vao)}compositeOIT(e,r,i,n){this._oitParameters.colorTexture=r,this._oitParameters.alphaTexture=i,this._oitParameters.frontFaceTexture=n;const s=this._rctx,o=this._techniqueRepository.acquire(_8e);s.bindTechnique(o,this._oitParameters,e);const a=this._ensureVAO();s.bindVAO(a),s.drawArrays(Ft.TRIANGLE_STRIP,0,Da(a,"geometry")),o.release()}compositeHUD(e,r){this._hudParameters.texture=r;const i=this._rctx,n=this._techniqueRepository.acquire(m8e);i.bindTechnique(n,this._hudParameters,e);const s=this._ensureVAO();i.bindVAO(s),i.drawArrays(Ft.TRIANGLE_STRIP,0,Da(s,"geometry")),n.release()}compositeOverlay(e,r,i,n){this._overlayParameters.texture=r,this._overlayParameters.opacity=i,this._overlayParameters.overlayIndex=n;const s=this._rctx,o=this._techniqueRepository.acquire(w8e);s.bindTechnique(o,this._overlayParameters,e);const a=this._ensureVAO();s.bindVAO(a),s.drawArrays(Ft.TRIANGLE_STRIP,0,Da(a,"geometry")),o.release()}composite(e,r,i=al.None,n=1){const s=this._rctx;this._configuration.alphaMode=i,this._configuration.hasOpacityFactor=n!==1,this._passParameters.texture=r,this._passParameters.opacity=n;const o=this._techniqueRepository.acquire(d8e,this._configuration);s.bindTechnique(o,this._passParameters,e);const a=this._ensureVAO();s.bindVAO(a),s.drawArrays(Ft.TRIANGLE_STRIP,0,Da(a,"geometry")),o.release()}_ensureVAO(){return R(this._vao)&&(this._vao=vl(this._rctx)),this._vao}};const M4t=1e4,cre=100,P4t=500,I4t=500,$4t=.1;function L4t(t,e,r){return Ile(e,t)*(r[1]-r[0])+r[0]}function D4t(t,e,r){let i=0;if(!e.some(s=>(i+=s.numGeometries,i>=M4t)))return j4t.compute(t,e);const n=nF();return r.forAll(s=>{s.visible&&r3(n,N4t(t,s))}),n}function N4t(t,e){if(!e.visible)return;const r=nF(),i=e.getSpatialQueryAccelerator();return v(i)?F4t(r,t,i):k4t(r,t,e.objects),r}function F4t(t,e,r){const i=e.eye,n=e.viewForward,s=e.frustum,o=l=>l.visible,a=r.objectCount;if(a<P4t)HD(Hd,e.near,Math.min(t.near,e.far)),r.forEachInDepthRange(i,n,Xf.DepthOrder.FRONT_TO_BACK,Hd,(l,c)=>{ure(t,e,l),Hd.far=t.near,c.setRange(Hd)},s,o),HD(Hd,Math.max(t.far,e.near),e.far),r.forEachInDepthRange(i,n,Xf.DepthOrder.BACK_TO_FRONT,Hd,(l,c)=>{ure(t,e,l),Hd.near=t.far,c.setRange(Hd)},s,o);else{const l=Math.max(Math.min(a,I4t),Math.ceil(a*$4t)),c=r.findClosest(n,Xf.DepthOrder.FRONT_TO_BACK,s,o,l),h=r.findClosest(n,Xf.DepthOrder.BACK_TO_FRONT,s,o,l);c&&h&&(Fbe(t,e,c.boundingVolumeWorldSpace.bounds),Fbe(t,e,h.boundingVolumeWorldSpace.bounds))}}function k4t(t,e,r){hC.clear(),r.forAll(i=>{i.visible&&i.geometries.length!==0&&hC.add(i)}),hC.empty||(hC.sort(e),HD(Hd,e.near,Math.min(t.near,e.far)),hC.forEachInDepthRange(Hd,Xf.DepthOrder.FRONT_TO_BACK,(i,n)=>{n<t.near&&ure(t,e,i)}),HD(Hd,Math.max(t.far,e.near),e.far),hC.forEachInDepthRange(Hd,Xf.DepthOrder.BACK_TO_FRONT,(i,n,s)=>{t.far=Math.max(t.far,s)}))}function ure(t,e,r){if(!r.visible||!bb(e.frustum,r.boundingVolumeWorldSpace.bounds))return;const i=r.transformation,n=B4t;r.geometries.forEach(s=>{Mn(n,i,s.shaderTransformation);const o=p2(n);T8e(t,e,s.boundingInfo,n,o)})}function T8e(t,e,r,i,n){if(R(r))return;Ke(Oa,r.center,i);const{eye:s,viewForward:o}=e,a=o[0]*(Oa[0]-s[0])+o[1]*(Oa[1]-s[1])+o[2]*(Oa[2]-s[2]);if(Oa[3]=r.radius*n,!(a-Oa[3]>t.near&&a+Oa[3]<t.far)&&bb(e.frustum,Oa))if(r.radius>cre&&r.getChildren())for(const l of r.getChildren())T8e(t,e,l,i,n);else hre.unionDepthRangeWithAABB(t,e.viewProjectionMatrix,i,r.bbMin,r.bbMax)}function Fbe(t,e,r){const i=e.eye,n=e.viewForward,s=(r[0]-i[0])*n[0]+(r[1]-i[1])*n[1]+(r[2]-i[2])*n[2];t.near=Math.min(t.near,s-r[3]),t.far=Math.max(t.far,s+r[3])}class U4t{constructor(){this._items=new Wt({allocator:e=>e||{obj:null,distance:0,near:0,far:0},deallocator:e=>(e.obj=null,e.distance=0,e.near=0,e.far=0,e)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(e){this._items.pushNew().obj=e}sort(e){const r=e.eye,i=e.viewForward;this._items.forAll(n=>{const s=n.obj.boundingVolumeWorldSpace.bounds,o=(s[0]-r[0])*i[0]+(s[1]-r[1])*i[1]+(s[2]-r[2])*i[2];n.distance=o,n.near=o-s[3],n.far=o+s[3]}),this._items.sort((n,s)=>n.distance-s.distance)}forEachInDepthRange(e,r,i){if(r===Xf.DepthOrder.FRONT_TO_BACK)for(let n=0;n<this._items.length;++n){const s=this._items.data[n];s.far<e.near||s.near>e.far||i(s.obj,s.near,s.far)}else for(let n=this._items.length-1;n>=0;--n){const s=this._items.data[n];s.far<e.near||s.near>e.far||i(s.obj,s.near,s.far)}}}let z4t=class{constructor(){this._view=$e(),this._viewProj=$e(),this._frustum=_D(),this._geometries=new Array,this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._looseRange={near:0,far:0}}compute(e,r){this._reset(),po(this._view,e.viewMatrix),Mn(this._viewProj,e.projectionMatrix,this._view),iV(this._frustum,e.frustum);const i=this._view,n=i[2],s=i[6],o=i[10],a=i[14];r.forAll(f=>f.forEachGeometry(m=>{if(!m.visible||!m.castShadow)return;let g;m.hasShaderTransformation?(m.computeBoundingSphere(m.shaderTransformation,Oa,1),g=Oa):g=m.boundingSphere;const _=n*g[0]+s*g[1]+o*g[2]+a,b=_-g[3],w=_+g[3];this._geometries.push(m),this._near.push(-w),this._far.push(-b)}));const l=new $Ft;if(this._geometries.length===0)return l;for(let f=0;f<this._geometries.length;++f)this._near[f]>l.far&&(l.far=this._near[f]),this._near[f]>2&&this._far[f]<l.near&&(l.near=this._far[f]);const c=this._looseRange;c.near=Math.max(.5*l.near,2),c.far=2*l.far;let h=0,p=0;for(let f=0;f<this._geometries.length;++f)this._near[f]<l.near&&(this._near[f]>=c.near?l.near=this._near[f]:this._nearCandidates[h++]=f),this._far[f]>l.far&&(this._far[f]<=c.far?l.far=this._far[f]:this._farCandidates[p++]=f);if(this._nearCandidates.length===0&&this._farCandidates.length===0)return l;this._nearCandidates.sort((f,m)=>this._near[f]<this._near[m]?-1:this._near[f]>this._near[m]?1:0),this._farCandidates.sort((f,m)=>this._far[f]<this._far[m]?1:this._far[f]>this._far[m]?-1:0);for(let f=0;f<this._nearCandidates.length;++f){const m=this._nearCandidates[f];if(this._near[m]<l.near){const g=this._geometries[m],_=g.boundingInfo;this._includeNearBoundingInfoRec(_,g.shaderTransformation,l)}}for(let f=0;f<this._farCandidates.length;++f){const m=this._farCandidates[f];if(this._far[m]>l.far){const g=this._geometries[m],_=g.boundingInfo;this._includeFarBoundingInfoRec(_,g.shaderTransformation,l)}}return this._reset(),l}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0}_includeNearBoundingInfoRec(e,r,i){if(R(e))return;const n=e.center;Ke(Oa,n,r);const s=p2(r),o=Oa[0],a=Oa[1],l=Oa[2],c=e.radius*s,h=this._frustum;if(h[0][0]*o+h[0][1]*a+h[0][2]*l+h[0][3]>c||h[1][0]*o+h[1][1]*a+h[1][2]*l+h[1][3]>c||h[2][0]*o+h[2][1]*a+h[2][2]*l+h[2][3]>c||h[3][0]*o+h[3][1]*a+h[3][2]*l+h[3][3]>c)return;const p=this._view[2]*o+this._view[6]*a+this._view[10]*l+this._view[14],f=p+c;if(!(-(p-c)<2||-f>=i.near))if(-f>this._looseRange.near)i.near=-f;else{if(c>cre){const m=e.getChildren();if(m!==void 0){for(const g of m)this._includeNearBoundingInfoRec(g,r,i);return}}hre.unionDepthRangeWithAABB(i,this._viewProj,r,e.bbMin,e.bbMax)}}_includeFarBoundingInfoRec(e,r,i){if(R(e))return;let n=e.radius;const s=e.center;Ke(Oa,s,r);const o=p2(r),a=Oa[0],l=Oa[1],c=Oa[2];n*=o;const h=this._frustum;if(h[0][0]*a+h[0][1]*l+h[0][2]*c+h[0][3]>n||h[1][0]*a+h[1][1]*l+h[1][2]*c+h[1][3]>n||h[2][0]*a+h[2][1]*l+h[2][2]*c+h[2][3]>n||h[3][0]*a+h[3][1]*l+h[3][2]*c+h[3][3]>n)return;const p=this._view[2]*a+this._view[6]*l+this._view[10]*c+this._view[14]-n;if(!(-p<=i.far))if(-p<this._looseRange.far)i.far=-p;else{if(n>cre){const f=e.getChildren();if(f!==void 0){for(const m of f)this._includeFarBoundingInfoRec(m,r,i);return}}hre.unionDepthRangeWithAABB(i,this._viewProj,r,e.bbMin,e.bbMax)}}},V4t=class{constructor(){this._modelViewProj=$e(),this._clipPosition=[pr(),pr(),pr(),pr(),pr(),pr(),pr(),pr()]}unionDepthRangeWithAABB(e,r,i,n,s){const o=this._modelViewProj;Mn(o,r,i);let a=!1;for(let l=0;l<8;++l){const c=this._clipPosition[l],h=l===0||l===3||l===4||l===7?n[0]:s[0],p=l===0||l===1||l===4||l===5?n[1]:s[1],f=l<4?n[2]:s[2];c[0]=o[0]*h+o[4]*p+o[8]*f+o[12],c[1]=o[1]*h+o[5]*p+o[9]*f+o[13],c[2]=o[2]*h+o[6]*p+o[10]*f+o[14],c[3]=o[3]*h+o[7]*p+o[11]*f+o[15]}for(let l=0;l<12;++l){const c=this._clipPosition[UW[l][0]],h=this._clipPosition[UW[l][1]],p=this._clipPosition[UW[l][2]],f=this._clipTriangle(c,h,p);let m=!0;for(let g=0;g<f.length;++g)if(f[g][3]>=2){m=!1;break}if(!m){a=!0;for(let g=0;g<f.length;++g){const _=f[g][3];Number.isFinite(_)&&(e.near=Math.min(_,e.near),e.far=Math.max(_,e.far))}}}return a}_inside(e,r){return r===0?e[0]>=-e[3]:r===1?e[1]>=-e[3]:r===2?e[0]<=e[3]:r===3?e[1]<=e[3]:void wt(!1)}_intersect(e,r,i){let n=0;return i===0?n=(-e[3]-e[0])/(r[0]-e[0]+r[3]-e[3]):i===1?n=(-e[3]-e[1])/(r[1]-e[1]+r[3]-e[3]):i===2?n=(e[3]-e[0])/(r[0]-e[0]-r[3]+e[3]):i===3&&(n=(e[3]-e[1])/(r[1]-e[1]-r[3]+e[3])),F9(pr(),e,r,n)}_clipTriangle(e,r,i){let n=[e,r,i];for(let s=0;s<4;++s){const o=n;n=[];for(let a=0;a<o.length;++a){const l=o[a],c=o[(a+1)%o.length];this._inside(c,s)?(this._inside(l,s)||n.push(this._intersect(l,c,s)),n.push(c)):this._inside(l,s)&&n.push(this._intersect(l,c,s))}}return n}};const UW=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],Oa=Os(),B4t=$e(),Hd=nF(),hC=new U4t,j4t=new z4t,hre=new V4t;let G4t=class{},H4t=class extends wi{constructor(){super(...arguments),this.textures=new G4t}};function q4t(){const t=new Br;return t.attributes.add(O.POSITION,"vec2"),t.vertex.uniforms.add(new br("drawPosition",(e,r)=>W4t(e,r))),t.varyings.add("vUV","vec2"),t.vertex.code.add(S`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),t.fragment.uniforms.add(new Dt("textureInput",e=>e.textures.input)),t.fragment.uniforms.add(new Dt("textureMask",e=>e.textures.mask)),t.fragment.uniforms.add(new Dt("textureOverlay",e=>e.textures.overlay)),t.fragment.uniforms.add(new s_("maskEnabled",e=>e.magnifier.maskEnabled)),t.fragment.uniforms.add(new s_("overlayEnabled",e=>e.magnifier.overlayEnabled)),t.fragment.code.add(S`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture2D(textureMask, vUV).a : 1.0;
vec4 inputColor = texture2D(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture2D(textureOverlay, vUV) : vec4(0);
gl_FragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),t}function W4t(t,e){const r=e.camera.pixelRatio,i=t.magnifier.offset.x*r,n=t.magnifier.offset.y*r;Og(t.magnifier.position,kbe);const s=e.camera.screenToRender(kbe,X4t),o=Math.ceil(r*t.magnifier.size),a=e.camera.fullWidth,l=e.camera.fullHeight;return ai(Y4t,(s[0]+i)/a*2-1,(s[1]-n)/l*2-1,o/a*2,o/l*2)}const kbe=wn(),X4t=nCe(),Y4t=pr();async function Z4t(t){const e=Q(()=>import("./mask-svg-023bbc42.js"),[]),r=Q(()=>import("./overlay-svg-d62383f3.js"),[]),i=O_((await e).default,{signal:t}),n=O_((await r).default,{signal:t}),s={mask:await i,overlay:await n};return lr(t),s}let vA=class extends be{constructor(){super(...arguments),this._handles=new qr,this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this._passParameters=new H4t,this.events=new Sn,this.attributeLocations=new Map([[O.POSITION,0]]),this._tmpScreenPoint=wn(),this._tmpRenderPoint=nCe()}get updating(){return R(this._imageSources)&&v(this._imageLoadTask)&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(e){if(e===this._magnifier)return;this._handles.removeAll(),this._magnifier=e;const r=()=>{this._updateResourceLoading(),this.events.emit("request-render")};v(this._magnifier)&&this._handles.add(ne(()=>Fo(this._magnifier,i=>i.version),r)),r()}get enabled(){return v(this._validMagnifier)}get _validMagnifier(){return v(this._magnifier)&&this._magnifier.visible&&v(this._magnifier.position)&&this._magnifier.size>0?this._magnifier:null}get _factor(){return v(this._magnifier)&&this._magnifier.factor||1}destroy(){this._magnifier=null,this._handles.destroy(),v(this._imageLoadTask)&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeResources()}render(e,r){const i=this._validMagnifier;if(R(i))return;const n=r.camera.pixelRatio,s=Math.ceil(n*i.size);if(this._updateResources(e,s),R(this._resources))return;const o=this._passParameters.textures,a=Math.ceil(1/this._factor*s);o.input.resize(a,a),Og(i.position,this._tmpScreenPoint);const l=r.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),c=r.camera.fullWidth,h=r.camera.fullHeight,p=.5*a,f=.5*a;l[0]=_e(l[0],p,c-p-1),l[1]=_e(l[1],f,h-f-1);const m=Math.floor(l[0]-p),g=Math.floor(l[1]-f),_=this._resources.program;_.bindTexture("textureInput",o.input),e.gl.copyTexImage2D(o.input.descriptor.target,0,o.input.descriptor.pixelFormat,m,g,a,a,0),this._passParameters.magnifier=i,e.useProgram(_),_.bindPass(this._passParameters,r),e.bindVAO(this._resources.vao),e.setPipelineState(this._resources.pipelineState),e.drawArrays(Ft.TRIANGLE_STRIP,0,4)}_updateResourceLoading(){const e=this._validMagnifier;if(R(e))return;const r=e.maskUrl,i=e.overlayUrl;!v(this._imageLoadTask)||this._imageLoadTask.maskUrl===r&&this._imageLoadTask.overlayUrl===i||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),v(this._imageSources)||v(this._imageLoadTask)||(this._imageLoadTask={maskUrl:r,overlayUrl:i,task:EN(async n=>{const s=R(r)||R(i)?Z4t(n):null,o=v(r)?O_(r,{signal:n}):s.then(l=>l.mask),a=v(i)?O_(i,{signal:n}):s.then(l=>l.overlay);this._imageSources={mask:await o,overlay:await a},this._disposeResources(),this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}_updateResources(e,r){if(!this.enabled)return void this._disposeResources();if(v(this._resources)){if(this._passParameters.textures.size!==r){const n=this._createTextureResources(e,r);if(R(n))return void this._disposeResources();this._disposeTextureResources(this._passParameters.textures),this._passParameters.textures=n}return}const i=this._createTextureResources(e,r);R(i)||(this._resources={program:this._createProgram(e),vao:vl(e,Cae,this.attributeLocations,0,1),pipelineState:Ht({blending:bm(Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:ir})},this._passParameters.textures=i)}_disposeResources(){R(this._resources)||(this._disposeTextureResources(this._passParameters.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(e){e.mask.dispose(),e.overlay.dispose(),e.input.dispose()}_createTextureResources(e,r){if(R(this._imageSources))return null;this._imageSources.overlay.width=r,this._imageSources.overlay.height=r,this._imageSources.mask.width=r,this._imageSources.mask.height=r;const i=new mt(e,{target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,internalFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE,samplingMode:it.LINEAR,flipped:!0,preMultiplyAlpha:!ICe(this._imageSources.overlay.src)||!e.driverTest.svgPremultipliesAlpha.result},this._imageSources.overlay),n=new mt(e,{target:Ct.TEXTURE_2D,pixelFormat:Ge.ALPHA,internalFormat:Ge.ALPHA,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE,samplingMode:it.LINEAR,flipped:!0},this._imageSources.mask);return{input:new mt(e,{target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,internalFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE,samplingMode:it.LINEAR,flipped:!1}),mask:n,overlay:i,size:r}}_createProgram(e){return new Gr(e,q4t(),this.attributeLocations)}};u([d()],vA.prototype,"_imageSources",void 0),u([d()],vA.prototype,"_imageLoadTask",void 0),u([d({readOnly:!0})],vA.prototype,"updating",null),vA=u([$("esri/views/3d/webgl-engine/lib/MagnifierHelper")],vA);let J4t=class{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new gl(new ArrayBuffer(4)),this._uidToRenderColor=new Map,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new Map,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(e,r,i,n,s,o=null,a=null,l=null){if(!(e&&r&&i&&n)||(this._layerUidToId.set(n,i),this._layerUidToPopupEnabled.set(n,s),!s))return;let c=this._layerUidToGraphicsUidToObjectId.get(n);c||(c=new Map,this._layerUidToGraphicsUidToObjectId.set(n,c)),c.set(r,{objectId:e,attributeNodeId:o,attributeIndex:a,subLayerId:l})}getObjectAndLayerIdColor(e){const r=this.getObjectAndLayerIdColorArray(e);return Zt(r.get(0,1),r.get(0,2),r.get(0,3),255)}getObjectAndLayerIdColorArray(e){if(!e.layerUid||!e.graphicUid)return this.colorZero;const r=this._layerUidToPopupEnabled.get(e.layerUid);if(r===void 0)return re.getLogger(this.declaredClass).warn("popupEnabled is undefined for layerUid "+e.layerUid),this.colorZero;if(r===!1)return this.colorZero;let i=this._uidToRenderColor.get(e.layerUid);i||(i=new Map,this._uidToRenderColor.set(e.layerUid,i));let n=i.get(e.graphicUid);if(!n){for(;!n;){const o=Math.floor(16777214*Math.random())+1;this._colorToUID.has(o)||(n=o)}if(n>16777215)throw new Error("Object ID Overflow");i.set(e.graphicUid,n),this._colorToUID.set(n,e)}const s=new ArrayBuffer(4);return new DataView(s).setUint32(0,n,!1),new gl(s)}getColorToObjectAndLayerIdMapping(){const e=new Map;for(const[r,i]of this._colorToUID.entries()){const n=this._layerUidToGraphicsUidToObjectId.get(i.layerUid);let s=null;n?(s=n.get(i.graphicUid),s||re.getLogger(this.declaredClass).warn("getColorMapping: no entry found for graphicsId "+i.graphicUid)):re.getLogger(this.declaredClass).warn("getColorMapping: no entry found for layerUid "+i.layerUid);const o=this._layerUidToId.get(i.layerUid);o||re.getLogger(this.declaredClass).warn("no layerId found for uid "+i.layerUid),s&&o&&e.set(r,s.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:s.objectId,lid:o,attrId:s.attributeNodeId,attrIdx:s.attributeIndex,subLayerId:s.subLayerId}:{type:"object-and-layer-id",oid:s.objectId,lid:o})}return e}};var qD;(function(t){t[t.FrontToBack=0]="FrontToBack",t[t.BackToFront=1]="BackToFront"})(qD||(qD={}));let Gv=class{constructor(e,r,i=qD.FrontToBack){this._rctx=e,this._techniqueRepository=r,this._sorting=i,this._draws=new Wt({initialSize:32,allocator:n=>n||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(e,r,i,n){const s=this._draws.pushNew();s.geometry=r,s.geometryRanges=i,s.material=e,s.depthSquaredHint=n,s.indexType=(r.indexed?r.vao.indexBuffer.indexType:null)??0}dispatch(e,r){const i=this._rctx;this._previouslyBoundDraw.clear();let n=null;const s=this._draws.map(a=>a.material.prepareTechnique(this._techniqueRepository,e,r,a.geometry.parameters)),o=this._draws.length;for(let a=0;a<o;a++){const l=s[a];l===n&&l.configuration.transparencyPassType===At.NONE||(i.bindTechnique(l,e,r),n=l);const c=this._draws.data[a],h=c.geometry;i.bindVAO(h.vao),this._previouslyBoundDraw.get(l)!==c.material&&(l.program.bindDraw(c.material,r,e),this._previouslyBoundDraw.set(l,c.material));const p=c.geometryRanges,f=p.length;if(c.indexType!==0){const m=JU.get(c.indexType);for(let g=0;g<f;g+=2){const _=p[g],b=p[g+1];i.drawElements(h.primitiveType,b,c.indexType,_*m)}}else for(let m=0;m<f;m+=2){const g=p[m],_=p[m+1];i.drawArrays(h.primitiveType,g,_)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const e=this._sorting===qD.FrontToBack?1:-1;this._draws.sort((r,i)=>{const n=e*(r.depthSquaredHint-i.depthSquaredHint);return n!==0?n:r.geometry.vao.size-i.geometry.vao.size})}get count(){return this._draws.length}};const JU=new Map;JU.set(ft.UNSIGNED_BYTE,1),JU.set(ft.UNSIGNED_SHORT,2),JU.set(ft.UNSIGNED_INT,4);let K4t=class{constructor(e,r){this.rctx=e,this.shaderTechniqueRepository=r,this.canRender=!0,this._materialPassParameters=new VDt,this._shadowPassParameters=new BDt,this._highlightPassParameters=new jDt,this._systems=new Set,this._passes={materialOpaque:new Gv(e,r),materialTransparent:new Gv(e,r,qD.BackToFront),materialIntegratedMesh:new Gv(e,r),shadowMap:new Gv(e,r),highlight:new Gv(e,r),highlightIntegratedMesh:new Gv(e,r),highlightShadowMap:new Gv(e,r),defaultShadowMap:new Gv(e,r)}}register(e){this._systems.add(e)}prepareRender(e){if(this._systems.size!==0){for(const r of Object.values(this._passes))r.prepareSubmit();this._systems.forEach(r=>r.submit(this._passes,e.bindParameters));for(const r of Object.values(this._passes))r.finishSubmit();this.shaderTechniqueRepository.frameUpdate()}}render(e){if(this._systems.size!==0)switch(this._configure(e),this._materialPassParameters.output=e.output,e.bindParameters.slot){case Ee.OPAQUE_MATERIAL:switch(e.output){case V.Color:case V.Depth:case V.Normal:return this._passes.materialOpaque.dispatch(this._materialPassParameters,e.bindParameters);case V.Highlight:return this._passes.highlight.dispatch(this._highlightPassParameters,e.bindParameters);case V.Shadow:return this._passes.shadowMap.dispatch(this._shadowPassParameters,e.bindParameters);case V.ShadowHighlight:return this._passes.highlightShadowMap.dispatch(this._shadowPassParameters,e.bindParameters);case V.ShadowExcludeHighlight:return this._passes.defaultShadowMap.dispatch(this._shadowPassParameters,e.bindParameters);case V.ObjectAndLayerIdColor:return this._passes.materialOpaque.dispatch(this._materialPassParameters,e.bindParameters)}return;case Ee.TRANSPARENT_MATERIAL:switch(e.output){case V.Color:case V.Alpha:case V.Depth:case V.Normal:case V.ObjectAndLayerIdColor:return this._passes.materialTransparent.dispatch(this._materialPassParameters,e.bindParameters)}return;case Ee.INTEGRATED_MESH:switch(e.output){case V.Color:case V.Depth:case V.Normal:return this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,e.bindParameters);case V.Highlight:return this._passes.highlightIntegratedMesh.dispatch(this._highlightPassParameters,e.bindParameters);case V.ObjectAndLayerIdColor:return this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,e.bindParameters)}return}}notifyDirty(){this._context.requestRender()}slots(){return[Ee.OPAQUE_MATERIAL,Ee.TRANSPARENT_MATERIAL,Ee.INTEGRATED_MESH]}initializeRenderContext(e){this._context=e}uninitializeRenderContext(){}queryDepthRange(e){const r={near:1/0,far:-1/0};return this._systems.forEach(i=>{const n=i.queryShadowCasterDepthRange(e);v(n)&&r3(r,n,r)}),r}_configure(e){const r=e.output===V.Shadow||e.output===V.ShadowHighlight||e.output===V.ShadowExcludeHighlight?this._shadowPassParameters:e.output===V.Highlight?this._highlightPassParameters:this._materialPassParameters;this._updateParameters(e,r)}_updateParameters(e,r){const i=e.bindParameters.camera,n=i.viewInverseTransposeMatrix;he(zW,n[3],n[7],n[11]),VW.set(zW),ce(r.transformWorldFromViewTH,VW.high),ce(r.transformWorldFromViewTL,VW.low),ce(r.slicePlaneLocalOrigin,zW),Op(r.transformViewFromCameraRelativeRS,i.viewMatrix),po(r.transformProjFromView,i.projectionMatrix),r.identifier===$u.Material&&(this._materialPassParameters.transparent=e.bindParameters.slot===Ee.TRANSPARENT_MATERIAL,this._materialPassParameters.integratedMesh=e.bindParameters.slot===Ee.INTEGRATED_MESH,Xu(Ube,r.transformViewFromCameraRelativeRS),Lw(r.transformNormalViewFromGlobal,Ube))}get needsHighlight(){return this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0}get needsTransparentPass(){return this._passes.materialTransparent.count>0}};const zW=P(),Ube=vi(),VW=new j7;let Q4t=class{constructor(){this._step=Bbe,this._dilation=1,this._firstIdleTime=0}frame(e,r){if(r?this._firstIdleTime===0&&(this._firstIdleTime=performance.now()):this._firstIdleTime=0,ue("enable-feature:high-quality-idle")){const n=r?performance.now()-this._firstIdleTime:0;if(n>=zbe+t5t)return this._step=1/0,void(this._dilation=1);this._dilation=n>=zbe?r5t:1}else this._dilation=1;const i=_e(e/e5t,Bbe,n5t);this._step===1/0?this._step=i:this._step=this._step*Vbe+i*(1-Vbe)}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=0}};const e5t=.5,zbe=6e4,t5t=5e3,r5t=10,Vbe=.9,i5t=30,Bbe=1e3/1,n5t=1e3/i5t,s5t=8.6,o5t=.4;function a5t(){const t=new Br,{vertex:e,fragment:r}=t,i=e.code,n=r.code;return t.attributes.add(O.POSITION,"vec2"),t.varyings.add("uv","vec2"),t.attributes.add(O.UV0,"vec2"),e.uniforms.add(new Dt("coverageTex",s=>s.coverageTexture)),i.add(S`void main() {
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),r.uniforms.add(new Dt("tex",s=>s.blurColorTexture)),r.uniforms.add(new Dt("origin",s=>s.highlightColorTexture)),r.uniforms.add(new br("uColor",s=>s.color)),r.uniforms.add(new br("haloColor",s=>s.haloColor)),r.uniforms.add(new br("opacities",s=>ai(l5t,s.haloOpacity,s.haloOpacityOccluded,s.fillOpacity,s.fillOpacityOccluded))),r.constants.add("outlineSize","float",s5t),r.constants.add("blurSize","float",o5t),n.add(S`void main() {
vec4 blurredHighlightValue = texture2D(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture2D(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
gl_FragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),t}const l5t=pr(),c5t=Object.freeze(Object.defineProperty({__proto__:null,build:a5t},Symbol.toStringTag,{value:"Module"}));let S8e=class E8e extends Wr{initializeProgram(e){return new Gr(e.rctx,E8e.shader.get().build(),Lr)}initializePipeline(){return Ht({blending:mo(Ce.SRC_ALPHA,Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA,Ce.ONE_MINUS_SRC_ALPHA),colorWrite:ir})}};S8e.shader=new jr(c5t,()=>Q(()=>import("./HighlightApply.glsl-319c19c1.js"),[]));let C8e=class extends wi{constructor(){super(...arguments),this.blurSize=Ne()}};function u5t(){const t=new Br,{vertex:e,fragment:r}=t,i=e.code,n=r.code;return t.attributes.add(O.POSITION,"vec2"),t.attributes.add(O.UV0,"vec2"),t.varyings.add("blurCoordinate","vec3"),e.uniforms.add(new Dt("coverageTex",s=>s.coverageTexture)),r.uniforms.add(new gD("blurSize",s=>s.blurSize)),i.add(S`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
}`),r.uniforms.add(new zN("tex",s=>s.blurInputTexture)),n.add(S`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture2D(tex, uv);
if (blurCoordinate.z == 1.0) {
gl_FragColor = center;
} else {
vec4 sum = vec4(0.0);
sum += center * 0.204164;
sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;
gl_FragColor = sum;
}
}`),t}const h5t=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:C8e,build:u5t},Symbol.toStringTag,{value:"Module"}));let A8e=class R8e extends Wr{initializeProgram(e){return new Gr(e.rctx,R8e.shader.get().build(),Lr)}initializePipeline(){return Ht({colorWrite:ir})}};A8e.shader=new jr(h5t,()=>Q(()=>import("./HighlightBlur.glsl-10bd327c.js"),[]));let O8e=class extends wi{constructor(){super(...arguments),this.invFramebufferDim=Ne()}};function d5t(){const t=new Br,{vertex:e,fragment:r}=t,i=e.code,n=r.code;return t.attributes.add(O.POSITION,"vec2"),i.add(S`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`),r.uniforms.add(new zN("tex",s=>s.inputTexture)),r.uniforms.add(new gD("invFramebufferDim",s=>s.invFramebufferDim)),n.add(S`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture2D(tex, coord);
float mx = floor(max(value.g, value.b));
gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`),t}const p5t=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:O8e,build:d5t},Symbol.toStringTag,{value:"Module"}));let M8e=class P8e extends Wr{initializeProgram(e){return new Gr(e.rctx,P8e.shader.get().build(),Lr)}initializePipeline(){return Ht({colorWrite:ir})}};M8e.shader=new jr(p5t,()=>Q(()=>import("./HighlightDownsample.glsl-3e0f932b.js"),[]));let jbe=class extends wi{constructor(){super(...arguments),this.color=gm(1,0,1,1),this.haloColor=gm(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.shadowColor=Zt(1,0,1,1),this.shadowOpacity=.15,this.occludedShadowOpacity=.075}};const f5t=32;let m5t=class{constructor(e,r){this._techniqueRep=e,this._rctx=r,this._viewportToRestore=pr(),this._passParameters=new jbe,this._downsampleDrawParameters=new O8e,this._blurDrawParameters=new C8e,this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0}}_assertResources(){if(this._quadVAO)return;this._quadVAO=vl(this._rctx);const e={colorTarget:xn.TEXTURE,depthStencilTarget:Ur.NONE,width:0,height:0},r={target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:it.LINEAR,wrapMode:$t.CLAMP_TO_EDGE,width:0,height:0};this._blur0Fbo=new Jn(this._rctx,e,r),this._blur1Fbo=new Jn(this._rctx,e,r),this._blurTechnique=this._techniqueRep.acquire(A8e),this._downsampleTechnique=this._techniqueRep.acquire(M8e),this._applyTechnique=this._techniqueRep.acquire(S8e)}dispose(){if(this._blurTechnique=en(this._blurTechnique),this._downsampleTechnique=en(this._downsampleTechnique),this._applyTechnique=en(this._applyTechnique),this._grid.coverageMipmap)for(let e=1;e<this._grid.coverageMipmap.length;e++)this._grid.coverageMipmap[e].dispose();this._grid.vao&&this._grid.vao.dispose(!0),this._quadVAO&&(this._quadVAO.dispose(!0),this._quadVAO=null),this._blur0Fbo=rt(this._blur0Fbo),this._blur1Fbo=rt(this._blur1Fbo)}setDefaultOptions(e){this._passParameters={...new jbe,...e}}render(e,r,i){this._passParameters.highlightColorTexture=r.colorTexture,this._assertResources();const n=e.camera;Vf(this._viewportToRestore,n.fullViewport);const s=n.fullWidth,o=n.fullHeight,a=n.pixelRatio,l=Math.ceil(s/a),c=Math.ceil(o/a);this._blur0Fbo.resize(l,c),this._blur1Fbo.resize(l,c);const h=this._rctx;h.bindVAO(this._quadVAO);let p=null;this._gridUpdateResources(r,f5t),this._gridComputeMipmap(e),this._passParameters.coverageTexture=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,p=this._grid.vao;const f=h.bindTechnique(this._blurTechnique,this._passParameters,e);h.bindVAO(p),h.bindFramebuffer(this._blur0Fbo),h.setViewport(0,0,l,c),h.setClearColor(0,0,0,0),h.clear(Hi.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=r.colorTexture,dt(this._blurDrawParameters.blurSize,1/l,0),f.bindDraw(this._blurDrawParameters,e,this._passParameters),h.drawArrays(this._blurTechnique.primitiveType,0,Da(p,"geometry")),h.bindFramebuffer(this._blur1Fbo),h.clear(Hi.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=this._blur0Fbo.colorTexture,dt(this._blurDrawParameters.blurSize,0,1/c),f.bindDraw(this._blurDrawParameters,e,this._passParameters),h.drawArrays(this._blurTechnique.primitiveType,0,Da(p,"geometry")),h.bindFramebuffer(i),h.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3]),this._passParameters.blurColorTexture=this._blur1Fbo.colorTexture,h.bindTechnique(this._applyTechnique,this._passParameters,e),h.drawArrays(this._applyTechnique.primitiveType,0,Da(p,"geometry")),h.bindVAO(null)}_gridUpdateResources(e,r){const i=this._rctx,n=this._grid;let s=!1;if(n.coverageMipmap===null&&(n.coverageMipmap=[e],s=!0),n.viewportWidth===e.width&&n.viewportHeight===e.height||(s=!0,n.viewportWidth=e.width,n.viewportHeight=e.height),n.coverageMipmap[0]=e,n.cellPixelSize!==r&&(n.cellPixelSize=r,s=!0),s){for(let l=1;l<n.coverageMipmap.length;l++)n.coverageMipmap[l].dispose();n.mipmapLevels=Math.ceil(Math.log(n.cellPixelSize)*Math.LOG2E),n.coverageMipmap.length=n.mipmapLevels+1;for(let l=0;l<n.mipmapLevels;l++){const c=n.coverageMipmap[l],h={target:Ct.TEXTURE_2D,pixelFormat:Ge.RGB,dataType:kt.UNSIGNED_SHORT_5_6_5,samplingMode:it.LINEAR,wrapMode:$t.CLAMP_TO_EDGE,width:Math.ceil(c.width/2),height:Math.ceil(c.height/2)},p={colorTarget:xn.TEXTURE,depthStencilTarget:Ur.NONE,width:Math.ceil(c.width/2),height:Math.ceil(c.height/2)};n.coverageMipmap[l+1]=new Jn(i,p,h)}}const o=Math.ceil(e.height/n.cellPixelSize),a=Math.ceil(e.width/n.cellPixelSize);if(!n.vao||n.verticalCellCount!==o||n.horizontalCellCount!==a){n.verticalCellCount=o,n.horizontalCellCount=a;const l=o+1,c=a+1,h=1/o,p=1/a,f=6,m=4,g=new Float32Array(f*m*l*c);let _=0;for(let b=0;b<l;b++)for(let w=0;w<c;w++)g[_+0]=(w-.5)*p*2-1,g[_+1]=(b-.5)*h*2-1,g[_+2]=w*p,g[_+3]=b*h,g[_+4]=(w+.5)*p*2-1,g[_+5]=(b-.5)*h*2-1,g[_+6]=w*p,g[_+7]=b*h,g[_+8]=(w-.5)*p*2-1,g[_+9]=(b+.5)*h*2-1,g[_+10]=w*p,g[_+11]=b*h,g[_+12]=(w-.5)*p*2-1,g[_+13]=(b+.5)*h*2-1,g[_+14]=w*p,g[_+15]=b*h,g[_+16]=(w+.5)*p*2-1,g[_+17]=(b-.5)*h*2-1,g[_+18]=w*p,g[_+19]=b*h,g[_+20]=(w+.5)*p*2-1,g[_+21]=(b+.5)*h*2-1,g[_+22]=w*p,g[_+23]=b*h,_+=f*m;n.vao&&n.vao.dispose(!0),n.vao=new wm(i,Lr,{geometry:$3},{geometry:Kr.createVertex(i,zr.STATIC_DRAW,g)})}}_gridComputeMipmap(e){const r=this._rctx,i=this._grid,n=r.bindTechnique(this._downsampleTechnique,this._passParameters,e);r.bindVAO(this._quadVAO);for(let s=0;s<i.mipmapLevels;s++){r.bindFramebuffer(i.coverageMipmap[s+1]);const o=i.coverageMipmap[s+1].width,a=i.coverageMipmap[s+1].height;this._downsampleDrawParameters.inputTexture=i.coverageMipmap[s].colorTexture,dt(this._downsampleDrawParameters.invFramebufferDim,1/o,1/a),n.bindDraw(this._downsampleDrawParameters,e,this._passParameters),r.setViewport(0,0,o,a),r.drawArrays(Ft.TRIANGLE_STRIP,0,Da(this._quadVAO,"geometry"))}}get gpuMemoryUsage(){let e=(v(this._blur0Fbo)?this._blur0Fbo.gpuMemoryUsage:0)+(v(this._blur1Fbo)?this._blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const r of this._grid.coverageMipmap)e+=r.gpuMemoryUsage;return e}get test(){return{coverage:this._grid.coverageMipmap,blur:[this._blur0Fbo,this._blur1Fbo]}}};const g5t={dataType:kt.UNSIGNED_BYTE,internalFormat:Ge.RGBA},y5t={};let _5t=class{constructor(e){this._rctx=e,this._activeTargets=new Set,this._depthTextures=new Map,this._depthBuffers=new Map,this._colorTextures=new Map,this._framebuffers=new Map,this.depthTextureSupported=e.capabilities.depthTexture}dispose(){this._depthBuffers.forEach(e=>e.dispose()),this._depthBuffers.clear(),this._depthTextures.forEach(e=>e.dispose()),this._depthTextures.clear(),this._colorTextures.forEach(e=>e.dispose()),this._colorTextures.clear(),this._framebuffers.forEach(e=>e.dispose()),this._framebuffers.clear(),this._activeTargets.clear()}disposeTargetResource(e){const r=e.id;this._activeTargets.has(r)&&(this._activeTargets.delete(r),this._disposeWithFramebuffers(this._depthTextures,r),this._disposeWithFramebuffers(this._depthBuffers,r),this._disposeWithFramebuffers(this._colorTextures,r))}_disposeWithFramebuffers(e,r){const i=e.get(r);i&&(this._framebuffers.forEach((n,s)=>{n.colorAttachment!==i&&n.depthStencilAttachment!==i||(n.detachAll(),n.dispose(),this._framebuffers.delete(s))}),i.dispose(),e.delete(r))}getDepthTexture(e,r){if(!this.depthTextureSupported)return null;let i=this._depthTextures.get(e.id);return!i||i.descriptor.width===r.width&&i.descriptor.height===r.height||(i.dispose(),i=XS()),i||(i=new mt(this._rctx,{target:Ct.TEXTURE_2D,pixelFormat:Ge.DEPTH_STENCIL,dataType:kt.UNSIGNED_INT_24_8,samplingMode:it.NEAREST,wrapMode:$t.CLAMP_TO_EDGE,width:r.width,height:r.height}),this._depthTextures.set(e.id,i),this._activeTargets.add(e.id)),i}getAllocatedDepthTexture(e){return this._depthTextures.get(e.id)}getDepthBuffer(e,r){if(this.depthTextureSupported)return null;let i=this._depthBuffers.get(e.id);return i?i.descriptor.width===r.width&&i.descriptor.height===r.height||i.resize(r.width,r.height):(i=new cA(this._rctx,{internalFormat:Ul.DEPTH_STENCIL,...r}),this._depthBuffers.set(e.id,i),this._activeTargets.add(e.id)),i}getColorTexture(e,r){let i=this._colorTextures.get(e.id);return i&&(i.descriptor.width===r.width&&i.descriptor.height===r.height||(i.dispose(),i=XS())),i||(i=new mt(this._rctx,{target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,internalFormat:e.internalFormat,dataType:e.dataType,samplingMode:e.samplingMode!=null?e.samplingMode:it.LINEAR,wrapMode:$t.CLAMP_TO_EDGE,width:r.width,height:r.height}),this._colorTextures.set(e.id,i),this._activeTargets.add(e.id)),i}getAllocatedColorTexture(e){return this._colorTextures.get(e.id)}registerDepthTarget(e={}){return{id:Vu(),...y5t,...e}}registerColorTarget(e={}){return{id:Vu(),...g5t,...e}}getFramebuffer(e,r,i){const n=this._getKey(r,i);let s=this._framebuffers.get(n);const o=this.getColorTexture(r,e);if(this.depthTextureSupported){const l=i?this.getDepthTexture(i,e):void 0;return s?((s.width!==e.width||s.height!==e.height||s.colorTexture!==o||s.depthStencilTexture!==l)&&(s.detachAll(),s.resize(e.width,e.height),s.attachColorTexture(o),s.attachDepthStencilTexture(l)),s):(s=v(i)?new Jn(this._rctx,{colorTarget:xn.TEXTURE,depthStencilTarget:Ur.DEPTH_STENCIL_TEXTURE},o,l):new Jn(this._rctx,{colorTarget:xn.TEXTURE,depthStencilTarget:Ur.NONE},o),this._framebuffers.set(n,s),s)}const a=i?this.getDepthBuffer(i,e):void 0;return s?((s.width!==e.width||s.height!==e.height||s.colorTexture!==o)&&(s.detachAll(),s.resize(e.width,e.height),s.attachColorTexture(o),s.attachDepthStencilBuffer(a)),s):(s=new Jn(this._rctx,{colorTarget:xn.TEXTURE,depthStencilTarget:i?Ur.DEPTH_STENCIL_RENDER_BUFFER:Ur.NONE},o,a),this._framebuffers.set(n,s),s)}_getKey(e,r){return`${e.id}_${r?r.id:"X"}_${e.name}${r?"_"+r.name:""}`}get gpuMemoryUsage(){let e=0;const r=new Set,i=n=>{r.has(n)||(r.add(n),e+=g2(n))};return this._depthTextures.forEach(i),this._colorTextures.forEach(i),this._depthBuffers.forEach(i),e}},v5t=class{constructor(e,r){this._rctx=e,this._compositingHelper=r,this._mainColorTarget=0,this._dimensions={width:4,height:4},this._background={type:"color",color:[0,0,0,1]};const i=e.type===Et.WEBGL2;this._renderTargetHelper=new _5t(e);const n=this._renderTargetHelper;this._mainColorTargets=[n.registerColorTarget({name:"mainColorTarget0"}),n.registerColorTarget({name:"mainColorTarget1"})],this.frontFaceTarget=n.registerColorTarget({name:"frontFaceTarget"});const s=o=>n.registerColorTarget({name:o,dataType:kt.FLOAT,internalFormat:i?Ot.RGBA32F:Ge.RGBA,samplingMode:it.NEAREST});this.colorFloatTarget=s("colorFloatTarget"),this.alphaFloatTarget=s("alphaFloatTarget"),this.mainDepth=n.registerDepthTarget({name:"mainDepth"}),this.linearDepth=n.registerColorTarget({name:"linearDepth",samplingMode:it.NEAREST}),this.terrainLinearDepth=n.registerColorTarget({name:"terrainLinearDepth"}),this.geometryLinearDepth=n.registerColorTarget({name:"geometryLinearDepth"}),this.normal=n.registerColorTarget({name:"normal"}),this.highlight=n.registerColorTarget({name:"highlight",internalFormat:i?Ot.RGBA4:Ge.RGBA,dataType:kt.UNSIGNED_SHORT_4_4_4_4}),this.hudVisibility=n.registerColorTarget({name:"hudVisibility",internalFormat:i?Ot.RGBA4:Ge.RGBA,dataType:kt.UNSIGNED_SHORT_4_4_4_4}),this.tmpColor=n.registerColorTarget({name:"tmpColor"}),this.tmpDepth=n.registerDepthTarget({name:"tmpDepth"}),this.hudColor=n.registerColorTarget({name:"hudColor"})}dispose(){this._renderTargetHelper.dispose()}get width(){return this._dimensions.width}get height(){return this._dimensions.height}set background(e){this._background=e}get background(){return this._background}get currentColorTarget(){return this._mainColorTargets[this._mainColorTarget]}get previousColorTarget(){return this._mainColorTargets[1-this._mainColorTarget]}get framebuffer(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}getFramebuffer(e,r){return this._renderTargetHelper.getFramebuffer(this._dimensions,e,r)}get colorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}get depthTexture(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}get linearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}get terrainLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}get geometryLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}get lastFrameColorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}get normalTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}get highlightTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}get hudVisibilityTexture(){return this._getColorTexture(this.hudVisibility)}get tmpColorTexture(){return this._getColorTexture(this.tmpColor)}get hudColorTexture(){return this._getColorTexture(this.hudColor)}get mainColorTexture(){return this._getColorTexture(this.currentColorTarget)}setupRenderTarget(e){e||(this._mainColorTarget=0,this.disposeTarget(this._mainColorTargets[1])),this._mainColorTarget=this._mainColorTarget===0&&e?1:0}initializeFrame(e){const r=this._rctx;this._dimensions.width=e.fullWidth,this._dimensions.height=e.fullHeight,this.bindTarget(this.currentColorTarget,this.mainDepth),r.setClearStencil(0);const i=this._background.color;r.setClearColor(i[0]*i[3],i[1]*i[3],i[2]*i[3],i[3]),r.clearSafe(Hi.COLOR_BUFFER_BIT|Hi.DEPTH_BUFFER_BIT|Hi.STENCIL_BUFFER_BIT)}composite(e){v(this.colorTexture)&&this._compositingHelper.composite(e,this.colorTexture,al.None)}renderTmpAndCompositeToMain(e,r,i,n=!1){this.renderToTargets(e,this.tmpColor,n?this.tmpDepth:this.mainDepth,b5t),this._compositingHelper.composite(r,this._getColorTexture(this.tmpColor),i)}renderHUDVisibility(e,r=!1){this.renderToTargets(e,this.hudVisibility,r?this.tmpDepth:this.mainDepth,w5t)}compositeTransparentTerrainOntoHUDVisibility(e){this.renderToTargets(()=>this._compositingHelper.compositeHUD(e,this._getColorTexture(this.tmpColor)),this.hudVisibility,this.tmpDepth)}renderOITPass(e,r,i){let n,s;switch(r){case At.Color:n=this.colorFloatTarget,s=[0,0,0,0];break;case At.Alpha:n=this.alphaFloatTarget,s=[1,1,1,1];break;case At.FrontFace:n=this.frontFaceTarget,s=[0,0,0,0]}i?this.renderToTargets(e,n,this.tmpDepth,s,!0,!0):this.renderToTargets(e,n,this.mainDepth,s,!1)}compositeTransparentTerrainOntoMain(e){this.bindFramebuffer(),this._compositingHelper.composite(e,this._getColorTexture(this.tmpColor),al.PremultipliedAlpha)}compositeOccludedOntoMain(e,r){this.bindFramebuffer(),this._compositingHelper.composite(e,this._getColorTexture(this.tmpColor),al.PremultipliedAlpha,r)}compositeTransparentOntoOpaque(e,r){r?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clearSafe(Hi.COLOR_BUFFER_BIT)):this.bindFramebuffer(),this._compositingHelper.compositeOIT(e,this._getColorTexture(this.colorFloatTarget),this._getColorTexture(this.alphaFloatTarget),this._getColorTexture(this.frontFaceTarget))}bindFramebuffer(){this._rctx.bindFramebuffer(this.framebuffer)}renderDepthDetached(e){this.bindTarget(this.currentColorTarget),e(),this.bindTarget(this.currentColorTarget,this.mainDepth)}disposeTarget(e){this._renderTargetHelper.disposeTargetResource(e)}renderToFBO(e,r,i=!1,n=!1){const s=this._rctx;let o=0;if(r){const l=Math.max(1e-13,r[3]);s.setClearColor(r[0],r[1],r[2],l),o|=Hi.COLOR_BUFFER_BIT}i&&(o|=Hi.DEPTH_BUFFER_BIT),n===!1?n=0:(n===!0&&(n=255),o|=Hi.STENCIL_BUFFER_BIT),o&&s.clearSafe(o,n),e(),s.gl.flush(),this.bindTarget(this.currentColorTarget,this.mainDepth)}renderToTargets(e,r,i,n,s=!1,o=!1){const a=this.bindTarget(r,i);return this.renderToFBO(e,n,s,o),a}bindTarget(e,r){const i=this._renderTargetHelper.getFramebuffer(this._dimensions,e,r);return this._rctx.bindFramebuffer(i),i}_getColorTexture(e){return this._renderTargetHelper.getColorTexture(e,this._dimensions)}get gpuMemoryUsage(){let e=0;return this._renderTargetHelper&&(e+=this._renderTargetHelper.gpuMemoryUsage),e}};const b5t=[0,0,0,0],w5t=[0,1,0,1];let x5t=class{constructor(e){this._context=e,this._renderPlugins=new Wt,this._slots=[];for(let r=0;r<Ee.MAX_SLOTS;++r)this._slots[r]=[]}add(e,r,i){const n=()=>{if(i!=null&&i.aborted)throw r.uninitializeRenderContext(),Vr();this._renderPlugins.push(r);for(const o of e)this._slots[o].push(r);this._context.requestRender()},s=r.initializeRenderContext(this._context,i);if(Ju(s))return s.then(n);n()}remove(e){if(this._renderPlugins.removeUnordered(e)!=null){for(let r=0;r<this._slots.length;++r)this._slots[r]=this._slots[r].filter(i=>i!==e);e.uninitializeRenderContext(),this._context.requestRender()}}prepareRender(){this._renderPlugins.forAll(e=>{e.prepareRender&&e.prepareRender(this._context.renderContext)})}updateAnimation(e){let r=!1;return this._renderPlugins.forAll(i=>{i.updateAnimation&&(r=i.updateAnimation(e)||r)}),r}render(){const e=this._slots[this._context.renderContext.bindParameters.slot],r=new Array;e.filter(i=>{if(!i.canRender)return!1;if(T5t(i)){const n=i.prepareTechnique(this._context.renderContext);return!!n&&(r.push(n),!0)}return r.push(null),!0}).forEach((i,n)=>i.render(this._context.renderContext,r[n]))}queryDepthRange(e){const r=S5t;return r.near=1/0,r.far=-1/0,this._renderPlugins.forAll(i=>{if(i.queryDepthRange){const n=i.queryDepthRange(e);n&&r3(r,n,r)}}),r}get needsTransparentPass(){return this._renderPlugins.some(e=>!!e.needsTransparentPass)}get needsHighlight(){return this._renderPlugins.some(e=>!!e.needsHighlight)}get needsLinearDepth(){return this._renderPlugins.some(e=>!!e.needsLinearDepth)}get needsLaserlineWithContrastControl(){const e=this._slots[Ee.LASERLINES_CONTRAST_CONTROL];return!!e&&e.length>0}get renderOccludedFlags(){return this._renderPlugins.reduce((e,r)=>e|r.renderOccludedFlags,0)}};function T5t(t){return"prepareTechnique"in t}const S5t={near:0,far:0};let I8e=class extends oke{};const G7=255,E5t=1/G7;function C5t(t){const e=new Br,r=e.fragment;return r.include(Qu),r.include(sd),e.include(R7),e.include(Np),e.include(A7,t),r.uniforms.add([new Dt("depthMap",i=>i.linearDepthTexture),new rn("inverseViewMatrix",(i,n)=>ya(Gbe,Hc(Gbe,n.camera.viewMatrix,n.camera.center))),new Hr("nearFar",(i,n)=>n.camera.nearFar)]),r.constants.add("sampleValue","float",E5t),r.code.add(S`void main(void) {
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
gl_FragColor = vec4(sampleValue);
}`),e}const Gbe=$e(),A5t=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastAccumulatePassParameters:I8e,ShadowCastMaxSamples:G7,build:C5t},Symbol.toStringTag,{value:"Module"}));var M2;(function(t){t[t.Gradient=0]="Gradient",t[t.Threshold=1]="Threshold",t[t.COUNT=2]="COUNT"})(M2||(M2={}));let dre=class extends _l{constructor(){super(...arguments),this.visualization=M2.Gradient,this.bandsEnabled=!1}};u([j({count:M2.COUNT})],dre.prototype,"visualization",void 0),u([j()],dre.prototype,"bandsEnabled",void 0);let $8e=class extends wi{constructor(e){super(),this.shadowCastMap=e,this.sampleScale=0,this.opacityFromElevation=1,this.color=MN(R5t),this.bandSize=.1,this.threshold=.5}};const R5t=Zt(.01,0,.25,1);function O5t(t){const e=new Br,r=e.fragment;r.include(Qu),r.include(sd),e.include(R7),e.include(Np);const{visualization:i,bandsEnabled:n}=t;r.constants.add("inverseSampleValue","float",G7),r.uniforms.add([new Dt("shadowCastMap",a=>a.shadowCastMap),new Ie("sampleScale",a=>a.sampleScale),new Ie("opacityFromElevation",a=>a.opacityFromElevation),new br("uColor",a=>a.color)]);const s=i===M2.Gradient,o=i===M2.Threshold;return s&&n?r.uniforms.add(new Ie("bandSize",a=>a.bandSize)):o&&r.uniforms.add(new Ie("threshold",a=>a.threshold)),r.code.add(S`
      void main(void) {
        vec4 record = texture2D(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${o?S`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${s&&n?S`strength = ceil(strength / bandSize) * bandSize;`:""}

        gl_FragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${s?S`* strength`:""});
      }
    `),e}const M5t=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:$8e,build:O5t},Symbol.toStringTag,{value:"Module"}));let L8e=class D8e extends Wr{constructor(e,r){super(e,r,()=>this.destroy())}initializeProgram(e){return new Gr(e.rctx,D8e.shader.get().build(this.configuration),Lr)}initializePipeline(){return Ht({blending:Qh,colorWrite:ir,depthTest:null,depthWrite:null})}get primitiveType(){return Ft.TRIANGLE_STRIP}};L8e.shader=new jr(M5t,()=>Q(()=>import("./ShadowCastVisualize.glsl-dca8b48d.js"),[]));const P5t=4e4,I5t=5e4,N8e=1/512;let KU=class extends be{constructor(e,r,i,n){super({}),this._techniqueRepository=e,this._rctx=r,this._data=i,this._requestRender=n,this._passParameters=new $8e(this._data.shadowCastTexture),this._techniqueConfig=new dre,this._enabled=!1,this._vao=vl(r),this._techniqueConfig.visualization=M2.Gradient}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=rt(this._vao),this._techniqueRepository.release(this._technique),this._technique=null}get _visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(L8e,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._showVisualization)return;this._passParameters.sampleScale=1/this._data.computedSamples;const r=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(r,this._passParameters,e),this._rctx.drawArrays(r.primitiveType,0,Da(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&this._data.computedSamples>0&&this.opacityFromElevation>N8e}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const r=this._passParameters.color;xR(e,r)||(Vf(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};u([d()],KU.prototype,"opacityFromElevation",null),KU=u([$("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],KU);let t9=class extends _l{constructor(){super(...arguments),this.receiveShadows=!0,this.hasWebGL2Context=!1}};u([j()],t9.prototype,"receiveShadows",void 0),u([j()],t9.prototype,"hasWebGL2Context",void 0);let F8e=class k8e extends Wr{constructor(e){super(e,new t9,()=>this.destroy())}initializeConfiguration(e,r){r.hasWebGL2Context=e.rctx.type===Et.WEBGL2}initializeProgram(e){return new Gr(e.rctx,k8e.shader.get().build(this.configuration),Lr)}initializePipeline(){return Ht({blending:mo(Ce.ONE,Ce.ONE,Ce.ONE,Ce.ONE),colorWrite:ir,depthTest:null,depthWrite:null})}get primitiveType(){return Ft.TRIANGLE_STRIP}};F8e.shader=new jr(A5t,()=>Q(()=>import("./ShadowCastAccumulate.glsl-12a10b8d.js"),[]));let Cc=class extends be{constructor(e,r,i,n,s,o){super({}),this._rctx=e,this._stage=i,this._prepareForShadowMapPass=n,this._renderToShadowMap=s,this._requestRender=o,this._progress=0,this._sampleCount=0,this._passParameters=new I8e,this._enabledInternal=!1,this._cachedLightDirections=[],this._depthRange=nre,this._previewing=!1,this._handles=new qr,this._cameraForcedForScreenshot=!1,this._bindParameters=new XB(new Qle(e,i.viewingMode),null,null),this._bindParameters.shadowMap.enabled=!0,this._vao=vl(e);const a={colorTarget:xn.TEXTURE,depthStencilTarget:Ur.NONE,width:0,height:0},l={target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:it.LINEAR,wrapMode:$t.CLAMP_TO_EDGE,width:0,height:0};this._fbo=new Jn(e,a,l),this._accumulationRenderer=new KU(r,e,this,o);const c=this._stage.view.resourceController.scheduler;this._handles.add([c.registerTask(St.SHADOW_ACCUMULATOR,this),ne(()=>i.renderView,h=>{this._handles.remove(Hbe),v(h)&&this._handles.add(h.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),Hbe)},Wi),ne(()=>this._previewing,()=>this._requestRenderIfEnabled(),Zr)])}normalizeCtorArgs(){return{}}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _accumulationTechnique(){if(R(this._accumulationTechniqueCached)){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechniqueCached=new F8e(e)}return this._accumulationTechniqueCached}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._enabledInternal&&this._sampleCount>0}get canAccumulate(){return this._passParameters.linearDepthTexture!==null&&this._depthRange!==nre&&this._opacityFromElevation>N8e}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const r=this._cachedLightDirections;if(g_(r,e,Xb))return;const i=Math.min(G7,e.length);r.length=i,this._sampleCount=i;for(let n=0;n<i;++n)r[n]=ce(r[n]??P(),e[n]);this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,r,i,n){if(this._depthRange=r,this._updateCamera(i),this._bindParameters.contentCamera=n,this._passParameters.linearDepthTexture=e,this._passParameters.origin=this._bindParameters.camera.center,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const s=this._cameraForcedForScreenshot?this._sampleCount:Math.min($5t,this._sampleCount-this._progress);for(let o=0;o<s;++o)this._accumulateShadow();this._cameraForcedForScreenshot=!1,this._requestRender()}render(e){this._accumulationRenderer.render(e)}dispose(){this._stop(),this._handles.destroy(),this._accumulationRenderer=rt(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=rt(this._fbo),this._vao=rt(this._vao),this._accumulationTechniqueCached=en(this._accumulationTechniqueCached),this._cachedLightDirections.length=0,this._sampleCount=0}setOptions(e){e.enabled!==void 0&&(this._enabled=e.enabled),e.previewing!==void 0&&(this._previewing=e.previewing),e.lightDirections!==void 0&&(this._lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}readAccumulatedShadow(e,r){return!this._isActive||this._progress<1||e<0||e>this._fbo.width||r<0||r>this._fbo.height?0:(this._fbo.readPixels(e,r,1,1,Ge.RGBA,kt.UNSIGNED_BYTE,qbe),qbe[0]/this._progress)}_start(){this._progress=0,this._enabledInternal=!0}_stop(){this._enabledInternal=!1}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(Hi.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._sampleLightDirection(),this._depthRange);const e=this._accumulationTechnique;this._rctx.bindFramebuffer(this._fbo),this._rctx.bindTechnique(e,this._passParameters,this._bindParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(e.primitiveType,0,Da(this._vao,"geometry"))}_sampleLightDirection(){return this._progress++,this._lightDirections[this._progress*L5t%this._lightDirections.length]}_updateCamera(e){e.equals(this._bindParameters.camera)||(this._bindParameters.camera.copyFrom(e),this._fbo.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-mO(P5t,I5t,e.relativeElevation))}set _enabled(e){e!==this._enabledInternal&&(e?this._start():this._stop())}_requestRenderIfEnabled(){this._enabledInternal&&this._requestRender()}get test(){const e=this;return{lightDirections:this._lightDirections,get isDone(){return e._isDoneAccumulating},get isActive(){return e._isActive}}}};u([d()],Cc.prototype,"_progress",void 0),u([d()],Cc.prototype,"_sampleCount",void 0),u([d()],Cc.prototype,"_enabledInternal",void 0),u([d()],Cc.prototype,"_depthRange",void 0),u([d()],Cc.prototype,"_previewing",void 0),u([d()],Cc.prototype,"_accumulationRenderer",void 0),u([d()],Cc.prototype,"_isRefining",null),u([d()],Cc.prototype,"_isActive",null),u([d()],Cc.prototype,"canAccumulate",null),u([d()],Cc.prototype,"_isDoneAccumulating",null),u([d()],Cc.prototype,"_opacityFromElevation",null),u([d()],Cc.prototype,"running",null),Cc=u([$("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],Cc);const $5t=6,Hbe="renderView",L5t=104729,qbe=new Uint8Array(4),Wbe={highlightedThreshold:.99999,selfShadowThreshold:.025};function D5t(t){const e=new Br;e.include(S2,t);const r=e.fragment;return r.include(Qu),r.include(sd),e.include(R7),e.include(Np),r.uniforms.add([new Dt("defaultDepthTex",(i,n)=>n.shadowMap.getSnapshot(KO.Default)),new Dt("highlightDepthTex",(i,n)=>n.shadowMap.getSnapshot(KO.Highlight)),new Dt("depthMap",(i,n)=>n.linearDepthTexture),new Dt("highlightMap",(i,n)=>n.highlightColorTexture),new br("uColor",i=>i.shadowColor),new Hr("nearFar",(i,n)=>n.camera.nearFar),new Ie("opacity",i=>i.shadowOpacity),new Ie("occludedOpacity",i=>i.occludedShadowOpacity),new Ie("terminationFactor",i=>i.opacityElevation*i.dayNightTerminator),new Jt("lightingMainDirectionView",(i,n)=>we(Ybe,Ke(Ybe,n.lighting.mainLight.direction,n.camera.viewInverseTransposeMatrix))),new Hr("texelSize",(i,n)=>v(n.linearDepthTexture)?dt(N5t,1/n.linearDepthTexture.descriptor.width,1/n.linearDepthTexture.descriptor.height):Wc),new rn("inverseViewMatrix",(i,n)=>ya(Xbe,Hc(Xbe,n.camera.viewMatrix,n.camera.center)))]),r.constants.add("unoccludedHighlightFlag","vec4",k4e).add("highlightedThreshold","float",Wbe.highlightedThreshold).add("selfShadowThreshold","float",Wbe.selfShadowThreshold),r.code.add(S`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`),r.code.add(S`void main(void) {
vec4 highlightInfo = texture2D(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
gl_FragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
}`),e}const Xbe=$e(),Ybe=P(),N5t=Ne(),F5t=Object.freeze(Object.defineProperty({__proto__:null,build:D5t},Symbol.toStringTag,{value:"Module"}));let k5t=class extends wi{constructor(){super(...arguments),this.shadowColor=Zt(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}},U8e=class z8e extends Wr{constructor(e){super(e,new t9,()=>this.destroy())}initializeConfiguration(e,r){r.hasWebGL2Context=e.rctx.type===Et.WEBGL2}initializeProgram(e){return new Gr(e.rctx,z8e.shader.get().build(this.configuration),Lr)}initializePipeline(){return Ht({blending:mo(Ce.SRC_ALPHA,Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA,Ce.ONE_MINUS_SRC_ALPHA),colorWrite:ir,depthTest:null,depthWrite:null})}get primitiveType(){return Ft.TRIANGLE_STRIP}};U8e.shader=new jr(F5t,()=>Q(()=>import("./ShadowHighlight.glsl-99639543.js"),[]));const U5t=.001953125,z5t=4e4,V5t=5e4;let B5t=class{constructor(e,r){this._rctx=e,this._viewingMode=r,this._maxOpacity=1,this._passParameters=new k5t,this._drawParameters=new oke,this._vao=vl(this._rctx)}get _technique(){return R(this._techniqueCached)&&(this._techniqueCached=new U8e({rctx:this._rctx,viewingMode:this._viewingMode})),this._techniqueCached}render(e,r){if(!e.shadowMap.enabled||!e.linearDepthTexture||!this.isVisible)return;const i=this._technique;this._drawParameters.origin=e.camera.center,this._rctx.bindFramebuffer(r),this._rctx.bindTechnique(i,this._passParameters,e).bindDraw(this._drawParameters,e,this._passParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(i.primitiveType,0,Da(this._vao,"geometry"))}get gpuMemoryUsage(){var e;return((e=this._vao)==null?void 0:e.size)??0}setDefaultOptions(e){this._passParameters={...this._passParameters,...e},this._updateMaxOpacity()}updateParameters(e,r){this._passParameters.opacityElevation=1-mO(z5t,V5t,e.relativeElevation);const i=this._viewingMode===qe.Global?we(Zbe,e.center):he(Zbe,0,0,1),n=ve(i,r);this._passParameters.dayNightTerminator=mO(0,1,_e(30*n,0,1))}dispose(){this._vao=rt(this._vao),this._techniqueCached=en(this._techniqueCached)}get isVisible(){const{opacityElevation:e,dayNightTerminator:r}=this._passParameters;return this._maxOpacity*e*r>=U5t}_updateMaxOpacity(){const e=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=e*this._passParameters.shadowColor[3]}};const Zbe=P(),Jbe=k_();let j5t=class{constructor(){this._plane=k_()}get isEnabled(){return!VLe(this.plane,Jbe)}get plane(){return this._plane}set plane(e){G2(e||Jbe,this._plane)}},G5t=class extends wi{};function WD(t){t.uniforms.add(new br("resolution",e=>{const{descriptor:r}=e.colorTexture,i=r.width,n=r.height;return ai(H5t,1/i,1/n,i,n)}))}const H5t=pr(),dC={maxSearchSteps:8,maxDistanceAreaTex:16};function q5t(){const t=new Br,{attributes:e,varyings:r,vertex:i,fragment:n}=t;return e.add(O.POSITION,"vec2"),r.add("uv","vec2"),r.add("offsets[2]","vec4"),r.add("maxOffset","vec4"),r.add("pixelCoord","vec2"),WD(i),i.code.add(S`
      void main() {
        uv = position * 0.5 + vec2(0.5);
        gl_Position = vec4(position, 0, 1);

        pixelCoord = uv * resolution.zw;
        offsets[0] = uv.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        offsets[1] = uv.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        maxOffset = vec4( offsets[0].xz, offsets[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${S.int(dC.maxSearchSteps)} );
      }
    `),n.uniforms.add(new Dt("edgesTexture",s=>s.edges.colorTexture)),n.uniforms.add(new Dt("areaTexture",s=>s.areaTexture)),n.uniforms.add(new Dt("searchTexture",s=>s.searchTexture)),WD(n),n.code.add(S`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 sampleLevelZeroOffset(sampler2D texture, vec2 coord, vec2 offset) {
        return texture2D(texture, coord + offset.x * resolution.xy, 0.0);
      }

      vec2 round( vec2 x ) {
        return sign(x) * floor(abs(x) + 0.5);
      }

      float searchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
        e.r = bias + e.r * scale;
        return 255.0 * texture2D( searchTex, e, 0.0 ).r;
      }

      float searchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${S.int(dC.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * searchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float searchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${S.int(dC.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * searchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float searchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${S.int(dC.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * searchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float searchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${S.int(dC.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * searchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 getArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${S.int(dC.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture2D( areaTex, texcoord, 0.0 ).rg;
      }

      void main() {
        ivec4 subsampleIndices = ivec4(0.0);
        vec4 weights = vec4(0.0);
        vec2 e = texture2D( edgesTexture, uv ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = searchXLeft( edgesTexture, searchTexture, offsets[0].xy, maxOffset.x );
          coords.y = offsets[1].y;
          d.x = coords.x;
          float e1 = texture2D( edgesTexture, coords, 0.0 ).r;
          coords.x = searchXRight( edgesTexture, searchTexture, offsets[0].zw, maxOffset.y );
          d.y = coords.x;
          d = d * resolution.z - pixelCoord.x;
          vec2 sqrt_d = sqrt( abs(d) );
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = searchYUp( edgesTexture, searchTexture, offsets[1].xy, maxOffset.z );
          coords.x = offsets[0].x;
          d.x = coords.y;
          float e1 = texture2D( edgesTexture, coords, 0.0 ).g;
          coords.y = searchYDown( edgesTexture, searchTexture, offsets[1].zw, maxOffset.w );
          d.y = coords.y;
          d = d * resolution.w - pixelCoord.y;
          vec2 sqrt_d = sqrt(abs(d));
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2(0.0, 1.0)).g;
          weights.ba = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
        }
        gl_FragColor = weights;
      }
    `),t}const W5t=Object.freeze(Object.defineProperty({__proto__:null,build:q5t},Symbol.toStringTag,{value:"Module"}));let V8e=class B8e extends Wr{initializeProgram(e){return new Gr(e.rctx,B8e.shader.get().build(),Lr)}initializePipeline(){return Ht({colorWrite:ir})}};V8e.shader=new jr(W5t,()=>Q(()=>import("./BlendWeights.glsl-2dd9ba47.js"),[]));function X5t(){const t=new Br,{attributes:e,varyings:r,vertex:i,fragment:n}=t;return e.add(O.POSITION,"vec2"),r.add("uv","vec2"),r.add("offsets[2]","vec4"),WD(i),i.code.add(S`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}`),n.uniforms.add(new Dt("blendWeightsTexture",s=>s.blend.colorTexture)),n.uniforms.add(new Dt("colorTexture",s=>s.colorTexture)),WD(n),n.code.add(S`void main() {
vec4 a;
a.rb = texture2D(blendWeightsTexture, uv).rb;
a.g = texture2D(blendWeightsTexture, offsets[1].zw).g;
a.a = texture2D(blendWeightsTexture, offsets[1].xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
gl_FragColor = texture2D( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture2D( colorTexture, uv, 0.0 );
vec4 Cop = texture2D( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
gl_FragColor = mix(C, Cop, s);
}
}`),t}const Y5t=Object.freeze(Object.defineProperty({__proto__:null,build:X5t},Symbol.toStringTag,{value:"Module"}));let j8e=class G8e extends Wr{initializeProgram(e){return new Gr(e.rctx,G8e.shader.get().build(),Lr)}initializePipeline(){return Ht({colorWrite:ir})}};j8e.shader=new jr(Y5t,()=>Q(()=>import("./Blur.glsl-c839ac3b.js"),[]));const Kbe={threshold:.05,localConstrastAdaption:2};function Z5t(){const t=new Br,{attributes:e,varyings:r,vertex:i,fragment:n}=t;return e.add(O.POSITION,"vec2"),WD(i),r.add("uv","vec2"),r.add("offsets[3]","vec4"),i.code.add(S`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
offsets[2] = uv.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}`),n.uniforms.add(new Dt("colorTexture",s=>s.colorTexture)),n.code.add(S`
    float absMax3(vec3 v) {
      vec3 t = abs(v);
      return max(max(t.r, t.g), t.b);
    }

    void main() {
      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture2D(colorTexture, uv).rgb;

      vec3 Cleft = texture2D(colorTexture, offsets[0].xy).rgb;
      delta.x = absMax3(C - Cleft);

      vec3 Ctop = texture2D(colorTexture, offsets[0].zw).rgb;
      delta.y = absMax3(C - Ctop);

      vec2 edges = step(vec2(${S.float(Kbe.threshold)}), delta.xy);

      // discard if there is no edge:
      if (dot(edges, vec2(1.0)) == 0.0) {
        discard;
      }

      // Calculate right and bottom deltas:
      vec3 Cright = texture2D(colorTexture, offsets[1].xy).rgb;
      delta.z = absMax3(C - Cright);

      vec3 Cbottom  = texture2D(colorTexture, offsets[1].zw).rgb;
      delta.w = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture2D(colorTexture, offsets[2].xy).rgb;
      delta.z = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture2D(colorTexture, offsets[2].zw).rgb;
      delta.w = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, delta.z), delta.w);

      // Local contrast adaptation in action:
      edges.xy *= step(maxDelta, float(${S.float(Kbe.localConstrastAdaption)}) * delta.xy);

      gl_FragColor = vec4(edges, 0.0, 0.0);
    }
  `),t}const J5t=Object.freeze(Object.defineProperty({__proto__:null,build:Z5t},Symbol.toStringTag,{value:"Module"}));let H8e=class q8e extends Wr{initializeProgram(e){return new Gr(e.rctx,q8e.shader.get().build(),Lr)}initializePipeline(){return Ht({colorWrite:ir})}};H8e.shader=new jr(J5t,()=>Q(()=>import("./EdgeDetect.glsl-bd8353d5.js"),[]));let ZI=class extends be{constructor(e,r){super({}),this._rctx=e,this._techniqueRep=r,this._passParameters=new G5t,this._isEnabled=!1}normalizeCtorArgs(){return{}}dispose(){this._abortController=Tp(this._abortController),this.disable()}_loadResources(e){if(v(this._abortController))return!1;if(v(this._passParameters.searchTexture))return!0;this._abortController=new AbortController;const r=this._abortController.signal;return Q(()=>import("./SmaaRenderPassData-660b7d34.js"),[]).then(i=>this._loadTextures(i,r)).then(()=>e()).finally(()=>this._abortController=null),!1}_loadTextures(e,r){return lr(r),Promise.all([this._loadTextureFromBase64(e.areaTexture,it.LINEAR,Ge.RGB),this._loadTextureFromBase64(e.searchTexure,it.NEAREST,Ge.LUMINANCE)]).then(([i,n])=>{uo(r)?(i.dispose(),n.dispose(),lr(r)):(this._passParameters.areaTexture=i,this._passParameters.searchTexture=n)})}get updating(){return v(this._abortController)}enable(e){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const r=new _l;this._edgeDetectTechnique=this._techniqueRep.releaseAndAcquire(H8e,r,this._edgeDetectTechnique),this._blendWeightsTechnique=this._techniqueRep.releaseAndAcquire(V8e,r,this._blendWeightsTechnique),this._blurTechnique=this._techniqueRep.releaseAndAcquire(j8e,r,this._blurTechnique)}return!!this._loadResources(e)&&(this._vao=a_t(this._rctx),this._passParameters.edges=new Jn(this._rctx,{colorTarget:xn.TEXTURE,depthStencilTarget:Ur.NONE},{target:Ct.TEXTURE_2D,pixelFormat:Ge.RGB,dataType:kt.UNSIGNED_BYTE,samplingMode:it.LINEAR,wrapMode:$t.CLAMP_TO_EDGE,width:4,height:4}),this._passParameters.blend=new Jn(this._rctx,{colorTarget:xn.TEXTURE,depthStencilTarget:Ur.NONE},{target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:it.LINEAR,wrapMode:$t.CLAMP_TO_EDGE,width:4,height:4}),this._isEnabled=!0,!0)}disable(){this._isEnabled&&(this._vao=rt(this._vao),this._passParameters.areaTexture=rt(this._passParameters.areaTexture),this._passParameters.searchTexture=rt(this._passParameters.searchTexture),this._passParameters.blend=rt(this._passParameters.blend),this._passParameters.edges=rt(this._passParameters.edges),this._isEnabled=!1)}get _validPassParameters(){return this._isEnabled?this._passParameters:null}render(e){const r=this._validPassParameters;if(R(r))return;r.colorTexture=e;const i=this._rctx,n=i.getBoundFramebufferObject(),s=e.descriptor.width,o=e.descriptor.height;i.bindVAO(this._vao),i.setViewport(0,0,s,o),r.edges.resize(s,o),i.bindFramebuffer(r.edges),i.setClearColor(0,0,0,1),i.clear(Hi.COLOR_BUFFER_BIT),i.bindTechnique(this._edgeDetectTechnique,r,null),i.drawArrays(Ft.TRIANGLES,0,3),r.blend.resize(s,o),i.bindFramebuffer(r.blend),i.setClearColor(0,0,1,1),i.clear(Hi.COLOR_BUFFER_BIT),i.bindTechnique(this._blendWeightsTechnique,r,null),i.drawArrays(Ft.TRIANGLES,0,3),i.bindFramebuffer(n),i.setClearColor(0,1,0,1),i.clear(Hi.COLOR_BUFFER_BIT),i.bindTechnique(this._blurTechnique,r,null),i.drawArrays(Ft.TRIANGLES,0,3)}_loadTextureFromBase64(e,r,i){return O_(e).then(n=>new mt(this._rctx,{pixelFormat:i,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE,width:n.width,height:n.height,samplingMode:r},n))}};u([d()],ZI.prototype,"_abortController",void 0),u([d({readOnly:!0})],ZI.prototype,"updating",null),ZI=u([$("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],ZI);function K5t(t,e){const r=-t[0],i=-t[1],n=-t[2],s=e[3],o=e[7],a=e[11],l=e[15];e[0]+=s*r,e[1]+=s*i,e[2]+=s*n,e[4]+=o*r,e[5]+=o*i,e[6]+=o*n,e[8]+=a*r,e[9]+=a*i,e[10]+=a*n,e[12]+=l*r,e[13]+=l*i,e[14]+=l*n}function Q5t(t,e){const r=t[0],i=t[1],n=t[2];e[12]+=r*e[0]+i*e[4]+n*e[8],e[13]+=r*e[1]+i*e[5]+n*e[9],e[14]+=r*e[2]+i*e[6]+n*e[10],e[14]+=r*e[3]+i*e[7]+n*e[11]}let ekt=class{constructor(e){this._factory=e,this._originData=new Map}acquire(e){return this.register(this._factory.getOrigin(e))}register(e){const r=this._originData.get(e.id)||new tkt(e);return r.refCount++,this._originData.has(r.origin.id)||this._originData.set(r.origin.id,r),r}release(e){e.refCount--,e.refCount===0&&this._originData.delete(e.origin.id)}updateViewMatrices(e){this._originData.forEach(r=>{po(r.viewMatrix,e),Q5t(r.origin.vec3,r.viewMatrix)})}},tkt=class{constructor(e){this.origin=e,this.refCount=0,this.viewMatrix=$e()}},rkt=class extends rNe{constructor(e,r){super(),this.distanceFalloffFactor=e,this.transparency=r,this.transformNormalViewFromGlobal=vi()}},ikt=class extends iNe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=vi(),this.slicePlaneLocalOrigin=P(),this.transformNormalGlobalFromModel=vi()}};function nkt(t){const e=S`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;t.code.add(e)}const skt=Rr(.5,-4e-4);function okt(t,e){const r=t.vertex;r.include(nkt),r.constants.add("depthBias","vec2",skt),r.uniforms.add(new Hr("inverseViewport",(i,n)=>n.inverseViewport)),e.legacy?(r.uniforms.add(new rn("proj",(i,n)=>n.camera.projectionMatrix)),r.code.add(S`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(r.uniforms.add(new wy("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal)),r.uniforms.add(new rn("transformProjFromView",i=>i.transformProjFromView)),r.code.add(S`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)),r.code.add(S`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}function akt(t,e){const r=t.fragment;r.constants.add("coverageTestThreshold","float",.01),e.antialiasing?r.code.add(S`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):r.code.add(S`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)}function lkt(t,e){const r=t.vertex;e.silhouette?(r.code.add(S`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),e.legacy?r.code.add(S`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):r.code.add(S`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):r.code.add(S`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)}function ckt(t,e){const r=t.vertex;r.include(Qu),r.uniforms.add(new Ie("distanceFalloffFactor",i=>i.distanceFalloffFactor)),r.code.add(S`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),r.uniforms.add(Ub("componentDataTex",i=>i.componentDataTexture,e.hasWebGL2Context?oi.None:oi.InvSize)),t.attributes.add(O.COMPONENTINDEX,"float"),r.constants.add("componentColorFieldOffset","float",0),r.constants.add("componentOtherFieldOffset","float",1),r.constants.add("componentVerticalOffsetFieldOffset","float",2),r.constants.add("componentFieldCount","float",3),r.constants.add("lineWidthFractionFactor","float",8),r.constants.add("extensionLengthOffset","float",128),r.constants.add("verticalOffsetScale","float",2*Ice),r.code.add(S`
    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
      float fieldIndex = componentFieldCount * componentIndex + fieldOffset;

      vec2 textureSizeInverse = ${yp(e,"componentDataTex",!0)};

      float colIndex = mod(fieldIndex, 1.0 / textureSizeInverse.x);
      float rowIndex = floor(fieldIndex * textureSizeInverse.x);

      return vec2(colIndex, rowIndex) + 0.5;
    }

    struct ComponentData {
      vec4 color;
      float lineWidth;
      float extensionLength;
      float type;
      float verticalOffset;
    };

    ComponentData readComponentData() {
      vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
      vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
      vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);

      vec4 colorValue = ${Wl(e,"componentDataTex","colorIndex")};
      vec4 otherValue = ${Wl(e,"componentDataTex","otherIndex")};
      float verticalOffset = (rgba2float(${Wl(e,"componentDataTex","verticalOffsetIndex")}) - 0.5) * verticalOffsetScale;

      return ComponentData(
        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity
        otherValue.x * (255.0 / lineWidthFractionFactor),
        otherValue.y * 255.0 - extensionLengthOffset,
        -(otherValue.z * 255.0) + 0.5, // SOLID (=0/255) needs to be > 0.0, SKETCHY (=1/255) needs to be <= 0;
        verticalOffset
      );
    }
  `),e.legacy?r.code.add(S`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(r.uniforms.add(new yD("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel)),r.code.add(S`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),e.silhouette?(t.attributes.add(O.NORMALA,"vec3"),t.attributes.add(O.NORMALB,"vec3"),r.code.add(S`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(t.attributes.add(O.NORMAL,"vec3"),r.code.add(S`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`)),e.legacy?r.code.add(S`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(r.include(sV,e),r.include(sV,e),r.uniforms.add([new wy("transformViewFromCameraRelativeRS",i=>i.transformViewFromCameraRelativeRS),new yD("transformWorldFromModelRS",i=>i.transformWorldFromModelRS),new Kh("transformWorldFromModelTL",i=>i.transformWorldFromModelTL),new Kh("transformWorldFromModelTH",i=>i.transformWorldFromModelTH),new Jt("transformWorldFromViewTL",i=>i.transformWorldFromViewTL),new Jt("transformWorldFromViewTH",i=>i.transformWorldFromViewTH)]),r.code.add(S`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${e.spherical?S`normalize(transformWorldFromModelTL + rotatedModelPosition);`:S`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),r.uniforms.add(new rn("transformProjFromView",(i,n)=>n.camera.projectionMatrix)),r.code.add(S`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),r.code.add(S`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function ukt(t){return t.mode===Ws.SKETCH||t.mode===Ws.MIXED}var Ws,sS;(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH",t[t.MIXED=2]="MIXED",t[t.COUNT=3]="COUNT"})(Ws||(Ws={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.SILHOUETTE=1]="SILHOUETTE"}(sS||(sS={}));function Nce(t,e){const r=t.vertex;switch(t.attributes.add(O.SIDENESS,"vec2"),e.mode===Ws.MIXED?r.code.add(S`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):r.code.add(S`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),e.mode){case Ws.MIXED:r.code.add(S`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case Ws.SKETCH:r.code.add(S`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case Ws.SOLID:r.code.add(S`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case Ws.COUNT:break;default:e.mode}}function hkt(t,e){const r=t.vertex;switch(t.include(Nce,e),e.mode){case Ws.SOLID:r.code.add(S`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case Ws.SKETCH:r.uniforms.add(new kS("strokesAmplitude",i=>i.strokesTexture.amplitude)),r.code.add(S`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case Ws.MIXED:r.uniforms.add(new kS("strokesAmplitude",i=>i.strokesTexture.amplitude)),r.code.add(S`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}}function dkt(t,e){t.include(Nce,e);const{vertex:r,fragment:i}=t;switch(ukt(e)&&(r.uniforms.add(Ub("strokesTexture",n=>n.strokesTexture.texture,e.hasWebGL2Context?oi.None:oi.InvSize)),r.uniforms.add([new kS("strokesLog2Resolution",n=>Math.log2(n.strokesTexture.resolution)),new kS("strokeVariants",n=>n.strokesTexture.variants)]),t.varyings.add("vStrokeUV","vec2"),i.uniforms.add([new zN("strokesTexture",n=>n.strokesTexture.texture),new kS("strokesNormalizationScale",n=>n.strokesTexture.normalizationScale)]),r.code.add(S`
      void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
        vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

        float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);

        vec2 textureSizeInverse = ${yp(e,"strokesTexture",!0)};
        vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) * textureSizeInverse;
        vStrokeUV.x += variantOffset;
      }
    `),t.fragment.include(Qu),i.code.add(S`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture2D(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture2D(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),e.mode){case Ws.SOLID:r.code.add(S`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),i.code.add(S`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case Ws.SKETCH:r.code.add(S`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),i.code.add(S`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case Ws.MIXED:t.varyings.add("vType","float"),r.code.add(S`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),i.code.add(S`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}function pkt(t){const e=new Br,{vertex:r,fragment:i}=e;return t.legacy&&r.uniforms.add([new Qbe("model"),new Qbe("localView")]),e.include(okt,t),e.include(ckt,t),e.include(hkt,t),e.include(Nce,t),e.include(dkt,t),e.include(hs,t),e.include(lkt,t),e.include(akt,t),e.include(od,t),e.varyings.add("vColor","vec4"),e.varyings.add("vRadius","float"),e.varyings.add("vPosition","vec3"),e.varyings.add("vWorldPosition","vec3"),e.varyings.add("vViewPos","vec3"),e.varyings.add("vLineLengthPixels","float"),e.varyings.add("vSizeFalloffFactor","float"),r.uniforms.add([new Hr("pixelToNDC",(n,s)=>dt(fkt,2/s.camera.fullViewport[2],2/s.camera.fullViewport[3])),new br("viewport",(n,s)=>s.camera.fullViewport),new Ie("pixelRatio",(n,s)=>s.camera.pixelRatio)]),e.attributes.add(O.POSITION0,"vec3"),e.attributes.add(O.POSITION1,"vec3"),e.attributes.add(O.VARIANTOFFSET,"float"),e.attributes.add(O.VARIANTSTROKE,"float"),e.attributes.add(O.VARIANTEXTENSION,"float"),r.code.add(S`
    const float opaqueCutoff = 1.0 / 255.0;

    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
      vec2 sideness = unpackedAttributes.sideness;
      vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

      vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;

      vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
      vViewPos = viewPos;

      vec4 projPosV0 = projFromViewPosition(viewPosV0);
      vec4 projPosV1 = projFromViewPosition(viewPosV1);
      vec4 projPos = projFromViewPosition(viewPos);

      vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
      vec2 ndcToPixel = viewport.zw * 0.5;
      vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
      float lineLengthPixels = length(screenSpaceLinePixels);

      float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
      vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;

      float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
      float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;

      float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
      float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;

      vSizeFalloffFactor = falloffFactor;

      float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
      float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;

      ${t.antialiasing?S`
        const float aaPaddingPixels = 1.0;

        // Line size with padding
        float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
        float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;`:S`
        float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
        float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;`}

      // Half line width in NDC including padding for anti aliasing
      vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
      vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
      vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;

      // Compute screen space position of vertex, offsetting for line size and end caps
      vec2 ndcOffset = (
          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
      );

      projPos.xy += ndcOffset * projPos.w;
      projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;

      projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));

      // Line length with end caps
      float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;

      float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;

      // Position in pixels with origin at first vertex of line segment
      vPosition = vec3(
        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
        pixelPositionAlongLine,
        pixelPositionAlongLine / extendedLineLengthPixels
      );

      // The line width radius in pixels
      vRadius = lineWidthPixels * 0.5;
      vLineLengthPixels = extendedLineLengthPixels;

      // discard short edges below a certain length threshold
      ${t.mode===Ws.SKETCH?S`
        if (lineLengthPixels <= 3.0) {
          gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
          return;
        }`:t.mode===Ws.MIXED?S`
        if (lineLengthPixels <= 3.0 && unpackedAttributes.type <= 0.0) {
           gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
           return;
        }`:""}
      gl_Position = projPos;
    }

    void main() {
      ComponentData component = readComponentData();
      UnpackedAttributes unpackedAttributes = unpackAttributes(component);

      vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
      worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
      worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);

      // Component color
      vColor = component.color;

      // Discard fully transparent edges
      if (vColor.a < opaqueCutoff) {
        gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
        return;
      }

      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
        return;
      }

      // General geometric computation for all types of edges
      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);

      // Specific computation for different edge styles
      calculateStyleOutputs(unpackedAttributes);
    }
  `),i.code.add(S`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float positionX = position.x - calculateLineOffset();

      if (radius < 1.0) {
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);
        return vec2(0.5 - min(coverageX, coverageY), 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      gl_FragColor = vec4(vColor.rgb, vColor.a * coverage);
    }
  `),e}const fkt=Ne();let Qbe=class extends Ln{constructor(e){super(e,"mat4")}};const mkt=Object.freeze(Object.defineProperty({__proto__:null,build:pkt},Symbol.toStringTag,{value:"Module"}));let W8e=class X8e extends Wr{initializeConfiguration(e,r){r.hasWebGL2Context=e.rctx.type===Et.WEBGL2}initializeProgram(e){return new Gr(e.rctx,X8e.shader.get().build(this.configuration),a8e)}initializePipeline(e){return e.blendMinMax?Ht({blending:mo(Ce.ONE,Ce.ONE,Ce.ZERO,Ce.ONE,hy.ADD,e.blendMinMax.MAX),depthTest:{func:zi.LEQUAL},colorWrite:ir}):Ht({depthTest:{func:zi.LEQUAL},depthWrite:Xc,colorWrite:ir})}};W8e.shader=new jr(mkt,()=>Q(()=>import("./EdgeShader.glsl-33c24cc1.js"),[]));let mg=class extends Io{constructor(){super(...arguments),this.mode=Ws.SOLID,this.hasSlicePlane=!1,this.silhouette=!1,this.legacy=!1,this.antialiasing=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.spherical=!1}};u([j({count:Ws.COUNT})],mg.prototype,"mode",void 0),u([j()],mg.prototype,"hasSlicePlane",void 0),u([j()],mg.prototype,"silhouette",void 0),u([j()],mg.prototype,"legacy",void 0),u([j()],mg.prototype,"antialiasing",void 0),u([j()],mg.prototype,"doublePrecisionRequiresObfuscation",void 0),u([j()],mg.prototype,"hasMultipassTerrain",void 0),u([j()],mg.prototype,"cullAboveGround",void 0),u([j()],mg.prototype,"spherical",void 0);const gkt=8,BW=128,ykt={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0},_kt={solid:Ws.SOLID,sketch:Ws.SKETCH,uber:Ws.MIXED};let jW=class Y8e{constructor(e,r,i){this._rctx=e,this._shaderTechniqueRepository=r,this._configuration=new mg,this.refCount=0,this._renderables=new Set,this._sortedRenderables={[ar.TRANSPARENT]:{[ar.TRANSPARENT]:new Wt,[ar.OPAQUE]:new Wt},[ar.OPAQUE]:{[ar.TRANSPARENT]:new Wt,[ar.OPAQUE]:new Wt}},this._renderablesDirty=!1,this._drawParameters=new ikt,this._settings={...ykt,...i},this.key=Y8e.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);const n=this._settings.strokesTexture.variants;this.writerSettings={variants:n,reducedPrecision:Qr.TESTS_DISABLE_OPTIMIZATIONS},this._configuration.legacy=this._settings.legacy,this._configuration.mode=_kt[this._settings.type],this._configuration.silhouette=!1,this._configuration.antialiasing=!!this._rctx.capabilities.blendMinMax,this._configuration.hasSlicePlane=this._settings.hasSlicePlane,this._configuration.doublePrecisionRequiresObfuscation=e.driverTest.doublePrecisionRequiresObfuscation.result,this._configuration.spherical=i.spherical}dispose(){this._technique=en(this._technique)}addRenderable(e){this._renderables.add(e),this._renderablesDirty=!0}removeRenderable(e){this._renderables.delete(e),this._renderablesDirty=!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(e,r){this._renderablesDirty&&this._sortRenderables(),this._sortedRenderables[r][ar.TRANSPARENT].forAll(e),this._sortedRenderables[r][ar.OPAQUE].forAll(e)}updateTechnique(e,r){return this._configuration.hasMultipassTerrain=!!e.multipassTerrain.enabled,this._configuration.cullAboveGround=!!e.multipassTerrain.cullAboveGround,this._configuration.silhouette=r,this._technique=this._shaderTechniqueRepository.releaseAndAcquire(W8e,this._configuration,this._technique),this._technique}bindRegularEdges(e,r){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(r,!1),e,r)}bindSilhouetteEdges(e,r){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(r,!0),e,r)}renderRegularEdges(e,r,i,n,s){this._render(e,r,r.regular.vao,i,n,s)}renderSilhouetteEdges(e,r,i,n,s){this._render(e,r,r.silhouette.vao,i,n,s)}_render(e,r,i,n,s,o){o>0&&(this._bindDraw(e,r,n,s),this._rctx.bindVAO(i),this._rctx.capabilities.instancing.drawArraysInstanced(Ft.TRIANGLE_FAN,0,4,o))}_bindDraw(e,r,i,n){if(this._drawParameters.componentDataTexture=r.components.buffer.textureBuffer.texture,this._drawParameters.strokesTexture=this._settings.strokesTexture,"origin"in r.transform)this._lastOriginId!==r.transform.origin.origin.id&&(e.setUniformMatrix4fv("localView",r.transform.origin.viewMatrix),this._lastOriginId=r.transform.origin.origin.id),e.setUniformMatrix4fv("model",r.transform.modelMatrix),this._drawParameters.slicePlaneLocalOrigin=r.transform.origin.origin.vec3;else{const s=new j7(r.transform.position),o=Xu(ewe,Lw(ewe,r.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=s.low,this._drawParameters.transformWorldFromModelTH=s.high,this._drawParameters.transformWorldFromModelRS=r.transform.rotationScale,this._drawParameters.transformNormalGlobalFromModel=o;const a=n.camera.viewInverseTransposeMatrix;he(this._drawParameters.slicePlaneLocalOrigin,a[3],a[7],a[11])}e.bindDraw(this._drawParameters,n,i)}_sortRenderables(){this._renderablesDirty=!1,this._sortedRenderables[ar.TRANSPARENT][ar.TRANSPARENT].clear(),this._sortedRenderables[ar.TRANSPARENT][ar.OPAQUE].clear(),this._sortedRenderables[ar.OPAQUE][ar.TRANSPARENT].clear(),this._sortedRenderables[ar.OPAQUE][ar.OPAQUE].clear(),this._renderables.forEach(r=>{r.objectTransparency!==ar.INVISIBLE&&r.edgeTransparency!==ar.INVISIBLE&&this._sortedRenderables[r.objectTransparency][r.edgeTransparency].push(r)});const e=(r,i)=>"origin"in r.transform?"origin"in i.transform?r.transform.origin.origin.id<i.transform.origin.origin.id?-1:r.transform.origin.origin.id>i.transform.origin.origin.id?1:0:1:0;this._sortedRenderables[ar.TRANSPARENT][ar.TRANSPARENT].sort(e),this._sortedRenderables[ar.TRANSPARENT][ar.OPAQUE].sort(e),this._sortedRenderables[ar.OPAQUE][ar.TRANSPARENT].sort(e),this._sortedRenderables[ar.OPAQUE][ar.OPAQUE].sort(e)}static getKey(e,r,i){return`edges-t:${e}:${r}:${i}`}};const ewe=Bc();function Yrr(t,e){return e.push(t.buffer),{buffer:t.buffer,layout:vkt(t.layout)}}function Rk(t){return bkt(t.layout).createView(t.buffer)}function vkt(t){const e=new Array;return t.fields.forEach((r,i)=>{const n={...r,constructor:Z8e(r.constructor)};e.push([i,n])}),{stride:t.stride,fields:e,fieldNames:t.fieldNames}}function bkt(t){const e=mn();return e.stride=t.stride,e.fieldNames=t.fieldNames,t.fields.forEach(r=>e.fields.set(r[0],{...r[1],constructor:xkt(r[1].constructor)})),e}const wkt=[Bae,q_,Ui,Yu,fw,Gae,Hae,qae,ml,ZB,jae,vD,GO,JB,bD,gl,KB,Wae,QB,jN,e7,Xae,lNe,cNe,Yae,t7,uNe,hNe,dNe,r7,pNe,fNe,mNe,gNe,yNe,_Ne];function Z8e(t){return`${t.ElementType}_${t.ElementCount}`}function xkt(t){return J8e.get(t)}const J8e=new Map;wkt.forEach(t=>J8e.set(Z8e(t),t));let Tkt=class extends eUe{constructor(e){super("EdgeProcessingWorker","extract",{extract:r=>[r.dataBuffer],extractComponentsEdgeLocations:r=>[r.dataBuffer],extractEdgeLocations:r=>[r.dataBuffer]},e)}async process(e,r,i){if(i)return d4t(e);const n=await this.invoke(new GW(e),r);return this._unpackOutput(n)}async extractEdgeLocations(e,r){const i=await this.invokeMethod("extractEdgeLocations",new GW(e),r);return Rk(i)}async extractComponentsEdgeLocations(e,r){const i=await this.invokeMethod("extractComponentsEdgeLocations",new GW(e),r);return Rk(i)}_unpackOutput(e){return{regular:{instancesData:Rk(e.regular.instancesData),lodInfo:{lengths:new Float32Array(e.regular.lodInfo.lengths)}},silhouette:{instancesData:Rk(e.silhouette.instancesData),lodInfo:{lengths:new Float32Array(e.silhouette.lodInfo.lengths)}},averageEdgeLength:e.averageEdgeLength}}},GW=class{constructor(e){this.dataBuffer=e.data.buffer,this.writerSettings=e.writerSettings,this.skipDeduplicate=e.skipDeduplicate,this.indices=Array.isArray(e.indices)?e.indices:e.indices.buffer,this.indicesType=Array.isArray(e.indices)?"Array":$ie(e.indices)?"Uint32Array":"Uint16Array",this.indicesLength=e.indicesLength}};function Skt(t){const r=hP.resolution,i=r/2,n=new Uint8Array(4*r*r),s=4*r*i,o=hP.amplitude,a=2*o,l=4*r,c=Math.log2(r)+1,h=hP.strokes.length;let p=(c-1)*h*l;for(const{distance:m,pressure:g}of hP.strokes){let _=m,b=g,w=p;for(let x=0;x<c;x++){x!==0&&(_=twe(_,XD.DISTANCE),b=twe(b,XD.PRESSURE));for(let T=0;T<hP.resolution;T++){const E=.5+(_?_[T%_.length]/a:0),C=b?b[T%b.length]:1;AD(E,n,w),AD(C,n,w+s),w+=4}w-=l*(h+1)}p+=l}const f=new mt(t,{pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,hasMipmap:!1,samplingMode:it.LINEAR,width:r,height:r,wrapMode:$t.REPEAT},n);return new Ckt(r,a,o,h,f)}function twe(t,e){if(!t)return null;const r=t.length/2,i=Ekt*r,n=new Array(r);let s=0;const o=e===XD.PRESSURE;for(let a=0;a<t.length;a+=2){const l=(t[a]+t[a+1])/2;n[s++]=o?Math.min(i,1-(1-l)*rwe):Math.min(i,l*rwe)}return n}var XD;(function(t){t[t.DISTANCE=0]="DISTANCE",t[t.PRESSURE=1]="PRESSURE"})(XD||(XD={}));const Ekt=.1,rwe=.5;let Ckt=class{constructor(e,r,i,n,s){this.resolution=e,this.normalizationScale=r,this.amplitude=i,this.variants=n,this.texture=s}dispose(){this.texture=rt(this.texture)}};const hP={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};function iwe(t){let e=null;for(const r of t){const i=r.type;if(Akt(r)){if(R(e))e=i;else if(e!==i)return"uber"}}return v(e)?e:"uber"}function nwe(t){let e=ar.INVISIBLE;for(const{material:r}of t)if(K8e(r)){if(r.color[3]*r.opacity<1)return ar.TRANSPARENT;e=ar.OPAQUE}return e}function swe(t){let e=ar.INVISIBLE;for(const{material:r}of t)if(K8e(r)){switch(r.objectTransparency){case ar.TRANSPARENT:case ar.INVISIBLE:return ar.TRANSPARENT;case ar.OPAQUE:if(r.opacity<1)return ar.TRANSPARENT}e=ar.OPAQUE}return e}function K8e(t){return t.size*t.color[3]*t.opacity>0}function Akt(t){return t.size*t.color[3]>0}function owe(t,e,r,i){for(let n=0;n<t.length;n++){const s=t[n].index,o=e[n],a=e[n+1];if(i)for(let l=o;l<a;l++){const c=i[l];r.set(c,s)}else for(let l=o;l<a;l++)r.set(l,s)}}let wf=class extends be{constructor(e){super(e),this._updatingHandles=new Hg,this._perObjectData=new Map,this._perObjectDataEvictionCache=new Set,this._renderers=new Map,this._gpuMemoryUsage=0,this._workerAbort=new AbortController,this._tmpModelPosition=P(),this._localOrigins=new ekt(new Kle(e.renderSR))}initialize(){this._worker=new Tkt(this.schedule),this._componentColorManager=new u8e(this.rctx,3);const e=s8e.createBuffer(4);for(let r=0;r<4;r++)e.sideness.set(r,0,r===0||r===3?0:1),e.sideness.set(r,1,r===0||r===1?0:1);this._verticesBufferObject=Kr.createVertex(this.rctx,zr.STATIC_DRAW,e.buffer)}destroy(){this.destroyed||(this._perObjectData.forEach(e=>this._discardObjectEntry(e)),this._perObjectData.clear(),this._strokesTexture=rt(this._strokesTexture),this._componentColorManager=ze(this._componentColorManager),this._workerAbort.abort(),this._worker.destroy(),this._verticesBufferObject=rt(this._verticesBufferObject),this._renderers.clear(),this._updatingHandles.destroy())}get updating(){return this._updatingHandles.updating}get usedMemory(){return this._gpuMemoryUsage}shouldRender(){return this._renderers.size>0}async addComponentObject(e,r,i,n,s,o,a,l){if(this.hasObject(e))return this.getObjectMemoryUsage(e);let c;const h=new lwe(new Promise(f=>c=f),i.center,i.radius);this._perObjectData.set(e,h);const p=await this._updatingHandles.addPromise(this._addComponentGeometry(r,h,n,s,o,a,l));return this.setNeedsRender(),c(),p}async addOrUpdateObject3D(e,r,i,n){if(this.destroyed)return void re.getLogger(this.declaredClass).warn("Attempt to add an object to a destroyed instance");const s=this._perObjectData.get(e);let o;(s==null?void 0:s.renderables.length)>0&&this._perObjectDataEvictionCache.add(s);const a=e.boundingVolumeWorldSpace.bounds,l=new lwe(new Promise(h=>o=h),a,i_(a));this._perObjectData.set(e,l);const c=new Array;if(i.mergeGeometries&&e.geometries.length>1&&Rkt(e))c.push(this._addObjectMergedGeometries(e,l,r,i,n));else for(let h=0;h<e.geometries.length;h++){const p=e.geometries[h];p.material.supportsEdges&&c.push(this._addGeometry(e,l,p,r[0],i,n))}await this._updatingHandles.addPromise(Promise.all(c)),this._perObjectDataEvictionCache.delete(l),this._discardObjectEntry(s),this.setNeedsRender(),o()}_discardObjectEntry(e){e&&(e.renderables.length&&(e.renderables.forEach(r=>this._removeRenderable(r)),this.setNeedsRender()),e.loaded=null)}hasObject(e){return this._perObjectData.has(e)}async updateAllComponentOpacities(e,r){const i=await this._updatingHandles.addPromise(this._getObjectEntry(e));if(R(i))return;const n=r instanceof Array?s=>r[s]:()=>r;i.renderables.forEach(s=>{const o=s.components.meta.length;for(let a=0;a<o;a++){const l=n(a),c=s.components.meta[a],h=c.index;c.material.opacity=l,s.components.buffer.textureBuffer.setDataElement(h,1,3,255*l)}this._updateTransparency(s)}),this.setNeedsRender()}async getObjectMemoryUsage(e){const r=await this._getObjectEntry(e);return v(r)?r.renderables.reduce((i,n)=>i+n.statistics.gpuMemoryUsage,0):0}async updateAllComponentMaterials(e,r,i,n){const s=e instanceof Z_,o=!!i.hasSlicePlane,a=iwe(r),l=jW.getKey(a,o,s),c=await this._updatingHandles.addPromise(this._getObjectEntry(e));R(c)||(c.renderables.forEach(h=>{if(l!==h.rendererKey){const p=this._renderers.get(h.rendererKey),f=this._acquireRenderer(a,o,s);p.removeRenderable(h),--p.refCount,h.rendererKey=l,f.addRenderable(h)}for(let p=0;p<r.length;p++)h.components.meta[p].material=r[p];n&&this._updateComponentBuffer(h.components),this._updateTransparency(h)}),this.setNeedsRender())}async updateAllVerticalOffsets(e,r){const i=await this._updatingHandles.addPromise(this._getObjectEntry(e));R(i)||(i.renderables.forEach(n=>{const s=n.components.meta;for(let o=0;o<s.length;o++)n.components.meta[o].verticalOffset=(r==null?void 0:r[o])??0;this._updateComponentBuffer(n.components)}),this.setNeedsRender())}async updateObjectVisibility(e,r){const i=await this._updatingHandles.addPromise(this._getObjectEntry(e));v(i)&&(i.renderables.forEach(n=>n.visible=r),this.setNeedsRender())}removeObject(e){const r=this._perObjectData.get(e);r&&(this._perObjectData.delete(e),this._discardObjectEntry(r))}async _getObjectEntry(e){const r=this._perObjectData.get(e);if(!r)throw new Error("no object");return await r.loaded,r.loaded==null?null:r}render(e,r){if(R(this._componentColorManager))return;this._localOrigins.updateViewMatrices(e.camera.viewMatrix);const i=e.camera.viewInverseTransposeMatrix,n=P(),s=new j7;let o=0,a=0;if(this._renderers.forEach(c=>{if(c.refCount===0)this._renderers.delete(c.key),c.dispose();else{let h=!0,p=!0;c.forEachRenderable(f=>{f.visible&&(o+=f.statistics.averageEdgeLength,a++,h&&f.regular&&(c.updateTechnique(e,!1),h=!1),p&&f.silhouette&&(c.updateTechnique(e,!0),p=!1))},r)}}),this._componentColorManager.garbageCollect(),this._componentColorManager.updateTextures(),a===0)return;const l=new rkt(40*o/a,r);he(n,i[3],i[7],i[11]),s.set(n),ce(l.transformWorldFromViewTH,s.high),ce(l.transformWorldFromViewTL,s.low),Op(l.transformViewFromCameraRelativeRS,e.camera.viewMatrix),Xu(dwe,l.transformViewFromCameraRelativeRS),Lw(l.transformNormalViewFromGlobal,dwe),l.transformProjFromView=e.camera.projectionMatrix,this._updateObjectCameraDistances(e),this._renderers.forEach(c=>{this._renderRegularEdges(c,e,l),this._renderSilhouetteEdges(c,e,l)})}_updateTransparency(e){const r=nwe(e.components.meta),i=swe(e.components.meta);r===e.edgeTransparency&&i===e.objectTransparency||(e.edgeTransparency=r,e.objectTransparency=i,this._renderers.get(e.rendererKey).setRenderablesDirty())}_computeModelTransformWithLocalOrigin(e,r,i){e.getCombinedStaticTransformation(r,i);const n=v(r.localOrigin)?this._localOrigins.register(r.localOrigin):this._localOrigins.acquire(he(this._tmpModelPosition,i[12],i[13],i[14]));return r.localOrigin=n.origin,K5t(n.origin.vec3,i),n}_updateComponentBuffer(e){const{meta:r,buffer:i}=e,n=new Uint8Array(4);for(let s=0;s<r.length;s++){const o=r[s].material,a=r[s].index,l=_e(Math.round(o.size*gkt),0,255),c=_e(o.extensionLength,-BW,255-BW)+BW,h=o.type==="solid"?e9.SOLID:e9.SKETCH,p=255*o.opacity,f=o.color,m=255*f[0],g=255*f[1],_=255*f[2],b=255*f[3];i.textureBuffer.setData(a,0,m,g,_,b),i.textureBuffer.setData(a,1,l,c,h,p),t8e(r[s].verticalOffset,n),i.textureBuffer.setData(a,2,n[0],n[1],n[2],n[3])}}_createComponentBuffers(e){if(R(this._componentColorManager))return null;const r=new Array,i=this._componentColorManager.getBuffer(e.length);for(let s=0;s<e.length;s++){const o=e[s],a=i.acquireIndex();r.push({index:a,verticalOffset:0,material:o})}const n=new Okt(i,r);return this._updateComponentBuffer(n),n}_extractEdges(e,r,i,n,s,o=s.length){return this._worker.process({data:r,indices:s,indicesLength:o,writerSettings:e,skipDeduplicate:i},this._workerAbort.signal,n)}_createRenderable(e,r,i,n,s){const o=h=>v(this._verticesBufferObject)?new Mkt(new wm(this.rctx,a8e,{vertices:t4t,instances:h===sS.REGULAR?KV.glLayout:QV.glLayout},{vertices:this._verticesBufferObject,instances:Kr.createVertex(this.rctx,zr.STATIC_DRAW,h===sS.REGULAR?e.regular.instancesData.buffer:e.silhouette.instancesData.buffer)}),h===sS.REGULAR?e.regular.lodInfo:e.silhouette.lodInfo):null,a=e.regular.lodInfo.lengths.length>0?o(sS.REGULAR):null,l=e.silhouette.lodInfo.lengths.length>0?o(sS.SILHOUETTE):null,c=(v(a)?a.vao.size:0)+(v(l)?l.vao.size:0);return new Ikt(a,l,{gpuMemoryUsage:c,externalMemoryUsage:s,averageEdgeLength:e.averageEdgeLength},i,nwe(r.meta),swe(r.meta),r,n)}async _addGeometry(e,r,i,n,s,o){const a=i.vertexAttributes.get(O.POSITION),l=i.indices.get(O.POSITION),c=$e(),h=this._computeModelTransformWithLocalOrigin(e,i,c),p=new hwe(a,l,c,h);return this._addPositionData(r,p,i.edgeIndicesLength,n,s,o)}async _addPositionData(e,r,i,n,s,o=!1){if(e.loaded==null)return;const a=this._createComponentBuffers([n]);if(R(a)||i<=0)return;const l=this._acquireRenderer(n.type,!!s.hasSlicePlane,!0),{modelTransform:c,origin:h}=r,p=r.indices,f=r.position,m=f.data.length/f.size,g=ZV.createBuffer(m);for(let w=0;w<m;w++)g.position.set(w,0,f.data[w*f.size+0]),g.position.set(w,1,f.data[w*f.size+1]),g.position.set(w,2,f.data[w*f.size+2]);owe(a.meta,[0,g.componentIndex.count],g.componentIndex);const _=await this._updatingHandles.addPromise(this._extractEdges(l.writerSettings,g,!1,o,p,i));if(e.loaded==null)return;const b=this._createRenderable(_,a,new Pkt(c,h),l.key,!1);e.renderables.push(b),l.addRenderable(b),this._gpuMemoryUsage+=b.statistics.gpuMemoryUsage}async _addComponentGeometry(e,r,i,n,s,o,a){if(r.loaded==null)return 0;const l=this._createComponentBuffers(o);if(R(l))return 0;const c=iwe(o),h=this._acquireRenderer(c,a.hasSlicePlane||!1,!1),p=ZV.createBuffer(i.count);L7(p.position,i),owe(l.meta,s,p.componentIndex,n);const f=!0,m=h.writerSettings,g=await this._updatingHandles.addPromise(this._extractEdges(m,p,f,!1,n));if(r.loaded==null)return 0;const _=this._createRenderable(g,l,e,h.key,!0);return r.renderables.push(_),h.addRenderable(_),_.statistics.gpuMemoryUsage}async _addObjectMergedGeometries(e,r,i,n,s){const o=new Map;let a=0,l=null,c=0;for(let x=0;x<e.geometries.length;x++){const T=e.geometries[x];if(!T.material.supportsEdges)continue;!l&&T.localOrigin&&(l=T);const E=T.vertexAttributes.get(O.POSITION);c+=E.data.length/E.size,a+=T.edgeIndicesLength}const h=c>=65536?Uint32Array:Uint16Array,p=a?new h(a):null,f=[];let m=0;for(let x=0;x<e.geometries.length;x++){const T=e.geometries[x];if(!T.material.supportsEdges)continue;const E=T.vertexAttributes.get(O.POSITION),C=T.indices.get(O.POSITION);let A=o.get(E.data);if(A==null){A=f.length/3;for(let I=0;I<E.data.length;I+=E.size)f.push(E.data[I+0]),f.push(E.data[I+1]),f.push(E.data[I+2]);o.set(E.data,A)}if(C)for(let I=0;I<T.edgeIndicesLength;I++)p[m++]=A+C[I]}const g=l||e.geometries[0],_=$e(),b=this._computeModelTransformWithLocalOrigin(e,g,_);for(let x=0;x<e.geometries.length;x++)e.geometries[x].localOrigin=b.origin;const w=new hwe({data:f,size:3},p,_,b);await this._updatingHandles.addPromise(this._addPositionData(r,w,p.length,i[0],n,s))}_acquireRenderer(e,r,i){const n=jW.getKey(e,r,i);let s=this._renderers.get(n);return R(this._strokesTexture)&&(this._strokesTexture=Skt(this.rctx)),s||(s=new jW(this.rctx,this.techniqueRepository,{type:e,hasSlicePlane:r,strokesTexture:this._strokesTexture,legacy:i,spherical:this.viewingMode===qe.Global}),this._renderers.set(n,s)),++s.refCount,s}_removeRenderable(e){awe(e.regular),awe(e.silhouette);const r=this._renderers.get(e.rendererKey);if(r){r.removeRenderable(e),--r.refCount,"origin"in e.transform&&this._localOrigins.release(e.transform.origin),this._gpuMemoryUsage-=e.statistics.externalMemoryUsage?0:e.statistics.gpuMemoryUsage;for(const i of e.components.meta)e.components.buffer.releaseIndex(i.index)}}_updateObjectCameraDistances(e){const r=e.camera.eye,i=e.camera.viewForward,n=P(),s=o=>{Lo(n,o.center,r);const a=ve(n,i),l=o.radius,c=a<-l?1/0:a<l?0:a-l;o.renderables.forEach(h=>h.distanceToCamera=c)};this._perObjectData.forEach(s),this._perObjectDataEvictionCache.forEach(s)}_renderRegularEdges(e,r,i){const n=e.bindRegularEdges(i,r),s=i.transparency,o=r.camera.perScreenPixelRatio;e.forEachRenderable(a=>{if(!cwe(a)||!a.visible)return;const l=Ok(a.regular.lod.lengths,a.distanceToCamera,o);e.renderRegularEdges(n,a,i,r,l)},s)}_renderSilhouetteEdges(e,r,i){const n=e.bindSilhouetteEdges(i,r),s=i.transparency,o=r.camera.perScreenPixelRatio;e.forEachRenderable(a=>{if(!uwe(a)||!a.visible)return;const l=Ok(a.silhouette.lod.lengths,a.distanceToCamera,o);e.renderSilhouetteEdges(n,a,i,r,l)},s)}get test(){return{hasRenderedPrimitives:e=>{let r=!1;const i=e.perScreenPixelRatio,n=(s,o)=>s.forEachRenderable(a=>{a.visible&&!r&&(cwe(a)&&(r=Ok(a.regular.lod.lengths,a.distanceToCamera,i)>0),!r&&uwe(a)&&(r=Ok(a.silhouette.lod.lengths,a.distanceToCamera,i)>0))},o);return this._renderers.forEach(s=>{r||(n(s,ar.OPAQUE),n(s,ar.TRANSPARENT))}),r}}}};function awe(t){v(t)&&(t.vao.vertexBuffers.instances.dispose(),t.vao.dispose(!1),t.vao=null)}function Rkt(t){let e=null,r=null;for(let i=0;i<t.geometries.length;i++){const n=t.geometries[i];if(n.material.supportsEdges){if(e){if(!g_(e,n.transformation))return!1}else e=n.transformation;if(!r&&v(n.localOrigin))r=n;else if(r&&v(r.localOrigin)&&v(n.localOrigin)&&r.localOrigin.id!==n.localOrigin.id)return!1}}return!0}u([d({constructOnly:!0})],wf.prototype,"rctx",void 0),u([d({constructOnly:!0})],wf.prototype,"renderSR",void 0),u([d({constructOnly:!0})],wf.prototype,"viewingMode",void 0),u([d({constructOnly:!0})],wf.prototype,"techniqueRepository",void 0),u([d({constructOnly:!0})],wf.prototype,"setNeedsRender",void 0),u([d({constructOnly:!0})],wf.prototype,"schedule",void 0),u([d({readOnly:!0})],wf.prototype,"_updatingHandles",void 0),u([d({readOnly:!0})],wf.prototype,"updating",null),wf=u([$("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],wf);let lwe=class{constructor(e,r,i){this.center=r,this.radius=i,this.renderables=new Array,this.loaded=e,this.loaded.then(()=>{this.loaded!=null&&(this.loaded=!0)})}},Okt=class{constructor(e,r){this.buffer=e,this.meta=r}},Mkt=class{constructor(e,r){this.vao=e,this.lod=r}},Pkt=class{constructor(e,r){this.modelMatrix=e,this.origin=r}},Ikt=class{constructor(e,r,i,n,s,o,a,l){this.regular=e,this.silhouette=r,this.statistics=i,this.transform=n,this.edgeTransparency=s,this.objectTransparency=o,this.components=a,this.rendererKey=l,this.distanceToCamera=0,this.visible=!0}};function cwe(t){return v(t.regular)}function uwe(t){return v(t.silhouette)}function Ok(t,e,r){const i=e*r,n=JBe(t,i,!0);return n===-1?i<t[0]?t.length:0:t.length-n}let hwe=class{constructor(e,r,i,n){this.position=e,this.indices=r,this.modelTransform=i,this.origin=n}};const dwe=vi();function Sy(t){return window.WebGL2RenderingContext&&t instanceof window.WebGL2RenderingContext}let pwe=class{constructor(e,r,i,n,s,o,a,l,c){this.createQuery=e,this.deleteQuery=r,this.resultAvailable=i,this.getResult=n,this.disjoint=s,this.beginTimeElapsed=o,this.endTimeElapsed=a,this.createTimestamp=l,this.timestampBits=c}},x0=!1;function $kt(t,e){if(e.disjointTimerQuery)return null;let r=t.getExtension("EXT_disjoint_timer_query_webgl2");return r&&Sy(t)?new pwe(()=>t.createQuery(),i=>{t.deleteQuery(i),x0=!1},i=>t.getQueryParameter(i,t.QUERY_RESULT_AVAILABLE),i=>t.getQueryParameter(i,t.QUERY_RESULT),()=>t.getParameter(r.GPU_DISJOINT_EXT),i=>{x0||(x0=!0,t.beginQuery(r.TIME_ELAPSED_EXT,i))},()=>{t.endQuery(r.TIME_ELAPSED_EXT),x0=!1},i=>r.queryCounterEXT(i,r.TIMESTAMP_EXT),()=>t.getQuery(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):(r=t.getExtension("EXT_disjoint_timer_query"),r?new pwe(()=>r.createQueryEXT(),i=>{r.deleteQueryEXT(i),x0=!1},i=>r.getQueryObjectEXT(i,r.QUERY_RESULT_AVAILABLE_EXT),i=>r.getQueryObjectEXT(i,r.QUERY_RESULT_EXT),()=>t.getParameter(r.GPU_DISJOINT_EXT),i=>{x0||(x0=!0,r.beginQueryEXT(r.TIME_ELAPSED_EXT,i))},()=>{r.endQueryEXT(r.TIME_ELAPSED_EXT),x0=!1},i=>r.queryCounterEXT(i,r.TIMESTAMP_EXT),()=>r.getQueryEXT(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):null)}function Lkt(t,e){const r=t.capabilities.disjointTimerQuery;return R(r)?null:new Dkt(r,e)}let Dkt=class{constructor(e,r){this._timer=e,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,r.forEach(i=>{const n=this._timer.createQuery(),s=this._timer.createQuery();this._queryPool.push(n,s),this._queryResults.set(i,null)})}start(){x0||(this._currentQuery=this._queryPool.pop(),R(this._currentQuery)||(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(e){if(this._timer.disjoint()||R(this._currentQuery)||!this._queryResults.has(e))return this.abort(),null;this._timer.endTimeElapsed();const r=this._queryResults.get(e);if(R(r))return this._queryResults.set(e,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(r))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;const i=this._timer.getResult(r)/1e6;return this._queryPool.unshift(r),this._queryResults.set(e,this._currentQuery),this._currentQuery=null,i}abort(){v(this._currentQuery)&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){v(this._currentQuery)&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach(e=>{this._timer.deleteQuery(e)}),this._queryResults.forEach(e=>{R(e)||this._timer.deleteQuery(e)})}};var Fi;(function(t){t.OVERLAY="overlay",t.PREPARE="prepare",t.SHADOW_MAP="shadow map",t.LINEAR_DEPTH="linear depth",t.ACCUMULATED_SHADOWS="accumulated shadows",t.NORMALS="normals",t.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",t.SSAO="SSAO",t.OPAQUE="opaque",t.OPAQUE_EDGES="opaque edges",t.VOXEL="voxel",t.TRANSPARENT="transparent",t.TRANSPARENT_EDGES="transparent edges",t.HUD_VISIBILITY="HUD visibility",t.TRANSPARENT_TERRAIN="transparent terrain",t.ENVIRONMENT="environment",t.LASER_LINE="laser line",t.OCCLUDED="occluded",t.ANTIALIASING="antialiasing",t.HIGHLIGHTS="highlights",t.HUD="HUD",t.HUD_OCCLUDED="HUD occluded",t.FINISH="finish"})(Fi||(Fi={}));const fwe="Total";let Nkt=class{constructor(e){this._rctx=e,this._startTimeStampCPU=0,this._lastTimeStampCPU=0,this._totalCPUTime=new B0(fwe),this._cpuTimeSamplers=new Map(Object.values(Fi).map(r=>[r,new B0(r)])),this._enableGPUTimer=0,this._totalGPUTime=new B0("GPU"),this._gpuTimeSamplers=new Map(Object.values(Fi).map(r=>[r,new B0(r)])),this._totalTime=0,this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return v(this._gpuTimerPool)}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return performance.now()-this._startTimeStampCPU}enableGPUPerformanceInfo(){if(R(this._gpuTimerPool)){const e=[...Object.values(Fi),fwe];this._gpuTimerPool=Lkt(this._rctx,e)}return R(this._gpuTimerPool)?{hasGPUTimerSupport:!1,remove:()=>{}}:(++this._enableGPUTimer,{hasGPUTimerSupport:!0,remove:zie(()=>{--this._enableGPUTimer,this._enableGPUTimer===0&&(this._gpuTimerPool=rt(this._gpuTimerPool))})})}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=performance.now(),v(this._gpuTimerPool)&&this._gpuTimerPool.start()}advance(e){const r=performance.now();if(this._cpuTimeSamplers.get(e).record(r-this._lastTimeStampCPU),this._lastTimeStampCPU=r,v(this._gpuTimerPool)){const i=this._gpuTimerPool.stop(e);this._gpuTimeSamplers.get(e).record(i),this._gpuTimerPool.start()}}finishFrame(){if(v(this._gpuTimerPool)){const r=this._gpuTimerPool.stop(Fi.FINISH);this._gpuTimeSamplers.get(Fi.FINISH).record(r)}const e=performance.now()-this._startTimeStampCPU;this._totalTime=this._totalTime+e,this._totalCPUTime.record(e),v(this._gpuTimerPool)&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce((r,i)=>r+(i.last||0),0)),++this._totalFrameCount}},wh=class extends be{get _bindParameters(){return this._renderContext.bindParameters}isFeatureEnabled(e,r=this._state){return Nt(this._renderStateFeatures.get(r,e),!1)}setFeatureEnabled(e,r,i){this._renderStateFeatures.set(r,e,i),this.notifyChange("_renderStateFeatures"),this._requestRender()}get _antialiasing(){return this._antialiasingEnabled||this.isFeatureEnabled(ss.Antialiasing)}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(ss.HighQualityTransparency)}get hasWaterReflection(){return this.hasWater&&(this._waterReflectionEnabled||this.isFeatureEnabled(ss.WaterReflection))}get hasWater(){return this._hasWater||this._hasOverlayWater}constructor(e,r,i,n,s,o,a,l){super({}),this._stage=e,this._materialRepository=r,this._shaderTechniqueRepository=n,this._rctx=s,this._compositingHelper=o,this._magnifierHelper=a,this._requestRender=l,this._materialRenderers=new Wt,this._needsTransparentPass=!1,this._hasHUDElements=!1,this._hasHighlights=!1,this._hasWater=!1,this._hasOverlayWater=!1,this._renderOverlay=c=>{},this._isRendering=!1,this._fallbackDepthStencilTexture=null,this._sliceHelper=new j5t,this._state=Mr.IDLE,this._renderStateFeatures=s0e(),this._antialiasingEnabled=!0,this._highQualityTransparencyEnabled=!0,this._terrainRenderingEnabled=!0,this._terrainTransparency=no.Opaque,this._waterReflectionEnabled=!1,this._ssaoEnabled=!1,this._hasAnimations=!1,this._animationTimestep=new Q4t,this._handles=new qr,this._renderHiddenTransparentEdges=()=>{},this._oitUsed=!1,this._smaaPass=new ZI(this._rctx,n),l(),this._offscreen=new v5t(this._rctx,this._compositingHelper),this.performanceInfo=new Nkt(this._rctx),this._shadowMap=new Qle(this._rctx,e.viewingMode),this._ssaoHelper=new bke(e.view,n,this._rctx,l),this._highlight=new m5t(n,this._rctx),this._shadowHighlight=new B5t(this._rctx,e.viewingMode),this._shadowAccumulator=new Cc(this._rctx,n,e,c=>{const h=this.shadowsEnabled;this._shadowMap.enabled=!0,this._prepare(c.camera,c.contentCamera),this._renderPlugins.prepareRender(),this._shadowMap.enabled=h},(c,h,p)=>{c.shadowMap.start(c.camera,h,p),this._renderShadowCascades(V.Shadow,c.shadowMap),c.camera.setGLViewport(this._rctx),this._prepare(c.camera,c.contentCamera)},l),this._renderContext=new mAt(this._rctx,this._offscreen,this._shadowMap,this._ssaoHelper,this._sliceHelper),this._renderPlugins=new x5t({renderContext:this._renderContext,techniqueRepository:n,textureRepository:i,materialRepository:this._materialRepository,requestRender:l,controller:e}),this.renderPassManager=new K4t(this._rctx,this._shaderTechniqueRepository),this._renderPlugins.add(this.renderPassManager.slots(),this.renderPassManager),this._handles.add([ne(()=>this._stage.view.state.camera,()=>l(),Wi),ne(()=>Qr.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,c=>{this._renderHiddenTransparentEdges=c?()=>this._renderEdges(ar.TRANSPARENT):()=>{},l()},Vt),ne(()=>this._ssaoEnabled||this.isFeatureEnabled(ss.SSAO),c=>this._ssaoHelper.enabled=c,Wi)])}normalizeCtorArgs(){return{}}destroy(){this._handles.destroy(),this._smaaPass.dispose(),this._gpuTimerHandle=$i(this._gpuTimerHandle),this._materialRenderers.forAll(e=>e.dispose()),this._materialRenderers.clear(),this._offscreen.dispose(),this._fallbackDepthStencilTexture=rt(this._fallbackDepthStencilTexture),this._shadowMap.dispose(),this._ssaoHelper.dispose(),this._highlight.dispose(),this._shadowHighlight.dispose(),this._shadowAccumulator.dispose(),TNe.prune()}disposeOffscreenBuffers(){this._offscreen.dispose(),this._shadowMap.disposeOffscreenBuffers(),this._smaaPass.disable(),this._ssaoHelper.disposeOffscreenBuffers()}get updating(){return this._antialiasing&&this._smaaPass.updating||v(this._edgeView)&&this._edgeView.updating||this._shadowAccumulator.running||!this.isCameraFinal}ensureEdgeView(){return R(this._edgeView)&&(this._edgeView=new wf({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniqueRepository:this._shaderTechniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:e=>this._stage.view.resourceController.immediate.schedule(e)}),this._handles.add(ne(()=>Fo(this._edgeView,e=>e.updating),()=>this._requestRender(),Zr)),this._requestRender()),this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return rse(this._bindParameters.ssr.reprojectionMatrix,id)}set _reprojectionMatrix(e){Oie(this._bindParameters.ssr.reprojectionMatrix,e)&&this.notifyChange("isCameraFinal")}get shadowsEnabled(){var e;return!!((e=this._shadowMap)!=null&&e.enabled)}setParameters(e){const{_shadowMap:r,_bindParameters:i}=this;if(e.screenSpaceReflectionsEnabled!==void 0&&i.ssr.enabled!==e.screenSpaceReflectionsEnabled&&(i.ssr.enabled=e.screenSpaceReflectionsEnabled,this._requestRender()),e.shadowMap!==void 0&&this._shadowMap.enabled!==e.shadowMap&&(this._shadowMap.enabled=e.shadowMap,this._requestRender()),e.shadowMapMaxCascades!==void 0&&r.maxCascades!==e.shadowMapMaxCascades&&(r.maxCascades=e.shadowMapMaxCascades,this._requestRender()),v(e.environment)){v(e.environment.weather)&&(this._bindParameters.weather=e.environment.weather,this._bindParameters.weatherVisible=!!e.weatherVisible),e.environment.lighting.ambientOcclusionEnabled!==void 0&&this._ssaoEnabled!==e.environment.lighting.ambientOcclusionEnabled&&(this._ssaoEnabled=e.environment.lighting.ambientOcclusionEnabled,this._requestRender()),e.environment.lighting.waterReflectionEnabled!==void 0&&this._waterReflectionEnabled!==e.environment.lighting.waterReflectionEnabled&&(this._waterReflectionEnabled=e.environment.lighting.waterReflectionEnabled,this._requestRender());const n=e.environment.lighting.type!=="virtual";i.enableFillLights!==n&&(i.enableFillLights=n,this._requestRender())}e.background&&this._offscreen.background!==e.background&&(this._offscreen.background=e.background,this._requestRender()),e.antialiasingEnabled!==void 0&&this._antialiasingEnabled!==e.antialiasingEnabled&&(this._antialiasingEnabled=e.antialiasingEnabled,this._requestRender()),e.highQualityTransparency!==void 0&&this._highQualityTransparencyEnabled!==e.highQualityTransparency&&(this._highQualityTransparencyEnabled=e.highQualityTransparency,this._requestRender()),e.defaultHighlightOptions!==void 0&&(this._highlight.setDefaultOptions(e.defaultHighlightOptions),this._shadowHighlight.setDefaultOptions(e.defaultHighlightOptions),this._requestRender()),e.overlays!==void 0&&this._bindParameters.overlays!==e.overlays&&(this._bindParameters.overlays=e.overlays,this._requestRender()),e.hasOverlayWater!==void 0&&this._hasOverlayWater!==e.hasOverlayWater&&(this._hasOverlayWater=e.hasOverlayWater,this._requestRender()),e.renderOverlay!==void 0&&this._renderOverlay!==e.renderOverlay&&(this._renderOverlay=e.renderOverlay,this._requestRender()),e.slicePlane!==void 0&&this._sliceHelper.plane!==e.slicePlane&&(this._sliceHelper.plane=e.slicePlane,this._requestRender()),e.terrainRenderingEnabled!==void 0&&this._terrainRenderingEnabled!==e.terrainRenderingEnabled&&(this._terrainRenderingEnabled=e.terrainRenderingEnabled,this._requestRender()),e.terrainTransparency!==void 0&&this._terrainTransparency!==e.terrainTransparency&&(this._terrainTransparency=e.terrainTransparency,this._requestRender()),e.shadowCastOptions!==void 0&&this._shadowAccumulator.setOptions(e.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&this._hasOITSupport}modify(e,r){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:i,removes:n,updates:s}=e;if(i.length===0&&n.length===0&&s.length===0)return;const o=tke(e);let a=!1;o.forEach((l,c)=>{if(r.done)return;let h=this._materialRenderers.find(p=>p.material===c);R(h)&&l.adds.length>0&&(h=new pke(this._rctx,this._materialRepository,c),this._materialRenderers.push(h)),h&&(h.modify(l),h.isEmpty&&(a=!0)),l.removes.forEach(p=>e.removes.removeUnordered(p)),l.adds.forEach(p=>e.adds.removeUnordered(p)),l.updates.forEach(p=>e.updates.removeUnordered(p)),r.madeProgress()}),a&&this._materialRenderers.filterInPlace(l=>!l.isEmpty||(l.dispose(),!1)),this._hasHighlights=this._materialRenderers.some(l=>l.hasHighlights),this._bindParameters.hasOccludees=this._materialRenderers.some(l=>l.hasOccludees),this._hasWater=this._materialRenderers.some(l=>l.hasWater),this._hasHUDElements=this._materialRenderers.some(l=>l.requiresSlot(Ee.LINE_CALLOUTS_HUD_DEPTH,V.Color)||l.requiresSlot(Ee.HUD_MATERIAL,V.Color)||l.requiresSlot(Ee.LABEL_MATERIAL,V.Color)),this._requestRender()}updateAnimation(e){const r=this._hasAnimations;return this._hasAnimations=!1,this._materialRenderers.forAll(i=>this._hasAnimations=i.updateAnimation(e)||this._hasAnimations),this._hasAnimations=this._renderPlugins.updateAnimation(e)||this._hasAnimations,this._hasAnimations!==r&&(this._gpuTimerHandle=r?$i(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo()),this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}render(e,r,i,n,s){this._isRendering=!0,this.performanceInfo.startFrame();const{camera:o,contentCamera:a,mode:l}=i;this._state=l,this._renderOverlay(s),this.performanceInfo.advance(Fi.OVERLAY),this._renderContext.time=s,this._bindParameters.transparencyPassType=At.NONE;const c=this._offscreen;c.setupRenderTarget(this.hasWaterReflection);const h=k_(this._sliceHelper.plane);n===m2.OFF&&(this._sliceHelper.plane=null),this._rctx.bindFramebuffer(e),o.setGLViewport(this._rctx),this._prepare(o,a),this._renderPlugins.prepareRender(),this.performanceInfo.advance(Fi.PREPARE);const p=this._computeDepthRange(o);this._renderShadowMap(e,o,this._bindParameters.lighting.mainLight.direction,p),this.performanceInfo.advance(Fi.SHADOW_MAP),c.initializeFrame(o),this._ensureBindParameters(o,a),this._renderLinearDepth(),this.performanceInfo.advance(Fi.LINEAR_DEPTH),this._accumulateShadows(p,o,a),this.performanceInfo.advance(Fi.ACCUMULATED_SHADOWS),this._renderNormal(),this.performanceInfo.advance(Fi.NORMALS),this._ensureBindParametersSSR(s),this._renderSSAO(s),this.performanceInfo.advance(Fi.SSAO),this._renderContext.output=V.Color,c.bindFramebuffer(),this._renderOpaqueGeometry(),this.performanceInfo.advance(Fi.OPAQUE);const f=this._terrainRenderingEnabled&&(this._terrainTransparency===no.Semitransparent||this._terrainTransparency===no.TransparentWithDraped),m=this._highQualityTransparency&&f;this._renderTerrainLinearDepth(m),this._setMultipassEnabled(m),this._setTerrainCulling(m),this._renderEdges(ar.OPAQUE),this.performanceInfo.advance(Fi.OPAQUE_EDGES),this._offscreen.bindTarget(this._offscreen.currentColorTarget,this._offscreen.mainDepth),this._renderSlot(Ee.VOXEL),this.performanceInfo.advance(Fi.VOXEL),this._renderHiddenTransparentEdges();const g=this._needsTransparentPass||this._renderPlugins.needsTransparentPass;g&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(Fi.TRANSPARENT),this._renderGeometryLinearDepth(m);const _=this._renderHUDVisibility(m);m||this._renderInternalSlot(Ee.LINE_CALLOUTS),this.performanceInfo.advance(Fi.HUD_VISIBILITY),this._renderObjectAndLayerIdColor(r),this.performanceInfo.advance(Fi.OBJECT_AND_LAYER_ID_COLOR),this._renderEdges(ar.TRANSPARENT,m),this.performanceInfo.advance(Fi.TRANSPARENT_EDGES),this._renderTransparentTerrain(),f&&_&&(m?this._renderLineCallouts(Rh.Occluded):c.compositeTransparentTerrainOntoHUDVisibility(this._bindParameters),this._renderHUD(Rh.Occluded,c.framebuffer),this.performanceInfo.advance(Fi.HUD_OCCLUDED)),this.performanceInfo.advance(Fi.TRANSPARENT_TERRAIN),this._setTerrainCulling(!1),f&&(c.compositeTransparentTerrainOntoMain(this._bindParameters),m&&(this._renderEdges(ar.OPAQUE),this.performanceInfo.advance(Fi.OPAQUE_EDGES),g&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(Fi.TRANSPARENT),this._renderEdges(ar.TRANSPARENT),this.performanceInfo.advance(Fi.TRANSPARENT_EDGES))),m&&this._renderLineCallouts(Rh.NotOccluded),this._setMultipassEnabled(!1),this._shadowAccumulator.render(this._bindParameters),c.renderToTargets(()=>{this._renderInternalSlot(Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderSlot(Ee.POSTPROCESSING_ENVIRONMENT_TRANSPARENT),this._renderSlot(Ee.LASERLINES)},c.currentColorTarget,c.mainDepth),this.performanceInfo.advance(Fi.ENVIRONMENT),this._renderPlugins.needsLaserlineWithContrastControl&&c.renderTmpAndCompositeToMain(()=>this._renderSlot(Ee.LASERLINES_CONTRAST_CONTROL),this._bindParameters,al.PremultipliedAlpha),this.performanceInfo.advance(Fi.LASER_LINE),this._renderOccluded(),this.performanceInfo.advance(Fi.OCCLUDED);const b=n===m2.ON&&this._magnifierHelper.enabled,w=b&&R(e)?this._offscreen.getFramebuffer(this._offscreen.tmpColor,this._offscreen.tmpDepth):e;this._rctx.bindFramebuffer(w);const x=this._offscreen.colorTexture;!this._renderAntiAliasing(x)&&v(x)&&this._compositingHelper.composite(this._bindParameters,x,al.None),this.performanceInfo.advance(Fi.ANTIALIASING),this._renderHUD(Rh.NotOccluded,w),this.performanceInfo.advance(Fi.HUD),this._renderHighlights(w,this._bindParameters),this.performanceInfo.advance(Fi.HIGHLIGHTS),b&&this._magnifierHelper.render(this._rctx,this._bindParameters),w!==e&&(this._rctx.bindFramebuffer(e),this._compositingHelper.composite(this._bindParameters,this._offscreen.tmpColorTexture,al.None)),this._disposeOITBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=h,this._isRendering=!1,this.onPostRender&&this.onPostRender(),this.performanceInfo.finishFrame()}_renderObjectAndLayerIdColor(e){if(v(e)&&ue("enable-feature:objectAndLayerId-rendering")){const r=this._renderContext.output;this._rctx.bindFramebuffer(e),this._offscreen.renderToFBO(()=>this._renderGeometryAndTransparentTerrainPass(V.ObjectAndLayerIdColor),[0,0,0,0],!0,!0),this._rctx.bindFramebuffer(e),this._offscreen.renderToFBO(()=>{this._bindParameters.renderTransparentlyOccludedHUD=Rh.NotOccluded,this._renderInternalSlot(Ee.HUD_MATERIAL)},void 0,!0,!0),this._renderContext.output=r}}finish(e){this._hasAnimations||this._animationTimestep.clear();const r=this.performanceInfo.gpuSamplingEnabled,i=e===Gn.BACKGROUND;if(i||r){const n=i?this.performanceInfo.elapsedTime:0,s=r?this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError(),o=Math.max(n,s);this._animationTimestep.frame(o,i)}}readDepthPixels(e,r,i){const n=this._offscreen.bindTarget(this._offscreen.linearDepth,this._offscreen.tmpDepth);if(!this._needsLinearDepth){this._ensureBindParameters(e,e),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const s=Hi.COLOR_BUFFER_BIT|Hi.DEPTH_BUFFER_BIT|Hi.STENCIL_BUFFER_BIT;this._rctx.clearSafe(s),this._renderGeometryAndTransparentTerrainPass(V.Depth)}n.readPixels(r[0],r[1],r[2],r[3],Ge.RGBA,kt.UNSIGNED_BYTE,i)}readHUDVisibility(e,r,i,n,s){this._offscreen.bindTarget(this._offscreen.hudVisibility).readPixels(e,r,i,n,Ge.RGBA,kt.UNSIGNED_BYTE,s)}readAccumulatedShadow(e){return this._shadowAccumulator.readAccumulatedShadow(e[0],e[1])}_setMultipassEnabled(e){this._bindParameters.multipassTerrain.enabled=this._bindParameters.multipassGeometry.enabled=e}_setTerrainCulling(e){this._bindParameters.multipassTerrain.cullAboveGround=e}_renderSlot(e){this._bindParameters.slot=e,this._renderPlugins.render()}_renderEdges(e,r=!1){const i=this._edgeView;v(i)&&i.shouldRender()&&this._offscreen.renderTmpAndCompositeToMain(()=>i.render(this._bindParameters,e),this._bindParameters,al.Alpha,r)}_renderShadowMap(e,r,i,n){const s=this._shadowMap;s.enabled&&this.isFeatureEnabled(ss.ShadowMapUpdate)&&(s.start(r,i,n),this._shadowHighlight.updateParameters(r,i),this._needsShadowHighlight?(this._renderShadowCascades(V.ShadowHighlight,this._shadowMap,o=>s.takeCascadeSnapshotTo(o,KO.Highlight)),s.clear(),this._renderShadowCascades(V.ShadowExcludeHighlight,this._shadowMap,o=>{s.takeCascadeSnapshotTo(o,KO.Default),this._renderGeometryAndTransparentTerrainPass(V.ShadowHighlight)})):this._renderShadowCascades(V.Shadow),s.finish(e),r.setGLViewport(this._rctx))}_renderShadowCascades(e,r=this._shadowMap,i=n=>{}){for(const n of r.cascades)n.camera.setGLViewport(this._rctx),this._prepare(n.camera,n.camera),this._renderGeometryAndTransparentTerrainPass(e),i(n)}get _needsLinearDepth(){return this._ssaoHelper.active||this._renderPlugins.needsLinearDepth||this.hasWaterReflection||this._needsShadowHighlight||this._needsShadowCast}_renderLinearDepth(){this._needsLinearDepth?this._offscreen.renderToTargets(()=>this._renderGeometryAndTransparentTerrainPass(V.Depth),this._offscreen.linearDepth,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.linearDepth),this._bindParameters.linearDepthTexture=this._offscreen.linearDepthTexture}_renderTerrainLinearDepth(e){if(e){const r=this._renderContext.output;this._renderContext.output=V.Depth,this._offscreen.renderToTargets(()=>this._renderTransparentTerrain(),this._offscreen.terrainLinearDepth,this._offscreen.tmpDepth,[-1e10,-1e10,-1e10,1],!0,!0),this._renderContext.output=r}else this._offscreen.disposeTarget(this._offscreen.terrainLinearDepth);this._bindParameters.multipassTerrain.linearDepthTexture=this._offscreen.terrainLinearDepthTexture}_renderGeometryLinearDepth(e){if(e){const r=this._renderContext.output;this._offscreen.renderToTargets(()=>this._renderGeometryPass(V.Depth),this._offscreen.geometryLinearDepth,this._offscreen.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.output=r}else this._offscreen.disposeTarget(this._offscreen.geometryLinearDepth);this._bindParameters.multipassGeometry.linearDepthTexture=this._offscreen.geometryLinearDepthTexture}get _needsNormal(){return this._ssaoHelper.active}_renderNormal(){this._needsNormal?this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(V.Normal)},this._offscreen.normal,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.normal)}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowCast}_computeDepthRange(e){if(!this._needsDepthRange)return nre;const r=D4t(e,this._materialRenderers,this._stage.layers);return r3(r,this.renderPlugins.queryDepthRange(e)),r.near=Math.max(e.near,r.near),r.far=Math.min(e.far,r.far),r}_renderGeometryAndTransparentTerrainPass(e){this._renderContext.output=e,this._renderGeometryPass(e),this._renderTransparentTerrain()}_renderGeometryPass(e){this._renderContext.output=e,this._renderOpaqueGeometry(),this._renderTransparentGeometry()}_renderSSAO(e){this._ssaoHelper.render(this._bindParameters,e,this._offscreen.linearDepthTexture,this._offscreen.normalTexture)}_renderOpaqueGeometry(){this._renderSlot(Ee.INTEGRATED_MESH),this._renderSlot(Ee.OPAQUE_TERRAIN),this._renderInternalSlot(Ee.OPAQUE_MATERIAL),this._renderSlot(Ee.OPAQUE_MATERIAL),this._renderSlot(Ee.POSTPROCESSING_ENVIRONMENT_OPAQUE)}_renderTransparentGeometry(){this._renderInternalSlot(Ee.TRANSPARENT_MATERIAL),this._renderSlot(Ee.TRANSPARENT_MATERIAL)}_renderTransparentTerrain(){this._renderSlot(Ee.TRANSPARENT_TERRAIN)}_renderHUDVisibility(e){let r=!1;return this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper.hudVisibilityTexture,r=this._renderInternalSlot(Ee.OCCLUSION_PIXELS)},e),r}_renderLineCallouts(e){this._bindParameters.renderTransparentlyOccludedHUD=e,e===Rh.Occluded?this._offscreen.renderToTargets(()=>this._renderInternalSlot(Ee.LINE_CALLOUTS),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderInternalSlot(Ee.LINE_CALLOUTS)}_renderHUD(e,r){this._hasHUDElements&&(this._oitEnabled?(this._renderOrderIndependentTransparency(()=>this._renderHUDElements(e),!0),this._rctx.bindFramebuffer(r),this._compositingHelper.composite(this._bindParameters,this._offscreen.hudColorTexture,al.PremultipliedAlpha)):e===Rh.Occluded?this._offscreen.renderToTargets(()=>this._renderHUDElements(Rh.Occluded),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderHUDElements(e))}_renderHUDElements(e){this._bindParameters.renderTransparentlyOccludedHUD=e,this._renderInternalSlot(Ee.LINE_CALLOUTS_HUD_DEPTH),this._renderInternalSlot(Ee.HUD_MATERIAL),this._renderInternalSlot(Ee.LABEL_MATERIAL)}get _needsHighlight(){return this._hasHighlights||this._renderPlugins.needsHighlight}get _needsShadowHighlight(){return this._shadowMap.enabled&&this._shadowHighlight.isVisible&&this._needsHighlight}_renderHighlights(e,r){if(!this._needsHighlight)return void this._offscreen.disposeTarget(this._offscreen.highlight);const i=this._highlight,n=this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(V.Highlight),this._rctx.clearSafe(Hi.DEPTH_BUFFER_BIT),this._renderHUDElements(Rh.Both)},this._offscreen.highlight,this._offscreen.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=n.colorTexture,this._needsShadowHighlight&&this._shadowHighlight.render(r,e),i.render(this._bindParameters,n,e)}get _needsShadowCast(){return this._shadowAccumulator.isAccumulating}_accumulateShadows(e,r,i){this._needsShadowCast&&v(this._offscreen.linearDepthTexture)&&this._shadowAccumulator.renderAccumulation(this._offscreen.linearDepthTexture,e,r,i)}_renderOrderIndependentTransparency(e,r){const i=s=>{this._bindParameters.transparencyPassType=s,this._offscreen.renderOITPass(()=>e(),s,r)},n=this._renderContext.output;this._renderContext.output=V.Alpha,i(At.Alpha),this._renderContext.output=V.Color,i(At.Color),i(At.FrontFace),this._offscreen.compositeTransparentOntoOpaque(this._bindParameters,r),this._bindParameters.transparencyPassType=At.NONE,this._renderContext.output=n,this._oitUsed=!0}_disposeOITBuffers(){this._oitUsed||(this._offscreen.disposeTarget(this._offscreen.alphaFloatTarget),this._offscreen.disposeTarget(this._offscreen.colorFloatTarget),this._offscreen.disposeTarget(this._offscreen.frontFaceTarget)),this._oitUsed=!1}_renderOccluded(){let e=0;Kp.clear(),this._materialRenderers.forAll(o=>{o.material&&o.material.isVisible()&&o.material.renderOccluded===vn.OccludeAndTransparentStencil&&(e|=o.material.renderOccluded,Kp.push(o))});const r=this._offscreen,i=(o,a,l,c,h)=>{e&a&&(r.renderToTargets(l,r.tmpColor,r.mainDepth,[0,0,0,0],c,h),r.compositeOccludedOntoMain(this._bindParameters,o))};Kp.length!==0&&(this._renderInternalSlot(Ee.OCCLUDER_MATERIAL,Kp),i(.5,vn.OccludeAndTransparentStencil,()=>this._renderInternalSlot(Ee.TRANSPARENT_OCCLUDER_MATERIAL,Kp),!1,!1)),Kp.clear(),this._materialRenderers.forAll(o=>{o.material&&o.material.isVisible()&&(o.material.renderOccluded===vn.OccludeAndTransparent||o.material.renderOccluded===vn.Transparent||o.material.renderOccluded===vn.Opaque)&&(e|=o.material.renderOccluded,Kp.push(o))});const n=this._renderPlugins.renderOccludedFlags;if(e|=n,!e)return;const s=o=>{this._renderContext.renderOccludedMask=o,n>vn.Occlude&&this._renderSlot(Ee.OCCLUDED_TERRAIN),this._renderInternalSlot(Ee.OPAQUE_MATERIAL,Kp),this._renderInternalSlot(Ee.TRANSPARENT_MATERIAL,Kp),this._renderInternalSlot(Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,Kp),this._renderContext.resetRenderOccludedMask()};this._renderContext.output=V.Color,i(.5,vn.OccludeAndTransparent,()=>s(vn.OccludeAndTransparent),!0,jc.OutlineVisualElementMask),i(.5,vn.Transparent,()=>s(vn.Transparent),!0,jc.OutlineVisualElementMask),i(1,vn.Opaque,()=>s(vn.Opaque),!0,jc.OutlineVisualElementMask),Kp.clear()}_renderAntiAliasing(e){if(this._antialiasing){if(this._smaaPass.enable(()=>this._requestRender())&&v(e))return this._smaaPass.render(e),!0}else this._smaaPass.disable();return!1}_prepare(e,r){this._needsTransparentPass=this._materialRenderers.some(i=>i.requiresSlot(Ee.TRANSPARENT_MATERIAL,V.Color)),this._bindParameters.camera=e,this._bindParameters.contentCamera=r}_ensureBindParameters(e,r){this._bindParameters.camera=e,this._bindParameters.contentCamera=r;const i=this._renderContext.offscreenRenderingHelper;this._bindParameters.hudVisibilityTexture=i.hudVisibilityTexture,this._bindParameters.mainColorTexture=i.mainColorTexture,this._bindParameters.highlightDepthTexture=i.depthTexture??this._getFallbackDepthTexture()}_ensureBindParametersSSR(e){if(this._bindParameters.ssr.enabled=this.hasWaterReflection,this._bindParameters.ssr.enabled){R(this._waterReflectionEnableTime)&&(this._waterReflectionEnableTime=e),this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=id:(ya(gwe,this._bindParameters.camera.viewMatrix),ya(mwe,this._bindParameters.camera.projectionMatrix),Mn(pC,gwe,mwe),Mn(pC,this._renderContext.lastFrameCamera.viewMatrix,pC),Mn(pC,this._renderContext.lastFrameCamera.projectionMatrix,pC),this._reprojectionMatrix=pC),this._bindParameters.ssr.lastFrameColorTexture=this._offscreen.lastFrameColorTexture;const r=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=r>0?Math.min(r,e-this._waterReflectionEnableTime)/r:1,this._bindParameters.ssr.fadeFactor<1&&this._requestRender()}else this._bindParameters.ssr.lastFrameColorTexture=null,this._waterReflectionEnableTime=null}_renderInternalSlot(e,r=this._materialRenderers){let i=!1;return this._bindParameters.slot=e,r.forAll(n=>{n.material.shouldRender(this._renderContext)&&n.render(this._renderContext.output,this._bindParameters)&&(i=!0)}),i}_getFallbackDepthTexture(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=TDe(this._rctx)),this._fallbackDepthStencilTexture}get gpuMemoryUsage(){var e,r,i,n,s;return{offscreen:((e=this._offscreen)==null?void 0:e.gpuMemoryUsage)??0,highlights:(((r=this._highlight)==null?void 0:r.gpuMemoryUsage)??0)+(((i=this._shadowHighlight)==null?void 0:i.gpuMemoryUsage)??0),shadows:((n=this._shadowMap)==null?void 0:n.gpuMemoryUsage)??0,ssao:((s=this._ssaoHelper)==null?void 0:s.gpuMemoryUsage)??0}}get test(){const e=this;return{offscreen:this._offscreen,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,weatherIsFading:this._bindParameters.cloudsFade.isFading,resetRenderStateFeatures:()=>{e._renderStateFeatures=s0e()},getFramebufferTexture:r=>{switch(r){case V1.Color:return e._offscreen.colorTexture;case V1.LinearDepth:return e._offscreen.linearDepthTexture;case V1.Normals:return e._offscreen.normalTexture;case V1.ShadowMap:return e._shadowMap.depthTexture;case V1.HudVisibility:return e._offscreen.hudVisibilityTexture;case V1.Highlight:return e._offscreen.highlightTexture}}}}};var V1;u([d()],wh.prototype,"_shadowAccumulator",void 0),u([d()],wh.prototype,"_state",void 0),u([d()],wh.prototype,"_renderStateFeatures",void 0),u([d()],wh.prototype,"_antialiasingEnabled",void 0),u([d({readOnly:!0})],wh.prototype,"_antialiasing",null),u([d()],wh.prototype,"_ssaoEnabled",void 0),u([d()],wh.prototype,"_smaaPass",void 0),u([d({autoDestroy:!0})],wh.prototype,"_edgeView",void 0),u([d()],wh.prototype,"updating",null),u([d()],wh.prototype,"isCameraFinal",null),wh=u([$("esri.views.3d.webgl-engine.lib.Renderer")],wh),function(t){t[t.Color=0]="Color",t[t.LinearDepth=1]="LinearDepth",t[t.Normals=2]="Normals",t[t.ShadowMap=3]="ShadowMap",t[t.HudVisibility=4]="HudVisibility",t[t.Highlight=5]="Highlight"}(V1||(V1={}));const Kp=new Wt,mwe=$e(),gwe=$e(),pC=$e();let ywe=class{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:Ce.ONE,dstRGB:Ce.ZERO,srcAlpha:Ce.ONE,dstAlpha:Ce.ZERO},this.blendEquation={mode:hy.ADD,modeAlpha:hy.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=Wf.BACK,this.frontFace=BO.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=zi.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:Wf.FRONT_AND_BACK,func:zi.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:Wf.FRONT_AND_BACK,fail:Zn.KEEP,zFail:Zn.KEEP,zPass:Zn.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.uniformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}},Fkt=class{constructor(e){this._allocations=new Map,e?Error.stackTraceLimit=1/0:(this.add=()=>{},this.remove=()=>{})}add(e){this._allocations.set(e,new Error().stack)}remove(e){this._allocations.delete(e)}get information(){let e="";if(this._allocations.size>0){e+=`${this._allocations.size} live object allocations:
`;const r=new Map;this._allocations.forEach(i=>{r.set(i,(r.get(i)??0)+1)}),r.forEach((i,n)=>{const s=n.split(`
`);s.shift(),s.shift(),e+=`${i}: ${s.shift()}
`,s.forEach(o=>e+=`   ${o}
`)})}return e}};const kkt={RECORD_ALLOCATIONS:!1};let Ukt=class{constructor(){for(this._current=new Array,this._max=new Array,this._allocations=new Fkt(kkt.RECORD_ALLOCATIONS);this._current.length<ho.COUNT;)this._current.push(0),this._max.push(0)}resetMax(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)}increment(e,r){const i=++this._current[e];this._max[e]=Math.max(i,this._max[e]),this._allocations.add(r)}decrement(e,r){--this._current[e],this._allocations.remove(r)}get max(){return this._max}get current(){return this._current}get total(){return this.current.reduce((e,r)=>e+r,0)}get resourceInformation(){let e="";if(this.total>0){e+=`Live objects:
`;for(let r=0;r<ho.COUNT;++r){const i=this._current[r];i>0&&(e+=`${ho[r]}: ${i}
`)}}return e+=this._allocations.information,e}};const zkt=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var _we,pre={},Vkt={get exports(){return pre},set exports(t){pre=t}};(_we=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(Vkt.exports=_we);const Bkt=pre;var vwe,fre={},jkt={get exports(){return fre},set exports(t){fre=t}};vwe=jkt,function(t){var e=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];e!==void 0&&(vwe.exports=e)}();const bwe=fre;var mre={},Gkt={get exports(){return mre},set exports(t){mre=t}};(function(t){(function(e){var r=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"]}();r!==void 0&&(t.exports=r)})()})(Gkt);const Hkt=mre;var Qp=999,wwe=9999,HW=0,qW=1,xwe=2,Twe=3,Swe=4,Mk=5,qkt=6,Wkt=7,Xkt=8,Ewe=9,Ykt=10,Cwe=11,Zkt=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function Jkt(){var t,e,r,i=0,n=0,s=Qp,o=[],a=[],l=1,c=0,h=0,p=!1,f=!1,m="";return function(B){return a=[],B!==null?_(B.replace?B.replace(/\r\n/g,`
`):B):b()};function g(B){B.length&&a.push({type:Zkt[s],data:B,position:h,line:l,column:c})}function _(B){var ee;for(i=0,r=(m+=B).length;t=m[i],i<r;){switch(ee=i,s){case HW:i=C();break;case qW:i=E();break;case xwe:i=T();break;case Twe:i=A();break;case Swe:i=D();break;case Cwe:i=M();break;case Mk:i=U();break;case wwe:i=z();break;case Ewe:i=x();break;case Qp:i=w()}ee!==i&&(m[ee]===`
`?(c=0,++l):++c)}return n+=i,m=m.slice(i),a}function b(B){return o.length&&g(o.join("")),s=Ykt,g("(eof)"),a}function w(){return o=o.length?[]:o,e==="/"&&t==="*"?(h=n+i-1,s=HW,e=t,i+1):e==="/"&&t==="/"?(h=n+i-1,s=qW,e=t,i+1):t==="#"?(s=xwe,h=n+i,i):/\s/.test(t)?(s=Ewe,h=n+i,i):(p=/\d/.test(t),f=/[^\w_]/.test(t),h=n+i,s=p?Swe:f?Twe:wwe,i)}function x(){return/[^\s]/g.test(t)?(g(o.join("")),s=Qp,i):(o.push(t),e=t,i+1)}function T(){return t!=="\r"&&t!==`
`||e==="\\"?(o.push(t),e=t,i+1):(g(o.join("")),s=Qp,i)}function E(){return T()}function C(){return t==="/"&&e==="*"?(o.push(t),g(o.join("")),s=Qp,i+1):(o.push(t),e=t,i+1)}function A(){if(e==="."&&/\d/.test(t))return s=Mk,i;if(e==="/"&&t==="*")return s=HW,i;if(e==="/"&&t==="/")return s=qW,i;if(t==="."&&o.length){for(;I(o););return s=Mk,i}if(t===";"||t===")"||t==="("){if(o.length)for(;I(o););return g(t),s=Qp,i+1}var B=o.length===2&&t!=="=";if(/[\w_\d\s]/.test(t)||B){for(;I(o););return s=Qp,i}return o.push(t),e=t,i+1}function I(B){for(var ee,te,K=0;;){if(ee=bwe.indexOf(B.slice(0,B.length+K).join("")),te=bwe[ee],ee===-1){if(K--+B.length>0)continue;te=B.slice(0,1).join("")}return g(te),h+=te.length,(o=o.slice(te.length)).length}}function M(){return/[^a-fA-F0-9]/.test(t)?(g(o.join("")),s=Qp,i):(o.push(t),e=t,i+1)}function D(){return t==="."||/[eE]/.test(t)?(o.push(t),s=Mk,e=t,i+1):t==="x"&&o.length===1&&o[0]==="0"?(s=Cwe,o.push(t),e=t,i+1):/[^\d]/.test(t)?(g(o.join("")),s=Qp,i):(o.push(t),e=t,i+1)}function U(){return t==="f"&&(o.push(t),e=t,i+=1),/[eE]/.test(t)||t==="-"&&/[eE]/.test(e)?(o.push(t),e=t,i+1):/[^\d]/.test(t)?(g(o.join("")),s=Qp,i):(o.push(t),e=t,i+1)}function z(){if(/[^\d\w_]/.test(t)){var B=o.join("");return s=Bkt.indexOf(B)>-1?Xkt:Hkt.indexOf(B)>-1?Wkt:qkt,g(o.join("")),s=Qp,i}return o.push(t),e=t,i+1}}function Kkt(t){var e=Jkt(),r=[];return r=(r=r.concat(e(t))).concat(e(null))}function Qkt(t){return Kkt(t)}function e6t(t){return t.map(e=>e.type!=="eof"?e.data:"").join("")}const WW=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];function t6t(t,e="100",r="300 es"){const i=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const n of t)if(n.type==="preprocessor"){const s=i.exec(n.data);if(s){const o=s[1].replace(/\s\s+/g," ");if(o===r)return o;if(o===e)return n.data="#version "+r,e;throw new Error("unknown glsl version: "+o)}}return t.splice(0,0,{type:"preprocessor",data:"#version "+r},{type:"whitespace",data:`
`}),null}function r6t(t,e){for(let r=e-1;r>=0;r--){const i=t[r];if(i.type!=="whitespace"&&i.type!=="block-comment"){if(i.type!=="keyword")break;if(i.data==="attribute"||i.data==="in")return!0}}return!1}function JI(t,e,r,i){i=i||r;for(const n of t)if(n.type==="ident"&&n.data===r)return i in e?e[i]++:e[i]=0,JI(t,e,i+"_"+e[i],i);return r}function Q8e(t,e,r="afterVersion"){function i(l,c){for(let h=c;h<l.length;h++){const p=l[h];if(p.type==="operator"&&p.data===";")return h}return null}function n(l){let c=-1,h=0,p=-1;for(let f=0;f<l.length;f++){const m=l[f];if(m.type==="preprocessor"&&(m.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++h:m.data.match(/\#endif\s*.*/)&&--h),r!=="afterVersion"&&r!=="afterPrecision"||m.type==="preprocessor"&&/^#version/.test(m.data)&&(p=Math.max(p,f)),r==="afterPrecision"&&m.type==="keyword"&&m.data==="precision"){const g=i(l,f);if(g===null)throw new Error("precision statement not followed by any semicolons!");p=Math.max(p,g)}c<p&&h===0&&(c=f)}return c+1}const s={data:`
`,type:"whitespace"},o=l=>l<t.length&&/[^\r\n]$/.test(t[l].data);let a=n(t);o(a-1)&&t.splice(a++,0,s);for(const l of e)t.splice(a++,0,l);o(a-1)&&o(a)&&t.splice(a,0,s)}function i6t(t,e,r,i="lowp"){Q8e(t,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function n6t(t,e,r,i,n="lowp"){Q8e(t,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:i.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:n},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function s6t(t,e){let r,i,n=-1;for(let s=e;s<t.length;s++){const o=t[s];if(o.type==="operator"&&(o.data==="["&&(r=s),o.data==="]")){i=s;break}o.type==="integer"&&(n=parseInt(o.data,10))}return r&&i&&t.splice(r,i-r+1),n}function Awe(t,e){const r=o6t();if(v(r))return r;const i=Qkt(t);if(t6t(i,"100","300 es")==="300 es")return t;let n=null,s=null;const o={},a={};for(let l=0;l<i.length;++l){const c=i[l];switch(c.type){case"keyword":e===Uh.VERTEX_SHADER&&c.data==="attribute"?c.data="in":c.data==="varying"&&(c.data=e===Uh.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(c.data.trim())&&(c.data=c.data.replace(/(2D|Cube|EXT)/g,"")),e===Uh.FRAGMENT_SHADER&&c.data==="gl_FragColor"&&(n||(n=JI(i,o,"fragColor"),i6t(i,n,"vec4")),c.data=n),e===Uh.FRAGMENT_SHADER&&c.data==="gl_FragData"){const h=s6t(i,l+1),p=JI(i,o,"fragData");n6t(i,p,"vec4",h,"mediump"),c.data=p}else e===Uh.FRAGMENT_SHADER&&c.data==="gl_FragDepthEXT"&&(s||(s=JI(i,o,"gl_FragDepth")),c.data=s);break;case"ident":if(zkt.includes(c.data)){if(e===Uh.VERTEX_SHADER&&r6t(i,l))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");c.data in a||(a[c.data]=JI(i,o,c.data)),c.data=a[c.data]}}}for(let l=i.length-1;l>=0;--l){const c=i[l];if(c.type==="preprocessor"){const h=c.data.match(/\#extension\s+(.*)\:/);if(h&&h[1]&&WW.includes(h[1].trim())){const m=i[l+1];i.splice(l,m&&m.type==="whitespace"?2:1)}const p=c.data.match(/\#ifdef\s+(.*)/);p&&p[1]&&WW.includes(p[1].trim())&&(c.data="#if 1");const f=c.data.match(/\#ifndef\s+(.*)/);f&&f[1]&&WW.includes(f[1].trim())&&(c.data="#if 0")}}return a6t(t,e6t(i))}function o6t(t){return null}function a6t(t,e){return e}const l6t=4294967295;let c6t=class{constructor(e,r,i,n,s=new Map){this._context=e,this._locations=n,this._uniformBlockBindings=s,this._refCount=1,this._compiled=!1,this._nameToUniformLocation={},this._nameToUniform1={},this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,e||console.error("RenderingContext isn't initialized!"),r.length===0&&console.error("Shaders source should not be empty!"),this._context.type===Et.WEBGL2&&(r=Awe(r,Uh.VERTEX_SHADER),i=Awe(i,Uh.FRAGMENT_SHADER)),this._vShader=Rwe(this._context,Uh.VERTEX_SHADER,r),this._fShader=Rwe(this._context,Uh.FRAGMENT_SHADER,i),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(ho.Shader,this),iee()&&(this.vertexShader=r,this.fragmentShader=i);const o=this._context.gl,a=o.createProgram();if(o.attachShader(a,this._vShader),o.attachShader(a,this._fShader),this._locations.forEach((l,c)=>o.bindAttribLocation(a,l,c)),o.linkProgram(a),iee()&&!o.getProgramParameter(a,o.LINK_STATUS)&&console.error(`Could not link shader
validated: ${o.getProgramParameter(a,o.VALIDATE_STATUS)}, gl error ${o.getError()}, vertex: ${o.getShaderParameter(this._vShader,o.COMPILE_STATUS)}, fragment: ${o.getShaderParameter(this._fShader,o.COMPILE_STATUS)}, info log: ${o.getProgramInfoLog(a)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`),this._context.type===Et.WEBGL2){const l=o;for(const[c,h]of this._uniformBlockBindings){const p=l.getUniformBlockIndex(a,c);p<l6t&&l.uniformBlockBinding(a,p,h)}}this._glName=a,this._context.instanceCounter.increment(ho.Program,this)}get glName(){return this._glName}get hasGLName(){return v(this._glName)}get compiled(){if(this._compiled)return!0;const e=this._context.gl.getExtension("KHR_parallel_shader_compile");return e==null||R(this.glName)?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,e.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const e=this._context.gl;this._vShader&&(e.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(ho.Shader,this)),this._fShader&&(e.deleteShader(this._fShader),this._fShader=null),this._glName&&(e.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(ho.Program,this))}ref(){++this._refCount}_getUniformLocation(e){return this._nameToUniformLocation[e]===void 0&&v(this.glName)&&(this._nameToUniformLocation[e]=this._context.gl.getUniformLocation(this.glName,e)),this._nameToUniformLocation[e]}hasUniform(e){return this._getUniformLocation(e)!==null}setUniform1i(e,r){const i=this._nameToUniform1[e];i!==void 0&&r===i||(this._context.gl.uniform1i(this._getUniformLocation(e),r),this._nameToUniform1[e]=r)}setUniform1iv(e,r){Gm(this._nameToUniform1v,e,r)&&this._context.gl.uniform1iv(this._getUniformLocation(e),r)}setUniform2iv(e,r){Gm(this._nameToUniform2,e,r)&&this._context.gl.uniform2iv(this._getUniformLocation(e),r)}setUniform3iv(e,r){Gm(this._nameToUniform3,e,r)&&this._context.gl.uniform3iv(this._getUniformLocation(e),r)}setUniform4iv(e,r){Gm(this._nameToUniform4,e,r)&&this._context.gl.uniform4iv(this._getUniformLocation(e),r)}setUniform1f(e,r){const i=this._nameToUniform1[e];i!==void 0&&r===i||(this._context.gl.uniform1f(this._getUniformLocation(e),r),this._nameToUniform1[e]=r)}setUniform1fv(e,r){Gm(this._nameToUniform1v,e,r)&&this._context.gl.uniform1fv(this._getUniformLocation(e),r)}setUniform2f(e,r,i){const n=this._nameToUniform2.get(e);n===void 0?(this._context.gl.uniform2f(this._getUniformLocation(e),r,i),this._nameToUniform2.set(e,[r,i])):r===n[0]&&i===n[1]||(this._context.gl.uniform2f(this._getUniformLocation(e),r,i),n[0]=r,n[1]=i)}setUniform2fv(e,r){Gm(this._nameToUniform2,e,r)&&this._context.gl.uniform2fv(this._getUniformLocation(e),r)}setUniform3f(e,r,i,n){const s=this._nameToUniform3.get(e);s===void 0?(this._context.gl.uniform3f(this._getUniformLocation(e),r,i,n),this._nameToUniform3[e]=[r,i,n]):r===s[0]&&i===s[1]&&n===s[2]||(this._context.gl.uniform3f(this._getUniformLocation(e),r,i,n),s[0]=r,s[1]=i,s[2]=n)}setUniform3fv(e,r){Gm(this._nameToUniform3,e,r)&&this._context.gl.uniform3fv(this._getUniformLocation(e),r)}setUniform4f(e,r,i,n,s){const o=this._nameToUniform4.get(e);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(e),r,i,n,s),this._nameToUniform4.set(e,[r,i,n,s])):o!==void 0&&r===o[0]&&i===o[1]&&n===o[2]&&s===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(e),r,i,n,s),o[0]=r,o[1]=i,o[2]=n,o[3]=s)}setUniform4fv(e,r){Gm(this._nameToUniform4,e,r)&&this._context.gl.uniform4fv(this._getUniformLocation(e),r)}setUniformMatrix3fv(e,r,i=!1){Gm(this._nameToUniformMatrix3,e,r)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(e),i,r)}setUniformMatrix4fv(e,r,i=!1){Gm(this._nameToUniformMatrix4,e,r)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(e),i,r)}stop(){}};function Rwe(t,e,r){const i=t.gl,n=i.createShader(e);return i.shaderSource(n,r),i.compileShader(n),iee()&&!i.getShaderParameter(n,i.COMPILE_STATUS)&&(console.error("Compile error in ".concat(e===Uh.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(i.getShaderInfoLog(n)),console.error(u6t(r))),n}function u6t(t){let e=2;return t.replace(/\n/g,()=>`
`+h6t(e++)+":")}function h6t(t){return t>=1e3?t.toString():("  "+t).slice(-3)}function Gm(t,e,r){const i=t.get(e);return i?Oie(i,r):(t.set(e,Array.from(r)),!0)}let d6t=class{constructor(e){this._rctx=e,this._store=new D3}dispose(){this._store.forEach(e=>e.forEach(r=>r.dispose())),this._store.clear()}acquire(e,r,i,n){const s=this._store.get(e,r);if(v(s))return s.ref(),s;const o=new c6t(this._rctx,e,r,i,n);return o.ref(),this._store.set(e,r,o),o}get test(){let e=0;return this._store.forEach(r=>r.forEach(i=>e+=i.hasGLName?2:1)),{cachedWebGLObjects:e}}},sF=class{constructor(){this._result=!1}dispose(){this._program=rt(this._program)}get result(){return v(this._program)&&(this._result=this._test(this._program),this.dispose()),this._result}},p6t=class extends sF{constructor(e){super(),this._rctx=e,this._dummyProgram=null,this._rctx.type===Et.WEBGL2&&ue("mac")&&ue("chrome")&&(this._program=this._prepareProgram(),this._dummyProgram=this._prepareDummyProgram())}dispose(){var e;super.dispose(),(e=this._dummyProgram)==null||e.dispose(),this._dummyProgram=null}_test(e){const r=this._rctx;r.resetState();const i=new Jn(r,{colorTarget:xn.TEXTURE,depthStencilTarget:Ur.NONE},{target:Ct.TEXTURE_2D,wrapMode:$t.CLAMP_TO_EDGE,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:it.NEAREST,width:1,height:1}),n=Kr.createIndex(this._rctx,zr.STATIC_DRAW,new Uint8Array([0]));r.bindFramebuffer(i),r.setViewport(0,0,1,1),r.useProgram(this._dummyProgram),r.bindBuffer(n,Lt.ELEMENT_ARRAY_BUFFER),r.drawElements(Ft.POINTS,1,ft.UNSIGNED_BYTE,0),r.useProgram(e),r.bindVAO(null),r.drawArrays(Ft.TRIANGLES,0,258);const s=new Uint8Array(4);return i.readPixels(0,0,1,1,Ge.RGBA,kt.UNSIGNED_BYTE,s),i.dispose(),n.dispose(),s[0]===255}_prepareProgram(){const r=`
    precision highp float;

    varying float triangleId;

    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));

    void main(void) {
      triangleId = floor(float(gl_VertexID)/3.0);

      vec3 position = triangleVertices[gl_VertexID % 3];
      float offset = triangleId / ${S.float(85)};
      position.z = 0.5 - offset;

      gl_Position = vec4(position, 1.0);
    }
    `,i=`
    precision highp float;

    varying float triangleId;

    void main(void) {
      gl_FragColor = triangleId == ${S.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);
    }
    `;return this._rctx.programCache.acquire(r,i,new Map([]))}_prepareDummyProgram(){const e=`
    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,r=`
    void main(void) {
      gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`;return this._rctx.programCache.acquire(e,r,new Map([]))}},f6t=class extends sF{constructor(e){super(),this._rctx=e,this._program=Owe(this._rctx,!1),this._obfuscated=Owe(this._rctx,!0)}dispose(){super.dispose(),this._obfuscated=rt(this._obfuscated)}_test(e){if(ue("force-double-precision-obfuscation"))return!0;if(R(this._obfuscated))return!1;const r=this._runProgram(e),i=this._runProgram(this._obfuscated);return r!==0&&(i===0||r/i>5)}_runProgram(e){const r=this._rctx;r.resetState();const i=new Jn(r,{colorTarget:xn.TEXTURE,depthStencilTarget:Ur.NONE},{target:Ct.TEXTURE_2D,wrapMode:$t.CLAMP_TO_EDGE,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:it.NEAREST,width:1,height:1}),n=Kr.createVertex(r,zr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),s=new Mp(r,new Map([["position",0]]),{geometry:[new va("position",2,ft.UNSIGNED_SHORT,0,4)]},{geometry:n}),o=ke(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),a=ke(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),l=new Float32Array(6);qee(o,l,3);const c=new Float32Array(6);qee(a,c,3),r.useProgram(e),e.setUniform3f("u_highA",l[0],l[2],l[4]),e.setUniform3f("u_lowA",l[1],l[3],l[5]),e.setUniform3f("u_highB",c[0],c[2],c[4]),e.setUniform3f("u_lowB",c[1],c[3],c[5]),r.bindFramebuffer(i),r.setViewport(0,0,1,1),r.bindVAO(s),r.drawArrays(Ft.TRIANGLE_STRIP,0,4);const h=new Uint8Array(4);i.readPixels(0,0,1,1,Ge.RGBA,kt.UNSIGNED_BYTE,h),s.dispose(!1),n.dispose(),i.dispose();const p=(o[2]-a[2])/25,f=Ile(h);return Math.abs(p-f)}};function Owe(t,e){const r=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${e?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `,i=`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `;return t.programCache.acquire(r,i,new Map([["position",0]]))}var Mwe,Pwe,gre={},m6t={get exports(){return gre},set exports(t){gre=t}};Mwe=m6t,(Pwe=function(){var t=function(_){window.console&&window.console.log&&window.console.log(_)},e=function(_){window.console&&window.console.error?window.console.error(_):t(_)},r={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},i=null,n=null;function s(_){if(i==null)for(var b in i={},n={},_)typeof _[b]=="number"&&(i[_[b]]=b,n[b]=_[b])}function o(){if(i==null)throw"WebGLDebugUtils.init(ctx) not called"}function a(_){return o(),i[_]!==void 0}function l(_){o();var b=i[_];return b!==void 0?"gl."+b:"/*UNKNOWN WebGL ENUM*/ 0x"+_.toString(16)}function c(_,b,w,x){var T;if((T=r[_])!==void 0&&(T=T[b])!==void 0&&T[w]){if(typeof T[w]=="object"&&T[w].enumBitwiseOr!==void 0){for(var E=T[w].enumBitwiseOr,C=0,A=[],I=0;I<E.length;++I){var M=n[E[I]];x&M&&(C|=M,A.push(l(M)))}return C===x?A.join(" | "):l(x)}return l(x)}return x===null?"null":x===void 0?"undefined":x.toString()}function h(_,b){for(var w="",x=b.length,T=0;T<x;++T)w+=(T==0?"":", ")+c(_,x,T,b[T]);return w}function p(_,b,w){_.__defineGetter__(w,function(){return b[w]}),_.__defineSetter__(w,function(x){b[w]=x})}function f(_,b,w,x){x=x||_,s(_),b=b||function(M,D,U){for(var z="",B=U.length,ee=0;ee<B;++ee)z+=(ee==0?"":", ")+c(D,B,ee,U[ee]);e("WebGL error "+l(M)+" in "+D+"("+z+")")};var T={};function E(M,D){return function(){w&&w(D,arguments);var U=M[D].apply(M,arguments),z=x.getError();return z!=0&&(T[z]=!0,b(z,D,arguments)),U}}var C={};for(var A in _)if(typeof _[A]=="function")if(A!="getExtension")C[A]=E(_,A);else{var I=E(_,A);C[A]=function(){return f(I.apply(_,arguments),b,w,x)}}else p(C,_,A);return C.getError=function(){for(var M in T)if(T.hasOwnProperty(M)&&T[M])return T[M]=!1,M;return _.NO_ERROR},C}function m(_){var b=_.getParameter(_.MAX_VERTEX_ATTRIBS),w=_.createBuffer();_.bindBuffer(_.ARRAY_BUFFER,w);for(var x=0;x<b;++x)_.disableVertexAttribArray(x),_.vertexAttribPointer(x,4,_.FLOAT,!1,0,0),_.vertexAttrib1f(x,0);_.deleteBuffer(w);var T=_.getParameter(_.MAX_TEXTURE_IMAGE_UNITS);for(x=0;x<T;++x)_.activeTexture(_.TEXTURE0+x),_.bindTexture(_.TEXTURE_CUBE_MAP,null),_.bindTexture(_.TEXTURE_2D,null);for(_.activeTexture(_.TEXTURE0),_.useProgram(null),_.bindBuffer(_.ARRAY_BUFFER,null),_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,null),_.bindFramebuffer(_.FRAMEBUFFER,null),_.bindRenderbuffer(_.RENDERBUFFER,null),_.disable(_.BLEND),_.disable(_.CULL_FACE),_.disable(_.DEPTH_TEST),_.disable(_.DITHER),_.disable(_.SCISSOR_TEST),_.blendColor(0,0,0,0),_.blendEquation(_.FUNC_ADD),_.blendFunc(_.ONE,_.ZERO),_.clearColor(0,0,0,0),_.clearDepth(1),_.clearStencil(-1),_.colorMask(!0,!0,!0,!0),_.cullFace(_.BACK),_.depthFunc(_.LESS),_.depthMask(!0),_.depthRange(0,1),_.frontFace(_.CCW),_.hint(_.GENERATE_MIPMAP_HINT,_.DONT_CARE),_.lineWidth(1),_.pixelStorei(_.PACK_ALIGNMENT,4),_.pixelStorei(_.UNPACK_ALIGNMENT,4),_.pixelStorei(_.UNPACK_FLIP_Y_WEBGL,!1),_.pixelStorei(_.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),_.UNPACK_COLORSPACE_CONVERSION_WEBGL&&_.pixelStorei(_.UNPACK_COLORSPACE_CONVERSION_WEBGL,_.BROWSER_DEFAULT_WEBGL),_.polygonOffset(0,0),_.sampleCoverage(1,!1),_.scissor(0,0,_.canvas.width,_.canvas.height),_.stencilFunc(_.ALWAYS,0,4294967295),_.stencilMask(4294967295),_.stencilOp(_.KEEP,_.KEEP,_.KEEP),_.viewport(0,0,_.canvas.width,_.canvas.height),_.clear(_.COLOR_BUFFER_BIT|_.DEPTH_BUFFER_BIT|_.STENCIL_BUFFER_BIT);_.getError(););}function g(_){var b,w,x=[],T=[],E={},C=1,A=!1,I=[],M=0,D=0,U=!1,z=0,B={};function ee(X){return typeof X=="function"?X:function(oe){X.handleEvent(oe)}}_.getContext=(w=_.getContext,function(){var X=w.apply(_,arguments);if(X instanceof WebGLRenderingContext){if(X!=b){if(b)throw"got different context";E=Z(b=X)}return E}return X});var te=function(X){x.push(ee(X))},K=function(X){T.push(ee(X))};function W(X){var oe=X.addEventListener;X.addEventListener=function(pe,ye,Se){switch(pe){case"webglcontextlost":te(ye);break;case"webglcontextrestored":K(ye);break;default:oe.apply(X,arguments)}}}function N(){for(var X=Object.keys(B),oe=0;oe<X.length;++oe)delete B[X]}function L(){++D,A||M==D&&_.loseContext()}function F(X,oe){var pe=X[oe];return function(){if(L(),!A)return pe.apply(X,arguments)}}function G(){for(var X=0;X<I.length;++X){var oe=I[X];oe instanceof WebGLBuffer?b.deleteBuffer(oe):oe instanceof WebGLFramebuffer?b.deleteFramebuffer(oe):oe instanceof WebGLProgram?b.deleteProgram(oe):oe instanceof WebGLRenderbuffer?b.deleteRenderbuffer(oe):oe instanceof WebGLShader?b.deleteShader(oe):oe instanceof WebGLTexture&&b.deleteTexture(oe)}}function q(X){return{statusMessage:X,preventDefault:function(){U=!0}}}return W(_),_.loseContext=function(){if(!A){for(A=!0,M=0,++C;b.getError(););N(),B[b.CONTEXT_LOST_WEBGL]=!0;var X=q("context lost"),oe=x.slice();setTimeout(function(){for(var pe=0;pe<oe.length;++pe)oe[pe](X);z>=0&&setTimeout(function(){_.restoreContext()},z)},0)}},_.restoreContext=function(){A&&T.length&&setTimeout(function(){if(!U)throw"can not restore. webglcontestlost listener did not call event.preventDefault";G(),m(b),A=!1,D=0,U=!1;for(var X=T.slice(),oe=q("context restored"),pe=0;pe<X.length;++pe)X[pe](oe)},0)},_.loseContextInNCalls=function(X){if(A)throw"You can not ask a lost contet to be lost";M=D+X},_.getNumCalls=function(){return D},_.setRestoreTimeout=function(X){z=X},_;function Z(X){for(var oe in X)typeof X[oe]=="function"?E[oe]=F(X,oe):p(E,X,oe);E.getError=function(){if(L(),!A)for(;Te=b.getError();)B[Te]=!0;for(var Te in B)if(B[Te])return delete B[Te],Te;return E.NO_ERROR};for(var pe=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],ye=0;ye<pe.length;++ye){var Se=pe[ye];E[Se]=function(Te){return function(){if(L(),A)return null;var Fe=Te.apply(X,arguments);return Fe.__webglDebugContextLostId__=C,I.push(Fe),Fe}}(X[Se])}var He=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(ye=0;ye<He.length;++ye)Se=He[ye],E[Se]=function(Te){return function(){return L(),A?null:Te.apply(X,arguments)}}(E[Se]);var Le=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(ye=0;ye<Le.length;++ye)Se=Le[ye],E[Se]=function(Te){return function(){return L(),!A&&Te.apply(X,arguments)}}(E[Se]);return E.checkFramebufferStatus=function(Te){return function(){return L(),A?E.FRAMEBUFFER_UNSUPPORTED:Te.apply(X,arguments)}}(E.checkFramebufferStatus),E.getAttribLocation=function(Te){return function(){return L(),A?-1:Te.apply(X,arguments)}}(E.getAttribLocation),E.getVertexAttribOffset=function(Te){return function(){return L(),A?0:Te.apply(X,arguments)}}(E.getVertexAttribOffset),E.isContextLost=function(){return A},E}}return{init:s,mightBeEnum:a,glEnumToString:l,glFunctionArgToString:c,glFunctionArgsToString:h,makeDebugContext:f,makeLostContextSimulatingCanvas:g,resetToInitialState:m}}())!==void 0&&(Mwe.exports=Pwe);let g6t=class extends sF{constructor(e){var n,s,o,a,l;if(super(),this._rctx=e,!e.gl)return;if(e.type===Et.WEBGL1)return void(this._result=!(!((n=e.capabilities.textureFloat)!=null&&n.textureFloat)||!((s=e.capabilities.colorBufferFloat)!=null&&s.textureFloat)));if(!((o=e.capabilities.textureFloat)!=null&&o.textureFloat&&((a=e.capabilities.colorBufferFloat)!=null&&a.textureFloat)&&((l=e.capabilities.colorBufferFloat)!=null&&l.floatBlend)))return;const r=`
    precision highp float;
    attribute vec2 a_pos;

    void main() {
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,i=`
     precision highp float;

     void main() {
      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
     }
    `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}_test(e){const r=this._rctx,i=new Jn(r,{colorTarget:xn.TEXTURE,depthStencilTarget:Ur.NONE},{target:Ct.TEXTURE_2D,wrapMode:$t.CLAMP_TO_EDGE,pixelFormat:Ge.RGBA,dataType:kt.FLOAT,internalFormat:Ot.RGBA32F,samplingMode:it.NEAREST,width:1,height:1}),n=Kr.createVertex(r,zr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),s=new Mp(r,new Map([["a_pos",0]]),{geometry:[new va("a_pos",2,ft.UNSIGNED_SHORT,0,4)]},{geometry:n});r.useProgram(e);const o=r.getBoundFramebufferObject(),{x:a,y:l,width:c,height:h}=r.getViewport();r.bindFramebuffer(i),r.setViewport(0,0,1,1),r.bindVAO(s),r.drawArrays(Ft.TRIANGLE_STRIP,0,4);const p=Ht({blending:z4e});r.setPipelineState(p),r.drawArrays(Ft.TRIANGLE_STRIP,0,4),gre.init(r);const f=r.gl.getError();return r.setViewport(a,l,c,h),r.bindFramebuffer(o),s.dispose(!1),n.dispose(),i.dispose(),f!==1282||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}},y6t=class extends sF{constructor(e){super(),this._rctx=e;const r=`
      precision highp float;
      attribute vec2 a_pos;
      uniform highp sampler2D u_texture;
      varying vec4 v_color;

      float getBit(in float bitset, in int bitIndex) {
        float offset = pow(2.0, float(bitIndex));
        return mod(floor(bitset / offset), 2.0);
      }

      void main() {
        vec4 value = texture2D(u_texture, vec2(0.0));
        float bit = getBit(value.x * 255.0, 1);

        v_color = bit * vec4(1.0);
        gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
      }
      `,i=`
      precision highp float;
      varying vec4 v_color;

      void main() {
        gl_FragColor = v_color;
      }
      `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}_test(e){const r=this._rctx,i=new Jn(r,{colorTarget:xn.TEXTURE,depthStencilTarget:Ur.NONE},{target:Ct.TEXTURE_2D,wrapMode:$t.CLAMP_TO_EDGE,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:it.NEAREST,width:1,height:1}),n=new Uint8Array(4),s=Kr.createVertex(r,zr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new Mp(r,new Map([["a_position",0]]),{geometry:[new va("a_position",2,ft.SHORT,0,4)]},{geometry:s});r.useProgram(e);const a=new mt(r,{target:Ct.TEXTURE_2D,wrapMode:$t.CLAMP_TO_EDGE,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:it.NEAREST,width:1,height:1},new Uint8Array([2,255,0,0]));e.setUniform1i("u_texture",0),r.bindTexture(a,0);const l=r.getBoundFramebufferObject();r.bindFramebuffer(i),r.useProgram(e);const{x:c,y:h,width:p,height:f}=r.getViewport();r.setViewport(0,0,1,1),r.bindVAO(o),r.drawArrays(Ft.TRIANGLE_STRIP,0,4),r.setViewport(c,h,p,f),i.readPixels(0,0,1,1,Ge.RGBA,kt.UNSIGNED_BYTE,n),o.dispose(!1),s.dispose(),i.dispose();const m=n[0]!==255||n[1]!==255||n[2]!==255||n[3]!==255;return m&&re.getLogger("esri.views.webgl.testSamplerPrecision").warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${n[0]}.${n[1]}.${n[2]}.${n[3]}]`),r.bindFramebuffer(l),m}};const bir={geometry:[new va("a_pos",2,ft.BYTE,0,2)]},wir={geometry:[new va("a_pos",2,ft.BYTE,0,4),new va("a_tex",2,ft.BYTE,2,4)]},_6t={geometry:[new va("a_pos",2,ft.UNSIGNED_SHORT,0,4)]};let v6t=class extends sF{constructor(e){super(),this._rctx=e,this._image=new Image,this._image.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",this._image.width=5,this._image.height=5,this._image.decode();const r=`
    precision highp float;

    attribute vec2 a_pos;
    varying vec2 v_uv;

    void main() {
      v_uv = a_pos;
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,i=`
    precision highp float;

    varying vec2 v_uv;
    uniform sampler2D u_texture;

    void main() {
      gl_FragColor = texture2D(u_texture, v_uv);
    }
    `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}dispose(){super.dispose(),this._image.src=""}_test(e){const r=this._rctx;if(!r.gl)return e.dispose(),!0;const i=new Jn(r,{colorTarget:xn.TEXTURE,depthStencilTarget:Ur.NONE},{target:Ct.TEXTURE_2D,wrapMode:$t.CLAMP_TO_EDGE,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:it.NEAREST,width:1,height:1}),n=Kr.createVertex(r,zr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),s=new Mp(r,new Map([["a_pos",0]]),_6t,{geometry:n}),o=new mt(r,{dataType:kt.UNSIGNED_BYTE,pixelFormat:Ge.RGBA,preMultiplyAlpha:!1,wrapMode:$t.CLAMP_TO_EDGE,samplingMode:it.LINEAR},this._image);r.useProgram(e),r.bindTexture(o,0),e.setUniform1i("u_texture",0);const a=r.getBoundFramebufferObject(),{x:l,y:c,width:h,height:p}=r.getViewport();r.bindFramebuffer(i),r.setViewport(0,0,1,1),r.setClearColor(0,0,0,0),r.setBlendingEnabled(!1),r.clearSafe(Hi.COLOR_BUFFER_BIT),r.bindVAO(s),r.drawArrays(Ft.TRIANGLE_STRIP,0,4);const f=new Uint8Array(4);return i.readPixels(0,0,1,1,Ge.RGBA,kt.UNSIGNED_BYTE,f),s.dispose(!1),n.dispose(),i.dispose(),o.dispose(),r.setViewport(l,c,h,p),r.bindFramebuffer(a),f[0]!==255}},b6t=class{constructor(e){this.rctx=e,this.floatBufferBlend=new g6t(e),this.svgPremultipliesAlpha=new v6t(e),this.doublePrecisionRequiresObfuscation=new f6t(e),this.ignoresSamplerPrecision=new y6t(e),this.drawArraysRequiresIndicesTypeReset=new p6t(e)}dispose(){this.ignoresSamplerPrecision.dispose(),this.doublePrecisionRequiresObfuscation.dispose(),this.svgPremultipliesAlpha.dispose(),this.floatBufferBlend.dispose(),this.drawArraysRequiresIndicesTypeReset.dispose()}};function w6t(t,e){if(e.disjointTimerQuery)return null;if(Sy(t))return{drawBuffers:t.drawBuffers.bind(t),MAX_DRAW_BUFFERS:t.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:t.MAX_COLOR_ATTACHMENTS};if(e.drawBuffers)return null;const r=t.getExtension("WEBGL_draw_buffers");return r?{drawBuffers:r.drawBuffersWEBGL.bind(r),MAX_DRAW_BUFFERS:r.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:r.MAX_COLOR_ATTACHMENTS_WEBGL}:null}function x6t(t){if(Sy(t))return t;const e=t.getExtension("ANGLE_instanced_arrays");return e?{drawArraysInstanced:e.drawArraysInstancedANGLE.bind(e),drawElementsInstanced:e.drawElementsInstancedANGLE.bind(e),vertexAttribDivisor:e.vertexAttribDivisorANGLE.bind(e)}:null}function T6t(t,e){if(e.compressedTextureETC)return null;const r=t.getExtension("WEBGL_compressed_texture_etc");return r?{COMPRESSED_R11_EAC:r.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:r.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:r.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:r.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:r.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:r.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function S6t(t,e){if(e.compressedTextureS3TC)return null;const r=t.getExtension("WEBGL_compressed_texture_s3tc");return r?{COMPRESSED_RGB_S3TC_DXT1:r.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:r.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:r.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:r.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function E6t(t,e){if(Sy(t))return{MIN:t.MIN,MAX:t.MAX};if(e.blendMinMax)return null;{const r=t.getExtension("EXT_blend_minmax");return r?{MIN:r.MIN_EXT,MAX:r.MAX_EXT}:null}}function C6t(t,e){if(e.textureFilterAnisotropic)return null;const r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return r?{MAX_TEXTURE_MAX_ANISOTROPY:r.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:r.TEXTURE_MAX_ANISOTROPY_EXT}:null}function A6t(t,e){if(Sy(t))return{textureFloat:!0,textureFloatLinear:!e.textureFloatLinear&&!!t.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:t.HALF_FLOAT,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F};if(t instanceof WebGLRenderingContext){const r=!e.textureHalfFloat&&t.getExtension("OES_texture_half_float");return{textureFloat:!e.textureFloat&&!!t.getExtension("OES_texture_float"),textureFloatLinear:!e.textureFloatLinear&&!!t.getExtension("OES_texture_float_linear"),textureHalfFloat:!!r,textureHalfFloatLinear:!e.textureHalfFloatLinear&&!!t.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:r?r.HALF_FLOAT_OES:void 0}}return null}function R6t(t,e){if(Sy(t)){const r=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float")||!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),i=!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),n=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return r||i||n?{textureFloat:!!i,textureHalfFloat:!!r,floatBlend:!!n,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F}:null}if(t instanceof WebGLRenderingContext){const r=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float"),i=!e.colorBufferFloat&&t.getExtension("WEBGL_color_buffer_float"),n=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return r||i||n?{textureFloat:!!i,textureHalfFloat:!!r,floatBlend:!!n,RGBA16F:r?r.RGBA16F_EXT:void 0,RGB16F:r?r.RGB16F_EXT:void 0,RGBA32F:i?i.RGBA32F_EXT:void 0}:null}return null}function dP(t,e,r,i,n){if(i&&Sy(t))return!0;if(e[r])return!1;for(const s of n)if(t.getExtension(s))return!0;return!1}function O6t(t,e){if(!Sy(t)||e.textureNorm16)return null;const r=t.getExtension("EXT_texture_norm16");return r?{R16:r.R16_EXT,RG16:r.RG16_EXT,RGB16:r.RGB16_EXT,RGBA16:r.RGBA16_EXT,R16_SNORM:r.R16_SNORM_EXT,RG16_SNORM:r.RG16_SNORM_EXT,RGB16_SNORM:r.RGB16_SNORM_EXT,RGBA16_SNORM:r.RGBA16_SNORM_EXT}:null}function M6t(t,e){const r=e.loseContext&&t.getExtension("WEBGL_lose_context");return r?{loseRenderingContext:()=>r.loseContext()}:null}function P6t(t,e){if(Sy(t))return{createVertexArray:t.createVertexArray.bind(t),deleteVertexArray:t.deleteVertexArray.bind(t),bindVertexArray:t.bindVertexArray.bind(t)};if(e.vao)return null;const r=t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object");return r?{createVertexArray:r.createVertexArrayOES.bind(r),deleteVertexArray:r.deleteVertexArrayOES.bind(r),bindVertexArray:r.bindVertexArrayOES.bind(r)}:null}class I6t{constructor(e,r){this._gl=e,this._instancing=null,this._vertexArrayObject=null,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._textureFloat=null,this._colorBufferFloat=null,this._minMaxBlending=null,this._loseContext=null,this._drawBuffers=null,this._textureNorm16=null,this._depthTexture=null,this._standardDerivatives=null,this._shaderTextureLOD=null,this._fragDepth=null,this._textureFloatLinear=null,this._disabledExtensions=r.disabledExtensions||{},this._debugWebGLExtensions=r.debugWebGLExtensions||{}}get drawBuffers(){return this._drawBuffers||(this._drawBuffers=w6t(this._gl,this._disabledExtensions)),this._drawBuffers}get instancing(){return this._instancing||(this._instancing=x6t(this._gl)),this._instancing}get vao(){return this._vertexArrayObject||(this._vertexArrayObject=P6t(this._gl,this._disabledExtensions)),this._vertexArrayObject}get compressedTextureETC(){return this._compressedTextureETC||(this._compressedTextureETC=T6t(this._gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC||(this._compressedTextureS3TC=S6t(this._gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic||(this._textureFilterAnisotropic=C6t(this._gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery||(this._disjointTimerQuery=$kt(this._gl,this._disabledExtensions)),this._disjointTimerQuery}get textureFloat(){return this._textureFloat||(this._textureFloat=A6t(this._gl,this._disabledExtensions)),this._textureFloat}get colorBufferFloat(){return this._colorBufferFloat||(this._colorBufferFloat=R6t(this._gl,this._disabledExtensions)),this._colorBufferFloat}get blendMinMax(){return this._minMaxBlending||(this._minMaxBlending=E6t(this._gl,this._disabledExtensions)),this._minMaxBlending}get depthTexture(){return this._depthTexture===null&&(this._depthTexture=dP(this._gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),this._depthTexture}get standardDerivatives(){return this._standardDerivatives===null&&(this._standardDerivatives=dP(this._gl,this._disabledExtensions,"standardDerivatives",!0,["OES_standard_derivatives"])),this._standardDerivatives}get shaderTextureLOD(){return this._shaderTextureLOD===null&&(this._shaderTextureLOD=dP(this._gl,this._disabledExtensions,"shaderTextureLOD",!0,["EXT_shader_texture_lod"])),this._shaderTextureLOD}get fragDepth(){return this._fragDepth===null&&(this._fragDepth=dP(this._gl,this._disabledExtensions,"fragDepth",!0,["EXT_frag_depth"])),this._fragDepth}get loseContext(){return this._loseContext||(this._loseContext=M6t(this._gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16||(this._textureNorm16=O6t(this._gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear===null&&(this._textureFloatLinear=dP(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(e){return this[e]}}let $6t=class{constructor(e,r){this.gl=e,this.instanceCounter=new Ukt,this.programCache=new d6t(this),this._state=new ywe,this._numOfDrawCalls=0,this._numOfTriangles=0,this.type=Sy(e)?Et.WEBGL2:Et.WEBGL1,this._loadExtensions(),this.configure(r)}get gl2(){return this.type===Et.WEBGL1?null:this.gl}configure(e){this._capabilities=new I6t(this.gl,e),this._parameters=this._loadParameters(e);const r=this.gl.getParameter(this.gl.VIEWPORT);this._state=new ywe,this._state.viewport={x:r[0],y:r[1],width:r[2],height:r[3]},this._stateTracker=new e_t({setBlending:i=>{if(i){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(i.opRgb,i.opAlpha),this.setBlendFunctionSeparate(i.srcRgb,i.dstRgb,i.srcAlpha,i.dstAlpha);const n=i.color;this.setBlendColor(n.r,n.g,n.b,n.a)}else this.setBlendingEnabled(!1)},setCulling:i=>{i?(this.setFaceCullingEnabled(!0),this.setCullFace(i.face),this.setFrontFace(i.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:i=>{i?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(i.factor,i.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:i=>{i?(this.setDepthTestEnabled(!0),this.setDepthFunction(i.func)):this.setDepthTestEnabled(!1)},setStencilTest:i=>{if(i){this.setStencilTestEnabled(!0);const n=i.function;this.setStencilFunction(n.func,n.ref,n.mask);const s=i.operation;this.setStencilOp(s.fail,s.zFail,s.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:i=>{i?(this.setDepthWriteEnabled(!0),this.setDepthRange(i.zNear,i.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:i=>{i?this.setColorMask(i.r,i.g,i.b,i.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:i=>{i?this.setStencilWriteMask(i.mask):this.setStencilWriteMask(0)}}),this.enforceState(),rt(this._driverTest),this._driverTest=new b6t(this)}dispose(){rt(this._driverTest),this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(Lt.ARRAY_BUFFER),this.unbindBuffer(Lt.ELEMENT_ARRAY_BUFFER),this.type===Et.WEBGL2&&(this.unbindBuffer(Lt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Lt.PIXEL_PACK_BUFFER),this.unbindBuffer(Lt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Lt.COPY_READ_BUFFER),this.unbindBuffer(Lt.COPY_WRITE_BUFFER)),this._state.textureUnitMap.length=0,Ih()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._state.blend!==e&&(e===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=e,this._stateTracker.invalidateBlending())}externalProgramUpdate(){var e;(e=this._state.program)==null||e.stop(),this._state.program=null}externalTextureUnitUpdate(e,r){for(let i=0;i<e.length;++i)this._state.textureUnitMap[e[i]]=null;r>=0&&(this._state.activeTexture=r)}externalVertexArrayObjectUpdate(){const e=this.capabilities.vao;e&&(e.bindVertexArray(null),this._state.vertexArrayObject=null),this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(e,r,i,n){e===this._state.blendColor.r&&r===this._state.blendColor.g&&i===this._state.blendColor.b&&n===this._state.blendColor.a||(this.gl.blendColor(e,r,i,n),this._state.blendColor.r=e,this._state.blendColor.g=r,this._state.blendColor.b=i,this._state.blendColor.a=n,this._stateTracker.invalidateBlending())}setBlendFunction(e,r){e===this._state.blendFunction.srcRGB&&r===this._state.blendFunction.dstRGB||(this.gl.blendFunc(e,r),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=e,this._state.blendFunction.dstRGB=r,this._state.blendFunction.dstAlpha=r,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,r,i,n){this._state.blendFunction.srcRGB===e&&this._state.blendFunction.srcAlpha===i&&this._state.blendFunction.dstRGB===r&&this._state.blendFunction.dstAlpha===n||(this.gl.blendFuncSeparate(e,r,i,n),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=i,this._state.blendFunction.dstRGB=r,this._state.blendFunction.dstAlpha=n,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._state.blendEquation.mode!==e&&(this.gl.blendEquation(e),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,r){this._state.blendEquation.mode===e&&this._state.blendEquation.modeAlpha===r||(this.gl.blendEquationSeparate(e,r),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=r,this._stateTracker.invalidateBlending())}setColorMask(e,r,i,n){this._state.colorMask.r===e&&this._state.colorMask.g===r&&this._state.colorMask.b===i&&this._state.colorMask.a===n||(this.gl.colorMask(e,r,i,n),this._state.colorMask.r=e,this._state.colorMask.g=r,this._state.colorMask.b=i,this._state.colorMask.a=n,this._stateTracker.invalidateColorWrite())}setClearColor(e,r,i,n){this._state.clearColor.r===e&&this._state.clearColor.g===r&&this._state.clearColor.b===i&&this._state.clearColor.a===n||(this.gl.clearColor(e,r,i,n),this._state.clearColor.r=e,this._state.clearColor.g=r,this._state.clearColor.b=i,this._state.clearColor.a=n)}setFaceCullingEnabled(e){this._state.faceCulling!==e&&(e===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._state.polygonOffsetFill!==e&&(e===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,r){this._state.polygonOffset[0]===e&&this._state.polygonOffset[1]===r||(this._state.polygonOffset[0]=e,this._state.polygonOffset[1]=r,this.gl.polygonOffset(e,r),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._state.cullFace!==e&&(this.gl.cullFace(e),this._state.cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._state.frontFace!==e&&(this.gl.frontFace(e),this._state.frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._state.scissorTest!==e&&(e===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=e)}setScissorRect(e,r,i,n){this._state.scissorRect.x===e&&this._state.scissorRect.y===r&&this._state.scissorRect.width===i&&this._state.scissorRect.height===n||(this.gl.scissor(e,r,i,n),this._state.scissorRect.x=e,this._state.scissorRect.y=r,this._state.scissorRect.width=i,this._state.scissorRect.height=n)}setDepthTestEnabled(e){this._state.depthTest!==e&&(e===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._state.clearDepth!==e&&(this.gl.clearDepth(e),this._state.clearDepth=e)}setDepthFunction(e){this._state.depthFunction!==e&&(this.gl.depthFunc(e),this._state.depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._state.depthWrite!==e&&(this.gl.depthMask(e),this._state.depthWrite=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,r){this._state.depthRange.zNear===e&&this._state.depthRange.zFar===r||(this.gl.depthRange(e,r),this._state.depthRange.zNear=e,this._state.depthRange.zFar=r,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._state.stencilTest!==e&&(e===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._state.clearStencil&&(this.gl.clearStencil(e),this._state.clearStencil=e)}setStencilFunction(e,r,i){this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===i||(this.gl.stencilFunc(e,r,i),this._state.stencilFunction.face=Wf.FRONT_AND_BACK,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=i,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,r,i,n){this._state.stencilFunction.face===e&&this._state.stencilFunction.func===r&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===n||(this.gl.stencilFuncSeparate(e,r,i,n),this._state.stencilFunction.face=e,this._state.stencilFunction.func=r,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=n,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._state.stencilWriteMask!==e&&(this.gl.stencilMask(e),this._state.stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,r,i){this._state.stencilOperation.face===Wf.FRONT_AND_BACK&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===i||(this.gl.stencilOp(e,r,i),this._state.stencilOperation.face=Wf.FRONT_AND_BACK,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=i,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,r,i,n){this._state.stencilOperation.face===e&&this._state.stencilOperation.fail===r&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===n||(this.gl.stencilOpSeparate(e,r,i,n),this._state.stencilOperation.face=e,this._state.stencilOperation.fail=r,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=n,this._stateTracker.invalidateStencilTest())}setActiveTexture(e,r=!1){const i=this._state.activeTexture;return e>=0&&(r||e!==this._state.activeTexture)&&(this.gl.activeTexture(DH+e),this._state.activeTexture=e),i}clear(e){e&&this.gl.clear(e)}clearSafe(e,r=255){e&&(e&Hi.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),e&Hi.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),e&Hi.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(r),this.gl.clear(e))}drawArrays(e,r,i){if(Ih()&&(this._numOfDrawCalls++,this._numOfTriangles+=Iwe(e,i)),this.gl.drawArrays(e,r,i),Ih()){const n=_ye(this);n&&console.error("drawArrays:",n)}}drawElements(e,r,i,n){if(Ih()&&(this._numOfDrawCalls++,this._numOfTriangles+=Iwe(e,r)),this.gl.drawElements(e,r,i,n),Ih()){const s=_ye(this);if(s){const o=this.getBoundVAO(),a=o==null?void 0:o.indexBuffer,l=o==null?void 0:o.vertexBuffers,c={indexBuffer:a,vertexBuffers:l},h={mode:e,count:r,type:i,offset:n},p=Fo(a,g=>g.size)??0,f=n+r,m=p<f?`. Buffer is too small. Attempted to draw index ${f} of ${p}`:"";console.error(`drawElements: ${s}${m}`,{args:h,vao:c})}}}logInfo(){Ih()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){Ih()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(e,r,i,n){i=Math.max(Math.round(i),1),n=Math.max(Math.round(n),1);const s=this._state.viewport;s.x===e&&s.y===r&&s.width===i&&s.height===n||(s.x=e,s.y=r,s.width=i,s.height=n,this.gl.viewport(e,r,i,n))}getViewport(){const e=this._state.viewport;return{x:e.x,y:e.y,width:e.width,height:e.height}}useProgram(e){var r;this._state.program!==e&&((r=this._state.program)==null||r.stop(),this._state.program=e,this.gl.useProgram((e==null?void 0:e.glName)??null))}bindTexture(e,r,i=!1){(r>=this.parameters.maxTextureImageUnits||r<0)&&console.error("Input texture unit is out of range of available units!");const n=this._state.textureUnitMap[r];return R(e)||e.glName==null?(v(n)&&(this.setActiveTexture(r,i),this.gl.bindTexture(n.descriptor.target,null)),this._state.textureUnitMap[r]=null,n):i||n!==e?(this.setActiveTexture(r,i),this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._state.textureUnitMap[r]=e,n):(e.isDirty&&(this.setActiveTexture(r,i),e.applyChanges()),n)}unbindTexture(e){if(!R(e))for(let r=0;r<this.parameters.maxTextureImageUnits;r++)this._state.textureUnitMap[r]===e&&(this.bindTexture(null,r),this._state.textureUnitMap[r]=null)}bindFramebuffer(e,r=!1){if(r||this._state.readFramebuffer!==e||this._state.drawFramebuffer!==e){if(R(e))return this.gl.bindFramebuffer(Ro.FRAMEBUFFER,null),this._state.readFramebuffer=null,void(this._state.drawFramebuffer=null);e.initializeAndBind(Ro.FRAMEBUFFER),this._state.readFramebuffer=e,this._state.drawFramebuffer=e}}bindFramebufferSeparate(e,r,i=!1){const n=r===Ro.READ_FRAMEBUFFER,s=n?this._state.readFramebuffer:this._state.drawFramebuffer;(i||s!==e)&&(R(e)?this.gl.bindFramebuffer(r,null):e.initializeAndBind(r),n?this._state.readFramebuffer=Nt(e,null):this._state.drawFramebuffer=Nt(e,null))}blitFramebuffer(e,r,i=0,n=0,s=e.width,o=e.height,a=0,l=0,c=r.width,h=r.height,p=Hi.COLOR_BUFFER_BIT,f=it.NEAREST){this.bindFramebufferSeparate(e,Ro.READ_FRAMEBUFFER),this.bindFramebufferSeparate(r,Ro.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(i,n,s,o,a,l,c,h,p,f)}bindBuffer(e,r){if(e)switch(r??(r=e.bufferType),r){case Lt.ARRAY_BUFFER:this._state.vertexBuffer=su(this.gl,e,r,this._state.vertexBuffer);break;case Lt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=su(this.gl,e,r,this._state.indexBuffer);break;case Lt.UNIFORM_BUFFER:this._state.uniformBuffer=su(this.gl,e,r,this._state.uniformBuffer);break;case Lt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=su(this.gl,e,r,this._state.pixelPackBuffer);break;case Lt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=su(this.gl,e,r,this._state.pixelUnpackBuffer);break;case Lt.COPY_READ_BUFFER:this._state.copyReadBuffer=su(this.gl,e,r,this._state.copyReadBuffer);break;case Lt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=su(this.gl,e,r,this._state.copyWriteBuffer)}}bindRenderbuffer(e){const r=this.gl;e||(r.bindRenderbuffer(r.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==e&&(r.bindRenderbuffer(r.RENDERBUFFER,e.glName),this._state.renderbuffer=e)}_getBufferBinding(e,r){if(r>=this.parameters.maxUniformBufferBindings||r<0)return console.error("Uniform buffer binding point is out of range!"),null;const i=this._state.uniformBufferBindingPoints;let n=i[r];return R(n)&&(n={buffer:null,offset:0,size:0},i[r]=n),n}bindBufferBase(e,r,i){const n=this._getBufferBinding(e,r);R(n)||n.buffer===i&&n.offset===0&&n.size===0||(this.gl.bindBufferBase(e,r,i?i.glName:null),n.buffer=i,n.offset=0,n.size=0)}bindBufferRange(e,r,i,n,s){const o=this._getBufferBinding(e,r);if(!R(o)&&!(o.buffer===i&&o.offset===n&&o.size===s)){if(n%this._parameters.uniformBufferOffsetAlignment!=0)return void console.error("Uniform buffer binding offset is not a multiple of the context offset alignment");this.gl.bindBufferRange(e,r,i.glName,n,s),o.buffer=i,o.offset=n,o.size=s}}bindUBO(e,r,i,n){R(r)?this.bindBufferBase(Lt.UNIFORM_BUFFER,e,null):(Ih()&&(n??r.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),r.initialize(),i!==void 0&&n!==void 0?this.bindBufferRange(Lt.UNIFORM_BUFFER,e,r.buffer,i,n):this.bindBufferBase(Lt.UNIFORM_BUFFER,e,r.buffer))}unbindUBO(e){for(let r=0,i=this._state.uniformBufferBindingPoints.length;r<i;r++){const n=this._state.uniformBufferBindingPoints[r];v(n)&&n.buffer===e.buffer&&this.bindBufferBase(Lt.UNIFORM_BUFFER,r,null)}}unbindBuffer(e){switch(e){case Lt.ARRAY_BUFFER:this._state.vertexBuffer=su(this.gl,null,e,this._state.vertexBuffer);break;case Lt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=su(this.gl,null,e,this._state.indexBuffer);break;case Lt.UNIFORM_BUFFER:this._state.uniformBuffer=su(this.gl,null,e,this._state.uniformBuffer);break;case Lt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=su(this.gl,null,e,this._state.pixelPackBuffer);break;case Lt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=su(this.gl,null,e,this._state.pixelUnpackBuffer);break;case Lt.COPY_READ_BUFFER:this._state.copyReadBuffer=su(this.gl,null,e,this._state.copyReadBuffer);break;case Lt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=su(this.gl,null,e,this._state.copyWriteBuffer)}}bindVAO(e=null){R(e)?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null):this._state.vertexArrayObject!==e&&(e.bind(),this._state.vertexArrayObject=e)}async clientWaitAsync(e=10){const r=this.gl,i=r.fenceSync(ree.SYNC_GPU_COMMANDS_COMPLETE,0);if(!i)throw new Error("Client wait failed, could not create sync object");let n;this.instanceCounter.increment(ho.Sync,i),r.flush();do await YS(e),n=r.clientWaitSync(i,0,0);while(n===tV.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(ho.Sync,i),r.deleteSync(i),n===tV.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(e=Ro.FRAMEBUFFER){return e===Ro.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(Lt.ARRAY_BUFFER),this.unbindBuffer(Lt.ELEMENT_ARRAY_BUFFER),this.type===Et.WEBGL2&&(this.unbindBuffer(Lt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Lt.PIXEL_PACK_BUFFER),this.unbindBuffer(Lt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Lt.COPY_READ_BUFFER),this.unbindBuffer(Lt.COPY_WRITE_BUFFER));for(let e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(Ce.ONE,Ce.ZERO),this.setBlendEquation(hy.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(Wf.BACK),this.setFrontFace(BO.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(zi.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(zi.ALWAYS,0,0),this.setStencilOp(Zn.KEEP,Zn.KEEP,Zn.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var s,o,a;const e=this.capabilities.vao;e&&e.bindVertexArray(null);const{gl:r,gl2:i}=this;for(let l=0;l<this.parameters.maxVertexAttributes;l++)r.disableVertexAttribArray(l);if(this._state.vertexBuffer?r.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):r.bindBuffer(Lt.ARRAY_BUFFER,null),this._state.indexBuffer?r.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):r.bindBuffer(Lt.ELEMENT_ARRAY_BUFFER,null),v(i)){this._state.uniformBuffer?i.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):i.bindBuffer(Lt.UNIFORM_BUFFER,null);for(let l=0;l<this._parameters.maxUniformBufferBindings;l++){const c=this._state.uniformBufferBindingPoints[l];if(v(c)){const{buffer:h,offset:p,size:f}=c;h!==null?p===0&&f===0?i.bindBufferBase(Lt.UNIFORM_BUFFER,l,h.glName):i.bindBufferRange(Lt.UNIFORM_BUFFER,l,h.glName,p,f):i.bindBufferBase(Lt.UNIFORM_BUFFER,l,null)}}this._state.pixelPackBuffer?i.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):i.bindBuffer(Lt.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?i.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):i.bindBuffer(Lt.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?i.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):i.bindBuffer(Lt.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?i.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):i.bindBuffer(Lt.COPY_WRITE_BUFFER,null),i.bindFramebuffer(Ro.READ_FRAMEBUFFER,null),i.readBuffer(i.BACK),this._state.readFramebuffer&&(i.bindFramebuffer(Ro.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),i.readBuffer(Ah.COLOR_ATTACHMENT0)),i.bindFramebuffer(Ro.DRAW_FRAMEBUFFER,((s=this._state.drawFramebuffer)==null?void 0:s.glName)??null)}else this._state.readFramebuffer=this._state.drawFramebuffer,r.bindFramebuffer(Ro.FRAMEBUFFER,((o=this._state.drawFramebuffer)==null?void 0:o.glName)??null);if(e&&this._state.vertexArrayObject){const l=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(l)}r.useProgram(((a=this._state.program)==null?void 0:a.glName)??null),r.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),r.bindRenderbuffer(r.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null),this._state.blend===!0?r.enable(this.gl.BLEND):r.disable(this.gl.BLEND),r.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),r.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),r.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),r.clearDepth(this._state.clearDepth),r.clearStencil(this._state.clearStencil),r.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),r.cullFace(this._state.cullFace),r.depthFunc(this._state.depthFunction),r.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),r.depthMask(this._state.depthWrite),r.frontFace(this._state.frontFace),r.lineWidth(1),this._state.faceCulling===!0?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),r.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?r.enable(r.POLYGON_OFFSET_FILL):r.disable(r.POLYGON_OFFSET_FILL),r.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?r.enable(r.SCISSOR_TEST):r.disable(r.SCISSOR_TEST),r.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),r.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),r.stencilMask(this._state.stencilWriteMask);for(let l=0;l<this.parameters.maxTextureImageUnits;l++){r.activeTexture(DH+l),r.bindTexture(Ct.TEXTURE_2D,null),r.bindTexture(Ct.TEXTURE_CUBE_MAP,null),this.type===Et.WEBGL2&&(r.bindTexture(Ct.TEXTURE_3D,null),r.bindTexture(Ct.TEXTURE_2D_ARRAY,null));const c=this._state.textureUnitMap[l];v(c)&&r.bindTexture(c.descriptor.target,c.glName)}r.activeTexture(DH+this._state.activeTexture);const n=this._state.viewport;r.viewport(n.x,n.y,n.width,n.height),this.resetInfo()}_loadExtensions(){this.type===Et.WEBGL1&&this.gl.getExtension("OES_element_index_uint"),this.gl.getExtension("KHR_parallel_shader_compile")}_loadParameters(e){const r=this.capabilities.textureFilterAnisotropic,i=e.maxAnisotropy??1/0,n=this.type===Et.WEBGL2,s=this.gl,o={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:r?Math.min(this.gl.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY),i):1,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE),maxUniformBufferBindings:n?s.getParameter(s.MAX_UNIFORM_BUFFER_BINDINGS):0,maxVertexUniformBlocks:n?s.getParameter(s.MAX_VERTEX_UNIFORM_BLOCKS):0,maxFragmentUniformBlocks:n?s.getParameter(s.MAX_FRAGMENT_UNIFORM_BLOCKS):0,maxUniformBlockSize:n?s.getParameter(s.MAX_UNIFORM_BLOCK_SIZE):0,uniformBufferOffsetAlignment:n?s.getParameter(s.UNIFORM_BUFFER_OFFSET_ALIGNMENT):1,maxArrayTextureLayers:n?s.getParameter(s.MAX_ARRAY_TEXTURE_LAYERS):1,maxSamples:n?s.getParameter(s.MAX_SAMPLES):1};return mt.TEXTURE_UNIT_FOR_UPDATES=o.maxTextureImageUnits-1,o}};function su(t,e,r,i){return e?i!==e&&t.bindBuffer(r,e.glName):t.bindBuffer(r,null),e}function Iwe(t,e){switch(t){case Ft.POINTS:return 2*e;case Ft.TRIANGLES:return e/3;case Ft.TRIANGLE_STRIP:case Ft.TRIANGLE_FAN:return e-2;default:return 0}}let L6t=class extends $6t{constructor(e,r,i){super(e,r),this.newCache=i,this._refCount=1}destroy(){--this._refCount>0||this.dispose()}ref(){++this._refCount}bindTechnique(e,r,i,n){return this.useProgram(e.program),e.bindPipelineState(this,i==null?void 0:i.slot,!!n),e.program.bindPass(r,i),e.program}get test(){return this.programCache.test}},bA=class extends be{constructor(e,r,i){super({}),this._stage=e,this._techniqueRepository=r,this._rctx=i,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new Sn,this._frameTask=e.view.resourceController.scheduler.registerTask(St.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this._stage.forEachOfType(Wn.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return R(this._textureTechnique)&&(this._textureTechnique=this._techniqueRepository.acquire(nce,new sce)),this._textureTechnique}acquire(e){const r=this._textures.get(e);return r?(r.ref(),Nt(r.loadingPromise,r)):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(r=>{const i=r.texture.frameUpdate(this._rctx,this.textureTechnique,r.previousToken);i>=0&&i!==r.previousToken&&(r.previousToken=i,e=!0)}),e&&this.events.emit("changed",Gn.BACKGROUND)}_createNewRef(e){const r=this._stage.getObject(e);if(R(r))return wt(r!==void 0),null;const i=r.events.on("unloaded",()=>{i.remove(),this._onTextureUnloaded(e)}),n=new D6t(e,()=>{this._frameTask.schedule(()=>{n.isUnreferenced&&r.unload()})});return this._textures.set(e,n),n.ref(),v(r.glTexture)?(this._updateGLTexture(n,r.glTexture),r.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:r,previousToken:-1}),n):(this._loadingCount++,n.loadingPromise=this._stage.schedule(()=>{const s=r.load(this._rctx,()=>this.textureTechnique),o=l=>(this._loadingCount--,n.loadingPromise=null,this._updateGLTexture(n,l),r.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:r,previousToken:-1}),n),a=l=>(this._loadingCount--,n.loadingPromise=null,ps(l)||re.getLogger(this.declaredClass).error(l),null);return Ju(s)?s.then(o,a):o(s)}),n.loadingPromise)}_updateGLTexture(e,r){e.glTexture=r,this.events.emit("changed",Gn.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};u([d()],bA.prototype,"_loadingCount",void 0),u([d()],bA.prototype,"_frameTask",void 0),u([d()],bA.prototype,"updating",null),bA=u([$("esri.views.3d.webgl-engine.lib.TextureRepository")],bA);let D6t=class{constructor(e,r){this.id=e,this._release=r,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(re.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}},KI=class extends be{constructor(){super(...arguments),this._passParameters=new N6t,this._loading=0}get passParameters(){return this._passParameters}destroy(){this._passParameters.waveNormal=rt(this._passParameters.waveNormal),this._passParameters.wavePertubation=rt(this._passParameters.wavePertubation)}get updating(){return this._loading>0}ensureResources(t){if(this._loading>0)return n_.LOADING;if(v(this._passParameters.waveNormal)&&v(this._passParameters.wavePertubation))return n_.LOADED;const e={target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.REPEAT,samplingMode:it.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,maxAnisotropy:8};return++this._loading,O_(si("esri/images/materials/water/normals.jpg")).then(r=>this._passParameters.waveNormal=new mt(t,{...e,width:r.width,height:r.height},r)).catch(r=>re.getLogger(this.declaredClass).error("Failed to load water material normal texture.",r)).finally(()=>--this._loading),++this._loading,O_(si("esri/images/materials/water/perturbation.jpg")).then(r=>this._passParameters.wavePertubation=new mt(t,{...e,width:r.width,height:r.height},r)).catch(r=>re.getLogger(this.declaredClass).error("Failed to load water material pertubation texture.",r)).finally(()=>--this._loading),n_.LOADING}};u([d()],KI.prototype,"_loading",void 0),u([d({type:Boolean,readOnly:!0})],KI.prototype,"updating",null),KI=u([$("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],KI);let N6t=class extends wi{},F6t=class{constructor(e,r){this.viewCamera=e,this.frameHasDecorations=r}},k6t=class{constructor(e,r,i,n){this._rctx=e,this._renderFunctions=r,this._forceCameraHook=i,this._disposeOffscreenBuffers=n,this.supersample=!0,this._screenshotQueue=new Array}destroy(){this._rctx=null}async takeScreenshot(e){await this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene(Gn.BACKGROUND);const r=qb();return this._screenshotQueue.push({settings:e,resolver:r}),r.promise}update(e,r){for(const i of this._screenshotQueue){if(this._rctx==null){i.resolver.reject();continue}const n={...i.settings,pixelRatio:i.settings.pixelRatio*e.viewCamera.pixelRatio},s=this._renderScreenshot(e,n,r);i.resolver(s)}this._screenshotQueue.length=0}_renderScreenshotOverlay(e,r,i){e.width=r.width,e.height=r.height;const n=e.getContext("2d"),s=i.pixelRatio;return n.save(),n.translate(0,r.height),n.scale(1,-1),i.region&&n.translate(-i.region.x,-i.region.y),n.scale(s,s),r=this._renderFunctions.renderOverlay(e,r),n.restore(),r}_readbackScreenshot(e,r){return e.resample?this._readbackScreenshotResampled({...e,resample:e.resample},r):this._readbackScreenshotImmediate(e,r)}_readbackScreenshotResampled(e,r){const{framebufferWidth:i,framebufferHeight:n,region:s,resample:o}=e,a=this._ensureScreenshotEncodeCanvas();let l=cH(i,n,a);this._rctx.gl.readPixels(0,0,i,n,Ge.RGBA,ft.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),r(),l=this._renderScreenshotOverlay(a,l,{...e,region:void 0});const c=cH(s.width,s.height,a);return pft(l,c,!0,o.region.x,n-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(e,r){const{framebufferHeight:i,region:n}=e,s=this._ensureScreenshotEncodeCanvas(),o=cH(n.width,n.height,s);return this._rctx.gl.readPixels(n.x,i-(n.y+n.height),n.width,n.height,Ge.RGBA,ft.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),r(),this._renderScreenshotOverlay(s,o,e)}_renderScreenshot(e,r,i){let n=null,s=null;const o=e.viewCamera,{framebufferWidth:a,framebufferHeight:l}=r;let c=!1;const h=r.disableDecorations&&e.frameHasDecorations,p=a!==o.fullWidth||l!==o.fullHeight,f=r.ignorePadding&&o.pixelRatio!==r.pixelRatio,m=p||h||f||r.objectAndLayerIdColor;if(r.objectAndLayerIdColor&&(s=new Jn(this._rctx,{width:a,height:l,colorTarget:xn.TEXTURE,depthStencilTarget:Ur.DEPTH_STENCIL_RENDER_BUFFER})),m){const w=o.clone();if(r.ignorePadding){const E=MN(w.padding);for(let C=0;C<4;C++)E[C]=Math.round(E[C]/w.pixelRatio*r.pixelRatio);w.padding=E}w.fullWidth=a,w.fullHeight=l,w.pixelRatio=r.pixelRatio;const x=o.fovX-w.fovX,T=o.fovY-w.fovY;x<0&&x<T?w.fovX=o.fovX:T<0&&T<x&&(w.fovY=o.fovY),this._forceCameraHook(w),c=!0,n=new Jn(this._rctx,{width:w.fullWidth,height:w.fullHeight,colorTarget:xn.TEXTURE,depthStencilTarget:Ur.DEPTH_STENCIL_RENDER_BUFFER}),this._renderFunctions.renderScene(n,s,w,r.disableDecorations?m2.OFF:m2.ON,i),this._disposeOffscreenBuffers()}const g=()=>{this._rctx.bindFramebuffer(null),rt(n)},_=this._readbackScreenshot(r,g);g();let b=null;if(r.objectAndLayerIdColor){const w=()=>{this._rctx.bindFramebuffer(null),rt(s)};this._rctx.bindFramebuffer(s),b=this._readbackScreenshot(r,w),this._rctx.bindFramebuffer(null),w()}if(m&&!this._rctx.contextAttributes.alpha)for(let w=3;w<_.data.length;w+=4)_.data[w]=255;if(b&&!this._rctx.contextAttributes.alpha)for(let w=3;w<b.data.length;w+=4)b.data[w]=255;return c&&this._forceCameraHook(o),[_,b]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}},ta=class extends be{constructor(e){super({}),this.events=new Sn,this.waterTextureRepository=new KI,this._magnifierHelper=new vA,this.objectAndLayerIdRenderHelper=ue("enable-feature:objectAndLayerId-rendering")?new J4t:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode,this._initializeContext(e),ne(()=>{var i;return(i=this.waterTextureRepository)==null?void 0:i.updating},()=>this.requestRender(),Vt),this._magnifierHelper.events.on("request-render",()=>this.requestRender()),this._stippleTextureRepository=new k5e(this._rctx),this._shaderTechniqueRepository=new I5e({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:this.waterTextureRepository}),this._textureRepository=new bA(e,this._shaderTechniqueRepository,this._rctx),this._textureRepository.events.on("changed",i=>this.requestRender(i)),this._materialRepository=new $5e(this._textureRepository,this._shaderTechniqueRepository,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new O4t(this._rctx,this._shaderTechniqueRepository),this.renderer=new wh(e,this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,i=>this.requestRender(i));const r={renderScene:(i,n,s,o,a)=>this.renderer.render(i,n,{camera:s,contentCamera:s,mode:Mr.IDLE},o,a),requestRenderScene:i=>this.requestRender(i),prepareOverlay:()=>e.options.screenshot.prepareOverlay(),renderOverlay:(i,n)=>e.options.screenshot.renderOverlay(i,n)};this._screenshotManager=new k6t(this._rctx,r,i=>this.events.emit("force-camera-for-screenshot",i),()=>this.renderer.disposeOffscreenBuffers()),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}destroy(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=$i(this._frameTask),this._shaderTechniqueRepository=ze(this._shaderTechniqueRepository)}get performanceInfo(){const e=this._rctx.gl;return{renderer:this.renderer.performanceInfo,textureMemory:e.getUsedTextureMemory!==void 0?e.getUsedTextureMemory():void 0,renderbufferMemory:e.getUsedRenderbufferMemory!==void 0?e.getUsedRenderbufferMemory():void 0,VBOMemory:e.getUsedVBOMemory!==void 0?e.getUsedVBOMemory():void 0}}requestRender(e=Gn.UPDATE){this._needsRender=!0,e===Gn.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(e){this._magnifierHelper.magnifier=e}setIdleSuspend(e){this._idleSuspend!==e&&(this._idleSuspend=e,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e).then(r=>r[0])}takeScreenshotWithOID(e){return e.objectAndLayerIdColor=!0,this._screenshotManager.takeScreenshot(e)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(e,r,i,n,s,o=s){const a=n.constrainWindowSize(r,i,s*n.pixelRatio,o*n.pixelRatio),l=this._ensureDepthBuffer(a);this.renderer.readDepthPixels(n,a,l);let c=Number.MAX_VALUE;for(let h=0;h<a[2]*a[3];h++){const p=L4t(4*h,l,n.nearFar);c>p&&p!==n.nearFar[0]&&p!==n.nearFar[1]&&(c=p)}if(v(e)){const h=e.pickDepth(r*n.pixelRatio,i*n.pixelRatio,n);v(h)&&c>h&&h!==n.nearFar[0]&&h!==n.nearFar[1]&&(c=h)}return c===Number.MAX_VALUE?void 0:c}_ensureDepthBuffer(e){const r=4*e[2]*e[3];return(R(this._tmpDepthBuffer)||this._tmpDepthBuffer.byteLength<r)&&(this._tmpDepthBuffer=new Uint8Array(r)),this._tmpDepthBuffer}async reloadShaders(){nUe(),await this._shaderTechniqueRepository.reloadAll(),this.requestRender()}_registerFrameTask(e){const r=e.view.state;let i=!1,n=Gn.BACKGROUND,s=!1;const o={preRender:({time:a})=>{i=this.updating,n=this._needsUpdate?Gn.UPDATE:Gn.BACKGROUND,e.commitSyncLayers();const l=a-this._lastAnimationUpdate;if(l>this.renderer.animationTimestep||v(r.forcedAnimationTime)||i||this._needsRender){const c=l/this.renderer.animationTimeDilation,h=new _4e(r.camera,c,r.forcedAnimationTime);this.renderer.updateAnimation(h)&&this.requestRender(Gn.BACKGROUND),this._lastAnimationUpdate=a}},render:({time:a})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&r.camera.fullWidth>0&&r.camera.fullHeight>0){const l=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this.renderer.render(null,null,r,m2.ON,a),s=!0,l&&this.renderer.hasWaterReflection&&(this.requestRender(Gn.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:a})=>{const l=new F6t(r.camera,this.renderer.hasSlicePlane||this._magnifierHelper.enabled);this._textureRepository.update(),this._screenshotManager.update(l,a)},finish:()=>{s&&(this.renderer.finish(r.mode===Mr.IDLE?n:Gn.UPDATE),s=!1)}};this._frameTask=v_(o)}_initializeContext(e){const r=e.options;this._canvas=r.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const i={alpha:r.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:r.stencil==null||r.stencil,powerPreference:"high-performance",preserveDrawingBuffer:r.preserveDrawingBuffer??!1},n=Sft("3d",this._canvas,i);if(R(n)){const s=ue("esri-force-webgl");re.getLogger(this.declaredClass).error(s)}else this._rctx=this._newRenderingContext(n,e),this._loadShaderOnlyExtensions(),!r.alpha&&this._rctx.contextAttributes.alpha&&re.getLogger(this.declaredClass).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&ue("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)}_newRenderingContext(e,r){const i={disabledExtensions:r.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:r.options.debugWebGLExtensions||{},maxAnisotropy:8},n=(s,o)=>r.view.resourceController.memoryController.newCache(s,o);return new L6t(e,i,n)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("standardDerivatives"),this._rctx.capabilities.enable("shaderTextureLOD"),this._rctx.capabilities.enable("textureFloat")}getObjectAndLayerIdColor(e){return v(this.objectAndLayerIdRenderHelper)?this.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(e):null}get componentObjectCollection(){return R(this._componentObjectCollection)&&(this._componentObjectCollection=new v4t(this.renderer.renderPassManager,this._viewingMode)),this._componentObjectCollection}set componentObjectCollection(e){this._componentObjectCollection=e}};u([d({type:Boolean,readOnly:!0})],ta.prototype,"updating",null),u([d({autoDestroy:!0})],ta.prototype,"_rctx",void 0),u([d({autoDestroy:!0})],ta.prototype,"_container",void 0),u([d({autoDestroy:!0})],ta.prototype,"_canvas",void 0),u([d({autoDestroy:!0})],ta.prototype,"_stippleTextureRepository",void 0),u([d({autoDestroy:!0})],ta.prototype,"waterTextureRepository",void 0),u([d({autoDestroy:!0})],ta.prototype,"_magnifierHelper",void 0),u([d({readOnly:!0})],ta.prototype,"objectAndLayerIdRenderHelper",void 0),u([d({autoDestroy:!0})],ta.prototype,"_textureRepository",void 0),u([d({autoDestroy:!0})],ta.prototype,"_compositingHelper",void 0),u([d({autoDestroy:!0,readOnly:!0})],ta.prototype,"renderer",void 0),u([d({autoDestroy:!0})],ta.prototype,"_screenshotManager",void 0),u([d()],ta.prototype,"componentObjectCollection",null),u([d({autoDestroy:!0})],ta.prototype,"_componentObjectCollection",void 0),u([d()],ta.prototype,"_needsUpdate",void 0),u([d()],ta.prototype,"_needsWaterReflectionUpdate",void 0),ta=u([$("esri.views.3d.webgl-engine.parts.RenderView")],ta);let _u=class extends be{constructor(t){super(t),this._handles=new qr,this._model=new XU,this._layers=new Wt,this._asyncChangeSet=new Cte,this._syncChangeSet=new Cte,this._layerSyncSet=new Set}initialize(){this._set("renderView",new ta(this)),this._frameTask=this.view.resourceController.scheduler.registerTask(St.STAGE,this),this._handles.add(this._frameTask)}destroy(){this._handles.destroy()}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||this.renderView.updating||this._frameTask.updating}get renderer(){var t;return(t=this.renderView)==null?void 0:t.renderer}add(t){this._model.add(t),IV(t)&&(t.attachStage(this),this._addLayer(t)),this.renderView.requestRender()}remove(t){R(t)||(this.renderView.requestRender(),this._model.remove(t),IV(t)&&(this._removeLayer(t),t.detachStage()))}addMany(t){v(t)&&(this._model.addMany(t),this.renderView.requestRender())}removeMany(t){v(t)&&(this._model.removeMany(t),this.renderView.requestRender())}async load(t,e){R(t)||(Array.isArray(t)||(t=[t]),await Promise.all(t.filter(r=>R(r.glTexture)).map(r=>this.schedule(()=>this._model.has(r)?r.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique):null),e)))}loadImmediate(t){return t.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique)}forEachOfType(t,e){this._model.forEachOfType(t,e)}handleEvent(t,e){this.destroyed||(this._model.dirtySet[t](e),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(t){this._frameTask.processQueue(t),this._commit(t)}_commit(t){const e=this._model.dirtySet;this._asyncChangeSet.empty||t.done||(this.renderer.modify(this._asyncChangeSet,t),this.renderView.requestRender(),t.madeProgress()),this._layers.forAll(r=>{if(t.done)return;const i=this._layerSyncSet.has(r.id)||r.updatePolicy===Vb.SYNC,n=i?this._syncChangeSet:this._asyncChangeSet;e.commitLayer(r.id,n),this._layerSyncSet.delete(r.id),n.empty||(this.renderer.modify(n,i?jl:t),this.renderView.requestRender(),t.madeProgress())}),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,jl),this.renderView.requestRender(),t.madeProgress()),this._layers.forAll(r=>{t.done||this._layerSyncSet.has(r.id)||r.updatePolicy!==Vb.ASYNC||(e.commitLayer(r.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,t),this.renderView.requestRender(),t.madeProgress()))}),this._layerSyncSet.clear(),this.notifyChange("running")}commitSyncLayers(){const t=this._model.dirtySet;this._layers.forAll(e=>{(this._layerSyncSet.has(e.id)||e.updatePolicy===Vb.SYNC)&&(t.commitLayer(e.id,this._syncChangeSet),this._layerSyncSet.delete(e.id))});for(const e of this._layerSyncSet)t.commitLayer(e,this._syncChangeSet);this._layerSyncSet.clear(),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,jl),this.renderView.requestRender())}_commitLayer(t){this._model.dirtySet.commitLayer(t.id,this._syncChangeSet),this._layerSyncSet.delete(t.id),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,jl),this.renderView.requestRender())}schedule(t,e){return this._frameTask.schedule(t,e)}reschedule(t,e){return this._frameTask.reschedule(t,e)}syncLayer(t){this._layerSyncSet.add(t),this.renderView.requestRender()}getObject(t){return this._model.getObject(t)}get layers(){return this._layers}_addLayer(t){this._layers.includes(t)||this._layers.push(t)}_removeLayer(t){this._commitLayer(t),this._layers.removeUnordered(t)!=null&&(this._model.dirtySet.getResidentRenderGeometries(t.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,jl))}addRenderPlugin(t,e,r){const i=this.renderer.renderPlugins.add(t,e,r),n=()=>{w1e(e)&&this.view.sceneIntersectionHelper.addIntersectionHandler(e)};if(Ju(i))return i.then(n);n()}removeRenderPlugin(t){w1e(t)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(t),this.renderer.renderPlugins.remove(t)}get performanceInfo(){return{renderView:this.renderView.performanceInfo,model:this._model.getStats()}}get test(){const t=this;return{getCount:e=>t._model.test.content.filter(r=>r.type===e).length,model:t._model}}};_u.DebugSettings={endFrameContentValidation:!1},u([d({constructOnly:!0})],_u.prototype,"view",void 0),u([d({constructOnly:!0})],_u.prototype,"options",void 0),u([d({readOnly:!0})],_u.prototype,"viewingMode",null),u([d({constructOnly:!0})],_u.prototype,"container",void 0),u([d({constructOnly:!0})],_u.prototype,"_handles",void 0),u([d({readOnly:!0})],_u.prototype,"updating",null),u([d({constructOnly:!0})],_u.prototype,"_model",void 0),u([d({autoDestroy:!0})],_u.prototype,"renderView",void 0),u([d({readOnly:!0})],_u.prototype,"renderer",null),u([d({readOnly:!0})],_u.prototype,"running",null),_u=u([$("esri.views.3d.webgl-engine.Stage")],_u);let Iir=class extends i7{constructor(e,r,i,n){super(r,i),this.point=e,this.createGraphic=n}};function eze(t){return xm(t)&&t.intersector===pn.PCL&&!!t.target}let Lir=class extends GNe{constructor(e,r,i,n,s){super(e),this.layerUid=e,this.sublayerUid=r,this.nodeIndex=i,this.componentIndex=n,this.triangleNr=s}},Nir=class extends i7{constructor(e,r,i){super(r,null),this.point=e,this.createVoxelGraphic=i}};function H7(t){return xm(t)&&t.intersector===pn.I3S&&!!t.target}function tze(t){return xm(t)&&t.intersector===pn.VOXEL&&!!t.target}function $we(t,e){var r,i;return n7(t)||s7(t)?YD((r=t.target)==null?void 0:r.object.metadata,e):wAt(t)?(i=e.map)==null?void 0:i.ground:eze(t)||H7(t)||eke(t)||tze(t)?YD(t.target,e):null}function kir(t,e){const r=yre(t,e);return v(r)&&r.type==="graphic"?r.graphic:null}function yre(t,e){var r;if(R(t))return null;if(n7(t)||s7(t))return Lwe((r=t.target)==null?void 0:r.object.metadata,e);if(eze(t)){const i=t.target.createGraphic();return{type:"graphic",graphic:i,layer:i.layer}}if(tze(t)){const i=t.target.createVoxelGraphic();return{type:"graphic",graphic:i,layer:i.layer}}return eke(t)||dce(t)?Lwe(t.target,e):H7(t)?U6t(t.target,e):null}function Lwe(t,e){if(R(t)||R(t.graphicUid))return null;const r=YD(t,e);if(R(r))return null;if(r===e.graphics)return R(e.graphicsView)||typeof t.graphicUid!="number"?null:e.graphicsView.getHit(t.graphicUid);const i=e.allLayerViews.find(n=>n.layer===r);return!i||i.suspended||R(t.graphicUid)?null:"getHit"in i?i.getHit(t.graphicUid):null}function U6t(t,e){const r=YD(t,e);if(R(r))return null;const i=e.allLayerViews.find(n=>n.layer===r);return i&&!i.suspended&&"getGraphicFromIntersectorTarget"in i?V6t(i.getGraphicFromIntersectorTarget(t)):null}function z6t(t,e){const r=YD(t,e);if(R(r))return null;const i=e.allLayerViews.find(n=>n.layer===r);return i&&!i.suspended&&"getAABBFromIntersectorTarget"in i?i.getAABBFromIntersectorTarget(t):null}function V6t(t){return v(t)?{type:"graphic",graphic:t,layer:t.layer}:null}function YD(t,e){return!t||R(t.layerUid)?null:v(e.graphicsView)&&t.layerUid===e.graphicsView.processor.layer.id?e.graphics:e.map.findLayerByUid(t.layerUid)}function Uir(t,e){if(n7(t)||s7(t))return i_(t.target.object.boundingVolumeWorldSpace.bounds);if(dce(t)){CAe(Pk,t.transformation);const r=Math.max(Pk[0],Pk[1],Pk[2]);return t.target.baseBoundingSphere.radius*r}return H7(t)?Fo(z6t(t.target,e),r=>.5*mCe(r)):null}function zir(t){return!n7(t)&&!s7(t)&&(dce(t)?t.target.numLodLevels>1:!!H7(t))}const Pk=P();async function B6t(t,e){if(t.type==="2d")return t.hitTest(e);const r=await t.hitTest(e);if(r.results.length===0)return r;const i=r.results[0],n=(i.distance??0)*(1+j6t),s=r.results.findIndex(o=>(o.distance??0)>n);return s!==-1&&(r.results=r.results.slice(0,s)),r}const j6t=.05;let QU=class extends D$e{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};u([d()],QU.prototype,"components",void 0),QU=u([$("esri.views.ui.3d.DefaultUI3D")],QU);const rze=QU;let ht=class extends eRe(cIe(uIe(CIe))){constructor(t){super(t),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._defaults={},this._externallySet={environment:!1},this._createGraphicsViewController=null,this._lostWebGLContextHandle=null,this._resolveWhenReady=[],this._propertiesPool=new S_({slicePlane:LLe},this),this._resourceController=$$t(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new yte({view:this}),this.labeler=new MT({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new DO,this.basemapTerrain=null,this.elevationProvider=null,this.canvas=null,this.constraints=new QT,this.environmentManager=new gf,this.floors=new ct,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new o0t({view:this}),this.groundView=null,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new e$t,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new rze,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.highlightOptions=new Vte,this.voxelWasm=null,this.voxelWasmPromise=null,bAe(),t&&t.environment||(this._defaults.environment=new aA,this.environment=this._defaults.environment);const e=(r=null)=>{v(r)&&r.type===xi.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async i=>{try{await i.when()}catch{}this._updatingChanged()}))};this.handles.add([Yn(()=>{var r;return(r=this.map)==null?void 0:r.allLayers},"after-changes",r=>e(r),{onListenerAdd:()=>e(),onListenerRemove:()=>e(),sync:!0}),this.allLayerViews.on("after-changes",r=>this._updateUpdatingMonitors(r)),ne(()=>this.map,r=>{r&&"load"in r&&r.load&&r.load().catch(()=>{})})]),this.inputManager=new aSt({view:this}),this.stateManager=new Ds({view:this})}initialize(){this.groundView=new n0t({view:this}),this._updateUpdatingMonitors();const t=()=>this._updateDefaultToMapOptions();this.handles.add(Yn(()=>{var e;return(e=this.map)==null?void 0:e.allLayers},"after-changes",t,{onListenerAdd:t,onListenerRemove:t})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,e=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=e)},Vt),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,e=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=e)},Vt),this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,e=>gje(e>0?1e3/Math.ceil(e):0),Vt),this.updatingHandles.add(()=>{var e;return(e=this.map)==null?void 0:e.ground},t,Wi),this.updatingHandles.add(()=>{var e,r;return(r=(e=this.map)==null?void 0:e.ground)==null?void 0:r.opacity},()=>this._updateDefaultHitTestOptions(),Wi),this.handles.add(ne(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),Zr))}destroy(){this.destroyed||(this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=ze(this.sharedSymbolResources),this._set("labeler",ze(this.labeler)),this._set("deconflictor",ze(this.deconflictor)),this._resourceController=ze(this._resourceController),this._set("stateManager",ze(this.stateManager)),this._set("inputManager",ze(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.handles.remove("updatingMonitors"),this._set("environmentManager",ze(this.environmentManager)),this.groundView=ze(this.groundView))}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){var t;return(t=this.basemapTerrain)==null?void 0:t.spatialReference}get animation(){var t;return(t=this.state)==null?void 0:t.animation}get camera(){var t;return(t=this.stateManager)==null?void 0:t.camera}set camera(t){this.stateManager&&(this.stateManager.camera=t)}get contentCamera(){var t;return(t=this.stateManager)==null?void 0:t.contentCamera}set contentCamera(t){this.stateManager&&(this.stateManager.contentCamera=t)}installContentCameraReset(t={sticky:!1}){return this.stateManager.installContentCameraReset(t)}get center(){var t;return(t=this.stateManager)==null?void 0:t.center}set center(t){this.stateManager&&(this.stateManager.center=t)}get clippingArea(){var e;if(this.viewingMode==="global")return null;let t=this._userClippingArea||("clippingArea"in this.map?(e=this.map)==null?void 0:e.clippingArea:void 0);return!(this._userClippingArea||this.get("map.clippingEnabled"))||R(t)?(this._clippingArea=null,null):t instanceof ur?this.spatialReference&&(t=Ik(t,this.spatialReference),R(t))?(re.getLogger(this.declaredClass).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(t=t.clone(),R(t.intersection(this._groundAndLayersExtent))&&(t.xmin=t.xmax,t.ymin=t.ymax),t.zmin=void 0,t.zmax=void 0,t.equals(this._clippingArea)||(this._clippingArea=t),this._clippingArea):(re.getLogger(this.declaredClass).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(t){this.ready&&this.viewingMode==="global"&&v(t)?re.getLogger(this.declaredClass).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=t}get renderDataExtent(){if(this.state.viewingMode===qe.Global)return null;const t=this.renderSpatialReference,e=this.dataExtent;return R(e)||R(t)||e.spatialReference.equals(t)?e:Ik(e,t)}get dataExtent(){let t=this._groundAndLayersExtent;const e=this.spatialReference||Je.WGS84,r=Ik(this.clippingArea,e);v(r)&&(t=v(t)?t.intersection(r):r);const i=this._get("dataExtent");return v(t)&&t.equals(i)?i:t}get _groundAndLayersExtent(){const t=this.spatialReference||Je.WGS84;let e;const r=s=>{const o=Ik(s,t);R(o)||(v(e)?e.union(o):e=o.clone())},i=this.basemapTerrain;if(i!=null&&i.spatialReference){const s=i.groundExtent;r(new ur({xmin:s[0],ymin:s[1],zmin:0,xmax:s[2],ymax:s[3],zmax:0,spatialReference:i.spatialReference}))}if(this.map){const s=o=>{!v(o.fullExtent)||o.type==="graphics"&&o.internal||r(o.fullExtent)};this.map.allLayers.forEach(o=>s(o))}if(R(e))return null;e.hasZ?(e.zmin=Math.min(0,e.zmin??0),e.zmax=Math.max(0,e.zmax??0)):(e.zmin=0,e.zmax=0);const n=this._get("_groundAndLayersExtent");return e.equals(n)?n:e}set environment(t){t!==this._defaults.environment&&(this._externallySet.environment=!0),this._set("environment",t)}castEnvironment(t){return t?t instanceof aA?t:t instanceof nDe?this.environment!=null?this.environment.cloneWithWebsceneEnvironment(t):aA.fromWebsceneEnvironment(t):bs(aA,t):new aA}get extent(){var t;return(t=this.stateManager)==null?void 0:t.extent}set extent(t){this.stateManager&&(this.stateManager.extent=t)}get screenCenter(){var t;return(t=this.stateManager)==null?void 0:t.screenCenter}get frustum(){var t;return(t=this.stateManager)==null?void 0:t.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||v(this.activeTool)&&this.activeTool.visible}get stationary(){return!this.animation&&!this.resizing&&(R(this.state)||this.state.stationary)}get navigating(){var t;return((t=this.state)==null?void 0:t.navigating)??!1}get padding(){var t;return(t=this.stateManager)==null?void 0:t.padding}set padding(t){this.stateManager&&(this.stateManager.padding=t)}set qualityProfile(t){zU.isValidProfile(t)&&(zU.apply(t,this.qualitySettings),this._set("qualityProfile",t))}get qualityProfile(){return this._get("qualityProfile")||zU.getDefaultProfile()}set slicePlane(t){if(v(this._stage)&&this._stage.renderer.setParameters({slicePlane:t}),R(t))return void this._set("slicePlane",null);const e=this._propertiesPool.get("slicePlane");G2(t,e),this._set("slicePlane",e)}get typeSpecificPreconditionsReady(){return!!this.viewingMode}get resolution(){return this.spatialReference!=null?jyt(this.scale,this.spatialReference):0}get scale(){var t;return(t=this.stateManager)==null?void 0:t.scale}set scale(t){this.stateManager&&(this.stateManager.scale=t)}get heightModelInfo(){const t=this.getDefaultHeightModelInfo();return t!=null?E3.deriveUnitFromSR(t,this.spatialReference):null}get updating(){var n,s,o;if(this.destroyed)return!1;let t=0,e=this.layerViewManager.updating,r=e?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(a=>{if(a.isFulfilled()){if(a.updating){if(e=!0,a.suspended||jD(a))return;++r,t+=a.updatingProgress}}else++r});for(const a of[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager])v(a)&&a.updating&&(r+=.1,t+=.5*.1);for(const a of[this.deconflictor,this.labeler,this.basemapTerrain])v(a)&&a.updating&&(++r,t+=a.updatingProgress);const i=this.stateManager.test.updatingIgnoreRenderState?Mr.IDLE:this.state.mode;if(e=!!(e||r>0||this.updatingHandles.updating||!this.ready||!this.stationary||i!==Mr.IDLE||this._createGraphicsViewController||(n=this.inputManager)!=null&&n.hasPendingInputs||(o=(s=this.map)==null?void 0:s.allLayers)!=null&&o.some(a=>!a.isFulfilled())),e?(this._numUpdating=Math.max(r,this._numUpdating),t+=this._numUpdating-r):this._numUpdating=0,this._numUpdating>0?t/=this._numUpdating:t=e?0:1,this._get("updatingProgress")!==t){const a=performance.now();if(t<1){const l=Math.min((a-this._lastUpdateTime)/2e3,1);t=this.updatingProgress*(1-l)+t*l}this._set("updatingProgress",t),this._lastUpdateTime=e&&t<1?a:0}return e}get viewingMode(){var r;const t=this._predeterminedViewingMode;if(v(t))return KG(t);const e=this.spatialReference;return e?v((r=this.defaultsFromMap)==null?void 0:r.viewingMode)&&e.equals(this.defaultsFromMap.spatialReference)?KG(this.defaultsFromMap.viewingMode):bV(e,qe.Global)?"global":"local":"global"}set viewingMode(t){this.ready?re.getLogger(this.declaredClass).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",t)}get viewpoint(){var t;return(t=this.stateManager)==null?void 0:t.viewpoint}set viewpoint(t){this.stateManager&&(this.stateManager.viewpoint=t)}get zoom(){return this.stateManager.zoom}set zoom(t){this.stateManager&&(this.stateManager.zoom=t)}get resourceController(){return this._resourceController}get performanceInfo(){return new sLt(this)}on(t,e,r,i){return this.viewEvents.on(t,e,r,i)||super.on(t,e)}hasEventListener(t){return super.hasEventListener(t)||this.viewEvents.hasHandler(t)}toMap(t,e){if(!this.ready)return re.getLogger(this.declaredClass).error("#toMap()","Scene view cannot be used before it is ready"),null;const r=e?this.externalToInternalIntersectOptions(e):this._defaultToMapOptions,i=v(r.graphics)&&(v(r.graphics.include)||v(r.graphics.exclude)),n=jz(t)?Bz(this,t):t,s=Og(n);r.enableDraped=r.include&&!r.include.has(Y1)||r.exclude&&r.exclude.has(Y1);const o=this.sceneIntersectionHelper,a=Pp(this.state.viewingMode);if(a.options.selectionMode=!0,a.options.store=i?ba.ALL:ba.MIN,o.intersectIntersectorScreen(s,a,r),i){for(const l of a.results.all){const c=yre(l,this);if(R(c))return this._intersectResultToMapPoint(l);if(c.type!=="graphic"||this._testGraphicUidFilter(r.graphics,c.graphic))return this._intersectResultToMapPoint(l)}return null}return this._intersectResultToMapPoint(a.results.min)}toScreen(t){if(!this.ready)return re.getLogger(this.declaredClass).error("#toScreen()","Scene view cannot be used before it is ready"),null;const e=Nt(t.z==null?Fg(this.elevationProvider,t):null,0);return Ba(t,fC,this.renderSpatialReference,e),this.state.camera.projectToScreen(fC,XW),Gs(XW[0],XW[1])}pixelSizeAt(t){return this.ready?t?(Ba(t,fC,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(fC)):0:(re.getLogger(this.declaredClass).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(t){const e=this.basemapTerrain.overlayManager;return e?e.overlayPixelSizeInMapUnits(t):1}hitTest(t,e){if(!this.ready)return re.getLogger(this.declaredClass).error("#hitTest()","Scene view cannot be used before it is ready"),null;const r=jz(t)?Bz(this,t):t,i=wn(r.x,r.y),n=e?this.externalToInternalIntersectOptions(e):this._defaultHitTestOptions;n.requiresGroundFeedback=!0,n.enableDraped=!0;const s=Pp(this.state.viewingMode);s.options.selectionMode=!0,s.options.store=ba.ALL,this.sceneIntersectionHelper.intersectIntersectorScreen(i,s,n);const o=this._intersectResultsToHits(s.results.all,n.graphics),a=s.results.ground,l=$we(a,this),c=v(l)&&"type"in l&&l.type==="integrated-mesh"?l:null,h={screenPoint:r,results:o,ground:{mapPoint:this._intersectResultToMapPoint(a),distance:xm(a)?a.distanceInRenderSpace:0,layer:c}};return Qr.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(h.intersector=s),Promise.resolve(h)}async popupHitTest(t){const{results:e,ground:r}=await B6t(this,t);let i=null;return!(e.length===0||Math.abs(Nt(e[0].distance,0)-r.distance)<1e-5)||r.layer&&r.layer.type==="integrated-mesh"||(i=r.mapPoint),{results:e,screenPoint:t,mapPoint:i}}goTo(t,e){return this.updatingHandles.addPromise(this.stateManager.goTo(t,e))}async whenAnalysisView(t){if(R(t.parent))throw new H("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:t});switch(t.parent.type){case"line-of-sight":case"dimension":return(await this.whenLayerView(t.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(t)}}whenLayerView(t){return super.whenLayerView(t)}async takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshot(e);return uU(r,e,this._pixelFormat())}async _takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshot(e);return hU(r,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(t){const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshotWithOID(e);return[hU(r[0],this._pixelFormat()),hU(r[1],this._pixelFormat())]}_completeSettings(t){const e=lft(t,this);return e.pixelRatio/=this.state.pixelRatio,fft(e,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:t=>this._takeScreenshot(t),takeScreenshotWithObjectAndLayerId:t=>this._takeScreenshotWithObjectAndLayerId(t)}}async takeScreenshotWithObjectAndLayerId(t){if(!ue("enable-feature:objectAndLayerId-rendering"))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshotWithOID(e),i=uU(r[0],e,this._pixelFormat()),n=this._completeSettings(t);return n.format="png",[i,uU(r[1],n,this._pixelFormat())]}getColorToObjectAndLayerIdMapping(){if(R(this._stage.renderView.objectAndLayerIdRenderHelper))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");return this._stage.renderView.objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()}addUpdatingPromise(t){return this.updatingHandles.addPromise(t)}importLayerView(t){return oye.importLayerView(t)}hasLayerViewModule(t){return oye.hasLayerViewModule(t)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var t,e,r,i;return this.map&&"initialViewProperties"in this.map&&((e=(t=this.map)==null?void 0:t.initialViewProperties)==null?void 0:e.spatialReference)||((r=this.defaultsFromMap)==null?void 0:r.spatialReference)||((i=this.defaultsFromMap)==null?void 0:i.ready)&&this._initialDefaultSpatialReference||null}async validate(){let t=O$e(this.type);const e=ue("safari");if(e&&e<9&&(t=new H("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:e})),v(t))throw re.getLogger(this.declaredClass).warn("#validate()",t.message),t}get _predeterminedViewingMode(){var e;const t=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?(e=this.map.initialViewProperties)==null?void 0:e.viewingMode:null)??null;return v(t)?tge(t):null}getSpatialReferenceSupport({spatialReference:t,layer:e}){const r=this._predeterminedViewingMode;if(v(r))return this._validateSpatialReferenceForViewingMode(t,e,r)?{constraints:this._makeSpatialReferenceConstraints(t,e,r)}:null;const i=this._validateSpatialReferenceForViewingMode(t,e,qe.Local),n=this._validateSpatialReferenceForViewingMode(t,e,qe.Global);return i||n?i&&n?{constraints:this._makeSpatialReferenceConstraints(t,e,null)}:i?{constraints:this._makeSpatialReferenceConstraints(t,e,qe.Local)}:{constraints:this._makeSpatialReferenceConstraints(t,e,qe.Global)}:null}_validateSpatialReferenceForViewingMode(t,e,r){return!!bV(t,r)&&(!!R(e)||!!ope(e)||(!E$(e)||!R(F7(e,t,r)))&&(!spe(e)||r!==qe.Global))}_makeSpatialReferenceConstraints(t,e,r){if(R(e))return[{spatialReference:t,viewingMode:r}];const i=t.isWebMercator,n=t.isWGS84;return ope(e)&&(i||n)?!n||r===qe.Local||wce(e.tileInfo,e.fullExtent,t,qe.Global)===null?[{spatialReference:t,viewingMode:r},{spatialReference:Je.WebMercator,viewingMode:r}]:[{spatialReference:i?Je.WGS84:Je.WebMercator,viewingMode:r}]:E$(e)||spe(e)||!i&&!n?E$(e)&&i&&r!==qe.Global?[{spatialReference:t,viewingMode:r},{spatialReference:Je.WGS84,viewingMode:qe.Local}]:[{spatialReference:t,viewingMode:r}]:[{spatialReference:t,viewingMode:r},{spatialReference:i?Je.WGS84:Je.WebMercator,viewingMode:r}]}_validateSpatialReference(t){const e=v(this.getSpatialReferenceSupport({spatialReference:t})),r=this._predeterminedViewingMode;return e||(v(r)?re.getLogger(this.declaredClass).warnOnce(`Spatial reference defined on view not supported in ${KG(r)} viewing mode.`):t.isGeographic&&re.getLogger(this.declaredClass).warnOnce("Spatial reference is geographic but not supported.")),e}whenReady(){return new Promise(t=>{this.ready?t(this):this._resolveWhenReady.push(t)})}computeMapPointFromVec3d(t,e){let r=this.spatialReference||Je.WGS84;return zo(t,this.renderSpatialReference,t,r)||(r=Je.WGS84,zo(t,this.renderSpatialReference,t,r)),e?(e.x=t[0],e.y=t[1],e.z=t[2],e.spatialReference=r):e=new Ue(t,r),e}trackGraphicState(t){if(!t.graphic)return re.getLogger(this.declaredClass).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const e=this.getViewForGraphic(t.graphic);let r=null,i=!1;const n=s=>{var o;!i&&v(s)&&"processor"in s&&((o=s.processor)==null?void 0:o.type)==="graphics-3d"&&s.processor.graphicsCore&&(r=s.processor.graphicsCore.trackGraphicState(t))};return v(e)?n(e):this.whenViewForGraphic(t.graphic,{waitForLayer:!0}).then(s=>n(s),()=>{}).catch(()=>{}),{remove:()=>{i=!0,v(r)&&(r.remove(),r=null)}}}highlight(t){if(Array.isArray(t))return oO(t.map(r=>this.highlight(r)));if(ct.isCollection(t))return oO(t.toArray().map(r=>this.highlight(r)));const e=this.getViewForGraphic(t);return e&&"highlight"in e?e.highlight(t):am()}maskOccludee(t){if(!t)return re.getLogger(this.declaredClass).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const e=this.getViewForGraphic(t);let r=null,i=!1;const n=s=>{!i&&v(s)&&Hut(s)&&(r=s.maskOccludee(t))};return v(e)?n(e):this.whenViewForGraphic(t,{waitForLayer:!0}).then(s=>n(s),()=>{}).catch(()=>{}),{remove:()=>{i=!0,v(r)&&(r.remove(),r=null)}}}getViewForGraphic(t){return t.layer===this.graphics?this.graphicsView:t.layer?this.allLayerViews.find(e=>e.layer===t.layer):null}graphicChanged(t){v(this.graphicsView)&&this.graphicsView.graphicChanged(t)}async whenViewForGraphic(t,e){if(t.layer===this)return await tw(()=>this.graphicsView),this.graphicsView;if(!t.layer||!this.map)throw new H("no-view-for-graphic");return e&&e.waitForLayer&&!this.map.allLayers.includes(t.layer)?new Promise((r,i)=>{const n=this.map.allLayers.on("change",s=>{s.added.includes(t.layer)&&(n.remove(),this.whenLayerView(t.layer).then(r,i))})}):this.whenLayerView(t.layer)}externalToInternalIntersectOptions(t){const e=this._externalToInternalRenderItems(t.include,cL.INCLUDE),r=this._externalToInternalRenderItems(t.exclude,cL.EXCLUDE);return{include:e.layerUids,exclude:r.layerUids,graphics:{include:e.graphicUids,exclude:r.graphicUids}}}_intersectResultToMapPoint(t,e){return t.getIntersectionPoint(fC)?(e=this.computeMapPointFromVec3d(fC,e),t.intersector===pn.TERRAIN&&this.basemapTerrain&&(e.z=Nt(Fg(this.basemapTerrain,e),0)),e):null}_intersectResultsToHits(t,e){const r=new Array;let i=null;for(let n=0;n<t.length;n++){const s=t[n],o=$we(s,this);if(v(o)&&(o===this.map.ground||"type"in o&&o.type==="integrated-mesh"))break;const a=yre(s,this);if(R(a))continue;if(a.type==="graphic"){if(R(i)&&n!==t.length-1&&(i=new Set),v(i)){const h=this._getGraphicFilterUid(a.graphic);if(i.has(h))continue;i.add(h)}if(!this._testGraphicUidFilter(e,a.graphic))continue}const l=this._intersectResultToMapPoint(s),c=s.distanceInRenderSpace;r.push({...a,mapPoint:l,distance:c})}return r}_getGraphicFilterUid(t){var n;const e=t.sourceLayer,r=t.layer,i=e&&"objectIdField"in e?e:r&&"objectIdField"in r?r:e;if(i){const s=i.objectIdField??YPe,o=(n=t.attributes)==null?void 0:n[s];if(o)return`o-${i.id}-${o}`}return`u-${t.uid}`}_testGraphicUidFilter(t,e){const r=this._getGraphicFilterUid(e);return R(t)||(R(t.include)||t.include.has(r))&&(R(t.exclude)||!t.exclude.has(r))}_externalToInternalRenderItems(t,e,r={layerUids:void 0,graphicUids:void 0}){if(!t)return r;if(t instanceof Va)G6t(r,this._getGraphicFilterUid(t)),e===cL.INCLUDE&&(v(this.graphicsView)&&t.layer===this?pP(r,this.graphicsView.processor.layer.id):t.layer&&pP(r,t.layer.uid));else if(LL(t))for(const i of t)i===this.graphics&&v(this.graphicsView)?pP(r,this.graphicsView.processor.layer.id):i===this.map.ground?pP(r,Y1):this._externalToInternalRenderItems(i,e,r);else"uid"in t&&pP(r,t.uid);return r}_initBasemapTerrain(){this._set("basemapTerrain",new ZNt({view:this})),this._set("elevationProvider",new GI({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new Ac({view:this})),this._set("featureTiles",new na({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const t=()=>{var r;const e=(r=this.basemapTerrain)==null?void 0:r.extent;if(this.clippingArea||e)if(e&&this.basemapTerrain.spatialReference){const i=v(this.basemapTerrain.extent)&&v(this.basemapTerrain.spatialReference)?ym(U9(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;v(this.clippingArea)?this.featureTiles.filterExtent=this.clippingArea.intersection(i):this.featureTiles.filterExtent=i}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add(()=>Qr.FEATURE_TILE_TREE_SHOW_TILES,e=>{e&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(Q(()=>import("./FeatureTileTree3DDebugger-957411e8.js"),["assets/FeatureTileTree3DDebugger-957411e8.js","assets/TileTreeDebugger-197583c7.js"])).then(({FeatureTileTree3DDebugger:r})=>{!this._featureTreeDebugger&&Qr.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new r({view:this}))}):e||!this._featureTreeDebugger||Qr.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},Wi),this.updatingHandles.add(()=>this.clippingArea,t,Wi),this.updatingHandles.add(()=>this.basemapTerrain.extent,t,Wi)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.exit(),this.handles.remove("render-coords-helper"),this.handles.remove("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const t=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(t)||this._set("mapCoordsHelper",new m$t(this.map,t));const e=this.state.isGlobal,r=XLe(e,t);r!==this.renderSpatialReference&&(this._set("renderCoordsHelper",v$t.create(this.state.viewingMode,r)),e||this.handles.add(ne(()=>{var i;return(i=this.basemapTerrain)==null?void 0:i.extent},i=>{const n=this.renderCoordsHelper.spatialReference;v(i)&&(i[0]!==0||i[1]!==0||i[2]!==0||i[3]!==0)&&rB(i,this.basemapTerrain.spatialReference,Dwe,n)&&(this.renderCoordsHelper.extent=Dwe)},Zr),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(qO/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.handles.remove("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(t=null){v(t)&&t.type===xi.MOVE||(this.handles.remove("updatingMonitors"),this.allLayerViews.forEach(e=>{e.destroyed||(this.handles.add(ne(()=>[e.updating,e.updatingProgress],()=>this._updatingChanged(),Zr),"updatingMonitors"),e.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(t,e){if(!this.overlay||!this.overlay.hasVisibleItems)return e;const r=t.getContext("2d");return r.putImageData(e,0,0),this.overlay.renderCanvas(t),r.getImageData(0,0,e.width,e.height)}_initStage(){const t={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(n,s)=>this._renderScreenshotOverlay(n,s)}},e=new t$t(this.state.viewingMode,n=>this._stage.layers.forAll(n),this);this._set("sceneIntersectionHelper",e);const r=nB(this.surface);this._stage=new _u({view:this,options:t,container:r}),this._stage.renderer.setParameters({slicePlane:this.slicePlane}),this._lostWebGLContextHandle=cN(this._stage.renderView.canvas,"webglcontextlost",()=>this.fatalError=new H("webgl-context-lost")),this.handles.add([this.updatingHandles.add(()=>this.qualitySettings.antialiasingEnabled,()=>this._stage.renderer.setParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled}),Vt),this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,n=>this._stage.renderer.setParameters({highQualityTransparency:n}),Vt),ne(()=>this.magnifier,n=>this._stage.renderView.magnifier=n,Wi),this.on("pointer-move",()=>{var n;return(n=this._stage)==null?void 0:n.renderer.resetAnimation()})],"stage");const i=()=>{this._stage.renderer.setParameters({defaultHighlightOptions:Vte.toEngineOptions(this.highlightOptions)})};this.handles.add(this.updatingHandles.add(()=>[this.highlightOptions.color,this.highlightOptions.haloColor,this.highlightOptions.haloOpacity,this.highlightOptions.fillOpacity,this.highlightOptions.shadowOpacity,this.highlightOptions.shadowColor,this.highlightOptions.shadowDifference],i),"stage"),i(),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(qO/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage=ze(this._stage),this._lostWebGLContextHandle=$i(this._lostWebGLContextHandle),this.handles.remove("stage"),this._set("canvas",null)}_initSurface(t){this._exitSurface(),this.state.init(t,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new lLt({view:this,viewingMode:t,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.handles.remove("graphics-view"),this._createGraphicsViewController=new AbortController;const t=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(t,t),this._updatingChanged()}async _createGraphicsViewAsync(t){const e=(await Q(()=>import("./GraphicsView3D-4c2d46e6.js"),["assets/GraphicsView3D-4c2d46e6.js","assets/GraphicsProcessor-47f520cd.js","assets/Graphics3DObjectStates-b839ed8f.js","assets/optimizedFeatureQueryEngineAdapter-4dc0036f.js","assets/centroid-f5daa837.js","assets/GraphicsView-f9d61ea4.js"])).default;lr(t),await tw(()=>{var r;return(r=this.basemapTerrain)==null?void 0:r.ready},t),this._set("graphicsView",new e({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.handles.remove("graphics-view"),v(this.graphicsView)&&(this.handles.remove(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const t=tge(this.viewingMode);if(t===qe.Global&&(this._clippingArea=null),this._initSurface(t),this._set("ready",!0),this.handles.add(Yn(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded(),!this._externallySet.environment){const r=this.get("map.initialViewProperties.environment");r&&(this.environment=r)}this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect();const e=this._resolveWhenReady;this._resolveWhenReady=[],e.forEach(r=>r(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.handles.remove("graphics-view"),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(Y1);for(const t of this.map.allLayers.items)t.type==="integrated-mesh"&&this._defaultToMapOptions.include.add(t.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(Y1);for(const t of this.map.allLayers.items)t.type==="integrated-mesh"&&t.opacity<1&&this._defaultHitTestOptions.exclude.add(t.uid)}}addVoxelLayerViewToWasm(t){return R(this.voxelWasm)?(R(this.voxelWasmPromise)&&(this.voxelWasmPromise=Q(()=>import("./VoxelWasmPerSceneView-33f5e46a.js"),[]).then(e=>(this.voxelWasm=new e.default(this),this.voxelWasm))),this.voxelWasmPromise.then(e=>e.addVoxelLayer(t))):this.voxelWasm.addVoxelLayer(t)}removeVoxelLayerViewFromWasm(t){v(this.voxelWasm)&&this.voxelWasm.removeVoxelLayer(t)<1&&(this.voxelWasm=null,this.voxelWasmPromise=null)}};function pP(t,e){t.layerUids||(t.layerUids=new Set),t.layerUids.add(e)}function G6t(t,e){t.graphicUids||(t.graphicUids=new Set),t.graphicUids.add(e)}function Ik(t,e){return v(t)&&cy(t.spatialReference,e)?ym(t,e):null}var cL;ht.type="3d",u([d()],ht.prototype,"_userClippingArea",void 0),u([d()],ht.prototype,"_resourceController",void 0),u([d()],ht.prototype,"_stage",void 0),u([d({readOnly:!0})],ht.prototype,"deconflictor",void 0),u([d({readOnly:!0})],ht.prototype,"labeler",void 0),u([d(uQ(DO,"analyses"))],ht.prototype,"analyses",void 0),u([d({type:E_,readOnly:!0})],ht.prototype,"animation",null),u([d({readOnly:!0})],ht.prototype,"basemapTerrain",void 0),u([d({readOnly:!0})],ht.prototype,"elevationProvider",void 0),u([d()],ht.prototype,"camera",null),u([d({type:Ap})],ht.prototype,"contentCamera",null),u([d({readOnly:!0})],ht.prototype,"canvas",void 0),u([d({type:Ue})],ht.prototype,"center",null),u([d({type:ur})],ht.prototype,"clippingArea",null),u([d({type:QT})],ht.prototype,"constraints",void 0),u([d({type:ur,readOnly:!0})],ht.prototype,"renderDataExtent",null),u([d({type:ur,readOnly:!0})],ht.prototype,"dataExtent",null),u([d({type:ur,readOnly:!0})],ht.prototype,"_groundAndLayersExtent",null),u([d({value:null,type:aA})],ht.prototype,"environment",null),u([cr("environment")],ht.prototype,"castEnvironment",null),u([d({readOnly:!0})],ht.prototype,"environmentManager",void 0),u([d({type:ur})],ht.prototype,"extent",null),u([d()],ht.prototype,"floors",void 0),u([d()],ht.prototype,"screenCenter",null),u([d()],ht.prototype,"frustum",null),u([d({type:Number,readOnly:!0})],ht.prototype,"fullOpacity",void 0),u([d({readOnly:!0})],ht.prototype,"graphicsView",void 0),u([d({readOnly:!0})],ht.prototype,"analysisViewManager",void 0),u([d()],ht.prototype,"groundView",void 0),u([d({type:Boolean})],ht.prototype,"initialExtentRequired",null),u([d()],ht.prototype,"_defaultsFromMapSettings",null),u([d()],ht.prototype,"interacting",null),u([d()],ht.prototype,"stationary",null),u([d()],ht.prototype,"navigating",null),u([d()],ht.prototype,"map",void 0),u([d({readOnly:!0})],ht.prototype,"mapCoordsHelper",void 0),u([d()],ht.prototype,"padding",null),u([d({type:Ac,readOnly:!0})],ht.prototype,"pointsOfInterest",void 0),u([d({type:na,readOnly:!0})],ht.prototype,"featureTiles",void 0),u([d()],ht.prototype,"_featureTreeDebugger",void 0),u([d({type:Boolean})],ht.prototype,"screenSizePerspectiveEnabled",void 0),u([d({constructOnly:!0})],ht.prototype,"deactivatedWebGLExtensions",void 0),u([d({constructOnly:!0})],ht.prototype,"debugWebGLExtensions",void 0),u([d({constructOnly:!0})],ht.prototype,"renderCanvas",void 0),u([d({constructOnly:!0})],ht.prototype,"state",void 0),u([d({readOnly:!0})],ht.prototype,"inputManager",void 0),u([d({readOnly:!0})],ht.prototype,"stateManager",void 0),u([d({type:["low","medium","high"]})],ht.prototype,"qualityProfile",null),u([d({type:O1e,get(){let t=this._get("qualitySettings");return t||(t=new O1e,zU.apply(this.qualityProfile,t)),t}})],ht.prototype,"qualitySettings",void 0),u([d()],ht.prototype,"slicePlane",null),u([d({readOnly:!0})],ht.prototype,"typeSpecificPreconditionsReady",null),u([d({readOnly:!0})],ht.prototype,"renderCoordsHelper",void 0),u([d({readOnly:!0})],ht.prototype,"sceneIntersectionHelper",void 0),u([d({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],ht.prototype,"resolution",null),u([d({type:Number})],ht.prototype,"scale",null),u([d()],ht.prototype,"heightModelInfo",null),u([d()],ht.prototype,"spatialReference",void 0),u([d({type:Boolean,constructOnly:!0})],ht.prototype,"alphaCompositingEnabled",void 0),u([d({constructOnly:!0})],ht.prototype,"preserveDrawingBufferEnabled",void 0),u([d({type:Boolean})],ht.prototype,"supersampleScreenshotsEnabled",void 0),u([d({readOnly:!0})],ht.prototype,"type",void 0),u([d({type:rze})],ht.prototype,"ui",void 0),u([d({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.hasPendingInputs","toolViewManager.updating","analysisViewManager.updating","state.mode"]})],ht.prototype,"updating",null),u([d({type:Number,readOnly:!0,dependsOn:["updating"]})],ht.prototype,"updatingProgress",void 0),u([d({type:["global","local"]})],ht.prototype,"viewingMode",null),u([d({type:Xn})],ht.prototype,"viewpoint",null),u([d({type:Number})],ht.prototype,"zoom",null),u([d({type:Vte})],ht.prototype,"highlightOptions",void 0),ht=u([$("esri.views.SceneView")],ht),function(t){t[t.INCLUDE=0]="INCLUDE",t[t.EXCLUDE=1]="EXCLUDE"}(cL||(cL={}));const fC=P(),XW=wn(),Dwe=Kt(),H6t=ht;function q6t(){const t=ut.useRef(null),e=ut.useRef(null),r=ut.useRef(null),[i,n]=ut.useState(null),[s,o]=ut.useState(null);ut.useEffect(()=>{a()},[]);async function a(){if(gLe.highlightAll(),!(t!=null&&t.current))return;ri.portalUrl="http://arcgis.com/";const h=new PB({basemap:{portalItem:{id:"eb303185d14e45e9be8bbbc1c0daf7ab"}}}),p=new H6t({container:t==null?void 0:t.current,map:h,center:[-65,40],constraints:{altitude:{min:2e6}}});p.ui.add([new K$e({view:p,content:e==null?void 0:e.current,expanded:!0,group:"group1",expandTooltip:"MediaLayer"})],"top-left"),n(p)}async function l(){const h=new Qoe({video:"aerosol.mp4",georeference:new Yoe({extent:new ur({xmin:-150,ymin:1,xmax:20,ymax:80,spatialReference:{wkid:4326}})})}),p=new eae({source:[h],title:"2017 Hurricanes and Aerosols Simulation",copyright:"NASA's Goddard Space Flight Center"});i.map.layers.add(p),await i.when(),await p.when(),o(p)}return JR("div",{className:"App",children:[Qi("div",{id:"view",ref:t}),JR("div",{ref:e,className:"card",children:[Qi("p",{className:"title",children:"MediaLayer"}),Qi("pre",{className:"line-numbers",children:Qi("code",{className:"language-js",children:`new MediaLayer({ 
  source: new VideoElement({
    video: "/aerosol.mp4",
    georeference: 
      new ExtentAndRotationGeoreference({
        extent: new Extent({
          xmin: -150, 
          ymin: 1, 
          xmax: 20, 
          ymax: 80,
          spatialReference: { wkid: 4326 }
        })
      })
  }) 
});`})}),Qi("div",{ref:r,className:"slider"}),Qi(mLe,{className:"btn","icon-start":"play",onClick:l})]})]})}function W6t(t){return t&&"getAtOrigin"in t&&"originOf"in t}function X6t(t){t&&t.writtenProperties&&t.writtenProperties.forEach(({target:e,propName:r,newOrigin:i})=>{W6t(e)&&i&&e.originOf(r)!==i&&e.updateOrigin(r,i)})}async function Y6t(t,e,r){e=e.clone(),t.capabilities.query.supportsMaxRecordCountFactor&&(e.maxRecordCountFactor=ize(t));const i=Z6t(t),n=t.capabilities.query.supportsPagination;e.start=0,e.num=i;let s=null;for(;;){const o=await t.source.queryFeaturesJSON(e,r);if(R(s)?s=o:s.features=s.features.concat(o.features),s.exceededTransferLimit=o.exceededTransferLimit,!n||!o.exceededTransferLimit)break;e.start+=i}return s}function Z6t(t){return ize(t)*J6t(t)}function J6t(t){return t.capabilities.query.maxRecordCount||2e3}function ize(t){return t.capabilities.query.supportsMaxRecordCountFactor?gp.MAX_MAX_RECORD_COUNT_FACTOR:1}let T0=class extends fe{constructor(e){super(e),this.moment=null,this.fullUpdate=!1,this.validateErrorsCreated=!1,this.dirtyAreaCount=null,this.exceededTransferLimit=null,this.serviceEdits=null}};u([d({type:Date,json:{type:Number,write:{writer:(t,e)=>{e.moment=t?t.getTime():null}}}})],T0.prototype,"moment",void 0),u([d({type:Boolean,json:{write:!0}})],T0.prototype,"fullUpdate",void 0),u([d({type:Boolean,json:{write:!0}})],T0.prototype,"validateErrorsCreated",void 0),u([d({type:Number,json:{write:!0}})],T0.prototype,"dirtyAreaCount",void 0),u([d({type:Boolean,json:{write:!0}})],T0.prototype,"exceededTransferLimit",void 0),u([d({type:[Object],json:{write:!0}})],T0.prototype,"serviceEdits",void 0),T0=u([$("esri.rest.networks.support.ValidateNetworkTopologyResult")],T0);const K6t=T0,Q6t=ja()({Pending:"job-waiting",InProgress:"job-executing",Completed:"job-succeeded"});let C1=class extends K6t{constructor(e){super(e),this.featureServiceUrl=null,this.statusUrl=null,this.status=null,this.submissionTime=null,this.lastUpdatedTime=null,this._timer=void 0}destroy(){clearInterval(this._timer)}async checkJobStatus(e){const r={...e,query:{f:"json"}},{data:i}=await ei(this.statusUrl,r);if(this.read(i),(this.serviceEdits||this.exceededTransferLimit)&&this.featureServiceUrl){const n={edits:null,addedFeatures:[],updatedFeatures:[],deletedFeatures:[],addedAttachments:[],updatedAttachments:[],deletedAttachments:[],exceededTransferLimit:!0};noe.emit("edits",{serviceUrl:this.featureServiceUrl??"",layerId:null,event:n})}return this}async waitForJobCompletion(e={}){const{interval:r=1e3,statusCallback:i}=e;return new Promise((n,s)=>{this._clearTimer();const o=setInterval(()=>{this._timer||s(Vr()),this.checkJobStatus().then(a=>{const{status:l}=a;switch(this.status=l,l){case"job-succeeded":this._clearTimer(),n(this);break;case"job-waiting":case"job-executing":i&&i(this)}},a=>{this._clearTimer(),s(a)})},r);this._timer=o})}_clearTimer(){clearInterval(this._timer),this._timer=void 0}};u([d()],C1.prototype,"featureServiceUrl",void 0),u([d({type:String,json:{write:!0}})],C1.prototype,"statusUrl",void 0),u([st(Q6t)],C1.prototype,"status",void 0),u([d({type:Date,json:{type:Number,write:{writer:(t,e)=>{e.submissionTime=t?t.getTime():null}}}})],C1.prototype,"submissionTime",void 0),u([d({type:Date,json:{type:Number,write:{writer:(t,e)=>{e.lastUpdatedTime=t?t.getTime():null}}}})],C1.prototype,"lastUpdatedTime",void 0),C1=u([$("esri.networks.support.TopologyValidationJobInfo")],C1);const eUt=C1;async function Nwe(t,e){if(t==="Utility Network Layer"){const{default:r}=await Q(()=>Promise.resolve().then(()=>uUt),void 0);return new r({layerUrl:e})}return null}async function tUt(t){let e="portalItem"in t?t:{portalItem:t};!e.portalItem||e.portalItem instanceof r_||(e={...e,portalItem:new r_(e.portalItem)});const r=e.portalItem;if(await r.load(),r.type!=="Feature Service")throw new H("portal:unknown-item-type","Unknown item type '${type}'",{type:r.type});const i=r.url,n=await ei(i,{responseType:"json",query:{f:"json"}}),s="Network Layer";if(n.data.type&&n.data.type.includes(s))return Nwe(n.data.type,i);if(n.data.layers){const o=n.data.layers.find(a=>a.type.includes(s));if(o){const a=`${i}/${o.id}`;return Nwe(o.type,a)}}return null}let NT=class extends fe{constructor(e){super(e),this.globalIds=[],this.creators=[],this.tags=[],this.names=[]}};u([d({type:[String],json:{write:!0}})],NT.prototype,"globalIds",void 0),u([d({type:[String],json:{write:!0}})],NT.prototype,"creators",void 0),u([d({type:[String],json:{write:!0}})],NT.prototype,"tags",void 0),u([d({type:[String],json:{write:!0}})],NT.prototype,"names",void 0),NT=u([$("esri.rest.networks.support.QueryNamedTraceConfigurationsParameters")],NT);const rUt=NT;let ra=class extends IN(qu){static fromPortalItem(t){return tUt(t)}constructor(t){super(t),this.id=null,this.title=null,this.layerUrl=null,this.dataElement=null,this.fullExtent=null,this.spatialReference=null,this.type=null,this.sourceJSON=null}initialize(){this.when().catch(t=>{ps(t)||re.getLogger(this.declaredClass).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:t})})}get datasetName(){var t;return((t=this.dataElement)==null?void 0:t.name)??null}get owner(){var t;return((t=this.dataElement)==null?void 0:t.userIdentity)??null}get schemaGeneration(){var t;return((t=this.dataElement)==null?void 0:t.schemaGeneration)??null}get parsedUrl(){return Uo(this.layerUrl)}get featureServiceUrl(){const t=this.parsedUrl&&aw(this.parsedUrl.path);return v(t)?t.url.path:null}get networkServiceUrl(){return this.featureServiceUrl?this.featureServiceUrl.replace(/\/FeatureServer/i,"/UtilityNetworkServer"):null}get layerId(){const t=this.parsedUrl&&aw(this.parsedUrl.path);return v(t)?t.sublayer:null}get networkSystemLayers(){return null}async load(t){return this.addResolvingPromise(this._fetchDataElement(this.featureServiceUrl,this.layerId.toString(),t)),this.addResolvingPromise(this._fetchLayerMetaData(this.layerUrl,t)),this}getLayerIdBySourceId(t){if(this.dataElement){const e=this.dataElement.domainNetworks;for(const r of e){for(const i of r.edgeSources?r.edgeSources:[])if(i.sourceId===t)return i.layerId;for(const i of r.junctionSources?r.junctionSources:[])if(i.sourceId===t)return i.layerId}return null}return null}async queryNamedTraceConfigurations(t,e){var s;const{queryNamedTraceConfigurations:r}=await Q(()=>import("./queryNamedTraceConfigurations-efafed9b.js"),[]),i=this.networkServiceUrl,n=new rUt({...t});return((s=await r(i,n,{...e}))==null?void 0:s.namedTraceConfigurations)??null}async validateTopology(t,e){if(!t.validateArea)throw new H("network:undefined-validateArea","the network must have validateArea defined in the validate network topology parameters.");const{validateNetworkTopology:r}=await Q(()=>import("./validateNetworkTopology-8d1f6bc1.js"),[]),i=this.networkServiceUrl,n=await r(i,t,{...e});if(n!=null&&n.serviceEdits){const s={edits:null,addedFeatures:[],updatedFeatures:[],deletedFeatures:[],addedAttachments:[],updatedAttachments:[],deletedAttachments:[],editedFeatures:n.serviceEdits,exceededTransferLimit:!1};noe.emit("edits",{serviceUrl:this.featureServiceUrl??"",layerId:null,event:s})}return n}async submitTopologyValidationJob(t,e){if(!t.validateArea)throw new H("network:undefined-validateArea","the network must have validateArea defined in the validate network topology parameters.");if(!t.gdbVersion)throw new H("network:undefined-gdb-version","version must be defined");const{submitValidateNetworkTopologyJob:r}=await Q(()=>import("./validateNetworkTopology-8d1f6bc1.js"),[]),i=this.networkServiceUrl,n=await r(i,t,{...e});return new eUt({statusUrl:n,featureServiceUrl:this.featureServiceUrl})}async _fetchLayerMetaData(t,e){const r=await ei(t,{responseType:"json",query:{f:"json"},...e});this.sourceJSON=r.data,this.read(r.data,{origin:"service"})}async _fetchDataElement(t,e,r){if(this.dataElement)return;const i=await ei(`${t}/queryDataElements`,{responseType:"json",query:{layers:JSON.stringify([e]),f:"json"},...r}).then(n=>{var s;return(s=n.data.layerDataElements)==null?void 0:s[0]});i&&this.read(i,{origin:"service"})}};u([d({type:String,nonNullable:!0,json:{origins:{"web-map":{read:!0,write:{isRequired:!0}},service:{read:!0}},read:!1}})],ra.prototype,"id",void 0),u([d({type:String,nonNullable:!0,json:{origins:{"web-map":{read:!0,write:{isRequired:!0}},service:{read:{source:"name"}}},read:!1}})],ra.prototype,"title",void 0),u([d({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"url"},write:{target:"url",isRequired:!0}}},read:!1}})],ra.prototype,"layerUrl",void 0),u([d({type:Object,json:{origins:{service:{read:!0}},read:!1}})],ra.prototype,"dataElement",void 0),u([d({type:ur,json:{origins:{service:{read:{source:"extent"}}},read:!1}})],ra.prototype,"fullExtent",void 0),u([d({type:Je,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:!1}})],ra.prototype,"spatialReference",void 0),u([d({type:["utility","trace"],readOnly:!0,json:{read:!1,write:!1}})],ra.prototype,"type",void 0),u([d({readOnly:!0})],ra.prototype,"datasetName",null),u([d({readOnly:!0})],ra.prototype,"owner",null),u([d({readOnly:!0})],ra.prototype,"schemaGeneration",null),u([d({readOnly:!0})],ra.prototype,"parsedUrl",null),u([d({readOnly:!0})],ra.prototype,"featureServiceUrl",null),u([d({readOnly:!0})],ra.prototype,"networkServiceUrl",null),u([d({readOnly:!0})],ra.prototype,"layerId",null),u([d()],ra.prototype,"sourceJSON",void 0),u([d({readOnly:!0})],ra.prototype,"networkSystemLayers",null),ra=u([$("esri.networks.Network")],ra);const iUt=ra;var Vh;(function(t){t[t.RTJunctionJunctionConnectivity=1]="RTJunctionJunctionConnectivity",t[t.RTContainment=2]="RTContainment",t[t.RTAttachment=3]="RTAttachment",t[t.RTJunctionEdgeConnectivity=4]="RTJunctionEdgeConnectivity",t[t.RTEdgeJunctionEdgeConnectivity=5]="RTEdgeJunctionEdgeConnectivity"})(Vh||(Vh={}));const $k=new mr({connected:"connected",upstream:"upstream",downstream:"downstream",shortestPath:"shortest-path",subnetwork:"subnetwork",subnetworkController:"subnetwork-controller",loops:"loops",isolation:"isolation"});new mr({connectivity:"connectivity",attachment:"attachment",containment:"containment",junctionEdgeFromConnectivity:"junction-edge-from-connectivity",junctionMidspanConnectivity:"junction-midspan-connectivity",junctionEdgeToConnectivity:"junction-edge-to-connectivity"});new mr({normal:"normal",rebuild:"rebuild",forceRebuild:"force-rebuild"});let FT=class extends Cw(qu){constructor(e){super(e),this.request=ei}initialize(){}async load(e){const r=this.layer.load(e).then(()=>this._initializeRulesTable());return this.addResolvingPromise(r),this}getFeatureSQL(e,r){var c,h;const i=e.layerId.toString(),n=(c=e.fieldsIndex)==null?void 0:c.normalizeFieldName("assetGroup"),s=(h=e.fieldsIndex)==null?void 0:h.normalizeFieldName("assetType"),o=n?r.attributes[n]:null,a=s?r.attributes[s]:null,l=this.rulesHash[i];if(l){const p=l.assetGroupHash[o];if(p)return p.assetTypeHash[a]||null}return null}async _initializeRulesTable(){var n,s,o,a,l,c,h,p,f,m;const e={};let r;(function(g){g[g.from=0]="from",g[g.to=1]="to",g[g.via=2]="via"})(r||(r={}));const i=[{networkSourceId:"fromNetworkSource",assetGroupId:"fromAssetGroup",assetTypeId:"fromAssetType"},{networkSourceId:"toNetworkSource",assetGroupId:"toAssetGroup",assetTypeId:"toAssetType"},{networkSourceId:"viaNetworkSource",assetGroupId:"viaAssetGroup",assetTypeId:"viaAssetType"}];for(const g of this.rules){if(g.ruleType!==Vh.RTJunctionJunctionConnectivity&&g.ruleType!==Vh.RTJunctionEdgeConnectivity&&g.ruleType!==Vh.RTEdgeJunctionEdgeConnectivity)continue;let _=[[r.from,r.to],[r.to,r.from]];g.ruleType===Vh.RTEdgeJunctionEdgeConnectivity&&(_=[[r.from,r.via],[r.via,r.from],[r.to,r.via],[r.via,r.to]]);for(const b of _){const w=b.shift(),x=b.shift();let T=!1;switch(g.ruleType){case Vh.RTEdgeJunctionEdgeConnectivity:T=w===r.from||w===r.to;break;case Vh.RTJunctionEdgeConnectivity:T=w===r.to}const E=i[w],C=g[E.networkSourceId].layerId.toString(),A=(s=(n=g[E.assetGroupId])==null?void 0:n.assetGroupCode)==null?void 0:s.toString(),I=(a=(o=g[E.assetTypeId])==null?void 0:o.assetTypeCode)==null?void 0:a.toString(),M=i[x],D=g[M.networkSourceId].layerId.toString(),U=(c=(l=g[M.assetGroupId])==null?void 0:l.assetGroupCode)==null?void 0:c.toString(),z=g[M.assetTypeId],B=(h=z==null?void 0:z.assetTypeCode)==null?void 0:h.toString(),ee=e[C]?e[C]:{assetGroupHash:{}};if(!(A&&I&&U&&B))continue;const te=ee.assetGroupHash[A]?ee.assetGroupHash[A]:{assetTypeHash:{}},K=te.assetTypeHash[I]?te.assetTypeHash[I]:{};if(K[D]=K[D]?K[D]:{},T){K[C]=K[C]?K[C]:{};const N=`(assetgroup = ${A} AND assettype = ${I})`;K[C].anyVertex=K[C].anyVertex?`${K[C].anyVertex}`:`${N}`,z.connectivityPolicy==="esriNECPEndVertex"&&(K[C].endVertex=(p=K[C])!=null&&p.endVertex?`${K[C].endVertex}`:`${N}`)}const W=`(assetgroup = ${U} AND assettype = ${B})`;K[D].anyVertex=(f=K[D])!=null&&f.anyVertex?`${K[D].anyVertex} OR ${W}`:`${W}`,z.connectivityPolicy==="esriNECPEndVertex"&&(K[D].endVertex=(m=K[D])!=null&&m.endVertex?`${K[D].endVertex} OR ${W}`:`${W}`),te.assetTypeHash[I]=K,ee.assetGroupHash[A]=te,e[C]=ee}}this.rulesHash=e}};u([d({constructOnly:!0})],FT.prototype,"layer",void 0),u([d({constructOnly:!0})],FT.prototype,"rules",void 0),u([d()],FT.prototype,"rulesHash",void 0),u([d({constructOnly:!0})],FT.prototype,"request",void 0),FT=u([$("esri.networks.RulesTable")],FT);const nUt=FT;let kd=class extends fe{constructor(e){super(e),this.conditionBarriers=[],this.outputConditions=[],this.functions=[],this.functionBarriers=[],this.traversabilityScope=null,this.shortestPathNetworkAttributeName=null,this.includeBarriers=null,this.validateConsistency=null,this.ignoreBarriersAtStartingPoints=null}};u([d({type:[Object],json:{write:!0}})],kd.prototype,"conditionBarriers",void 0),u([d({type:[Object],json:{write:!0}})],kd.prototype,"outputConditions",void 0),u([d({type:[Object],json:{write:!0}})],kd.prototype,"functions",void 0),u([d({type:[Object],json:{write:!0}})],kd.prototype,"functionBarriers",void 0),u([d({type:["junctions","edges","junctionsAndEdges"],json:{write:!0}})],kd.prototype,"traversabilityScope",void 0),u([d({type:String,json:{write:!0}})],kd.prototype,"shortestPathNetworkAttributeName",void 0),u([d({type:Boolean,json:{write:!0}})],kd.prototype,"includeBarriers",void 0),u([d({type:Boolean,json:{write:!0}})],kd.prototype,"validateConsistency",void 0),u([d({type:Boolean,json:{write:!0}})],kd.prototype,"ignoreBarriersAtStartingPoints",void 0),kd=u([$("esri.networks.support.TraceConfiguration")],kd);const Fce=kd;let to=class extends Fce{constructor(e){super(e),this.filterBarriers=[],this.domainNetworkName=null,this.filterBitsetNetworkAttributeName=null,this.filterFunctionBarriers=[],this.filterScope=null,this.includeContainers=null,this.includeContent=null,this.includeIsolated=null,this.includeStructures=null,this.includeUpToFirstSpatialContainer=null,this.nearestNeighbor=null,this.outputFilterCategories=[],this.outputFilters=[],this.propagators=[],this.subnetworkName=null,this.targetTierName=null,this.tierName=null,this.validateLocatability=null}};u([d({type:[Object],json:{write:!0}})],to.prototype,"filterBarriers",void 0),u([d({type:String,json:{write:!0}})],to.prototype,"domainNetworkName",void 0),u([d({type:String,json:{write:!0}})],to.prototype,"filterBitsetNetworkAttributeName",void 0),u([d({type:[Object],json:{write:!0}})],to.prototype,"filterFunctionBarriers",void 0),u([d({type:["junctions","edges","junctionsAndEdges"],json:{write:!0}})],to.prototype,"filterScope",void 0),u([d({type:Boolean,json:{write:!0}})],to.prototype,"includeContainers",void 0),u([d({type:Boolean,json:{write:!0}})],to.prototype,"includeContent",void 0),u([d({type:Boolean,json:{write:!0}})],to.prototype,"includeIsolated",void 0),u([d({type:Boolean,json:{write:!0}})],to.prototype,"includeStructures",void 0),u([d({type:Boolean,json:{write:!0}})],to.prototype,"includeUpToFirstSpatialContainer",void 0),u([d({type:Object,json:{write:!0}})],to.prototype,"nearestNeighbor",void 0),u([d({type:[Object],json:{write:!0}})],to.prototype,"outputFilterCategories",void 0),u([d({type:[Object],json:{write:!0}})],to.prototype,"outputFilters",void 0),u([d({type:[Object],json:{write:!0}})],to.prototype,"propagators",void 0),u([d({type:String,json:{write:!0}})],to.prototype,"subnetworkName",void 0),u([d({type:String,json:{write:!0}})],to.prototype,"targetTierName",void 0),u([d({type:String,json:{write:!0}})],to.prototype,"tierName",void 0),u([d({type:Boolean,json:{write:!0}})],to.prototype,"validateLocatability",void 0),to=u([$("esri.networks.support.UNTraceConfiguration")],to);const sUt=to;let vu=class extends Mz{constructor(e){super(e),this.globalId=null,this.title=null,this.traceConfiguration=null,this.creationDate=null,this.creator=null,this.description=null,this.minStartingPoints=null,this.resultTypes=[],this.tags=[],this.traceType=null}readTraceConfiguration(e,r){return e.tierName!==void 0?sUt.fromJSON(e):Fce.fromJSON(e)}};u([d({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"id"},write:{target:"id",isRequired:!0}},service:{read:{source:"globalId"},write:{target:"globalId",isRequired:!0}}},read:!1}})],vu.prototype,"globalId",void 0),u([d({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"title"},write:{target:"title",isRequired:!0}},service:{read:{source:"name"},write:{target:"name",isRequired:!0}}},read:!1}})],vu.prototype,"title",void 0),u([d({type:Fce,json:{origins:{service:{read:!0,write:!0}},read:!1}})],vu.prototype,"traceConfiguration",void 0),u([Me("service","traceConfiguration")],vu.prototype,"readTraceConfiguration",null),u([d({type:Date,json:{origins:{service:{read:!0,write:!0}},read:!1}})],vu.prototype,"creationDate",void 0),u([d({type:String,json:{origins:{service:{read:!0,write:!0}},read:!1}})],vu.prototype,"creator",void 0),u([d({type:String,json:{origins:{service:{read:!0,write:!0}},read:!1}})],vu.prototype,"description",void 0),u([d({type:["none","one","many"],json:{origins:{service:{read:{source:"minNumStartingPoints"},write:{target:"minNumStartingPoints"}}},read:!1}})],vu.prototype,"minStartingPoints",void 0),u([d({type:[Object],json:{origins:{service:{read:!0,write:!0}},read:!1}})],vu.prototype,"resultTypes",void 0),u([d({type:[String],json:{origins:{service:{read:!0,write:!0}},read:!1}})],vu.prototype,"tags",void 0),u([d({type:$k.apiValues,json:{type:$k.jsonValues,origins:{service:{read:$k.read,write:$k.write}},read:!1}})],vu.prototype,"traceType",void 0),vu=u([$("esri.networks.support.NamedTraceConfiguration")],vu);const oUt=vu;let S0=class extends be{constructor(e){super(e),this.rulesTableId=null,this.rulesTableUrl=null,this.subnetworksTableId=null,this.subnetworksTableUrl=null,this.dirtyAreasLayerId=null,this.dirtyAreasLayerUrl=null}};u([d({constructOnly:!0})],S0.prototype,"rulesTableId",void 0),u([d({constructOnly:!0})],S0.prototype,"rulesTableUrl",void 0),u([d({constructOnly:!0})],S0.prototype,"subnetworksTableId",void 0),u([d({constructOnly:!0})],S0.prototype,"subnetworksTableUrl",void 0),u([d({constructOnly:!0})],S0.prototype,"dirtyAreasLayerId",void 0),u([d({constructOnly:!0})],S0.prototype,"dirtyAreasLayerUrl",void 0),S0=u([$("esri.networks.support.NetworkSystemLayers")],S0);const aUt=S0;let wA=class extends fe{constructor(e){super(e),this.id=null,this.name=null}};u([d({type:Number,json:{read:{source:"terminalId"},write:{target:"terminalId"}}})],wA.prototype,"id",void 0),u([d({type:String,json:{read:{source:"terminalName"},write:{target:"terminalName"}}})],wA.prototype,"name",void 0),u([d({type:Boolean,json:{write:!0}})],wA.prototype,"isUpstreamTerminal",void 0),wA=u([$("esri.networks.support.Terminal")],wA);const lUt=wA,Lk=new mr({esriUNTMBidirectional:"bidirectional",esriUNTMDirectional:"directional"});let A1=class extends fe{constructor(e){super(e),this.defaultConfiguration=null,this.id=null,this.name=null,this.terminals=[],this.traversabilityModel=null}};u([d({type:String,json:{write:!0}})],A1.prototype,"defaultConfiguration",void 0),u([d({type:Number,json:{read:{source:"terminalConfigurationId"},write:{target:"terminalConfigurationId"}}})],A1.prototype,"id",void 0),u([d({type:String,json:{read:{source:"terminalConfigurationName"},write:{target:"terminalConfigurationName"}}})],A1.prototype,"name",void 0),u([d({type:[lUt],json:{write:!0}})],A1.prototype,"terminals",void 0),u([d({type:Lk.apiValues,json:{type:Lk.jsonValues,read:Lk.read,write:Lk.write}})],A1.prototype,"traversabilityModel",void 0),A1=u([$("esri.networks.support.TerminalConfiguration")],A1);const Fwe=A1,cUt="esri.networks.UtilityNetwork",Dk=re.getLogger(cUt);let xh=class extends iUt{constructor(e){super(e),this.sharedNamedTraceConfigurations=[],this.type="utility"}get serviceTerritoryFeatureLayerId(){var e;return((e=this.dataElement)==null?void 0:e.serviceTerritoryFeatureLayerId)??null}get networkSystemLayers(){var e,r,i,n,s,o;return new aUt({rulesTableId:(e=this.sourceJSON)==null?void 0:e.systemLayers.rulesTableId,rulesTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${(r=this.sourceJSON)==null?void 0:r.systemLayers.rulesTableId}`:null,subnetworksTableId:(i=this.sourceJSON)==null?void 0:i.systemLayers.subnetworksTableId,subnetworksTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${(n=this.sourceJSON)==null?void 0:n.systemLayers.subnetworksTableId}`:null,dirtyAreasLayerId:(s=this.sourceJSON)==null?void 0:s.systemLayers.dirtyAreasLayerId,dirtyAreasLayerUrl:this.sourceJSON?`${this.featureServiceUrl}/${(o=this.sourceJSON)==null?void 0:o.systemLayers.dirtyAreasLayerId}`:null})}get rulesTableId(){var e;return cS(Dk,"rulesTableId",{replacement:"networkSystemLayers.rulesTableId",version:"4.25"}),(e=this.sourceJSON)==null?void 0:e.systemLayers.rulesTableId}get rulesTableUrl(){return cS(Dk,"rulesTableUrl",{replacement:"networkSystemLayers.rulesTableUrl",version:"4.25"}),this.sourceJSON?`${this.featureServiceUrl}/${this.networkSystemLayers.rulesTableId}`:null}get subnetworksTableId(){var e;return cS(Dk,"subnetworksTableId",{replacement:"networkSystemLayers.subnetworksTableId",version:"4.25"}),(e=this.sourceJSON)==null?void 0:e.systemLayers.subnetworksTableId}get subnetworksTableUrl(){return cS(Dk,"subnetworksTableUrl",{replacement:"networkSystemLayers.subnetworksTableUrl",version:"4.25"}),this.sourceJSON?`${this.featureServiceUrl}/${this.networkSystemLayers.subnetworksTableId}`:null}get terminalConfigurations(){var e;return((e=this.dataElement)==null?void 0:e.terminalConfigurations.map(r=>Fwe.fromJSON(r)))||[]}get domainNetworkNames(){var e;return((e=this.dataElement)==null?void 0:e.domainNetworks.map(r=>r.domainNetworkName))||[]}get _utilityLayerList(){var r,i;const e=new Set;return(i=(r=this.dataElement)==null?void 0:r.domainNetworks)==null||i.map(n=>{n.edgeSources.map(s=>{e.add(s.layerId)}),n.junctionSources.map(s=>{e.add(s.layerId)})}),e}async load(e){return this.addResolvingPromise(super.load(e)),this.addResolvingPromise(this._loadNamedTraceConfigurationsFromNetwork(e)),this}getTerminalConfiguration(e){var c,h,p,f;let r=null,i=null;const n=e.layer;let s=null;if((n==null?void 0:n.type)!=="feature"||(s=n.layerId,s===null))return null;const o=e.attributes;if(o==null)return null;for(const m of Object.keys(o))m.toUpperCase()==="ASSETGROUP"&&(r=e.getAttribute(m)),m.toUpperCase()==="ASSETTYPE"&&(i=e.getAttribute(m));if(!this.dataElement)return null;let a=null;const l=this.dataElement.domainNetworks;for(const m of l){const g=(c=m.junctionSources)==null?void 0:c.find(_=>_.layerId===s);if(g){const _=(h=g.assetGroups)==null?void 0:h.find(b=>b.assetGroupCode===r);if(_){const b=(p=_.assetTypes)==null?void 0:p.find(w=>w.assetTypeCode===i);if(b){a=b.terminalConfigurationId;break}}}}if(a!=null){const m=(f=this.dataElement.terminalConfigurations)==null?void 0:f.find(g=>g.terminalConfigurationId===a);return m?Fwe.fromJSON(m):null}return null}getTierNames(e){var i;const r=(i=this.dataElement)==null?void 0:i.domainNetworks.find(n=>n.domainNetworkName===e);return(r==null?void 0:r.tiers.map(n=>n.name))||[]}async getRulesTable(){return this._createRulesTable()}isUtilityLayer(e){return this._utilityLayerList.has(e.layerId)}async _loadNamedTraceConfigurationsFromNetwork(e){var n;if(((n=this.sharedNamedTraceConfigurations)==null?void 0:n.length)===0)return;const r=this.sharedNamedTraceConfigurations.map(s=>s.globalId),i=await this.queryNamedTraceConfigurations({globalIds:r},e);for(const s of this.sharedNamedTraceConfigurations){const o=i==null?void 0:i.find(a=>a.globalId===s.globalId);if(o){const a=o.write({},{origin:"service"});s.read(a,{origin:"service"})}}}async _createRulesTable(){var s;const e=new woe({url:this.rulesTableUrl});await e.load();const r=(s=this.dataElement)==null?void 0:s.domainNetworks;if(!r)return null;const i=r.flatMap(o=>[...o.edgeSources,...o.junctionSources]),n=(await this._queryRulesTable(e)).map(o=>this._hydrateRuleInfo(e,i,o));return new nUt({layer:e,rules:n})}async _queryRulesTable(e){const r=new gp({where:"1=1",outFields:["*"]});return(await Y6t(e,r)).features}_hydrateRuleInfo(e,r,i){const n=e.fieldsIndex,s=n.get("RULETYPE"),o=n.get("CREATIONDATE"),a=n.get("FROMNETWORKSOURCEID"),l=n.get("FROMASSETGROUP"),c=n.get("FROMASSETTYPE"),h=n.get("FROMTERMINALID"),p=n.get("TONETWORKSOURCEID"),f=n.get("TOASSETGROUP"),m=n.get("TOASSETTYPE"),g=n.get("TOTERMINALID"),_=n.get("VIANETWORKSOURCEID"),b=n.get("VIAASSETGROUP"),w=n.get("VIAASSETTYPE"),x=n.get("VIATERMINALID"),T=i.attributes[s.name],E=new Date(i.attributes[o.name]),C=[{networkSourceId:i.attributes[a.name],assetGroupId:i.attributes[l.name],assetTypeId:i.attributes[c.name],terminalId:i.attributes[h.name]},{networkSourceId:i.attributes[p.name],assetGroupId:i.attributes[f.name],assetTypeId:i.attributes[m.name],terminalId:i.attributes[g.name]},{networkSourceId:i.attributes[_.name],assetGroupId:i.attributes[b.name],assetTypeId:i.attributes[w.name],terminalId:i.attributes[x.name]}];let A;(function(M){M[M.from=0]="from",M[M.to=1]="to",M[M.via=2]="via"})(A||(A={}));const I={ruleType:T,creationDate:E};for(const M of[A.from,A.to,A.via]){if(T!==Vh.RTEdgeJunctionEdgeConnectivity&&M===A.via)continue;const D=C[M],U=r.find(K=>K.sourceId===D.networkSourceId),z=U==null?void 0:U.assetGroups.find(K=>K.assetGroupCode===D.assetGroupId),B=z==null?void 0:z.assetTypes.find(K=>K.assetTypeCode===D.assetTypeId);let ee=this._getTerminal(T,B,D);T!==Vh.RTContainment&&T!==Vh.RTAttachment||(ee=null);let te="";switch(M){case A.from:te="from";break;case A.to:te="to";break;case A.via:te="via"}I[`${te}NetworkSource`]=U,I[`${te}AssetGroup`]=z,I[`${te}AssetType`]=B,I[`${te}Terminal`]=ee}return I}_getTerminal(e,r,i){var o,a;if(e===Vh.RTAttachment||e===Vh.RTContainment)return null;const n=r==null?void 0:r.terminalConfigurationId,s=(o=this.terminalConfigurations)==null?void 0:o.find(l=>l.id===n);return((a=s==null?void 0:s.terminals)==null?void 0:a.find(l=>l.id===i.terminalId))??null}};u([d({type:[oUt],json:{origins:{"web-map":{read:{source:"traceConfigurations"},write:{target:"traceConfigurations"}},service:{read:{source:"traceConfigurations"}}},read:!1}})],xh.prototype,"sharedNamedTraceConfigurations",void 0),u([d({type:["utility"],readOnly:!0,json:{read:!1,write:!1}})],xh.prototype,"type",void 0),u([d({readOnly:!0})],xh.prototype,"serviceTerritoryFeatureLayerId",null),u([d({readOnly:!0})],xh.prototype,"networkSystemLayers",null),u([d({readOnly:!0})],xh.prototype,"rulesTableId",null),u([d({readOnly:!0})],xh.prototype,"rulesTableUrl",null),u([d({readOnly:!0})],xh.prototype,"subnetworksTableId",null),u([d({readOnly:!0})],xh.prototype,"subnetworksTableUrl",null),u([d({readOnly:!0})],xh.prototype,"terminalConfigurations",null),u([d({readOnly:!0})],xh.prototype,"domainNetworkNames",null),xh=u([$("esri.networks.UtilityNetwork")],xh);const nze=xh,uUt=Object.freeze(Object.defineProperty({__proto__:null,default:nze},Symbol.toStringTag,{value:"Module"}));let R1=class extends fe{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};u([d({type:String,json:{write:!0}})],R1.prototype,"facilityIdField",void 0),u([d({type:String,json:{write:!0}})],R1.prototype,"layerId",void 0),u([d({type:String,json:{write:!0}})],R1.prototype,"nameField",void 0),u([d({type:String,json:{write:!0}})],R1.prototype,"siteIdField",void 0),u([d({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],R1.prototype,"sublayerId",void 0),R1=u([$("esri.layers.support.FacilityLayerInfo")],R1);const hUt=R1;let xf=class extends fe{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.levelIdField=null,this.levelNumberField=null,this.longNameField=null,this.shortNameField=null,this.sublayerId=null,this.verticalOrderField=null}};u([d({type:String,json:{write:!0}})],xf.prototype,"facilityIdField",void 0),u([d({type:String,json:{write:!0}})],xf.prototype,"layerId",void 0),u([d({type:String,json:{write:!0}})],xf.prototype,"levelIdField",void 0),u([d({type:String,json:{write:!0}})],xf.prototype,"levelNumberField",void 0),u([d({type:String,json:{write:!0}})],xf.prototype,"longNameField",void 0),u([d({type:String,json:{write:!0}})],xf.prototype,"shortNameField",void 0),u([d({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],xf.prototype,"sublayerId",void 0),u([d({type:String,json:{write:!0}})],xf.prototype,"verticalOrderField",void 0),xf=u([$("esri.layers.support.LevelLayerInfo")],xf);const dUt=xf;let kT=class extends fe{constructor(e){super(e),this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};u([d({type:String,json:{write:!0}})],kT.prototype,"layerId",void 0),u([d({type:String,json:{write:!0}})],kT.prototype,"nameField",void 0),u([d({type:String,json:{write:!0}})],kT.prototype,"siteIdField",void 0),u([d({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],kT.prototype,"sublayerId",void 0),kT=u([$("esri.layers.support.SiteLayerInfo")],kT);const pUt=kT;let xA=class extends fe{constructor(e){super(e),this.levelLayer=null,this.facilityLayer=null,this.siteLayer=null}};u([d({type:dUt,json:{write:!0}})],xA.prototype,"levelLayer",void 0),u([d({type:hUt,json:{write:!0}})],xA.prototype,"facilityLayer",void 0),u([d({type:pUt,json:{write:!0}})],xA.prototype,"siteLayer",void 0),xA=u([$("esri.support.MapFloorInfo")],xA);const fUt=xA;let TA=class extends bi(fe){constructor(e){super(e),this.expression=null,this.returnType="string",this.title=null}};u([d({type:String,json:{write:{isRequired:!0}}})],TA.prototype,"expression",void 0),u([d({type:["number","string"],json:{write:!0}})],TA.prototype,"returnType",void 0),u([d({type:String,json:{write:!0}})],TA.prototype,"title",void 0),TA=u([$("esri.webdoc.geotriggersInfo.ExpressionInfo")],TA);const sze=TA,Nk=new mr({deviceLocation:"device-location"});let QI=class extends bi(fe){constructor(e){super(e),this.filterExpression=null,this.type="device-location"}};u([d({type:sze,json:{write:!0}})],QI.prototype,"filterExpression",void 0),u([d({type:Nk.apiValues,readOnly:!0,json:{type:Nk.jsonValues,read:Nk.read,write:Nk.write}})],QI.prototype,"type",void 0),QI=u([$("esri.webdoc.geotriggersInfo.DeviceLocationFeed")],QI);const mUt=QI;let e$=class extends bi(fe){constructor(e){super(e),this.geometry=null,this.where=null}};u([d({types:Aw,json:{read:ry,write:!0}})],e$.prototype,"geometry",void 0),u([d({type:String,json:{write:!0}})],e$.prototype,"where",void 0),e$=u([$("esri.webdoc.geotriggersInfo.FeatureFilter")],e$);const gUt=e$;let SA=class extends bi(fe){constructor(e){super(e),this.layerId=null,this.layerUrl=null,this.type="feature-layer"}};u([d({type:String,json:{write:{overridePolicy(){return{isRequired:this.layerUrl===null}}}}})],SA.prototype,"layerId",void 0),u([d({type:String,json:{write:{overridePolicy(){return{isRequired:this.layerId===null}}}}})],SA.prototype,"layerUrl",void 0),u([st({featureLayer:"feature-layer"},{readOnly:!0})],SA.prototype,"type",void 0),SA=u([$("esri.webdoc.geotriggersInfo.FeatureLayerSource")],SA);const yUt=SA;let UT=class extends bi(fe){constructor(e){super(e),this.fenceSource=null,this.filter=null,this.bufferDistance=null,this.type="features"}};u([d({type:yUt,json:{write:{isRequired:!0}}})],UT.prototype,"fenceSource",void 0),u([d({type:gUt,json:{write:!0}})],UT.prototype,"filter",void 0),u([d({type:Number,json:{write:!0}})],UT.prototype,"bufferDistance",void 0),u([st({features:"features"},{readOnly:!0})],UT.prototype,"type",void 0),UT=u([$("esri.webdoc.geotriggersInfo.FeatureFenceParameters")],UT);const _Ut=UT;let e8=class extends bi(fe){constructor(e){super(e),this.type="fence"}};u([st({fence:"fence"},{readOnly:!0})],e8.prototype,"type",void 0),e8=u([$("esri.webdoc.geotriggersInfo.Geotrigger")],e8);const oze=e8;let t$=class extends bi(fe){constructor(e){super(e),this.expressionInfo=null,this.requestedActions=null}};u([d({type:sze,json:{write:!0}})],t$.prototype,"expressionInfo",void 0),u([d({type:[String],json:{write:!0}})],t$.prototype,"requestedActions",void 0),t$=u([$("esri.webdoc.geotriggersInfo.GeotriggerNotificationOptions")],t$);const vUt=t$,bUt=new mr({enterContainsAndExitDoesNotContain:"enter-contains-and-exit-does-not-contain",enterContainsAndExitDoesNotIntersect:"enter-contains-and-exit-does-not-intersect",enterIntersectsAndExitDoesNotIntersect:"enter-intersects-and-exit-does-not-intersect"}),wUt=new mr({useGeometry:"use-geometry",useGeometryWithAccuracy:"use-geometry-with-accuracy"}),Fk=new mr({enter:"enter",enterOrExit:"enter-or-exit",exit:"exit"});let Tf=class extends oze{constructor(e){super(e),this.enterExitRule="enter-contains-and-exit-does-not-intersect",this.feed=null,this.feedAccuracyMode="use-geometry",this.fenceNotificationRule=null,this.fenceParameters=null,this.name=null,this.notificationOptions=null,this.type="fence"}};u([st(bUt)],Tf.prototype,"enterExitRule",void 0),u([d({type:mUt,json:{write:{isRequired:!0}}})],Tf.prototype,"feed",void 0),u([st(wUt)],Tf.prototype,"feedAccuracyMode",void 0),u([d({type:Fk.apiValues,json:{type:Fk.jsonValues,read:Fk.read,write:{writer:Fk.write,isRequired:!0}}})],Tf.prototype,"fenceNotificationRule",void 0),u([d({type:_Ut,json:{write:{isRequired:!0}}})],Tf.prototype,"fenceParameters",void 0),u([d({type:String,json:{write:!0}})],Tf.prototype,"name",void 0),u([d({type:vUt,json:{write:!0}})],Tf.prototype,"notificationOptions",void 0),u([st({fence:"fence"},{readOnly:!0})],Tf.prototype,"type",void 0),Tf=u([$("esri.webdoc.geotriggersInfo.FenceGeotrigger")],Tf);const xUt=Tf,TUt={base:oze,key:"type",typeMap:{fence:xUt}};let t8=class extends bi(fe){constructor(e){super(e),this.geotriggers=null}};u([d({types:[TUt],json:{write:{isRequired:!0}}})],t8.prototype,"geotriggers",void 0),t8=u([$("esri.webdoc.GeotriggersInfo")],t8);const SUt=t8;var _re;let EA=_re=class extends fe{constructor(t){super(t),this.activeRange=null,this.currentRangeExtent=null,this.fullRangeExtent=null}clone(){return new _re(se({activeRange:this.activeRange,currentRangeExtent:this.currentRangeExtent,fullRangeExtent:this.fullRangeExtent}))}};u([d({type:String,nonNullable:!0,json:{read:{source:"activeRangeName"},write:{target:"activeRangeName",isRequired:!0}}})],EA.prototype,"activeRange",void 0),u([d({type:[Number],json:{write:!0}})],EA.prototype,"currentRangeExtent",void 0),u([d({type:[Number],json:{write:!0}})],EA.prototype,"fullRangeExtent",void 0),EA=_re=u([$("esri.webdoc.RangeInfo")],EA);const kce=EA;var vre;let gg=vre=class extends fe{constructor(t){super(t),this.enabled=!1,this.longNames=!1,this.minimized=!1,this.pinnedLevels=!1,this.site=null,this.facility=null,this.level=null}clone(){return new vre(se({enabled:this.enabled,longNames:this.longNames,minimized:this.minimized,pinnedLevels:this.pinnedLevels,site:this.site,facility:this.facility,level:this.level}))}};u([d({type:Boolean,json:{read:{source:"enabled"},write:{target:"enabled"}}})],gg.prototype,"enabled",void 0),u([d({type:Boolean,json:{read:{source:"longNames"},write:{target:"longNames"}}})],gg.prototype,"longNames",void 0),u([d({type:Boolean,json:{read:{source:"minimized"},write:{target:"minimized"}}})],gg.prototype,"minimized",void 0),u([d({type:Boolean,json:{read:{source:"pinnedLevels"},write:{target:"pinnedLevels"}}})],gg.prototype,"pinnedLevels",void 0),u([d({type:String,json:{read:{source:"site"},write:{target:"site"}}})],gg.prototype,"site",void 0),u([d({type:String,json:{read:{source:"facility"},write:{target:"facility"}}})],gg.prototype,"facility",void 0),u([d({type:String,json:{read:{source:"level"},write:{target:"level"}}})],gg.prototype,"level",void 0),gg=vre=u([$("esri.webdoc.widgets.FloorFilter")],gg);const EUt=gg;var bre;const kk=new mr({slider:"slider",picker:"picker"});let CA=bre=class extends fe{constructor(t){super(t),this.interactionMode=null,this.numStops=null,this.stopInterval=null}clone(){return new bre({interactionMode:this.interactionMode,numStops:this.numStops,stopInterval:this.stopInterval})}};u([d({type:kk.apiValues,nonNullable:!0,json:{type:kk.jsonValues,default:null,read:{reader:kk.read},write:{isRequired:!0,writer:kk.write}}})],CA.prototype,"interactionMode",void 0),u([d({type:Number,json:{read:{source:"numberOfStops"},write:{target:"numberOfStops",overridePolicy(){const t=this.stopInterval!=null;return{enabled:!t,isRequired:!t}}}}})],CA.prototype,"numStops",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{isRequired:this.numStops==null}}}}})],CA.prototype,"stopInterval",void 0),CA=bre=u([$("esri.webdoc.widgets.Range")],CA);const CUt=CA;var wre;let ia=wre=class extends fe{constructor(t){super(t),this.currentTimeExtent=null,this.fullTimeExtent=null,this.loop=!1,this.numStops=null,this.numThumbs=null,this.stopDelay=null,this.stopInterval=null,this.stops=null}readCurrentTimeExtent(t){if(!t)return;const e=t[0]!=null?new Date(t[0]):null,r=t[1]!=null?new Date(t[1]):null;return new qc({start:e,end:r})}writeCurrentTimeExtent(t,e,r){t&&ma(r,[v(t.start)?t.start.getTime():null,v(t.end)?t.end.getTime():null],e)}readFullTimeExtent(t,e){const r=e.properties;if(!r)return;const i=r.endTime!=null?new Date(r.endTime):null,n=r.startTime!=null?new Date(r.startTime):null;return new qc({start:n,end:i})}writeFullTimeExtent(t,e){if(!t)return;const r=e.properties=e.properties||{},i=t.end,n=t.start;i&&(r.endTime=v(i)?i.getTime():null),n&&(r.startTime=v(n)?n.getTime():null)}readStopInterval(t,e,r){return t?LO.fromJSON({value:t.interval,unit:t.units},r):null}writeStopInterval(t,e,r,i){if(!t)return;const n=t.toJSON(i);ma(r,{interval:n.value,units:n.unit},e)}readStops(t){return t&&t.length?t.map(e=>new Date(e)):null}writeStops(t,e,r){t&&t.length&&ma(r,t.map(i=>i.getTime()),e)}clone(){return new wre(se({currentTimeExtent:this.currentTimeExtent,fullTimeExtent:this.fullTimeExtent,loop:this.loop,numStops:this.numStops,numThumbs:this.numThumbs,stopDelay:this.stopDelay,stopInterval:this.stopInterval,stops:this.stops}))}};u([d({type:qc,json:{read:{source:"properties.currentTimeExtent"},write:{target:"properties.currentTimeExtent"}}})],ia.prototype,"currentTimeExtent",void 0),u([Me("currentTimeExtent")],ia.prototype,"readCurrentTimeExtent",null),u([De("currentTimeExtent")],ia.prototype,"writeCurrentTimeExtent",null),u([d({type:qc,json:{read:{source:["properties.endTime","properties.startTime"]},write:{target:{"properties.endTime":{type:Number},"properties.startTime":{type:Number}}}}})],ia.prototype,"fullTimeExtent",void 0),u([Me("fullTimeExtent")],ia.prototype,"readFullTimeExtent",null),u([De("fullTimeExtent")],ia.prototype,"writeFullTimeExtent",null),u([d({type:Boolean,nonNullable:!0,json:{default:!1,read:{source:"properties.loop"},write:{target:"properties.loop"}}})],ia.prototype,"loop",void 0),u([d({type:Number,json:{read:{source:"properties.numberOfStops"},write:{target:"properties.numberOfStops",overridePolicy(){var i;const t=!!this.stopInterval,e=!!((i=this.stops)!=null&&i.length),r=!(t||e);return{enabled:r,isRequired:r}}}}})],ia.prototype,"numStops",void 0),u([d({type:[1,2],nonNullable:!0,json:{read:{source:"properties.thumbCount"},write:{target:"properties.thumbCount",isRequired:!0}}})],ia.prototype,"numThumbs",void 0),u([d({type:Number,nonNullable:!0,json:{read:{source:"properties.thumbMovingRate"},write:{target:"properties.thumbMovingRate",isRequired:!0}}})],ia.prototype,"stopDelay",void 0),u([d({type:LO,json:{read:{source:"properties.timeStopInterval"},write:{target:"properties.timeStopInterval",overridePolicy(){var r;const t=this.numStops!=null,e=!!((r=this.stops)!=null&&r.length);return{enabled:!e,isRequired:!(t||e)}}}}})],ia.prototype,"stopInterval",void 0),u([Me("stopInterval")],ia.prototype,"readStopInterval",null),u([De("stopInterval")],ia.prototype,"writeStopInterval",null),u([d({type:[Date],json:{read:{source:"properties.stops"},write:{target:"properties.stops",overridePolicy(){return{isRequired:this.numStops==null&&!this.stopInterval}}}}})],ia.prototype,"stops",void 0),u([Me("stops")],ia.prototype,"readStops",null),u([De("stops")],ia.prototype,"writeStops",null),ia=wre=u([$("esri.webdoc.widgets.TimeSlider")],ia);const AUt=ia;var xre;let AA=xre=class extends fe{constructor(t){super(t),this.range=null,this.timeSlider=null,this.floorFilter=null}clone(){return new xre(se({range:this.range,timeSlider:this.timeSlider,floorFilter:this.floorFilter}))}};u([d({type:CUt,json:{write:!0}})],AA.prototype,"range",void 0),u([d({type:AUt,json:{write:!0}})],AA.prototype,"timeSlider",void 0),u([d({type:EUt,json:{write:!0}})],AA.prototype,"floorFilter",void 0),AA=xre=u([$("esri.webdoc.Widgets")],AA);const RUt=AA,OUt={width:600,height:400},Uk=1.5;function MUt(t,e){e=e||OUt;let{width:r,height:i}=e;const n=r/i;return n<Uk?i=r/Uk:n>Uk&&(r=i*Uk),r>t.width&&(i*=t.width/r,r=t.width),i>t.height&&(r*=t.height/i,i=t.height),{width:Math.round(r),height:Math.round(i)}}function kwe(t){return{enabled:!!(t!=null&&t.length)}}var Tre;let RA=Tre=class extends fe{constructor(t){super(t),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new Tre({exactMatch:this.exactMatch,type:this.type,name:this.name})}};u([d({type:Boolean,json:{write:!0}})],RA.prototype,"exactMatch",void 0),u([d({type:String,json:{write:!0}})],RA.prototype,"name",void 0),u([st(Fse)],RA.prototype,"type",void 0),RA=Tre=u([$("esri.webdoc.applicationProperties.SearchLayerField")],RA);const PUt=RA;var Sre;let OA=Sre=class extends fe{constructor(t){super(t),this.field=null,this.id=null,this.subLayer=null}clone(){return new Sre(se({field:this.field,id:this.id,subLayer:this.subLayer}))}};u([d({type:PUt,json:{write:{isRequired:!0}}})],OA.prototype,"field",void 0),u([d({type:String,json:{write:{isRequired:!0}}})],OA.prototype,"id",void 0),u([d({type:Xi,json:{write:!0}})],OA.prototype,"subLayer",void 0),OA=Sre=u([$("esri.webdoc.applicationProperties.SearchLayer")],OA);const IUt=OA;var Ere;let MA=Ere=class extends fe{constructor(t){super(t),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new Ere({exactMatch:this.exactMatch,type:this.type,name:this.name})}};u([d({type:Boolean,json:{write:!0}})],MA.prototype,"exactMatch",void 0),u([d({type:String,json:{write:!0}})],MA.prototype,"name",void 0),u([st(Fse)],MA.prototype,"type",void 0),MA=Ere=u([$("esri.webdoc.applicationProperties.SearchTableField")],MA);const $Ut=MA;var Cre;let r$=Cre=class extends fe{constructor(t){super(t),this.field=null,this.id=null}clone(){return new Cre(se({field:this.field,id:this.id}))}};u([d({type:$Ut,json:{write:{isRequired:!0}}})],r$.prototype,"field",void 0),u([d({type:String,json:{write:{isRequired:!0}}})],r$.prototype,"id",void 0),r$=Cre=u([$("esri.webdoc.applicationProperties.SearchTable")],r$);const LUt=r$;var Are;const aze=ct.ofType(IUt),lze=ct.ofType(LUt);let yg=Are=class extends fe{constructor(t){super(t),this.addressSearchEnabled=!0,this.enabled=!0,this.hintText=null,this.layers=new aze,this.tables=new lze}readAddressSearchEnabled(t){return!t}writeAddressSearchEnabled(t,e,r){e[r]=!t}clone(){return new Are(se({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers,tables:this.tables}))}};u([d({type:Boolean,nonNullable:!0,json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder",isRequired:!0},origins:{"web-scene":{read:!1,write:!1}}}})],yg.prototype,"addressSearchEnabled",void 0),u([Me("addressSearchEnabled")],yg.prototype,"readAddressSearchEnabled",null),u([De("addressSearchEnabled")],yg.prototype,"writeAddressSearchEnabled",null),u([d({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-map":{write:{isRequired:!0}},"web-scene":{default:!0,write:!0}}}})],yg.prototype,"enabled",void 0),u([d({type:String,json:{write:!0}})],yg.prototype,"hintText",void 0),u([d({type:aze,json:{write:{overridePolicy:kwe},origins:{"web-scene":{write:{isRequired:!0}}}}})],yg.prototype,"layers",void 0),u([d({type:lze,json:{read:!0,write:{overridePolicy:kwe}}})],yg.prototype,"tables",void 0),yg=Are=u([$("esri.webdoc.applicationProperties.Search")],yg);const DUt=yg;var Rre;let r8=Rre=class extends fe{constructor(t){super(t),this.search=null}clone(){return new Rre(se({search:this.search}))}};u([d({type:DUt,json:{write:!0}})],r8.prototype,"search",void 0),r8=Rre=u([$("esri.webdoc.applicationProperties.Viewing")],r8);const NUt=r8;var Ore;let PA=Ore=class extends fe{constructor(t){super(t),this.editing=null,this.offline=null,this.viewing=null}clone(){return new Ore(se({editing:this.editing,offline:this.offline,viewing:this.viewing}))}};u([d({json:{write:!0}})],PA.prototype,"editing",void 0),u([d({json:{write:!0}})],PA.prototype,"offline",void 0),u([d({type:NUt,json:{write:!0}})],PA.prototype,"viewing",void 0),PA=Ore=u([$("esri.webmap.ApplicationProperties")],PA);const FUt=PA;var Mre;let BS=Mre=class extends fe{constructor(){super(...arguments),this.url=""}destroy(){this.url=""}clone(){return new Mre({url:this.url})}};u([d({type:String,json:{write:{isRequired:!0}}})],BS.prototype,"url",void 0),BS=Mre=u([$("esri.webdoc.support.SlideThumbnail")],BS);var Pre;let _g=Pre=class extends c3(fe){constructor(t){super(t),this.name=null,this.thumbnail=new BS,this.timeExtent=null}castThumbnail(t){return typeof t=="string"?new BS({url:t}):bs(BS,t)}set viewpoint(t){const{targetGeometry:e,scale:r}=t;v(e)&&e.type==="point"&&R(r)&&re.getLogger(this.declaredClass).warn("Bookmark.viewpoint should include 'scale' when its targetGeometry is a point.",t),this._set("viewpoint",t)}readViewpoint(t,e){const{extent:r,viewpoint:i}=e;return Xn.fromJSON(i||{targetGeometry:r})}writeViewpoint(t,e,r,i){if(!t)return;const{targetGeometry:n}=t;if(v(n)&&n.type!=="extent"){const s="Bookmark.viewpoint cannot be written to JSON when the viewpoint's targetGeometry is not an extent.";i!=null&&i.messages?i.messages.push(new H("property:unsupported",s)):re.getLogger(this.declaredClass).error(s)}else v(n)&&(e.extent=n.toJSON()),e[r]=t.toJSON()}clone(){return new Pre(se({name:this.name,thumbnail:this.thumbnail,timeExtent:this.timeExtent,viewpoint:this.viewpoint}))}};u([d({type:String,nonNullable:!0,json:{write:{isRequired:!0}}})],_g.prototype,"name",void 0),u([d({type:BS,json:{write:{overridePolicy:t=>({enabled:!(!t||!t.url)})}}})],_g.prototype,"thumbnail",void 0),u([cr("thumbnail")],_g.prototype,"castThumbnail",null),u([d({type:qc,json:{write:!0}})],_g.prototype,"timeExtent",void 0),u([d({type:Xn,nonNullable:!0,json:{write:!0}})],_g.prototype,"viewpoint",null),u([Me("viewpoint",["extent","viewpoint"])],_g.prototype,"readViewpoint",null),u([De("viewpoint")],_g.prototype,"writeViewpoint",null),_g=Pre=u([$("esri.webmap.Bookmark")],_g);const kUt=_g;var Ire;let zT=Ire=class extends be{constructor(t){super(t),this.background=null,this.rangeInfo=null,this.spatialReference=null,this.viewpoint=null}clone(){return new Ire(se({background:this.background,rangeInfo:this.rangeInfo,spatialReference:this.spatialReference,viewpoint:this.viewpoint}))}};u([d({type:LB})],zT.prototype,"background",void 0),u([d({type:kce})],zT.prototype,"rangeInfo",void 0),u([d({type:Je})],zT.prototype,"spatialReference",void 0),u([d({type:Xn})],zT.prototype,"viewpoint",void 0),zT=Ire=u([$("esri.webmap.InitialViewProperties")],zT);const i8=zT;class uL extends C2{constructor(e,r){super(e,r,"webmap")}}const n8=new uL(2,27),YW="Web Map",cze=ct.ofType(kUt),UUt=ct.ofType(nze),i$=new Map;i$.set("image/jpeg","jpeg"),i$.set("image/jpg","jpg"),i$.set("image/png","png"),i$.set("image/gif","gif");const zUt="ArcGIS Pro",Uwe=voe.JSAPI,zwe="CollectorDisabled",Vwe="Collector",Bwe="Data Editing",jwe="OfflineDisabled",Gwe="Offline",Hwe="Workforce Project",qwe="Workforce Worker",Wwe="Workforce Dispatcher",VUt="Offline Map Areas",BUt="FieldMapsDisabled",Xwe=voe.DEVELOPER_BASEMAP,Ywe="UtilityNetwork",jUt=["NatGeo_World_Map","Ocean_Basemap","USA_Topo_Maps","World_Imagery","World_Street_Map","World_Terrain_Base","World_Topo_Map","World_Hillshade","Canvas/World_Light_Gray_Base","Canvas/World_Light_Gray_Reference","Canvas/World_Dark_Gray_Base","Canvas/World_Dark_Gray_Reference","Ocean/World_Ocean_Base","Ocean/World_Ocean_Reference","Reference/World_Boundaries_and_Places","Reference/World_Reference_Overlay","Reference/World_Transportation"].map(t=>t.toLowerCase());let hn=class extends IN(qu.LoadableMixin(m3(PB))){constructor(t){super(t),this._isAuthoringAppSetByUser=!1,this._isAuthoringAppVersionSetByUser=!1,this._thumbnailFilename=null,this._updateFromPromise=null,this._resourceReferences={portalItem:null,paths:[]},this.applicationProperties=null,this.bookmarks=new cze,this.floorInfo=null,this.geotriggersInfo=null,this.initialViewProperties=new i8,this.portalItem=null,this.presentation=null,this.sourceVersion=null,this.widgets=null,this.utilityNetworks=null,this.authoringApp=this.authoringAppVersion=null,this._isAuthoringAppSetByUser=this._isAuthoringAppVersionSetByUser=!1}destroy(){const t=this.portalItem;this.portalItem=null,t==null||t.destroy()}initialize(){if(this.when().catch(t=>{re.getLogger(this.declaredClass).error("#load()","Failed to load web map",t)}),this.resourceInfo){let t;try{t=this._validateJSON(this.resourceInfo)}catch(e){return void this.addResolvingPromise(Promise.reject(e))}this.read(t)}}set authoringApp(t){this._isAuthoringAppSetByUser=!0,this._set("authoringApp",t)}writeAuthoringApp(t,e){t&&this._isAuthoringAppSetByUser?e.authoringApp=t:e.authoringApp=Uwe}set authoringAppVersion(t){this._isAuthoringAppVersionSetByUser=!0,this._set("authoringAppVersion",t)}writeAuthoringAppVersion(t,e){t&&this._isAuthoringAppVersionSetByUser?e.authoringAppVersion=t:e.authoringAppVersion=Gne}readInitialViewProperties(t,e){var n;const r=new i8;e.background&&(r.background=LB.fromJSON(e.background));const i=(n=e.initialState)==null?void 0:n.viewpoint;return i&&(i.rotation&&uL.parse(e.version||"","webmap").lessThan(2,20)&&e.authoringApp===zUt&&(i.rotation*=-1),r.viewpoint=Xn.fromJSON(i)),e.mapRangeInfo&&(r.rangeInfo=kce.fromJSON(e.mapRangeInfo)),e.spatialReference&&(r.spatialReference=Je.fromJSON(e.spatialReference)),r}writeInitialViewProperties(t,e,r,i){if(!t)return;const n=t.background;n&&n.color&&(e.background=n.write({},i)),t.viewpoint&&(e.initialState={viewpoint:t.viewpoint.write({},i)}),t.rangeInfo&&(e.mapRangeInfo=t.rangeInfo.toJSON(i)),t.spatialReference&&(e.spatialReference=t.spatialReference.write({},i))}writeLayers(t,e,r,i){e[r]=this._writeLayers(t,i,"operational-layers")}readSourceVersion(t,e){const[r,i]=e.version.split(".");return new uL(parseInt(r,10),parseInt(i,10))}writeSourceVersion(t,e,r){e[r]=`${n8.major}.${n8.minor}`}writeTables(t,e,r,i){const n=this._writeLayers(t,i,"tables");n.length&&(e[r]=n)}get thumbnailUrl(){return this.portalItem&&this.portalItem.thumbnailUrl||null}set thumbnailUrl(t){t?(this._override("thumbnailUrl",t),this._thumbnailFilename=this._generateCustomThumbnailFilename(t)):this._clearThumbnailOverride()}load(t){return this.addResolvingPromise(this._loadFromSource()),Promise.resolve(this)}loadAll(){return Ooe(this,t=>{t(this.ground,this.basemap,this.layers,this.tables)})}read(t,e){e={...e,origin:"web-map"};const r=this._getAuthoringPropsState();T2e(this,t,i=>super.read(t,i),e),this._restoreAuthoringPropsFromState(r)}write(t,e){if(this.loadStatus!=="loaded"){const r=new H("webmap:not-loaded","Web map must be loaded before it can be serialized");throw re.getLogger(this.declaredClass).error("#toJSON()","Web map must be loaded before it can be serialized",this.loadError||this.loadStatus),r}return this._removeDanglingLayerRefs(),e={...e,origin:"web-map",restrictedWebMapWriting:!0,webmap:this},super.write(t,e)}async save(t){t=t||{},this._validateItem();const e=Q(()=>import("./saveUtils-0c6b48e0.js"),["assets/saveUtils-0c6b48e0.js","assets/resourceUtils-49972048.js"]);await this._updateFromPromise,await this.load(),await this._loadLayerContainers(),await this._beforeSave(),await this._validateMap();const r=this.portalItem,i=Uo(r.itemUrl),n={origin:"web-map",messages:[],writtenProperties:[],url:i,portal:r.portal||pa.getDefault(),portalItem:r,verifyItemRelativeUrls:i?{rootPath:i.path,writtenUrls:[]}:null,blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},s=this.write({},n);return await Promise.all(n.resources.pendingOperations),this._validateJSONForWriting(n,t),await this._updateItemProperties(r),await this._updateItem(r,s,n),await Promise.all([this._updateItemThumbnail(),e.then(({saveResources:o})=>o(this._resourceReferences,n,null))]),r}async saveAs(t,e){e=e||{};const r=this._getPortalItem(t),i=Q(()=>import("./saveUtils-0c6b48e0.js"),["assets/saveUtils-0c6b48e0.js","assets/resourceUtils-49972048.js"]);await this._updateFromPromise,await this.load(),await this._loadLayerContainers(),await this._beforeSave(),await this._validateMap();const n={origin:"web-map",messages:[],writtenProperties:[],url:null,portal:r.portal,portalItem:r,blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},s=this.write({},n);await Promise.all(n.resources.pendingOperations),this._validateJSONForWriting(n,e),await this._updateItemPropertiesForSaveAs(r);const o=this._getThumbnailState();return await this._createItem(r,s,n,e)&&(this._resourceReferences.portalItem=r),this._restoreThumbnailFromState(o),await Promise.all([this._updateItemThumbnail(),i.then(({saveResources:a})=>a(this._resourceReferences,n,null))]),r}async updateFrom(t,e){const r=this._updateFromInternal(t,e);this._updateFromPromise=r,await r,r===this._updateFromPromise&&(this._updateFromPromise=null)}getLayerJSONFromResourceInfo(t){var r,i,n,s;const e=this.resourceInfo;return this._collectAllLayersJSON([...((r=e==null?void 0:e.baseMap)==null?void 0:r.baseMapLayers)||[],...(e==null?void 0:e.operationalLayers)||[],...((s=(n=(i=this.basemap)==null?void 0:i.resourceInfo)==null?void 0:n.data)==null?void 0:s.baseMapLayers)||[]]).find(o=>o.id===t.id)}_collectAllLayersJSON(t){return t.reduce((e,r)=>(e.push(r),r.layerType==="GroupLayer"&&(e=e.concat(this._collectAllLayersJSON(r.layers||[]))),e),[])}_writeLayers(t,e,r){return e={...e,layerContainerType:r},t.map(i=>sQ(i,r==="tables"?null:this.getLayerJSONFromResourceInfo(i),e)).filter(Boolean).toArray()}_loadFromSource(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-map"}):this.portalItem&&this.portalItem.id?this._loadFromItem(this.portalItem):Promise.resolve()}async _loadFromItem(t){if(await t.load().catch(i=>{throw new H("webmap:load-portal-item","Failed to load portal item",{error:i})}),t.type!=="Web Map")throw new H("webmap:invalid-portal-item",`Invalid portal item type '${t.type}', expected 'Web Map'`,{type:t.type});const e=await t.fetchData();this.resourceInfo=e;const r={origin:"web-map",url:Uo(t.itemUrl),portal:t.portal||pa.getDefault(),portalItem:t,readResourcePaths:[]};return await this._readAndLoadFromJSON(e,r),this._resourceReferences={portalItem:t,paths:r.readResourcePaths??[]},this._computeInitialViewpoint()}_readAndLoadFromJSON(t,e){const r=this._validateJSON(t);return this.read(r,e),this._loadFromJSON(r,e)}_validateJSON(t){const e=uL.parse(t.version||"","webmap");return n8.validate(e),t.version=`${e.major}.${e.minor}`,t}_loadFromJSON(t,e){const r={context:{...e,layerContainerType:"operational-layers"}};return this.portalItem&&(r.context.portal=this.portalItem.portal||pa.getDefault()),Q(()=>import("./layersCreator-46a6cc05.js"),["assets/layersCreator-46a6cc05.js","assets/lazyLayerLoader-60b48c6f.js","assets/portalLayers-f443c7e1.js","assets/layersLoader-aabc4951.js","assets/fetchService-65c9e60a.js","assets/jsonContext-b7261aa0.js"]).then(({populateOperationalLayers:i})=>{const n=[],s=t.operationalLayers;s&&s.length&&n.push(i(this.layers,s,r));const o={...r,context:{...r.context,layerContainerType:"tables"},defaultLayerType:"ArcGISFeatureLayer"},a=t.tables;return a&&a.length&&n.push(i(this.tables,a,o)),ha(n).then(()=>{})})}async _computeInitialViewpoint(){var i;let t=this.initialViewProperties;if((i=t==null?void 0:t.viewpoint)==null?void 0:i.targetGeometry)return;const r=await this._getExtentFromItem();r&&(t=t?t.clone():new i8,t.viewpoint=new Xn,t.viewpoint.targetGeometry=r,this.initialViewProperties=t)}async _getExtentFromItem(){var r,i;const t=(r=this.initialViewProperties)==null?void 0:r.spatialReference,e=(i=this.portalItem)==null?void 0:i.extent;return t&&e?t.isWGS84?e.clone():t.isWebMercator?Gg(e):(await Q(()=>Promise.resolve().then(()=>Bte),void 0)).getGeometryServiceURL(this.portalItem).then(n=>{const s=new VD;return s.geometries=[e],s.outSpatialReference=t,zV(n,s)}).then(n=>n[0]).catch(n=>(re.getLogger(this.declaredClass).error("Error projecting item's extent:",n),null)):null}_removeDanglingLayerRefs(){const t=this.applicationProperties,e=t&&t.viewing&&t.viewing.search,r=s=>this.allLayers.some(o=>o.id===s);e&&e.layers&&(e.layers=e.layers.filter(s=>r(s.id))),e&&e.tables&&(e.tables=e.tables.filter(s=>this.tables.some(o=>o.id===s.id)));const i=t&&t.editing&&t.editing.locationTracking;i&&i.info&&!r(i.info.layerId)&&(t.editing=null);const n=this.presentation&&this.presentation.slides;n&&n.forEach(s=>{s.visibleLayers&&(s.visibleLayers=s.visibleLayers.filter(o=>r(o.id)))})}async _validateMap(){var e;if(!((e=this.basemap)!=null&&e.baseLayers.length))throw new H("webmap:save","Map does not have a valid basemap with a base layer.");let t=null;if(await tw(()=>{const r=ght(this.initialViewProperties,this.basemap);return t=r.spatialReference,!r.updating}),!In(t,this.initialViewProperties.spatialReference))throw new H("webmap:save","The spatial reference of the basemap is not compatible with the one from the map.",{expected:this.initialViewProperties.spatialReference,actual:t})}_validateItem(){if(!this.portalItem)throw re.getLogger(this.declaredClass).error("save: requires the portalItem property to be set"),new H("webmap:portal-item-not-set","Portal item to save to has not been set on the WebMap");this._validateItemType(this.portalItem)}_validateItemType(t){if(t.type!==YW)throw new H("webmap:portal-item-wrong-type",`Portal item needs to have type "${YW}"`)}_loadLayerContainers(){const t=[];return this.basemap&&t.push(this.basemap.load()),this.ground&&t.push(this.ground.load()),ha(t).then(()=>{})}async _beforeSave(){const t=[];for(const e of this.allLayers)if("beforeSave"in e&&typeof e.beforeSave=="function"){const r=e.beforeSave();r&&t.push(r)}await ha(t)}_loadAllLayers(){const t=this._getAllLayersAndTables().map(e=>e.load());return ha(t).then(()=>{})}_getAllLayersAndTables(){return this.allLayers.concat(this.allTables)}_validateJSONForWriting(t,e){let r=(t.messages?t.messages:[]).filter(i=>i.type==="error").map(i=>new H(i.name,i.message,i.details));if(t.blockedRelativeUrls&&(r=r.concat(t.blockedRelativeUrls.map(i=>new H("url:unsupported",`Relative url '${i}' is not supported in Web Map`)))),e.ignoreUnsupported&&(r=r.filter(i=>i.name!=="layer:unsupported"&&i.name!=="symbol:unsupported"&&i.name!=="symbol-layer:unsupported"&&i.name!=="property:unsupported"&&i.name!=="url:unsupported")),r.length>0)throw new H("webmap:save","Failed to save webmap due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:r})}async _updateItemProperties(t){t.extent=await this._getWGS84Extent(this.initialViewProperties.viewpoint.targetGeometry),await this._updateTypeKeywords(t)}async _updateItemPropertiesForSaveAs(t){ih(t,zwe),ih(t,BUt),ih(t,voe.METADATA),ih(t,jwe),ih(t,VUt),ih(t,Wwe),ih(t,Hwe),ih(t,qwe),await this._updateItemProperties(t)}async _getWGS84Extent(t){const e=t.clone().normalize();let r;if(e.length>1)for(const i of e)r?i.width>r.width&&(r=i):r=i;else r=e[0];return this._projectToWGS84(r)}async _projectToWGS84(t){const e=t.spatialReference;if(e.isWGS84)return t.clone();if(e.isWebMercator)return uS(t);const r=await Q(()=>Promise.resolve().then(()=>Bte),void 0),i=await r.getGeometryServiceURL(this.portalItem),n=new VD;return n.geometries=[t],n.outSpatialReference=Je.WGS84,(await zV(i,n))[0]}async _updateTypeKeywords(t){iE(t,Uwe),await this._loadAllLayers(),this._evalCollectorKeyword(t),this._evalDataEditingKeyword(t),this._evalOfflineKeyword(t),this._evalDeveloperBasemapKeyword(t),this._evalUtilityNetworkKeyword(t),t.typeKeywords&&(t.typeKeywords=t.typeKeywords.filter((e,r,i)=>i.indexOf(e)===r))}_evalCollectorKeyword(t){HC(t,zwe)||HC(t,Hwe)||HC(t,qwe)||HC(t,Wwe)||!this._hasEditableFeatureLayer()?ih(t,Vwe):iE(t,Vwe)}_evalDataEditingKeyword(t){this._hasEditableFeatureLayer()?iE(t,Bwe):ih(t,Bwe)}_evalOfflineKeyword(t){!HC(t,jwe)&&this._isOfflineCapableMap()?iE(t,Gwe):ih(t,Gwe)}_evalDeveloperBasemapKeyword(t){mht(this.basemap)?iE(t,Xwe):ih(t,Xwe)}_evalUtilityNetworkKeyword(t){var e;(e=this.utilityNetworks)!=null&&e.length?iE(t,Ywe):ih(t,Ywe)}_hasEditableFeatureLayer(){return this._getAllLayersAndTables().some(t=>t.loaded&&ape(t)&&t.capabilities.operations.supportsEditing&&t.editingEnabled)}_isOfflineCapableMap(){return this._getAllLayersAndTables().filter(t=>t.type!=="group").every(t=>t.loaded&&this._isOfflineCapableLayer(t))}_isFeatureCollectionLike(t){return uB(t)||t.type==="map-notes"||t.type==="route"}_isOfflineCapableLayer(t){return ape(t)&&t.capabilities.operations.supportsSync||this._isFeatureCollectionLike(t)&&!t.portalItem||(t.type==="tile"||t.type==="vector-tile")&&(t.capabilities.operations.supportsExportTiles||this._isExportableAGOLTileLayer(t)||dIe(t))&&t.spatialReference.equals(this.initialViewProperties.spatialReference)}_isExportableAGOLTileLayer(t){return t.type==="tile"&&dst(t.url)&&jUt.some(e=>{var r;return(r=t.url)==null?void 0:r.toLowerCase().includes("/"+e+"/")})}async _updateItem(t,e,r){await t.update({data:e}),this._syncUpInstanceWithItem(t,e,r)}async _createItem(t,e,r,i){const n=this.portalItem,s={item:n,authenticated:!(!(n!=null&&n.id)||!n.portal.user)},o=t.portal;await o.signIn();const{copyAllowed:a,itemReloaded:l}=await this._isCopyAllowed(s,o);if(s.authenticated||(s.authenticated=l),!a)throw new H("webmap:save-as-copy-not-allowed","Owner of this map does not allow others to save a copy");const c=await this._initializeNewItem(t,s,e,i);return this.portalItem=t,this._syncUpInstanceWithItem(t,e,r),c}async _isCopyAllowed(t,e){var n;const{item:r,authenticated:i}=t;return r!=null&&r.id&&((n=r.typeKeywords)!=null&&n.includes("useOnly"))?r.portal.portalHostname!==e.portalHostname?{copyAllowed:!1,itemReloaded:!1}:(i||await r.reload(),{copyAllowed:r.itemControl==="admin"||r.itemControl==="update",itemReloaded:!0}):{copyAllowed:!0,itemReloaded:!1}}async _initializeNewItem(t,e,r,i){var h;const n=t.portal,{item:s,authenticated:o}=e,{folder:a,copyAllResources:l}=i;let c=!1;if(l&&(s!=null&&s.id)&&HWe(s.portal.url,n.url)&&(o||await s.reload(),s.isOrgItem)){const{total:p}=await s.fetchResources();c=!!p}if(c){const p=await s.copy({copyResources:"all",folder:a});t.id=p.id,t.portal=p.portal;const f=t.toJSON();await t.load(),t.read(f),await t.update({data:r})}else await((h=n.user)==null?void 0:h.addItem({item:t,folder:a,data:r}));return c}_syncUpInstanceWithItem(t,e,r){Mz.prototype.read.call(this,{version:e.version,authoringApp:e.authoringApp,authoringAppVersion:e.authoringAppVersion},{origin:"web-map",ignoreDefaults:!0,url:t.itemUrl&&Uo(t.itemUrl)}),X6t(r),this.resourceInfo=e}async _updateItemThumbnail(){var t;this.thumbnailUrl&&this._isOverridden("thumbnailUrl")&&(await((t=this.portalItem)==null?void 0:t.updateThumbnail({thumbnail:this.thumbnailUrl,filename:this._thumbnailFilename})),this._clearThumbnailOverride())}_getPortalItem(t){let e=r_.from(t);return e.id&&(e=e.clone(),e.id=null),e.type||(e.type=YW),e.portal||(e.portal=pa.getDefault()),this._validateItemType(e),e}async _updateFromInternal(t,e){if(e=e||{},await tw(()=>t.ready),this._updateInitialViewProperties(t,e),t.map===this)for(const r of t.allLayerViews)for(const i of["visible","featureEffect"])i in r&&i in r.layer&&r._isOverridden(i)&&(r.layer[i]=r[i]);await this._updateThumbnailUrl(t,e)}_updateInitialViewProperties(t,e){var r,i;if(e.backgroundExcluded||(this.initialViewProperties.background=(r=t.background)==null?void 0:r.clone()),this.initialViewProperties.spatialReference=(i=t.spatialReference)==null?void 0:i.clone(),e.viewpointExcluded||(this.initialViewProperties.viewpoint=new Xn({rotation:t.rotation,scale:e.scalePreserved?t.scale:null,targetGeometry:this._getViewExtent(t)})),!e.widgetsExcluded)for(const n of t.persistableViewModels)n.updateWebDocument(this)}_getViewExtent(t){const e=t.center.clone().normalize(),r=t.extent.clone(),i=r.width/2;return r.xmin=e.x-i,r.xmax=e.x+i,r}async _updateThumbnailUrl(t,e){if(e.thumbnailExcluded)return;const r=MUt(t,e.thumbnailSize),i=await t.takeScreenshot({format:"png",width:r.width,height:r.height});this._setAutoGeneratedThumbnail(i.dataUrl)}_setAutoGeneratedThumbnail(t){this.thumbnailUrl=t,this._thumbnailFilename=null}_clearThumbnailOverride(){this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"),this._thumbnailFilename=null}_generateCustomThumbnailFilename(t){if(cd(t)){const e=f3(t),r=e&&e.mediaType,i=r&&i$.get(r.toLowerCase())||null,n=`thumbnail${Date.now()}`;return i?`${n}.${i}`:n}return null}_getThumbnailState(){let t=this.thumbnailUrl;return t&&(t=this._isOverridden("thumbnailUrl")?t:Bne(t,"w","8192")),{thumbnailUrl:t,filename:this._thumbnailFilename}}_restoreThumbnailFromState(t){this.thumbnailUrl=t.thumbnailUrl,this._thumbnailFilename=t.filename}_getAuthoringPropsState(){return{authoringApp:this.authoringApp,authoringAppVersion:this.authoringAppVersion,isAuthoringAppSetByUser:this._isAuthoringAppSetByUser,isAuthoringAppVersionSetByUser:this._isAuthoringAppVersionSetByUser}}_restoreAuthoringPropsFromState(t){t.isAuthoringAppSetByUser?this.authoringApp=t.authoringApp:this._isAuthoringAppSetByUser=!1,t.isAuthoringAppVersionSetByUser?this.authoringAppVersion=t.authoringAppVersion:this._isAuthoringAppVersionSetByUser=!1}static fromJSON(t){const e=t;if(!e)throw new H("webmap:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:e})}};hn.VERSION=n8,u([d({type:FUt,json:{write:!0}})],hn.prototype,"applicationProperties",void 0),u([d({type:String,json:{write:{allowNull:!0,ignoreOrigin:!0}}})],hn.prototype,"authoringApp",null),u([De("authoringApp")],hn.prototype,"writeAuthoringApp",null),u([d({type:String,json:{write:{allowNull:!0,ignoreOrigin:!0}}})],hn.prototype,"authoringAppVersion",null),u([De("authoringAppVersion")],hn.prototype,"writeAuthoringAppVersion",null),u([d({json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],hn.prototype,"basemap",void 0),u([d({type:cze,json:{write:{overridePolicy:t=>({enabled:!!(t&&t.length>0),ignoreOrigin:!0})}}})],hn.prototype,"bookmarks",void 0),u([d({type:fUt,json:{read:{source:"mapFloorInfo"},write:{target:"mapFloorInfo"}}})],hn.prototype,"floorInfo",void 0),u([d({type:SUt,json:{write:!0}})],hn.prototype,"geotriggersInfo",void 0),u([d({type:i8,nonNullable:!0,json:{read:{source:["background","initialState.viewpoint","mapRangeInfo","spatialReference"]},write:{ignoreOrigin:!0,target:{background:{type:LB},"initialState.viewpoint":{type:Xn},mapRangeInfo:{type:kce},spatialReference:{type:Je}}}}})],hn.prototype,"initialViewProperties",void 0),u([Me("initialViewProperties")],hn.prototype,"readInitialViewProperties",null),u([De("initialViewProperties")],hn.prototype,"writeInitialViewProperties",null),u([d({json:{read:!1,write:{target:"operationalLayers",ignoreOrigin:!0}}})],hn.prototype,"layers",void 0),u([De("layers")],hn.prototype,"writeLayers",null),u([d({type:r_})],hn.prototype,"portalItem",void 0),u([d({json:{write:!0}})],hn.prototype,"presentation",void 0),u([d()],hn.prototype,"resourceInfo",void 0),u([d({readOnly:!0,type:uL,json:{read:{source:"version"},write:{allowNull:!0,ignoreOrigin:!0,target:"version",isRequired:!0}}})],hn.prototype,"sourceVersion",void 0),u([Me("sourceVersion")],hn.prototype,"readSourceVersion",null),u([De("sourceVersion")],hn.prototype,"writeSourceVersion",null),u([d({json:{read:!1,write:{ignoreOrigin:!0}}})],hn.prototype,"tables",void 0),u([De("tables")],hn.prototype,"writeTables",null),u([d()],hn.prototype,"thumbnailUrl",null),u([d({type:RUt,json:{write:!0}})],hn.prototype,"widgets",void 0),u([d({type:UUt,json:{read:!0,write:!0}})],hn.prototype,"utilityNetworks",void 0),hn=u([$("esri.WebMap")],hn);const GUt=hn;function HUt(){const t=ut.useRef(null),[e,r]=ut.useState(null);ut.useEffect(()=>{i()},[]);async function i(){if(!(t!=null&&t.current))return;const n=new GUt({portalItem:{id:"769b776b17c4406493b5f96044c26696"}}),s=new j$e({container:t==null?void 0:t.current,map:n});r(s)}return Qi("div",{className:"App",children:Qi("div",{id:"view",ref:t})})}function qUt(){return Qi(UBe,{children:JR(LBe,{children:[Qi(_P,{path:"/",element:Qi(jBe,{})}),Qi(_P,{path:"/media-layer-image",element:Qi(Fgt,{})}),Qi(_P,{path:"/media-layer-video",element:Qi(q6t,{})}),Qi(_P,{path:"/media-layer-webmap",element:Qi(HUt,{})})]})})}PRe(window.location.href);const WUt=JW.createRoot(document.getElementById("root"));WUt.render(Qi(hL.StrictMode,{children:Qi(qUt,{})}));export{DLt as $,$t as A,da as B,ft as C,qb as D,Kr as E,zr as F,kt as G,XBe as H,zi as I,Ul as J,$6t as K,it as L,Gz as M,XUt as N,Zn as O,Ge as P,ue as Q,Ce as R,b$e as S,v_ as T,cN as U,Ur as V,H as W,$i as X,xn as Y,pft as Z,cH as _,cA as a,Z1e as a$,qr as a0,ze as a1,Tp as a2,ne as a3,Vt as a4,_e as a5,EN as a6,_6t as a7,ICe as a8,Z4t as a9,Va as aA,Nir as aB,ha as aC,Rct as aD,r_ as aE,ct as aF,U$ as aG,bpt as aH,djt as aI,fjt as aJ,In as aK,cw as aL,zse as aM,fN as aN,fBt as aO,MO as aP,s2e as aQ,ur as aR,eD as aS,Wi as aT,Zr as aU,Foe as aV,ep as aW,Hdt as aX,lw as aY,EDt as aZ,SDt as a_,ei as aa,Hg as ab,u as ac,d as ad,Jl as ae,$ as af,Ghe as ag,be as ah,Q as ai,si as aj,re as ak,V as al,Ee as am,pn as an,Wf as ao,ps as ap,lt as aq,Ai as ar,v$t as as,qe as at,XLe as au,J1 as av,ss as aw,Pi as ax,ba as ay,nle as az,mt as b,IB as b$,Ler as b0,$er as b1,ADt as b2,ODt as b3,RDt as b4,Wc as b5,Ot as b6,CDt as b7,Ier as b8,Per as b9,Gs as bA,m9t as bB,ti as bC,fp as bD,B2e as bE,kie as bF,m0 as bG,G2e as bH,lY as bI,kJ as bJ,AD as bK,Ua as bL,Vr as bM,E8t as bN,a$e as bO,ri as bP,vzt as bQ,joe as bR,Sn as bS,$kt as bT,oa as bU,OO as bV,Iw as bW,ER as bX,Xg as bY,HFe as bZ,Xn as b_,NLt as ba,Kt as bb,Mdt as bc,Rft as bd,Ue as be,S$ as bf,cD as bg,Xt as bh,ym as bi,Ah as bj,n2 as bk,Je as bl,Gne as bm,CCe as bn,kse as bo,qL as bp,Kb as bq,UCe as br,Hi as bs,Yn as bt,Ne as bu,fo as bv,lm as bw,emt as bx,dt as by,vi as bz,rt as c,Snt as c$,le as c0,wn as c1,ke as c2,WFe as c3,XFe as c4,HIe as c5,qd as c6,qIe as c7,wdt as c8,Q7t as c9,gGt as cA,X8t as cB,dN as cC,hN as cD,zBt as cE,VBt as cF,UBt as cG,c3 as cH,oO as cI,gst as cJ,Me as cK,oz as cL,bR as cM,wAe as cN,UO as cO,Fo as cP,yOe as cQ,se as cR,gp as cS,APe as cT,RPe as cU,BBt as cV,Klt as cW,Zlt as cX,tw as cY,yi as cZ,Nt as c_,Idt as ca,Qs as cb,ejt as cc,wO as cd,l3 as ce,R9t as cf,Q0 as cg,UGe as ch,sEt as ci,cWe as cj,eYt as ck,g3e as cl,L9t as cm,kpe as cn,f3e as co,dm as cp,Hz as cq,V9 as cr,$zt as cs,HGe as ct,Bh as cu,cm as cv,Mu as cw,b9 as cx,a3 as cy,O9 as cz,Ft as d,Wb as d$,Unt as d0,KBt as d1,mr as d2,int as d3,jQt as d4,XQt as d5,rer as d6,j1e as d7,B1e as d8,Tnt as d9,Z2e as dA,nne as dB,zGe as dC,DGe as dD,vY as dE,ine as dF,W8t as dG,Z8t as dH,ZPe as dI,QPe as dJ,KPe as dK,yut as dL,Ag as dM,oD as dN,OB as dO,Ane as dP,Cp as dQ,ko as dR,Rne as dS,cHe as dT,ZRt as dU,Fie as dV,cne as dW,GA as dX,g$ as dY,$a as dZ,Ib as d_,TW as da,U9 as db,K9t as dc,Xe as dd,ry as de,$_ as df,Rmt as dg,$4 as dh,v$e as di,GOe as dj,Qet as dk,ett as dl,ULt as dm,kAe as dn,tHt as dp,HL as dq,Kl as dr,Hie as ds,IZe as dt,hm as du,uN as dv,zf as dw,cZ as dx,Ic as dy,p$ as dz,lr as e,FBt as e$,Sde as e0,k9t as e1,eit as e2,Roe as e3,Ont as e4,pBt as e5,Mnt as e6,hBt as e7,pa as e8,Uo as e9,az as eA,cd as eB,f3 as eC,T_ as eD,$r as eE,$N as eF,ql as eG,Lat as eH,Mw as eI,lb as eJ,U2 as eK,y3 as eL,Bt as eM,J$ as eN,Vb as eO,UYt as eP,zYt as eQ,nD as eR,fEt as eS,A_ as eT,am as eU,fYt as eV,dJt as eW,tnt as eX,gM as eY,NBt as eZ,q9 as e_,k2 as ea,dBt as eb,c7t as ec,Put as ed,$lt as ee,Llt as ef,Dlt as eg,uo as eh,tit as ei,b3e as ej,P9t as ek,O9t as el,prt as em,F9t as en,Upe as eo,JUt as ep,KUt as eq,wct as er,gm as es,bir as et,Qrt as eu,v3e as ev,vw as ew,V1e as ex,but as ey,kh as ez,Mp as f,Vzt as f$,bN as f0,kBt as f1,W9 as f2,_N as f3,bPe as f4,Qqe as f5,DBt as f6,Ks as f7,uYt as f8,gZe as f9,jl as fA,St as fB,N5e as fC,ca as fD,za as fE,a8t as fF,__ as fG,Xs as fH,Bf as fI,zo as fJ,me as fK,Fh as fL,i4 as fM,cYt as fN,Ede as fO,iYt as fP,zEt as fQ,H9 as fR,cy as fS,z2 as fT,bIt as fU,kle as fV,iy as fW,PN as fX,Ys as fY,L2 as fZ,G6e as f_,sw as fa,vIt as fb,pCt as fc,hCt as fd,Pie as fe,fmt as ff,zzt as fg,Pp as fh,JS as fi,Tst as fj,ki as fk,Pne as fl,ce as fm,ay as fn,td as fo,AYt as fp,CYt as fq,S_ as fr,NO as fs,Wt as ft,Iu as fu,aa as fv,eQt as fw,Kle as fx,vYt as fy,_Yt as fz,Et as g,HQt as g$,$n as g0,rB as g1,w7t as g2,w_ as g3,pCe as g4,$b as g5,fCe as g6,zIt as g7,ii as g8,ARe as g9,szt as gA,nzt as gB,ozt as gC,UL as gD,Yh as gE,FHe as gF,cr as gG,i2 as gH,ZZ as gI,ns as gJ,YZ as gK,KZ as gL,hz as gM,fZe as gN,c8t as gO,Oi as gP,Bj as gQ,Jhe as gR,J8t as gS,gO as gT,ja as gU,bi as gV,RS as gW,st as gX,qQt as gY,ter as gZ,e$e as g_,Yb as ga,aXe as gb,HC as gc,ZVt as gd,xBt as ge,m3 as gf,KGt as gg,Aw as gh,qc as gi,fe as gj,sO as gk,De as gl,Vhe as gm,e3e as gn,rrt as go,trt as gp,Pw as gq,jyt as gr,azt as gs,mEe as gt,Jr as gu,yst as gv,CBt as gw,rzt as gx,lzt as gy,izt as gz,c6t as h,X_ as h$,XT as h0,aw as h1,ast as h2,Xzt as h3,_a as h4,Ga as h5,ie as h6,bg as h7,fz as h8,Az as h9,dn as hA,QO as hB,x7t as hC,uZ as hD,D2 as hE,f$t as hF,Br as hG,Gu as hH,zc as hI,Hr as hJ,zIe as hK,S as hL,hs as hM,od as hN,Dt as hO,Ie as hP,RV as hQ,by as hR,At as hS,jr as hT,bm as hU,j as hV,Ii as hW,Wr as hX,Gr as hY,Lr as hZ,Ht as h_,wSe as ha,_O as hb,Lb as hc,qzt as hd,PWe as he,em as hf,G9 as hg,nN as hh,Fc as hi,Zzt as hj,Ght as hk,Z7t as hl,kLt as hm,ser as hn,wce as ho,qqt as hp,Zu as hq,us as hr,As as hs,O as ht,Qe as hu,AS as hv,pB as hw,Qr as hx,_n as hy,W2 as hz,E9 as i,Y_ as i$,qB as i0,kw as i1,Xc as i2,_7 as i3,ir as i4,fy as i5,ww as i6,Uw as i7,w7 as i8,Io as i9,Xie as iA,Qae as iB,Voe as iC,Otr as iD,Dtr as iE,Kae as iF,v2 as iG,Lo as iH,Qf as iI,yRt as iJ,ya as iK,Ke as iL,Xi as iM,EBt as iN,Mz as iO,qu as iP,woe as iQ,Pct as iR,Cst as iS,Lnt as iT,soe as iU,xct as iV,s8t as iW,B9 as iX,Wh as iY,vCe as iZ,Gl as i_,ece as ia,v7 as ib,G3 as ic,RAt as id,Pae as ie,z3 as ig,XEt as ih,Hs as ii,MN as ij,kHe as ik,n8t as il,cY as im,Sp as io,Qut as ip,um as iq,$e as ir,YEt as is,tFt as it,JUe as iu,i7e as iv,n7e as iw,JBe as ix,e8t as iy,BB as iz,Bc as j,tge as j$,eUe as j0,PL as j1,YYe as j2,twt as j3,Ltr as j4,Lir as j5,CO as j6,rk as j7,T4e as j8,eh as j9,FL as jA,Cr as jB,Mie as jC,pr as jD,eoe as jE,Pe as jF,F0 as jG,WHt as jH,gi as jI,qtr as jJ,l9t as jK,S8t as jL,_D as jM,Tm as jN,yYt as jO,jDe as jP,Vf as jQ,TEt as jR,_Ft as jS,$tr as jT,bb as jU,Xgt as jV,ga as jW,ve as jX,nl as jY,$g as jZ,Cht as j_,BFt as ja,YPe as jb,Ugt as jc,xVt as jd,wbe as je,ZR as jf,zO as jg,Mn as jh,HYe as ji,Op as jj,CVt as jk,Zt as jl,cs as jm,EVt as jn,ai as jo,g3 as jp,ar as jq,M3e as jr,P3e as js,mYt as jt,tM as ju,ge as jv,yvt as jw,A9 as jx,Uj as jy,ML as jz,he as k,Zb as k$,Zhe as k0,T7t as k1,w$t as k2,cBt as k3,uBt as k4,Z6t as k5,a9t as k6,Y6t as k7,sy as k8,aOe as k9,mn as kA,Fw as kB,FO as kC,Nw as kD,m7 as kE,UXt as kF,cOe as kG,HVt as kH,M9 as kI,C9t as kJ,ZUt as kK,Ba as kL,oce as kM,Wn as kN,oo as kO,p9t as kP,Dse as kQ,Ttt as kR,zSe as kS,x9 as kT,jne as kU,x_ as kV,vO as kW,W6t as kX,nb as kY,Bu as kZ,NCe as k_,lOe as ka,TVt as kb,ELe as kc,hEt as kd,aYt as ke,Nzt as kf,i8t as kg,wer as kh,o3e as ki,lYt as kj,Pu as kk,a3e as kl,uMe as km,uEe as kn,T8t as ko,$it as kp,H9t as kq,Np as kr,bRt as ks,Qh as kt,wi as ku,Th as kv,vl as kw,en as kx,Da as ky,hy as kz,qdt as l,wm as l$,uXe as l0,lmt as l1,Yzt as l2,Ju as l3,Stt as l4,P_e as l5,bCt as l6,czt as l7,QXt as l8,lEe as l9,kb as lA,Rtr as lB,Mtr as lC,kzt as lD,mWe as lE,LT as lF,Ctr as lG,aV as lH,Bzt as lI,VXt as lJ,o4e as lK,Q9 as lL,rn as lM,gD as lN,Kh as lO,JY as lP,_2 as lQ,YB as lR,Qu as lS,W_ as lT,Yr as lU,ul as lV,gCe as lW,Ptr as lX,Itr as lY,Mne as lZ,Ggt as l_,K8t as la,Y8t as lb,CGe as lc,IGe as ld,R9 as le,q8t as lf,A2e as lg,Xje as lh,N9t as li,E9t as lj,y3e as lk,h3e as ll,gB as lm,ey as ln,RN as lo,$rt as lp,oYt as lq,t5e as lr,xi as ls,r6 as lt,j3 as lu,JN as lv,wmt as lw,D9t as lx,xte as ly,u8t as lz,zoe as m,yY as m$,Iir as m0,XKt as m1,XOe as m2,GP as m3,PLe as m4,rV as m5,EF as m6,OR as m7,Fet as m8,vt as m9,mZe as mA,br as mB,mo as mC,vn as mD,xR as mE,TJt as mF,SEe as mG,bzt as mH,Vs as mI,V8t as mJ,z8t as mK,D2e as mL,$2e as mM,yAe as mN,vVt as mO,wVt as mP,bVt as mQ,jh as mR,d2 as mS,La as mT,po as mU,Z_ as mV,lR as mW,cl as mX,_Jt as mY,Ite as mZ,j8t as m_,we as ma,C9 as mb,y_ as mc,NAe as md,xGe as me,YS as mf,PDt as mg,P6 as mh,aU as mi,Q$t as mj,eLt as mk,$Qe as ml,WGt as mm,bZe as mn,wZe as mo,o2 as mp,Nu as mq,SVt as mr,GGt as ms,HGt as mt,uy as mu,NR as mv,Nye as mw,Fg as mx,Pyt as my,JGt as mz,P as n,Azt as n$,cB as n0,qVt as n1,WVt as n2,XVt as n3,YVt as n4,sl as n5,Poe as n6,lD as n7,nCe as n8,fs as n9,B8t as nA,U8t as nB,k8t as nC,rd as nD,hS as nE,yEt as nF,bne as nG,Zme as nH,Xqt as nI,Yme as nJ,Kne as nK,Hl as nL,Rp as nM,J9 as nN,QCt as nO,dl as nP,WB as nQ,vm as nR,Do as nS,s$t as nT,YUt as nU,DS as nV,L_t as nW,pqt as nX,hqt as nY,dqt as nZ,VGt as n_,Ye as na,On as nb,qGt as nc,syt as nd,W1 as ne,LIe as nf,IIe as ng,$c as nh,Xb as ni,F9 as nj,Sne as nk,g_ as nl,idt as nm,Ss as nn,OIe as no,L_ as np,hae as nq,UN as nr,Ri as ns,V$ as nt,kB as nu,$Le as nv,YGt as nw,XGt as nx,yS as ny,udt as nz,Sft as o,Dle as o$,PV as o0,l5e as o1,Hqt as o2,Ioe as o3,hI as o4,TR as o5,ZY as o6,yl as o7,aO as o8,Nie as o9,wt as oA,Ui as oB,Uzt as oC,cae as oD,Ove as oE,e1e as oF,aD as oG,Cw as oH,Jd as oI,xY as oJ,FGt as oK,Y1 as oL,sd as oM,R7 as oN,Hc as oO,_l as oP,qh as oQ,Os as oR,g4e as oS,UGt as oT,ESt as oU,nd as oV,Bgt as oW,R4e as oX,JO as oY,fO as oZ,Yee as o_,B7t as oa,lN as ob,zOt as oc,tAt as od,T2 as oe,Wg as of,Pt as og,zie as oh,hYt as oi,Og as oj,rFe as ok,j2 as ol,uae as om,Ezt as on,BGt as oo,Dzt as op,_y as oq,ase as or,GAe as os,mm as ot,YO as ou,Jt as ov,Fa as ow,b7 as ox,h4e as oy,x4e as oz,Uoe as p,lWt as p$,wzt as p0,qBe as p1,jGt as p2,H7 as p3,Kz as p4,wAt as p5,kir as p6,zir as p7,Uir as p8,yN as p9,cct as pA,IN as pB,CLt as pC,ELt as pD,E3 as pE,Rst as pF,t8t as pG,O8t as pH,Wje as pI,tBt as pJ,ynt as pK,gHe as pL,EHe as pM,Olt as pN,Mlt as pO,Plt as pP,mp as pQ,d4t as pR,p4t as pS,s4t as pT,Yrr as pU,ZV as pV,srr as pW,m4t as pX,HN as pY,cV as pZ,t0e as p_,dz as pa,Lzt as pb,$x as pc,Xme as pd,sg as pe,dD as pf,pae as pg,TO as ph,Czt as pi,_xt as pj,fae as pk,SAe as pl,xO as pm,xLe as pn,k_ as po,Eyt as pp,C_ as pq,zB as pr,V1t as ps,kGt as pt,kye as pu,Wqt as pv,G2 as pw,VYe as px,pst as py,OPe as pz,Rr as q,vse as q$,WYe as q0,ml as q1,KN as q2,rse as q3,id as q4,L7 as q5,PAe as q6,Dp as q7,kO as q8,CJt as q9,Lrt as qA,$9t as qB,pYe as qC,sBt as qD,dG as qE,pG as qF,g9t as qG,QUt as qH,eft as qI,gWe as qJ,M9t as qK,i3e as qL,Ki as qM,iJ as qN,Rit as qO,Oit as qP,Ygt as qQ,Xf as qR,zGt as qS,ryt as qT,h8t as qU,JWe as qV,Vne as qW,Y7e as qX,eer as qY,Ru as qZ,Nc as q_,bw as qa,SJt as qb,AJt as qc,EJt as qd,t3t as qe,s3t as qf,r3t as qg,i3t as qh,n3t as qi,T9t as qj,b9t as qk,_9t as ql,I9t as qm,x9t as qn,Fse as qo,A9t as qp,hzt as qq,dzt as qr,uzt as qs,qqe as qt,nYt as qu,tYt as qv,Vu as qw,Mrt as qx,Srt as qy,Rpe as qz,v as r,NQe as r$,bse as r0,nae as r1,_s as r2,kVt as r3,iQe as r4,tQe as r5,LVt as r6,DVt as r7,NVt as r8,dLe as r9,$f as rA,Brt as rB,w9t as rC,X6t as rD,uB as rE,iE as rF,voe as rG,WBe as rH,HBt as rI,ih as rJ,ape as rK,oUt as rL,K6t as rM,rXe as rN,W9t as rO,bO as rP,x$ as rQ,NZ as rR,VVt as rS,zVt as rT,rne as rU,RCe as rV,mb as rW,yUe as rX,ZDt as rY,SBt as rZ,noe as r_,hLe as ra,MVt as rb,VKe as rc,hQe as rd,pgt as re,ogt as rf,fgt as rg,dgt as rh,Hmt as ri,qmt as rj,lgt as rk,mgt as rl,Wmt as rm,PVt as rn,UVt as ro,sQe as rp,gse as rq,IGt as rr,jVt as rs,IVt as rt,Fmt as ru,nQe as rv,v3 as rw,wgt as rx,est as ry,ma as rz,d6t as s,a5t as s$,Imt as s0,DGt as s1,sae as s2,$Gt as s3,LGt as s4,aLe as s5,FVt as s6,rLe as s7,OGt as s8,zmt as s9,ZFt as sA,$ce as sB,h8e as sC,w4t as sD,f8e as sE,T4t as sF,y8e as sG,E4t as sH,b8e as sI,A4t as sJ,DF as sK,Vj as sL,xWe as sM,kDe as sN,A_t as sO,qA as sP,ARt as sQ,IRt as sR,eRt as sS,nRt as sT,ice as sU,_Dt as sV,yDt as sW,U7 as sX,vDt as sY,$V as sZ,rAt as s_,MGt as sa,Vmt as sb,$Vt as sc,PGt as sd,sLe as se,BVt as sf,j$ as sg,P0t as sh,y_t as si,DDe as sj,LDe as sk,S_t as sl,Nae as sm,nvt as sn,nNe as so,Uae as sp,cvt as sq,Zvt as sr,m1t as ss,_2t as st,OV as su,iCt as sv,$le as sw,LSt as sx,O2 as sy,SNt as sz,wir as t,G8t as t$,C8e as t0,u5t as t1,O8e as t2,d5t as t3,I8e as t4,G7 as t5,C5t as t6,D5t as t7,q5t as t8,X5t as t9,nct as tA,fst as tB,ect as tC,_st as tD,vct as tE,Bhe as tF,fEe as tG,ooe as tH,CB as tI,mme as tJ,Ost as tK,UK as tL,bB as tM,Ast as tN,boe as tO,kPe as tP,Ku as tQ,Lp as tR,X9 as tS,wht as tT,bht as tU,_ht as tV,sQ as tW,Zl as tX,vB as tY,pGe as tZ,dGe as t_,Z5t as ta,kAt as tb,$8e as tc,O5t as td,pkt as te,kOt as tf,c3t as tg,TPt as th,GPt as ti,kPt as tj,hMe as tk,DPe as tl,yct as tm,Kd as tn,sCe as to,nst as tp,Ooe as tq,ABt as tr,Mst as ts,Ist as tt,lst as tu,ioe as tv,ust as tw,hst as tx,Jb as ty,pZe as tz,gN as u,r7e as u$,hG as u0,O7e as u1,Act as u2,x3 as u3,Yse as u4,A3e as u5,ktt as u6,Xit as u7,Utt as u8,I3e as u9,Nb as uA,ome as uB,GL as uC,Lst as uD,$st as uE,Ew as uF,Z9 as uG,Nse as uH,Zat as uI,Jnt as uJ,N_ as uK,mlt as uL,Qat as uM,elt as uN,kat as uO,Uat as uP,zat as uQ,Vat as uR,Bat as uS,jat as uT,Gat as uU,Hat as uV,qat as uW,Wat as uX,Xat as uY,Yat as uZ,FPe as u_,k3e as ua,Oz as ub,T3e as uc,I$ as ud,cst as ue,bs as uf,o8t as ug,r2 as uh,Fzt as ui,$O as uj,C2 as uk,_Pe as ul,Uie as um,PC as un,_J as uo,rlt as up,z8 as uq,uQ as ur,dZ as us,ly as ut,ty as uu,DEe as uv,PCe as uw,ahe as ux,iD as uy,mst as uz,R as v,bte as v$,tm as v0,Gzt as v1,rz as v2,FCe as v3,cqe as v4,K8 as v5,N9 as v6,Pst as v7,TBt as v8,Hzt as v9,U1t as vA,zgt as vB,kgt as vC,Lg as vD,Jke as vE,zS as vF,O1t as vG,Wzt as vH,c6e as vI,h6e as vJ,rS as vK,rL as vL,xzt as vM,Wle as vN,M3t as vO,n6e as vP,S3t as vQ,l6e as vR,o6e as vS,O3t as vT,Yu as vU,Dte as vV,gl as vW,a6e as vX,jN as vY,E3t as vZ,bD as v_,jje as va,Rhe as vb,k as vc,F8t as vd,eBt as ve,NLe as vf,wyt as vg,el as vh,Aht as vi,kz as vj,Tkt as vk,Q9t as vl,kne as vm,e3t as vn,_d as vo,aWt as vp,oWt as vq,BYt as vr,t3e as vs,RO as vt,Jzt as vu,IQe as vv,ZF as vw,UJ as vx,CPe as vy,rE as vz,va as w,QB as w0,vCt as w1,eMt as w2,Q3t as w3,K3t as w4,q_ as w5,jqt as w6,HE as w7,IXe as w8,U9t as w9,Kse as wa,Z9t as wb,e7t as wc,TGt as wd,dYt as we,VJt as wf,Jn as x,XS as y,Ct as z};
