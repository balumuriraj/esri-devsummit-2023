import{a as q}from"./mathUtils-b4bb77e2.js";import{r as v}from"./typedArrayUtil-4d7bb04c.js";import{P as f,_ as x,g as X,e as g,u as O,r as z,F as h,z as d}from"./vec3-e93e648f.js";import{n as E}from"./vec3f64-2f9cef06.js";import{r as j,c as M}from"./sphere-2af0d852.js";function V(r=s){return[r[0],r[1],r[2],r[3]]}function Q(r=s[0],t=s[1],n=s[2],e=s[3]){return l(r,t,n,e,j.get())}function k(r,t){return l(t[0],t[1],t[2],t[3],r)}function l(r,t,n,e,u=V()){return u[0]=r,u[1]=t,u[2]=n,u[3]=e,u}function S(r,t,n){return z(n,r),n[3]=t,n}function D(r,t,n){const e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],u=Math.abs(e-1)>1e-5&&e>1e-12?1/Math.sqrt(e):1;return n[0]=t[0]*u,n[1]=t[1]*u,n[2]=t[2]*u,n[3]=-(n[0]*r[0]+n[1]*r[1]+n[2]*r[2]),n}function G(r,t,n,e=V()){const u=n[0]-t[0],o=n[1]-t[1],c=n[2]-t[2],C=r[0]-t[0],L=r[1]-t[1],b=r[2]-t[2],$=o*b-c*L,A=c*C-u*b,T=u*L-o*C,p=$*$+A*A+T*T,P=Math.abs(p-1)>1e-5&&p>1e-12?1/Math.sqrt(p):1;return e[0]=$*P,e[1]=A*P,e[2]=T*P,e[3]=-(e[0]*r[0]+e[1]*r[1]+e[2]*r[2]),e}function H(r,t,n,e,u){if(r.count<3)return!1;r.getVec(n,a);let o=e,c=!1;for(;o<r.count-1&&!c;)r.getVec(o,N),o++,c=!h(a,N);if(!c)return!1;for(o=Math.max(o,u),c=!1;o<r.count&&!c;)r.getVec(o,I),o++,g(m,a,N),d(m,m),g(F,N,I),d(F,F),c=!h(a,I)&&!h(N,I)&&Math.abs(f(m,F))<K;return c?(G(a,N,I,t),!0):(n!==0||e!==1||u!==2)&&H(r,t,0,1,2)}const K=.99619469809,a=E(),N=E(),I=E(),m=E(),F=E();function rr(r,t,n){return t!==r&&k(r,t),r[3]=-f(r,n),r}function tr(r,t){return t[0]=-r[0],t[1]=-r[1],t[2]=-r[2],t[3]=-r[3],t}function nr(r,t,n,e){return x(I,t,r),D(n,I,e)}function er(r,t,n,e){return _(r,t,g(M.get(),n,t),U,e)}function ur(r,t,n){return!!v(t)&&_(r,t.origin,t.direction,W,n)}function cr(r,t,n){return _(r,t.origin,t.vector,i.NONE,n)}function or(r,t,n){return _(r,t.origin,t.vector,i.CLAMP,n)}function ir(r,t){return y(r,t)>=0}function fr(r,t){const n=f(r,t.ray.direction),e=-y(r,t.ray.origin);if(e<0&&n>=0)return!1;if(n>-1e-6&&n<1e-6)return e>0;if((e<0||n<0)&&!(e<0&&n<0))return!0;const u=e/n;return n>0?u<t.c1&&(t.c1=u):u>t.c0&&(t.c0=u),t.c0<=t.c1}function Ir(r,t){const n=f(r,t.ray.direction),e=-y(r,t.ray.origin);if(n>-1e-6&&n<1e-6)return e>0;const u=e/n;return n>0?u<t.c1&&(t.c1=u):u>t.c0&&(t.c0=u),t.c0<=t.c1}function Nr(r,t,n){const e=X(M.get(),r,-r[3]),u=R(r,g(M.get(),t,e),M.get());return O(n,u,e),n}function R(r,t,n){const e=X(M.get(),r,f(r,t));return g(n,t,e),n}function y(r,t){return f(r,t)+r[3]}function _(r,t,n,e,u){const o=f(r,n);if(o===0)return!1;let c=-(f(r,t)+r[3])/o;return e&i.CLAMP&&(c=q(c,0,1)),!(!(e&i.INFINITE_MIN)&&c<0||!(e&i.INFINITE_MAX)&&c>1)&&(O(u,t,X(u,n,c)),!0)}function ar(r){return r}const s=[0,0,1,0];var i;(function(r){r[r.NONE=0]="NONE",r[r.CLAMP=1]="CLAMP",r[r.INFINITE_MIN=4]="INFINITE_MIN",r[r.INFINITE_MAX=8]="INFINITE_MAX"})(i||(i={}));const U=i.INFINITE_MIN|i.INFINITE_MAX,W=i.INFINITE_MAX;export{k as A,fr as D,Q as E,l as F,Ir as G,Nr as H,R as K,rr as L,nr as O,tr as P,y as R,S as T,or as U,er as V,ar as Y,D as _,H as b,G as j,V as p,ur as q,cr as x,ir as z};
