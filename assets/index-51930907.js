function gVe(t,e){for(var i=0;i<e.length;i++){const r=e[i];if(typeof r!="string"&&!Array.isArray(r)){for(const n in r)if(n!=="default"&&!(n in t)){const s=Object.getOwnPropertyDescriptor(r,n);s&&Object.defineProperty(t,n,s.get?s:{enumerable:!0,get:()=>r[n]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}})();var Zce=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function yVe(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var u8={},_Ve={get exports(){return u8},set exports(t){u8=t}},l9={},ut={},vVe={get exports(){return ut},set exports(t){ut=t}},dr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tN=Symbol.for("react.element"),bVe=Symbol.for("react.portal"),wVe=Symbol.for("react.fragment"),xVe=Symbol.for("react.strict_mode"),TVe=Symbol.for("react.profiler"),SVe=Symbol.for("react.provider"),EVe=Symbol.for("react.context"),CVe=Symbol.for("react.forward_ref"),AVe=Symbol.for("react.suspense"),RVe=Symbol.for("react.memo"),MVe=Symbol.for("react.lazy"),Jce=Symbol.iterator;function OVe(t){return t===null||typeof t!="object"?null:(t=Jce&&t[Jce]||t["@@iterator"],typeof t=="function"?t:null)}var pxe={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},fxe=Object.assign,mxe={};function lO(t,e,i){this.props=t,this.context=e,this.refs=mxe,this.updater=i||pxe}lO.prototype.isReactComponent={};lO.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};lO.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function gxe(){}gxe.prototype=lO.prototype;function zie(t,e,i){this.props=t,this.context=e,this.refs=mxe,this.updater=i||pxe}var Bie=zie.prototype=new gxe;Bie.constructor=zie;fxe(Bie,lO.prototype);Bie.isPureReactComponent=!0;var Kce=Array.isArray,yxe=Object.prototype.hasOwnProperty,jie={current:null},_xe={key:!0,ref:!0,__self:!0,__source:!0};function vxe(t,e,i){var r,n={},s=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)yxe.call(e,r)&&!_xe.hasOwnProperty(r)&&(n[r]=e[r]);var a=arguments.length-2;if(a===1)n.children=i;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];n.children=l}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)n[r]===void 0&&(n[r]=a[r]);return{$$typeof:tN,type:t,key:s,ref:o,props:n,_owner:jie.current}}function PVe(t,e){return{$$typeof:tN,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Gie(t){return typeof t=="object"&&t!==null&&t.$$typeof===tN}function IVe(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(i){return e[i]})}var Qce=/\/+/g;function ej(t,e){return typeof t=="object"&&t!==null&&t.key!=null?IVe(""+t.key):e.toString(36)}function Hk(t,e,i,r,n){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case tN:case bVe:o=!0}}if(o)return o=t,n=n(o),t=r===""?"."+ej(o,0):r,Kce(n)?(i="",t!=null&&(i=t.replace(Qce,"$&/")+"/"),Hk(n,e,i,"",function(c){return c})):n!=null&&(Gie(n)&&(n=PVe(n,i+(!n.key||o&&o.key===n.key?"":(""+n.key).replace(Qce,"$&/")+"/")+t)),e.push(n)),1;if(o=0,r=r===""?".":r+":",Kce(t))for(var a=0;a<t.length;a++){s=t[a];var l=r+ej(s,a);o+=Hk(s,e,i,l,n)}else if(l=OVe(t),typeof l=="function")for(t=l.call(t),a=0;!(s=t.next()).done;)s=s.value,l=r+ej(s,a++),o+=Hk(s,e,i,l,n);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function pF(t,e,i){if(t==null)return t;var r=[],n=0;return Hk(t,r,"","",function(s){return e.call(i,s,n++)}),r}function $Ve(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(i){(t._status===0||t._status===-1)&&(t._status=1,t._result=i)},function(i){(t._status===0||t._status===-1)&&(t._status=2,t._result=i)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Qc={current:null},qk={transition:null},LVe={ReactCurrentDispatcher:Qc,ReactCurrentBatchConfig:qk,ReactCurrentOwner:jie};dr.Children={map:pF,forEach:function(t,e,i){pF(t,function(){e.apply(this,arguments)},i)},count:function(t){var e=0;return pF(t,function(){e++}),e},toArray:function(t){return pF(t,function(e){return e})||[]},only:function(t){if(!Gie(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};dr.Component=lO;dr.Fragment=wVe;dr.Profiler=TVe;dr.PureComponent=zie;dr.StrictMode=xVe;dr.Suspense=AVe;dr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=LVe;dr.cloneElement=function(t,e,i){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=fxe({},t.props),n=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=jie.current),e.key!==void 0&&(n=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)yxe.call(e,l)&&!_xe.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=i;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];r.children=a}return{$$typeof:tN,type:t.type,key:n,ref:s,props:r,_owner:o}};dr.createContext=function(t){return t={$$typeof:EVe,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:SVe,_context:t},t.Consumer=t};dr.createElement=vxe;dr.createFactory=function(t){var e=vxe.bind(null,t);return e.type=t,e};dr.createRef=function(){return{current:null}};dr.forwardRef=function(t){return{$$typeof:CVe,render:t}};dr.isValidElement=Gie;dr.lazy=function(t){return{$$typeof:MVe,_payload:{_status:-1,_result:t},_init:$Ve}};dr.memo=function(t,e){return{$$typeof:RVe,type:t,compare:e===void 0?null:e}};dr.startTransition=function(t){var e=qk.transition;qk.transition={};try{t()}finally{qk.transition=e}};dr.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};dr.useCallback=function(t,e){return Qc.current.useCallback(t,e)};dr.useContext=function(t){return Qc.current.useContext(t)};dr.useDebugValue=function(){};dr.useDeferredValue=function(t){return Qc.current.useDeferredValue(t)};dr.useEffect=function(t,e){return Qc.current.useEffect(t,e)};dr.useId=function(){return Qc.current.useId()};dr.useImperativeHandle=function(t,e,i){return Qc.current.useImperativeHandle(t,e,i)};dr.useInsertionEffect=function(t,e){return Qc.current.useInsertionEffect(t,e)};dr.useLayoutEffect=function(t,e){return Qc.current.useLayoutEffect(t,e)};dr.useMemo=function(t,e){return Qc.current.useMemo(t,e)};dr.useReducer=function(t,e,i){return Qc.current.useReducer(t,e,i)};dr.useRef=function(t){return Qc.current.useRef(t)};dr.useState=function(t){return Qc.current.useState(t)};dr.useSyncExternalStore=function(t,e,i){return Qc.current.useSyncExternalStore(t,e,i)};dr.useTransition=function(){return Qc.current.useTransition()};dr.version="18.2.0";(function(t){t.exports=dr})(vVe);const gL=yVe(ut),iX=gVe({__proto__:null,default:gL},[ut]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var DVe=ut,NVe=Symbol.for("react.element"),FVe=Symbol.for("react.fragment"),kVe=Object.prototype.hasOwnProperty,UVe=DVe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,VVe={key:!0,ref:!0,__self:!0,__source:!0};function bxe(t,e,i){var r,n={},s=null,o=null;i!==void 0&&(s=""+i),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)kVe.call(e,r)&&!VVe.hasOwnProperty(r)&&(n[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)n[r]===void 0&&(n[r]=e[r]);return{$$typeof:NVe,type:t,key:s,ref:o,props:n,_owner:UVe.current}}l9.Fragment=FVe;l9.jsx=bxe;l9.jsxs=bxe;(function(t){t.exports=l9})(_Ve);const Cr=u8.jsx,MS=u8.jsxs;var rX={},nX={},zVe={get exports(){return nX},set exports(t){nX=t}},dd={},sX={},BVe={get exports(){return sX},set exports(t){sX=t}},wxe={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(L,F){var G=L.length;L.push(F);e:for(;0<G;){var W=G-1>>>1,Z=L[W];if(0<n(Z,F))L[W]=F,L[G]=Z,G=W;else break e}}function i(L){return L.length===0?null:L[0]}function r(L){if(L.length===0)return null;var F=L[0],G=L.pop();if(G!==F){L[0]=G;e:for(var W=0,Z=L.length,X=Z>>>1;W<X;){var oe=2*(W+1)-1,pe=L[oe],ye=oe+1,Se=L[ye];if(0>n(pe,G))ye<Z&&0>n(Se,pe)?(L[W]=Se,L[ye]=G,W=ye):(L[W]=pe,L[oe]=G,W=oe);else if(ye<Z&&0>n(Se,G))L[W]=Se,L[ye]=G,W=ye;else break e}}return F}function n(L,F){var G=L.sortIndex-F.sortIndex;return G!==0?G:L.id-F.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],c=[],h=1,p=null,f=3,m=!1,g=!1,_=!1,b=typeof setTimeout=="function"?setTimeout:null,w=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function T(L){for(var F=i(c);F!==null;){if(F.callback===null)r(c);else if(F.startTime<=L)r(c),F.sortIndex=F.expirationTime,e(l,F);else break;F=i(c)}}function E(L){if(_=!1,T(L),!g)if(i(l)!==null)g=!0,q(C);else{var F=i(c);F!==null&&N(E,F.startTime-L)}}function C(L,F){g=!1,_&&(_=!1,w(O),O=-1),m=!0;var G=f;try{for(T(F),p=i(l);p!==null&&(!(p.expirationTime>F)||L&&!V());){var W=p.callback;if(typeof W=="function"){p.callback=null,f=p.priorityLevel;var Z=W(p.expirationTime<=F);F=t.unstable_now(),typeof Z=="function"?p.callback=Z:p===i(l)&&r(l),T(F)}else r(l);p=i(l)}if(p!==null)var X=!0;else{var oe=i(c);oe!==null&&N(E,oe.startTime-F),X=!1}return X}finally{p=null,f=G,m=!1}}var A=!1,I=null,O=-1,D=5,U=-1;function V(){return!(t.unstable_now()-U<D)}function B(){if(I!==null){var L=t.unstable_now();U=L;var F=!0;try{F=I(!0,L)}finally{F?ee():(A=!1,I=null)}}else A=!1}var ee;if(typeof x=="function")ee=function(){x(B)};else if(typeof MessageChannel<"u"){var ie=new MessageChannel,J=ie.port2;ie.port1.onmessage=B,ee=function(){J.postMessage(null)}}else ee=function(){b(B,0)};function q(L){I=L,A||(A=!0,ee())}function N(L,F){O=b(function(){L(t.unstable_now())},F)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(L){L.callback=null},t.unstable_continueExecution=function(){g||m||(g=!0,q(C))},t.unstable_forceFrameRate=function(L){0>L||125<L?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<L?Math.floor(1e3/L):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return i(l)},t.unstable_next=function(L){switch(f){case 1:case 2:case 3:var F=3;break;default:F=f}var G=f;f=F;try{return L()}finally{f=G}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(L,F){switch(L){case 1:case 2:case 3:case 4:case 5:break;default:L=3}var G=f;f=L;try{return F()}finally{f=G}},t.unstable_scheduleCallback=function(L,F,G){var W=t.unstable_now();switch(typeof G=="object"&&G!==null?(G=G.delay,G=typeof G=="number"&&0<G?W+G:W):G=W,L){case 1:var Z=-1;break;case 2:Z=250;break;case 5:Z=1073741823;break;case 4:Z=1e4;break;default:Z=5e3}return Z=G+Z,L={id:h++,callback:F,priorityLevel:L,startTime:G,expirationTime:Z,sortIndex:-1},G>W?(L.sortIndex=G,e(c,L),i(l)===null&&L===i(c)&&(_?(w(O),O=-1):_=!0,N(E,G-W))):(L.sortIndex=Z,e(l,L),g||m||(g=!0,q(C))),L},t.unstable_shouldYield=V,t.unstable_wrapCallback=function(L){var F=f;return function(){var G=f;f=F;try{return L.apply(this,arguments)}finally{f=G}}}})(wxe);(function(t){t.exports=wxe})(BVe);/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xxe=ut,sd=sX;function je(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,i=1;i<arguments.length;i++)e+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Txe=new Set,yL={};function F2(t,e){rM(t,e),rM(t+"Capture",e)}function rM(t,e){for(yL[t]=e,t=0;t<e.length;t++)Txe.add(e[t])}var __=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),oX=Object.prototype.hasOwnProperty,jVe=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,eue={},tue={};function GVe(t){return oX.call(tue,t)?!0:oX.call(eue,t)?!1:jVe.test(t)?tue[t]=!0:(eue[t]=!0,!1)}function HVe(t,e,i,r){if(i!==null&&i.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:i!==null?!i.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function qVe(t,e,i,r){if(e===null||typeof e>"u"||HVe(t,e,i,r))return!0;if(r)return!1;if(i!==null)switch(i.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function eu(t,e,i,r,n,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=n,this.mustUseProperty=i,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var fl={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){fl[t]=new eu(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];fl[e]=new eu(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){fl[t]=new eu(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){fl[t]=new eu(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){fl[t]=new eu(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){fl[t]=new eu(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){fl[t]=new eu(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){fl[t]=new eu(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){fl[t]=new eu(t,5,!1,t.toLowerCase(),null,!1,!1)});var Hie=/[\-:]([a-z])/g;function qie(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Hie,qie);fl[e]=new eu(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Hie,qie);fl[e]=new eu(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Hie,qie);fl[e]=new eu(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){fl[t]=new eu(t,1,!1,t.toLowerCase(),null,!1,!1)});fl.xlinkHref=new eu("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){fl[t]=new eu(t,1,!1,t.toLowerCase(),null,!0,!0)});function Wie(t,e,i,r){var n=fl.hasOwnProperty(e)?fl[e]:null;(n!==null?n.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(qVe(e,i,n,r)&&(i=null),r||n===null?GVe(e)&&(i===null?t.removeAttribute(e):t.setAttribute(e,""+i)):n.mustUseProperty?t[n.propertyName]=i===null?n.type===3?!1:"":i:(e=n.attributeName,r=n.attributeNamespace,i===null?t.removeAttribute(e):(n=n.type,i=n===3||n===4&&i===!0?"":""+i,r?t.setAttributeNS(r,e,i):t.setAttribute(e,i))))}var k_=xxe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,fF=Symbol.for("react.element"),kA=Symbol.for("react.portal"),UA=Symbol.for("react.fragment"),Xie=Symbol.for("react.strict_mode"),aX=Symbol.for("react.profiler"),Sxe=Symbol.for("react.provider"),Exe=Symbol.for("react.context"),Yie=Symbol.for("react.forward_ref"),lX=Symbol.for("react.suspense"),cX=Symbol.for("react.suspense_list"),Zie=Symbol.for("react.memo"),D1=Symbol.for("react.lazy"),Cxe=Symbol.for("react.offscreen"),iue=Symbol.iterator;function KO(t){return t===null||typeof t!="object"?null:(t=iue&&t[iue]||t["@@iterator"],typeof t=="function"?t:null)}var Ps=Object.assign,tj;function vP(t){if(tj===void 0)try{throw Error()}catch(i){var e=i.stack.trim().match(/\n( *(at )?)/);tj=e&&e[1]||""}return`
`+tj+t}var ij=!1;function rj(t,e){if(!t||ij)return"";ij=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var r=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){r=c}t.call(e.prototype)}else{try{throw Error()}catch(c){r=c}t()}}catch(c){if(c&&r&&typeof c.stack=="string"){for(var n=c.stack.split(`
`),s=r.stack.split(`
`),o=n.length-1,a=s.length-1;1<=o&&0<=a&&n[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(n[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||n[o]!==s[a]){var l=`
`+n[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{ij=!1,Error.prepareStackTrace=i}return(t=t?t.displayName||t.name:"")?vP(t):""}function WVe(t){switch(t.tag){case 5:return vP(t.type);case 16:return vP("Lazy");case 13:return vP("Suspense");case 19:return vP("SuspenseList");case 0:case 2:case 15:return t=rj(t.type,!1),t;case 11:return t=rj(t.type.render,!1),t;case 1:return t=rj(t.type,!0),t;default:return""}}function uX(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case UA:return"Fragment";case kA:return"Portal";case aX:return"Profiler";case Xie:return"StrictMode";case lX:return"Suspense";case cX:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Exe:return(t.displayName||"Context")+".Consumer";case Sxe:return(t._context.displayName||"Context")+".Provider";case Yie:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Zie:return e=t.displayName||null,e!==null?e:uX(t.type)||"Memo";case D1:e=t._payload,t=t._init;try{return uX(t(e))}catch{}}return null}function XVe(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return uX(e);case 8:return e===Xie?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Yb(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Axe(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function YVe(t){var e=Axe(t)?"checked":"value",i=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var n=i.get,s=i.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return n.call(this)},set:function(o){r=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:i.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function mF(t){t._valueTracker||(t._valueTracker=YVe(t))}function Rxe(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var i=e.getValue(),r="";return t&&(r=Axe(t)?t.checked?"true":"false":t.value),t=r,t!==i?(e.setValue(t),!0):!1}function h8(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function hX(t,e){var i=e.checked;return Ps({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:i??t._wrapperState.initialChecked})}function rue(t,e){var i=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;i=Yb(e.value!=null?e.value:i),t._wrapperState={initialChecked:r,initialValue:i,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Mxe(t,e){e=e.checked,e!=null&&Wie(t,"checked",e,!1)}function dX(t,e){Mxe(t,e);var i=Yb(e.value),r=e.type;if(i!=null)r==="number"?(i===0&&t.value===""||t.value!=i)&&(t.value=""+i):t.value!==""+i&&(t.value=""+i);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?pX(t,e.type,i):e.hasOwnProperty("defaultValue")&&pX(t,e.type,Yb(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function nue(t,e,i){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,i||e===t.value||(t.value=e),t.defaultValue=e}i=t.name,i!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,i!==""&&(t.name=i)}function pX(t,e,i){(e!=="number"||h8(t.ownerDocument)!==t)&&(i==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+i&&(t.defaultValue=""+i))}var bP=Array.isArray;function vR(t,e,i,r){if(t=t.options,e){e={};for(var n=0;n<i.length;n++)e["$"+i[n]]=!0;for(i=0;i<t.length;i++)n=e.hasOwnProperty("$"+t[i].value),t[i].selected!==n&&(t[i].selected=n),n&&r&&(t[i].defaultSelected=!0)}else{for(i=""+Yb(i),e=null,n=0;n<t.length;n++){if(t[n].value===i){t[n].selected=!0,r&&(t[n].defaultSelected=!0);return}e!==null||t[n].disabled||(e=t[n])}e!==null&&(e.selected=!0)}}function fX(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(je(91));return Ps({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function sue(t,e){var i=e.value;if(i==null){if(i=e.children,e=e.defaultValue,i!=null){if(e!=null)throw Error(je(92));if(bP(i)){if(1<i.length)throw Error(je(93));i=i[0]}e=i}e==null&&(e=""),i=e}t._wrapperState={initialValue:Yb(i)}}function Oxe(t,e){var i=Yb(e.value),r=Yb(e.defaultValue);i!=null&&(i=""+i,i!==t.value&&(t.value=i),e.defaultValue==null&&t.defaultValue!==i&&(t.defaultValue=i)),r!=null&&(t.defaultValue=""+r)}function oue(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function Pxe(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function mX(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?Pxe(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var gF,Ixe=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,i,r,n){MSApp.execUnsafeLocalFunction(function(){return t(e,i,r,n)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(gF=gF||document.createElement("div"),gF.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=gF.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function _L(t,e){if(e){var i=t.firstChild;if(i&&i===t.lastChild&&i.nodeType===3){i.nodeValue=e;return}}t.textContent=e}var c$={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ZVe=["Webkit","ms","Moz","O"];Object.keys(c$).forEach(function(t){ZVe.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),c$[e]=c$[t]})});function $xe(t,e,i){return e==null||typeof e=="boolean"||e===""?"":i||typeof e!="number"||e===0||c$.hasOwnProperty(t)&&c$[t]?(""+e).trim():e+"px"}function Lxe(t,e){t=t.style;for(var i in e)if(e.hasOwnProperty(i)){var r=i.indexOf("--")===0,n=$xe(i,e[i],r);i==="float"&&(i="cssFloat"),r?t.setProperty(i,n):t[i]=n}}var JVe=Ps({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function gX(t,e){if(e){if(JVe[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(je(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(je(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(je(61))}if(e.style!=null&&typeof e.style!="object")throw Error(je(62))}}function yX(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var _X=null;function Jie(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var vX=null,bR=null,wR=null;function aue(t){if(t=nN(t)){if(typeof vX!="function")throw Error(je(280));var e=t.stateNode;e&&(e=p9(e),vX(t.stateNode,t.type,e))}}function Dxe(t){bR?wR?wR.push(t):wR=[t]:bR=t}function Nxe(){if(bR){var t=bR,e=wR;if(wR=bR=null,aue(t),e)for(t=0;t<e.length;t++)aue(e[t])}}function Fxe(t,e){return t(e)}function kxe(){}var nj=!1;function Uxe(t,e,i){if(nj)return t(e,i);nj=!0;try{return Fxe(t,e,i)}finally{nj=!1,(bR!==null||wR!==null)&&(kxe(),Nxe())}}function vL(t,e){var i=t.stateNode;if(i===null)return null;var r=p9(i);if(r===null)return null;i=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(i&&typeof i!="function")throw Error(je(231,e,typeof i));return i}var bX=!1;if(__)try{var QO={};Object.defineProperty(QO,"passive",{get:function(){bX=!0}}),window.addEventListener("test",QO,QO),window.removeEventListener("test",QO,QO)}catch{bX=!1}function KVe(t,e,i,r,n,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(i,c)}catch(h){this.onError(h)}}var u$=!1,d8=null,p8=!1,wX=null,QVe={onError:function(t){u$=!0,d8=t}};function eze(t,e,i,r,n,s,o,a,l){u$=!1,d8=null,KVe.apply(QVe,arguments)}function tze(t,e,i,r,n,s,o,a,l){if(eze.apply(this,arguments),u$){if(u$){var c=d8;u$=!1,d8=null}else throw Error(je(198));p8||(p8=!0,wX=c)}}function k2(t){var e=t,i=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(i=e.return),t=e.return;while(t)}return e.tag===3?i:null}function Vxe(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function lue(t){if(k2(t)!==t)throw Error(je(188))}function ize(t){var e=t.alternate;if(!e){if(e=k2(t),e===null)throw Error(je(188));return e!==t?null:t}for(var i=t,r=e;;){var n=i.return;if(n===null)break;var s=n.alternate;if(s===null){if(r=n.return,r!==null){i=r;continue}break}if(n.child===s.child){for(s=n.child;s;){if(s===i)return lue(n),t;if(s===r)return lue(n),e;s=s.sibling}throw Error(je(188))}if(i.return!==r.return)i=n,r=s;else{for(var o=!1,a=n.child;a;){if(a===i){o=!0,i=n,r=s;break}if(a===r){o=!0,r=n,i=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===i){o=!0,i=s,r=n;break}if(a===r){o=!0,r=s,i=n;break}a=a.sibling}if(!o)throw Error(je(189))}}if(i.alternate!==r)throw Error(je(190))}if(i.tag!==3)throw Error(je(188));return i.stateNode.current===i?t:e}function zxe(t){return t=ize(t),t!==null?Bxe(t):null}function Bxe(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=Bxe(t);if(e!==null)return e;t=t.sibling}return null}var jxe=sd.unstable_scheduleCallback,cue=sd.unstable_cancelCallback,rze=sd.unstable_shouldYield,nze=sd.unstable_requestPaint,po=sd.unstable_now,sze=sd.unstable_getCurrentPriorityLevel,Kie=sd.unstable_ImmediatePriority,Gxe=sd.unstable_UserBlockingPriority,f8=sd.unstable_NormalPriority,oze=sd.unstable_LowPriority,Hxe=sd.unstable_IdlePriority,c9=null,Wg=null;function aze(t){if(Wg&&typeof Wg.onCommitFiberRoot=="function")try{Wg.onCommitFiberRoot(c9,t,void 0,(t.current.flags&128)===128)}catch{}}var nm=Math.clz32?Math.clz32:uze,lze=Math.log,cze=Math.LN2;function uze(t){return t>>>=0,t===0?32:31-(lze(t)/cze|0)|0}var yF=64,_F=4194304;function wP(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function m8(t,e){var i=t.pendingLanes;if(i===0)return 0;var r=0,n=t.suspendedLanes,s=t.pingedLanes,o=i&268435455;if(o!==0){var a=o&~n;a!==0?r=wP(a):(s&=o,s!==0&&(r=wP(s)))}else o=i&~n,o!==0?r=wP(o):s!==0&&(r=wP(s));if(r===0)return 0;if(e!==0&&e!==r&&!(e&n)&&(n=r&-r,s=e&-e,n>=s||n===16&&(s&4194240)!==0))return e;if(r&4&&(r|=i&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)i=31-nm(e),n=1<<i,r|=t[i],e&=~n;return r}function hze(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function dze(t,e){for(var i=t.suspendedLanes,r=t.pingedLanes,n=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-nm(s),a=1<<o,l=n[o];l===-1?(!(a&i)||a&r)&&(n[o]=hze(a,e)):l<=e&&(t.expiredLanes|=a),s&=~a}}function xX(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function qxe(){var t=yF;return yF<<=1,!(yF&4194240)&&(yF=64),t}function sj(t){for(var e=[],i=0;31>i;i++)e.push(t);return e}function iN(t,e,i){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-nm(e),t[e]=i}function pze(t,e){var i=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<i;){var n=31-nm(i),s=1<<n;e[n]=0,r[n]=-1,t[n]=-1,i&=~s}}function Qie(t,e){var i=t.entangledLanes|=e;for(t=t.entanglements;i;){var r=31-nm(i),n=1<<r;n&e|t[r]&e&&(t[r]|=e),i&=~n}}var yn=0;function Wxe(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Xxe,ere,Yxe,Zxe,Jxe,TX=!1,vF=[],Rb=null,Mb=null,Ob=null,bL=new Map,wL=new Map,X1=[],fze="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function uue(t,e){switch(t){case"focusin":case"focusout":Rb=null;break;case"dragenter":case"dragleave":Mb=null;break;case"mouseover":case"mouseout":Ob=null;break;case"pointerover":case"pointerout":bL.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":wL.delete(e.pointerId)}}function e3(t,e,i,r,n,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:i,eventSystemFlags:r,nativeEvent:s,targetContainers:[n]},e!==null&&(e=nN(e),e!==null&&ere(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,n!==null&&e.indexOf(n)===-1&&e.push(n),t)}function mze(t,e,i,r,n){switch(e){case"focusin":return Rb=e3(Rb,t,e,i,r,n),!0;case"dragenter":return Mb=e3(Mb,t,e,i,r,n),!0;case"mouseover":return Ob=e3(Ob,t,e,i,r,n),!0;case"pointerover":var s=n.pointerId;return bL.set(s,e3(bL.get(s)||null,t,e,i,r,n)),!0;case"gotpointercapture":return s=n.pointerId,wL.set(s,e3(wL.get(s)||null,t,e,i,r,n)),!0}return!1}function Kxe(t){var e=hS(t.target);if(e!==null){var i=k2(e);if(i!==null){if(e=i.tag,e===13){if(e=Vxe(i),e!==null){t.blockedOn=e,Jxe(t.priority,function(){Yxe(i)});return}}else if(e===3&&i.stateNode.current.memoizedState.isDehydrated){t.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Wk(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var i=SX(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(i===null){i=t.nativeEvent;var r=new i.constructor(i.type,i);_X=r,i.target.dispatchEvent(r),_X=null}else return e=nN(i),e!==null&&ere(e),t.blockedOn=i,!1;e.shift()}return!0}function hue(t,e,i){Wk(t)&&i.delete(e)}function gze(){TX=!1,Rb!==null&&Wk(Rb)&&(Rb=null),Mb!==null&&Wk(Mb)&&(Mb=null),Ob!==null&&Wk(Ob)&&(Ob=null),bL.forEach(hue),wL.forEach(hue)}function t3(t,e){t.blockedOn===e&&(t.blockedOn=null,TX||(TX=!0,sd.unstable_scheduleCallback(sd.unstable_NormalPriority,gze)))}function xL(t){function e(n){return t3(n,t)}if(0<vF.length){t3(vF[0],t);for(var i=1;i<vF.length;i++){var r=vF[i];r.blockedOn===t&&(r.blockedOn=null)}}for(Rb!==null&&t3(Rb,t),Mb!==null&&t3(Mb,t),Ob!==null&&t3(Ob,t),bL.forEach(e),wL.forEach(e),i=0;i<X1.length;i++)r=X1[i],r.blockedOn===t&&(r.blockedOn=null);for(;0<X1.length&&(i=X1[0],i.blockedOn===null);)Kxe(i),i.blockedOn===null&&X1.shift()}var xR=k_.ReactCurrentBatchConfig,g8=!0;function yze(t,e,i,r){var n=yn,s=xR.transition;xR.transition=null;try{yn=1,tre(t,e,i,r)}finally{yn=n,xR.transition=s}}function _ze(t,e,i,r){var n=yn,s=xR.transition;xR.transition=null;try{yn=4,tre(t,e,i,r)}finally{yn=n,xR.transition=s}}function tre(t,e,i,r){if(g8){var n=SX(t,e,i,r);if(n===null)mj(t,e,r,y8,i),uue(t,r);else if(mze(n,t,e,i,r))r.stopPropagation();else if(uue(t,r),e&4&&-1<fze.indexOf(t)){for(;n!==null;){var s=nN(n);if(s!==null&&Xxe(s),s=SX(t,e,i,r),s===null&&mj(t,e,r,y8,i),s===n)break;n=s}n!==null&&r.stopPropagation()}else mj(t,e,r,null,i)}}var y8=null;function SX(t,e,i,r){if(y8=null,t=Jie(r),t=hS(t),t!==null)if(e=k2(t),e===null)t=null;else if(i=e.tag,i===13){if(t=Vxe(e),t!==null)return t;t=null}else if(i===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return y8=t,null}function Qxe(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(sze()){case Kie:return 1;case Gxe:return 4;case f8:case oze:return 16;case Hxe:return 536870912;default:return 16}default:return 16}}var sb=null,ire=null,Xk=null;function eTe(){if(Xk)return Xk;var t,e=ire,i=e.length,r,n="value"in sb?sb.value:sb.textContent,s=n.length;for(t=0;t<i&&e[t]===n[t];t++);var o=i-t;for(r=1;r<=o&&e[i-r]===n[s-r];r++);return Xk=n.slice(t,1<r?1-r:void 0)}function Yk(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function bF(){return!0}function due(){return!1}function pd(t){function e(i,r,n,s,o){this._reactName=i,this._targetInst=n,this.type=r,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(i=t[a],this[a]=i?i(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?bF:due,this.isPropagationStopped=due,this}return Ps(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=bF)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=bF)},persist:function(){},isPersistent:bF}),e}var cO={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},rre=pd(cO),rN=Ps({},cO,{view:0,detail:0}),vze=pd(rN),oj,aj,i3,u9=Ps({},rN,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:nre,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==i3&&(i3&&t.type==="mousemove"?(oj=t.screenX-i3.screenX,aj=t.screenY-i3.screenY):aj=oj=0,i3=t),oj)},movementY:function(t){return"movementY"in t?t.movementY:aj}}),pue=pd(u9),bze=Ps({},u9,{dataTransfer:0}),wze=pd(bze),xze=Ps({},rN,{relatedTarget:0}),lj=pd(xze),Tze=Ps({},cO,{animationName:0,elapsedTime:0,pseudoElement:0}),Sze=pd(Tze),Eze=Ps({},cO,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Cze=pd(Eze),Aze=Ps({},cO,{data:0}),fue=pd(Aze),Rze={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Mze={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Oze={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pze(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=Oze[t])?!!e[t]:!1}function nre(){return Pze}var Ize=Ps({},rN,{key:function(t){if(t.key){var e=Rze[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Yk(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Mze[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:nre,charCode:function(t){return t.type==="keypress"?Yk(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Yk(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),$ze=pd(Ize),Lze=Ps({},u9,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),mue=pd(Lze),Dze=Ps({},rN,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:nre}),Nze=pd(Dze),Fze=Ps({},cO,{propertyName:0,elapsedTime:0,pseudoElement:0}),kze=pd(Fze),Uze=Ps({},u9,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Vze=pd(Uze),zze=[9,13,27,32],sre=__&&"CompositionEvent"in window,h$=null;__&&"documentMode"in document&&(h$=document.documentMode);var Bze=__&&"TextEvent"in window&&!h$,tTe=__&&(!sre||h$&&8<h$&&11>=h$),gue=String.fromCharCode(32),yue=!1;function iTe(t,e){switch(t){case"keyup":return zze.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function rTe(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var VA=!1;function jze(t,e){switch(t){case"compositionend":return rTe(e);case"keypress":return e.which!==32?null:(yue=!0,gue);case"textInput":return t=e.data,t===gue&&yue?null:t;default:return null}}function Gze(t,e){if(VA)return t==="compositionend"||!sre&&iTe(t,e)?(t=eTe(),Xk=ire=sb=null,VA=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return tTe&&e.locale!=="ko"?null:e.data;default:return null}}var Hze={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function _ue(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!Hze[t.type]:e==="textarea"}function nTe(t,e,i,r){Dxe(r),e=_8(e,"onChange"),0<e.length&&(i=new rre("onChange","change",null,i,r),t.push({event:i,listeners:e}))}var d$=null,TL=null;function qze(t){mTe(t,0)}function h9(t){var e=jA(t);if(Rxe(e))return t}function Wze(t,e){if(t==="change")return e}var sTe=!1;if(__){var cj;if(__){var uj="oninput"in document;if(!uj){var vue=document.createElement("div");vue.setAttribute("oninput","return;"),uj=typeof vue.oninput=="function"}cj=uj}else cj=!1;sTe=cj&&(!document.documentMode||9<document.documentMode)}function bue(){d$&&(d$.detachEvent("onpropertychange",oTe),TL=d$=null)}function oTe(t){if(t.propertyName==="value"&&h9(TL)){var e=[];nTe(e,TL,t,Jie(t)),Uxe(qze,e)}}function Xze(t,e,i){t==="focusin"?(bue(),d$=e,TL=i,d$.attachEvent("onpropertychange",oTe)):t==="focusout"&&bue()}function Yze(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return h9(TL)}function Zze(t,e){if(t==="click")return h9(e)}function Jze(t,e){if(t==="input"||t==="change")return h9(e)}function Kze(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var dm=typeof Object.is=="function"?Object.is:Kze;function SL(t,e){if(dm(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var i=Object.keys(t),r=Object.keys(e);if(i.length!==r.length)return!1;for(r=0;r<i.length;r++){var n=i[r];if(!oX.call(e,n)||!dm(t[n],e[n]))return!1}return!0}function wue(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function xue(t,e){var i=wue(t);t=0;for(var r;i;){if(i.nodeType===3){if(r=t+i.textContent.length,t<=e&&r>=e)return{node:i,offset:e-t};t=r}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=wue(i)}}function aTe(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?aTe(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function lTe(){for(var t=window,e=h8();e instanceof t.HTMLIFrameElement;){try{var i=typeof e.contentWindow.location.href=="string"}catch{i=!1}if(i)t=e.contentWindow;else break;e=h8(t.document)}return e}function ore(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function Qze(t){var e=lTe(),i=t.focusedElem,r=t.selectionRange;if(e!==i&&i&&i.ownerDocument&&aTe(i.ownerDocument.documentElement,i)){if(r!==null&&ore(i)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in i)i.selectionStart=e,i.selectionEnd=Math.min(t,i.value.length);else if(t=(e=i.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var n=i.textContent.length,s=Math.min(r.start,n);r=r.end===void 0?s:Math.min(r.end,n),!t.extend&&s>r&&(n=r,r=s,s=n),n=xue(i,s);var o=xue(i,r);n&&o&&(t.rangeCount!==1||t.anchorNode!==n.node||t.anchorOffset!==n.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(n.node,n.offset),t.removeAllRanges(),s>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=i;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof i.focus=="function"&&i.focus(),i=0;i<e.length;i++)t=e[i],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var e9e=__&&"documentMode"in document&&11>=document.documentMode,zA=null,EX=null,p$=null,CX=!1;function Tue(t,e,i){var r=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;CX||zA==null||zA!==h8(r)||(r=zA,"selectionStart"in r&&ore(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),p$&&SL(p$,r)||(p$=r,r=_8(EX,"onSelect"),0<r.length&&(e=new rre("onSelect","select",null,e,i),t.push({event:e,listeners:r}),e.target=zA)))}function wF(t,e){var i={};return i[t.toLowerCase()]=e.toLowerCase(),i["Webkit"+t]="webkit"+e,i["Moz"+t]="moz"+e,i}var BA={animationend:wF("Animation","AnimationEnd"),animationiteration:wF("Animation","AnimationIteration"),animationstart:wF("Animation","AnimationStart"),transitionend:wF("Transition","TransitionEnd")},hj={},cTe={};__&&(cTe=document.createElement("div").style,"AnimationEvent"in window||(delete BA.animationend.animation,delete BA.animationiteration.animation,delete BA.animationstart.animation),"TransitionEvent"in window||delete BA.transitionend.transition);function d9(t){if(hj[t])return hj[t];if(!BA[t])return t;var e=BA[t],i;for(i in e)if(e.hasOwnProperty(i)&&i in cTe)return hj[t]=e[i];return t}var uTe=d9("animationend"),hTe=d9("animationiteration"),dTe=d9("animationstart"),pTe=d9("transitionend"),fTe=new Map,Sue="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Aw(t,e){fTe.set(t,e),F2(e,[t])}for(var dj=0;dj<Sue.length;dj++){var pj=Sue[dj],t9e=pj.toLowerCase(),i9e=pj[0].toUpperCase()+pj.slice(1);Aw(t9e,"on"+i9e)}Aw(uTe,"onAnimationEnd");Aw(hTe,"onAnimationIteration");Aw(dTe,"onAnimationStart");Aw("dblclick","onDoubleClick");Aw("focusin","onFocus");Aw("focusout","onBlur");Aw(pTe,"onTransitionEnd");rM("onMouseEnter",["mouseout","mouseover"]);rM("onMouseLeave",["mouseout","mouseover"]);rM("onPointerEnter",["pointerout","pointerover"]);rM("onPointerLeave",["pointerout","pointerover"]);F2("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));F2("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));F2("onBeforeInput",["compositionend","keypress","textInput","paste"]);F2("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));F2("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));F2("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var xP="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),r9e=new Set("cancel close invalid load scroll toggle".split(" ").concat(xP));function Eue(t,e,i){var r=t.type||"unknown-event";t.currentTarget=i,tze(r,e,void 0,t),t.currentTarget=null}function mTe(t,e){e=(e&4)!==0;for(var i=0;i<t.length;i++){var r=t[i],n=r.event;r=r.listeners;e:{var s=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&n.isPropagationStopped())break e;Eue(n,a,c),s=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==s&&n.isPropagationStopped())break e;Eue(n,a,c),s=l}}}if(p8)throw t=wX,p8=!1,wX=null,t}function rs(t,e){var i=e[PX];i===void 0&&(i=e[PX]=new Set);var r=t+"__bubble";i.has(r)||(gTe(e,t,2,!1),i.add(r))}function fj(t,e,i){var r=0;e&&(r|=4),gTe(i,t,r,e)}var xF="_reactListening"+Math.random().toString(36).slice(2);function EL(t){if(!t[xF]){t[xF]=!0,Txe.forEach(function(i){i!=="selectionchange"&&(r9e.has(i)||fj(i,!1,t),fj(i,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[xF]||(e[xF]=!0,fj("selectionchange",!1,e))}}function gTe(t,e,i,r){switch(Qxe(e)){case 1:var n=yze;break;case 4:n=_ze;break;default:n=tre}i=n.bind(null,e,i,t),n=void 0,!bX||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(n=!0),r?n!==void 0?t.addEventListener(e,i,{capture:!0,passive:n}):t.addEventListener(e,i,!0):n!==void 0?t.addEventListener(e,i,{passive:n}):t.addEventListener(e,i,!1)}function mj(t,e,i,r,n){var s=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===n||a.nodeType===8&&a.parentNode===n)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===n||l.nodeType===8&&l.parentNode===n))return;o=o.return}for(;a!==null;){if(o=hS(a),o===null)return;if(l=o.tag,l===5||l===6){r=s=o;continue e}a=a.parentNode}}r=r.return}Uxe(function(){var c=s,h=Jie(i),p=[];e:{var f=fTe.get(t);if(f!==void 0){var m=rre,g=t;switch(t){case"keypress":if(Yk(i)===0)break e;case"keydown":case"keyup":m=$ze;break;case"focusin":g="focus",m=lj;break;case"focusout":g="blur",m=lj;break;case"beforeblur":case"afterblur":m=lj;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=pue;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=wze;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=Nze;break;case uTe:case hTe:case dTe:m=Sze;break;case pTe:m=kze;break;case"scroll":m=vze;break;case"wheel":m=Vze;break;case"copy":case"cut":case"paste":m=Cze;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=mue}var _=(e&4)!==0,b=!_&&t==="scroll",w=_?f!==null?f+"Capture":null:f;_=[];for(var x=c,T;x!==null;){T=x;var E=T.stateNode;if(T.tag===5&&E!==null&&(T=E,w!==null&&(E=vL(x,w),E!=null&&_.push(CL(x,E,T)))),b)break;x=x.return}0<_.length&&(f=new m(f,g,null,i,h),p.push({event:f,listeners:_}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",m=t==="mouseout"||t==="pointerout",f&&i!==_X&&(g=i.relatedTarget||i.fromElement)&&(hS(g)||g[v_]))break e;if((m||f)&&(f=h.window===h?h:(f=h.ownerDocument)?f.defaultView||f.parentWindow:window,m?(g=i.relatedTarget||i.toElement,m=c,g=g?hS(g):null,g!==null&&(b=k2(g),g!==b||g.tag!==5&&g.tag!==6)&&(g=null)):(m=null,g=c),m!==g)){if(_=pue,E="onMouseLeave",w="onMouseEnter",x="mouse",(t==="pointerout"||t==="pointerover")&&(_=mue,E="onPointerLeave",w="onPointerEnter",x="pointer"),b=m==null?f:jA(m),T=g==null?f:jA(g),f=new _(E,x+"leave",m,i,h),f.target=b,f.relatedTarget=T,E=null,hS(h)===c&&(_=new _(w,x+"enter",g,i,h),_.target=T,_.relatedTarget=b,E=_),b=E,m&&g)t:{for(_=m,w=g,x=0,T=_;T;T=rE(T))x++;for(T=0,E=w;E;E=rE(E))T++;for(;0<x-T;)_=rE(_),x--;for(;0<T-x;)w=rE(w),T--;for(;x--;){if(_===w||w!==null&&_===w.alternate)break t;_=rE(_),w=rE(w)}_=null}else _=null;m!==null&&Cue(p,f,m,_,!1),g!==null&&b!==null&&Cue(p,b,g,_,!0)}}e:{if(f=c?jA(c):window,m=f.nodeName&&f.nodeName.toLowerCase(),m==="select"||m==="input"&&f.type==="file")var C=Wze;else if(_ue(f))if(sTe)C=Jze;else{C=Yze;var A=Xze}else(m=f.nodeName)&&m.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(C=Zze);if(C&&(C=C(t,c))){nTe(p,C,i,h);break e}A&&A(t,f,c),t==="focusout"&&(A=f._wrapperState)&&A.controlled&&f.type==="number"&&pX(f,"number",f.value)}switch(A=c?jA(c):window,t){case"focusin":(_ue(A)||A.contentEditable==="true")&&(zA=A,EX=c,p$=null);break;case"focusout":p$=EX=zA=null;break;case"mousedown":CX=!0;break;case"contextmenu":case"mouseup":case"dragend":CX=!1,Tue(p,i,h);break;case"selectionchange":if(e9e)break;case"keydown":case"keyup":Tue(p,i,h)}var I;if(sre)e:{switch(t){case"compositionstart":var O="onCompositionStart";break e;case"compositionend":O="onCompositionEnd";break e;case"compositionupdate":O="onCompositionUpdate";break e}O=void 0}else VA?iTe(t,i)&&(O="onCompositionEnd"):t==="keydown"&&i.keyCode===229&&(O="onCompositionStart");O&&(tTe&&i.locale!=="ko"&&(VA||O!=="onCompositionStart"?O==="onCompositionEnd"&&VA&&(I=eTe()):(sb=h,ire="value"in sb?sb.value:sb.textContent,VA=!0)),A=_8(c,O),0<A.length&&(O=new fue(O,t,null,i,h),p.push({event:O,listeners:A}),I?O.data=I:(I=rTe(i),I!==null&&(O.data=I)))),(I=Bze?jze(t,i):Gze(t,i))&&(c=_8(c,"onBeforeInput"),0<c.length&&(h=new fue("onBeforeInput","beforeinput",null,i,h),p.push({event:h,listeners:c}),h.data=I))}mTe(p,e)})}function CL(t,e,i){return{instance:t,listener:e,currentTarget:i}}function _8(t,e){for(var i=e+"Capture",r=[];t!==null;){var n=t,s=n.stateNode;n.tag===5&&s!==null&&(n=s,s=vL(t,i),s!=null&&r.unshift(CL(t,s,n)),s=vL(t,e),s!=null&&r.push(CL(t,s,n))),t=t.return}return r}function rE(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Cue(t,e,i,r,n){for(var s=e._reactName,o=[];i!==null&&i!==r;){var a=i,l=a.alternate,c=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&c!==null&&(a=c,n?(l=vL(i,s),l!=null&&o.unshift(CL(i,l,a))):n||(l=vL(i,s),l!=null&&o.push(CL(i,l,a)))),i=i.return}o.length!==0&&t.push({event:e,listeners:o})}var n9e=/\r\n?/g,s9e=/\u0000|\uFFFD/g;function Aue(t){return(typeof t=="string"?t:""+t).replace(n9e,`
`).replace(s9e,"")}function TF(t,e,i){if(e=Aue(e),Aue(t)!==e&&i)throw Error(je(425))}function v8(){}var AX=null,RX=null;function MX(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var OX=typeof setTimeout=="function"?setTimeout:void 0,o9e=typeof clearTimeout=="function"?clearTimeout:void 0,Rue=typeof Promise=="function"?Promise:void 0,a9e=typeof queueMicrotask=="function"?queueMicrotask:typeof Rue<"u"?function(t){return Rue.resolve(null).then(t).catch(l9e)}:OX;function l9e(t){setTimeout(function(){throw t})}function gj(t,e){var i=e,r=0;do{var n=i.nextSibling;if(t.removeChild(i),n&&n.nodeType===8)if(i=n.data,i==="/$"){if(r===0){t.removeChild(n),xL(e);return}r--}else i!=="$"&&i!=="$?"&&i!=="$!"||r++;i=n}while(i);xL(e)}function Pb(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Mue(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var i=t.data;if(i==="$"||i==="$!"||i==="$?"){if(e===0)return t;e--}else i==="/$"&&e++}t=t.previousSibling}return null}var uO=Math.random().toString(36).slice(2),Lg="__reactFiber$"+uO,AL="__reactProps$"+uO,v_="__reactContainer$"+uO,PX="__reactEvents$"+uO,c9e="__reactListeners$"+uO,u9e="__reactHandles$"+uO;function hS(t){var e=t[Lg];if(e)return e;for(var i=t.parentNode;i;){if(e=i[v_]||i[Lg]){if(i=e.alternate,e.child!==null||i!==null&&i.child!==null)for(t=Mue(t);t!==null;){if(i=t[Lg])return i;t=Mue(t)}return e}t=i,i=t.parentNode}return null}function nN(t){return t=t[Lg]||t[v_],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function jA(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(je(33))}function p9(t){return t[AL]||null}var IX=[],GA=-1;function Rw(t){return{current:t}}function ms(t){0>GA||(t.current=IX[GA],IX[GA]=null,GA--)}function Yn(t,e){GA++,IX[GA]=t.current,t.current=e}var Zb={},Kl=Rw(Zb),ju=Rw(!1),YS=Zb;function nM(t,e){var i=t.type.contextTypes;if(!i)return Zb;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var n={},s;for(s in i)n[s]=e[s];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=n),n}function Gu(t){return t=t.childContextTypes,t!=null}function b8(){ms(ju),ms(Kl)}function Oue(t,e,i){if(Kl.current!==Zb)throw Error(je(168));Yn(Kl,e),Yn(ju,i)}function yTe(t,e,i){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return i;r=r.getChildContext();for(var n in r)if(!(n in e))throw Error(je(108,XVe(t)||"Unknown",n));return Ps({},i,r)}function w8(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Zb,YS=Kl.current,Yn(Kl,t),Yn(ju,ju.current),!0}function Pue(t,e,i){var r=t.stateNode;if(!r)throw Error(je(169));i?(t=yTe(t,e,YS),r.__reactInternalMemoizedMergedChildContext=t,ms(ju),ms(Kl),Yn(Kl,t)):ms(ju),Yn(ju,i)}var N0=null,f9=!1,yj=!1;function _Te(t){N0===null?N0=[t]:N0.push(t)}function h9e(t){f9=!0,_Te(t)}function Mw(){if(!yj&&N0!==null){yj=!0;var t=0,e=yn;try{var i=N0;for(yn=1;t<i.length;t++){var r=i[t];do r=r(!0);while(r!==null)}N0=null,f9=!1}catch(n){throw N0!==null&&(N0=N0.slice(t+1)),jxe(Kie,Mw),n}finally{yn=e,yj=!1}}return null}var HA=[],qA=0,x8=null,T8=0,ep=[],tp=0,ZS=null,q0=1,W0="";function Nx(t,e){HA[qA++]=T8,HA[qA++]=x8,x8=t,T8=e}function vTe(t,e,i){ep[tp++]=q0,ep[tp++]=W0,ep[tp++]=ZS,ZS=t;var r=q0;t=W0;var n=32-nm(r)-1;r&=~(1<<n),i+=1;var s=32-nm(e)+n;if(30<s){var o=n-n%5;s=(r&(1<<o)-1).toString(32),r>>=o,n-=o,q0=1<<32-nm(e)+n|i<<n|r,W0=s+t}else q0=1<<s|i<<n|r,W0=t}function are(t){t.return!==null&&(Nx(t,1),vTe(t,1,0))}function lre(t){for(;t===x8;)x8=HA[--qA],HA[qA]=null,T8=HA[--qA],HA[qA]=null;for(;t===ZS;)ZS=ep[--tp],ep[tp]=null,W0=ep[--tp],ep[tp]=null,q0=ep[--tp],ep[tp]=null}var Qh=null,Zh=null,xs=!1,Bf=null;function bTe(t,e){var i=fp(5,null,null,0);i.elementType="DELETED",i.stateNode=e,i.return=t,e=t.deletions,e===null?(t.deletions=[i],t.flags|=16):e.push(i)}function Iue(t,e){switch(t.tag){case 5:var i=t.type;return e=e.nodeType!==1||i.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Qh=t,Zh=Pb(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Qh=t,Zh=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(i=ZS!==null?{id:q0,overflow:W0}:null,t.memoizedState={dehydrated:e,treeContext:i,retryLane:1073741824},i=fp(18,null,null,0),i.stateNode=e,i.return=t,t.child=i,Qh=t,Zh=null,!0):!1;default:return!1}}function $X(t){return(t.mode&1)!==0&&(t.flags&128)===0}function LX(t){if(xs){var e=Zh;if(e){var i=e;if(!Iue(t,e)){if($X(t))throw Error(je(418));e=Pb(i.nextSibling);var r=Qh;e&&Iue(t,e)?bTe(r,i):(t.flags=t.flags&-4097|2,xs=!1,Qh=t)}}else{if($X(t))throw Error(je(418));t.flags=t.flags&-4097|2,xs=!1,Qh=t}}}function $ue(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Qh=t}function SF(t){if(t!==Qh)return!1;if(!xs)return $ue(t),xs=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!MX(t.type,t.memoizedProps)),e&&(e=Zh)){if($X(t))throw wTe(),Error(je(418));for(;e;)bTe(t,e),e=Pb(e.nextSibling)}if($ue(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(je(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var i=t.data;if(i==="/$"){if(e===0){Zh=Pb(t.nextSibling);break e}e--}else i!=="$"&&i!=="$!"&&i!=="$?"||e++}t=t.nextSibling}Zh=null}}else Zh=Qh?Pb(t.stateNode.nextSibling):null;return!0}function wTe(){for(var t=Zh;t;)t=Pb(t.nextSibling)}function sM(){Zh=Qh=null,xs=!1}function cre(t){Bf===null?Bf=[t]:Bf.push(t)}var d9e=k_.ReactCurrentBatchConfig;function $f(t,e){if(t&&t.defaultProps){e=Ps({},e),t=t.defaultProps;for(var i in t)e[i]===void 0&&(e[i]=t[i]);return e}return e}var S8=Rw(null),E8=null,WA=null,ure=null;function hre(){ure=WA=E8=null}function dre(t){var e=S8.current;ms(S8),t._currentValue=e}function DX(t,e,i){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===i)break;t=t.return}}function TR(t,e){E8=t,ure=WA=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Uu=!0),t.firstContext=null)}function Ap(t){var e=t._currentValue;if(ure!==t)if(t={context:t,memoizedValue:e,next:null},WA===null){if(E8===null)throw Error(je(308));WA=t,E8.dependencies={lanes:0,firstContext:t}}else WA=WA.next=t;return e}var dS=null;function pre(t){dS===null?dS=[t]:dS.push(t)}function xTe(t,e,i,r){var n=e.interleaved;return n===null?(i.next=i,pre(e)):(i.next=n.next,n.next=i),e.interleaved=i,b_(t,r)}function b_(t,e){t.lanes|=e;var i=t.alternate;for(i!==null&&(i.lanes|=e),i=t,t=t.return;t!==null;)t.childLanes|=e,i=t.alternate,i!==null&&(i.childLanes|=e),i=t,t=t.return;return i.tag===3?i.stateNode:null}var N1=!1;function fre(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function TTe(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function r_(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Ib(t,e,i){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,$r&2){var n=r.pending;return n===null?e.next=e:(e.next=n.next,n.next=e),r.pending=e,b_(t,i)}return n=r.interleaved,n===null?(e.next=e,pre(r)):(e.next=n.next,n.next=e),r.interleaved=e,b_(t,i)}function Zk(t,e,i){if(e=e.updateQueue,e!==null&&(e=e.shared,(i&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,i|=r,e.lanes=i,Qie(t,i)}}function Lue(t,e){var i=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,i===r)){var n=null,s=null;if(i=i.firstBaseUpdate,i!==null){do{var o={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};s===null?n=s=o:s=s.next=o,i=i.next}while(i!==null);s===null?n=s=e:s=s.next=e}else n=s=e;i={baseState:r.baseState,firstBaseUpdate:n,lastBaseUpdate:s,shared:r.shared,effects:r.effects},t.updateQueue=i;return}t=i.lastBaseUpdate,t===null?i.firstBaseUpdate=e:t.next=e,i.lastBaseUpdate=e}function C8(t,e,i,r){var n=t.updateQueue;N1=!1;var s=n.firstBaseUpdate,o=n.lastBaseUpdate,a=n.shared.pending;if(a!==null){n.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?s=c:o.next=c,o=l;var h=t.alternate;h!==null&&(h=h.updateQueue,a=h.lastBaseUpdate,a!==o&&(a===null?h.firstBaseUpdate=c:a.next=c,h.lastBaseUpdate=l))}if(s!==null){var p=n.baseState;o=0,h=c=l=null,a=s;do{var f=a.lane,m=a.eventTime;if((r&f)===f){h!==null&&(h=h.next={eventTime:m,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var g=t,_=a;switch(f=e,m=i,_.tag){case 1:if(g=_.payload,typeof g=="function"){p=g.call(m,p,f);break e}p=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=_.payload,f=typeof g=="function"?g.call(m,p,f):g,f==null)break e;p=Ps({},p,f);break e;case 2:N1=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,f=n.effects,f===null?n.effects=[a]:f.push(a))}else m={eventTime:m,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},h===null?(c=h=m,l=p):h=h.next=m,o|=f;if(a=a.next,a===null){if(a=n.shared.pending,a===null)break;f=a,a=f.next,f.next=null,n.lastBaseUpdate=f,n.shared.pending=null}}while(1);if(h===null&&(l=p),n.baseState=l,n.firstBaseUpdate=c,n.lastBaseUpdate=h,e=n.shared.interleaved,e!==null){n=e;do o|=n.lane,n=n.next;while(n!==e)}else s===null&&(n.shared.lanes=0);KS|=o,t.lanes=o,t.memoizedState=p}}function Due(t,e,i){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],n=r.callback;if(n!==null){if(r.callback=null,r=i,typeof n!="function")throw Error(je(191,n));n.call(r)}}}var STe=new xxe.Component().refs;function NX(t,e,i,r){e=t.memoizedState,i=i(r,e),i=i==null?e:Ps({},e,i),t.memoizedState=i,t.lanes===0&&(t.updateQueue.baseState=i)}var m9={isMounted:function(t){return(t=t._reactInternals)?k2(t)===t:!1},enqueueSetState:function(t,e,i){t=t._reactInternals;var r=Hc(),n=Lb(t),s=r_(r,n);s.payload=e,i!=null&&(s.callback=i),e=Ib(t,s,n),e!==null&&(sm(e,t,n,r),Zk(e,t,n))},enqueueReplaceState:function(t,e,i){t=t._reactInternals;var r=Hc(),n=Lb(t),s=r_(r,n);s.tag=1,s.payload=e,i!=null&&(s.callback=i),e=Ib(t,s,n),e!==null&&(sm(e,t,n,r),Zk(e,t,n))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var i=Hc(),r=Lb(t),n=r_(i,r);n.tag=2,e!=null&&(n.callback=e),e=Ib(t,n,r),e!==null&&(sm(e,t,r,i),Zk(e,t,r))}};function Nue(t,e,i,r,n,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,s,o):e.prototype&&e.prototype.isPureReactComponent?!SL(i,r)||!SL(n,s):!0}function ETe(t,e,i){var r=!1,n=Zb,s=e.contextType;return typeof s=="object"&&s!==null?s=Ap(s):(n=Gu(e)?YS:Kl.current,r=e.contextTypes,s=(r=r!=null)?nM(t,n):Zb),e=new e(i,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=m9,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=n,t.__reactInternalMemoizedMaskedChildContext=s),e}function Fue(t,e,i,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(i,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(i,r),e.state!==t&&m9.enqueueReplaceState(e,e.state,null)}function FX(t,e,i,r){var n=t.stateNode;n.props=i,n.state=t.memoizedState,n.refs=STe,fre(t);var s=e.contextType;typeof s=="object"&&s!==null?n.context=Ap(s):(s=Gu(e)?YS:Kl.current,n.context=nM(t,s)),n.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(NX(t,e,s,i),n.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof n.getSnapshotBeforeUpdate=="function"||typeof n.UNSAFE_componentWillMount!="function"&&typeof n.componentWillMount!="function"||(e=n.state,typeof n.componentWillMount=="function"&&n.componentWillMount(),typeof n.UNSAFE_componentWillMount=="function"&&n.UNSAFE_componentWillMount(),e!==n.state&&m9.enqueueReplaceState(n,n.state,null),C8(t,i,n,r),n.state=t.memoizedState),typeof n.componentDidMount=="function"&&(t.flags|=4194308)}function r3(t,e,i){if(t=i.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(i._owner){if(i=i._owner,i){if(i.tag!==1)throw Error(je(309));var r=i.stateNode}if(!r)throw Error(je(147,t));var n=r,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=n.refs;a===STe&&(a=n.refs={}),o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(je(284));if(!i._owner)throw Error(je(290,t))}return t}function EF(t,e){throw t=Object.prototype.toString.call(e),Error(je(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function kue(t){var e=t._init;return e(t._payload)}function CTe(t){function e(w,x){if(t){var T=w.deletions;T===null?(w.deletions=[x],w.flags|=16):T.push(x)}}function i(w,x){if(!t)return null;for(;x!==null;)e(w,x),x=x.sibling;return null}function r(w,x){for(w=new Map;x!==null;)x.key!==null?w.set(x.key,x):w.set(x.index,x),x=x.sibling;return w}function n(w,x){return w=Db(w,x),w.index=0,w.sibling=null,w}function s(w,x,T){return w.index=T,t?(T=w.alternate,T!==null?(T=T.index,T<x?(w.flags|=2,x):T):(w.flags|=2,x)):(w.flags|=1048576,x)}function o(w){return t&&w.alternate===null&&(w.flags|=2),w}function a(w,x,T,E){return x===null||x.tag!==6?(x=Sj(T,w.mode,E),x.return=w,x):(x=n(x,T),x.return=w,x)}function l(w,x,T,E){var C=T.type;return C===UA?h(w,x,T.props.children,E,T.key):x!==null&&(x.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===D1&&kue(C)===x.type)?(E=n(x,T.props),E.ref=r3(w,x,T),E.return=w,E):(E=i6(T.type,T.key,T.props,null,w.mode,E),E.ref=r3(w,x,T),E.return=w,E)}function c(w,x,T,E){return x===null||x.tag!==4||x.stateNode.containerInfo!==T.containerInfo||x.stateNode.implementation!==T.implementation?(x=Ej(T,w.mode,E),x.return=w,x):(x=n(x,T.children||[]),x.return=w,x)}function h(w,x,T,E,C){return x===null||x.tag!==7?(x=PS(T,w.mode,E,C),x.return=w,x):(x=n(x,T),x.return=w,x)}function p(w,x,T){if(typeof x=="string"&&x!==""||typeof x=="number")return x=Sj(""+x,w.mode,T),x.return=w,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case fF:return T=i6(x.type,x.key,x.props,null,w.mode,T),T.ref=r3(w,null,x),T.return=w,T;case kA:return x=Ej(x,w.mode,T),x.return=w,x;case D1:var E=x._init;return p(w,E(x._payload),T)}if(bP(x)||KO(x))return x=PS(x,w.mode,T,null),x.return=w,x;EF(w,x)}return null}function f(w,x,T,E){var C=x!==null?x.key:null;if(typeof T=="string"&&T!==""||typeof T=="number")return C!==null?null:a(w,x,""+T,E);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case fF:return T.key===C?l(w,x,T,E):null;case kA:return T.key===C?c(w,x,T,E):null;case D1:return C=T._init,f(w,x,C(T._payload),E)}if(bP(T)||KO(T))return C!==null?null:h(w,x,T,E,null);EF(w,T)}return null}function m(w,x,T,E,C){if(typeof E=="string"&&E!==""||typeof E=="number")return w=w.get(T)||null,a(x,w,""+E,C);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case fF:return w=w.get(E.key===null?T:E.key)||null,l(x,w,E,C);case kA:return w=w.get(E.key===null?T:E.key)||null,c(x,w,E,C);case D1:var A=E._init;return m(w,x,T,A(E._payload),C)}if(bP(E)||KO(E))return w=w.get(T)||null,h(x,w,E,C,null);EF(x,E)}return null}function g(w,x,T,E){for(var C=null,A=null,I=x,O=x=0,D=null;I!==null&&O<T.length;O++){I.index>O?(D=I,I=null):D=I.sibling;var U=f(w,I,T[O],E);if(U===null){I===null&&(I=D);break}t&&I&&U.alternate===null&&e(w,I),x=s(U,x,O),A===null?C=U:A.sibling=U,A=U,I=D}if(O===T.length)return i(w,I),xs&&Nx(w,O),C;if(I===null){for(;O<T.length;O++)I=p(w,T[O],E),I!==null&&(x=s(I,x,O),A===null?C=I:A.sibling=I,A=I);return xs&&Nx(w,O),C}for(I=r(w,I);O<T.length;O++)D=m(I,w,O,T[O],E),D!==null&&(t&&D.alternate!==null&&I.delete(D.key===null?O:D.key),x=s(D,x,O),A===null?C=D:A.sibling=D,A=D);return t&&I.forEach(function(V){return e(w,V)}),xs&&Nx(w,O),C}function _(w,x,T,E){var C=KO(T);if(typeof C!="function")throw Error(je(150));if(T=C.call(T),T==null)throw Error(je(151));for(var A=C=null,I=x,O=x=0,D=null,U=T.next();I!==null&&!U.done;O++,U=T.next()){I.index>O?(D=I,I=null):D=I.sibling;var V=f(w,I,U.value,E);if(V===null){I===null&&(I=D);break}t&&I&&V.alternate===null&&e(w,I),x=s(V,x,O),A===null?C=V:A.sibling=V,A=V,I=D}if(U.done)return i(w,I),xs&&Nx(w,O),C;if(I===null){for(;!U.done;O++,U=T.next())U=p(w,U.value,E),U!==null&&(x=s(U,x,O),A===null?C=U:A.sibling=U,A=U);return xs&&Nx(w,O),C}for(I=r(w,I);!U.done;O++,U=T.next())U=m(I,w,O,U.value,E),U!==null&&(t&&U.alternate!==null&&I.delete(U.key===null?O:U.key),x=s(U,x,O),A===null?C=U:A.sibling=U,A=U);return t&&I.forEach(function(B){return e(w,B)}),xs&&Nx(w,O),C}function b(w,x,T,E){if(typeof T=="object"&&T!==null&&T.type===UA&&T.key===null&&(T=T.props.children),typeof T=="object"&&T!==null){switch(T.$$typeof){case fF:e:{for(var C=T.key,A=x;A!==null;){if(A.key===C){if(C=T.type,C===UA){if(A.tag===7){i(w,A.sibling),x=n(A,T.props.children),x.return=w,w=x;break e}}else if(A.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===D1&&kue(C)===A.type){i(w,A.sibling),x=n(A,T.props),x.ref=r3(w,A,T),x.return=w,w=x;break e}i(w,A);break}else e(w,A);A=A.sibling}T.type===UA?(x=PS(T.props.children,w.mode,E,T.key),x.return=w,w=x):(E=i6(T.type,T.key,T.props,null,w.mode,E),E.ref=r3(w,x,T),E.return=w,w=E)}return o(w);case kA:e:{for(A=T.key;x!==null;){if(x.key===A)if(x.tag===4&&x.stateNode.containerInfo===T.containerInfo&&x.stateNode.implementation===T.implementation){i(w,x.sibling),x=n(x,T.children||[]),x.return=w,w=x;break e}else{i(w,x);break}else e(w,x);x=x.sibling}x=Ej(T,w.mode,E),x.return=w,w=x}return o(w);case D1:return A=T._init,b(w,x,A(T._payload),E)}if(bP(T))return g(w,x,T,E);if(KO(T))return _(w,x,T,E);EF(w,T)}return typeof T=="string"&&T!==""||typeof T=="number"?(T=""+T,x!==null&&x.tag===6?(i(w,x.sibling),x=n(x,T),x.return=w,w=x):(i(w,x),x=Sj(T,w.mode,E),x.return=w,w=x),o(w)):i(w,x)}return b}var oM=CTe(!0),ATe=CTe(!1),sN={},Xg=Rw(sN),RL=Rw(sN),ML=Rw(sN);function pS(t){if(t===sN)throw Error(je(174));return t}function mre(t,e){switch(Yn(ML,e),Yn(RL,t),Yn(Xg,sN),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:mX(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=mX(e,t)}ms(Xg),Yn(Xg,e)}function aM(){ms(Xg),ms(RL),ms(ML)}function RTe(t){pS(ML.current);var e=pS(Xg.current),i=mX(e,t.type);e!==i&&(Yn(RL,t),Yn(Xg,i))}function gre(t){RL.current===t&&(ms(Xg),ms(RL))}var Rs=Rw(0);function A8(t){for(var e=t;e!==null;){if(e.tag===13){var i=e.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||i.data==="$?"||i.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var _j=[];function yre(){for(var t=0;t<_j.length;t++)_j[t]._workInProgressVersionPrimary=null;_j.length=0}var Jk=k_.ReactCurrentDispatcher,vj=k_.ReactCurrentBatchConfig,JS=0,Ms=null,ca=null,Da=null,R8=!1,f$=!1,OL=0,p9e=0;function Tl(){throw Error(je(321))}function _re(t,e){if(e===null)return!1;for(var i=0;i<e.length&&i<t.length;i++)if(!dm(t[i],e[i]))return!1;return!0}function vre(t,e,i,r,n,s){if(JS=s,Ms=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Jk.current=t===null||t.memoizedState===null?y9e:_9e,t=i(r,n),f$){s=0;do{if(f$=!1,OL=0,25<=s)throw Error(je(301));s+=1,Da=ca=null,e.updateQueue=null,Jk.current=v9e,t=i(r,n)}while(f$)}if(Jk.current=M8,e=ca!==null&&ca.next!==null,JS=0,Da=ca=Ms=null,R8=!1,e)throw Error(je(300));return t}function bre(){var t=OL!==0;return OL=0,t}function Cg(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Da===null?Ms.memoizedState=Da=t:Da=Da.next=t,Da}function Rp(){if(ca===null){var t=Ms.alternate;t=t!==null?t.memoizedState:null}else t=ca.next;var e=Da===null?Ms.memoizedState:Da.next;if(e!==null)Da=e,ca=t;else{if(t===null)throw Error(je(310));ca=t,t={memoizedState:ca.memoizedState,baseState:ca.baseState,baseQueue:ca.baseQueue,queue:ca.queue,next:null},Da===null?Ms.memoizedState=Da=t:Da=Da.next=t}return Da}function PL(t,e){return typeof e=="function"?e(t):e}function bj(t){var e=Rp(),i=e.queue;if(i===null)throw Error(je(311));i.lastRenderedReducer=t;var r=ca,n=r.baseQueue,s=i.pending;if(s!==null){if(n!==null){var o=n.next;n.next=s.next,s.next=o}r.baseQueue=n=s,i.pending=null}if(n!==null){s=n.next,r=r.baseState;var a=o=null,l=null,c=s;do{var h=c.lane;if((JS&h)===h)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:t(r,c.action);else{var p={lane:h,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=p,o=r):l=l.next=p,Ms.lanes|=h,KS|=h}c=c.next}while(c!==null&&c!==s);l===null?o=r:l.next=a,dm(r,e.memoizedState)||(Uu=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,i.lastRenderedState=r}if(t=i.interleaved,t!==null){n=t;do s=n.lane,Ms.lanes|=s,KS|=s,n=n.next;while(n!==t)}else n===null&&(i.lanes=0);return[e.memoizedState,i.dispatch]}function wj(t){var e=Rp(),i=e.queue;if(i===null)throw Error(je(311));i.lastRenderedReducer=t;var r=i.dispatch,n=i.pending,s=e.memoizedState;if(n!==null){i.pending=null;var o=n=n.next;do s=t(s,o.action),o=o.next;while(o!==n);dm(s,e.memoizedState)||(Uu=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),i.lastRenderedState=s}return[s,r]}function MTe(){}function OTe(t,e){var i=Ms,r=Rp(),n=e(),s=!dm(r.memoizedState,n);if(s&&(r.memoizedState=n,Uu=!0),r=r.queue,wre($Te.bind(null,i,r,t),[t]),r.getSnapshot!==e||s||Da!==null&&Da.memoizedState.tag&1){if(i.flags|=2048,IL(9,ITe.bind(null,i,r,n,e),void 0,null),Ba===null)throw Error(je(349));JS&30||PTe(i,e,n)}return n}function PTe(t,e,i){t.flags|=16384,t={getSnapshot:e,value:i},e=Ms.updateQueue,e===null?(e={lastEffect:null,stores:null},Ms.updateQueue=e,e.stores=[t]):(i=e.stores,i===null?e.stores=[t]:i.push(t))}function ITe(t,e,i,r){e.value=i,e.getSnapshot=r,LTe(e)&&DTe(t)}function $Te(t,e,i){return i(function(){LTe(e)&&DTe(t)})}function LTe(t){var e=t.getSnapshot;t=t.value;try{var i=e();return!dm(t,i)}catch{return!0}}function DTe(t){var e=b_(t,1);e!==null&&sm(e,t,1,-1)}function Uue(t){var e=Cg();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:PL,lastRenderedState:t},e.queue=t,t=t.dispatch=g9e.bind(null,Ms,t),[e.memoizedState,t]}function IL(t,e,i,r){return t={tag:t,create:e,destroy:i,deps:r,next:null},e=Ms.updateQueue,e===null?(e={lastEffect:null,stores:null},Ms.updateQueue=e,e.lastEffect=t.next=t):(i=e.lastEffect,i===null?e.lastEffect=t.next=t:(r=i.next,i.next=t,t.next=r,e.lastEffect=t)),t}function NTe(){return Rp().memoizedState}function Kk(t,e,i,r){var n=Cg();Ms.flags|=t,n.memoizedState=IL(1|e,i,void 0,r===void 0?null:r)}function g9(t,e,i,r){var n=Rp();r=r===void 0?null:r;var s=void 0;if(ca!==null){var o=ca.memoizedState;if(s=o.destroy,r!==null&&_re(r,o.deps)){n.memoizedState=IL(e,i,s,r);return}}Ms.flags|=t,n.memoizedState=IL(1|e,i,s,r)}function Vue(t,e){return Kk(8390656,8,t,e)}function wre(t,e){return g9(2048,8,t,e)}function FTe(t,e){return g9(4,2,t,e)}function kTe(t,e){return g9(4,4,t,e)}function UTe(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function VTe(t,e,i){return i=i!=null?i.concat([t]):null,g9(4,4,UTe.bind(null,e,t),i)}function xre(){}function zTe(t,e){var i=Rp();e=e===void 0?null:e;var r=i.memoizedState;return r!==null&&e!==null&&_re(e,r[1])?r[0]:(i.memoizedState=[t,e],t)}function BTe(t,e){var i=Rp();e=e===void 0?null:e;var r=i.memoizedState;return r!==null&&e!==null&&_re(e,r[1])?r[0]:(t=t(),i.memoizedState=[t,e],t)}function jTe(t,e,i){return JS&21?(dm(i,e)||(i=qxe(),Ms.lanes|=i,KS|=i,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Uu=!0),t.memoizedState=i)}function f9e(t,e){var i=yn;yn=i!==0&&4>i?i:4,t(!0);var r=vj.transition;vj.transition={};try{t(!1),e()}finally{yn=i,vj.transition=r}}function GTe(){return Rp().memoizedState}function m9e(t,e,i){var r=Lb(t);if(i={lane:r,action:i,hasEagerState:!1,eagerState:null,next:null},HTe(t))qTe(e,i);else if(i=xTe(t,e,i,r),i!==null){var n=Hc();sm(i,t,r,n),WTe(i,e,r)}}function g9e(t,e,i){var r=Lb(t),n={lane:r,action:i,hasEagerState:!1,eagerState:null,next:null};if(HTe(t))qTe(e,n);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,i);if(n.hasEagerState=!0,n.eagerState=a,dm(a,o)){var l=e.interleaved;l===null?(n.next=n,pre(e)):(n.next=l.next,l.next=n),e.interleaved=n;return}}catch{}finally{}i=xTe(t,e,n,r),i!==null&&(n=Hc(),sm(i,t,r,n),WTe(i,e,r))}}function HTe(t){var e=t.alternate;return t===Ms||e!==null&&e===Ms}function qTe(t,e){f$=R8=!0;var i=t.pending;i===null?e.next=e:(e.next=i.next,i.next=e),t.pending=e}function WTe(t,e,i){if(i&4194240){var r=e.lanes;r&=t.pendingLanes,i|=r,e.lanes=i,Qie(t,i)}}var M8={readContext:Ap,useCallback:Tl,useContext:Tl,useEffect:Tl,useImperativeHandle:Tl,useInsertionEffect:Tl,useLayoutEffect:Tl,useMemo:Tl,useReducer:Tl,useRef:Tl,useState:Tl,useDebugValue:Tl,useDeferredValue:Tl,useTransition:Tl,useMutableSource:Tl,useSyncExternalStore:Tl,useId:Tl,unstable_isNewReconciler:!1},y9e={readContext:Ap,useCallback:function(t,e){return Cg().memoizedState=[t,e===void 0?null:e],t},useContext:Ap,useEffect:Vue,useImperativeHandle:function(t,e,i){return i=i!=null?i.concat([t]):null,Kk(4194308,4,UTe.bind(null,e,t),i)},useLayoutEffect:function(t,e){return Kk(4194308,4,t,e)},useInsertionEffect:function(t,e){return Kk(4,2,t,e)},useMemo:function(t,e){var i=Cg();return e=e===void 0?null:e,t=t(),i.memoizedState=[t,e],t},useReducer:function(t,e,i){var r=Cg();return e=i!==void 0?i(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=m9e.bind(null,Ms,t),[r.memoizedState,t]},useRef:function(t){var e=Cg();return t={current:t},e.memoizedState=t},useState:Uue,useDebugValue:xre,useDeferredValue:function(t){return Cg().memoizedState=t},useTransition:function(){var t=Uue(!1),e=t[0];return t=f9e.bind(null,t[1]),Cg().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,i){var r=Ms,n=Cg();if(xs){if(i===void 0)throw Error(je(407));i=i()}else{if(i=e(),Ba===null)throw Error(je(349));JS&30||PTe(r,e,i)}n.memoizedState=i;var s={value:i,getSnapshot:e};return n.queue=s,Vue($Te.bind(null,r,s,t),[t]),r.flags|=2048,IL(9,ITe.bind(null,r,s,i,e),void 0,null),i},useId:function(){var t=Cg(),e=Ba.identifierPrefix;if(xs){var i=W0,r=q0;i=(r&~(1<<32-nm(r)-1)).toString(32)+i,e=":"+e+"R"+i,i=OL++,0<i&&(e+="H"+i.toString(32)),e+=":"}else i=p9e++,e=":"+e+"r"+i.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},_9e={readContext:Ap,useCallback:zTe,useContext:Ap,useEffect:wre,useImperativeHandle:VTe,useInsertionEffect:FTe,useLayoutEffect:kTe,useMemo:BTe,useReducer:bj,useRef:NTe,useState:function(){return bj(PL)},useDebugValue:xre,useDeferredValue:function(t){var e=Rp();return jTe(e,ca.memoizedState,t)},useTransition:function(){var t=bj(PL)[0],e=Rp().memoizedState;return[t,e]},useMutableSource:MTe,useSyncExternalStore:OTe,useId:GTe,unstable_isNewReconciler:!1},v9e={readContext:Ap,useCallback:zTe,useContext:Ap,useEffect:wre,useImperativeHandle:VTe,useInsertionEffect:FTe,useLayoutEffect:kTe,useMemo:BTe,useReducer:wj,useRef:NTe,useState:function(){return wj(PL)},useDebugValue:xre,useDeferredValue:function(t){var e=Rp();return ca===null?e.memoizedState=t:jTe(e,ca.memoizedState,t)},useTransition:function(){var t=wj(PL)[0],e=Rp().memoizedState;return[t,e]},useMutableSource:MTe,useSyncExternalStore:OTe,useId:GTe,unstable_isNewReconciler:!1};function lM(t,e){try{var i="",r=e;do i+=WVe(r),r=r.return;while(r);var n=i}catch(s){n=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:n,digest:null}}function xj(t,e,i){return{value:t,source:null,stack:i??null,digest:e??null}}function kX(t,e){try{console.error(e.value)}catch(i){setTimeout(function(){throw i})}}var b9e=typeof WeakMap=="function"?WeakMap:Map;function XTe(t,e,i){i=r_(-1,i),i.tag=3,i.payload={element:null};var r=e.value;return i.callback=function(){P8||(P8=!0,XX=r),kX(t,e)},i}function YTe(t,e,i){i=r_(-1,i),i.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var n=e.value;i.payload=function(){return r(n)},i.callback=function(){kX(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(i.callback=function(){kX(t,e),typeof r!="function"&&($b===null?$b=new Set([this]):$b.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),i}function zue(t,e,i){var r=t.pingCache;if(r===null){r=t.pingCache=new b9e;var n=new Set;r.set(e,n)}else n=r.get(e),n===void 0&&(n=new Set,r.set(e,n));n.has(i)||(n.add(i),t=L9e.bind(null,t,e,i),e.then(t,t))}function Bue(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function jue(t,e,i,r,n){return t.mode&1?(t.flags|=65536,t.lanes=n,t):(t===e?t.flags|=65536:(t.flags|=128,i.flags|=131072,i.flags&=-52805,i.tag===1&&(i.alternate===null?i.tag=17:(e=r_(-1,1),e.tag=2,Ib(i,e,1))),i.lanes|=1),t)}var w9e=k_.ReactCurrentOwner,Uu=!1;function Lc(t,e,i,r){e.child=t===null?ATe(e,null,i,r):oM(e,t.child,i,r)}function Gue(t,e,i,r,n){i=i.render;var s=e.ref;return TR(e,n),r=vre(t,e,i,r,s,n),i=bre(),t!==null&&!Uu?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~n,w_(t,e,n)):(xs&&i&&are(e),e.flags|=1,Lc(t,e,r,n),e.child)}function Hue(t,e,i,r,n){if(t===null){var s=i.type;return typeof s=="function"&&!Ore(s)&&s.defaultProps===void 0&&i.compare===null&&i.defaultProps===void 0?(e.tag=15,e.type=s,ZTe(t,e,s,r,n)):(t=i6(i.type,null,r,e,e.mode,n),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&n)){var o=s.memoizedProps;if(i=i.compare,i=i!==null?i:SL,i(o,r)&&t.ref===e.ref)return w_(t,e,n)}return e.flags|=1,t=Db(s,r),t.ref=e.ref,t.return=e,e.child=t}function ZTe(t,e,i,r,n){if(t!==null){var s=t.memoizedProps;if(SL(s,r)&&t.ref===e.ref)if(Uu=!1,e.pendingProps=r=s,(t.lanes&n)!==0)t.flags&131072&&(Uu=!0);else return e.lanes=t.lanes,w_(t,e,n)}return UX(t,e,i,r,n)}function JTe(t,e,i){var r=e.pendingProps,n=r.children,s=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Yn(YA,Lh),Lh|=i;else{if(!(i&1073741824))return t=s!==null?s.baseLanes|i:i,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Yn(YA,Lh),Lh|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:i,Yn(YA,Lh),Lh|=r}else s!==null?(r=s.baseLanes|i,e.memoizedState=null):r=i,Yn(YA,Lh),Lh|=r;return Lc(t,e,n,i),e.child}function KTe(t,e){var i=e.ref;(t===null&&i!==null||t!==null&&t.ref!==i)&&(e.flags|=512,e.flags|=2097152)}function UX(t,e,i,r,n){var s=Gu(i)?YS:Kl.current;return s=nM(e,s),TR(e,n),i=vre(t,e,i,r,s,n),r=bre(),t!==null&&!Uu?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~n,w_(t,e,n)):(xs&&r&&are(e),e.flags|=1,Lc(t,e,i,n),e.child)}function que(t,e,i,r,n){if(Gu(i)){var s=!0;w8(e)}else s=!1;if(TR(e,n),e.stateNode===null)Qk(t,e),ETe(e,i,r),FX(e,i,r,n),r=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=i.contextType;typeof c=="object"&&c!==null?c=Ap(c):(c=Gu(i)?YS:Kl.current,c=nM(e,c));var h=i.getDerivedStateFromProps,p=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function";p||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==c)&&Fue(e,o,r,c),N1=!1;var f=e.memoizedState;o.state=f,C8(e,r,o,n),l=e.memoizedState,a!==r||f!==l||ju.current||N1?(typeof h=="function"&&(NX(e,i,h,r),l=e.memoizedState),(a=N1||Nue(e,i,a,r,f,l,c))?(p||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=c,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,TTe(t,e),a=e.memoizedProps,c=e.type===e.elementType?a:$f(e.type,a),o.props=c,p=e.pendingProps,f=o.context,l=i.contextType,typeof l=="object"&&l!==null?l=Ap(l):(l=Gu(i)?YS:Kl.current,l=nM(e,l));var m=i.getDerivedStateFromProps;(h=typeof m=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==p||f!==l)&&Fue(e,o,r,l),N1=!1,f=e.memoizedState,o.state=f,C8(e,r,o,n);var g=e.memoizedState;a!==p||f!==g||ju.current||N1?(typeof m=="function"&&(NX(e,i,m,r),g=e.memoizedState),(c=N1||Nue(e,i,c,r,f,g,l)||!1)?(h||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,g,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,g,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=g),o.props=r,o.state=g,o.context=l,r=c):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),r=!1)}return VX(t,e,i,r,s,n)}function VX(t,e,i,r,n,s){KTe(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return n&&Pue(e,i,!1),w_(t,e,s);r=e.stateNode,w9e.current=e;var a=o&&typeof i.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=oM(e,t.child,null,s),e.child=oM(e,null,a,s)):Lc(t,e,a,s),e.memoizedState=r.state,n&&Pue(e,i,!0),e.child}function QTe(t){var e=t.stateNode;e.pendingContext?Oue(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Oue(t,e.context,!1),mre(t,e.containerInfo)}function Wue(t,e,i,r,n){return sM(),cre(n),e.flags|=256,Lc(t,e,i,r),e.child}var zX={dehydrated:null,treeContext:null,retryLane:0};function BX(t){return{baseLanes:t,cachePool:null,transitions:null}}function eSe(t,e,i){var r=e.pendingProps,n=Rs.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(n&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(n|=1),Yn(Rs,n&1),t===null)return LX(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,s?(r=e.mode,s=e.child,o={mode:"hidden",children:o},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=v9(o,r,0,null),t=PS(t,r,i,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=BX(i),e.memoizedState=zX,t):Tre(e,o));if(n=t.memoizedState,n!==null&&(a=n.dehydrated,a!==null))return x9e(t,e,o,r,a,n,i);if(s){s=r.fallback,o=e.mode,n=t.child,a=n.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==n?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=Db(n,l),r.subtreeFlags=n.subtreeFlags&14680064),a!==null?s=Db(a,s):(s=PS(s,o,i,null),s.flags|=2),s.return=e,r.return=e,r.sibling=s,e.child=r,r=s,s=e.child,o=t.child.memoizedState,o=o===null?BX(i):{baseLanes:o.baseLanes|i,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~i,e.memoizedState=zX,r}return s=t.child,t=s.sibling,r=Db(s,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=i),r.return=e,r.sibling=null,t!==null&&(i=e.deletions,i===null?(e.deletions=[t],e.flags|=16):i.push(t)),e.child=r,e.memoizedState=null,r}function Tre(t,e){return e=v9({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function CF(t,e,i,r){return r!==null&&cre(r),oM(e,t.child,null,i),t=Tre(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function x9e(t,e,i,r,n,s,o){if(i)return e.flags&256?(e.flags&=-257,r=xj(Error(je(422))),CF(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=r.fallback,n=e.mode,r=v9({mode:"visible",children:r.children},n,0,null),s=PS(s,n,o,null),s.flags|=2,r.return=e,s.return=e,r.sibling=s,e.child=r,e.mode&1&&oM(e,t.child,null,o),e.child.memoizedState=BX(o),e.memoizedState=zX,s);if(!(e.mode&1))return CF(t,e,o,null);if(n.data==="$!"){if(r=n.nextSibling&&n.nextSibling.dataset,r)var a=r.dgst;return r=a,s=Error(je(419)),r=xj(s,r,void 0),CF(t,e,o,r)}if(a=(o&t.childLanes)!==0,Uu||a){if(r=Ba,r!==null){switch(o&-o){case 4:n=2;break;case 16:n=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:n=32;break;case 536870912:n=268435456;break;default:n=0}n=n&(r.suspendedLanes|o)?0:n,n!==0&&n!==s.retryLane&&(s.retryLane=n,b_(t,n),sm(r,t,n,-1))}return Mre(),r=xj(Error(je(421))),CF(t,e,o,r)}return n.data==="$?"?(e.flags|=128,e.child=t.child,e=D9e.bind(null,t),n._reactRetry=e,null):(t=s.treeContext,Zh=Pb(n.nextSibling),Qh=e,xs=!0,Bf=null,t!==null&&(ep[tp++]=q0,ep[tp++]=W0,ep[tp++]=ZS,q0=t.id,W0=t.overflow,ZS=e),e=Tre(e,r.children),e.flags|=4096,e)}function Xue(t,e,i){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),DX(t.return,e,i)}function Tj(t,e,i,r,n){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:i,tailMode:n}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=i,s.tailMode=n)}function tSe(t,e,i){var r=e.pendingProps,n=r.revealOrder,s=r.tail;if(Lc(t,e,r.children,i),r=Rs.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Xue(t,i,e);else if(t.tag===19)Xue(t,i,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(Yn(Rs,r),!(e.mode&1))e.memoizedState=null;else switch(n){case"forwards":for(i=e.child,n=null;i!==null;)t=i.alternate,t!==null&&A8(t)===null&&(n=i),i=i.sibling;i=n,i===null?(n=e.child,e.child=null):(n=i.sibling,i.sibling=null),Tj(e,!1,n,i,s);break;case"backwards":for(i=null,n=e.child,e.child=null;n!==null;){if(t=n.alternate,t!==null&&A8(t)===null){e.child=n;break}t=n.sibling,n.sibling=i,i=n,n=t}Tj(e,!0,i,null,s);break;case"together":Tj(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Qk(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function w_(t,e,i){if(t!==null&&(e.dependencies=t.dependencies),KS|=e.lanes,!(i&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(je(153));if(e.child!==null){for(t=e.child,i=Db(t,t.pendingProps),e.child=i,i.return=e;t.sibling!==null;)t=t.sibling,i=i.sibling=Db(t,t.pendingProps),i.return=e;i.sibling=null}return e.child}function T9e(t,e,i){switch(e.tag){case 3:QTe(e),sM();break;case 5:RTe(e);break;case 1:Gu(e.type)&&w8(e);break;case 4:mre(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,n=e.memoizedProps.value;Yn(S8,r._currentValue),r._currentValue=n;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Yn(Rs,Rs.current&1),e.flags|=128,null):i&e.child.childLanes?eSe(t,e,i):(Yn(Rs,Rs.current&1),t=w_(t,e,i),t!==null?t.sibling:null);Yn(Rs,Rs.current&1);break;case 19:if(r=(i&e.childLanes)!==0,t.flags&128){if(r)return tSe(t,e,i);e.flags|=128}if(n=e.memoizedState,n!==null&&(n.rendering=null,n.tail=null,n.lastEffect=null),Yn(Rs,Rs.current),r)break;return null;case 22:case 23:return e.lanes=0,JTe(t,e,i)}return w_(t,e,i)}var iSe,jX,rSe,nSe;iSe=function(t,e){for(var i=e.child;i!==null;){if(i.tag===5||i.tag===6)t.appendChild(i.stateNode);else if(i.tag!==4&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===e)break;for(;i.sibling===null;){if(i.return===null||i.return===e)return;i=i.return}i.sibling.return=i.return,i=i.sibling}};jX=function(){};rSe=function(t,e,i,r){var n=t.memoizedProps;if(n!==r){t=e.stateNode,pS(Xg.current);var s=null;switch(i){case"input":n=hX(t,n),r=hX(t,r),s=[];break;case"select":n=Ps({},n,{value:void 0}),r=Ps({},r,{value:void 0}),s=[];break;case"textarea":n=fX(t,n),r=fX(t,r),s=[];break;default:typeof n.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=v8)}gX(i,r);var o;i=null;for(c in n)if(!r.hasOwnProperty(c)&&n.hasOwnProperty(c)&&n[c]!=null)if(c==="style"){var a=n[c];for(o in a)a.hasOwnProperty(o)&&(i||(i={}),i[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(yL.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in r){var l=r[c];if(a=n!=null?n[c]:void 0,r.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(i||(i={}),i[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(i||(i={}),i[o]=l[o])}else i||(s||(s=[]),s.push(c,i)),i=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(yL.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&rs("scroll",t),s||a===l||(s=[])):(s=s||[]).push(c,l))}i&&(s=s||[]).push("style",i);var c=s;(e.updateQueue=c)&&(e.flags|=4)}};nSe=function(t,e,i,r){i!==r&&(e.flags|=4)};function n3(t,e){if(!xs)switch(t.tailMode){case"hidden":e=t.tail;for(var i=null;e!==null;)e.alternate!==null&&(i=e),e=e.sibling;i===null?t.tail=null:i.sibling=null;break;case"collapsed":i=t.tail;for(var r=null;i!==null;)i.alternate!==null&&(r=i),i=i.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Sl(t){var e=t.alternate!==null&&t.alternate.child===t.child,i=0,r=0;if(e)for(var n=t.child;n!==null;)i|=n.lanes|n.childLanes,r|=n.subtreeFlags&14680064,r|=n.flags&14680064,n.return=t,n=n.sibling;else for(n=t.child;n!==null;)i|=n.lanes|n.childLanes,r|=n.subtreeFlags,r|=n.flags,n.return=t,n=n.sibling;return t.subtreeFlags|=r,t.childLanes=i,e}function S9e(t,e,i){var r=e.pendingProps;switch(lre(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Sl(e),null;case 1:return Gu(e.type)&&b8(),Sl(e),null;case 3:return r=e.stateNode,aM(),ms(ju),ms(Kl),yre(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(SF(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Bf!==null&&(JX(Bf),Bf=null))),jX(t,e),Sl(e),null;case 5:gre(e);var n=pS(ML.current);if(i=e.type,t!==null&&e.stateNode!=null)rSe(t,e,i,r,n),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(je(166));return Sl(e),null}if(t=pS(Xg.current),SF(e)){r=e.stateNode,i=e.type;var s=e.memoizedProps;switch(r[Lg]=e,r[AL]=s,t=(e.mode&1)!==0,i){case"dialog":rs("cancel",r),rs("close",r);break;case"iframe":case"object":case"embed":rs("load",r);break;case"video":case"audio":for(n=0;n<xP.length;n++)rs(xP[n],r);break;case"source":rs("error",r);break;case"img":case"image":case"link":rs("error",r),rs("load",r);break;case"details":rs("toggle",r);break;case"input":rue(r,s),rs("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},rs("invalid",r);break;case"textarea":sue(r,s),rs("invalid",r)}gX(i,s),n=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?r.textContent!==a&&(s.suppressHydrationWarning!==!0&&TF(r.textContent,a,t),n=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&TF(r.textContent,a,t),n=["children",""+a]):yL.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&rs("scroll",r)}switch(i){case"input":mF(r),nue(r,s,!0);break;case"textarea":mF(r),oue(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=v8)}r=n,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=n.nodeType===9?n:n.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=Pxe(i)),t==="http://www.w3.org/1999/xhtml"?i==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(i,{is:r.is}):(t=o.createElement(i),i==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,i),t[Lg]=e,t[AL]=r,iSe(t,e,!1,!1),e.stateNode=t;e:{switch(o=yX(i,r),i){case"dialog":rs("cancel",t),rs("close",t),n=r;break;case"iframe":case"object":case"embed":rs("load",t),n=r;break;case"video":case"audio":for(n=0;n<xP.length;n++)rs(xP[n],t);n=r;break;case"source":rs("error",t),n=r;break;case"img":case"image":case"link":rs("error",t),rs("load",t),n=r;break;case"details":rs("toggle",t),n=r;break;case"input":rue(t,r),n=hX(t,r),rs("invalid",t);break;case"option":n=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},n=Ps({},r,{value:void 0}),rs("invalid",t);break;case"textarea":sue(t,r),n=fX(t,r),rs("invalid",t);break;default:n=r}gX(i,n),a=n;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?Lxe(t,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&Ixe(t,l)):s==="children"?typeof l=="string"?(i!=="textarea"||l!=="")&&_L(t,l):typeof l=="number"&&_L(t,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(yL.hasOwnProperty(s)?l!=null&&s==="onScroll"&&rs("scroll",t):l!=null&&Wie(t,s,l,o))}switch(i){case"input":mF(t),nue(t,r,!1);break;case"textarea":mF(t),oue(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Yb(r.value));break;case"select":t.multiple=!!r.multiple,s=r.value,s!=null?vR(t,!!r.multiple,s,!1):r.defaultValue!=null&&vR(t,!!r.multiple,r.defaultValue,!0);break;default:typeof n.onClick=="function"&&(t.onclick=v8)}switch(i){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Sl(e),null;case 6:if(t&&e.stateNode!=null)nSe(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(je(166));if(i=pS(ML.current),pS(Xg.current),SF(e)){if(r=e.stateNode,i=e.memoizedProps,r[Lg]=e,(s=r.nodeValue!==i)&&(t=Qh,t!==null))switch(t.tag){case 3:TF(r.nodeValue,i,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&TF(r.nodeValue,i,(t.mode&1)!==0)}s&&(e.flags|=4)}else r=(i.nodeType===9?i:i.ownerDocument).createTextNode(r),r[Lg]=e,e.stateNode=r}return Sl(e),null;case 13:if(ms(Rs),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(xs&&Zh!==null&&e.mode&1&&!(e.flags&128))wTe(),sM(),e.flags|=98560,s=!1;else if(s=SF(e),r!==null&&r.dehydrated!==null){if(t===null){if(!s)throw Error(je(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(je(317));s[Lg]=e}else sM(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Sl(e),s=!1}else Bf!==null&&(JX(Bf),Bf=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=i,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||Rs.current&1?fa===0&&(fa=3):Mre())),e.updateQueue!==null&&(e.flags|=4),Sl(e),null);case 4:return aM(),jX(t,e),t===null&&EL(e.stateNode.containerInfo),Sl(e),null;case 10:return dre(e.type._context),Sl(e),null;case 17:return Gu(e.type)&&b8(),Sl(e),null;case 19:if(ms(Rs),s=e.memoizedState,s===null)return Sl(e),null;if(r=(e.flags&128)!==0,o=s.rendering,o===null)if(r)n3(s,!1);else{if(fa!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=A8(t),o!==null){for(e.flags|=128,n3(s,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=i,i=e.child;i!==null;)s=i,t=r,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),i=i.sibling;return Yn(Rs,Rs.current&1|2),e.child}t=t.sibling}s.tail!==null&&po()>cM&&(e.flags|=128,r=!0,n3(s,!1),e.lanes=4194304)}else{if(!r)if(t=A8(o),t!==null){if(e.flags|=128,r=!0,i=t.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),n3(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!xs)return Sl(e),null}else 2*po()-s.renderingStartTime>cM&&i!==1073741824&&(e.flags|=128,r=!0,n3(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(i=s.last,i!==null?i.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=po(),e.sibling=null,i=Rs.current,Yn(Rs,r?i&1|2:i&1),e):(Sl(e),null);case 22:case 23:return Rre(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Lh&1073741824&&(Sl(e),e.subtreeFlags&6&&(e.flags|=8192)):Sl(e),null;case 24:return null;case 25:return null}throw Error(je(156,e.tag))}function E9e(t,e){switch(lre(e),e.tag){case 1:return Gu(e.type)&&b8(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return aM(),ms(ju),ms(Kl),yre(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return gre(e),null;case 13:if(ms(Rs),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(je(340));sM()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return ms(Rs),null;case 4:return aM(),null;case 10:return dre(e.type._context),null;case 22:case 23:return Rre(),null;case 24:return null;default:return null}}var AF=!1,jl=!1,C9e=typeof WeakSet=="function"?WeakSet:Set,xt=null;function XA(t,e){var i=t.ref;if(i!==null)if(typeof i=="function")try{i(null)}catch(r){Hs(t,e,r)}else i.current=null}function GX(t,e,i){try{i()}catch(r){Hs(t,e,r)}}var Yue=!1;function A9e(t,e){if(AX=g8,t=lTe(),ore(t)){if("selectionStart"in t)var i={start:t.selectionStart,end:t.selectionEnd};else e:{i=(i=t.ownerDocument)&&i.defaultView||window;var r=i.getSelection&&i.getSelection();if(r&&r.rangeCount!==0){i=r.anchorNode;var n=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{i.nodeType,s.nodeType}catch{i=null;break e}var o=0,a=-1,l=-1,c=0,h=0,p=t,f=null;t:for(;;){for(var m;p!==i||n!==0&&p.nodeType!==3||(a=o+n),p!==s||r!==0&&p.nodeType!==3||(l=o+r),p.nodeType===3&&(o+=p.nodeValue.length),(m=p.firstChild)!==null;)f=p,p=m;for(;;){if(p===t)break t;if(f===i&&++c===n&&(a=o),f===s&&++h===r&&(l=o),(m=p.nextSibling)!==null)break;p=f,f=p.parentNode}p=m}i=a===-1||l===-1?null:{start:a,end:l}}else i=null}i=i||{start:0,end:0}}else i=null;for(RX={focusedElem:t,selectionRange:i},g8=!1,xt=e;xt!==null;)if(e=xt,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,xt=t;else for(;xt!==null;){e=xt;try{var g=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var _=g.memoizedProps,b=g.memoizedState,w=e.stateNode,x=w.getSnapshotBeforeUpdate(e.elementType===e.type?_:$f(e.type,_),b);w.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var T=e.stateNode.containerInfo;T.nodeType===1?T.textContent="":T.nodeType===9&&T.documentElement&&T.removeChild(T.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(je(163))}}catch(E){Hs(e,e.return,E)}if(t=e.sibling,t!==null){t.return=e.return,xt=t;break}xt=e.return}return g=Yue,Yue=!1,g}function m$(t,e,i){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var n=r=r.next;do{if((n.tag&t)===t){var s=n.destroy;n.destroy=void 0,s!==void 0&&GX(e,i,s)}n=n.next}while(n!==r)}}function y9(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var i=e=e.next;do{if((i.tag&t)===t){var r=i.create;i.destroy=r()}i=i.next}while(i!==e)}}function HX(t){var e=t.ref;if(e!==null){var i=t.stateNode;switch(t.tag){case 5:t=i;break;default:t=i}typeof e=="function"?e(t):e.current=t}}function sSe(t){var e=t.alternate;e!==null&&(t.alternate=null,sSe(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Lg],delete e[AL],delete e[PX],delete e[c9e],delete e[u9e])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function oSe(t){return t.tag===5||t.tag===3||t.tag===4}function Zue(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||oSe(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function qX(t,e,i){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?i.nodeType===8?i.parentNode.insertBefore(t,e):i.insertBefore(t,e):(i.nodeType===8?(e=i.parentNode,e.insertBefore(t,i)):(e=i,e.appendChild(t)),i=i._reactRootContainer,i!=null||e.onclick!==null||(e.onclick=v8));else if(r!==4&&(t=t.child,t!==null))for(qX(t,e,i),t=t.sibling;t!==null;)qX(t,e,i),t=t.sibling}function WX(t,e,i){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?i.insertBefore(t,e):i.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(WX(t,e,i),t=t.sibling;t!==null;)WX(t,e,i),t=t.sibling}var il=null,Ff=!1;function lv(t,e,i){for(i=i.child;i!==null;)aSe(t,e,i),i=i.sibling}function aSe(t,e,i){if(Wg&&typeof Wg.onCommitFiberUnmount=="function")try{Wg.onCommitFiberUnmount(c9,i)}catch{}switch(i.tag){case 5:jl||XA(i,e);case 6:var r=il,n=Ff;il=null,lv(t,e,i),il=r,Ff=n,il!==null&&(Ff?(t=il,i=i.stateNode,t.nodeType===8?t.parentNode.removeChild(i):t.removeChild(i)):il.removeChild(i.stateNode));break;case 18:il!==null&&(Ff?(t=il,i=i.stateNode,t.nodeType===8?gj(t.parentNode,i):t.nodeType===1&&gj(t,i),xL(t)):gj(il,i.stateNode));break;case 4:r=il,n=Ff,il=i.stateNode.containerInfo,Ff=!0,lv(t,e,i),il=r,Ff=n;break;case 0:case 11:case 14:case 15:if(!jl&&(r=i.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){n=r=r.next;do{var s=n,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&GX(i,e,o),n=n.next}while(n!==r)}lv(t,e,i);break;case 1:if(!jl&&(XA(i,e),r=i.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=i.memoizedProps,r.state=i.memoizedState,r.componentWillUnmount()}catch(a){Hs(i,e,a)}lv(t,e,i);break;case 21:lv(t,e,i);break;case 22:i.mode&1?(jl=(r=jl)||i.memoizedState!==null,lv(t,e,i),jl=r):lv(t,e,i);break;default:lv(t,e,i)}}function Jue(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var i=t.stateNode;i===null&&(i=t.stateNode=new C9e),e.forEach(function(r){var n=N9e.bind(null,t,r);i.has(r)||(i.add(r),r.then(n,n))})}}function qp(t,e){var i=e.deletions;if(i!==null)for(var r=0;r<i.length;r++){var n=i[r];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:il=a.stateNode,Ff=!1;break e;case 3:il=a.stateNode.containerInfo,Ff=!0;break e;case 4:il=a.stateNode.containerInfo,Ff=!0;break e}a=a.return}if(il===null)throw Error(je(160));aSe(s,o,n),il=null,Ff=!1;var l=n.alternate;l!==null&&(l.return=null),n.return=null}catch(c){Hs(n,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)lSe(e,t),e=e.sibling}function lSe(t,e){var i=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(qp(e,t),Im(t),r&4){try{m$(3,t,t.return),y9(3,t)}catch(_){Hs(t,t.return,_)}try{m$(5,t,t.return)}catch(_){Hs(t,t.return,_)}}break;case 1:qp(e,t),Im(t),r&512&&i!==null&&XA(i,i.return);break;case 5:if(qp(e,t),Im(t),r&512&&i!==null&&XA(i,i.return),t.flags&32){var n=t.stateNode;try{_L(n,"")}catch(_){Hs(t,t.return,_)}}if(r&4&&(n=t.stateNode,n!=null)){var s=t.memoizedProps,o=i!==null?i.memoizedProps:s,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&Mxe(n,s),yX(a,o);var c=yX(a,s);for(o=0;o<l.length;o+=2){var h=l[o],p=l[o+1];h==="style"?Lxe(n,p):h==="dangerouslySetInnerHTML"?Ixe(n,p):h==="children"?_L(n,p):Wie(n,h,p,c)}switch(a){case"input":dX(n,s);break;case"textarea":Oxe(n,s);break;case"select":var f=n._wrapperState.wasMultiple;n._wrapperState.wasMultiple=!!s.multiple;var m=s.value;m!=null?vR(n,!!s.multiple,m,!1):f!==!!s.multiple&&(s.defaultValue!=null?vR(n,!!s.multiple,s.defaultValue,!0):vR(n,!!s.multiple,s.multiple?[]:"",!1))}n[AL]=s}catch(_){Hs(t,t.return,_)}}break;case 6:if(qp(e,t),Im(t),r&4){if(t.stateNode===null)throw Error(je(162));n=t.stateNode,s=t.memoizedProps;try{n.nodeValue=s}catch(_){Hs(t,t.return,_)}}break;case 3:if(qp(e,t),Im(t),r&4&&i!==null&&i.memoizedState.isDehydrated)try{xL(e.containerInfo)}catch(_){Hs(t,t.return,_)}break;case 4:qp(e,t),Im(t);break;case 13:qp(e,t),Im(t),n=t.child,n.flags&8192&&(s=n.memoizedState!==null,n.stateNode.isHidden=s,!s||n.alternate!==null&&n.alternate.memoizedState!==null||(Cre=po())),r&4&&Jue(t);break;case 22:if(h=i!==null&&i.memoizedState!==null,t.mode&1?(jl=(c=jl)||h,qp(e,t),jl=c):qp(e,t),Im(t),r&8192){if(c=t.memoizedState!==null,(t.stateNode.isHidden=c)&&!h&&t.mode&1)for(xt=t,h=t.child;h!==null;){for(p=xt=h;xt!==null;){switch(f=xt,m=f.child,f.tag){case 0:case 11:case 14:case 15:m$(4,f,f.return);break;case 1:XA(f,f.return);var g=f.stateNode;if(typeof g.componentWillUnmount=="function"){r=f,i=f.return;try{e=r,g.props=e.memoizedProps,g.state=e.memoizedState,g.componentWillUnmount()}catch(_){Hs(r,i,_)}}break;case 5:XA(f,f.return);break;case 22:if(f.memoizedState!==null){Que(p);continue}}m!==null?(m.return=f,xt=m):Que(p)}h=h.sibling}e:for(h=null,p=t;;){if(p.tag===5){if(h===null){h=p;try{n=p.stateNode,c?(s=n.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=p.stateNode,l=p.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=$xe("display",o))}catch(_){Hs(t,t.return,_)}}}else if(p.tag===6){if(h===null)try{p.stateNode.nodeValue=c?"":p.memoizedProps}catch(_){Hs(t,t.return,_)}}else if((p.tag!==22&&p.tag!==23||p.memoizedState===null||p===t)&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===t)break e;for(;p.sibling===null;){if(p.return===null||p.return===t)break e;h===p&&(h=null),p=p.return}h===p&&(h=null),p.sibling.return=p.return,p=p.sibling}}break;case 19:qp(e,t),Im(t),r&4&&Jue(t);break;case 21:break;default:qp(e,t),Im(t)}}function Im(t){var e=t.flags;if(e&2){try{e:{for(var i=t.return;i!==null;){if(oSe(i)){var r=i;break e}i=i.return}throw Error(je(160))}switch(r.tag){case 5:var n=r.stateNode;r.flags&32&&(_L(n,""),r.flags&=-33);var s=Zue(t);WX(t,s,n);break;case 3:case 4:var o=r.stateNode.containerInfo,a=Zue(t);qX(t,a,o);break;default:throw Error(je(161))}}catch(l){Hs(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function R9e(t,e,i){xt=t,cSe(t)}function cSe(t,e,i){for(var r=(t.mode&1)!==0;xt!==null;){var n=xt,s=n.child;if(n.tag===22&&r){var o=n.memoizedState!==null||AF;if(!o){var a=n.alternate,l=a!==null&&a.memoizedState!==null||jl;a=AF;var c=jl;if(AF=o,(jl=l)&&!c)for(xt=n;xt!==null;)o=xt,l=o.child,o.tag===22&&o.memoizedState!==null?ehe(n):l!==null?(l.return=o,xt=l):ehe(n);for(;s!==null;)xt=s,cSe(s),s=s.sibling;xt=n,AF=a,jl=c}Kue(t)}else n.subtreeFlags&8772&&s!==null?(s.return=n,xt=s):Kue(t)}}function Kue(t){for(;xt!==null;){var e=xt;if(e.flags&8772){var i=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:jl||y9(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!jl)if(i===null)r.componentDidMount();else{var n=e.elementType===e.type?i.memoizedProps:$f(e.type,i.memoizedProps);r.componentDidUpdate(n,i.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&Due(e,s,r);break;case 3:var o=e.updateQueue;if(o!==null){if(i=null,e.child!==null)switch(e.child.tag){case 5:i=e.child.stateNode;break;case 1:i=e.child.stateNode}Due(e,o,i)}break;case 5:var a=e.stateNode;if(i===null&&e.flags&4){i=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&i.focus();break;case"img":l.src&&(i.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var h=c.memoizedState;if(h!==null){var p=h.dehydrated;p!==null&&xL(p)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(je(163))}jl||e.flags&512&&HX(e)}catch(f){Hs(e,e.return,f)}}if(e===t){xt=null;break}if(i=e.sibling,i!==null){i.return=e.return,xt=i;break}xt=e.return}}function Que(t){for(;xt!==null;){var e=xt;if(e===t){xt=null;break}var i=e.sibling;if(i!==null){i.return=e.return,xt=i;break}xt=e.return}}function ehe(t){for(;xt!==null;){var e=xt;try{switch(e.tag){case 0:case 11:case 15:var i=e.return;try{y9(4,e)}catch(l){Hs(e,i,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var n=e.return;try{r.componentDidMount()}catch(l){Hs(e,n,l)}}var s=e.return;try{HX(e)}catch(l){Hs(e,s,l)}break;case 5:var o=e.return;try{HX(e)}catch(l){Hs(e,o,l)}}}catch(l){Hs(e,e.return,l)}if(e===t){xt=null;break}var a=e.sibling;if(a!==null){a.return=e.return,xt=a;break}xt=e.return}}var M9e=Math.ceil,O8=k_.ReactCurrentDispatcher,Sre=k_.ReactCurrentOwner,vp=k_.ReactCurrentBatchConfig,$r=0,Ba=null,No=null,hl=0,Lh=0,YA=Rw(0),fa=0,$L=null,KS=0,_9=0,Ere=0,g$=null,Lu=null,Cre=0,cM=1/0,P0=null,P8=!1,XX=null,$b=null,RF=!1,ob=null,I8=0,y$=0,YX=null,e6=-1,t6=0;function Hc(){return $r&6?po():e6!==-1?e6:e6=po()}function Lb(t){return t.mode&1?$r&2&&hl!==0?hl&-hl:d9e.transition!==null?(t6===0&&(t6=qxe()),t6):(t=yn,t!==0||(t=window.event,t=t===void 0?16:Qxe(t.type)),t):1}function sm(t,e,i,r){if(50<y$)throw y$=0,YX=null,Error(je(185));iN(t,i,r),(!($r&2)||t!==Ba)&&(t===Ba&&(!($r&2)&&(_9|=i),fa===4&&Y1(t,hl)),Hu(t,r),i===1&&$r===0&&!(e.mode&1)&&(cM=po()+500,f9&&Mw()))}function Hu(t,e){var i=t.callbackNode;dze(t,e);var r=m8(t,t===Ba?hl:0);if(r===0)i!==null&&cue(i),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(i!=null&&cue(i),e===1)t.tag===0?h9e(the.bind(null,t)):_Te(the.bind(null,t)),a9e(function(){!($r&6)&&Mw()}),i=null;else{switch(Wxe(r)){case 1:i=Kie;break;case 4:i=Gxe;break;case 16:i=f8;break;case 536870912:i=Hxe;break;default:i=f8}i=ySe(i,uSe.bind(null,t))}t.callbackPriority=e,t.callbackNode=i}}function uSe(t,e){if(e6=-1,t6=0,$r&6)throw Error(je(327));var i=t.callbackNode;if(SR()&&t.callbackNode!==i)return null;var r=m8(t,t===Ba?hl:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=$8(t,r);else{e=r;var n=$r;$r|=2;var s=dSe();(Ba!==t||hl!==e)&&(P0=null,cM=po()+500,OS(t,e));do try{I9e();break}catch(a){hSe(t,a)}while(1);hre(),O8.current=s,$r=n,No!==null?e=0:(Ba=null,hl=0,e=fa)}if(e!==0){if(e===2&&(n=xX(t),n!==0&&(r=n,e=ZX(t,n))),e===1)throw i=$L,OS(t,0),Y1(t,r),Hu(t,po()),i;if(e===6)Y1(t,r);else{if(n=t.current.alternate,!(r&30)&&!O9e(n)&&(e=$8(t,r),e===2&&(s=xX(t),s!==0&&(r=s,e=ZX(t,s))),e===1))throw i=$L,OS(t,0),Y1(t,r),Hu(t,po()),i;switch(t.finishedWork=n,t.finishedLanes=r,e){case 0:case 1:throw Error(je(345));case 2:Fx(t,Lu,P0);break;case 3:if(Y1(t,r),(r&130023424)===r&&(e=Cre+500-po(),10<e)){if(m8(t,0)!==0)break;if(n=t.suspendedLanes,(n&r)!==r){Hc(),t.pingedLanes|=t.suspendedLanes&n;break}t.timeoutHandle=OX(Fx.bind(null,t,Lu,P0),e);break}Fx(t,Lu,P0);break;case 4:if(Y1(t,r),(r&4194240)===r)break;for(e=t.eventTimes,n=-1;0<r;){var o=31-nm(r);s=1<<o,o=e[o],o>n&&(n=o),r&=~s}if(r=n,r=po()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*M9e(r/1960))-r,10<r){t.timeoutHandle=OX(Fx.bind(null,t,Lu,P0),r);break}Fx(t,Lu,P0);break;case 5:Fx(t,Lu,P0);break;default:throw Error(je(329))}}}return Hu(t,po()),t.callbackNode===i?uSe.bind(null,t):null}function ZX(t,e){var i=g$;return t.current.memoizedState.isDehydrated&&(OS(t,e).flags|=256),t=$8(t,e),t!==2&&(e=Lu,Lu=i,e!==null&&JX(e)),t}function JX(t){Lu===null?Lu=t:Lu.push.apply(Lu,t)}function O9e(t){for(var e=t;;){if(e.flags&16384){var i=e.updateQueue;if(i!==null&&(i=i.stores,i!==null))for(var r=0;r<i.length;r++){var n=i[r],s=n.getSnapshot;n=n.value;try{if(!dm(s(),n))return!1}catch{return!1}}}if(i=e.child,e.subtreeFlags&16384&&i!==null)i.return=e,e=i;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Y1(t,e){for(e&=~Ere,e&=~_9,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var i=31-nm(e),r=1<<i;t[i]=-1,e&=~r}}function the(t){if($r&6)throw Error(je(327));SR();var e=m8(t,0);if(!(e&1))return Hu(t,po()),null;var i=$8(t,e);if(t.tag!==0&&i===2){var r=xX(t);r!==0&&(e=r,i=ZX(t,r))}if(i===1)throw i=$L,OS(t,0),Y1(t,e),Hu(t,po()),i;if(i===6)throw Error(je(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Fx(t,Lu,P0),Hu(t,po()),null}function Are(t,e){var i=$r;$r|=1;try{return t(e)}finally{$r=i,$r===0&&(cM=po()+500,f9&&Mw())}}function QS(t){ob!==null&&ob.tag===0&&!($r&6)&&SR();var e=$r;$r|=1;var i=vp.transition,r=yn;try{if(vp.transition=null,yn=1,t)return t()}finally{yn=r,vp.transition=i,$r=e,!($r&6)&&Mw()}}function Rre(){Lh=YA.current,ms(YA)}function OS(t,e){t.finishedWork=null,t.finishedLanes=0;var i=t.timeoutHandle;if(i!==-1&&(t.timeoutHandle=-1,o9e(i)),No!==null)for(i=No.return;i!==null;){var r=i;switch(lre(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&b8();break;case 3:aM(),ms(ju),ms(Kl),yre();break;case 5:gre(r);break;case 4:aM();break;case 13:ms(Rs);break;case 19:ms(Rs);break;case 10:dre(r.type._context);break;case 22:case 23:Rre()}i=i.return}if(Ba=t,No=t=Db(t.current,null),hl=Lh=e,fa=0,$L=null,Ere=_9=KS=0,Lu=g$=null,dS!==null){for(e=0;e<dS.length;e++)if(i=dS[e],r=i.interleaved,r!==null){i.interleaved=null;var n=r.next,s=i.pending;if(s!==null){var o=s.next;s.next=n,r.next=o}i.pending=r}dS=null}return t}function hSe(t,e){do{var i=No;try{if(hre(),Jk.current=M8,R8){for(var r=Ms.memoizedState;r!==null;){var n=r.queue;n!==null&&(n.pending=null),r=r.next}R8=!1}if(JS=0,Da=ca=Ms=null,f$=!1,OL=0,Sre.current=null,i===null||i.return===null){fa=1,$L=e,No=null;break}e:{var s=t,o=i.return,a=i,l=e;if(e=hl,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,h=a,p=h.tag;if(!(h.mode&1)&&(p===0||p===11||p===15)){var f=h.alternate;f?(h.updateQueue=f.updateQueue,h.memoizedState=f.memoizedState,h.lanes=f.lanes):(h.updateQueue=null,h.memoizedState=null)}var m=Bue(o);if(m!==null){m.flags&=-257,jue(m,o,a,s,e),m.mode&1&&zue(s,c,e),e=m,l=c;var g=e.updateQueue;if(g===null){var _=new Set;_.add(l),e.updateQueue=_}else g.add(l);break e}else{if(!(e&1)){zue(s,c,e),Mre();break e}l=Error(je(426))}}else if(xs&&a.mode&1){var b=Bue(o);if(b!==null){!(b.flags&65536)&&(b.flags|=256),jue(b,o,a,s,e),cre(lM(l,a));break e}}s=l=lM(l,a),fa!==4&&(fa=2),g$===null?g$=[s]:g$.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var w=XTe(s,l,e);Lue(s,w);break e;case 1:a=l;var x=s.type,T=s.stateNode;if(!(s.flags&128)&&(typeof x.getDerivedStateFromError=="function"||T!==null&&typeof T.componentDidCatch=="function"&&($b===null||!$b.has(T)))){s.flags|=65536,e&=-e,s.lanes|=e;var E=YTe(s,a,e);Lue(s,E);break e}}s=s.return}while(s!==null)}fSe(i)}catch(C){e=C,No===i&&i!==null&&(No=i=i.return);continue}break}while(1)}function dSe(){var t=O8.current;return O8.current=M8,t===null?M8:t}function Mre(){(fa===0||fa===3||fa===2)&&(fa=4),Ba===null||!(KS&268435455)&&!(_9&268435455)||Y1(Ba,hl)}function $8(t,e){var i=$r;$r|=2;var r=dSe();(Ba!==t||hl!==e)&&(P0=null,OS(t,e));do try{P9e();break}catch(n){hSe(t,n)}while(1);if(hre(),$r=i,O8.current=r,No!==null)throw Error(je(261));return Ba=null,hl=0,fa}function P9e(){for(;No!==null;)pSe(No)}function I9e(){for(;No!==null&&!rze();)pSe(No)}function pSe(t){var e=gSe(t.alternate,t,Lh);t.memoizedProps=t.pendingProps,e===null?fSe(t):No=e,Sre.current=null}function fSe(t){var e=t;do{var i=e.alternate;if(t=e.return,e.flags&32768){if(i=E9e(i,e),i!==null){i.flags&=32767,No=i;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{fa=6,No=null;return}}else if(i=S9e(i,e,Lh),i!==null){No=i;return}if(e=e.sibling,e!==null){No=e;return}No=e=t}while(e!==null);fa===0&&(fa=5)}function Fx(t,e,i){var r=yn,n=vp.transition;try{vp.transition=null,yn=1,$9e(t,e,i,r)}finally{vp.transition=n,yn=r}return null}function $9e(t,e,i,r){do SR();while(ob!==null);if($r&6)throw Error(je(327));i=t.finishedWork;var n=t.finishedLanes;if(i===null)return null;if(t.finishedWork=null,t.finishedLanes=0,i===t.current)throw Error(je(177));t.callbackNode=null,t.callbackPriority=0;var s=i.lanes|i.childLanes;if(pze(t,s),t===Ba&&(No=Ba=null,hl=0),!(i.subtreeFlags&2064)&&!(i.flags&2064)||RF||(RF=!0,ySe(f8,function(){return SR(),null})),s=(i.flags&15990)!==0,i.subtreeFlags&15990||s){s=vp.transition,vp.transition=null;var o=yn;yn=1;var a=$r;$r|=4,Sre.current=null,A9e(t,i),lSe(i,t),Qze(RX),g8=!!AX,RX=AX=null,t.current=i,R9e(i),nze(),$r=a,yn=o,vp.transition=s}else t.current=i;if(RF&&(RF=!1,ob=t,I8=n),s=t.pendingLanes,s===0&&($b=null),aze(i.stateNode),Hu(t,po()),e!==null)for(r=t.onRecoverableError,i=0;i<e.length;i++)n=e[i],r(n.value,{componentStack:n.stack,digest:n.digest});if(P8)throw P8=!1,t=XX,XX=null,t;return I8&1&&t.tag!==0&&SR(),s=t.pendingLanes,s&1?t===YX?y$++:(y$=0,YX=t):y$=0,Mw(),null}function SR(){if(ob!==null){var t=Wxe(I8),e=vp.transition,i=yn;try{if(vp.transition=null,yn=16>t?16:t,ob===null)var r=!1;else{if(t=ob,ob=null,I8=0,$r&6)throw Error(je(331));var n=$r;for($r|=4,xt=t.current;xt!==null;){var s=xt,o=s.child;if(xt.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(xt=c;xt!==null;){var h=xt;switch(h.tag){case 0:case 11:case 15:m$(8,h,s)}var p=h.child;if(p!==null)p.return=h,xt=p;else for(;xt!==null;){h=xt;var f=h.sibling,m=h.return;if(sSe(h),h===c){xt=null;break}if(f!==null){f.return=m,xt=f;break}xt=m}}}var g=s.alternate;if(g!==null){var _=g.child;if(_!==null){g.child=null;do{var b=_.sibling;_.sibling=null,_=b}while(_!==null)}}xt=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,xt=o;else e:for(;xt!==null;){if(s=xt,s.flags&2048)switch(s.tag){case 0:case 11:case 15:m$(9,s,s.return)}var w=s.sibling;if(w!==null){w.return=s.return,xt=w;break e}xt=s.return}}var x=t.current;for(xt=x;xt!==null;){o=xt;var T=o.child;if(o.subtreeFlags&2064&&T!==null)T.return=o,xt=T;else e:for(o=x;xt!==null;){if(a=xt,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:y9(9,a)}}catch(C){Hs(a,a.return,C)}if(a===o){xt=null;break e}var E=a.sibling;if(E!==null){E.return=a.return,xt=E;break e}xt=a.return}}if($r=n,Mw(),Wg&&typeof Wg.onPostCommitFiberRoot=="function")try{Wg.onPostCommitFiberRoot(c9,t)}catch{}r=!0}return r}finally{yn=i,vp.transition=e}}return!1}function ihe(t,e,i){e=lM(i,e),e=XTe(t,e,1),t=Ib(t,e,1),e=Hc(),t!==null&&(iN(t,1,e),Hu(t,e))}function Hs(t,e,i){if(t.tag===3)ihe(t,t,i);else for(;e!==null;){if(e.tag===3){ihe(e,t,i);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&($b===null||!$b.has(r))){t=lM(i,t),t=YTe(e,t,1),e=Ib(e,t,1),t=Hc(),e!==null&&(iN(e,1,t),Hu(e,t));break}}e=e.return}}function L9e(t,e,i){var r=t.pingCache;r!==null&&r.delete(e),e=Hc(),t.pingedLanes|=t.suspendedLanes&i,Ba===t&&(hl&i)===i&&(fa===4||fa===3&&(hl&130023424)===hl&&500>po()-Cre?OS(t,0):Ere|=i),Hu(t,e)}function mSe(t,e){e===0&&(t.mode&1?(e=_F,_F<<=1,!(_F&130023424)&&(_F=4194304)):e=1);var i=Hc();t=b_(t,e),t!==null&&(iN(t,e,i),Hu(t,i))}function D9e(t){var e=t.memoizedState,i=0;e!==null&&(i=e.retryLane),mSe(t,i)}function N9e(t,e){var i=0;switch(t.tag){case 13:var r=t.stateNode,n=t.memoizedState;n!==null&&(i=n.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(je(314))}r!==null&&r.delete(e),mSe(t,i)}var gSe;gSe=function(t,e,i){if(t!==null)if(t.memoizedProps!==e.pendingProps||ju.current)Uu=!0;else{if(!(t.lanes&i)&&!(e.flags&128))return Uu=!1,T9e(t,e,i);Uu=!!(t.flags&131072)}else Uu=!1,xs&&e.flags&1048576&&vTe(e,T8,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Qk(t,e),t=e.pendingProps;var n=nM(e,Kl.current);TR(e,i),n=vre(null,e,r,t,n,i);var s=bre();return e.flags|=1,typeof n=="object"&&n!==null&&typeof n.render=="function"&&n.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Gu(r)?(s=!0,w8(e)):s=!1,e.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,fre(e),n.updater=m9,e.stateNode=n,n._reactInternals=e,FX(e,r,t,i),e=VX(null,e,r,!0,s,i)):(e.tag=0,xs&&s&&are(e),Lc(null,e,n,i),e=e.child),e;case 16:r=e.elementType;e:{switch(Qk(t,e),t=e.pendingProps,n=r._init,r=n(r._payload),e.type=r,n=e.tag=k9e(r),t=$f(r,t),n){case 0:e=UX(null,e,r,t,i);break e;case 1:e=que(null,e,r,t,i);break e;case 11:e=Gue(null,e,r,t,i);break e;case 14:e=Hue(null,e,r,$f(r.type,t),i);break e}throw Error(je(306,r,""))}return e;case 0:return r=e.type,n=e.pendingProps,n=e.elementType===r?n:$f(r,n),UX(t,e,r,n,i);case 1:return r=e.type,n=e.pendingProps,n=e.elementType===r?n:$f(r,n),que(t,e,r,n,i);case 3:e:{if(QTe(e),t===null)throw Error(je(387));r=e.pendingProps,s=e.memoizedState,n=s.element,TTe(t,e),C8(e,r,null,i);var o=e.memoizedState;if(r=o.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){n=lM(Error(je(423)),e),e=Wue(t,e,r,i,n);break e}else if(r!==n){n=lM(Error(je(424)),e),e=Wue(t,e,r,i,n);break e}else for(Zh=Pb(e.stateNode.containerInfo.firstChild),Qh=e,xs=!0,Bf=null,i=ATe(e,null,r,i),e.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling;else{if(sM(),r===n){e=w_(t,e,i);break e}Lc(t,e,r,i)}e=e.child}return e;case 5:return RTe(e),t===null&&LX(e),r=e.type,n=e.pendingProps,s=t!==null?t.memoizedProps:null,o=n.children,MX(r,n)?o=null:s!==null&&MX(r,s)&&(e.flags|=32),KTe(t,e),Lc(t,e,o,i),e.child;case 6:return t===null&&LX(e),null;case 13:return eSe(t,e,i);case 4:return mre(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=oM(e,null,r,i):Lc(t,e,r,i),e.child;case 11:return r=e.type,n=e.pendingProps,n=e.elementType===r?n:$f(r,n),Gue(t,e,r,n,i);case 7:return Lc(t,e,e.pendingProps,i),e.child;case 8:return Lc(t,e,e.pendingProps.children,i),e.child;case 12:return Lc(t,e,e.pendingProps.children,i),e.child;case 10:e:{if(r=e.type._context,n=e.pendingProps,s=e.memoizedProps,o=n.value,Yn(S8,r._currentValue),r._currentValue=o,s!==null)if(dm(s.value,o)){if(s.children===n.children&&!ju.current){e=w_(t,e,i);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(s.tag===1){l=r_(-1,i&-i),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var h=c.pending;h===null?l.next=l:(l.next=h.next,h.next=l),c.pending=l}}s.lanes|=i,l=s.alternate,l!==null&&(l.lanes|=i),DX(s.return,i,e),a.lanes|=i;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(je(341));o.lanes|=i,a=o.alternate,a!==null&&(a.lanes|=i),DX(o,i,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Lc(t,e,n.children,i),e=e.child}return e;case 9:return n=e.type,r=e.pendingProps.children,TR(e,i),n=Ap(n),r=r(n),e.flags|=1,Lc(t,e,r,i),e.child;case 14:return r=e.type,n=$f(r,e.pendingProps),n=$f(r.type,n),Hue(t,e,r,n,i);case 15:return ZTe(t,e,e.type,e.pendingProps,i);case 17:return r=e.type,n=e.pendingProps,n=e.elementType===r?n:$f(r,n),Qk(t,e),e.tag=1,Gu(r)?(t=!0,w8(e)):t=!1,TR(e,i),ETe(e,r,n),FX(e,r,n,i),VX(null,e,r,!0,t,i);case 19:return tSe(t,e,i);case 22:return JTe(t,e,i)}throw Error(je(156,e.tag))};function ySe(t,e){return jxe(t,e)}function F9e(t,e,i,r){this.tag=t,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function fp(t,e,i,r){return new F9e(t,e,i,r)}function Ore(t){return t=t.prototype,!(!t||!t.isReactComponent)}function k9e(t){if(typeof t=="function")return Ore(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Yie)return 11;if(t===Zie)return 14}return 2}function Db(t,e){var i=t.alternate;return i===null?(i=fp(t.tag,e,t.key,t.mode),i.elementType=t.elementType,i.type=t.type,i.stateNode=t.stateNode,i.alternate=t,t.alternate=i):(i.pendingProps=e,i.type=t.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=t.flags&14680064,i.childLanes=t.childLanes,i.lanes=t.lanes,i.child=t.child,i.memoizedProps=t.memoizedProps,i.memoizedState=t.memoizedState,i.updateQueue=t.updateQueue,e=t.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},i.sibling=t.sibling,i.index=t.index,i.ref=t.ref,i}function i6(t,e,i,r,n,s){var o=2;if(r=t,typeof t=="function")Ore(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case UA:return PS(i.children,n,s,e);case Xie:o=8,n|=8;break;case aX:return t=fp(12,i,e,n|2),t.elementType=aX,t.lanes=s,t;case lX:return t=fp(13,i,e,n),t.elementType=lX,t.lanes=s,t;case cX:return t=fp(19,i,e,n),t.elementType=cX,t.lanes=s,t;case Cxe:return v9(i,n,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Sxe:o=10;break e;case Exe:o=9;break e;case Yie:o=11;break e;case Zie:o=14;break e;case D1:o=16,r=null;break e}throw Error(je(130,t==null?t:typeof t,""))}return e=fp(o,i,e,n),e.elementType=t,e.type=r,e.lanes=s,e}function PS(t,e,i,r){return t=fp(7,t,r,e),t.lanes=i,t}function v9(t,e,i,r){return t=fp(22,t,r,e),t.elementType=Cxe,t.lanes=i,t.stateNode={isHidden:!1},t}function Sj(t,e,i){return t=fp(6,t,null,e),t.lanes=i,t}function Ej(t,e,i){return e=fp(4,t.children!==null?t.children:[],t.key,e),e.lanes=i,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function U9e(t,e,i,r,n){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=sj(0),this.expirationTimes=sj(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=sj(0),this.identifierPrefix=r,this.onRecoverableError=n,this.mutableSourceEagerHydrationData=null}function Pre(t,e,i,r,n,s,o,a,l){return t=new U9e(t,e,i,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=fp(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:r,isDehydrated:i,cache:null,transitions:null,pendingSuspenseBoundaries:null},fre(s),t}function V9e(t,e,i){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:kA,key:r==null?null:""+r,children:t,containerInfo:e,implementation:i}}function _Se(t){if(!t)return Zb;t=t._reactInternals;e:{if(k2(t)!==t||t.tag!==1)throw Error(je(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Gu(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(je(171))}if(t.tag===1){var i=t.type;if(Gu(i))return yTe(t,i,e)}return e}function vSe(t,e,i,r,n,s,o,a,l){return t=Pre(i,r,!0,t,n,s,o,a,l),t.context=_Se(null),i=t.current,r=Hc(),n=Lb(i),s=r_(r,n),s.callback=e??null,Ib(i,s,n),t.current.lanes=n,iN(t,n,r),Hu(t,r),t}function b9(t,e,i,r){var n=e.current,s=Hc(),o=Lb(n);return i=_Se(i),e.context===null?e.context=i:e.pendingContext=i,e=r_(s,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Ib(n,e,o),t!==null&&(sm(t,n,o,s),Zk(t,n,o)),o}function L8(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function rhe(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var i=t.retryLane;t.retryLane=i!==0&&i<e?i:e}}function Ire(t,e){rhe(t,e),(t=t.alternate)&&rhe(t,e)}function z9e(){return null}var bSe=typeof reportError=="function"?reportError:function(t){console.error(t)};function $re(t){this._internalRoot=t}w9.prototype.render=$re.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(je(409));b9(t,e,null,null)};w9.prototype.unmount=$re.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;QS(function(){b9(null,t,null,null)}),e[v_]=null}};function w9(t){this._internalRoot=t}w9.prototype.unstable_scheduleHydration=function(t){if(t){var e=Zxe();t={blockedOn:null,target:t,priority:e};for(var i=0;i<X1.length&&e!==0&&e<X1[i].priority;i++);X1.splice(i,0,t),i===0&&Kxe(t)}};function Lre(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function x9(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function nhe(){}function B9e(t,e,i,r,n){if(n){if(typeof r=="function"){var s=r;r=function(){var c=L8(o);s.call(c)}}var o=vSe(e,r,t,0,null,!1,!1,"",nhe);return t._reactRootContainer=o,t[v_]=o.current,EL(t.nodeType===8?t.parentNode:t),QS(),o}for(;n=t.lastChild;)t.removeChild(n);if(typeof r=="function"){var a=r;r=function(){var c=L8(l);a.call(c)}}var l=Pre(t,0,!1,null,null,!1,!1,"",nhe);return t._reactRootContainer=l,t[v_]=l.current,EL(t.nodeType===8?t.parentNode:t),QS(function(){b9(e,l,i,r)}),l}function T9(t,e,i,r,n){var s=i._reactRootContainer;if(s){var o=s;if(typeof n=="function"){var a=n;n=function(){var l=L8(o);a.call(l)}}b9(e,o,t,n)}else o=B9e(i,e,t,n,r);return L8(o)}Xxe=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var i=wP(e.pendingLanes);i!==0&&(Qie(e,i|1),Hu(e,po()),!($r&6)&&(cM=po()+500,Mw()))}break;case 13:QS(function(){var r=b_(t,1);if(r!==null){var n=Hc();sm(r,t,1,n)}}),Ire(t,1)}};ere=function(t){if(t.tag===13){var e=b_(t,134217728);if(e!==null){var i=Hc();sm(e,t,134217728,i)}Ire(t,134217728)}};Yxe=function(t){if(t.tag===13){var e=Lb(t),i=b_(t,e);if(i!==null){var r=Hc();sm(i,t,e,r)}Ire(t,e)}};Zxe=function(){return yn};Jxe=function(t,e){var i=yn;try{return yn=t,e()}finally{yn=i}};vX=function(t,e,i){switch(e){case"input":if(dX(t,i),e=i.name,i.type==="radio"&&e!=null){for(i=t;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<i.length;e++){var r=i[e];if(r!==t&&r.form===t.form){var n=p9(r);if(!n)throw Error(je(90));Rxe(r),dX(r,n)}}}break;case"textarea":Oxe(t,i);break;case"select":e=i.value,e!=null&&vR(t,!!i.multiple,e,!1)}};Fxe=Are;kxe=QS;var j9e={usingClientEntryPoint:!1,Events:[nN,jA,p9,Dxe,Nxe,Are]},s3={findFiberByHostInstance:hS,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},G9e={bundleType:s3.bundleType,version:s3.version,rendererPackageName:s3.rendererPackageName,rendererConfig:s3.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:k_.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=zxe(t),t===null?null:t.stateNode},findFiberByHostInstance:s3.findFiberByHostInstance||z9e,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var MF=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!MF.isDisabled&&MF.supportsFiber)try{c9=MF.inject(G9e),Wg=MF}catch{}}dd.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=j9e;dd.createPortal=function(t,e){var i=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Lre(e))throw Error(je(200));return V9e(t,e,null,i)};dd.createRoot=function(t,e){if(!Lre(t))throw Error(je(299));var i=!1,r="",n=bSe;return e!=null&&(e.unstable_strictMode===!0&&(i=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(n=e.onRecoverableError)),e=Pre(t,1,!1,null,null,i,!1,r,n),t[v_]=e.current,EL(t.nodeType===8?t.parentNode:t),new $re(e)};dd.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(je(188)):(t=Object.keys(t).join(","),Error(je(268,t)));return t=zxe(e),t=t===null?null:t.stateNode,t};dd.flushSync=function(t){return QS(t)};dd.hydrate=function(t,e,i){if(!x9(e))throw Error(je(200));return T9(null,t,e,!0,i)};dd.hydrateRoot=function(t,e,i){if(!Lre(t))throw Error(je(405));var r=i!=null&&i.hydratedSources||null,n=!1,s="",o=bSe;if(i!=null&&(i.unstable_strictMode===!0&&(n=!0),i.identifierPrefix!==void 0&&(s=i.identifierPrefix),i.onRecoverableError!==void 0&&(o=i.onRecoverableError)),e=vSe(e,null,t,1,i??null,n,!1,s,o),t[v_]=e.current,EL(t),r)for(t=0;t<r.length;t++)i=r[t],n=i._getVersion,n=n(i._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[i,n]:e.mutableSourceEagerHydrationData.push(i,n);return new w9(e)};dd.render=function(t,e,i){if(!x9(e))throw Error(je(200));return T9(null,t,e,!1,i)};dd.unmountComponentAtNode=function(t){if(!x9(t))throw Error(je(40));return t._reactRootContainer?(QS(function(){T9(null,null,t,!1,function(){t._reactRootContainer=null,t[v_]=null})}),!0):!1};dd.unstable_batchedUpdates=Are;dd.unstable_renderSubtreeIntoContainer=function(t,e,i,r){if(!x9(i))throw Error(je(200));if(t==null||t._reactInternals===void 0)throw Error(je(38));return T9(t,e,i,!1,r)};dd.version="18.2.0-next-9e3b772b8-20220608";(function(t){function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(i){console.error(i)}}e(),t.exports=dd})(zVe);var she=nX;rX.createRoot=she.createRoot,rX.hydrateRoot=she.hydrateRoot;/**
 * @remix-run/router v1.3.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function LL(){return LL=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},LL.apply(this,arguments)}var ab;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(ab||(ab={}));const ohe="popstate";function H9e(t){t===void 0&&(t={});function e(n,s){let{pathname:o="/",search:a="",hash:l=""}=U2(n.location.hash.substr(1));return KX("",{pathname:o,search:a,hash:l},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function i(n,s){let o=n.document.querySelector("base"),a="";if(o&&o.getAttribute("href")){let l=n.location.href,c=l.indexOf("#");a=c===-1?l:l.slice(0,c)}return a+"#"+(typeof s=="string"?s:D8(s))}function r(n,s){q9e(n.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(s)+")")}return X9e(e,i,r,t)}function _a(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function q9e(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function W9e(){return Math.random().toString(36).substr(2,8)}function ahe(t,e){return{usr:t.state,key:t.key,idx:e}}function KX(t,e,i,r){return i===void 0&&(i=null),LL({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?U2(e):e,{state:i,key:e&&e.key||r||W9e()})}function D8(t){let{pathname:e="/",search:i="",hash:r=""}=t;return i&&i!=="?"&&(e+=i.charAt(0)==="?"?i:"?"+i),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function U2(t){let e={};if(t){let i=t.indexOf("#");i>=0&&(e.hash=t.substr(i),t=t.substr(0,i));let r=t.indexOf("?");r>=0&&(e.search=t.substr(r),t=t.substr(0,r)),t&&(e.pathname=t)}return e}function X9e(t,e,i,r){r===void 0&&(r={});let{window:n=document.defaultView,v5Compat:s=!1}=r,o=n.history,a=ab.Pop,l=null,c=h();c==null&&(c=0,o.replaceState(LL({},o.state,{idx:c}),""));function h(){return(o.state||{idx:null}).idx}function p(){a=ab.Pop;let b=h(),w=b==null?null:b-c;c=b,l&&l({action:a,location:_.location,delta:w})}function f(b,w){a=ab.Push;let x=KX(_.location,b,w);i&&i(x,b),c=h()+1;let T=ahe(x,c),E=_.createHref(x);try{o.pushState(T,"",E)}catch{n.location.assign(E)}s&&l&&l({action:a,location:_.location,delta:1})}function m(b,w){a=ab.Replace;let x=KX(_.location,b,w);i&&i(x,b),c=h();let T=ahe(x,c),E=_.createHref(x);o.replaceState(T,"",E),s&&l&&l({action:a,location:_.location,delta:0})}function g(b){let w=n.location.origin!=="null"?n.location.origin:n.location.href,x=typeof b=="string"?b:D8(b);return _a(w,"No window.location.(origin|href) available to create URL for href: "+x),new URL(x,w)}let _={get action(){return a},get location(){return t(n,o)},listen(b){if(l)throw new Error("A history only accepts one active listener");return n.addEventListener(ohe,p),l=b,()=>{n.removeEventListener(ohe,p),l=null}},createHref(b){return e(n,b)},createURL:g,encodeLocation(b){let w=g(b);return{pathname:w.pathname,search:w.search,hash:w.hash}},push:f,replace:m,go(b){return o.go(b)}};return _}var lhe;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(lhe||(lhe={}));function Y9e(t,e,i){i===void 0&&(i="/");let r=typeof e=="string"?U2(e):e,n=Dre(r.pathname||"/",i);if(n==null)return null;let s=wSe(t);Z9e(s);let o=null;for(let a=0;o==null&&a<s.length;++a)o=sBe(s[a],lBe(n));return o}function wSe(t,e,i,r){e===void 0&&(e=[]),i===void 0&&(i=[]),r===void 0&&(r="");let n=(s,o,a)=>{let l={relativePath:a===void 0?s.path||"":a,caseSensitive:s.caseSensitive===!0,childrenIndex:o,route:s};l.relativePath.startsWith("/")&&(_a(l.relativePath.startsWith(r),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(r.length));let c=Nb([r,l.relativePath]),h=i.concat(l);s.children&&s.children.length>0&&(_a(s.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+c+'".')),wSe(s.children,e,h,c)),!(s.path==null&&!s.index)&&e.push({path:c,score:rBe(c,s.index),routesMeta:h})};return t.forEach((s,o)=>{var a;if(s.path===""||!((a=s.path)!=null&&a.includes("?")))n(s,o);else for(let l of xSe(s.path))n(s,o,l)}),e}function xSe(t){let e=t.split("/");if(e.length===0)return[];let[i,...r]=e,n=i.endsWith("?"),s=i.replace(/\?$/,"");if(r.length===0)return n?[s,""]:[s];let o=xSe(r.join("/")),a=[];return a.push(...o.map(l=>l===""?s:[s,l].join("/"))),n&&a.push(...o),a.map(l=>t.startsWith("/")&&l===""?"/":l)}function Z9e(t){t.sort((e,i)=>e.score!==i.score?i.score-e.score:nBe(e.routesMeta.map(r=>r.childrenIndex),i.routesMeta.map(r=>r.childrenIndex)))}const J9e=/^:\w+$/,K9e=3,Q9e=2,eBe=1,tBe=10,iBe=-2,che=t=>t==="*";function rBe(t,e){let i=t.split("/"),r=i.length;return i.some(che)&&(r+=iBe),e&&(r+=Q9e),i.filter(n=>!che(n)).reduce((n,s)=>n+(J9e.test(s)?K9e:s===""?eBe:tBe),r)}function nBe(t,e){return t.length===e.length&&t.slice(0,-1).every((r,n)=>r===e[n])?t[t.length-1]-e[e.length-1]:0}function sBe(t,e){let{routesMeta:i}=t,r={},n="/",s=[];for(let o=0;o<i.length;++o){let a=i[o],l=o===i.length-1,c=n==="/"?e:e.slice(n.length)||"/",h=oBe({path:a.relativePath,caseSensitive:a.caseSensitive,end:l},c);if(!h)return null;Object.assign(r,h.params);let p=a.route;s.push({params:r,pathname:Nb([n,h.pathname]),pathnameBase:dBe(Nb([n,h.pathnameBase])),route:p}),h.pathnameBase!=="/"&&(n=Nb([n,h.pathnameBase]))}return s}function oBe(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[i,r]=aBe(t.path,t.caseSensitive,t.end),n=e.match(i);if(!n)return null;let s=n[0],o=s.replace(/(.)\/+$/,"$1"),a=n.slice(1);return{params:r.reduce((c,h,p)=>{if(h==="*"){let f=a[p]||"";o=s.slice(0,s.length-f.length).replace(/(.)\/+$/,"$1")}return c[h]=cBe(a[p]||"",h),c},{}),pathname:s,pathnameBase:o,pattern:t}}function aBe(t,e,i){e===void 0&&(e=!1),i===void 0&&(i=!0),Nre(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let r=[],n="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^$?{}|()[\]]/g,"\\$&").replace(/\/:(\w+)/g,(o,a)=>(r.push(a),"/([^\\/]+)"));return t.endsWith("*")?(r.push("*"),n+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):i?n+="\\/*$":t!==""&&t!=="/"&&(n+="(?:(?=\\/|$))"),[new RegExp(n,e?void 0:"i"),r]}function lBe(t){try{return decodeURI(t)}catch(e){return Nre(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function cBe(t,e){try{return decodeURIComponent(t)}catch(i){return Nre(!1,'The value for the URL param "'+e+'" will not be decoded because'+(' the string "'+t+'" is a malformed URL segment. This is probably')+(" due to a bad percent encoding ("+i+").")),t}}function Dre(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let i=e.endsWith("/")?e.length-1:e.length,r=t.charAt(i);return r&&r!=="/"?null:t.slice(i)||"/"}function Nre(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function uBe(t,e){e===void 0&&(e="/");let{pathname:i,search:r="",hash:n=""}=typeof t=="string"?U2(t):t;return{pathname:i?i.startsWith("/")?i:hBe(i,e):e,search:pBe(r),hash:fBe(n)}}function hBe(t,e){let i=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(n=>{n===".."?i.length>1&&i.pop():n!=="."&&i.push(n)}),i.length>1?i.join("/"):"/"}function Cj(t,e,i,r){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+i+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function TSe(t){return t.filter((e,i)=>i===0||e.route.path&&e.route.path.length>0)}function SSe(t,e,i,r){r===void 0&&(r=!1);let n;typeof t=="string"?n=U2(t):(n=LL({},t),_a(!n.pathname||!n.pathname.includes("?"),Cj("?","pathname","search",n)),_a(!n.pathname||!n.pathname.includes("#"),Cj("#","pathname","hash",n)),_a(!n.search||!n.search.includes("#"),Cj("#","search","hash",n)));let s=t===""||n.pathname==="",o=s?"/":n.pathname,a;if(r||o==null)a=i;else{let p=e.length-1;if(o.startsWith("..")){let f=o.split("/");for(;f[0]==="..";)f.shift(),p-=1;n.pathname=f.join("/")}a=p>=0?e[p]:"/"}let l=uBe(n,a),c=o&&o!=="/"&&o.endsWith("/"),h=(s||o===".")&&i.endsWith("/");return!l.pathname.endsWith("/")&&(c||h)&&(l.pathname+="/"),l}const Nb=t=>t.join("/").replace(/\/\/+/g,"/"),dBe=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),pBe=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,fBe=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function mBe(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const gBe=["post","put","patch","delete"];[...gBe];/**
 * React Router v6.8.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function QX(){return QX=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},QX.apply(this,arguments)}function yBe(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}const _Be=typeof Object.is=="function"?Object.is:yBe,{useState:vBe,useEffect:bBe,useLayoutEffect:wBe,useDebugValue:xBe}=iX;function TBe(t,e,i){const r=e(),[{inst:n},s]=vBe({inst:{value:r,getSnapshot:e}});return wBe(()=>{n.value=r,n.getSnapshot=e,Aj(n)&&s({inst:n})},[t,r,e]),bBe(()=>(Aj(n)&&s({inst:n}),t(()=>{Aj(n)&&s({inst:n})})),[t]),xBe(r),r}function Aj(t){const e=t.getSnapshot,i=t.value;try{const r=e();return!_Be(i,r)}catch{return!0}}function SBe(t,e,i){return e()}const EBe=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",CBe=!EBe,ABe=CBe?SBe:TBe;"useSyncExternalStore"in iX&&(t=>t.useSyncExternalStore)(iX);const ESe=ut.createContext(null),CSe=ut.createContext(null),oN=ut.createContext(null),S9=ut.createContext(null),hO=ut.createContext({outlet:null,matches:[]}),ASe=ut.createContext(null);function RBe(t,e){let{relative:i}=e===void 0?{}:e;aN()||_a(!1);let{basename:r,navigator:n}=ut.useContext(oN),{hash:s,pathname:o,search:a}=RSe(t,{relative:i}),l=o;return r!=="/"&&(l=o==="/"?r:Nb([r,o])),n.createHref({pathname:l,search:a,hash:s})}function aN(){return ut.useContext(S9)!=null}function E9(){return aN()||_a(!1),ut.useContext(S9).location}function MBe(){aN()||_a(!1);let{basename:t,navigator:e}=ut.useContext(oN),{matches:i}=ut.useContext(hO),{pathname:r}=E9(),n=JSON.stringify(TSe(i).map(a=>a.pathnameBase)),s=ut.useRef(!1);return ut.useEffect(()=>{s.current=!0}),ut.useCallback(function(a,l){if(l===void 0&&(l={}),!s.current)return;if(typeof a=="number"){e.go(a);return}let c=SSe(a,JSON.parse(n),r,l.relative==="path");t!=="/"&&(c.pathname=c.pathname==="/"?t:Nb([t,c.pathname])),(l.replace?e.replace:e.push)(c,l.state,l)},[t,e,n,r])}function RSe(t,e){let{relative:i}=e===void 0?{}:e,{matches:r}=ut.useContext(hO),{pathname:n}=E9(),s=JSON.stringify(TSe(r).map(o=>o.pathnameBase));return ut.useMemo(()=>SSe(t,JSON.parse(s),n,i==="path"),[t,s,n,i])}function OBe(t,e){aN()||_a(!1);let{navigator:i}=ut.useContext(oN),r=ut.useContext(CSe),{matches:n}=ut.useContext(hO),s=n[n.length-1],o=s?s.params:{};s&&s.pathname;let a=s?s.pathnameBase:"/";s&&s.route;let l=E9(),c;if(e){var h;let _=typeof e=="string"?U2(e):e;a==="/"||(h=_.pathname)!=null&&h.startsWith(a)||_a(!1),c=_}else c=l;let p=c.pathname||"/",f=a==="/"?p:p.slice(a.length)||"/",m=Y9e(t,{pathname:f}),g=LBe(m&&m.map(_=>Object.assign({},_,{params:Object.assign({},o,_.params),pathname:Nb([a,i.encodeLocation?i.encodeLocation(_.pathname).pathname:_.pathname]),pathnameBase:_.pathnameBase==="/"?a:Nb([a,i.encodeLocation?i.encodeLocation(_.pathnameBase).pathname:_.pathnameBase])})),n,r||void 0);return e&&g?ut.createElement(S9.Provider,{value:{location:QX({pathname:"/",search:"",hash:"",state:null,key:"default"},c),navigationType:ab.Pop}},g):g}function PBe(){let t=kBe(),e=mBe(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),i=t instanceof Error?t.stack:null,n={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},s=null;return ut.createElement(ut.Fragment,null,ut.createElement("h2",null,"Unexpected Application Error!"),ut.createElement("h3",{style:{fontStyle:"italic"}},e),i?ut.createElement("pre",{style:n},i):null,s)}class IBe extends ut.Component{constructor(e){super(e),this.state={location:e.location,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,i){return i.location!==e.location?{error:e.error,location:e.location}:{error:e.error||i.error,location:i.location}}componentDidCatch(e,i){console.error("React Router caught the following error during render",e,i)}render(){return this.state.error?ut.createElement(hO.Provider,{value:this.props.routeContext},ut.createElement(ASe.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function $Be(t){let{routeContext:e,match:i,children:r}=t,n=ut.useContext(ESe);return n&&n.static&&n.staticContext&&i.route.errorElement&&(n.staticContext._deepestRenderedBoundaryId=i.route.id),ut.createElement(hO.Provider,{value:e},r)}function LBe(t,e,i){if(e===void 0&&(e=[]),t==null)if(i!=null&&i.errors)t=i.matches;else return null;let r=t,n=i==null?void 0:i.errors;if(n!=null){let s=r.findIndex(o=>o.route.id&&(n==null?void 0:n[o.route.id]));s>=0||_a(!1),r=r.slice(0,Math.min(r.length,s+1))}return r.reduceRight((s,o,a)=>{let l=o.route.id?n==null?void 0:n[o.route.id]:null,c=i?o.route.errorElement||ut.createElement(PBe,null):null,h=e.concat(r.slice(0,a+1)),p=()=>ut.createElement($Be,{match:o,routeContext:{outlet:s,matches:h}},l?c:o.route.element!==void 0?o.route.element:s);return i&&(o.route.errorElement||a===0)?ut.createElement(IBe,{location:i.location,component:c,error:l,children:p(),routeContext:{outlet:null,matches:h}}):p()},null)}var uhe;(function(t){t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator"})(uhe||(uhe={}));var N8;(function(t){t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator"})(N8||(N8={}));function DBe(t){let e=ut.useContext(CSe);return e||_a(!1),e}function NBe(t){let e=ut.useContext(hO);return e||_a(!1),e}function FBe(t){let e=NBe(),i=e.matches[e.matches.length-1];return i.route.id||_a(!1),i.route.id}function kBe(){var t;let e=ut.useContext(ASe),i=DBe(N8.UseRouteError),r=FBe(N8.UseRouteError);return e||((t=i.errors)==null?void 0:t[r])}function TP(t){_a(!1)}function UBe(t){let{basename:e="/",children:i=null,location:r,navigationType:n=ab.Pop,navigator:s,static:o=!1}=t;aN()&&_a(!1);let a=e.replace(/^\/*/,"/"),l=ut.useMemo(()=>({basename:a,navigator:s,static:o}),[a,s,o]);typeof r=="string"&&(r=U2(r));let{pathname:c="/",search:h="",hash:p="",state:f=null,key:m="default"}=r,g=ut.useMemo(()=>{let _=Dre(c,a);return _==null?null:{pathname:_,search:h,hash:p,state:f,key:m}},[a,c,h,p,f,m]);return g==null?null:ut.createElement(oN.Provider,{value:l},ut.createElement(S9.Provider,{children:i,value:{location:g,navigationType:n}}))}function VBe(t){let{children:e,location:i}=t,r=ut.useContext(ESe),n=r&&!e?r.router.routes:eY(e);return OBe(n,i)}var hhe;(function(t){t[t.pending=0]="pending",t[t.success=1]="success",t[t.error=2]="error"})(hhe||(hhe={}));new Promise(()=>{});function eY(t,e){e===void 0&&(e=[]);let i=[];return ut.Children.forEach(t,(r,n)=>{if(!ut.isValidElement(r))return;if(r.type===ut.Fragment){i.push.apply(i,eY(r.props.children,e));return}r.type!==TP&&_a(!1),!r.props.index||!r.props.children||_a(!1);let s=[...e,n],o={id:r.props.id||s.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,hasErrorBoundary:r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle};r.props.children&&(o.children=eY(r.props.children,s)),i.push(o)}),i}/**
 * React Router DOM v6.8.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function tY(){return tY=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},tY.apply(this,arguments)}function zBe(t,e){if(t==null)return{};var i={},r=Object.keys(t),n,s;for(s=0;s<r.length;s++)n=r[s],!(e.indexOf(n)>=0)&&(i[n]=t[n]);return i}function BBe(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function jBe(t,e){return t.button===0&&(!e||e==="_self")&&!BBe(t)}const GBe=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset"];function HBe(t){let{basename:e,children:i,window:r}=t,n=ut.useRef();n.current==null&&(n.current=H9e({window:r,v5Compat:!0}));let s=n.current,[o,a]=ut.useState({action:s.action,location:s.location});return ut.useLayoutEffect(()=>s.listen(a),[s]),ut.createElement(UBe,{basename:e,children:i,location:o.location,navigationType:o.action,navigator:s})}const qBe=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",WBe=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Rj=ut.forwardRef(function(e,i){let{onClick:r,relative:n,reloadDocument:s,replace:o,state:a,target:l,to:c,preventScrollReset:h}=e,p=zBe(e,GBe),{basename:f}=ut.useContext(oN),m,g=!1;if(typeof c=="string"&&WBe.test(c)&&(m=c,qBe)){let x=new URL(window.location.href),T=c.startsWith("//")?new URL(x.protocol+c):new URL(c),E=Dre(T.pathname,f);T.origin===x.origin&&E!=null?c=E+T.search+T.hash:g=!0}let _=RBe(c,{relative:n}),b=XBe(c,{replace:o,state:a,target:l,preventScrollReset:h,relative:n});function w(x){r&&r(x),x.defaultPrevented||b(x)}return ut.createElement("a",tY({},p,{href:m||_,onClick:g||s?r:w,ref:i,target:l}))});var dhe;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmitImpl="useSubmitImpl",t.UseFetcher="useFetcher"})(dhe||(dhe={}));var phe;(function(t){t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(phe||(phe={}));function XBe(t,e){let{target:i,replace:r,state:n,preventScrollReset:s,relative:o}=e===void 0?{}:e,a=MBe(),l=E9(),c=RSe(t,{relative:o});return ut.useCallback(h=>{if(jBe(h,i)){h.preventDefault();let p=r!==void 0?r:D8(l)===D8(c);a(t,{replace:p,state:n,preventScrollReset:s,relative:o})}},[l,a,c,r,n,i,t,s,o])}function YBe(){return MS("div",{className:"home",children:[Cr("div",{className:"link",children:Cr(Rj,{to:"/media-layer-image",children:"MediaLayerImages"})}),Cr("div",{className:"link",children:Cr(Rj,{to:"/media-layer-video",children:"MediaLayerVideo"})}),Cr("div",{className:"link",children:Cr(Rj,{to:"/media-layer-webmap",children:"MediaLayerWebmap"})})]})}const ZBe="modulepreload",JBe=function(t){return"/esri-devsummit-2023/"+t},fhe={},Q=function(e,i,r){if(!i||i.length===0)return e();const n=document.getElementsByTagName("link");return Promise.all(i.map(s=>{if(s=JBe(s),s in fhe)return;fhe[s]=!0;const o=s.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let h=n.length-1;h>=0;h--){const p=n[h];if(p.href===s&&(!o||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":ZBe,o||(c.as="script",c.crossOrigin=""),c.href=s,document.head.appendChild(c),o)return new Promise((h,p)=>{c.addEventListener("load",h),c.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e())};function u(t,e,i,r){var n,s=arguments.length,o=s<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,i):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(s<3?n(o):s>3?n(e,i,o):n(e,i))||o);return s>3&&o&&Object.defineProperty(e,i,o),o}let lb;function ue(t){return typeof lb[t]=="function"?lb[t]=lb[t](globalThis):lb[t]}var sxe,oxe,axe,lxe;lb=(sxe=globalThis.dojoConfig)!=null&&sxe.has||(oxe=globalThis.esriConfig)!=null&&oxe.has?{...(axe=globalThis.dojoConfig)==null?void 0:axe.has,...(lxe=globalThis.esriConfig)==null?void 0:lxe.has}:{},ue.add=(t,e,i,r)=>((r||lb[t]===void 0)&&(lb[t]=e),i&&ue(t)),ue.cache=lb,ue.add("esri-deprecation-warnings",!0),(()=>{var e;ue.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const t=typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;if(ue.add("host-browser",t),ue.add("host-node",typeof globalThis.process=="object"&&((e=globalThis.process.versions)==null?void 0:e.node)&&globalThis.process.versions.v8),ue.add("dom",t),ue("host-browser")){const i=navigator,r=i.userAgent,n=i.appVersion,s=parseFloat(n);if(ue.add("wp",parseFloat(r.split("Windows Phone")[1])||void 0),ue.add("msapp",parseFloat(r.split("MSAppHost/")[1])||void 0),ue.add("khtml",n.includes("Konqueror")?s:void 0),ue.add("edge",parseFloat(r.split("Edge/")[1])||void 0),ue.add("opr",parseFloat(r.split("OPR/")[1])||void 0),ue.add("webkit",!ue("wp")&&!ue("edge")&&parseFloat(r.split("WebKit/")[1])||void 0),ue.add("chrome",!ue("edge")&&!ue("opr")&&parseFloat(r.split("Chrome/")[1])||void 0),ue.add("android",!ue("wp")&&parseFloat(r.split("Android ")[1])||void 0),ue.add("safari",!n.includes("Safari")||ue("wp")||ue("chrome")||ue("android")||ue("edge")||ue("opr")?void 0:parseFloat(n.split("Version/")[1])),ue.add("mac",n.includes("Macintosh")),!ue("wp")&&r.match(/(iPhone|iPod|iPad)/)){const o=RegExp.$1.replace(/P/,"p"),a=r.match(/OS ([\d_]+)/)?RegExp.$1:"1",l=parseFloat(a.replace(/_/,".").replace(/_/g,""));ue.add(o,l),ue.add("ios",l)}ue("webkit")||(!r.includes("Gecko")||ue("wp")||ue("khtml")||ue("edge")||ue.add("mozilla",s),ue("mozilla")&&ue.add("ff",parseFloat(r.split("Firefox/")[1]||r.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const t=navigator.userAgent,e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(t),i=/iPhone/i.test(t);e&&ue.add("esri-mobile",e),i&&ue.add("esri-iPhone",i),ue.add("esri-geolocation",!!navigator.geolocation)}ue.add("esri-wasm","WebAssembly"in globalThis),ue.add("esri-shared-array-buffer",()=>{const t="SharedArrayBuffer"in globalThis,e=globalThis.crossOriginIsolated===!1;return t&&!e}),ue.add("wasm-simd",()=>{const t=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(t))}),ue.add("esri-atomics","Atomics"in globalThis),ue.add("esri-workers","Worker"in globalThis),ue.add("web-feat:cache","caches"in globalThis),ue.add("esri-workers-arraybuffer-transfer",!ue("safari")||Number(ue("safari"))>=12),ue.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),ue.add("featurelayer-simplify-payload-size-factors",[1,1,4]),ue.add("featurelayer-snapshot-enabled",!0),ue.add("featurelayer-snapshot-point-min-threshold",8e4),ue.add("featurelayer-snapshot-point-max-threshold",4e5),ue.add("featurelayer-snapshot-point-coverage",.1),ue.add("featurelayer-advanced-symbols",!1),ue.add("featurelayer-pbf",!0),ue.add("featurelayer-pbf-statistics",!1),ue.add("feature-layers-workers",!0),ue.add("feature-polyline-generalization-factor",1),ue.add("mapview-transitions-duration",200),ue.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),ue.add("mapserver-pbf-version-support",10.81),ue.add("mapservice-popup-identify-max-tolerance",20),ue.add("heatmap-allow-raster-fallback",!0),ue.add("heatmap-force-raster",!1),ue("host-webworker")||ue("host-browser")&&(ue.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),ue.add("esri-image-decode",()=>{if("decode"in new Image){const t=new Image;return t.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void t.decode().then(()=>{ue.add("esri-image-decode",!0,!0,!0)}).catch(()=>{ue.add("esri-image-decode",!1,!0,!0)})}return!1}),ue.add("esri-url-encodes-apostrophe",()=>{const t=window.document.createElement("a");return t.href="?'",t.href.includes("?%27")}))})();const kx=null;function v(t){return t!=null}function R(t){return t==null}function Vo(t,e){return v(t)?e(t):kx}function n8t(t){return t}function s8t(t){return t}function Nc(t,e){return C9(t,e),t}function C9(t,e){if(R(t))throw new Error(e??"value is None")}function Nt(t,e){return v(t)?t:typeof e=="function"?e():e}function mhe(t,e){return v(t)?t:e}function Ve(t){return v(t)&&t.destroy(),null}function rt(t){return v(t)&&t.dispose(),null}function Nr(t){return v(t)&&t.remove(),null}function Mp(t){return v(t)&&t.abort(),null}function nn(t){return v(t)&&t.release(),null}function KBe(t,e,i){return v(t)&&v(e)?v(i)?i(t,e):t.equals(e):t===e}function e2(t){return null}function o8t(t,e){const i=new Array;return t.forEach(r=>{const n=e(r);v(n)&&i.push(n)}),i}function a8t(t,e){const i=new Array;for(const r of t)i.push(jh(r,null,e));return i}function l8t(t,e){for(const i of t)Vo(i,e)}function jh(t,e,i){return v(t)?i(t):e}function c8t(t){return t.filter(e=>v(e))}function Js(t,...e){let i=t;for(let r=0;r<e.length&&i;++r)i=i[e[r]];return i}let _$=class Ux{constructor(e=1){this._seed=e}set seed(e){this._seed=e??Math.random()*Ux._m}getInt(){return this._seed=(Ux._a*this._seed+Ux._c)%Ux._m,this._seed}getFloat(){return this.getInt()/(Ux._m-1)}getIntRange(e,i){return Math.round(this.getFloatRange(e,i))}getFloatRange(e,i){const r=i-e;return e+this.getInt()/Ux._m*r}};_$._m=2147483647,_$._a=48271,_$._c=0;function lN(t,e){return e?t.filter((i,r,n)=>n.findIndex(e.bind(null,i))===r):t.filter((i,r,n)=>n.indexOf(i)===r)}function x_(t,e,i){if(R(t)&&R(e))return!0;if(R(t)||R(e)||t.length!==e.length)return!1;if(i){for(let r=0;r<t.length;r++)if(!i(t[r],e[r]))return!1}else for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function Fre(t,e){let i=t.length!==e.length;i&&(t.length=e.length);for(let r=0;r<e.length;++r)t[r]!==e[r]&&(t[r]=e[r],i=!0);return i}function QBe(t,e,i){let r,n;return i?(r=e.filter(s=>!t.some(o=>i(o,s))),n=t.filter(s=>!e.some(o=>i(o,s)))):(r=e.filter(s=>!t.includes(s)),n=t.filter(s=>!e.includes(s))),{added:r,removed:n}}function e7e(t){return t&&typeof t.length=="number"}function u8t(t,e){const i=t.length;if(i===0)return[];const r=[];for(let n=0;n<i;n+=e)r.push(t.slice(n,n+e));return r}const t7e=!!Array.prototype.fill;function h8t(t,e){if(t7e)return new Array(t).fill(e);const i=new Array(t);for(let r=0;r<t;r++)i[r]=e;return i}function i7e(t,e){e===void 0&&(e=t,t=0);const i=new Array(e-t);for(let r=t;r<e;r++)i[r-t]=r;return i}function r7e(t,e,i){const r=t.length;let n=0,s=r-1;for(;n<s;){const a=n+Math.floor((s-n)/2);e>t[a]?n=a+1:s=a}const o=t[n];return i?e>=t[r-1]?-1:o===e?n:n-1:o===e?n:-1}let kre=class{constructor(){this.last=0}};const MSe=new kre;function DL(t,e,i,r){r=r||MSe;const n=Math.max(0,r.last-10);for(let o=n;o<i;++o)if(t[o]===e)return r.last=o,o;const s=Math.min(n,i);for(let o=0;o<s;++o)if(t[o]===e)return r.last=o,o;return-1}function NL(t,e,i,r){const n=i??t.length,s=DL(t,e,n,r);if(s!==-1)return t[s]=t[n-1],i==null&&t.pop(),e}const Wp=new Set;function n7e(t,e,i=t.length,r=e.length,n,s){if(r===0||i===0)return i;Wp.clear();for(let a=0;a<r;++a)Wp.add(e[a]);n=n||MSe;const o=Math.max(0,n.last-10);for(let a=o;a<i;++a)if(Wp.has(t[a])&&(s&&s.push(t[a]),Wp.delete(t[a]),t[a]=t[i-1],--i,--a,Wp.size===0||i===0))return Wp.clear(),i;for(let a=0;a<o;++a)if(Wp.has(t[a])&&(s&&s.push(t[a]),Wp.delete(t[a]),t[a]=t[i-1],--i,--a,Wp.size===0||i===0))return Wp.clear(),i;return Wp.clear(),i}function s7e(t,e){let i=0;for(let r=0;r<t.length;++r){const n=t[r];e(n,r)&&(t[i]=n,i++)}t.length=i}function o7e(t){return t?(ghe.seed=t,()=>ghe.getFloat()):Math.random}function p8t(t,e){const i=o7e(e);for(let r=t.length-1;r>0;r--){const n=Math.floor(i()*(r+1)),s=t[r];t[r]=t[n],t[n]=s}return t}const ghe=new _$;function Ure(t,e){const i=t.indexOf(e);return i!==-1?(t.splice(i,1),e):null}function f8t(t,e){const i=new Map,r=t.length;for(let n=0;n<r;n++){const s=t[n],o=e(s,n,t),a=i.get(o);a?a.push(s):i.set(o,[s])}return i}function o3(t){return t instanceof ArrayBuffer}function a7e(t){return t&&t.constructor&&t.constructor.name==="Int8Array"}function qT(t){return t&&t.constructor&&t.constructor.name==="Uint8Array"}function l7e(t){return t&&t.constructor&&t.constructor.name==="Uint8ClampedArray"}function c7e(t){return t&&t.constructor&&t.constructor.name==="Int16Array"}function Vre(t){return t&&t.constructor&&t.constructor.name==="Uint16Array"}function u7e(t){return t&&t.constructor&&t.constructor.name==="Int32Array"}function zre(t){return t&&t.constructor&&t.constructor.name==="Uint32Array"}function Bre(t){return t&&t.constructor&&t.constructor.name==="Float32Array"}function jre(t){return t&&t.constructor&&t.constructor.name==="Float64Array"}function OF(t){return v(t)?128+t.buffer.byteLength+64:0}const oy=1024;function OSe(t,e){let i;if(e)for(i in t)t.hasOwnProperty(i)&&(t[i]===void 0?delete t[i]:t[i]instanceof Object&&OSe(t[i],!0));else for(i in t)t.hasOwnProperty(i)&&t[i]===void 0&&delete t[i];return t}function se(t){if(!t||typeof t!="object"||typeof t=="function")return t;const e=LSe(t);if(v(e))return e;if(PSe(t))return t.clone();if(ISe(t))return t.map(se);if($Se(t))return t.clone();const i={};for(const r of Object.getOwnPropertyNames(t))i[r]=se(t[r]);return i}function iY(t){if(!t||typeof t!="object"||typeof t=="function"||"HTMLElement"in globalThis&&t instanceof HTMLElement)return t;const e=LSe(t);if(v(e))return e;if(ISe(t)){let i=!0;const r=t.map(n=>{const s=iY(n);return n!=null&&s==null&&(i=!1),s});return i?r:null}if(PSe(t))return t.clone();if(!$Se(t)){const i=new(Object.getPrototypeOf(t)).constructor;for(const r of Object.getOwnPropertyNames(t)){const n=t[r],s=iY(n);if(n!=null&&s==null)return null;i[r]=s}return i}return null}function PSe(t){return typeof t.clone=="function"}function ISe(t){return typeof t.map=="function"&&typeof t.forEach=="function"}function $Se(t){return typeof t.notifyChange=="function"&&typeof t.watch=="function"}function yhe(t){if(Object.prototype.toString.call(t)!=="[object Object]")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}function LSe(t){if(a7e(t)||qT(t)||l7e(t)||c7e(t)||Vre(t)||u7e(t)||zre(t)||Bre(t)||jre(t))return t.slice();if(t instanceof Date)return new Date(t.getTime());if(t instanceof ArrayBuffer)return t.slice(0,t.byteLength);if(t instanceof Map){const e=new Map;for(const[i,r]of t)e.set(i,se(r));return e}if(t instanceof Set){const e=new Set;for(const i of t)e.add(se(i));return e}return null}function Gre(t,e){return t===e||typeof t=="number"&&isNaN(t)&&typeof e=="number"&&isNaN(e)||typeof(t||{}).getTime=="function"&&typeof(e||{}).getTime=="function"&&t.getTime()===e.getTime()||!1}function h7e(t,e){return t===e||(t==null||typeof t=="string"?t===e:typeof t=="number"?t===e||typeof e=="number"&&isNaN(t)&&isNaN(e):t instanceof Date?e instanceof Date&&t.getTime()===e.getTime():Array.isArray(t)?Array.isArray(e)&&x_(t,e):t instanceof Set?e instanceof Set&&p7e(t,e):t instanceof Map?e instanceof Map&&f7e(t,e):!!yhe(t)&&yhe(e)&&d7e(t,e))}function d7e(t,e){if(t===null||e===null)return!1;const i=Object.keys(t);if(e===null||Object.keys(e).length!==i.length)return!1;for(const r of i)if(t[r]!==e[r]||!Object.prototype.hasOwnProperty.call(e,r))return!1;return!0}function p7e(t,e){if(t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0}function f7e(t,e){if(t.size!==e.size)return!1;for(const[i,r]of t){const n=e.get(i);if(n!==r||n===void 0&&!e.has(i))return!1}return!0}function DSe(t,e,i=!1){return FSe(t,e,i)}function cN(t,e){if(e!=null)return e[t]||NSe(t.split("."),!1,e)}function va(t,e,i){const r=t.split("."),n=r.pop(),s=NSe(r,!0,i);s&&n&&(s[n]=e)}function NSe(t,e,i){let r=i;for(const n of t){if(r==null)return;if(!(n in r)){if(!e)return;r[n]={}}r=r[n]}return r}function FSe(t,e,i){return e?Object.keys(e).reduce((r,n)=>{let s=r[n],o=e[n];return s===o?r:s===void 0?(r[n]=se(o),r):(Array.isArray(o)||Array.isArray(r)?(s=s?Array.isArray(s)?r[n]=s.concat():r[n]=[s]:r[n]=[],o&&(Array.isArray(o)||(o=[o]),i?o.forEach(a=>{s.includes(a)||s.push(a)}):r[n]=o.concat())):o&&typeof o=="object"?r[n]=FSe(s,o,i):r.hasOwnProperty(n)&&!e.hasOwnProperty(n)||(r[n]=o),r)},t||{}):t}var cxe;const nr={analysisTheme:{accentColor:[255,128,0],textColor:"white"},apiKey:void 0,applicationUrl:(cxe=globalThis.location)==null?void 0:cxe.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",userPrivilegesApplied:!1,portalUrl:"https://www.arcgis.com",routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(DSe(nr,globalThis.esriConfig,!0),delete nr.has),!nr.assetsPath){{const t="4.26.4";nr.assetsPath=`https://js.arcgis.com/${t.slice(0,-2)}/@arcgis/core/assets`}nr.defaultAssetsPath=nr.assetsPath}const m7e=/\{([^\}]+)\}/g;function _he(t){return t??""}function ay(t,e){return t.replace(m7e,typeof e=="object"?(i,r)=>_he(cN(r,e)):(i,r)=>_he(e(r)))}function m8t(t,e){return t.replace(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,i=>e&&e.includes(i)?i:`\\${i}`)}function Hre(t){let e=0;for(let i=0;i<t.length;i++)e=(e<<5)-e+t.charCodeAt(i),e|=0;return e}function g8t(t){return new DOMParser().parseFromString(t||"","text/html").body.innerText||""}const vhe={info:0,warn:1,error:2,none:3};let re=class Pl{constructor(e){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},e.level!=null&&(this.level=e.level),e.writer!=null&&(this.writer=e.writer),this._module=e.module,Pl._loggers[this.module]=this;const i=this.module.lastIndexOf(".");i!==-1&&(this._parent=Pl.getLogger(this.module.slice(0,i)))}get module(){return this._module}get parent(){return this._parent}error(...e){this._log("error","always",...e)}warn(...e){this._log("warn","always",...e)}info(...e){this._log("info","always",...e)}errorOnce(...e){this._log("error","once",...e)}warnOnce(...e){this._log("warn","once",...e)}infoOnce(...e){this._log("info","once",...e)}errorOncePerTick(...e){this._log("error","oncePerTick",...e)}warnOncePerTick(...e){this._log("warn","oncePerTick",...e)}infoOncePerTick(...e){this._log("info","oncePerTick",...e)}get test(){const e=this;return{loggedMessages:e._loggedMessages,clearLoggedWarnings:()=>e._loggedMessages.warn.clear()}}static get testSingleton(){return{resetLoggers(e={}){const i=Pl._loggers;return Pl._loggers=e,i},set throttlingDisabled(e){Pl._throttlingDisabled=e}}}static getLogger(e){let i=Pl._loggers[e];return i||(i=new Pl({module:e})),i}_log(e,i,...r){if(this._matchLevel(e)){if(i!=="always"&&!Pl._throttlingDisabled){const n=this._argsToKey(r),s=this._loggedMessages[e].get(n);if(i==="once"&&s!=null||i==="oncePerTick"&&s&&s>=Pl._tickCounter)return;this._loggedMessages[e].set(n,Pl._tickCounter),Pl._scheduleTickCounterIncrement()}for(const n of nr.log.interceptors)if(n(e,this.module,...r))return;this._inheritedWriter()(e,this.module,...r)}}_parentWithMember(e,i){let r=this;for(;v(r);){const n=r[e];if(v(n))return n;r=r.parent}return i}_inheritedWriter(){return this._parentWithMember("writer",this._consoleWriter)}_consoleWriter(e,i,...r){console[e](`[${i}]`,...r)}_matchLevel(e){const i=nr.log.level?nr.log.level:"warn";return vhe[this._parentWithMember("level",i)]<=vhe[e]}_argsToKey(...e){return Hre(JSON.stringify(e,(r,n)=>typeof n!="object"||Array.isArray(n)?n:"[Object]"))}static _scheduleTickCounterIncrement(){Pl._tickCounterScheduled||(Pl._tickCounterScheduled=!0,Promise.resolve().then(()=>{Pl._tickCounter++,Pl._tickCounterScheduled=!1}))}};re._loggers={},re._tickCounter=0,re._tickCounterScheduled=!1,re._throttlingDisabled=!1;function pa(t,e){for(const[i,r]of t)if(e(r,i))return!0;return!1}function y8t(t,e){for(const[i,r]of t)if(e(r,i))return r;return null}function qre(t,e,i){const r=t.get(e);if(r!==void 0)return r;const n=i();return t.set(e,n),n}const ER=re.getLogger("esri.core.accessorSupport.ensureTypes");function g7e(t){return t==null?t:new Date(t)}function y7e(t){return t==null?t:!!t}function uN(t){return t==null?t:t.toString()}function ip(t){return t==null?t:(t=parseFloat(t),isNaN(t)?0:t)}function Wre(t){return t==null?t:Math.round(parseFloat(t))}function kSe(t){return t&&t.constructor&&t.constructor.__accessorMetadata__!==void 0}function F8(t,e){return e!=null&&t&&!(e instanceof t)}function USe(t){return t&&"isCollection"in t}function bhe(t){return t&&t.Type?typeof t.Type=="function"?t.Type:t.Type.base:null}function _7e(t,e){if(!e||!e.constructor||!USe(e.constructor))return rY(t,e)?e:new t(e);const i=bhe(t.prototype.itemType),r=bhe(e.constructor.prototype.itemType);return i?r?i===r?e:i.prototype.isPrototypeOf(r.prototype)?new t(e):(rY(t,e),e):new t(e):e}function rY(t,e){return!!kSe(e)&&(ER.error("Accessor#set","Assigning an instance of '"+(e.declaredClass||"unknown")+"' which is not a subclass of '"+A9(t)+"'"),!0)}function uM(t,e){return e==null?e:USe(t)?_7e(t,e):F8(t,e)?rY(t,e)?e:new t(e):e}function A9(t){return t&&t.prototype&&t.prototype.declaredClass||"unknown"}const v7e=new WeakMap;function b7e(t){switch(t){case Number:return ip;case Kr:return Wre;case Boolean:return y7e;case String:return uN;case Date:return g7e;default:return qre(v7e,t,()=>uM.bind(null,t))}}function Ts(t,e){const i=b7e(t);return arguments.length===1?i:i(e)}function FL(t,e,i){return arguments.length===1?FL.bind(null,t):e&&(Array.isArray(e)?e.map(r=>t(r,i)):[t(e,i)])}function w7e(t,e){return arguments.length===1?FL(Ts.bind(null,t)):FL(Ts.bind(null,t),e)}function VSe(t,e,i){return e!==0&&Array.isArray(i)?i.map(r=>VSe(t,e-1,r)):t(i)}function k8(t,e,i){if(arguments.length===2)return k8.bind(null,t,e);if(!i)return i;let r=e,n=i=VSe(t,e,i);for(;r>0&&Array.isArray(n);)r--,n=n[0];if(n!==void 0)for(let s=0;s<r;s++)i=[i];return i}function x7e(t,e,i){return arguments.length===2?k8(Ts.bind(null,t),e):k8(Ts.bind(null,t),e,i)}function zSe(t){return!!Array.isArray(t)&&!t.some(e=>{const i=typeof e;return!(i==="string"||i==="number"||i==="function"&&t.length>1)})}function nY(t,e){if(arguments.length===2)return nY(t).call(null,e);const i=new Set,r=t.filter(a=>typeof a!="function"),n=t.filter(a=>typeof a=="function");for(const a of t)typeof a!="string"&&typeof a!="number"||i.add(a);let s=null,o=null;return(a,l)=>{if(a==null)return a;const c=typeof a,h=c==="string"||c==="number";return h&&(i.has(a)||n.some(p=>c==="string"&&p===String||c==="number"&&p===Number))||c==="object"&&n.some(p=>!F8(a,p))?a:(h&&r.length?(s||(s=r.map(p=>typeof p=="string"?`'${p}'`:`${p}`).join(", ")),ER.error("Accessor#set",`'${a}' is not a valid value for this property, only the following values are valid: ${s}`)):typeof a=="object"&&n.length?(o||(o=n.map(p=>A9(p)).join(", ")),ER.error("Accessor#set",`'${a}' is not a valid value for this property, value must be one of ${o}`)):ER.error("Accessor#set",`'${a}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function pm(t,e){if(arguments.length===2)return pm(t).call(null,e);const i={},r=[],n=[];for(const l in t.typeMap){const c=t.typeMap[l];i[l]=Ts(c),r.push(A9(c)),n.push(l)}const s=()=>`'${r.join("', '")}'`,o=()=>`'${n.join("', '")}'`,a=typeof t.key=="string"?l=>l[t.key]:t.key;return l=>{if(t.base&&!F8(t.base,l)||l==null)return l;const c=a(l)||t.defaultKeyValue,h=i[c];if(!h)return ER.error("Accessor#set",`Invalid property value, value needs to be one of ${s()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!F8(t.typeMap[c],l))return l;if(typeof t.key=="string"&&!kSe(l)){const p={};for(const f in l)f!==t.key&&(p[f]=l[f]);return h(p)}return h(l)}}let Kr=class{};const v8t={native:t=>({type:"native",value:t}),array:t=>({type:"array",value:t}),oneOf:t=>({type:"one-of",values:t})};function T7e(t){if(!t||!("type"in t))return!1;switch(t.type){case"native":case"array":case"one-of":return!0}return!1}function BSe(t){switch(t.type){case"native":return Ts(t.value);case"array":return FL(BSe(t.value));case"one-of":return S7e(t);default:return null}}function S7e(t){let e=null;return(i,r)=>oY(i,t)?i:(e==null&&(e=sY(t)),ER.error("Accessor#set",`Invalid property value, value needs to be of type ${e}`),r&&(r.valid=!1),null)}function sY(t){switch(t.type){case"native":switch(t.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case Kr:return"integer";case Date:return"date";default:return A9(t.value)}case"array":return`array of ${sY(t.value)}`;case"one-of":{const e=t.values.map(i=>sY(i));return`one of ${e.slice(0,e.length-1)} or ${e[e.length-1]}`}}return"unknown"}function oY(t,e){if(t==null)return!0;switch(e.type){case"native":switch(e.value){case Number:case Kr:return typeof t=="number";case Boolean:return typeof t=="boolean";case String:return typeof t=="string"}return t instanceof e.value;case"array":return!!Array.isArray(t)&&!t.some(i=>!oY(i,e.value));case"one-of":return e.values.some(i=>oY(t,i))}}function hM(t){return fm(()=>t.forEach(e=>v(e)&&e.remove()))}function fm(t){return{remove:()=>{t&&(t(),t=void 0)}}}function b8t(t){return fm(v(t)?()=>t.destroy():void 0)}function Ql(t){return t?t.__accessor__?t.__accessor__:t.propertyInvalidated?t:null:null}function E7e(t,e){return t!=null&&t.metadatas&&t.metadatas[e]!=null}function r6(t,e,i){return i?U8(t,e,{policy:i,path:""}):U8(t,e,null)}function U8(t,e,i){return e?Object.keys(e).reduce((r,n)=>{let s=null,o="merge";if(i&&(s=i.path?`${i.path}.${n}`:n,o=i.policy(s)),o==="replace"||o==="replace-arrays"&&Array.isArray(r[n]))return r[n]=e[n],r;if(r[n]===void 0)return r[n]=se(e[n]),r;let a=r[n],l=e[n];if(a===l)return r;if(Array.isArray(l)||Array.isArray(r))a=a?Array.isArray(a)?r[n]=a.concat():r[n]=[a]:r[n]=[],l&&(Array.isArray(l)||(l=[l]),l.forEach(c=>{a.includes(c)||a.push(c)}));else if(l&&typeof l=="object")if(i){const c=i.path;i.path=s,r[n]=U8(a,l,i),i.path=c}else r[n]=U8(a,l,null);else r.hasOwnProperty(n)&&!e.hasOwnProperty(n)||(r[n]=l);return r},t||{}):t}function jSe(t){return Array.isArray(t)?t:t.split(".")}function whe(t){return t.includes(",")?t.split(",").map(e=>e.trim()):[t.trim()]}function C7e(t){if(Array.isArray(t)){const e=[];for(const i of t)e.push(...whe(i));return e}return whe(t)}function GSe(t,e,i,r){const n=C7e(e);if(n.length!==1){const s=n.map(o=>r(t,o,i));return hM(s)}return r(t,n[0],i)}function Xre(t){let e=!1;return()=>{e||(e=!0,t())}}function HSe(t,e){const i=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const n=parseInt(i,10);if(!isNaN(n))return Array.isArray(e)?e[n]:e.getItemAt(n)}const r=Ql(e);return E7e(r,i)?r.get(i):e[i]}function qSe(t,e,i){if(t==null)return t;const r=HSe(e[i],t);return!r&&i<e.length-1?void 0:i===e.length-1?r:qSe(r,e,i+1)}function hN(t,e,i=0){return typeof e!="string"||e.includes(".")?qSe(t,jSe(e),i):HSe(e,t)}function V8(t,e){return hN(t,e)}function xhe(t,e){return hN(e,t)!==void 0}function dN(t){let e=t.constructor.__accessorMetadata__;const i=Object.prototype.hasOwnProperty.call(t.constructor,"__accessorMetadata__");if(e){if(!i){e=Object.create(e);for(const r in e)e[r]=se(e[r]);Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0})}}else e={},Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0});return t.constructor.__accessorMetadata__}function R9(t,e){const i=dN(t);let r=i[e];return r||(r=i[e]={}),r}function A7e(t,e){return r6(t,e,M7e)}const R7e=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function M7e(t){return R7e.test(t)?"replace":"merge"}function O7e(t,e){return t.replace(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,(i,r)=>{if(r==="")return"$";const n=cN(r,e),s=n??"";if(s===void 0)throw new Error(`could not find key "${r}" in template`);return s.toString()})}let WSe=class XSe{constructor(e,i,r){this.name=e,this.details=r,this instanceof XSe&&(this.message=(i&&O7e(i,r))??"")}toString(){return"["+this.name+"]: "+this.message}},H=class n6 extends WSe{constructor(e,i,r){if(super(e,i,r),!(this instanceof n6))return new n6(e,i,r)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(e,i)=>{if(i&&typeof i=="object"&&typeof i.toJSON=="function")return i;try{return se(i)}catch{return"[object]"}}))}}catch(e){throw re.getLogger("esri.core.Error").error(e),e}return{name:this.name,message:this.message,details:this.details}}static fromJSON(e){return new n6(e.name,e.message,e.details)}};H.prototype.type="error";function z8(t,e,i){if(t&&e)if(typeof e=="object")for(const r of Object.getOwnPropertyNames(e))z8(t,r,e[r]);else{if(e.includes(".")){const n=e.split("."),s=n.splice(n.length-1,1)[0];return void z8(V8(t,n),s,i)}const r=t.__accessor__;r!=null&&P7e(e,r),t[e]=i}}function P7e(t,e){if(ue("esri-unknown-property-errors")&&!I7e(t,e))throw new H("set:unknown-property",$7e(t,e))}function I7e(t,e){return e.metadatas[t]!=null}function $7e(t,e){return"setting unknown property '"+t+"' on instance of "+e.host.declaredClass}function d(t={}){return(e,i)=>{if(e===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${e.name}.${i}. Accessor does not support static properties.`);const r=Object.getOwnPropertyDescriptor(e,i),n=R9(e,i);r&&(r.get||r.set?(n.get=r.get||n.get,n.set=r.set||n.set):"value"in r&&("value"in t&&re.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${i}" on "${e.constructor.name}" already defined in the metadata`,t),n.value=t.value=r.value)),t.readOnly!=null&&(n.readOnly=t.readOnly);const s=t.aliasOf;if(s){const l=typeof s=="string"?s:s.source,c=typeof s=="string"?null:s.overridable===!0;let h;n.dependsOn=[l],n.get=function(){let p=V8(this,l);if(typeof p=="function"){h||(h=l.split(".").slice(0,-1).join("."));const f=V8(this,h);f&&(p=p.bind(f))}return p},n.readOnly||(n.set=c?function(p){this._override(i,p)}:function(p){z8(this,l,p)})}const o=t.type,a=t.types;n.cast||(o?n.cast=L7e(o):a&&(Array.isArray(a)?n.cast=FL(pm(a[0])):n.cast=pm(a))),A7e(n,t),t.range&&(n.cast=D7e(n.cast,t.range))}}function YSe(t,e,i){const r=R9(t,i);r.json||(r.json={});let n=r.json;return e!==void 0&&(n.origins||(n.origins={}),n.origins[e]||(n.origins[e]={}),n=n.origins[e]),n}function L7e(t){let e=0,i=t;if(T7e(t))return BSe(t);for(;Array.isArray(i)&&i.length===1&&typeof i[0]!="string"&&typeof i[0]!="number";)i=i[0],e++;const r=i;if(zSe(r))return e===0?nY(r):k8(nY(r),e);if(e===1)return w7e(r);if(e>1)return x7e(r,e);const n=t;return n.from?n.from:Ts(n)}function D7e(t,e){return i=>{let r=+t(i);return e.step!=null&&(r=Math.round(r/e.step)*e.step),e.min!=null&&(r=Math.max(e.min,r)),e.max!=null&&(r=Math.min(e.max,r)),r}}const ZSe=Symbol("Accessor-beforeDestroy");var z0;(function(t){t[t.INITIALIZING=0]="INITIALIZING",t[t.CONSTRUCTING=1]="CONSTRUCTING",t[t.CONSTRUCTED=2]="CONSTRUCTED"})(z0||(z0={}));var Xr;(function(t){t[t.Dirty=1]="Dirty",t[t.Overriden=2]="Overriden",t[t.Computing=4]="Computing",t[t.NonNullable=8]="NonNullable",t[t.HasDefaultValue=16]="HasDefaultValue",t[t.DepTrackingInitialized=32]="DepTrackingInitialized",t[t.AutoTracked=64]="AutoTracked",t[t.ExplicitlyTracking=128]="ExplicitlyTracking"})(Xr||(Xr={}));const B8={onObservableAccessed:()=>{},onTrackingEnd:()=>{}},SP=[];let v$=B8;function Ei(t){v$.onObservableAccessed(t)}let s6=!1,o6=!1;function T_(t,e,i){if(s6)return Yre(t,e,i);JSe(t);const r=e.call(i);return KSe(),r}function N7e(t,e){return T_(B8,t,e)}function Yre(t,e,i){const r=s6;s6=!0,JSe(t);let n=null;try{n=e.call(i)}catch(s){o6&&re.getLogger("esri.core.accessorSupport.tracking").error(s)}return KSe(),s6=r,n}function JSe(t){v$=t,SP.push(t)}function KSe(){const t=SP.length;if(t>1){const e=SP.pop();v$=SP[t-2],e.onTrackingEnd()}else if(t===1){const e=SP.pop();v$=B8,e.onTrackingEnd()}else v$=B8}function QSe(t,e){const i=e.observerObject;if(i.flags&Xr.DepTrackingInitialized)return;const r=o6;o6=!1,i.flags&Xr.AutoTracked?Yre(e,e.metadata.get,t):e2e(t,e),o6=r}const F7e=[];function e2e(t,e){const i=e.observerObject;i.flags&Xr.ExplicitlyTracking||(i.flags|=Xr.ExplicitlyTracking,Yre(e,()=>{const r=e.metadata.dependsOn||F7e;for(const n of r)if(typeof n!="string"||n.includes(".")){const s=jSe(n);for(let o=0,a=t;o<s.length&&a!=null&&typeof a=="object";++o)a=The(a,s[o],o!==s.length-1)}else The(t,n,!1)}),i.flags&=~Xr.ExplicitlyTracking)}function The(t,e,i){var s;const r=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const o=parseInt(r,10);if(!isNaN(o))return Array.isArray(t)?t[o]:t.getItemAt(o)}const n=(s=Ql(t))==null?void 0:s.properties.get(r);return n&&(Ei(n.observerObject),QSe(t,n)),i?t[r]:void 0}function k7e(t){if(t.json&&t.json.origins){const e=t.json.origins,i={"web-document":["web-scene","web-map"]};for(const r in i)if(e[r]){const n=e[r];i[r].forEach(s=>{e[s]=n}),delete e[r]}}}let Op=class aY extends WSe{constructor(e,i,r){if(super(e,i,r),!(this instanceof aY))return new aY(e,i,r)}};Op.prototype.type="warning";function t2e(t){return!!t&&t.prototype&&t.prototype.declaredClass&&t.prototype.declaredClass.indexOf("esri.core.Collection")===0}const lY=re.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function She(t,e,i){var r,n;t&&(!i&&!e.read||(r=e.read)!=null&&r.reader||((n=e.read)==null?void 0:n.enabled)===!1||z7e(t)&&va("read.reader",Ow(t),e))}function Ow(t){var i,r;const e=t.ndimArray??0;if(e>1)return V7e(t);if(e===1)return Ehe(t);if("type"in t&&r2e(t.type)){const n=(r=(i=t.type.prototype)==null?void 0:i.itemType)==null?void 0:r.Type,s=Ehe(typeof n=="function"?{type:n}:{types:n});return(o,a,l)=>{const c=s(o,a,l);return c&&new t.type(c)}}return Zre(t)}function Zre(t){return"type"in t?U7e(t.type):B7e(t.types)}function U7e(t){return t.prototype.read?(e,i,r)=>{if(e==null)return e;const n=typeof e;if(n!=="object")return void lY.error(`Expected JSON value of type 'object' to deserialize type '${t.prototype.declaredClass}', but got '${n}'`);const s=new t;return s.read(e,r),s}:t.fromJSON}function i2e(t,e,i,r){return r!==0&&Array.isArray(e)?e.map(n=>i2e(t,n,i,r-1)):t(e,void 0,i)}function V7e(t){const e=Zre(t),i=i2e.bind(null,e),r=t.ndimArray??0;return(n,s,o)=>{if(n==null)return n;n=i(n,o,r);let a=r,l=n;for(;a>0&&Array.isArray(l);)a--,l=l[0];if(l!==void 0)for(let c=0;c<a;c++)n=[n];return n}}function Ehe(t){const e=Zre(t);return(i,r,n)=>{if(i==null)return i;if(Array.isArray(i)){const o=[];for(const a of i){const l=e(a,void 0,n);l!==void 0&&o.push(l)}return o}const s=e(i,void 0,n);return s!==void 0?[s]:void 0}}function r2e(t){if(!t2e(t))return!1;const e=t.prototype.itemType;return!(!e||!e.Type)&&(typeof e.Type=="function"?Jre(e.Type):n2e(e.Type))}function z7e(t){return"types"in t?n2e(t.types):Jre(t.type)}function Jre(t){return!Array.isArray(t)&&!!t&&t.prototype&&("read"in t.prototype||"fromJSON"in t||r2e(t))}function n2e(t){for(const e in t.typeMap)if(!Jre(t.typeMap[e]))return!1;return!0}function B7e(t){let e=null;const i=t.errorContext??"type";return(r,n,s)=>{if(r==null)return r;const o=typeof r;if(o!=="object")return void lY.error(`Expected JSON value of type 'object' to deserialize, but got '${o}'`);e||(e=j7e(t));const a=t.key;if(typeof a!="string")return;const l=r[a],c=l?e[l]:t.defaultKeyValue?t.typeMap[t.defaultKeyValue]:void 0;if(!c){const p=`Type '${l||"unknown"}' is not supported`;return s&&s.messages&&r&&s.messages.push(new Op(`${i}:unsupported`,p,{definition:r,context:s})),void lY.error(p)}const h=new c;return h.read(r,s),h}}function j7e(t){var i,r;const e={};for(const n in t.typeMap){const s=t.typeMap[n],o=dN(s.prototype);if(typeof t.key=="function")continue;const a=o[t.key];if(!a)continue;(i=a.json)!=null&&i.type&&Array.isArray(a.json.type)&&a.json.type.length===1&&typeof a.json.type[0]=="string"&&(e[a.json.type[0]]=s);const l=(r=a.json)==null?void 0:r.write;if(!l||!l.writer){e[n]=s;continue}const c=l.target,h=typeof c=="string"?c:t.key,p={};l.writer(n,p,h),p[h]&&(e[p[h]]=s)}return e}function G7e(t){if(t.json||(t.json={}),Ahe(t.json),Rhe(t.json),Che(t.json),t.json.origins)for(const e in t.json.origins)Ahe(t.json.origins[e]),Rhe(t.json.origins[e]),Che(t.json.origins[e]);return!0}function Che(t){t.name&&(t.read&&typeof t.read=="object"?t.read.source===void 0&&(t.read.source=t.name):t.read={source:t.name},t.write&&typeof t.write=="object"?t.write.target===void 0&&(t.write.target=t.name):t.write={target:t.name})}function Ahe(t){typeof t.read=="boolean"?t.read={enabled:t.read}:typeof t.read=="function"?t.read={enabled:!0,reader:t.read}:t.read&&typeof t.read=="object"&&t.read.enabled===void 0&&(t.read.enabled=!0)}function Rhe(t){typeof t.write=="boolean"?t.write={enabled:t.write}:typeof t.write=="function"?t.write={enabled:!0,writer:t.write}:t.write&&typeof t.write=="object"&&t.write.enabled===void 0&&(t.write.enabled=!0)}function Mhe(t,e){if(!e.write||e.write.writer||e.write.enabled===!1&&!e.write.overridePolicy)return;const i=(t==null?void 0:t.ndimArray)??0;t&&(i===1||"type"in t&&t2e(t.type))?e.write.writer=W7e:i>1?e.write.writer=X7e(i):e.types?Array.isArray(e.types)?e.write.writer=q7e(e.types[0]):e.write.writer=H7e(e.types):e.write.writer=kL}function H7e(t){return(e,i,r,n)=>e?s2e(e,t,n)?kL(e,i,r,n):void 0:kL(e,i,r,n)}function s2e(t,e,i){for(const r in e.typeMap)if(t instanceof e.typeMap[r])return!0;if(i!=null&&i.messages){const r=e.errorContext??"type",n=`Values of type '${(typeof e.key!="function"?t[e.key]:t.declaredClass)??"Unknown"}' cannot be written`;i&&i.messages&&t&&i.messages.push(new H(`${r}:unsupported`,n,{definition:t,context:i})),re.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(n)}return!1}function q7e(t){return(e,i,r,n)=>!e||!Array.isArray(e)?kL(e,i,r,n):kL(e.filter(s=>s2e(s,t,n)),i,r,n)}function kL(t,e,i,r){va(i,j8(t,r),e)}function j8(t,e){return t&&typeof t.write=="function"?t.write({},e):t&&typeof t.toJSON=="function"?t.toJSON():typeof t=="number"?G8(t):t}function G8(t){return t===-1/0?-Number.MAX_VALUE:t===1/0?Number.MAX_VALUE:isNaN(t)?null:t}function W7e(t,e,i,r){let n;t===null?n=null:t&&typeof t.map=="function"?(n=t.map(s=>j8(s,r)),typeof n.toArray=="function"&&(n=n.toArray())):n=[j8(t,r)],va(i,n,e)}function o2e(t,e,i){return i!==0&&Array.isArray(t)?t.map(r=>o2e(r,e,i-1)):j8(t,e)}function X7e(t){return(e,i,r,n)=>{let s;if(e===null)s=null;else{s=o2e(e,n,t);let o=t,a=s;for(;o>0&&Array.isArray(a);)o--,a=a[0];if(a!==void 0)for(let l=0;l<o;l++)s=[s]}va(r,s,i)}}function cY(t,e){return Kre(t,"read",e)}function a2e(t,e){return Kre(t,"write",e)}function Kre(t,e,i){let r=t&&t.json;if(t&&t.json&&t.json.origins&&i){const n=i.origin&&t.json.origins[i.origin];n&&(e==="any"||e in n)&&(r=n)}return r}function Y7e(t){const e=Z7e(t);if(t.json.origins)for(const i in t.json.origins){const r=t.json.origins[i],n=r.types?J7e(r):e;She(n,r,!1),r.types&&!r.write&&t.json.write&&t.json.write.enabled&&(r.write={...t.json.write}),Mhe(n,r)}She(e,t.json,!0),Mhe(e,t.json)}function Z7e(t){return t.json.types?uY(t.json):t.type?l2e(t):uY(t)}function J7e(t){return t.type?l2e(t):uY(t)}function l2e(t){if(!t.type)return;let e=0,i=t.type;for(;Array.isArray(i)&&!zSe(i);)i=i[0],e++;return{type:i,ndimArray:e}}function uY(t){if(!t.types)return;let e=0,i=t.types;for(;Array.isArray(i);)i=i[0],e++;return{types:i,ndimArray:e}}function K7e(t){G7e(t)&&(k7e(t),Y7e(t))}const Mj=new Set,Oj=new Set;function $(t){return e=>{e.prototype.declaredClass=t,eje(e);const i=[],r=[];let n=e.prototype;for(;n;)n.hasOwnProperty("initialize")&&!Mj.has(n.initialize)&&(Mj.add(n.initialize),i.push(n.initialize)),n.hasOwnProperty("destroy")&&!Oj.has(n.destroy)&&(Oj.add(n.destroy),r.push(n.destroy)),n=Object.getPrototypeOf(n);Mj.clear(),Oj.clear();class s extends e{constructor(...a){if(super(...a),this.constructor===s&&typeof this.postscript=="function"){if(i.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=i.length-1;l>=0;l--)i[l].call(this)}}),r.length){let l=!1;const c=this[ZSe];Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){l=!0,c.call(this);for(let h=0;h<r.length;h++)r[h].call(this)}}})}this.postscript(...a)}}}return s.__accessorMetadata__=dN(e.prototype),s.prototype.declaredClass=t,s}}function Q7e(t,e){return e.get==null?function(){const i=this.__accessor__.properties.get(t);if(i===void 0)return;Ei(i.observerObject);const r=this.__accessor__.store;return r.has(t)?r.get(t):i.metadata.value}:function(){const i=this.__accessor__.properties.get(t);if(i!==void 0)return i.getComputed()}}function eje(t){const e=t.prototype,i=dN(e),r={};for(const n of Object.getOwnPropertyNames(i)){const s=i[n];K7e(s),r[n]={enumerable:!0,configurable:!0,get:Q7e(n,s),set(o){const a=this.__accessor__;if(a!==void 0){if(!Object.isFrozen(this)){if(a.initialized&&s.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${n}' of ${this.declaredClass}`);if(a.lifecycle===z0.CONSTRUCTED&&s.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${n}' of ${this.declaredClass}`);a.set(n,o)}}else Object.defineProperty(this,n,{enumerable:!0,configurable:!0,writable:!0,value:o})}}}Object.defineProperties(t.prototype,r)}function w8t(t){const e=[];return function*(){yield*e;for(const i of t)e.push(i),yield i}}function tje(t,e){for(const i of t)if(i!=null&&e(i))return i}function UL(t){return t!=null&&typeof t[Symbol.iterator]=="function"}let Xi=class{constructor(){this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(i=>{e+=i.length}),e}add(e,i){if(UL(e)){const r=this._getOrCreateGroup(i);for(const n of e)this._isHandle(n)&&r.push(n)}else this._isHandle(e)&&this._getOrCreateGroup(i).push(e);return this}forEach(e,i){if(typeof e=="function")this._groups.forEach(r=>r.forEach(e));else{const r=this._getGroup(e);r&&i&&r.forEach(i)}}has(e){return this._groups.has(this._ensureGroupKey(e))}remove(e){if(typeof e!="string"&&UL(e)){for(const i of e)this.remove(i);return this}return this.has(e)?(this._removeAllFromGroup(this._getGroup(e)),this._groups.delete(this._ensureGroupKey(e)),this):this}removeAll(){return this._groups.forEach(e=>this._removeAllFromGroup(e)),this._groups.clear(),this}_isHandle(e){return e&&!!e.remove}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const i=[];return this._groups.set(this._ensureGroupKey(e),i),i}_getGroup(e){return this._groups.get(this._ensureGroupKey(e))}_ensureGroupKey(e){return e||"_default_"}_removeAllFromGroup(e){e.forEach(i=>i.remove())}};function ije(t){return t&&t.release&&typeof t.release=="function"}function rje(t){return t&&t.acquire&&typeof t.acquire=="function"}let zo=class hY{constructor(e,i,r,n=1,s=0){if(this._ctor=e,this._acquireFunction=i,this._releaseFunction=r,this.allocationSize=n,this._pool=new Array(s),this._initialSize=s,this._ctor)for(let o=0;o<s;o++)this._pool[o]=new this._ctor;this.allocationSize=Math.max(n,1)}destroy(){this.prune(0)}acquire(...e){let i;if(hY.test.disabled)i=new this._ctor;else{if(this._pool.length===0){const r=this.allocationSize;for(let n=0;n<r;n++)this._pool[n]=new this._ctor}i=this._pool.pop()}return this._acquireFunction?this._acquireFunction(i,...e):rje(i)&&i.acquire(...e),i}release(e){e&&!hY.test.disabled&&(this._releaseFunction?this._releaseFunction(e):ije(e)&&e.release(),this._pool.push(e))}prune(e=this._initialSize){if(!(e>=this._pool.length)){for(let i=e;i<this._pool.length;++i){const r=this._pool[i];this._dispose(r)}this._pool.length=e}}_dispose(e){e.dispose&&typeof e.dispose=="function"&&e.dispose()}};zo.test={disabled:!1};let nje=class{constructor(e,i){this._observers=e,this._observer=i}remove(){Ure(this._observers,this._observer)}},c2e=class{constructor(){this._observers=null,this.destroyed=!1}observe(e){if(this.destroyed||e.destroyed)return sje;this._observers==null&&(this._observers=[]);const i=this._observers;let r=!1,n=!1;const s=i.length;for(let o=0;o<s;++o){const a=i[o];if(a.destroyed)n=!0;else if(a===e){r=!0;break}}return r||(i.push(e),n&&this._removeDestroyedObservers()),new nje(i,e)}_removeDestroyedObservers(){const e=this._observers;if(!e||e.length===0)return;const i=e.length;let r=0;for(let n=0;n<i;++n){for(;n+r<i&&e[n+r].destroyed;)++r;if(r>0){if(!(n+r<i))break;e[n]=e[n+r]}}e.length=i-r}destroy(){if(this.destroyed)return;this.destroyed=!0;const e=this._observers;if(e!=null){for(const i of e)i.onCommitted();this._observers=null}}};const sje={remove:()=>{}};var Qi;(function(t){t[t.DEFAULTS=0]="DEFAULTS",t[t.COMPUTED=1]="COMPUTED",t[t.SERVICE=2]="SERVICE",t[t.PORTAL_ITEM=3]="PORTAL_ITEM",t[t.WEB_SCENE=4]="WEB_SCENE",t[t.WEB_MAP=5]="WEB_MAP",t[t.USER=6]="USER"})(Qi||(Qi={}));const dY=Qi.USER+1;function cb(t){switch(t){case"defaults":return Qi.DEFAULTS;case"service":return Qi.SERVICE;case"portal-item":return Qi.PORTAL_ITEM;case"web-scene":return Qi.WEB_SCENE;case"web-map":return Qi.WEB_MAP;case"user":return Qi.USER;default:return null}}function H8(t){switch(t){case Qi.DEFAULTS:return"defaults";case Qi.SERVICE:return"service";case Qi.PORTAL_ITEM:return"portal-item";case Qi.WEB_SCENE:return"web-scene";case Qi.WEB_MAP:return"web-map";case Qi.USER:return"user"}return void 0}function oje(t){return H8(t)}let Ohe=class{constructor(e,i,r){this.properties=e,this.propertyName=i,this.metadata=r,this.observerObject=new aje,this._accessed=null,this._handles=null,this.observerObject.flags=Xr.Dirty|(r.nonNullable?Xr.NonNullable:0)|(r.hasOwnProperty("value")?Xr.HasDefaultValue:0)|(r.get===void 0?Xr.DepTrackingInitialized:0)|(r.dependsOn===void 0?Xr.AutoTracked:0),Phe.register(this,this.observerObject)}destroy(){this.observerObject.destroy(),this._accessed=null,this._clearObservationHandles(),Phe.unregister(this)}getComputed(){const e=this.observerObject;Ei(e);const i=this.properties.store,r=this.propertyName,n=e.flags,s=i.get(r);if(n&Xr.Computing||~n&Xr.Dirty&&i.has(r))return s;e.flags|=Xr.Computing;const o=this.properties.host;let a;n&Xr.AutoTracked?a=T_(this,this.metadata.get,o):(e2e(o,this),a=this.metadata.get.call(o)),i.set(r,a,Qi.COMPUTED);const l=i.get(r);return l===s?e.flags&=~Xr.Dirty:N7e(this.commit,this),e.flags&=~Xr.Computing,l}onObservableAccessed(e){e!==this.observerObject&&(this._accessed===null&&(this._accessed=[]),this._accessed.includes(e)||this._accessed.push(e))}onTrackingEnd(){this._clearObservationHandles();const e=this.observerObject;e.flags|=Xr.DepTrackingInitialized;const i=this._accessed;if(i===null)return;let r=this._handles;r===null&&(r=this._handles=[]);for(let n=0;n<i.length;++n)r.push(i[n].observe(e));i.length=0}notifyChange(){const e=this.observerObject;e.onInvalidated(),e.onCommitted()}invalidate(){this.observerObject.onInvalidated()}commit(){const e=this.observerObject;e.flags&=~Xr.Dirty,e.onCommitted()}_clearObservationHandles(){const e=this._handles;if(e!==null){for(let i=0;i<e.length;++i)e[i].remove();e.length=0}}},aje=class extends c2e{constructor(){super(...arguments),this.flags=0}onInvalidated(){~this.flags&Xr.Overriden&&(this.flags|=Xr.Dirty);const e=this._observers;if(e&&e.length>0)for(const i of e)i.onInvalidated()}onCommitted(){const e=this._observers;if(e&&e.length>0){const i=e.slice();for(const r of i)r.onCommitted()}}destroy(){this.flags&Xr.Dirty&&this.onCommitted(),super.destroy()}};const Phe=new FinalizationRegistry(t=>{t.destroy()});let lje=class u2e{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const i=new u2e;return this._values.forEach((r,n)=>{e&&e.has(n)||i.set(n,se(r))}),i}get(e){return this._values.get(e)}originOf(){return Qi.USER}keys(){return[...this._values.keys()]}set(e,i){this._values.set(e,i)}delete(e){this._values.delete(e)}has(e){return this._values.has(e)}forEach(e){this._values.forEach(e)}};function PF(t,e,i){return t!==void 0}function Ihe(t,e,i,r){return t!==void 0&&(!(i==null&&t.observerObject.flags&Xr.NonNullable)||(r.lifecycle,z0.INITIALIZING,!1))}function cje(t){return t&&typeof t.destroy=="function"}re.getLogger("esri.core.accessorSupport.Properties");let uje=class{constructor(e){this.host=e,this.properties=new Map,this.ctorArgs=null,this.destroyed=!1,this.lifecycle=z0.INITIALIZING,this.store=new lje,this._origin=Qi.USER;const i=this.host.constructor.__accessorMetadata__;for(const r in i){const n=new Ohe(this,r,i[r]);this.properties.set(r,n)}this.metadatas=i}initialize(){this.lifecycle=z0.CONSTRUCTING}constructed(){this.lifecycle=z0.CONSTRUCTED}destroy(){this.destroyed=!0;for(const[e,i]of this.properties){if(i.metadata.autoDestroy){const r=this.internalGet(e);r&&cje(r)&&(r.destroy(),~i.observerObject.flags&Xr.NonNullable&&this._internalSet(i,null))}i.destroy()}}get initialized(){return this.lifecycle!==z0.INITIALIZING}get(e){const i=this.properties.get(e);if(i.metadata.get)return i.getComputed();Ei(i.observerObject);const r=this.store;return r.has(e)?r.get(e):i.metadata.value}originOf(e){const i=this.store.originOf(e);if(i===void 0){const r=this.properties.get(e);if(r!==void 0&&r.observerObject.flags&Xr.HasDefaultValue)return"defaults"}return H8(i)}has(e){return!!this.properties.has(e)&&this.store.has(e)}keys(){return[...this.properties.keys()]}internalGet(e){const i=this.properties.get(e);if(PF(i))return this.store.has(e)?this.store.get(e):i.metadata.value}internalSet(e,i){const r=this.properties.get(e);PF(r)&&this._internalSet(r,i)}getDependsInfo(e,i,r){const n=this.properties.get(i);if(!PF(n))return"";const s=new Set,o=T_({onObservableAccessed:l=>s.add(l),onTrackingEnd:()=>{}},()=>{var l;return(l=n.metadata.get)==null?void 0:l.call(e)});let a=`${r}${e.declaredClass.split(".").pop()}.${i}: ${o}
`;if(s.size===0)return a;r+="  ";for(const l of s){if(!(l instanceof Ohe))continue;const c=l.properties.host,h=l.propertyName,p=Ql(c);a+=p?p.getDependsInfo(c,h,r):`${r}${h}: undefined
`}return a}setAtOrigin(e,i,r){const n=this.properties.get(e);if(PF(n))return this._setAtOrigin(n,i,r)}isOverridden(e){const i=this.properties.get(e);return i!==void 0&&!!(i.observerObject.flags&Xr.Overriden)}clearOverride(e){const i=this.properties.get(e),r=i==null?void 0:i.observerObject;r&&r.flags&Xr.Overriden&&(r.flags&=~Xr.Overriden,i.notifyChange())}override(e,i){const r=this.properties.get(e);if(!Ihe(r,e,i,this))return;const n=r.metadata.cast;if(n){const s=this._cast(n,i),{valid:o,value:a}=s;if(Pj.release(s),!o)return;i=a}r.observerObject.flags|=Xr.Overriden,this._internalSet(r,i)}set(e,i){const r=this.properties.get(e);if(!Ihe(r,e,i,this))return;const n=r.metadata.cast;if(n){const o=this._cast(n,i),{valid:a,value:l}=o;if(Pj.release(o),!a)return;i=l}const s=r.metadata.set;s?s.call(this.host,i):this._internalSet(r,i)}setDefaultOrigin(e){this._origin=cb(e)}getDefaultOrigin(){return H8(this._origin)}notifyChange(e){const i=this.properties.get(e);i!==void 0&&i.notifyChange()}invalidate(e){const i=this.properties.get(e);i!==void 0&&i.invalidate()}commit(e){const i=this.properties.get(e);i!==void 0&&i.commit()}_internalSet(e,i){const r=this.lifecycle!==z0.INITIALIZING?this._origin:Qi.DEFAULTS;this._setAtOrigin(e,i,r)}_setAtOrigin(e,i,r){const n=this.store,s=e.propertyName;n.has(s,r)&&Gre(i,n.get(s))&&~e.observerObject.flags&Xr.Overriden&&r===n.originOf(s)||(e.invalidate(),n.set(s,i,r),e.commit(),QSe(this.host,e))}_cast(e,i){const r=Pj.acquire();return r.valid=!0,r.value=i,e&&(r.value=e.call(this.host,i,r)),r}},hje=class{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}};const Pj=new zo(hje);function dje(t){t.length=0}let Vc=class{constructor(e=50,i=50){this._pool=new zo(Array,void 0,dje,i,e)}acquire(){return this._pool.acquire()}release(e){this._pool.release(e)}prune(){this._pool.prune(0)}static acquire(){return Ij.acquire()}static release(e){return Ij.release(e)}static prune(){Ij.prune()}};const Ij=new Vc(100);let h2e=class extends zo{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=e2(this._set)}acquire(...e){const i=super.acquire(...e);return this._set.delete(i),i}release(e){e&&!this._set.has(e)&&(super.release(e),this._set.add(e))}_dispose(e){this._set.delete(e),super._dispose(e)}};const IF=[];function dM(t){IF.push(t),IF.length===1&&queueMicrotask(()=>{const e=IF.slice();IF.length=0;for(const i of e)i()})}let X0=class{constructor(e,i=30){this.name=e,this._counter=0,this._samples=new Array(i)}record(e){v(e)&&(this._samples[++this._counter%this._samples.length]=e)}get median(){return this._samples.slice().sort((e,i)=>e-i)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((e,i)=>e+i,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}};var pY;(function(t){const e=(s,o,a,l)=>{let c=o,h=o;const p=a>>>1,f=s[c-1];for(;h<=p;){h=c<<1,h<a&&l(s[h-1],s[h])<0&&++h;const m=s[h-1];if(l(m,f)<=0)break;s[c-1]=m,c=h}s[c-1]=f},i=(s,o)=>s<o?-1:s>o?1:0;function r(s,o,a,l){o===void 0&&(o=0),a===void 0&&(a=s.length),l===void 0&&(l=i);for(let h=a>>>1;h>o;h--)e(s,h,a,l);const c=o+1;for(let h=a-1;h>o;h--){const p=s[o];s[o]=s[h],s[h]=p,e(s,c,h,l)}}function*n(s,o,a,l){o===void 0&&(o=0),a===void 0&&(a=s.length),l===void 0&&(l=i);for(let h=a>>>1;h>o;h--)e(s,h,a,l),yield;const c=o+1;for(let h=a-1;h>o;h--){const p=s[o];s[o]=s[h],s[h]=p,e(s,c,h,l),yield}}t.sort=r,t.iterableSort=n})(pY||(pY={}));const $he=pY,pje=1.5,fje=1.1;let Wt=class{constructor(e){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new kre,e&&(e.initialSize&&(this.data=new Array(e.initialSize)),e.allocator&&(this._allocator=e.allocator),e.deallocator!==void 0&&(this._deallocator=e.deallocator),e.shrink&&(this._shrink=()=>Lhe(this)))}toArray(){return this.data.slice(0,this.length)}filter(e){const i=new Array;for(let r=0;r<this._length;r++){const n=this.data[r];e(n)&&i.push(n)}return i}getItemAt(e){if(!(e<0||e>=this._length))return this.data[e]}includes(e,i){const r=this.data.indexOf(e,i);return r!==-1&&r<this.length}get length(){return this._length}set length(e){if(e>this._length){if(this._allocator){for(;this._length<e;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=e}else{if(this._deallocator)for(let i=e;i<this._length;++i)this.data[i]=this._deallocator(this.data[i]);this._length=e,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(e){this.data[this._length++]=e}pushArray(e,i=e.length){for(let r=0;r<i;r++)this.data[this._length++]=e[r]}fill(e,i){for(let r=0;r<i;r++)this.data[this._length++]=e}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const e=this.data[this._length];return++this._length,e}unshift(e){this.data.unshift(e),this._length++,Lhe(this)}pop(){if(this.length===0)return;const e=this.data[this.length-1];return this.length=this.length-1,this._shrink(),e}remove(e){const i=DL(this.data,e,this.length,this._hint);if(i!==-1)return this.data.splice(i,1),this.length=this.length-1,e}removeUnordered(e){return this.removeUnorderedIndex(DL(this.data,e,this.length,this._hint))}removeUnorderedIndex(e){if(!(e>=this.length||e<0))return this.swapElements(e,this.length-1),this.pop()}removeUnorderedMany(e,i=e.length,r){this.length=n7e(this.data,e,this.length,i,this._hint,r),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(e,i){if(e>=this.length||i>=this.length||e===i)return;const r=this.data[e];this.data[e]=this.data[i],this.data[i]=r}sort(e){$he.sort(this.data,0,this.length,e)}iterableSort(e){return $he.iterableSort(this.data,0,this.length,e)}some(e,i){for(let r=0;r<this.length;++r)if(e.call(i,this.data[r],r,this.data))return!0;return!1}find(e,i){for(let r=0;r<this.length;++r){const n=this.data[r];if(e.call(i,n,r))return n}}filterInPlace(e,i){let r=0;for(let n=0;n<this._length;++n){const s=this.data[n];e.call(i,s,n,this.data)&&(this.data[n]=this.data[r],this.data[r]=s,r++)}if(this._deallocator)for(let n=r;n<this._length;n++)this.data[n]=this._deallocator(this.data[n]);return this._length=r,this._shrink(),this}forAll(e,i){const r=this.length,n=this.data;for(let s=0;s<r;++s)e.call(i,n[s],s,n)}forEach(e,i){for(let r=0;r<this.length;++r)e.call(i,this.data[r],r,this.data)}map(e,i){const r=new Array(this.length);for(let n=0;n<this.length;++n)r[n]=e.call(i,this.data[n],n,this.data);return r}reduce(e,i){let r=i;for(let n=0;n<this.length;++n)r=e(r,this.data[n],n,this.data);return r}has(e){const i=this.length,r=this.data;for(let n=0;n<i;++n)if(r[n]===e)return!0;return!1}};function Lhe(t){t.data.length>pje*t.length&&(t.data.length=Math.floor(t.length*fje))}function mje(t){return{setTimeout:(e,i)=>{const r=t.setTimeout(e,i);return{remove:()=>t.clearTimeout(r)}}}}const pN=mje(globalThis),Dhe=new Set;function gje(t,e,i=!1){i&&Dhe.has(e)||(i&&Dhe.add(e),t.warn(` DEPRECATED - ${e}`))}function fS(t,e,i={}){if(ue("esri-deprecation-warnings")){const{moduleName:r}=i;d2e(t,`Property: ${(r?r+"::":"")+e}`,i)}}function d2e(t,e,i={}){if(ue("esri-deprecation-warnings")){const{replacement:r,version:n,see:s,warnOnce:o}=i;let a=e;r&&(a+=`
	 Replacement: ${r}`),n&&(a+=`
	 Version: ${n}`),s&&(a+=`
	 See ${s} for more details.`),gje(t,a,o)}}function M9(t){return t&&(typeof t.on=="function"||typeof t.addEventListener=="function")}function fN(t,e,i){if(!M9(t))throw new TypeError("target is not a Evented or EventTarget object");if("on"in t)return t.on(e,i);if(Array.isArray(e)){const r=e.slice();for(const n of r)t.addEventListener(n,i);return{remove(){for(const n of r)t.removeEventListener(n,i)}}}return t.addEventListener(e,i),{remove(){t.removeEventListener(e,i)}}}function p2e(t,e,i){if(!M9(t))throw new TypeError("target is not a Evented or EventTarget object");if("once"in t)return t.once(e,i);const r=fN(t,e,n=>{r.remove(),i.call(t,n)});return{remove(){r.remove()}}}const yje={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"};function up({key:t}){return yje[t]||t}function Bi(t="Aborted"){return new H("AbortError",t)}function ui(t,e="Aborted"){if(fo(t))throw Bi(e)}function O9(t){return v(t)?"aborted"in t?t:t.signal:t}function fo(t){const e=O9(t);return v(e)&&e.aborted}function Du(t){if(gs(t))throw t}function fY(t){if(!gs(t))throw t}function ja(t,e){const i=O9(t);if(!R(i)){if(!i.aborted)return p2e(i,"abort",()=>e());e()}}function P9(t,e){const i=O9(t);if(!R(i))return ui(i),p2e(i,"abort",()=>e(Bi()))}function Qre(t,e){const i=O9(e);return R(i)?t:new Promise((r,n)=>{let s=ja(e,()=>n(Bi()));const o=()=>s=Nr(s);t.then(o,o),t.then(r,n)})}function gs(t){return(t==null?void 0:t.name)==="AbortError"}async function CR(t){try{return await t}catch(e){if(!gs(e))throw e;return}}async function $8t(t,e=re.getLogger("esri")){try{return await t}catch(i){gs(i)||e.error(i)}}function S_(){let t=null;const e=new Promise((i,r)=>{t={promise:void 0,resolve:i,reject:r}});return t.promise=e,t}async function ma(t){if(!t)return;if(typeof t.forEach!="function"){const i=Object.keys(t),r=i.map(o=>t[o]),n=await ma(r),s={};return i.map((o,a)=>s[o]=n[a]),s}const e=t;return new Promise(i=>{const r=[];let n=e.length;n===0&&i(r),e.forEach(s=>{const o={promise:s||Promise.resolve(s)};r.push(o),o.promise.then(a=>{o.value=a}).catch(a=>{o.error=a}).then(()=>{--n,n===0&&i(r)})})})}async function mY(t){return(await ma(t)).filter(e=>!!e.value).map(e=>e.value)}function t2(t,e,i){const r=new AbortController;return ja(i,()=>r.abort()),new Promise((n,s)=>{let o=setTimeout(()=>{o=0,n(e)},t);ja(r,()=>{o&&(clearTimeout(o),s(Bi()))})})}function ih(t){return t&&typeof t.then=="function"}function gY(t){return ih(t)?t:Promise.resolve(t)}function f2e(t,e=-1){let i,r,n,s,o=null;const a=(...l)=>{if(i){r=l,s&&s.reject(Bi()),s=S_();const f=s.promise;if(o){const m=o;o=null,m.abort()}return f}if(n=s||S_(),s=null,e>0){const f=new AbortController;i=gY(t(...l,f.signal));const m=i;t2(e).then(()=>{i===m&&(s?f.abort():o=f)})}else i=1,i=gY(t(...l));const c=()=>{const f=r;r=n=i=o=null,f!=null&&a(...f)},h=i,p=n;return h.then(c,c),h.then(p.resolve,p.reject),p.promise};return a}function Jb(){let t,e;const i=new Promise((n,s)=>{t=n,e=s}),r=n=>{t(n)};return r.resolve=n=>t(n),r.reject=n=>e(n),r.timeout=(n,s)=>pN.setTimeout(()=>r.reject(s),n),r.promise=i,r}function L8t(t,e){return t.then(e,e)}async function Nhe(t){await Promise.resolve(),ui(t)}function D8t(t){return t}function m2e(t){return 1e3*t}function ene(t){return .001*t}let _je=class{constructor(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1}},vje=class{constructor(e){this.callback=e,this.isActive=!0}remove(){this.isActive=!1}},yY=0,_Y=0;const a3={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},vY=["prepare","preRender","render","postRender","update","finish"],bY=[],i2=new Wt;let bje=class{constructor(e){this._task=e}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}};const q8={frameTasks:i2,willDispatch:!1,clearFrameTasks:wje,dispatch:_2e,executeFrameTasks:Tje};function V2(t){const e=new vje(t);return bY.push(e),q8.willDispatch||(q8.willDispatch=!0,dM(_2e)),e}function E_(t){const e=new _je(t);return i2.push(e),W8==null&&(yY=performance.now(),W8=requestAnimationFrame(g2e)),new bje(e)}let W8=null;function wje(t=!1){i2.forAll(e=>{e.removed=!0}),t&&y2e()}function xje(t){_Y=Math.max(0,t)}function g2e(){const t=performance.now();W8=null,W8=i2.length>0?requestAnimationFrame(g2e):null,q8.executeFrameTasks(t)}function Tje(t){const e=t-yY;yY=t;const i=_Y>0?_Y:1e3/60,r=Math.max(0,e-i);a3.time=t,a3.frameDuration=i-r;for(let n=0;n<vY.length;n++){const s=performance.now(),o=vY[n];i2.forAll(a=>{var l;a.paused||a.removed||(n===0&&a.ticks++,a.phases[o]&&(a3.elapsedFrameTime=performance.now()-t,a3.deltaTime=a.ticks===0?0:e,(l=a.phases[o])==null||l.call(a,a3)))}),Sje[n].record(performance.now()-s)}y2e(),Eje.record(performance.now()-t)}const $F=new Wt;function y2e(){i2.forAll(t=>{t.removed&&$F.push(t)}),i2.removeUnorderedMany($F.data,$F.length),$F.clear()}function _2e(){for(;bY.length;){const t=bY.shift();t.isActive&&t.callback()}q8.willDispatch=!1}function U8t(t=1,e){const i=Jb(),r=()=>{fo(e)?i.reject(Bi()):t===0?i():(--t,dM(()=>r()))};return r(),i.promise}const Sje=vY.map(t=>new X0(t)),Eje=new X0("total");function a6(t,e){for(const i of t.entries())if(e(i[0]))return!0;return!1}let Cje=0;const Aje=0;function qu(){return++Cje}let I9=class{constructor(e){this._notify=e,this._accessed=[],this._handles=[],this._observerObject=new Rje(this._notify),Fhe.register(this,this._observerObject)}destroy(){var e;this._accessed.length=0,(e=this._observerObject)==null||e.destroy(),this.clear(),Fhe.unregister(this)}onObservableAccessed(e){const i=this._accessed;i.includes(e)||i.push(e)}onTrackingEnd(){const e=this._handles,i=this._accessed,r=this._observerObject;for(let n=0;n<i.length;++n)e.push(i[n].observe(r));i.length=0}clear(){const e=this._handles;for(let i=0;i<e.length;++i)e[i].remove();e.length=0}},Rje=class{constructor(e){this._notify=e,this._invalidCount=0,this.destroyed=!1}onInvalidated(){this._invalidCount++}onCommitted(){if(this.destroyed)return;const e=this._invalidCount;if(e===1)return this._invalidCount=0,void this._notify();this._invalidCount=e>0?e-1:0}destroy(){this.destroyed=!0,this._notify=Mje}};const Fhe=new FinalizationRegistry(t=>{t.destroy()});function Mje(){}let AR=!1;const X8=[];function v2e(t,e){let i=new I9(s),r=null,n=!1;function s(){if(!i||n)return;if(AR)return void x2e(s);const a=r;i.clear(),AR=!0,n=!0,r=T_(i,t),n=!1,AR=!1,e(r,a),T2e()}function o(){i&&(i.destroy(),i=null,r=null)}return n=!0,r=T_(i,t),n=!1,{remove:o}}function b2e(t,e){let i=new I9(n),r=null;function n(){e(r,o)}function s(){i&&(i.destroy(),i=null),r=null}function o(){return i?(i.clear(),r=T_(i,t),r):null}return o(),{remove:s}}function w2e(t){let e=new I9(r),i=!1;function r(){e&&!i&&(AR?x2e(r):(e.clear(),AR=!0,i=!0,T_(e,t),i=!1,AR=!1,T2e()))}function n(){e&&(e.destroy(),e=null)}return i=!0,T_(e,t),i=!1,{remove:n}}function x2e(t){X8.includes(t)||X8.unshift(t)}function T2e(){for(;X8.length;)X8.pop()()}var b$;(function(t){t[t.Untracked=0]="Untracked",t[t.Tracked=1]="Tracked"})(b$||(b$={}));let VL=class{constructor(){this.uid=qu(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(e,i,r,n,s){return this.pool.acquire(b$.Untracked,e,i,r,n,s,Gre)}static acquireTracked(e,i,r,n){return this.pool.acquire(b$.Tracked,e,i,r,null,null,n)}notify(e,i){this.type===b$.Untracked?this.callback.call(this.target,e,i,this.path,this.target):this.callback.call(null,e,i)}acquire(e,i,r,n,s,o,a){this.uid=qu(),this.removed=!1,this.type=e,this.oldValue=i,this.callback=r,this.getValue=n,this.target=s,this.path=o,this.equals=a}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=qu(),this.removed=!0}};VL.pool=new h2e(VL);const l6=new Vc,n_=new Set;let Y8;function Z8(t){n_.delete(t),n_.add(t),Y8||(Y8=V2(Ije))}function Oje(t){if(t.removed)return;const e=t.oldValue,i=t.getValue();t.equals(e,i)||(t.oldValue=i,t.notify(i,e))}function Pje(t){for(const e of n_.values())e.target===t&&(e.removed=!0)}function Ije(){let t=10;for(;Y8&&t--;){Y8=null;const e=$je(),i=l6.acquire();for(const r of e){const n=r.uid;Oje(r),n===r.uid&&r.removed&&i.push(r)}for(const r of n_)r.removed&&(i.push(r),n_.delete(r));for(const r of i)VL.pool.release(r);l6.release(i),l6.release(e),wY.forEach(r=>r())}}function $je(){const t=l6.acquire();t.length=n_.size;let e=0;for(const i of n_)t[e]=i,++e;return n_.clear(),t}const wY=new Set;function S2e(t){return wY.add(t),{remove(){wY.delete(t)}}}function Lje(t,e,i){let r=GSe(t,e,i,(n,s,o)=>{let a,l,c=b2e(()=>hN(n,s),(h,p)=>{n.__accessor__.destroyed||a&&a.uid!==l?r.remove():(a||(a=VL.acquireUntracked(h,o,p,n,s),l=a.uid),Z8(a))});return{remove:Xre(()=>{c.remove(),a&&(a.uid!==l||a.removed||(a.removed=!0,Z8(a)),a=null),r=c=null})}});return r}function Dje(t,e,i){const r=GSe(t,e,i,(n,s,o)=>{let a=!1;return v2e(()=>hN(n,s),(l,c)=>{n.__accessor__.destroyed?r.remove():a||(a=!0,Gre(c,l)||o.call(n,l,c,s,n),a=!1)})});return r}function Nje(t,e,i,r=!1){return!t.__accessor__||t.__accessor__.destroyed?{remove(){}}:r?Dje(t,e,i):Lje(t,e,i)}function Fje(t,e,i){let r,n,s=b2e(t,(o,a)=>{r&&r.uid!==n?s.remove():(r||(r=VL.acquireTracked(o,e,a,i),n=r.uid),Z8(r))});return{remove:Xre(()=>{s.remove(),r&&(r.uid!==n||r.removed||(r.removed=!0,Z8(r)),r=null),s=null})}}function kje(t,e,i){let r=!1;return v2e(t,(n,s)=>{r||(r=!0,i(s,n)||e(n,s),r=!1)})}function Uje(t,e,i=!1,r=h7e){return i?kje(t,e,r):Fje(t,e,r)}function khe(t){return a6(n_,e=>e.oldValue===t)}var E2e,C2e;function Vje(t){var e;if(t==null)return{value:t};if(Array.isArray(t))return{type:[t[0]],value:null};switch(typeof t){case"object":return(e=t.constructor)!=null&&e.__accessorMetadata__||t instanceof Date?{type:t.constructor,value:t}:t;case"boolean":return{type:Boolean,value:t};case"string":return{type:String,value:t};case"number":return{type:Number,value:t};case"function":return{type:t,value:null};default:return}}const Vx=Symbol("Accessor-Handles"),xY=Symbol("Accessor-Initialized");let ve=class A2e{static createSubclass(e={}){if(Array.isArray(e))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:i,declaredClass:r,constructor:n}=e;delete e.declaredClass,delete e.properties,delete e.constructor;const s=this;class o extends s{constructor(...l){super(...l),this.inherited=null,n&&n.apply(this,l)}}dN(o.prototype);for(const a in e){const l=e[a];o.prototype[a]=typeof l=="function"?function(...c){const h=this.inherited;let p;this.inherited=function(...f){if(s.prototype[a])return s.prototype[a].apply(this,f)};try{p=l.apply(this,c)}catch(f){throw this.inherited=h,f}return this.inherited=h,p}:e[a]}for(const a in i){const l=Vje(i[a]);d(l)(o.prototype,a)}return $(r)(o)}constructor(...e){if(this[E2e]=null,this[C2e]=!1,this.constructor===A2e)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");Object.defineProperty(this,"__accessor__",{enumerable:!1,value:new uje(this)}),e.length>0&&this.normalizeCtorArgs&&(this.__accessor__.ctorArgs=this.normalizeCtorArgs.apply(this,e))}postscript(e){const i=this.__accessor__,r=i.ctorArgs||e;i.initialize(),r&&(this.set(r),i.ctorArgs=null),i.constructed(),this.initialize(),this[xY]=!0}initialize(){}[ZSe](){this[Vx]=Ve(this[Vx])}destroy(){this.destroyed||(Pje(this),this.__accessor__.destroy())}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[xY]}get destroyed(){return this.__accessor__&&this.__accessor__.destroyed||!1}commitProperty(e){this.get(e)}get(e){return V8(this,e)}hasOwnProperty(e){return this.__accessor__?this.__accessor__.has(e):Object.prototype.hasOwnProperty.call(this,e)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(e,i){return z8(this,e,i),this}watch(e,i,r){return Nje(this,e,i,r)}own(e){this.addHandles(e)}addHandles(e,i){let r=this[Vx];R(r)&&(r=this[Vx]=new Xi),r.add(e,i)}removeHandles(e){const i=this[Vx];R(i)||i.remove(e)}hasHandles(e){const i=this[Vx];return!!v(i)&&i.has(e)}_override(e,i){i===void 0?this.__accessor__.clearOverride(e):this.__accessor__.override(e,i)}_clearOverride(e){return this.__accessor__.clearOverride(e)}_overrideIfSome(e,i){i==null?this.__accessor__.clearOverride(e):this.__accessor__.override(e,i)}_isOverridden(e){return this.__accessor__.isOverridden(e)}notifyChange(e){this.__accessor__.notifyChange(e)}_get(e){return this.__accessor__.internalGet(e)}_set(e,i){return this.__accessor__.internalSet(e,i),this}};E2e=Vx,C2e=xY;let zje=class R2e{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const i=new R2e;return this._values.forEach((r,n)=>{e&&e.has(n)||i.set(n,se(r.value),r.origin)}),i}get(e,i){i=this._normalizeOrigin(i);const r=this._values.get(e);return i==null||(r==null?void 0:r.origin)===i?r==null?void 0:r.value:void 0}originOf(e){var i;return((i=this._values.get(e))==null?void 0:i.origin)??Qi.USER}keys(e){e=this._normalizeOrigin(e);const i=[...this._values.keys()];return e==null?i:i.filter(r=>{var n;return((n=this._values.get(r))==null?void 0:n.origin)===e})}set(e,i,r){if((r=this._normalizeOrigin(r))===Qi.DEFAULTS){const n=this._values.get(e);if(n&&n.origin!=null&&n.origin>r)return}this._values.set(e,new Bje(i,r))}delete(e,i){var r;(i=this._normalizeOrigin(i))!=null&&((r=this._values.get(e))==null?void 0:r.origin)!==i||this._values.delete(e)}has(e,i){var r;return(i=this._normalizeOrigin(i))!=null?((r=this._values.get(e))==null?void 0:r.origin)===i:this._values.has(e)}forEach(e){this._values.forEach(({value:i},r)=>e(i,r))}_normalizeOrigin(e){if(e!=null)return e===Qi.DEFAULTS?e:Qi.USER}},Bje=class{constructor(e,i){this.value=e,this.origin=i}};function M2e(t,e,i){e.keys().forEach(n=>{i.set(n,e.get(n),Qi.DEFAULTS)});const r=t.metadatas;Object.keys(r).forEach(n=>{t.internalGet(n)&&i.set(n,t.internalGet(n),Qi.DEFAULTS)})}function jje(t,e,i){if(!t||!t.read||t.read.enabled===!1||!t.read.source)return!1;const r=t.read.source;if(typeof r=="string"){if(r===e||r.includes(".")&&r.indexOf(e)===0&&xhe(r,i))return!0}else for(const n of r)if(n===e||n.includes(".")&&n.indexOf(e)===0&&xhe(n,i))return!0;return!1}function Gje(t){return t&&(!t.read||t.read.enabled!==!1&&!t.read.source)}function Hje(t,e,i,r,n){let s=cY(e[i],n);Gje(s)&&(t[i]=!0);for(const o of Object.getOwnPropertyNames(e))s=cY(e[o],n),jje(s,i,r)&&(t[o]=!0)}function qje(t,e,i,r){const n=i.metadatas,s=Kre(n[e],"any",r),o=s&&s.default;if(o===void 0)return;const a=typeof o=="function"?o.call(t,e,r):o;a!==void 0&&i.set(e,a)}const O2e={origin:"service"};function P2e(t,e,i=O2e){if(!e||typeof e!="object")return;const r=Ql(t),n=r.metadatas,s={};for(const o of Object.getOwnPropertyNames(e))Hje(s,n,o,e,i);r.setDefaultOrigin(i.origin);for(const o of Object.getOwnPropertyNames(s)){const a=cY(n[o],i).read,l=a&&a.source;let c;c=l&&typeof l=="string"?hN(e,l):e[o],a&&a.reader&&(c=a.reader.call(t,c,e,i)),c!==void 0&&r.set(o,c)}if(!i||!i.ignoreDefaults){r.setDefaultOrigin("defaults");for(const o of Object.getOwnPropertyNames(n))s[o]||qje(t,o,r,i)}r.setDefaultOrigin("user")}function I2e(t,e,i,r=O2e){var s;const n={...r,messages:[]};i(n),(s=n.messages)==null||s.forEach(o=>{o.type!=="warning"||t.loaded?r&&r.messages&&r.messages.push(o):t.loadWarnings.push(o)})}function Wje(t,e,i,r,n){var o,a;const s={};return(a=(o=e.write)==null?void 0:o.writer)==null||a.call(t,r,s,i,n),s}function $2e(t,e,i,r,n,s){if(!r||!r.write)return!1;const o=t.get(i);if(!n&&r.write.overridePolicy){const a=r.write.overridePolicy.call(t,o,i,s);a!==void 0&&(n=a)}if(n||(n=r.write),!n||n.enabled===!1)return!1;if((o===null&&!n.allowNull&&!n.writerEnsuresNonNull||o===void 0)&&n.isRequired){const a=new H("web-document-write:property-required",`Missing value for required property '${i}' on '${t.declaredClass}'`,{propertyName:i,target:t});return a&&s&&s.messages?s.messages.push(a):a&&!s&&re.getLogger("esri.core.accessorSupport.write").error(a.name,a.message),!1}return!(o===void 0||o===null&&!n.allowNull&&!n.writerEnsuresNonNull||(!e.store.multipleOriginsSupported||e.store.originOf(i)===Qi.DEFAULTS)&&Xje(t,i,s,r,o)||!n.ignoreOrigin&&s&&s.origin&&e.store.multipleOriginsSupported&&e.store.originOf(i)<cb(s.origin))}function Xje(t,e,i,r,n){const s=r.default;if(s===void 0)return!1;if(r.defaultEquals!=null)return r.defaultEquals(n);if(typeof s=="function"){if(Array.isArray(n)){const o=s.call(t,e,i);return x_(o,n)}return!1}return s===n}function Yje(t,e,i,r){const n=Ql(t),s=n.metadatas,o=a2e(s[e],r);return!!o&&$2e(t,n,e,o,i,r)}function L2e(t,e,i){var s,o;if(t&&typeof t.toJSON=="function"&&(!t.toJSON.isDefaultToJSON||!t.write))return r6(e,t.toJSON(i));const r=Ql(t),n=r.metadatas;for(const a in n){const l=a2e(n[a],i);if(!$2e(t,r,a,l,void 0,i))continue;const c=t.get(a),h=Wje(t,l,l.write&&typeof l.write.target=="string"?l.write.target:a,c,i);Object.keys(h).length>0&&(e=r6(e,h),(o=(s=i==null?void 0:i.resources)==null?void 0:s.pendingOperations)!=null&&o.length&&i.resources.pendingOperations.push(Promise.all(i.resources.pendingOperations).then(()=>r6(e,h,()=>"replace-arrays"))),i&&i.writtenProperties&&i.writtenProperties.push({target:t,propName:a,oldOrigin:oje(r.store.originOf(a)),newOrigin:i.origin}))}return e}const Pw=t=>{let e=class extends t{constructor(...i){super(...i);const r=Ql(this),n=r.store,s=new zje;r.store=s,M2e(r,n,s)}read(i,r){P2e(this,i,r)}write(i={},r){return L2e(this,i,r)}toJSON(i){return this.write({},i)}static fromJSON(i,r){return Zje.call(this,i,r)}};return e=u([$("esri.core.JSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function Zje(t,e){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const i=new this;return i.read(t,e),i}let fe=class extends Pw(ve){};fe=u([$("esri.core.JSONSupport")],fe);function Oe(t,e,i){let r,n;return e===void 0||Array.isArray(e)?(n=t,i=e,r=[void 0]):(n=e,r=Array.isArray(t)?t:[t]),(s,o)=>{const a=s.constructor.prototype;r.forEach(l=>{const c=YSe(s,l,n);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=a[o],i&&(c.read.source=(c.read.source||[]).concat(i))})}}let mi=class{constructor(e,i={ignoreUnknown:!1,useNumericKeys:!1}){this._jsonToAPI=e,this._options=i,this.apiValues=[],this.jsonValues=[],this._apiToJSON=this._invertMap(e),this.apiValues=this._getKeysSorted(this._apiToJSON),this.jsonValues=this._getKeysSorted(this._jsonToAPI),this.read=r=>this.fromJSON(r),this.write=(r,n,s)=>{const o=this.toJSON(r);o!==void 0&&va(s,o,n)},this.write.isJSONMapWriter=!0}toJSON(e){if(e==null)return null;if(this._apiToJSON.hasOwnProperty(e)){const i=this._apiToJSON[e];return this._options.useNumericKeys?+i:i}return this._options.ignoreUnknown?void 0:e}fromJSON(e){return e!=null&&this._jsonToAPI.hasOwnProperty(e)?this._jsonToAPI[e]:this._options.ignoreUnknown?void 0:e}_invertMap(e){const i={};for(const r in e)i[e[r]]=r;return i}_getKeysSorted(e){const i=[];for(const r in e)i.push(r);return i.sort(),i}};function Wa(){return function(t,e){return new mi(t,{ignoreUnknown:!0,...e})}}let tne=class{constructor(e,i,r,n){this.semiMajorAxis=e,this.flattening=i,this.outerAtmosphereRimWidth=r;const s=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*s,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=n||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}};const Ci=new tne(6378137,1/298.257223563,3e5,.006694379990137799),Yg=new tne(3396190,1/169.8944472236118,23e4),C_=new tne(1737400,0,0);var hp;(function(t){t[t.CGCS2000=4490]="CGCS2000",t[t.GCSMARS2000=104971]="GCSMARS2000",t[t.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",t[t.GCSMOON2000=104903]="GCSMOON2000"})(hp||(hp={}));let y;const k={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5041:0,5042:0,5048:0,5167:0,5168:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,9793:0,9794:0,9869:0,9874:0,9875:0,9880:0,9943:0,9945:0,9947:0,9967:0,9972:0,9977:0,20042:0,20050:1,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22239:0,22240:0,22332:0,22337:0,22338:0,22391:0,22392:0,22639:0,22700:0,22739:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102731:0,102732:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2};for(y=2e3;y<=2045;y++)k[y]=0;for(y=2056;y<=2065;y++)k[y]=0;for(y=2067;y<=2135;y++)k[y]=0;for(y=2137;y<=2154;y++)k[y]=0;for(y=2161;y<=2170;y++)k[y]=0;for(y=2172;y<=2193;y++)k[y]=0;for(y=2195;y<=2198;y++)k[y]=0;for(y=2200;y<=2203;y++)k[y]=0;for(y=2205;y<=2217;y++)k[y]=0;for(y=2222;y<=2224;y++)k[y]=1;for(y=2225;y<=2250;y++)k[y]=2;for(y=2251;y<=2253;y++)k[y]=1;for(y=2257;y<=2264;y++)k[y]=2;for(y=2274;y<=2279;y++)k[y]=2;for(y=2280;y<=2282;y++)k[y]=1;for(y=2283;y<=2289;y++)k[y]=2;for(y=2290;y<=2292;y++)k[y]=0;for(y=2308;y<=2313;y++)k[y]=0;for(y=2315;y<=2491;y++)k[y]=0;for(y=2494;y<=2866;y++)k[y]=0;for(y=2867;y<=2869;y++)k[y]=1;for(y=2870;y<=2888;y++)k[y]=2;for(y=2891;y<=2895;y++)k[y]=2;for(y=2896;y<=2898;y++)k[y]=1;for(y=2902;y<=2908;y++)k[y]=2;for(y=2915;y<=2920;y++)k[y]=2;for(y=2921;y<=2923;y++)k[y]=1;for(y=2924;y<=2930;y++)k[y]=2;for(y=2931;y<=2962;y++)k[y]=0;for(y=2964;y<=2968;y++)k[y]=2;for(y=2969;y<=2973;y++)k[y]=0;for(y=2975;y<=2991;y++)k[y]=0;for(y=2995;y<=3051;y++)k[y]=0;for(y=3054;y<=3079;y++)k[y]=0;for(y=3081;y<=3088;y++)k[y]=0;for(y=3092;y<=3101;y++)k[y]=0;for(y=3106;y<=3138;y++)k[y]=0;for(y=3146;y<=3151;y++)k[y]=0;for(y=3153;y<=3166;y++)k[y]=0;for(y=3168;y<=3172;y++)k[y]=0;for(y=3174;y<=3203;y++)k[y]=0;for(y=3294;y<=3358;y++)k[y]=0;for(y=3367;y<=3403;y++)k[y]=0;for(y=3408;y<=3416;y++)k[y]=0;for(y=3417;y<=3438;y++)k[y]=2;for(y=3441;y<=3446;y++)k[y]=2;for(y=3447;y<=3450;y++)k[y]=0;for(y=3451;y<=3459;y++)k[y]=2;for(y=3460;y<=3478;y++)k[y]=0;for(y=3554;y<=3559;y++)k[y]=0;for(y=3560;y<=3570;y++)k[y]=2;for(y=3571;y<=3581;y++)k[y]=0;for(y=3594;y<=3597;y++)k[y]=0;for(y=3601;y<=3604;y++)k[y]=0;for(y=3637;y<=3639;y++)k[y]=0;for(y=3665;y<=3667;y++)k[y]=0;for(y=3693;y<=3695;y++)k[y]=0;for(y=3701;y<=3727;y++)k[y]=0;for(y=3728;y<=3739;y++)k[y]=2;for(y=3740;y<=3751;y++)k[y]=0;for(y=3753;y<=3760;y++)k[y]=2;for(y=3761;y<=3773;y++)k[y]=0;for(y=3775;y<=3777;y++)k[y]=0;for(y=3779;y<=3781;y++)k[y]=0;for(y=3783;y<=3785;y++)k[y]=0;for(y=3788;y<=3791;y++)k[y]=0;for(y=3797;y<=3802;y++)k[y]=0;for(y=3814;y<=3816;y++)k[y]=0;for(y=3825;y<=3829;y++)k[y]=0;for(y=3832;y<=3841;y++)k[y]=0;for(y=3844;y<=3852;y++)k[y]=0;for(y=3873;y<=3885;y++)k[y]=0;for(y=3890;y<=3893;y++)k[y]=0;for(y=3907;y<=3912;y++)k[y]=0;for(y=3942;y<=3950;y++)k[y]=0;for(y=3968;y<=3970;y++)k[y]=0;for(y=3973;y<=3976;y++)k[y]=0;for(y=3986;y<=3989;y++)k[y]=0;for(y=3994;y<=3997;y++)k[y]=0;for(y=4048;y<=4051;y++)k[y]=0;for(y=4056;y<=4063;y++)k[y]=0;for(y=4093;y<=4096;y++)k[y]=0;for(y=4390;y<=4398;y++)k[y]=0;for(y=4399;y<=4413;y++)k[y]=2;for(y=4418;y<=4433;y++)k[y]=2;for(y=4455;y<=4457;y++)k[y]=2;for(y=4484;y<=4489;y++)k[y]=0;for(y=4491;y<=4554;y++)k[y]=0;for(y=4568;y<=4589;y++)k[y]=0;for(y=4652;y<=4656;y++)k[y]=0;for(y=4766;y<=4800;y++)k[y]=0;for(y=5014;y<=5016;y++)k[y]=0;for(y=5069;y<=5072;y++)k[y]=0;for(y=5105;y<=5130;y++)k[y]=0;for(y=5173;y<=5188;y++)k[y]=0;for(y=5253;y<=5259;y++)k[y]=0;for(y=5269;y<=5275;y++)k[y]=0;for(y=5292;y<=5311;y++)k[y]=0;for(y=5329;y<=5331;y++)k[y]=0;for(y=5343;y<=5349;y++)k[y]=0;for(y=5355;y<=5357;y++)k[y]=0;for(y=5387;y<=5389;y++)k[y]=0;for(y=5459;y<=5463;y++)k[y]=0;for(y=5479;y<=5482;y++)k[y]=0;for(y=5518;y<=5520;y++)k[y]=0;for(y=5530;y<=5539;y++)k[y]=0;for(y=5550;y<=5552;y++)k[y]=0;for(y=5562;y<=5583;y++)k[y]=0;for(y=5623;y<=5625;y++)k[y]=2;for(y=5631;y<=5639;y++)k[y]=0;for(y=5649;y<=5653;y++)k[y]=0;for(y=5663;y<=5680;y++)k[y]=0;for(y=5682;y<=5685;y++)k[y]=0;for(y=5875;y<=5877;y++)k[y]=0;for(y=5896;y<=5899;y++)k[y]=0;for(y=5921;y<=5940;y++)k[y]=0;for(y=6050;y<=6125;y++)k[y]=0;for(y=6244;y<=6275;y++)k[y]=0;for(y=6328;y<=6348;y++)k[y]=0;for(y=6350;y<=6356;y++)k[y]=0;for(y=6366;y<=6372;y++)k[y]=0;for(y=6381;y<=6387;y++)k[y]=0;for(y=6393;y<=6404;y++)k[y]=0;for(y=6480;y<=6483;y++)k[y]=0;for(y=6511;y<=6514;y++)k[y]=0;for(y=6579;y<=6581;y++)k[y]=0;for(y=6619;y<=6624;y++)k[y]=0;for(y=6625;y<=6627;y++)k[y]=2;for(y=6628;y<=6632;y++)k[y]=0;for(y=6634;y<=6637;y++)k[y]=0;for(y=6669;y<=6692;y++)k[y]=0;for(y=6707;y<=6709;y++)k[y]=0;for(y=6720;y<=6723;y++)k[y]=0;for(y=6732;y<=6738;y++)k[y]=0;for(y=6931;y<=6933;y++)k[y]=0;for(y=6956;y<=6959;y++)k[y]=0;for(y=7005;y<=7007;y++)k[y]=0;for(y=7057;y<=7070;y++)k[y]=2;for(y=7074;y<=7082;y++)k[y]=0;for(y=7109;y<=7118;y++)k[y]=0;for(y=7119;y<=7127;y++)k[y]=1;for(y=7374;y<=7376;y++)k[y]=0;for(y=7528;y<=7586;y++)k[y]=0;for(y=7587;y<=7645;y++)k[y]=2;for(y=7692;y<=7696;y++)k[y]=0;for(y=7755;y<=7787;y++)k[y]=0;for(y=7791;y<=7795;y++)k[y]=0;for(y=7799;y<=7801;y++)k[y]=0;for(y=7803;y<=7805;y++)k[y]=0;for(y=7825;y<=7831;y++)k[y]=0;for(y=7845;y<=7859;y++)k[y]=0;for(y=8013;y<=8032;y++)k[y]=0;for(y=8065;y<=8068;y++)k[y]=1;for(y=8518;y<=8529;y++)k[y]=2;for(y=8533;y<=8536;y++)k[y]=2;for(y=8538;y<=8540;y++)k[y]=2;for(y=8677;y<=8679;y++)k[y]=0;for(y=8836;y<=8840;y++)k[y]=0;for(y=8857;y<=8859;y++)k[y]=0;for(y=8908;y<=8910;y++)k[y]=0;for(y=9154;y<=9159;y++)k[y]=0;for(y=9205;y<=9218;y++)k[y]=0;for(y=9271;y<=9273;y++)k[y]=0;for(y=9295;y<=9297;y++)k[y]=0;for(y=9356;y<=9360;y++)k[y]=0;for(y=9404;y<=9407;y++)k[y]=0;for(y=9476;y<=9482;y++)k[y]=0;for(y=9487;y<=9494;y++)k[y]=0;for(y=9697;y<=9699;y++)k[y]=0;for(y=9821;y<=9865;y++)k[y]=0;for(y=20002;y<=20032;y++)k[y]=0;for(y=20047;y<=20049;y++)k[y]=0;for(y=20062;y<=20092;y++)k[y]=0;for(y=20135;y<=20138;y++)k[y]=0;for(y=20248;y<=20258;y++)k[y]=0;for(y=20348;y<=20358;y++)k[y]=0;for(y=20436;y<=20440;y++)k[y]=0;for(y=20822;y<=20824;y++)k[y]=0;for(y=20904;y<=20932;y++)k[y]=0;for(y=20934;y<=20936;y++)k[y]=0;for(y=21004;y<=21032;y++)k[y]=0;for(y=21035;y<=21037;y++)k[y]=0;for(y=21095;y<=21097;y++)k[y]=0;for(y=21148;y<=21150;y++)k[y]=0;for(y=21207;y<=21264;y++)k[y]=0;for(y=21307;y<=21364;y++)k[y]=0;for(y=21413;y<=21423;y++)k[y]=0;for(y=21453;y<=21463;y++)k[y]=0;for(y=21473;y<=21483;y++)k[y]=0;for(y=21780;y<=21782;y++)k[y]=0;for(y=21891;y<=21894;y++)k[y]=0;for(y=21896;y<=21899;y++)k[y]=0;for(y=22171;y<=22177;y++)k[y]=0;for(y=22181;y<=22187;y++)k[y]=0;for(y=22191;y<=22197;y++)k[y]=0;for(y=22207;y<=22222;y++)k[y]=0;for(y=22234;y<=22236;y++)k[y]=0;for(y=22243;y<=22250;y++)k[y]=0;for(y=22262;y<=22265;y++)k[y]=0;for(y=22307;y<=22322;y++)k[y]=0;for(y=22348;y<=22357;y++)k[y]=0;for(y=22407;y<=22422;y++)k[y]=0;for(y=22462;y<=22465;y++)k[y]=0;for(y=22521;y<=22525;y++)k[y]=0;for(y=22607;y<=22622;y++)k[y]=0;for(y=22641;y<=22646;y++)k[y]=0;for(y=22648;y<=22657;y++)k[y]=0;for(y=22707;y<=22722;y++)k[y]=0;for(y=22762;y<=22765;y++)k[y]=0;for(y=22991;y<=22994;y++)k[y]=0;for(y=23028;y<=23038;y++)k[y]=0;for(y=23830;y<=23853;y++)k[y]=0;for(y=23866;y<=23872;y++)k[y]=0;for(y=23877;y<=23884;y++)k[y]=0;for(y=23886;y<=23894;y++)k[y]=0;for(y=23946;y<=23948;y++)k[y]=0;for(y=24311;y<=24313;y++)k[y]=0;for(y=24342;y<=24347;y++)k[y]=0;for(y=24370;y<=24374;y++)k[y]=10;for(y=24375;y<=24381;y++)k[y]=0;for(y=24718;y<=24721;y++)k[y]=0;for(y=24817;y<=24821;y++)k[y]=0;for(y=24877;y<=24882;y++)k[y]=0;for(y=24891;y<=24893;y++)k[y]=0;for(y=25391;y<=25395;y++)k[y]=0;for(y=25828;y<=25838;y++)k[y]=0;for(y=26191;y<=26195;y++)k[y]=0;for(y=26391;y<=26393;y++)k[y]=0;for(y=26701;y<=26722;y++)k[y]=0;for(y=26729;y<=26799;y++)k[y]=2;for(y=26801;y<=26803;y++)k[y]=2;for(y=26811;y<=26813;y++)k[y]=2;for(y=26847;y<=26870;y++)k[y]=2;for(y=26891;y<=26899;y++)k[y]=0;for(y=26901;y<=26923;y++)k[y]=0;for(y=26929;y<=26946;y++)k[y]=0;for(y=26948;y<=26998;y++)k[y]=0;for(y=27037;y<=27040;y++)k[y]=0;for(y=27205;y<=27232;y++)k[y]=0;for(y=27258;y<=27260;y++)k[y]=0;for(y=27391;y<=27398;y++)k[y]=0;for(y=27561;y<=27564;y++)k[y]=0;for(y=27571;y<=27574;y++)k[y]=0;for(y=27581;y<=27584;y++)k[y]=0;for(y=27591;y<=27594;y++)k[y]=0;for(y=28191;y<=28193;y++)k[y]=0;for(y=28348;y<=28358;y++)k[y]=0;for(y=28402;y<=28432;y++)k[y]=0;for(y=28462;y<=28492;y++)k[y]=0;for(y=29118;y<=29122;y++)k[y]=0;for(y=29168;y<=29172;y++)k[y]=0;for(y=29177;y<=29185;y++)k[y]=0;for(y=29187;y<=29195;y++)k[y]=0;for(y=29900;y<=29903;y++)k[y]=0;for(y=30161;y<=30179;y++)k[y]=0;for(y=30491;y<=30494;y++)k[y]=0;for(y=30729;y<=30732;y++)k[y]=0;for(y=31251;y<=31259;y++)k[y]=0;for(y=31265;y<=31268;y++)k[y]=0;for(y=31275;y<=31279;y++)k[y]=0;for(y=31281;y<=31297;y++)k[y]=0;for(y=31461;y<=31469;y++)k[y]=0;for(y=31491;y<=31495;y++)k[y]=0;for(y=31917;y<=31922;y++)k[y]=0;for(y=31965;y<=32e3;y++)k[y]=0;for(y=32001;y<=32003;y++)k[y]=2;for(y=32005;y<=32031;y++)k[y]=2;for(y=32033;y<=32060;y++)k[y]=2;for(y=32064;y<=32067;y++)k[y]=2;for(y=32074;y<=32077;y++)k[y]=2;for(y=32081;y<=32086;y++)k[y]=0;for(y=32107;y<=32130;y++)k[y]=0;for(y=32133;y<=32159;y++)k[y]=0;for(y=32164;y<=32167;y++)k[y]=2;for(y=32180;y<=32199;y++)k[y]=0;for(y=32201;y<=32260;y++)k[y]=0;for(y=32301;y<=32360;y++)k[y]=0;for(y=32601;y<=32662;y++)k[y]=0;for(y=32664;y<=32667;y++)k[y]=2;for(y=32701;y<=32761;y++)k[y]=0;for(y=53001;y<=53004;y++)k[y]=0;for(y=53008;y<=53019;y++)k[y]=0;for(y=53021;y<=53032;y++)k[y]=0;for(y=53034;y<=53037;y++)k[y]=0;for(y=53042;y<=53046;y++)k[y]=0;for(y=53074;y<=53080;y++)k[y]=0;for(y=54001;y<=54004;y++)k[y]=0;for(y=54008;y<=54019;y++)k[y]=0;for(y=54021;y<=54032;y++)k[y]=0;for(y=54034;y<=54037;y++)k[y]=0;for(y=54042;y<=54046;y++)k[y]=0;for(y=54048;y<=54053;y++)k[y]=0;for(y=54074;y<=54080;y++)k[y]=0;for(y=54098;y<=54101;y++)k[y]=0;for(y=102001;y<=102040;y++)k[y]=0;for(y=102042;y<=102063;y++)k[y]=0;for(y=102065;y<=102067;y++)k[y]=0;for(y=102070;y<=102117;y++)k[y]=0;for(y=102122;y<=102216;y++)k[y]=0;for(y=102221;y<=102377;y++)k[y]=0;for(y=102382;y<=102388;y++)k[y]=0;for(y=102389;y<=102398;y++)k[y]=2;for(y=102399;y<=102444;y++)k[y]=0;for(y=102445;y<=102447;y++)k[y]=2;for(y=102448;y<=102458;y++)k[y]=0;for(y=102459;y<=102468;y++)k[y]=2;for(y=102469;y<=102499;y++)k[y]=0;for(y=102500;y<=102519;y++)k[y]=1;for(y=102520;y<=102524;y++)k[y]=0;for(y=102525;y<=102529;y++)k[y]=2;for(y=102530;y<=102588;y++)k[y]=0;for(y=102590;y<=102598;y++)k[y]=0;for(y=102601;y<=102603;y++)k[y]=0;for(y=102605;y<=102628;y++)k[y]=0;for(y=102629;y<=102646;y++)k[y]=2;for(y=102648;y<=102700;y++)k[y]=2;for(y=102701;y<=102703;y++)k[y]=0;for(y=102707;y<=102730;y++)k[y]=2;for(y=102733;y<=102758;y++)k[y]=2;for(y=102767;y<=102900;y++)k[y]=0;for(y=102901;y<=102933;y++)k[y]=2;for(y=102934;y<=102950;y++)k[y]=13;for(y=102951;y<=102955;y++)k[y]=0;for(y=102961;y<=102963;y++)k[y]=0;for(y=102965;y<=102969;y++)k[y]=0;for(y=102971;y<=102973;y++)k[y]=0;for(y=102975;y<=102989;y++)k[y]=0;for(y=102990;y<=102992;y++)k[y]=1;for(y=102997;y<=103002;y++)k[y]=0;for(y=103003;y<=103008;y++)k[y]=2;for(y=103009;y<=103011;y++)k[y]=0;for(y=103012;y<=103014;y++)k[y]=2;for(y=103019;y<=103021;y++)k[y]=0;for(y=103022;y<=103024;y++)k[y]=2;for(y=103029;y<=103031;y++)k[y]=0;for(y=103032;y<=103034;y++)k[y]=2;for(y=103065;y<=103068;y++)k[y]=0;for(y=103074;y<=103076;y++)k[y]=0;for(y=103077;y<=103079;y++)k[y]=1;for(y=103080;y<=103082;y++)k[y]=0;for(y=103083;y<=103085;y++)k[y]=2;for(y=103090;y<=103093;y++)k[y]=0;for(y=103097;y<=103099;y++)k[y]=0;for(y=103100;y<=103102;y++)k[y]=2;for(y=103107;y<=103109;y++)k[y]=0;for(y=103110;y<=103112;y++)k[y]=2;for(y=103113;y<=103116;y++)k[y]=0;for(y=103117;y<=103120;y++)k[y]=2;for(y=103153;y<=103157;y++)k[y]=0;for(y=103158;y<=103162;y++)k[y]=2;for(y=103163;y<=103165;y++)k[y]=0;for(y=103166;y<=103168;y++)k[y]=1;for(y=103169;y<=103171;y++)k[y]=2;for(y=103186;y<=103188;y++)k[y]=0;for(y=103189;y<=103191;y++)k[y]=2;for(y=103192;y<=103195;y++)k[y]=0;for(y=103196;y<=103199;y++)k[y]=2;for(y=103200;y<=103224;y++)k[y]=0;for(y=103225;y<=103227;y++)k[y]=1;for(y=103232;y<=103237;y++)k[y]=0;for(y=103238;y<=103243;y++)k[y]=2;for(y=103244;y<=103246;y++)k[y]=0;for(y=103247;y<=103249;y++)k[y]=2;for(y=103254;y<=103256;y++)k[y]=0;for(y=103257;y<=103259;y++)k[y]=2;for(y=103264;y<=103266;y++)k[y]=0;for(y=103267;y<=103269;y++)k[y]=2;for(y=103300;y<=103375;y++)k[y]=0;for(y=103381;y<=103383;y++)k[y]=0;for(y=103384;y<=103386;y++)k[y]=1;for(y=103387;y<=103389;y++)k[y]=0;for(y=103390;y<=103392;y++)k[y]=2;for(y=103397;y<=103399;y++)k[y]=0;for(y=103400;y<=103471;y++)k[y]=2;for(y=103476;y<=103478;y++)k[y]=0;for(y=103479;y<=103481;y++)k[y]=2;for(y=103486;y<=103488;y++)k[y]=0;for(y=103489;y<=103491;y++)k[y]=2;for(y=103492;y<=103495;y++)k[y]=0;for(y=103496;y<=103499;y++)k[y]=2;for(y=103528;y<=103543;y++)k[y]=0;for(y=103544;y<=103548;y++)k[y]=2;for(y=103549;y<=103551;y++)k[y]=0;for(y=103552;y<=103554;y++)k[y]=1;for(y=103555;y<=103557;y++)k[y]=2;for(y=103558;y<=103560;y++)k[y]=0;for(y=103571;y<=103573;y++)k[y]=0;for(y=103574;y<=103576;y++)k[y]=2;for(y=103577;y<=103580;y++)k[y]=0;for(y=103581;y<=103583;y++)k[y]=2;for(y=103595;y<=103694;y++)k[y]=0;for(y=103696;y<=103699;y++)k[y]=0;for(y=103700;y<=103793;y++)k[y]=2;for(y=103794;y<=103890;y++)k[y]=0;for(y=103891;y<=103896;y++)k[y]=2;for(y=103900;y<=103971;y++)k[y]=2;for(y=103972;y<=103977;y++)k[y]=0;for(y=112e3;y<=112101;y++)k[y]=0;const Jje={102113:!0,102100:!0,3857:!0,3785:!0},Kje={4326:!0,3785:!0,3857:!0,102113:!0,102100:!0,104905:!0,104971:!0},Uhe='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',LF=[-20037508342788905e-9,20037508342788905e-9],DF=[-20037508342787e-6,20037508342787e-6],D2e={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:LF,origin:DF,dx:1e-5},102100:{wkTemplate:Uhe,valid:LF,origin:DF,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:LF,origin:DF,dx:1e-5},3857:{wkTemplate:Uhe,valid:LF,origin:DF,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function Dn(t,e){return t===e||!R(t)&&!R(e)&&(t.wkid!=null||e.wkid!=null?t.wkid===e.wkid||Kb(t)&&Kb(e)||e.latestWkid!=null&&t.wkid===e.latestWkid||t.latestWkid!=null&&e.wkid===t.latestWkid:!(!t.wkt||!e.wkt)&&t.wkt.toUpperCase()===e.wkt.toUpperCase())}function bp(t){return Fa(t)&&t.wkid&&D2e[t.wkid]||null}function N2e(t){return!!Fa(t)&&(t.wkid?k[t.wkid]==null:!!t.wkt&&!!/^\s*GEOGCS/i.test(t.wkt))}function zL(t){return!(wy(t)||xy(t))}function BL(t){return Fa(t)&&t.wkid===4326}function F2e(t){return Fa(t)&&t.wkid===hp.CGCS2000}function Kb(t){return Fa(t)&&t.wkid!=null&&Jje[t.wkid]===!0}function ine(t){return Fa(t)&&t.wkid===32662}function rne(t){return t===hp.GCSMARS2000||t===hp.GCSMARS2000_SPHERE}function wy(t){return Fa(t)&&t.wkid!=null&&rne(t.wkid)}function nne(t){return t===hp.GCSMOON2000}function xy(t){return Fa(t)&&t.wkid!=null&&nne(t.wkid)}function Qje(t){return Fa(t)&&t.wkid!=null&&Kje[t.wkid]===!0}function Fa(t){return v(t)&&(t.wkid!=null&&t.wkid>=2e3||t.wkt!=null)}const eGe={wkid:4326,wkt:ay(D2e[4326].wkTemplate,{Central_Meridian:"0.0"})},tGe={wkid:102100,latestWkid:3857},iGe={wkid:32662};function sne(t){return{wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${t.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`}}const k2e=sne(Ci),one=sne(Yg),ane=sne(C_),U2e={wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${Ci.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`};function sr(t){return v(t)&&(wy(t)||Dn(t,one))?Yg:v(t)&&(xy(t)||Dn(t,ane))?C_:Ci}function W8t(t){return rne(t)?Yg:nne(t)?C_:Ci}const lne=39.37,rGe=Ci.radius*Math.PI/200,V2e=/UNIT\[([^\]]+)\]\]$/i,IS=k,z2e=/UNIT\[([^\]]+)\]/i,nGe=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),sGe=Wa()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),$m=t=>t*t,cv=t=>t*t*t,jL={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:$m(.001)},"square-centimeters":{inBaseUnits:$m(.01)},"square-decimeters":{inBaseUnits:$m(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:$m(1e3)},"square-inches":{inBaseUnits:$m(.0254)},"square-feet":{inBaseUnits:$m(.3048)},"square-yards":{inBaseUnits:$m(.9144)},"square-miles":{inBaseUnits:$m(1609.344)},"square-us-feet":{inBaseUnits:$m(1200/3937)},acres:{inBaseUnits:.0015625*$m(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*cv(.001)},"cubic-centimeters":{inBaseUnits:1e3*cv(.01)},"cubic-decimeters":{inBaseUnits:1e3*cv(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*cv(1e3)},"cubic-inches":{inBaseUnits:1e3*cv(.0254)},"cubic-feet":{inBaseUnits:1e3*cv(.3048)},"cubic-yards":{inBaseUnits:1e3*cv(.9144)},"cubic-miles":{inBaseUnits:1e3*cv(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},oGe=(()=>{const t={};for(const e in jL)for(const i in jL[e].units)t[i]=e;return t})();function aGe(t,e,i){return t*jL[i].units[e].inBaseUnits}function lGe(t,e,i){return t/jL[i].units[e].inBaseUnits}const cGe=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"];function TY(t){const e=oGe[t];if(!e)throw new Error("unknown type");return e}function Vhe(t,e=null){return e=e||TY(t),jL[e].baseUnit===t}function Gs(t,e,i){if(e===i)return t;const r=TY(e);if(r!==TY(i))throw new Error("incompatible units");const n=Vhe(e,r)?t:aGe(t,e,r);return Vhe(i,r)?n:lGe(n,i,r)}function X8t(t,e,i){switch(i){case"metric":return B2e(t,e);case"imperial":return G2e(t,e);default:return i}}function Y8t(t,e,i){switch(i){case"metric":return j2e(t,e);case"imperial":return H2e(t,e);default:return i}}function B2e(t,e){const i=Gs(t,e,"meters");return Math.abs(i)<3e3?"meters":"kilometers"}function j2e(t,e){const i=Gs(t,e,"meters");return Math.abs(i)<1e5?"meters":"kilometers"}function G2e(t,e){const i=Gs(t,e,"feet");return Math.abs(i)<1e3?"feet":"miles"}function H2e(t,e){const i=Gs(t,e,"feet");return Math.abs(i)<1e5?"feet":"miles"}function Z8t(t,e){const i=Gs(t,e,"square-meters");return Math.abs(i)<3e6?"square-meters":"square-kilometers"}function J8t(t,e){const i=Gs(t,e,"square-feet");return Math.abs(i)<1e6?"square-feet":"square-miles"}function uGe(t,e,i){return Gs(t,e,"meters")/(i*Math.PI/180)}function q2e(t){return sGe.fromJSON(t.toLowerCase())||null}function r2(t){if(v(t)&&!zL(t))return 1;const e=tc(t);return e>1e5?1:e}function hGe(t){return tc(t)>=sr(t).metersPerDegree?"meters":$9(t)}function tc(t,e=Ci.metersPerDegree){return Nt(dGe(t,!0),e)}function dGe(t,e=!1){const i=v(t)?t.wkid:null,r=v(t)?t.wkt:null;let n=null;if(i){if(rne(i))return Yg.metersPerDegree;if(nne(i))return C_.metersPerDegree;n=IS.values[IS[i]],!n&&e&&nGe.has(i)&&(n=rGe)}else r&&(Y2e(r)?n=zhe(V2e.exec(r),n):X2e(r)&&(n=zhe(z2e.exec(r),n)));return n}function zhe(t,e){return t&&t[1]?W2e(t[1]):e}function W2e(t){return parseFloat(t.split(",")[1])}function $9(t){const e=v(t)?t.wkid:null,i=v(t)?t.wkt:null;let r=null;if(e)r=IS.units[IS[e]];else if(i){const n=Y2e(i)?V2e:X2e(i)?z2e:null;if(n){const s=n.exec(i);s&&s[1]&&(r=fGe(s[1]))}}return v(r)?q2e(r):null}function K8t(t){const e=$9(t);return R(e)||!cGe.includes(e)?null:e}function X2e(t){return/^GEOCCS/i.test(t)}function Y2e(t){return/^PROJCS/i.test(t)}const pGe=1e-7;function fGe(t){const e=/[\\"\\']{1}([^\\"\\']+)/.exec(t);let i=e&&e[1];if(!i||!IS.units.includes(i)){const r=W2e(t);i=null;const n=IS.values;for(let s=0;s<n.length;++s)if(Math.abs(r-n[s])<pGe){i=IS.units[s];break}}return i}function Q8t(t){const e=$9(t);if(R(e))return null;switch(e){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}const mGe={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},gGe={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},yGe={esriDUDecimalDegrees:"degrees",esriDURadians:"radians"},_Ge=Wa()(mGe),vGe=Wa()(gGe),eVt=Wa()(yGe);function Ne(t,e,i){let r,n;return e===void 0?(n=t,r=[void 0]):typeof e!="string"?(n=t,r=[void 0],i=e):(n=e,r=Array.isArray(t)?t:[t]),(s,o)=>{const a=s.constructor.prototype;for(const l of r){const c=YSe(s,l,n);c.write&&typeof c.write=="object"||(c.write={}),i&&(c.write.target=i),c.write.writer=a[o]}}}var Km;let Vr=Km=class extends fe{static fromJSON(t){if(!t)return null;if(t.wkid){if(t.wkid===102100)return Km.WebMercator;if(t.wkid===4326)return Km.WGS84}const e=new Km;return e.read(t),e}constructor(t){super(t),this.latestWkid=null,this.wkid=null,this.wkt=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}normalizeCtorArgs(t){return t&&typeof t=="object"?t:{[typeof t=="string"?"wkt":"wkid"]:t}}get isWGS84(){return BL(this)}get isWebMercator(){return Kb(this)}get isGeographic(){return N2e(this)}get isWrappable(){return Qje(this)}get metersPerUnit(){return tc(this)}get unit(){return $9(this)||(this.isGeographic?"degrees":null)}writeWkt(t,e){this.wkid||(e.wkt=t)}clone(){if(this===Km.WGS84)return Km.WGS84;if(this===Km.WebMercator)return Km.WebMercator;const t=new Km;return this.wkid!=null?(t.wkid=this.wkid,this.latestWkid!=null&&(t.latestWkid=this.latestWkid),this.vcsWkid!=null&&(t.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(t.latestVcsWkid=this.latestVcsWkid)):this.wkt!=null&&(t.wkt=this.wkt),this.imageCoordinateSystem&&(t.imageCoordinateSystem=se(this.imageCoordinateSystem)),t}equals(t){if(t==null)return!1;if(this.imageCoordinateSystem||t.imageCoordinateSystem){if(this.imageCoordinateSystem==null||t.imageCoordinateSystem==null)return!1;const{id:e,referenceServiceName:i}=t.imageCoordinateSystem,{geodataXform:r}=t.imageCoordinateSystem,n=this.imageCoordinateSystem;return e==null||r?JSON.stringify(n)===JSON.stringify(t.imageCoordinateSystem):i?n.id===e&&n.referenceServiceName===i:n.id===e}return Dn(this,t)}toJSON(t){return this.write(void 0,t)}};Vr.GCS_NAD_1927=null,Vr.WGS84=null,Vr.WebMercator=null,Vr.PlateCarree=null,u([d({readOnly:!0})],Vr.prototype,"isWGS84",null),u([d({readOnly:!0})],Vr.prototype,"isWebMercator",null),u([d({readOnly:!0})],Vr.prototype,"isGeographic",null),u([d({readOnly:!0})],Vr.prototype,"isWrappable",null),u([d({type:Kr,json:{write:!0}})],Vr.prototype,"latestWkid",void 0),u([d({readOnly:!0})],Vr.prototype,"metersPerUnit",null),u([d({readOnly:!0})],Vr.prototype,"unit",null),u([d({type:Kr,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt===null}}}}}}})],Vr.prototype,"wkid",void 0),u([d({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid===null}}}}}}})],Vr.prototype,"wkt",void 0),u([Ne("wkt"),Ne("web-scene","wkt")],Vr.prototype,"writeWkt",null),u([d({type:Kr,json:{write:!0}})],Vr.prototype,"vcsWkid",void 0),u([d({type:Kr,json:{write:!0}})],Vr.prototype,"latestVcsWkid",void 0),u([d()],Vr.prototype,"imageCoordinateSystem",void 0),Vr=Km=u([$("esri.geometry.SpatialReference")],Vr),Vr.prototype.toJSON.isDefaultToJSON=!0,Vr.GCS_NAD_1927=new Vr({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),Vr.WGS84=new Vr(eGe),Vr.WebMercator=new Vr(tGe),Vr.PlateCarree=new Vr(iGe),Object.freeze&&(Object.freeze(Vr.GCS_NAD_1927),Object.freeze(Vr.WGS84),Object.freeze(Vr.WebMercator));const Je=Vr;let Qm=class extends fe{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=Je.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,i){if(e instanceof Je)return e;if(e!=null){const r=new Je;return r.read(e,i),r}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,i){this.cache[e]=i}};u([d()],Qm.prototype,"type",void 0),u([d({readOnly:!0})],Qm.prototype,"cache",null),u([d({readOnly:!0})],Qm.prototype,"extent",null),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Qm.prototype,"hasM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Qm.prototype,"hasZ",void 0),u([d({type:Je,json:{write:!0},value:Je.WGS84})],Qm.prototype,"spatialReference",void 0),u([Oe("spatialReference")],Qm.prototype,"readSpatialReference",null),Qm=u([$("esri.geometry.Geometry")],Qm);const U_=Qm,bGe=Object.prototype.toString;function wGe(t){const e="__accessorMetadata__"in t?Ts(t):t;return function(...i){if(i.push(e),typeof i[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return xGe.apply(this,i)}}function xGe(t,e,i,r){R9(t,e).cast=r}function TGe(t){return(e,i)=>{R9(e,t).cast=e[i]}}function ri(...t){if(t.length!==3||typeof t[1]!="string")return t.length===1&&bGe.call(t[0])==="[object Function]"?wGe(t[0]):t.length===1&&typeof t[0]=="string"?TGe(t[0]):void 0}function SGe(t,e){const i=t.x-e.x,r=t.y-e.y,n=t.hasZ&&e.hasZ?t.z-e.z:0;return Math.sqrt(i*i+r*r+n*n)}const EGe=57.29577951308232,CGe=.017453292519943;function Bhe(t){return t*EGe}function jhe(t){return t*CGe}function Ghe(t){return t/Ci.radius}function J8(t){return Math.PI/2-2*Math.atan(Math.exp(-t/Ci.radius))}function SY(t){return t.wkid!=null||t.wkt!=null}const $j=[0,0];function K8(t,e,i,r,n){const s=t,o=n;if(o.spatialReference=i,"x"in s&&"x"in o)[o.x,o.y]=e(s.x,s.y,$j,r);else if("xmin"in s&&"xmin"in o)[o.xmin,o.ymin]=e(s.xmin,s.ymin,$j,r),[o.xmax,o.ymax]=e(s.xmax,s.ymax,$j,r);else if("paths"in s&&"paths"in o||"rings"in s&&"rings"in o){const a="paths"in s?s.paths:s.rings,l=[];let c;for(let h=0;h<a.length;h++){const p=a[h];c=[],l.push(c);for(let f=0;f<p.length;f++)c.push(e(p[f][0],p[f][1],[0,0],r)),p[f].length>2&&c[f].push(p[f][2]),p[f].length>3&&c[f].push(p[f][3])}"paths"in o?o.paths=l:o.rings=l}else if("points"in s&&"points"in o){const a=s.points,l=[];for(let c=0;c<a.length;c++)l[c]=e(a[c][0],a[c][1],[0,0],r),a[c].length>2&&l[c].push(a[c][2]),a[c].length>3&&l[c].push(a[c][3]);o.points=l}return n}function Fb(t,e){const i=t&&(SY(t)?t:t.spatialReference),r=e&&(SY(e)?e:e.spatialReference);return!(t&&"type"in t&&t.type==="mesh"||e&&"type"in e&&e.type==="mesh"||!i||!r)&&(!!Dn(r,i)||Kb(r)&&BL(i)||Kb(i)&&BL(r))}function z2(t,e){if(R(t))return null;const i=t.spatialReference,r=e&&(SY(e)?e:e.spatialReference);return Fb(i,r)?Dn(i,r)?se(t):Kb(r)?K8(t,ZA,Je.WebMercator,!1,se(t)):BL(r)?K8(t,w$,Je.WGS84,!1,se(t)):null:null}function ZA(t,e,i=[0,0]){e>89.99999?e=89.99999:e<-89.99999&&(e=-89.99999);const r=jhe(e);return i[0]=jhe(t)*Ci.radius,i[1]=Ci.halfSemiMajorAxis*Math.log((1+Math.sin(r))/(1-Math.sin(r))),i}function w$(t,e,i=[0,0],r=!1){const n=Bhe(t/Ci.radius);return i[0]=r?n:n-360*Math.floor((n+180)/360),i[1]=Bhe(Math.PI/2-2*Math.atan(Math.exp(-e/Ci.radius))),i}function Zg(t,e=!1,i=se(t)){return K8(t,ZA,Je.WebMercator,e,i)}function mS(t,e=!1,i=se(t)){return K8(t,w$,Je.WGS84,e,i)}var c6;const l3=[0,0];function Hhe(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let _c=c6=class extends U_{static copy(t,e){e._set("x",t._get("x")),e._set("y",t._get("y")),e._set("z",t._get("z")),e._set("m",t._get("m"));const i=t._get("spatialReference");e._set("spatialReference",Object.isFrozen(i)?i:i.clone())}constructor(...t){super(...t),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}normalizeCtorArgs(t,e,i,r,n){let s;if(Array.isArray(t))s=t,n=e,t=s[0],e=s[1],i=s[2],r=s[3];else if(t&&typeof t=="object"){if(s=t,t=s.x!=null?s.x:s.longitude,e=s.y!=null?s.y:s.latitude,i=s.z,r=s.m,(n=s.spatialReference)&&n.declaredClass!=="esri.geometry.SpatialReference"&&(n=new Je(n)),s.longitude!=null||s.latitude!=null){if(s.longitude==null)re.getLogger(this.declaredClass).warn(".longitude=","Latitude was defined without longitude");else if(s.latitude==null)re.getLogger(this.declaredClass).warn(".latitude=","Longitude was defined without latitude");else if(!s.declaredClass&&n&&n.isWebMercator){const a=ZA(s.longitude,s.latitude,l3);t=a[0],e=a[1]}}}else Hhe(i)?(n=i,i=null):Hhe(r)&&(n=r,r=null);const o={x:t,y:e};return o.x==null&&o.y!=null?re.getLogger(this.declaredClass).warn(".y=","Y coordinate was defined without an X coordinate"):o.y==null&&o.x!=null&&re.getLogger(this.declaredClass).warn(".x=","X coordinate was defined without a Y coordinate"),n!=null&&(o.spatialReference=n),i!=null&&(o.z=i),r!=null&&(o.m=r),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(t){t!==(this._get("m")!==void 0)&&(this._set("m",t?0:void 0),this._set("hasM",t))}get hasZ(){return this.z!==void 0}set hasZ(t){t!==(this._get("z")!==void 0)&&(this._set("z",t?0:void 0),this._set("hasZ",t))}get latitude(){const{spatialReference:t,x:e,y:i}=this;if(t){if(t.isWebMercator)return w$(e,i,l3)[1];if(t.isGeographic)return i}return null}set latitude(t){const{spatialReference:e,x:i}=this;t!=null&&e&&(e.isWebMercator?this._set("y",ZA(i,t,l3)[1]):e.isGeographic&&this._set("y",t),this._set("latitude",t))}get longitude(){const{x:t,y:e,spatialReference:i}=this;if(i){if(i.isWebMercator)return w$(t,e,l3)[0];if(i.isGeographic)return t}return null}set longitude(t){const{y:e,spatialReference:i}=this;t!=null&&i&&(i.isWebMercator?this._set("x",ZA(t,e,l3)[0]):i.isGeographic&&this._set("x",t),this._set("longitude",t))}writeX(t,e,i){e[i]=isNaN(t)?"NaN":t}readX(t){return typeof t=="string"?NaN:t}clone(){const t=new c6;return t.x=this.x,t.y=this.y,t.z=this.z,t.m=this.m,t.spatialReference=this.spatialReference,t}copy(t){return c6.copy(t,this),this}equals(t){if(R(t))return!1;const{x:e,y:i,z:r,m:n,spatialReference:s}=this,{z:o,m:a}=t;let{x:l,y:c,spatialReference:h}=t;if(!s.equals(h))if(s.isWebMercator&&h.isWGS84)[l,c]=ZA(l,c),h=s;else{if(!s.isWGS84||!h.isWebMercator)return!1;[l,c]=w$(l,c),h=s}return e===l&&i===c&&r===o&&n===a&&s.wkid===h.wkid}offset(t,e,i){return this.x+=t,this.y+=e,i!=null&&(this.z=(this.z??0)+i),this}normalize(){if(!this.spatialReference)return this;const t=bp(this.spatialReference);if(!t)return this;let e=this.x;const[i,r]=t.valid,n=2*r;let s;return e>r?(s=Math.ceil(Math.abs(e-r)/n),e-=s*n):e<i&&(s=Math.ceil(Math.abs(e-i)/n),e+=s*n),this._set("x",e),this}distance(t){return SGe(this,t)}toArray(){const t=this.hasZ,e=this.hasM;return t&&e?[this.x,this.y,this.z,this.m]:t?[this.x,this.y,this.z]:e?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(t){return this.write({},t)}};u([d({readOnly:!0})],_c.prototype,"cache",null),u([d({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],_c.prototype,"hasM",null),u([d({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],_c.prototype,"hasZ",null),u([d({type:Number})],_c.prototype,"latitude",null),u([d({type:Number})],_c.prototype,"longitude",null),u([d({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),ri(t=>isNaN(t)?t:ip(t))],_c.prototype,"x",void 0),u([Ne("x")],_c.prototype,"writeX",null),u([Oe("x")],_c.prototype,"readX",null),u([d({type:Number,json:{write:!0}})],_c.prototype,"y",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],_c.prototype,"z",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],_c.prototype,"m",void 0),_c=c6=u([$("esri.geometry.Point")],_c),_c.prototype.toJSON.isDefaultToJSON=!0;const Le=_c,Lj=[0,0];function L9(t,e){return!!v(e)&&zl(t,e.x,e.y,e.z)}function iVt(t,e){if(!e.points||e.points.length)return!1;for(const i of e.points)if(!pM(t,i))return!1;return!0}function AGe(t,e){const{xmin:i,ymin:r,zmin:n,xmax:s,ymax:o,zmax:a}=e;return t.hasZ&&e.hasZ?zl(t,i,r,n)&&zl(t,i,o,n)&&zl(t,s,o,n)&&zl(t,s,r,n)&&zl(t,i,r,a)&&zl(t,i,o,a)&&zl(t,s,o,a)&&zl(t,s,r,a):zl(t,i,r)&&zl(t,i,o)&&zl(t,s,o)&&zl(t,s,r)}function pM(t,e){return zl(t,e[0],e[1])}function RGe(t,e){return zl(t,e[0],e[1],e[2])}function zl(t,e,i,r){return e>=t.xmin&&e<=t.xmax&&i>=t.ymin&&i<=t.ymax&&(r==null||!t.hasZ||r>=t.zmin&&r<=t.zmax)}function Z2e(t,e){return Lj[1]=e.y,Lj[0]=e.x,MGe(t,Lj)}function MGe(t,e){return J2e(t.rings,e)}function J2e(t,e){if(!t)return!1;if(OGe(t))return qhe(!1,t,e);let i=!1;for(let r=0,n=t.length;r<n;r++)i=qhe(i,t[r],e);return i}function OGe(t){return!Array.isArray(t[0][0])}function qhe(t,e,i){const[r,n]=i;let s=t,o=0;for(let a=0,l=e.length;a<l;a++){o++,o===l&&(o=0);const[c,h]=e[a],[p,f]=e[o];(h<n&&f>=n||f<n&&h>=n)&&c+(n-h)/(f-h)*(p-c)<r&&(s=!s)}return s}function PGe(t,e){return L9(t,e)}function IGe(t,e){const i=t.hasZ&&e.hasZ;let r,n,s;if(t.xmin<=e.xmin){if(r=e.xmin,t.xmax<r)return!1}else if(r=t.xmin,e.xmax<r)return!1;if(t.ymin<=e.ymin){if(n=e.ymin,t.ymax<n)return!1}else if(n=t.ymin,e.ymax<n)return!1;if(i&&e.hasZ){if(t.zmin<=e.zmin){if(s=e.zmin,t.zmax<s)return!1}else if(s=t.zmin,e.zmax<s)return!1}return!0}function $Ge(t,e){const{points:i,hasZ:r}=e,n=r?RGe:pM;for(const s of i)if(n(t,s))return!0;return!1}const n2=[0,0],s2=[0,0],o2=[0,0],a2=[0,0],LGe=[n2,s2,o2,a2],K2e=[[o2,n2],[n2,s2],[s2,a2],[a2,o2]];function Q2e(t,e){return DGe(t,e.rings)}function DGe(t,e){n2[0]=t.xmin,n2[1]=t.ymax,s2[0]=t.xmax,s2[1]=t.ymax,o2[0]=t.xmin,o2[1]=t.ymin,a2[0]=t.xmax,a2[1]=t.ymin;for(const i of LGe)if(J2e(e,i))return!0;for(const i of e){if(!i.length)continue;let r=i[0];if(pM(t,r))return!0;for(let n=1;n<i.length;n++){const s=i[n];if(pM(t,s)||eEe(r,s,K2e))return!0;r=s}}return!1}function NGe(t,e){n2[0]=t.xmin,n2[1]=t.ymax,s2[0]=t.xmax,s2[1]=t.ymax,o2[0]=t.xmin,o2[1]=t.ymin,a2[0]=t.xmax,a2[1]=t.ymin;const i=e.paths;for(const r of i){if(!i.length)continue;let n=r[0];if(pM(t,n))return!0;for(let s=1;s<r.length;s++){const o=r[s];if(pM(t,o)||eEe(n,o,K2e))return!0;n=o}}return!1}const Aa=[0,0];function FGe(t){for(let e=0;e<t.length;e++){const i=t[e];for(let n=0;n<i.length-1;n++){const s=i[n],o=i[n+1];for(let a=e+1;a<t.length;a++)for(let l=0;l<t[a].length-1;l++){const c=t[a][l],h=t[a][l+1];if(EY(s,o,c,h,Aa)&&!(Aa[0]===s[0]&&Aa[1]===s[1]||Aa[0]===c[0]&&Aa[1]===c[1]||Aa[0]===o[0]&&Aa[1]===o[1]||Aa[0]===h[0]&&Aa[1]===h[1]))return!0}}const r=i.length;if(!(r<=4))for(let n=0;n<r-3;n++){let s=r-1;n===0&&(s=r-2);const o=i[n],a=i[n+1];for(let l=n+2;l<s;l++){const c=i[l],h=i[l+1];if(EY(o,a,c,h,Aa)&&!(Aa[0]===o[0]&&Aa[1]===o[1]||Aa[0]===c[0]&&Aa[1]===c[1]||Aa[0]===a[0]&&Aa[1]===a[1]||Aa[0]===h[0]&&Aa[1]===h[1]))return!0}}}return!1}function eEe(t,e,i){for(let r=0;r<i.length;r++)if(EY(t,e,i[r][0],i[r][1]))return!0;return!1}function EY(t,e,i,r,n){const[s,o]=t,[a,l]=e,[c,h]=i,[p,f]=r,m=p-c,g=s-c,_=a-s,b=f-h,w=o-h,x=l-o,T=b*_-m*x;if(T===0)return!1;const E=(m*w-b*g)/T,C=(_*w-x*g)/T;return E>=0&&E<=1&&C>=0&&C<=1&&(n&&(n[0]=s+E*(a-s),n[1]=o+E*(l-o)),!0)}function kGe(t){switch(t){case"esriGeometryEnvelope":case"extent":return IGe;case"esriGeometryMultipoint":case"multipoint":return $Ge;case"esriGeometryPoint":case"point":return PGe;case"esriGeometryPolygon":case"polygon":return Q2e;case"esriGeometryPolyline":case"polyline":return NGe}}var Pd;function UGe(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}function uv(t,e,i){return e==null?i:i==null?e:t(e,i)}let Yo=Pd=class extends U_{constructor(...t){super(...t),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(t,e,i,r,n){return UGe(t)?{spatialReference:t,xmin:0,ymin:0,xmax:0,ymax:0}:typeof t=="object"?(t.spatialReference=t.spatialReference==null?Je.WGS84:t.spatialReference,t):{xmin:t,ymin:e,xmax:i,ymax:r,spatialReference:n??Je.WGS84}}static fromBounds(t,e){return new Pd({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}static fromPoint(t){return new Pd({xmin:t.x,ymin:t.y,zmin:t.z,xmax:t.x,ymax:t.y,zmax:t.z,spatialReference:t.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const t=new Le({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(t.z=.5*(this.zmin+this.zmax)),this.hasM&&(t.m=.5*(this.mmin+this.mmax)),t}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(t){const e=this.center;return t.z!=null&&this.hasZ?this.offset(t.x-e.x,t.y-e.y,t.z-e.z):this.offset(t.x-e.x,t.y-e.y)}clone(){const t=new Pd;return t.xmin=this.xmin,t.ymin=this.ymin,t.xmax=this.xmax,t.ymax=this.ymax,t.spatialReference=this.spatialReference,this.zmin!=null&&(t.zmin=this.zmin,t.zmax=this.zmax),this.mmin!=null&&(t.mmin=this.mmin,t.mmax=this.mmax),t}contains(t){if(!t)return!1;const e=this.spatialReference,i=t.spatialReference;return e&&i&&!e.equals(i)&&Fb(e,i)&&(t=e.isWebMercator?Zg(t):mS(t,!0)),t.type==="point"?L9(this,t):t.type==="extent"&&AGe(this,t)}equals(t){if(this===t)return!0;if(R(t))return!1;const e=this.spatialReference,i=t.spatialReference;return e&&i&&!e.equals(i)&&Fb(e,i)&&(t=e.isWebMercator?Zg(t):mS(t,!0)),this.xmin===t.xmin&&this.ymin===t.ymin&&this.zmin===t.zmin&&this.mmin===t.mmin&&this.xmax===t.xmax&&this.ymax===t.ymax&&this.zmax===t.zmax&&this.mmax===t.mmax}expand(t){const e=.5*(1-t),i=this.width*e,r=this.height*e;if(this.xmin+=i,this.ymin+=r,this.xmax-=i,this.ymax-=r,this.hasZ){const n=(this.zmax-this.zmin)*e;this.zmin+=n,this.zmax-=n}if(this.hasM){const n=(this.mmax-this.mmin)*e;this.mmin+=n,this.mmax-=n}return this}intersects(t){if(R(t))return!1;t.type==="mesh"&&(t=t.extent);const e=this.spatialReference,i=t.spatialReference;return e&&i&&!Dn(e,i)&&Fb(e,i)&&(t=e.isWebMercator?Zg(t):mS(t,!0)),kGe(t.type)(this,t)}normalize(){const t=this._normalize(!1,!0);return Array.isArray(t)?t:[t]}offset(t,e,i){return this.xmin+=t,this.ymin+=e,this.xmax+=t,this.ymax+=e,i!=null&&(this.zmin+=i,this.zmax+=i),this}shiftCentralMeridian(){return this._normalize(!0)}union(t){return this===t||(this.xmin=Math.min(this.xmin,t.xmin),this.ymin=Math.min(this.ymin,t.ymin),this.xmax=Math.max(this.xmax,t.xmax),this.ymax=Math.max(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=uv(Math.min,this.zmin,t.zmin),this.zmax=uv(Math.max,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=uv(Math.min,this.mmin,t.mmin),this.mmax=uv(Math.max,this.mmax,t.mmax))),this}intersection(t){return this===t?this:R(t)||!this.intersects(t)?null:(this.xmin=Math.max(this.xmin,t.xmin),this.ymin=Math.max(this.ymin,t.ymin),this.xmax=Math.min(this.xmax,t.xmax),this.ymax=Math.min(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=uv(Math.max,this.zmin,t.zmin),this.zmax=uv(Math.min,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=uv(Math.max,this.mmin,t.mmin),this.mmax=uv(Math.min,this.mmax,t.mmax)),this)}toJSON(t){return this.write({},t)}_shiftCM(t=bp(this.spatialReference)){if(!t||!this.spatialReference)return this;const e=this.spatialReference,i=this._getCM(t);if(i){const r=e.isWebMercator?mS(i):i;this.xmin-=i.x,this.xmax-=i.x,e.isWebMercator||(r.x=this._normalizeX(r.x,t).x),this.spatialReference=new Je(ay((e.isWGS84?t.altTemplate:null)??t.wkTemplate,{Central_Meridian:r.x}))}return this}_getCM(t){let e=null;const[i,r]=t.valid,n=this.xmin,s=this.xmax;return n>=i&&n<=r&&s>=i&&s<=r||(e=this.center),e}_normalize(t,e,i){const r=this.spatialReference;if(!r)return this;const n=i??bp(r);if(n==null)return this;const s=this._getParts(n).map(l=>l.extent);if(s.length<2)return s[0]||this;if(s.length>2)return t?this._shiftCM(n):this.set({xmin:n.valid[0],xmax:n.valid[1]});if(t)return this._shiftCM(n);if(e)return s;let o=!0,a=!0;return s.forEach(l=>{l.hasZ||(o=!1),l.hasM||(a=!1)}),{rings:s.map(l=>{const c=[[l.xmin,l.ymin],[l.xmin,l.ymax],[l.xmax,l.ymax],[l.xmax,l.ymin],[l.xmin,l.ymin]];if(o){const h=(l.zmax-l.zmin)/2;for(let p=0;p<c.length;p++)c[p].push(h)}if(a){const h=(l.mmax-l.mmin)/2;for(let p=0;p<c.length;p++)c[p].push(h)}return c}),hasZ:o,hasM:a,spatialReference:r}}_getParts(t){let e=this.cache._parts;if(!e){e=[];const{ymin:n,ymax:s,spatialReference:o}=this,a=this.width,l=this.xmin,c=this.xmax;let h;t=t||bp(o);const[p,f]=t.valid;h=this._normalizeX(this.xmin,t);const m=h.x,g=h.frameId;h=this._normalizeX(this.xmax,t);const _=h.x,b=h.frameId,w=m===_&&a>0;if(a>2*f){const x=new Pd(l<c?m:_,n,f,s,o),T=new Pd(p,n,l<c?_:m,s,o),E=new Pd(0,n,f,s,o),C=new Pd(p,n,0,s,o),A=[],I=[];x.contains(E)&&A.push(g),x.contains(C)&&I.push(g),T.contains(E)&&A.push(b),T.contains(C)&&I.push(b);for(let O=g+1;O<b;O++)A.push(O),I.push(O);e.push({extent:x,frameIds:[g]},{extent:T,frameIds:[b]},{extent:E,frameIds:A},{extent:C,frameIds:I})}else m>_||w?e.push({extent:new Pd(m,n,f,s,o),frameIds:[g]},{extent:new Pd(p,n,_,s,o),frameIds:[b]}):e.push({extent:new Pd(m,n,_,s,o),frameIds:[g]});this.cache._parts=e}const i=this.hasZ,r=this.hasM;if(i||r){const n={};i&&(n.zmin=this.zmin,n.zmax=this.zmax),r&&(n.mmin=this.mmin,n.mmax=this.mmax);for(let s=0;s<e.length;s++)e[s].extent.set(n)}return e}_normalizeX(t,e){const[i,r]=e.valid,n=2*r;let s,o=0;return t>r?(s=Math.ceil(Math.abs(t-r)/n),t-=s*n,o=s):t<i&&(s=Math.ceil(Math.abs(t-i)/n),t+=s*n,o=-s),{x:t,frameId:o}}};u([d({readOnly:!0})],Yo.prototype,"cache",null),u([d({readOnly:!0})],Yo.prototype,"center",null),u([d({readOnly:!0})],Yo.prototype,"extent",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Yo.prototype,"hasM",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Yo.prototype,"hasZ",null),u([d({readOnly:!0})],Yo.prototype,"height",null),u([d({readOnly:!0})],Yo.prototype,"width",null),u([d({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],Yo.prototype,"xmin",void 0),u([d({type:Number,json:{write:!0}})],Yo.prototype,"ymin",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Yo.prototype,"mmin",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Yo.prototype,"zmin",void 0),u([d({type:Number,json:{write:!0}})],Yo.prototype,"xmax",void 0),u([d({type:Number,json:{write:!0}})],Yo.prototype,"ymax",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Yo.prototype,"mmax",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Yo.prototype,"zmax",void 0),Yo=Pd=u([$("esri.geometry.Extent")],Yo),Yo.prototype.toJSON.isDefaultToJSON=!0;const ni=Yo;function fM(t,e,i=!1){let{hasM:r,hasZ:n}=t;Array.isArray(e)?e.length!==4||r||n?e.length===3&&i&&!r?(n=!0,r=!1):e.length===3&&r&&n&&(r=!1,n=!1):(r=!0,n=!0):(n=!n&&e.hasZ&&(!r||e.hasM),r=!r&&e.hasM&&(!n||e.hasZ)),t.hasZ=n,t.hasM=r}var CY;function Whe(t){return(e,i)=>e==null?i:i==null?e:t(e,i)}function VGe(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let Jv=CY=class extends U_{constructor(...t){super(...t),this.points=[],this.type="multipoint"}normalizeCtorArgs(t,e){if(!t&&!e)return{};const i={};Array.isArray(t)?(i.points=t,i.spatialReference=e):VGe(t)?i.spatialReference=t:(t.points&&(i.points=t.points),t.spatialReference&&(i.spatialReference=t.spatialReference),t.hasZ&&(i.hasZ=t.hasZ),t.hasM&&(i.hasM=t.hasM));const r=i.points&&i.points[0];return r&&(i.hasZ===void 0&&i.hasM===void 0?(i.hasZ=r.length>2,i.hasM=!1):i.hasZ===void 0?i.hasZ=r.length>3:i.hasM===void 0&&(i.hasM=r.length>3)),i}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const t=this.points;if(!t.length)return null;const e=new ni,i=this.hasZ,r=this.hasM,n=i?3:2,s=t[0],o=Whe(Math.min),a=Whe(Math.max);let l,c,h,p,[f,m]=s,[g,_]=s;for(let b=0,w=t.length;b<w;b++){const x=t[b],[T,E]=x;if(f=o(f,T),m=o(m,E),g=a(g,T),_=a(_,E),i&&x.length>2){const C=x[2];l=o(l,C),h=a(h,C)}if(r&&x.length>n){const C=x[n];c=o(c,C),p=a(p,C)}}return e.xmin=f,e.ymin=m,e.xmax=g,e.ymax=_,e.spatialReference=this.spatialReference,i?(e.zmin=l,e.zmax=h):(e.zmin=void 0,e.zmax=void 0),r?(e.mmin=c,e.mmax=p):(e.mmin=void 0,e.mmax=void 0),e}writePoints(t,e){e.points=se(this.points)}addPoint(t){return fM(this,t),Array.isArray(t)?this.points.push(t):this.points.push(t.toArray()),this.notifyChange("points"),this}clone(){const t={points:se(this.points),spatialReference:this.spatialReference};return this.hasZ&&(t.hasZ=!0),this.hasM&&(t.hasM=!0),new CY(t)}getPoint(t){if(!this._validateInputs(t))return null;const e=this.points[t],i={x:e[0],y:e[1],spatialReference:this.spatialReference};let r=2;return this.hasZ&&(i.z=e[2],r=3),this.hasM&&(i.m=e[r]),new Le(i)}removePoint(t){if(!this._validateInputs(t))return null;const e=new Le(this.points.splice(t,1)[0],this.spatialReference);return this.notifyChange("points"),e}setPoint(t,e){return this._validateInputs(t)?(fM(this,e),Array.isArray(e)||(e=e.toArray()),this.points[t]=e,this.notifyChange("points"),this):this}toJSON(t){return this.write({},t)}_validateInputs(t){return t!=null&&t>=0&&t<this.points.length}};u([d({readOnly:!0})],Jv.prototype,"cache",null),u([d()],Jv.prototype,"extent",null),u([d({type:[[Number]],json:{write:{isRequired:!0}}})],Jv.prototype,"points",void 0),u([Ne("points")],Jv.prototype,"writePoints",null),Jv=CY=u([$("esri.geometry.Multipoint")],Jv),Jv.prototype.toJSON.isDefaultToJSON=!0;const mN=Jv;function cne(t,e){const i=e[0]-t[0],r=e[1]-t[1];if(t.length>2&&e.length>2){const n=t[2]-e[2];return Math.sqrt(i*i+r*r+n*n)}return Math.sqrt(i*i+r*r)}function tEe(t,e,i){const r=t[0]+i*(e[0]-t[0]),n=t[1]+i*(e[1]-t[1]);return t.length>2&&e.length>2?[r,n,t[2]+i*(e[2]-t[2])]:[r,n]}function zGe(t,e,i,r){const[n,s]=e,[o,a]=i[r],[l,c]=i[r+1],h=l-o,p=c-a,f=h*h+p*p,m=(n-o)*h+(s-a)*p,g=Math.min(1,Math.max(0,m/f));return t[0]=o+h*g,t[1]=a+p*g,t}function rVt(t,e,i){const r=i.rings;let n,s,o=!1,a=1/0;for(let l=0;l<r.length;l++){const c=r[l];for(let h=0,p=c.length-1;h<c.length;p=h++)n=c[h],s=c[p],n[1]>e!=s[1]>e&&t<(s[0]-n[0])*(e-n[1])/(s[1]-n[1])+n[0]&&(o=!o),a=Math.min(a,BGe(t,e,n,s))}return a===0?0:(o?1:-1)*Math.sqrt(a)}function BGe(t,e,i,r){let n=i[0],s=i[1],o=r[0]-n,a=r[1]-s;if(o!==0||a!==0){const l=((t-n)*o+(e-s)*a)/(o*o+a*a);l>1?(n=r[0],s=r[1]):l>0&&(n+=o*l,s+=a*l)}return o=t-n,a=e-s,o*o+a*a}function jGe(t,e){return tEe(t,e,.5)}function iEe(t){const e=t.length;let i=0;for(let r=0;r<e-1;++r)i+=cne(t[r],t[r+1]);return i}function rEe(t,e){if(e<=0)return t[0];const i=t.length;let r=0;for(let n=0;n<i-1;++n){const s=cne(t[n],t[n+1]);if(e-r<s){const o=(e-r)/s;return tEe(t[n],t[n+1],o)}r+=s}return t[i-1]}function une(t,e,i){const r=t.length;let n=0,s=0,o=0;for(let a=0;a<r;a++){const l=t[a],c=t[(a+1)%r];let h=2;n+=l[0]*c[1]-c[0]*l[1],l.length>2&&c.length>2&&i&&(s+=l[0]*c[2]-c[0]*l[2],h=3),l.length>h&&c.length>h&&e&&(o+=l[0]*c[h]-c[0]*l[h])}return n<=0&&s<=0&&o<=0}function GGe(t){const e=t.length;return e>2&&x_(t[0],t[e-1])}function nVt(t){if("rings"in t&&(nEe(t),t.rings.length>0&&!une(t.rings[0],t.hasM??!1,t.hasZ??!1)))for(const e of t.rings)e.reverse()}function nEe(t){if("rings"in t)for(const e of t.rings)GGe(e)||e.push(e[0].slice())}function sEe(t){if(!t||t.length<3)return 0;let e=0;const i=t.length-1;for(let r=0;r<i;r++)e+=(t[r][0]-t[r+1][0])*(t[r][1]+t[r+1][1]);return e+=(t[i][0]-t[0][0])*(t[i][1]+t[0][1]),-.5*e}function sVt(t){return t?t.hasZ?[t.xmax-t.xmin/2,t.ymax-t.ymin/2,t.zmax-t.zmin/2]:[t.xmax-t.xmin/2,t.ymax-t.ymin/2]:null}function HGe(t){return t?hne(t.rings,t.hasZ??!1):null}function hne(t,e){if(!t||!t.length)return null;const i=[],r=[],n=e?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let s=0,o=t.length;s<o;s++){const a=qGe(t[s],e,n);a&&r.push(a)}if(r.sort((s,o)=>{let a=s[2]-o[2];return a===0&&e&&(a=s[4]-o[4]),a}),r.length&&(i[0]=r[0][0],i[1]=r[0][1],e&&(i[2]=r[0][3]),(i[0]<n[0]||i[0]>n[1]||i[1]<n[2]||i[1]>n[3]||e&&(i[2]<n[4]||i[2]>n[5]))&&(i.length=0)),!i.length){const s=t[0]&&t[0].length?WGe(t[0],e):null;if(!s)return null;i[0]=s[0],i[1]=s[1],e&&s.length>2&&(i[2]=s[2])}return i}function qGe(t,e,i){let r=0,n=0,s=0,o=0,a=0;const l=t.length?t[0][0]:0,c=t.length?t[0][1]:0,h=t.length&&e?t[0][2]:0;for(let f=0;f<t.length;f++){const m=t[f],g=t[(f+1)%t.length],[_,b,w]=m,x=_-l,T=b-c,[E,C,A]=g,I=E-l,O=C-c,D=x*O-I*T;if(o+=D,r+=(x+I)*D,n+=(T+O)*D,e&&m.length>2&&g.length>2){const U=w-h,V=A-h,B=x*V-I*U;s+=(U+V)*B,a+=B}_<i[0]&&(i[0]=_),_>i[1]&&(i[1]=_),b<i[2]&&(i[2]=b),b>i[3]&&(i[3]=b),e&&(w<i[4]&&(i[4]=w),w>i[5]&&(i[5]=w))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const p=[r/(6*o)+l,n/(6*o)+c,o];return e&&(i[4]===i[5]||a===0?(p[3]=(i[4]+i[5])/2,p[4]=0):(p[3]=s/(6*a)+h,p[4]=a)),p}function WGe(t,e){const i=e?[0,0,0]:[0,0],r=e?[0,0,0]:[0,0];let n=0,s=0,o=0,a=0;for(let l=0,c=t.length;l<c-1;l++){const h=t[l],p=t[l+1];if(h&&p){i[0]=h[0],i[1]=h[1],r[0]=p[0],r[1]=p[1],e&&h.length>2&&p.length>2&&(i[2]=h[2],r[2]=p[2]);const f=cne(i,r);if(f){n+=f;const m=jGe(h,p);s+=f*m[0],o+=f*m[1],e&&m.length>2&&(a+=f*m[2])}}}return n>0?e?[s/n,o/n,a/n]:[s/n,o/n]:t.length?t[0]:null}const XGe=1e-6;function oVt(t){if(!t||!t.rings)return null;const{rings:e}=t;let i=0;for(let s=0;s<e.length;s++)i+=sEe(e[s]);if(i<XGe)return hne(e,!1);const r=[0,0],n=e[0][0];for(let s=0;s<e.length;s++)ZGe(r,n,e[s]);return r[0]*=1/i,r[1]*=1/i,r[0]+=n[0],r[1]+=n[1],r}const YGe=1/3;function ZGe(t,e,i){if(!t||!i||i.length<3)return null;const r=i[0],n=[0,0],s=[i[1][0]-r[0],i[1][1]-r[1]];let o;for(let c=2;c<i.length;c++)n[0]=i[c][0]-r[0],n[1]=i[c][1]-r[1],o=.5*YGe*(n[0]*s[1]-n[1]*s[0]),t[0]+=o*(s[0]+n[0]),t[1]+=o*(s[1]+n[1]),s[0]=n[0],s[1]=n[1];const a=sEe(i),l=[r[0],r[1]];return l[0]-=e[0],l[1]-=e[1],l[0]*=a,l[1]*=a,t[0]+=l[0],t[1]+=l[1],t}function oEe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function aEe(t){return t.points!==void 0}function lEe(t){return t.x!==void 0&&t.y!==void 0}function cEe(t){return t.paths!==void 0}function uEe(t){return t.rings!==void 0}function hEe(t){function e(i,r){return i==null?r:r==null?i:t(i,r)}return e}const ub=hEe(Math.min),hb=hEe(Math.max);function JGe(t,e){return cEe(e)?mM(t,e.paths,!1,!1):uEe(e)?mM(t,e.rings,!1,!1):aEe(e)?dne(t,e.points,!1,!1,!1,!1):oEe(e)?dEe(t,e):(lEe(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.x,t[3]=e.y),t)}function aVt(t,e){return cEe(e)?mM(t,e.paths,!0,!1):uEe(e)?mM(t,e.rings,!0,!1):aEe(e)?dne(t,e.points,!0,!1,!0,!1):oEe(e)?dEe(t,e,!0,!1,!0,!1):(lEe(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.x,t[4]=e.y,t[5]=e.z),t)}function mM(t,e,i,r){const n=i?3:2;if(!e.length||!e[0].length)return null;let s,o,a,l,[c,h]=e[0][0],[p,f]=e[0][0];for(let m=0;m<e.length;m++){const g=e[m];for(let _=0;_<g.length;_++){const b=g[_],[w,x]=b;if(c=ub(c,w),h=ub(h,x),p=hb(p,w),f=hb(f,x),i&&b.length>2){const T=b[2];s=ub(s,T),o=hb(o,T)}if(r&&b.length>n){const T=b[n];a=ub(s,T),l=hb(o,T)}}}return i?r?(t[0]=c,t[1]=h,t[2]=s,t[3]=a,t[4]=p,t[5]=f,t[6]=o,t[7]=l,t.length=8,t):(t[0]=c,t[1]=h,t[2]=s,t[3]=p,t[4]=f,t[5]=o,t.length=6,t):r?(t[0]=c,t[1]=h,t[2]=a,t[3]=p,t[4]=f,t[5]=l,t.length=6,t):(t[0]=c,t[1]=h,t[2]=p,t[3]=f,t.length=4,t)}function dEe(t,e,i,r,n,s){const o=e.xmin,a=e.xmax,l=e.ymin,c=e.ymax;let h=e.zmin,p=e.zmax,f=e.mmin,m=e.mmax;return n?(h=h||0,p=p||0,s?(f=f||0,m=m||0,t[0]=o,t[1]=l,t[2]=h,t[3]=f,t[4]=a,t[5]=c,t[6]=p,t[7]=m,t):(t[0]=o,t[1]=l,t[2]=h,t[3]=a,t[4]=c,t[5]=p,t)):s?(f=f||0,m=m||0,t[0]=o,t[1]=l,t[2]=f,t[3]=a,t[4]=c,t[5]=m,t):(t[0]=o,t[1]=l,t[2]=a,t[3]=c,t)}function dne(t,e,i,r,n,s){const o=i?3:2,a=r&&s,l=i&&n;if(!e.length||!e[0].length)return null;let c,h,p,f,[m,g]=e[0],[_,b]=e[0];for(let w=0;w<e.length;w++){const x=e[w],[T,E]=x;if(m=ub(m,T),g=ub(g,E),_=hb(_,T),b=hb(b,E),l&&x.length>2){const C=x[2];c=ub(c,C),h=hb(h,C)}if(a&&x.length>o){const C=x[o];p=ub(c,C),f=hb(h,C)}}return n?(c=c||0,h=h||0,s?(p=p||0,f=f||0,t[0]=m,t[1]=g,t[2]=c,t[3]=p,t[4]=_,t[5]=b,t[6]=h,t[7]=f,t):(t[0]=m,t[1]=g,t[2]=c,t[3]=_,t[4]=b,t[5]=h,t)):s?(p=p||0,f=f||0,t[0]=m,t[1]=g,t[2]=p,t[3]=_,t[4]=b,t[5]=f,t):(t[0]=m,t[1]=g,t[2]=_,t[3]=b,t)}function KGe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function QGe(t){return t.points!==void 0}function eHe(t){return t.x!==void 0&&t.y!==void 0}function tHe(t){return t.paths!==void 0}function iHe(t){return t.rings!==void 0}const pne=[];function pEe(t,e,i,r){return{xmin:t,ymin:e,xmax:i,ymax:r}}function fEe(t,e,i,r,n,s){return{xmin:t,ymin:e,zmin:i,xmax:r,ymax:n,zmax:s}}function mEe(t,e,i,r,n,s){return{xmin:t,ymin:e,mmin:i,xmax:r,ymax:n,mmax:s}}function gEe(t,e,i,r,n,s,o,a){return{xmin:t,ymin:e,zmin:i,mmin:r,xmax:n,ymax:s,zmax:o,mmax:a}}function fne(t,e=!1,i=!1){return e?i?gEe(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]):fEe(t[0],t[1],t[2],t[3],t[4],t[5]):i?mEe(t[0],t[1],t[2],t[3],t[4],t[5]):pEe(t[0],t[1],t[2],t[3])}function lVt(t){return t?KGe(t)?t:eHe(t)?nHe(t):iHe(t)?yEe(t):tHe(t)?_Ee(t):QGe(t)?rHe(t):null:null}function rHe(t){const{hasZ:e,hasM:i,points:r}=t;return fne(dne(pne,r,e??!1,i??!1),e,i)}function nHe(t){const{x:e,y:i,z:r,m:n}=t,s=n!=null;return r!=null?s?gEe(e,i,r,n,e,i,r,n):fEe(e,i,r,e,i,r):s?mEe(e,i,n,e,i,n):pEe(e,i,e,i)}function yEe(t){const{hasZ:e,hasM:i,rings:r}=t,n=mM(pne,r,e??!1,i??!1);return n?fne(n,e,i):null}function _Ee(t){const{hasZ:e,hasM:i,paths:r}=t,n=mM(pne,r,e??!1,i??!1);return n?fne(n,e,i):null}var u6;function Xhe(t){return!Array.isArray(t[0])}let eg=u6=class extends U_{static fromExtent(t){const e=t.clone().normalize(),i=t.spatialReference;let r=!1,n=!1;for(const o of e)o.hasZ&&(r=!0),o.hasM&&(n=!0);const s={rings:e.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(r&&o.hasZ){const l=o.zmin+.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(n&&o.hasM){const l=o.mmin+.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a}),spatialReference:i};return r&&(s.hasZ=!0),n&&(s.hasM=!0),new u6(s)}constructor(...t){super(...t),this.rings=[],this.type="polygon"}normalizeCtorArgs(t,e){let i,r,n=null,s=null;return t&&!Array.isArray(t)?(n=t.rings?t.rings:null,e||(t.spatialReference?e=t.spatialReference:t.rings||(e=t)),i=t.hasZ,r=t.hasM):n=t,n=n||[],e=e||Je.WGS84,n.length&&n[0]&&n[0][0]!=null&&typeof n[0][0]=="number"&&(n=[n]),s=n[0]&&n[0][0],s&&(i===void 0&&r===void 0?(i=s.length>2,r=s.length>3):i===void 0?i=r?s.length>3:s.length>2:r===void 0&&(r=i?s.length>3:s.length>2)),{rings:n,spatialReference:e,hasZ:i,hasM:r}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const t=HGe(this);if(!t||isNaN(t[0])||isNaN(t[1])||this.hasZ&&isNaN(t[2]))return null;const e=new Le;return e.x=t[0],e.y=t[1],e.spatialReference=this.spatialReference,this.hasZ&&(e.z=t[2]),e}get extent(){const{spatialReference:t}=this,e=yEe(this);if(!e)return null;const i=new ni(e);return i.spatialReference=t,i}get isSelfIntersecting(){return FGe(this.rings)}writeRings(t,e){e.rings=se(this.rings)}addRing(t){if(!t)return;const e=this.rings,i=e.length;if(Xhe(t)){const r=[];for(let n=0,s=t.length;n<s;n++)r[n]=t[n].toArray();e[i]=r}else e[i]=t.concat();return this.notifyChange("rings"),this}clone(){const t=new u6;return t.spatialReference=this.spatialReference,t.rings=se(this.rings),t.hasZ=this.hasZ,t.hasM=this.hasM,t}equals(t){if(this===t)return!0;if(R(t))return!1;const e=this.spatialReference,i=t.spatialReference;if(v(e)!==v(i)||v(e)&&v(i)&&!e.equals(i)||this.rings.length!==t.rings.length)return!1;const r=([n,s,o,a],[l,c,h,p])=>n===l&&s===c&&(o==null&&h==null||o===h)&&(a==null&&p==null||a===p);for(let n=0;n<this.rings.length;n++){const s=this.rings[n],o=t.rings[n];if(!x_(s,o,r))return!1}return!0}contains(t){if(!t)return!1;const e=z2(t,this.spatialReference);return Z2e(this,v(e)?e:t)}isClockwise(t){let e;return e=Xhe(t)?t.map(i=>this.hasZ?this.hasM?[i.x,i.y,i.z,i.m]:[i.x,i.y,i.z]:[i.x,i.y]):t,une(e,this.hasM,this.hasZ)}getPoint(t,e){if(!this._validateInputs(t,e))return null;const i=this.rings[t][e],r=this.hasZ,n=this.hasM;return r&&!n?new Le(i[0],i[1],i[2],void 0,this.spatialReference):n&&!r?new Le(i[0],i[1],void 0,i[2],this.spatialReference):r&&n?new Le(i[0],i[1],i[2],i[3],this.spatialReference):new Le(i[0],i[1],this.spatialReference)}insertPoint(t,e,i){return this._validateInputs(t,e,!0)?(fM(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[t].splice(e,0,i),this.notifyChange("rings"),this):this}removePoint(t,e){if(!this._validateInputs(t,e))return null;const i=new Le(this.rings[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("rings"),i}removeRing(t){if(!this._validateInputs(t,null))return null;const e=this.rings.splice(t,1)[0],i=this.spatialReference,r=e.map(n=>new Le(n,i));return this.notifyChange("rings"),r}setPoint(t,e,i){return this._validateInputs(t,e)?(fM(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[t][e]=i,this.notifyChange("rings"),this):this}_validateInputs(t,e,i=!1){if(t==null||t<0||t>=this.rings.length)return!1;if(e!=null){const r=this.rings[t];if(i&&(e<0||e>r.length)||!i&&(e<0||e>=r.length))return!1}return!0}toJSON(t){return this.write({},t)}};u([d({readOnly:!0})],eg.prototype,"cache",null),u([d({readOnly:!0})],eg.prototype,"centroid",null),u([d({readOnly:!0})],eg.prototype,"extent",null),u([d({readOnly:!0})],eg.prototype,"isSelfIntersecting",null),u([d({type:[[[Number]]],json:{write:{isRequired:!0}}})],eg.prototype,"rings",void 0),u([Ne("rings")],eg.prototype,"writeRings",null),eg=u6=u([$("esri.geometry.Polygon")],eg),eg.prototype.toJSON.isDefaultToJSON=!0;const ec=eg;var AY;function sHe(t){return!Array.isArray(t[0])}let Kv=AY=class extends U_{constructor(...t){super(...t),this.paths=[],this.type="polyline"}normalizeCtorArgs(t,e){let i,r,n=null,s=null;return t&&!Array.isArray(t)?(n=t.paths?t.paths:null,e||(t.spatialReference?e=t.spatialReference:t.paths||(e=t)),i=t.hasZ,r=t.hasM):n=t,n=n||[],e=e||Je.WGS84,n.length&&n[0]&&n[0][0]!=null&&typeof n[0][0]=="number"&&(n=[n]),s=n[0]&&n[0][0],s&&(i===void 0&&r===void 0?(i=s.length>2,r=!1):i===void 0?i=!r&&s.length>3:r===void 0&&(r=!i&&s.length>3)),{paths:n,spatialReference:e,hasZ:i,hasM:r}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:t}=this,e=_Ee(this);if(!e)return null;const i=new ni(e);return i.spatialReference=t,i}writePaths(t,e){e.paths=se(this.paths)}addPath(t){if(!t)return;const e=this.paths,i=e.length;if(sHe(t)){const r=[];for(let n=0,s=t.length;n<s;n++)r[n]=t[n].toArray();e[i]=r}else e[i]=t.concat();return this.notifyChange("paths"),this}clone(){const t=new AY;return t.spatialReference=this.spatialReference,t.paths=se(this.paths),t.hasZ=this.hasZ,t.hasM=this.hasM,t}getPoint(t,e){if(!this._validateInputs(t,e))return null;const i=this.paths[t][e],r=this.hasZ,n=this.hasM;return r&&!n?new Le(i[0],i[1],i[2],void 0,this.spatialReference):n&&!r?new Le(i[0],i[1],void 0,i[2],this.spatialReference):r&&n?new Le(i[0],i[1],i[2],i[3],this.spatialReference):new Le(i[0],i[1],this.spatialReference)}insertPoint(t,e,i){return this._validateInputs(t,e,!0)?(fM(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[t].splice(e,0,i),this.notifyChange("paths"),this):this}removePath(t){if(!this._validateInputs(t,null))return null;const e=this.paths.splice(t,1)[0],i=this.spatialReference,r=e.map(n=>new Le(n,i));return this.notifyChange("paths"),r}removePoint(t,e){if(!this._validateInputs(t,e))return null;const i=new Le(this.paths[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("paths"),i}setPoint(t,e,i){return this._validateInputs(t,e)?(fM(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[t][e]=i,this.notifyChange("paths"),this):this}_validateInputs(t,e,i=!1){if(t==null||t<0||t>=this.paths.length)return!1;if(e!=null){const r=this.paths[t];if(i&&(e<0||e>r.length)||!i&&(e<0||e>=r.length))return!1}return!0}toJSON(t){return this.write({},t)}};u([d({readOnly:!0})],Kv.prototype,"cache",null),u([d({readOnly:!0})],Kv.prototype,"extent",null),u([d({type:[[[Number]]],json:{write:{isRequired:!0}}})],Kv.prototype,"paths",void 0),u([Ne("paths")],Kv.prototype,"writePaths",null),Kv=AY=u([$("esri.geometry.Polyline")],Kv),Kv.prototype.toJSON.isDefaultToJSON=!0;const Wf=Kv,vEe=Wa()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),Yhe=Wa()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function D9(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function gN(t){return t.points!==void 0}function yN(t){return t.x!==void 0&&t.y!==void 0}function dO(t){return t.paths!==void 0}function s_(t){return t.rings!==void 0}function ly(t){return R(t)?null:t instanceof U_?t:yN(t)?Le.fromJSON(t):dO(t)?Wf.fromJSON(t):s_(t)?ec.fromJSON(t):gN(t)?mN.fromJSON(t):D9(t)?ni.fromJSON(t):null}function pO(t){return t?yN(t)?"esriGeometryPoint":dO(t)?"esriGeometryPolyline":s_(t)?"esriGeometryPolygon":D9(t)?"esriGeometryEnvelope":gN(t)?"esriGeometryMultipoint":null:null}const oHe={esriGeometryPoint:Le,esriGeometryPolyline:Wf,esriGeometryPolygon:ec,esriGeometryEnvelope:ni,esriGeometryMultipoint:mN};function aHe(t){return t&&oHe[t]||null}const Iw={base:U_,key:"type",typeMap:{extent:ni,multipoint:mN,point:Le,polyline:Wf,polygon:ec}};pm(Iw);const xr=t=>{let e=class extends t{clone(){var l;const i=Nc(Ql(this),"unable to clone instance of non-accessor class"),r=i.metadatas,n=i.store,s={},o=new Map;for(const c in r){const h=r[c],p=n==null?void 0:n.originOf(c),f=h.clonable;if(h.readOnly||f===!1||p!==Qi.USER&&p!==Qi.DEFAULTS&&p!==Qi.WEB_MAP&&p!==Qi.WEB_SCENE)continue;const m=this[c];let g=null;g=typeof f=="function"?f(m):f==="reference"?m:iY(m),m!=null&&g==null||(p===Qi.DEFAULTS?o.set(c,g):s[c]=g)}const a=new(Object.getPrototypeOf(this)).constructor(s);if(o.size){const c=(l=Ql(a))==null?void 0:l.store;if(c)for(const[h,p]of o)c.set(h,p,Qi.DEFAULTS)}return a}};return e=u([$("esri.core.Clonable")],e),e};let RY=class extends xr(ve){};RY=u([$("esri.core.Clonable")],RY);let h6=class bEe{constructor(){this._emitter=new bEe.EventEmitter(this)}emit(e,i){return this._emitter.emit(e,i)}on(e,i){return this._emitter.on(e,i)}once(e,i){return this._emitter.once(e,i)}hasEventListener(e){return this._emitter.hasEventListener(e)}};(function(t){class e{constructor(n=null){this._target=n,this._listenersMap=null}clear(){this._listenersMap&&this._listenersMap.clear(),this._listenersMap=null}emit(n,s){const o=this._listenersMap&&this._listenersMap.get(n);if(!o)return!1;const a=this._target||this;return[...o].forEach(l=>{l.call(a,s)}),o.length>0}on(n,s){if(Array.isArray(n)){const a=n.map(l=>this.on(l,s));return hM(a)}if(n.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap||(this._listenersMap=new Map);const o=this._listenersMap.get(n)||[];return o.push(s),this._listenersMap.set(n,o),{remove:()=>{const a=this._listenersMap&&this._listenersMap.get(n)||[],l=a.indexOf(s);l>=0&&a.splice(l,1)}}}once(n,s){const o=this.on(n,a=>{o.remove(),s.call(null,a)});return o}hasEventListener(n){const s=this._listenersMap&&this._listenersMap.get(n);return s!=null&&s.length>0}}t.EventEmitter=e,t.EventedMixin=r=>{let n=class extends r{constructor(){super(...arguments),this._emitter=new e}destroy(){this._emitter.clear()}emit(s,o){return this._emitter.emit(s,o)}on(s,o){return this._emitter.on(s,o)}once(s,o){return this._emitter.once(s,o)}hasEventListener(s){return this._emitter.hasEventListener(s)}};return n=u([$("esri.core.Evented")],n),n};let i=class extends ve{constructor(){super(...arguments),this._emitter=new h6.EventEmitter(this)}destroy(){this._emitter.clear()}emit(r,n){return this._emitter.emit(r,n)}on(r,n){return this._emitter.on(r,n)}once(r,n){return this._emitter.once(r,n)}hasEventListener(r){return this._emitter.hasEventListener(r)}};i=u([$("esri.core.Evented")],i),t.EventedAccessor=i})(h6||(h6={}));const An=h6;var Sr;(function(t){t[t.ADD=1]="ADD",t[t.REMOVE=2]="REMOVE",t[t.MOVE=4]="MOVE"})(Sr||(Sr={}));function mne(t){return(e,i)=>{e[i]=t}}let gne=class extends c2e{notify(){const e=this._observers;if(e&&e.length>0){const i=e.slice();for(const r of i)r.onInvalidated(),r.onCommitted()}}};var F0;let lHe=class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}};const yd=new zo(lHe,void 0,t=>{t.item=null,t.target=null,t.defaultPrevented=!1,t.cancellable=!1}),cHe=()=>{};function Dj(t){return t?t instanceof WT?t.toArray():t.length?Array.prototype.slice.apply(t):[]:[]}function Nj(t){if(t&&t.length)return t[0]}function uHe(t,e,i,r){const n=Math.min(t.length-i,e.length-r);let s=0;for(;s<n&&t[i+s]===e[r+s];)s++;return s}function wEe(t,e,i,r){e&&e.forEach((n,s,o)=>{t.push(n),wEe(t,i.call(r,n,s,o),i,r)})}const hv=new Set,dv=new Set,pv=new Set,Fj=new Map;let hHe=0,WT=F0=class extends An.EventedAccessor{static isCollection(t){return t!=null&&t instanceof F0}constructor(t){super(t),this._chgListeners=[],this._notifications=null,this._timer=null,this._observable=new gne,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:hHe++})}normalizeCtorArgs(t){return t?Array.isArray(t)||t instanceof F0?{items:t}:t:{}}destroy(){this.removeAll()}*[Symbol.iterator](){yield*this.items}get items(){return Ei(this._observable),this._items}set items(t){this._emitBeforeChanges(Sr.ADD)||(this._splice(0,this.length,Dj(t)),this._emitAfterChanges(Sr.ADD))}hasEventListener(t){return t==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(t)}on(t,e){if(t==="change"){const i=this._chgListeners,r={removed:!1,callback:e};return i.push(r),this._notifications&&this._notifications.push({listeners:i.slice(),items:this._items.slice(),changes:[]}),{remove(){this.remove=cHe,r.removed=!0,i.splice(i.indexOf(r),1)}}}return this._emitter.on(t,e)}once(t,e){const i=this.on(t,e);return{remove(){i.remove()}}}add(t,e){if(Ei(this._observable),this._emitBeforeChanges(Sr.ADD))return this;const i=this.getNextIndex(e??null);return this._splice(i,0,[t]),this._emitAfterChanges(Sr.ADD),this}addMany(t,e=this._items.length){if(Ei(this._observable),!t||!t.length)return this;if(this._emitBeforeChanges(Sr.ADD))return this;const i=this.getNextIndex(e);return this._splice(i,0,Dj(t)),this._emitAfterChanges(Sr.ADD),this}at(t){if(Ei(this._observable),(t=Math.trunc(t)||0)<0&&(t+=this.length),!(t<0||t>=this.length))return this._items[t]}removeAll(){if(Ei(this._observable),!this.length||this._emitBeforeChanges(Sr.REMOVE))return[];const t=this._splice(0,this.length)||[];return this._emitAfterChanges(Sr.REMOVE),t}clone(){return Ei(this._observable),this._createNewInstance({items:this._items.map(se)})}concat(...t){Ei(this._observable);const e=t.map(Dj);return this._createNewInstance({items:this._items.concat(...e)})}drain(t,e){if(Ei(this._observable),!this.length||this._emitBeforeChanges(Sr.REMOVE))return;const i=this._splice(0,this.length),r=i.length;for(let n=0;n<r;n++)t.call(e,i[n],n,i);this._emitAfterChanges(Sr.REMOVE)}every(t,e){return Ei(this._observable),this._items.every(t,e)}filter(t,e){let i;return Ei(this._observable),i=arguments.length===2?this._items.filter(t,e):this._items.filter(t),this._createNewInstance({items:i})}find(t,e){return Ei(this._observable),this._items.find(t,e)}findIndex(t,e){return Ei(this._observable),this._items.findIndex(t,e)}flatten(t,e){Ei(this._observable);const i=[];return wEe(i,this,t,e),new F0(i)}forEach(t,e){return Ei(this._observable),this._items.forEach(t,e)}getItemAt(t){return Ei(this._observable),this._items[t]}getNextIndex(t){Ei(this._observable);const e=this.length;return(t=t??e)<0?t=0:t>e&&(t=e),t}includes(t,e=0){return Ei(this._observable),this._items.includes(t,e)}indexOf(t,e=0){return Ei(this._observable),this._items.indexOf(t,e)}join(t=","){return Ei(this._observable),this._items.join(t)}lastIndexOf(t,e=this.length-1){return Ei(this._observable),this._items.lastIndexOf(t,e)}map(t,e){Ei(this._observable);const i=this._items.map(t,e);return new F0({items:i})}reorder(t,e=this.length-1){Ei(this._observable);const i=this.indexOf(t);if(i!==-1){if(e<0?e=0:e>=this.length&&(e=this.length-1),i!==e){if(this._emitBeforeChanges(Sr.MOVE))return t;this._splice(i,1),this._splice(e,0,[t]),this._emitAfterChanges(Sr.MOVE)}return t}}pop(){if(Ei(this._observable),!this.length||this._emitBeforeChanges(Sr.REMOVE))return;const t=Nj(this._splice(this.length-1,1));return this._emitAfterChanges(Sr.REMOVE),t}push(...t){return Ei(this._observable),this._emitBeforeChanges(Sr.ADD)||(this._splice(this.length,0,t),this._emitAfterChanges(Sr.ADD)),this.length}reduce(t,e){Ei(this._observable);const i=this._items;return arguments.length===2?i.reduce(t,e):i.reduce(t)}reduceRight(t,e){Ei(this._observable);const i=this._items;return arguments.length===2?i.reduceRight(t,e):i.reduceRight(t)}remove(t){return Ei(this._observable),this.removeAt(this.indexOf(t))}removeAt(t){if(Ei(this._observable),t<0||t>=this.length||this._emitBeforeChanges(Sr.REMOVE))return;const e=Nj(this._splice(t,1));return this._emitAfterChanges(Sr.REMOVE),e}removeMany(t){if(Ei(this._observable),!t||!t.length||this._emitBeforeChanges(Sr.REMOVE))return[];const e=t instanceof F0?t.toArray():t,i=this._items,r=[],n=e.length;for(let s=0;s<n;s++){const o=e[s],a=i.indexOf(o);if(a>-1){const l=1+uHe(e,i,s+1,a+1),c=this._splice(a,l);c&&c.length>0&&r.push.apply(r,c),s+=l-1}}return this._emitAfterChanges(Sr.REMOVE),r}reverse(){if(Ei(this._observable),this._emitBeforeChanges(Sr.MOVE))return this;const t=this._splice(0,this.length);return t&&(t.reverse(),this._splice(0,0,t)),this._emitAfterChanges(Sr.MOVE),this}shift(){if(Ei(this._observable),!this.length||this._emitBeforeChanges(Sr.REMOVE))return;const t=Nj(this._splice(0,1));return this._emitAfterChanges(Sr.REMOVE),t}slice(t=0,e=this.length){return Ei(this._observable),this._createNewInstance({items:this._items.slice(t,e)})}some(t,e){return Ei(this._observable),this._items.some(t,e)}sort(t){if(Ei(this._observable),!this.length||this._emitBeforeChanges(Sr.MOVE))return this;const e=this._splice(0,this.length);return arguments.length?e.sort(t):e.sort(),this._splice(0,0,e),this._emitAfterChanges(Sr.MOVE),this}splice(t,e,...i){Ei(this._observable);const r=(e?Sr.REMOVE:0)|(i.length?Sr.ADD:0);if(this._emitBeforeChanges(r))return[];const n=this._splice(t,e,i)||[];return this._emitAfterChanges(r),n}toArray(){return Ei(this._observable),this._items.slice()}toJSON(){return Ei(this._observable),this.toArray()}toLocaleString(){return Ei(this._observable),this._items.toLocaleString()}toString(){return Ei(this._observable),this._items.toString()}unshift(...t){return Ei(this._observable),!t.length||this._emitBeforeChanges(Sr.ADD)||(this._splice(0,0,t),this._emitAfterChanges(Sr.ADD)),this.length}_createNewInstance(t){return new this.constructor(t)}_splice(t,e,i){const r=this._items,n=this.itemType;let s,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=V2(()=>this._dispatchChange())),e){if(o=r.splice(t,e),this.hasEventListener("before-remove")){const a=yd.acquire();a.target=this,a.cancellable=!0;for(let l=0,c=o.length;l<c;l++)s=o[l],a.reset(s),this.emit("before-remove",a),a.defaultPrevented&&(o.splice(l,1),r.splice(t,0,s),t+=1,l-=1,c-=1);yd.release(a)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const a=yd.acquire();a.target=this,a.cancellable=!1;const l=o.length;for(let c=0;c<l;c++)a.reset(o[c]),this.emit("after-remove",a);yd.release(a)}}if(i&&i.length){if(n){const h=[];for(const p of i){const f=n.ensureType(p);f==null&&p!=null||h.push(f)}i=h}const a=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=t===this.length;if(a||l){const h=yd.acquire();h.target=this,h.cancellable=!0;const p=yd.acquire();p.target=this,p.cancellable=!1;for(const f of i)a?(h.reset(f),this.emit("before-add",h),h.defaultPrevented||(c?r.push(f):r.splice(t++,0,f),this._set("length",r.length),l&&(p.reset(f),this.emit("after-add",p)))):(c?r.push(f):r.splice(t++,0,f),this._set("length",r.length),p.reset(f),this.emit("after-add",p));yd.release(p),yd.release(h)}else{if(c)for(const h of i)r.push(h);else r.splice(t,0,...i);this._set("length",r.length)}}return(i&&i.length||o&&o.length)&&this._notifyChangeEvent(i,o),o}_emitBeforeChanges(t){let e=!1;if(this.hasEventListener("before-changes")){const i=yd.acquire();i.target=this,i.cancellable=!0,i.type=t,this.emit("before-changes",i),e=i.defaultPrevented,yd.release(i)}return e}_emitAfterChanges(t){if(this.hasEventListener("after-changes")){const e=yd.acquire();e.target=this,e.cancellable=!1,e.type=t,this.emit("after-changes",e),yd.release(e)}this._observable.notify()}_notifyChangeEvent(t,e){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:t,removed:e})}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),!this._notifications)return;const t=this._notifications;this._notifications=null;for(const e of t){const i=e.changes;hv.clear(),dv.clear(),pv.clear();for(const{added:l,removed:c}of i){if(l)if(pv.size===0&&dv.size===0)for(const h of l)hv.add(h);else for(const h of l)dv.has(h)?(pv.add(h),dv.delete(h)):pv.has(h)||hv.add(h);if(c)if(pv.size===0&&hv.size===0)for(const h of c)dv.add(h);else for(const h of c)hv.has(h)?hv.delete(h):(pv.delete(h),dv.add(h))}const r=Vc.acquire();hv.forEach(l=>{r.push(l)});const n=Vc.acquire();dv.forEach(l=>{n.push(l)});const s=this._items,o=e.items,a=Vc.acquire();if(pv.forEach(l=>{o.indexOf(l)!==s.indexOf(l)&&a.push(l)}),e.listeners&&(r.length||n.length||a.length)){const l={target:this,added:r,removed:n,moved:a},c=e.listeners.length;for(let h=0;h<c;h++){const p=e.listeners[h];p.removed||p.callback.call(this,l)}}Vc.release(r),Vc.release(n),Vc.release(a)}hv.clear(),dv.clear(),pv.clear()}};WT.ofType=t=>{if(!t)return F0;if(Fj.has(t))return Fj.get(t);let e=null;if(typeof t=="function")e=t.prototype.declaredClass;else if(t.base)e=t.base.prototype.declaredClass;else for(const r in t.typeMap){const n=t.typeMap[r].prototype.declaredClass;e?e+=` | ${n}`:e=n}let i=class extends F0{};return u([mne({Type:t,ensureType:typeof t=="function"?Ts(t):pm(t)})],i.prototype,"itemType",void 0),i=u([$(`esri.core.Collection<${e}>`)],i),Fj.set(t,i),i},u([d()],WT.prototype,"length",void 0),u([d()],WT.prototype,"items",null),WT=F0=u([$("esri.core.Collection")],WT);const tt=WT;var gM;function dHe(t,e){switch(t.type){case"range":{const i="range"in t?t.range[0]:t.minValue,r="range"in t?t.range[1]:t.maxValue;if(i!=null&&+e<i||r!=null&&+e>r)return gM.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(t.codedValues==null||t.codedValues.every(i=>i==null||i.code!==e))return gM.INVALID_CODED_VALUE}return null}(function(t){t.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",t.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(gM||(gM={}));const pHe=re.getLogger("esri.support.arcadeOnDemand");let kj;function cy(){return kj||(kj=(async()=>{const t=await Q(()=>import("./arcadeUtils-39415c80.js").then(e=>e.ax),["assets/arcadeUtils-39415c80.js","assets/arcadeTimeUtils-21c68d00.js","assets/executionError-fb3f283a.js","assets/number-beae30ff.js","assets/hash-0ddfbf4b.js"]);return{arcade:t.arcade,arcadeUtils:t,Dictionary:t.Dictionary,Feature:t.arcadeFeature}})()),kj}const fHe=(t,e,i)=>yne.create(t,e,i,null,["$feature"]),mHe=(t,e,i)=>yne.create(t,e,i,null,["$feature","$view"]),gHe=(t,e,i,r)=>yne.create(t,e,i,r,["$feature","$view"]);let yne=class xEe{constructor(e,i,r,n,s,o,a){this.script=e,this.evaluate=n;const l=Array.isArray(o)?o:o.fields;this.fields=l,this._syntaxTree=r,this._arcade=i,this._arcadeFeature=s,this._spatialReference=a,this._referencesGeometry=i.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(e,i,r,n,s,o){const{arcade:a,Feature:l,Dictionary:c}=await cy(),h=Je.fromJSON(i);let p;try{p=a.parseScript(e,o)}catch(O){return pHe.error(new H("arcade-bad-expression","Failed to parse arcade script",{script:e,error:O})),null}const f=s.reduce((O,D)=>({...O,[D]:null}),{});let m=null;v(n)&&(m=new c(n),m.immutable=!0,f.$config=null);const g=a.scriptUsesGeometryEngine(p),_=g&&a.enableGeometrySupport(),b=a.scriptUsesFeatureSet(p)&&a.enableFeatureSetSupport(),w=a.scriptIsAsync(p),x=w&&a.enableAsyncSupport(),T={vars:f,spatialReference:h,useAsync:!!x};await Promise.all([_,b,x]);const E=new Set;await a.loadDependentModules(E,p,null,w,g);const C=new c;C.immutable=!1,C.setField("scale",0);const A=a.compileScript(p,T),I=O=>("$view"in O&&O.$view&&(C.setField("scale",typeof O.$view=="object"?O.$view.scale:void 0),O.$view=C),m&&(O.$config=m),A({vars:O,spatialReference:h}));return new xEe(e,a,p,I,new l,r,h)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}};const yHe=/^([0-9])/,_He=/[^a-z0-9_\u0080-\uffff]/gi,vHe=/_{2,}/g,bHe=/^_/,wHe=/_$/;function xHe(t){return t==null?null:t.trim().replace(_He,"_").replace(vHe,"_").replace(bHe,"").replace(wHe,"").replace(yHe,"F$1")||null}const THe=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],SHe=["field","normalizationField"];function Zhe(t,e){if(t!=null&&e!=null){for(const i of Array.isArray(t)?t:[t])if(Jhe(THe,i,e),"visualVariables"in i&&i.visualVariables)for(const r of i.visualVariables)Jhe(SHe,r,e)}}function Jhe(t,e,i){if(t)for(const r of t){const n=cN(r,e),s=n&&typeof n!="function"&&i.get(n);s&&va(r,s.name,e)}}function TEe(t,e){var i;if(t!=null&&((i=e==null?void 0:e.fields)!=null&&i.length))if("startField"in t){const r=e.get(t.startField),n=e.get(t.endField);t.startField=(r==null?void 0:r.name)??null,t.endField=(n==null?void 0:n.name)??null}else{const r=e.get(t.startTimeField),n=e.get(t.endTimeField);t.startTimeField=(r==null?void 0:r.name)??null,t.endTimeField=(n==null?void 0:n.name)??null}}const Uj=new Set;function SEe(t,e){return t&&e?(Uj.clear(),GL(Uj,t,e),Array.from(Uj).sort()):[]}function GL(t,e,i){var r;if(i)if((r=e==null?void 0:e.fields)!=null&&r.length)if(i.includes("*"))for(const{name:n}of e.fields)t.add(n);else for(const n of i)ed(t,e,n);else{if(i.includes("*"))return t.clear(),void t.add("*");for(const n of i)n!=null&&t.add(n)}}function ed(t,e,i){if(typeof i=="string")if(e){const r=e.get(i);r&&t.add(r.name)}else t.add(i)}function dVt(t,e){return R(e)||R(t)?[]:e.includes("*")?(t.fields??[]).map(i=>i.name):e}async function Xc(t,e,i){var s;if(!i)return;const{arcadeUtils:r}=await cy(),n=r.extractFieldNames(i,(s=e==null?void 0:e.fields)==null?void 0:s.map(o=>o.name));for(const o of n)ed(t,e,o)}async function EEe(t,e,i){if(i&&i!=="1=1"){const r=(await Q(()=>import("./WhereClause-cdddccc4.js").then(n=>n.W),["assets/WhereClause-cdddccc4.js","assets/executionError-fb3f283a.js"])).WhereClause.create(i,e);if(!r.isStandardized)throw new H("fieldUtils:collectFilterFields","Where clause is not standardized",{where:i});GL(t,e,r.fieldNames)}}function EHe({displayField:t,fields:e}){return t||(e&&e.length?Vj(e,"name-or-title")||Vj(e,"unique-identifier")||Vj(e,"type-or-category")||CHe(e):null)}function CHe(t){for(const e of t){if(!e||!e.name)continue;const i=e.name.toLowerCase();if(i.includes("name")||i.includes("title"))return e.name}return null}function Vj(t,e){for(const i of t)if(i&&i.valueType&&i.valueType===e)return i.name;return null}async function pVt(t,e){var r;if(!e)return;const i=(r=e.elevationInfo)==null?void 0:r.featureExpressionInfo;return i?i.collectRequiredFields(t,e.fieldsIndex):void 0}function AHe(t,e,i){i.onStatisticExpression?Xc(t,e,i.onStatisticExpression.expression):t.add(i.onStatisticField)}async function fVt(t,e,i){if(!e||!i||!("fields"in i))return;const r=[],n=i.popupTemplate;r.push(RHe(t,e,n)),i.fields&&r.push(...i.fields.map(async s=>AHe(t,e.fieldsIndex,s))),await Promise.all(r)}async function RHe(t,e,i){const r=[];i!=null&&i.expressionInfos&&r.push(...i.expressionInfos.map(s=>Xc(t,e.fieldsIndex,s.expression)));const n=i==null?void 0:i.content;if(Array.isArray(n))for(const s of n)s.type==="expression"&&s.expressionInfo&&r.push(Xc(t,e.fieldsIndex,s.expressionInfo.expression));await Promise.all(r)}async function mVt(t,e,i){e&&(e.timeInfo&&v(i)&&i.timeExtent&&GL(t,e.fieldsIndex,[e.timeInfo.startField,e.timeInfo.endField]),e.floorInfo&&GL(t,e.fieldsIndex,[e.floorInfo.floorField]),v(i)&&v(i.where)&&await EEe(t,e.fieldsIndex,i.where))}async function gVt(t,e,i){e&&i&&await Promise.all(i.map(r=>MHe(t,e,r)))}async function MHe(t,e,i){e&&i&&(i.valueExpression?await Xc(t,e.fieldsIndex,i.valueExpression):i.field&&ed(t,e.fieldsIndex,i.field))}function yVt(t){if(!t)return[];const e="editFieldsInfo"in t&&t.editFieldsInfo;return e?SEe(t.fieldsIndex,[e&&e.creatorField,e&&e.creationDateField,e&&e.editorField,e&&e.editDateField]):[]}async function _Vt(t,e){const{labelingInfo:i,fieldsIndex:r}=e;i&&i.length&&await Promise.all(i.map(n=>OHe(t,r,n)))}async function OHe(t,e,i){if(!i)return;const r=i.getLabelExpression(),n=i.where;if(r.type==="arcade")await Xc(t,e,r.expression);else{const s=r.expression.match(/{[^}]*}/g);s&&s.forEach(o=>{ed(t,e,o.slice(1,-1))})}await EEe(t,e,n)}function PHe(t){const e=t.defaultValue;return e!==void 0&&REe(t,e)?e:t.nullable?null:void 0}function CEe(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}function IHe(t){return t===null||CEe(t)}const _ne="isInteger"in Number?Number.isInteger:t=>typeof t=="number"&&isFinite(t)&&Math.floor(t)===t;function $He(t){return t===null||_ne(t)}function AEe(t){return t!=null&&typeof t=="string"}function LHe(t){return t===null||AEe(t)}function DHe(){return!0}function REe(t,e){let i;switch(t.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":i=t.nullable?$He:_ne;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":i=t.nullable?IHe:CEe;break;case"string":case"esriFieldTypeString":i=t.nullable?LHe:AEe;break;default:i=DHe}return arguments.length===1?i:i(e)}const NHe=["integer","small-integer","single","double"],FHe=new Set([...NHe,"esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]);function N9(t){return t!=null&&FHe.has(t.type)}function vVt(t){return t!=null&&(t.type==="string"||t.type==="esriFieldTypeString")}var Q8,eV;function bVt(t){return t==null||typeof t=="number"&&isNaN(t)?null:t}function wVt(t,e){return t==null||t.nullable&&e===null?null:N9(t)&&!kHe(t.type,Number(e))?Q8.OUT_OF_RANGE:REe(t,e)?t.domain?dHe(t.domain,e):null:eV.INVALID_TYPE}function kHe(t,e){const i=typeof t=="string"?MEe(t):t;if(!i)return!1;const r=i.min,n=i.max;return i.isInteger?_ne(e)&&e>=r&&e<=n:e>=r&&e<=n}function MEe(t){switch(t){case"esriFieldTypeSmallInteger":case"small-integer":return UHe;case"esriFieldTypeInteger":case"integer":return VHe;case"esriFieldTypeSingle":case"single":return zHe;case"esriFieldTypeDouble":case"double":return BHe}}(function(t){t.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(Q8||(Q8={})),function(t){t.INVALID_TYPE="type-validation-error::invalid-type"}(eV||(eV={}));const UHe={min:-32768,max:32767,isInteger:!0},VHe={min:-2147483648,max:2147483647,isInteger:!0},zHe={min:-34e37,max:12e37,isInteger:!1},BHe={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1};function xVt(t,e,i){switch(t){case gM.INVALID_CODED_VALUE:return`Value ${i} is not in the coded domain - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case gM.VALUE_OUT_OF_RANGE:return`Value ${i} is out of the range of valid values - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case eV.INVALID_TYPE:return`Value ${i} is not a valid value for the field type - field: ${e.name}, type: ${e.type}, nullable: ${e.nullable}`;case Q8.OUT_OF_RANGE:{const{min:r,max:n}=MEe(e.type);return`Value ${i} is out of range for the number type - field: ${e.name}, type: ${e.type}, value range is ${r} to ${n}`}}}function jHe(t,e){return!GHe(t,e,null)}function GHe(t,e,i){if(!e||!e.attributes||!t){if(v(i))for(const s of t??[])i.add(s);return!0}const r=e.attributes;let n=!1;for(const s of t)if(!(s in r)){if(n=!0,!v(i))break;i.add(s)}return n}function OEe(t){return!!t&&["raster.itempixelvalue","raster.servicepixelvalue"].some(e=>t.toLowerCase().startsWith(e))}let d6=class extends fe{constructor(e){super(e),this.type=null}};u([d({type:["attachments","custom","fields","media","text","expression","relationship"],readOnly:!0,json:{read:!1,write:!0}})],d6.prototype,"type",void 0),d6=u([$("esri.popup.content.Content")],d6);const $w=d6;var MY;let zx=MY=class extends $w{constructor(t){super(t),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new MY({description:this.description,displayType:this.displayType,title:this.title})}};u([d({type:String,json:{write:!0}})],zx.prototype,"description",void 0),u([d({type:["auto","preview","list"],json:{write:!0}})],zx.prototype,"displayType",void 0),u([d({type:String,json:{write:!0}})],zx.prototype,"title",void 0),u([d({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],zx.prototype,"type",void 0),zx=MY=u([$("esri.popup.content.AttachmentsContent")],zx);const HL=zx;var OY;let Bx=OY=class extends $w{constructor(t){super(t),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new OY({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?se(this.outFields):null})}};u([d()],Bx.prototype,"creator",void 0),u([d()],Bx.prototype,"destroyer",void 0),u([d()],Bx.prototype,"outFields",void 0),u([d({type:["custom"],readOnly:!0})],Bx.prototype,"type",void 0),Bx=OY=u([$("esri.popup.content.CustomContent")],Bx);const HHe=Bx;var PY;let wC=PY=class extends fe{constructor(t){super(t),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new PY({title:this.title,expression:this.expression})}};u([d({type:String,json:{write:!0}})],wC.prototype,"title",void 0),u([d({type:String,json:{write:!0}})],wC.prototype,"expression",void 0),u([d({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],wC.prototype,"returnType",void 0),wC=PY=u([$("esri.popup.ElementExpressionInfo")],wC);const PEe=wC;var IY;let EP=IY=class extends $w{constructor(t){super(t),this.expressionInfo=null,this.type="expression"}clone(){var t;return new IY({expressionInfo:(t=this.expressionInfo)==null?void 0:t.clone()})}};u([d({type:PEe,json:{write:!0}})],EP.prototype,"expressionInfo",void 0),u([d({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],EP.prototype,"type",void 0),EP=IY=u([$("esri.popup.content.ExpressionContent")],EP);const vne=EP;function ot(t,e={}){const i=t instanceof mi?t:new mi(t,e),r={type:(e==null?void 0:e.ignoreUnknown)??1?i.apiValues:String,json:{type:i.jsonValues,read:!(e!=null&&e.readOnly)&&{reader:i.read},write:{writer:i.write}}};return(e==null?void 0:e.readOnly)!==void 0&&(r.readOnly=!!e.readOnly),(e==null?void 0:e.default)!==void 0&&(r.json.default=e.default),(e==null?void 0:e.name)!==void 0&&(r.json.name=e.name),(e==null?void 0:e.nonNullable)!==void 0&&(r.nonNullable=e.nonNullable),d(r)}const qL=Wa()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});qL.toJSON.bind(qL);qL.fromJSON.bind(qL);let x$;var uxe,hxe;const qHe=((uxe=globalThis.esriConfig)==null?void 0:uxe.locale)??((hxe=globalThis.dojoConfig)==null?void 0:hxe.locale);function IEe(){var t;return qHe??((t=globalThis.navigator)==null?void 0:t.language)??"en"}function wp(){return x$===void 0&&(x$=IEe()),x$}const T$=[];function $Ee(t){return T$.push(t),{remove(){T$.splice(T$.indexOf(t),1)}}}const $Y=[];function bne(t){return $Y.push(t),{remove(){T$.splice($Y.indexOf(t),1)}}}function WHe(){const t=IEe();x$!==t&&(x$=t,[...$Y].forEach(e=>{e.call(null,t)}),[...T$].forEach(e=>{e.call(null,t)}))}var dxe;(dxe=globalThis.addEventListener)==null||dxe.call(globalThis,"languagechange",WHe);const Lm={year:"numeric",month:"numeric",day:"numeric"},c3={year:"numeric",month:"long",day:"numeric"},u3={year:"numeric",month:"short",day:"numeric"},h3={year:"numeric",month:"long",weekday:"long",day:"numeric"},Id={hour:"numeric",minute:"numeric"},Xp={...Id,second:"numeric"},wne={"short-date":Lm,"short-date-short-time":{...Lm,...Id},"short-date-short-time-24":{...Lm,...Id,hour12:!1},"short-date-long-time":{...Lm,...Xp},"short-date-long-time-24":{...Lm,...Xp,hour12:!1},"short-date-le":Lm,"short-date-le-short-time":{...Lm,...Id},"short-date-le-short-time-24":{...Lm,...Id,hour12:!1},"short-date-le-long-time":{...Lm,...Xp},"short-date-le-long-time-24":{...Lm,...Xp,hour12:!1},"long-month-day-year":c3,"long-month-day-year-short-time":{...c3,...Id},"long-month-day-year-short-time-24":{...c3,...Id,hour12:!1},"long-month-day-year-long-time":{...c3,...Xp},"long-month-day-year-long-time-24":{...c3,...Xp,hour12:!1},"day-short-month-year":u3,"day-short-month-year-short-time":{...u3,...Id},"day-short-month-year-short-time-24":{...u3,...Id,hour12:!1},"day-short-month-year-long-time":{...u3,...Xp},"day-short-month-year-long-time-24":{...u3,...Xp,hour12:!1},"long-date":h3,"long-date-short-time":{...h3,...Id},"long-date-short-time-24":{...h3,...Id,hour12:!1},"long-date-long-time":{...h3,...Xp},"long-date-long-time-24":{...h3,...Xp,hour12:!1},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":Id,"long-time":Xp},WL=Wa()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});WL.apiValues;WL.toJSON.bind(WL);WL.fromJSON.bind(WL);const XHe={ar:"ar-u-nu-latn-ca-gregory"};let LY=new WeakMap,LEe=wne["short-date-short-time"];function YHe(t){const e=t||LEe;let i=LY.get(e);if(!i){const r=wp(),n=XHe[wp()]||r;i=new Intl.DateTimeFormat(n,e),LY.set(e,i)}return i}function F9(t){return t?wne[t]:null}function uy(t,e){return YHe(e).format(t)}bne(()=>{LY=new WeakMap,LEe=wne["short-date-short-time"]});const ZHe={ar:"ar-u-nu-latn"};let p6=new WeakMap,DEe={};function JHe(t){const e=t||DEe;if(!p6.has(e)){const i=wp(),r=ZHe[wp()]||i;p6.set(e,new Intl.NumberFormat(r,t))}return p6.get(e)}function NEe(t={}){const e={};return t.digitSeparator!=null&&(e.useGrouping=t.digitSeparator),t.places!=null&&(e.minimumFractionDigits=e.maximumFractionDigits=t.places),e}function hy(t,e){return t===-0&&(t=0),JHe(e).format(t)}bne(()=>{p6=new WeakMap,DEe={}});var DY;let jx=DY=class extends fe{constructor(t){super(t),this.dateFormat=null,this.dateTimeFormatOptions=null,this.digitSeparator=!1,this.places=null}clone(){return new DY({dateFormat:this.dateFormat,digitSeparator:this.digitSeparator,places:this.places})}format(t){return this.dateFormat?uy(t,{...F9(this.dateFormat),...this.dateTimeFormatOptions}):hy(t,NEe(this))}formatRasterPixelValue(t){if(t.includes("-"))return t;let e,i;return t.trim().includes(",")?(e=",",i=e+" ",this._formatDelimitedString(t,e,i,this)):t.trim().includes(";")?(e=";",i=e+" ",this._formatDelimitedString(t,e,i,this)):t.trim().includes(" ")?(e=i=" ",this._formatDelimitedString(t,e,i,this)):this.format(Number(t))}_formatDelimitedString(t,e,i,r){return t&&e&&i&&r?t.trim().split(e).map(n=>this.format(Number(n))).join(i):t}};u([ot(qL)],jx.prototype,"dateFormat",void 0),u([d({type:Object,json:{read:!1}})],jx.prototype,"dateTimeFormatOptions",void 0),u([d({type:Boolean,json:{write:!0}})],jx.prototype,"digitSeparator",void 0),u([d({type:Kr,json:{write:!0}})],jx.prototype,"places",void 0),jx=DY=u([$("esri.popup.support.FieldInfoFormat")],jx);const JA=jx;var NY;let af=NY=class extends fe{constructor(t){super(t),this.fieldName=null,this.format=null,this.isEditable=!1,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new NY({fieldName:this.fieldName,format:this.format?se(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};u([d({type:String,json:{write:!0}})],af.prototype,"fieldName",void 0),u([d({type:JA,json:{write:!0}})],af.prototype,"format",void 0),u([d({type:Boolean,json:{write:!0,default:!1}})],af.prototype,"isEditable",void 0),u([d({type:String,json:{write:!0}})],af.prototype,"label",void 0),u([ot(new mi({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],af.prototype,"stringFieldOption",void 0),u([d({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],af.prototype,"statisticType",void 0),u([d({type:String,json:{write:!0}})],af.prototype,"tooltip",void 0),u([d({type:Boolean,json:{write:!0}})],af.prototype,"visible",void 0),af=NY=u([$("esri.popup.FieldInfo")],af);const _N=af;var FY;let i0=FY=class extends $w{constructor(t){super(t),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(t,e){e.fieldInfos=t&&t.map(i=>i.toJSON())}clone(){return new FY(se({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};u([d({type:Object,json:{write:!0}})],i0.prototype,"attributes",void 0),u([d({type:String,json:{write:!0}})],i0.prototype,"description",void 0),u([d({type:[_N]})],i0.prototype,"fieldInfos",void 0),u([Ne("fieldInfos")],i0.prototype,"writeFieldInfos",null),u([d({type:String,json:{write:!0}})],i0.prototype,"title",void 0),u([d({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],i0.prototype,"type",void 0),i0=FY=u([$("esri.popup.content.FieldsContent")],i0);const yM=i0;let Gx=class extends fe{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};u([d({type:String,json:{write:!0}})],Gx.prototype,"altText",void 0),u([d({type:String,json:{write:!0}})],Gx.prototype,"caption",void 0),u([d({type:String,json:{write:!0}})],Gx.prototype,"title",void 0),u([d({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],Gx.prototype,"type",void 0),Gx=u([$("esri.popup.content.mixins.MediaInfo")],Gx);const xne=Gx;var kY;let xC=kY=class extends ve{constructor(t){super(t),this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new kY({fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};u([d()],xC.prototype,"fieldName",void 0),u([d()],xC.prototype,"tooltip",void 0),u([d()],xC.prototype,"value",void 0),xC=kY=u([$("esri.popup.content.support.ChartMediaInfoValueSeries")],xC);const FEe=xC;var UY;let Hx=UY=class extends fe{constructor(t){super(t),this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new UY({fields:se(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};u([d({type:[String],json:{write:!0}})],Hx.prototype,"fields",void 0),u([d({type:String,json:{write:!0}})],Hx.prototype,"normalizeField",void 0),u([d({type:[FEe],json:{read:!1}})],Hx.prototype,"series",void 0),u([d({type:String,json:{write:!0}})],Hx.prototype,"tooltipField",void 0),Hx=UY=u([$("esri.popup.content.support.ChartMediaInfoValue")],Hx);const KHe=Hx;let CP=class extends xne{constructor(e){super(e),this.type=null,this.value=null}};u([d({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],CP.prototype,"type",void 0),u([d({type:KHe,json:{write:!0}})],CP.prototype,"value",void 0),CP=u([$("esri.popup.content.mixins.ChartMediaInfo")],CP);const k9=CP,U9=Wa()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var VY;let f6=VY=class extends k9{constructor(t){super(t),this.type="bar-chart"}clone(){return new VY({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:U9.write}})],f6.prototype,"type",void 0),f6=VY=u([$("esri.popup.content.BarChartMediaInfo")],f6);const kEe=f6;var zY;let m6=zY=class extends k9{constructor(t){super(t),this.type="column-chart"}clone(){return new zY({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:U9.write}})],m6.prototype,"type",void 0),m6=zY=u([$("esri.popup.content.ColumnChartMediaInfo")],m6);const UEe=m6;var BY;let AP=BY=class extends fe{constructor(t){super(t),this.linkURL=null,this.sourceURL=null}clone(){return new BY({linkURL:this.linkURL,sourceURL:this.sourceURL})}};u([d({type:String,json:{write:!0}})],AP.prototype,"linkURL",void 0),u([d({type:String,json:{write:!0}})],AP.prototype,"sourceURL",void 0),AP=BY=u([$("esri.popup.content.support.ImageMediaInfoValue")],AP);const QHe=AP;var jY;let TC=jY=class extends xne{constructor(t){super(t),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new jY({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};u([d({type:Number,json:{write:!0}})],TC.prototype,"refreshInterval",void 0),u([d({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],TC.prototype,"type",void 0),u([d({type:QHe,json:{write:!0}})],TC.prototype,"value",void 0),TC=jY=u([$("esri.popup.content.ImageMediaInfo")],TC);const VEe=TC;var GY;let g6=GY=class extends k9{constructor(t){super(t),this.type="line-chart"}clone(){return new GY({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:U9.write}})],g6.prototype,"type",void 0),g6=GY=u([$("esri.popup.content.LineChartMediaInfo")],g6);const zEe=g6;var HY;let y6=HY=class extends k9{constructor(t){super(t),this.type="pie-chart"}clone(){return new HY({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:U9.write}})],y6.prototype,"type",void 0),y6=HY=u([$("esri.popup.content.PieChartMediaInfo")],y6);const BEe=y6,jEe={base:xne,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":kEe,"column-chart":UEe,"line-chart":zEe,"pie-chart":BEe,image:VEe}};var qY;let lf=qY=class extends $w{constructor(t){super(t),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(t){return t&&t.map(e=>e.type==="image"?VEe.fromJSON(e):e.type==="barchart"?kEe.fromJSON(e):e.type==="columnchart"?UEe.fromJSON(e):e.type==="linechart"?zEe.fromJSON(e):e.type==="piechart"?BEe.fromJSON(e):void 0).filter(Boolean)}writeMediaInfos(t,e){e.mediaInfos=t&&t.map(i=>i.toJSON())}clone(){return new qY(se({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};u([d()],lf.prototype,"activeMediaInfoIndex",void 0),u([d({type:Object,json:{write:!0}})],lf.prototype,"attributes",void 0),u([d({type:String,json:{write:!0}})],lf.prototype,"description",void 0),u([d({types:[jEe]})],lf.prototype,"mediaInfos",void 0),u([Oe("mediaInfos")],lf.prototype,"readMediaInfos",null),u([Ne("mediaInfos")],lf.prototype,"writeMediaInfos",null),u([d({type:String,json:{write:!0}})],lf.prototype,"title",void 0),u([d({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],lf.prototype,"type",void 0),lf=qY=u([$("esri.popup.content.MediaContent")],lf);const XL=lf;var WY;let RP=WY=class extends fe{constructor(t){super(t),this.field=null,this.order=null}clone(){return new WY({field:this.field,order:this.order})}};u([d({type:String,json:{write:!0}})],RP.prototype,"field",void 0),u([d({type:["asc","desc"],json:{write:!0}})],RP.prototype,"order",void 0),RP=WY=u([$("esri.popup.support.RelatedRecordsInfoFieldOrder")],RP);const Tne=RP;let tg=class extends xr($w){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};u([d({type:String,json:{write:!0}})],tg.prototype,"description",void 0),u([d({type:Number,json:{type:Kr,write:!0}})],tg.prototype,"displayCount",void 0),u([d({type:["list"],json:{write:!0}})],tg.prototype,"displayType",void 0),u([d({type:[Tne],json:{write:!0}})],tg.prototype,"orderByFields",void 0),u([d({type:Number,json:{type:Kr,write:!0}})],tg.prototype,"relationshipId",void 0),u([d({type:String,json:{write:!0}})],tg.prototype,"title",void 0),u([d({type:["relationship"],readOnly:!0,json:{read:!1,write:!0}})],tg.prototype,"type",void 0),tg=u([$("esri.popup.content.RelationshipContent")],tg);const tV=tg;var XY;let MP=XY=class extends $w{constructor(t){super(t),this.text=null,this.type="text"}clone(){return new XY({text:this.text})}};u([d({type:String,json:{write:!0}})],MP.prototype,"text",void 0),u([d({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],MP.prototype,"type",void 0),MP=XY=u([$("esri.popup.content.TextContent")],MP);const _M=MP,eqe={base:null,key:"type",typeMap:{attachment:HL,media:XL,text:_M,expression:vne,field:yM,relationship:tV}};var YY;let qx=YY=class extends fe{constructor(t){super(t),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new YY({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([d({type:String,json:{write:!0}})],qx.prototype,"name",void 0),u([d({type:String,json:{write:!0}})],qx.prototype,"title",void 0),u([d({type:String,json:{write:!0}})],qx.prototype,"expression",void 0),u([d({type:["string","number"],json:{write:!0}})],qx.prototype,"returnType",void 0),qx=YY=u([$("esri.popup.ExpressionInfo")],qx);const GEe=qx;var ZY;let OP=ZY=class extends fe{constructor(t){super(t),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new ZY({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};u([d({type:Boolean,json:{write:!0}})],OP.prototype,"returnTopmostRaster",void 0),u([d({type:Boolean,json:{write:!0}})],OP.prototype,"showNoDataRecords",void 0),OP=ZY=u([$("esri.popup.LayerOptions")],OP);const tqe=OP;var JY;let PP=JY=class extends fe{constructor(t){super(t),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new JY({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?se(this.orderByFields):null})}};u([d({type:Boolean,json:{write:!0}})],PP.prototype,"showRelatedRecords",void 0),u([d({type:[Tne],json:{write:!0}})],PP.prototype,"orderByFields",void 0),PP=JY=u([$("esri.popup.RelatedRecordsInfo")],PP);const iqe=PP;let HEe=0;const fO=t=>{let e=class extends t{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+HEe++})}};return e=u([$("esri.core.Identifiable")],e),e},V9=t=>{let e=class extends t{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:HEe++})}};return e=u([$("esri.core.NumericIdentifiable")],e),e};let Khe=class extends fO(class{}){};Khe=u([$("esri.core.Identifiable")],Khe);var KY;let cf=KY=class extends fO(ve){constructor(t){super(t),this.active=!1,this.className=null,this.disabled=!1,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new KY({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};u([d()],cf.prototype,"active",void 0),u([d()],cf.prototype,"className",void 0),u([d()],cf.prototype,"disabled",void 0),u([d()],cf.prototype,"id",void 0),u([d()],cf.prototype,"indicator",void 0),u([d()],cf.prototype,"title",void 0),u([d()],cf.prototype,"type",void 0),u([d()],cf.prototype,"visible",void 0),cf=KY=u([$("esri.support.actions.ActionBase")],cf);const z9=cf;var QY;let _6=QY=class extends z9{constructor(t){super(t),this.image=null,this.type="button"}clone(){return new QY({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};u([d()],_6.prototype,"image",void 0),_6=QY=u([$("esri.support.Action.ActionButton")],_6);const mO=_6;var eZ;let IP=eZ=class extends z9{constructor(t){super(t),this.image=null,this.type="toggle",this.value=!1}clone(){return new eZ({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};u([d()],IP.prototype,"image",void 0),u([d()],IP.prototype,"value",void 0),IP=eZ=u([$("esri.support.Action.ActionToggle")],IP);const qEe=IP,rqe="esri.PopupTemplate",nqe=re.getLogger(rqe),d3="relationships/",Qhe="expression/",sqe=tt.ofType({key:"type",defaultKeyValue:"button",base:z9,typeMap:{button:mO,toggle:qEe}}),oqe={base:$w,key:"type",typeMap:{media:XL,custom:HHe,text:_M,attachments:HL,fields:yM,expression:vne,relationship:tV}},aqe=["attachments","fields","media","text","expression","relationship"];let Zo=class extends xr(fe){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map(i=>pm(oqe,i)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||ih(e)?e:(nqe.error("content error","unsupported content value",{value:e}),null)}readContent(e,i){const{popupElements:r}=i;return Array.isArray(r)&&r.length>0?this._readPopupInfoElements(i.description,i.mediaInfos,r):this._readPopupInfo(i)}writeContent(e,i,r,n){typeof e!="string"?Array.isArray(e)&&(i.popupElements=e.filter(s=>aqe.includes(s.type)).map(s=>s&&s.toJSON(n)),i.popupElements.forEach(s=>{s.type==="attachments"?this._writeAttachmentContent(i):s.type==="media"?this._writeMediaContent(s,i):s.type==="text"?this._writeTextContent(s,i):s.type==="relationship"&&this._writeRelationshipContent(s,i)})):i.description=e}writeFieldInfos(e,i,r,n){const{content:s}=this,o=Array.isArray(s)?s:null;if(e){const a=o?o.filter(c=>c.type==="fields"):[],l=a.length&&a.every(c=>{var h;return(h=c.fieldInfos)==null?void 0:h.length});i.fieldInfos=e.filter(Boolean).map(c=>{const h=c.toJSON(n);return l&&(h.visible=!1),h})}if(o)for(const a of o)a.type==="fields"&&this._writeFieldsContent(a,i)}writeLayerOptions(e,i,r,n){i[r]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(n)}writeTitle(e,i){i.title=e||""}async collectRequiredFields(e,i){const r=this.expressionInfos||[];await this._collectExpressionInfoFields(e,i,[...r,...this._getContentExpressionInfos(this.content,r)]),GL(e,i,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const i=new Set;return await this.collectRequiredFields(i,e),[...i].sort()}_writeFieldsContent(e,i){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const r=se(e.fieldInfos);Array.isArray(i.fieldInfos)?r.forEach(n=>{const s=i.fieldInfos.find(o=>o.fieldName.toLowerCase()===n.fieldName.toLowerCase());s?s.visible=!0:i.fieldInfos.push(n)}):i.fieldInfos=r}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,i){var s,o;const r=((s=e.orderByFields)==null?void 0:s.map(a=>this._toFieldOrderJSON(a,e.relationshipId)))||[],n=[...((o=i.relatedRecordsInfo)==null?void 0:o.orderByFields)||[],...r];i.relatedRecordsInfo={showRelatedRecords:!0,...(n==null?void 0:n.length)&&{orderByFields:n}}}_writeTextContent(e,i){!i.description&&e.text&&(i.description=e.text)}_writeMediaContent(e,i){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const r=se(e.mediaInfos);Array.isArray(i.mediaInfos)?i.mediaInfos=[...i.mediaInfos,...r]:i.mediaInfos=r}_readPopupInfoElements(e,i,r){const n={description:!1,mediaInfos:!1};return r.map(s=>s.type==="media"?(s.mediaInfos||!i||n.mediaInfos||(s.mediaInfos=i,n.mediaInfos=!0),XL.fromJSON(s)):s.type==="text"?(s.text||!e||n.description||(s.text=e,n.description=!0),_M.fromJSON(s)):s.type==="attachments"?HL.fromJSON(s):s.type==="fields"?yM.fromJSON(s):s.type==="expression"?vne.fromJSON(s):s.type==="relationship"?tV.fromJSON(s):void 0).filter(Boolean)}_toRelationshipContent(e){const{field:i,order:r}=e;if(!(i!=null&&i.startsWith(d3)))return null;const n=i.replace(d3,"").split("/");if(n.length!==2)return null;const s=parseInt(n[0],10),o=n[1];return typeof s=="number"&&o?tV.fromJSON({relationshipId:s,orderByFields:[{field:o,order:r}]}):null}_toFieldOrderJSON(e,i){const{order:r,field:n}=e;return{field:`${d3}${i}/${n}`,order:r}}_readPopupInfo({description:e,mediaInfos:i,showAttachments:r,relatedRecordsInfo:n={showRelatedRecords:!1}}){const s=[];e?s.push(new _M({text:e})):s.push(new yM),Array.isArray(i)&&i.length&&s.push(XL.fromJSON({mediaInfos:i})),r&&s.push(HL.fromJSON({displayType:"auto"}));const{showRelatedRecords:o,orderByFields:a}=n;return o&&(a!=null&&a.length)&&a.forEach(l=>{const c=this._toRelationshipContent(l);c&&s.push(c)}),s.length?s:e}_getContentElementFields(e){const i=e==null?void 0:e.type;if(i==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(i==="custom")return e.outFields||[];if(i==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos??this.fieldInfos)];if(i==="media"){const r=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...r.reduce((n,s)=>[...n,...this._getMediaInfoFields(s)],[])]}return i==="text"?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:i,title:r,value:n}=e,s=n||{},{fields:o,normalizeField:a,tooltipField:l,sourceURL:c,linkURL:h}=s,p=[...this._extractFieldNames(r),...this._extractFieldNames(i),...this._extractFieldNames(c),...this._extractFieldNames(h),...o??[]];return a&&p.push(a),l&&p.push(l),p}_getContentExpressionInfos(e,i){return Array.isArray(e)?e.reduce((r,n)=>[...r,...n.type==="expression"&&n.expressionInfo?[n.expressionInfo]:[]],i):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((i,r)=>[...i,...this._getContentElementFields(r)],[]):[]}async _collectExpressionInfoFields(e,i,r){r&&await Promise.all(r.map(n=>Xc(e,i,n.expression)))}_getFieldInfoFields(e){return e?e.filter(i=>i.visible===void 0||!!i.visible).map(i=>i.fieldName).filter(i=>!i.startsWith(d3)&&!i.startsWith(Qhe)):[]}_getActionsFields(e){return e?e.toArray().reduce((i,r)=>[...i,...this._getActionFields(r)],[]):[]}_getActionFields(e){const{className:i,title:r,type:n}=e,s=n==="button"||n==="toggle"?e.image:"";return[...this._extractFieldNames(r),...this._extractFieldNames(i),...this._extractFieldNames(s)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){if(!e||typeof e!="string")return[];const i=/{[^}]*}/g,r=e.match(i);if(!r)return[];const n=/\{(\w+):.+\}/,s=r.filter(o=>!(o.indexOf(`{${d3}`)===0||o.indexOf(`{${Qhe}`)===0)).map(o=>o.replace(n,"{$1}"));return s?s.map(o=>o.slice(1,-1)):[]}};u([d({type:sqe})],Zo.prototype,"actions",void 0),u([d()],Zo.prototype,"content",void 0),u([ri("content")],Zo.prototype,"castContent",null),u([Oe("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],Zo.prototype,"readContent",null),u([Ne("content",{popupElements:{type:tt.ofType(eqe)},showAttachments:{type:Boolean},mediaInfos:{type:tt.ofType(jEe)},description:{type:String},relatedRecordsInfo:{type:iqe}})],Zo.prototype,"writeContent",null),u([d({type:[GEe],json:{write:!0}})],Zo.prototype,"expressionInfos",void 0),u([d({type:[_N]})],Zo.prototype,"fieldInfos",void 0),u([Ne("fieldInfos")],Zo.prototype,"writeFieldInfos",null),u([d({type:tqe})],Zo.prototype,"layerOptions",void 0),u([Ne("layerOptions")],Zo.prototype,"writeLayerOptions",null),u([d({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],Zo.prototype,"lastEditInfoEnabled",void 0),u([d()],Zo.prototype,"outFields",void 0),u([d()],Zo.prototype,"overwriteActions",void 0),u([d()],Zo.prototype,"returnGeometry",void 0),u([d({json:{type:String}})],Zo.prototype,"title",void 0),u([Ne("title")],Zo.prototype,"writeTitle",null),Zo=u([$("esri.PopupTemplate")],Zo);const vN=Zo,iV={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function WEe(t){return iV[t]||iV[t.toLowerCase()]}function Sne(t){return iV[t]??iV[t.toLowerCase()]}function lqe(t){return[...Sne(t)]}function zj(t,e,i){i<0&&++i,i>1&&--i;const r=6*i;return r<1?t+(e-t)*r:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}function XEe(t,e,i,r=1){const n=(t%360+360)%360/360,s=i<=.5?i*(e+1):i+e-i*e,o=2*i-s;return[Math.round(255*zj(o,s,n+1/3)),Math.round(255*zj(o,s,n)),Math.round(255*zj(o,s,n-1/3)),r]}function cqe(t){const e=t.length>5,i=e?8:4,r=(1<<i)-1,n=e?1:17,s=e?t.length===9:t.length===5;let o=Number("0x"+t.substr(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return s&&(l=o&r,o>>=i,a[3]=n*l/255),l=o&r,o>>=i,a[2]=n*l,l=o&r,o>>=i,a[1]=n*l,l=o&r,o>>=i,a[0]=n*l,a}function P(){return[0,0,0]}function In(t){return[t[0],t[1],t[2]]}function Ue(t,e,i){return[t,e,i]}function Fc(t){const e=P(),i=Math.min(3,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function Ene(t,e){return new Float64Array(t,e,3)}function YEe(){return P()}function ZEe(){return Ue(1,1,1)}function JEe(){return Ue(1,0,0)}function KEe(){return Ue(0,1,0)}function Cne(){return Ue(0,0,1)}const dl=YEe(),Vg=ZEe(),uqe=JEe(),hqe=KEe(),QEe=Cne();Object.freeze(Object.defineProperty({__proto__:null,ONES:Vg,UNIT_X:uqe,UNIT_Y:hqe,UNIT_Z:QEe,ZEROS:dl,clone:In,create:P,createView:Ene,fromArray:Fc,fromValues:Ue,ones:ZEe,unitX:JEe,unitY:KEe,unitZ:Cne,zeros:YEe},Symbol.toStringTag,{value:"Module"}));let Ane=1e-6;function bl(){return Ane}function dqe(t){Ane=t}const bN=Math.random,pqe=Math.PI/180,fqe=180/Math.PI;function wN(t){return t*pqe}function mqe(t){return t*fqe}function gqe(t,e){return Math.abs(t-e)<=Ane*Math.max(1,Math.abs(t),Math.abs(e))}Object.freeze(Object.defineProperty({__proto__:null,RANDOM:bN,equals:gqe,getEpsilon:bl,setEpsilon:dqe,toDegree:mqe,toRadian:wN},Symbol.toStringTag,{value:"Module"}));function Pe(t){const e=t[0],i=t[1],r=t[2];return Math.sqrt(e*e+i*i+r*r)}function ce(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function he(t,e,i,r){return t[0]=e,t[1]=i,t[2]=r,t}function me(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function ge(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function B9(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function rV(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t}function yqe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function eCe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function tZ(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t}function tCe(t,e){return t[0]=Math.sign(e[0]),t[1]=Math.sign(e[1]),t[2]=Math.sign(e[2]),t}function iCe(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t}function _qe(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t}function vqe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function le(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function gS(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t}function Lr(t,e){const i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(i*i+r*r+n*n)}function ba(t,e){const i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return i*i+r*r+n*n}function al(t){const e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r}function pl(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function bqe(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function we(t,e){const i=e[0],r=e[1],n=e[2];let s=i*i+r*r+n*n;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s),t}function be(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function vt(t,e,i){const r=e[0],n=e[1],s=e[2],o=i[0],a=i[1],l=i[2];return t[0]=n*l-s*a,t[1]=s*o-r*l,t[2]=r*a-n*o,t}function ys(t,e,i,r){const n=e[0],s=e[1],o=e[2];return t[0]=n+r*(i[0]-n),t[1]=s+r*(i[1]-s),t[2]=o+r*(i[2]-o),t}function wqe(t,e,i,r,n,s){const o=s*s,a=o*(2*s-3)+1,l=o*(s-2)+s,c=o*(s-1),h=o*(3-2*s);return t[0]=e[0]*a+i[0]*l+r[0]*c+n[0]*h,t[1]=e[1]*a+i[1]*l+r[1]*c+n[1]*h,t[2]=e[2]*a+i[2]*l+r[2]*c+n[2]*h,t}function xqe(t,e,i,r,n,s){const o=1-s,a=o*o,l=s*s,c=a*o,h=3*s*a,p=3*l*o,f=l*s;return t[0]=e[0]*c+i[0]*h+r[0]*p+n[0]*f,t[1]=e[1]*c+i[1]*h+r[1]*p+n[1]*f,t[2]=e[2]*c+i[2]*h+r[2]*p+n[2]*f,t}function Tqe(t,e){e=e||1;const i=bN,r=2*i()*Math.PI,n=2*i()-1,s=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(r)*s,t[1]=Math.sin(r)*s,t[2]=n*e,t}function Ke(t,e,i){const r=e[0],n=e[1],s=e[2];return t[0]=i[0]*r+i[4]*n+i[8]*s+i[12],t[1]=i[1]*r+i[5]*n+i[9]*s+i[13],t[2]=i[2]*r+i[6]*n+i[10]*s+i[14],t}function Wl(t,e,i){const r=e[0],n=e[1],s=e[2];return t[0]=r*i[0]+n*i[3]+s*i[6],t[1]=r*i[1]+n*i[4]+s*i[7],t[2]=r*i[2]+n*i[5]+s*i[8],t}function om(t,e,i){const r=i[0],n=i[1],s=i[2],o=i[3],a=e[0],l=e[1],c=e[2];let h=n*c-s*l,p=s*a-r*c,f=r*l-n*a,m=n*f-s*p,g=s*h-r*f,_=r*p-n*h;const b=2*o;return h*=b,p*=b,f*=b,m*=2,g*=2,_*=2,t[0]=a+h+m,t[1]=l+p+g,t[2]=c+f+_,t}function Sqe(t,e,i,r){const n=[],s=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],s[0]=n[0],s[1]=n[1]*Math.cos(r)-n[2]*Math.sin(r),s[2]=n[1]*Math.sin(r)+n[2]*Math.cos(r),t[0]=s[0]+i[0],t[1]=s[1]+i[1],t[2]=s[2]+i[2],t}function Eqe(t,e,i,r){const n=[],s=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],s[0]=n[2]*Math.sin(r)+n[0]*Math.cos(r),s[1]=n[1],s[2]=n[2]*Math.cos(r)-n[0]*Math.sin(r),t[0]=s[0]+i[0],t[1]=s[1]+i[1],t[2]=s[2]+i[2],t}function Cqe(t,e,i,r){const n=[],s=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],s[0]=n[0]*Math.cos(r)-n[1]*Math.sin(r),s[1]=n[0]*Math.sin(r)+n[1]*Math.cos(r),s[2]=n[2],t[0]=s[0]+i[0],t[1]=s[1]+i[1],t[2]=s[2]+i[2],t}function rCe(t,e){ce(NF,t),ce(FF,e),we(NF,NF),we(FF,FF);const i=be(NF,FF);return i>1?0:i<-1?Math.PI:Math.acos(i)}const NF=P(),FF=P();function Aqe(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function Xl(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Qb(t,e){if(t===e)return!0;const i=t[0],r=t[1],n=t[2],s=e[0],o=e[1],a=e[2],l=bl();return Math.abs(i-s)<=l*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-o)<=l*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-a)<=l*Math.max(1,Math.abs(n),Math.abs(a))}function V_(t,e,i){const r=i[0]-e[0],n=i[1]-e[1],s=i[2]-e[2];let o=r*r+n*n+s*s;return o>0?(o=1/Math.sqrt(o),t[0]=r*o,t[1]=n*o,t[2]=s*o,t):(t[0]=0,t[1]=0,t[2]=0,t)}const Fo=ge,Rqe=B9,Mqe=rV,xN=Lr,Rne=ba,Ru=Pe,iZ=al,ede=Object.freeze(Object.defineProperty({__proto__:null,abs:tZ,add:me,angle:rCe,bezier:xqe,ceil:yqe,copy:ce,cross:vt,direction:V_,dist:xN,distance:Lr,div:Mqe,divide:rV,dot:be,equals:Qb,exactEquals:Xl,floor:eCe,hermite:wqe,inverse:bqe,len:Ru,length:Pe,lerp:ys,max:_qe,min:iCe,mul:Rqe,multiply:B9,negate:pl,normalize:we,random:Tqe,rotateX:Sqe,rotateY:Eqe,rotateZ:Cqe,round:vqe,scale:le,scaleAndAdd:gS,set:he,sign:tCe,sqrDist:Rne,sqrLen:iZ,squaredDistance:ba,squaredLength:al,str:Aqe,sub:Fo,subtract:ge,transformMat3:Wl,transformMat4:Ke,transformQuat:om},Symbol.toStringTag,{value:"Module"}));function Xf(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function cr(t,e,i,r,n){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t}function Mne(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t}function nCe(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function sCe(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t}function oCe(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t}function Oqe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function Pqe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function Iqe(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t}function $qe(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t}function Lqe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function gO(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function Dqe(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t}function aCe(t,e){const i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2],s=e[3]-t[3];return Math.sqrt(i*i+r*r+n*n+s*s)}function nV(t,e){const i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2],s=e[3]-t[3];return i*i+r*r+n*n+s*s}function One(t){const e=t[0],i=t[1],r=t[2],n=t[3];return Math.sqrt(e*e+i*i+r*r+n*n)}function Pne(t){const e=t[0],i=t[1],r=t[2],n=t[3];return e*e+i*i+r*r+n*n}function Nqe(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function Fqe(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function lCe(t,e){const i=e[0],r=e[1],n=e[2],s=e[3];let o=i*i+r*r+n*n+s*s;return o>0&&(o=1/Math.sqrt(o),t[0]=i*o,t[1]=r*o,t[2]=n*o,t[3]=s*o),t}function cCe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function j9(t,e,i,r){const n=e[0],s=e[1],o=e[2],a=e[3];return t[0]=n+r*(i[0]-n),t[1]=s+r*(i[1]-s),t[2]=o+r*(i[2]-o),t[3]=a+r*(i[3]-a),t}function kqe(t,e){const i=bN;let r,n,s,o,a,l;e=e||1;do r=2*i()-1,n=2*i()-1,a=r*r+n*n;while(a>=1);do s=2*i()-1,o=2*i()-1,l=s*s+o*o;while(l>=1);const c=Math.sqrt((1-a)/l);return t[0]=e*r,t[1]=e*n,t[2]=e*s*c,t[3]=e*o*c,t}function Jh(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3];return t[0]=i[0]*r+i[4]*n+i[8]*s+i[12]*o,t[1]=i[1]*r+i[5]*n+i[9]*s+i[13]*o,t[2]=i[2]*r+i[6]*n+i[10]*s+i[14]*o,t[3]=i[3]*r+i[7]*n+i[11]*s+i[15]*o,t}function Uqe(t,e,i){const r=e[0],n=e[1],s=e[2],o=i[0],a=i[1],l=i[2],c=i[3],h=c*r+a*s-l*n,p=c*n+l*r-o*s,f=c*s+o*n-a*r,m=-o*r-a*n-l*s;return t[0]=h*c+m*-o+p*-l-f*-a,t[1]=p*c+m*-a+f*-o-h*-l,t[2]=f*c+m*-l+h*-a-p*-o,t[3]=e[3],t}function Vqe(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function RR(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Ine(t,e){const i=t[0],r=t[1],n=t[2],s=t[3],o=e[0],a=e[1],l=e[2],c=e[3],h=bl();return Math.abs(i-o)<=h*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=h*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-l)<=h*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-c)<=h*Math.max(1,Math.abs(s),Math.abs(c))}const zqe=nCe,Bqe=sCe,jqe=oCe,Gqe=aCe,Hqe=nV,qqe=One,Wqe=Pne,uCe=Object.freeze(Object.defineProperty({__proto__:null,add:Mne,ceil:Oqe,copy:Xf,dist:Gqe,distance:aCe,div:jqe,divide:oCe,dot:cCe,equals:Ine,exactEquals:RR,floor:Pqe,inverse:Fqe,len:qqe,length:One,lerp:j9,max:$qe,min:Iqe,mul:Bqe,multiply:sCe,negate:Nqe,normalize:lCe,random:kqe,round:Lqe,scale:gO,scaleAndAdd:Dqe,set:cr,sqrDist:Hqe,sqrLen:Wqe,squaredDistance:nV,squaredLength:Pne,str:Vqe,sub:zqe,subtract:nCe,transformMat4:Jh,transformQuat:Uqe},Symbol.toStringTag,{value:"Module"})),tde=new Float32Array(1);function vM(t){--t;for(let e=1;e<32;e<<=1)t|=t>>e;return t+1}function _e(t,e,i){return Math.min(Math.max(t,e),i)}function mm(t){return(t&t-1)==0}function MVt(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function OVt(t){return 10**Math.ceil(Math.LOG10E*Math.log(t))}function Bt(t,e,i){return t+(e-t)*i}function Xt(t){return t*Math.PI/180}function ml(t){return 180*t/Math.PI}function Bj(t,e=1e-6){return(t<0?-1:1)/Math.max(Math.abs(t),e)}function eo(t){return Math.acos(_e(t,-1,1))}function Pp(t){return Math.asin(_e(t,-1,1))}function MR(t,e,i=1e-6){return t===e?!0:!Number.isFinite(t)||!Number.isFinite(e)?!1:(t>e?t-e:e-t)<=i}const sV=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT));function Xqe(t){return sV.setFloat64(0,t),sV.getBigInt64(0)}function Yqe(t){return sV.setBigInt64(0,t),sV.getFloat64(0)}const jj=BigInt("1000000");Zqe(1);function Zqe(t){const e=Xqe(t=Math.abs(t)),i=Yqe(e<=jj?jj:e-jj);return Math.abs(t-i)}function Jqe(t,e,i=1e-6){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;const r=Math.abs(t-e),n=Math.abs(t),s=Math.abs(e);if(t===0||e===0||n<1e-12&&s<1e-12){if(r>.01*i)return!1}else if(r/(n+s)>i)return!1;return!0}function Kqe(t){return hCe(Math.max(-rZ,Math.min(t,rZ)))}function hCe(t){return tde[0]=t,tde[0]}function bM(t,e,i){const r=_e((i-t)/(e-t),0,1);return r*r*(3-2*r)}function ide(t,e){const i=Pe(t),r=Pp(t[2]/i),n=Math.atan2(t[1]/i,t[0]/i);return he(e,i,r,n),e}function PVt(t,e,i){return cr(t,e[0],e[1],e[2],e[3]*i)}function IVt(t){const e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[3]*t[3]+t[4]*t[4]+t[5]*t[5],r=t[6]*t[6]+t[7]*t[7]+t[8]*t[8];return!(MR(e,1)&&MR(i,1)&&MR(r,1))}const rZ=hCe(34028234663852886e22);function kF(t){return _e(Wre(t),0,255)}function UF(t,e,i){return t=Number(t),isNaN(t)?i:t<e?e:t>i?i:t}let v6=class el{static blendColors(e,i,r,n=new el){return n.r=Math.round(e.r+(i.r-e.r)*r),n.g=Math.round(e.g+(i.g-e.g)*r),n.b=Math.round(e.b+(i.b-e.b)*r),n.a=e.a+(i.a-e.a)*r,n._sanitize()}static fromRgb(e,i){const r=e.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(r){const n=r[2].split(/\s*,\s*/),s=r[1];if(s==="rgb"&&n.length===3||s==="rgba"&&n.length===4){const o=n[0];if(o.charAt(o.length-1)==="%"){const a=n.map(l=>2.56*parseFloat(l));return n.length===4&&(a[3]=parseFloat(n[3])),el.fromArray(a,i)}return el.fromArray(n.map(a=>parseFloat(a)),i)}if(s==="hsl"&&n.length===3||s==="hsla"&&n.length===4)return el.fromArray(XEe(parseFloat(n[0]),parseFloat(n[1])/100,parseFloat(n[2])/100,parseFloat(n[3])),i)}return null}static fromHex(e,i=new el){if(e.length!==4&&e.length!==7||e[0]!=="#")return null;const r=e.length===4?4:8,n=(1<<r)-1;let s=Number("0x"+e.substr(1));return isNaN(s)?null:(["b","g","r"].forEach(o=>{const a=s&n;s>>=r,i[o]=r===4?17*a:a}),i.a=1,i)}static fromArray(e,i=new el){return i._set(Number(e[0]),Number(e[1]),Number(e[2]),Number(e[3])),isNaN(i.a)&&(i.a=1),i._sanitize()}static fromString(e,i){const r=WEe(e)?Sne(e):null;return r&&el.fromArray(r,i)||el.fromRgb(e,i)||el.fromHex(e,i)}static fromJSON(e){return e&&new el([e[0],e[1],e[2],e[3]/255])}static toUnitRGB(e){return v(e)?[e.r/255,e.g/255,e.b/255]:null}static toUnitRGBA(e){return v(e)?[e.r/255,e.g/255,e.b/255,e.a!=null?e.a:1]:null}constructor(e){this.r=255,this.g=255,this.b=255,this.a=1,e&&this.setColor(e)}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(e){return typeof e=="string"?el.fromString(e,this):Array.isArray(e)?el.fromArray(e,this):(this._set(e.r??0,e.g??0,e.b??0,e.a??1),e instanceof el||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(){const e=this.r.toString(16),i=this.g.toString(16),r=this.b.toString(16);return`#${e.length<2?"0"+e:e}${i.length<2?"0"+i:i}${r.length<2?"0"+r:r}`}toCss(e=!1){const i=this.r+", "+this.g+", "+this.b;return e?`rgba(${i}, ${this.a})`:`rgb(${i})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(e=el.AlphaMode.ALWAYS){const i=kF(this.r),r=kF(this.g),n=kF(this.b);return e===el.AlphaMode.ALWAYS||this.a!==1?[i,r,n,kF(255*this.a)]:[i,r,n]}clone(){return new el(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(e){return v(e)&&e.r===this.r&&e.g===this.g&&e.b===this.b&&e.a===this.a}_sanitize(){return this.r=Math.round(UF(this.r,0,255)),this.g=Math.round(UF(this.g,0,255)),this.b=Math.round(UF(this.b,0,255)),this.a=UF(this.a,0,1),this}_set(e,i,r,n){this.r=e,this.g=i,this.b=r,this.a=n}};v6.prototype.declaredClass="esri.Color",function(t){var e;(e=t.AlphaMode||(t.AlphaMode={}))[e.ALWAYS=0]="ALWAYS",e[e.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(v6||(v6={}));const Xe=v6,rde=new mi({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let Qqe=0,SC=class extends fe{constructor(e){super(e),this.id="sym"+Qqe++,this.type=null,this.color=new Xe([0,0,0,1])}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,i){}hash(){return JSON.stringify(this.toJSON())}clone(){}};u([d({type:rde.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:rde.write}}})],SC.prototype,"type",void 0),u([d({type:Xe,json:{write:{allowNull:!0}}})],SC.prototype,"color",void 0),u([Oe("color")],SC.prototype,"readColor",null),SC=u([$("esri.symbols.Symbol")],SC);const rh=SC;var nZ;let Qv=nZ=class extends rh{constructor(t){super(t),this.data=null,this.type="cim"}readData(t,e){return e}writeData(t,e){if(t)for(const i in t)e[i]=t[i]}async collectRequiredFields(t,e){var i;if(((i=this.data)==null?void 0:i.type)==="CIMSymbolReference"){const r=this.data.primitiveOverrides;if(r){const n=r.map(s=>{const o=s.valueExpressionInfo;return Xc(t,e,o.expression)});await Promise.all(n)}}}clone(){return new nZ({data:se(this.data)})}hash(){return Hre(JSON.stringify(this.data)).toString()}};u([d({json:{write:!1}})],Qv.prototype,"color",void 0),u([d({json:{write:!0}})],Qv.prototype,"data",void 0),u([Oe("data",["symbol"])],Qv.prototype,"readData",null),u([Ne("data",{})],Qv.prototype,"writeData",null),u([ot({CIMSymbolReference:"cim"},{readOnly:!0})],Qv.prototype,"type",void 0),Qv=nZ=u([$("esri.symbols.CIMSymbol")],Qv);const yO=Qv;let EC=class extends fe{constructor(e){super(e),this.enabled=!0,this.type=null}writeEnabled(e,i,r){e||(i[r]=e)}};u([d({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],EC.prototype,"enabled",void 0),u([Ne("enabled")],EC.prototype,"writeEnabled",null),u([d({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],EC.prototype,"type",void 0),EC=u([$("esri.symbols.Symbol3DLayer")],EC);const Ty=EC,eWe=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,tWe="screenUtils.toPt: input not recognized!",dCe=96;function ga(t){return t?t/72*dCe:0}function Ip(t){return t?72*t/dCe:0}function vr(t){if(typeof t=="string"){const e=t.match(eWe);if(e){const i=Number(e[1]),r=e[3]&&e[3].toLowerCase(),n=t.charAt(0)==="-",s=r==="px"?Ip(i):i;return n?-s:s}return console.warn(tWe),null}return t}function Ws(t=0,e=0){return{x:t,y:e}}function Sn(t=0,e=0){return[t,e]}function pCe(t=0,e=0){return[t,e]}function ka(t=0,e=0,i=0){return[t,e,i]}function DVt(t){return t}function NVt(t){return t}function FVt(t){return t}function Dg(t,e){return e?(e[0]=t.x,e[1]=t.y,e.length>2&&(e[2]=0),e):[t.x,t.y]}function G9(t){const e=Wre(100*(1-t));return Math.max(0,Math.min(e,100))}function YL(t){const e=1-t/100;return Math.max(0,Math.min(e,1))}function iWe(t,e){const i=e.transparency!=null?YL(e.transparency):1,r=e.color;return r&&Array.isArray(r)?new Xe([r[0]||0,r[1]||0,r[2]||0,i]):null}function rWe(t,e){e.color=t.toJSON().slice(0,3);const i=G9(t.a);i!==0&&(e.transparency=i)}const z_={type:Xe,json:{type:[Kr],default:null,read:{source:["color","transparency"],reader:iWe},write:{target:{color:{type:[Kr]},transparency:{type:Kr}},writer:rWe}}},dy={type:Number,cast:vr,json:{write:!0}};let Wx=class extends fe{constructor(e){super(e),this.color=new Xe([0,0,0,1]),this.extensionLength=0,this.size=Ip(1)}clone(){}cloneProperties(){return{color:se(this.color),size:this.size,extensionLength:this.extensionLength}}};u([d({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],Wx.prototype,"type",void 0),u([d(z_)],Wx.prototype,"color",void 0),u([d({...dy,json:{write:{overridePolicy:t=>({enabled:!!t})}}})],Wx.prototype,"extensionLength",void 0),u([d(dy)],Wx.prototype,"size",void 0),Wx=u([$("esri.symbols.edges.Edges3D")],Wx);const $ne=Wx;var sZ;let b6=sZ=class extends $ne{constructor(t){super(t),this.type="sketch"}clone(){return new sZ(this.cloneProperties())}};u([ot({sketch:"sketch"},{readOnly:!0})],b6.prototype,"type",void 0),b6=sZ=u([$("esri.symbols.edges.SketchEdges3D")],b6);const nWe=b6;var oZ;let w6=oZ=class extends $ne{constructor(t){super(t),this.type="solid"}clone(){return new oZ(this.cloneProperties())}};u([ot({solid:"solid"},{readOnly:!0})],w6.prototype,"type",void 0),w6=oZ=u([$("esri.symbols.support.SolidEdges3D")],w6);const sWe=w6,fCe={types:{key:"type",base:$ne,typeMap:{solid:sWe,sketch:nWe}},json:{write:!0}};var aZ;let td=aZ=class extends fe{constructor(t){super(t),this.color=null}clone(){const t={color:v(this.color)?this.color.clone():null};return new aZ(t)}};u([d(z_)],td.prototype,"color",void 0),td=aZ=u([$("esri.symbols.support.Symbol3DMaterial")],td);var lZ;let e1=lZ=class extends Ty{constructor(t){super(t),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new lZ({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:v(this.material)?this.material.clone():null,castShadows:this.castShadows,size:this.size})}};u([ot({Extrude:"extrude"},{readOnly:!0})],e1.prototype,"type",void 0),u([d({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],e1.prototype,"size",void 0),u([d({type:td,json:{write:!0}})],e1.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],e1.prototype,"castShadows",void 0),u([d(fCe)],e1.prototype,"edges",void 0),e1=lZ=u([$("esri.symbols.ExtrudeSymbol3DLayer")],e1);const mCe=e1;let $P=class extends rh{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};u([ot({esriSLS:"simple-line"},{readOnly:!0})],$P.prototype,"type",void 0),u([d({type:Number,cast:vr,json:{write:!0}})],$P.prototype,"width",void 0),$P=u([$("esri.symbols.LineSymbol")],$P);const oWe=$P,aWe=["begin","end","begin-end"],gCe=["arrow","circle","square","diamond","cross","x"];var cZ;let ig=cZ=class extends fe{constructor(t){super(t),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(t,e,i,r){e[i]=(r==null?void 0:r.origin)==="web-map"?"arrow":t}set color(t){this._set("color",t)}readColor(t){return t&&t[0]!=null?[t[0],t[1],t[2],t[3]/255]:t}writeColor(t,e,i,r){(r==null?void 0:r.origin)==="web-map"||(e[i]=t)}clone(){return new cZ({color:se(this.color),placement:this.placement,style:this.style})}hash(){var t;return`${this.placement}.${(t=this.color)==null?void 0:t.hash()}.${this.style}`}};u([d({type:["begin","end","begin-end"],json:{write:!0}})],ig.prototype,"placement",void 0),u([ot({"line-marker":"line-marker"},{readOnly:!0}),d({json:{origins:{"web-map":{write:!1}}}})],ig.prototype,"type",void 0),u([d({type:gCe})],ig.prototype,"style",void 0),u([Ne("style")],ig.prototype,"writeStyle",null),u([d({type:Xe,value:null,json:{write:{allowNull:!0}}})],ig.prototype,"color",null),u([Oe("color")],ig.prototype,"readColor",null),u([Ne("color")],ig.prototype,"writeColor",null),ig=cZ=u([$("esri.symbols.LineSymbolMarker")],ig);const lWe=ig;var uZ;const Gj=new mi({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let r0=uZ=class extends oWe{constructor(...t){super(...t),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(t,e,i,r,n,s){if(t&&typeof t!="string")return t;const o={};return t!=null&&(o.style=t),e!=null&&(o.color=e),i!=null&&(o.width=vr(i)),r!=null&&(o.cap=r),n!=null&&(o.join=n),s!=null&&(o.miterLimit=vr(s)),o}clone(){var t;return new uZ({color:se(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:(t=this.marker)==null?void 0:t.clone()})}hash(){var t,e;return`${super.hash()}.${(t=this.color)==null?void 0:t.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${(e=this.marker)==null?void 0:e.hash()}`}};u([ot({esriSLS:"simple-line"},{readOnly:!0})],r0.prototype,"type",void 0),u([d({type:Gj.apiValues,json:{read:Gj.read,write:Gj.write}})],r0.prototype,"style",void 0),u([d({type:["butt","round","square"],json:{write:{overridePolicy:(t,e,i)=>({enabled:t!=="round"&&(i==null||i.origin==null)})}}})],r0.prototype,"cap",void 0),u([d({type:["miter","round","bevel"],json:{write:{overridePolicy:(t,e,i)=>({enabled:t!=="round"&&(i==null||i.origin==null)})}}})],r0.prototype,"join",void 0),u([d({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":lWe}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],r0.prototype,"marker",void 0),u([d({type:Number,json:{read:!1,write:!1}})],r0.prototype,"miterLimit",void 0),r0=uZ=u([$("esri.symbols.SimpleLineSymbol")],r0);const Vp=r0;let LP=class extends rh{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};u([d({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Vp}},json:{default:null,write:!0}})],LP.prototype,"outline",void 0),u([d({type:["simple-fill","picture-fill"],readOnly:!0})],LP.prototype,"type",void 0),LP=u([$("esri.symbols.FillSymbol")],LP);const yCe=LP;let x6=class extends fe{constructor(e){super(e)}clone(){}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],x6.prototype,"type",void 0),x6=u([$("esri.symbols.patterns.LinePattern3D")],x6);const _Ce=x6,cWe=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var hZ;const uWe=Wa()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let DP=hZ=class extends _Ce{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new hZ(t)}};u([d({type:["style"]})],DP.prototype,"type",void 0),u([ot(uWe),d({type:cWe})],DP.prototype,"style",void 0),DP=hZ=u([$("esri.symbols.patterns.LineStylePattern3D")],DP);const Lne=DP;let T6=class extends fe{constructor(e){super(e)}clone(){}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],T6.prototype,"type",void 0),T6=u([$("esri.symbols.patterns.Pattern3D")],T6);const vCe=T6,hWe=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var dZ;let NP=dZ=class extends vCe{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new dZ(t)}};u([d({type:["style"]})],NP.prototype,"type",void 0),u([d({type:hWe,json:{read:!0,write:!0}})],NP.prototype,"style",void 0),NP=dZ=u([$("esri.symbols.patterns.StylePattern3D")],NP);const bCe=NP,dWe={types:{key:"type",base:vCe,typeMap:{style:bCe}},json:{write:!0}},wCe={types:{key:"type",base:_Ce,typeMap:{style:Lne}},json:{write:!0}},S$=new Xe("white");new Xe("black");const pWe=new Xe([255,255,255,0]);function fWe(t){return t.r===0&&t.g===0&&t.b===0}var pZ;let E$=pZ=class extends td{constructor(t){super(t),this.colorMixMode=null}clone(){const t={color:v(this.color)?this.color.clone():null,colorMixMode:this.colorMixMode};return new pZ(t)}};u([ot({multiply:"multiply",replace:"replace",tint:"tint"})],E$.prototype,"colorMixMode",void 0),E$=pZ=u([$("esri.symbols.support.Symbol3DFillMaterial")],E$);function Kt(t=_We){return[t[0],t[1],t[2],t[3]]}function jVt(t){return[t[0],t[1],t[2],t[3]]}function A_(t,e){return t!==e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]),t}function Dne(t,e,i,r,n=Kt()){return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n}function ZL(t,e=Kt()){return e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax,e}function H9(t,e){return new ni({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}function Nne(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function kb(t,e,i){if(R(e))A_(i,t);else if("length"in e)yZ(e)?(i[0]=Math.min(t[0],e[0]),i[1]=Math.min(t[1],e[1]),i[2]=Math.max(t[2],e[2]),i[3]=Math.max(t[3],e[3])):e.length!==2&&e.length!==3||(i[0]=Math.min(t[0],e[0]),i[1]=Math.min(t[1],e[1]),i[2]=Math.max(t[2],e[0]),i[3]=Math.max(t[3],e[1]));else switch(e.type){case"extent":i[0]=Math.min(t[0],e.xmin),i[1]=Math.min(t[1],e.ymin),i[2]=Math.max(t[2],e.xmax),i[3]=Math.max(t[3],e.ymax);break;case"point":i[0]=Math.min(t[0],e.x),i[1]=Math.min(t[1],e.y),i[2]=Math.max(t[2],e.x),i[3]=Math.max(t[3],e.y)}}function Hj(t,e,i=t){const r=e.length;let n=t[0],s=t[1],o=t[2],a=t[3];for(let l=0;l<r;l++){const c=e[l];n=Math.min(n,c[0]),s=Math.min(s,c[1]),o=Math.max(o,c[0]),a=Math.max(a,c[1])}return i[0]=n,i[1]=s,i[2]=o,i[3]=a,i}function fZ(t){for(let e=0;e<4;e++)if(!isFinite(t[e]))return!1;return!0}function Wh(t){return R(t)||t[0]>=t[2]?0:t[2]-t[0]}function gm(t){return t[1]>=t[3]?0:t[3]-t[1]}function xCe(t){return Wh(t)*gm(t)}function Fne(t,e=[0,0]){return e[0]=(t[0]+t[2])/2,e[1]=(t[1]+t[3])/2,e}function TCe(t,e){return q9(t,e[0],e[1])}function nde(t,e){const i=e[3],r=.5*(t[0]+t[2]),n=Math.abs(e[0]-r),s=.5*(t[2]-t[0]);if(n>i+s)return!1;const o=.5*(t[1]+t[3]),a=.5*(t[3]-t[1]),l=Math.abs(e[1]-o);if(l>i+a)return!1;if(n<s||l<a)return!0;const c=n-s,h=l-a;return c*c+h*h<=i*i}function GVt(t,e,i){const r=t[0],n=t[1],s=t[2],o=t[3],{x:a,y:l}=e,{x:c,y:h}=i,p=(b,w)=>(h-l)*b+(a-c)*w+(c*l-a*h)<0,f=p(r,o),m=p(s,o),g=p(s,n),_=p(r,n);return!(f===m&&m===g&&g===_&&_===f||a<r&&c<r||a>s&&c>s||l>o&&h>o||l<n&&h<n)}function HVt(t,e){return q9(t,e.x,e.y)}function q9(t,e,i){return e>=t[0]&&i>=t[1]&&e<=t[2]&&i<=t[3]}function mWe(t,e,i){return e[0]>=t[0]-i&&e[1]>=t[1]-i&&e[0]<=t[2]+i&&e[1]<=t[3]+i}function W9(t,e){return Math.max(e[0],t[0])<=Math.min(e[2],t[2])&&Math.max(e[1],t[1])<=Math.min(e[3],t[3])}function mZ(t,e){return e[0]>=t[0]&&e[2]<=t[2]&&e[1]>=t[1]&&e[3]<=t[3]}function gZ(t,e,i){if(R(e))return A_(i,t);const r=e[0],n=e[1],s=e[2],o=e[3];return i[0]=_e(t[0],r,s),i[1]=_e(t[1],n,o),i[2]=_e(t[2],r,s),i[3]=_e(t[3],n,o),i}function gWe(t,e){const i=(t[0]+t[2])/2,r=(t[1]+t[3])/2,n=Math.max(Math.abs(e[0]-i)-Wh(t)/2,0),s=Math.max(Math.abs(e[1]-r)-gm(t)/2,0);return Math.sqrt(n*n+s*s)}function oV(t,e,i,r=t){return r[0]=t[0]+e,r[1]=t[1]+i,r[2]=t[2]+e,r[3]=t[3]+i,r}function od(t){return t?A_(t,_Z):Kt(_Z)}function yZ(t){return t!=null&&t.length===4}function yWe(t){return!(Wh(t)!==0&&isFinite(t[0])||gm(t)!==0&&isFinite(t[1]))}function $S(t,e){return yZ(t)&&yZ(e)?t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]:t===e}const qVt=[-1/0,-1/0,1/0,1/0],_Z=[1/0,1/0,-1/0,-1/0],_We=[0,0,0,0];function to(t=RCe){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function l2(t,e,i,r,n,s,o=to()){return o[0]=t,o[1]=e,o[2]=i,o[3]=r,o[4]=n,o[5]=s,o}function WVt(t,e){const i=isFinite(t[2])||isFinite(t[5]);return new ni(i?{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],zmin:t[2],zmax:t[5],spatialReference:e}:{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],spatialReference:e})}function wM(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[3]),t[4]=Math.max(t[4],e[4]),t[5]=Math.max(t[5],e[5])}function vWe(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[3]=Math.max(t[3],e[2]),t[4]=Math.max(t[4],e[3])}function py(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[0]),t[4]=Math.max(t[4],e[1]),t[5]=Math.max(t[5],e[2])}function Kh(t,e,i=0,r=e.length/3){let n=t[0],s=t[1],o=t[2],a=t[3],l=t[4],c=t[5];for(let h=0;h<r;h++)n=Math.min(n,e[i+3*h]),s=Math.min(s,e[i+3*h+1]),o=Math.min(o,e[i+3*h+2]),a=Math.max(a,e[i+3*h]),l=Math.max(l,e[i+3*h+1]),c=Math.max(c,e[i+3*h+2]);t[0]=n,t[1]=s,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function qj(t,e,i){const r=e.length;let n=t[0],s=t[1],o=t[2],a=t[3],l=t[4],c=t[5];if(i)for(let h=0;h<r;h++){const p=e[h];n=Math.min(n,p[0]),s=Math.min(s,p[1]),o=Math.min(o,p[2]),a=Math.max(a,p[0]),l=Math.max(l,p[1]),c=Math.max(c,p[2])}else for(let h=0;h<r;h++){const p=e[h];n=Math.min(n,p[0]),s=Math.min(s,p[1]),a=Math.max(a,p[0]),l=Math.max(l,p[1])}t[0]=n,t[1]=s,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function bWe(t){for(let e=0;e<6;e++)if(!isFinite(t[e]))return!1;return!0}function B2(t){return t[0]>=t[3]?0:t[3]-t[0]}function j2(t){return t[1]>=t[4]?0:t[4]-t[1]}function Lw(t){return t[2]>=t[5]?0:t[5]-t[2]}function SCe(t){const e=B2(t),i=Lw(t),r=j2(t);return Math.sqrt(e*e+i*i+r*r)}function Yf(t,e=[0,0,0]){return e[0]=t[0]+B2(t)/2,e[1]=t[1]+j2(t)/2,e[2]=t[2]+Lw(t)/2,e}function VF(t,e=[0,0,0]){return e[0]=B2(t),e[1]=j2(t),e[2]=Lw(t),e}function kne(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[0]<=t[3]&&e[1]<=t[4]&&e[2]<=t[5]}function XVt(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[3]<=t[3]&&e[4]<=t[4]&&e[5]<=t[5]}function wWe(t,e){return Math.max(e[0],t[0])<=Math.min(e[3],t[3])&&Math.max(e[1],t[1])<=Math.min(e[4],t[4])&&Math.max(e[2],t[2])<=Math.min(e[5],t[5])}function Zf(t,e){return!!R(e)||wWe(t,e)}function ECe(t,e,i,r,n=t){return n[0]=t[0]+e,n[1]=t[1]+i,n[2]=t[2]+r,n[3]=t[3]+e,n[4]=t[4]+i,n[5]=t[5]+r,n}function YVt(t,e,i=t){const r=t[0]+B2(t)/2,n=t[1]+j2(t)/2,s=t[2]+Lw(t)/2;return i[0]=r+(t[0]-r)*e,i[1]=n+(t[1]-n)*e,i[2]=s+(t[2]-s)*e,i[3]=r+(t[3]-r)*e,i[4]=n+(t[4]-n)*e,i[5]=s+(t[5]-s)*e,i}function CCe(t,e,i=t){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i!==t&&(i[3]=t[3],i[4]=t[4],i[5]=t[5]),i}function ACe(t,e,i=t){return i[3]=e[0],i[4]=e[1],i[5]=e[2],i!==t&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),t}function X9(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Br(t){return t?X9(t,sde):to(sde)}function Une(t,e){return e||(e=Kt()),e[0]=t[0],e[1]=t[1],e[2]=t[3],e[3]=t[4],e}function ZVt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=Number.NEGATIVE_INFINITY,t[3]=e[2],t[4]=e[3],t[5]=Number.POSITIVE_INFINITY,t}function xWe(t,e,i,r,n){return t[0]=e,t[1]=i,t[2]=Number.NEGATIVE_INFINITY,t[3]=r,t[4]=n,t[5]=Number.POSITIVE_INFINITY,t}function vZ(t){return t.length===6}function Vne(t){return B2(t)===0&&j2(t)===0&&Lw(t)===0}function JVt(t,e,i){if(R(t)||R(e))return t===e;if(!vZ(t)||!vZ(e))return!1;if(i){for(let r=0;r<t.length;r++)if(!i(t[r],e[r]))return!1}else for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function TWe(t,e,i,r,n,s){return l2(t,e,i,r,n,s,SWe)}const KVt=[-1/0,-1/0,-1/0,1/0,1/0,1/0],sde=[1/0,1/0,1/0,-1/0,-1/0,-1/0],RCe=[0,0,0,0,0,0],SWe=to();function Wj(t,{isPrimitive:e,width:i,depth:r,height:n}){const s=e?10:1;if(i==null&&n==null&&r==null)return[s*t[0],s*t[1],s*t[2]];const o=Ue(i,r,n);let a;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/t[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=t[l]*a);return o}const EWe=l2(-.5,-.5,-.5,.5,.5,.5),CWe=l2(-.5,-.5,0,.5,.5,1),AWe=l2(-.5,-.5,0,.5,.5,.5);function RWe(t){switch(t){case"sphere":case"cube":case"diamond":return EWe;case"cylinder":case"cone":case"inverted-cone":return CWe;case"tetrahedron":return AWe;default:return}}const zne=["butt","square","round"],MWe=[...zne,"none"],MCe=["miter","bevel","round"];var bZ;let Xx=bZ=class extends fe{constructor(t){super(t),this.color=new Xe([0,0,0,1]),this.size=Ip(1),this.pattern=null,this.patternCap="butt"}clone(){const t={color:v(this.color)?this.color.clone():null,size:this.size,pattern:v(this.pattern)?this.pattern.clone():null,patternCap:this.patternCap};return new bZ(t)}};u([d(z_)],Xx.prototype,"color",void 0),u([d(dy)],Xx.prototype,"size",void 0),u([d(wCe)],Xx.prototype,"pattern",void 0),u([d({type:zne,json:{default:"butt",write:{overridePolicy(){return{enabled:v(this.pattern)}}}}})],Xx.prototype,"patternCap",void 0),Xx=bZ=u([$("esri.symbols.support.Symbol3DOutline")],Xx);var S6;let n0=S6=class extends Ty{constructor(t){super(t),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const t={edges:v(this.edges)?this.edges.clone():null,enabled:this.enabled,material:v(this.material)?this.material.clone():null,pattern:v(this.pattern)?this.pattern.clone():null,castShadows:this.castShadows,outline:v(this.outline)?this.outline.clone():null};return new S6(t)}static fromSimpleFillSymbol(t){var r,n,s;const e=t.outline&&t.outline.style&&t.outline.style!=="inside-frame"&&t.outline.style!=="solid"?new Lne({style:t.outline.style}):null,i={size:((r=t.outline)==null?void 0:r.width)??0,color:(((n=t.outline)==null?void 0:n.color)??S$).clone(),pattern:e};return e&&((s=t.outline)!=null&&s.cap)&&(i.patternCap=t.outline.cap),new S6({material:new E$({color:(t.color??pWe).clone()}),pattern:t.style&&t.style!=="solid"?new bCe({style:t.style}):null,outline:i})}};u([ot({Fill:"fill"},{readOnly:!0})],n0.prototype,"type",void 0),u([d({type:E$,json:{write:!0}})],n0.prototype,"material",void 0),u([d(dWe)],n0.prototype,"pattern",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],n0.prototype,"castShadows",void 0),u([d({type:Xx,json:{write:!0}})],n0.prototype,"outline",void 0),u([d(fCe)],n0.prototype,"edges",void 0),n0=S6=u([$("esri.symbols.FillSymbol3DLayer")],n0);const TN=n0,OWe=["none","underline","line-through"],PWe=["normal","italic","oblique"],IWe=["normal","lighter","bold","bolder"],OCe={type:Number,cast:t=>{const e=ip(t);return e===0?1:_e(e,.1,4)},nonNullable:!0},$We=["left","right","center"],LWe=["baseline","top","middle","bottom"],PCe={type:$We,nonNullable:!0},ICe={type:LWe,nonNullable:!0};var wZ;let s0=wZ=class extends fe{constructor(t){super(t),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(t){return vr(t)}clone(){return new wZ({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};u([d({type:OWe,json:{default:"none",write:!0}})],s0.prototype,"decoration",void 0),u([d({type:String,json:{write:!0}})],s0.prototype,"family",void 0),u([d({type:Number,json:{write:{overridePolicy:(t,e,i)=>({enabled:!i||!i.textSymbol3D})}}})],s0.prototype,"size",void 0),u([ri("size")],s0.prototype,"castSize",null),u([d({type:PWe,json:{default:"normal",write:!0}})],s0.prototype,"style",void 0),u([d({type:IWe,json:{default:"normal",write:!0}})],s0.prototype,"weight",void 0),s0=wZ=u([$("esri.symbols.Font")],s0);const Y9=s0,DWe=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,NWe={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function aV(t){const e=t==null?void 0:t.match(DWe);if(!e)return null;const[,i,r,n]=e;if(!i)return null;let s=null,o=null,a=null;const{devext:l,qaext:c,www:h}=NWe;if(r)if(s=i,n)switch(n.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qa":({customBaseUrl:o,portalHostname:a}=c);break;default:return null}else({customBaseUrl:o,portalHostname:a}=h);else switch(i.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qaext":({customBaseUrl:o,portalHostname:a}=c);break;case"www":({customBaseUrl:o,portalHostname:a}=h);break;default:return null}return{customBaseUrl:o,isPortal:!1,portalHostname:a,urlKey:s}}function FWe(t){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(t)}const kWe=re.getLogger("esri.core.urlUtils"),_O=nr.request,ode="esri/config: esriConfig.request.proxyUrl is not set.",$Ce=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,LCe=/^\s*http:/i,UWe=/^\s*https:/i,VWe=/^\s*file:/i,zWe=/:\d+$/,BWe=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,jWe=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),GWe=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");let Ub=class{constructor(e=""){this.uri=e,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let i=this.uri.match(jWe);this.scheme=i[2]||(i[1]?"":null),this.authority=i[4]||(i[3]?"":null),this.path=i[5],this.query=i[7]||(i[6]?"":null),this.fragment=i[9]||(i[8]?"":null),this.authority!=null&&(i=this.authority.match(GWe),this.user=i[3]||null,this.password=i[4]||null,this.host=i[6]||i[7],this.port=i[9]||null)}toString(){return this.uri}};const zF={},HWe=new Ub(nr.applicationUrl);let Gl=HWe;const qWe=WWe();let Bne=qWe;const jne=()=>Gl,ezt=()=>Bne;function WWe(){const t=Gl.path,e=t.substring(0,t.lastIndexOf(t.split("/")[t.split("/").length-1]));return`${`${Gl.scheme}://${Gl.host}${Gl.port!=null?`:${Gl.port}`:""}`}${e}`}function Bo(t){if(!t)return null;const e={path:null,query:null},i=new Ub(t),r=t.indexOf("?");return i.query===null?e.path=t:(e.path=t.substring(0,r),e.query=DCe(i.query)),i.fragment&&(e.hash=i.fragment,i.query===null&&(e.path=e.path.substring(0,e.path.length-(i.fragment.length+1)))),e}function DCe(t){const e=t.split("&"),i={};for(const r of e){if(!r)continue;const n=r.indexOf("=");let s,o;n<0?(s=decodeURIComponent(r),o=""):(s=decodeURIComponent(r.slice(0,n)),o=decodeURIComponent(r.slice(n+1)));let a=i[s];typeof a=="string"&&(a=i[s]=[a]),Array.isArray(a)?a.push(o):i[s]=o}return i}function ade(t){return t&&typeof t=="object"&&"toJSON"in t&&typeof t.toJSON=="function"}function JL(t,e){return t?e&&typeof e=="function"?Object.keys(t).map(i=>encodeURIComponent(i)+"="+encodeURIComponent(e(i,t[i]))).join("&"):Object.keys(t).map(i=>{const r=t[i];if(r==null)return"";const n=encodeURIComponent(i)+"=",s=e&&e[i];return s?n+encodeURIComponent(s(r)):Array.isArray(r)?r.map(o=>ade(o)?n+encodeURIComponent(JSON.stringify(o)):n+encodeURIComponent(o)).join("&"):ade(r)?n+encodeURIComponent(JSON.stringify(r)):n+encodeURIComponent(r)}).filter(i=>i).join("&"):""}function XWe(t=!1){let e,i=_O.proxyUrl;if(typeof t=="string"){e=rXe(t);const r=Z9(t);r&&(i=r.proxyUrl)}else e=!!t;if(!i)throw kWe.warn(ode),new H("urlutils:proxy-not-set",ode);return e&&xZ()&&(i=Yne(i)),Bo(i)}function tzt(t){const e=Z9(t);let i,r;if(e){const n=Gne(e.proxyUrl);i=n.path,r=n.query?DCe(n.query):null}if(i){const n=Bo(t);t=i+"?"+n.path;const s=JL({...r,...n.query});s&&(t=`${t}?${s}`)}return t}const p3={path:"",query:""};function Gne(t){const e=t.indexOf("?");return e!==-1?(p3.path=t.slice(0,e),p3.query=t.slice(e+1)):(p3.path=t,p3.query=null),p3}function NCe(t){return t=(t=lV(t=cXe(t=Gne(t).path),!0)).toLowerCase()}function YWe(t){const e={proxyUrl:t.proxyUrl,urlPrefix:NCe(t.urlPrefix)},i=_O.proxyRules,r=e.urlPrefix;let n=i.length;for(let s=0;s<i.length;s++){const o=i[s].urlPrefix;if(r.indexOf(o)===0){if(r.length===o.length)return-1;n=s;break}o.indexOf(r)===0&&(n=s+1)}return i.splice(n,0,e),n}function Z9(t){const e=_O.proxyRules,i=NCe(t);for(let r=0;r<e.length;r++)if(i.indexOf(e[r].urlPrefix)===0)return e[r]}function ZWe(t,e){if(!t||!e)return!1;t=xM(t),e=xM(e);const i=aV(t),r=aV(e);return v(i)&&v(r)?i.portalHostname===r.portalHostname:!v(i)&&!v(r)&&TM(t,e,!0)}function JWe(t,e){if(!t||!e)return!1;t=xM(t),e=xM(e);const i=aV(t),r=aV(e);return!(!v(i)||!v(r))&&i.portalHostname===r.portalHostname}function FCe(t,e){return t=xM(t),e=xM(e),lV(t)===lV(e)}function xM(t){const e=(t=am(t)).indexOf("/sharing");return e>0?t.substring(0,e):t.replace(/\/+$/,"")}function kCe(t){const e=r=>r==null||r instanceof RegExp&&r.test(t)||typeof r=="string"&&t.startsWith(r),i=_O.interceptors;if(i){for(const r of i)if(Array.isArray(r.urls)){if(r.urls.some(e))return r}else if(e(r.urls))return r}return null}function TM(t,e,i=!1){if(!t||!e)return!1;const r=SZ(t),n=SZ(e);return!(!i&&r.scheme!==n.scheme)&&r.host!=null&&n.host!=null&&r.host.toLowerCase()===n.host.toLowerCase()&&r.port===n.port}function Hne(t){if(typeof t=="string"){if(!Wu(t))return!0;t=SZ(t)}if(TM(t,Gl))return!0;const e=_O.trustedServers||[];for(let i=0;i<e.length;i++){const r=KWe(e[i]);for(let n=0;n<r.length;n++)if(TM(t,r[n]))return!0}return!1}function KWe(t){return zF[t]||(Xne(t)||fy(t)?zF[t]=[new Ub(zc(t))]:zF[t]=[new Ub(`http://${t}`),new Ub(`https://${t}`)]),zF[t]}function zc(t,e=Bne,i){return fy(t)?i&&i.preserveProtocolRelative?t:Gl.scheme==="http"&&Gl.authority===lm(t).slice(2)?`http:${t}`:`https:${t}`:Xne(t)?t:ew(t[0]==="/"?aXe(e):e,t)}function qne(t,e=Bne,i){if(t==null||!Wu(t))return t;const r=am(t),n=r.toLowerCase(),s=am(e).toLowerCase().replace(/\/+$/,""),o=i?am(i).toLowerCase().replace(/\/+$/,""):null;if(o&&s.indexOf(o)!==0)return t;const a=(p,f,m)=>(m=p.indexOf(f,m))===-1?p.length:m;let l=a(n,"/",n.indexOf("//")+2),c=-1;for(;n.slice(0,l+1)===s.slice(0,l)+"/"&&(c=l+1,l!==n.length);)l=a(n,"/",l+1);if(c===-1||o&&c<o.length)return t;t=r.slice(c);const h=s.slice(c-1).replace(/[^/]+/g,"").length;if(h>0)for(let p=0;p<h;p++)t=`../${t}`;else t=`./${t}`;return t}function am(t){return t=dXe(t=hXe(t=uXe(t=zc(t=t.trim()))))}function ew(...t){const e=t.filter(v);if(!e||!e.length)return;const i=[];if(Wu(e[0])){const n=e[0],s=n.indexOf("//");s!==-1&&(i.push(n.slice(0,s+1)),sXe(e[0])&&(i[0]+="/"),e[0]=n.slice(s+2))}else e[0][0]==="/"&&i.push("");const r=e.reduce((n,s)=>s?n.concat(s.split("/")):n,[]);for(let n=0;n<r.length;n++){const s=r[n];s===".."&&i.length>0&&i[i.length-1]!==".."?i.pop():(!s&&n===r.length-1||s&&(s!=="."||i.length===0))&&i.push(s)}return i.join("/")}function lm(t,e=!1){if(t==null||tw(t)||fd(t))return null;let i=t.indexOf("://");if(i===-1&&fy(t))i=2;else{if(i===-1)return null;i+=3}const r=t.indexOf("/",i);return r!==-1&&(t=t.slice(0,r)),e&&(t=lV(t,!0)),t}function Wu(t){return fy(t)||Xne(t)}function tw(t){return t!=null&&t.slice(0,5)==="blob:"}function fd(t){return t!=null&&t.slice(0,5)==="data:"}function Wne(t){const e=vO(t);if(!e||!e.isBase64)return null;const i=atob(e.data),r=new Uint8Array(i.length);for(let n=0;n<i.length;n++)r[n]=i.charCodeAt(n);return r.buffer}function izt(t){return btoa(String.fromCharCode.apply(null,t)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}const QWe=/^data:(.*?)(;base64)?,(.*)$/;function vO(t){const e=t.match(QWe);if(!e)return null;const[,i,r,n]=e;return{mediaType:i,isBase64:!!r,data:n}}function UCe(t){return t.isBase64?`data:${t.mediaType};base64,${t.data}`:`data:${t.mediaType},${t.data}`}function eXe(t){const e=Wne(t);if(!e)return null;const i=vO(t);return new Blob([e],{type:i.mediaType})}function rzt(t,e){tXe(t,e)||iXe(t,e)}function tXe(t,e){if(!t)return!1;const i=document.createElement("a");if(!("download"in i))return!1;const r=URL.createObjectURL(t);return i.download=e,i.href=r,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r),!0}function iXe(t,e){return!!window.navigator.msSaveOrOpenBlob&&window.navigator.msSaveOrOpenBlob(t,e)}function fy(t){return t!=null&&t[0]==="/"&&t[1]==="/"}function Xne(t){return t!=null&&$Ce.test(t)}function rXe(t){return t!=null&&UWe.test(t)||Gl.scheme==="https"&&fy(t)}function nXe(t){return t!=null&&LCe.test(t)||Gl.scheme==="http"&&fy(t)}function sXe(t){return t!=null&&VWe.test(t)}function Yne(t){return fy(t)?`https:${t}`:t.replace(LCe,"https:")}function oXe(){return Gl.scheme==="http"}function xZ(){return Gl.scheme==="https"}function lV(t,e=!1){return fy(t)?t.slice(2):(t=t.replace($Ce,""),e&&t.length>1&&t[0]==="/"&&t[1]==="/"&&(t=t.slice(2)),t)}function aXe(t){const e=t.indexOf("//"),i=t.indexOf("/",e+2);return i===-1?t:t.slice(0,i)}function lXe(t){let e=0;if(Wu(t)){const r=t.indexOf("//");r!==-1&&(e=r+2)}const i=t.lastIndexOf("/");return i<e?t:t.slice(0,i+1)}function nzt(t,e){if(!t)return"";const i=Bo(t).path.replace(/\/+$/,""),r=i.substring(i.lastIndexOf("/")+1);if(!(e!=null&&e.length))return r;const n=new RegExp(`.(${e.join("|")})$`,"ig");return r.replace(n,"")}function cXe(t){return t&&t[t.length-1]==="/"?t:`${t}/`}function VCe(t){return t.replace(/\/+$/,"")}function uXe(t){if(/^https?:\/\//i.test(t)){const e=Gne(t);t=(t=e.path.replace(/\/{2,}/g,"/")).replace("/","//"),e.query&&(t+=`?${e.query}`)}return t}function hXe(t){return t.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function dXe(t){const e=_O.httpsDomains;if(!nXe(t))return t;const i=t.indexOf("/",7);let r;if(r=i===-1?t:t.slice(0,i),r=r.toLowerCase().slice(7),zWe.test(r)){if(!r.endsWith(":80"))return t;r=r.slice(0,-3),t=t.replace(":80","")}return oXe()&&r===Gl.authority&&!BWe.test(t)||(xZ()&&r===Gl.authority||e&&e.some(n=>r===n||r.endsWith(`.${n}`))||xZ()&&!Z9(t))&&(t=Yne(t)),t}function TZ(t,e,i){if(!(e&&i&&t&&Wu(t)))return t;const r=t.indexOf("//"),n=t.indexOf("/",r+2),s=t.indexOf(":",r+2),o=Math.min(n<0?t.length:n,s<0?t.length:s);return t.slice(r+2,o).toLowerCase()!==e.toLowerCase()?t:`${t.slice(0,r+2)}${i}${t.slice(o)}`}function SZ(t){return typeof t=="string"?new Ub(zc(t)):(t.scheme||(t.scheme=Gl.scheme),t)}function zCe(t){return fXe.test(t)}function BCe(t,e){const i=Bo(t),r=Object.keys(i.query||{});return r.length>0&&e&&e.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${r.join(", ")}.`),i.path}function Zne(t,e,i){const r=Bo(t),n=r.query||{};return n[e]=String(i),`${r.path}?${JL(n)}`}function Xj(t,e){const i=Bo(t),r=i.query||{};for(const s in e)r[s]=e[s];const n=JL(r);return n?`${i.path}?${n}`:i.path}function pXe(t){if(R(t))return null;const e=t.match(jCe);return e?e[2]:null}function lde(t){if(R(t))return null;const e=t.match(jCe);return e?{path:e[1],extension:e[2]}:{path:t,extension:null}}const jCe=/([^.]*)\.([^\/]*)$/,fXe=/(^data:image\/svg|\.svg$)/i;function G2(t,e){const i=e&&e.url&&e.url.path;if(t&&i&&(t=zc(t,i,{preserveProtocolRelative:!0}),e.portalItem&&e.readResourcePaths)){const r=qne(t,e.portalItem.itemUrl);r!=null&&mXe.test(r)&&e.readResourcePaths.push(e.portalItem.resourceFromPath(r).path)}return EZ(t,e&&e.portal)}function R_(t,e,i=SM.YES){if(t==null)return t;!Wu(t)&&e&&e.blockedRelativeUrls&&e.blockedRelativeUrls.push(t);let r=zc(t);if(e){const n=e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.rootPath||e.url&&e.url.path;if(n){const s=EZ(n,e.portal),o=EZ(r,e.portal);r=qne(o,s,s),r!=null&&r!==o&&r!==t&&e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.writtenUrls.push(r)}}return r=qCe(r,e==null?void 0:e.portal),Wu(r)&&(r=am(r)),e!=null&&e.resources&&(e!=null&&e.portalItem)&&!Wu(r)&&!fd(r)&&i===SM.YES&&e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(r),compress:!1}),r}function Jne(t,e,i){return G2(t,i)}function iw(t,e,i,r){const n=R_(t,r);n!==void 0&&(e[i]=n)}const GCe=/\/items\/([^\/]+)\/resources\/(.*)/,mXe=/^\.\/resources\//;function HCe(t){var e;return((e=(t==null?void 0:t.match(GCe))??null)==null?void 0:e[1])??null}function gXe(t){const e=(t==null?void 0:t.match(GCe))??null;if(e==null)return null;const i=e[2],r=i.lastIndexOf("/");if(r===-1){const{path:o,extension:a}=lde(i);return{prefix:null,filename:o,extension:a}}const{path:n,extension:s}=lde(i.slice(r+1));return{prefix:i.slice(0,r),filename:n,extension:s}}function qCe(t,e){return e&&!e.isPortal&&e.urlKey&&e.customBaseUrl?TZ(t,`${e.urlKey}.${e.customBaseUrl}`,e.portalHostname):t}function EZ(t,e){if(!e||e.isPortal||!e.urlKey||!e.customBaseUrl)return t;const i=`${e.urlKey}.${e.customBaseUrl}`,r=jne();return TM(r,`${r.scheme}://${i}`)?TZ(t,e.portalHostname,i):TZ(t,i,e.portalHostname)}var SM;(function(t){t[t.YES=0]="YES",t[t.NO=1]="NO"})(SM||(SM={}));const szt=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return SM},ensureMainOnlineDomain:qCe,fromJSON:G2,itemIdFromResourceUrl:HCe,prefixAndFilenameFromResourceUrl:gXe,read:Jne,toJSON:R_,write:iw},Symbol.toStringTag,{value:"Module"}));var CZ;const yXe=Wa()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let Yx=CZ=class extends fe{constructor(t){super(t)}readHref(t,e,i){return t?G2(t,i):e.dataURI}writeHref(t,e,i,r){t&&(fd(t)?e.dataURI=t:(e.href=R_(t,r),Wu(e.href)&&(e.href=am(e.href))))}clone(){return new CZ({href:this.href,primitive:this.primitive})}};u([d({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],Yx.prototype,"href",void 0),u([Oe("href")],Yx.prototype,"readHref",null),u([Ne("href",{href:{type:String},dataURI:{type:String}})],Yx.prototype,"writeHref",null),u([ot(yXe)],Yx.prototype,"primitive",void 0),Yx=CZ=u([$("esri.symbols.support.IconSymbol3DLayerResource")],Yx);const _Xe="circle";var AZ;let KA=AZ=class extends ve{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new AZ({x:this.x,y:this.y})}};u([d({type:Number})],KA.prototype,"x",void 0),u([d({type:Number})],KA.prototype,"y",void 0),KA=AZ=u([$("esri.symbols.support.Symbol3DAnchorPosition2D")],KA);var RZ;let FP=RZ=class extends fe{constructor(t){super(t),this.color=new Xe([0,0,0,1]),this.size=Ip(1)}clone(){const t={color:v(this.color)?this.color.clone():null,size:this.size};return new RZ(t)}};u([d(z_)],FP.prototype,"color",void 0),u([d(dy)],FP.prototype,"size",void 0),FP=RZ=u([$("esri.symbols.support.Symbol3DIconOutline")],FP);var CC;const WCe="esri.symbols.IconSymbol3DLayer";let rg=CC=class extends Ty{constructor(t){super(t),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null}clone(){return new CC({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:v(this.material)?this.material.clone():null,outline:v(this.outline)?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})}static fromSimpleMarkerSymbol(t){const e=t.color||S$,i=cde(t),r=t.outline&&t.outline.width>0?{size:t.outline.width,color:(t.outline.color||S$).clone()}:null;return new CC({size:t.size,resource:{primitive:bXe(t.style)},material:{color:e},outline:r,anchor:i?"relative":void 0,anchorPosition:i})}static fromPictureMarkerSymbol(t){const e=!t.color||fWe(t.color)?S$:t.color,i=cde(t);return new CC({size:t.width<=t.height?t.height:t.width,resource:{href:t.url},material:{color:e.clone()},anchor:i?"relative":void 0,anchorPosition:i})}static fromCIMSymbol(t){return new CC({resource:{href:UCe({mediaType:"application/json",data:JSON.stringify(t.data)})}})}};function cde(t){const e="width"in t?t.width:t.size,i="height"in t?t.height:t.size,r=ude(t.xoffset),n=ude(t.yoffset);return(r||n)&&e&&i?{x:-r/e,y:n/i}:null}function ude(t){return isFinite(t)?t:0}u([d({type:td,json:{write:!0}})],rg.prototype,"material",void 0),u([d({type:Yx,json:{write:!0}})],rg.prototype,"resource",void 0),u([ot({Icon:"icon"},{readOnly:!0})],rg.prototype,"type",void 0),u([d(dy)],rg.prototype,"size",void 0),u([ot({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),d({json:{default:"center"}})],rg.prototype,"anchor",void 0),u([d({type:KA,json:{type:[Number],read:{reader:t=>new KA({x:t[0],y:t[1]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],rg.prototype,"anchorPosition",void 0),u([d({type:FP,json:{write:!0}})],rg.prototype,"outline",void 0),rg=CC=u([$(WCe)],rg);const vXe={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function bXe(t){return vXe[t]||(re.getLogger(WCe).warn(`${t} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const db=rg;function rw(t,e,i=tt){return e||(e=new i),e===t||(e.removeAll(),wXe(t)?e.addMany(t):t&&e.add(t)),e}function XCe(t){return t}function wXe(t){return t&&(Array.isArray(t)||"items"in t&&Array.isArray(t.items))}const YCe="20230228",ZCe="82c504e7a258618693fa8f46717811c9d421bd0d",Kne="4.26",xXe={async request(t,e){var a,l;const{default:i}=await Q(()=>Promise.resolve().then(()=>kXe),void 0),r=t.options,n=r.responseType;r.signal=e==null?void 0:e.signal,r.responseType=n==="native"||n==="native-request-init"?"native-request-init":n&&["blob","json","text"].includes(n)&&((a=kCe(t.url))!=null&&a.after)?n:"array-buffer";const s=await i(t.url,r),o={data:s.data,httpStatus:s.httpStatus,ssl:s.ssl};switch((l=s.requestOptions)==null?void 0:l.responseType){case"native-request-init":return delete o.data.signal,o;case"blob":o.data=await o.data.arrayBuffer();break;case"json":o.data=new TextEncoder().encode(JSON.stringify(o.data)).buffer;break;case"text":o.data=new TextEncoder().encode(o.data).buffer}return{result:o,transferList:[o.data]}}};let Ir;function ozt(t){Ir=t}function azt(t){const e=Ir&&Ir.findCredential(t);return e&&e.token?Zne(t,"token",e.token):t}ue("host-webworker");const TXe=["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"];function JCe(t){const e=lm(t,!0);return!!e&&e.endsWith(".arcgis.com")&&!TXe.includes(e)&&!t.endsWith("/sharing/rest/generateToken")}function KCe(t,e,i=!1,r){return new Promise((n,s)=>{if(fo(r))return void s(hde());let o=()=>{c(),s(new Error(`Unable to load ${e}`))},a=()=>{const h=t;c(),n(h)},l=()=>{if(!t)return;const h=t;c(),h.src="",s(hde())};const c=()=>{ue("esri-image-decode")||(t.removeEventListener("error",o),t.removeEventListener("load",a)),o=null,a=null,t=null,v(r)&&r.removeEventListener("abort",l),l=null,i&&URL.revokeObjectURL(e)};v(r)&&r.addEventListener("abort",l),ue("esri-image-decode")?t.decode().then(a,o):(t.addEventListener("error",o),t.addEventListener("load",a))})}function hde(){try{return new DOMException("Aborted","AbortError")}catch{const t=new Error;return t.name="AbortError",t}}function SXe(t){nr.request.crossOriginNoCorsDomains||(nr.request.crossOriginNoCorsDomains={});const e=nr.request.crossOriginNoCorsDomains;for(let i of t)i=i.toLowerCase(),/^https?:\/\//.test(i)?e[lm(i)??""]=0:(e[lm("http://"+i)??""]=0,e[lm("https://"+i)??""]=0)}function EXe(t){const e=nr.request.crossOriginNoCorsDomains;if(e){let i=lm(t);if(i)return i=i.toLowerCase(),!TM(i,jne())&&e[i]<Date.now()-36e5}return!1}async function CXe(t){var n;const e=nr.request.crossOriginNoCorsDomains,i=lm(t);e&&i&&(e[i.toLowerCase()]=Date.now());const r=Bo(t);t=r.path,((n=r.query)==null?void 0:n.f)==="json"&&(t+="?f=json");try{await fetch(t,{mode:"no-cors",credentials:"include"})}catch{}}async function ir(t,e){var c;const i=fd(t),r=tw(t);r||i||(t=am(t));const n={url:t,requestOptions:{...e}};let s=kCe(t);if(s){const h=await LXe(s,n);if(h!=null)return{data:h,getHeader:Qne,httpStatus:200,requestOptions:n.requestOptions,url:n.url};s.after||s.error||(s=null)}if(t=n.url,(e=n.requestOptions).responseType==="image"){if(ue("host-webworker")||ue("host-node"))throw Jf("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),n)}else if(i)throw Jf("request:invalid-parameters",new Error("Data URLs are not supported for responseType = "+e.responseType),n);if(e.method==="head"){if(e.body)throw Jf("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),n);if(i||r)throw Jf("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),n)}if(await PXe(),cV)return cV.execute(t,e);const o=new AbortController;ja(e,()=>o.abort());const a={controller:o,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:s,params:n,redoRequest:!1,useIdentity:kf.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},l=await NXe(a);return(c=s==null?void 0:s.after)==null||c.call(s,l),l}let cV;const kf=nr.request,QCe="FormData"in globalThis,AXe=[499,498,403,401],RXe=["COM_0056","COM_0057","SB_0008"],MXe=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],Qne=()=>null,uV=Symbol();function OXe(t){const e=lm(t);e&&!ir._corsServers.includes(e)&&ir._corsServers.push(e)}function dde(t){const e=lm(t);return!e||e.endsWith(".arcgis.com")||ir._corsServers.includes(e)||Hne(e)}function Jf(t,e,i,r){let n="Error";const s={url:i.url,requestOptions:i.requestOptions,getHeader:Qne,ssl:!1};if(e instanceof H)return e.details?(e.details=se(e.details),e.details.url=i.url,e.details.requestOptions=i.requestOptions):e.details=s,e;if(e){const o=r&&(c=>r.headers.get(c)),a=r&&r.status,l=e.message;l&&(n=l),o&&(s.getHeader=o),s.httpStatus=(e.httpCode!=null?e.httpCode:e.code)||a||0,s.subCode=e.subcode,s.messageCode=e.messageCode,typeof e.details=="string"?s.messages=[e.details]:s.messages=e.details,s.raw=uV in e?e[uV]:e}return gs(e)?Bi():new H(t,n,s)}async function PXe(){ue("host-webworker")?cV||(cV=await Q(()=>import("./request-fc57d57a.js"),[])):ir._abortableFetch||(ir._abortableFetch=globalThis.fetch.bind(globalThis))}async function MZ(){Ir||await Q(()=>import("./IdentityManager-b0c9dc17.js"),[])}async function IXe(t){var a;const e=t.params.url,i=t.params.requestOptions,r=t.controller.signal,n=i.body;let s=null,o=null;if(QCe&&"HTMLFormElement"in globalThis&&(n instanceof FormData?s=n:n instanceof HTMLFormElement&&(s=new FormData(n))),typeof n=="string"&&(o=n),t.fetchOptions={cache:i.cacheBust&&!ir._abortableFetch.polyfill?"no-cache":"default",credentials:"same-origin",headers:i.headers||{},method:i.method==="head"?"HEAD":"GET",mode:"cors",priority:kf.priority,redirect:"follow",signal:r},(s||o)&&(t.fetchOptions.body=s||o),i.authMode==="anonymous"&&(t.useIdentity=!1),t.hasToken=!!(/token=/i.test(e)||(a=i.query)!=null&&a.token||s!=null&&s.get("token")),!t.hasToken&&nr.apiKey&&JCe(e)&&(i.query||(i.query={}),i.query.token=nr.apiKey,t.hasToken=!0),t.useIdentity&&!t.hasToken&&!t.credentialToken&&!eAe(e)&&!fo(r)){let l;i.authMode==="immediate"?(await MZ(),l=await Ir.getCredential(e,{signal:r}),t.credential=l):i.authMode==="no-prompt"?(await MZ(),l=await Ir.getCredential(e,{prompt:!1,signal:r}).catch(()=>{}),t.credential=l):Ir&&(l=Ir.findCredential(e)),l&&(t.credentialToken=l.token,t.useSSL=!!l.ssl)}}function eAe(t){return MXe.some(e=>e.test(t))}async function $Xe(t){let e=t.params.url;const i=t.params.requestOptions,r=t.fetchOptions??{},n=tw(e)||fd(e),s=i.responseType||"json",o=n?0:i.timeout!=null?i.timeout:kf.timeout;let a=!1;if(!n){t.useSSL&&(e=Yne(e)),i.cacheBust&&r.cache==="default"&&(e=Zne(e,"request.preventCache",Date.now()));let f={...i.query};t.credentialToken&&(f.token=t.credentialToken);let m=JL(f);ue("esri-url-encodes-apostrophe")&&(m=m.replace(/'/g,"%27"));const g=e.length+1+m.length;let _;a=i.method==="delete"||i.method==="post"||i.method==="put"||!!i.body||g>kf.maxUrlLength;const b=i.useProxy||!!Z9(e);if(b){const w=XWe(e);_=w.path,!a&&_.length+1+g>kf.maxUrlLength&&(a=!0),w.query&&(f={...w.query,...f})}if(r.method==="HEAD"&&(a||b)){if(a)throw g>kf.maxUrlLength?Jf("request:invalid-parameters",new Error("URL exceeds maximum length"),t.params):Jf("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),t.params);if(b)throw Jf("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),t.params)}if(a?(r.method=i.method==="delete"?"DELETE":i.method==="put"?"PUT":"POST",i.body?e=Xj(e,f):(r.body=JL(f),r.headers||(r.headers={}),r.headers["Content-Type"]="application/x-www-form-urlencoded")):e=Xj(e,f),b&&(t.useProxy=!0,e=`${_}?${e}`),f.token&&QCe&&r.body instanceof FormData&&!FWe(e)&&r.body.set("token",f.token),i.hasOwnProperty("withCredentials"))t.withCredentials=i.withCredentials;else if(!TM(e,jne())){if(Hne(e))t.withCredentials=!0;else if(Ir){const w=Ir.findServerInfo(e);w&&w.webTierAuth&&(t.withCredentials=!0)}}t.withCredentials&&(r.credentials="include",EXe(e)&&await CXe(a?Xj(e,f):e))}let l,c,h=0,p=!1;o>0&&(h=setTimeout(()=>{p=!0,t.controller.abort()},o));try{if(i.responseType==="native-request-init")c=r,c.url=e;else if(i.responseType!=="image"||r.cache!=="default"||r.method!=="GET"||a||DXe(i.headers)||!n&&!t.useProxy&&kf.proxyUrl&&!dde(e)){if(l=await ir._abortableFetch(e,r),t.useProxy||OXe(e),i.responseType==="native")c=l;else if(r.method!=="HEAD")if(l.ok){switch(s){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(h&&(clearTimeout(h),h=0),s==="json"||s==="xml"||s==="document")if(c)switch(s){case"json":c=JSON.parse(c);break;case"xml":c=pde(c,"application/xml");break;case"document":c=pde(c,"text/html")}else c=null;if(c){if(s==="array-buffer"||s==="blob"){const f=l.headers.get("Content-Type");if(f&&/application\/json|text\/plain/i.test(f)&&c[s==="blob"?"size":"byteLength"]<=750)try{const m=await new Response(c).json();m.error&&(c=m)}catch{}}s==="image"&&c instanceof Blob&&(c=await fde(URL.createObjectURL(c),t,!0))}}else c=await l.text()}else c=await fde(e,t)}catch(f){if(f.name==="AbortError")throw p?new Error("Timeout exceeded"):Bi("Request canceled");if(!(!l&&f instanceof TypeError&&kf.proxyUrl)||i.body||i.method==="delete"||i.method==="head"||i.method==="post"||i.method==="put"||t.useProxy||dde(e))throw f;t.redoRequest=!0,YWe({proxyUrl:kf.proxyUrl,urlPrefix:lm(e)??""})}finally{h&&clearTimeout(h)}return[l,c]}async function LXe(t,e){if(t.responseData!=null)return t.responseData;if(t.headers&&(e.requestOptions.headers={...e.requestOptions.headers,...t.headers}),t.query&&(e.requestOptions.query={...e.requestOptions.query,...t.query}),t.before){let i,r;try{r=await t.before(e)}catch(n){i=Jf("request:interceptor",n,e)}if((r instanceof Error||r instanceof H)&&(i=Jf("request:interceptor",r,e)),i)throw t.error&&t.error(i),i;return r}}function DXe(t){if(t){for(const e of Object.getOwnPropertyNames(t))if(t[e])return!0}return!1}function pde(t,e){let i;try{i=new DOMParser().parseFromString(t,e)}catch{}if(!i||i.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return i}async function NXe(t){var s;let e,i;await IXe(t);try{do[e,i]=await $Xe(t);while(!await FXe(t,e,i))}catch(o){const a=Jf("request:server",o,t.params,e);throw a.details.ssl=t.useSSL,t.interceptor&&t.interceptor.error&&t.interceptor.error(a),a}const r=t.params.url;if(i&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(r)){if(!t.hasToken&&!t.credentialToken&&((s=i.user)!=null&&s.username)&&!Hne(r)){const o=lm(r,!0);o&&kf.trustedServers.push(o)}Array.isArray(i.authorizedCrossOriginNoCorsDomains)&&SXe(i.authorizedCrossOriginNoCorsDomains)}const n=t.credential;if(n&&Ir){const o=Ir.findServerInfo(n.server);let a=o&&o.owningSystemUrl;if(a){a=a.replace(/\/?$/,"/sharing");const l=Ir.findCredential(a,n.userId);l&&Ir._getIdenticalSvcIdx(a,l)===-1&&l.resources.unshift(a)}}return{data:i,getHeader:e?o=>e==null?void 0:e.headers.get(o):Qne,httpStatus:(e==null?void 0:e.status)??200,requestOptions:t.params.requestOptions,ssl:t.useSSL,url:t.params.url}}async function FXe(t,e,i){if(t.redoRequest)return t.redoRequest=!1,!1;const r=t.params.requestOptions;if(!e||r.responseType==="native"||r.responseType==="native-request-init")return!0;let n,s;if(!e.ok)throw n=new Error(`Unable to load ${e.url} status: ${e.status}`),n[uV]=i,n;i&&(i.error?n=i.error:i.status==="error"&&Array.isArray(i.messages)&&(n={...i},n[uV]=i,n.details=i.messages));let o,a=null;n&&(s=Number(n.code),a=n.hasOwnProperty("subcode")?Number(n.subcode):null,o=n.messageCode,o=o&&o.toUpperCase());const l=r.authMode;if(s===403&&(a===4||n.message&&n.message.toLowerCase().includes("ssl")&&!n.message.toLowerCase().includes("permission"))){if(!t.useSSL)return t.useSSL=!0,!1}else if(!t.hasToken&&t.useIdentity&&(l!=="no-prompt"||s===498)&&s!==void 0&&AXe.includes(s)&&!eAe(t.params.url)&&(s!==403||o&&!RXe.includes(o)&&(a==null||a===2&&t.credentialToken))){await MZ();try{const c=await Ir.getCredential(t.params.url,{error:Jf("request:server",n,t.params),prompt:l!=="no-prompt",signal:t.controller.signal,token:t.credentialToken});return t.credential=c,t.credentialToken=c.token,t.useSSL=t.useSSL||c.ssl,!1}catch(c){if(l==="no-prompt")return t.credential=void 0,t.credentialToken=void 0,!1;n=c}}if(n)throw n;return!0}function fde(t,e,i=!1){const r=e.controller.signal,n=new Image;return e.withCredentials?n.crossOrigin="use-credentials":n.crossOrigin="anonymous",n.alt="",n.fetchPriority=kf.priority,n.src=t,KCe(n,t,i,r)}ir._abortableFetch=null,ir._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"];const kXe=Object.freeze(Object.defineProperty({__proto__:null,default:ir},Symbol.toStringTag,{value:"Module"}));var F1;(function(t){t[t.PENDING=0]="PENDING",t[t.RESOLVED=1]="RESOLVED",t[t.REJECTED=2]="REJECTED"})(F1||(F1={}));let UXe=class{constructor(e){this.instance=e,this._resolver=S_(),this._status=F1.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=F1.RESOLVED,this._cleanUp()},()=>{this._status=F1.REJECTED,this._cleanUp()})}addResolvingPromise(e){this._resolvingPromises.push(e),this._tryResolve()}isResolved(){return this._status===F1.RESOLVED}isRejected(){return this._status===F1.REJECTED}isFulfilled(){return this._status!==F1.PENDING}abort(){this._resolver.reject(Bi())}when(e,i){return this._resolver.promise.then(e,i)}_cleanUp(){this._allPromise=this._resolvingPromises=this._allPromise=null}_tryResolve(){if(this.isFulfilled())return;const e=S_(),i=[...this._resolvingPromises,e.promise],r=this._allPromise=Promise.all(i);r.then(()=>{this.isFulfilled()||this._allPromise!==r||this._resolver.resolve(this.instance)},n=>{this.isFulfilled()||this._allPromise!==r||gs(n)||this._resolver.reject(n)}),e.resolve()}};const bO=t=>{let e=class extends t{constructor(...i){super(...i),this._promiseProps=new UXe(this),this.addResolvingPromise(Promise.resolve())}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(i,r){return new Promise((n,s)=>{this._promiseProps.when(n,s)}).then(i,r)}catch(i){return this.when(null,i)}addResolvingPromise(i){i&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in i?i.when():i)}};return e=u([$("esri.core.Promise")],e),e};let hV=class extends bO(ve){};hV=u([$("esri.core.Promise")],hV);const VXe="not-loaded",zXe="loading",BXe="failed",mde="loaded",tAe=t=>{let e=class extends t{constructor(...i){super(...i),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(r=>{const n=this.load.bind(this);this.load=s=>{const o=new Promise((a,l)=>{const c=P9(s,l);this.destroyed&&l(new H("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this._promiseProps.when(a,l).finally(()=>{c&&c.remove()})});if(this.loadStatus===VXe){this._set("loadStatus",zXe);const a=this._loadController=new AbortController;n({signal:a.signal}),ja(a.signal,()=>{this._promiseProps.abort()})}return r(),o}})),this.when(()=>{this._set("loadStatus",mde),this._loadController=null},r=>{this._set("loadStatus",BXe),this._set("loadError",r),this._loadController=null})}get loaded(){return this.loadStatus===mde}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){var i;return this.isFulfilled()||(this._set("loadError",new H("load:cancelled","Cancelled")),(i=this._loadController)==null||i.abort()),this}};return u([d({readOnly:!0})],e.prototype,"loaded",null),u([d({readOnly:!0})],e.prototype,"loadError",void 0),u([d({clonable:!1})],e.prototype,"loadStatus",void 0),u([d({type:[Op],readOnly:!0})],e.prototype,"loadWarnings",null),e=u([$("esri.core.Loadable")],e),e};let kP=class extends tAe(hV){};kP=u([$("esri.core.Loadable")],kP),function(t){function e(i){return!(!i||!i.load)}t.LoadableMixin=tAe,t.isLoadable=e}(kP||(kP={}));const Ju=kP;var OZ;const jXe=new mi({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let $d=OZ=class extends ve{constructor(t){super(t),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(t){t!=="asc"&&t!=="desc"||this._set("sortOrder",t)}clone(){return new OZ({categories:this.categories?se(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(t,e){let i=[];this.categories&&(i=this.categories.map(o=>Array.isArray(o)?JSON.stringify(o):o));let r="";if(this.extent){const o=z2(this.extent,Je.WGS84);v(o)&&(r=`${o.xmin},${o.ymin},${o.xmax},${o.ymax}`)}let n=this.query;!this.disableExtraQuery&&t.extraQuery&&(n="("+n+")"+t.extraQuery);const s={categories:i,bbox:r,q:n,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(s.sortField=this.sortField.split(",").map(o=>jXe.toJSON(o.trim())).join(","),s.sortOrder=this.sortOrder),{query:{...e,...s}}}};u([d()],$d.prototype,"categories",void 0),u([d()],$d.prototype,"disableExtraQuery",void 0),u([d({type:ni})],$d.prototype,"extent",void 0),u([d()],$d.prototype,"filter",void 0),u([d()],$d.prototype,"num",void 0),u([d()],$d.prototype,"query",void 0),u([d()],$d.prototype,"sortField",void 0),u([d()],$d.prototype,"sortOrder",null),u([d()],$d.prototype,"start",void 0),$d=OZ=u([$("esri.portal.PortalQueryParams")],$d);const B0=$d;let Zx=class extends ve{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};u([d()],Zx.prototype,"nextQueryParams",void 0),u([d()],Zx.prototype,"queryParams",void 0),u([d()],Zx.prototype,"results",void 0),u([d()],Zx.prototype,"total",void 0),Zx=u([$("esri.portal.PortalQueryResult")],Zx);const GXe=Zx;let o0=class extends fe{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new H("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};u([d({type:Date})],o0.prototype,"created",void 0),u([d()],o0.prototype,"id",void 0),u([d()],o0.prototype,"portal",void 0),u([d()],o0.prototype,"title",void 0),u([d({readOnly:!0})],o0.prototype,"url",null),u([d()],o0.prototype,"username",void 0),o0=u([$("esri.portal.PortalFolder")],o0);const HXe=o0;let Jo=class extends fe{constructor(e){super(e),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.tags=null,this.title=null}get thumbnailUrl(){var r;const e=this.url,i=this.thumbnail;return e&&i&&this.portal?(r=this.portal)==null?void 0:r.normalizeUrl(`${e}/info/${i}?f=json`):null}get url(){const e=this.get("portal.restUrl");return e?e+"/community/groups/"+this.id:null}fetchCategorySchema(e){return Nc(this.portal).request(this.url+"/categorySchema",e).then(i=>{const r=i.categorySchema||[];return r.some(n=>n.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",e):r})}fetchMembers(e){return Nc(this.portal).request(this.url+"/users",e)}getThumbnailUrl(e){let i=this.thumbnailUrl;return i&&e&&(i+=`&w=${e}`),i}toJSON(){throw new H("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}queryItems(e,i){let r=Ts(B0,e);const n=Nc(this.portal);return parseFloat(n.currentVersion)>5?(r=r||new B0,n.queryPortal(`/content/groups/${this.id}/search`,r,"PortalItem",i)):(r=r?r.clone():new B0,r.query="group:"+this.id+(r.query?" "+r.query:""),n.queryItems(r,i))}_fetchCategorySchemaSet(e,i){const r=Nc(this.portal);return r.fetchSelf(r.authMode,!0,i).then(n=>{const s=n.contentCategorySetsGroupQuery;if(s){const o=new B0;return o.disableExtraQuery=!0,o.num=1,o.query=s,r.queryGroups(o,i)}throw new H("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(n=>{if(n.total){const s=n.results[0],o=new B0;return o.num=1,o.query=`typekeywords:"${e}"`,s.queryItems(o,i)}throw new H("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(n=>n.total?n.results[0].fetchData("json",i).then(s=>{const o=s&&s.categorySchema;return o&&o.length?o:[]}):[])}};u([d()],Jo.prototype,"access",void 0),u([d({type:Date})],Jo.prototype,"created",void 0),u([d()],Jo.prototype,"description",void 0),u([d()],Jo.prototype,"id",void 0),u([d()],Jo.prototype,"isInvitationOnly",void 0),u([d({type:Date})],Jo.prototype,"modified",void 0),u([d()],Jo.prototype,"owner",void 0),u([d()],Jo.prototype,"portal",void 0),u([d()],Jo.prototype,"snippet",void 0),u([d()],Jo.prototype,"sortField",void 0),u([d()],Jo.prototype,"sortOrder",void 0),u([d()],Jo.prototype,"tags",void 0),u([d()],Jo.prototype,"thumbnail",void 0),u([d({readOnly:!0})],Jo.prototype,"thumbnailUrl",null),u([d()],Jo.prototype,"title",void 0),u([d({readOnly:!0})],Jo.prototype,"url",null),Jo=u([$("esri.portal.PortalGroup")],Jo);const PZ=Jo,qXe=Object.freeze(Object.defineProperty({__proto__:null,default:PZ},Symbol.toStringTag,{value:"Module"}));var IZ;let Bn=IZ=class extends fe{constructor(...t){super(...t),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const t=this.url,e=this.thumbnail;return t&&e?this.portal.normalizeUrl(`${t}/info/${e}?f=json`):null}get userContentUrl(){const t=this.get("portal.restUrl");return t?`${t}/content/users/${this.username}`:null}get url(){const t=this.get("portal.restUrl");return t?`${t}/community/users/${this.username}`:null}addItem(t){const e=t&&t.item,i=t&&t.data,r=t&&t.folder,n={method:"post"};e&&(n.query=e.createPostQuery(),i!=null&&(typeof i=="string"?n.query.text=i:typeof i=="object"&&(n.query.text=JSON.stringify(i))));let s=this.userContentUrl;return r&&(s+="/"+(typeof r=="string"?r:r.id)),this.portal.request(s+"/addItem",n).then(o=>(e.id=o.id,e.portal=this.portal,e.loaded?e.reload():e.load()))}deleteItem(t){let e=this.userContentUrl;return t.ownerFolder&&(e+="/"+t.ownerFolder),this.portal.request(e+`/items/${t.id}/delete`,{method:"post"}).then(()=>{t.id=null,t.portal=null})}deleteItems(t){const e=this.userContentUrl+"/deleteItems",i=t.map(r=>r.id);if(i.length){const r={method:"post",query:{items:i.join(",")}};return this.portal.request(e,r).then(()=>{t.forEach(n=>{n.id=null,n.portal=null})})}return Promise.resolve(void 0)}fetchFolders(){const t={query:{num:1}};return this.portal.request(this.userContentUrl??"",t).then(e=>{let i;return i=e&&e.folders?e.folders.map(r=>{const n=HXe.fromJSON(r);return n.portal=this.portal,n}):[],i})}fetchGroups(){return this.portal.request(this.url??"").then(t=>{let e;return e=t&&t.groups?t.groups.map(i=>{const r=PZ.fromJSON(i);return r.portal=this.portal,r}):[],e})}fetchItems(t){const e=t??{};let i,r=this.userContentUrl??"";return e.folder&&(r+="/"+e.folder.id),Q(()=>Promise.resolve().then(()=>VPe),void 0).then(({default:n})=>{i=n;const s={folders:!1,num:e.num||10,start:e.start||1,sortField:e.sortField||"created",sortOrder:e.sortOrder||"asc"};return this.portal.request(r,{query:s})}).then(n=>{let s;return n&&n.items?(s=n.items.map(o=>{const a=i.fromJSON(o);return a.portal=this.portal,a}),Promise.all(s.map(o=>o.load())).catch(o=>o).then(()=>({items:s,nextStart:n.nextStart,total:n.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal.request(this.url+"/tags").then(t=>t.tags)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}queryFavorites(t){return this.favGroupId?(this._favGroup||(this._favGroup=new PZ({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(t)):Promise.reject(new H("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new H("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new IZ;return e.sourceJSON=t,e.read(t),e}};u([d()],Bn.prototype,"access",void 0),u([d({type:Date})],Bn.prototype,"created",void 0),u([d()],Bn.prototype,"culture",void 0),u([d()],Bn.prototype,"description",void 0),u([d()],Bn.prototype,"email",void 0),u([d()],Bn.prototype,"favGroupId",void 0),u([d()],Bn.prototype,"fullName",void 0),u([d({type:Date})],Bn.prototype,"modified",void 0),u([d()],Bn.prototype,"orgId",void 0),u([d()],Bn.prototype,"portal",void 0),u([d()],Bn.prototype,"preferredView",void 0),u([d()],Bn.prototype,"privileges",void 0),u([d()],Bn.prototype,"region",void 0),u([d()],Bn.prototype,"role",void 0),u([d()],Bn.prototype,"roleId",void 0),u([d()],Bn.prototype,"sourceJSON",void 0),u([d()],Bn.prototype,"thumbnail",void 0),u([d({readOnly:!0})],Bn.prototype,"thumbnailUrl",null),u([d()],Bn.prototype,"units",void 0),u([d({readOnly:!0})],Bn.prototype,"userContentUrl",null),u([d({readOnly:!0})],Bn.prototype,"url",null),u([d()],Bn.prototype,"username",void 0),u([d()],Bn.prototype,"userType",void 0),Bn=IZ=u([$("esri.portal.PortalUser")],Bn);const ese=Bn,WXe=Object.freeze(Object.defineProperty({__proto__:null,default:ese},Symbol.toStringTag,{value:"Module"}));var vh;let Yj;const gde={PortalGroup:()=>Q(()=>Promise.resolve().then(()=>qXe),void 0),PortalItem:()=>Q(()=>Promise.resolve().then(()=>VPe),void 0),PortalUser:()=>Q(()=>Promise.resolve().then(()=>WXe),void 0)};let We=vh=class extends Pw(Ju){constructor(t){super(t),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=nr.portalUrl,this.urlKey=null,this.user=null,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(t){return typeof t=="string"?{url:t}:t}destroy(){this._esriIdCredentialCreateHandle=Nr(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(t){if(t)for(const e of t)nr.request.trustedServers.includes(e)||nr.request.trustedServers.push(e);return t}readDefaultBasemap(t){return this._readBasemap(t)}readDefaultDevBasemap(t){return this._readBasemap(t)}readDefaultVectorBasemap(t){return this._readBasemap(t)}get extraQuery(){const t=!(this.user&&this.user.orgId)||this.canSearchPublic;return this.id&&!t?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let t=this.url;if(t){const e=t.indexOf("/sharing");t=e>0?t.substring(0,e):this.url.replace(/\/+$/,""),t+="/sharing/rest"}return t}get thumbnailUrl(){const t=this.restUrl,e=this.thumbnail;return t&&e?this._normalizeSSL(t+"/portals/self/resources/"+e):null}readUrlKey(t){return t&&t.toLowerCase()}readUser(t){let e=null;return t&&(e=ese.fromJSON(t),e.portal=this),e}load(t){const e=Q(()=>Promise.resolve().then(()=>ght),void 0).then(({default:i})=>{ui(t),Yj=i}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,t)).then(i=>{if(Ir){const r=Ir;this.credential=r.findCredential(this.restUrl),this.credential||this.authMode!==vh.AUTH_MODE_AUTO||(this._esriIdCredentialCreateHandle=r.on("credential-create",()=>{r.findCredential(this.restUrl)&&this.signIn().catch(()=>{})}))}this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(e),Promise.resolve(this)}async createElevationLayers(){await this.load();const t=this._getHelperService("defaultElevationLayers"),e=(await Q(()=>import("./ElevationLayer-26e170dd.js"),["assets/ElevationLayer-26e170dd.js","assets/ArcGISCachedService-32f42233.js","assets/TilemapCache-dd1c5037.js"])).default;return t?t.map(i=>new e({id:i.id,url:i.url})):[]}fetchBasemaps(t,e){const i=new B0;return i.query=t||(nr.apiKey&&JCe(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),i.disableExtraQuery=!0,this.queryGroups(i,e).then(r=>{if(i.num=100,i.query='type:"Web Map" -type:"Web Application"',r.total){const n=r.results[0];return i.sortField=n.sortField||"name",i.sortOrder=n.sortOrder||"desc",n.queryItems(i,e)}return null}).then(r=>{let n;return n=r&&r.total?r.results.filter(s=>s.type==="Web Map").map(s=>new Yj({portalItem:s})):[],n})}fetchCategorySchema(t){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",t).then(e=>e.categorySchema):fo(t)?Promise.reject(Bi()):Promise.resolve([])}fetchFeaturedGroups(t){const e=this.featuredGroups,i=new B0;if(i.num=100,i.sortField="title",e&&e.length){const r=[];for(const n of e)r.push(`(title:"${n.title}" AND owner:${n.owner})`);return i.query=r.join(" OR "),this.queryGroups(i,t).then(n=>n.results)}return fo(t)?Promise.reject(Bi()):Promise.resolve([])}fetchRegions(t){var i;const e=((i=this.user)==null?void 0:i.culture)||this.culture||wp();return this.request(this.restUrl+"/portals/regions",{...t,query:{culture:e}})}fetchSettings(t){var i;const e=((i=this.user)==null?void 0:i.culture)||this.culture||wp();return this.request(this.restUrl+"/portals/self/settings",{...t,query:{culture:e}})}static getDefault(){return vh._default&&!vh._default.destroyed||(vh._default=new vh),vh._default}queryGroups(t,e){return this.queryPortal("/community/groups",t,"PortalGroup",e)}queryItems(t,e){return this.queryPortal("/search",t,"PortalItem",e)}queryUsers(t,e){return t.sortField||(t.sortField="username"),this.queryPortal("/community/users",t,"PortalUser",e)}fetchSelf(t=this.authMode,e=!1,i){const r=this.restUrl+"/portals/self",n={authMode:t,query:{culture:wp().toLowerCase()},...i};return n.authMode==="auto"&&(n.authMode="no-prompt"),e&&(n.query.default=!0),this.request(r,n)}queryPortal(t,e,i,r){const n=Ts(B0,e),s=o=>this.request(this.restUrl+t,{...n.toRequestOptions(this),...r}).then(a=>{const l=n.clone();return l.start=a.nextStart,new GXe({nextQueryParams:l,queryParams:n,total:a.total,results:vh._resultsToTypedArray(o,{portal:this},a,r)})}).then(a=>Promise.all(a.results.map(l=>typeof l.when=="function"?l.when():a)).then(()=>a,l=>(Du(l),a)));return i&&gde[i]?gde[i]().then(({default:o})=>(ui(r),s(o))):s()}signIn(){if(this.authMode===vh.AUTH_MODE_ANONYMOUS)return Promise.reject(new H("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const t=e=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(e||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=e,this.fetchSelf("immediate"))):this.user&&this.credential===e?null:(this.credential=e,this.fetchSelf("immediate"))).then(i=>{i&&(this.sourceJSON=i,this.read(i))});return Ir?Ir.getCredential(this.restUrl).then(e=>t(e)):t(this.credential)}normalizeUrl(t){const e=this.credential&&this.credential.token;return this._normalizeSSL(e?t+(t.includes("?")?"&":"?")+"token="+e:t)}requestToTypedArray(t,e,i){return this.request(t,e).then(r=>{const n=vh._resultsToTypedArray(i,{portal:this},r);return Promise.all(n.map(s=>typeof s.when=="function"?s.when():r)).then(()=>n,()=>n)})}request(t,e={}){const i={f:"json",...e.query},{authMode:r=this.authMode===vh.AUTH_MODE_ANONYMOUS?"anonymous":"auto",body:n=null,cacheBust:s=!1,method:o="auto",responseType:a="json",signal:l}=e,c={authMode:r,body:n,cacheBust:s,method:o,query:i,responseType:a,timeout:0,signal:l};return ir(this._normalizeSSL(t),c).then(h=>h.data)}toJSON(){throw new H("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new vh({sourceJSON:t})}_getHelperService(t){const e=this.helperServices&&this.helperServices[t];if(!e)throw new H("portal:service-not-found",`The \`helperServices\` do not include an entry named "${t}"`);return e}_normalizeSSL(t){return t.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(t){if(t){const e=Yj.fromJSON(t);return e.portalItem={portal:this},e}return null}static _resultsToTypedArray(t,e,i,r){let n=[];if(i){const s=v(r)?r.signal:null;n=i.listings||i.notifications||i.userInvitations||i.tags||i.items||i.groups||i.comments||i.provisions||i.results||i.relatedItems||i,(t||e)&&(n=n.map(o=>{const a=Object.assign(t?t.fromJSON(o):o,e);return typeof a.load=="function"&&a.load(s),a}))}else n=[];return n}};We.AUTH_MODE_ANONYMOUS="anonymous",We.AUTH_MODE_AUTO="auto",We.AUTH_MODE_IMMEDIATE="immediate",u([d()],We.prototype,"access",void 0),u([d()],We.prototype,"allSSL",void 0),u([d()],We.prototype,"authMode",void 0),u([d()],We.prototype,"authorizedCrossOriginDomains",void 0),u([Oe("authorizedCrossOriginDomains")],We.prototype,"readAuthorizedCrossOriginDomains",null),u([d()],We.prototype,"basemapGalleryGroupQuery",void 0),u([d()],We.prototype,"bingKey",void 0),u([d()],We.prototype,"canListApps",void 0),u([d()],We.prototype,"canListData",void 0),u([d()],We.prototype,"canListPreProvisionedItems",void 0),u([d()],We.prototype,"canProvisionDirectPurchase",void 0),u([d()],We.prototype,"canSearchPublic",void 0),u([d()],We.prototype,"canShareBingPublic",void 0),u([d()],We.prototype,"canSharePublic",void 0),u([d()],We.prototype,"canSignInArcGIS",void 0),u([d()],We.prototype,"canSignInIDP",void 0),u([d()],We.prototype,"colorSetsGroupQuery",void 0),u([d()],We.prototype,"commentsEnabled",void 0),u([d({type:Date})],We.prototype,"created",void 0),u([d()],We.prototype,"credential",void 0),u([d()],We.prototype,"culture",void 0),u([d()],We.prototype,"currentVersion",void 0),u([d()],We.prototype,"customBaseUrl",void 0),u([d()],We.prototype,"defaultBasemap",void 0),u([Oe("defaultBasemap")],We.prototype,"readDefaultBasemap",null),u([d()],We.prototype,"defaultDevBasemap",void 0),u([Oe("defaultDevBasemap")],We.prototype,"readDefaultDevBasemap",null),u([d({type:ni})],We.prototype,"defaultExtent",void 0),u([d()],We.prototype,"defaultVectorBasemap",void 0),u([Oe("defaultVectorBasemap")],We.prototype,"readDefaultVectorBasemap",null),u([d()],We.prototype,"description",void 0),u([d()],We.prototype,"devBasemapGalleryGroupQuery",void 0),u([d()],We.prototype,"eueiEnabled",void 0),u([d({readOnly:!0})],We.prototype,"extraQuery",null),u([d()],We.prototype,"featuredGroups",void 0),u([d()],We.prototype,"featuredItemsGroupQuery",void 0),u([d()],We.prototype,"galleryTemplatesGroupQuery",void 0),u([d()],We.prototype,"livingAtlasGroupQuery",void 0),u([d()],We.prototype,"hasCategorySchema",void 0),u([d()],We.prototype,"helpBase",void 0),u([d()],We.prototype,"helperServices",void 0),u([d()],We.prototype,"helpMap",void 0),u([d()],We.prototype,"homePageFeaturedContent",void 0),u([d()],We.prototype,"homePageFeaturedContentCount",void 0),u([d()],We.prototype,"httpPort",void 0),u([d()],We.prototype,"httpsPort",void 0),u([d()],We.prototype,"id",void 0),u([d()],We.prototype,"ipCntryCode",void 0),u([d({readOnly:!0})],We.prototype,"isOrganization",null),u([d()],We.prototype,"isPortal",void 0),u([d()],We.prototype,"isReadOnly",void 0),u([d({readOnly:!0})],We.prototype,"itemPageUrl",null),u([d()],We.prototype,"layerTemplatesGroupQuery",void 0),u([d()],We.prototype,"maxTokenExpirationMinutes",void 0),u([d({type:Date})],We.prototype,"modified",void 0),u([d()],We.prototype,"name",void 0),u([d()],We.prototype,"portalHostname",void 0),u([d()],We.prototype,"portalMode",void 0),u([d()],We.prototype,"portalProperties",void 0),u([d()],We.prototype,"region",void 0),u([d({readOnly:!0})],We.prototype,"restUrl",null),u([d()],We.prototype,"rotatorPanels",void 0),u([d()],We.prototype,"showHomePageDescription",void 0),u([d()],We.prototype,"sourceJSON",void 0),u([d()],We.prototype,"staticImagesUrl",void 0),u([d({json:{name:"2DStylesGroupQuery"}})],We.prototype,"stylesGroupQuery2d",void 0),u([d({json:{name:"stylesGroupQuery"}})],We.prototype,"stylesGroupQuery3d",void 0),u([d()],We.prototype,"supportsHostedServices",void 0),u([d()],We.prototype,"symbolSetsGroupQuery",void 0),u([d()],We.prototype,"templatesGroupQuery",void 0),u([d()],We.prototype,"thumbnail",void 0),u([d({readOnly:!0})],We.prototype,"thumbnailUrl",null),u([d()],We.prototype,"units",void 0),u([d()],We.prototype,"url",void 0),u([d()],We.prototype,"urlKey",void 0),u([Oe("urlKey")],We.prototype,"readUrlKey",null),u([d()],We.prototype,"user",void 0),u([Oe("user")],We.prototype,"readUser",null),u([d()],We.prototype,"useStandardizedQuery",void 0),u([d()],We.prototype,"useVectorBasemaps",void 0),u([d()],We.prototype,"vectorBasemapGalleryGroupQuery",void 0),We=vh=u([$("esri.portal.Portal")],We);const ya=We;let Jx=class extends xr(fe){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return v(e)&&e.placement===this.placement&&e.style===this.style&&(R(this.color)&&R(e.color)||v(this.color)&&v(e.color)&&this.color.toJSON()===e.color.toJSON())}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],Jx.prototype,"type",void 0),u([d({type:aWe,json:{default:"begin-end",write:!0}})],Jx.prototype,"placement",void 0),u([d({type:gCe,json:{default:"arrow",write:!0}})],Jx.prototype,"style",void 0),u([d({type:Xe,json:{type:[Kr],default:null,write:!0}})],Jx.prototype,"color",void 0),Jx=u([$("esri.symbols.LineStyleMarker3D")],Jx);const $Z=Jx;var E6;let ng=E6=class extends Ty{constructor(t){super(t),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=Ip(1),this.pattern=null,this.marker=null}clone(){const t={enabled:this.enabled,material:v(this.material)?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:v(this.pattern)?this.pattern.clone():null,marker:v(this.marker)?this.marker.clone():null};return new E6(t)}static fromSimpleLineSymbol(t){var i;const e={enabled:!0,size:t.width??Ip(1),cap:t.cap||"butt",join:t.join||"miter",pattern:t.style&&t.style!=="inside-frame"?new Lne({style:t.style}):null,material:new td({color:(t.color||S$).clone()}),marker:t.marker?new $Z({placement:t.marker.placement,style:t.marker.style,color:((i=t.marker.color)==null?void 0:i.clone())??null}):null};return new E6(e)}};u([d({type:td,json:{write:!0}})],ng.prototype,"material",void 0),u([ot({Line:"line"},{readOnly:!0})],ng.prototype,"type",void 0),u([d({type:MCe,json:{write:!0,default:"miter"}})],ng.prototype,"join",void 0),u([d({type:zne,json:{write:!0,default:"butt"}})],ng.prototype,"cap",void 0),u([d(dy)],ng.prototype,"size",void 0),u([d(wCe)],ng.prototype,"pattern",void 0),u([d({types:{key:"type",base:$Z,typeMap:{style:$Z}},json:{write:!0}})],ng.prototype,"marker",void 0),ng=E6=u([$("esri.symbols.LineSymbol3DLayer")],ng);const SN=ng;var LZ;const XXe=Wa()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let UP=LZ=class extends fe{clone(){return new LZ({href:this.href,primitive:this.primitive})}};u([d({type:String,json:{read:Jne,write:iw}})],UP.prototype,"href",void 0),u([ot(XXe)],UP.prototype,"primitive",void 0),UP=LZ=u([$("esri.symbols.support.ObjectSymbol3DLayerResource")],UP);const iAe="sphere";var DZ;let XT=DZ=class extends ve{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new DZ({x:this.x,y:this.y,z:this.z})}};u([d({type:Number})],XT.prototype,"x",void 0),u([d({type:Number})],XT.prototype,"y",void 0),u([d({type:Number})],XT.prototype,"z",void 0),XT=DZ=u([$("esri.symbols.support.Symbol3DAnchorPosition3D")],XT);var NZ;let Il=NZ=class extends Ty{constructor(t){super(t),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new NZ({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:v(this.material)?this.material.clone():null,castShadows:this.castShadows,resource:this.resource&&this.resource.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};u([d({type:td,json:{write:!0}})],Il.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Il.prototype,"castShadows",void 0),u([d({type:UP,json:{write:!0}})],Il.prototype,"resource",void 0),u([ot({Object:"object"},{readOnly:!0})],Il.prototype,"type",void 0),u([d({type:Number,json:{write:!0}})],Il.prototype,"width",void 0),u([d({type:Number,json:{write:!0}})],Il.prototype,"height",void 0),u([d({type:Number,json:{write:!0}})],Il.prototype,"depth",void 0),u([ot({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),d({json:{default:"origin"}})],Il.prototype,"anchor",void 0),u([d({type:XT,json:{type:[Number],read:{reader:t=>new XT({x:t[0],y:t[1],z:t[2]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y,t.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Il.prototype,"anchorPosition",void 0),u([d({type:Number,json:{write:!0}})],Il.prototype,"heading",void 0),u([d({type:Number,json:{write:!0}})],Il.prototype,"tilt",void 0),u([d({type:Number,json:{write:!0}})],Il.prototype,"roll",void 0),u([d({readOnly:!0})],Il.prototype,"isPrimitive",null),Il=NZ=u([$("esri.symbols.ObjectSymbol3DLayer")],Il);const tse=Il;var FZ;let vc=FZ=class extends Ty{constructor(t){super(t),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(t,e){return t??(e.height==null&&e.size!=null?e.size:void 0)}readHeight(t,e){return t??(e.width==null&&e.size!=null?e.size:void 0)}clone(){return new FZ({enabled:this.enabled,material:v(this.material)?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};u([d({type:td,json:{write:!0}})],vc.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],vc.prototype,"castShadows",void 0),u([ot({Path:"path"},{readOnly:!0})],vc.prototype,"type",void 0),u([d({type:["circle","quad"],json:{write:!0,default:"circle"}})],vc.prototype,"profile",void 0),u([d({type:MCe,json:{write:!0,default:"miter"}})],vc.prototype,"join",void 0),u([d({type:MWe,json:{write:!0,default:"butt"}})],vc.prototype,"cap",void 0),u([d({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],vc.prototype,"width",void 0),u([Oe("width",["width","size","height"])],vc.prototype,"readWidth",null),u([d({type:Number,json:{write:!0}})],vc.prototype,"height",void 0),u([Oe("height",["height","size","width"])],vc.prototype,"readHeight",null),u([d({type:["center","bottom","top"],json:{write:!0,default:"center"}})],vc.prototype,"anchor",void 0),u([d({type:["heading","all"],json:{write:!0,default:"all"}})],vc.prototype,"profileRotation",void 0),vc=FZ=u([$("esri.symbols.PathSymbol3DLayer")],vc);const ise=vc;var kZ;let QA=kZ=class extends fe{constructor(){super(...arguments),this.color=new Xe([0,0,0,1]),this.size=0}clone(){const t={color:se(this.color),size:this.size};return new kZ(t)}};u([d(z_)],QA.prototype,"color",void 0),u([d(dy)],QA.prototype,"size",void 0),QA=kZ=u([$("esri.symbols.support.Symbol3DHalo")],QA);let C$=class extends xr(fe){constructor(e){super(e),this.color=null}};u([d(z_)],C$.prototype,"color",void 0),C$=u([$("esri.symbols.support.Symbol3DTextBackground")],C$);var C6;let hu=C6=class extends Ty{constructor(t){super(t),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(t){v(t)&&v(this._userSize)&&(t.size=this._userSize),this._set("font",t)}writeFont(t,e,i,r){const n={...r,textSymbol3D:!0};e.font=t.write({},n),delete e.font.size}get size(){return v(this._userSize)?this._userSize:v(this.font)&&this.font.size!=null?this.font.size:9}set size(t){this._userSize=t,v(this.font)&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const t=new C6({enabled:this.enabled,font:this.font&&se(this.font),halo:this.halo&&se(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:v(this.material)?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:se(this.background)});return t._userSize=this._userSize,t}static fromTextSymbol(t){return new C6({font:v(t.font)?t.font.clone():new Y9,halo:YXe(t.haloColor,t.haloSize),horizontalAlignment:t.horizontalAlignment,lineHeight:t.lineHeight,material:t.color?new td({color:t.color.clone()}):null,text:t.text,verticalAlignment:t.verticalAlignment,background:t.backgroundColor?new C$({color:t.backgroundColor.clone()}):null})}};function YXe(t,e){return t&&e!=null&&e>0?new QA({color:se(t),size:e}):null}u([d({type:Y9,json:{write:!0}})],hu.prototype,"font",null),u([Ne("font")],hu.prototype,"writeFont",null),u([d({type:QA,json:{write:!0}})],hu.prototype,"halo",void 0),u([d({...PCe,json:{default:"center",write:!0}})],hu.prototype,"horizontalAlignment",void 0),u([d({...OCe,json:{default:1,write:!0}})],hu.prototype,"lineHeight",void 0),u([d({type:td,json:{write:!0}})],hu.prototype,"material",void 0),u([d({type:C$,json:{write:!0}})],hu.prototype,"background",void 0),u([d(dy)],hu.prototype,"size",null),u([d({type:String,json:{write:!0}})],hu.prototype,"text",void 0),u([ot({Text:"text"},{readOnly:!0})],hu.prototype,"type",void 0),u([d({...ICe,json:{default:"baseline",write:!0}})],hu.prototype,"verticalAlignment",void 0),hu=C6=u([$("esri.symbols.TextSymbol3DLayer")],hu);const H2=hu;var UZ;let t1=UZ=class extends Ty{constructor(t){super(t),this.color=VZ.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new UZ({color:se(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};u([d({type:Xe,nonNullable:!0,json:{type:[Kr],write:(t,e,i)=>e[i]=t.toArray(Xe.AlphaMode.UNLESS_OPAQUE),default:()=>VZ.clone(),defaultEquals:t=>t.toCss(!0)===VZ.toCss(!0)}})],t1.prototype,"color",void 0),u([ot({Water:"water"},{readOnly:!0})],t1.prototype,"type",void 0),u([d({type:["small","medium","large"],json:{write:!0,default:"medium"}})],t1.prototype,"waterbodySize",void 0),u([d({type:Number,json:{write:!0,default:null}})],t1.prototype,"waveDirection",void 0),u([d({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],t1.prototype,"waveStrength",void 0),t1=UZ=u([$("esri.symbols.WaterSymbol3DLayer")],t1);const VZ=new Xe([0,119,190]),rAe=t1;var zZ;let Kx=zZ=class extends ve{constructor(t){super(t),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new zZ({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};u([d({type:String})],Kx.prototype,"name",void 0),u([d({type:String})],Kx.prototype,"styleUrl",void 0),u([d({type:String})],Kx.prototype,"styleName",void 0),u([d({type:ya})],Kx.prototype,"portal",void 0),Kx=zZ=u([$("esri.symbols.support.StyleOrigin")],Kx);const BZ=Kx;var jZ;let A$=jZ=class extends ve{constructor(){super(...arguments),this.url=""}clone(){return new jZ({url:this.url})}};u([d({type:String})],A$.prototype,"url",void 0),A$=jZ=u([$("esri.symbols.support.Thumbnail")],A$);const nAe={icon:db,object:tse,line:SN,path:ise,fill:TN,extrude:mCe,text:H2,water:rAe},ZXe=tt.ofType({base:Ty,key:"type",typeMap:nAe,errorContext:"symbol-layer"});let sg=class extends rh{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const i=this.__accessor__&&this.__accessor__.metadatas&&this.__accessor__.metadatas.symbolLayers,r=i&&i.type||tt;this._set("symbolLayers",new r)}get color(){return null}set color(e){this.constructed&&re.getLogger(this.declaredClass).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){rw(e,this._get("symbolLayers"))}readStyleOrigin(e,i,r){if(e.styleUrl&&e.name){const n=G2(e.styleUrl,r);return new BZ({styleUrl:n,name:e.name})}if(e.styleName&&e.name)return new BZ({portal:r&&r.portal||ya.getDefault(),styleName:e.styleName,name:e.name});r&&r.messages&&r.messages.push(new Op("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:r,definition:e}))}writeStyleOrigin(e,i,r,n){if(e.styleUrl&&e.name){let s=R_(e.styleUrl,n);Wu(s)&&(s=am(s)),i.styleOrigin={styleUrl:s,name:e.name}}else e.styleName&&e.name&&(e.portal&&n&&n.portal&&!FCe(e.portal.restUrl,n.portal.restUrl)?n&&n.messages&&n.messages.push(new Op("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):i.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof Ty||e&&nAe[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};u([d({json:{read:!1,write:!1}})],sg.prototype,"color",null),u([d({type:ZXe,nonNullable:!0,json:{write:!0}}),ri(XCe)],sg.prototype,"symbolLayers",null),u([d({type:BZ})],sg.prototype,"styleOrigin",void 0),u([Oe("styleOrigin")],sg.prototype,"readStyleOrigin",null),u([Ne("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],sg.prototype,"writeStyleOrigin",null),u([d({type:A$,json:{read:!1}})],sg.prototype,"thumbnail",void 0),u([d({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],sg.prototype,"type",void 0),sg=u([$("esri.symbols.Symbol3D")],sg);const wO=sg;let VP=class extends fe{constructor(e){super(e),this.visible=!0}clone(){}};u([d({type:["line"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],VP.prototype,"type",void 0),u([d({readOnly:!0})],VP.prototype,"visible",void 0),VP=u([$("esri.symbols.callouts.Callout3D")],VP);const sAe=VP;var GZ;let A6=GZ=class extends fe{constructor(){super(...arguments),this.color=new Xe("white")}clone(){return new GZ({color:se(this.color)})}};u([d(z_)],A6.prototype,"color",void 0),A6=GZ=u([$("esri.symbols.callouts.LineCallout3DBorder")],A6);const oAe=A6;Object.freeze(Object.defineProperty({__proto__:null,default:oAe},Symbol.toStringTag,{value:"Module"}));var HZ;let i1=HZ=class extends sAe{constructor(t){super(t),this.type="line",this.color=new Xe([0,0,0,1]),this.size=Ip(1),this.border=null}get visible(){return this.size>0&&v(this.color)&&this.color.a>0}clone(){return new HZ({color:se(this.color),size:this.size,border:se(this.border)})}};u([ot({line:"line"},{readOnly:!0})],i1.prototype,"type",void 0),u([d(z_)],i1.prototype,"color",void 0),u([d(dy)],i1.prototype,"size",void 0),u([d({type:oAe,json:{write:!0}})],i1.prototype,"border",void 0),u([d({readOnly:!0})],i1.prototype,"visible",null),i1=HZ=u([$("esri.symbols.callouts.LineCallout3D")],i1);const JXe=i1;function rse(t){if(!t)return!1;const e=t.verticalOffset;return!!e&&!(e.screenLength<=0||v(e.maxWorldLength)&&e.maxWorldLength<=0)}function aAe(t){if(!t||!t.supportsCallout||!t.supportsCallout())return!1;const e=t.callout;return!!e&&!!e.visible&&!!rse(t)}function nse(t){return t.type==="point-3d"||t.type==="label-3d"}function lAe(t){return t.horizontalAlignment==="center"}const cAe={types:{key:"type",base:sAe,typeMap:{line:JXe}},json:{write:!0}};var qZ;let AC=qZ=class extends fe{constructor(t){super(t),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new qZ({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};u([d(dy)],AC.prototype,"screenLength",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0,default:0}})],AC.prototype,"minWorldLength",void 0),u([d({type:Number,json:{write:!0}})],AC.prototype,"maxWorldLength",void 0),AC=qZ=u([$("esri.symbols.support.Symbol3DVerticalOffset")],AC);const uAe=AC;var R6;const hAe=tt.ofType({base:null,key:"type",typeMap:{text:H2}});let r1=R6=class extends wO{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new hAe,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return aAe(this)}hasVisibleVerticalOffset(){return rse(this)}clone(){return new R6({styleOrigin:se(this.styleOrigin),symbolLayers:se(this.symbolLayers),thumbnail:se(this.thumbnail),callout:se(this.callout),verticalOffset:se(this.verticalOffset)})}static fromTextSymbol(t){return new R6({symbolLayers:[H2.fromTextSymbol(t)]})}};u([d({type:uAe,json:{write:!0}})],r1.prototype,"verticalOffset",void 0),u([d(cAe)],r1.prototype,"callout",void 0),u([d({json:{read:!1,write:!1}})],r1.prototype,"styleOrigin",void 0),u([d({type:hAe})],r1.prototype,"symbolLayers",void 0),u([ot({LabelSymbol3D:"label-3d"},{readOnly:!0})],r1.prototype,"type",void 0),r1=R6=u([$("esri.symbols.LabelSymbol3D")],r1);const J9=r1;var M6;const dAe=tt.ofType({base:null,key:"type",typeMap:{line:SN,path:ise}}),KXe=tt.ofType({base:null,key:"type",typeMap:{line:SN,path:ise}});let zP=M6=class extends wO{constructor(t){super(t),this.symbolLayers=new dAe,this.type="line-3d"}clone(){return new M6({styleOrigin:se(this.styleOrigin),symbolLayers:se(this.symbolLayers),thumbnail:se(this.thumbnail)})}static fromSimpleLineSymbol(t){return new M6({symbolLayers:[SN.fromSimpleLineSymbol(t)]})}};u([d({type:dAe,json:{type:KXe}})],zP.prototype,"symbolLayers",void 0),u([ot({LineSymbol3D:"line-3d"},{readOnly:!0})],zP.prototype,"type",void 0),zP=M6=u([$("esri.symbols.LineSymbol3D")],zP);const K9=zP;let n1=class extends rh{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};u([d({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],n1.prototype,"angle",void 0),u([d({type:["simple-marker","picture-marker"],readOnly:!0})],n1.prototype,"type",void 0),u([d({type:Number,cast:vr,json:{write:!0}})],n1.prototype,"xoffset",void 0),u([d({type:Number,cast:vr,json:{write:!0}})],n1.prototype,"yoffset",void 0),u([d({type:Number,cast:t=>t==="auto"?t:vr(t),json:{write:!0}})],n1.prototype,"size",void 0),n1=u([$("esri.symbols.MarkerSymbol")],n1);const pAe=n1;var O6;const fAe=tt.ofType({base:null,key:"type",typeMap:{fill:TN}});let BP=O6=class extends wO{constructor(t){super(t),this.symbolLayers=new fAe,this.type="mesh-3d"}clone(){return new O6({styleOrigin:se(this.styleOrigin),symbolLayers:se(this.symbolLayers),thumbnail:se(this.thumbnail)})}static fromSimpleFillSymbol(t){return new O6({symbolLayers:[TN.fromSimpleFillSymbol(t)]})}};u([d({type:fAe})],BP.prototype,"symbolLayers",void 0),u([ot({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],BP.prototype,"type",void 0),BP=O6=u([$("esri.symbols.MeshSymbol3D")],BP);const Q9=BP;function QXe(t,e,i){return e.imageData?UCe({mediaType:e.contentType||"image/png",isBase64:!0,data:e.imageData}):mAe(e.url,i)}function mAe(t,e){var i;return tYe(e)&&!Wu(t)&&((i=e==null?void 0:e.layer)!=null&&i.parsedUrl)?ew(e.layer.parsedUrl.path,"images",t):G2(t,e)}function eYe(t,e,i,r){if(fd(t)){const n=vO(t);if(!n)return;e.contentType=n.mediaType,e.imageData=n.data,i&&i.imageData===e.imageData&&i.url&&iw(i.url,e,"url",r)}else iw(t,e,"url",r)}const gAe={json:{read:{source:["imageData","url"],reader:QXe},write:{writer(t,e,i,r){eYe(t,e,this.source,r)}}}},yAe={readOnly:!0,json:{read:{source:["imageData","url"],reader(t,e,i){const r={};return e.imageData&&(r.imageData=e.imageData),e.contentType&&(r.contentType=e.contentType),e.url&&(r.url=mAe(e.url,i)),r}}}};function tYe(t){var e,i;return!(t==null||t.origin!=="service"&&t.origin!=="portal-item"||((e=t.layer)==null?void 0:e.type)!=="feature"&&((i=t.layer)==null?void 0:i.type)!=="stream")}var WZ;let Ld=WZ=class extends yCe{constructor(...t){super(...t),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(t,e,i,r){if(t&&typeof t!="string"&&t.imageData==null)return t;const n={};return t&&(n.url=t),e&&(n.outline=e),i!=null&&(n.width=vr(i)),r!=null&&(n.height=vr(r)),n}clone(){const t=new WZ({color:se(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return t._set("source",se(this.source)),t}hash(){var t;return`${super.hash()}.${(t=this.color)==null?void 0:t.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};u([ot({esriPFS:"picture-fill"},{readOnly:!0})],Ld.prototype,"type",void 0),u([d(gAe)],Ld.prototype,"url",void 0),u([d({type:Number,json:{write:!0}})],Ld.prototype,"xscale",void 0),u([d({type:Number,json:{write:!0}})],Ld.prototype,"yscale",void 0),u([d({type:Number,cast:vr,json:{write:!0}})],Ld.prototype,"width",void 0),u([d({type:Number,cast:vr,json:{write:!0}})],Ld.prototype,"height",void 0),u([d({type:Number,cast:vr,json:{write:!0}})],Ld.prototype,"xoffset",void 0),u([d({type:Number,cast:vr,json:{write:!0}})],Ld.prototype,"yoffset",void 0),u([d(yAe)],Ld.prototype,"source",void 0),Ld=WZ=u([$("esri.symbols.PictureFillSymbol")],Ld);const _Ae=Ld;var XZ;let uf=XZ=class extends pAe{constructor(...t){super(...t),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string"&&t.imageData==null)return t;const r={};return t&&(r.url=t),e!=null&&(r.width=vr(e)),i!=null&&(r.height=vr(i)),r}readHeight(t,e){return e.size||t}readWidth(t,e){return e.size||t}clone(){const t=new XZ({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return t._set("source",se(this.source)),t}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};u([d({json:{write:!1}})],uf.prototype,"color",void 0),u([ot({esriPMS:"picture-marker"},{readOnly:!0})],uf.prototype,"type",void 0),u([d(gAe)],uf.prototype,"url",void 0),u([d(yAe)],uf.prototype,"source",void 0),u([d({type:Number,cast:vr,json:{write:!0}})],uf.prototype,"height",void 0),u([Oe("height",["height","size"])],uf.prototype,"readHeight",null),u([d({type:Number,cast:vr,json:{write:!0}})],uf.prototype,"width",void 0),u([d({json:{write:!1}})],uf.prototype,"size",void 0),uf=XZ=u([$("esri.symbols.PictureMarkerSymbol")],uf);const eB=uf;var Qx;const vAe=tt.ofType({base:null,key:"type",typeMap:{icon:db,object:tse,text:H2}});let eT=Qx=class extends wO{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.symbolLayers=new vAe,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const t of this.symbolLayers.items)switch(t.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return aAe(this)}hasVisibleVerticalOffset(){return rse(this)}clone(){return new Qx({verticalOffset:se(this.verticalOffset),callout:se(this.callout),styleOrigin:se(this.styleOrigin),symbolLayers:se(this.symbolLayers),thumbnail:se(this.thumbnail)})}static fromSimpleMarkerSymbol(t){return new Qx({symbolLayers:[db.fromSimpleMarkerSymbol(t)]})}static fromPictureMarkerSymbol(t){return new Qx({symbolLayers:[db.fromPictureMarkerSymbol(t)]})}static fromCIMSymbol(t){var r,n;if(((n=(r=t.data)==null?void 0:r.symbol)==null?void 0:n.type)!=="CIMPointSymbol")return null;const i=t.data.symbol;return new Qx(i!=null&&i.callout?{symbolLayers:[db.fromCIMSymbol(t)],callout:{type:"line",size:.5,color:[0,0,0]},verticalOffset:{screenLength:40}}:{symbolLayers:[db.fromCIMSymbol(t)]})}static fromTextSymbol(t){return new Qx({symbolLayers:[H2.fromTextSymbol(t)]})}};u([d({type:uAe,json:{write:!0}})],eT.prototype,"verticalOffset",void 0),u([d(cAe)],eT.prototype,"callout",void 0),u([d({type:vAe,json:{origins:{"web-scene":{write:!0}}}})],eT.prototype,"symbolLayers",void 0),u([ot({PointSymbol3D:"point-3d"},{readOnly:!0})],eT.prototype,"type",void 0),eT=Qx=u([$("esri.symbols.PointSymbol3D")],eT);const pb=eT;var jP;const bAe=tt.ofType({base:null,key:"type",typeMap:{extrude:mCe,fill:TN,icon:db,line:SN,object:tse,text:H2,water:rAe}});let GP=jP=class extends wO{constructor(t){super(t),this.symbolLayers=new bAe,this.type="polygon-3d"}clone(){return new jP({styleOrigin:se(this.styleOrigin),symbolLayers:se(this.symbolLayers),thumbnail:se(this.thumbnail)})}static fromJSON(t){const e=new jP;if(e.read(t),e.symbolLayers.length===2&&e.symbolLayers.getItemAt(0).type==="fill"&&e.symbolLayers.getItemAt(1).type==="line"){const i=e.symbolLayers.getItemAt(0),r=e.symbolLayers.getItemAt(1);!r.enabled||t.symbolLayers&&t.symbolLayers[1]&&t.symbolLayers[1].enable===!1||(i.outline={size:r.size,color:v(r.material)?r.material.color:null}),e.symbolLayers.removeAt(1)}return e}static fromSimpleFillSymbol(t){return new jP({symbolLayers:[TN.fromSimpleFillSymbol(t)]})}};u([d({type:bAe,json:{write:!0}})],GP.prototype,"symbolLayers",void 0),u([ot({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],GP.prototype,"type",void 0),GP=jP=u([$("esri.symbols.PolygonSymbol3D")],GP);const EN=GP;var YZ;const Zj=new mi({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let tT=YZ=class extends yCe{constructor(...t){super(...t),this.color=new Xe([0,0,0,.25]),this.outline=new Vp,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string")return t;const r={};return t&&(r.style=t),e&&(r.outline=e),i&&(r.color=i),r}clone(){return new YZ({color:se(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};u([d()],tT.prototype,"color",void 0),u([d()],tT.prototype,"outline",void 0),u([ot({esriSFS:"simple-fill"},{readOnly:!0})],tT.prototype,"type",void 0),u([d({type:Zj.apiValues,json:{read:Zj.read,write:Zj.write}})],tT.prototype,"style",void 0),tT=YZ=u([$("esri.symbols.SimpleFillSymbol")],tT);const Dw=tT;var ZZ;const Jj=new mi({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let og=ZZ=class extends pAe{constructor(...t){super(...t),this.color=new Xe([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new Vp}normalizeCtorArgs(t,e,i,r){if(t&&typeof t!="string")return t;const n={};return t&&(n.style=t),e!=null&&(n.size=vr(e)),i&&(n.outline=i),r&&(n.color=r),n}writeColor(t,e){t&&this.style!=="x"&&this.style!=="cross"&&(e.color=t.toJSON()),t===null&&(e.color=null)}set path(t){this.style="path",this._set("path",t)}clone(){return new ZZ({angle:this.angle,color:se(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var t;return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${(t=this.outline)==null?void 0:t.hash()}`}};u([d()],og.prototype,"color",void 0),u([Ne("color")],og.prototype,"writeColor",null),u([ot({esriSMS:"simple-marker"},{readOnly:!0})],og.prototype,"type",void 0),u([d()],og.prototype,"size",void 0),u([d({type:Jj.apiValues,json:{read:Jj.read,write:Jj.write}})],og.prototype,"style",void 0),u([d({type:String,json:{write:!0}})],og.prototype,"path",null),u([d({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Vp}},json:{default:null,write:!0}})],og.prototype,"outline",void 0),og=ZZ=u([$("esri.symbols.SimpleMarkerSymbol")],og);const Nw=og;var JZ;let ns=JZ=class extends rh{constructor(...t){super(...t),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new Y9,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string")return t;const r={};return t&&(r.text=t),e&&(r.font=e),i&&(r.color=i),r}writeLineWidth(t,e,i,r){r&&typeof r!="string"?r.origin:e[i]=t}castLineWidth(t){return vr(t)}writeLineHeight(t,e,i,r){r&&typeof r!="string"?r.origin:e[i]=t}clone(){return new JZ({angle:this.angle,backgroundColor:se(this.backgroundColor),borderLineColor:se(this.borderLineColor),borderLineSize:this.borderLineSize,color:se(this.color),font:this.font&&this.font.clone(),haloColor:se(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var t;return`${this.backgroundColor&&this.backgroundColor.hash()}.${this.borderLineColor}.${this.borderLineSize}.${(t=this.color)==null?void 0:t.hash()}.${this.font&&this.font.hash()}.${this.haloColor&&this.haloColor.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};u([d({type:Xe,json:{write:!0}})],ns.prototype,"backgroundColor",void 0),u([d({type:Xe,json:{write:!0}})],ns.prototype,"borderLineColor",void 0),u([d({type:Number,json:{write:!0},cast:vr})],ns.prototype,"borderLineSize",void 0),u([d({type:Y9,json:{write:!0}})],ns.prototype,"font",void 0),u([d({...PCe,json:{write:!0}})],ns.prototype,"horizontalAlignment",void 0),u([d({type:Boolean,json:{write:!0}})],ns.prototype,"kerning",void 0),u([d({type:Xe,json:{write:!0}})],ns.prototype,"haloColor",void 0),u([d({type:Number,cast:vr,json:{write:!0}})],ns.prototype,"haloSize",void 0),u([d({type:Boolean,json:{write:!0}})],ns.prototype,"rightToLeft",void 0),u([d({type:Boolean,json:{write:!0}})],ns.prototype,"rotated",void 0),u([d({type:String,json:{write:!0}})],ns.prototype,"text",void 0),u([ot({esriTS:"text"},{readOnly:!0})],ns.prototype,"type",void 0),u([d({...ICe,json:{write:!0}})],ns.prototype,"verticalAlignment",void 0),u([d({type:Number,cast:vr,json:{write:!0}})],ns.prototype,"xoffset",void 0),u([d({type:Number,cast:vr,json:{write:!0}})],ns.prototype,"yoffset",void 0),u([d({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],ns.prototype,"angle",void 0),u([d({type:Number,json:{write:!0}})],ns.prototype,"width",void 0),u([d({type:Number})],ns.prototype,"lineWidth",void 0),u([Ne("lineWidth")],ns.prototype,"writeLineWidth",null),u([ri("lineWidth")],ns.prototype,"castLineWidth",null),u([d(OCe)],ns.prototype,"lineHeight",void 0),u([Ne("lineHeight")],ns.prototype,"writeLineHeight",null),ns=JZ=u([$("esri.symbols.TextSymbol")],ns);const xO=ns;var KZ;let hf=KZ=class extends rh{constructor(t){super(t),this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const t=v(this.portal)?this.portal:ya.getDefault(),e=t.user?t.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${e}:${t.url}`}read(t,e){this.portal=e==null?void 0:e.portal,super.read(t,e)}clone(){return new KZ({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(t){return this._fetchSymbol("webRef",t)}fetchCIMSymbol(t){return this._fetchSymbol("cimRef",t)}async _fetchSymbol(t,e){const i=v(e)?e.cache:null,r=i?this._fetchCacheKey:null;if(v(i)){const a=r&&i.get(r);if(a)return a.clone()}const n=await iYe();ui(e);const s=n.resolveWebStyleSymbol(this,{portal:this.portal},t,e);s.catch(a=>{re.getLogger(this.declaredClass).error("#fetchSymbol()","Failed to create symbol from style",a)});const o=await s;return t==="webRef"&&o.type==="point-3d"||t==="cimRef"&&o.type==="cim"?(v(i)&&i.set(r,o.clone()),o):null}};function iYe(){return Q(()=>import("./webStyleSymbolUtils-ac3f7cc4.js"),[])}u([d({json:{write:!1}})],hf.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],hf.prototype,"styleName",void 0),u([d({type:ya,json:{write:!1}})],hf.prototype,"portal",void 0),u([d({type:String,json:{read:Jne,write:iw}})],hf.prototype,"styleUrl",void 0),u([d({type:A$,json:{read:!1}})],hf.prototype,"thumbnail",void 0),u([d({type:String,json:{write:!0}})],hf.prototype,"name",void 0),u([ot({styleSymbolReference:"web-style"},{readOnly:!0})],hf.prototype,"type",void 0),u([d()],hf.prototype,"_fetchCacheKey",null),hf=KZ=u([$("esri.symbols.WebStyleSymbol")],hf);const q2=hf;function tB(t){if(!t)return!1;switch(t.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function EM(t){if(!t)return!1;switch(t.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const LS={base:rh,key:"type",typeMap:{"simple-fill":Dw,"picture-fill":_Ae,"picture-marker":eB,"simple-line":Vp,"simple-marker":Nw,text:xO,"label-3d":J9,"line-3d":K9,"mesh-3d":Q9,"point-3d":pb,"polygon-3d":EN,"web-style":q2,cim:yO},errorContext:"symbol"},rYe={base:rh,key:"type",typeMap:{"picture-marker":eB,"simple-marker":Nw,text:xO,"web-style":q2,cim:yO},errorContext:"symbol"},nYe=Ow({types:LS}),iB={base:rh,key:"type",typeMap:{"simple-fill":Dw,"picture-fill":_Ae,"picture-marker":eB,"simple-line":Vp,"simple-marker":Nw,text:xO,"line-3d":K9,"mesh-3d":Q9,"point-3d":pb,"polygon-3d":EN,"web-style":q2,cim:yO},errorContext:"symbol"},sYe={base:rh,key:"type",typeMap:{text:xO,"label-3d":J9},errorContext:"symbol"},yde={base:rh,key:"type",typeMap:{"line-3d":K9,"mesh-3d":Q9,"point-3d":pb,"polygon-3d":EN,"web-style":q2,cim:yO},errorContext:"symbol"},oYe={base:rh,key:"type",typeMap:{"label-3d":J9},errorContext:"symbol"},wAe=pm(LS);function aYe(t){if(!t)return null;const e={};for(const i in t){const r=ly(t[i]);r&&(e[i]=r)}return Object.keys(e).length!==0?e:null}function lYe(t){if(!v(t))return null;const e={};for(const i in t){const r=t[i];r&&(e[i]=r.toJSON())}return Object.keys(e).length!==0?e:null}let du=class extends xr(fe){constructor(...e){super(...e),this.isAggregate=!1,this.layer=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:qu(),configurable:!0})}normalizeCtorArgs(e,i,r,n){return e&&!e.declaredClass?e:{geometry:e,symbol:i,attributes:r,popupTemplate:n}}set aggregateGeometries(e){const i=this._get("aggregateGeometries");JSON.stringify(i)!==JSON.stringify(e)&&this._set("aggregateGeometries",e)}set attributes(e){const i=this._get("attributes");i!==e&&(this._set("attributes",e),this._notifyLayer("attributes",i,e))}set geometry(e){const i=this._get("geometry");i!==e&&(this._set("geometry",e),this._notifyLayer("geometry",i,e))}set symbol(e){const i=this._get("symbol");i!==e&&(this._set("symbol",e),this._notifyLayer("symbol",i,e))}set visible(e){const i=this._get("visible");i!==e&&(this._set("visible",e),this._notifyLayer("visible",i,e))}getEffectivePopupTemplate(e=!1){if(this.popupTemplate)return this.popupTemplate;for(const i of[this.sourceLayer,this.layer])if(i){if("popupTemplate"in i&&i.popupTemplate)return i.popupTemplate;if(e&&"defaultPopupTemplate"in i&&v(i.defaultPopupTemplate))return i.defaultPopupTemplate}return null}getAttribute(e){var i;return(i=this.attributes)==null?void 0:i[e]}setAttribute(e,i){if(this.attributes){const r=this.getAttribute(e);this.attributes[e]=i,this._notifyLayer("attributes",r,i,e)}else this.attributes={[e]:i},this._notifyLayer("attributes",void 0,i,e)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{aggregateGeometries:lYe(this.aggregateGeometries),geometry:v(this.geometry)?this.geometry.toJSON():null,symbol:v(this.symbol)?this.symbol.toJSON():null,attributes:{...this.attributes},popupTemplate:this.popupTemplate&&this.popupTemplate.toJSON()}}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}notifyMeshTransformChanged(){v(this.geometry)&&this.geometry.type==="mesh"&&this._notifyLayer("transform",this.geometry.transform,this.geometry.transform)}_notifyLayer(e,i,r,n){if(!this.layer||!("graphicChanged"in this.layer))return;const s={graphic:this,property:e,oldValue:i,newValue:r};e==="attributes"&&(s.attributeName=n),this.layer.graphicChanged(s)}};u([d({value:null,json:{read:aYe}})],du.prototype,"aggregateGeometries",null),u([d({value:null})],du.prototype,"attributes",null),u([d({value:null,types:Iw,json:{read:ly}})],du.prototype,"geometry",null),u([d({type:Boolean})],du.prototype,"isAggregate",void 0),u([d({clonable:"reference"})],du.prototype,"layer",void 0),u([d({type:vN})],du.prototype,"popupTemplate",void 0),u([d({clonable:"reference"})],du.prototype,"sourceLayer",void 0),u([d({value:null,types:LS})],du.prototype,"symbol",null),u([d({type:Boolean,value:!0})],du.prototype,"visible",null),du=u([$("esri.Graphic")],du),function(t){t.generateUID=qu}(du||(du={}));const Ha=du;let nw=class{constructor(e,i){this.min=e,this.max=i,this.range=i-e}ndiff(e,i=0){return Math.ceil((e-i)/this.range)*this.range+i}_normalize(e,i,r,n=0,s=!1){return(r-=n)<e?r+=this.ndiff(e-r):r>i&&(r-=this.ndiff(r-i)),s&&r===i&&(r=e),r+n}normalize(e,i=0,r=!1){return this._normalize(this.min,this.max,e,i,r)}clamp(e,i=0){return _e(e-i,this.min,this.max)+i}monotonic(e,i,r){return e<i?i:i+this.ndiff(e-i,r)}minimalMonotonic(e,i,r){return this._normalize(e,e+this.range,i,r)}center(e,i,r){return i=this.monotonic(e,i,r),this.normalize((e+i)/2,r)}diff(e,i,r){return this.monotonic(e,i,r)-e}shortestSignedDiff(e,i){e=this.normalize(e);const r=(i=this.normalize(i))-e,n=i<e?this.minimalMonotonic(e,i)-e:i-this.minimalMonotonic(i,e);return Math.abs(r)<Math.abs(n)?r:n}contains(e,i,r){return i=this.minimalMonotonic(e,i),(r=this.minimalMonotonic(e,r))>e&&r<i}};function sse(t){for(const e in t){const i=t[e];i instanceof Function&&(t[e]=i.bind(t))}return t}const cYe=sse(new nw(0,2*Math.PI)),sw=sse(new nw(-Math.PI,Math.PI)),ose=sse(new nw(0,360));let a0=class extends xr(fe){constructor(...e){super(...e),this.position=new Le([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(e,i,r,n){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const s={position:e};return i!=null&&(s.heading=i),r!=null&&(s.tilt=r),n!=null&&(s.fov=n),s}return e}writePosition(e,i,r,n){const s=e.clone();s.x=ip(e.x||0),s.y=ip(e.y||0),s.z=e.hasZ?ip(e.z||0):e.z,i[r]=s.write({},n)}readPosition(e,i){const r=new Le;return r.read(e,i),r.x=ip(r.x||0),r.y=ip(r.y||0),r.z=r.hasZ?ip(r.z||0):r.z,r}equals(e){return!R(e)&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}};u([d({type:Le,json:{write:{isRequired:!0}}})],a0.prototype,"position",void 0),u([Ne("position")],a0.prototype,"writePosition",null),u([Oe("position")],a0.prototype,"readPosition",null),u([d({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),ri(t=>ose.normalize(ip(t)))],a0.prototype,"heading",void 0),u([d({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),ri(t=>_e(ip(t),-180,180))],a0.prototype,"tilt",void 0),u([d({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],a0.prototype,"fov",void 0),a0=u([$("esri.Camera")],a0);const $p=a0;var QZ;let s1=QZ=class extends fe{constructor(t){super(t),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(t){return(t%=360)<0&&(t+=360),t}clone(){return new QZ({rotation:this.rotation,scale:this.scale,targetGeometry:v(this.targetGeometry)?this.targetGeometry.clone():null,camera:v(this.camera)?this.camera.clone():null})}};function Kj(){return{enabled:!this.camera}}u([d({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:Kj}}}}})],s1.prototype,"rotation",void 0),u([ri("rotation")],s1.prototype,"castRotation",null),u([d({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:Kj}}}}})],s1.prototype,"scale",void 0),u([d({types:Iw,json:{read:ly,write:!0,origins:{"web-scene":{read:ly,write:{overridePolicy:Kj}}}}})],s1.prototype,"targetGeometry",void 0),u([d({type:$p,json:{write:!0}})],s1.prototype,"camera",void 0),s1=QZ=u([$("esri.Viewpoint")],s1);const Jn=s1;let RC=class extends tt{constructor(e){super(e),this.getCollections=null}initialize(){this.own(w2e(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const e=v(this.getCollections)?this.getCollections():null;if(R(e))return void this.removeAll();let i=0;for(const r of e)v(r)&&(i=this._processCollection(i,r));this.splice(i,this.length)}_createNewInstance(e){return new tt(e)}_processCollection(e,i){if(!i)return e;const r=this.itemFilterFunction?this.itemFilterFunction:n=>!!n;for(const n of i)if(n){if(r(n)){const s=this.indexOf(n,e);s>=0?s!==e&&this.reorder(n,e):this.add(n,e),++e}if(this.getChildrenFunction){const s=this.getChildrenFunction(n);if(Array.isArray(s))for(const o of s)e=this._processCollection(e,o);else e=this._processCollection(e,s)}}return e}};u([d()],RC.prototype,"getCollections",void 0),u([d()],RC.prototype,"getChildrenFunction",void 0),u([d()],RC.prototype,"itemFilterFunction",void 0),RC=u([$("esri.core.CollectionFlattener")],RC);const CM=RC;function ne(t,e,i={}){return ase(t,e,i,xAe)}function yo(t,e,i={}){return ase(t,e,i,TAe)}function ase(t,e,i={},r){let n=null;const s=i.once?(o,a)=>{r(o)&&(Nr(n),e(o,a))}:(o,a)=>{r(o)&&e(o,a)};if(n=Uje(t,s,i.sync,i.equals),i.initial){const o=t();s(o,o)}return n}function Kn(t,e,i,r={}){let n=null,s=null,o=null;function a(){var h;n&&s&&(s.remove(),(h=r.onListenerRemove)==null||h.call(r,n),n=null,s=null)}function l(h){r.once&&r.once&&Nr(o),i(h)}const c=ne(t,(h,p)=>{var f;a(),M9(h)&&(n=h,s=fN(h,e,l),(f=r.onListenerAdd)==null||f.call(r,h))},{sync:r.sync,initial:!0});return o=fm(()=>{c.remove(),a()}),o}function ow(t,e){return uYe(t,TAe,e)}function uYe(t,e,i){if(fo(i))return Promise.reject(Bi());const r=t();if(e!=null&&e(r))return Promise.resolve(r);let n=null;function s(){n=Nr(n)}return new Promise((o,a)=>{n=hM([ja(i,()=>{s(),a(Bi())}),ase(t,l=>{s(),o(l)},{sync:!1,once:!0},e??xAe)])})}function xAe(t){return!0}function TAe(t){return!!t}function hYe(t,e,i={}){let r=!1;const n=ne(t,(s,o)=>{r||e(s,o)},i);return{remove(){n.remove()},pause(){r=!0},resume(){r=!1}}}const Ki={sync:!0},zt={initial:!0},Jr={sync:!0,initial:!0};let dV=class{constructor(e=i=>i.values().next().value){this._peeker=e,this._items=new Set}get length(){return this._items.size}clear(){this._items.clear()}last(){if(this._items.size===0)return;let e;for(e of this._items);return e}peek(){if(this._items.size!==0)return this._peeker(this._items)}push(e){this.contains(e)||this._items.add(e)}contains(e){return this._items.has(e)}pop(){if(this.length===0)return;const e=this.peek();return this._items.delete(e),e}popLast(){if(this.length===0)return;const e=this.last();return this._items.delete(e),e}remove(e){this._items.delete(e)}filter(e){return this._items.forEach(i=>{e(i)||this._items.delete(i)}),this}};var Na;(function(t){t[t.HANDSHAKE=0]="HANDSHAKE",t[t.OPEN=1]="OPEN",t[t.OPENED=2]="OPENED",t[t.RESPONSE=3]="RESPONSE",t[t.INVOKE=4]="INVOKE",t[t.ABORT=5]="ABORT",t[t.CLOSE=6]="CLOSE",t[t.OPEN_PORT=7]="OPEN_PORT",t[t.ON=8]="ON"})(Na||(Na={}));let dYe=0;function SAe(){return dYe++}function pYe(t){return t&&typeof t=="object"&&("result"in t||"transferList"in t)}function KL(t){return t?typeof t=="string"?JSON.stringify({name:"message",message:t}):t.toJSON?JSON.stringify(t):JSON.stringify({name:t.name,message:t.message,details:t.details||{stack:t.stack}}):null}function lse(t,e,i,r){if(e.type===Na.OPEN_PORT)return void t.postMessage(e,[e.port]);if(e.type!==Na.INVOKE&&e.type!==Na.RESPONSE)return void t.postMessage(e);let n;if(pYe(i)?(n=_de(i.transferList),e.data=i.result):(n=_de(r),e.data=i),n){if(ue("ff")){for(const s of n)if("byteLength"in s&&s.byteLength>267386880){const o="Worker call with large ArrayBuffer would crash Firefox";switch(e.type){case Na.INVOKE:throw o;case Na.RESPONSE:return void lse(t,{type:Na.RESPONSE,jobId:e.jobId,error:KL(o)})}}}t.postMessage(e,n)}else t.postMessage(e)}function QL(t){if(!t)return null;const e=t.data;return e?typeof e=="string"?JSON.parse(e):e:null}function _de(t){if(!t||!t.length)return null;if(ue("esri-workers-arraybuffer-transfer"))return t;const e=t.filter(i=>!fYe(i));return e.length?e:null}function fYe(t){return t instanceof ArrayBuffer||t&&t.constructor&&t.constructor.name==="ArrayBuffer"}const mYe={statsWorker:()=>Q(()=>import("./statsWorker-8b56416d.js"),["assets/statsWorker-8b56416d.js","assets/utils-15a7108f.js","assets/generateRendererUtils-e2b7324f.js"]),geometryEngineWorker:()=>Q(()=>import("./geometryEngineWorker-8a57eda3.js"),["assets/geometryEngineWorker-8a57eda3.js","assets/geometryEngineJSON-3f330436.js","assets/geometryEngineBase-e1a33b0a.js","assets/json-48e3ea08.js"]),CSVSourceWorker:()=>Q(()=>import("./CSVSourceWorker-fbef90e6.js"),["assets/CSVSourceWorker-fbef90e6.js","assets/json-48e3ea08.js","assets/FeatureStore-198512e7.js","assets/optimizedFeatureQueryEngineAdapter-a67931c5.js","assets/centroid-c62179b0.js","assets/utils-7734a0d6.js","assets/projectionSupport-2f167231.js","assets/QueryEngine-e7f31776.js","assets/QueryEngineResult-2dd0323b.js","assets/WhereClause-cdddccc4.js","assets/executionError-fb3f283a.js","assets/utils-15a7108f.js","assets/generateRendererUtils-e2b7324f.js","assets/QueryEngineCapabilities-42e44ded.js","assets/timeSupport-d318046f.js","assets/number-beae30ff.js","assets/clientSideDefaults-17bf364d.js"]),EdgeProcessingWorker:()=>Q(()=>import("./EdgeProcessingWorker-770d9a12.js"),[]),ElevationSamplerWorker:()=>Q(()=>import("./ElevationSamplerWorker-b765cfc4.js"),["assets/ElevationSamplerWorker-b765cfc4.js","assets/georeference-ecba025e.js"]),FeatureServiceSnappingSourceWorker:()=>Q(()=>import("./FeatureServiceSnappingSourceWorker-9938d614.js"),["assets/FeatureServiceSnappingSourceWorker-9938d614.js","assets/FeatureStore-198512e7.js","assets/optimizedFeatureQueryEngineAdapter-a67931c5.js","assets/centroid-c62179b0.js","assets/utils-7734a0d6.js","assets/projectionSupport-2f167231.js","assets/json-48e3ea08.js","assets/QueryEngine-e7f31776.js","assets/QueryEngineResult-2dd0323b.js","assets/WhereClause-cdddccc4.js","assets/executionError-fb3f283a.js","assets/utils-15a7108f.js","assets/generateRendererUtils-e2b7324f.js","assets/QueryEngineCapabilities-42e44ded.js","assets/timeSupport-d318046f.js","assets/symbologySnappingCandidates-271b7ecb.js"]),GeoJSONSourceWorker:()=>Q(()=>import("./GeoJSONSourceWorker-cac17e90.js"),["assets/GeoJSONSourceWorker-cac17e90.js","assets/FeatureStore-198512e7.js","assets/optimizedFeatureQueryEngineAdapter-a67931c5.js","assets/centroid-c62179b0.js","assets/utils-7734a0d6.js","assets/projectionSupport-2f167231.js","assets/json-48e3ea08.js","assets/QueryEngine-e7f31776.js","assets/QueryEngineResult-2dd0323b.js","assets/WhereClause-cdddccc4.js","assets/executionError-fb3f283a.js","assets/utils-15a7108f.js","assets/generateRendererUtils-e2b7324f.js","assets/QueryEngineCapabilities-42e44ded.js","assets/timeSupport-d318046f.js","assets/geojson-a4357d4f.js","assets/clientSideDefaults-17bf364d.js","assets/sourceUtils-f57a25fd.js"]),LercWorker:()=>Q(()=>import("./LercWorker-5a3b9fdf.js"),[]),MemorySourceWorker:()=>Q(()=>import("./MemorySourceWorker-82ba9870.js"),["assets/MemorySourceWorker-82ba9870.js","assets/objectIdUtils-789e911a.js","assets/FeatureStore-198512e7.js","assets/optimizedFeatureQueryEngineAdapter-a67931c5.js","assets/centroid-c62179b0.js","assets/utils-7734a0d6.js","assets/projectionSupport-2f167231.js","assets/json-48e3ea08.js","assets/QueryEngine-e7f31776.js","assets/QueryEngineResult-2dd0323b.js","assets/WhereClause-cdddccc4.js","assets/executionError-fb3f283a.js","assets/utils-15a7108f.js","assets/generateRendererUtils-e2b7324f.js","assets/QueryEngineCapabilities-42e44ded.js","assets/timeSupport-d318046f.js","assets/clientSideDefaults-17bf364d.js","assets/sourceUtils-f57a25fd.js"]),PBFDecoderWorker:()=>Q(()=>import("./PBFDecoderWorker-fea83092.js"),[]),Pipeline:()=>Q(()=>import("./Pipeline-5a77977c.js"),["assets/Pipeline-5a77977c.js","assets/QueryEngine-e7f31776.js","assets/QueryEngineResult-2dd0323b.js","assets/WhereClause-cdddccc4.js","assets/executionError-fb3f283a.js","assets/utils-15a7108f.js","assets/generateRendererUtils-e2b7324f.js","assets/projectionSupport-2f167231.js","assets/json-48e3ea08.js","assets/utils-7734a0d6.js","assets/QueryEngineCapabilities-42e44ded.js","assets/timeSupport-d318046f.js","assets/FeatureStore2D-253af554.js","assets/CircularArray-724bafc9.js","assets/ComputedAttributeStorage-a0054ede.js","assets/arcadeTimeUtils-21c68d00.js","assets/centroid-c62179b0.js","assets/definitions-3ddd14a8.js","assets/visualVariablesUtils-3c7f6581.js","assets/color-ecd22285.js","assets/enums-4b2a86a0.js","assets/enums-b1d611e3.js","assets/number-b10bd8f5.js","assets/visualVariablesUtils-6323c511.js","assets/ogcFeatureUtils-b34315aa.js","assets/geojson-a4357d4f.js","assets/clientSideDefaults-17bf364d.js","assets/StreamFeatureManager-74396e01.js","assets/createConnection-2241a850.js"]),PointCloudWorker:()=>Q(()=>import("./PointCloudWorker-65e1c188.js"),["assets/PointCloudWorker-65e1c188.js","assets/PointCloudWorkerUtil-a766efc2.js","assets/PointCloudUniqueValueRenderer-f4ad8c34.js","assets/I3SBinaryReader-099159c4.js"]),RasterWorker:()=>Q(()=>import("./RasterWorker-6ff381ac.js"),["assets/RasterWorker-6ff381ac.js","assets/dataUtils-6f18e1a2.js","assets/RasterSymbolizer-51daf1e2.js","assets/colorUtils-c0f43caf.js","assets/utils-5f5da799.js","assets/rasterProjectionHelper-c7164d08.js"]),SceneLayerSnappingSourceWorker:()=>Q(()=>import("./SceneLayerSnappingSourceWorker-0dea3c05.js"),["assets/SceneLayerSnappingSourceWorker-0dea3c05.js","assets/QueryEngineResult-2dd0323b.js","assets/WhereClause-cdddccc4.js","assets/executionError-fb3f283a.js","assets/utils-15a7108f.js","assets/generateRendererUtils-e2b7324f.js","assets/projectionSupport-2f167231.js","assets/json-48e3ea08.js","assets/utils-7734a0d6.js"]),SceneLayerWorker:()=>Q(()=>import("./SceneLayerWorker-84f410be.js").then(t=>t.S),["assets/SceneLayerWorker-84f410be.js","assets/I3SNode-ee019592.js"]),WFSSourceWorker:()=>Q(()=>import("./WFSSourceWorker-74cdaccc.js"),["assets/WFSSourceWorker-74cdaccc.js","assets/FeatureStore-198512e7.js","assets/optimizedFeatureQueryEngineAdapter-a67931c5.js","assets/centroid-c62179b0.js","assets/utils-7734a0d6.js","assets/projectionSupport-2f167231.js","assets/json-48e3ea08.js","assets/QueryEngine-e7f31776.js","assets/QueryEngineResult-2dd0323b.js","assets/WhereClause-cdddccc4.js","assets/executionError-fb3f283a.js","assets/utils-15a7108f.js","assets/generateRendererUtils-e2b7324f.js","assets/QueryEngineCapabilities-42e44ded.js","assets/timeSupport-d318046f.js","assets/geojson-a4357d4f.js","assets/sourceUtils-f57a25fd.js","assets/wfsUtils-ff6395c8.js","assets/xmlUtils-444cb4c0.js"]),WorkerTileHandler:()=>Q(()=>import("./WorkerTileHandler-4868607b.js"),["assets/WorkerTileHandler-4868607b.js","assets/GeometryUtils-53652037.js","assets/Rect-ea14f53a.js","assets/StyleDefinition-7d58136b.js","assets/enums-4b2a86a0.js","assets/TurboLine-f2375728.js","assets/definitions-3ddd14a8.js","assets/StyleRepository-30524876.js","assets/colorUtils-c0f43caf.js","assets/BidiEngine-836b7ef6.js"])},{CLOSE:vde,ABORT:bde,INVOKE:wde,RESPONSE:f3,OPEN_PORT:xde,ON:gYe}=Na,yYe=2;let _Ye=class{constructor(e){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=e,this._timer=null,this._process=this._process.bind(this)}push(e){e.type===Na.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}},aw=class MC{static connect(e){const i=new MessageChannel;let r;r=typeof e=="function"?new e:"default"in e&&typeof e.default=="function"?new e.default:e;const n=new MC(i.port1,{channel:i,client:r},()=>null);return typeof r=="object"&&"remoteClient"in r&&(r.remoteClient=n),MC.clients.set(n,r),i.port2}static loadWorker(e){const i=mYe[e];return i?i():Promise.resolve(null)}constructor(e,i,r){this._port=e,this._getNextJob=r,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new _Ye(n=>this._onInvokeMessage(n)),this._client=i.client,this._onMessage=this._onMessage.bind(this),this._channel=i.channel,this._schedule=i.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:vde}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,i,r){const n=r&&r.signal,s=r&&r.transferList;if(!this._port)return Promise.reject(new H("worker:port-closed",`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:i}));const o=SAe();return new Promise((a,l)=>{if(fo(n))return this._processWork(),void l(Bi());const c=ja(n,()=>{const p=this._outJobs.get(o);p&&(this._outJobs.delete(o),this._processWork(),Nr(p.abortHandle),this._post({type:bde,jobId:o}),l(Bi()))}),h={resolve:a,reject:l,abortHandle:c,debugInfo:e};this._outJobs.set(o,h),this._post({type:wde,jobId:o,methodName:e,abortable:n!=null},i,s)})}on(e,i){const r=new MessageChannel;function n(s){i(s.data)}return this._port.postMessage({type:Na.ON,eventType:e,port:r.port2},[r.port2]),r.port1.addEventListener("message",n),r.port1.start(),{remove(){r.port1.postMessage({type:Na.CLOSE}),r.port1.close(),r.port1.removeEventListener("message",n)}}}jobAdded(){this._processWork()}openPort(){const e=new MessageChannel;return this._post({type:xde,port:e.port2}),e.port1}_processWork(){if(this._outJobs.size>=yYe)return;const e=this._getNextJob();if(!e)return;const{methodName:i,data:r,invokeOptions:n,deferred:s}=e;this.invoke(i,r,n).then(o=>s.resolve(o)).catch(o=>s.reject(o))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(e=>{Nr(e.abortHandle),e.reject(Bi(`Worker closing, aborting job calling '${e.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=this._client=this._schedule=null}_onMessage(e){v(this._schedule)?this._schedule(()=>this._processMessage(e)):this._processMessage(e)}_processMessage(e){const i=QL(e);if(i)switch(i.type){case f3:this._onResponseMessage(i);break;case wde:this._invokeQueue.push(i);break;case bde:this._onAbortMessage(i);break;case vde:this._onCloseMessage();break;case xde:this._onOpenPortMessage(i);break;case gYe:this._onOnMessage(i)}}_onAbortMessage(e){const i=this._inJobs,r=e.jobId,n=i.get(r);this._invokeQueue.push(e),n&&(n.controller&&n.controller.abort(),i.delete(r))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&MC.clients.get(this)===e&&e.destroy(),MC.clients.delete(this),e&&e.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:i,jobId:r,data:n,abortable:s}=e,o=s?new AbortController:null,a=this._inJobs;let l,c=this._client,h=c[i];try{if(!h&&i&&i.includes(".")){const p=i.split(".");for(let f=0;f<p.length-1;f++)c=c[p[f]],h=c[p[f+1]]}if(typeof h!="function")throw new TypeError(`${i} is not a function`);l=h.call(c,n,{client:this,signal:o?o.signal:null})}catch(p){return void this._post({type:f3,jobId:r,error:KL(p)})}ih(l)?(a.set(r,{controller:o,promise:l}),l.then(p=>{a.has(r)&&(a.delete(r),this._post({type:f3,jobId:r},p))},p=>{a.has(r)&&(a.delete(r),gs(p)||this._post({type:f3,jobId:r,error:KL(p||{message:`Error encountered at method ${i}`})}))})):this._post({type:f3,jobId:r},l)}_onOpenPortMessage(e){new MC(e.port,{client:this._client},()=>null)}_onOnMessage(e){const{port:i}=e,r=this._client.on(e.eventType,s=>{i.postMessage(s)}),n=fN(e.port,"message",s=>{var o;((o=QL(s))==null?void 0:o.type)===Na.CLOSE&&(n.remove(),r.remove(),i.close())})}_onResponseMessage(e){const{jobId:i,error:r,data:n}=e,s=this._outJobs;if(!s.has(i))return;const o=s.get(i);s.delete(i),this._processWork(),Nr(o.abortHandle),r?o.reject(H.fromJSON(JSON.parse(r))):o.resolve(n)}_post(e,i,r){return lse(this._port,e,i,r)}};aw.kernelInfo={revision:ZCe,version:Kne,buildDate:YCe},aw.clients=new Map;let vYe=class{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new dV}destroy(){this.close()}get closed(){return!this._clients||!this._clients.length}open(e,i){return new Promise((r,n)=>{let s=!0;const o=a=>{ui(i.signal),s&&(s=!1,a())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let a=0;a<e.length;++a){const l=e[a];ih(l)?this._clientPromises[a]=l.then(c=>(this._clients[a]=new aw(c,i,()=>this._ongoingJobsQueue.pop()??null),o(r),this._clients[a]),()=>(o(n),null)):(this._clients[a]=new aw(l,i,()=>this._ongoingJobsQueue.pop()??null),this._clientPromises[a]=Promise.resolve(this._clients[a]),o(r))}})}broadcast(e,i,r){const n=new Array(this._clientPromises.length);for(let s=0;s<this._clientPromises.length;++s){const o=this._clientPromises[s];n[s]=o.then(a=>a==null?void 0:a.invoke(e,i,r))}return n}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.deferred.reject(Bi(`Worker closing, aborting job calling '${e.methodName}'`));for(const i of this._clientPromises)i.then(r=>r==null?void 0:r.close());this._clients.length=0,this._clientPromises.length=0}invoke(e,i,r){let n;Array.isArray(r)?(re.getLogger("esri.core.workers.Connection").warn("invoke()","The transferList parameter is deprecated, use the options object instead"),n={transferList:r}):n=r;const s=S_();this._ongoingJobsQueue.push({methodName:e,data:i,invokeOptions:n,deferred:s});for(let o=0;o<this._clientPromises.length;o++){const a=this._clients[o];a?a.jobAdded():this._clientPromises[o].then(l=>l==null?void 0:l.jobAdded())}return s.promise}on(e,i){return Promise.all(this._clientPromises).then(()=>hM(this._clients.map(r=>r.on(e,i))))}openPorts(){return new Promise(e=>{const i=new Array(this._clientPromises.length);let r=i.length;for(let n=0;n<this._clientPromises.length;++n)this._clientPromises[n].then(s=>{s&&(i[n]=s.openPort()),--r==0&&e(i)})})}get test(){return{numClients:this._clients.length}}};const bYe=re.getLogger("esri.assets");function wYe(t,e){return ir(ar(t),e)}function ar(t){if(!nr.assetsPath)throw bYe.errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new H("assets:path-not-set","config.assetsPath is not set");return ew(nr.assetsPath,t)}const EAe=re.getLogger("esri.intl.substitute");function Lf(t,e,i={}){const{format:r={}}=i;return ay(t,n=>xYe(n,e,r))}function xYe(t,e,i){let r,n;const s=t.indexOf(":");if(s===-1?r=t.trim():(r=t.slice(0,s).trim(),n=t.slice(s+1).trim()),!r)return"";const o=cN(r,e);if(o==null)return"";const a=(n?i==null?void 0:i[n]:null)??(i==null?void 0:i[r]);return a?TYe(o,a):n?SYe(o,n):cse(o)}function TYe(t,e){switch(e.type){case"date":return uy(t,e.intlOptions);case"number":return hy(t,e.intlOptions);default:return EAe.warn("missing format descriptor for key {key}"),cse(t)}}function SYe(t,e){switch(e.toLowerCase()){case"dateformat":return uy(t);case"numberformat":return hy(t);default:return EAe.warn(`inline format is unsupported since 4.12: ${e}`),/^(dateformat|datestring)/i.test(e)?uy(t):/^numberformat/i.test(e)?hy(t):cse(t)}}function cse(t){switch(typeof t){case"string":return t;case"number":return hy(t);case"boolean":return""+t;default:return t instanceof Date?uy(t):""}}const Tde=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,EYe={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function Sde(t){return EYe[t]??!1}const HP=[],OR=new Map;function Ede(t){for(const e of OR.keys())AAe(t.pattern,e)&&OR.delete(e)}function CYe(t){return HP.includes(t)||(Ede(t),HP.unshift(t)),{remove(){const e=HP.indexOf(t);e>-1&&(HP.splice(e,1),Ede(t))}}}async function CAe(t){const e=wp();OR.has(t)||OR.set(t,RYe(t,e));const i=OR.get(t);return i&&await MYe.add(i),i}function AYe(t){if(!Tde.test(t))return null;const e=Tde.exec(t);if(e===null)return null;const[,i,r]=e,n=i+(r?"-"+r.toUpperCase():"");return Sde(n)?n:Sde(i)?i:null}async function RYe(t,e){const i=[];for(const r of HP)if(AAe(r.pattern,t))try{return await r.fetchMessageBundle(t,e)}catch(n){i.push(n)}throw i.length?new H("intl:message-bundle-error",`Errors occurred while loading "${t}"`,{errors:i}):new H("intl:no-message-bundle-loader",`No loader found for message bundle "${t}"`)}function AAe(t,e){return typeof t=="string"?e.startsWith(t):t.test(e)}bne(()=>{OR.clear()});const MYe=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(t){return this._increase(),t.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=S_())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}};async function OYe(t,e,i,r){const n=e.exec(i);if(!n)throw new H("esri-intl:invalid-bundle",`Bundle id "${i}" is not compatible with the pattern "${e}"`);const s=n[1]?`${n[1]}/`:"",o=n[2],a=AYe(r),l=`${s}${o}.json`,c=a?`${s}${o}_${a}.json`:l;let h;try{h=await Cde(t(c))}catch(p){if(c===l)throw new H("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:p});try{h=await Cde(t(l))}catch(f){throw new H("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:f})}}return h}async function Cde(t){if(v(Ade.fetchBundleAsset))return Ade.fetchBundleAsset(t);const e=await ir(t,{responseType:"text"});return JSON.parse(e.data)}let PYe=class{constructor({base:e="",pattern:i,location:r=new URL(window.location.href)}){let n;n=typeof r=="string"?s=>new URL(s,new URL(r,window.location.href)).href:r instanceof URL?s=>new URL(s,r).href:r,this.pattern=typeof i=="string"?new RegExp(`^${i}`):i,this.getAssetUrl=n,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)/)?(.*)$`)}fetchMessageBundle(e,i){return OYe(this.getAssetUrl,this.matcher,e,i)}};function IYe(t){return new PYe(t)}const Ade={};CYe(IYe({pattern:"esri/",location:ar}));const $Ye={};function LYe(t){const e={async:t.async,isDebug:t.isDebug,locale:t.locale,baseUrl:t.baseUrl,has:{...t.has},map:{...t.map},packages:t.packages&&t.packages.concat()||[],paths:{...t.paths}};return t.hasOwnProperty("async")||(e.async=!0),t.hasOwnProperty("isDebug")||(e.isDebug=!1),t.baseUrl||(e.baseUrl=$Ye.baseUrl),e}let DYe=class{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(i=>{this[i]=(...r)=>e[i](...r)})}},P6=class{constructor(){this._dispatcher=new DYe,this._workerPostMessage({type:Na.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){dM(()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))})}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,i,r){this._dispatcher.addEventListener(e,i,r)}removeEventListener(e,i,r){this._dispatcher.removeEventListener(e,i,r)}_workerPostMessage(e){dM(()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))})}async _workerMessageHandler(e){const i=QL(e);if(i&&i.type===Na.OPEN){const{modulePath:r,jobId:n}=i;let s=await aw.loadWorker(r);s||(s=await Q(()=>import(r),[]));const o=aw.connect(s);this._workerPostMessage({type:Na.OPENED,jobId:n,data:o})}}};const eJ=re.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:NYe}=Na,FYe='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,version:r}=configuration.kernelInfo,{revision:t,version:n}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS API for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\\nModules version: ${r}\\nAssets version: ${n}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let n;function t(e){const o=n.connect(e);self.postMessage({type:2,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const i=outgoing.get(r);outgoing.delete(r),o.error?i.reject(JSON.parse(o.error)):i.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let BF,jF;const Rde="Failed to create Worker. Fallback to execute module in main thread";async function kYe(){if(!ue("esri-workers")||(ue("mozilla"),0))return Mde(new P6);if(!BF&&!jF)try{const e=FYe.split('"{CONFIGURATION}"').join(`'${UYe()}'`);BF=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){jF=e||{}}let t;if(BF)try{t=new Worker(BF,{name:"esri-worker-"+VYe++})}catch{eJ.warn(Rde,jF),t=new P6}else eJ.warn(Rde,jF),t=new P6;return Mde(t)}async function Mde(t){return new Promise(e=>{function i(n){const s=QL(n);s&&s.type===NYe&&(t.removeEventListener("message",i),t.removeEventListener("error",r),e(t))}function r(n){n.preventDefault(),t.removeEventListener("message",i),t.removeEventListener("error",r),eJ.warn("Failed to create Worker. Fallback to execute module in main thread",n),(t=new P6).addEventListener("message",i),t.addEventListener("error",r)}t.addEventListener("message",i),t.addEventListener("error",r)})}function UYe(){let t;if(nr.default!=null){const n={...nr};delete n.default,t=JSON.parse(JSON.stringify(n))}else t=JSON.parse(JSON.stringify(nr));t.assetsPath=zc(t.assetsPath),t.defaultAssetsPath=t.defaultAssetsPath?zc(t.defaultAssetsPath):void 0,t.request.interceptors=[],t.log.interceptors=[],t.locale=wp(),t.has={"esri-csp-restrictions":ue("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":ue("esri-2d-update-debug"),"featurelayer-pbf":ue("featurelayer-pbf"),"featurelayer-simplify-thresholds":ue("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":ue("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":ue("featurelayer-simplify-mobile-factor"),"esri-atomics":ue("esri-atomics"),"esri-shared-array-buffer":ue("esri-shared-array-buffer"),"esri-tiles-debug":ue("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":ue("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":ue("feature-polyline-generalization-factor"),"host-webworker":1,"polylabel-placement-enabled":ue("polylabel-placement-enabled")},t.workers.loaderUrl&&(t.workers.loaderUrl=zc(t.workers.loaderUrl)),t.workers.workerPath?t.workers.workerPath=zc(t.workers.workerPath):t.workers.workerPath=zc(ar("esri/core/workers/RemoteClient.js")),t.workers.useDynamicImport=!1;const e=nr.workers.loaderConfig,i=LYe({baseUrl:e==null?void 0:e.baseUrl,locale:wp(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...e==null?void 0:e.has},map:{...e==null?void 0:e.map},paths:{...e==null?void 0:e.paths},packages:(e==null?void 0:e.packages)||[]});return JSON.stringify({esriConfig:t,loaderConfig:i,kernelInfo:{version:Kne,buildDate:YCe,revision:ZCe}})}let VYe=0;const{ABORT:Ode,INVOKE:zYe,OPEN:BYe,OPENED:jYe,RESPONSE:m3}=Na;let GYe=class RAe{static async create(e){const i=await kYe();return new RAe(i,e)}constructor(e,i){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=i,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",r=>{r.preventDefault(),re.getLogger("esri.core.workers.WorkerOwner").error(r)})}terminate(){this.worker.terminate()}async open(e,i={}){const{signal:r}=i,n=SAe();return new Promise((s,o)=>{const a={resolve:s,reject:o,abortHandle:P9(r,()=>{this._outJobs.delete(n),this._post({type:Ode,jobId:n})})};this._outJobs.set(n,a),this._post({type:BYe,jobId:n,modulePath:e})})}_onMessage(e){const i=QL(e);if(i)switch(i.type){case jYe:this._onOpenedMessage(i);break;case m3:this._onResponseMessage(i);break;case Ode:this._onAbortMessage(i);break;case zYe:this._onInvokeMessage(i)}}_onAbortMessage(e){const i=this._inJobs,r=e.jobId,n=i.get(r);n&&(n.controller&&n.controller.abort(),i.delete(r))}_onInvokeMessage(e){const{methodName:i,jobId:r,data:n,abortable:s}=e,o=s?new AbortController:null,a=this._inJobs,l=xXe[i];let c;try{if(typeof l!="function")throw new TypeError(`${i} is not a function`);c=l.call(null,n,{signal:o?o.signal:null})}catch(h){return void this._post({type:m3,jobId:r,error:KL(h)})}ih(c)?(a.set(r,{controller:o,promise:c}),c.then(h=>{a.has(r)&&(a.delete(r),this._post({type:m3,jobId:r},h))},h=>{a.has(r)&&(a.delete(r),h||(h={message:"Error encountered at method"+i}),gs(h)||this._post({type:m3,jobId:r,error:KL(h||{message:`Error encountered at method ${i}`})}))})):this._post({type:m3,jobId:r},c)}_onOpenedMessage(e){const{jobId:i,data:r}=e,n=this._outJobs.get(i);n&&(this._outJobs.delete(i),Nr(n.abortHandle),n.resolve(r))}_onResponseMessage(e){const{jobId:i,error:r,data:n}=e,s=this._outJobs.get(i);s&&(this._outJobs.delete(i),Nr(s.abortHandle),r?s.reject(H.fromJSON(JSON.parse(r))):s.resolve(n))}_post(e,i,r){return lse(this.worker,e,i,r)}},yS=ue("esri-workers-debug")?1:ue("esri-mobile")?Math.min(navigator.hardwareConcurrency-1,3):ue("host-browser")?navigator.hardwareConcurrency-1:0;yS||(yS=ue("safari")&&ue("mac")?7:2);let Pde=0;const I6=[];function MAe(){PAe()}async function GF(t,e){const i=new vYe;return await i.open(t,e),i}async function OAe(t,e={}){if(typeof t!="string")throw new H("workers:undefined-module","modulePath is missing");let i=e.strategy||"distributed";if(ue("host-webworker")&&!ue("esri-workers")&&(i="local"),i==="local"){let r=await aw.loadWorker(t);r||(r=await Q(()=>import(t),[])),ui(e.signal);const n=e.client||r;return GF([aw.connect(r)],{...e,client:n})}if(await PAe(),ui(e.signal),i==="dedicated"){const r=Pde++%yS;return GF([await I6[r].open(t,e)],e)}if(e.maxNumWorkers&&e.maxNumWorkers>0){const r=Math.min(e.maxNumWorkers,yS);if(r<yS){const n=new Array(r);for(let s=0;s<r;++s){const o=Pde++%yS;n[s]=I6[o].open(t,e)}return GF(n,e)}}return GF(I6.map(r=>r.open(t,e)),e)}let HF=null;async function PAe(){if(HF)return HF;new AbortController;const t=[];for(let e=0;e<yS;e++){const i=GYe.create(e).then(r=>(I6[e]=r,r));t.push(i)}return HF=Promise.all(t),HF}function go(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Sy(t,e,i,r,n,s,o,a,l,c,h,p,f,m,g,_,b){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=s,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t[9]=h,t[10]=p,t[11]=f,t[12]=m,t[13]=g,t[14]=_,t[15]=b,t}function Lp(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Ku(t,e){if(t===e){const i=e[1],r=e[2],n=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=s,t[11]=e[14],t[12]=n,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function TO(t,e){return wa(t,e)||Lp(t),t}function wa(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],m=e[11],g=e[12],_=e[13],b=e[14],w=e[15],x=i*a-r*o,T=i*l-n*o,E=i*c-s*o,C=r*l-n*a,A=r*c-s*a,I=n*c-s*l,O=h*_-p*g,D=h*b-f*g,U=h*w-m*g,V=p*b-f*_,B=p*w-m*_,ee=f*w-m*b;let ie=x*ee-T*B+E*V+C*U-A*D+I*O;return ie?(ie=1/ie,t[0]=(a*ee-l*B+c*V)*ie,t[1]=(n*B-r*ee-s*V)*ie,t[2]=(_*I-b*A+w*C)*ie,t[3]=(f*A-p*I-m*C)*ie,t[4]=(l*U-o*ee-c*D)*ie,t[5]=(i*ee-n*U+s*D)*ie,t[6]=(b*E-g*I-w*T)*ie,t[7]=(h*I-f*E+m*T)*ie,t[8]=(o*B-a*U+c*O)*ie,t[9]=(r*U-i*B-s*O)*ie,t[10]=(g*A-_*E+w*x)*ie,t[11]=(p*E-h*A-m*x)*ie,t[12]=(a*D-o*V-l*O)*ie,t[13]=(i*V-r*D+n*O)*ie,t[14]=(_*T-g*C-b*x)*ie,t[15]=(h*C-p*T+f*x)*ie,t):null}function HYe(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],m=e[11],g=e[12],_=e[13],b=e[14],w=e[15];return t[0]=a*(f*w-m*b)-p*(l*w-c*b)+_*(l*m-c*f),t[1]=-(r*(f*w-m*b)-p*(n*w-s*b)+_*(n*m-s*f)),t[2]=r*(l*w-c*b)-a*(n*w-s*b)+_*(n*c-s*l),t[3]=-(r*(l*m-c*f)-a*(n*m-s*f)+p*(n*c-s*l)),t[4]=-(o*(f*w-m*b)-h*(l*w-c*b)+g*(l*m-c*f)),t[5]=i*(f*w-m*b)-h*(n*w-s*b)+g*(n*m-s*f),t[6]=-(i*(l*w-c*b)-o*(n*w-s*b)+g*(n*c-s*l)),t[7]=i*(l*m-c*f)-o*(n*m-s*f)+h*(n*c-s*l),t[8]=o*(p*w-m*_)-h*(a*w-c*_)+g*(a*m-c*p),t[9]=-(i*(p*w-m*_)-h*(r*w-s*_)+g*(r*m-s*p)),t[10]=i*(a*w-c*_)-o*(r*w-s*_)+g*(r*c-s*a),t[11]=-(i*(a*m-c*p)-o*(r*m-s*p)+h*(r*c-s*a)),t[12]=-(o*(p*b-f*_)-h*(a*b-l*_)+g*(a*f-l*p)),t[13]=i*(p*b-f*_)-h*(r*b-n*_)+g*(r*f-n*p),t[14]=-(i*(a*b-l*_)-o*(r*b-n*_)+g*(r*l-n*a)),t[15]=i*(a*f-l*p)-o*(r*f-n*p)+h*(r*l-n*a),t}function qYe(t){const e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=t[9],p=t[10],f=t[11],m=t[12],g=t[13],_=t[14],b=t[15];return(e*o-i*s)*(p*b-f*_)-(e*a-r*s)*(h*b-f*g)+(e*l-n*s)*(h*_-p*g)+(i*a-r*o)*(c*b-f*m)-(i*l-n*o)*(c*_-p*m)+(r*l-n*a)*(c*g-h*m)}function $n(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],p=e[8],f=e[9],m=e[10],g=e[11],_=e[12],b=e[13],w=e[14],x=e[15];let T=i[0],E=i[1],C=i[2],A=i[3];return t[0]=T*r+E*a+C*p+A*_,t[1]=T*n+E*l+C*f+A*b,t[2]=T*s+E*c+C*m+A*w,t[3]=T*o+E*h+C*g+A*x,T=i[4],E=i[5],C=i[6],A=i[7],t[4]=T*r+E*a+C*p+A*_,t[5]=T*n+E*l+C*f+A*b,t[6]=T*s+E*c+C*m+A*w,t[7]=T*o+E*h+C*g+A*x,T=i[8],E=i[9],C=i[10],A=i[11],t[8]=T*r+E*a+C*p+A*_,t[9]=T*n+E*l+C*f+A*b,t[10]=T*s+E*c+C*m+A*w,t[11]=T*o+E*h+C*g+A*x,T=i[12],E=i[13],C=i[14],A=i[15],t[12]=T*r+E*a+C*p+A*_,t[13]=T*n+E*l+C*f+A*b,t[14]=T*s+E*c+C*m+A*w,t[15]=T*o+E*h+C*g+A*x,t}function Yc(t,e,i){const r=i[0],n=i[1],s=i[2];if(e===t)t[12]=e[0]*r+e[4]*n+e[8]*s+e[12],t[13]=e[1]*r+e[5]*n+e[9]*s+e[13],t[14]=e[2]*r+e[6]*n+e[10]*s+e[14],t[15]=e[3]*r+e[7]*n+e[11]*s+e[15];else{const o=e[0],a=e[1],l=e[2],c=e[3],h=e[4],p=e[5],f=e[6],m=e[7],g=e[8],_=e[9],b=e[10],w=e[11];t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=h,t[5]=p,t[6]=f,t[7]=m,t[8]=g,t[9]=_,t[10]=b,t[11]=w,t[12]=o*r+h*n+g*s+e[12],t[13]=a*r+p*n+_*s+e[13],t[14]=l*r+f*n+b*s+e[14],t[15]=c*r+m*n+w*s+e[15]}return t}function rB(t,e,i){const r=i[0],n=i[1],s=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Vu(t,e,i,r){let n,s,o,a,l,c,h,p,f,m,g,_,b,w,x,T,E,C,A,I,O,D,U,V,B=r[0],ee=r[1],ie=r[2],J=Math.sqrt(B*B+ee*ee+ie*ie);return J<bl()?null:(J=1/J,B*=J,ee*=J,ie*=J,n=Math.sin(i),s=Math.cos(i),o=1-s,a=e[0],l=e[1],c=e[2],h=e[3],p=e[4],f=e[5],m=e[6],g=e[7],_=e[8],b=e[9],w=e[10],x=e[11],T=B*B*o+s,E=ee*B*o+ie*n,C=ie*B*o-ee*n,A=B*ee*o-ie*n,I=ee*ee*o+s,O=ie*ee*o+B*n,D=B*ie*o+ee*n,U=ee*ie*o-B*n,V=ie*ie*o+s,t[0]=a*T+p*E+_*C,t[1]=l*T+f*E+b*C,t[2]=c*T+m*E+w*C,t[3]=h*T+g*E+x*C,t[4]=a*A+p*I+_*O,t[5]=l*A+f*I+b*O,t[6]=c*A+m*I+w*O,t[7]=h*A+g*I+x*O,t[8]=a*D+p*U+_*V,t[9]=l*D+f*U+b*V,t[10]=c*D+m*U+w*V,t[11]=h*D+g*U+x*V,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function AM(t,e,i){const r=Math.sin(i),n=Math.cos(i),s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=e[9],p=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*n+c*r,t[5]=o*n+h*r,t[6]=a*n+p*r,t[7]=l*n+f*r,t[8]=c*n-s*r,t[9]=h*n-o*r,t[10]=p*n-a*r,t[11]=f*n-l*r,t}function nB(t,e,i){const r=Math.sin(i),n=Math.cos(i),s=e[0],o=e[1],a=e[2],l=e[3],c=e[8],h=e[9],p=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n-c*r,t[1]=o*n-h*r,t[2]=a*n-p*r,t[3]=l*n-f*r,t[8]=s*r+c*n,t[9]=o*r+h*n,t[10]=a*r+p*n,t[11]=l*r+f*n,t}function RM(t,e,i){const r=Math.sin(i),n=Math.cos(i),s=e[0],o=e[1],a=e[2],l=e[3],c=e[4],h=e[5],p=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n+c*r,t[1]=o*n+h*r,t[2]=a*n+p*r,t[3]=l*n+f*r,t[4]=c*n-s*r,t[5]=h*n-o*r,t[6]=p*n-a*r,t[7]=f*n-l*r,t}function sB(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function WYe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ad(t,e,i){if(e===0)return Lp(t);let r,n,s,o=i[0],a=i[1],l=i[2],c=Math.sqrt(o*o+a*a+l*l);return c<bl()?null:(c=1/c,o*=c,a*=c,l*=c,r=Math.sin(e),n=Math.cos(e),s=1-n,t[0]=o*o*s+n,t[1]=a*o*s+l*r,t[2]=l*o*s-a*r,t[3]=0,t[4]=o*a*s-l*r,t[5]=a*a*s+n,t[6]=l*a*s+o*r,t[7]=0,t[8]=o*l*s+a*r,t[9]=a*l*s-o*r,t[10]=l*l*s+n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function IAe(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function XYe(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function $Ae(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function LAe(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=r+r,l=n+n,c=s+s,h=r*a,p=r*l,f=r*c,m=n*l,g=n*c,_=s*c,b=o*a,w=o*l,x=o*c;return t[0]=1-(m+_),t[1]=p+x,t[2]=f-w,t[3]=0,t[4]=p-x,t[5]=1-(h+_),t[6]=g+b,t[7]=0,t[8]=f+w,t[9]=g-b,t[10]=1-(h+m),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function YYe(t,e){const i=ZYe,r=-e[0],n=-e[1],s=-e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],p=r*r+n*n+s*s+o*o;return p>0?(i[0]=2*(a*o+h*r+l*s-c*n)/p,i[1]=2*(l*o+h*n+c*r-a*s)/p,i[2]=2*(c*o+h*s+a*n-l*r)/p):(i[0]=2*(a*o+h*r+l*s-c*n),i[1]=2*(l*o+h*n+c*r-a*s),i[2]=2*(c*o+h*s+a*n-l*r)),LAe(t,e,i),t}const ZYe=P();function JYe(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function DAe(t,e){const i=e[0],r=e[1],n=e[2],s=e[4],o=e[5],a=e[6],l=e[8],c=e[9],h=e[10];return t[0]=Math.sqrt(i*i+r*r+n*n),t[1]=Math.sqrt(s*s+o*o+a*a),t[2]=Math.sqrt(l*l+c*c+h*h),t}function KYe(t,e){const i=e[0]+e[5]+e[10];let r=0;return i>0?(r=2*Math.sqrt(i+1),t[3]=.25*r,t[0]=(e[6]-e[9])/r,t[1]=(e[8]-e[2])/r,t[2]=(e[1]-e[4])/r):e[0]>e[5]&&e[0]>e[10]?(r=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/r,t[0]=.25*r,t[1]=(e[1]+e[4])/r,t[2]=(e[8]+e[2])/r):e[5]>e[10]?(r=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/r,t[0]=(e[1]+e[4])/r,t[1]=.25*r,t[2]=(e[6]+e[9])/r):(r=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/r,t[0]=(e[8]+e[2])/r,t[1]=(e[6]+e[9])/r,t[2]=.25*r),t}function QYe(t,e,i,r){const n=e[0],s=e[1],o=e[2],a=e[3],l=n+n,c=s+s,h=o+o,p=n*l,f=n*c,m=n*h,g=s*c,_=s*h,b=o*h,w=a*l,x=a*c,T=a*h,E=r[0],C=r[1],A=r[2];return t[0]=(1-(g+b))*E,t[1]=(f+T)*E,t[2]=(m-x)*E,t[3]=0,t[4]=(f-T)*C,t[5]=(1-(p+b))*C,t[6]=(_+w)*C,t[7]=0,t[8]=(m+x)*A,t[9]=(_-w)*A,t[10]=(1-(p+g))*A,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function eZe(t,e,i,r,n){const s=e[0],o=e[1],a=e[2],l=e[3],c=s+s,h=o+o,p=a+a,f=s*c,m=s*h,g=s*p,_=o*h,b=o*p,w=a*p,x=l*c,T=l*h,E=l*p,C=r[0],A=r[1],I=r[2],O=n[0],D=n[1],U=n[2],V=(1-(_+w))*C,B=(m+E)*C,ee=(g-T)*C,ie=(m-E)*A,J=(1-(f+w))*A,q=(b+x)*A,N=(g+T)*I,L=(b-x)*I,F=(1-(f+_))*I;return t[0]=V,t[1]=B,t[2]=ee,t[3]=0,t[4]=ie,t[5]=J,t[6]=q,t[7]=0,t[8]=N,t[9]=L,t[10]=F,t[11]=0,t[12]=i[0]+O-(V*O+ie*D+N*U),t[13]=i[1]+D-(B*O+J*D+L*U),t[14]=i[2]+U-(ee*O+q*D+F*U),t[15]=1,t}function tZe(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=i+i,a=r+r,l=n+n,c=i*o,h=r*o,p=r*a,f=n*o,m=n*a,g=n*l,_=s*o,b=s*a,w=s*l;return t[0]=1-p-g,t[1]=h+w,t[2]=f-b,t[3]=0,t[4]=h-w,t[5]=1-c-g,t[6]=m+_,t[7]=0,t[8]=f+b,t[9]=m-_,t[10]=1-c-p,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function NAe(t,e,i,r,n,s,o){const a=1/(i-e),l=1/(n-r),c=1/(s-o);return t[0]=2*s*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*s*l,t[6]=0,t[7]=0,t[8]=(i+e)*a,t[9]=(n+r)*l,t[10]=(o+s)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*c,t[15]=0,t}function iZe(t,e,i,r,n){const s=1/Math.tan(e/2);let o;return t[0]=s/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,n!=null&&n!==1/0?(o=1/(r-n),t[10]=(n+r)*o,t[14]=2*n*r*o):(t[10]=-1,t[14]=-2*r),t}function rZe(t,e,i,r){const n=Math.tan(e.upDegrees*Math.PI/180),s=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(n+s);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(o-a)*l*.5,t[9]=(n-s)*c*.5,t[10]=r/(i-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*i/(i-r),t[15]=0,t}function FAe(t,e,i,r,n,s,o){const a=1/(e-i),l=1/(r-n),c=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+i)*a,t[13]=(n+r)*l,t[14]=(o+s)*c,t[15]=1,t}function oB(t,e,i,r){let n,s,o,a,l,c,h,p,f,m;const g=e[0],_=e[1],b=e[2],w=r[0],x=r[1],T=r[2],E=i[0],C=i[1],A=i[2],I=bl();return Math.abs(g-E)<I&&Math.abs(_-C)<I&&Math.abs(b-A)<I?Lp(t):(h=g-E,p=_-C,f=b-A,m=1/Math.sqrt(h*h+p*p+f*f),h*=m,p*=m,f*=m,n=x*f-T*p,s=T*h-w*f,o=w*p-x*h,m=Math.sqrt(n*n+s*s+o*o),m?(m=1/m,n*=m,s*=m,o*=m):(n=0,s=0,o=0),a=p*o-f*s,l=f*n-h*o,c=h*s-p*n,m=Math.sqrt(a*a+l*l+c*c),m?(m=1/m,a*=m,l*=m,c*=m):(a=0,l=0,c=0),t[0]=n,t[1]=a,t[2]=h,t[3]=0,t[4]=s,t[5]=l,t[6]=p,t[7]=0,t[8]=o,t[9]=c,t[10]=f,t[11]=0,t[12]=-(n*g+s*_+o*b),t[13]=-(a*g+l*_+c*b),t[14]=-(h*g+p*_+f*b),t[15]=1,t)}function kAe(t,e,i,r){const n=e[0],s=e[1],o=e[2],a=r[0],l=r[1],c=r[2];let h=n-i[0],p=s-i[1],f=o-i[2],m=h*h+p*p+f*f;m>0&&(m=1/Math.sqrt(m),h*=m,p*=m,f*=m);let g=l*f-c*p,_=c*h-a*f,b=a*p-l*h;return m=g*g+_*_+b*b,m>0&&(m=1/Math.sqrt(m),g*=m,_*=m,b*=m),t[0]=g,t[1]=_,t[2]=b,t[3]=0,t[4]=p*b-f*_,t[5]=f*g-h*b,t[6]=h*_-p*g,t[7]=0,t[8]=h,t[9]=p,t[10]=f,t[11]=0,t[12]=n,t[13]=s,t[14]=o,t[15]=1,t}function nZe(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function sZe(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2+t[9]**2+t[10]**2+t[11]**2+t[12]**2+t[13]**2+t[14]**2+t[15]**2)}function oZe(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t}function UAe(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t}function aZe(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t}function lZe(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t[9]=e[9]+i[9]*r,t[10]=e[10]+i[10]*r,t[11]=e[11]+i[11]*r,t[12]=e[12]+i[12]*r,t[13]=e[13]+i[13]*r,t[14]=e[14]+i[14]*r,t[15]=e[15]+i[15]*r,t}function VAe(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function use(t,e){if(t===e)return!0;const i=t[0],r=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=t[9],f=t[10],m=t[11],g=t[12],_=t[13],b=t[14],w=t[15],x=e[0],T=e[1],E=e[2],C=e[3],A=e[4],I=e[5],O=e[6],D=e[7],U=e[8],V=e[9],B=e[10],ee=e[11],ie=e[12],J=e[13],q=e[14],N=e[15],L=bl();return Math.abs(i-x)<=L*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(r-T)<=L*Math.max(1,Math.abs(r),Math.abs(T))&&Math.abs(n-E)<=L*Math.max(1,Math.abs(n),Math.abs(E))&&Math.abs(s-C)<=L*Math.max(1,Math.abs(s),Math.abs(C))&&Math.abs(o-A)<=L*Math.max(1,Math.abs(o),Math.abs(A))&&Math.abs(a-I)<=L*Math.max(1,Math.abs(a),Math.abs(I))&&Math.abs(l-O)<=L*Math.max(1,Math.abs(l),Math.abs(O))&&Math.abs(c-D)<=L*Math.max(1,Math.abs(c),Math.abs(D))&&Math.abs(h-U)<=L*Math.max(1,Math.abs(h),Math.abs(U))&&Math.abs(p-V)<=L*Math.max(1,Math.abs(p),Math.abs(V))&&Math.abs(f-B)<=L*Math.max(1,Math.abs(f),Math.abs(B))&&Math.abs(m-ee)<=L*Math.max(1,Math.abs(m),Math.abs(ee))&&Math.abs(g-ie)<=L*Math.max(1,Math.abs(g),Math.abs(ie))&&Math.abs(_-J)<=L*Math.max(1,Math.abs(_),Math.abs(J))&&Math.abs(b-q)<=L*Math.max(1,Math.abs(b),Math.abs(q))&&Math.abs(w-N)<=L*Math.max(1,Math.abs(w),Math.abs(N))}function hse(t){const e=bl(),i=t[0],r=t[1],n=t[2],s=t[4],o=t[5],a=t[6],l=t[8],c=t[9],h=t[10];return Math.abs(1-(i*i+s*s+l*l))<=e&&Math.abs(1-(r*r+o*o+c*c))<=e&&Math.abs(1-(n*n+a*a+h*h))<=e}function aB(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[8]===0&&t[9]===0&&t[10]===1}const cZe=$n,uZe=UAe;Object.freeze(Object.defineProperty({__proto__:null,add:oZe,adjoint:HYe,copy:go,determinant:qYe,equals:use,exactEquals:VAe,frob:sZe,fromQuat:tZe,fromQuat2:YYe,fromRotation:ad,fromRotationTranslation:LAe,fromRotationTranslationScale:QYe,fromRotationTranslationScaleOrigin:eZe,fromScaling:WYe,fromTranslation:sB,fromXRotation:IAe,fromYRotation:XYe,fromZRotation:$Ae,frustum:NAe,getRotation:KYe,getScaling:DAe,getTranslation:JYe,hasIdentityRotation:aB,identity:Lp,invert:wa,invertOrIdentity:TO,isOrthoNormal:hse,lookAt:oB,mul:cZe,multiply:$n,multiplyScalar:aZe,multiplyScalarAndAdd:lZe,ortho:FAe,perspective:iZe,perspectiveFromFieldOfView:rZe,rotate:Vu,rotateX:AM,rotateY:nB,rotateZ:RM,scale:rB,set:Sy,str:nZe,sub:uZe,subtract:UAe,targetTo:kAe,translate:Yc,transpose:Ku},Symbol.toStringTag,{value:"Module"}));let Qj,ae=null;function zAe(){return!!ae}function hZe(){return!!ue("esri-wasm")}function BAe(){return Qj||(Qj=Q(()=>import("./pe-wasm-815c1904.js"),[]).then(t=>t.p).then(({default:t})=>t({locateFile:e=>ar(`esri/geometry/support/${e}`)})).then(t=>{GAe(t)}),Qj)}var tJ,as,iJ;(function(t){function e(s,o,a){ae.ensureCache.prepare();const l=YT(a),c=a===l,h=ae.ensureFloat64(l),p=ae._pe_geog_to_proj(ae.getPointer(s),o,h);return p&&Z1(a,o,h,c),p}function i(s,o,a,l){switch(l){case as.PE_TRANSFORM_P_TO_G:return r(s,o,a);case as.PE_TRANSFORM_G_TO_P:return e(s,o,a)}return 0}function r(s,o,a){return n(s,o,a,0)}function n(s,o,a,l){ae.ensureCache.prepare();const c=YT(a),h=a===c,p=ae.ensureFloat64(c),f=ae._pe_proj_to_geog_center(ae.getPointer(s),o,p,l);return f&&Z1(a,o,p,h),f}t.geogToProj=e,t.projGeog=i,t.projToGeog=r,t.projToGeogCenter=n})(tJ||(tJ={})),function(t){function e(){t.PE_BUFFER_MAX=ae.PeDefs.prototype.PE_BUFFER_MAX,t.PE_NAME_MAX=ae.PeDefs.prototype.PE_NAME_MAX,t.PE_MGRS_MAX=ae.PeDefs.prototype.PE_MGRS_MAX,t.PE_USNG_MAX=ae.PeDefs.prototype.PE_USNG_MAX,t.PE_DD_MAX=ae.PeDefs.prototype.PE_DD_MAX,t.PE_DDM_MAX=ae.PeDefs.prototype.PE_DDM_MAX,t.PE_DMS_MAX=ae.PeDefs.prototype.PE_DMS_MAX,t.PE_UTM_MAX=ae.PeDefs.prototype.PE_UTM_MAX,t.PE_PARM_MAX=ae.PeDefs.prototype.PE_PARM_MAX,t.PE_TYPE_NONE=ae.PeDefs.prototype.PE_TYPE_NONE,t.PE_TYPE_GEOGCS=ae.PeDefs.prototype.PE_TYPE_GEOGCS,t.PE_TYPE_PROJCS=ae.PeDefs.prototype.PE_TYPE_PROJCS,t.PE_TYPE_GEOGTRAN=ae.PeDefs.prototype.PE_TYPE_GEOGTRAN,t.PE_TYPE_COORDSYS=ae.PeDefs.prototype.PE_TYPE_COORDSYS,t.PE_TYPE_UNIT=ae.PeDefs.prototype.PE_TYPE_UNIT,t.PE_TYPE_LINUNIT=ae.PeDefs.prototype.PE_TYPE_LINUNIT,t.PE_STR_OPTS_NONE=ae.PeDefs.prototype.PE_STR_OPTS_NONE,t.PE_STR_AUTH_NONE=ae.PeDefs.prototype.PE_STR_AUTH_NONE,t.PE_STR_AUTH_TOP=ae.PeDefs.prototype.PE_STR_AUTH_TOP,t.PE_STR_NAME_CANON=ae.PeDefs.prototype.PE_STR_NAME_CANON,t.PE_PARM_X0=ae.PeDefs.prototype.PE_PARM_X0,t.PE_PARM_ND=ae.PeDefs.prototype.PE_PARM_ND,t.PE_TRANSFORM_1_TO_2=ae.PeDefs.prototype.PE_TRANSFORM_1_TO_2,t.PE_TRANSFORM_2_TO_1=ae.PeDefs.prototype.PE_TRANSFORM_2_TO_1,t.PE_TRANSFORM_P_TO_G=ae.PeDefs.prototype.PE_TRANSFORM_P_TO_G,t.PE_TRANSFORM_G_TO_P=ae.PeDefs.prototype.PE_TRANSFORM_G_TO_P,t.PE_HORIZON_RECT=ae.PeDefs.prototype.PE_HORIZON_RECT,t.PE_HORIZON_POLY=ae.PeDefs.prototype.PE_HORIZON_POLY,t.PE_HORIZON_LINE=ae.PeDefs.prototype.PE_HORIZON_LINE,t.PE_HORIZON_DELTA=ae.PeDefs.prototype.PE_HORIZON_DELTA}t.init=e}(as||(as={})),function(t){const e={},i={},r=m=>{if(m){const g=m.getType();switch(g){case as.PE_TYPE_GEOGCS:m=ae.castObject(m,ae.PeGeogcs);break;case as.PE_TYPE_PROJCS:m=ae.castObject(m,ae.PeProjcs);break;case as.PE_TYPE_GEOGTRAN:m=ae.castObject(m,ae.PeGeogtran);break;default:g&as.PE_TYPE_UNIT&&(m=ae.castObject(m,ae.PeUnit))}}return m};function n(){ae.PeFactory.prototype.initialize(null)}function s(m){return o(as.PE_TYPE_COORDSYS,m)}function o(m,g){let _=null,b=e[m];if(b||(b={},e[m]=b),b.hasOwnProperty(String(g)))_=b[g];else{const w=ae.PeFactory.prototype.factoryByType(m,g);ae.compare(w,ae.NULL)||(_=w,b[g]=_)}return _=r(_),_}function a(m,g){let _=null,b=i[m];if(b||(b={},i[m]=b),b.hasOwnProperty(g))_=b[g];else{const w=ae.PeFactory.prototype.fromString(m,g);ae.compare(w,ae.NULL)||(_=w,b[g]=_)}return _=r(_),_}function l(m){return o(as.PE_TYPE_GEOGCS,m)}function c(m){return o(as.PE_TYPE_GEOGTRAN,m)}function h(m){return ae.PeFactory.prototype.getCode(m)}function p(m){return o(as.PE_TYPE_PROJCS,m)}function f(m){return o(as.PE_TYPE_UNIT,m)}t.initialize=n,t.coordsys=s,t.factoryByType=o,t.fromString=a,t.geogcs=l,t.geogtran=c,t.getCode=h,t.projcs=p,t.unit=f}(iJ||(iJ={}));let jAe=null;var pV,rJ,nJ,sJ,fV,oJ,mV,gV,aJ;function GAe(t){function e(s,o,a){s[o]=a(s[o])}ae=t,as.init(),pV.init(),fV.init(),mV.init(),gV.init(),jAe=class extends ae.PeGCSExtent{destroy(){ae.destroy(this)}};const i=[ae.PeDatum,ae.PeGeogcs,ae.PeGeogtran,ae.PeObject,ae.PeParameter,ae.PePrimem,ae.PeProjcs,ae.PeSpheroid,ae.PeUnit];for(const s of i)e(s.prototype,"getName",o=>function(){return o.call(this,new Array(as.PE_NAME_MAX))});for(const s of[ae.PeGeogtran,ae.PeProjcs])e(s.prototype,"getParameters",o=>function(){const a=new Array(as.PE_PARM_MAX);let l=o.call(this);for(let c=0;c<a.length;c++){const h=ae.getValue(l,"*");a[c]=h?ae.wrapPointer(h,ae.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return a});e(ae.PeHorizon.prototype,"getCoord",s=>function(){const o=this.getSize();if(!o)return null;const a=[];return Z1(a,o,s.call(this)),a}),e(ae.PeGTlistExtendedEntry.prototype,"getEntries",s=>{const o=ae._pe_getPeGTlistExtendedGTsSize();return function(){let a=null;const l=s.call(this);if(!ae.compare(l,ae.NULL)){a=[l];const c=this.getSteps();if(c>1){const h=ae.getPointer(l);for(let p=1;p<c;p++)a.push(ae.wrapPointer(h+o*p,ae.PeGTlistExtendedGTs))}}return a}});const r=ae._pe_getPeHorizonSize(),n=s=>function(){let o=this._cache;if(o||(o=new Map,this._cache=o),o.has(s))return o.get(s);let a=null;const l=s.call(this);if(!ae.compare(l,ae.NULL)){a=[l];const c=l.getNump();if(c>1){const h=ae.getPointer(l);for(let p=1;p<c;p++)a.push(ae.wrapPointer(h+r*p,ae.PeHorizon))}}return o.set(s,a),a};e(ae.PeProjcs.prototype,"horizonGcsGenerate",n),e(ae.PeProjcs.prototype,"horizonPcsGenerate",n),ae.PeObject.prototype.toString=function(s=as.PE_STR_OPTS_NONE){ae.ensureCache.prepare();const o=ae.getPointer(this),a=ae.ensureInt8(new Array(as.PE_BUFFER_MAX));return ae.UTF8ToString(ae._pe_object_to_string_ext(o,s,a))}}function Ly(t){if(!t)return;const e=ae.getClass(t);if(!e)return;const i=ae.getCache(e);if(!i)return;const r=ae.getPointer(t);r&&delete i[r]}function qF(t,e){const i=[],r=new Array(e);for(let n=0;n<t;n++)i.push(ae.ensureInt8(r));return i}function YT(t){let e;return Array.isArray(t[0])?(e=[],t.forEach(i=>{e.push(i[0],i[1])})):e=t,e}function Z1(t,e,i,r=!1){if(r)for(let n=0;n<2*e;n++)t[n]=ae.getValue(i+n*Float64Array.BYTES_PER_ELEMENT,"double");else{const n=t.length===0;for(let s=0;s<e;s++)n&&(t[s]=new Array(2)),t[s][0]=ae.getValue(i,"double"),t[s][1]=ae.getValue(i+Float64Array.BYTES_PER_ELEMENT,"double"),i+=2*Float64Array.BYTES_PER_ELEMENT}}(function(t){let e;function i(){t.PE_GTLIST_OPTS_COMMON=ae.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,e=ae._pe_getPeGTlistExtendedEntrySize()}function r(n,s,o,a,l,c){let h=null;const p=new ae.PeInteger(c);try{const f=ae.PeGTlistExtended.prototype.getGTlist(n,s,o,a,l,p);if((c=p.val)&&(h=[f],c>1)){const m=ae.getPointer(f);for(let g=1;g<c;g++)h.push(ae.wrapPointer(m+e*g,ae.PeGTlistExtendedEntry))}}finally{ae.destroy(p)}return h}t.init=i,t.getGTlist=r})(pV||(pV={})),function(t){function e(i){if(i&&i.length){for(const r of i)Ly(r),r.getEntries().forEach(n=>{Ly(n);const s=n.getGeogtran();Ly(s),s.getParameters().forEach(Ly),[s.getGeogcs1(),s.getGeogcs2()].forEach(o=>{Ly(o);const a=o.getDatum();Ly(a),Ly(a.getSpheroid()),Ly(o.getPrimem()),Ly(o.getUnit())})});ae.PeGTlistExtendedEntry.prototype.Delete(i[0])}}t.destroy=e}(rJ||(rJ={})),function(t){function e(i,r,n,s,o){ae.ensureCache.prepare();const a=YT(n),l=n===a,c=ae.ensureFloat64(a);let h=0;s&&(h=ae.ensureFloat64(s));const p=ae._pe_geog_to_geog(ae.getPointer(i),r,c,h,o);return p&&Z1(n,r,c,l),p}t.geogToGeog=e}(nJ||(nJ={})),function(t){const e=(c,h,p,f,m,g)=>{let _,b;switch(ae.ensureCache.prepare(),c){case"dd":_=ae._pe_geog_to_dd,b=as.PE_DD_MAX;break;case"ddm":_=ae._pe_geog_to_ddm,b=as.PE_DDM_MAX;break;case"dms":_=ae._pe_geog_to_dms,b=as.PE_DMS_MAX}let w=0;h&&(w=ae.getPointer(h));const x=YT(f),T=ae.ensureFloat64(x),E=qF(p,b),C=_(w,p,T,m,ae.ensureInt32(E));if(C)for(let A=0;A<p;A++)g[A]=ae.UTF8ToString(E[A]);return C},i=(c,h,p,f,m)=>{let g;switch(ae.ensureCache.prepare(),c){case"dd":g=ae._pe_dd_to_geog;break;case"ddm":g=ae._pe_ddm_to_geog;break;case"dms":g=ae._pe_dms_to_geog}let _=0;h&&(_=ae.getPointer(h));const b=f.map(E=>ae.ensureString(E)),w=ae.ensureInt32(b),x=ae.ensureFloat64(new Array(2*p)),T=g(_,p,w,x);return T&&Z1(m,p,x),T};function r(c,h,p,f,m){return e("dms",c,h,p,f,m)}function n(c,h,p,f){return i("dms",c,h,p,f)}function s(c,h,p,f,m){return e("ddm",c,h,p,f,m)}function o(c,h,p,f){return i("ddm",c,h,p,f)}function a(c,h,p,f,m){return e("dd",c,h,p,f,m)}function l(c,h,p,f){return i("dd",c,h,p,f)}t.geogToDms=r,t.dmsToGeog=n,t.geogToDdm=s,t.ddmToGeog=o,t.geogToDd=a,t.ddToGeog=l}(sJ||(sJ={})),function(t){function e(){t.PE_MGRS_STYLE_NEW=ae.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,t.PE_MGRS_STYLE_OLD=ae.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,t.PE_MGRS_STYLE_AUTO=ae.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,t.PE_MGRS_180_ZONE_1_PLUS=ae.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,t.PE_MGRS_ADD_SPACES=ae.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function i(n,s,o,a,l,c,h){ae.ensureCache.prepare();let p=0;n&&(p=ae.getPointer(n));const f=YT(o),m=ae.ensureFloat64(f),g=qF(s,as.PE_MGRS_MAX),_=ae.ensureInt32(g),b=ae._pe_geog_to_mgrs_extended(p,s,m,a,l,c,_);if(b)for(let w=0;w<s;w++)h[w]=ae.UTF8ToString(g[w]);return b}function r(n,s,o,a,l){ae.ensureCache.prepare();let c=0;n&&(c=ae.getPointer(n));const h=o.map(g=>ae.ensureString(g)),p=ae.ensureInt32(h),f=ae.ensureFloat64(new Array(2*s)),m=ae._pe_mgrs_to_geog_extended(c,s,p,a,f);return m&&Z1(l,s,f),m}t.init=e,t.geogToMgrsExtended=i,t.mgrsToGeogExtended=r}(fV||(fV={})),function(t){function e(r,n,s,o,a,l,c){ae.ensureCache.prepare();let h=0;r&&(h=ae.getPointer(r));const p=YT(s),f=ae.ensureFloat64(p),m=qF(n,as.PE_MGRS_MAX),g=ae.ensureInt32(m),_=ae._pe_geog_to_usng(h,n,f,o,a,l,g);if(_)for(let b=0;b<n;b++)c[b]=ae.UTF8ToString(m[b]);return _}function i(r,n,s,o){ae.ensureCache.prepare();let a=0;r&&(a=ae.getPointer(r));const l=s.map(f=>ae.ensureString(f)),c=ae.ensureInt32(l),h=ae.ensureFloat64(new Array(2*n)),p=ae._pe_usng_to_geog(a,n,c,h);return p&&Z1(o,n,h),p}t.geogToUsng=e,t.usngToGeog=i}(oJ||(oJ={})),function(t){function e(){t.PE_UTM_OPTS_NONE=ae.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,t.PE_UTM_OPTS_ADD_SPACES=ae.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,t.PE_UTM_OPTS_NS=ae.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function i(n,s,o,a,l){ae.ensureCache.prepare();let c=0;n&&(c=ae.getPointer(n));const h=YT(o),p=ae.ensureFloat64(h),f=qF(s,as.PE_UTM_MAX),m=ae.ensureInt32(f),g=ae._pe_geog_to_utm(c,s,p,a,m);if(g)for(let _=0;_<s;_++)l[_]=ae.UTF8ToString(f[_]);return g}function r(n,s,o,a,l){ae.ensureCache.prepare();let c=0;n&&(c=ae.getPointer(n));const h=o.map(g=>ae.ensureString(g)),p=ae.ensureInt32(h),f=ae.ensureFloat64(new Array(2*s)),m=ae._pe_utm_to_geog(c,s,p,a,f);return m&&Z1(l,s,f),m}t.init=e,t.geogToUtm=i,t.utmToGeog=r}(mV||(mV={})),function(t){const e=new Map;function i(){t.PE_PCSINFO_OPTION_NONE=ae.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,t.PE_PCSINFO_OPTION_DOMAIN=ae.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,t.PE_POLE_OUTSIDE_BOUNDARY=ae.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,t.PE_POLE_POINT=ae.PePCSInfo.prototype.PE_POLE_POINT}function r(n,s=t.PE_PCSINFO_OPTION_DOMAIN){let o=null,a=null;return e.has(n)&&(a=e.get(n),a[s]&&(o=a[s])),o||(o=ae.PePCSInfo.prototype.generate(n,s),a||(a=[],e.set(n,a)),a[s]=o),o}t.init=i,t.generate=r}(gV||(gV={})),function(t){function e(){return ae.PeVersion.prototype.version_string()}t.versionString=e}(aJ||(aJ={}));const dZe=Object.freeze(Object.defineProperty({__proto__:null,get PeCSTransformations(){return tJ},get PeDefs(){return as},get PeFactory(){return iJ},get PeGCSExtent(){return jAe},get PeGTTransformations(){return nJ},get PeGTlistExtended(){return pV},get PeGTlistExtendedEntry(){return rJ},get PeNotationDms(){return sJ},get PeNotationMgrs(){return fV},get PeNotationUsng(){return oJ},get PeNotationUtm(){return mV},get PePCSInfo(){return gV},get PeVersion(){return aJ},_init:GAe,get _pe(){return ae},isLoaded:zAe,isSupported:hZe,load:BAe},Symbol.toStringTag,{value:"Module"})),Mzt=Math.PI/180,Ozt=/SPHEROID\[([^\]]+)]/i,fv=Ci.radius,Yp=Ci.eccentricitySquared,pZe={a1:fv*Yp,a2:fv*Yp*fv*Yp,a3:fv*Yp*Yp/2,a4:fv*Yp*fv*Yp*2.5,a5:fv*Yp+fv*Yp*Yp/2,a6:1-Yp},Pzt={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:Ci.radius,f:Ci.flattening},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:C_.radius,f:C_.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:Yg.radius,f:Yg.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:Yg.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};let WF=0,eG=class lJ{static fromGE(e){const i=new lJ;return i._wkt=e.wkt,i._wkid=e.wkid,i._isInverse=e.isInverse,i}constructor(e){this.uid=WF++,e?(this._wkt=e.wkt!=null?e.wkt:null,this._wkid=e.wkid!=null?e.wkid:-1,this._isInverse=e.isInverse!=null&&e.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}get wkt(){return this._wkt}set wkt(e){this._wkt=e,this.uid=WF++}get wkid(){return this._wkid}set wkid(e){this._wkid=e,this.uid=WF++}get isInverse(){return this._isInverse}set isInverse(e){this._isInverse=e,this.uid=WF++}getInverse(){const e=new lJ;return e._wkt=this.wkt,e._wkid=this._wkid,e._isInverse=!this.isInverse,e}},cJ=class qP{static cacheKey(e,i){return[e.wkid!==void 0&&e.wkid!==null?e.wkid.toString():"-1",e.wkt!==void 0&&e.wkt!==null?e.wkt.toString():"",i.wkid!==void 0&&i.wkid!==null?i.wkid.toString():"-1",i.wkt!==void 0&&i.wkt!==null?i.wkt.toString():""].join(",")}static fromGE(e){const i=new qP;let r="";for(const n of e.steps){const s=eG.fromGE(n);i.steps.push(s),r+=s.uid.toString()+","}return i._cachedProjection={},i._gtlistentry=null,i._chain=r,i}constructor(e){if(this.steps=[],this._cachedProjection={},this._chain="",this._gtlistentry=null,e&&e.steps)for(const i of e.steps)i instanceof eG?this.steps.push(i):this.steps.push(new eG({wkid:i.wkid,wkt:i.wkt,isInverse:i.isInverse}))}getInverse(){const e=new qP;e.steps=[];for(let i=this.steps.length-1;i>=0;i--){const r=this.steps[i];e.steps.push(r.getInverse())}return e}getGTListEntry(){let e="";for(const i of this.steps)e+=i.uid.toString()+",";return e!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=e),this._gtlistentry}assignCachedGe(e,i,r){this._cachedProjection[qP.cacheKey(e,i)]=r}getCachedGeTransformation(e,i){let r="";for(const s of this.steps)r+=s.uid.toString()+",";r!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=r);const n=this._cachedProjection[qP.cacheKey(e,i)];return n===void 0?null:n}};function HAe(t,e,i){if(R(e)||R(i)||i.vcsWkid||Dn(e,i))return null;const r=r2(e)/r2(i);if(r===1)return null;switch(t){case"point":case"esriGeometryPoint":return n=>fZe(n,r);case"polyline":case"esriGeometryPolyline":return n=>gZe(n,r);case"polygon":case"esriGeometryPolygon":return n=>mZe(n,r);case"multipoint":case"esriGeometryMultipoint":return n=>yZe(n,r);case"extent":case"esriGeometryExtent":return n=>_Ze(n,r);default:return null}}function fZe(t,e){t&&t.z!=null&&(t.z*=e)}function mZe(t,e){if(t)for(const i of t.rings)for(const r of i)r.length>2&&(r[2]*=e)}function gZe(t,e){if(t)for(const i of t.paths)for(const r of i)r.length>2&&(r[2]*=e)}function yZe(t,e){if(t)for(const i of t.points)i.length>2&&(i[2]*=e)}function _Ze(t,e){t&&t.zmin!=null&&t.zmax!=null&&(t.zmin*=e,t.zmax*=e)}let Vb=null,eD=null,tG=null,iG={};const qAe=new gne;function c2(){return!!Vb&&zAe()}function u2(t){return R(tG)&&(tG=Promise.all([BAe(),Q(()=>import("./geometryEngineBase-e1a33b0a.js"),[]).then(e=>e.g),Q(()=>import("./hydrated-343069df.js"),[])])),tG.then(([,e,{hydratedAdapter:i}])=>{ui(t),eD=i,Vb=e.default,Vb._enableProjection(dZe),qAe.notify()})}function Sm(t,e,i=null,r=null){return Array.isArray(t)?t.length===0?[]:Ide(eD,t,t[0].spatialReference,e,i,r):Ide(eD,[t],t.spatialReference,e,i,r)[0]}function Ide(t,e,i,r,n=null,s=null){if(R(i)||R(r))return e;if(my(i,r,n))return e.map(o=>XAe(o,i,r));if(R(n)){const o=cJ.cacheKey(i,r);iG[o]!==void 0?n=iG[o]:(n=bZe(i,r,void 0),R(n)&&(n=new cJ),iG[o]=n)}if(R(Vb)||R(t))throw new dse;return v(s)?Vb._project(t,e,i,r,n,s):Vb._project(t,e,i,r,n)}function yV(t,e){const i=vZe([t],e);return v(i.pending)?{pending:i.pending,geometry:null}:v(i.geometries)?{pending:null,geometry:i.geometries[0]}:{pending:null,geometry:null}}function vZe(t,e){if(!c2()){for(const i of t)if(v(i)&&!Dn(i.spatialReference,e)&&Fa(i.spatialReference)&&Fa(e)&&!my(i.spatialReference,e))return Ei(qAe),{pending:u2(),geometries:null}}return{pending:null,geometries:t.map(i=>R(i)?null:Dn(i.spatialReference,e)?i:Fa(i.spatialReference)&&Fa(e)?wZe(i,e):null)}}function bZe(t,e,i=null){if(R(t)||R(e))return null;if(R(Vb)||R(eD))throw new dse;const r=Vb._getTransformation(eD,t,e,i,i==null?void 0:i.spatialReference);return r!==null?cJ.fromGE(r):null}class dse extends H{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}var K;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",t[t.WGS84=2]="WGS84",t[t.WEB_MERCATOR=3]="WEB_MERCATOR",t[t.WGS84_ECEF=4]="WGS84_ECEF",t[t.CGCS2000=5]="CGCS2000",t[t.WGS84_COMPARABLE_LON_LAT=6]="WGS84_COMPARABLE_LON_LAT",t[t.SPHERICAL_MARS_PCPF=7]="SPHERICAL_MARS_PCPF",t[t.GCSMARS2000=8]="GCSMARS2000",t[t.SPHERICAL_MOON_PCPF=9]="SPHERICAL_MOON_PCPF",t[t.GCSMOON2000=10]="GCSMOON2000",t[t.LON_LAT=11]="LON_LAT",t[t.PLATE_CARREE=12]="PLATE_CARREE"})(K||(K={}));function wZe(t,e){try{const i=Sm(t,e);if(i==null)return null;"xmin"in t&&"xmin"in i&&(i.zmin=t.zmin,i.zmax=t.zmax);const r=HAe(i.type,t.spatialReference,e);return v(r)&&r(i),i}catch(i){if(!(i instanceof dse))throw i;return null}}function my(t,e,i){return!i&&(!!Dn(t,e)||Fa(t)&&Fa(e)&&!!gse(t,e,_se))}async function WAe(t,e,i,r){if(c2())return Nhe(r);if(Array.isArray(t)){for(const{source:n,dest:s,geographicTransformation:o}of t)if(!my(n,s,o))return u2(r)}else if(!my(t,e,i))return u2(r);return Nhe(r)}function Izt(t,e){switch(gse(t,e,_se)){case qr:return"copy3";case mb:return"wgs84ToSphericalECEF";case h2:return"wgs84ToWebMercator";case fb:return"wgs84ToPlateCarree";case yb:return"wgs84ToWGS84ECEF";case DS:return"webMercatorToWGS84";case eRe:return"webMercatorToSphericalECEF";case tRe:return"webMercatorToWGS84ECEF";case iRe:return"webMercatorToPlateCarree";case _b:return"wgs84ECEFToWGS84";case sRe:return"wgs84ECEFToSphericalECEF";case oRe:return"wgs84ECEFToWebMercator";case gb:return"sphericalECEFToWGS84";case rRe:return"sphericalECEFToWebMercator";case pJ:return"sphericalMarsPCPFToMars2000";case dJ:return"sphericalMoonPCPFToMoon2000";case nRe:return"sphericalECEFToWGS84ECEF";case hJ:return"mars2000ToSphericalPCPF";case uJ:return"moon2000ToSphericalPCPF";default:return null}}function XAe(t,e,i){return t?"x"in t?YAe(t,e,new Le,i,0):"xmin"in t?EZe(t,e,new ni,i,0):"rings"in t?ZAe(t,e,new ec,i,0):"paths"in t?SZe(t,e,new Wf,i,0):"points"in t?TZe(t,e,new mN,i,0):null:null}function xZe(t,e,i=e.spatialReference,r=0){return v(i)&&v(t.spatialReference)&&v(YAe(t,t.spatialReference,e,i,r))}function YAe(t,e,i,r,n){ur[0]=t.x,ur[1]=t.y;const s=t.z;return ur[2]=s!==void 0?s:n,Nn(ur,e,0,ur,r,0,1)?(i.x=ur[0],i.y=ur[1],i.spatialReference=r,s===void 0?(i.z=void 0,i.hasZ=!1):(i.z=ur[2],i.hasZ=!0),t.m===void 0?(i.m=void 0,i.hasM=!1):(i.m=t.m,i.hasM=!0),i):null}function TZe(t,e,i,r,n){const{points:s,hasZ:o,hasM:a}=t,l=[],c=s.length,h=[];for(const p of s)h.push(p[0],p[1],o?p[2]:n);if(!Nn(h,e,0,h,r,0,c))return null;for(let p=0;p<c;++p){const f=3*p,m=h[f],g=h[f+1];o&&a?l.push([m,g,h[f+2],s[p][3]]):o?l.push([m,g,h[f+2]]):a?l.push([m,g,s[p][2]]):l.push([m,g])}return i.points=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i}function SZe(t,e,i,r,n){const{paths:s,hasZ:o,hasM:a}=t,l=[];return KAe(s,o??!1,a??!1,e,l,r,n)?(i.paths=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i):null}function $zt(t,e,i=e.spatialReference,r=0){return v(t.spatialReference)&&v(i)&&v(ZAe(t,t.spatialReference,e,i,r))}function ZAe(t,e,i,r,n){const{rings:s,hasZ:o,hasM:a}=t,l=[];return KAe(s,o??!1,a??!1,e,l,r,n)?(i.rings=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i):null}function EZe(t,e,i,r,n){const{xmin:s,ymin:o,xmax:a,ymax:l,hasZ:c,hasM:h}=t;return $de(s,o,c?t.zmin:n,e,ur,r)?(i.xmin=ur[0],i.ymin=ur[1],c&&(i.zmin=ur[2]),$de(a,l,c?t.zmax:n,e,ur,r)?(i.xmax=ur[0],i.ymax=ur[1],c&&(i.zmax=ur[2]),h&&(i.mmin=t.mmin,i.mmax=t.mmax),i.spatialReference=r,i):null):null}function lw(t,e,i){if(R(e)||R(i))return null;const r=new Le({spatialReference:i});return Nn(t,e,0,ur,i,0,1)?(r.x=ur[0],r.y=ur[1],r.z=ur[2],r):null}function JAe(t,e,i){return Nn(t,e,0,ur,i.spatialReference,0,1)?(i.x=ur[0],i.y=ur[1],i.z=ur[2],i):null}function qa(t,e,i,r=0){ur[0]=t.x,ur[1]=t.y;const n=t.z;return ur[2]=n!==void 0?n:r,Nn(ur,t.spatialReference,0,e,i,0,1)}function $de(t,e,i,r,n,s){return On[0]=t,On[1]=e,On[2]=i,Nn(On,r,0,n,s,0,1)}function jo(t,e,i,r){return!(R(e)||R(r)||t.length<2)&&(t.length===2&&(On[0]=t[0],On[1]=t[1],On[2]=0,t=On),Nn(t,e,0,i,r,0,1))}function CZe(t,e){ur[0]=t.x,ur[1]=t.y;const i=t.z;return ur[2]=i!==void 0?i:0,AZe(ur,t.spatialReference,e)}function AZe(t,e,i){return RZe(t,e,i)}function RZe(t,e,i){if(R(e))return!1;const r=cw(e,cB),n=zg[r][K.WGS84_COMPARABLE_LON_LAT];return!R(n)&&(n(t,0,On,0),i!==On&&(i[0]=On[0],i[1]=On[1],i.length>2&&(i[2]=On[2])),!0)}function Nn(t,e,i,r,n,s,o=1){const a=gse(e,n,_se);if(R(a))return!1;if(a===qr){if(t===r&&i===s)return!0;const c=i+3*o;for(let h=i,p=s;h<c;h++,p++)r[p]=t[h];return!0}const l=i+3*o;for(let c=i,h=s;c<l;c+=3,h+=3)a(t,c,r,h);return!0}function Lzt(t,e,i,r,n){ce(ur,t),me(XF,t,e),jo(ur,i,ur,n),jo(XF,i,XF,n),ge(r,XF,ur),we(r,r)}function KAe(t,e,i,r,n,s,o=0){const a=new Array;for(const c of t)for(const h of c)a.push(h[0],h[1],e?h[2]:o);if(!Nn(a,r,0,a,s,0,a.length/3))return!1;let l=0;n.length=0;for(const c of t){const h=new Array;for(const p of c)e&&i?h.push([a[l++],a[l++],a[l++],p[3]]):e?h.push([a[l++],a[l++],a[l++]]):i?(h.push([a[l++],a[l++],p[2]]),l++):(h.push([a[l++],a[l++]]),l++);n.push(h)}return!0}function Dzt(t,e,i,r){if(R(e)||R(r))return!1;const n=aRe(e,r,FZe);if(n.projector===qr)return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],!0;if(R(n.projector))return!1;const{source:s,dest:o}=n;if(o.spatialReferenceId===K.WEB_MERCATOR){const a=zg[s.spatialReferenceId][K.WGS84];return!R(a)&&(a(t,0,Df,0),h2(Df,0,i,0),i[3]=Lde(Df[1],t[2],t[3],Ci.radius),!0)}if(s.spatialReferenceId!==K.WGS84&&s.spatialReferenceId!==K.CGCS2000||o.spatialReferenceId!==K.PLATE_CARREE){n.projector(t,0,i,0);const a=s.metersPerUnit??1,l=o.metersPerUnit??1;i[3]=t[3]*a/l}else{const a=zg[s.spatialReferenceId][K.SPHERICAL_ECEF],l=zg[K.SPHERICAL_ECEF][K.PLATE_CARREE];let c=t[3];v(a)&&v(l)&&(c=Lde(t[1],t[2],t[3],Ci.radius)),n.projector(t,0,i,0),i[3]=c}return!0}function Lde(t,e,i,r){const n=r+e;if(n<r/2||i>n)return Number.MAX_VALUE;const s=Math.abs(Kf*t)+Math.asin(i/n);return s>=Math.PI/2?Number.MAX_VALUE:i/Math.cos(s)}function lB(t,e,i,r){return t!=null&&(Dn(e,r)?(A_(i,t),!0):(On[0]=t[0],On[1]=t[1],On[2]=0,!!Nn(On,e,0,On,r,0,1)&&(i[0]=On[0],i[1]=On[1],On[0]=t[2],On[1]=t[3],On[2]=0,!!Nn(On,e,0,On,r,0,1)&&(i[2]=On[0],i[3]=On[1],!0))))}function Nzt(t,e,i,r){if(R(e)||R(r))return!1;const n=cw(e,cB),s=cw(r,lRe);if(n===s&&n!==K.UNKNOWN||Dn(e,r))return i[0]=1,i[1]=1,i[2]=1,!0;if(n===K.SPHERICAL_ECEF){const o=Pe(t),a=o/Math.sqrt(t[0]*t[0]+t[1]*t[1]),l=o/Ci.radius;if(s===K.WEB_MERCATOR)return i[0]=a*l,i[1]=a*l,i[2]=1,!0;if(s===K.WGS84||s===K.CGCS2000){const c=R$;return i[0]=c*a*l,i[1]=c*l,i[2]=1,!0}}else if(n===K.PLATE_CARREE){if(s===K.WGS84||s===K.CGCS2000)return i[0]=R$,i[1]=R$,i[2]=1,!0;if(s===K.WEB_MERCATOR){const o=t[1]/Ci.radius;return i[0]=1,i[1]=1/Math.cos(o),i[2]=1,!0}}return!1}function ym(t,e,i,r){if(R(t)||R(r))return!1;const n=cw(t,cB),s=cw(r,lRe);if(n===s&&!Dde(s)&&(n!==K.UNKNOWN||Dn(t,r)))return sB(i,e),!0;if(Dde(s)){const o=zg[n][K.LON_LAT],a=zg[K.LON_LAT][s];return!R(o)&&!R(a)&&(o(e,0,Df,0),a(Df,0,mv,0),QAe(Kf*Df[0],Kf*Df[1],i),i[12]=mv[0],i[13]=mv[1],i[14]=mv[2],!0)}if((s===K.WEB_MERCATOR||s===K.PLATE_CARREE)&&(n===K.WGS84||n===K.CGCS2000&&s===K.PLATE_CARREE||n===K.SPHERICAL_ECEF||n===K.WEB_MERCATOR)){const o=zg[n][K.LON_LAT],a=zg[K.LON_LAT][s];return!R(o)&&!R(a)&&(o(e,0,Df,0),a(Df,0,mv,0),n===K.SPHERICAL_ECEF?MZe(Kf*Df[0],Kf*Df[1],i):Lp(i),i[12]=mv[0],i[13]=mv[1],i[14]=mv[2],!0)}return!1}function Dde(t){return t===K.SPHERICAL_ECEF||t===K.SPHERICAL_MARS_PCPF||t===K.SPHERICAL_MOON_PCPF}function QAe(t,e,i){const r=Math.sin(t),n=Math.cos(t),s=Math.sin(e),o=Math.cos(e),a=i;return a[0]=-r,a[4]=-s*n,a[8]=o*n,a[12]=0,a[1]=n,a[5]=-s*r,a[9]=o*r,a[13]=0,a[2]=0,a[6]=o,a[10]=s,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function MZe(t,e,i){return QAe(t,e,i),Ku(i,i),i}function cw(t,e){return t?e.spatialReference===t?e.spatialReferenceId:(e.spatialReference=t,"metersPerUnit"in e&&(e.metersPerUnit=tc(t,1)),t.wkt===k2e.wkt?e.spatialReferenceId=K.SPHERICAL_ECEF:BL(t)?e.spatialReferenceId=K.WGS84:Kb(t)?e.spatialReferenceId=K.WEB_MERCATOR:ine(t)?e.spatialReferenceId=K.PLATE_CARREE:t.wkt===U2e.wkt?e.spatialReferenceId=K.WGS84_ECEF:t.wkid===hp.CGCS2000?e.spatialReferenceId=K.CGCS2000:t.wkt===one.wkt?e.spatialReferenceId=K.SPHERICAL_MARS_PCPF:t.wkt===ane.wkt?e.spatialReferenceId=K.SPHERICAL_MOON_PCPF:wy(t)?e.spatialReferenceId=K.GCSMARS2000:xy(t)?e.spatialReferenceId=K.GCSMOON2000:e.spatialReferenceId=K.UNKNOWN):K.UNKNOWN}function qr(t,e,i,r){t!==i&&(i[r++]=t[e++],i[r++]=t[e++],i[r]=t[e])}function DS(t,e,i,r){i[r++]=MM*(t[e++]/Ci.radius),i[r++]=MM*(Math.PI/2-2*Math.atan(Math.exp(-t[e++]/Ci.radius))),i[r]=t[e]}function eRe(t,e,i,r){DS(t,e,i,r),mb(i,r,i,r)}function tRe(t,e,i,r){DS(t,e,i,r),yb(i,r,i,r)}function pse(t,e,i,r,n){const s=.4999999*Math.PI,o=_e(Kf*t[e+1],-s,s),a=Math.sin(o);i[r++]=Kf*t[e]*n.radius,i[r++]=n.halfSemiMajorAxis*Math.log((1+a)/(1-a)),i[r]=t[e+2]}function h2(t,e,i,r){pse(t,e,i,r,Ci)}const Nde=Ci.radius*Math.PI/180,R$=180/(Ci.radius*Math.PI);function fb(t,e,i,r){i[r]=t[e]*Nde,i[r+1]=t[e+1]*Nde,i[r+2]=t[e+2]}function _S(t,e,i,r){i[r]=t[e]*R$,i[r+1]=t[e+1]*R$,i[r+2]=t[e+2]}function iRe(t,e,i,r){DS(t,e,i,r),fb(i,r,i,r)}function OZe(t,e,i,r){_b(t,e,i,r),fb(i,r,i,r)}function PZe(t,e,i,r){gb(t,e,i,r),fb(i,r,i,r)}function IZe(t,e,i,r){_S(t,e,i,r),mb(i,r,i,r)}function $Ze(t,e,i,r){_S(t,e,i,r),h2(i,r,i,r)}function LZe(t,e,i,r){_S(t,e,i,r),yb(i,r,i,r)}function d2(t){if(R(t))return!1;const e=cw(t,cB);return!!zg[e][K.WGS84_COMPARABLE_LON_LAT]}function DZe(t,e,i,r){const n=Math.cos(i);t[0]=Math.cos(e)*n*r,t[1]=Math.sin(e)*n*r,t[2]=Math.sin(i)*r}function fse(t,e,i,r,n){const s=n+t[e+2],o=Kf*t[e+1],a=Kf*t[e],l=Math.cos(o);i[r++]=Math.cos(a)*l*s,i[r++]=Math.sin(a)*l*s,i[r]=Math.sin(o)*s}function uJ(t,e,i,r){fse(t,e,i,r,C_.radius)}function hJ(t,e,i,r){fse(t,e,i,r,Yg.radius)}function mb(t,e,i,r){fse(t,e,i,r,Ci.radius)}function mse(t,e,i,r,n){const s=t[e],o=t[e+1],a=t[e+2],l=Math.sqrt(s*s+o*o+a*a),c=Pp(a/(l===0?1:l)),h=Math.atan2(o,s);i[r++]=MM*h,i[r++]=MM*c,i[r]=l-n}function dJ(t,e,i,r){mse(t,e,i,r,C_.radius)}function pJ(t,e,i,r){mse(t,e,i,r,Yg.radius)}function gb(t,e,i,r){mse(t,e,i,r,Ci.radius)}function rRe(t,e,i,r){gb(t,e,i,r),h2(i,r,i,r)}function nRe(t,e,i,r){gb(t,e,i,r),yb(i,r,i,r)}function NZe(t,e,i,r,n){const s=Kf*t[e],o=Kf*t[e+1],a=t[e+2],l=Math.sin(o),c=Math.cos(o),h=n.radius/Math.sqrt(1-n.eccentricitySquared*l*l);i[r++]=(h+a)*c*Math.cos(s),i[r++]=(h+a)*c*Math.sin(s),i[r++]=(h*(1-n.eccentricitySquared)+a)*l}function yb(t,e,i,r){NZe(t,e,i,r,Ci)}function _b(t,e,i,r){const n=pZe,s=t[e],o=t[e+1],a=t[e+2];let l,c,h,p,f,m,g,_,b,w,x,T,E,C,A,I,O,D,U,V,B;l=Math.abs(a),c=s*s+o*o,h=Math.sqrt(c),p=c+a*a,f=Math.sqrt(p),V=Math.atan2(o,s),m=a*a/p,g=c/p,C=n.a2/f,A=n.a3-n.a4/f,g>.3?(_=l/f*(1+g*(n.a1+C+m*A)/f),U=Math.asin(_),w=_*_,b=Math.sqrt(1-w)):(b=h/f*(1-m*(n.a5-C-g*A)/f),U=Math.acos(b),w=1-b*b,_=Math.sqrt(w)),x=1-Ci.eccentricitySquared*w,T=Ci.radius/Math.sqrt(x),E=n.a6*T,C=h-T*b,A=l-E*_,O=b*C+_*A,I=b*A-_*C,D=I/(E/x+O),U+=D,B=O+I*D/2,a<0&&(U=-U),i[r++]=MM*V,i[r++]=MM*U,i[r]=B}function sRe(t,e,i,r){_b(t,e,i,r),mb(i,r,i,r)}function oRe(t,e,i,r){_b(t,e,i,r),h2(i,r,i,r)}const zg={[K.WGS84]:{[K.CGCS2000]:null,[K.GCSMARS2000]:null,[K.GCSMOON2000]:null,[K.LON_LAT]:qr,[K.WGS84_COMPARABLE_LON_LAT]:qr,[K.SPHERICAL_ECEF]:mb,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:h2,[K.PLATE_CARREE]:fb,[K.WGS84]:qr,[K.WGS84_ECEF]:yb},[K.CGCS2000]:{[K.CGCS2000]:qr,[K.GCSMARS2000]:null,[K.GCSMOON2000]:null,[K.LON_LAT]:qr,[K.WGS84_COMPARABLE_LON_LAT]:qr,[K.SPHERICAL_ECEF]:mb,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:null,[K.PLATE_CARREE]:fb,[K.WGS84]:null,[K.WGS84_ECEF]:yb},[K.GCSMARS2000]:{[K.CGCS2000]:null,[K.GCSMARS2000]:qr,[K.GCSMOON2000]:null,[K.LON_LAT]:qr,[K.WGS84_COMPARABLE_LON_LAT]:null,[K.SPHERICAL_ECEF]:null,[K.SPHERICAL_MARS_PCPF]:hJ,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:null,[K.PLATE_CARREE]:null,[K.WGS84]:null,[K.WGS84_ECEF]:null},[K.GCSMOON2000]:{[K.CGCS2000]:null,[K.GCSMARS2000]:null,[K.GCSMOON2000]:qr,[K.LON_LAT]:qr,[K.WGS84_COMPARABLE_LON_LAT]:null,[K.SPHERICAL_ECEF]:null,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:uJ,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:null,[K.PLATE_CARREE]:null,[K.WGS84]:null,[K.WGS84_ECEF]:null},[K.WEB_MERCATOR]:{[K.CGCS2000]:null,[K.GCSMARS2000]:null,[K.GCSMOON2000]:null,[K.LON_LAT]:DS,[K.WGS84_COMPARABLE_LON_LAT]:DS,[K.SPHERICAL_ECEF]:eRe,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:qr,[K.PLATE_CARREE]:iRe,[K.WGS84]:DS,[K.WGS84_ECEF]:tRe},[K.WGS84_ECEF]:{[K.CGCS2000]:_b,[K.GCSMARS2000]:null,[K.GCSMOON2000]:null,[K.LON_LAT]:_b,[K.WGS84_COMPARABLE_LON_LAT]:_b,[K.SPHERICAL_ECEF]:sRe,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:oRe,[K.PLATE_CARREE]:OZe,[K.WGS84]:_b,[K.WGS84_ECEF]:qr},[K.SPHERICAL_ECEF]:{[K.CGCS2000]:gb,[K.GCSMARS2000]:null,[K.GCSMOON2000]:null,[K.LON_LAT]:gb,[K.WGS84_COMPARABLE_LON_LAT]:gb,[K.SPHERICAL_ECEF]:qr,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:rRe,[K.PLATE_CARREE]:PZe,[K.WGS84]:gb,[K.WGS84_ECEF]:nRe},[K.SPHERICAL_MARS_PCPF]:{[K.CGCS2000]:null,[K.GCSMARS2000]:pJ,[K.GCSMOON2000]:null,[K.LON_LAT]:pJ,[K.WGS84_COMPARABLE_LON_LAT]:null,[K.SPHERICAL_ECEF]:null,[K.SPHERICAL_MARS_PCPF]:qr,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:null,[K.PLATE_CARREE]:null,[K.WGS84]:null,[K.WGS84_ECEF]:null},[K.SPHERICAL_MOON_PCPF]:{[K.CGCS2000]:null,[K.GCSMARS2000]:null,[K.GCSMOON2000]:dJ,[K.LON_LAT]:dJ,[K.WGS84_COMPARABLE_LON_LAT]:null,[K.SPHERICAL_ECEF]:null,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:qr,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:null,[K.PLATE_CARREE]:null,[K.WGS84]:null,[K.WGS84_ECEF]:null},[K.UNKNOWN]:{[K.CGCS2000]:null,[K.GCSMARS2000]:null,[K.GCSMOON2000]:null,[K.LON_LAT]:null,[K.WGS84_COMPARABLE_LON_LAT]:null,[K.SPHERICAL_ECEF]:null,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:qr,[K.WEB_MERCATOR]:null,[K.PLATE_CARREE]:null,[K.WGS84]:null,[K.WGS84_ECEF]:null},[K.LON_LAT]:{[K.CGCS2000]:qr,[K.GCSMARS2000]:qr,[K.GCSMOON2000]:qr,[K.LON_LAT]:qr,[K.WGS84_COMPARABLE_LON_LAT]:qr,[K.SPHERICAL_ECEF]:mb,[K.SPHERICAL_MARS_PCPF]:hJ,[K.SPHERICAL_MOON_PCPF]:uJ,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:h2,[K.PLATE_CARREE]:fb,[K.WGS84]:qr,[K.WGS84_ECEF]:yb},[K.WGS84_COMPARABLE_LON_LAT]:{[K.CGCS2000]:null,[K.GCSMARS2000]:null,[K.GCSMOON2000]:null,[K.LON_LAT]:qr,[K.WGS84_COMPARABLE_LON_LAT]:qr,[K.SPHERICAL_ECEF]:mb,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:null,[K.PLATE_CARREE]:fb,[K.WGS84]:qr,[K.WGS84_ECEF]:yb},[K.PLATE_CARREE]:{[K.CGCS2000]:_S,[K.GCSMARS2000]:null,[K.GCSMOON2000]:null,[K.LON_LAT]:_S,[K.WGS84_COMPARABLE_LON_LAT]:_S,[K.SPHERICAL_ECEF]:IZe,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:$Ze,[K.PLATE_CARREE]:qr,[K.WGS84]:_S,[K.WGS84_ECEF]:LZe}};function gse(t,e,i=yse()){return R(t)||R(e)?null:aRe(t,e,i).projector}function aRe(t,e,i){if(R(t)||R(e)||i.source.spatialReference===t&&i.dest.spatialReference===e)return i;const r=cw(t,i.source),n=cw(e,i.dest);return r===K.UNKNOWN&&n===K.UNKNOWN?Dn(t,e)?i.projector=qr:i.projector=null:i.projector=zg[r][n],i}function yse(){return{source:{spatialReference:null,spatialReferenceId:K.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:K.UNKNOWN,metersPerUnit:1},projector:qr}}const cB={spatialReference:null,spatialReferenceId:K.UNKNOWN},lRe={spatialReference:null,spatialReferenceId:K.UNKNOWN},_se=yse(),FZe=yse(),Kf=Xt(1),MM=ml(1),On=P(),Df=P(),mv=P(),ur=P(),XF=P();var fJ;let ag=fJ=class extends fe{constructor(t){super(t),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new fJ({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],ag.prototype,"cols",void 0),u([d({type:Kr,json:{write:!0}})],ag.prototype,"level",void 0),u([d({type:String,json:{write:!0}})],ag.prototype,"levelValue",void 0),u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],ag.prototype,"origin",void 0),u([d({type:Number,json:{write:!0}})],ag.prototype,"resolution",void 0),u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],ag.prototype,"rows",void 0),u([d({type:Number,json:{write:!0}})],ag.prototype,"scale",void 0),ag=fJ=u([$("esri.layers.support.LOD")],ag);const rp=ag;let kZe=class{constructor(e,i,r,n,s){this.id=e,this.level=i,this.row=r,this.col=n,this.extent=s}};var o1;const Fde=new mi({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let Ko=o1=class extends fe{static create(t={}){const{resolutionFactor:e=1,scales:i,size:r=256,spatialReference:n=Je.WebMercator,numLODs:s=24}=t;if(!Fa(n)){const p=[];if(i)for(let f=0;f<i.length;f++){const m=i[f];p.push(new rp({level:f,scale:m,resolution:m}))}else{let f=5e-4;for(let m=s-1;m>=0;m--)p.unshift(new rp({level:m,scale:f,resolution:f})),f*=2}return new o1({dpi:96,lods:p,origin:new Le(0,0,n),size:[r,r],spatialReference:n})}const o=bp(n),a=t.origin?new Le({x:t.origin.x,y:t.origin.y,spatialReference:n}):new Le(o?{x:o.origin[0],y:o.origin[1],spatialReference:n}:{x:0,y:0,spatialReference:n}),l=96,c=1/(tc(n)*39.37*l),h=[];if(i)for(let p=0;p<i.length;p++){const f=i[p],m=f*c;h.push(new rp({level:p,scale:f,resolution:m}))}else{let p=N2e(n)?512/r*5916575275917094e-7:256/r*591657527591555e-6;const f=Math.ceil(s/e);h.push(new rp({level:0,scale:p,resolution:p*c}));for(let m=1;m<f;m++){const g=p/2**e,_=g*c;h.push(new rp({level:m,scale:g,resolution:_})),p=g}}return new o1({dpi:l,lods:h,origin:a,size:[r,r],spatialReference:n})}constructor(t){super(t),this.dpi=96,this.format=null,this.origin=null,this.minScale=0,this.maxScale=0,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:t,origin:e}=this;if(t&&e){const i=bp(t);return t.isWrappable&&!!i&&Math.abs(i.origin[0]-e.x)<=i.dx}return!1}readOrigin(t,e){return Le.fromJSON({spatialReference:e.spatialReference,...t})}set lods(t){let e=0,i=0;const r=[],n=this._levelToLOD={};t&&(e=-1/0,i=1/0,t.forEach(s=>{r.push(s.scale),e=s.scale>e?s.scale:e,i=s.scale<i?s.scale:i,n[s.level]=s})),this._set("scales",r),this._set("minScale",e),this._set("maxScale",i),this._set("lods",t),this._initializeUpsampleLevels()}readSize(t,e){return[e.cols,e.rows]}writeSize(t,e){e.cols=t[0],e.rows=t[1]}zoomToScale(t){const e=this.scales;if(t<=0)return e[0];if(t>=e.length-1)return e[e.length-1];const i=Math.floor(t),r=i+1;return e[i]/(e[i]/e[r])**(t-i)}scaleToZoom(t){const e=this.scales,i=e.length-1;let r=0;for(;r<i;r++){const n=e[r],s=e[r+1];if(n<=t)return r;if(s===t)return r+1;if(n>t&&s<t)return r+Math.log(n/t)/Math.log(n/s)}return r}snapScale(t,e=.95){const i=this.scaleToZoom(t);return i%Math.floor(i)>=e?this.zoomToScale(Math.ceil(i)):this.zoomToScale(Math.floor(i))}tileAt(t,e,i,r){const n=this.lodAt(t);if(!n)return null;let s,o;if(typeof e=="number")s=e,o=i;else if(Dn(e.spatialReference,this.spatialReference))s=e.x,o=e.y,r=i;else{const c=z2(e,this.spatialReference);if(R(c))return null;s=c.x,o=c.y,r=i}const a=n.resolution*this.size[0],l=n.resolution*this.size[1];return r||(r=new kZe(null,0,0,0,Kt())),r.level=t,r.row=Math.floor((this.origin.y-o)/l+.001),r.col=Math.floor((s-this.origin.x)/a+.001),this.updateTileInfo(r),r}updateTileInfo(t,e=o1.ExtrapolateOptions.NONE){let i=this.lodAt(t.level);if(!i&&e===o1.ExtrapolateOptions.POWER_OF_TWO){const o=this.lods[this.lods.length-1];o.level<t.level&&(i=o)}if(!i)return;const r=t.level-i.level,n=i.resolution*this.size[0]/2**r,s=i.resolution*this.size[1]/2**r;t.id=`${t.level}/${t.row}/${t.col}`,t.extent||(t.extent=Kt()),t.extent[0]=this.origin.x+t.col*n,t.extent[1]=this.origin.y-(t.row+1)*s,t.extent[2]=t.extent[0]+n,t.extent[3]=t.extent[1]+s}upsampleTile(t){const e=this._upsampleLevels[t.level];return!(!e||e.parentLevel===-1)&&(t.level=e.parentLevel,t.row=Math.floor(t.row/e.factor+.001),t.col=Math.floor(t.col/e.factor+.001),this.updateTileInfo(t),!0)}getTileBounds(t,e){const i=this.lodAt(e.level);if(i==null)return null;const{resolution:r}=i,n=r*this.size[0],s=r*this.size[1];return t[0]=this.origin.x+e.col*n,t[1]=this.origin.y-(e.row+1)*s,t[2]=t[0]+n,t[3]=t[1]+s,t}lodAt(t){var e;return((e=this._levelToLOD)==null?void 0:e[t])??null}clone(){return o1.fromJSON(this.write({}))}getOrCreateCompatible(t,e){if(this.size[0]===256&&this.size[1]===256)return t===256?this:null;const i=[],r=this.lods.length;for(let n=0;n<r;n++){const s=this.lods[n],o=s.resolution*e;i.push(new rp({level:s.level,scale:s.scale,resolution:o}))}return new o1({size:[t,t],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:i})}_initializeUpsampleLevels(){const t=this.lods;this._upsampleLevels=[];let e=null;for(let i=0;i<t.length;i++){const r=t[i];this._upsampleLevels[r.level]={parentLevel:e?e.level:-1,factor:e?e.resolution/r.resolution:0},e=r}}};u([d({type:Number,json:{write:!0}})],Ko.prototype,"compressionQuality",void 0),u([d({type:Number,json:{write:!0}})],Ko.prototype,"dpi",void 0),u([d({type:String,json:{read:Fde.read,write:Fde.write,origins:{"web-scene":{read:!1,write:!1}}}})],Ko.prototype,"format",void 0),u([d({readOnly:!0})],Ko.prototype,"isWrappable",null),u([d({type:Le,json:{write:!0}})],Ko.prototype,"origin",void 0),u([Oe("origin")],Ko.prototype,"readOrigin",null),u([d({type:[rp],value:null,json:{write:!0}})],Ko.prototype,"lods",null),u([d({readOnly:!0})],Ko.prototype,"minScale",void 0),u([d({readOnly:!0})],Ko.prototype,"maxScale",void 0),u([d({readOnly:!0})],Ko.prototype,"scales",void 0),u([d({cast:t=>Array.isArray(t)?t:typeof t=="number"?[t,t]:[256,256]})],Ko.prototype,"size",void 0),u([Oe("size",["rows","cols"])],Ko.prototype,"readSize",null),u([Ne("size",{cols:{type:Kr},rows:{type:Kr}})],Ko.prototype,"writeSize",null),u([d({type:Je,json:{write:!0}})],Ko.prototype,"spatialReference",void 0),Ko=o1=u([$("esri.layers.support.TileInfo")],Ko),function(t){var e;(e=t.ExtrapolateOptions||(t.ExtrapolateOptions={}))[e.NONE=0]="NONE",e[e.POWER_OF_TWO=1]="POWER_OF_TWO"}(Ko||(Ko={}));const M$=Ko,$6={widthBreakpoint:{getValue(t){const e=t.viewSize[0],i=t.breakpoints,r=this.values;return e<=i.xsmall?r.xsmall:e<=i.small?r.small:e<=i.medium?r.medium:e<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(t){const e=t.viewSize[1],i=t.breakpoints,r=this.values;return e<=i.xsmall?r.xsmall:e<=i.small?r.small:e<=i.medium?r.medium:e<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(t){const e=t.viewSize,i=e[0],r=e[1],n=this.values;return r>=i?n.portrait:n.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},rG={xsmall:544,small:768,medium:992,large:1200};function UZe(t){const e=t;return e&&e.xsmall<e.small&&e.small<e.medium&&e.medium<e.large}function nG(t,e){return e?$6[t].valueToClassName[e].split(" "):[]}const cRe=t=>{let e=class extends t{constructor(...i){super(...i),this._breakpointsHandles=new Xi,this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=rG}initialize(){this._breakpointsHandles.add(ne(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),zt))}destroy(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=Ve(this._breakpointsHandles))}set breakpoints(i){if(i===this._get("breakpoints"))return;const r=UZe(i);if(!r){const n=JSON.stringify(rG,null,2);console.warn("provided breakpoints are not valid, using defaults:"+n)}i=r?i:rG,this._set("breakpoints",{...i})}_updateClassNames(){if(!this.container)return;const i=Vc.acquire(),r=Vc.acquire();let n,s=!1;for(n in $6){const o=this[n],a=$6[n].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(s=!0,this[n]=a,nG(n,o).forEach(l=>r.push(l)),nG(n,a).forEach(l=>i.push(l)))}s&&(this._applyClassNameChanges(i,r),Vc.release(i),Vc.release(r))}_applyClassNameChanges(i,r){const n=this.container;n&&(r.forEach(s=>n.classList.remove(s)),i.forEach(s=>n.classList.add(s)))}_removeActiveClassNames(){const i=this.container;if(!i)return;let r;for(r in $6)nG(r,this[r]).forEach(n=>i.classList.remove(n))}};return u([d()],e.prototype,"breakpoints",null),u([d()],e.prototype,"orientation",void 0),u([d()],e.prototype,"widthBreakpoint",void 0),u([d()],e.prototype,"heightBreakpoint",void 0),e=u([$("esri.views.BreakpointsOwner")],e),e};function uB(t){return typeof t=="string"?document.getElementById(t):t??null}function uRe(t){for(;t.hasChildNodes();)t.removeChild(t.firstChild)}function kde(t,e){const i=e.parentNode;i&&i.insertBefore(t,e)}function Ude(t,e){for(;;){const i=t.firstChild;if(!i)break;e.appendChild(i)}}let Jg=class extends ve{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._handles=new Xi,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll(),this._handles.destroy()}add(e,i,r={}){return this._installWatch(e,i,r,ne)}addWhen(e,i,r={}){return this._installWatch(e,i,r,yo)}addOnCollectionChange(e,i,{initial:r=!1,final:n=!1}={}){const s=++this._handleId;return this._handles.add([Kn(e,"after-changes",this._createSyncUpdatingCallback(),Ki),Kn(e,"change",i,{onListenerAdd:r?o=>i({added:o.toArray(),removed:[]}):void 0,onListenerRemove:n?o=>i({added:[],removed:o.toArray()}):void 0})],s),{remove:()=>this._handles.remove(s)}}addPromise(e){if(R(e))return e;const i=++this._handleId;this._handles.add({remove:()=>{this._pendingPromises.delete(e)&&(this._pendingPromises.size!==0||this._handles.has(YF)||this._set("updating",!1))}},i),this._pendingPromises.add(e),this._set("updating",!0);const r=()=>this._handles.remove(i);return e.then(r,r),e}removeAll(){this._pendingPromises.clear(),this._handles.removeAll(),this._set("updating",!1)}_installWatch(e,i,r={},n){const s=++this._handleId;r.sync||this._installSyncUpdatingWatch(e,s);const o=n(e,i,r);return this._handles.add(o,s),{remove:()=>this._handles.remove(s)}}_installSyncUpdatingWatch(e,i){const r=this._createSyncUpdatingCallback(),n=ne(e,r,{sync:!0,equals:()=>!1});return this._handles.add(n,i),n}_createSyncUpdatingCallback(){return()=>{this._handles.remove(YF),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this._handles.add(V2(()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this._handles.remove(YF))}),YF)}}};u([d({readOnly:!0})],Jg.prototype,"updating",void 0),Jg=u([$("esri.core.support.WatchUpdatingTracking")],Jg);const YF=-42;/*!
 * @esri/arcgis-html-sanitizer - v3.0.1 - Tue Nov 15 2022 09:46:54 GMT-0800 (Pacific Standard Time)
 * Copyright (c) 2022 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2018 Zongmin Lei() <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 */var VZe=function(t){if(typeof t!="object"||t===null||Object.prototype.toString.call(t)!=="[object Object]")return!1;var e=Object.getPrototypeOf(t);if(e===null)return!0;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},ZT={exports:{}},$s={},tD={exports:{}},W2={};function hRe(){var t={};return t["align-content"]=!1,t["align-items"]=!1,t["align-self"]=!1,t["alignment-adjust"]=!1,t["alignment-baseline"]=!1,t.all=!1,t["anchor-point"]=!1,t.animation=!1,t["animation-delay"]=!1,t["animation-direction"]=!1,t["animation-duration"]=!1,t["animation-fill-mode"]=!1,t["animation-iteration-count"]=!1,t["animation-name"]=!1,t["animation-play-state"]=!1,t["animation-timing-function"]=!1,t.azimuth=!1,t["backface-visibility"]=!1,t.background=!0,t["background-attachment"]=!0,t["background-clip"]=!0,t["background-color"]=!0,t["background-image"]=!0,t["background-origin"]=!0,t["background-position"]=!0,t["background-repeat"]=!0,t["background-size"]=!0,t["baseline-shift"]=!1,t.binding=!1,t.bleed=!1,t["bookmark-label"]=!1,t["bookmark-level"]=!1,t["bookmark-state"]=!1,t.border=!0,t["border-bottom"]=!0,t["border-bottom-color"]=!0,t["border-bottom-left-radius"]=!0,t["border-bottom-right-radius"]=!0,t["border-bottom-style"]=!0,t["border-bottom-width"]=!0,t["border-collapse"]=!0,t["border-color"]=!0,t["border-image"]=!0,t["border-image-outset"]=!0,t["border-image-repeat"]=!0,t["border-image-slice"]=!0,t["border-image-source"]=!0,t["border-image-width"]=!0,t["border-left"]=!0,t["border-left-color"]=!0,t["border-left-style"]=!0,t["border-left-width"]=!0,t["border-radius"]=!0,t["border-right"]=!0,t["border-right-color"]=!0,t["border-right-style"]=!0,t["border-right-width"]=!0,t["border-spacing"]=!0,t["border-style"]=!0,t["border-top"]=!0,t["border-top-color"]=!0,t["border-top-left-radius"]=!0,t["border-top-right-radius"]=!0,t["border-top-style"]=!0,t["border-top-width"]=!0,t["border-width"]=!0,t.bottom=!1,t["box-decoration-break"]=!0,t["box-shadow"]=!0,t["box-sizing"]=!0,t["box-snap"]=!0,t["box-suppress"]=!0,t["break-after"]=!0,t["break-before"]=!0,t["break-inside"]=!0,t["caption-side"]=!1,t.chains=!1,t.clear=!0,t.clip=!1,t["clip-path"]=!1,t["clip-rule"]=!1,t.color=!0,t["color-interpolation-filters"]=!0,t["column-count"]=!1,t["column-fill"]=!1,t["column-gap"]=!1,t["column-rule"]=!1,t["column-rule-color"]=!1,t["column-rule-style"]=!1,t["column-rule-width"]=!1,t["column-span"]=!1,t["column-width"]=!1,t.columns=!1,t.contain=!1,t.content=!1,t["counter-increment"]=!1,t["counter-reset"]=!1,t["counter-set"]=!1,t.crop=!1,t.cue=!1,t["cue-after"]=!1,t["cue-before"]=!1,t.cursor=!1,t.direction=!1,t.display=!0,t["display-inside"]=!0,t["display-list"]=!0,t["display-outside"]=!0,t["dominant-baseline"]=!1,t.elevation=!1,t["empty-cells"]=!1,t.filter=!1,t.flex=!1,t["flex-basis"]=!1,t["flex-direction"]=!1,t["flex-flow"]=!1,t["flex-grow"]=!1,t["flex-shrink"]=!1,t["flex-wrap"]=!1,t.float=!1,t["float-offset"]=!1,t["flood-color"]=!1,t["flood-opacity"]=!1,t["flow-from"]=!1,t["flow-into"]=!1,t.font=!0,t["font-family"]=!0,t["font-feature-settings"]=!0,t["font-kerning"]=!0,t["font-language-override"]=!0,t["font-size"]=!0,t["font-size-adjust"]=!0,t["font-stretch"]=!0,t["font-style"]=!0,t["font-synthesis"]=!0,t["font-variant"]=!0,t["font-variant-alternates"]=!0,t["font-variant-caps"]=!0,t["font-variant-east-asian"]=!0,t["font-variant-ligatures"]=!0,t["font-variant-numeric"]=!0,t["font-variant-position"]=!0,t["font-weight"]=!0,t.grid=!1,t["grid-area"]=!1,t["grid-auto-columns"]=!1,t["grid-auto-flow"]=!1,t["grid-auto-rows"]=!1,t["grid-column"]=!1,t["grid-column-end"]=!1,t["grid-column-start"]=!1,t["grid-row"]=!1,t["grid-row-end"]=!1,t["grid-row-start"]=!1,t["grid-template"]=!1,t["grid-template-areas"]=!1,t["grid-template-columns"]=!1,t["grid-template-rows"]=!1,t["hanging-punctuation"]=!1,t.height=!0,t.hyphens=!1,t.icon=!1,t["image-orientation"]=!1,t["image-resolution"]=!1,t["ime-mode"]=!1,t["initial-letters"]=!1,t["inline-box-align"]=!1,t["justify-content"]=!1,t["justify-items"]=!1,t["justify-self"]=!1,t.left=!1,t["letter-spacing"]=!0,t["lighting-color"]=!0,t["line-box-contain"]=!1,t["line-break"]=!1,t["line-grid"]=!1,t["line-height"]=!1,t["line-snap"]=!1,t["line-stacking"]=!1,t["line-stacking-ruby"]=!1,t["line-stacking-shift"]=!1,t["line-stacking-strategy"]=!1,t["list-style"]=!0,t["list-style-image"]=!0,t["list-style-position"]=!0,t["list-style-type"]=!0,t.margin=!0,t["margin-bottom"]=!0,t["margin-left"]=!0,t["margin-right"]=!0,t["margin-top"]=!0,t["marker-offset"]=!1,t["marker-side"]=!1,t.marks=!1,t.mask=!1,t["mask-box"]=!1,t["mask-box-outset"]=!1,t["mask-box-repeat"]=!1,t["mask-box-slice"]=!1,t["mask-box-source"]=!1,t["mask-box-width"]=!1,t["mask-clip"]=!1,t["mask-image"]=!1,t["mask-origin"]=!1,t["mask-position"]=!1,t["mask-repeat"]=!1,t["mask-size"]=!1,t["mask-source-type"]=!1,t["mask-type"]=!1,t["max-height"]=!0,t["max-lines"]=!1,t["max-width"]=!0,t["min-height"]=!0,t["min-width"]=!0,t["move-to"]=!1,t["nav-down"]=!1,t["nav-index"]=!1,t["nav-left"]=!1,t["nav-right"]=!1,t["nav-up"]=!1,t["object-fit"]=!1,t["object-position"]=!1,t.opacity=!1,t.order=!1,t.orphans=!1,t.outline=!1,t["outline-color"]=!1,t["outline-offset"]=!1,t["outline-style"]=!1,t["outline-width"]=!1,t.overflow=!1,t["overflow-wrap"]=!1,t["overflow-x"]=!1,t["overflow-y"]=!1,t.padding=!0,t["padding-bottom"]=!0,t["padding-left"]=!0,t["padding-right"]=!0,t["padding-top"]=!0,t.page=!1,t["page-break-after"]=!1,t["page-break-before"]=!1,t["page-break-inside"]=!1,t["page-policy"]=!1,t.pause=!1,t["pause-after"]=!1,t["pause-before"]=!1,t.perspective=!1,t["perspective-origin"]=!1,t.pitch=!1,t["pitch-range"]=!1,t["play-during"]=!1,t.position=!1,t["presentation-level"]=!1,t.quotes=!1,t["region-fragment"]=!1,t.resize=!1,t.rest=!1,t["rest-after"]=!1,t["rest-before"]=!1,t.richness=!1,t.right=!1,t.rotation=!1,t["rotation-point"]=!1,t["ruby-align"]=!1,t["ruby-merge"]=!1,t["ruby-position"]=!1,t["shape-image-threshold"]=!1,t["shape-outside"]=!1,t["shape-margin"]=!1,t.size=!1,t.speak=!1,t["speak-as"]=!1,t["speak-header"]=!1,t["speak-numeral"]=!1,t["speak-punctuation"]=!1,t["speech-rate"]=!1,t.stress=!1,t["string-set"]=!1,t["tab-size"]=!1,t["table-layout"]=!1,t["text-align"]=!0,t["text-align-last"]=!0,t["text-combine-upright"]=!0,t["text-decoration"]=!0,t["text-decoration-color"]=!0,t["text-decoration-line"]=!0,t["text-decoration-skip"]=!0,t["text-decoration-style"]=!0,t["text-emphasis"]=!0,t["text-emphasis-color"]=!0,t["text-emphasis-position"]=!0,t["text-emphasis-style"]=!0,t["text-height"]=!0,t["text-indent"]=!0,t["text-justify"]=!0,t["text-orientation"]=!0,t["text-overflow"]=!0,t["text-shadow"]=!0,t["text-space-collapse"]=!0,t["text-transform"]=!0,t["text-underline-position"]=!0,t["text-wrap"]=!0,t.top=!1,t.transform=!1,t["transform-origin"]=!1,t["transform-style"]=!1,t.transition=!1,t["transition-delay"]=!1,t["transition-duration"]=!1,t["transition-property"]=!1,t["transition-timing-function"]=!1,t["unicode-bidi"]=!1,t["vertical-align"]=!1,t.visibility=!1,t["voice-balance"]=!1,t["voice-duration"]=!1,t["voice-family"]=!1,t["voice-pitch"]=!1,t["voice-range"]=!1,t["voice-rate"]=!1,t["voice-stress"]=!1,t["voice-volume"]=!1,t.volume=!1,t["white-space"]=!1,t.widows=!1,t.width=!0,t["will-change"]=!1,t["word-break"]=!0,t["word-spacing"]=!0,t["word-wrap"]=!0,t["wrap-flow"]=!1,t["wrap-through"]=!1,t["writing-mode"]=!1,t["z-index"]=!1,t}function zZe(t,e,i){}function BZe(t,e,i){}var jZe=/javascript\s*\:/img;function GZe(t,e){return jZe.test(e)?"":e}W2.whiteList=hRe();W2.getDefaultWhiteList=hRe;W2.onAttr=zZe;W2.onIgnoreAttr=BZe;W2.safeAttrValue=GZe;var HZe={indexOf:function(t,e){var i,r;if(Array.prototype.indexOf)return t.indexOf(e);for(i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1},forEach:function(t,e,i){var r,n;if(Array.prototype.forEach)return t.forEach(e,i);for(r=0,n=t.length;r<n;r++)e.call(i,t[r],r,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(t){return String.prototype.trimRight?t.trimRight():t.replace(/(\s*$)/g,"")}},g3=HZe;function qZe(t,e){t=g3.trimRight(t),t[t.length-1]!==";"&&(t+=";");var i=t.length,r=!1,n=0,s=0,o="";function a(){if(!r){var h=g3.trim(t.slice(n,s)),p=h.indexOf(":");if(p!==-1){var f=g3.trim(h.slice(0,p)),m=g3.trim(h.slice(p+1));if(f){var g=e(n,o.length,f,m,h);g&&(o+=g+"; ")}}}n=s+1}for(;s<i;s++){var l=t[s];if(l==="/"&&t[s+1]==="*"){var c=t.indexOf("*/",s+2);if(c===-1)break;s=c+1,n=s+1,r=!1}else l==="("?r=!0:l===")"?r=!1:l===";"?r||a():l===`
`&&a()}return g3.trim(o)}var WZe=qZe,ZF=W2,XZe=WZe;function Vde(t){return t==null}function YZe(t){var e={};for(var i in t)e[i]=t[i];return e}function dRe(t){t=YZe(t||{}),t.whiteList=t.whiteList||ZF.whiteList,t.onAttr=t.onAttr||ZF.onAttr,t.onIgnoreAttr=t.onIgnoreAttr||ZF.onIgnoreAttr,t.safeAttrValue=t.safeAttrValue||ZF.safeAttrValue,this.options=t}dRe.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,i=e.options,r=i.whiteList,n=i.onAttr,s=i.onIgnoreAttr,o=i.safeAttrValue,a=XZe(t,function(l,c,h,p,f){var m=r[h],g=!1;if(m===!0?g=m:typeof m=="function"?g=m(p):m instanceof RegExp&&(g=m.test(p)),g!==!0&&(g=!1),p=o(h,p),!!p){var _={position:c,sourcePosition:l,source:f,isWhite:g};if(g){var b=n(h,p,_);return Vde(b)?h+":"+p:b}else{var b=s(h,p,_);if(!Vde(b))return b}}});return a};var ZZe=dRe;(function(t,e){var i=W2,r=ZZe;function n(o,a){var l=new r(a);return l.process(o)}e=t.exports=n,e.FilterCSS=r;for(var s in i)e[s]=i[s]})(tD,tD.exports);var vse={indexOf:function(t,e){var i,r;if(Array.prototype.indexOf)return t.indexOf(e);for(i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1},forEach:function(t,e,i){var r,n;if(Array.prototype.forEach)return t.forEach(e,i);for(r=0,n=t.length;r<n;r++)e.call(i,t[r],r,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(t){var e=/\s|\n|\t/,i=e.exec(t);return i?i.index:-1}},JZe=tD.exports.FilterCSS,KZe=tD.exports.getDefaultWhiteList,_V=vse;function pRe(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var fRe=new JZe;function QZe(t,e,i){}function eJe(t,e,i){}function tJe(t,e,i){}function iJe(t,e,i){}function mRe(t){return t.replace(nJe,"&lt;").replace(sJe,"&gt;")}function rJe(t,e,i,r){if(i=wRe(i),e==="href"||e==="src"){if(i=_V.trim(i),i==="#")return"#";if(!(i.substr(0,7)==="http://"||i.substr(0,8)==="https://"||i.substr(0,7)==="mailto:"||i.substr(0,4)==="tel:"||i.substr(0,11)==="data:image/"||i.substr(0,6)==="ftp://"||i.substr(0,2)==="./"||i.substr(0,3)==="../"||i[0]==="#"||i[0]==="/"))return""}else if(e==="background"){if(JF.lastIndex=0,JF.test(i))return""}else if(e==="style"){if(zde.lastIndex=0,zde.test(i)||(Bde.lastIndex=0,Bde.test(i)&&(JF.lastIndex=0,JF.test(i))))return"";r!==!1&&(r=r||fRe,i=r.process(i))}return i=xRe(i),i}var nJe=/</g,sJe=/>/g,oJe=/"/g,aJe=/&quot;/g,lJe=/&#([a-zA-Z0-9]*);?/gim,cJe=/&colon;?/gim,uJe=/&newline;?/gim,JF=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,zde=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,Bde=/u\s*r\s*l\s*\(.*/gi;function gRe(t){return t.replace(oJe,"&quot;")}function yRe(t){return t.replace(aJe,'"')}function _Re(t){return t.replace(lJe,function(i,r){return r[0]==="x"||r[0]==="X"?String.fromCharCode(parseInt(r.substr(1),16)):String.fromCharCode(parseInt(r,10))})}function vRe(t){return t.replace(cJe,":").replace(uJe," ")}function bRe(t){for(var e="",i=0,r=t.length;i<r;i++)e+=t.charCodeAt(i)<32?" ":t.charAt(i);return _V.trim(e)}function wRe(t){return t=yRe(t),t=_Re(t),t=vRe(t),t=bRe(t),t}function xRe(t){return t=gRe(t),t=mRe(t),t}function hJe(){return""}function dJe(t,e){typeof e!="function"&&(e=function(){});var i=!Array.isArray(t);function r(o){return i?!0:_V.indexOf(t,o)!==-1}var n=[],s=!1;return{onIgnoreTag:function(o,a,l){if(r(o))if(l.isClosing){var c="[/removed]",h=l.position+c.length;return n.push([s!==!1?s:l.position,h]),s=!1,c}else return s||(s=l.position),"[removed]";else return e(o,a,l)},remove:function(o){var a="",l=0;return _V.forEach(n,function(c){a+=o.slice(l,c[0]),l=c[1]}),a+=o.slice(l),a}}}function pJe(t){for(var e="",i=0;i<t.length;){var r=t.indexOf("<!--",i);if(r===-1){e+=t.slice(i);break}e+=t.slice(i,r);var n=t.indexOf("-->",r);if(n===-1)break;i=n+3}return e}function fJe(t){var e=t.split("");return e=e.filter(function(i){var r=i.charCodeAt(0);return r===127?!1:r<=31?r===10||r===13:!0}),e.join("")}$s.whiteList=pRe();$s.getDefaultWhiteList=pRe;$s.onTag=QZe;$s.onIgnoreTag=eJe;$s.onTagAttr=tJe;$s.onIgnoreTagAttr=iJe;$s.safeAttrValue=rJe;$s.escapeHtml=mRe;$s.escapeQuote=gRe;$s.unescapeQuote=yRe;$s.escapeHtmlEntities=_Re;$s.escapeDangerHtml5Entities=vRe;$s.clearNonPrintableCharacter=bRe;$s.friendlyAttrValue=wRe;$s.escapeAttrValue=xRe;$s.onIgnoreTagStripAll=hJe;$s.StripTagBody=dJe;$s.stripCommentTag=pJe;$s.stripBlankChar=fJe;$s.cssFilter=fRe;$s.getDefaultCSSWhiteList=KZe;var hB={},k1=vse;function mJe(t){var e=k1.spaceIndex(t),i;return e===-1?i=t.slice(1,-1):i=t.slice(1,e+1),i=k1.trim(i).toLowerCase(),i.slice(0,1)==="/"&&(i=i.slice(1)),i.slice(-1)==="/"&&(i=i.slice(0,-1)),i}function gJe(t){return t.slice(0,2)==="</"}function yJe(t,e,i){var r="",n=0,s=!1,o=!1,a=0,l=t.length,c="",h="";e:for(a=0;a<l;a++){var p=t.charAt(a);if(s===!1){if(p==="<"){s=a;continue}}else if(o===!1){if(p==="<"){r+=i(t.slice(n,a)),s=a,n=a;continue}if(p===">"){r+=i(t.slice(n,s)),h=t.slice(s,a+1),c=mJe(h),r+=e(s,r.length,c,h,gJe(h)),n=a+1,s=!1;continue}if(p==='"'||p==="'")for(var f=1,m=t.charAt(a-f);m.trim()===""||m==="=";){if(m==="="){o=p;continue e}m=t.charAt(a-++f)}}else if(p===o){o=!1;continue}}return n<t.length&&(r+=i(t.substr(n))),r}var _Je=/[^a-zA-Z0-9\\_:.-]/gim;function vJe(t,e){var i=0,r=0,n=[],s=!1,o=t.length;function a(f,m){if(f=k1.trim(f),f=f.replace(_Je,"").toLowerCase(),!(f.length<1)){var g=e(f,m||"");g&&n.push(g)}}for(var l=0;l<o;l++){var c=t.charAt(l),h,p;if(s===!1&&c==="="){s=t.slice(i,l),i=l+1,r=t.charAt(i)==='"'||t.charAt(i)==="'"?i:wJe(t,l+1);continue}if(s!==!1&&l===r){if(p=t.indexOf(c,l+1),p===-1)break;h=k1.trim(t.slice(r+1,p)),a(s,h),s=!1,l=p,i=l+1;continue}if(/\s|\n|\t/.test(c))if(t=t.replace(/\s|\n|\t/g," "),s===!1)if(p=bJe(t,l),p===-1){h=k1.trim(t.slice(i,l)),a(h),s=!1,i=l+1;continue}else{l=p-1;continue}else if(p=xJe(t,l-1),p===-1){h=k1.trim(t.slice(i,l)),h=jde(h),a(s,h),s=!1,i=l+1;continue}else continue}return i<t.length&&(s===!1?a(t.slice(i)):a(s,jde(k1.trim(t.slice(i))))),k1.trim(n.join(" "))}function bJe(t,e){for(;e<t.length;e++){var i=t[e];if(i!==" ")return i==="="?e:-1}}function wJe(t,e){for(;e<t.length;e++){var i=t[e];if(i!==" ")return i==="'"||i==='"'?e:-1}}function xJe(t,e){for(;e>0;e--){var i=t[e];if(i!==" ")return i==="="?e:-1}}function TJe(t){return t[0]==='"'&&t[t.length-1]==='"'||t[0]==="'"&&t[t.length-1]==="'"}function jde(t){return TJe(t)?t.substr(1,t.length-2):t}hB.parseTag=yJe;hB.parseAttr=vJe;var SJe=tD.exports.FilterCSS,Nf=$s,TRe=hB,EJe=TRe.parseTag,CJe=TRe.parseAttr,L6=vse;function KF(t){return t==null}function AJe(t){var e=L6.spaceIndex(t);if(e===-1)return{html:"",closing:t[t.length-2]==="/"};t=L6.trim(t.slice(e+1,-1));var i=t[t.length-1]==="/";return i&&(t=L6.trim(t.slice(0,-1))),{html:t,closing:i}}function RJe(t){var e={};for(var i in t)e[i]=t[i];return e}function MJe(t){var e={};for(var i in t)Array.isArray(t[i])?e[i.toLowerCase()]=t[i].map(function(r){return r.toLowerCase()}):e[i.toLowerCase()]=t[i];return e}function SRe(t){t=RJe(t||{}),t.stripIgnoreTag&&(t.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),t.onIgnoreTag=Nf.onIgnoreTagStripAll),t.whiteList||t.allowList?t.whiteList=MJe(t.whiteList||t.allowList):t.whiteList=Nf.whiteList,t.onTag=t.onTag||Nf.onTag,t.onTagAttr=t.onTagAttr||Nf.onTagAttr,t.onIgnoreTag=t.onIgnoreTag||Nf.onIgnoreTag,t.onIgnoreTagAttr=t.onIgnoreTagAttr||Nf.onIgnoreTagAttr,t.safeAttrValue=t.safeAttrValue||Nf.safeAttrValue,t.escapeHtml=t.escapeHtml||Nf.escapeHtml,this.options=t,t.css===!1?this.cssFilter=!1:(t.css=t.css||{},this.cssFilter=new SJe(t.css))}SRe.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,i=e.options,r=i.whiteList,n=i.onTag,s=i.onIgnoreTag,o=i.onTagAttr,a=i.onIgnoreTagAttr,l=i.safeAttrValue,c=i.escapeHtml,h=e.cssFilter;i.stripBlankChar&&(t=Nf.stripBlankChar(t)),i.allowCommentTag||(t=Nf.stripCommentTag(t));var p=!1;i.stripIgnoreTagBody&&(p=Nf.StripTagBody(i.stripIgnoreTagBody,s),s=p.onIgnoreTag);var f=EJe(t,function(m,g,_,b,w){var x={sourcePosition:m,position:g,isClosing:w,isWhite:Object.prototype.hasOwnProperty.call(r,_)},T=n(_,b,x);if(!KF(T))return T;if(x.isWhite){if(x.isClosing)return"</"+_+">";var E=AJe(b),C=r[_],A=CJe(E.html,function(I,O){var D=L6.indexOf(C,I)!==-1,U=o(_,I,O,D);return KF(U)?D?(O=l(_,I,O,h),O?I+'="'+O+'"':I):(U=a(_,I,O,D),KF(U)?void 0:U):U});return b="<"+_,A&&(b+=" "+A),E.closing&&(b+=" /"),b+=">",b}else return T=s(_,b,x),KF(T)?c(b):T},c);return p&&(f=p.remove(f)),f};var OJe=SRe;(function(t,e){var i=$s,r=hB,n=OJe;function s(a,l){var c=new n(l);return c.process(a)}e=t.exports=s,e.filterXSS=s,e.FilterXSS=n,function(){for(var a in i)e[a]=i[a];for(var l in r)e[l]=r[l]}();function o(){return typeof self<"u"&&typeof DedicatedWorkerGlobalScope<"u"&&self instanceof DedicatedWorkerGlobalScope}o()&&(self.filterXSS=t.exports)})(ZT,ZT.exports);var PJe=function(){function t(e,i){var r=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(s,o,a,l){return s==="a"&&o==="href"||(s==="img"||s==="source")&&o==="src"?r.sanitizeUrl(a):ZT.exports.safeAttrValue(s,o,a,l)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"};var n;e&&!i?n=e:e&&i?(n=Object.create(this.arcgisFilterOptions),Object.keys(e).forEach(function(s){s==="whiteList"?n.whiteList=r._extendObjectOfArrays([r.arcgisWhiteList,e.whiteList||{}]):n[s]=e[s]})):(n=Object.create(this.arcgisFilterOptions),n.whiteList=this.arcgisWhiteList),this.xssFilterOptions=n,this._xssFilter=new ZT.exports.FilterXSS(n)}return t.prototype.sanitize=function(e,i){switch(i===void 0&&(i={}),typeof e){case"number":return isNaN(e)||!isFinite(e)?null:e;case"boolean":return e;case"string":return this._xssFilter.process(e);case"object":return this._iterateOverObject(e,i);default:return i.allowUndefined&&typeof e>"u"?void 0:null}},t.prototype.sanitizeUrl=function(e,i){var r=(i??{}).isProtocolRequired,n=r===void 0?!0:r,s=this._trim(e.substring(0,e.indexOf(":"))),o=e==="/",a=/^#/.test(e),l=s&&this.allowedProtocols.indexOf(s.toLowerCase())>-1;return o||a||l?ZT.exports.escapeAttrValue(e):!s&&!n?ZT.exports.escapeAttrValue("https://".concat(e)):""},t.prototype.sanitizeHTMLAttribute=function(e,i,r,n){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(e,i,r,n):ZT.exports.safeAttrValue(e,i,r,n)},t.prototype.validate=function(e,i){i===void 0&&(i={});var r=this.sanitize(e,i);return{isValid:e===r,sanitized:r}},t.prototype.encodeHTML=function(e){var i=this;return String(e).replace(/[&<>"'\/]/g,function(r){return i._entityMap[r]})},t.prototype.encodeAttrValue=function(e){var i=/^[a-zA-Z0-9]$/;return String(e).replace(/[\x00-\xFF]/g,function(r,n){return i.test(r)?r:"&#x".concat(Number(e.charCodeAt(n)).toString(16),";")})},t.prototype._extendObjectOfArrays=function(e){var i={};return e.forEach(function(r){Object.keys(r).forEach(function(n){Array.isArray(r[n])&&Array.isArray(i[n])?i[n]=i[n].concat(r[n]):i[n]=r[n]})}),i},t.prototype._iterateOverObject=function(e,i){var r=this;i===void 0&&(i={});try{var n=!1,s=void 0;if(Array.isArray(e))s=e.reduce(function(a,l){var c=r.validate(l,i);return c.isValid?a.concat([l]):(n=!0,a.concat([c.sanitized]))},[]);else if(VZe(e)){var o=Object.keys(e);s=o.reduce(function(a,l){var c=e[l],h=r.validate(c,i);return h.isValid?a[l]=c:(n=!0,a[l]=h.sanitized),a},{})}else return i.allowUndefined&&typeof e>"u"?void 0:null;return n?s:e}catch{return null}},t.prototype._trim=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},t}();const dB=new Map;function ERe(){dB.clear()}function IJe(t){return dB.get(t)}function $Je(t,e){dB.set(t,e)}function sG(t){dB.delete(t)}var p2,OM,LJe=function(t){if("WebkitTransition"in t.style)p2="webkitTransitionEnd",OM="webkitAnimationEnd";else{if(!("transition"in t.style))throw new Error("Your browser is not supported!");p2="transitionend",OM="animationend"}},CRe=function(t){p2||LJe(t)},DJe=function(t,e){return e===void 0&&(e=t+"-active"),function(i){CRe(i);var r=!1,n=function(s){r||(r=!0,i.removeEventListener(p2,n),i.removeEventListener(OM,n),i.classList.remove(t),i.classList.remove(e))};i.classList.add(t),i.addEventListener(p2,n),i.addEventListener(OM,n),requestAnimationFrame(function(){i.classList.add(e)})}},NJe=function(t,e){return e===void 0&&(e=t+"-active"),function(i,r){CRe(i);var n=!1,s=function(o){n||(n=!0,i.removeEventListener(p2,s),i.removeEventListener(OM,s),r())};i.classList.add(t),i.addEventListener(p2,s),i.addEventListener(OM,s),requestAnimationFrame(function(){i.classList.add(e)})}};const FJe=re.getLogger("esri.widgets.support.widgetUtils");function ARe(t){const e=Vc.acquire();for(let r=0;r<arguments.length;r++){const n=arguments[r],s=typeof n;if(s==="string")e.push(n);else if(Array.isArray(n))e.push.apply(e,n);else if(s==="object")for(const o in n)n[o]&&e.push(o)}const i=e.join(" ");return Vc.release(e),i}const kJe=(()=>{const t=new Map,e=new ResizeObserver(i=>{var r;ERe();for(const n of i)(r=t.get(n.target))==null||r(n)});return(i,r,n)=>(t.has(i)&&FJe.error("Already observing element",i),t.set(i,r),e.observe(i,n),fm(()=>{e.unobserve(i),t.delete(i)}))})();function Bg(t){const e=t==null?void 0:t.closest("[dir]");return e!==null&&e instanceof HTMLElement&&e.dir==="rtl"||document.dir==="rtl"}function Gde(t){const e="data-node-ref";this[t.getAttribute(e)]=null}function vV(t){const e="data-node-ref";this[t.getAttribute(e)]=t}function UJe(t,e){return(t==="enter"?DJe:NJe)(e)}const VJe=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],zJe=VJe.reduce((t,e)=>(t[e]=[],t),{}),BJe=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],RRe=new PJe({whiteList:zJe,onTagAttr:(t,e,i)=>{const r=`${e}="${i}"`;if(BJe.includes(e))return r},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function jJe(t){return t==="Enter"||t===" "}const MRe="http://www.w3.org/",pB=`${MRe}2000/svg`,ORe=`${MRe}1999/xlink`;let Hde=[],bse=(t,e)=>{let i={};return Object.keys(t).forEach(r=>{i[r]=t[r]}),e&&Object.keys(e).forEach(r=>{i[r]=e[r]}),i},wse=(t,e)=>t.vnodeSelector===e.vnodeSelector&&(t.properties&&e.properties?t.properties.key===e.properties.key&&t.properties.bind===e.properties.bind:!t.properties&&!e.properties),PRe=t=>{if(typeof t!="string")throw new Error("Style values must be strings")},GJe=(t,e,i)=>{if(e.vnodeSelector!==""){for(let r=i;r<t.length;r++)if(wse(t[r],e))return r}return-1},oG=(t,e,i,r)=>{let n=t[e];if(n.vnodeSelector==="")return;let s=n.properties;if(!(s&&(s.key===void 0?s.bind:s.key))){for(let o=0;o<t.length;o++)if(o!==e){let a=t[o];if(wse(a,n))throw new Error(`${i.vnodeSelector} had a ${n.vnodeSelector} child ${r==="added"?r:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},HJe=t=>{if(t.properties){let e=t.properties.enterAnimation;e&&e(t.domNode,t.properties)}},mJ=[],gJ=!1,IRe=t=>{(t.children||[]).forEach(IRe),t.properties&&t.properties.afterRemoved&&t.properties.afterRemoved.apply(t.properties.bind||t.properties,[t.domNode])},qde=()=>{gJ=!1,mJ.forEach(IRe),mJ.length=0},Wde=t=>{mJ.push(t),gJ||(gJ=!0,typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(qde,{timeout:16}):setTimeout(qde,16))},Xde=t=>{let e=t.domNode;if(t.properties){let i=t.properties.exitAnimation;if(i)return e.style.pointerEvents="none",void i(e,()=>{e.parentNode&&(e.parentNode.removeChild(e),Wde(t))},t.properties)}e.parentNode&&(e.parentNode.removeChild(e),Wde(t))},qJe=(t,e,i)=>{if(!e)return;let r=i.eventHandlerInterceptor,n=Object.keys(e),s=n.length;for(let o=0;o<s;o++){let a=n[o],l=e[a];if(a==="className")throw new Error('Property "className" is not supported, use "class".');if(a==="class")yJ(t,l,!0);else if(a==="classes"){let c=Object.keys(l),h=c.length;for(let p=0;p<h;p++){let f=c[p];l[f]&&t.classList.add(f)}}else if(a==="styles"){let c=Object.keys(l),h=c.length;for(let p=0;p<h;p++){let f=c[p],m=l[f];m&&(PRe(m),i.styleApplyer(t,f,m))}}else if(a!=="key"&&l!=null){let c=typeof l;c==="function"?(a.lastIndexOf("on",0)===0&&(r&&(l=r(a,l,t,e)),a==="oninput"&&function(){let h=l;l=function(p){h.apply(this,[p]),p.target["oninput-value"]=p.target.value}}()),t[a]=l):i.namespace===pB?a==="href"?t.setAttributeNS(ORe,a,l):t.setAttribute(a,l):c==="string"&&a!=="value"?a==="innerHTML"?t[a]=RRe.sanitize(l):$Re(t)&&a in t?t[a]=l:t.setAttribute(a,l):t[a]=l}}};function $Re(t){if(!(t instanceof Element&&t.tagName.includes("-")))return!1;const e=window.customElements.get(t.tagName.toLowerCase());return!!e&&t instanceof e}let bV,WJe=(t,e,i)=>{if(e)for(let r of e)eR(r,t,void 0,i)},LRe=(t,e,i)=>{WJe(t,e.children,i),e.text&&(t.textContent=e.text),qJe(t,e.properties,i),e.properties&&e.properties.afterCreate&&e.properties.afterCreate.apply(e.properties.bind||e.properties,[t,i,e.vnodeSelector,e.properties,e.children])},eR=(t,e,i,r)=>{let n,s=0,o=t.vnodeSelector,a=e.ownerDocument;if(o==="")n=t.domNode=a.createTextNode(t.text),i!==void 0?e.insertBefore(n,i):e.appendChild(n);else{for(let l=0;l<=o.length;++l){let c=o.charAt(l);if(l===o.length||c==="."||c==="#"){let h=o.charAt(s-1),p=o.slice(s,l);h==="."?n.classList.add(p):h==="#"?n.id=p:(p==="svg"&&(r=bse(r,{namespace:pB})),r.namespace!==void 0?n=t.domNode=a.createElementNS(r.namespace,p):(n=t.domNode=t.domNode||a.createElement(p),p==="input"&&t.properties&&t.properties.type!==void 0&&n.setAttribute("type",t.properties.type)),i!==void 0?e.insertBefore(n,i):n.parentNode!==e&&e.appendChild(n)),s=l+1}}LRe(n,t,r)}},yJ=(t,e,i)=>{e&&e.split(" ").forEach(r=>{r&&t.classList.toggle(r,i)})},XJe=(t,e,i,r)=>{if(!i)return;let n=!1,s=Object.keys(i),o=s.length;for(let a=0;a<o;a++){let l=s[a],c=i[l],h=e[l];if(l==="class")h!==c&&(yJ(t,h,!1),yJ(t,c,!0));else if(l==="classes"){let p=t.classList,f=Object.keys(c),m=f.length;for(let g=0;g<m;g++){let _=f[g],b=!!c[_];b!==!!h[_]&&(n=!0,b?p.add(_):p.remove(_))}}else if(l==="styles"){let p=Object.keys(c),f=p.length;for(let m=0;m<f;m++){let g=p[m],_=c[g];_!==h[g]&&(n=!0,_?(PRe(_),r.styleApplyer(t,g,_)):r.styleApplyer(t,g,""))}}else if(c||typeof h!="string"||(c=""),l==="value"){let p=t[l];p!==c&&(t["oninput-value"]?p===t["oninput-value"]:c!==h)&&(t[l]=c,t["oninput-value"]=void 0),c!==h&&(n=!0)}else if(c!==h){let p=typeof c;p==="function"&&r.eventHandlerInterceptor||(r.namespace===pB?l==="href"?t.setAttributeNS(ORe,l,c):t.setAttribute(l,c):p==="string"?l==="innerHTML"?t[l]=RRe.sanitize(c):l==="role"&&c===""?t.removeAttribute(l):$Re(t)&&l in t?t[l]=c:t.setAttribute(l,c):t[l]!==c&&(t[l]=c),n=!0)}}return n},YJe=(t,e,i,r,n)=>{if(i===r)return!1;r=r||Hde;let s,o=(i=i||Hde).length,a=r.length,l=0,c=0,h=!1;for(;c<a;){let p=l<o?i[l]:void 0,f=r[c];if(p!==void 0&&wse(p,f))h=bV(p,f,n)||h,l++;else{let m=GJe(i,f,l+1);if(m>=0){for(s=l;s<m;s++)Xde(i[s]),oG(i,s,t,"removed");h=bV(i[m],f,n)||h,l=m+1}else eR(f,e,l<o?i[l].domNode:void 0,n),HJe(f),oG(r,c,t,"added")}c++}if(o>l)for(s=l;s<o;s++)Xde(i[s]),oG(i,s,t,"removed");return h};bV=(t,e,i)=>{let r=t.domNode,n=!1;if(t===e)return!1;let s=!1;if(e.vnodeSelector===""){if(e.text!==t.text){let o=r.ownerDocument.createTextNode(e.text);return r.parentNode.replaceChild(o,r),e.domNode=o,n=!0,n}e.domNode=r}else e.vnodeSelector.lastIndexOf("svg",0)===0&&(i=bse(i,{namespace:pB})),t.text!==e.text&&(s=!0,e.text===void 0?r.removeChild(r.firstChild):r.textContent=e.text),e.domNode=r,s=YJe(e,r,t.children,e.children,i)||s,s=XJe(r,t.properties,e.properties,i)||s,e.properties&&e.properties.afterUpdate&&e.properties.afterUpdate.apply(e.properties.bind||e.properties,[r,i,e.vnodeSelector,e.properties,e.children]);return s&&e.properties&&e.properties.updateAnimation&&e.properties.updateAnimation(r,e.properties,t.properties),n};let y3=(t,e)=>({getLastRender:()=>t,update:i=>{if(t.vnodeSelector!==i.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let r=t;t=i,bV(r,i,e)},domNode:t.domNode});const ZJe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,i)=>{e.charAt(0)==="-"?t.style.setProperty(e,i):t.style[e]=i}};let OC=t=>bse(ZJe,t),vb={create:(t,e)=>(e=OC(e),eR(t,document.createElement("div"),void 0,e),y3(t,e)),append:(t,e,i)=>(i=OC(i),eR(e,t,void 0,i),y3(e,i)),insertBefore:(t,e,i)=>(i=OC(i),eR(e,t.parentNode,t,i),y3(e,i)),merge:(t,e,i)=>(i=OC(i),e.domNode=t,LRe(t,e,i),y3(e,i)),replace:(t,e,i)=>(i=OC(i),eR(e,t.parentNode,t,i),t.parentNode.removeChild(t),y3(e,i))},DRe,JJe=(t,e)=>{let i=[];for(;t&&t!==e;)i.push(t),t=t.parentNode;return i};DRe=Array.prototype.find?(t,e)=>t.find(e):(t,e)=>t.filter(e)[0];let KJe=(t,e)=>{let i=t;return e.forEach(r=>{i=i&&i.children?DRe(i.children,n=>n.domNode===r):void 0}),i},QJe=(t,e,i)=>{let r=function(n){i("domEvent",n);let s=e(),o=JJe(n.currentTarget,s.domNode);o.reverse();let a,l=KJe(s.getLastRender(),o);return t.scheduleRender(),l&&(a=l.properties[`on${n.type}`].apply(l.properties.bind||this,arguments)),i("domEventProcessed",n),a};return(n,s,o,a)=>r},_J=t=>{let e,i,r=OC(t),n=r.performanceLogger,s=!0,o=!1,a=[],l=[],c=(p,f,m)=>{let g,_=()=>g;r.eventHandlerInterceptor=QJe(e,_,n),g=p(f,m(),r),a.push(g),l.push(m)},h=()=>{if(i=void 0,s){s=!1,n("renderStart",void 0);for(let p=0;p<a.length;p++){let f=l[p]();n("rendered",void 0),a[p].update(f),n("patched",void 0)}n("renderDone",void 0),s=!0}};return e={renderNow:h,scheduleRender:()=>{i||o||(i=requestAnimationFrame(h))},stop:()=>{i&&(cancelAnimationFrame(i),i=void 0),o=!0},resume:()=>{o=!1,s=!0,e.scheduleRender()},append:(p,f)=>{c(vb.append,p,f)},insertBefore:(p,f)=>{c(vb.insertBefore,p,f)},merge:(p,f)=>{c(vb.merge,p,f)},replace:(p,f)=>{c(vb.replace,p,f)},detach:p=>{for(let f=0;f<l.length;f++)if(l[f]===p)return l.splice(f,1),a.splice(f,1)[0];throw new Error("renderFunction was not found")}},e},a1=class extends ve{constructor(){super(...arguments),this.items=new tt,this._watchUpdatingTracking=new Jg,this._callbacks=new Map,this._projector=_J(),this._hiddenProjector=_J()}get needsRender(){return this.items.length>0}get updating(){var e;return((e=this._watchUpdatingTracking)==null?void 0:e.updating)??!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,i=>{for(const r of i.added){const n=()=>r.render();this._callbacks.set(r,n),this._projector.append(this.surface,n)}for(const r of i.removed){const n=this._projector.detach(this._callbacks.get(r));this.surface.removeChild(n.domNode),this._callbacks.delete(r)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const i=this._hiddenSurface,r=this._hiddenProjector;let n;const s=()=>(n=e.render(),n);r.append(i,s),r.renderNow();const o={left:0,top:0,right:0,bottom:0};if(n&&n.domNode){const a=n.domNode.getBoundingClientRect();o.left=a.left,o.top=a.top,o.right=a.right,o.bottom=a.bottom}for(r.detach(s);i.firstChild;)i.removeChild(i.firstChild);return o}overlaps(e,i){const r=this.computeBoundingRect(e),n=this.computeBoundingRect(i);return Math.max(r.left,n.left)<=Math.min(r.right,n.right)&&Math.max(r.top,n.top)<=Math.min(r.bottom,n.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e){if(!this.items.some(r=>r.visible))return;const i=e.getContext("2d");i.save(),i.font=this._fontString(),this.items.forEach(r=>{i.save(),r.renderCanvas(i),i.restore()}),i.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};u([d({readOnly:!0})],a1.prototype,"surface",void 0),u([d({readOnly:!0})],a1.prototype,"items",void 0),u([d({readOnly:!0})],a1.prototype,"needsRender",null),u([d({readOnly:!0})],a1.prototype,"_watchUpdatingTracking",void 0),u([d({readOnly:!0})],a1.prototype,"updating",null),a1=u([$("esri.views.overlay.ViewOverlay")],a1);const Yde=a1;function PR(t,e,i,r){let n=null,s=1e3;typeof e=="number"?(s=e,r=i):(n=e??null,s=i);let o,a=0;const l=()=>{a=0,t.apply(r,o)},c=(...h)=>{n&&n.apply(r,h),o=h,s?a||(a=setTimeout(l,s)):l()};return c.remove=()=>{a&&(clearTimeout(a),a=0)},c.forceUpdate=()=>{a&&(clearTimeout(a),l())},c.hasPendingUpdates=()=>!!a,c}const eKe="randomUUID"in crypto;function NRe(){if(eKe)return crypto.randomUUID();const t=crypto.getRandomValues(new Uint16Array(8));t[3]=4095&t[3]|16384,t[4]=16383&t[4]|32768;const e=i=>t[i].toString(16).padStart(4,"0");return e(0)+e(1)+"-"+e(2)+"-"+e(3)+"-"+e(4)+"-"+e(5)+e(6)+e(7)}const tKe={handleInterceptedEvent:(t,e,i,r)=>(t.scheduleRender(),e.properties[`on${r.type}`].apply(e.properties.bind||i,[r]))},iKe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,i)=>{t.style[e]=i}},rKe=t=>({...iKe,...t}),nKe=(t,e)=>{const i=[];for(;t&&t!==e;)i.push(t),t=t.parentNode;return i},sKe=(t,e)=>t.find(e),Zde=(t,e,i=!1)=>{let r=t;return e.forEach((n,s)=>{const o=r!=null&&r.children?sKe(r.children,a=>a.domNode===n):void 0;i&&!o&&s!==e.length-1||(r=o)}),r},oKe=t=>{let e;const i={...tKe,...t},r=rKe(i),n=r.performanceLogger;let s,o=!0,a=!1;const l=[],c=[],h=(f,m,g)=>{var w;let _;r.eventHandlerInterceptor=(x,T,E,C)=>function(A){let I;n("domEvent",A);const O=nKe(A.currentTarget,_.domNode),D=O.some(V=>{var B;return customElements.get((B=V==null?void 0:V.tagName)==null?void 0:B.toLowerCase())});if(A.eventPhase===Event.CAPTURING_PHASE||!D)O.reverse(),I=Zde(_.getLastRender(),O);else{const V=A.composedPath(),B=V.slice(V.indexOf(A.currentTarget),V.indexOf(_.domNode)).filter(ee=>ee.getRootNode()===ee.ownerDocument).reverse();I=Zde(_.getLastRender(),B,!0)}let U;return I&&(U=i.handleInterceptedEvent(e,I,this,A)),n("domEventProcessed",A),U},(w=i.postProcessProjectionOptions)==null||w.call(i,r);const b=g();_=f(m,b,r),l.push(_),c.push(g),i.afterFirstVNodeRendered&&i.afterFirstVNodeRendered(_,b)};let p=()=>{if(s=void 0,o){o=!1,n("renderStart",void 0);for(let f=0;f<l.length;f++){const m=c[f]();n("rendered",void 0),l[f].update(m),n("patched",void 0)}n("renderDone",void 0),o=!0}};return i.modifyDoRenderImplementation&&(p=i.modifyDoRenderImplementation(p,l,c)),e={renderNow:p,scheduleRender:()=>{s||a||(s=requestAnimationFrame(p))},stop:()=>{s&&(cancelAnimationFrame(s),s=void 0),a=!0},resume:()=>{a=!1,o=!0,e.scheduleRender()},append:(f,m)=>{h(vb.append,f,m)},insertBefore:(f,m)=>{h(vb.insertBefore,f,m)},merge:(f,m)=>{h(vb.merge,f,m)},replace:(f,m)=>{h(vb.replace,f,m)},detach:f=>{for(let m=0;m<c.length;m++)if(c[m]===f)return c.splice(m,1),l.splice(m,1)[0];throw new Error("renderFunction was not found")}},e},PC={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,safari10:!1,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,cssVarShim:!1,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,dynamicImportShim:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0};let IC,FRe,fB,kRe=!1,wV=!1,xse=!1,Dh=!1,Jde=null,vJ=!1;const URe=t=>{const e=new URL(t,gl.$resourcesUrl$);return e.origin!==RN.location.origin?e.href:e.pathname},VRe=t=>gl.$resourcesUrl$=t,f2=(t,e="")=>()=>{},Kde="http://www.w3.org/1999/xlink",Qde={},aKe="http://www.w3.org/2000/svg",lKe="http://www.w3.org/1999/xhtml",cKe=t=>t!=null,Tse=t=>(t=typeof t,t==="object"||t==="function"),ws=(t,e,...i)=>{let r=null,n=null,s=null,o=!1,a=!1;const l=[],c=p=>{for(let f=0;f<p.length;f++)r=p[f],Array.isArray(r)?c(r):r!=null&&typeof r!="boolean"&&((o=typeof t!="function"&&!Tse(r))&&(r=String(r)),o&&a?l[l.length-1].$text$+=r:l.push(o?xV(null,r):r),a=o)};if(c(i),e){e.key&&(n=e.key),e.name&&(s=e.name);{const p=e.className||e.class;p&&(e.class=typeof p!="object"?p:Object.keys(p).filter(f=>p[f]).join(" "))}}if(typeof t=="function")return t(e===null?{}:e,l,hKe);const h=xV(t,null);return h.$attrs$=e,l.length>0&&(h.$children$=l),h.$key$=n,h.$name$=s,h},xV=(t,e)=>{const i={$flags$:0,$tag$:t,$text$:e,$elm$:null,$children$:null};return i.$attrs$=null,i.$key$=null,i.$name$=null,i},Sse={},uKe=t=>t&&t.$tag$===Sse,hKe={forEach:(t,e)=>t.map(epe).forEach(e),map:(t,e)=>t.map(epe).map(e).map(dKe)},epe=t=>({vattrs:t.$attrs$,vchildren:t.$children$,vkey:t.$key$,vname:t.$name$,vtag:t.$tag$,vtext:t.$text$}),dKe=t=>{if(typeof t.vtag=="function"){const i=Object.assign({},t.vattrs);return t.vkey&&(i.key=t.vkey),t.vname&&(i.name=t.vname),ws(t.vtag,i,...t.vchildren||[])}const e=xV(t.vtag,t.vtext);return e.$attrs$=t.vattrs,e.$children$=t.vchildren,e.$key$=t.vkey,e.$name$=t.vname,e},pKe=t=>VKe.map(e=>e(t)).find(e=>!!e),fKe=(t,e)=>t!=null&&!Tse(t)?e&4?t==="false"?!1:t===""||!!t:e&2?parseFloat(t):e&1?String(t):t:t,mKe=t=>t,Vzt=(t,e,i)=>{const r=mKe(t);return{emit:n=>gKe(r,e,{bubbles:!!(i&4),composed:!!(i&2),cancelable:!!(i&1),detail:n})}},gKe=(t,e,i)=>{const r=gl.ce(e,i);return t.dispatchEvent(r),r},tpe=new WeakMap,yKe=(t,e,i)=>{let r=SV.get(t);jKe&&i?(r=r||new CSSStyleSheet,typeof r=="string"?r=e:r.replaceSync(e)):r=e,SV.set(t,r)},_Ke=(t,e,i,r)=>{let n=zRe(e,i);const s=SV.get(n);if(t=t.nodeType===11?t:Kg,s)if(typeof s=="string"){t=t.head||t;let o=tpe.get(t),a;o||tpe.set(t,o=new Set),o.has(n)||(a=Kg.createElement("style"),a.innerHTML=s,t.insertBefore(a,t.querySelector("link")),o&&o.add(n))}else t.adoptedStyleSheets.includes(s)||(t.adoptedStyleSheets=[...t.adoptedStyleSheets,s]);return n},vKe=t=>{const e=t.$cmpMeta$,i=t.$hostElement$,r=e.$flags$,n=f2("attachStyles",e.$tagName$),s=_Ke(i.shadowRoot?i.shadowRoot:i.getRootNode(),e,t.$modeName$);r&10&&(i["s-sc"]=s,i.classList.add(s+"-h"),r&2&&i.classList.add(s+"-s")),n()},zRe=(t,e)=>"sc-"+(e&&t.$flags$&32?t.$tagName$+"-"+e:t.$tagName$),ipe=(t,e,i,r,n,s)=>{if(i!==r){let o=ope(t,e),a=e.toLowerCase();if(e==="class"){const l=t.classList,c=rpe(i),h=rpe(r);l.remove(...c.filter(p=>p&&!h.includes(p))),l.add(...h.filter(p=>p&&!c.includes(p)))}else if(e==="style"){for(const l in i)(!r||r[l]==null)&&(l.includes("-")?t.style.removeProperty(l):t.style[l]="");for(const l in r)(!i||r[l]!==i[l])&&(l.includes("-")?t.style.setProperty(l,r[l]):t.style[l]=r[l])}else if(e!=="key")if(e==="ref")r&&r(t);else if(!t.__lookupSetter__(e)&&e[0]==="o"&&e[1]==="n")e[2]==="-"?e=e.slice(3):ope(RN,a)?e=a.slice(2):e=a[2]+e.slice(3),i&&gl.rel(t,e,i,!1),r&&gl.ael(t,e,r,!1);else{const l=Tse(r);if((o||l&&r!==null)&&!n)try{if(t.tagName.includes("-"))t[e]=r;else{const h=r??"";e==="list"?o=!1:(i==null||t[e]!=h)&&(t[e]=h)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(e=a,c=!0),r==null||r===!1?(r!==!1||t.getAttribute(e)==="")&&(c?t.removeAttributeNS(Kde,e):t.removeAttribute(e)):(!o||s&4||n)&&!l&&(r=r===!0?"":r,c?t.setAttributeNS(Kde,e,r):t.setAttribute(e,r))}}},bKe=/\s/,rpe=t=>t?t.split(bKe):[],BRe=(t,e,i,r)=>{const n=e.$elm$.nodeType===11&&e.$elm$.host?e.$elm$.host:e.$elm$,s=t&&t.$attrs$||Qde,o=e.$attrs$||Qde;for(r in s)r in o||ipe(n,r,s[r],void 0,i,e.$flags$);for(r in o)ipe(n,r,s[r],o[r],i,e.$flags$)},TV=(t,e,i,r)=>{const n=e.$children$[i];let s=0,o,a,l;if(kRe||(xse=!0,n.$tag$==="slot"&&(IC&&r.classList.add(IC+"-s"),n.$flags$|=n.$children$?2:1)),n.$text$!==null)o=n.$elm$=Kg.createTextNode(n.$text$);else if(n.$flags$&1)o=n.$elm$=Kg.createTextNode("");else{if(Dh||(Dh=n.$tag$==="svg"),o=n.$elm$=Kg.createElementNS(Dh?aKe:lKe,n.$flags$&2?"slot-fb":n.$tag$),Dh&&n.$tag$==="foreignObject"&&(Dh=!1),BRe(null,n,Dh),cKe(IC)&&o["s-si"]!==IC&&o.classList.add(o["s-si"]=IC),n.$children$)for(s=0;s<n.$children$.length;++s)a=TV(t,n,s,o),a&&o.appendChild(a);n.$tag$==="svg"?Dh=!1:o.tagName==="foreignObject"&&(Dh=!0)}return o["s-hn"]=fB,n.$flags$&3&&(o["s-sr"]=!0,o["s-cr"]=FRe,o["s-sn"]=n.$name$||"",l=t&&t.$children$&&t.$children$[i],l&&l.$tag$===n.$tag$&&t.$elm$&&iD(t.$elm$,!1)),o},iD=(t,e)=>{gl.$flags$|=1;const i=t.childNodes;for(let r=i.length-1;r>=0;r--){const n=i[r];n["s-hn"]!==fB&&n["s-ol"]&&(HRe(n).insertBefore(n,Ese(n)),n["s-ol"].remove(),n["s-ol"]=void 0,xse=!0),e&&iD(n,e)}gl.$flags$&=-2},jRe=(t,e,i,r,n,s)=>{let o=t["s-cr"]&&t["s-cr"].parentNode||t,a;for(o.shadowRoot&&o.tagName===fB&&(o=o.shadowRoot);n<=s;++n)r[n]&&(a=TV(null,i,n,t),a&&(r[n].$elm$=a,o.insertBefore(a,Ese(e))))},GRe=(t,e,i,r,n)=>{for(;e<=i;++e)(r=t[e])&&(n=r.$elm$,XRe(r),wV=!0,n["s-ol"]?n["s-ol"].remove():iD(n,!0),n.remove())},wKe=(t,e,i,r)=>{let n=0,s=0,o=0,a=0,l=e.length-1,c=e[0],h=e[l],p=r.length-1,f=r[0],m=r[p],g,_;for(;n<=l&&s<=p;)if(c==null)c=e[++n];else if(h==null)h=e[--l];else if(f==null)f=r[++s];else if(m==null)m=r[--p];else if(QF(c,f))$C(c,f),c=e[++n],f=r[++s];else if(QF(h,m))$C(h,m),h=e[--l],m=r[--p];else if(QF(c,m))(c.$tag$==="slot"||m.$tag$==="slot")&&iD(c.$elm$.parentNode,!1),$C(c,m),t.insertBefore(c.$elm$,h.$elm$.nextSibling),c=e[++n],m=r[--p];else if(QF(h,f))(c.$tag$==="slot"||m.$tag$==="slot")&&iD(h.$elm$.parentNode,!1),$C(h,f),t.insertBefore(h.$elm$,c.$elm$),h=e[--l],f=r[++s];else{for(o=-1,a=n;a<=l;++a)if(e[a]&&e[a].$key$!==null&&e[a].$key$===f.$key$){o=a;break}o>=0?(_=e[o],_.$tag$!==f.$tag$?g=TV(e&&e[s],i,o,t):($C(_,f),e[o]=void 0,g=_.$elm$),f=r[++s]):(g=TV(e&&e[s],i,s,t),f=r[++s]),g&&HRe(c.$elm$).insertBefore(g,Ese(c.$elm$))}n>l?jRe(t,r[p+1]==null?null:r[p+1].$elm$,i,r,s,p):s>p&&GRe(e,n,l)},QF=(t,e)=>t.$tag$===e.$tag$?t.$tag$==="slot"?t.$name$===e.$name$:t.$key$===e.$key$:!1,Ese=t=>t&&t["s-ol"]||t,HRe=t=>(t["s-ol"]?t["s-ol"]:t).parentNode,$C=(t,e)=>{const i=e.$elm$=t.$elm$,r=t.$children$,n=e.$children$,s=e.$tag$,o=e.$text$;let a;o===null?(Dh=s==="svg"?!0:s==="foreignObject"?!1:Dh,s==="slot"||BRe(t,e,Dh),r!==null&&n!==null?wKe(i,r,e,n):n!==null?(t.$text$!==null&&(i.textContent=""),jRe(i,null,e,n,0,n.length-1)):r!==null&&GRe(r,0,r.length-1),Dh&&s==="svg"&&(Dh=!1)):(a=i["s-cr"])?a.parentNode.textContent=o:t.$text$!==o&&(i.data=o)},qRe=t=>{const e=t.childNodes;let i,r,n,s,o,a;for(r=0,n=e.length;r<n;r++)if(i=e[r],i.nodeType===1){if(i["s-sr"]){for(o=i["s-sn"],i.hidden=!1,s=0;s<n;s++)if(a=e[s].nodeType,e[s]["s-hn"]!==i["s-hn"]||o!==""){if(a===1&&o===e[s].getAttribute("slot")){i.hidden=!0;break}}else if(a===1||a===3&&e[s].textContent.trim()!==""){i.hidden=!0;break}}qRe(i)}},jf=[],WRe=t=>{let e,i,r,n,s,o,a=0;const l=t.childNodes,c=l.length;for(;a<c;a++){if(e=l[a],e["s-sr"]&&(i=e["s-cr"])&&i.parentNode)for(r=i.parentNode.childNodes,n=e["s-sn"],o=r.length-1;o>=0;o--)i=r[o],!i["s-cn"]&&!i["s-nr"]&&i["s-hn"]!==e["s-hn"]&&(npe(i,n)?(s=jf.find(h=>h.$nodeToRelocate$===i),wV=!0,i["s-sn"]=i["s-sn"]||n,s?s.$slotRefNode$=e:jf.push({$slotRefNode$:e,$nodeToRelocate$:i}),i["s-sr"]&&jf.map(h=>{npe(h.$nodeToRelocate$,i["s-sn"])&&(s=jf.find(p=>p.$nodeToRelocate$===i),s&&!h.$slotRefNode$&&(h.$slotRefNode$=s.$slotRefNode$))})):jf.some(h=>h.$nodeToRelocate$===i)||jf.push({$nodeToRelocate$:i}));e.nodeType===1&&WRe(e)}},npe=(t,e)=>t.nodeType===1?t.getAttribute("slot")===null&&e===""||t.getAttribute("slot")===e:t["s-sn"]===e?!0:e==="",XRe=t=>{t.$attrs$&&t.$attrs$.ref&&t.$attrs$.ref(null),t.$children$&&t.$children$.map(XRe)},xKe=(t,e)=>{const i=t.$hostElement$,r=t.$cmpMeta$,n=t.$vnode$||xV(null,null),s=uKe(e)?e:ws(null,null,e);fB=i.tagName,r.$attrsToReflect$&&(s.$attrs$=s.$attrs$||{},r.$attrsToReflect$.map(([o,a])=>s.$attrs$[a]=i[o])),s.$tag$=null,s.$flags$|=4,t.$vnode$=s,s.$elm$=n.$elm$=i.shadowRoot||i,IC=i["s-sc"],FRe=i["s-cr"],kRe=(r.$flags$&1)!==0,wV=!1,$C(n,s);{if(gl.$flags$|=1,xse){WRe(s.$elm$);let o,a,l,c,h,p,f=0;for(;f<jf.length;f++)o=jf[f],a=o.$nodeToRelocate$,a["s-ol"]||(l=Kg.createTextNode(""),l["s-nr"]=a,a.parentNode.insertBefore(a["s-ol"]=l,a));for(f=0;f<jf.length;f++)if(o=jf[f],a=o.$nodeToRelocate$,o.$slotRefNode$){for(c=o.$slotRefNode$.parentNode,h=o.$slotRefNode$.nextSibling,l=a["s-ol"];l=l.previousSibling;)if(p=l["s-nr"],p&&p["s-sn"]===a["s-sn"]&&c===p.parentNode&&(p=p.nextSibling,!p||!p["s-nr"])){h=p;break}(!h&&c!==a.parentNode||a.nextSibling!==h)&&a!==h&&(!a["s-hn"]&&a["s-ol"]&&(a["s-hn"]=a["s-ol"].parentNode.nodeName),c.insertBefore(a,h))}else a.nodeType===1&&(a.hidden=!0)}wV&&qRe(s.$elm$),gl.$flags$&=-2,jf.length=0}},TKe=(t,e)=>{},Cse=(t,e)=>(t.$flags$|=16,TKe(t,t.$ancestorComponent$),qKe(()=>SKe(t,e))),SKe=(t,e)=>{const i=t.$hostElement$,r=f2("scheduleUpdate",t.$cmpMeta$.$tagName$),n=i;let s;return e?s=IR(n,"componentWillLoad"):s=IR(n,"componentWillUpdate"),s=spe(s,()=>IR(n,"componentWillRender")),r(),spe(s,()=>EKe(t,n,e))},EKe=async(t,e,i)=>{const r=t.$hostElement$,n=f2("update",t.$cmpMeta$.$tagName$);r["s-rc"],i&&vKe(t);const s=f2("render",t.$cmpMeta$.$tagName$);CKe(t,e,r),s(),n(),AKe(t)},CKe=(t,e,i)=>{try{Jde=e,e=e.render&&e.render(),t.$flags$&=-17,t.$flags$|=2,(PC.hasRenderFn||PC.reflect)&&(PC.vdomRender||PC.reflect)&&(PC.hydrateServerSide||xKe(t,e))}catch(a){AN(a,t.$hostElement$)}return Jde=null,null},AKe=t=>{const e=t.$cmpMeta$.$tagName$,i=t.$hostElement$,r=f2("postUpdate",e),n=i;t.$ancestorComponent$,IR(n,"componentDidRender"),t.$flags$&64?(IR(n,"componentDidUpdate"),r()):(t.$flags$|=64,IR(n,"componentDidLoad"),r())},zzt=t=>{{const e=CN(t),i=e.$hostElement$.isConnected;return i&&(e.$flags$&18)===2&&Cse(e,!1),i}},IR=(t,e,i)=>{if(t&&t[e])try{return t[e](i)}catch(r){AN(r)}},spe=(t,e)=>t&&t.then?t.then(e):e(),RKe=(t,e)=>CN(t).$instanceValues$.get(e),MKe=(t,e,i,r)=>{const n=CN(t),s=t,o=n.$instanceValues$.get(e),a=n.$flags$,l=s;i=fKe(i,r.$members$[e][0]);const c=Number.isNaN(o)&&Number.isNaN(i);if(i!==o&&!c){n.$instanceValues$.set(e,i);{if(r.$watchers$&&a&128){const p=r.$watchers$[e];p&&p.map(f=>{try{l[f](i,o,e)}catch(m){AN(m,s)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(i,o,e)===!1)return;Cse(n,!1)}}}},OKe=(t,e,i)=>{if(e.$members$){t.watchers&&(e.$watchers$=t.watchers);const r=Object.entries(e.$members$),n=t.prototype;r.map(([s,[o]])=>{(o&31||o&32)&&Object.defineProperty(n,s,{get(){return RKe(this,s)},set(a){MKe(this,s,a,e)},configurable:!0,enumerable:!0})});{const s=new Map;n.attributeChangedCallback=function(o,a,l){gl.jmp(()=>{const c=s.get(o);if(this.hasOwnProperty(c))l=this[c],delete this[c];else if(n.hasOwnProperty(c)&&typeof this[c]=="number"&&this[c]==l)return;this[c]=l===null&&typeof this[c]=="boolean"?!1:l})},t.observedAttributes=r.filter(([o,a])=>a[0]&15).map(([o,a])=>{const l=a[1]||o;return s.set(l,o),a[0]&512&&e.$attrsToReflect$.push([o,l]),l})}}return t},PKe=async(t,e,i,r,n)=>{if(!(e.$flags$&32)&&(n=t.constructor,e.$flags$|=32,customElements.whenDefined(i.$tagName$).then(()=>e.$flags$|=128),n.style)){let o=n.style;typeof o!="string"&&(o=o[e.$modeName$=pKe(t)]);const a=zRe(i,e.$modeName$);if(!SV.has(a)){const l=f2("registerStyles",i.$tagName$);yKe(a,o,!!(i.$flags$&1)),l()}}e.$ancestorComponent$,(()=>Cse(e,!0))()},IKe=t=>{},$Ke=t=>{if(!(gl.$flags$&1)){const e=CN(t),i=e.$cmpMeta$,r=f2("connectedCallback",i.$tagName$);e.$flags$&1?(YRe(t,e,i.$listeners$),IKe(e.$lazyInstance$)):(e.$flags$|=1,i.$flags$&12&&LKe(t),i.$members$&&Object.entries(i.$members$).map(([n,[s]])=>{if(s&31&&t.hasOwnProperty(n)){const o=t[n];delete t[n],t[n]=o}}),PKe(t,e,i)),r()}},LKe=t=>{const e=t["s-cr"]=Kg.createComment("");e["s-cn"]=!0,t.insertBefore(e,t.firstChild)},DKe=t=>{if(!(gl.$flags$&1)){const e=CN(t);e.$rmListeners$&&(e.$rmListeners$.map(i=>i()),e.$rmListeners$=void 0)}},Ase=(t,e)=>{const i={$flags$:e[0],$tagName$:e[1]};i.$members$=e[2],i.$listeners$=e[3],i.$watchers$=t.$watchers$,i.$attrsToReflect$=[];const r=t.prototype.connectedCallback,n=t.prototype.disconnectedCallback;return Object.assign(t.prototype,{__registerHost(){UKe(this,i)},connectedCallback(){$Ke(this),r&&r.call(this)},disconnectedCallback(){DKe(this),n&&n.call(this)},__attachShadow(){this.attachShadow({mode:"open",delegatesFocus:!!(i.$flags$&16)})}}),t.is=i.$tagName$,OKe(t,i)},Bzt=(t,e)=>e,YRe=(t,e,i,r)=>{i&&i.map(([n,s,o])=>{const a=FKe(t,n),l=NKe(e,o),c=kKe(n);gl.ael(a,s,l,c),(e.$rmListeners$=e.$rmListeners$||[]).push(()=>gl.rel(a,s,l,c))})},NKe=(t,e)=>i=>{try{PC.lazyLoad||t.$hostElement$[e](i)}catch(r){AN(r)}},FKe=(t,e)=>e&4?Kg:e&8?RN:e&16?Kg.body:t,kKe=t=>zKe?{passive:(t&1)!==0,capture:(t&2)!==0}:(t&2)!==0,ZRe=new WeakMap,CN=t=>ZRe.get(t),UKe=(t,e)=>{const i={$flags$:0,$hostElement$:t,$cmpMeta$:e,$instanceValues$:new Map};return YRe(t,i,e.$listeners$),ZRe.set(t,i)},ope=(t,e)=>e in t,AN=(t,e)=>(0,console.error)(t,e),SV=new Map,VKe=[],RN=typeof window<"u"?window:{},Kg=RN.document||{head:{}},Rse=RN.HTMLElement||class{},gl={$flags$:0,$resourcesUrl$:"",jmp:t=>t(),raf:t=>requestAnimationFrame(t),ael:(t,e,i,r)=>t.addEventListener(e,i,r),rel:(t,e,i,r)=>t.removeEventListener(e,i,r),ce:(t,e)=>new CustomEvent(t,e)},zKe=(()=>{let t=!1;try{Kg.addEventListener("e",null,Object.defineProperty({},"passive",{get(){t=!0}}))}catch{}return t})(),BKe=t=>Promise.resolve(t),jKe=(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replaceSync=="function"}catch{}return!1})(),ape=[],JRe=[],GKe=(t,e)=>i=>{t.push(i),vJ||(vJ=!0,e&&gl.$flags$&4?HKe(bJ):gl.raf(bJ))},lpe=t=>{for(let e=0;e<t.length;e++)try{t[e](performance.now())}catch(i){AN(i)}t.length=0},bJ=()=>{lpe(ape),lpe(JRe),(vJ=ape.length>0)&&gl.raf(bJ)},HKe=t=>BKe().then(t),qKe=GKe(JRe,!0);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.7
 */function WKe(t){return t.map(e=>{let i="";for(let r=0;r<e;r++)i+=((1+Math.random())*65536|0).toString(16).substring(1);return i}).join("-")}const XKe=()=>WKe([2,1,1,1,3]);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.7
 */const KRe="calcite-mode-auto",QRe="calcite-mode-dark",YKe="calcite-mode-light",jzt={autoMode:KRe,darkMode:QRe,lightMode:YKe,rtl:"calcite--rtl"};/*!
* tabbable 6.0.1
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var eMe=["input","select","textarea","a[href]","button","[tabindex]:not(slot)","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])',"details>summary:first-of-type","details"],EV=eMe.join(","),tMe=typeof Element>"u",m2=tMe?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,CV=!tMe&&Element.prototype.getRootNode?function(t){return t.getRootNode()}:function(t){return t.ownerDocument},iMe=function(e,i,r){var n=Array.prototype.slice.apply(e.querySelectorAll(EV));return i&&m2.call(e,EV)&&n.unshift(e),n=n.filter(r),n},rMe=function t(e,i,r){for(var n=[],s=Array.from(e);s.length;){var o=s.shift();if(o.tagName==="SLOT"){var a=o.assignedElements(),l=a.length?a:o.children,c=t(l,!0,r);r.flatten?n.push.apply(n,c):n.push({scopeParent:o,candidates:c})}else{var h=m2.call(o,EV);h&&r.filter(o)&&(i||!e.includes(o))&&n.push(o);var p=o.shadowRoot||typeof r.getShadowRoot=="function"&&r.getShadowRoot(o),f=!r.shadowRootFilter||r.shadowRootFilter(o);if(p&&f){var m=t(p===!0?o.children:p.children,!0,r);r.flatten?n.push.apply(n,m):n.push({scopeParent:o,candidates:m})}else s.unshift.apply(s,o.children)}}return n},nMe=function(e,i){return e.tabIndex<0&&(i||/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||e.isContentEditable)&&isNaN(parseInt(e.getAttribute("tabindex"),10))?0:e.tabIndex},ZKe=function(e,i){return e.tabIndex===i.tabIndex?e.documentOrder-i.documentOrder:e.tabIndex-i.tabIndex},sMe=function(e){return e.tagName==="INPUT"},JKe=function(e){return sMe(e)&&e.type==="hidden"},KKe=function(e){var i=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(r){return r.tagName==="SUMMARY"});return i},QKe=function(e,i){for(var r=0;r<e.length;r++)if(e[r].checked&&e[r].form===i)return e[r]},eQe=function(e){if(!e.name)return!0;var i=e.form||CV(e),r=function(a){return i.querySelectorAll('input[type="radio"][name="'+a+'"]')},n;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")n=r(window.CSS.escape(e.name));else try{n=r(e.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var s=QKe(n,e.form);return!s||s===e},tQe=function(e){return sMe(e)&&e.type==="radio"},iQe=function(e){return tQe(e)&&!eQe(e)},rQe=function(e){for(var i,r=CV(e).host,n=!!((i=r)!==null&&i!==void 0&&i.ownerDocument.contains(r)||e.ownerDocument.contains(e));!n&&r;){var s;r=CV(r).host,n=!!((s=r)!==null&&s!==void 0&&s.ownerDocument.contains(r))}return n},cpe=function(e){var i=e.getBoundingClientRect(),r=i.width,n=i.height;return r===0&&n===0},nQe=function(e,i){var r=i.displayCheck,n=i.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var s=m2.call(e,"details>summary:first-of-type"),o=s?e.parentElement:e;if(m2.call(o,"details:not([open]) *"))return!0;if(!r||r==="full"||r==="legacy-full"){if(typeof n=="function"){for(var a=e;e;){var l=e.parentElement,c=CV(e);if(l&&!l.shadowRoot&&n(l)===!0)return cpe(e);e.assignedSlot?e=e.assignedSlot:!l&&c!==e.ownerDocument?e=c.host:e=l}e=a}if(rQe(e))return!e.getClientRects().length;if(r!=="legacy-full")return!0}else if(r==="non-zero-area")return cpe(e);return!1},sQe=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var i=e.parentElement;i;){if(i.tagName==="FIELDSET"&&i.disabled){for(var r=0;r<i.children.length;r++){var n=i.children.item(r);if(n.tagName==="LEGEND")return m2.call(i,"fieldset[disabled] *")?!0:!n.contains(e)}return!0}i=i.parentElement}return!1},AV=function(e,i){return!(i.disabled||JKe(i)||nQe(i,e)||KKe(i)||sQe(i))},wJ=function(e,i){return!(iQe(i)||nMe(i)<0||!AV(e,i))},oQe=function(e){var i=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(i)||i>=0)},aQe=function t(e){var i=[],r=[];return e.forEach(function(n,s){var o=!!n.scopeParent,a=o?n.scopeParent:n,l=nMe(a,o),c=o?t(n.candidates):a;l===0?o?i.push.apply(i,c):i.push(a):r.push({documentOrder:s,tabIndex:l,item:n,isScope:o,content:c})}),r.sort(ZKe).reduce(function(n,s){return s.isScope?n.push.apply(n,s.content):n.push(s.content),n},[]).concat(i)},lQe=function(e,i){i=i||{};var r;return i.getShadowRoot?r=rMe([e],i.includeContainer,{filter:wJ.bind(null,i),flatten:!1,getShadowRoot:i.getShadowRoot,shadowRootFilter:oQe}):r=iMe(e,i.includeContainer,wJ.bind(null,i)),aQe(r)},Gzt=function(e,i){i=i||{};var r;return i.getShadowRoot?r=rMe([e],i.includeContainer,{filter:AV.bind(null,i),flatten:!0,getShadowRoot:i.getShadowRoot}):r=iMe(e,i.includeContainer,AV.bind(null,i)),r},Hzt=function(e,i){if(i=i||{},!e)throw new Error("No node provided");return m2.call(e,EV)===!1?!1:wJ(i,e)},cQe=eMe.concat("iframe").join(","),qzt=function(e,i){if(i=i||{},!e)throw new Error("No node provided");return m2.call(e,cQe)===!1?!1:AV(i,e)};const uQe={getShadowRoot:!0};function hQe(t){const e="dir",i=`[${e}]`,r=SO(t,i);return r?r.getAttribute(e):"ltr"}function Wzt(t,e,i){const r=`[${e}]`,n=t.closest(r);return n?n.getAttribute(e):i}function oMe(t){return t.getRootNode()}function aMe(t){return t.host||null}function dQe(t,{selector:e,id:i}){function r(n){if(!n)return null;n.assignedSlot&&(n=n.assignedSlot);const s=oMe(n),o=i?"getElementById"in s?s.getElementById(i):null:e?s.querySelector(e):null,a=aMe(s);return o||(a?r(a):null)}return r(t)}function SO(t,e){function i(r){return r?r.closest(e)||i(aMe(oMe(r))):null}return i(t)}function pQe(t,e){return lMe(t,e)}function lMe(t,e){if(!t)return;const i=e(t);if(i!==void 0)return i;const{parentNode:r}=t;return lMe(r instanceof ShadowRoot?r.host:r,e)}function fQe(t,e){return!!pQe(e,i=>i===t?!0:void 0)}function mQe(t){return typeof(t==null?void 0:t.setFocus)=="function"}async function Xzt(t){if(t)return mQe(t)?t.setFocus():t.focus()}function Yzt(t){(lQe(t,uQe)[0]||t).focus()}const rD=":not([slot])";function Zzt(t,e,i){e&&!Array.isArray(e)&&typeof e!="string"&&(i=e,e=null);const r=e?Array.isArray(e)?e.map(n=>`[slot="${n}"]`).join(","):`[slot="${e}"]`:rD;return i!=null&&i.all?gQe(t,r,i):yQe(t,r,i)}function cMe(t,e){return t?Array.from(t.children||[]).filter(i=>i==null?void 0:i.matches(e)):[]}function gQe(t,e,i){let r=e===rD?cMe(t,rD):Array.from(t.querySelectorAll(e));r=i&&i.direct===!1?r:r.filter(s=>s.parentElement===t),r=i!=null&&i.matches?r.filter(s=>s==null?void 0:s.matches(i.matches)):r;const n=i==null?void 0:i.selector;return n?r.map(s=>Array.from(s.querySelectorAll(n))).reduce((s,o)=>[...s,...o],[]).filter(s=>!!s):r}function yQe(t,e,i){let r=e===rD?cMe(t,rD)[0]||null:t.querySelector(e);r=i&&i.direct===!1||(r==null?void 0:r.parentElement)===t?r:null,r=i!=null&&i.matches?r!=null&&r.matches(i.matches)?r:null:r;const n=i==null?void 0:i.selector;return n?r==null?void 0:r.querySelector(n):r}function Jzt(t,e,i){if(typeof e=="string"&&e!=="")return e;if(e==="")return t[i]}function _Qe(t){return Boolean(t).toString()}function Kzt(t){return!!vQe(t).length}function vQe(t){return t.target.assignedElements({flatten:!0})}function Qzt(t){return!!(t.isPrimary&&t.button===0)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.7
 */function upe(){const{classList:t}=document.body,e=window.matchMedia("(prefers-color-scheme: dark)").matches,i=()=>t.contains(QRe)||t.contains(KRe)&&e?"dark":"light",r=o=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:o}})),n=o=>{s!==o&&r(o),s=o};let s=i();r(s),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",o=>n(o.matches?"dark":"light")),new MutationObserver(()=>n(i())).observe(document.body,{attributes:!0,attributeFilter:["class"]})}function bQe(){typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document&&(document.readyState==="interactive"?upe():document.addEventListener("DOMContentLoaded",()=>upe(),{once:!0}))}const wQe=bQe;wQe();let uMe;function xQe(){VRe(zc(ar(uMe)))}uMe="components/assets";const hMe=Symbol("widget"),TQe=Symbol("widget-test-data"),SQe=[],EQe={},RV=new WeakMap;function dMe(t,e){let i=e.children;if(i&&i.length)for(let n=0;n<i.length;++n)i[n]=dMe(t,i[n]);else i=SQe;const r=e.vnodeSelector;if(Mse(r)){const n=e.properties||EQe,s=n.key||r;return{vnodeSelector:"div",properties:{key:s,afterCreate:CQe,afterUpdate:AQe,afterRemoved:pMe,parentWidget:t,widgetConstructor:r,widgetProperties:{...n,key:s,children:i}},children:void 0,text:void 0,domNode:null}}return e}function CQe(t,e,i,{parentWidget:r,widgetConstructor:n,widgetProperties:s}){var a;const o=new n(s);o.container=t,RV.set(t,o),(a=o.afterCreate)==null||a.call(o,o,t),r._internalHandles.add(fm(()=>pMe(t)))}function AQe(t,e,i,{widgetProperties:r}){var s;const n=RV.get(t);n&&(n.set(r),(s=n.afterUpdate)==null||s.call(n,n,t))}function pMe(t){var i;const e=RV.get(t);e&&((i=e.afterRemoved)==null||i.call(e,e,t),e.destroy(),RV.delete(t))}function Mse(t){return typeof t=="function"&&t[hMe]}const hpe=new Set;function RQe(t){hpe.add(t),t.finally(()=>hpe.delete(t))}var fMe;const MQe="esri.widgets.Widget";let OQe=0;const PQe={widgetIcon:"esri-icon-checkbox-unchecked"};function mMe(t,e){for(const i in e)t[i]!=null&&(typeof t[i]=="object"&&typeof e[i]=="object"?mMe(t[i],e==null?void 0:e[i]):t[i]=e[i]);return t}const IQe=oKe({postProcessProjectionOptions(t){const e=t.eventHandlerInterceptor,i=/capture$/i;t.eventHandlerInterceptor=(r,n,s,o)=>{const a=e==null?void 0:e(r,n,s,o),l=i.test(r);if(!((r=r.replace(i,"")).toLowerCase()in s)||l){const c=r[2].toLowerCase()+r.slice(3),h=m=>a==null?void 0:a.call(s,m);s.addEventListener(c,h,l);const p=()=>s.removeEventListener(c,h,l),f=o.afterRemoved;o.afterRemoved=m=>{f==null||f(m),p()}}return a}},handleInterceptedEvent(t,e,i,r){const{eventPhase:n,type:s}=r,o=n===Event.CAPTURING_PHASE;let a=`on${s}${o?"capture":""}`;const l=e.properties;(l&&a in l||(a=`on${s[0].toUpperCase()}${s.slice(1)}${o?"Capture":""}`,l&&a in l))&&(ERe(),t.scheduleRender(),l[a].call(l.bind||i,r))}});let aG=!1,Qo=class extends bO(An.EventedAccessor){constructor(e,i){super(e,i),this._attached=!1,this._internalHandles=new Xi,this._projector=IQe,this._readyForTrueRender=!1,this.iconClass=PQe.widgetIcon,this.key=this,this._loadLocale=f2e(async()=>{if(this._messageBundleProps&&this._messageBundleProps.length){const o=await ma(this._messageBundleProps.map(async({bundlePath:a,propertyName:l})=>{let c=await CAe(a);this.uiStrings&&Object.keys(this.uiStrings)&&(c=mMe(se(c),this.uiStrings)),this[l]=c}));for(const a of o)a.error&&re.getLogger(this.declaredClass).error("widget-intl:locale-error",this.declaredClass,a.error)}await this.loadLocale()}),xQe();const r="esri-widget-uid-"+NRe(),n=this.render.bind(this);this._trackingTarget=new I9(()=>this.scheduleRender());const s=()=>{var p;if(!this._readyForTrueRender||this.destroyed)return null;if(!this.visible)return{vnodeSelector:"div",properties:{key:r,class:"",styles:{display:"none"}},domNode:null,children:void 0,text:void 0};const o=n();let{properties:a}=o;a||(o.properties=a={});let{key:l,styles:c}=a;l||(a.key=r),c||(a.styles=c={}),c.display||(c.display="");let h=0;return(p=o.children)==null||p.forEach(f=>{if(Mse(f.vnodeSelector))return;let{properties:m}=f;m||(f.properties=m={}),m.key||(m.key=`${this.id}--${h++}`)}),dMe(this,o)};this.render=()=>{if(aG)return s();let o=IJe(this)??null;if(o)return o;this._trackingTarget.clear(),aG=!0;try{o=T_(this._trackingTarget,s)}catch(a){throw console.error(a),a}finally{aG=!1}return o&&$Je(this,o),o},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then(()=>{this._readyForTrueRender=!0,this._postInitialize()})),RQe(this._resourcesFetch)}normalizeCtorArgs(e,i){const r={...e};return i&&(r.container=i),r}postInitialize(){}beforeFirstRender(){return Promise.all([this.loadDependencies(),this._loadLocale()]).then(()=>{}).catch(fY)}async loadDependencies(){}async loadLocale(){}destroy(){this.destroyed||(Ve(this._trackingTarget),Ve(this.viewModel),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null,sG(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return uB(e)}get domNode(){return this.container}set domNode(e){this.container=e}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+OQe++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(fMe=hMe,TQe)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(sG(this),this._projector.scheduleRender())}classes(...e){return ARe.apply(this,e)}renderNow(){sG(this),this._projector.renderNow()}_postInitialize(){var i;if(this.destroyed)return;this.scheduleRender(),(i=this._delegatedEventNames)!=null&&i.length&&this._internalHandles.add(ne(()=>this.viewModel,(r,n)=>{n&&this._internalHandles.remove("delegated-events"),r&&M9(r)&&this._internalHandles.add(this._delegatedEventNames.map(s=>fN(r,s,o=>{this.emit(s,o)})),"delegated-events")},zt)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(fY),this.scheduleRender()};this._internalHandles.add([$Ee(e),ne(()=>this.uiStrings,e),yo(()=>this.container,r=>{this.destroyed||this._attach(r)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){var i;this._attached&&(this._projector.detach(this.render),this._attached=!1),(i=e==null?void 0:e.parentNode)==null||i.removeChild(e)}};Qo[fMe]=!0,u([d()],Qo.prototype,"_readyForTrueRender",void 0),u([d({value:null})],Qo.prototype,"container",null),u([ri("container")],Qo.prototype,"castContainer",null),u([d()],Qo.prototype,"iconClass",void 0),u([d()],Qo.prototype,"id",null),u([d()],Qo.prototype,"label",null),u([d()],Qo.prototype,"renderable",null),u([d()],Qo.prototype,"uiStrings",void 0),u([d()],Qo.prototype,"viewModel",void 0),u([d({value:!0})],Qo.prototype,"visible",null),u([d()],Qo.prototype,"key",void 0),u([d()],Qo.prototype,"children",void 0),u([d()],Qo.prototype,"afterCreate",void 0),u([d()],Qo.prototype,"afterUpdate",void 0),u([d()],Qo.prototype,"afterRemoved",void 0),Qo=u([$(MQe)],Qo);const Sa=Qo;function gMe(t){return 32+t.length}function yMe(t){return 16}function _Me(t){if(!t)return 0;let e=wMe;for(const i in t)if(t.hasOwnProperty(i)){const r=t[i];switch(typeof r){case"string":e+=gMe(r);break;case"number":e+=yMe();break;case"boolean":e+=4}}return e}function vMe(t){if(!t)return 0;if(Array.isArray(t))return $Qe(t);let e=wMe;for(const i in t)t.hasOwnProperty(i)&&(e+=bMe(t[i]));return e}function $Qe(t){const e=t.length;if(e===0||typeof t[0]=="number")return 32+8*e;let i=xMe;for(let r=0;r<e;r++)i+=bMe(t[r]);return i}function bMe(t){switch(typeof t){case"object":return vMe(t);case"string":return gMe(t);case"number":return yMe();case"boolean":return 4;default:return 8}}function t9t(t,e){return xMe+t.length*e}const wMe=32,xMe=32;var PM;(function(t){t[t.KILOBYTES=1024]="KILOBYTES",t[t.MEGABYTES=1048576]="MEGABYTES",t[t.GIGABYTES=1073741824]="GIGABYTES"})(PM||(PM={}));function LQe(t,e,i){return t.units[e][i]}function mB(t,e,i,r=2,n="abbr"){return`${hy(e,{minimumFractionDigits:r,maximumFractionDigits:r,signDisplay:e>0?"never":"exceptZero"})} ${LQe(t,i,n)}`}function i9t(t,e,i,r=2,n="abbr"){const s=B2e(e,i);return mB(t,Gs(e,i,s),s,r,n)}function r9t(t,e,i,r=2,n="abbr"){const s=j2e(e,i);return mB(t,Gs(e,i,s),s,r,n)}function n9t(t,e,i,r=2,n="abbr"){const s=G2e(e,i);return mB(t,Gs(e,i,s),s,r,n)}function s9t(t,e,i,r=2,n="abbr"){const s=H2e(e,i);return mB(t,Gs(e,i,s),s,r,n)}const dpe=["B","kB","MB","GB","TB"];function DQe(t,e){let i=e===0?0:Math.floor(Math.log(e)/Math.log(PM.KILOBYTES));i=_e(i,0,dpe.length-1);const r=hy(e/PM.KILOBYTES**i,{maximumFractionDigits:2});return ay(t.units.bytes[dpe[i]],{fileSize:r})}function NQe(t){const{exifInfo:e,exifName:i,tagName:r}=t;if(!e||!i||!r)return null;const n=e.find(s=>s.name===i);return n?FQe({tagName:r,tags:n.tags}):null}function FQe(t){const{tagName:e,tags:i}=t;if(!i||!e)return null;const r=i.find(n=>n.name===e);return r&&r.value||null}var xJ;const kQe={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let pu=xJ=class extends fe{constructor(t){super(t),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:t}=this,e=NQe({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:t});return kQe[e]||null}clone(){return new xJ({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};u([d({type:String})],pu.prototype,"contentType",void 0),u([d()],pu.prototype,"exifInfo",void 0),u([d({readOnly:!0})],pu.prototype,"orientationInfo",null),u([d({type:Kr})],pu.prototype,"id",void 0),u([d({type:String})],pu.prototype,"globalId",void 0),u([d({type:String})],pu.prototype,"keywords",void 0),u([d({type:String})],pu.prototype,"name",void 0),u([d({json:{read:!1}})],pu.prototype,"parentGlobalId",void 0),u([d({json:{read:!1}})],pu.prototype,"parentObjectId",void 0),u([d({type:Kr})],pu.prototype,"size",void 0),u([d({json:{read:!1}})],pu.prototype,"url",void 0),pu=xJ=u([$("esri.layers.support.AttachmentInfo")],pu);const UQe=pu;var TJ;let Oa=TJ=class extends fe{constructor(t){super(t),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new TJ(se({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};u([d({type:[String],json:{write:!0}})],Oa.prototype,"attachmentTypes",void 0),u([d({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],Oa.prototype,"attachmentsWhere",void 0),u([d({type:Boolean,json:{write:!0}})],Oa.prototype,"cacheHint",void 0),u([d({type:[String],json:{write:!0}})],Oa.prototype,"keywords",void 0),u([d({type:[Number],json:{write:!0}})],Oa.prototype,"globalIds",void 0),u([d({json:{write:!0}})],Oa.prototype,"name",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],Oa.prototype,"num",void 0),u([d({type:[Number],json:{write:!0}})],Oa.prototype,"objectIds",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Oa.prototype,"returnMetadata",void 0),u([d({type:[Number],json:{write:!0}})],Oa.prototype,"size",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],Oa.prototype,"start",void 0),u([Ne("start"),Ne("num")],Oa.prototype,"writeStart",null),u([d({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],Oa.prototype,"where",void 0),Oa=TJ=u([$("esri.rest.support.AttachmentQuery")],Oa),Oa.from=Ts(Oa);const SJ=Oa;function O$(t){const e=t==null?void 0:t.type;return e==="base-tile"||e==="tile"||e==="elevation"||e==="imagery-tile"||e==="base-elevation"||e==="open-street-map"||e==="wcs"||e==="web-tile"||e==="wmts"||e==="vector-tile"}function IM(t){return t!=null&&"type"in t&&t.type==="group"}const o9t={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};function TMe(t){const e=t==null?void 0:t.type;return e==="building-scene"||e==="integrated-mesh"||e==="point-cloud"||e==="scene"}function ppe(t){return(t==null?void 0:t.type)==="voxel"}function fpe(t){return(t==null?void 0:t.type)==="imagery-tile"}function SMe(t){return t!=null&&t.parent!=null&&"declaredClass"in t.parent&&t.parent.declaredClass==="esri.Basemap"&&t.parent.baseLayers.includes(t)}function gB(t){var e;return(t==null?void 0:t.type)==="feature"&&!t.url&&((e=t.source)==null?void 0:e.type)==="memory"}function mpe(t){var e;return(t==null?void 0:t.type)==="feature"&&((e=t.source)==null?void 0:e.type)==="feature-layer"}function VQe(t){if(t.activeLayer){const e=t.activeLayer.tileMatrixSet;if(e)return e;const i=t.activeLayer.tileMatrixSets;if(i)return i}return null}async function EMe(t,e){const i=Ir==null?void 0:Ir.findServerInfo(t);if((i==null?void 0:i.currentVersion)!=null)return i.owningSystemUrl||null;const r=t.toLowerCase().indexOf("/rest/services");if(r===-1)return null;const n=`${t.substring(0,r)}/rest/info`,s=v(e)?e.signal:null,{data:o}=await ir(n,{query:{f:"json"},responseType:"json",signal:s});return(o==null?void 0:o.owningSystemUrl)||null}function zQe(t){if(!("capabilities"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function CMe(t){return zQe(t)?"effectiveCapabilities"in t?t.effectiveCapabilities:t.capabilities:null}function BQe(t){if(!("editingEnabled"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":return!0;default:return!1}}function jQe(t){return!!BQe(t)&&("effectiveEditingEnabled"in t?t.effectiveEditingEnabled:t.editingEnabled)}const GQe="esri.widgets.Feature.support.featureUtils",gpe=re.getLogger(GQe),HQe=/href=(""|'')/gi,qQe=/(\{([^\{\r\n]+)\})/g,WQe=/\'/g,AMe=/^\s*expression\//i,XQe=/(\n)/gi,YQe=/[\u00A0-\u9999<>\&]/gim,ZQe=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,JQe=/^(?:mailto:|tel:)/,RMe="relationships/",EJ=F9("short-date-short-time");function MMe(t){if(!R(t))return t.get("sourceLayer")||t.get("layer")}async function MV(t,e){return typeof t=="function"?t.call(null,e):t}function OMe(t=""){if(t)return!JQe.test(t.trim().toLowerCase())}function Ose(t){return!!t&&AMe.test(t)}function KQe(t,e){if(!Ose(e)||!t)return null;const i=e.replace(AMe,"").toLowerCase();let r=null;return t.some(n=>n.name.toLowerCase()===i&&(r=n,!0)),r}function PMe(t,e){const i=KQe(e,t==null?void 0:t.fieldName);return i?i.title||null:t?t.label||t.fieldName:null}function QQe(t,e){const i=e.get(t.toLowerCase());return`{${i&&i.fieldName||t}}`}function eet(t){return t.replace(HQe,"")}function nD(t,e){const i=Pse(e,t);return i?i.name:t}function tet(t,e){return t&&t.map(i=>nD(i,e))}function Pse(t,e){return t&&typeof t.getField=="function"&&e?t.getField(e)??null:null}function IMe(t){return`${t}`.trim()}function vS({attributes:t,globalAttributes:e,layer:i,text:r,expressionAttributes:n,fieldInfoMap:s}){return r?CJ({formattedAttributes:e,template:set(r,{...e,...n,...t},i),fieldInfoMap:s}):""}function CJ({formattedAttributes:t,template:e,fieldInfoMap:i}){return IMe(eet(ay(ay(e,r=>QQe(r,i)),t)))}function iet(t,e,i=!1){const r=e[t];if(typeof r=="string"){const n="%27",s=(i?encodeURIComponent(r):r).replace(WQe,n);e[t]=s}}function ret(t,e=!1){const i={...t};return Object.keys(i).forEach(r=>iet(r,i,e)),i}function net(t,e,i){const r=(e=IMe(e))&&e[0]!=="{";return ay(t,ret(i,r||!1))}function AJ(t,e){return t.replace(qQe,(i,r,n)=>{const s=Pse(e,n);return s?`{${s.name}}`:r})}function set(t,e,i){const r=AJ(t,i);return r&&r.replace(ZQe,(n,s,o)=>net(n,s||o,e))}function oet(t,e){if(typeof t=="string"&&e&&e.dateFormat==null&&(e.places!=null||e.digitSeparator!=null)){const i=Number(t);if(!isNaN(i))return i}return t}function aet(t){return(t==null?void 0:t.type)==="feature"}function ype(t){return!!(t!=null&&t.layer)}function cet(t){return(t==null?void 0:t.type)==="map-image"}function uet(t,e){var c;const i=e.fieldInfos,r=e.fieldName,n=(c=$Me(i,r))==null?void 0:c.clone(),s=e.preventPlacesFormatting,o=e.layer,a=Pse(o,r);if(n&&(a==null?void 0:a.type)==="date"){const h=n.format||new JA;h.dateFormat=h.dateFormat||"short-date-short-time",h.dateTimeFormatOptions=!ype(o)&&aet(o)&&o.datesInUnknownTimezone||ype(o)&&cet(o.layer)&&o.layer.datesInUnknownTimezone?{timeZone:"UTC"}:null,n.format=h}const l=n&&n.format;return typeof t=="string"&&OEe(r)&&l?l.formatRasterPixelValue(t):typeof(t=oet(t,l))=="string"||t==null||l==null?MN(t):s?hy(t,{...NEe(l),minimumFractionDigits:0,maximumFractionDigits:20}):l.format(t)}function $Me(t,e){if(!t||!t.length||!e)return;const i=e.toLowerCase();let r;return t.some(n=>!(!n.fieldName||n.fieldName.toLowerCase()!==i)&&(r=n,!0)),r}function het({fieldName:t,graphic:e,layer:i}){if(Y0(t)||!i||typeof i.getFeatureType!="function")return null;const{typeIdField:r}=i;if(!r||t!==r)return null;const n=i.getFeatureType(e);return n?n.name:null}function det({fieldName:t,value:e,graphic:i,layer:r}){if(Y0(t)||!r||typeof r.getFieldDomain!="function")return null;const n=i&&r.getFieldDomain(t,{feature:i});return n&&n.type==="coded-value"?n.getName(e):null}function pet(t,e){const{creatorField:i,creationDateField:r,editorField:n,editDateField:s}=t;if(!e)return;const o=e[s];if(typeof o=="number"){const l=e[n];return{type:"edit",date:uy(o,EJ),user:l}}const a=e[r];if(typeof a=="number"){const l=e[i];return{type:"create",date:uy(a,EJ),user:l}}return null}function fet(t,e){const i=new Map;return t&&t.forEach(r=>{const n=nD(r.fieldName,e);r.fieldName=n,i.set(n.toLowerCase(),r)}),i}function _pe(t){const e=[];if(!t)return e;const{fieldInfos:i,content:r}=t;return i&&e.push(...i),r&&Array.isArray(r)&&r.forEach(n=>{if(n.type==="fields"){const s=n&&n.fieldInfos;s&&e.push(...s)}}),e}function Ise(t){return t.replace(YQe,e=>`&#${e.charCodeAt(0)};`)}function MN(t){return typeof t=="string"?t.replace(XQe,'<br class="esri-text-new-line" />'):t}function LMe(t){const{value:e,fieldName:i,fieldInfos:r,fieldInfoMap:n,layer:s,graphic:o}=t;if(e==null)return"";const a=det({fieldName:i,value:e,graphic:o,layer:s});if(a)return a;const l=het({fieldName:i,graphic:o,layer:s});if(l)return l;if(n.get(i.toLowerCase()))return uet(e,{fieldInfos:r||Array.from(n.values()),fieldName:i,layer:s});const c=s&&s.fieldsIndex;return c&&c.isDateField(i)?uy(e,EJ):MN(e)}function lG({fieldInfos:t,attributes:e,layer:i,graphic:r,fieldInfoMap:n,relatedInfos:s}){const o={};return s==null||s.forEach(a=>_et({attributes:o,relatedInfo:a,fieldInfoMap:n,fieldInfos:t,layer:i})),e&&Object.keys(e).forEach(a=>{const l=e[a];o[a]=LMe({fieldName:a,fieldInfos:t,fieldInfoMap:n,layer:i,value:l,graphic:r})}),o}async function DMe(t,e){var h,p;const{layer:i,graphic:r,outFields:n,objectIds:s,returnGeometry:o,spatialReference:a}=t,l=s[0];if(typeof l!="number"&&typeof l!="string"){const f="Could not query required fields for the specified feature. The feature's ID is invalid.",m={layer:i,graphic:r,objectId:l,requiredFields:n};return gpe.warn(f,m),null}if(!((p=(h=CMe(i))==null?void 0:h.operations)!=null&&p.supportsQuery)){const f="The specified layer cannot be queried. The following fields will not be available.",m={layer:i,graphic:r,requiredFields:n,returnGeometry:o};return gpe.warn(f,m),null}const c=i.createQuery();return c.objectIds=s,c.outFields=n!=null&&n.length?n:[i.objectIdField],c.returnGeometry=!!o,c.returnZ=!!o,c.returnM=!!o,c.outSpatialReference=a,(await i.queryFeatures(c,e)).features[0]}async function met(t){var r;if(!((r=t.expressionInfos)!=null&&r.length))return!1;const e=await cy(),{arcadeUtils:{hasGeometryFunctions:i}}=e;return i(t)}async function get({graphic:t,popupTemplate:e,layer:i,spatialReference:r},n){if(!i||!e||(typeof i.load=="function"&&await i.load(n),!t.attributes))return;const s=t.attributes[i.objectIdField];if(s==null)return;const o=[s],a=await e.getRequiredFields(i.fieldsIndex),l=jHe(a,t),c=l?[]:a,h=e.returnGeometry||await met(e);if(l&&!h)return;const p=await DMe({layer:i,graphic:t,outFields:c,objectIds:o,returnGeometry:h,spatialReference:r},n);p&&(p.geometry&&(t.geometry=p.geometry),p.attributes&&(t.attributes={...t.attributes,...p.attributes}))}function Y0(t=""){return!!t&&t.includes(RMe)}function yet(t){return t?`${RMe}${t.layerId}/${t.fieldName}`:""}function vpe({attributes:t,graphic:e,relatedInfo:i,fieldInfos:r,fieldInfoMap:n,layer:s}){t&&e&&i&&Object.keys(e.attributes).forEach(o=>{const a=yet({layerId:i.relation.id.toString(),fieldName:o}),l=e.attributes[o];t[a]=LMe({fieldName:a,fieldInfos:r,fieldInfoMap:n,layer:s,value:l,graphic:e})})}function _et({attributes:t,relatedInfo:e,fieldInfoMap:i,fieldInfos:r,layer:n}){t&&e&&(e.relatedFeatures&&e.relatedFeatures&&e.relatedFeatures.forEach(s=>vpe({attributes:t,graphic:s,relatedInfo:e,fieldInfoMap:i,fieldInfos:r,layer:n})),e.relatedStatsFeatures&&e.relatedStatsFeatures&&e.relatedStatsFeatures.forEach(s=>vpe({attributes:t,graphic:s,relatedInfo:e,fieldInfoMap:i,fieldInfos:r,layer:n})))}const bpe=t=>{if(!t)return!1;const e=t.toUpperCase();return e.includes("CURRENT_TIMESTAMP")||e.includes("CURRENT_DATE")||e.includes("CURRENT_TIME")},NMe=({layer:t,method:e,query:i,definitionExpression:r})=>{var o,a;if(!((a=(o=t.capabilities)==null?void 0:o.query)!=null&&a.supportsCacheHint)||e==="attachments")return;const n=v(i.where)?i.where:null,s=v(i.geometry)?i.geometry:null;bpe(r)||bpe(n)||(s==null?void 0:s.type)==="extent"||i.resultType==="tile"||(i.cacheHint=!0)},vet=({query:t,layer:e,method:i})=>{NMe({layer:e,method:i,query:t,definitionExpression:`${e.definitionExpression} ${e.serviceDefinitionExpression}`})},bet=({queryPayload:t,layer:e,method:i})=>{NMe({layer:e,method:i,query:t,definitionExpression:`${e.definitionExpression} ${e.serviceDefinitionExpression}`})};function wet(t,e,i){return t&&e&&i?wpe(t.allLayers,e,i)||wpe(t.allTables,e,i):null}function wpe(t,e,i){return t.find(r=>r!==e&&r.type==="feature"&&r.url===e.url&&r.layerId===i.relatedTableId)}const xpe={editing:!1,operations:{add:!0,update:!0,delete:!0}},FMe=tt.ofType(UQe);let fu=class extends ve{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.abilities={...xpe},this.activeAttachmentInfo=null,this.activeFileInfo=null,this.attachmentInfos=new FMe,this.fileInfos=new tt,this.graphic=null,this.mode="view",this.filesEnabled=!1,this.addHandles(ne(()=>this.graphic,()=>this._graphicChanged(),zt))}destroy(){this._attachmentLayer=null,this.graphic=null}castAbilities(e){return{...xpe,...e}}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){const{graphic:e}=this;if(!e)return!1;const i=e.layer||e.sourceLayer;return(i==null?void 0:i.loaded)&&"capabilities"in i&&i.capabilities&&"operations"in i.capabilities&&"supportsResizeAttachments"in i.capabilities.operations&&i.capabilities.operations.supportsResizeAttachments||!1}async getAttachments(){const{_attachmentLayer:e,attachmentInfos:i}=this;if(!e||typeof e.queryAttachments!="function")throw new H("invalid-layer","getAttachments(): A valid layer is required.");const r=this._getObjectId(),n=new SJ({objectIds:[r],returnMetadata:!0}),s=[],o=e.queryAttachments(n).then(l=>l[r]||s).catch(()=>s);this._getAttachmentsPromise=o,this.notifyChange("state");const a=await o;return i.removeAll(),a.length&&i.addMany(a),this._getAttachmentsPromise=null,this.notifyChange("state"),a}async addAttachment(e,i=this.graphic){var l;const{_attachmentLayer:r,attachmentInfos:n,abilities:s}=this;if(!i)throw new H("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:i});if(!e)throw new H("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!((l=s.operations)!=null&&l.add))throw new H("invalid-abilities","addAttachment(): add abilities are required.");if(!r||typeof r.addAttachment!="function")throw new H("invalid-layer","addAttachment(): A valid layer is required.");const o=r.addAttachment(i,e).then(c=>this._queryAttachment(c.objectId,i)),a=await o;return n.add(a),a}async deleteAttachment(e){var l;const{_attachmentLayer:i,attachmentInfos:r,graphic:n,abilities:s}=this;if(!e)throw new H("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!((l=s.operations)!=null&&l.delete))throw new H("invalid-abilities","deleteAttachment(): delete abilities are required.");if(!i||typeof i.deleteAttachments!="function")throw new H("invalid-layer","deleteAttachment(): A valid layer is required.");if(!n)throw new H("invalid-graphic","deleteAttachment(): A graphic is required.");const o=i.deleteAttachments(n,[e.id]).then(()=>e),a=await o;return r.remove(a),a}async updateAttachment(e,i=this.activeAttachmentInfo){var h;const{_attachmentLayer:r,attachmentInfos:n,graphic:s,abilities:o}=this;if(!e)throw new H("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!i)throw new H("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:i});if(!((h=o.operations)!=null&&h.update))throw new H("invalid-abilities","updateAttachment(): Update abilities are required.");const a=n.findIndex(p=>p===i);if(!r||typeof r.updateAttachment!="function")throw new H("invalid-layer","updateAttachment(): A valid layer is required.");if(!s)throw new H("invalid-graphic","updateAttachment(): A graphic is required.");const l=r.updateAttachment(s,i.id,e).then(p=>this._queryAttachment(p.objectId)),c=await l;return n.splice(a,1,c),c}async commitFiles(){return await Promise.all(this.fileInfos.items.map(e=>this.addAttachment(e.form))),this.fileInfos.removeAll(),this.getAttachments()}addFile(e,i){if(!e||!i)return null;const r={file:e,form:i};return this.fileInfos.add(r),r}updateFile(e,i,r=this.activeFileInfo){if(!e||!i||!r)return null;const n=this.fileInfos.findIndex(s=>r===s);return n>-1&&this.fileInfos.splice(n,1,{file:e,form:i}),this.fileInfos.items[n]}deleteFile(e){const i=this.fileInfos.find(r=>r.file===e);return i?(this.fileInfos.remove(i),i):null}async _queryAttachment(e,i){const{_attachmentLayer:r}=this;if(!e||!(r!=null&&r.queryAttachments))throw new H("invalid-attachment-id","Could not query attachment.");const n=this._getObjectId(i),s=new SJ({objectIds:[n],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return r.queryAttachments(s).then(o=>o[n][0])}_getObjectId(e=this.graphic){return(e==null?void 0:e.getObjectId())??null}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))}_setAttachmentLayer(){const{graphic:e}=this,i=MMe(e);this._attachmentLayer=i?i.type==="scene"&&v(i.associatedLayer)?i.associatedLayer:i:null}};u([d()],fu.prototype,"abilities",void 0),u([ri("abilities")],fu.prototype,"castAbilities",null),u([d()],fu.prototype,"activeAttachmentInfo",void 0),u([d()],fu.prototype,"activeFileInfo",void 0),u([d({readOnly:!0,type:FMe})],fu.prototype,"attachmentInfos",void 0),u([d()],fu.prototype,"fileInfos",void 0),u([d({type:Ha})],fu.prototype,"graphic",void 0),u([d()],fu.prototype,"mode",void 0),u([d({readOnly:!0})],fu.prototype,"state",null),u([d()],fu.prototype,"filesEnabled",void 0),u([d({readOnly:!0})],fu.prototype,"supportsResizeAttachments",null),fu=u([$("esri.widgets.Attachments.AttachmentsViewModel")],fu);const $se=fu;function Tpe(t){const e=t.toLowerCase();return e==="image/bmp"||e==="image/emf"||e==="image/exif"||e==="image/gif"||e==="image/x-icon"||e==="image/jpeg"||e==="image/png"||e==="image/tiff"||e==="image/x-wmf"}function xet(t){const e=ar("esri/themes/base/images/files/");return t?t==="text/plain"?`${e}text-32.svg`:t==="application/pdf"?`${e}pdf-32.svg`:t==="text/csv"?`${e}csv-32.svg`:t==="application/gpx+xml"?`${e}gpx-32.svg`:t==="application/x-dwf"?`${e}cad-32.svg`:t==="application/postscript"||t==="application/json"||t==="text/xml"||t==="model/vrml"?`${e}code-32.svg`:t==="application/x-zip-compressed"||t==="application/x-7z-compressed"||t==="application/x-gzip"||t==="application/x-tar"||t==="application/x-gtar"||t==="application/x-bzip2"||t==="application/gzip"||t==="application/x-compress"||t==="application/x-apple-diskimage"||t==="application/x-rar-compressed"||t==="application/zip"?`${e}zip-32.svg`:t.includes("image/")?`${e}image-32.svg`:t.includes("audio/")?`${e}sound-32.svg`:t.includes("video/")?`${e}video-32.svg`:t.includes("msexcel")||t.includes("ms-excel")||t.includes("spreadsheetml")?`${e}excel-32.svg`:t.includes("msword")||t.includes("ms-word")||t.includes("wordprocessingml")?`${e}word-32.svg`:t.includes("powerpoint")||t.includes("presentationml")?`${e}report-32.svg`:`${e}generic-32.svg`:`${e}generic-32.svg`}function Go(t){return(e,i)=>{e.hasOwnProperty("_messageBundleProps")||(e._messageBundleProps=e._messageBundleProps?e._messageBundleProps.slice():[]),e._messageBundleProps.push({bundlePath:t,propertyName:i})}}var Tet=function(t){return{vnodeSelector:"",properties:void 0,children:void 0,text:t.toString(),domNode:null}},kMe=function(t,e){for(var i=0,r=t.length;i<r;i++){var n=t[i];Array.isArray(n)?kMe(n,e):n!=null&&n!==!1&&(n.hasOwnProperty("vnodeSelector")||(n=Tet(n)),e.push(n))}},Eet=function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(i.length===1&&typeof i[0]=="string")return{vnodeSelector:t,properties:e||void 0,children:void 0,text:i[0],domNode:null};var n=[];return kMe(i,n),{vnodeSelector:t,properties:e||void 0,children:n,text:void 0,domNode:null}};function te(t,e,...i){return typeof t!="function"||Mse(t)?Eet(t,e,...i):t(e,...i)}const Spe={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},gr="esri-attachments",Xw="esri-button",Ze={base:gr,loaderContainer:`${gr}__loader-container`,loader:`${gr}__loader`,fadeIn:`${gr}--fade-in`,container:`${gr}__container`,containerList:`${gr}__container--list`,containerPreview:`${gr}__container--preview`,actions:`${gr}__actions`,deleteButton:`${gr}__delete-button`,addAttachmentButton:`${gr}__add-attachment-button`,errorMessage:`${gr}__error-message`,items:`${gr}__items`,item:`${gr}__item`,itemButton:`${gr}__item-button`,itemMask:`${gr}__item-mask`,itemMaskIcon:`${gr}__item-mask--icon`,itemImage:`${gr}__image`,itemImageResizable:`${gr}__image--resizable`,itemLabel:`${gr}__label`,itemFilename:`${gr}__filename`,itemChevronIcon:`${gr}__item-chevron-icon`,itemLink:`${gr}__item-link`,itemLinkOverlay:`${gr}__item-link-overlay`,itemLinkOverlayIcon:`${gr}__item-link-overlay-icon`,itemEditIcon:`${gr}__item-edit-icon`,itemAddIcon:`${gr}__item-add-icon`,itemAddButton:`${gr}__item-add-button`,formNode:`${gr}__form-node`,fileFieldset:`${gr}__file-fieldset`,fileLabel:`${gr}__file-label`,fileName:`${gr}__file-name`,fileInput:`${gr}__file-input`,metadata:`${gr}__metadata`,metadataFieldset:`${gr}__metadata-fieldset`,progressBar:`${gr}__progress-bar`,esriWidget:"esri-widget",esriButton:Xw,buttonDisabled:`${Xw}--disabled`,esriButtonSecondary:`${Xw}--secondary`,esriButtonTertiary:`${Xw}--tertiary`,esriButtonThird:`${Xw}--third`,esriButtonSmall:`${Xw}--small`,esriButtonHalf:`${Xw}--half`,empty:"esri-widget__content--empty",iconExternalLink:"esri-icon-link-external",iconEdit:"esri-icon-edit",iconRight:"esri-icon-right",iconLeft:"esri-icon-left",iconPlus:"esri-icon-plus"},cG=window.CSS;let $l=class extends Sa{constructor(e,i){super(e,i),this.displayType="auto",this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=null,this.visibleElements={...Spe},this._supportsImageOrientation=cG&&cG.supports&&cG.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}initialize(){this.viewModel||(this.viewModel=new $se),this.addHandles([Kn(()=>{var e;return(e=this.viewModel)==null?void 0:e.attachmentInfos},"change",()=>this.scheduleRender()),Kn(()=>{var e;return(e=this.viewModel)==null?void 0:e.fileInfos},"change",()=>this.scheduleRender()),ne(()=>{var e;return(e=this.viewModel)==null?void 0:e.mode},()=>this._modeChanged(),zt)])}loadDependencies(){return Promise.all([Q(()=>import("./calcite-icon-02de242a.js"),[])])}get abilities(){return this.viewModel.abilities}set abilities(e){this.viewModel.abilities=e}get effectiveDisplayType(){const{displayType:e}=this;return e&&e!=="auto"?e:this.viewModel.supportsResizeAttachments?"preview":"list"}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}castVisibleElements(e){return{...Spe,...e}}addAttachment(){const{_addAttachmentForm:e,viewModel:i}=this;return this._set("submitting",!0),this._set("error",null),i.addAttachment(e).then(r=>(this._set("submitting",!1),this._set("error",null),i.mode="view",r)).catch(r=>{throw this._set("submitting",!1),this._set("error",new H("attachments:add-attachment",this.messages.addErrorMessage,r)),r})}deleteAttachment(e){const{viewModel:i}=this;return this._set("submitting",!0),this._set("error",null),i.deleteAttachment(e).then(r=>(this._set("submitting",!1),this._set("error",null),i.mode="view",r)).catch(r=>{throw this._set("submitting",!1),this._set("error",new H("attachments:delete-attachment",this.messages.deleteErrorMessage,r)),r})}updateAttachment(){const{viewModel:e}=this,{_updateAttachmentForm:i}=this;return this._set("submitting",!0),this._set("error",null),e.updateAttachment(i).then(r=>(this._set("submitting",!1),this._set("error",null),e.mode="view",r)).catch(r=>{throw this._set("submitting",!1),this._set("error",new H("attachments:update-attachment",this.messages.updateErrorMessage,r)),r})}addFile(){const e=this.viewModel.addFile(this.selectedFile,this._addAttachmentForm);return this.viewModel.mode="view",e}updateFile(){const{viewModel:e}=this,i=e.updateFile(this.selectedFile,this._updateAttachmentForm,e.activeFileInfo);return e.mode="view",i}deleteFile(e){var r;const i=this.viewModel.deleteFile(e||((r=this.viewModel.activeFileInfo)==null?void 0:r.file));return this.viewModel.mode="view",i}render(){const{submitting:e,viewModel:i}=this,{state:r}=i;return te("div",{class:this.classes(Ze.base,Ze.esriWidget)},e?this.renderProgressBar():null,r==="loading"?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())}renderErrorMessage(){const{error:e,visibleElements:i}=this;return e&&i.errorMessage?te("div",{key:"error-message",class:Ze.errorMessage},e.message):null}renderAttachments(){const{activeFileInfo:e,mode:i,activeAttachmentInfo:r}=this.viewModel;return i==="add"?this.renderAddForm():i==="edit"?this.renderDetailsForm(r||e):this.renderAttachmentContainer()}renderLoading(){return te("div",{class:Ze.loaderContainer,key:"loader"},te("div",{class:Ze.loader}))}renderProgressBar(){return this.visibleElements.progressBar?te("div",{class:Ze.progressBar,key:"progress-bar"}):null}renderAddForm(){const{submitting:e,selectedFile:i}=this,r=e||!i,n=this.visibleElements.cancelAddButton?te("button",{type:"button",bind:this,disabled:e,onclick:this._cancelForm,class:this.classes(Ze.esriButton,Ze.esriButtonTertiary,Ze.esriButtonSmall,Ze.esriButtonHalf,e&&Ze.buttonDisabled)},this.messages.cancel):null,s=this.visibleElements.addSubmitButton?te("button",{type:"submit",disabled:r,class:this.classes(Ze.esriButton,Ze.esriButtonSecondary,Ze.esriButtonSmall,Ze.esriButtonHalf,{[Ze.buttonDisabled]:r})},this.messages.add):null,o=i?te("span",{key:"file-name",class:Ze.fileName},i.name):null,a=te("form",{bind:this,afterCreate:vV,afterRemoved:Gde,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},te("fieldset",{class:Ze.fileFieldset},o,te("label",{class:this.classes(Ze.fileLabel,Ze.esriButton,Ze.esriButtonSecondary)},i?this.messages.changeFile:this.messages.selectFile,te("input",{class:Ze.fileInput,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),s,n);return te("div",{key:"add-form-container",class:Ze.formNode},a)}renderDetailsForm(e){var E,C,A;const{visibleElements:i,viewModel:r,selectedFile:n,submitting:s}=this,{abilities:o}=r,a=s||!n;let l,c,h,p;n?(l=n.type,c=n.name,h=n.size):e&&"file"in e?(l=e.file.type,c=e.file.name,h=e.file.size):e&&"contentType"in e&&(l=e.contentType,c=e.name,h=e.size,p=e.url);const f=o.editing&&((E=o.operations)!=null&&E.delete)&&i.deleteButton?te("button",{key:"delete-button",type:"button",disabled:s,bind:this,onclick:I=>this._submitDeleteAttachment(I,e),class:this.classes(Ze.esriButton,Ze.esriButtonSmall,Ze.esriButtonTertiary,Ze.deleteButton,{[Ze.buttonDisabled]:s})},this.messages.delete):void 0,m=o.editing&&((C=o.operations)!=null&&C.update)&&i.updateButton?te("button",{disabled:a,key:"update-button",type:"submit",class:this.classes(Ze.esriButton,Ze.esriButtonSmall,Ze.esriButtonThird,{[Ze.buttonDisabled]:a})},this.messages.update):void 0,g=this.visibleElements.cancelUpdateButton?te("button",{disabled:s,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes(Ze.esriButton,Ze.esriButtonSmall,Ze.esriButtonTertiary,Ze.esriButtonThird,{[Ze.buttonDisabled]:s})},this.messages.cancel):void 0,_=o.editing&&((A=o.operations)!=null&&A.update)?te("fieldset",{key:"file",class:Ze.fileFieldset},te("span",{key:"file-name",class:Ze.fileName},c),te("label",{class:this.classes(Ze.fileLabel,Ze.esriButton,Ze.esriButtonSecondary)},this.messages.changeFile,te("input",{class:Ze.fileInput,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):void 0,b=te("fieldset",{key:"size",class:Ze.metadataFieldset},te("label",null,DQe(this.messagesUnits,h??0))),w=te("fieldset",{key:"content-type",class:Ze.metadataFieldset},te("label",null,l)),x=v(p)?te("a",{class:Ze.itemLink,href:p,rel:"noreferrer",target:"_blank"},this.renderImageMask(e,400),te("div",{class:Ze.itemLinkOverlay},te("span",{class:Ze.itemLinkOverlayIcon},te("calcite-icon",{icon:"launch"})))):this.renderImageMask(e,400),T=te("form",{bind:this,afterCreate:vV,afterRemoved:Gde,"data-node-ref":"_updateAttachmentForm",onsubmit:I=>this._submitUpdateAttachment(I,e)},te("div",{class:Ze.metadata},b,w),_,te("div",{class:Ze.actions},f,g,m));return te("div",{key:"edit-form-container",class:Ze.formNode},x,T)}renderImageMask(e,i){return e?"file"in e?this.renderGenericImageMask(e.file.name,e.file.type):this.renderImageMaskForAttachment(e,i):null}renderGenericImageMask(e,i){const{supportsResizeAttachments:r}=this.viewModel,n=xet(i),s={[Ze.itemImageResizable]:r};return te("div",{class:this.classes(Ze.itemMaskIcon,Ze.itemMask)},te("img",{title:e,alt:e,src:n,class:this.classes(s,Ze.itemImage)}))}renderImageMaskForAttachment(e,i){const{supportsResizeAttachments:r}=this.viewModel;if(!e)return null;const{contentType:n,name:s,url:o}=e;if(!r||!Tpe(n))return this.renderGenericImageMask(s,n);const a=this._getCSSTransform(e),l=a?{transform:a,"image-orientation":"none"}:{},c=`${o}${o!=null&&o.includes("?")?"&":"?"}w=${i}`,h={[Ze.itemImageResizable]:r};return te("div",{class:this.classes(Ze.itemMask)},te("img",{styles:l,alt:s,title:s,src:c,class:this.classes(h,Ze.itemImage)}))}renderFile(e){const{file:i}=e;return te("li",{class:Ze.item,key:i},te("button",{key:"details-button",bind:this,class:Ze.itemButton,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,onclick:()=>this._startEditFile(e),type:"button"},this.renderImageMask(e),te("label",{class:Ze.itemLabel},te("span",{class:Ze.itemFilename},i.name||this.messages.noTitle),te("span",{"aria-hidden":"true",class:this.classes(Ze.itemChevronIcon,Bg(this.container)?Ze.iconLeft:Ze.iconRight)}))))}renderAttachmentInfo({attachmentInfo:e,displayType:i}){const{viewModel:r,effectiveDisplayType:n}=this,{abilities:s,supportsResizeAttachments:o}=r,{contentType:a,name:l,url:c}=e,h=this.renderImageMask(e,i==="list"?48:400),p=s.editing?te("span",{"aria-hidden":"true",class:this.classes(Ze.itemChevronIcon,Bg(this.container)?Ze.iconLeft:Ze.iconRight)}):null,f=[h,n==="preview"&&o&&Tpe(a)?null:te("label",{class:Ze.itemLabel},te("span",{class:Ze.itemFilename},l||this.messages.noTitle),p)],m=s.editing?te("button",{key:"details-button",bind:this,class:Ze.itemButton,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":e.id,onclick:()=>this._startEditAttachment(e),type:"button"},f):te("a",{key:"details-link",class:Ze.itemButton,href:c??void 0,target:"_blank"},f);return te("li",{class:Ze.item,key:e},m)}renderAttachmentContainer(){var g;const{effectiveDisplayType:e,viewModel:i,visibleElements:r}=this,{attachmentInfos:n,abilities:s,fileInfos:o}=i,a=!!(n!=null&&n.length),l=!!(o!=null&&o.length),c={[Ze.containerList]:e!=="preview",[Ze.containerPreview]:e==="preview"},h=s.editing&&((g=s.operations)!=null&&g.add)&&r.addButton?te("button",{bind:this,onclick:()=>this._startAddAttachment(),class:this.classes(Ze.esriButton,Ze.esriButtonTertiary,Ze.addAttachmentButton),type:"button"},te("span",{"aria-hidden":"true",class:this.classes(Ze.itemAddIcon,Ze.iconPlus)}),this.messages.add):void 0,p=a?te("ul",{key:"attachments-list",class:Ze.items},n.toArray().map(_=>this.renderAttachmentInfo({attachmentInfo:_,displayType:e}))):void 0,f=l?te("ul",{key:"file-list",class:Ze.items},o.toArray().map(_=>this.renderFile(_))):void 0,m=l||a?void 0:te("div",{class:Ze.empty},this.messages.noAttachments);return te("div",{key:"attachments-container",class:this.classes(Ze.container,c)},p,f,m,h)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(e){const i=e.target,r=i&&i.files&&i.files.item(0);this._set("selectedFile",r)}_submitDeleteAttachment(e,i){e.preventDefault(),i&&("file"in i?this.deleteFile(i.file):i&&this.deleteAttachment(i))}_submitAddAttachment(e){e.preventDefault(),this.viewModel.filesEnabled?this.addFile():this.addAttachment()}_submitUpdateAttachment(e,i){e.preventDefault(),i&&"file"in i?this.updateFile():this.updateAttachment()}_startEditAttachment(e){const{viewModel:i}=this;i.activeFileInfo=null,i.activeAttachmentInfo=e,i.mode="edit"}_startEditFile(e){const{viewModel:i}=this;i.activeAttachmentInfo=null,i.activeFileInfo=e,i.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(e){e.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(e){const{orientationInfo:i}=e;return!this._supportsImageOrientation&&i?[i.rotation?`rotate(${i.rotation}deg)`:"",i.mirrored?"scaleX(-1)":""].join(" "):""}};u([d()],$l.prototype,"abilities",null),u([d()],$l.prototype,"displayType",void 0),u([d({readOnly:!0})],$l.prototype,"effectiveDisplayType",null),u([d()],$l.prototype,"graphic",null),u([d()],$l.prototype,"label",null),u([d(),Go("esri/widgets/Attachments/t9n/Attachments")],$l.prototype,"messages",void 0),u([d(),Go("esri/core/t9n/Units")],$l.prototype,"messagesUnits",void 0),u([d({readOnly:!0})],$l.prototype,"selectedFile",void 0),u([d({readOnly:!0})],$l.prototype,"submitting",void 0),u([d({readOnly:!0})],$l.prototype,"error",void 0),u([d({type:$se})],$l.prototype,"viewModel",void 0),u([d()],$l.prototype,"visibleElements",void 0),u([ri("visibleElements")],$l.prototype,"castVisibleElements",null),$l=u([$("esri.widgets.Attachments")],$l);const Cet=$l;let WP=class extends $se{constructor(e){super(e),this.description=null,this.title=null}};u([d()],WP.prototype,"description",void 0),u([d()],WP.prototype,"title",void 0),WP=u([$("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],WP);const Lse=WP,Aet={heading:"esri-widget__heading"};function Dse({level:t,class:e,...i},r){const n=Ret(t);return te(`h${n}`,{...i,class:ARe(Aet.heading,e),role:"heading","aria-level":String(n)},r)}function Ret(t){return _e(Math.ceil(t),1,6)}const uG="esri-feature-element-info",hG={base:uG,title:`${uG}__title`,description:`${uG}__description`};let LC=class extends Sa{constructor(e,i){super(e,i),this.description=null,this.headingLevel=2,this.title=null}render(){return te("div",{class:hG.base},this.renderTitle(),this.renderDescription())}renderTitle(){const{title:e}=this;return e?te(Dse,{level:this.headingLevel,class:hG.title},e):null}renderDescription(){const{description:e}=this;return e?te("div",{key:"description",class:hG.description},e):null}};u([d()],LC.prototype,"description",void 0),u([d()],LC.prototype,"headingLevel",void 0),u([d()],LC.prototype,"title",void 0),LC=u([$("esri.widgets.Feature.support.FeatureElementInfo")],LC);const yB=LC,Met={base:"esri-feature-attachments"};let lg=class extends Sa{constructor(e,i){super(e,i),this._featureElementInfo=null,this.attachmentsWidget=new Cet,this.headingLevel=2,this.viewModel=new Lse}initialize(){this._featureElementInfo=new yB,this.addHandles([ne(()=>{var e,i;return[(e=this.viewModel)==null?void 0:e.description,(i=this.viewModel)==null?void 0:i.title,this.headingLevel]},()=>this._setupFeatureElementInfo(),zt),ne(()=>this.viewModel,e=>this.attachmentsWidget.viewModel=e,zt)])}destroy(){var e;this.attachmentsWidget.destroy(),(e=this._featureElementInfo)==null||e.destroy()}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get displayType(){return this.attachmentsWidget.displayType}set displayType(e){this.attachmentsWidget.displayType=e}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){var i;const{attachmentsWidget:e}=this;return te("div",{class:Met.base},(i=this._featureElementInfo)==null?void 0:i.render(),e==null?void 0:e.render())}_setupFeatureElementInfo(){var n;const{description:e,title:i,headingLevel:r}=this;(n=this._featureElementInfo)==null||n.set({description:e,title:i,headingLevel:r})}};u([d({readOnly:!0})],lg.prototype,"attachmentsWidget",void 0),u([d()],lg.prototype,"description",null),u([d()],lg.prototype,"displayType",null),u([d()],lg.prototype,"graphic",null),u([d()],lg.prototype,"headingLevel",void 0),u([d()],lg.prototype,"title",null),u([d({type:Lse})],lg.prototype,"viewModel",void 0),lg=u([$("esri.widgets.Feature.FeatureAttachments")],lg);const Oet=lg,Fw=t=>{let e=class extends t{destroy(){var i,r;this.destroyed||((i=this._get("handles"))==null||i.destroy(),(r=this._get("updatingHandles"))==null||r.destroy())}get handles(){return this._get("handles")||new Xi}get updatingHandles(){return this._get("updatingHandles")||new Jg}};return u([d({readOnly:!0})],e.prototype,"handles",null),u([d({readOnly:!0})],e.prototype,"updatingHandles",null),e=u([$("esri.core.HandleOwner")],e),e};let sD=class extends Fw(ve){};sD=u([$("esri.core.HandleOwner")],sD);let l1=class extends Fw(ve){constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.handles.add(ne(()=>this.creator,i=>{this._destroyContent(),this._createContent(i)},zt))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:e,graphic:i,destroyer:r}=this;e&&i&&(MV(r,{graphic:i}).catch(()=>null),this._set("created",null))}async _createContent(e){const i=this.graphic;if(!i||!e)return;const r=MV(e,{graphic:i}).catch(()=>null);this._loadingPromise=r,this.notifyChange("state");const n=await r;r===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",n))}};u([d({readOnly:!0})],l1.prototype,"created",void 0),u([d()],l1.prototype,"creator",void 0),u([d()],l1.prototype,"destroyer",void 0),u([d({type:Ha})],l1.prototype,"graphic",void 0),u([d({readOnly:!0})],l1.prototype,"state",null),l1=u([$("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],l1);const OV=l1;function Nh(){return function(t,e){if(!t[e])throw new TypeError(`Cannot auto bind undefined function '${e}'`);return{value:Iet(t[e])}}}function Pet(t){const e=t==null?void 0:t.type;return t instanceof KeyboardEvent||e==="keyup"||e==="keydown"||e==="keypress"}function Iet(t){return function(e,...i){Pet(e)?jJe(e.key)&&(e.preventDefault(),e.stopPropagation(),e.target.click()):t.call(this,e,...i)}}function $et(t){return e=>{e.hasOwnProperty("_delegatedEventNames")||(e._delegatedEventNames=e._delegatedEventNames?e._delegatedEventNames.slice():[]);const i=e._delegatedEventNames,r=Array.isArray(t)?t:Let(t);i.push(...r)}}function Let(t){return t.split(",").map(e=>e.trim())}const UMe="calcite-mode-";function Det(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-mode-name").replace(/\s|'|"/g,"")}function PV(){return Det().startsWith("dark")}function Net(){return`${UMe}${PV()?"dark":"light"}`}function Fet(t){ket(t),t.classList.add(Net())}function ket(t){Array.from(t.classList).forEach(e=>{e.startsWith(UMe)&&t.classList.remove(e)})}function IV(t){return t&&typeof t.render=="function"}function VMe(t){return t&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}const dG="esri-feature-content",pG={base:dG,loaderContainer:`${dG}__loader-container`,loader:`${dG}__loader`};let DC=class extends Sa{constructor(e,i){super(e,i),this.viewModel=null,this._addTargetToAnchors=r=>{Array.from(r.querySelectorAll("a")).forEach(n=>{OMe(n.href)&&!n.hasAttribute("target")&&n.setAttribute("target","_blank")})}}get creator(){var e;return(e=this.viewModel)==null?void 0:e.creator}set creator(e){this.viewModel&&(this.viewModel.creator=e)}get graphic(){var e;return(e=this.viewModel)==null?void 0:e.graphic}set graphic(e){this.viewModel&&(this.viewModel.graphic=e)}renderLoading(){return te("div",{class:pG.loaderContainer,key:"loader"},te("div",{class:pG.loader}))}renderCreated(){var i;const e=(i=this.viewModel)==null?void 0:i.created;return e?e instanceof HTMLElement?te("div",{key:e,bind:e,afterCreate:this._attachToNode}):IV(e)?te("div",{key:e},!e.destroyed&&e.render()):te("div",{key:e,innerHTML:e,afterCreate:this._addTargetToAnchors}):null}render(){var i;const e=(i=this.viewModel)==null?void 0:i.state;return te("div",{class:pG.base},e==="loading"?this.renderLoading():this.renderCreated())}_attachToNode(e){const i=this;e.appendChild(i)}};u([d()],DC.prototype,"creator",null),u([d()],DC.prototype,"graphic",null),u([d({type:OV})],DC.prototype,"viewModel",void 0),DC=u([$("esri.widgets.Feature.FeatureContent")],DC);const D6=DC;let l0=class extends ve{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:e,fieldInfos:i}=this,r=[];return i==null||i.forEach(n=>{if(!(!n.hasOwnProperty("visible")||n.visible))return;const s=n.clone();s.label=PMe(s,e),r.push(s)}),r}};u([d()],l0.prototype,"attributes",void 0),u([d({type:[GEe]})],l0.prototype,"expressionInfos",void 0),u([d()],l0.prototype,"description",void 0),u([d({type:[_N]})],l0.prototype,"fieldInfos",void 0),u([d({readOnly:!0})],l0.prototype,"formattedFieldInfos",null),u([d()],l0.prototype,"title",void 0),l0=u([$("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],l0);const _B=l0,Uet=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];function Vet(t){let e=null;return Uet.some(i=>(i.pattern.test(t)&&(e=i),!!e)),e}function zet(t,e){if(typeof e!="string"||!e)return e;const i=Vet(e);if(!i)return e;const r=e.match(i.pattern),n=r&&r[2],s=ay(ay(i.label,{messages:t,hierPart:n}),{appName:i.appName}),o=i.target?` target="${i.target}"`:"",a=i.target==="_blank"?' rel="noreferrer"':"";return e.replace(i.pattern,`<a${o} href="$1"${a}>${s}</a>`)}const e4="esri-feature-fields",_3={base:e4,fieldHeader:`${e4}__field-header`,fieldData:`${e4}__field-data`,fieldDataDate:`${e4}__field-data--date`,esriTable:"esri-widget__table"};let df=class extends Sa{constructor(e,i){super(e,i),this._featureElementInfo=null,this.viewModel=new _B,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new yB,this.addHandles(ne(()=>{var e,i;return[(e=this.viewModel)==null?void 0:e.description,(i=this.viewModel)==null?void 0:i.title]},()=>this._setupFeatureElementInfo(),zt))}destroy(){var e;(e=this._featureElementInfo)==null||e.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get expressionInfos(){return this.viewModel.expressionInfos}set expressionInfos(e){this.viewModel.expressionInfos=e}get fieldInfos(){return this.viewModel.fieldInfos}set fieldInfos(e){this.viewModel.fieldInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}renderFieldInfo(e,i){const{attributes:r}=this.viewModel,n=e.fieldName,s=e.label||n,o=r?r[n]==null?"":r[n]:"",a=!(!e.format||!e.format.dateFormat),l=typeof o=="number"&&!a?this._forceLTR(o):zet(this.messagesURIUtils,o),c={[_3.fieldDataDate]:a};return te("tr",{key:`fields-element-info-row-${n}-${i}`},te("th",{key:`fields-element-info-row-header-${n}-${i}`,class:_3.fieldHeader,innerHTML:s}),te("td",{key:`fields-element-info-row-data-${n}-${i}`,class:this.classes(_3.fieldData,c),innerHTML:l}))}renderFields(){const{formattedFieldInfos:e}=this.viewModel;return e!=null&&e.length?te("table",{class:_3.esriTable,summary:this.messages.fieldsSummary},te("tbody",null,e.map((i,r)=>this.renderFieldInfo(i,r)))):null}render(){var e;return te("div",{class:_3.base},(e=this._featureElementInfo)==null?void 0:e.render(),this.renderFields())}_setupFeatureElementInfo(){var r;const{description:e,title:i}=this;(r=this._featureElementInfo)==null||r.set({description:e,title:i})}_forceLTR(e){return`&lrm;${e}`}};u([d()],df.prototype,"attributes",null),u([d()],df.prototype,"description",null),u([d()],df.prototype,"expressionInfos",null),u([d()],df.prototype,"fieldInfos",null),u([d()],df.prototype,"title",null),u([d({type:_B,nonNullable:!0})],df.prototype,"viewModel",void 0),u([d(),Go("esri/widgets/Feature/t9n/Feature")],df.prototype,"messages",void 0),u([d(),Go("esri/widgets/support/t9n/uriUtils")],df.prototype,"messagesURIUtils",void 0),df=u([$("esri.widgets.Feature.FeatureFields")],df);const zMe=df,Bet={maximumFractionDigits:20};function jet(t){return hy(t,Bet)}var RJ;let iT=RJ=class extends fe{constructor(t){super(t),this.color=null,this.label=null,this.value=null}writeValue(t,e,i){e[i]=t??0}clone(){return new RJ({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};u([d({type:Xe,json:{type:[Kr],write:!0}})],iT.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],iT.prototype,"label",void 0),u([d({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],iT.prototype,"value",void 0),u([Ne("value")],iT.prototype,"writeValue",null),iT=RJ=u([$("esri.renderers.visualVariables.support.ColorStop")],iT);const Get=iT;function vB(t,e,i){return ma(t.map((r,n)=>e.apply(i,[r,n])))}async function Het(t,e,i){return(await ma(t.map((r,n)=>e.apply(i,[r,n])))).map(r=>r.value)}function Nse(t){return{ok:!0,value:t}}function Fse(t){return{ok:!1,error:t}}function qet(t){return v(t)&&t.ok===!0?t.value:null}function Wet(t){return v(t)&&t.ok===!1?t.error:null}async function _m(t){if(R(t))return{ok:!1,error:new Error("no promise provided")};try{return Nse(await t)}catch(e){return Fse(e)}}async function y9t(t){try{return Nse(await t)}catch(e){return Du(e),Fse(e)}}function _9t(t){if(t.ok===!0)return t.value;throw t.error}function ON(t,e){return new c1(t,e)}let c1=class extends ve{get value(){return qet(this._result)}get error(){return Wet(this._result)}get finished(){return v(this._result)}constructor(e,i){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=Mp(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:r}=this._abortController;this.promise=e(r),this.promise.then(n=>{this._result=Nse(n),this._cleanup()},n=>{this._result=Fse(n),this._cleanup()}),this._abortHandle=ja(i,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=Nr(this._abortHandle),this._abortController=null}};u([d()],c1.prototype,"value",null),u([d()],c1.prototype,"error",null),u([d()],c1.prototype,"finished",null),u([d()],c1.prototype,"promise",void 0),u([d()],c1.prototype,"_result",void 0),c1=u([$("esri.core.asyncUtils.ReactiveTask")],c1);function PN(){const t=new Float32Array(16);return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Xet(t){const e=new Float32Array(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Yet(t,e,i,r,n,s,o,a,l,c,h,p,f,m,g,_){const b=new Float32Array(16);return b[0]=t,b[1]=e,b[2]=i,b[3]=r,b[4]=n,b[5]=s,b[6]=o,b[7]=a,b[8]=l,b[9]=c,b[10]=h,b[11]=p,b[12]=f,b[13]=m,b[14]=g,b[15]=_,b}function Zet(t,e){return new Float32Array(t,e,16)}const Jet=PN();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:Jet,clone:Xet,create:PN,createView:Zet,fromValues:Yet},Symbol.toStringTag,{value:"Module"}));const Ket=(t,e)=>{const i=Sy(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1);return Ku(i,i)},Qet=(t,e)=>{const i=Sy(t,e,0,0,.5-.5*e,0,e,0,.5-.5*e,0,0,e,.5-.5*e,0,0,0,1);return Ku(i,i)},ett=(t,e)=>{const i=1-e,r=Sy(t,.2126+.7874*i,.7152-.7152*i,.0722-.0722*i,0,.2126-.2126*i,.7152+.2848*i,.0722-.0722*i,0,.2126-.2126*i,.7152-.7152*i,.0722+.9278*i,0,0,0,0,1);return Ku(r,r)},ttt=(t,e)=>{const i=Math.sin(e*Math.PI/180),r=Math.cos(e*Math.PI/180),n=Sy(t,.213+.787*r-.213*i,.715-.715*r-.715*i,.072-.072*r+.928*i,0,.213-.213*r+.143*i,.715+.285*r+.14*i,.072-.072*r-.283*i,0,.213-.213*r-.787*i,.715-.715*r+.715*i,.072+.928*r+.072*i,0,0,0,0,1);return Ku(n,n)},itt=(t,e)=>{const i=1-2*e,r=Sy(t,i,0,0,e,0,i,0,e,0,0,i,e,0,0,0,1);return Ku(r,r)},rtt=(t,e)=>{const i=Sy(t,.213+.787*e,.715-.715*e,.072-.072*e,0,.213-.213*e,.715+.285*e,.072-.072*e,0,.213-.213*e,.715-.715*e,.072+.928*e,0,0,0,0,1);return Ku(i,i)},ntt=(t,e)=>{const i=1-e,r=Sy(t,.393+.607*i,.769-.769*i,.189-.189*i,0,.349-.349*i,.686+.314*i,.168-.168*i,0,.272-.272*i,.534-.534*i,.131+.869*i,0,0,0,0,1);return Ku(r,r)};let BMe=class jMe{constructor(e,i,r){this.strength=e,this.radius=i,this.threshold=r,this.type="bloom"}interpolate(e,i,r){this.strength=Pu(e.strength,i.strength,r),this.radius=Pu(e.radius,i.radius,r),this.threshold=Pu(e.threshold,i.threshold,r)}clone(){return new jMe(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:P$(this.radius),strength:this.strength,threshold:this.threshold}}},GMe=class HMe{constructor(e){this.radius=e,this.type="blur"}interpolate(e,i,r){this.radius=Math.round(Pu(e.radius,i.radius,r))}clone(){return new HMe(this.radius)}toJSON(){return{type:"blur",radius:P$(this.radius)}}},MJ=class qMe{constructor(e,i){this.type=e,this.amount=i,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,i,r){this.amount=Pu(e.amount,i.amount,r),this._updateMatrix()}clone(){return new qMe(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const e=this._colorMatrix||PN();switch(this.type){case"brightness":this._colorMatrix=Ket(e,this.amount);break;case"contrast":this._colorMatrix=Qet(e,this.amount);break;case"grayscale":this._colorMatrix=ett(e,this.amount);break;case"invert":this._colorMatrix=itt(e,this.amount);break;case"saturate":this._colorMatrix=rtt(e,this.amount);break;case"sepia":this._colorMatrix=ntt(e,this.amount)}}},WMe=class XMe{constructor(e,i,r,n){this.offsetX=e,this.offsetY=i,this.blurRadius=r,this.color=n,this.type="drop-shadow"}interpolate(e,i,r){this.offsetX=Pu(e.offsetX,i.offsetX,r),this.offsetY=Pu(e.offsetY,i.offsetY,r),this.blurRadius=Pu(e.blurRadius,i.blurRadius,r),this.color[0]=Math.round(Pu(e.color[0],i.color[0],r)),this.color[1]=Math.round(Pu(e.color[1],i.color[1],r)),this.color[2]=Math.round(Pu(e.color[2],i.color[2],r)),this.color[3]=Pu(e.color[3],i.color[3],r)}clone(){return new XMe(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const e=[...this.color];return e[3]*=255,{type:"drop-shadow",xoffset:P$(this.offsetX),yoffset:P$(this.offsetY),blurRadius:P$(this.blurRadius),color:e}}},YMe=class ZMe{constructor(e){this.angle=e,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,i,r){this.angle=Pu(e.angle,i.angle,r),this._updateMatrix()}clone(){return new ZMe(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const e=this._colorMatrix||PN();this._colorMatrix=ttt(e,this.angle)}},JMe=class KMe{constructor(e){this.amount=e,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(e,i,r){this.amount=Pu(e.amount,i.amount,r)}clone(){return new KMe(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}};function Pu(t,e,i){return t+(e-t)*i}function P$(t){return Math.round(1e3*Ip(t))/1e3}function stt(t){switch(t.type){case"grayscale":case"sepia":case"invert":return new MJ(t.type,0);case"saturate":case"brightness":case"contrast":return new MJ(t.type,1);case"opacity":return new JMe(1);case"hue-rotate":return new YMe(0);case"blur":return new GMe(0);case"drop-shadow":return new WMe(0,0,0,[...Sne("transparent")]);case"bloom":return new BMe(0,0,1)}}function ott(t,e){const i=t.length>e.length?t:e;return(t.length>e.length?e:t).every((r,n)=>r.type===i[n].type)}function att(t,e){const i=t.length>e.length?t:e,r=t.length>e.length?e:t;for(let n=r.length;n<i.length;n++)r.push(stt(i[n]))}function ltt(t){const e=t[0];return!!e&&"type"in e}var Epe,Cpe,OJ={};function QMe(t){if(!t||t.length===0)return null;if(typeof t=="string"){const i=Ape(t);return i&&i.length!==0?i:null}const e=t.map(i=>{if(!Number.isFinite(i.scale)||i.scale<=0)throw new H("effect:invalid-scale","scale must be finite and greater than 0",{stop:i});return{scale:i.scale,effects:Ape(i.value)}});e.sort((i,r)=>r.effects.length-i.effects.length);for(let i=0;i<e.length-1;i++){if(!ott(e[i].effects,e[i+1].effects))throw new H("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:e[i].effects,b:e[i+1].effects});att(e[i].effects,e[i+1].effects)}return e.sort((i,r)=>r.scale-i.scale),e}function Ape(t){let e;if(!t)return[];try{e=OJ.parse(t)}catch(i){throw new H("effect:invalid-syntax","Invalid effect syntax",{value:t,error:i})}return e.map(i=>ctt(i))}function ctt(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return utt(t);case"opacity":return htt(t);case"hue-rotate":return dtt(t);case"blur":return ptt(t);case"drop-shadow":return ftt(t);case"bloom":return mtt(t)}}catch(e){throw e.details.filter=t,e}throw new H("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}function utt(t){let e=1;return EO(t.parameters,1),t.parameters.length===1&&(e=Uf(t.parameters[0])),new MJ(t.name,e)}function htt(t){let e=1;return EO(t.parameters,1),t.parameters.length===1&&(e=Uf(t.parameters[0])),new JMe(e)}function dtt(t){let e=0;return EO(t.parameters,1),t.parameters.length===1&&(e=wtt(t.parameters[0])),new YMe(e)}function ptt(t){let e=0;return EO(t.parameters,1),t.parameters.length===1&&(e=Vse(t.parameters[0]),IN(e,t.parameters[0])),new GMe(e)}function ftt(t){const e=[];let i=null;for(const r of t.parameters)if(r.type==="color"){if(e.length&&Object.freeze(e),i)throw new H("effect:type-error","Accepts only one color",{});i=xtt(r)}else{const n=Vse(r);if(Object.isFrozen(e))throw new H("effect:type-error","<length> parameters not consecutive",{lengths:e});e.push(n),e.length===3&&IN(n,r)}if(e.length<2||e.length>3)throw new H("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${e.length}}`,{lengths:e});return new WMe(e[0],e[1],e[2]||0,i||eOe("black"))}function mtt(t){let e=1,i=0,r=0;return EO(t.parameters,3),t.parameters[0]&&(e=Uf(t.parameters[0])),t.parameters[1]&&(i=Vse(t.parameters[1]),IN(i,t.parameters[1])),t.parameters[2]&&(r=Uf(t.parameters[2])),new BMe(e,i,r)}function EO(t,e){if(t.length>e)throw new H("effect:type-error",`Function supports up to ${e} parameters, Actual: ${t.length}`,{parameters:t})}function bB(t){if(t.type==="color")return"<color>";if(t.unit){if(Use[t.unit])return"<length>";if(kse[t.unit])return"<angle>";if(t.unit==="%")return"<percentage>"}return"<double>"}function IN(t,e){if(t<0)throw new H("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:e})}function gtt(t){if(t.type!=="quantity"||t.unit!==null)throw new H("effect:type-error",`Expected <double>, Actual: ${bB(t)}`,{term:t})}function ytt(t){if(t.type!=="quantity"||t.unit!==null&&t.unit!=="%")throw new H("effect:type-error",`Expected <double> or <percentage>, Actual: ${bB(t)}`,{term:t})}Cpe=function(){function t(n,s){function o(){this.constructor=n}o.prototype=s.prototype,n.prototype=new o}function e(n,s,o,a){var l=Error.call(this,n);return Object.setPrototypeOf&&Object.setPrototypeOf(l,e.prototype),l.expected=s,l.found=o,l.location=a,l.name="SyntaxError",l}function i(n,s,o){return o=o||" ",n.length>s?n:(s-=n.length,n+(o+=o.repeat(s)).slice(0,s))}function r(n,s){var o,a={},l=(s=s!==void 0?s:{}).grammarSource,c={start:Iy},h=Iy,p="none",f=")",m=",",g="(",_="%",b="px",w="cm",x="mm",T="in",E="pt",C="pc",A="deg",I="rad",O="grad",D="turn",U="#",V=".",B="e",ee=/^[ \t\n\r]/,ie=/^[a-z\-]/,J=/^[0-9a-fA-F]/,q=/^[+\-]/,N=/^[0-9]/,L=rc("none"),F=vn("none",!1),G=vn(")",!1),W=vn(",",!1),Z=rc("whitespace"),X=Hw([" ","	",`
`,"\r"],!1,!1),oe=rc("function"),pe=vn("(",!1),ye=rc("identifier"),Se=Hw([["a","z"],"-"],!1,!1),He=rc("percentage"),De=vn("%",!1),Te=rc("length"),ke=vn("px",!1),ze=vn("cm",!1),bt=vn("mm",!1),it=vn("in",!1),jt=vn("pt",!1),Qt=vn("pc",!1),oi=rc("angle"),ei=vn("deg",!1),wi=vn("rad",!1),or=vn("grad",!1),Ii=vn("turn",!1),Oi=rc("number"),at=rc("color"),et=vn("#",!1),pt=Hw([["0","9"],["a","f"],["A","F"]],!1,!1),gt=Hw(["+","-"],!1,!1),Rt=Hw([["0","9"]],!1,!1),Yt=vn(".",!1),Ni=vn("e",!1),Fi=function(){return[]},ki=function(Y,xe){return{type:"function",name:Y,parameters:xe||[]}},Ui=function(Y,xe){return xe.length>0?JO(Y,xe,3):[Y]},Fr=function(Y){return{type:"quantity",value:Y.value,unit:Y.unit}},hi=function(Y){return{type:"color",colorType:Y.type,value:Y.value}},Ai=function(Y){return Y},xi=function(){return tu()},kn=function(Y){return{value:Y,unit:"%"}},pr=function(Y){return{value:Y,unit:"px"}},ln=function(Y){return{value:Y,unit:"cm"}},kr=function(Y){return{value:Y,unit:"mm"}},Qr=function(Y){return{value:Y,unit:"in"}},Rn=function(Y){return{value:Y,unit:"pt"}},ts=function(Y){return{value:Y,unit:"pc"}},qo=function(Y){return{value:Y,unit:"deg"}},vo=function(Y){return{value:Y,unit:"rad"}},Un=function(Y){return{value:Y,unit:"grad"}},cn=function(Y){return{value:Y,unit:"turn"}},un=function(Y){return{value:Y,unit:null}},Vn=function(){return{type:"hex",value:tu()}},fr=function(Y){return{type:"function",value:Y}},Ea=function(){return{type:"named",value:tu()}},ic=function(){return parseFloat(tu())},de=0,Ar=0,Hp=[{line:1,column:1}],Xa=0,oh=[],yt=0;if("startRule"in s){if(!(s.startRule in c))throw new Error(`Can't start parsing from rule "`+s.startRule+'".');h=c[s.startRule]}function tu(){return n.substring(Ar,de)}function vn(Y,xe){return{type:"literal",text:Y,ignoreCase:xe}}function Hw(Y,xe,Me){return{type:"class",parts:Y,inverted:xe,ignoreCase:Me}}function K7(){return{type:"end"}}function rc(Y){return{type:"other",description:Y}}function rv(Y){var xe,Me=Hp[Y];if(Me)return Me;for(xe=Y-1;!Hp[xe];)xe--;for(Me={line:(Me=Hp[xe]).line,column:Me.column};xe<Y;)n.charCodeAt(xe)===10?(Me.line++,Me.column=1):Me.column++,xe++;return Hp[Y]=Me,Me}function Py(Y,xe){var Me=rv(Y),_i=rv(xe);return{source:l,start:{offset:Y,line:Me.line,column:Me.column},end:{offset:xe,line:_i.line,column:_i.column}}}function ai(Y){de<Xa||(de>Xa&&(Xa=de,oh=[]),oh.push(Y))}function hF(Y,xe,Me){return new e(e.buildMessage(Y,xe),Y,xe,Me)}function Iy(){var Y;return(Y=nv())===a&&(Y=sv()),Y}function nv(){var Y,xe;return yt++,Y=de,mr(),n.substr(de,4)===p?(xe=p,de+=4):(xe=a,yt===0&&ai(F)),xe!==a?(mr(),Ar=Y,Y=Fi()):(de=Y,Y=a),yt--,Y===a&&yt===0&&ai(L),Y}function sv(){var Y,xe;if(Y=[],(xe=Ca())!==a)for(;xe!==a;)Y.push(xe),xe=Ca();else Y=a;return Y}function Ca(){var Y,xe,Me,_i;return Y=de,mr(),(xe=Pm())!==a?(mr(),(Me=md())===a&&(Me=null),mr(),n.charCodeAt(de)===41?(_i=f,de++):(_i=a,yt===0&&ai(G)),_i!==a?(mr(),Ar=Y,Y=ki(xe,Me)):(de=Y,Y=a)):(de=Y,Y=a),Y}function md(){var Y,xe,Me,_i,bo,zn,sc,av;if(Y=de,(xe=gd())!==a){for(Me=[],_i=de,bo=mr(),n.charCodeAt(de)===44?(zn=m,de++):(zn=a,yt===0&&ai(W)),zn===a&&(zn=null),sc=mr(),(av=gd())!==a?_i=bo=[bo,zn,sc,av]:(de=_i,_i=a);_i!==a;)Me.push(_i),_i=de,bo=mr(),n.charCodeAt(de)===44?(zn=m,de++):(zn=a,yt===0&&ai(W)),zn===a&&(zn=null),sc=mr(),(av=gd())!==a?_i=bo=[bo,zn,sc,av]:(de=_i,_i=a);Ar=Y,Y=Ui(xe,Me)}else de=Y,Y=a;return Y}function gd(){var Y,xe;return Y=de,(xe=tE())===a&&(xe=qw())===a&&(xe=iE())===a&&(xe=Ww()),xe!==a&&(Ar=Y,xe=Fr(xe)),(Y=xe)===a&&(Y=de,(xe=ov())!==a&&(Ar=Y,xe=hi(xe)),Y=xe),Y}function mr(){var Y,xe;for(yt++,Y=[],ee.test(n.charAt(de))?(xe=n.charAt(de),de++):(xe=a,yt===0&&ai(X));xe!==a;)Y.push(xe),ee.test(n.charAt(de))?(xe=n.charAt(de),de++):(xe=a,yt===0&&ai(X));return yt--,xe=a,yt===0&&ai(Z),Y}function Pm(){var Y,xe,Me;return yt++,Y=de,(xe=$y())!==a?(n.charCodeAt(de)===40?(Me=g,de++):(Me=a,yt===0&&ai(pe)),Me!==a?(Ar=Y,Y=Ai(xe)):(de=Y,Y=a)):(de=Y,Y=a),yt--,Y===a&&(xe=a,yt===0&&ai(oe)),Y}function $y(){var Y,xe,Me;if(yt++,Y=de,xe=[],ie.test(n.charAt(de))?(Me=n.charAt(de),de++):(Me=a,yt===0&&ai(Se)),Me!==a)for(;Me!==a;)xe.push(Me),ie.test(n.charAt(de))?(Me=n.charAt(de),de++):(Me=a,yt===0&&ai(Se));else xe=a;return xe!==a&&(Ar=Y,xe=xi()),yt--,(Y=xe)===a&&(xe=a,yt===0&&ai(ye)),Y}function tE(){var Y,xe,Me;return yt++,Y=de,mr(),(xe=nc())!==a?(n.charCodeAt(de)===37?(Me=_,de++):(Me=a,yt===0&&ai(De)),Me!==a?(Ar=Y,Y=kn(xe)):(de=Y,Y=a)):(de=Y,Y=a),yt--,Y===a&&yt===0&&ai(He),Y}function qw(){var Y,xe,Me;return yt++,Y=de,mr(),(xe=nc())!==a?(n.substr(de,2)===b?(Me=b,de+=2):(Me=a,yt===0&&ai(ke)),Me!==a?(Ar=Y,Y=pr(xe)):(de=Y,Y=a)):(de=Y,Y=a),Y===a&&(Y=de,mr(),(xe=nc())!==a?(n.substr(de,2)===w?(Me=w,de+=2):(Me=a,yt===0&&ai(ze)),Me!==a?(Ar=Y,Y=ln(xe)):(de=Y,Y=a)):(de=Y,Y=a),Y===a&&(Y=de,mr(),(xe=nc())!==a?(n.substr(de,2)===x?(Me=x,de+=2):(Me=a,yt===0&&ai(bt)),Me!==a?(Ar=Y,Y=kr(xe)):(de=Y,Y=a)):(de=Y,Y=a),Y===a&&(Y=de,mr(),(xe=nc())!==a?(n.substr(de,2)===T?(Me=T,de+=2):(Me=a,yt===0&&ai(it)),Me!==a?(Ar=Y,Y=Qr(xe)):(de=Y,Y=a)):(de=Y,Y=a),Y===a&&(Y=de,mr(),(xe=nc())!==a?(n.substr(de,2)===E?(Me=E,de+=2):(Me=a,yt===0&&ai(jt)),Me!==a?(Ar=Y,Y=Rn(xe)):(de=Y,Y=a)):(de=Y,Y=a),Y===a&&(Y=de,mr(),(xe=nc())!==a?(n.substr(de,2)===C?(Me=C,de+=2):(Me=a,yt===0&&ai(Qt)),Me!==a?(Ar=Y,Y=ts(xe)):(de=Y,Y=a)):(de=Y,Y=a)))))),yt--,Y===a&&yt===0&&ai(Te),Y}function iE(){var Y,xe,Me;return yt++,Y=de,(xe=nc())!==a?(n.substr(de,3)===A?(Me=A,de+=3):(Me=a,yt===0&&ai(ei)),Me!==a?(Ar=Y,Y=qo(xe)):(de=Y,Y=a)):(de=Y,Y=a),Y===a&&(Y=de,(xe=nc())!==a?(n.substr(de,3)===I?(Me=I,de+=3):(Me=a,yt===0&&ai(wi)),Me!==a?(Ar=Y,Y=vo(xe)):(de=Y,Y=a)):(de=Y,Y=a),Y===a&&(Y=de,(xe=nc())!==a?(n.substr(de,4)===O?(Me=O,de+=4):(Me=a,yt===0&&ai(or)),Me!==a?(Ar=Y,Y=Un(xe)):(de=Y,Y=a)):(de=Y,Y=a),Y===a&&(Y=de,(xe=nc())!==a?(n.substr(de,4)===D?(Me=D,de+=4):(Me=a,yt===0&&ai(Ii)),Me!==a?(Ar=Y,Y=cn(xe)):(de=Y,Y=a)):(de=Y,Y=a)))),yt--,Y===a&&(xe=a,yt===0&&ai(oi)),Y}function Ww(){var Y,xe;return yt++,Y=de,mr(),(xe=nc())!==a?(Ar=Y,Y=un(xe)):(de=Y,Y=a),yt--,Y===a&&yt===0&&ai(Oi),Y}function ov(){var Y,xe,Me,_i;if(yt++,Y=de,n.charCodeAt(de)===35?(xe=U,de++):(xe=a,yt===0&&ai(et)),xe!==a){if(Me=[],J.test(n.charAt(de))?(_i=n.charAt(de),de++):(_i=a,yt===0&&ai(pt)),_i!==a)for(;_i!==a;)Me.push(_i),J.test(n.charAt(de))?(_i=n.charAt(de),de++):(_i=a,yt===0&&ai(pt));else Me=a;Me!==a?(Ar=Y,Y=Vn()):(de=Y,Y=a)}else de=Y,Y=a;return Y===a&&(Y=de,(xe=Ca())!==a&&(Ar=Y,xe=fr(xe)),(Y=xe)===a&&(Y=de,(xe=$y())!==a&&(Ar=Y,xe=Ea()),Y=xe)),yt--,Y===a&&(xe=a,yt===0&&ai(at)),Y}function nc(){var Y,xe,Me,_i,bo,zn,sc;for(Y=de,q.test(n.charAt(de))?(n.charAt(de),de++):yt===0&&ai(gt),xe=de,Me=[],N.test(n.charAt(de))?(_i=n.charAt(de),de++):(_i=a,yt===0&&ai(Rt));_i!==a;)Me.push(_i),N.test(n.charAt(de))?(_i=n.charAt(de),de++):(_i=a,yt===0&&ai(Rt));if(n.charCodeAt(de)===46?(_i=V,de++):(_i=a,yt===0&&ai(Yt)),_i!==a){if(bo=[],N.test(n.charAt(de))?(zn=n.charAt(de),de++):(zn=a,yt===0&&ai(Rt)),zn!==a)for(;zn!==a;)bo.push(zn),N.test(n.charAt(de))?(zn=n.charAt(de),de++):(zn=a,yt===0&&ai(Rt));else bo=a;bo!==a?xe=Me=[Me,_i,bo]:(de=xe,xe=a)}else de=xe,xe=a;if(xe===a)if(xe=[],N.test(n.charAt(de))?(Me=n.charAt(de),de++):(Me=a,yt===0&&ai(Rt)),Me!==a)for(;Me!==a;)xe.push(Me),N.test(n.charAt(de))?(Me=n.charAt(de),de++):(Me=a,yt===0&&ai(Rt));else xe=a;if(xe!==a){if(Me=de,n.charCodeAt(de)===101?(_i=B,de++):(_i=a,yt===0&&ai(Ni)),_i!==a){if(q.test(n.charAt(de))?(bo=n.charAt(de),de++):(bo=a,yt===0&&ai(gt)),bo===a&&(bo=null),zn=[],N.test(n.charAt(de))?(sc=n.charAt(de),de++):(sc=a,yt===0&&ai(Rt)),sc!==a)for(;sc!==a;)zn.push(sc),N.test(n.charAt(de))?(sc=n.charAt(de),de++):(sc=a,yt===0&&ai(Rt));else zn=a;zn!==a?Me=_i=[_i,bo,zn]:(de=Me,Me=a)}else de=Me,Me=a;Me===a&&(Me=null),Ar=Y,Y=ic()}else de=Y,Y=a;return Y}function dF(Y,xe){return Y.map(function(Me){return Me[xe]})}function JO(Y,xe,Me){return[Y].concat(dF(xe,Me))}if((o=h())!==a&&de===n.length)return o;throw o!==a&&de<n.length&&ai(K7()),hF(oh,Xa<n.length?n.charAt(Xa):null,Xa<n.length?Py(Xa,Xa+1):Py(Xa,Xa))}return t(e,Error),e.prototype.format=function(n){var s="Error: "+this.message;if(this.location){var o,a=null;for(o=0;o<n.length;o++)if(n[o].source===this.location.source){a=n[o].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,c=this.location.source+":"+l.line+":"+l.column;if(a){var h=this.location.end,p=i("",l.line.toString().length," "),f=a[l.line-1],m=(l.line===h.line?h.column:f.length+1)-l.column||1;s+=`
 --> `+c+`
`+p+` |
`+l.line+" | "+f+`
`+p+" | "+i("",l.column-1," ")+i("",m,"^")}else s+=`
 at `+c}return s},e.buildMessage=function(n,s){var o={literal:function(m){return'"'+l(m.text)+'"'},class:function(m){var g=m.parts.map(function(_){return Array.isArray(_)?c(_[0])+"-"+c(_[1]):c(_)});return"["+(m.inverted?"^":"")+g.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(m){return m.description}};function a(m){return m.charCodeAt(0).toString(16).toUpperCase()}function l(m){return m.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+a(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+a(g)})}function c(m){return m.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+a(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+a(g)})}function h(m){return o[m.type](m)}function p(m){var g,_,b=m.map(h);if(b.sort(),b.length>0){for(g=1,_=1;g<b.length;g++)b[g-1]!==b[g]&&(b[_]=b[g],_++);b.length=_}switch(b.length){case 1:return b[0];case 2:return b[0]+" or "+b[1];default:return b.slice(0,-1).join(", ")+", or "+b[b.length-1]}}function f(m){return m?'"'+l(m)+'"':"end of input"}return"Expected "+p(n)+" but "+f(s)+" found."},{SyntaxError:e,parse:r}},(Epe={get exports(){return OJ},set exports(t){OJ=t}}).exports&&(Epe.exports=Cpe());const kse={deg:1,grad:.9,rad:180/Math.PI,turn:360};function _tt(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&kse[t.unit]!=null))throw new H("effect:type-error",`Expected <angle>, Actual: ${bB(t)}`,{term:t})}const Use={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function vtt(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&Use[t.unit]!=null))throw new H("effect:type-error",`Expected <length>, Actual: ${bB(t)}`,{term:t})}function Uf(t){ytt(t);const e=t.value;return IN(e,t),t.unit==="%"?.01*e:e}function btt(t){return gtt(t),IN(t.value,t),t.value}function wtt(t){return _tt(t),t.value*kse[t.unit]||0}function Vse(t){return vtt(t),t.value*Use[t.unit]||0}function xtt(t){switch(t.colorType){case"hex":return cqe(t.value);case"named":return eOe(t.value);case"function":return Ett(t.value)}}function eOe(t){if(!WEe(t))throw new H("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return lqe(t)}const Ttt=/^rgba?/i,Stt=/^hsla?/i;function Ett(t){if(EO(t.parameters,4),Ttt.test(t.name))return[Uf(t.parameters[0]),Uf(t.parameters[1]),Uf(t.parameters[2]),t.parameters[3]?Uf(t.parameters[3]):1];if(Stt.test(t.name))return XEe(btt(t.parameters[0]),Uf(t.parameters[1]),Uf(t.parameters[2]),t.parameters[3]?Uf(t.parameters[3]):1);throw new H("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}function zse(t,e,i){var r;try{return Att(t)}catch(n){(r=i==null?void 0:i.messages)==null||r.push(n)}return null}function Bse(t,e,i,r){try{const n=Ctt(t);va(i,n,e)}catch(n){r.messages&&r.messages.push(n)}}function Ctt(t){const e=QMe(t);return e?ltt(e)?e.map(i=>i.toJSON()):e.map(({scale:i,effects:r})=>({scale:i,value:r.map(n=>n.toJSON())})):null}function Att(t){if(!t||t.length===0)return null;if(Rtt(t)){const e=[];for(const i of t)e.push({scale:i.scale,value:Rpe(i.value)});return e}return Rpe(t)}function Rtt(t){const e=t[0];return!!e&&"scale"in e}function Rpe(t){if(!t||!t.length)return"";const e=[];for(const i of t){let r=[];switch(i.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":r=[Dy(i,"amount")];break;case"blur":r=[Dy(i,"radius","pt")];break;case"hue-rotate":r=[Dy(i,"angle","deg")];break;case"drop-shadow":r=[Dy(i,"xoffset","pt"),Dy(i,"yoffset","pt"),Dy(i,"blurRadius","pt"),Mtt(i,"color")];break;case"bloom":r=[Dy(i,"strength"),Dy(i,"radius","pt"),Dy(i,"threshold")]}const n=`${i.type}(${r.filter(Boolean).join(" ")})`;QMe(n),e.push(n)}return e.join(" ")}function Dy(t,e,i){if(t[e]==null)throw new H("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});return i?t[e]+i:""+t[e]}function Mtt(t,e){if(t[e]==null)throw new H("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});const i=t[e];return`rgba(${i[0]||0}, ${i[1]||0}, ${i[2]||0}, ${i[3]/255||0})`}const N6=-3;var k0;(function(t){t[t.ALL=0]="ALL",t[t.SOME=1]="SOME"})(k0||(k0={}));let Ott=class{constructor(e,i,r){this._namespace=e,this._storage=i,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),this._namespace+=":",r&&(this._storage.registerRemoveFunc(this._namespace,r),this._removeFunc=!0)}destroy(){this._storage.clear(this._namespace),this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace),this._storage.deregister(this),this._storage=null}get namespace(){return this._namespace.slice(0,-1)}get hitRate(){return this._hit/(this._hit+this._miss)}get size(){return this._storage.size}get maxSize(){return this._storage.maxSize}resetHitRate(){this._hit=this._miss=0}put(e,i,r,n=0){this._storage.put(this._namespace+e,i,r,n)}get(e){const i=this._storage.get(this._namespace+e);return i===void 0?++this._miss:++this._hit,i}pop(e){const i=this._storage.pop(this._namespace+e);return i===void 0?++this._miss:++this._hit,i}updateSize(e,i,r){this._storage.updateSize(this._namespace+e,i,r)}clear(){this._storage.clear(this._namespace)}clearAll(){this._storage.clearAll()}getStats(){return this._storage.getStats()}resetStats(){this._storage.resetStats()}},jse=class{constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new Wt,this._users=new Wt}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,i){this._removeFuncs.push([e,i])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace(i=>i[0]!==e)}get size(){return this._size}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,0),this._checkSizeLimit()}put(e,i,r,n){const s=this._db.get(e);if(s&&(this._size-=s.size,this._db.delete(e),s.entry!==i&&this._notifyRemove(e,s.entry,k0.ALL)),r>this._maxSize)return void this._notifyRemove(e,i,k0.ALL);if(i===void 0)return void console.warn("Refusing to cache undefined entry ");if(!r||r<0)return void console.warn("Refusing to cache entry with invalid size "+r);const o=1+Math.max(n,N6)-N6;this._db.set(e,{entry:i,size:r,lifetime:o,lives:o}),this._size+=r,this._checkSizeLimit()}updateSize(e,i,r){const n=this._db.get(e);if(n&&n.entry===i){for(this._size-=n.size;r>this._maxSize;){const s=this._notifyRemove(e,i,k0.SOME);if(!(v(s)&&s>0))return void this._db.delete(e);r=s}n.size=r,this._size+=r,this._checkSizeLimit()}}pop(e){const i=this._db.get(e);if(i)return this._size-=i.size,this._db.delete(e),++this._hit,i.entry;++this._miss}get(e){const i=this._db.get(e);if(i!==void 0)return this._db.delete(e),i.lives=i.lifetime,this._db.set(e,i),++this._hit,i.entry;++this._miss}getStats(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},i={},r=new Array;this._db.forEach((o,a)=>{const l=o.lifetime;r[l]=(r[l]||0)+o.size,this._users.forAll(c=>{const h=c.namespace;if(a.startsWith(h)){const p=i[h]||0;i[h]=p+o.size}})});const n={};this._users.forAll(o=>{const a=o.namespace;if(!isNaN(o.hitRate)&&o.hitRate>0){const l=i[a]||0;i[a]=l,n[a]=Math.round(100*o.hitRate)+"%"}else n[a]="0%"});const s=Object.keys(i);s.sort((o,a)=>i[a]-i[o]),s.forEach(o=>e[o]=Math.round(i[o]/2**20)+"MB / "+n[o]);for(let o=r.length-1;o>=0;--o){const a=r[o];a&&(e["Priority "+(o+N6-1)]=Math.round(a/this.size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll(e=>e.resetHitRate())}clear(e){this._db.forEach((i,r)=>{r.startsWith(e)&&(this._size-=i.size,this._db.delete(r),this._notifyRemove(r,i.entry,k0.ALL))})}clearAll(){this._db.forEach((e,i)=>this._notifyRemove(i,e.entry,k0.ALL)),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,i,r){let n;return this._removeFuncs.some(s=>{if(e.startsWith(s[0])){const o=s[1](i,r);return typeof o=="number"&&(n=o),!0}return!1}),n}_checkSizeLimit(){if(!(this._size<=this._maxSize))for(const[e,i]of this._db){if(this._db.delete(e),i.lives<=1){this._size-=i.size;const r=this._notifyRemove(e,i.entry,k0.SOME);v(r)&&r>0&&(this._size+=r,i.lives=i.lifetime,i.size=r,this._db.set(e,i))}else--i.lives,this._db.set(e,i);if(this._size<=.9*this.maxSize)return}}},Ptt=class{constructor(e,i){this._storage=new jse,this._storage.maxSize=e,i&&this._storage.registerRemoveFunc("",i)}put(e,i){this._storage.put(e,i,1,1)}pop(e){return this._storage.pop(e)}get(e){return this._storage.get(e)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}};new Ptt(1e3);new Xe([128,128,128]);const Itt=new Xe("white");function $tt(t){return Nc(t.resource).href}function nE(t,e){if(!t)return null;let i=null;return EM(t)?i=Ltt(t):tB(t)&&(i=t.color?new Xe(t.color):null),i?oD(i,e):null}function Ltt(t){const e=t.symbolLayers;if(!e)return null;let i=null;return e.forEach(r=>{var n;r.type==="object"&&((n=r.resource)==null?void 0:n.href)!=null||(i=r.type==="water"?r.color:v(r.material)?r.material.color:null)}),i?new Xe(i):null}function oD(t,e){if(e==null||t==null)return t;const i=t.toRgba();return i[3]=i[3]*e,new Xe(i)}function Dtt(t,e,i){const r=t.symbolLayers;if(!r)return;const n=s=>{const o=v(s)?s:null;return oD(e=e??o??(i!=null?Itt:null),i)};r.forEach(s=>{var o;if(s.type!=="object"||((o=s.resource)==null?void 0:o.href)==null||e)if(s.type==="water")s.color=n(s.color);else{const a=v(s.material)?s.material.color:null,l=n(a);R(s.material)?s.material=new td({color:l}):s.material.color=l,i!=null&&"outline"in s&&v(s.outline)&&v(s.outline.color)&&(s.outline.color=oD(s.outline.color,i))}})}function Ntt(t,e,i){(e=e??t.color)&&(t.color=oD(e,i)),i!=null&&"outline"in t&&t.outline&&t.outline.color&&(t.outline.color=oD(t.outline.color,i))}function fG(t,e,i){t&&(e||i!=null)&&(e&&(e=new Xe(e)),EM(t)?Dtt(t,e,i):tB(t)&&Ntt(t,e,i))}async function Ftt(t,e){const i=t.symbolLayers;i&&await vB(i,async r=>ktt(r,e))}async function ktt(t,e){switch(t.type){case"extrude":Vtt(t,e);break;case"icon":case"line":case"text":Utt(t,e);break;case"path":Btt(t,e);break;case"object":await ztt(t,e)}}function Utt(t,e){const i=tOe(e);v(i)&&(t.size=i)}function tOe(t){for(const e of t)if(typeof e=="number")return e;return null}function Vtt(t,e){t.size=typeof e[2]=="number"?e[2]:0}async function ztt(t,e){const{resourceSize:i,symbolSize:r}=await jtt(t),n=iOe(e,i,r);t.width=I$(e[0],r[0],i[0],n),t.depth=I$(e[1],r[1],i[1],n),t.height=I$(e[2],r[2],i[2],n)}function Btt(t,e){const i=iOe(e,Vg,[t.width,void 0,t.height]);t.width=I$(e[0],t.width,1,i),t.height=I$(e[2],t.height,1,i)}function iOe(t,e,i){for(let r=0;r<3;r++){const n=t[r];switch(n){case"symbol-value":{const s=i[r];return s!=null?s/e[r]:1}case"proportional":break;default:if(n&&e[r])return n/e[r]}}return 1}async function jtt(t){const e=await Q(()=>import("./symbolLayerUtils-c1b1df2d.js"),[]),i=await e.computeObjectLayerResourceSize(t,10),{width:r,height:n,depth:s}=t,o=[r,s,n];let a=1;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/i[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=i[l]*a);return{resourceSize:i,symbolSize:o}}function I$(t,e,i,r){switch(t){case"proportional":return i*r;case"symbol-value":return e??i;default:return t}}function Gtt(t,e){const i=tOe(e);if(!R(i))switch(t.type){case"simple-marker":t.size=i;break;case"picture-marker":{const r=t.width/t.height;r>1?(t.width=i,t.height=i*r):(t.width=i*r,t.height=i);break}case"simple-line":t.width=i;break;case"text":t.font.size=i}}async function Htt(t,e){if(t&&e)return EM(t)?Ftt(t,e):void(tB(t)&&Gtt(t,e))}function qtt(t,e,i){if(t&&e!=null)if(EM(t)){const r=t.symbolLayers;r&&r.forEach(n=>{if(n&&n.type==="object")switch(i){case"tilt":n.tilt=e;break;case"roll":n.roll=e;break;default:n.heading=e}})}else tB(t)&&(t.type!=="simple-marker"&&t.type!=="picture-marker"&&t.type!=="text"||(t.angle=e))}function T9t(t){return v(t)&&t.type==="polygon-3d"&&t.symbolLayers.some(e=>e.type==="extrude")}async function Wtt(t,e){return await t.fetchSymbol(e)||t.fetchCIMSymbol(e)}const Xtt="<",Ytt=">",Ztt=F9("short-date");function Jtt(t,e,i,r){let n="";e===0?n=`${Xtt} `:e===i&&(n=`${Ytt} `);let s=null;return s=r?uy(t,Ztt):jet(t),n+s}const Ktt=new Xe([64,64,64]);function Qtt(t,e){const i=[],r=t.length-1;return t.length===5?i.push(0,2,4):i.push(0,r),t.map((n,s)=>i.includes(s)?Jtt(n,s,r,e):null)}async function eit(t,e,i){let r=!1,n=[],s=[];if(t.stops){const c=t.stops;n=c.map(h=>h.value),r=c.some(h=>!!h.label),r&&(s=c.map(h=>h.label))}const o=n[0],a=n[n.length-1];if(o==null&&a==null)return null;const l=r?null:Qtt(n,i??!1);return(await Promise.all(n.map(async(c,h)=>({value:c,color:t.type==="opacity"?await tit(c,t,e):(await Q(()=>Promise.resolve().then(()=>ooe),void 0)).getColor(t,c),label:r?s[h]:(l==null?void 0:l[h])??""})))).reverse()}async function tit(t,e,i=Ktt){const r=new Xe(i),n=(await Q(()=>Promise.resolve().then(()=>ooe),void 0)).getOpacity(e,t);return n!=null&&(r.a=n),r}var PJ;let XP=PJ=class extends fe{constructor(t){super(t),this.color=null,this.ratio=null}clone(){return new PJ({color:this.color,ratio:this.ratio})}};u([d({type:Xe,json:{type:[Kr],default:null,write:!0}})],XP.prototype,"color",void 0),u([d({type:Number,json:{write:!0}})],XP.prototype,"ratio",void 0),XP=PJ=u([$("esri.renderers.support.HeatmapColorStop")],XP);const $$=XP;function iit(t){if(!t.colorStops)return[];const e=[...t.colorStops].filter(r=>{var n;return((n=r.color)==null?void 0:n.a)>0});let i=e.length-1;if(e&&e[0]){const r=e[i];r&&r.ratio!==1&&(e.push(new $$({ratio:1,color:r.color})),i++)}return e.map((r,n)=>{var o,a;let s="";return n===0?s=((o=t.legendOptions)==null?void 0:o.minLabel)||"low":n===i&&(s=((a=t.legendOptions)==null?void 0:a.maxLabel)||"high"),{color:r.color,label:s,ratio:r.ratio}}).reverse()}re.getLogger("esri.renderers.support.utils");async function ah(t,e,i){qre(t,e,()=>[]).push(...i)}async function rit(t){var i,r;const e=new Map;if(!t)return e;if("visualVariables"in t&&t.visualVariables){const n=t.visualVariables.filter(s=>s.type==="color");for(const s of n){const o=(await eit(s)??[]).map(a=>a.color);await ah(e,s.field||s.valueExpression,o)}}if(t.type==="heatmap"){const n=iit(t).map(s=>s.color);await ah(e,t.field||t.valueExpression,n)}else if(t.type==="pie-chart"){for(const n of t.attributes)await ah(e,n.field||n.valueExpression,[n.color]);await ah(e,"default",[(i=t==null?void 0:t.othersCategory)==null?void 0:i.color,nE(t.backgroundFillSymbol,null)])}else if(t.type==="dot-density"){for(const n of t.attributes)await ah(e,n.field||n.valueExpression,[n.color]);await ah(e,"default",[t.backgroundColor])}else if(t.type==="unique-value")if(((r=t.authoringInfo)==null?void 0:r.type)==="predominance")for(const n of t.uniqueValueInfos??[])await ah(e,n.value.toString(),[nE(n.symbol,null)]);else{const n=(t.uniqueValueInfos??[]).map(c=>nE(c.symbol,null)),{field:s,field2:o,field3:a,valueExpression:l}=t;(s||l)&&await ah(e,s||l,n),o&&await ah(e,o,n),a&&await ah(e,a,n)}else if(t.type==="class-breaks"){const n=t.classBreakInfos.map(a=>nE(a.symbol,null)),{field:s,valueExpression:o}=t;await ah(e,s??o,n)}else t.type==="simple"&&await ah(e,"default",[nE(t.symbol,null)]);return"defaultSymbol"in t&&t.defaultSymbol&&await ah(e,"default",[nE(t.defaultSymbol,null)]),e.forEach((n,s)=>{const o=lN(n.filter(Boolean),(a,l)=>JSON.stringify(a)===JSON.stringify(l));e.set(s,o)}),e}var IJ;let YP=IJ=class extends fe{constructor(t){super(t),this.name=null,this.code=null}clone(){return new IJ({name:this.name,code:this.code})}};u([d({type:String,json:{write:!0}})],YP.prototype,"name",void 0),u([d({type:[String,Number],json:{write:!0}})],YP.prototype,"code",void 0),YP=IJ=u([$("esri.layers.support.CodedValue")],YP);const nit=new mi({inherited:"inherited",codedValue:"coded-value",range:"range"});let ZP=class extends fe{constructor(e){super(e),this.name=null,this.type=null}};u([d({type:String,json:{write:!0}})],ZP.prototype,"name",void 0),u([ot(nit)],ZP.prototype,"type",void 0),ZP=u([$("esri.layers.support.Domain")],ZP);const wB=ZP;var $J;let JP=$J=class extends wB{constructor(t){super(t),this.codedValues=null,this.type="coded-value"}getName(t){let e=null;if(this.codedValues){const i=String(t);this.codedValues.some(r=>(String(r.code)===i&&(e=r.name),!!e))}return e}clone(){return new $J({codedValues:se(this.codedValues),name:this.name})}};u([d({type:[YP],json:{write:!0}})],JP.prototype,"codedValues",void 0),u([ot({codedValue:"coded-value"})],JP.prototype,"type",void 0),JP=$J=u([$("esri.layers.support.CodedValueDomain")],JP);const rOe=JP;var LJ;let F6=LJ=class extends wB{constructor(t){super(t),this.type="inherited"}clone(){return new LJ}};u([ot({inherited:"inherited"})],F6.prototype,"type",void 0),F6=LJ=u([$("esri.layers.support.InheritedDomain")],F6);const nOe=F6;var DJ;let NC=DJ=class extends wB{constructor(t){super(t),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new DJ({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};u([d({type:Number,json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range&&e.range[1]},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(t,e,i){e[i]=[this.minValue||0,t]}}}})],NC.prototype,"maxValue",void 0),u([d({type:Number,json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range&&e.range[0]},write:{target:"range",writer(t,e,i){e[i]=[t,this.maxValue||0]}}}})],NC.prototype,"minValue",void 0),u([ot({range:"range"})],NC.prototype,"type",void 0),NC=DJ=u([$("esri.layers.support.RangeDomain")],NC);const sOe=NC,oOe={key:"type",base:wB,typeMap:{range:sOe,"coded-value":rOe,inherited:nOe}};function Gse(t){if(!t||!t.type)return null;switch(t.type){case"range":return sOe.fromJSON(t);case"codedValue":return rOe.fromJSON(t);case"inherited":return nOe.fromJSON(t)}return null}const Hse=new mi({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml"});var NJ;const sit=new mi({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let Ll=NJ=class extends fe{constructor(t){super(t),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=-1,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(t,{description:e}){let i=null;try{i=e?JSON.parse(e):null}catch{}return(i==null?void 0:i.value)??null}readValueType(t,{description:e}){let i=null;try{i=e?JSON.parse(e):null}catch{}return i?sit.fromJSON(i.fieldValueType):null}clone(){return new NJ({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};u([d({type:String,json:{write:!0}})],Ll.prototype,"alias",void 0),u([d({type:[String,Number],json:{write:{allowNull:!0}}})],Ll.prototype,"defaultValue",void 0),u([d()],Ll.prototype,"description",void 0),u([Oe("description")],Ll.prototype,"readDescription",null),u([d({types:oOe,json:{read:{reader:Gse},write:!0}})],Ll.prototype,"domain",void 0),u([d({type:Boolean,json:{write:!0}})],Ll.prototype,"editable",void 0),u([d({type:Kr,json:{write:!0}})],Ll.prototype,"length",void 0),u([d({type:String,json:{write:!0}})],Ll.prototype,"name",void 0),u([d({type:Boolean,json:{write:!0}})],Ll.prototype,"nullable",void 0),u([ot(Hse)],Ll.prototype,"type",void 0),u([d()],Ll.prototype,"valueType",void 0),u([Oe("valueType",["description"])],Ll.prototype,"readValueType",null),u([d({type:Boolean,json:{read:!1}})],Ll.prototype,"visible",void 0),Ll=NJ=u([$("esri.layers.support.Field")],Ll);const xB=Ll;var FJ;let FC=FJ=class extends fe{constructor(t){super(t),this.type="map-layer"}clone(){const{mapLayerId:t,gdbVersion:e}=this;return new FJ({mapLayerId:t,gdbVersion:e})}};u([ot({mapLayer:"map-layer"})],FC.prototype,"type",void 0),u([d({type:Kr,json:{write:!0}})],FC.prototype,"mapLayerId",void 0),u([d({type:String,json:{write:!0}})],FC.prototype,"gdbVersion",void 0),FC=FJ=u([$("esri.layers.support.source.MapLayerSource")],FC);var kJ;let c0=kJ=class extends fe{constructor(t){super(t),this.type="query-table"}clone(){const{workspaceId:t,query:e,oidFields:i,spatialReference:r,geometryType:n}=this,s={workspaceId:t,query:e,oidFields:i,spatialReference:(r==null?void 0:r.clone())??void 0,geometryType:n};return new kJ(s)}};u([ot({queryTable:"query-table"})],c0.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],c0.prototype,"workspaceId",void 0),u([d({type:String,json:{write:!0}})],c0.prototype,"query",void 0),u([d({type:String,json:{write:!0}})],c0.prototype,"oidFields",void 0),u([d({type:Je,json:{write:!0}})],c0.prototype,"spatialReference",void 0),u([ot(vEe)],c0.prototype,"geometryType",void 0),c0=kJ=u([$("esri.layers.support.source.QueryTableDataSource")],c0);var UJ;let kC=UJ=class extends fe{constructor(t){super(t),this.type="raster"}clone(){const{workspaceId:t,dataSourceName:e}=this;return new UJ({workspaceId:t,dataSourceName:e})}};u([ot({raster:"raster"})],kC.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],kC.prototype,"dataSourceName",void 0),u([d({type:String,json:{write:!0}})],kC.prototype,"workspaceId",void 0),kC=UJ=u([$("esri.layers.support.source.RasterDataSource")],kC);var VJ;let rT=VJ=class extends fe{constructor(t){super(t),this.type="table"}clone(){const{workspaceId:t,gdbVersion:e,dataSourceName:i}=this;return new VJ({workspaceId:t,gdbVersion:e,dataSourceName:i})}};u([ot({table:"table"})],rT.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],rT.prototype,"workspaceId",void 0),u([d({type:String,json:{write:!0}})],rT.prototype,"gdbVersion",void 0),u([d({type:String,json:{write:!0}})],rT.prototype,"dataSourceName",void 0),rT=VJ=u([$("esri.layers.support.source.TableDataSource")],rT);var zJ,BJ;const oit=Wa()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let bh=zJ=class extends fe{constructor(t){super(t),this.type="join-table"}readLeftTableSource(t,e,i){return Mpe()(t,e,i)}castLeftTableSource(t){return pm(jJ(),t)}readRightTableSource(t,e,i){return Mpe()(t,e,i)}castRightTableSource(t){return pm(jJ(),t)}clone(){const{leftTableKey:t,rightTableKey:e,leftTableSource:i,rightTableSource:r,joinType:n}=this,s={leftTableKey:t,rightTableKey:e,leftTableSource:(i==null?void 0:i.clone())??void 0,rightTableSource:(r==null?void 0:r.clone())??void 0,joinType:n};return new zJ(s)}};u([ot({joinTable:"join-table"})],bh.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],bh.prototype,"leftTableKey",void 0),u([d({type:String,json:{write:!0}})],bh.prototype,"rightTableKey",void 0),u([d({json:{write:!0}})],bh.prototype,"leftTableSource",void 0),u([Oe("leftTableSource")],bh.prototype,"readLeftTableSource",null),u([ri("leftTableSource")],bh.prototype,"castLeftTableSource",null),u([d({json:{write:!0}})],bh.prototype,"rightTableSource",void 0),u([Oe("rightTableSource")],bh.prototype,"readRightTableSource",null),u([ri("rightTableSource")],bh.prototype,"castRightTableSource",null),u([ot(oit)],bh.prototype,"joinType",void 0),bh=zJ=u([$("esri.layers.support.source.JoinTableDataSource")],bh);let mG=null;function Mpe(){return mG||(mG=Ow({types:jJ()})),mG}let gG=null;function jJ(){return gG||(gG={key:"type",base:null,typeMap:{"data-layer":Vf,"map-layer":FC}}),gG}const ait={key:"type",base:null,typeMap:{"join-table":bh,"query-table":c0,raster:kC,table:rT}};let Vf=BJ=class extends fe{constructor(t){super(t),this.type="data-layer"}clone(){const{fields:t,dataSource:e}=this;return new BJ({fields:t,dataSource:e})}};u([ot({dataLayer:"data-layer"})],Vf.prototype,"type",void 0),u([d({type:[xB],json:{write:!0}})],Vf.prototype,"fields",void 0),u([d({types:ait,json:{write:!0}})],Vf.prototype,"dataSource",void 0),Vf=BJ=u([$("esri.layers.support.source.DataLayerSource")],Vf),Vf.from=Ts(Vf);function lit(t,e){return e?{...e,query:{...t??{},...e.query}}:{query:t}}function qse(t){return typeof t=="string"?Bo(t):se(t)}function cit(t,e,i){const r={};for(const n in t){if(n==="declaredClass")continue;const s=t[n];if(s!=null&&typeof s!="function")if(Array.isArray(s)){r[n]=[];for(let o=0;o<s.length;o++)r[n][o]=cit(s[o])}else if(typeof s=="object")if(s.toJSON){const o=s.toJSON(i&&i[n]);r[n]=e?o:JSON.stringify(o)}else r[n]=e?s:JSON.stringify(s);else r[n]=s}return r}const tR={102100:{maxX:20037508342788905e-9,minX:-20037508342788905e-9,plus180Line:new Wf({paths:[[[20037508342788905e-9,-20037508342788905e-9],[20037508342788905e-9,20037508342788905e-9]]],spatialReference:Je.WebMercator}),minus180Line:new Wf({paths:[[[-20037508342788905e-9,-20037508342788905e-9],[-20037508342788905e-9,20037508342788905e-9]]],spatialReference:Je.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new Wf({paths:[[[180,-180],[180,180]]],spatialReference:Je.WGS84}),minus180Line:new Wf({paths:[[[-180,-180],[-180,180]]],spatialReference:Je.WGS84})}};function mp(t,e){return Math.ceil((t-e)/(2*e))}function Wse(t,e){const i=L$(t);for(const r of i)for(const n of r)n[0]+=e;return t}function L$(t){return s_(t)?t.rings:t.paths}async function uit(t,e,i,r){const n=qse(t),s=e[0].spatialReference,o={...r,query:{...n.query,f:"json",sr:JSON.stringify(s),target:JSON.stringify({geometryType:pO(e[0]),geometries:e}),cutter:JSON.stringify(i)}},a=await ir(n.path+"/cut",o),{cutIndexes:l,geometries:c=[]}=a.data;return{cutIndexes:l,geometries:c.map(h=>{const p=ly(h);return p.spatialReference=s,p})}}function hit(t){return{geometryType:pO(t[0]),geometries:t.map(e=>e.toJSON())}}function aOe(t,e,i){const r=aHe(e);return t.map(n=>{const s=r.fromJSON(n);return s.spatialReference=i,s})}async function dit(t,e,i){const r=typeof t=="string"?Bo(t):t,n=e[0].spatialReference,s=pO(e[0]),o={...i,query:{...r.query,f:"json",sr:n.wkid?n.wkid:JSON.stringify(n),geometries:JSON.stringify(hit(e))}},{data:a}=await ir(r.path+"/simplify",o);return aOe(a.geometries,s,n)}const lOe=re.getLogger("esri.geometry.support.normalizeUtils");function pit(t){return t.type==="polygon"}function fit(t){return t[0].type==="polygon"}function mit(t){return t[0].type==="polyline"}function git(t,e){if(!(t instanceof Wf||t instanceof ec)){const n="straightLineDensify: the input geometry is neither polyline nor polygon";throw lOe.error(n),new H(n)}const i=L$(t),r=[];for(const n of i){const s=[];r.push(s),s.push([n[0][0],n[0][1]]);for(let o=0;o<n.length-1;o++){const a=n[o][0],l=n[o][1],c=n[o+1][0],h=n[o+1][1],p=Math.sqrt((c-a)*(c-a)+(h-l)*(h-l)),f=(h-l)/p,m=(c-a)/p,g=p/e;if(g>1){for(let x=1;x<=g-1;x++){const T=x*e,E=m*T+a,C=f*T+l;s.push([E,C])}const _=(p+Math.floor(g-1)*e)/2,b=m*_+a,w=f*_+l;s.push([b,w])}s.push([c,h])}}return pit(t)?new ec({rings:r,spatialReference:t.spatialReference}):new Wf({paths:r,spatialReference:t.spatialReference})}function Ope(t,e,i){if(e){const r=git(t,1e6);t=mS(r,!0)}return i&&(t=Wse(t,i)),t}function Ppe(t,e,i){if(Array.isArray(t)){const r=t[0];if(r>e){const n=mp(r,e);t[0]=r+n*(-2*e)}else if(r<i){const n=mp(r,i);t[0]=r+n*(-2*i)}}else{const r=t.x;if(r>e){const n=mp(r,e);t=t.clone().offset(n*(-2*e),0)}else if(r<i){const n=mp(r,i);t=t.clone().offset(n*(-2*i),0)}}return t}function yit(t,e){let i=-1;for(let r=0;r<e.cutIndexes.length;r++){const n=e.cutIndexes[r],s=e.geometries[r],o=L$(s);for(let a=0;a<o.length;a++){const l=o[a];l.some(c=>{if(c[0]<180)return!0;{let h=0;for(let f=0;f<l.length;f++){const m=l[f][0];h=m>h?m:h}h=Number(h.toFixed(9));const p=-360*mp(h,180);for(let f=0;f<l.length;f++){const m=s.getPoint(a,f);s.setPoint(a,f,m.clone().offset(p,0))}return!0}})}if(n===i){if(fit(t))for(const a of L$(s))t[n]=t[n].addRing(a);else if(mit(t))for(const a of L$(s))t[n]=t[n].addPath(a)}else i=n,t[n]=s}return t}async function cOe(t,e,i){if(!Array.isArray(t))return cOe([t],e);e&&typeof e!="string"&&lOe.warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const r=typeof e=="string"?e:(e==null?void 0:e.url)??nr.geometryServiceUrl;let n,s,o,a,l,c,h,p,f=0;const m=[],g=[];for(const E of t)if(R(E))g.push(E);else if(n||(n=E.spatialReference,s=bp(n),o=n.isWebMercator,c=o?102100:4326,a=tR[c].maxX,l=tR[c].minX,h=tR[c].plus180Line,p=tR[c].minus180Line),s)if(E.type==="mesh")g.push(E);else if(E.type==="point")g.push(Ppe(E.clone(),a,l));else if(E.type==="multipoint"){const C=E.clone();C.points=C.points.map(A=>Ppe(A,a,l)),g.push(C)}else if(E.type==="extent"){const C=E.clone()._normalize(!1,!1,s);g.push(C.rings?new ec(C):C)}else if(E.extent){const C=E.extent,A=mp(C.xmin,l)*(2*a);let I=A===0?E.clone():Wse(E.clone(),A);C.offset(A,0),C.intersects(h)&&C.xmax!==a?(f=C.xmax>f?C.xmax:f,I=Ope(I,o),m.push(I),g.push("cut")):C.intersects(p)&&C.xmin!==l?(f=C.xmax*(2*a)>f?C.xmax*(2*a):f,I=Ope(I,o,360),m.push(I),g.push("cut")):g.push(I)}else g.push(E.clone());else g.push(E);let _=mp(f,a),b=-90;const w=_,x=new Wf;for(;_>0;){const E=360*_-180;x.addPath([[E,b],[E,-1*b]]),b*=-1,_--}if(m.length>0&&w>0){const E=yit(m,await uit(r,m,x,i)),C=[],A=[];for(let D=0;D<g.length;D++){const U=g[D];if(U!=="cut")A.push(U);else{const V=E.shift(),B=t[D];v(B)&&B.type==="polygon"&&B.rings&&B.rings.length>1&&V.rings.length>=B.rings.length?(C.push(V),A.push("simplify")):A.push(o?Zg(V):V)}}if(!C.length)return A;const I=await dit(r,C,i),O=[];for(let D=0;D<A.length;D++){const U=A[D];U!=="simplify"?O.push(U):O.push(o?Zg(I.shift()):I.shift())}return O}const T=[];for(let E=0;E<g.length;E++){const C=g[E];if(C!=="cut")T.push(C);else{const A=m.shift();T.push(o===!0?Zg(A):A)}}return T}function E9t(t,e){const i=bp(e);if(i){const[r,n]=i.valid,s=n-r;if(t<r)for(;t<r;)t+=s;if(t>n)for(;t>n;)t-=s}return t}function uOe(t){const e={};for(const i in t){if(i==="declaredClass")continue;const r=t[i];if(r!=null&&typeof r!="function")if(Array.isArray(r)){e[i]=[];for(let n=0;n<r.length;n++)e[i][n]=uOe(r[n])}else typeof r=="object"?r.toJSON&&(e[i]=JSON.stringify(r)):e[i]=r}return e}var U1;(function(t){t[t.varint=0]="varint",t[t.fixed64=1]="fixed64",t[t.delimited=2]="delimited",t[t.fixed32=5]="fixed32",t[t.unknown=99]="unknown"})(U1||(U1={}));const Ipe=4294967296,_it=new TextDecoder("utf-8"),vit=ue("safari")||ue("ios")?6:ue("ff")?12:32;let GJ=class k6{constructor(e,i,r=0,n=e?e.byteLength:0){this._tag=0,this._dataType=U1.unknown,this._init(e,i,r,n)}_init(e,i,r,n){this._data=e,this._dataView=i,this._pos=r,this._end=n}asUnsafe(){return this}clone(){return new k6(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(e){this._pos=e}nextTag(e){for(;;){if(this._pos===this._end)return!1;const i=this._decodeVarint();if(this._tag=i>>3,this._dataType=7&i,!e||e===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const e=this._decodeVarint();return this._tag=e>>3,this._dataType=7&e,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let e=4294967295;return e=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?e:(e=(e|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?e:void 0))))}getUInt64(){return this._decodeVarint()}getSInt32(){const e=this.getUInt32();if(e!==void 0)return e>>>1^-(1&e)|0}getSInt64(){return this._decodeSVarint()}getBool(){const e=this._data[this._pos]!==0;return this._skip(1),e}getEnum(){return this._decodeVarint()}getFixed64(){const e=this._dataView,i=this._pos,r=e.getUint32(i,!0)+e.getUint32(i+4,!0)*Ipe;return this._skip(8),r}getSFixed64(){const e=this._dataView,i=this._pos,r=e.getUint32(i,!0)+e.getInt32(i+4,!0)*Ipe;return this._skip(8),r}getDouble(){const e=this._dataView.getFloat64(this._pos,!0);return this._skip(8),e}getFixed32(){const e=this._dataView.getUint32(this._pos,!0);return this._skip(4),e}getSFixed32(){const e=this._dataView.getInt32(this._pos,!0);return this._skip(4),e}getFloat(){const e=this._dataView.getFloat32(this._pos,!0);return this._skip(4),e}getString(){const e=this._getLength(),i=this._pos,r=this._toString(this._data,i,i+e);return this._skip(e),r}getBytes(){const e=this._getLength(),i=this._pos,r=this._toBytes(this._data,i,i+e);return this._skip(e),r}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(e,i,r,n){const s=this.getMessage(),o=e(s,i,r,n);return s.release(),o}processMessage(e){const i=this.getMessage(),r=e(i);return i.release(),r}getMessage(){const e=this._getLength(),i=k6.pool.acquire();return i._init(this._data,this._dataView,this._pos,this._pos+e),this._skip(e),i}release(){k6.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case U1.varint:this._decodeVarint();break;case U1.fixed64:this._skip(8);break;case U1.delimited:this._skip(this._getLength());break;case U1.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(e){this._skip(e)}_skip(e){if(this._pos+e>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=e}_decodeVarint(){const e=this._data;let i=this._pos,r=0,n=0;if(this._end-i>=10)do{if(n=e[i++],r|=127&n,(128&n)==0||(n=e[i++],r|=(127&n)<<7,(128&n)==0)||(n=e[i++],r|=(127&n)<<14,(128&n)==0)||(n=e[i++],r|=(127&n)<<21,(128&n)==0)||(n=e[i++],r+=268435456*(127&n),(128&n)==0)||(n=e[i++],r+=34359738368*(127&n),(128&n)==0)||(n=e[i++],r+=4398046511104*(127&n),(128&n)==0)||(n=e[i++],r+=562949953421312*(127&n),(128&n)==0)||(n=e[i++],r+=72057594037927940*(127&n),(128&n)==0)||(n=e[i++],r+=9223372036854776e3*(127&n),(128&n)==0))break;throw new Error("Varint too long!")}while(0);else{let s=1;for(;i!==this._end&&(n=e[i],(128&n)!=0);)++i,r+=(127&n)*s,s*=128;if(i===this._end)throw new Error("Varint overrun!");++i,r+=n*s}return this._pos=i,r}_decodeSVarint(){const e=this._data;let i=this._pos,r=0,n=0;const s=1&e[i];if(this._end-i>=10)do{if(n=e[i++],r|=127&n,(128&n)==0||(n=e[i++],r|=(127&n)<<7,(128&n)==0)||(n=e[i++],r|=(127&n)<<14,(128&n)==0)||(n=e[i++],r|=(127&n)<<21,(128&n)==0)||(n=e[i++],r+=268435456*(127&n),(128&n)==0)||(n=e[i++],r+=34359738368*(127&n),(128&n)==0)||(n=e[i++],r+=4398046511104*(127&n),(128&n)==0)||(n=e[i++],r+=562949953421312*(127&n),(128&n)==0)||(n=e[i++],r+=72057594037927940*(127&n),(128&n)==0)||(n=e[i++],r+=9223372036854776e3*(127&n),(128&n)==0))break;throw new Error("Varint too long!")}while(0);else{let o=1;for(;i!==this._end&&(n=e[i],(128&n)!=0);)++i,r+=(127&n)*o,o*=128;if(i===this._end)throw new Error("Varint overrun!");++i,r+=n*o}return this._pos=i,s?-(r+1)/2:r/2}_getLength(){if(this._dataType!==U1.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(e,i,r){if((r=Math.min(this._end,r))-i>vit){const o=e.subarray(i,r);return _it.decode(o)}let n="",s="";for(let o=i;o<r;++o){const a=e[o];128&a?s+="%"+a.toString(16):(n+=decodeURIComponent(s)+String.fromCharCode(a),s="")}return s.length&&(n+=decodeURIComponent(s)),n}_toBytes(e,i,r){return r=Math.min(this._end,r),new Uint8Array(e.buffer,i,r-i)}};GJ.pool=new zo(GJ,void 0,t=>{t._data=null,t._dataView=null});let vm=class U6{constructor(e=[],i=[],r=!1){this.lengths=e??[],this.coords=i??[],this.hasIndeterminateRingOrder=r}static fromRect(e){const[i,r,n,s]=e,o=n-i,a=s-r;return new U6([5],[i,r,o,0,0,a,-o,0,0,-a])}get isPoint(){return this.lengths.length===0}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((e,i)=>e+i)}forEachVertex(e){let i=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const n=this.lengths[r];for(let s=0;s<n;s++)e(this.coords[2*(s+i)],this.coords[2*(s+i)+1]);i+=n}}clone(e){return e?(e.set(this.coords),new U6(this.lengths.slice(),e,this.hasIndeterminateRingOrder)):new U6(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}},uw=class hOe{constructor(e=null,i={},r,n){this.geometry=e,this.attributes=i,this.centroid=r,this.objectId=n,this.displayId=0,this.geohashX=0,this.geohashY=0}weakClone(){const e=new hOe(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}};function bit(t){return!(R(t.geometry)||!t.geometry.coords||!t.geometry.coords.length)}let C9t=class extends uw{},dOe=class pOe{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new pOe;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}};const fOe=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];let R9t=class{constructor(e){this._options=e,this.geometryTypes=fOe,this._coordinatePtr=0,this._vertexDimension=0}createFeatureResult(){return new dOe}prepareFeatures(e){this._vertexDimension=2,e.hasZ&&this._vertexDimension++,e.hasM&&this._vertexDimension++}finishFeatureResult(e){if(!e||!e.features||!e.hasZ||!this._options.sourceSpatialReference||!e.spatialReference||Dn(e.spatialReference,this._options.sourceSpatialReference)||e.spatialReference.vcsWkid)return;const i=r2(this._options.sourceSpatialReference)/r2(e.spatialReference);if(i!==1)for(const r of e.features){if(!bit(r))continue;const n=r.geometry.coords;for(let s=2;s<n.length;s+=3)n[s]*=i}}addFeature(e,i){e.features.push(i)}createFeature(){return new uw}createSpatialReference(){return{wkid:0}}createGeometry(){return new vm}addField(e,i){e.fields.push(i)}allocateCoordinates(e){e.coords.length=e.lengths.reduce((i,r)=>i+r,0)*this._vertexDimension,this._coordinatePtr=0}addCoordinate(e,i){e.coords[this._coordinatePtr++]=i}addCoordinatePoint(e,i){e.coords.push(i)}addLength(e,i){e.lengths.push(i)}addQueryGeometry(e,i){e.queryGeometry=i.queryGeometry,e.queryGeometryType=i.queryGeometryType}createPointGeometry(){return new vm}};const $pe=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],Lpe=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],Dpe=["upperLeft","lowerLeft"];function Npe(t){return t>=$pe.length?null:$pe[t]}function wit(t){return t>=Lpe.length?null:Lpe[t]}function Fpe(t){return t>=Dpe.length?null:Dpe[t]}function kpe(t,e){return e>=t.geometryTypes.length?null:t.geometryTypes[e]}function xit(t,e,i){const n=t.asUnsafe(),s=e.createPointGeometry(i);for(;n.next();)switch(n.tag()){case 3:{const o=n.getUInt32(),a=n.pos()+o;let l=0;for(;n.pos()<a;)e.addCoordinatePoint(s,n.getSInt64(),l++);break}default:n.skip()}return s}function Tit(t,e,i){const s=t.asUnsafe(),o=e.createGeometry(i),a=2+(i.hasZ?1:0)+(i.hasM?1:0);for(;s.next();)switch(s.tag()){case 2:{const l=s.getUInt32(),c=s.pos()+l;let h=0;for(;s.pos()<c;)e.addLength(o,s.getUInt32(),h++);break}case 3:{const l=s.getUInt32(),c=s.pos()+l;let h=0;for(e.allocateCoordinates(o);s.pos()<c;)e.addCoordinate(o,s.getSInt64(),h),h++,h===a&&(h=0);break}default:s.skip()}return o}function Sit(t){const n=t.asUnsafe(),s=new vm;let o="esriGeometryPoint";for(;n.next();)switch(n.tag()){case 2:{const a=n.getUInt32(),l=n.pos()+a;for(;n.pos()<l;)s.lengths.push(n.getUInt32());break}case 3:{const a=n.getUInt32(),l=n.pos()+a;for(;n.pos()<l;)s.coords.push(n.getSInt64());break}case 1:o=fOe[n.getEnum()];break;default:n.skip()}return{queryGeometry:s,queryGeometryType:o}}function Eit(t){const h=t.asUnsafe();for(;h.next();)switch(h.tag()){case 1:return h.getString();case 2:return h.getFloat();case 3:return h.getDouble();case 4:return h.getSInt32();case 5:return h.getUInt32();case 6:return h.getInt64();case 7:return h.getUInt64();case 8:return h.getSInt64();case 9:return h.getBool();default:return h.skip(),null}return null}function Cit(t){const a=t.asUnsafe(),l={type:Npe(0)};for(;a.next();)switch(a.tag()){case 1:l.name=a.getString();break;case 2:l.type=Npe(a.getEnum());break;case 3:l.alias=a.getString();break;case 4:l.sqlType=wit(a.getEnum());break;case 5:a.skip();break;case 6:l.defaultValue=a.getString();break;default:a.skip()}return l}function Ait(t){const r={},n=t.asUnsafe();for(;n.next();)switch(n.tag()){case 1:r.name=n.getString();break;case 2:r.isSystemMaintained=n.getBool();break;default:n.skip()}return r}function Rit(t,e,i,r){const a=e.createFeature(i);let l=0;for(;t.next();)switch(t.tag()){case 1:{const c=r[l++].name;a.attributes[c]=t.processMessage(Eit);break}case 2:a.geometry=t.processMessageWithArgs(Tit,e,i);break;case 4:a.centroid=t.processMessageWithArgs(xit,e,i);break;default:t.skip()}return a}function Mit(t){const s=[1,1,1,1],o=t.asUnsafe();for(;o.next();)switch(o.tag()){case 1:s[0]=o.getDouble();break;case 2:s[1]=o.getDouble();break;case 4:s[2]=o.getDouble();break;case 3:s[3]=o.getDouble();break;default:o.skip()}return s}function Oit(t){const s=[0,0,0,0],o=t.asUnsafe();for(;o.next();)switch(o.tag()){case 1:s[0]=o.getDouble();break;case 2:s[1]=o.getDouble();break;case 4:s[2]=o.getDouble();break;case 3:s[3]=o.getDouble();break;default:o.skip()}return s}function Pit(t){const n={originPosition:Fpe(0)},s=t.asUnsafe();for(;s.next();)switch(s.tag()){case 1:n.originPosition=Fpe(s.getEnum());break;case 2:n.scale=s.processMessage(Mit);break;case 3:n.translate=s.processMessage(Oit);break;default:s.skip()}return n}function Iit(t){const n={},s=t.asUnsafe();for(;s.next();)switch(s.tag()){case 1:n.shapeAreaFieldName=s.getString();break;case 2:n.shapeLengthFieldName=s.getString();break;case 3:n.units=s.getString();break;default:s.skip()}return n}function $it(t,e){const a=e.createSpatialReference();for(;t.next();)switch(t.tag()){case 1:a.wkid=t.getUInt32();break;case 5:a.wkt=t.getString();break;case 2:a.latestWkid=t.getUInt32();break;case 3:a.vcsWkid=t.getUInt32();break;case 4:a.latestVcsWkid=t.getUInt32();break;default:t.skip()}return a}function Lit(t,e){const _=e.createFeatureResult(),b=t.asUnsafe();_.geometryType=kpe(e,0);let w=!1;for(;b.next();)switch(b.tag()){case 1:_.objectIdFieldName=b.getString();break;case 3:_.globalIdFieldName=b.getString();break;case 4:_.geohashFieldName=b.getString();break;case 5:_.geometryProperties=b.processMessage(Iit);break;case 7:_.geometryType=kpe(e,b.getEnum());break;case 8:_.spatialReference=b.processMessageWithArgs($it,e);break;case 10:_.hasZ=b.getBool();break;case 11:_.hasM=b.getBool();break;case 12:_.transform=b.processMessage(Pit);break;case 9:{const x=b.getBool();_.exceededTransferLimit=x;break}case 13:e.addField(_,b.processMessage(Cit));break;case 15:w||(e.prepareFeatures(_),w=!0),e.addFeature(_,b.processMessageWithArgs(Rit,e,_,_.fields));break;case 2:_.uniqueIdField=b.processMessage(Ait);break;default:b.skip()}return e.finishFeatureResult(_),_}function Dit(t,e){const n={};let s=null;for(;t.next();)switch(t.tag()){case 4:s=t.processMessageWithArgs(Sit);break;case 1:n.featureResult=t.processMessageWithArgs(Lit,e);break;default:t.skip()}return v(s)&&n.featureResult&&e.addQueryGeometry(n,s),n}function Nit(t,e){try{const r=new GJ(new Uint8Array(t),new DataView(t)),n={};for(;r.next();)r.tag()===2?n.queryResult=r.processMessageWithArgs(Dit,e):r.skip();return n}catch(i){throw new H("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:i})}}function Fit(t,e){const i=Nit(t,e),r=i.queryResult.featureResult,n=i.queryResult.queryGeometry,s=i.queryResult.queryGeometryType;if(r&&r.features&&r.features.length&&r.objectIdFieldName){const o=r.objectIdFieldName;for(const a of r.features)a.attributes&&(a.objectId=a.attributes[o])}return r&&(r.queryGeometry=n,r.queryGeometryType=s),r}function HJ(t,e,i){if(!i||!i.features||!i.hasZ)return;const r=HAe(i.geometryType,e,t.outSpatialReference);if(!R(r))for(const n of i.features)r(n.geometry)}const Upe="Layer does not support extent calculation.";function kit(t,e){if(e&&t.type==="extent")return`${t.xmin},${t.ymin},${t.xmax},${t.ymax}`;if(e&&t.type==="point")return`${t.x},${t.y}`;const i=t.toJSON();return delete i.spatialReference,JSON.stringify(i)}function Uit(t,e){const i=t.geometry,r=t.toJSON();delete r.compactGeometryEnabled,delete r.defaultSpatialReferenceEnabled;const n=r;let s,o,a;if(v(i)&&(o=i.spatialReference,a=i.spatialReference.wkid||JSON.stringify(i.spatialReference),n.geometryType=pO(i),n.geometry=kit(i,t.compactGeometryEnabled),n.inSR=a),r.groupByFieldsForStatistics&&(n.groupByFieldsForStatistics=r.groupByFieldsForStatistics.join(",")),r.objectIds&&(n.objectIds=r.objectIds.join(",")),r.orderByFields&&(n.orderByFields=r.orderByFields.join(",")),!r.outFields||!r.returnDistinctValues&&(e!=null&&e.returnCountOnly||e!=null&&e.returnExtentOnly||e!=null&&e.returnIdsOnly)?delete n.outFields:r.outFields.includes("*")?n.outFields="*":n.outFields=r.outFields.join(","),r.outSR?(n.outSR=r.outSR.wkid||JSON.stringify(r.outSR),s=t.outSpatialReference):i&&(r.returnGeometry||r.returnCentroid)&&(n.outSR=n.inSR,s=o),r.returnGeometry&&delete r.returnGeometry,r.outStatistics&&(n.outStatistics=JSON.stringify(r.outStatistics)),r.fullText&&(n.fullText=JSON.stringify(r.fullText)),r.pixelSize&&(n.pixelSize=JSON.stringify(r.pixelSize)),r.quantizationParameters&&(t.defaultSpatialReferenceEnabled&&v(o)&&v(t.quantizationParameters)&&v(t.quantizationParameters.extent)&&o.equals(t.quantizationParameters.extent.spatialReference)&&delete r.quantizationParameters.extent.spatialReference,n.quantizationParameters=JSON.stringify(r.quantizationParameters)),r.parameterValues&&(n.parameterValues=JSON.stringify(r.parameterValues)),r.rangeValues&&(n.rangeValues=JSON.stringify(r.rangeValues)),r.dynamicDataSource&&(n.layer=JSON.stringify({source:r.dynamicDataSource}),delete r.dynamicDataSource),r.timeExtent){const l=r.timeExtent,{start:c,end:h}=l;c==null&&h==null||(n.time=c===h?c:`${c??"null"},${h??"null"}`),delete r.timeExtent}return t.defaultSpatialReferenceEnabled&&v(o)&&v(s)&&o.equals(s)&&(n.defaultSR=n.inSR,delete n.inSR,delete n.outSR),n}async function Vit(t,e,i,r){const n=v(e.timeExtent)&&e.timeExtent.isEmpty?{data:{features:[]}}:await $N(t,e,"json",r);return HJ(e,i,n.data),n}async function O9t(t,e,i,r){if(v(e.timeExtent)&&e.timeExtent.isEmpty)return{data:i.createFeatureResult()};const n=await zit(t,e,r),s=n;return s.data=Fit(n.data,i),s}function zit(t,e,i){return $N(t,e,"pbf",i)}function P9t(t,e,i){return v(e.timeExtent)&&e.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):$N(t,e,"json",i,{returnIdsOnly:!0})}function I9t(t,e,i){return v(e.timeExtent)&&e.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):$N(t,e,"json",i,{returnIdsOnly:!0,returnCountOnly:!0})}function $9t(t,e,i){return v(e.timeExtent)&&e.timeExtent.isEmpty?Promise.resolve({data:{count:0,extent:null}}):$N(t,e,"json",i,{returnExtentOnly:!0,returnCountOnly:!0}).then(r=>{const n=r.data;if(n.hasOwnProperty("extent"))return r;if(n.features)throw new Error(Upe);if(n.hasOwnProperty("count"))throw new Error(Upe);return r})}function $N(t,e,i,r={},n={}){const s=typeof t=="string"?Bo(t):t,o=e.geometry?[e.geometry]:[];return r.responseType=i==="pbf"?"array-buffer":"json",cOe(o,null,r).then(a=>{const l=a&&a[0];v(l)&&((e=e.clone()).geometry=l);const c=uOe({...s.query,f:i,...n,...Uit(e,n)});return ir(ew(s.path,"query"),{...r,query:{...c,...r.query}})})}var qJ;const WJ=new mi({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let Pa=qJ=class extends fe{constructor(t){super(t),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(t,e){var n;const i=Je.fromJSON(e.spatialReference),r=[];for(let s=0;s<t.length;s++){const o=t[s],a=Ha.fromJSON(o),l=o.geometry&&o.geometry.spatialReference;v(a.geometry)&&!l&&(a.geometry.spatialReference=i);const c=o.aggregateGeometries,h=a.aggregateGeometries;if(c&&v(h))for(const p in h){const f=h[p],m=(n=c[p])==null?void 0:n.spatialReference;v(f)&&!m&&(f.spatialReference=i)}r.push(a)}return r}writeGeometryType(t,e,i,r){if(t)return void WJ.write(t,e,i,r);const{features:n}=this;if(n){for(const s of n)if(s&&v(s.geometry))return void WJ.write(s.geometry.type,e,i,r)}}readQueryGeometry(t,e){if(!t)return null;const i=!!t.spatialReference,r=ly(t);return r&&!i&&e.spatialReference&&(r.spatialReference=Je.fromJSON(e.spatialReference)),r}writeSpatialReference(t,e){if(t)return void(e.spatialReference=t.toJSON());const{features:i}=this;if(i){for(const r of i)if(r&&v(r.geometry)&&r.geometry.spatialReference)return void(e.spatialReference=r.geometry.spatialReference.toJSON())}}clone(){return new qJ(this.cloneProperties())}cloneProperties(){return se({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(t){const e=this.write();if(e.features&&Array.isArray(t)&&t.length>0)for(let i=0;i<e.features.length;i++){const r=e.features[i];if(r.geometry){const n=t&&t[i];r.geometry=n&&n.toJSON()||r.geometry}}return e}quantize(t){const{scale:[e,i],translate:[r,n]}=t,s=c=>Math.round((c-r)/e),o=c=>Math.round((n-c)/i),a=this.features,l=this._getQuantizationFunction(this.geometryType,s,o);for(let c=0,h=a.length;c<h;c++)l!=null&&l(a[c].geometry)||(a.splice(c,1),c--,h--);return this.transform=t,this}unquantize(){const{geometryType:t,features:e,transform:i}=this;if(!i)return this;const{translate:[r,n],scale:[s,o]}=i,a=h=>h*s+r,l=h=>n-h*o,c=this._getHydrationFunction(t,a,l);for(const{geometry:h}of e)v(h)&&c&&c(h);return this.transform=null,this}_quantizePoints(t,e,i){let r,n;const s=[];for(let o=0,a=t.length;o<a;o++){const l=t[o];if(o>0){const c=e(l[0]),h=i(l[1]);c===r&&h===n||(s.push([c-r,h-n]),r=c,n=h)}else r=e(l[0]),n=i(l[1]),s.push([r,n])}return s.length>0?s:null}_getQuantizationFunction(t,e,i){return t==="point"?r=>(r.x=e(r.x),r.y=i(r.y),r):t==="polyline"||t==="polygon"?r=>{const n=s_(r)?r.rings:r.paths,s=[];for(let o=0,a=n.length;o<a;o++){const l=n[o],c=this._quantizePoints(l,e,i);c&&s.push(c)}return s.length>0?(s_(r)?r.rings=s:r.paths=s,r):null}:t==="multipoint"?r=>{const n=this._quantizePoints(r.points,e,i);return n&&n.length>0?(r.points=n,r):null}:t==="extent"?r=>r:null}_getHydrationFunction(t,e,i){return t==="point"?r=>{r.x=e(r.x),r.y=i(r.y)}:t==="polyline"||t==="polygon"?r=>{const n=s_(r)?r.rings:r.paths;let s,o;for(let a=0,l=n.length;a<l;a++){const c=n[a];for(let h=0,p=c.length;h<p;h++){const f=c[h];h>0?(s+=f[0],o+=f[1]):(s=f[0],o=f[1]),f[0]=e(s),f[1]=i(o)}}}:t==="extent"?r=>{r.xmin=e(r.xmin),r.ymin=i(r.ymin),r.xmax=e(r.xmax),r.ymax=i(r.ymax)}:t==="multipoint"?r=>{const n=r.points;let s,o;for(let a=0,l=n.length;a<l;a++){const c=n[a];a>0?(s+=c[0],o+=c[1]):(s=c[0],o=c[1]),c[0]=e(s),c[1]=i(o)}}:null}};u([d({type:String,json:{write:!0}})],Pa.prototype,"displayFieldName",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Pa.prototype,"exceededTransferLimit",void 0),u([d({type:[Ha],json:{write:!0}})],Pa.prototype,"features",void 0),u([Oe("features")],Pa.prototype,"readFeatures",null),u([d({type:[xB],json:{write:!0}})],Pa.prototype,"fields",void 0),u([d({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:WJ.read}}})],Pa.prototype,"geometryType",void 0),u([Ne("geometryType")],Pa.prototype,"writeGeometryType",null),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Pa.prototype,"hasM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Pa.prototype,"hasZ",void 0),u([d({types:Iw,json:{write:!0}})],Pa.prototype,"queryGeometry",void 0),u([Oe("queryGeometry")],Pa.prototype,"readQueryGeometry",null),u([d({type:Je,json:{write:!0}})],Pa.prototype,"spatialReference",void 0),u([Ne("spatialReference")],Pa.prototype,"writeSpatialReference",null),u([d({json:{write:!0}})],Pa.prototype,"transform",void 0),Pa=qJ=u([$("esri.rest.support.FeatureSet")],Pa),Pa.prototype.toJSON.isDefaultToJSON=!0;const Xse=Pa,Vpe={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8},Bit={milliseconds:{getter:"getMilliseconds",setter:"setMilliseconds",multiplier:1},seconds:{getter:"getSeconds",setter:"setSeconds",multiplier:1},minutes:{getter:"getMinutes",setter:"setMinutes",multiplier:1},hours:{getter:"getHours",setter:"setHours",multiplier:1},days:{getter:"getDate",setter:"setDate",multiplier:1},weeks:{getter:"getDate",setter:"setDate",multiplier:7},months:{getter:"getMonth",setter:"setMonth",multiplier:1},years:{getter:"getFullYear",setter:"setFullYear",multiplier:1},decades:{getter:"getFullYear",setter:"setFullYear",multiplier:10},centuries:{getter:"getFullYear",setter:"setFullYear",multiplier:100}};function jit(t,e){const i=new Date(t,e+1,1);return i.setDate(0),i.getDate()}function NS(t,e,i){const r=new Date(t.getTime());if(e&&i){const n=Bit[i],{getter:s,setter:o,multiplier:a}=n;if(i==="months"){const l=jit(r.getFullYear(),r.getMonth()+e);r.getDate()>l&&r.setDate(l)}r[o](r[s]()+e*a)}return r}function zpe(t,e){switch(e){case"milliseconds":return new Date(t.getTime());case"seconds":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds());case"minutes":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes());case"hours":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours());case"days":return new Date(t.getFullYear(),t.getMonth(),t.getDate());case"weeks":return new Date(t.getFullYear(),t.getMonth(),t.getDate()-t.getDay());case"months":return new Date(t.getFullYear(),t.getMonth(),1);case"years":return new Date(t.getFullYear(),0,1);case"decades":return new Date(t.getFullYear()-t.getFullYear()%10,0,1);case"centuries":return new Date(t.getFullYear()-t.getFullYear()%100,0,1);default:return new Date}}function Git(t,e,i){return t===0?0:t*Vpe[e]/Vpe[i]}var pf;let Oh=pf=class extends fe{static get allTime(){return Bpe}static get empty(){return Hit}constructor(t){super(t),this.end=null,this.start=null}readEnd(t,e){return e.end!=null?new Date(e.end):null}writeEnd(t,e){e.end=t?t.getTime():null}get isAllTime(){return this.equals(pf.allTime)}get isEmpty(){return this.equals(pf.empty)}readStart(t,e){return e.start!=null?new Date(e.start):null}writeStart(t,e){e.start=t?t.getTime():null}clone(){return new pf({end:this.end,start:this.start})}equals(t){if(!t)return!1;const e=v(this.start)?this.start.getTime():this.start,i=v(this.end)?this.end.getTime():this.end,r=v(t.start)?t.start.getTime():t.start,n=v(t.end)?t.end.getTime():t.end;return e===r&&i===n}expandTo(t){if(this.isEmpty||this.isAllTime)return this.clone();const e=Vo(this.start,r=>zpe(r,t)),i=Vo(this.end,r=>{const n=zpe(r,t);return r.getTime()===n.getTime()?n:NS(n,1,t)});return new pf({start:e,end:i})}intersection(t){if(!t)return this.clone();if(this.isEmpty||t.isEmpty)return pf.empty;if(this.isAllTime)return t.clone();if(t.isAllTime)return this.clone();const e=jh(this.start,-1/0,a=>a.getTime()),i=jh(this.end,1/0,a=>a.getTime()),r=jh(t.start,-1/0,a=>a.getTime()),n=jh(t.end,1/0,a=>a.getTime());let s,o;if(r>=e&&r<=i?s=r:e>=r&&e<=n&&(s=e),i>=r&&i<=n?o=i:n>=e&&n<=i&&(o=n),s!=null&&o!=null&&!isNaN(s)&&!isNaN(o)){const a=new pf;return a.start=s===-1/0?null:new Date(s),a.end=o===1/0?null:new Date(o),a}return pf.empty}offset(t,e){if(this.isEmpty||this.isAllTime)return this.clone();const i=new pf,{start:r,end:n}=this;return v(r)&&(i.start=NS(r,t,e)),v(n)&&(i.end=NS(n,t,e)),i}union(t){if(!t||t.isEmpty)return this.clone();if(this.isEmpty)return t.clone();if(this.isAllTime||t.isAllTime)return Bpe.clone();const e=v(this.start)&&v(t.start)?new Date(Math.min(this.start.getTime(),t.start.getTime())):null,i=v(this.end)&&v(t.end)?new Date(Math.max(this.end.getTime(),t.end.getTime())):null;return new pf({start:e,end:i})}};u([d({type:Date,json:{write:{allowNull:!0}}})],Oh.prototype,"end",void 0),u([Oe("end")],Oh.prototype,"readEnd",null),u([Ne("end")],Oh.prototype,"writeEnd",null),u([d({readOnly:!0,json:{read:!1}})],Oh.prototype,"isAllTime",null),u([d({readOnly:!0,json:{read:!1}})],Oh.prototype,"isEmpty",null),u([d({type:Date,json:{write:{allowNull:!0}}})],Oh.prototype,"start",void 0),u([Oe("start")],Oh.prototype,"readStart",null),u([Ne("start")],Oh.prototype,"writeStart",null),Oh=pf=u([$("esri.TimeExtent")],Oh);const Bpe=new Oh,Hit=new Oh({start:void 0,end:void 0}),Zc=Oh;let nT=class extends xr(fe){constructor(e){super(e),this.onFields=null,this.operator=null,this.searchTerm=null,this.searchType=null}};u([d({type:[String],json:{write:{enabled:!0,overridePolicy(){return{enabled:v(this.onFields)&&this.onFields.length>0}}}}})],nT.prototype,"onFields",void 0),u([d({type:String,json:{write:!0}})],nT.prototype,"operator",void 0),u([d({type:String,json:{write:!0}})],nT.prototype,"searchTerm",void 0),u([d({type:String,json:{write:!0}})],nT.prototype,"searchType",void 0),nT=u([$("esri.rest.support.FullTextSearch")],nT);const qit=nT;var XJ;const jpe=new mi({upperLeft:"upper-left",lowerLeft:"lower-left"});let sT=XJ=class extends fe{constructor(t){super(t),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new XJ(se({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};u([d({type:ni,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],sT.prototype,"extent",void 0),u([d({type:["view","edit"],json:{write:!0}})],sT.prototype,"mode",void 0),u([d({type:String,json:{read:jpe.read,write:jpe.write}})],sT.prototype,"originPosition",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],sT.prototype,"tolerance",void 0),sT=XJ=u([$("esri.rest.support.QuantizationParameters")],sT);const mOe=sT;var YJ;const Gpe=new mi({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let ff=YJ=class extends fe{constructor(t){super(t),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(t,e){this.statisticType!=="percentile-continuous"&&this.statisticType!=="percentile-discrete"||(e.statisticParameters=se(t))}clone(){return new YJ({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:se(this.statisticParameters)})}};u([d({type:Number,json:{write:!0}})],ff.prototype,"maxPointCount",void 0),u([d({type:Number,json:{write:!0}})],ff.prototype,"maxRecordCount",void 0),u([d({type:Number,json:{write:!0}})],ff.prototype,"maxVertexCount",void 0),u([d({type:String,json:{write:!0}})],ff.prototype,"onStatisticField",void 0),u([d({type:String,json:{write:!0}})],ff.prototype,"outStatisticFieldName",void 0),u([d({type:String,json:{read:{source:"statisticType",reader:Gpe.read},write:{target:"statisticType",writer:Gpe.write}}})],ff.prototype,"statisticType",void 0),u([d({type:Object})],ff.prototype,"statisticParameters",void 0),u([Ne("statisticParameters")],ff.prototype,"writeStatisticParameters",null),ff=YJ=u([$("esri.rest.support.StatisticDefinition")],ff);const gOe=ff;var $R;const Wit=new mi({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),Xit=new mi({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let qt=$R=class extends fe{static from(t){return uM($R,t)}constructor(t){super(t),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.fullText=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}castDatumTransformation(t){return typeof t=="number"||typeof t=="object"?t:null}writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeParameterValues(t,e){if(t){const i={};for(const r in t){const n=t[r];Array.isArray(n)?i[r]=n.map(s=>s instanceof Date?s.getTime():s):n instanceof Date?i[r]=n.getTime():i[r]=n}e.parameterValues=i}}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,e.where="1=1"}writeWhere(t,e){e.where=t||"1=1"}clone(){return new $R(se({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,fullText:this.fullText,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:v(this.historicMoment)?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};qt.MAX_MAX_RECORD_COUNT_FACTOR=5,u([d({json:{write:!0}})],qt.prototype,"aggregateIds",void 0),u([d({type:Boolean,json:{write:!0}})],qt.prototype,"cacheHint",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],qt.prototype,"compactGeometryEnabled",void 0),u([d({json:{write:!0}})],qt.prototype,"datumTransformation",void 0),u([ri("datumTransformation")],qt.prototype,"castDatumTransformation",null),u([d({type:Boolean,json:{default:!1,write:!0}})],qt.prototype,"defaultSpatialReferenceEnabled",void 0),u([d({type:Number,json:{write:{overridePolicy:t=>({enabled:t>0})}}})],qt.prototype,"distance",void 0),u([d({type:Vf,json:{write:!0}})],qt.prototype,"dynamicDataSource",void 0),u([d({type:String,json:{write:!0}})],qt.prototype,"formatOf3DObjects",void 0),u([d({type:[qit],json:{write:{enabled:!0,overridePolicy(){return{enabled:v(this.fullText)&&this.fullText.length>0}}}}})],qt.prototype,"fullText",void 0),u([d({type:String,json:{write:!0}})],qt.prototype,"gdbVersion",void 0),u([d({types:Iw,json:{read:ly,write:!0}})],qt.prototype,"geometry",void 0),u([d({type:Number,json:{write:!0}})],qt.prototype,"geometryPrecision",void 0),u([d({type:[String],json:{write:!0}})],qt.prototype,"groupByFieldsForStatistics",void 0),u([d({type:String,json:{write:!0}})],qt.prototype,"having",void 0),u([d({type:Date})],qt.prototype,"historicMoment",void 0),u([Ne("historicMoment")],qt.prototype,"writeHistoricMoment",null),u([d({type:Number,json:{write:!0}})],qt.prototype,"maxAllowableOffset",void 0),u([d({type:Number,cast:t=>t<1?1:t>$R.MAX_MAX_RECORD_COUNT_FACTOR?$R.MAX_MAX_RECORD_COUNT_FACTOR:t,json:{write:{overridePolicy:t=>({enabled:t>1})}}})],qt.prototype,"maxRecordCountFactor",void 0),u([d({type:["xyFootprint"],json:{write:!0}})],qt.prototype,"multipatchOption",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],qt.prototype,"num",void 0),u([d({json:{write:!0}})],qt.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],qt.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],qt.prototype,"outFields",void 0),u([d({type:Je,json:{name:"outSR",write:!0}})],qt.prototype,"outSpatialReference",void 0),u([d({type:[gOe],json:{write:{enabled:!0,overridePolicy(){return{enabled:v(this.outStatistics)&&this.outStatistics.length>0}}}}})],qt.prototype,"outStatistics",void 0),u([d({json:{write:!0}})],qt.prototype,"parameterValues",void 0),u([Ne("parameterValues")],qt.prototype,"writeParameterValues",null),u([d({type:Le,json:{write:!0}})],qt.prototype,"pixelSize",void 0),u([d({type:mOe,json:{write:!0}})],qt.prototype,"quantizationParameters",void 0),u([d({type:[Object],json:{write:!0}})],qt.prototype,"rangeValues",void 0),u([d({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:this.spatialRelationship==="relation"}}}}})],qt.prototype,"relationParameter",void 0),u([d({type:String,json:{write:!0}})],qt.prototype,"resultType",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],qt.prototype,"returnCentroid",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],qt.prototype,"returnDistinctValues",void 0),u([d({type:Boolean,json:{default:!0,write:!0}})],qt.prototype,"returnExceededLimitFeatures",void 0),u([d({type:Boolean,json:{write:!0}})],qt.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],qt.prototype,"returnQueryGeometry",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],qt.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],qt.prototype,"returnZ",void 0),u([d({type:Je,json:{write:!0}})],qt.prototype,"sourceSpatialReference",void 0),u([ot(Wit,{ignoreUnknown:!1,name:"spatialRel"})],qt.prototype,"spatialRelationship",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],qt.prototype,"start",void 0),u([Ne("start"),Ne("num")],qt.prototype,"writeStart",null),u([d({type:String,json:{write:!0}})],qt.prototype,"sqlFormat",void 0),u([d({type:String,json:{write:!0}})],qt.prototype,"text",void 0),u([d({type:Zc,json:{write:!0}})],qt.prototype,"timeExtent",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],qt.prototype,"timeReferenceUnknownClient",void 0),u([ot(Xit,{ignoreUnknown:!1}),d({json:{write:{overridePolicy(t){return{enabled:!!t&&this.distance!=null&&this.distance>0}}}}})],qt.prototype,"units",void 0),u([d({type:String,json:{write:{overridePolicy(t){return{enabled:t!=null||this.start!=null&&this.start>0}}}}})],qt.prototype,"where",void 0),u([Ne("where")],qt.prototype,"writeWhere",null),qt=$R=u([$("esri.rest.support.Query")],qt);const xp=qt;async function yG(t,e,i){const r=await Yit(t,e,i);return Xse.fromJSON(r)}async function Yit(t,e,i){const r=qse(t),n={...i},s=xp.from(e),{data:o}=await Vit(r,s,s.sourceSpatialReference,n);return o}function yl(t,e){return t?e?4:3:e?3:2}const CO=re.getLogger("esri.layers.graphics.featureConversionUtils"),yOe={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0},Zit=(t,e,i,r,n,s)=>{t[i]=n,t[i+1]=s},Hpe=(t,e,i,r,n,s)=>{t[i]=n,t[i+1]=s,t[i+2]=e[r+2]},Jit=(t,e,i,r,n,s)=>{t[i]=n,t[i+1]=s,t[i+2]=e[r+3]},Kit=(t,e,i,r,n,s)=>{t[i]=n,t[i+1]=s,t[i+2]=e[r+2],t[i+3]=e[r+3]};function Yse(t,e,i,r){if(t){if(i)return e&&r?Kit:Hpe;if(e&&r)return Jit}else if(e&&r)return Hpe;return Zit}function _G({scale:t,translate:e},i){return Math.round((i-e[0])/t[0])}function vG({scale:t,translate:e},i){return Math.round((e[1]-i)/t[1])}function bG({scale:t,translate:e},i,r){return i*t[r]+e[r]}function D9t(t,e,i){return t?e?i?Kse(t):Zse(t):i?Jse(t):TB(t):null}function TB(t){const e=t.coords;return{x:e[0],y:e[1]}}function _Oe(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t}function Zse(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2]}}function Qit(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t}function Jse(t){const e=t.coords;return{x:e[0],y:e[1],m:e[2]}}function ert(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.m,t}function Kse(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2],m:e[3]}}function trt(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t.coords[3]=e.m,t}function irt(t,e,i,r){let n=TB;i&&r?n=Kse:i?n=Zse:r&&(n=Jse);for(const s of e){const{geometry:o,attributes:a}=s,l=v(o)?n(o):null;t.push({attributes:a,geometry:l})}return t}function Qse(t,e){return t&&e?trt:t?Qit:e?ert:_Oe}function vOe(t,e,i,r,n){const s=Qse(i,r);for(const{geometry:o,attributes:a}of e){const l=v(o)?s(new vm,o):null;t.push(new uw(l,a,null,n?a[n]:void 0))}return t}function N9t(t,e,i=Qse(e.z!=null,e.m!=null)){return i(t,e)}function rrt(t,e,i,r){for(const{geometry:n,attributes:s}of e)t.push({attributes:s,geometry:v(n)?bOe(n,i,r):null});return t}function bOe(t,e,i){if(R(t))return null;const r=yl(e,i),n=[];for(let s=0;s<t.coords.length;s+=r){const o=[];for(let a=0;a<r;a++)o.push(t.coords[s+a]);n.push(o)}return e?i?{points:n,hasZ:e,hasM:i}:{points:n,hasZ:e}:i?{points:n,hasM:i}:{points:n}}function wOe(t,e,i,r,n){const s=yl(i,r);for(const{geometry:o,attributes:a}of e){const l=v(o)?xOe(new vm,o,s):null;t.push(new uw(l,a,null,n?a[n]:void 0))}return t}function xOe(t,e,i=yl(e.hasZ,e.hasM)){t.lengths[0]=e.points.length;const r=t.coords;let n=0;for(const s of e.points)for(let o=0;o<i;o++)r[n++]=s[o];return t}function nrt(t,e,i,r){for(const{geometry:n,attributes:s}of e)t.push({attributes:s,geometry:v(n)?TOe(n,i,r):null});return t}function TOe(t,e,i){if(!t)return null;const r=yl(e,i),{coords:n,lengths:s}=t,o=[];let a=0;for(const l of s){const c=[];for(let h=0;h<l;h++){const p=[];for(let f=0;f<r;f++)p.push(n[a++]);c.push(p)}o.push(c)}return e?i?{paths:o,hasZ:e,hasM:i}:{paths:o,hasZ:e}:i?{paths:o,hasM:i}:{paths:o}}function SOe(t,e,i,r,n){const s=yl(i,r);for(const{geometry:o,attributes:a}of e){const l=v(o)?EOe(new vm,o,s):null;t.push(new uw(l,a,null,n?a[n]:void 0))}return t}function EOe(t,e,i=yl(e.hasZ,e.hasM)){const{lengths:r,coords:n}=t;let s=0;for(const o of e.paths){for(const a of o)for(let l=0;l<i;l++)n[s++]=a[l];r.push(o.length)}return t}function srt(t,e,i,r){for(const{geometry:n,attributes:s,centroid:o}of e){const a=v(n)?COe(n,i,r):null;if(v(o)){const l=TB(o);t.push({attributes:s,centroid:l,geometry:a})}else t.push({attributes:s,geometry:a})}return t}function COe(t,e,i){if(!t)return null;const r=yl(e,i),{coords:n,lengths:s}=t,o=[];let a=0;for(const l of s){const c=[];for(let h=0;h<l;h++){const p=[];for(let f=0;f<r;f++)p.push(n[a++]);c.push(p)}o.push(c)}return e?i?{rings:o,hasZ:e,hasM:i}:{rings:o,hasZ:e}:i?{rings:o,hasM:i}:{rings:o}}function AOe(t,e,i,r,n){for(const{geometry:s,centroid:o,attributes:a}of e){const l=v(s)?ROe(new vm,s,i,r):null,c=n?a[n]:void 0;v(o)?t.push(new uw(l,a,_Oe(new vm,o),c)):t.push(new uw(l,a,null,c))}return t}function ROe(t,e,i=e.hasZ,r=e.hasM){return ort(t,e.rings,i,r),t}function ort(t,e,i,r){const n=yl(i,r),{lengths:s,coords:o}=t;let a=0;o_(t);for(const l of e){for(const c of l)for(let h=0;h<n;h++)o[a++]=c[h];s.push(l.length)}return t}const LR=[],D$=[];function F9t(t,e,i,r,n){LR[0]=t;const[s]=MOe(D$,LR,e,i,r,n);return bm(LR),bm(D$),s}function MOe(t,e,i,r,n,s){if(bm(t),!i){for(const o of e){const a=s?o.attributes[s]:void 0;t.push(new uw(null,o.attributes,null,a))}return t}switch(i){case"esriGeometryPoint":return vOe(t,e,r,n,s);case"esriGeometryMultipoint":return wOe(t,e,r,n,s);case"esriGeometryPolyline":return SOe(t,e,r,n,s);case"esriGeometryPolygon":return AOe(t,e,r,n,s);default:CO.error("convertToFeatureSet:unknown-geometry",new H(`Unable to parse unknown geometry type '${i}'`)),bm(t)}return t}function k9t(t,e,i,r,n,s){const o=t.length;switch(i){case"esriGeometryPoint":vOe(t,e,r,n,s);break;case"esriGeometryMultipoint":wOe(t,e,r,n,s);break;case"esriGeometryPolyline":SOe(t,e,r,n,s);break;case"esriGeometryPolygon":AOe(t,e,r,n,s);break;default:CO.error("convertToFeatureSet:unknown-geometry",new H(`Unable to parse unknown geometry type '${i}'`))}for(let a=0;a<e.length;a++)t[a+o].geometryType=i,t[a+o].insertAfter=e[a].insertAfter,t[a+o].groupId=e[a].groupId;return t}function U9t(t,e,i,r){D$[0]=t,OOe(LR,D$,e,i,r);const n=LR[0];return bm(LR),bm(D$),n}function art(t,e,i){if(R(t))return null;const r=new vm;return"hasZ"in t&&e==null&&(e=t.hasZ),"hasM"in t&&i==null&&(i=t.hasM),yN(t)?Qse(e??t.z!=null,i??t.m!=null)(r,t):s_(t)?ROe(r,t,e,i):dO(t)?EOe(r,t,yl(e,i)):gN(t)?xOe(r,t,yl(e,i)):void CO.error("convertFromGeometry:unknown-geometry",new H(`Unable to parse unknown geometry type '${t}'`))}function lrt(t,e,i,r){const n=t&&("coords"in t?t:t.geometry);if(R(n))return null;switch(e){case"esriGeometryPoint":{let s=TB;return i&&r?s=Kse:i?s=Zse:r&&(s=Jse),s(n)}case"esriGeometryMultipoint":return bOe(n,i,r);case"esriGeometryPolyline":return TOe(n,i,r);case"esriGeometryPolygon":return COe(n,i,r);default:return CO.error("convertToGeometry:unknown-geometry",new H(`Unable to parse unknown geometry type '${e}'`)),null}}function crt(t,e){for(const i of e)t.push({attributes:i.attributes});return t}function OOe(t,e,i,r,n){if(bm(t),R(i))return crt(t,e);switch(i){case"esriGeometryPoint":return irt(t,e,r,n);case"esriGeometryMultipoint":return rrt(t,e,r,n);case"esriGeometryPolyline":return nrt(t,e,r,n);case"esriGeometryPolygon":return srt(t,e,r,n);default:CO.error("convertToFeatureSet:unknown-geometry",new H(`Unable to parse unknown geometry type '${i}'`))}return t}function V9t(t){const{objectIdFieldName:e,spatialReference:i,transform:r,fields:n,hasM:s,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:h,queryGeometry:p,queryGeometryType:f}=t,m={features:OOe([],a,l,o,s),fields:n,geometryType:l,objectIdFieldName:e,spatialReference:i,uniqueIdField:h,queryGeometry:lrt(p,f,!1,!1)};return r&&(m.transform=r),c&&(m.exceededTransferLimit=c),s&&(m.hasM=s),o&&(m.hasZ=o),m}function z9t(t,e){const i=new dOe,{hasM:r,hasZ:n,features:s,objectIdFieldName:o,spatialReference:a,geometryType:l,exceededTransferLimit:c,transform:h,fields:p}=t;return p&&(i.fields=p),i.geometryType=l??null,i.objectIdFieldName=o??e??null,i.spatialReference=a??null,i.objectIdFieldName?(s&&MOe(i.features,s,l,n,r,i.objectIdFieldName),c&&(i.exceededTransferLimit=c),r&&(i.hasM=r),n&&(i.hasZ=n),h&&(i.transform=h),i):(CO.error(new H("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),i)}function B9t(t){const{transform:e,features:i,hasM:r,hasZ:n}=t;if(!e)return t;for(const s of i)v(s.geometry)&&Wpe(s.geometry,s.geometry,r,n,e),v(s.centroid)&&Wpe(s.centroid,s.centroid,r,n,e);return t.transform=null,t}function j9t(t,e){const{geometryType:i,features:r,hasM:n,hasZ:s}=e;if(!t)return e;for(let o=0;o<r.length;o++){const a=r[o],l=a.weakClone();l.geometry=new vm,qpe(l.geometry,a.geometry,n,s,i,t),a.centroid&&(l.centroid=new vm,qpe(l.centroid,a.centroid,n,s,"esriGeometryPoint",t)),r[o]=l}return e.transform=t,e}function qpe(t,e,i,r,n,s,o=i,a=r){if(o_(t),R(e)||!e.coords.length)return null;const l=yOe[n],{coords:c,lengths:h}=e,p=yl(i,r),f=yl(i&&o,r&&a),m=Yse(i,r,o,a);if(!h.length)return m(t.coords,c,0,0,_G(s,c[0]),vG(s,c[1])),o_(t,p,0),t;let g,_,b,w,x=0,T=0,E=T;for(const C of h){if(C<l)continue;let A=0;T=E,b=g=_G(s,c[x]),w=_=vG(s,c[x+1]),m(t.coords,c,T,x,b,w),A++,x+=p,T+=f;for(let I=1;I<C;I++,x+=p)b=_G(s,c[x]),w=vG(s,c[x+1]),b===g&&w===_||(m(t.coords,c,T,x,b-g,w-_),T+=f,A++,g=b,_=w);A>=l&&(t.lengths.push(A),E=T)}return bm(t.coords,E),t.coords.length?t:null}function G9t(t,e,i,r,n,s,o=i,a=r){if(o_(t),!e||!e.coords.length)return null;const l=yOe[n],{coords:c,lengths:h}=e,p=yl(i,r),f=yl(i&&o,r&&a),m=Yse(i,r,o,a);if(!h.length)return m(t.coords,c,0,0,c[0],c[1]),o_(t,p,0),t;let g=0;const _=s*s;for(const b of h){if(b<l){g+=b*p;continue}const w=t.coords.length/f,x=g,T=g+(b-1)*p;m(t.coords,c,t.coords.length,x,c[x],c[x+1]),ZJ(t.coords,c,p,_,m,x,T),m(t.coords,c,t.coords.length,T,c[T],c[T+1]);const E=t.coords.length/f-w;E>=l?t.lengths.push(E):bm(t.coords,w*f),g+=b*p}return t.coords.length?t:null}function urt(t,e,i,r){const n=t[e],s=t[e+1],o=t[i],a=t[i+1],l=t[r],c=t[r+1];let h=o,p=a,f=l-h,m=c-p;if(f!==0||m!==0){const g=((n-h)*f+(s-p)*m)/(f*f+m*m);g>1?(h=l,p=c):g>0&&(h+=f*g,p+=m*g)}return f=n-h,m=s-p,f*f+m*m}function ZJ(t,e,i,r,n,s,o){let a,l=r,c=0;for(let h=s+i;h<o;h+=i)a=urt(e,h,s,o),a>l&&(c=h,l=a);l>r&&(c-s>i&&ZJ(t,e,i,r,n,s,c),n(t,e,t.length,c,e[c],e[c+1]),o-c>i&&ZJ(t,e,i,r,n,c,o))}function H9t(t,e,i,r){if(R(e)||!e.coords||!e.coords.length)return null;const n=yl(i,r);let s=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(e&&e.coords){const c=e.coords;for(let h=0;h<c.length;h+=n){const p=c[h],f=c[h+1];s=Math.min(s,p),a=Math.max(a,p),o=Math.min(o,f),l=Math.max(l,f)}}return vZ(t)?xWe(t,s,o,a,l):Dne(s,o,a,l,t),t}function Wpe(t,e,i,r,n){const{coords:s,lengths:o}=e,a=yl(i,r);if(!s.length)return t!==e&&o_(t),t;C9(n);const{originPosition:l,scale:c,translate:h}=n,p=drt;p.originPosition=l;const f=p.scale;f[0]=c[0]??1,f[1]=-(c[1]??1),f[2]=c[2]??1,f[3]=c[3]??1;const m=p.translate;if(m[0]=h[0]??0,m[1]=h[1]??0,m[2]=h[2]??0,m[3]=h[3]??0,!o.length){for(let _=0;_<a;++_)t.coords[_]=bG(p,s[_],_);return t!==e&&o_(t,a,0),t}let g=0;for(let _=0;_<o.length;_++){const b=o[_];t.lengths[_]=b;for(let T=0;T<a;++T)t.coords[g+T]=bG(p,s[g+T],T);let w=t.coords[g],x=t.coords[g+1];g+=a;for(let T=1;T<b;T++,g+=a){w+=s[g]*f[0],x+=s[g+1]*f[1],t.coords[g]=w,t.coords[g+1]=x;for(let E=2;E<a;++E)t.coords[g+E]=bG(p,s[g+E],E)}}return t!==e&&o_(t,s.length,o.length),t}function q9t(t,e,i,r,n,s){if(o_(t),t.lengths.push(...e.lengths),i===n&&r===s)for(let o=0;o<e.coords.length;o++)t.coords.push(e.coords[o]);else{const o=yl(i,r),a=Yse(i,r,n,s),l=e.coords;for(let c=0;c<l.length;c+=o)a(t.coords,l,t.coords.length,c,l[c],l[c+1])}return t}function hrt(t,e,i,r){let n=0,s=t[r*e],o=t[r*(e+1)];for(let a=1;a<i;a++){const l=s+t[r*(e+a)],c=o+t[r*(e+a)+1],h=(l-s)*(c+o);s=l,o=c,n+=h}return .5*n}function W9t(t,e){const{coords:i,lengths:r}=t;let n=0,s=0;for(let o=0;o<r.length;o++){const a=r[o];s+=hrt(i,n,a,e),n+=a}return Math.abs(s)}function X9t(t,e){if(R(t))return null;const i=t.clone(),r=t.coords,n=t.lengths;let s=0;for(let o=0;o<n.length;o++){const a=n[o];let l=r[e*s],c=r[e*s+1];for(let h=1;h<a;h++){const p=l+r[e*(s+h)],f=c+r[e*(s+h)+1];i.coords[e*(s+h)]=p,i.coords[e*(s+h)+1]=f,l=p,c=f}s+=a}return i}function o_(t,e=0,i=0){bm(t.lengths,i),bm(t.coords,e)}function bm(t,e=0){t.length!==e&&(t.length=e)}const drt={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]};var JJ;let _s=JJ=class extends fe{constructor(t){super(t),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,this.start>0&&this.where==null&&(e.definitionExpression="1=1")}clone(){return new JJ(se({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};u([d({type:Boolean,json:{write:!0}})],_s.prototype,"cacheHint",void 0),u([d({type:Vf,json:{write:!0}})],_s.prototype,"dynamicDataSource",void 0),u([d({type:String,json:{write:!0}})],_s.prototype,"gdbVersion",void 0),u([d({type:Number,json:{write:!0}})],_s.prototype,"geometryPrecision",void 0),u([d({type:Date})],_s.prototype,"historicMoment",void 0),u([Ne("historicMoment")],_s.prototype,"_writeHistoricMoment",null),u([d({type:Number,json:{write:!0}})],_s.prototype,"maxAllowableOffset",void 0),u([d({type:[Number],json:{write:!0}})],_s.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],_s.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],_s.prototype,"outFields",void 0),u([d({type:Je,json:{read:{source:"outSR"},write:{target:"outSR"}}})],_s.prototype,"outSpatialReference",void 0),u([d({json:{write:!0}})],_s.prototype,"relationshipId",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],_s.prototype,"start",void 0),u([Ne("start"),Ne("num")],_s.prototype,"writeStart",null),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],_s.prototype,"num",void 0),u([d({json:{write:!0}})],_s.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],_s.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],_s.prototype,"returnZ",void 0),u([d({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],_s.prototype,"where",void 0),_s=JJ=u([$("esri.rest.support.RelationshipQuery")],_s),_s.from=Ts(_s);const $M=_s,Y9t=Object.freeze(Object.defineProperty({__proto__:null,default:$M},Symbol.toStringTag,{value:"Module"}));var KJ;let UC=KJ=class extends fe{constructor(t){super(t),this.groupByFields=void 0,this.topCount=void 0,this.orderByFields=void 0}clone(){return new KJ({groupByFields:this.groupByFields,topCount:this.topCount,orderByFields:this.orderByFields})}};u([d({type:[String],json:{write:!0}})],UC.prototype,"groupByFields",void 0),u([d({type:Number,json:{write:!0}})],UC.prototype,"topCount",void 0),u([d({type:[String],json:{write:!0}})],UC.prototype,"orderByFields",void 0),UC=KJ=u([$("esri.rest.support.TopFilter")],UC);const prt=UC;var QJ;const Xpe=new mi({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),Ype=new mi({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let jn=QJ=class extends fe{constructor(t){super(t),this.cacheHint=void 0,this.distance=void 0,this.geometry=null,this.geometryPrecision=void 0,this.maxAllowableOffset=void 0,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.resultType=null,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.start=void 0,this.spatialRelationship="intersects",this.timeExtent=null,this.topFilter=void 0,this.units=null,this.where="1=1"}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new QJ(se({cacheHint:this.cacheHint,distance:this.distance,geometry:this.geometry,geometryPrecision:this.geometryPrecision,maxAllowableOffset:this.maxAllowableOffset,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,resultType:this.resultType,returnGeometry:this.returnGeometry,returnZ:this.returnZ,returnM:this.returnM,start:this.start,spatialRelationship:this.spatialRelationship,timeExtent:this.timeExtent,topFilter:this.topFilter,units:this.units,where:this.where}))}};u([d({type:Boolean,json:{write:!0}})],jn.prototype,"cacheHint",void 0),u([d({type:Number,json:{write:{overridePolicy:t=>({enabled:t>0})}}})],jn.prototype,"distance",void 0),u([d({types:Iw,json:{read:ly,write:!0}})],jn.prototype,"geometry",void 0),u([d({type:Number,json:{write:!0}})],jn.prototype,"geometryPrecision",void 0),u([d({type:Number,json:{write:!0}})],jn.prototype,"maxAllowableOffset",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],jn.prototype,"num",void 0),u([d({json:{write:!0}})],jn.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],jn.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],jn.prototype,"outFields",void 0),u([d({type:Je,json:{read:{source:"outSR"},write:{target:"outSR"}}})],jn.prototype,"outSpatialReference",void 0),u([d({type:String,json:{write:!0}})],jn.prototype,"resultType",void 0),u([d({json:{write:!0}})],jn.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],jn.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],jn.prototype,"returnZ",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],jn.prototype,"start",void 0),u([Ne("start"),Ne("num")],jn.prototype,"writeStart",null),u([d({type:String,json:{read:{source:"spatialRel",reader:Xpe.read},write:{target:"spatialRel",writer:Xpe.write}}})],jn.prototype,"spatialRelationship",void 0),u([d({type:Zc,json:{write:!0}})],jn.prototype,"timeExtent",void 0),u([d({type:prt,json:{write:!0}})],jn.prototype,"topFilter",void 0),u([d({type:String,json:{read:Ype.read,write:{writer:Ype.write,overridePolicy(t){return{enabled:v(t)&&v(this.distance)&&this.distance>0}}}}})],jn.prototype,"units",void 0),u([d({type:String,json:{write:!0}})],jn.prototype,"where",void 0),jn=QJ=u([$("esri.rest.support.TopFeaturesQuery")],jn),jn.from=Ts(jn);const t4=jn,frt="esri.widgets.Feature.support.relatedFeatureUtils",Zpe=re.getLogger(frt),Jpe=new Map;function V6(t){if(!Y0(t))return null;const[e,i]=t.split("/").slice(1);return{layerId:e,fieldName:i}}function mrt(t,e){if(!e.relationships)return null;let i=null;const{relationships:r}=e;return r.some(n=>n.id===parseInt(t,10)&&(i=n,!0)),i}function grt({originRelationship:t,relationships:e,layerId:i}){let r=null;return e&&e.some(n=>(`${n.relatedTableId}`===i&&n.id===(t==null?void 0:t.id)&&(r=n),!!r)),r}function yrt(t,e){const i=e.toLowerCase();for(const r in t)if(r.toLowerCase()===i)return t[r];return null}function _rt(t,e){const i=mrt(t,e);if(i)return{url:`${e.url}/${i.relatedTableId}`,sourceSpatialReference:e.spatialReference,relation:i,relatedFields:[],outStatistics:[]}}function vrt(t,e){if(!e||!t)return;const{features:i,statsFeatures:r}=t,n=i&&i.value;e.relatedFeatures=n?n.features:[];const s=r&&r.value;e.relatedStatsFeatures=s?s.features:[]}function brt(t,e,i,r){var s;const n=new $M;return n.outFields=["*"],n.relationshipId=typeof e.id=="number"?e.id:parseInt(e.id,10),n.objectIds=[t.attributes[i.objectIdField]],((s=i.queryRelatedFeatures)==null?void 0:s.call(i,n,r))??Promise.resolve({})}function wrt(t,e,i){let r=0;const n=[];for(;r<e.length;)n.push(`${t} IN (${e.slice(r,i+r)})`),r+=i;return n.join(" OR ")}async function xrt(t,e,i,r){const n=i.layerId.toString(),{layerInfo:s,relation:o,relatedFields:a,outStatistics:l,url:c,sourceSpatialReference:h}=e;if(!s||!o)return null;const p=grt({originRelationship:o,relationships:s.relationships,layerId:n});if(p!=null&&p.relationshipTableId&&p.keyFieldInRelationshipTable){const m=(await brt(t,p,i,r))[t.attributes[i.objectIdField]];if(!m)return null;const g=m.features.map(_=>_.attributes[s.objectIdField]);if(l!=null&&l.length&&s.supportsStatistics){const _=new xp;_.where=wrt(s.objectIdField,g,1e3),_.outFields=a,_.outStatistics=l,_.sourceSpatialReference=h;const b={features:Promise.resolve(m),statsFeatures:yG(c,_)};return ma(b)}}const f=p==null?void 0:p.keyField;if(f){const m=N9(Art(s.fields,f)),g=yrt(t.attributes,o.keyField),_=m?`${f}=${g}`:`${f}='${g}'`,b=yG(c,new xp({where:_,outFields:e.relatedFields,sourceSpatialReference:h}),r),w=e.outStatistics&&e.outStatistics.length>0&&s.supportsStatistics?yG(c,new xp({where:_,outFields:e.relatedFields,outStatistics:e.outStatistics,sourceSpatialReference:h}),r):null,x={features:b};return w&&(x.statsFeatures=w),ma(x)}return null}function Trt(t,e){return ir(t,{query:{f:"json"},signal:e&&e.signal})}function Srt({relatedInfos:t,layer:e},i){const r={};return t.forEach((n,s)=>{const{relation:o}=n;if(!o){const p=new H("relation-required","A relation is required on a layer to retrieve related records.");throw Zpe.error(p),p}const{relatedTableId:a}=o;if(typeof a!="number"){const p=new H("A related table ID is required on a layer to retrieve related records.");throw Zpe.error(p),p}const l=`${e.url}/${a}`,c=Jpe.get(l),h=c||Trt(l);c||Jpe.set(l,h),r[s]=h}),Qre(ma(r),i)}function Ert({graphic:t,relatedInfos:e,layer:i},r){const n={};return e.forEach((s,o)=>{s.layerInfo&&(n[o]=xrt(t,s,i,r))}),ma(n)}function Crt({relatedInfo:t,fieldName:e,fieldInfo:i}){var r,n;if((r=t.relatedFields)==null||r.push(e),i.statisticType){const s=new gOe({statisticType:i.statisticType,onStatisticField:e,outStatisticFieldName:e});(n=t.outStatistics)==null||n.push(s)}}function Art(t,e){if(t!=null){e=e.toLowerCase();for(const i of t)if(i&&i.name.toLowerCase()===e)return i}return null}const Kpe={chartAnimation:!0};let To=class extends ve{constructor(e){super(e),this.abilities={...Kpe},this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.isAggregate=!1,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(e){return{...Kpe,...e}}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){const{formattedMediaInfoCount:i}=this,r=(e+i)%i;this.activeMediaInfoIndex=r}_pageContentElementMedia(e){const{activeMediaInfoIndex:i}=this,r=i+e;this._setContentElementMedia(r)}_formatMediaInfos(){const{mediaInfos:e,layer:i}=this,r=this.attributes??{},n=this.formattedAttributes??{},s=this.expressionAttributes??{},o=this.fieldInfoMap??new Map;return(e==null?void 0:e.map(a=>{const l=a==null?void 0:a.clone();if(!l)return null;if(l.title=vS({attributes:r,fieldInfoMap:o,globalAttributes:n,expressionAttributes:s,layer:i,text:l.title}),l.caption=vS({attributes:r,fieldInfoMap:o,globalAttributes:n,expressionAttributes:s,layer:i,text:l.caption}),l.altText=vS({attributes:r,fieldInfoMap:o,globalAttributes:n,expressionAttributes:s,layer:i,text:l.altText}),l.type==="image"){const{value:c}=l;return this._setImageValue({value:c,formattedAttributes:n,layer:i}),l.value.sourceURL?l:void 0}if(l.type==="pie-chart"||l.type==="line-chart"||l.type==="column-chart"||l.type==="bar-chart"){const{value:c}=l;return this._setChartValue({value:c,chartType:l.type,attributes:r,formattedAttributes:n,layer:i,expressionAttributes:s}),l}return null}).filter(v))??[]}_setImageValue(e){const i=this.fieldInfoMap??new Map,{value:r,formattedAttributes:n,layer:s}=e,{linkURL:o,sourceURL:a}=r;if(a){const l=AJ(a,s);r.sourceURL=CJ({formattedAttributes:n,template:l,fieldInfoMap:i})}if(o){const l=AJ(o,s);r.linkURL=CJ({formattedAttributes:n,template:l,fieldInfoMap:i})}}_setChartValue(e){const{value:i,attributes:r,formattedAttributes:n,chartType:s,layer:o,expressionAttributes:a}=e,{popupTemplate:l,relatedInfos:c}=this,{fields:h,normalizeField:p}=i,f=o;if(i.fields=tet(h,f),p&&(i.normalizeField=nD(p,f)),!h.some(g=>!!(n[g]!=null||Y0(g)&&(c!=null&&c.size))))return;const m=(l==null?void 0:l.fieldInfos)??[];h.forEach(g=>{if(Y0(g))return void(i.series=[...i.series,...this._getRelatedChartInfos({fieldInfos:m,fieldName:g,formattedAttributes:n,chartType:s,value:i})]);const _=this._getChartOption({value:i,attributes:r,chartType:s,formattedAttributes:n,expressionAttributes:a,fieldName:g,fieldInfos:m});i.series.push(_)})}_getRelatedChartInfos(e){var m;const{fieldInfos:i,fieldName:r,formattedAttributes:n,chartType:s,value:o}=e,a=[],l=V6(r),c=l&&((m=this.relatedInfos)==null?void 0:m.get(l.layerId.toString()));if(!c)return a;const{relatedFeatures:h,relation:p}=c;if(!p||!h)return a;const{cardinality:f}=p;return h.forEach(g=>{const{attributes:_}=g;_&&Object.keys(_).forEach(b=>{b===l.fieldName&&a.push(this._getChartOption({value:o,attributes:_,formattedAttributes:n,fieldName:r,chartType:s,relatedFieldName:b,hasMultipleRelatedFeatures:(h==null?void 0:h.length)>1,fieldInfos:i}))})}),f==="one-to-many"||f==="many-to-many"?a:[a[0]]}_getTooltip({label:e,value:i,chartType:r}){return r==="pie-chart"?`${e}`:`${e}: ${i}`}_getChartOption(e){var A;const{value:i,attributes:r,formattedAttributes:n,expressionAttributes:s,fieldName:o,relatedFieldName:a,fieldInfos:l,chartType:c,hasMultipleRelatedFeatures:h}=e,p=this.layer,f=this.fieldInfoMap??new Map,{normalizeField:m,tooltipField:g}=i,_=m?Y0(m)?r[V6(m).fieldName]:r[m]:null,b=Ose(o)&&s&&s[o]!==void 0?s[o]:a&&r[a]!==void 0?r[a]:r[o]!==void 0?r[o]:n[o],w=new FEe({fieldName:o,value:b===void 0?null:b&&_?b/_:b});if(Y0(o)){const I=f.get(o.toLowerCase()),O=g&&f.get(g.toLowerCase()),D=(I==null?void 0:I.fieldName)??o,U=h&&g?V6(g).fieldName:(O==null?void 0:O.fieldName)??g,V=h&&U?r[U]:n[U]??(I==null?void 0:I.label)??(I==null?void 0:I.fieldName)??a,B=h&&a?r[a]:n[D];return w.tooltip=this._getTooltip({label:V,value:B,chartType:c}),w}const x=$Me(l,o),T=nD(o,p),E=g&&n[g]!==void 0?n[g]:PMe(x||new _N({fieldName:T}),(A=this.popupTemplate)==null?void 0:A.expressionInfos),C=n[T];return w.tooltip=this._getTooltip({label:E,value:C,chartType:c}),w}};u([d()],To.prototype,"abilities",void 0),u([ri("abilities")],To.prototype,"castAbilities",null),u([d()],To.prototype,"activeMediaInfoIndex",void 0),u([d({readOnly:!0})],To.prototype,"activeMediaInfo",null),u([d()],To.prototype,"attributes",void 0),u([d()],To.prototype,"description",void 0),u([d()],To.prototype,"fieldInfoMap",void 0),u([d()],To.prototype,"formattedAttributes",void 0),u([d()],To.prototype,"expressionAttributes",void 0),u([d({readOnly:!0})],To.prototype,"formattedMediaInfos",null),u([d()],To.prototype,"isAggregate",void 0),u([d()],To.prototype,"layer",void 0),u([d({readOnly:!0})],To.prototype,"formattedMediaInfoCount",null),u([d()],To.prototype,"mediaInfos",void 0),u([d()],To.prototype,"popupTemplate",void 0),u([d()],To.prototype,"relatedInfos",void 0),u([d()],To.prototype,"title",void 0),To=u([$("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],To);const bS=To;var Qpe=["#ffffff","#858585","#ffbebe","#ffebbe","#ffebaf","#ffffbe","#e9ffbe","#d3ffbe","#beffe8","#bee8ff","#bed2ff","#e8beff","#ffbee8","#ebebeb","#707070","#ff7f7f","#ffa77f","#ffd37f","#ffff73","#d1ff73","#a3ff73","#73ffdf","#73dfff","#73b2ff","#df73ff","#ff73df","#d6d6d6","#5c5c5c","#ff0000","#ff5500","#ffaa00","#ffff00","#aaff00","#55ff00","#00ffc5","#00c5ff","#0070ff","#c500ff","#ff00c5","#c2c2c2","#474747","#e60000","#e64c00","#e69800","#e6e600","#98e600","#4ce600","#00e6a9","#00a9e6","#005ce6","#a900e6","#e600a9","#adadad","#242424","#a80000","#a83800","#a87000","#a8a800","#70a800","#38a800","#00a884","#0084a8","#004da8","#8400a8","#a80084","#999999","#1a1a1a","#730000","#732600","#734c00","#737300","#4c7300","#267300","#00734c","#004c73","#002673","#4c0073","#73004"],Rrt=[].concat(Qpe.slice(30,39),Qpe.slice(28,30).reverse()),Mrt=[{name:"default",colors:Rrt},{name:"cat-dark",colors:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99","#6b6bd6","#b54779","#7f7f7f"]},{name:"tropical-bliss",colors:["#fce138","#ff9399","#fcd27e","#f1983c","#a553b7","#b1a9d0","#6ecffc","#4c81cd","#fc6f84","#fc3e5a","#6af689","#48885c"]},{name:"desert-blooms",colors:["#102432","#144d59","#ffc730","#ed9310","#a64f1b","#661510","#d9351a","#b31515","#4a0932","#8c213f","#18382e","#2c6954"]},{name:"under-the-sea",colors:["#bf9727","#607100","#00734c","#704489","#01acca","#024e76","#f09100","#ea311f","#c6004b","#7570b3","#666666","#333333"]},{name:"vibrant-rainbow",colors:["#fffb00","#f5cb11","#9fd40c","#46e39c","#32b8a6","#7ff2fa","#ac08cc","#dd33ff","#eb7200","#e8a784","#bf2e2e","#6c7000"]},{name:"ocean-bay",colors:["#191921","#11495c","#78b1c2","#454f4b","#8f8f82","#9be0c0","#87b051","#f7ec88","#ebdcc1","#dbb658","#c43541","#75351e"]},{name:"prairie-summer",colors:["#332424","#751555","#d47013","#d68989","#211173","#82aad6","#7bfaeb","#6ec9a8","#6b6408","#eada40","#ccc54a","#1fc235"]},{name:"pastel-chalk",colors:["#fffd99","#f5e6a4","#c1d48c","#b8e3d0","#a0b8b5","#cbf7fa","#d791f2","#dfc1eb","#f2b983","#e8c4b2","#bf8e8e","#94995c"]},{name:"seq-yellow-orange-red-bright",colors:["#910000","#b1260b","#c0370f","#e05919","#ef6a1d","#ff7b22","#ffa143","#ffb454","#ffda74","#ffed85"]},{name:"seq-reds-bright",colors:["#57453b","#7b4238","#9f4036","#c23d33","#d7483c","#ec5244","#f3696c","#f9816c","#ffc4ae","#fff0dc"]},{name:"seq-purples-bright",colors:["#4e465c","#5a4a78","#695291","#775baa","#8663c3","#946bdc","#aa89e8","#c1a6f3","#d7c4ff","#e6e1ff"]},{name:"seq-blues-bright",colors:["#404d54","#435c6c","#48799d","#4b88b6","#4d96ce","#50a5e7","#74bbed","#98d0f3","#bce6f9","#e6faff"]},{name:"seq-greens-bright",colors:["#39544c","#386757","#368165","#359b73","#33b581","#4bc392","#64d2a2","#7ce0b3","#cbf6d9","#f4ffea"]},{name:"seq-browns-bright",colors:["#524834","#715b38","#8f6e3c","#ae8140","#cc9444","#eba748","#eeb664","#f0c47f","#f9e0b7","#fff8eb"]}];const efe="en-us",eoe=new Map([["ar",()=>Q(()=>import("./ar-bb1fe5ab.js"),["assets/ar-bb1fe5ab.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.a)],["bg-bg",()=>Q(()=>import("./bg_BG-184a2bfa.js"),["assets/bg_BG-184a2bfa.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.b)],["bs-ba",()=>Q(()=>import("./bs_BA-f32cc344.js"),["assets/bs_BA-f32cc344.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.b)],["ca-es",()=>Q(()=>import("./ca_ES-d17ee95b.js"),["assets/ca_ES-d17ee95b.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.c)],["cs-cz",()=>Q(()=>import("./cs_CZ-bcd1e782.js"),["assets/cs_CZ-bcd1e782.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.c)],["da-dk",()=>Q(()=>import("./da_DK-27b1b06e.js"),["assets/da_DK-27b1b06e.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.d)],["de-de",()=>Q(()=>import("./de_DE-c0a1d8dd.js"),["assets/de_DE-c0a1d8dd.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.d)],["de-ch",()=>Q(()=>import("./de_CH-be7b4255.js"),["assets/de_CH-be7b4255.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.d)],["el-gr",()=>Q(()=>import("./el_GR-05fb9ec0.js"),["assets/el_GR-05fb9ec0.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.e)],["en-us",()=>Q(()=>import("./en_US-170979d8.js"),["assets/en_US-170979d8.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.e)],["en-ca",()=>Q(()=>import("./en_CA-170979d8.js"),["assets/en_CA-170979d8.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.e)],["es-es",()=>Q(()=>import("./es_ES-d0b66640.js"),["assets/es_ES-d0b66640.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.e)],["et-ee",()=>Q(()=>import("./et_EE-56dd74d3.js"),["assets/et_EE-56dd74d3.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.e)],["fi-fi",()=>Q(()=>import("./fi_FI-91d58cb9.js"),["assets/fi_FI-91d58cb9.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.f)],["fr-fr",()=>Q(()=>import("./fr_FR-a11503e0.js"),["assets/fr_FR-a11503e0.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.f)],["he-il",()=>Q(()=>import("./he_IL-90db98c4.js"),["assets/he_IL-90db98c4.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.h)],["hr-hr",()=>Q(()=>import("./hr_HR-fac8bb29.js"),["assets/hr_HR-fac8bb29.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.h)],["hu-hu",()=>Q(()=>import("./hu_HU-e8803856.js"),["assets/hu_HU-e8803856.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.h)],["id-id",()=>Q(()=>import("./id_ID-86e57d06.js"),["assets/id_ID-86e57d06.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.i)],["it-it",()=>Q(()=>import("./it_IT-2d4485ba.js"),["assets/it_IT-2d4485ba.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.i)],["ja-jp",()=>Q(()=>import("./ja_JP-77c6c16d.js"),["assets/ja_JP-77c6c16d.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.j)],["ko-kr",()=>Q(()=>import("./ko_KR-e155b9ab.js"),["assets/ko_KR-e155b9ab.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.k)],["lt-lt",()=>Q(()=>import("./lt_LT-fde47ae9.js"),["assets/lt_LT-fde47ae9.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.l)],["lv-lv",()=>Q(()=>import("./lv_LV-359be050.js"),["assets/lv_LV-359be050.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.l)],["nb-no",()=>Q(()=>import("./nb_NO-30d57c1a.js"),["assets/nb_NO-30d57c1a.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.n)],["nl-nl",()=>Q(()=>import("./nl_NL-cb904b48.js"),["assets/nl_NL-cb904b48.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.n)],["pl-pl",()=>Q(()=>import("./pl_PL-58c54c9f.js"),["assets/pl_PL-58c54c9f.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.p)],["pt-br",()=>Q(()=>import("./pt_BR-d2e10248.js"),["assets/pt_BR-d2e10248.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.p)],["pt-pt",()=>Q(()=>import("./pt_PT-65a41842.js"),["assets/pt_PT-65a41842.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.p)],["ro-ro",()=>Q(()=>import("./ro_RO-15e90e9f.js"),["assets/ro_RO-15e90e9f.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.r)],["ru-ru",()=>Q(()=>import("./ru_RU-a74d21e5.js"),["assets/ru_RU-a74d21e5.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.r)],["sk-sk",()=>Q(()=>import("./sk_SK-a928dbd1.js"),["assets/sk_SK-a928dbd1.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.s)],["sl-sl",()=>Q(()=>import("./sl_SL-1a3c3078.js"),["assets/sl_SL-1a3c3078.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.s)],["sr-rs",()=>Q(()=>import("./sr_RS-0b18b911.js"),["assets/sr_RS-0b18b911.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.s)],["sv-se",()=>Q(()=>import("./sv_SE-ce7e3f84.js"),["assets/sv_SE-ce7e3f84.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.s)],["th-th",()=>Q(()=>import("./th_TH-1448f333.js"),["assets/th_TH-1448f333.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.t)],["tr-tr",()=>Q(()=>import("./tr_TR-dd92f630.js"),["assets/tr_TR-dd92f630.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.t)],["uk-ua",()=>Q(()=>import("./uk_UA-fe4434ed.js"),["assets/uk_UA-fe4434ed.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.u)],["vi-vn",()=>Q(()=>import("./vi_VN-41938633.js"),["assets/vi_VN-41938633.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.v)],["zh-cn",()=>Q(()=>import("./zh_Hans-524a1291.js"),["assets/zh_Hans-524a1291.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.z)],["zh-hk",()=>Q(()=>import("./zh_Hant-0e1f08e5.js"),["assets/zh_Hant-0e1f08e5.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.z)],["zh-tw",()=>Q(()=>import("./zh_Hant-0e1f08e5.js"),["assets/zh_Hant-0e1f08e5.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.z)]]);function Ort(t){const e=t.split("-")[0].toLowerCase();let i=null;for(const r of eoe.keys())if(r.startsWith(e)){i=r;break}return i}function Prt(t){return t?eoe.has(t.toLowerCase())?t.toLowerCase():Ort(t)||efe:efe}let sE=null,v3=null;async function Irt(t=wp()){if(t=Prt(t),sE&&t===v3)return sE;sE=Q(()=>import("./index-a70dd312.js"),["assets/index-a70dd312.js","assets/_commonjsHelpers-2f3e7994.js"]).then(e=>e.i),v3=t;try{const[e,i]=await Promise.all([sE,eoe.get(v3)()]);v3===t&&(e.am4core.options.defaultLocale=i.default),e.am4core.options.suppressWarnings=!0,e.am4core.options.autoDispose=!0}catch{return sE=null,v3=null,null}return sE}function $rt(t,e="default"){const i=Mrt.find(r=>r.name===e);return i?i.colors.map(r=>t.color(r)):null}const oc="esri-feature-media",Ss={base:oc,mediaContainer:`${oc}__container`,mediaItemContainer:`${oc}__item-container`,mediaItem:`${oc}__item`,mediaItemTitle:`${oc}__item-title`,mediaItemCaption:`${oc}__item-caption`,mediaPrevious:`${oc}__previous`,mediaPreviousIconLTR:`${oc}__previous-icon`,mediaPreviousIconRTL:`${oc}__previous-icon--rtl`,mediaNext:`${oc}__next`,mediaNextIconLTR:`${oc}__next-icon`,mediaNextIconRTL:`${oc}__next-icon--rtl`,mediaChart:`${oc}__chart`,mediaButton:`${oc}__button`,mediaIcon:`${oc}__icon`,iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow"},wG=.05,xG=.95,TG=15,Ny="color",gv="tooltip",b3="value",tfe="default-line-value";let mu=class extends Sa{constructor(e,i){super(e,i),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this.viewModel=new bS,this.messages=null,this._getChartDependencies=async r=>{const n=await Irt(),{destroyed:s,viewModel:o}=this;if(s||!o||!r)return;const{activeMediaInfo:a}=o,l=await this._getRendererColors(n);this._renderChart({chartDiv:r,mediaInfo:a,chartsModule:n,colorMap:l})}}initialize(){this._featureElementInfo=new yB,this.addHandles([ne(()=>{var e,i;return[(e=this.viewModel)==null?void 0:e.activeMediaInfo,(i=this.viewModel)==null?void 0:i.activeMediaInfoIndex]},()=>this._setupMediaRefreshTimer(),zt),ne(()=>{var e,i;return[(e=this.viewModel)==null?void 0:e.description,(i=this.viewModel)==null?void 0:i.title]},()=>this._setupFeatureElementInfo(),zt)])}destroy(){var e;this._clearMediaRefreshTimer(),(e=this._featureElementInfo)==null||e.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get activeMediaInfoIndex(){return this.viewModel.activeMediaInfoIndex}set activeMediaInfoIndex(e){this.viewModel.activeMediaInfoIndex=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get fieldInfoMap(){return this.viewModel.fieldInfoMap}set fieldInfoMap(e){this.viewModel.fieldInfoMap=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get mediaInfos(){return this.viewModel.mediaInfos}set mediaInfos(e){this.viewModel.mediaInfos=e}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(e){this.viewModel.popupTemplate=e}get relatedInfos(){return this.viewModel.relatedInfos}set relatedInfos(e){this.viewModel.relatedInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){var e;return te("div",{bind:this,class:Ss.base,onkeyup:this._handleMediaKeyup},(e=this._featureElementInfo)==null?void 0:e.render(),this.renderMedia())}renderMedia(){const{formattedMediaInfoCount:e}=this.viewModel;return e?te("div",{key:"media-element-container",class:Ss.mediaContainer},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null}renderImageMediaInfo(e){const{_refreshIntervalInfo:i}=this,{activeMediaInfoIndex:r,formattedMediaInfoCount:n}=this.viewModel,{value:s,refreshInterval:o,altText:a,title:l,type:c}=e,{sourceURL:h,linkURL:p}=s,f=OMe(p??void 0)?"_blank":"_self",m=f==="_blank"?"noreferrer":"",g=o?i:null,_=g?g.timestamp:0,b=g?g.sourceURL:h,w=te("img",{alt:a||l,key:`media-${c}-${r}-${n}-${_}`,src:b??void 0});return(p?te("a",{title:l,href:p,rel:m,target:f},w):null)||w}renderChartMediaInfo(e){const{activeMediaInfoIndex:i,formattedMediaInfoCount:r}=this.viewModel;return te("div",{key:`media-${e.type}-${i}-${r}`,bind:this,class:Ss.mediaChart,afterCreate:this._getChartDependencies})}renderMediaInfoType(){const{activeMediaInfo:e}=this.viewModel;return e?e.type==="image"?this.renderImageMediaInfo(e):e.type.includes("chart")?this.renderChartMediaInfo(e):null:null}renderMediaInfo(){const{activeMediaInfo:e}=this.viewModel;if(!e)return null;const i=e.title?te("div",{key:"media-title",class:Ss.mediaItemTitle,innerHTML:e.title}):null,r=e.caption?te("div",{key:"media-caption",class:Ss.mediaItemCaption,innerHTML:e.caption}):null;return te("div",{key:"media-container",class:Ss.mediaItemContainer},te("div",{key:"media-item-container",class:Ss.mediaItem},this.renderMediaInfoType()),i,r)}renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;const i=e==="previous",r=i?this.messages.previous:this.messages.next,n=i?this.classes(Ss.mediaButton,Ss.mediaPrevious):this.classes(Ss.mediaButton,Ss.mediaNext),s=i?this.classes(Ss.mediaIcon,Ss.mediaPreviousIconLTR,Ss.iconLeftTriangleArrow):this.classes(Ss.mediaIcon,Ss.mediaNextIconLTR,Ss.iconRightTriangleArrow),o=i?this.classes(Ss.mediaIcon,Ss.mediaPreviousIconRTL,Ss.iconRightTriangleArrow):this.classes(Ss.mediaIcon,Ss.mediaNextIconRTL,Ss.iconLeftTriangleArrow),a=i?"media-previous":"media-next",l=i?this._previous:this._next;return te("button",{type:"button",key:a,title:r,"aria-label":r,tabIndex:0,class:n,bind:this,onclick:l},te("span",{"aria-hidden":"true",class:s}),te("span",{"aria-hidden":"true",class:o}))}_setupFeatureElementInfo(){var r;const{description:e,title:i}=this;(r=this._featureElementInfo)==null||r.set({description:e,title:i})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_getRenderer(){const{isAggregate:e,layer:i}=this.viewModel;return e&&(i!=null&&i.featureReduction)&&"renderer"in i.featureReduction?i.featureReduction.renderer:i==null?void 0:i.renderer}async _getRendererColors(e){const{am4core:i}=e,r=new Map,n=this._getRenderer(),s="default";if(!n)return r;const o=await rit(n);return o.delete(s),Array.from(o.values()).every(a=>(a==null?void 0:a.length)===1)&&(r.set(tfe,i.color({r:50,g:50,b:50,a:1})),Array.from(o.keys()).forEach(a=>{var l;a&&r.set(a,i.color((l=o.get(a))==null?void 0:l[0].toCss(!0)))})),r}_handleMediaKeyup(e){const i=up(e);i==="ArrowLeft"&&(e.stopPropagation(),this.viewModel.previous()),i==="ArrowRight"&&(e.stopPropagation(),this.viewModel.next())}_renderChart(e){const{abilities:i}=this.viewModel,{chartsModule:r,chartDiv:n,mediaInfo:s,colorMap:o}=e,{value:a,type:l}=s,{am4core:c}=r,h=$rt(c);function p(g){g instanceof c.ColorSet&&h&&(g.list=h)}PV()&&c.useTheme(r.am4themes_dark);const f=window.matchMedia("(prefers-reduced-motion: reduce)");i.chartAnimation&&!f.matches?c.useTheme(r.am4themes_animated):c.unuseTheme(r.am4themes_animated),c.useTheme(p);const m=l==="pie-chart"?this._createPieChart(e):this._createXYChart(e);n.setAttribute("aria-label",s.altText||s.title),m.data=a.series.map(g=>({[gv]:g.tooltip,[b3]:g.value,[Ny]:o.get(g.fieldName)})).filter(g=>l!=="pie-chart"||g.value!=null&&g.value>0)}_customizeChartTooltip(e,i){e&&(e.label.wrap=!0,e.label.maxWidth=200,e.autoTextColor=!1,e.getFillFromObject=!1,e.label.fill=i.color("#ffffff"),e.background.fill=i.color({r:0,g:0,b:0,a:.7}))}_createPieChart(e){const{chartDiv:i,chartsModule:r}=e,{am4core:n,am4charts:s}=r,o=n.create(i,s.PieChart);o.rtl=Bg(this.container);const a=o.series.push(new s.PieSeries);return a.labels.template.disabled=!0,a.ticks.template.disabled=!0,a.dataFields.value=b3,a.dataFields.category=gv,this._customizeChartTooltip(a.tooltip,n),a.slices.template.propertyFields.fill=Ny,a.slices.template.propertyFields.stroke=Ny,o}_getMinSeriesValue(e){let i=0;return e.forEach(r=>i=Math.min(r.value,i)),i}_createColumnChart(e,i){const{chartsModule:r,mediaInfo:n}=i,{value:s}=n,{am4core:o,am4charts:a}=r,l=e.xAxes.push(new a.CategoryAxis);l.dataFields.category=gv,l.renderer.labels.template.disabled=!0;const c=l.tooltip;this._customizeChartTooltip(c,o),c.events.on("sizechanged",()=>{c.dy=-c.contentHeight});const h=e.yAxes.push(new a.ValueAxis),p=h.renderer.labels.template;h.renderer.minLabelPosition=wG,h.renderer.maxLabelPosition=xG,h.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(h.tooltip,o),p.wrap=!0;const f=e.series.push(new a.ColumnSeries);f.dataFields.valueY=b3,f.dataFields.categoryX=gv,f.columns.template.propertyFields.fill=Ny,f.columns.template.propertyFields.stroke=Ny,e.cursor=new a.XYCursor,s.series.length>TG&&(e.scrollbarX=new o.Scrollbar)}_createBarChart(e,i){const{chartsModule:r,mediaInfo:n}=i,{value:s}=n,{am4core:o,am4charts:a}=r,l=e.yAxes.push(new a.CategoryAxis);l.dataFields.category=gv,l.renderer.inversed=!0,l.renderer.labels.template.disabled=!0;const c=l.tooltip;this._customizeChartTooltip(c,o),c.events.on("sizechanged",()=>{c.dx=c.contentWidth});const h=e.xAxes.push(new a.ValueAxis),p=h.renderer.labels.template;h.renderer.minLabelPosition=wG,h.renderer.maxLabelPosition=xG,h.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(h.tooltip,o),p.wrap=!0;const f=e.series.push(new a.ColumnSeries);f.dataFields.valueX=b3,f.dataFields.categoryY=gv,f.columns.template.propertyFields.fill=Ny,f.columns.template.propertyFields.stroke=Ny,e.cursor=new a.XYCursor,s.series.length>TG&&(e.scrollbarY=new o.Scrollbar)}_createLineChart(e,i){const{chartsModule:r,mediaInfo:n,colorMap:s}=i,{value:o}=n,{am4core:a,am4charts:l}=r,c=e.xAxes.push(new l.CategoryAxis);c.dataFields.category=gv,c.renderer.labels.template.disabled=!0;const h=c.tooltip;this._customizeChartTooltip(h,a),h.events.on("sizechanged",()=>{h.dy=-h.contentHeight});const p=e.yAxes.push(new l.ValueAxis),f=p.renderer.labels.template;p.renderer.minLabelPosition=wG,p.renderer.maxLabelPosition=xG,p.min=this._getMinSeriesValue(o.series),this._customizeChartTooltip(p.tooltip,a),f.wrap=!0;const m=e.series.push(new l.LineSeries);m.dataFields.categoryX=gv,m.dataFields.valueY=b3,m.strokeWidth=1;const g=s.get(tfe);g&&(m.stroke=g);const _=m.bullets.push(new l.CircleBullet);_.propertyFields.fill=Ny,_.propertyFields.stroke=Ny,e.cursor=new l.XYCursor,o.series.length>TG&&(e.scrollbarX=new a.Scrollbar)}_createXYChart(e){const{chartDiv:i,chartsModule:r,mediaInfo:n}=e,{type:s}=n,{am4core:o,am4charts:a}=r,l=o.create(i,a.XYChart);return l.rtl=Bg(this.container),s==="column-chart"&&this._createColumnChart(l,e),s==="bar-chart"&&this._createBarChart(l,e),s==="line-chart"&&this._createLineChart(l,e),l}_clearMediaRefreshTimer(){const{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){const i=Date.now();this._refreshIntervalInfo={timestamp:i,sourceURL:e&&this._getImageSource(e,i)},this.scheduleRender()}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:e}=this.viewModel;e&&e.type==="image"&&e.refreshInterval&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){const{refreshInterval:i,value:r}=e;if(!i)return;const n=6e4*i;this._updateMediaInfoTimestamp(r.sourceURL);const s=setInterval(()=>{this._updateMediaInfoTimestamp(r.sourceURL)},n);this._refreshTimer=s}_getImageSource(e,i){const r=e.includes("?")?"&":"?",[n,s=""]=e.split("#");return`${n}${r}timestamp=${i}${s?"#":""}${s}`}};u([d()],mu.prototype,"attributes",null),u([d()],mu.prototype,"activeMediaInfoIndex",null),u([d()],mu.prototype,"description",null),u([d()],mu.prototype,"fieldInfoMap",null),u([d()],mu.prototype,"layer",null),u([d()],mu.prototype,"mediaInfos",null),u([d()],mu.prototype,"popupTemplate",null),u([d()],mu.prototype,"relatedInfos",null),u([d()],mu.prototype,"title",null),u([d({type:bS})],mu.prototype,"viewModel",void 0),u([d(),Go("esri/widgets/Feature/t9n/Feature")],mu.prototype,"messages",void 0),mu=u([$("esri.widgets.Feature.FeatureMedia")],mu);const POe=mu;var eK;let KP=eK=class extends fe{constructor(t){super(t),this.minValue=0,this.maxValue=0}clone(){return new eK({minValue:this.minValue,maxValue:this.maxValue})}};u([d({type:Number,json:{write:!0}})],KP.prototype,"minValue",void 0),u([d({type:Number,json:{write:!0}})],KP.prototype,"maxValue",void 0),KP=eK=u([$("esri.renderer.support.AuthoringInfoClassBreakInfo")],KP);var tK;let V1=tK=class extends fe{constructor(t){super(t),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=[]}clone(){return new tK({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:se(this.classBreakInfos)})}};u([d({type:String,json:{write:!0}})],V1.prototype,"field",void 0),u([d({type:String,json:{write:!0}})],V1.prototype,"normalizationField",void 0),u([d({type:String,json:{write:!0}})],V1.prototype,"label",void 0),u([d({type:[KP],json:{write:!0}})],V1.prototype,"classBreakInfos",void 0),V1=tK=u([$("esri.renderers.support.AuthoringInfoFieldInfo")],V1);var iK;const i4=new mi({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),r4=new mi({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),ife={key:t=>typeof t=="number"?"number":"string",typeMap:{number:Number,string:String},base:null},rfe=["high-to-low","above-and-below","centered-on","extremes"],nfe=[...new Set(["high-to-low","above-and-below","centered-on","extremes","90-10","above","below","high-to-low","above-and-below","90-10","above","below"])],sfe=["seconds","minutes","hours","days","months","years"];let gu=iK=class extends fe{constructor(t){super(t),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(t){return typeof t=="string"||typeof t=="number"?t:null}castStartTime(t){return typeof t=="string"||typeof t=="number"?t:null}get style(){return this.type==="color"?this._get("style"):null}set style(t){this._set("style",t)}get theme(){return this.type==="color"||this.type==="size"?this._get("theme")||"high-to-low":null}set theme(t){this._set("theme",t)}clone(){return new iK({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};u([d({types:ife,json:{write:!0}})],gu.prototype,"endTime",void 0),u([ri("endTime")],gu.prototype,"castEndTime",null),u([d({type:String,json:{write:!0}})],gu.prototype,"field",void 0),u([d({type:Number,json:{write:!0}})],gu.prototype,"maxSliderValue",void 0),u([d({type:Number,json:{write:!0}})],gu.prototype,"minSliderValue",void 0),u([d({types:ife,json:{write:!0}})],gu.prototype,"startTime",void 0),u([ri("startTime")],gu.prototype,"castStartTime",null),u([d({type:i4.apiValues,value:null,json:{type:i4.jsonValues,read:i4.read,write:i4.write}})],gu.prototype,"style",null),u([d({type:nfe,value:null,json:{type:nfe,origins:{"web-scene":{type:rfe,write:{writer:(t,e)=>{rfe.includes(t)&&(e.theme=t)}}}},write:!0}})],gu.prototype,"theme",null),u([d({type:r4.apiValues,json:{type:r4.jsonValues,read:r4.read,write:r4.write}})],gu.prototype,"type",void 0),u([d({type:sfe,json:{type:sfe,write:!0}})],gu.prototype,"units",void 0),gu=iK=u([$("esri.renderers.support.AuthoringInfoVisualVariable")],gu);const Lrt=gu;let z6=class extends fe{constructor(e){super(e),this.type=null}};u([d({readOnly:!0,json:{read:!1,write:!0}})],z6.prototype,"type",void 0),z6=u([$("esri.rest.support.ColorRamp")],z6);const toe=z6;var rK;let oT=rK=class extends toe{constructor(t){super(t),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new rK({fromColor:se(this.fromColor),toColor:se(this.toColor),algorithm:this.algorithm})}};u([ot({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],oT.prototype,"algorithm",void 0),u([d({type:Xe,json:{type:[Kr],write:!0}})],oT.prototype,"fromColor",void 0),u([d({type:Xe,json:{type:[Kr],write:!0}})],oT.prototype,"toColor",void 0),u([d({type:["algorithmic"]})],oT.prototype,"type",void 0),oT=rK=u([$("esri.rest.support.AlgorithmicColorRamp")],oT);const ioe=oT;var nK;let QP=nK=class extends toe{constructor(t){super(t),this.colorRamps=null,this.type="multipart"}clone(){return new nK({colorRamps:se(this.colorRamps)})}};u([d({type:[ioe],json:{write:!0}})],QP.prototype,"colorRamps",void 0),u([d({type:["multipart"]})],QP.prototype,"type",void 0),QP=nK=u([$("esri.rest.support.MultipartColorRamp")],QP);const IOe=QP,Drt={key:"type",base:toe,typeMap:{algorithmic:ioe,multipart:IOe}};function Nrt(t){return t&&t.type?t.type==="algorithmic"?ioe.fromJSON(t):t.type==="multipart"?IOe.fromJSON(t):null:null}var sK;const Yw=new mi({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),n4=new mi({pieChart:"pie-chart",classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),ofe=new mi({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),afe=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"],Frt=["high-to-low","above-and-below","above","below","90-10"],krt=["flow-line","wave-front"],Urt=["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"];let Es=sK=class extends fe{constructor(t){super(t),this.colorRamp=null,this.fadeRatio=null,this.isAutoGenerated=!1,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const t=this._get("classificationMethod"),e=this.type;return e&&e!=="relationship"?e==="class-breaks-size"||e==="class-breaks-color"?t||"manual":null:t}set classificationMethod(t){this._set("classificationMethod",t)}readColorRamp(t){return t?Nrt(t):void 0}get fields(){return this.type&&this.type!=="predominance"?null:this._get("fields")}set fields(t){this._set("fields",t)}get field1(){return this.type&&this.type!=="relationship"?null:this._get("field1")}set field1(t){this._set("field1",t)}get field2(){return this.type&&this.type!=="relationship"?null:this._get("field2")}set field2(t){this._set("field2",t)}get flowTheme(){return this.type==="flow"?this._get("flowTheme"):null}set flowTheme(t){this._set("flowTheme",t)}get focus(){return this.type&&this.type!=="relationship"?null:this._get("focus")}set focus(t){this._set("focus",t)}get numClasses(){return this.type&&this.type!=="relationship"?null:this._get("numClasses")}set numClasses(t){this._set("numClasses",t)}get statistics(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("statistics"):null}set statistics(t){this._set("statistics",t)}get standardDeviationInterval(){const t=this.type;return t&&t!=="relationship"&&t!=="class-breaks-size"&&t!=="class-breaks-color"||this.classificationMethod&&this.classificationMethod!=="standard-deviation"?null:this._get("standardDeviationInterval")}set standardDeviationInterval(t){this._set("standardDeviationInterval",t)}get type(){return this._get("type")}set type(t){let e=t;t==="classed-size"?e="class-breaks-size":t==="classed-color"&&(e="class-breaks-color"),this._set("type",e)}get univariateSymbolStyle(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(t){this._set("univariateSymbolStyle",t)}get univariateTheme(){return this.type==="univariate-color-size"?this._get("univariateTheme"):null}set univariateTheme(t){this._set("univariateTheme",t)}clone(){return new sK({classificationMethod:this.classificationMethod,colorRamp:se(this.colorRamp),fadeRatio:se(this.fadeRatio),fields:this.fields&&this.fields.slice(0),field1:se(this.field1),field2:se(this.field2),isAutoGenerated:this.isAutoGenerated,focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(t=>t.clone()),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};u([d({type:Yw.apiValues,value:null,json:{type:Yw.jsonValues,read:Yw.read,write:Yw.write,origins:{"web-document":{default:"manual",type:Yw.jsonValues,read:Yw.read,write:Yw.write}}}})],Es.prototype,"classificationMethod",null),u([d({types:Drt,json:{write:!0}})],Es.prototype,"colorRamp",void 0),u([Oe("colorRamp")],Es.prototype,"readColorRamp",null),u([d({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Es.prototype,"fadeRatio",void 0),u([d({type:[String],value:null,json:{write:!0}})],Es.prototype,"fields",null),u([d({type:V1,value:null,json:{write:!0}})],Es.prototype,"field1",null),u([d({type:V1,value:null,json:{write:!0}})],Es.prototype,"field2",null),u([d({type:krt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Es.prototype,"flowTheme",null),u([d({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],Es.prototype,"focus",null),u([d({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],Es.prototype,"isAutoGenerated",void 0),u([d({type:Number,value:null,json:{type:Kr,write:!0}})],Es.prototype,"numClasses",null),u([d({type:afe,json:{type:afe,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],Es.prototype,"lengthUnit",void 0),u([d({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Es.prototype,"maxSliderValue",void 0),u([d({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Es.prototype,"minSliderValue",void 0),u([d({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Es.prototype,"statistics",null),u([d({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],Es.prototype,"standardDeviationInterval",null),u([d({type:n4.apiValues,value:null,json:{type:n4.jsonValues,read:n4.read,write:n4.write,origins:{"web-scene":{type:ofe.jsonValues,write:{writer:ofe.write,overridePolicy:t=>({enabled:t!=="flow"})}}}}})],Es.prototype,"type",null),u([d({type:[Lrt],json:{write:!0}})],Es.prototype,"visualVariables",void 0),u([d({type:Urt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Es.prototype,"univariateSymbolStyle",null),u([d({type:Frt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Es.prototype,"univariateTheme",null),Es=sK=u([$("esri.renderers.support.AuthoringInfo")],Es);const roe=Es,SG=new mi({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let eI=class extends fe{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const i=new Set;return await this.collectRequiredFields(i,e),Array.from(i).sort()}getSymbol(e,i){}async getSymbolAsync(e,i){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};u([d({type:roe,json:{write:!0}})],eI.prototype,"authoringInfo",void 0),u([d({type:SG.apiValues,readOnly:!0,json:{type:SG.jsonValues,read:!1,write:{writer:SG.write,ignoreOrigin:!0}}})],eI.prototype,"type",void 0),eI=u([$("esri.renderers.Renderer")],eI);const B_=eI;function Vrt(t){var e,i;return((i=(e=t.match(zrt))==null?void 0:e[1])==null?void 0:i.replace(/\\'/g,"'"))??null}const zrt=/^hash\(\$feature\['((\\'|[^'])+)'\]\) \* 8\.381e-8$/;var oK;let DR=oK=class extends fe{constructor(){super(...arguments),this.title=null}clone(){return new oK({title:this.title})}};u([d({type:String,json:{write:!0}})],DR.prototype,"title",void 0),DR=oK=u([$("esri.renderers.support.LegendOptions")],DR);var aK;let B6=aK=class extends DR{constructor(){super(...arguments),this.showLegend=null}clone(){return new aK({title:this.title,showLegend:this.showLegend})}};u([d({type:Boolean,json:{write:!0}})],B6.prototype,"showLegend",void 0),B6=aK=u([$("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],B6);const $Oe=B6,EG=new mi({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let mf=class extends fe{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return e==null?e:typeof e=="function"?(re.getLogger(this.declaredClass).error(".field: field must be a string value"),null):uN(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};u([d()],mf.prototype,"index",void 0),u([d({type:EG.apiValues,readOnly:!0,json:{read:EG.read,write:EG.write}})],mf.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],mf.prototype,"field",void 0),u([ri("field")],mf.prototype,"castField",null),u([d({type:String,json:{write:!0}})],mf.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],mf.prototype,"valueExpressionTitle",void 0),u([d({readOnly:!0})],mf.prototype,"arcadeRequired",null),u([d({type:$Oe,json:{write:!0}})],mf.prototype,"legendOptions",void 0),mf=u([$("esri.renderers.visualVariables.VisualVariable")],mf);const LN=mf;var lK;let aT=lK=class extends LN{constructor(t){super(t),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,i)=>e.value-i.value),this._set("stops",t)}clone(){return new lK({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(t=>t.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};u([d({readOnly:!0})],aT.prototype,"cache",null),u([d({type:["color"],json:{type:["colorInfo"]}})],aT.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],aT.prototype,"normalizationField",void 0),u([d({type:[Get],json:{write:!0}})],aT.prototype,"stops",null),aT=lK=u([$("esri.renderers.visualVariables.ColorVariable")],aT);const LOe=aT;var cK;let u1=cK=class extends fe{constructor(t){super(t),this.label=null,this.opacity=null,this.value=null}readOpacity(t,e){return YL(e.transparency)}writeOpacity(t,e,i){e[i]=G9(t)}clone(){return new cK({label:this.label,opacity:this.opacity,value:this.value})}};u([d({type:String,json:{write:!0}})],u1.prototype,"label",void 0),u([d({type:Number,json:{type:Kr,write:{target:"transparency"}}})],u1.prototype,"opacity",void 0),u([Oe("opacity",["transparency"])],u1.prototype,"readOpacity",null),u([Ne("opacity")],u1.prototype,"writeOpacity",null),u([d({type:Number,json:{write:!0}})],u1.prototype,"value",void 0),u1=cK=u([$("esri.renderers.visualVariables.support.OpacityStop")],u1);const Brt=u1;var uK;let lT=uK=class extends LN{constructor(t){super(t),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,i)=>e.value-i.value),this._set("stops",t)}clone(){return new uK({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(t=>t.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};u([d({readOnly:!0})],lT.prototype,"cache",null),u([d({type:["opacity"],json:{type:["transparencyInfo"]}})],lT.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],lT.prototype,"normalizationField",void 0),u([d({type:[Brt],json:{write:!0}})],lT.prototype,"stops",null),lT=uK=u([$("esri.renderers.visualVariables.OpacityVariable")],lT);const DOe=lT;var hK;let u0=hK=class extends LN{constructor(t){super(t),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(t,e,i,r){if(r&&r.messages){const n=`visualVariables[${this.index}]`;r.messages.push(new H("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:n+".valueExpressionTitle",context:r}))}}clone(){return new hK({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions&&this.legendOptions.clone()})}};u([d({readOnly:!0})],u0.prototype,"cache",null),u([d({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],u0.prototype,"axis",void 0),u([d({type:["rotation"],json:{type:["rotationInfo"]}})],u0.prototype,"type",void 0),u([d({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],u0.prototype,"rotationType",void 0),u([d({type:String,json:{write:!0}})],u0.prototype,"valueExpressionTitle",void 0),u([Ne("web-scene","valueExpressionTitle")],u0.prototype,"writeValueExpressionTitleWebScene",null),u0=hK=u([$("esri.renderers.visualVariables.RotationVariable")],u0);const NOe=u0;var dK;let VC=dK=class extends fe{constructor(t){super(t),this.label=null,this.size=null,this.value=null}clone(){return new dK({label:this.label,size:this.size,value:this.value})}};u([d({type:String,json:{write:!0}})],VC.prototype,"label",void 0),u([d({type:Number,cast:vr,json:{write:!0}})],VC.prototype,"size",void 0),u([d({type:Number,json:{write:!0}})],VC.prototype,"value",void 0),VC=dK=u([$("esri.renderers.visualVariables.support.SizeStop")],VC);const zC=VC;var pK;let j6=pK=class extends $Oe{constructor(){super(...arguments),this.customValues=null}clone(){return new pK({title:this.title,showLegend:this.showLegend,customValues:this.customValues&&this.customValues.slice(0)})}};u([d({type:[Number],json:{write:!0}})],j6.prototype,"customValues",void 0),j6=pK=u([$("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],j6);const jrt=j6;var a_,ua;function bb(t){return t&&t.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function aD(t){return t!=null&&!isNaN(t)&&isFinite(t)}function FOe(t){return t.valueExpression?a_.Expression:t.field&&typeof t.field=="string"?a_.Field:a_.Unknown}function Grt(t,e){const i=e||FOe(t),r=t.valueUnit||"unknown";return i===a_.Unknown?ua.Constant:t.stops?ua.Stops:t.minSize!=null&&t.maxSize!=null&&t.minDataValue!=null&&t.maxDataValue!=null?ua.ClampedLinear:r==="unknown"?t.minSize!=null&&t.minDataValue!=null?t.minSize&&t.minDataValue?ua.Proportional:ua.Additive:ua.Identity:ua.RealWorldSize}(function(t){t.Unknown="unknown",t.Expression="expression",t.Field="field"})(a_||(a_={})),function(t){t.Unknown="unknown",t.Stops="stops",t.ClampedLinear="clamped-linear",t.Proportional="proportional",t.Additive="additive",t.Constant="constant",t.Identity="identity",t.RealWorldSize="real-world-size"}(ua||(ua={}));function tBt(t){}function Hrt(t){return()=>t}const LM={inches:Gs(1,"meters","inches"),feet:Gs(1,"meters","feet"),"us-feet":Gs(1,"meters","us-feet"),yards:Gs(1,"meters","yards"),miles:Gs(1,"meters","miles"),"nautical-miles":Gs(1,"meters","nautical-miles"),millimeters:Gs(1,"meters","millimeters"),centimeters:Gs(1,"meters","centimeters"),decimeters:Gs(1,"meters","decimeters"),meters:Gs(1,"meters","meters"),kilometers:Gs(1,"meters","kilometers"),"decimal-degrees":1/uGe(1,"meters",Ci.radius)},hw=re.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),lfe=new Ha,G6=Math.PI,kOe=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function UOe(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(g=>g.type==="color"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void hw.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const n=typeof e=="number",s=n?null:e,o=s&&s.attributes;let a=n?e:null;const l=r.field,{ipData:c,hasExpression:h}=r.cache;let p=r.cache.compiledFunc;if(!l&&!h){const g=r.stops;return g&&g[0]&&g[0].color}if(typeof a!="number")if(h){if(R(i)||R(i.arcade))return void hw.error("Use of arcade expressions requires an arcade context");const g={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},_=i.arcade.arcadeUtils,b=_.getViewInfo(g),w=_.createExecContext(s,b);if(!p){const x=_.createSyntaxTree(r.valueExpression);p=_.createFunction(x),r.cache.compiledFunc=p}a=_.executeFunction(p,w)}else o&&(a=o[l]);const f=r.normalizationField,m=o!=null&&f!=null?parseFloat(o[f]):void 0;if(a!=null&&(!f||n||!isNaN(m)&&m!==0)){isNaN(m)||n||(a/=m);const g=soe(a,c);if(g){const _=g[0],b=g[1],w=_===b?r.stops[_].color:Xe.blendColors(r.stops[_].color,r.stops[b].color,g[2],v(i)?i.color:void 0);return new Xe(w)}}}function VOe(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(g=>g.type==="opacity"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void hw.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const n=typeof e=="number",s=n?null:e,o=s&&s.attributes;let a=n?e:null;const l=r.field,{ipData:c,hasExpression:h}=r.cache;let p=r.cache.compiledFunc;if(!l&&!h){const g=r.stops;return g&&g[0]&&g[0].opacity}if(typeof a!="number")if(h){if(R(i)||R(i.arcade))return void hw.error("Use of arcade expressions requires an arcade context");const g={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},_=i.arcade.arcadeUtils,b=_.getViewInfo(g),w=_.createExecContext(s,b);if(!p){const x=_.createSyntaxTree(r.valueExpression);p=_.createFunction(x),r.cache.compiledFunc=p}a=_.executeFunction(p,w)}else o&&(a=o[l]);const f=r.normalizationField,m=o!=null&&f!=null?parseFloat(o[f]):void 0;if(a!=null&&(!f||n||!isNaN(m)&&m!==0)){isNaN(m)||n||(a/=m);const g=soe(a,c);if(g){const _=g[0],b=g[1];if(_===b)return r.stops[_].opacity;{const w=r.stops[_].opacity;return w+(r.stops[b].opacity-w)*g[2]}}}}function zOe(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(m=>m.type==="rotation"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void hw.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const n=r.axis||"heading",s=n==="heading"&&r.rotationType==="arithmetic"?90:0,o=n==="heading"&&r.rotationType==="arithmetic"?-1:1,a=typeof e=="number"?null:e,l=a&&a.attributes,c=r.field,{hasExpression:h}=r.cache;let p=r.cache.compiledFunc,f=0;if(!c&&!h)return f;if(h){if(R(i)||R(i.arcade))return void hw.error("Use of arcade expressions requires an arcade context");const m={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},g=i.arcade.arcadeUtils,_=g.getViewInfo(m),b=g.createExecContext(a,_);if(!p){const w=g.createSyntaxTree(r.valueExpression);p=g.createFunction(w),r.cache.compiledFunc=p}f=g.executeFunction(p,b)}else l&&(f=l[c]||0);return f=typeof f!="number"||isNaN(f)?null:s+o*f,f}function qrt(t,e,i){const r=typeof e=="number",n=r?null:e,s=n&&n.attributes;let o=r?e:null;const{isScaleDriven:a}=t.cache;let l=t.cache.compiledFunc;if(a){const h=v(i)?i.scale:void 0,p=v(i)?i.view:void 0;o=h==null||p==="3d"?Wrt(t):h}else if(!r)switch(t.inputValueType){case a_.Expression:{if(R(i)||R(i.arcade))return void hw.error("Use of arcade expressions requires an arcade context");const h={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},p=i.arcade.arcadeUtils,f=p.getViewInfo(h),m=p.createExecContext(n,f);if(!l){const g=p.createSyntaxTree(t.valueExpression);l=p.createFunction(g),t.cache.compiledFunc=l}o=p.executeFunction(l,m);break}case a_.Field:s&&(o=s[t.field]);break;case a_.Unknown:o=null}if(!aD(o))return null;if(r||!t.normalizationField)return o;const c=s?parseFloat(s[t.normalizationField]):null;return aD(c)&&c!==0?o/c:null}function Wrt(t){let e=null,i=null;const r=t.stops;return r?(e=r[0].value,i=r[r.length-1].value):(e=t.minDataValue||0,i=t.maxDataValue||0),(e+i)/2}function SB(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(s=>s.type==="size"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void hw.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const n=jOe(qrt(r,e,i),r,e,i,r.cache.ipData);return n==null||isNaN(n)?0:n}function Xu(t,e,i){return t==null?null:bb(t)?SB(t,e,i):aD(t)?t:null}function BOe(t,e,i){return aD(i)&&t>i?i:aD(e)&&t<e?e:t}function Xrt(t,e,i,r){return t+((Xu(e.minSize,i,r)||e.minDataValue)??0)}function Yrt(t,e,i){const r=t.stops;let n=r&&r.length&&r[0].size;return n==null&&(n=t.minSize),Xu(n,e,i)}function Zrt(t,e,i,r){const n=(t-e.minDataValue)/(e.maxDataValue-e.minDataValue),s=Xu(e.minSize,i,r),o=Xu(e.maxSize,i,r),a=v(r)?r.shape:void 0;if(t<=e.minDataValue)return s;if(t>=e.maxDataValue)return o;if(s==null||o==null)return null;if(e.scaleBy==="area"&&a){const l=a==="circle",c=l?G6*(s/2)**2:s*s,h=c+n*((l?G6*(o/2)**2:o*o)-c);return l?2*Math.sqrt(h/G6):Math.sqrt(h)}return s+n*(o-s)}function Jrt(t,e,i,r){const n=v(r)?r.shape:void 0,s=t/e.minDataValue,o=Xu(e.minSize,i,r),a=Xu(e.maxSize,i,r);let l=null;return l=n==="circle"?2*Math.sqrt(s*(o/2)**2):n==="square"||n==="diamond"||n==="image"?Math.sqrt(s*o**2):s*o,BOe(l,o,a)}function Krt(t,e,i,r,n){var l,c,h;const[s,o,a]=soe(t,n);if(s===o)return Xu((l=e.stops)==null?void 0:l[s].size,i,r);{const p=Xu((c=e.stops)==null?void 0:c[s].size,i,r);return p+(Xu((h=e.stops)==null?void 0:h[o].size,i,r)-p)*a}}function Qrt(t,e,i,r){const n=(v(r)&&r.resolution?r.resolution:1)*LM[e.valueUnit],s=Xu(e.minSize,i,r),o=Xu(e.maxSize,i,r),{valueRepresentation:a}=e;let l=null;return l=a==="area"?2*Math.sqrt(t/G6)/n:a==="radius"||a==="distance"?2*t/n:t/n,BOe(l,s,o)}function jOe(t,e,i,r,n){switch(e.transformationType){case ua.Additive:return Xrt(t,e,i,r);case ua.Constant:return Yrt(e,i,r);case ua.ClampedLinear:return Zrt(t,e,i,r);case ua.Proportional:return Jrt(t,e,i,r);case ua.Stops:return Krt(t,e,i,r,n);case ua.RealWorldSize:return Qrt(t,e,i,r);case ua.Identity:return t;case ua.Unknown:return null}}function ent(t,e,i){const{isScaleDriven:r}=t.cache;if(!(r&&i==="3d"||e))return null;const n={scale:e,view:i};let s=Xu(t.minSize,lfe,n),o=Xu(t.maxSize,lfe,n);if(s!=null||o!=null){if(s>o){const a=o;o=s,s=a}return{minSize:s,maxSize:o}}}function noe(t,e,i){if(!t.visualVariables)return;const r=[],n=[],s=[],o=[],a=[];for(const l of t.visualVariables)switch(l.type){case"color":n.push(l);break;case"opacity":s.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return n.forEach(l=>{const c=UOe(l,e,i);r.push({variable:l,value:c})}),s.forEach(l=>{const c=VOe(l,e,i);r.push({variable:l,value:c})}),a.forEach(l=>{const c=zOe(l,e,i);r.push({variable:l,value:c})}),o.forEach(l=>{const c=SB(l,e,i);r.push({variable:l,value:c})}),r.filter(l=>l.value!=null)}function soe(t,e){if(!e)return;let i=0,r=e.length-1;return e.some((n,s)=>t<n?(r=s,!0):(i=s,!1)),[i,r,(t-e[i])/(e[r]-e[i])]}function tnt(t,e,i){const r=["proportional","proportional","proportional"];for(const n of t){const s=n.useSymbolValue?"symbol-value":SB(n,e,i);switch(n.axis){case"width":r[0]=s;break;case"depth":r[1]=s;break;case"height":r[2]=s;break;case"width-and-depth":r[0]=s,r[1]=s;break;case"all":case void 0:case null:r[0]=s,r[1]=s,r[2]=s;break;default:n.axis}}return r}const ooe=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:tnt,getColor:UOe,getOpacity:VOe,getRotationAngle:zOe,getSize:SB,getSizeForValue:jOe,getSizeFromNumberOrVariable:Xu,getSizeRangeAtScale:ent,getVisualVariableValues:noe,viewScaleRE:kOe},Symbol.toStringTag,{value:"Module"}));var fK;const s4=new mi({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),mK=new mi({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function cfe(t){if(t!=null)return typeof t=="string"||typeof t=="number"?vr(t):t.type==="size"?bb(t)?t:(delete(t={...t}).type,new Rr(t)):void 0}function ufe(t,e,i){if(typeof t!="object")return t;const r=new Rr;return r.read(t,i),r}let Rr=fK=class extends LN{constructor(t){super(t),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:this.valueExpression!=null&&kOe.test(this.valueExpression)}}set expression(t){re.getLogger(this.declaredClass).warn("'expression' is deprecated since version 4.2. Use 'valueExpression' instead. The only supported expression is 'view.scale'."),t==="view.scale"?(this.valueExpression="$view.scale",this._set("expression",t)):this._set("expression",null)}set index(t){bb(this.maxSize)&&(this.maxSize.index=`visualVariables[${t}].maxSize`),bb(this.minSize)&&(this.minSize.index=`visualVariables[${t}].minSize`),this._set("index",t)}get inputValueType(){return FOe(this)}set maxDataValue(t){t&&this.stops&&(re.getLogger(this.declaredClass).warn("cannot set maxDataValue when stops is not null."),t=null),this._set("maxDataValue",t)}set maxSize(t){t&&this.stops&&(re.getLogger(this.declaredClass).warn("cannot set maxSize when stops is not null."),t=null),this._set("maxSize",t)}castMaxSize(t){return cfe(t)}readMaxSize(t,e,i){return ufe(t,e,i)}set minDataValue(t){t&&this.stops&&(re.getLogger(this.declaredClass).warn("cannot set minDataValue when stops is not null."),t=null),this._set("minDataValue",t)}set minSize(t){t&&this.stops&&(re.getLogger(this.declaredClass).warn("cannot set minSize when stops is not null."),t=null),this._set("minSize",t)}castMinSize(t){return cfe(t)}readMinSize(t,e,i){return ufe(t,e,i)}get arcadeRequired(){return!!this.valueExpression||this.minSize!=null&&typeof this.minSize=="object"&&this.minSize.arcadeRequired||this.maxSize!=null&&typeof this.maxSize=="object"&&this.maxSize.arcadeRequired}set stops(t){this.minDataValue==null&&this.maxDataValue==null&&this.minSize==null&&this.maxSize==null?t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,i)=>e.value-i.value):t&&(re.getLogger(this.declaredClass).warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),t=null),this._set("stops",t)}get transformationType(){return Grt(this,this.inputValueType)}readValueExpression(t,e){return t||e.expression&&"$view.scale"}writeValueExpressionWebScene(t,e,i,r){if(t==="$view.scale"){if(r&&r.messages){const n=this.index,s=typeof n=="string"?n:`visualVariables[${n}]`;r.messages.push(new H("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:s+".valueExpression",context:r}))}}else e[i]=t}readValueUnit(t){return t?mK.read(t):null}clone(){return new fK({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:bb(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:bb(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(t=>t.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone()})}flipSizes(){if(this.transformationType===ua.ClampedLinear){const{minSize:t,maxSize:e}=this;return this.minSize=e,this.maxSize=t,this}if(this.transformationType===ua.Stops){const t=this.stops;if(!t)return this;const e=t.map(r=>r.size).reverse(),i=t.length;for(let r=0;r<i;r++)t[r].size=e[r];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};u([d({readOnly:!0})],Rr.prototype,"cache",null),u([d({type:s4.apiValues,json:{type:s4.jsonValues,origins:{"web-map":{read:!1}},read:s4.read,write:s4.write}})],Rr.prototype,"axis",void 0),u([d({type:String,value:null,json:{read:!1}})],Rr.prototype,"expression",null),u([d()],Rr.prototype,"index",null),u([d({type:String,readOnly:!0})],Rr.prototype,"inputValueType",null),u([d({type:jrt,json:{write:!0}})],Rr.prototype,"legendOptions",void 0),u([d({type:Number,value:null,json:{write:!0}})],Rr.prototype,"maxDataValue",null),u([d({type:Number,value:null,json:{write:!0}})],Rr.prototype,"maxSize",null),u([ri("maxSize")],Rr.prototype,"castMaxSize",null),u([Oe("maxSize")],Rr.prototype,"readMaxSize",null),u([d({type:Number,value:null,json:{write:!0}})],Rr.prototype,"minDataValue",null),u([d({type:Number,value:null,json:{write:!0}})],Rr.prototype,"minSize",null),u([ri("minSize")],Rr.prototype,"castMinSize",null),u([Oe("minSize")],Rr.prototype,"readMinSize",null),u([d({type:String,json:{write:!0}})],Rr.prototype,"normalizationField",void 0),u([d({readOnly:!0})],Rr.prototype,"arcadeRequired",null),u([d({type:String})],Rr.prototype,"scaleBy",void 0),u([d({type:[zC],value:null,json:{write:!0}})],Rr.prototype,"stops",null),u([d({type:["outline"],json:{write:!0}})],Rr.prototype,"target",void 0),u([d({type:String,readOnly:!0})],Rr.prototype,"transformationType",null),u([d({type:["size"],json:{type:["sizeInfo"]}})],Rr.prototype,"type",void 0),u([d({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],Rr.prototype,"useSymbolValue",void 0),u([d({type:String,json:{write:!0}})],Rr.prototype,"valueExpression",void 0),u([Oe("valueExpression",["valueExpression","expression"])],Rr.prototype,"readValueExpression",null),u([Ne("web-scene","valueExpression")],Rr.prototype,"writeValueExpressionWebScene",null),u([d({type:["radius","diameter","area","width","distance"],json:{write:!0}})],Rr.prototype,"valueRepresentation",void 0),u([d({type:mK.apiValues,json:{write:mK.write,origins:{"web-map":{read:!1},"web-scene":{write:!0},"portal-item":{write:!0}}}})],Rr.prototype,"valueUnit",void 0),u([Oe("valueUnit")],Rr.prototype,"readValueUnit",null),Rr=fK=u([$("esri.renderers.visualVariables.SizeVariable")],Rr);const EB=Rr,int={color:LOe,size:EB,opacity:DOe,rotation:NOe},rnt=new mi({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),nnt=/^\[([^\]]+)\]$/i;let H6=class extends ve{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),(e=e&&e.filter(i=>!!i))&&e.length){for(const i of e)switch(i.type){case"color":this.colorVariables.push(i);break;case"opacity":this.opacityVariables.push(i);break;case"rotation":this.rotationVariables.push(i);break;case"size":this.sizeVariables.push(i)}this.sizeVariables.length&&this.sizeVariables.some(i=>!!i.target)&&e.sort((i,r)=>{let n=null;return n=i.target===r.target?0:i.target?1:-1,n});for(let i=0;i<e.length;i++)e[i].index=i;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,i,r){const{rotationExpression:n,rotationType:s}=i,o=n&&n.match(nnt),a=o&&o[1];if(a&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:s,field:a})),e)return e.map(l=>{const c=rnt.read(l.type),h=int[c];h||(re.getLogger(this.declaredClass).warn(`Unknown variable type: ${c}`),r&&r.messages&&r.messages.push(new Op("visual-variable:unsupported",`visualVariable of type '${c}' is not supported`,{definition:l,context:r})));const p=new h;return p.read(l,r),p})}writeVariables(e,i){const r=[];for(const n of e){const s=n.toJSON(i);s&&r.push(s)}return r}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};u([d()],H6.prototype,"visualVariables",null),H6=u([$("esri.renderers.visualVariables.VisualVariableFactory")],H6);const snt=H6,ont={base:LN,key:"type",typeMap:{opacity:DOe,color:LOe,rotation:NOe,size:EB}},AO=t=>{let e=class extends t{constructor(){super(...arguments),this._vvFactory=new snt}set visualVariables(i){this._vvFactory.visualVariables=i,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(i,r,n){return this._vvFactory.readVariables(i,r,n)}writeVisualVariables(i,r,n,s){r[n]=this._vvFactory.writeVariables(i,s)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const i of this.visualVariables)if(i.arcadeRequired)return!0;return!1}hasVisualVariables(i,r){return i?this.getVisualVariablesForType(i,r).length>0:this.getVisualVariablesForType("size",r).length>0||this.getVisualVariablesForType("color",r).length>0||this.getVisualVariablesForType("opacity",r).length>0||this.getVisualVariablesForType("rotation",r).length>0}getVisualVariablesForType(i,r){const n=this.visualVariables;return n?n.filter(s=>s.type===i&&(typeof r=="string"?s.target===r:r!==!1||!s.target)):[]}async collectVVRequiredFields(i,r){let n=[];this.visualVariables&&(n=n.concat(this.visualVariables));for(const s of n)s&&(s.field&&ed(i,r,s.field),s.normalizationField&&ed(i,r,s.normalizationField),s.valueExpression&&(ant(s.valueExpression,i,r)||await Xc(i,r,s.valueExpression)))}};return u([d({types:[ont],value:null,json:{write:!0}})],e.prototype,"visualVariables",null),u([Oe("visualVariables",["visualVariables","rotationType","rotationExpression"])],e.prototype,"readVisualVariables",null),u([Ne("visualVariables")],e.prototype,"writeVisualVariables",null),e=u([$("esri.renderers.mixins.VisualVariablesMixin")],e),e};function ant(t,e,i){const r=Vrt(t);return!!v(r)&&(ed(e,i,r),!0)}const w3={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function lnt(t,e=w3){var a,l;if(!t)return{symbol:null};const{retainId:i=w3.retainId,ignoreDrivers:r=w3.ignoreDrivers,hasLabelingContext:n=w3.hasLabelingContext,retainCIM:s=w3.retainCIM}=e;let o=null;if(EM(t)||t instanceof q2)o=t.clone();else if(t.type==="cim"){const c=(l=(a=t.data)==null?void 0:a.symbol)==null?void 0:l.type;if(c!=="CIMPointSymbol")return{error:new H("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${c||"unknown"}' is unsupported in 3D`,{symbol:t})};o=s?t.clone():pb.fromCIMSymbol(t)}else if(t instanceof Vp)o=K9.fromSimpleLineSymbol(t);else if(t instanceof Nw)o=pb.fromSimpleMarkerSymbol(t);else if(t instanceof eB)o=pb.fromPictureMarkerSymbol(t);else if(t instanceof Dw)o=e.geometryType&&e.geometryType==="mesh"?Q9.fromSimpleFillSymbol(t):EN.fromSimpleFillSymbol(t);else{if(!(t instanceof xO))return{error:new H("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${t.type||t.declaredClass}' is unsupported in 3D`,{symbol:t})};o=n?J9.fromTextSymbol(t):pb.fromTextSymbol(t)}if(i&&o&&o.type!=="cim"&&(o.id=t.id),r&&EM(o))for(let c=0;c<o.symbolLayers.length;++c)o.symbolLayers.getItemAt(c)._ignoreDrivers=!0;return{symbol:o}}function $V(t,e,i,r){const n=GOe(t,{},{context:r,isLabelSymbol:!1});v(n)&&(e[i]=n)}function hfe(t,e,i,r){const n=GOe(t,{},{context:r,isLabelSymbol:!0});v(n)&&(e[i]=n)}function dfe(t){return t instanceof wO||t instanceof q2}function GOe(t,e,i){if(R(t))return null;const{context:r,isLabelSymbol:n}=i,s=r==null?void 0:r.origin,o=r==null?void 0:r.messages;if(s==="web-scene"&&!dfe(t)){const a=lnt(t,{retainCIM:!0,hasLabelingContext:n});return v(a.symbol)?a.symbol.write(e,r):(o==null||o.push(new H("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:t,context:r,error:a.error})),null)}return(s==="web-map"||s==="portal-item"&&!TMe(r==null?void 0:r.layer))&&dfe(t)?(o==null||o.push(new H("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:t,context:r})),null):t.write(e,r)}function rBt(t,e){return nYe(t,null,e)}const RO={types:iB,json:{write:{writer:$V},origins:{"web-scene":{types:yde,write:{writer:$V},read:{reader:Ow({types:yde})}}}}},HOe={types:{base:rh,key:"type",typeMap:{"simple-fill":LS.typeMap["simple-fill"],"picture-fill":LS.typeMap["picture-fill"],"polygon-3d":LS.typeMap["polygon-3d"]}},json:{write:{writer:$V},origins:{"web-scene":{type:EN,write:{writer:$V}}}}},q6={cast:t=>t==null||typeof t=="string"||typeof t=="number"?t:`${t}`,json:{type:String,write:{writer:(t,e)=>{e.value=t==null?void 0:t.toString()}}}};var gK;let h1=gK=class extends fe{constructor(t){super(t),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new gK({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const t=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${t}`}};u([d({type:String,json:{write:!0}})],h1.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],h1.prototype,"label",void 0),u([d({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],h1.prototype,"minValue",void 0),u([d({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],h1.prototype,"maxValue",void 0),u([d(RO)],h1.prototype,"symbol",void 0),h1=gK=u([$("esri.renderers.support.ClassBreakInfo")],h1);const LV=h1;var yK;const qOe="log",W6="percent-of-total",X6="field",o4=new mi({esriNormalizeByLog:qOe,esriNormalizeByPercentOfTotal:W6,esriNormalizeByField:X6}),cnt=Ts(LV);let So=yK=class extends AO(B_){constructor(t){super(t),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(t,e,i){if(!Array.isArray(t))return;let r=e.minValue;return t.map(n=>{const s=new LV;return s.read(n,i),s.minValue==null&&(s.minValue=r),s.maxValue==null&&(s.maxValue=s.minValue),r=s.maxValue,s})}writeClassBreakInfos(t,e,i,r){const n=t.map(s=>s.write({},r));this._areClassBreaksConsecutive()&&n.forEach(s=>delete s.classMinValue),e[i]=n}castField(t){return t==null?t:typeof t=="function"?(re.getLogger(this.declaredClass).error(".field: field must be a string value"),null):uN(t)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let t=this._get("normalizationType");const e=!!this.normalizationField,i=this.normalizationTotal!=null;return e||i?(t=e&&X6||i&&W6||null,e&&i&&re.getLogger(this.declaredClass).warn("warning: both normalizationField and normalizationTotal are set!")):t!==X6&&t!==W6||(t=null),t}set normalizationType(t){this._set("normalizationType",t)}addClassBreakInfo(t,e,i){let r=null;r=typeof t=="number"?new LV({minValue:t,maxValue:e,symbol:wAe(i)}):cnt(se(t)),this.classBreakInfos.push(r),this.classBreakInfos.length===1&&this.notifyChange("minValue")}removeClassBreakInfo(t,e){const i=this.classBreakInfos.length;for(let r=0;r<i;r++){const n=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(n[0]===t&&n[1]===e){this.classBreakInfos.splice(r,1);break}}}getBreakIndex(t,e){return this.valueExpression&&(R(e)||R(e.arcade))&&re.getLogger(this.declaredClass).warn(""),this.valueExpression?this._getBreakIndexForExpression(t,e):this._getBreakIndexForField(t)}async getClassBreakInfo(t,e){let i=e;this.valueExpression&&(R(e)||R(e.arcade))&&(i={...i,arcade:await cy()});const r=this.getBreakIndex(t,i);return r!==-1?this.classBreakInfos[r]:null}getSymbol(t,e){if(this.valueExpression&&(R(e)||R(e.arcade)))return void re.getLogger(this.declaredClass).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this.getBreakIndex(t,e);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}async getSymbolAsync(t,e){let i=e;if(this.valueExpression&&(R(e)||R(e.arcade))){const n=await cy(),{arcadeUtils:s}=n;s.hasGeometryOperations(this.valueExpression)&&await s.enableGeometryOperations(),i={...i,arcade:n}}const r=this.getBreakIndex(t,i);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}getSymbols(){const t=[];return this.classBreakInfos.forEach(e=>{e.symbol&&t.push(e.symbol)}),this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),i=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${t}.${e}.${this.classBreakInfos.reduce((r,n)=>r+n.getMeshHash(),"")}.${i}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new yK({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol&&this.backgroundFillSymbol.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:se(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:se(this.visualVariables),legendOptions:se(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}async collectRequiredFields(t,e){const i=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(i)}async collectSymbolFields(t,e){const i=[...this.getSymbols().map(r=>r.collectRequiredFields(t,e)),Xc(t,e,this.valueExpression)];ed(t,e,this.field),ed(t,e,this.normalizationField),await Promise.all(i)}_getBreakIndexForExpression(t,e){const{viewingMode:i,scale:r,spatialReference:n,arcade:s}=Nt(e,{}),{valueExpression:o}=this;let a=this._compiledValueExpression.valueExpression===o?this._compiledValueExpression.compiledFunction:null;const l=s.arcadeUtils;if(!a){const h=l.createSyntaxTree(o);a=l.createFunction(h),this._compiledValueExpression.compiledFunction=a}this._compiledValueExpression.valueExpression=o;const c=l.executeFunction(a,l.createExecContext(t,l.getViewInfo({viewingMode:i,scale:r,spatialReference:n})));return this._getBreakIndexfromInfos(c)}_getBreakIndexForField(t){const e=this.field,i=t.attributes,r=this.normalizationType;let n=parseFloat(i[e]);if(r){const s=this.normalizationTotal,o=parseFloat(this.normalizationField?i[this.normalizationField]:void 0);if(r===qOe)n=Math.log(n)*Math.LOG10E;else if(r!==W6||s==null||isNaN(s)){if(r===X6&&!isNaN(o)){if(isNaN(n)||isNaN(o))return-1;n/=o}}else n=n/s*100}return this._getBreakIndexfromInfos(n)}_getBreakIndexfromInfos(t){const e=this.isMaxInclusive;if(t!=null&&typeof t=="number"&&!isNaN(t))for(let i=0;i<this.classBreakInfos.length;i++){const r=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(r[0]<=t&&(e?t<=r[1]:t<r[1]))return i}return-1}_areClassBreaksConsecutive(){const t=this.classBreakInfos,e=t.length;for(let i=1;i<e;i++)if(t[i-1].maxValue!==t[i].minValue)return!1;return!0}};u([d(HOe)],So.prototype,"backgroundFillSymbol",void 0),u([d({type:[LV]})],So.prototype,"classBreakInfos",void 0),u([Oe("classBreakInfos")],So.prototype,"readClassBreakInfos",null),u([Ne("classBreakInfos")],So.prototype,"writeClassBreakInfos",null),u([d({type:String,json:{write:!0}})],So.prototype,"defaultLabel",void 0),u([d(RO)],So.prototype,"defaultSymbol",void 0),u([d({type:String,json:{write:!0}})],So.prototype,"field",void 0),u([ri("field")],So.prototype,"castField",null),u([d({type:Boolean})],So.prototype,"isMaxInclusive",void 0),u([d({type:DR,json:{write:!0}})],So.prototype,"legendOptions",void 0),u([d({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return this.classBreakInfos.length!==0&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],So.prototype,"minValue",null),u([d({type:String,json:{write:!0}})],So.prototype,"normalizationField",void 0),u([d({type:Number,cast:t=>ip(t),json:{write:!0}})],So.prototype,"normalizationTotal",void 0),u([d({type:o4.apiValues,value:null,json:{type:o4.jsonValues,read:o4.read,write:o4.write}})],So.prototype,"normalizationType",null),u([ot({classBreaks:"class-breaks"})],So.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],So.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],So.prototype,"valueExpressionTitle",void 0),So=yK=u([$("esri.renderers.ClassBreaksRenderer")],So);const WOe=So;let unt=class{constructor(e,i){this._storage=new jse,this._storage.maxSize=e,i&&this._storage.registerRemoveFunc("",i)}put(e,i,r){this._storage.put(e,i,r,1)}pop(e){return this._storage.pop(e)}get(e){return this._storage.get(e)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}};const pfe="esri.renderers.support.DictionaryLoader",hnt={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};let aoe=class{constructor(e,i,r){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new unt(100),this._dictionaryPromise=null,this.url=e,this.config=i,this.fieldMap=r}getSymbolFields(){return this._symbolFields}async getSymbolAsync(e,i){let r;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(i));try{r=await this._dictionaryPromise}catch(m){if(gs(m))return this._dictionaryPromise=null,null}const n={};if(this.fieldMap)for(const m of this._symbolFields){const g=this.fieldMap[m];if(g&&e.attributes[g]!=null){const _=""+e.attributes[g];n[m]=_}else n[m]=""}const s=r==null?void 0:r(n,i);if(!s||typeof s!="string")return null;const o=Hre(s).toString(),a=this._symbolCache.get(o);if(a)return a.catch(()=>{this._symbolCache.pop(o)}),a;const l=s.split(";"),c=[],h=[];for(const m of l)if(m)if(m.includes("po:")){const g=m.substr(3).split("|");if(g.length===3){const _=g[0],b=g[1];let w=g[2];if(b==="DashTemplate")w=w.split(" ").map(x=>Number(x));else if(b==="Color"){const x=new Xe(w).toRgba();w=[x[0],x[1],x[2],255*x[3]]}else w=Number(w);h.push({primitiveName:_,propertyName:b,value:w})}}else if(m.includes("|")){for(const g of m.split("|"))if(this._itemNames.has(g)){c.push(g);break}}else this._itemNames.has(m)&&c.push(m);const p=!v(e.geometry)||!e.geometry.hasZ&&e.geometry.type==="point",f=this._cimPartsToCIMSymbol(c,h,p,i);return this._symbolCache.put(o,f,1),f}async fetchResources(e){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void re.getLogger(pfe).error("no valid URL!");const i=ir(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:v(e)?e.signal:null}),[{data:r}]=await Promise.all([i,cy()]);if(!r)throw this._dictionaryPromise=null,new H("esri.renderers.DictionaryRenderer","Bad dictionary data!");const n=r.expression,s=r.authoringInfo;this._refSymbolUrlTemplate=this.url+"/"+r.cimRefTemplateUrl,this._itemNames=new Set(r.itemsNames),this._symbolFields=s.symbol;const o={};if(this.config){const c=this.config;for(const h in c)o[h]=c[h]}if(s.configuration)for(const c of s.configuration)o.hasOwnProperty(c.name)||(o[c.name]=c.value);const a=[];if(v(e)&&e.fields&&this.fieldMap)for(const c of this._symbolFields){const h=this.fieldMap[c],p=e.fields.filter(f=>f.name===h);p.length>0&&a.push({...p[0],name:c})}const l=gHe(n,v(e)?e.spatialReference:null,a,o).then(c=>{const h={scale:0};return(p,f)=>{if(R(c))return null;const m=c.repurposeFeature({geometry:null,attributes:p});return h.scale=v(f)?f.scale??void 0:void 0,c.evaluate({$feature:m,$view:h})}}).catch(c=>(re.getLogger(pfe).error("Creating dictinoary expression failed:",c),null));return this._dictionaryPromise=l,l}async _cimPartsToCIMSymbol(e,i,r,n){const s=new Array(e.length);for(let l=0;l<e.length;l++)s[l]=this._getSymbolPart(e[l],n);const o=await Promise.all(s),a=this.fieldMap;if(a)for(const l of o)XOe(l,a);return new yO({data:this._combineSymbolParts(o,i,r)})}async _getSymbolPart(e,i){if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then(s=>s.data);const r=this._refSymbolUrlTemplate.replace(/\{itemName\}/gi,e),n=ir(r,{responseType:"json",query:{f:"json"},...i});this._ongoingRequests.set(e,n);try{return(await n).data}catch(s){throw this._ongoingRequests.delete(e),s}}_combineSymbolParts(e,i,r){if(!e||e.length===0)return null;const n={...e[0]};if(e.length>1){n.symbolLayers=[];for(const s of e){const o=s;n.symbolLayers.unshift(...o.symbolLayers)}}return r&&(n.callout=hnt),{type:"CIMSymbolReference",symbol:n,primitiveOverrides:i}}};function XOe(t,e){if(!t)return;const i=t.symbolLayers;if(!i)return;let r=i.length;for(;r--;){const n=i[r];n&&n.enable!==!1&&n.type==="CIMVectorMarker"&&dnt(n,e)}}function dnt(t,e){const i=t.markerGraphics;if(i)for(const r of i){if(!r)continue;const n=r.symbol;if(n)switch(n.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":XOe(n,e);break;case"CIMTextSymbol":n.fieldMap=e}}}const oBt=Object.freeze(Object.defineProperty({__proto__:null,DictionaryLoader:aoe},Symbol.toStringTag,{value:"Module"}));var _K;let gf=_K=class extends AO(B_){constructor(t){super(t),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new aoe(this.url,this.config,this.fieldMap)}writeData(t,e){t&&(e.scalingExpressionInfo={expression:t,returnType:"number"})}writeVisualVariables(t,e,i,r){r!=null&&r.origin||super.writeVisualVariables(t,e,i,r)}clone(){return new _K({config:se(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:se(this.fieldMap),url:se(this.url),visualVariables:se(this.visualVariables)})}async getSymbolAsync(t,e){return this._loader.getSymbolAsync(t,e)}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e),this.scaleExpression&&await Xc(t,e,this.scaleExpression);for(const i in this.fieldMap){const r=this.fieldMap[i];e.has(r)&&t.add(r)}}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};u([d({type:aoe})],gf.prototype,"_loader",null),u([d({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],gf.prototype,"config",void 0),u([d({type:Object,json:{write:!0}})],gf.prototype,"fieldMap",void 0),u([d({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],gf.prototype,"scaleExpression",void 0),u([Ne("scaleExpression")],gf.prototype,"writeData",null),u([d({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(t){return{enabled:!!t&&!!this.scaleExpression}}}}})],gf.prototype,"scaleExpressionTitle",void 0),u([d({type:String,json:{write:!0}})],gf.prototype,"url",void 0),u([Ne("visualVariables")],gf.prototype,"writeVisualVariables",null),gf=_K=u([$("esri.renderers.DictionaryRenderer")],gf);const pnt=gf;var vK;let h0=vK=class extends fe{constructor(t){super(t),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(t){return t==null?t:typeof t=="function"?(re.getLogger(this.declaredClass).error(".field: field must be a string value"),null):uN(t)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new vK({color:this.color&&this.color.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([d({type:Xe,json:{type:[Number],write:!0}})],h0.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],h0.prototype,"field",void 0),u([ri("field")],h0.prototype,"castField",null),u([d({type:String,json:{write:!0}})],h0.prototype,"label",void 0),u([d({type:String,json:{write:!0}})],h0.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],h0.prototype,"valueExpressionTitle",void 0),h0=vK=u([$("esri.renderers.support.AttributeColorInfo")],h0);const YOe=h0;var bK;let Y6=bK=class extends fe{constructor(){super(...arguments),this.unit=null}clone(){return new bK({unit:this.unit})}};u([d({type:String,json:{write:!0}})],Y6.prototype,"unit",void 0),Y6=bK=u([$("esri.renderers.support.DotDensityLegendOptions")],Y6);const fnt=Y6;var wK;let yu=wK=class extends AO(B_){constructor(t){super(t),this.attributes=null,this.backgroundColor=new Xe([0,0,0,0]),this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new Vp,this.dotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(t){if(this.referenceScale==null)return this.dotValue;const e=t/this.referenceScale*this.dotValue;return e<1?1:e}getSymbol(){return new Dw({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){var t;return((t=this.attributes)==null?void 0:t.reduce((e,i)=>e+i.getAttributeHash(),""))??""}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new wK({attributes:se(this.attributes),backgroundColor:se(this.backgroundColor),dotBlendingEnabled:se(this.dotBlendingEnabled),dotShape:se(this.dotShape),dotSize:se(this.dotSize),dotValue:se(this.dotValue),legendOptions:se(this.legendOptions),outline:se(this.outline),referenceScale:se(this.referenceScale),visualVariables:se(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}getControllerHash(){var e;return`${(e=this.attributes)==null?void 0:e.map(i=>i.field||i.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e);for(const i of this.attributes??[])i.valueExpression&&await Xc(t,e,i.valueExpression),i.field&&t.add(i.field)}};u([d({type:[YOe],json:{write:!0}})],yu.prototype,"attributes",void 0),u([d({type:Xe,json:{write:!0}})],yu.prototype,"backgroundColor",void 0),u([d({type:Boolean,json:{write:!0}})],yu.prototype,"dotBlendingEnabled",void 0),u([d({type:String,json:{write:!1}})],yu.prototype,"dotShape",void 0),u([d({type:Number,json:{write:!0}})],yu.prototype,"dotSize",void 0),u([d({type:fnt,json:{write:!0}})],yu.prototype,"legendOptions",void 0),u([d({type:Vp,json:{default:null,write:!0}})],yu.prototype,"outline",void 0),u([d({type:Number,json:{write:!0}})],yu.prototype,"dotValue",void 0),u([d({type:Number,json:{write:!0}})],yu.prototype,"referenceScale",void 0),u([d({type:Number,json:{write:!0}})],yu.prototype,"seed",void 0),u([ot({dotDensity:"dot-density"})],yu.prototype,"type",void 0),yu=wK=u([$("esri.renderers.DotDensityRenderer")],yu);const mnt=yu;let BC=class extends xr(fe){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};u([d({type:String,json:{write:!0}})],BC.prototype,"minLabel",void 0),u([d({type:String,json:{write:!0}})],BC.prototype,"maxLabel",void 0),u([d({type:String,json:{write:!0}})],BC.prototype,"title",void 0),BC=u([$("esri.renderers.support.HeatmapLegendOptions")],BC);function pi(){return[0,0,0,0]}function DN(t){return[t[0],t[1],t[2],t[3]]}function Zt(t,e,i,r){return[t,e,i,r]}function loe(t){const e=pi(),i=Math.min(4,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function ZOe(t,e){return new Float64Array(t,e,4)}function JOe(){return pi()}function KOe(){return Zt(1,1,1,1)}function QOe(){return Zt(1,0,0,0)}function e3e(){return Zt(0,1,0,0)}function t3e(){return Zt(0,0,1,0)}function i3e(){return Zt(0,0,0,1)}const Qg=JOe(),dp=KOe(),gnt=QOe(),ynt=e3e(),_nt=t3e(),vnt=i3e();Object.freeze(Object.defineProperty({__proto__:null,ONES:dp,UNIT_W:vnt,UNIT_X:gnt,UNIT_Y:ynt,UNIT_Z:_nt,ZEROS:Qg,clone:DN,create:pi,createView:ZOe,fromArray:loe,fromValues:Zt,ones:KOe,unitW:i3e,unitX:QOe,unitY:e3e,unitZ:t3e,zeros:JOe},Symbol.toStringTag,{value:"Module"}));const coe=2.4;function bnt(t){return Ip(t*coe)}function wnt(t){return ga(t)/coe}function xnt(t,e,i,r){let{color:n,ratio:s}=e,{color:o,ratio:a}=i;a===s&&(a===1?s-=1e-6:a+=1e-6);const l=_e((r-s)/(a-s),0,1);j9(t,n.toArray(),o.toArray(),l)}function lBt(t){const i=new Uint8ClampedArray(2048);if(t=t.filter(({ratio:a})=>a>=0&&a<=1).sort((a,l)=>a.ratio-l.ratio).map(({color:a,ratio:l})=>({color:a,ratio:Math.max(l,.001)})),t.length<1)return i;let r=t[0],n=t[0],s=1;const o=pi();for(let a=0;a<512;a++){const l=(a+.5)/512;for(;l>n.ratio&&s<t.length;)r=n,n=t[s++];xnt(o,r,n,l),i.set(o,4*a)}return i}function cBt(t,e,i,r){const{radius:n,fieldOffset:s,field:o}=e,a=Math.round(ga(n)),l=new Float64Array(i*r);let c,h=Number.NEGATIVE_INFINITY;const p=Ent(o,s),f=new Set;for(const m of t){const g=m.getCursor();for(;g.next();){const _=g.getObjectId();if(f.has(_))continue;f.add(_);const b=g.readLegacyPointGeometry(),w=128;if(b.x<-w||b.x>=i+w||b.y<-w||b.y>r+w)continue;const x=+p(g),T=Math.max(0,Math.round(b.x)-a),E=Math.max(0,Math.round(b.y)-a),C=Math.min(r,Math.round(b.y)+a),A=Math.min(i,Math.round(b.x)+a);for(let I=E;I<C;I++)for(let O=T;O<A;O++){const D=I*i+O,U=Snt(b.x-O,b.y-I,a);c=l[D]+=U*x,c>h&&(h=c)}}}return{matrix:l.buffer,max:h}}function uBt(t,e,i,r,n,s){t.canvas.width=t.canvas.height=e,t.clearRect(0,0,e,e);const o=t.getImageData(0,0,e,e);i&&r&&o.data.set(new Uint8ClampedArray(Tnt(e,i,r,n,s))),t.putImageData(o,0,0)}function Tnt(t,e,i,r,n){const s=new Uint32Array(t*t),o="buffer"in e?e:new Float64Array(e),a="buffer"in i?new Uint32Array(i.buffer):new Uint32Array(new Uint8Array(i).buffer),l=a.length/(n-r);for(let c=0;c<o.length;c++){const h=o[c],p=Math.floor((h-r)*l);s[c]=a[_e(p,0,a.length-1)]}return s.buffer}function Snt(t,e,i){const r=Math.sqrt(t**2+e**2)/i;return r>1?0:3/(Math.PI*i**2)*(1-r**2)**2}function hBt(t,e){return typeof t=="function"?t:t?typeof e=="string"?i=>-1*+i[t]:i=>+i[t]+e:()=>1}function Ent(t,e){return t!=null?typeof e=="string"?i=>-1*+i.readAttribute(t):i=>+i.readAttribute(t)+e:i=>1}var xK;const r3e="esri.renderers.HeatmapRenderer",Cnt=re.getLogger(r3e);function ffe(t){if(t!=null){const{maxDensity:e,minDensity:i,radius:r}=t;if(e!=null||i!=null||r!=null){const{blurRadius:n,maxPixelIntensity:s,minPixelIntensity:o,...a}=t;return a}}return t}let ea=xK=class extends B_{constructor(t){super(t),this.authoringInfo=null,this.colorStops=[new $$({ratio:0,color:new Xe("rgba(255, 140, 0, 0)")}),new $$({ratio:.75,color:new Xe("rgba(255, 140, 0, 1)")}),new $$({ratio:.9,color:new Xe("rgba(255, 0,   0, 1)")})],this.field=null,this.fieldOffset=0,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null,this._warnedProps={blurRadius:!1,maxPixelIntensity:!1,minPixelIntensity:!1}}normalizeCtorArgs(t){return ffe(t)}get blurRadius(){return wnt(this.radius)}set blurRadius(t){const e=this.maxPixelIntensity,i=this.minPixelIntensity;this._set("radius",bnt(t)),this._warnAboutDeprecatedGaussianBlurProp("blurRadius","radius"),this._set("maxDensity",e*this._pixelIntensityToDensity),this._set("minDensity",i*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(t){this._set("maxDensity",t*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("maxPixelIntensity","maxDensity")}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(t){this._set("minDensity",t*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("minPixelIntensity","minDensity")}get _pixelIntensityToDensity(){return 24/(coe**2*this.blurRadius**4)}_warnAboutDeprecatedGaussianBlurProp(t,e){this._warnedProps[t]||Ql(this).getDefaultOrigin()==="user"&&(this._warnedProps[t]=!0,V2(()=>{fS(Cnt,t,{replacement:`${String(e)} (suggested value: ${this._get(e)})`,version:"4.24"})}))}read(t,e){t=ffe(t),super.read(t,e)}getSymbol(){return new Nw}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}async collectRequiredFields(t,e){const i=this.field,r=this.valueExpression;i&&typeof i=="string"&&await ed(t,e,i),r&&typeof r=="string"&&await Xc(t,e,r)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new xK({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:se(this.colorStops),field:this.field,legendOptions:se(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([d({type:roe,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],ea.prototype,"authoringInfo",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],ea.prototype,"blurRadius",null),u([d({type:[$$],json:{write:!0}})],ea.prototype,"colorStops",void 0),u([d({type:String,json:{write:!0}})],ea.prototype,"field",void 0),u([d({type:Number,json:{write:{overridePolicy:(t,e,i)=>({enabled:i==null})},origins:{"web-scene":{write:!1}}}})],ea.prototype,"fieldOffset",void 0),u([d({type:BC,json:{write:!0}})],ea.prototype,"legendOptions",void 0),u([d({type:Number,json:{write:!0}})],ea.prototype,"maxDensity",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],ea.prototype,"maxPixelIntensity",null),u([d({type:Number,json:{write:!0}})],ea.prototype,"minDensity",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],ea.prototype,"minPixelIntensity",null),u([d({type:Number,cast:vr,json:{write:!0}})],ea.prototype,"radius",void 0),u([d({type:Number,range:{min:0},json:{default:0,write:!0}})],ea.prototype,"referenceScale",void 0),u([ot({heatmap:"heatmap"})],ea.prototype,"type",void 0),u([d({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],ea.prototype,"valueExpression",void 0),u([d({type:String})],ea.prototype,"valueExpressionTitle",void 0),u([d({readOnly:!0})],ea.prototype,"_pixelIntensityToDensity",null),ea=xK=u([$(r3e)],ea);const n3e=ea;let JT=class extends xr(fe){constructor(){super(...arguments),this.color=new Xe([0,0,0,0]),this.label=null,this.threshold=0}};u([d({type:Xe,json:{write:!0}})],JT.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],JT.prototype,"label",void 0),u([d({type:Number,range:{min:0,max:1},json:{write:!0}})],JT.prototype,"threshold",void 0),JT=u([$("esri.renderers.support.OthersCategory")],JT);let Z6=class extends xr(fe){constructor(){super(...arguments),this.title=null}};u([d({type:String,json:{write:!0}})],Z6.prototype,"title",void 0),Z6=u([$("esri.renderers.support.PieChartLegendOptions")],Z6);let wh=class extends AO(xr(B_)){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new Xe([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new JT,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart"}getSymbol(){var e;return new Nw({size:this.size?this.size/2+(((e=this.outline)==null?void 0:e.width)||0):0})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol(),this.backgroundFillSymbol].filter(v)}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,i)=>e+i.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,i)=>e+JSON.stringify(i),"")}async collectRequiredFields(e,i){await this.collectVVRequiredFields(e,i);for(const r of this.attributes)r.valueExpression&&await Xc(e,i,r.valueExpression),r.field&&e.add(r.field)}};u([d({type:[YOe],json:{write:!0}})],wh.prototype,"attributes",void 0),u([d({type:Dw,json:{default:null,write:!0}})],wh.prototype,"backgroundFillSymbol",void 0),u([d({type:Xe,json:{write:!0}})],wh.prototype,"defaultColor",void 0),u([d({type:String,json:{write:!0}})],wh.prototype,"defaultLabel",void 0),u([d({type:Number,range:{min:0,max:1},json:{write:!0}})],wh.prototype,"holePercentage",void 0),u([d({type:JT,json:{write:!0}})],wh.prototype,"othersCategory",void 0),u([d({type:Z6,json:{write:!0}})],wh.prototype,"legendOptions",void 0),u([d({type:Vp,json:{default:null,write:!0}})],wh.prototype,"outline",void 0),u([d({type:Number,cast:vr,json:{write:!0}})],wh.prototype,"size",void 0),u([ot({pieChart:"pie-chart"})],wh.prototype,"type",void 0),wh=u([$("esri.renderers.PieChartRenderer")],wh);const Ant=wh;var TK;let cT=TK=class extends AO(B_){constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(t,e){await Promise.all([this.collectSymbolFields(t,e),this.collectVVRequiredFields(t,e)])}async collectSymbolFields(t,e){await Promise.all(this.getSymbols().map(i=>i.collectRequiredFields(t,e)))}getSymbol(t,e){return this.symbol}async getSymbolAsync(t,e){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((t,e)=>t+JSON.stringify(e),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new TK({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:se(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}};u([d({type:String,json:{write:!0}})],cT.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],cT.prototype,"label",void 0),u([d(RO)],cT.prototype,"symbol",void 0),u([ot({simple:"simple"})],cT.prototype,"type",void 0),cT=TK=u([$("esri.renderers.SimpleRenderer")],cT);const DM=cT,Rnt=["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"];function SK(t){return t instanceof ve}function mfe(t){return t instanceof tt?Object.keys(t.items):SK(t)?Ql(t).keys():t?Object.keys(t):[]}function a4(t,e){return t instanceof tt?t.items[e]:t[e]}function Mnt(t,e){return!(!Array.isArray(t)||!Array.isArray(e))&&t.length!==e.length}function N$(t){return t?t.declaredClass:null}function s3e(t,e){const i=t.diff;if(i&&typeof i=="function")return i(t,e);const r=mfe(t),n=mfe(e);if(r.length===0&&n.length===0)return;if(!r.length||!n.length||Mnt(t,e))return{type:"complete",oldValue:t,newValue:e};const s=n.filter(p=>!r.includes(p)),o=r.filter(p=>!n.includes(p)),a=r.filter(p=>n.includes(p)&&a4(t,p)!==a4(e,p)).concat(s,o).sort(),l=N$(t);if(l&&Rnt.includes(l)&&a.length)return{type:"complete",oldValue:t,newValue:e};let c;const h=SK(t)&&SK(e);for(const p of a){const f=a4(t,p),m=a4(e,p);let g;if((h||typeof f!="function"&&typeof m!="function")&&f!==m&&(f!=null||m!=null)){if(i&&i[p]&&typeof i[p]=="function")g=i[p](f,m);else if(f instanceof Date&&m instanceof Date){if(f.getTime()===m.getTime())continue;g={type:"complete",oldValue:f,newValue:m}}else g=typeof f=="object"&&typeof m=="object"&&N$(f)===N$(m)?s3e(f,m):{type:"complete",oldValue:f,newValue:m};v(g)&&(v(c)?c.diff[p]=g:c={type:"partial",diff:{[p]:g}})}}return c}function Ont(t,e){if(R(t))return!1;const i=e.split(".");let r=t;for(const n of i){if(r.type==="complete")return!0;if(r.type!=="partial")return!1;{const s=r.diff[n];if(!s)return!1;r=s}}return!0}function mBt(t,e){for(const i of e)if(Ont(t,i))return!0;return!1}function Pnt(t,e){if(!(typeof t=="function"||typeof e=="function"||R(t)&&R(e)))return R(t)||R(e)||typeof t=="object"&&typeof e=="object"&&N$(t)!==N$(e)?{type:"complete",oldValue:t,newValue:e}:s3e(t,e)}function l4(t){if(R(t))return!0;switch(t.type){case"complete":return!1;case"collection":{const e=t;for(const i of e.added)if(!l4(i))return!1;for(const i of e.removed)if(!l4(i))return!1;for(const i of e.changed)if(!l4(i))return!1;return!0}case"partial":for(const e in t.diff)if(!l4(t.diff[e]))return!1;return!0}}let jC=class extends xr(fe){constructor(e){super(e),this.value=null,this.value2=null,this.value3=null}};u([d(q6)],jC.prototype,"value",void 0),u([d(q6)],jC.prototype,"value2",void 0),u([d(q6)],jC.prototype,"value3",void 0),jC=u([$("esri.renderers.support.UniqueValue")],jC);const NR=jC;let d1=class extends xr(fe){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.values=null}castValues(e){if(e==null)return null;const i=typeof(e=Array.isArray(e)?e:[e])[0];return i==="string"||i==="number"?e.map(r=>new NR({value:r})):i==="object"?e[0]instanceof NR?e:e.map(r=>new NR(r)):null}};u([d({type:String,json:{write:!0}})],d1.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],d1.prototype,"label",void 0),u([d(RO)],d1.prototype,"symbol",void 0),u([d({type:[NR],json:{type:[[String]],read:{reader:t=>t?t.map(e=>new NR({value:e[0],value2:e[1],value3:e[2]})):null},write:{writer:(t,e)=>{const i=[];for(const r of t){const n=[r.value,r.value2,r.value3].filter(v).map(s=>s.toString());i.push(n)}e.values=i}}}})],d1.prototype,"values",void 0),u([ri("values")],d1.prototype,"castValues",null),d1=u([$("esri.renderers.support.UniqueValueClass")],d1);const o3e=d1;let tI=class extends xr(fe){constructor(e){super(e),this.heading=null,this.classes=null}};u([d({type:String,json:{write:!0}})],tI.prototype,"heading",void 0),u([d({type:[o3e],json:{write:!0}})],tI.prototype,"classes",void 0),tI=u([$("esri.renderers.support.UniqueValueGroup")],tI);const EK=tI;var CK;let uT=CK=class extends fe{constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new CK({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const t=JSON.stringify(this.symbol&&this.symbol.toJSON());return`${this.value}.${t}`}};u([d({type:String,json:{write:!0}})],uT.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],uT.prototype,"label",void 0),u([d(RO)],uT.prototype,"symbol",void 0),u([d(q6)],uT.prototype,"value",void 0),uT=CK=u([$("esri.renderers.support.UniqueValueInfo")],uT);const F$=uT,Int=()=>!!ue("enable-feature:force-wosr"),vBt=()=>!!ue("enable-feature:direct-3d-object-feature-layer-display"),bBt=()=>!!ue("enable-feature:SceneLayer-editing");let CG={};async function $nt(t,e){try{return{data:(await Fnt(t,e)).data,baseUrl:lXe(t),styleUrl:t}}catch(i){return Du(i),null}}function Lnt(t,e,i){const r=v(e.portal)?e.portal:ya.getDefault();let n;const s=`${r.url} - ${r.user&&r.user.username} - ${t}`;return CG[s]||(CG[s]=Dnt(t,r,i).then(o=>(n=o,o.fetchData())).then(o=>({data:o,baseUrl:n.itemUrl??"",styleName:t}))),CG[s]}function Dnt(t,e,i){return e.load(i).then(()=>{const r=new B0({disableExtraQuery:!0,query:`owner:${gfe} AND type:${yfe} AND typekeywords:"${t}"`});return e.queryItems(r,i)}).then(({results:r})=>{var o;let n=null;const s=t.toLowerCase();if(r&&Array.isArray(r)){for(const a of r)if(((o=a.typeKeywords)==null?void 0:o.some(c=>c.toLowerCase()===s))&&a.type===yfe&&a.owner===gfe){n=a;break}}if(!n)throw new H("symbolstyleutils:style-not-found",`The style '${t}' could not be found`,{styleName:t});return n.load(i)})}function Nnt(t,e,i){return t&&v(t.styleUrl)?$nt(t.styleUrl,i):t&&v(t.styleName)?Lnt(t.styleName,e,i):Promise.reject(new H("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function wBt(t){return t===null||t.type==="CIMSymbolReference"?t:{type:"CIMSymbolReference",symbol:t}}function xBt(t,e){if(e==="cimRef")return t.cimRef;if(t.formatInfos&&!Int()){for(const i of t.formatInfos)if(i.type==="gltf")return i.href}return t.webRef}function Fnt(t,e){const i={responseType:"json",query:{f:"json"},...e};return ir(am(t),i)}const gfe="esri_en",yfe="Style",TBt="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json";var iI;const a3e="esri.renderers.UniqueValueRenderer",yv=re.getLogger(a3e),_fe="uvInfos-watcher",vfe="uvGroups-watcher",knt=",",Unt=Ts(F$);function Vnt(t){const{field1:e,field2:i,field3:r,fieldDelimiter:n,uniqueValueInfos:s,valueExpression:o}=t,a=!(!e||!i);return[{classes:(s??[]).map(l=>{var w;const{symbol:c,label:h,value:p,description:f}=l,[m,g,_]=a?((w=p==null?void 0:p.toString())==null?void 0:w.split(n||""))||[]:[p],b=[];return(e||o)&&b.push(m),i&&b.push(g),r&&b.push(_),{symbol:c,label:h,values:[b],description:f}})}]}let ss=iI=class extends AO(B_){constructor(t){super(t),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this._isInfosSource=null,this.type="unique-value",this.backgroundFillSymbol=null,this.orderByClassesEnabled=!1,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(e,i){if(!e&&!i)return;if(!e||!i)return{type:"complete",oldValue:e,newValue:i};let r=!1;const n={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let s=0;s<i.length;s++){const o=e.find(a=>a.value===i[s].value);o?Pnt(o,i[s])?(n.changed.push({type:"complete",oldValue:o,newValue:i[s]}),r=!0):n.unchanged.push({oldValue:o,newValue:i[s]}):(n.added.push(i[s]),r=!0)}for(let s=0;s<e.length;s++)i.find(o=>o.value===e[s].value)||(n.removed.push(e[s]),r=!0);return r?n:void 0}},this._set("uniqueValueInfos",[]),this._set("uniqueValueGroups",[])}get _cache(){return{compiledFunc:null}}set field(t){this._set("field",t),this._updateFieldDelimiter(),this._updateUniqueValues()}castField(t){return t==null||typeof t=="function"?t:uN(t)}writeField(t,e,i,r){typeof t=="string"?e[i]=t:r&&r.messages?r.messages.push(new H("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):yv.error(".field: cannot write field to JSON since it's not a string value")}set field2(t){this._set("field2",t),this._updateFieldDelimiter(),this._updateUniqueValues()}set field3(t){this._set("field3",t),this._updateUniqueValues()}set valueExpression(t){this._set("valueExpression",t),this._updateUniqueValues()}set defaultSymbol(t){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",t)}set fieldDelimiter(t){this._set("fieldDelimiter",t),this._updateUniqueValues()}readPortal(t,e,i){return i.portal||ya.getDefault()}readStyleOrigin(t,e,i){if(e.styleName)return Object.freeze({styleName:e.styleName});if(e.styleUrl){const r=G2(e.styleUrl,i);return Object.freeze({styleUrl:r})}}writeStyleOrigin(t,e,i,r){t.styleName?e.styleName=t.styleName:t.styleUrl&&(e.styleUrl=R_(t.styleUrl,r))}set uniqueValueGroups(t){this.styleOrigin?yv.error("#uniqueValueGroups=","Cannot modify unique value groups of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueGroups",t),this._updateInfosFromGroups(),this._isInfosSource=!1,this._watchUniqueValueGroups())}set uniqueValueInfos(t){this.styleOrigin?yv.error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos())}addUniqueValueInfo(t,e){var r;if(this.styleOrigin)return void yv.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let i;i=typeof t=="object"?Unt(t):new F$({value:t,symbol:wAe(e)}),(r=this.uniqueValueInfos)==null||r.push(i),this._valueInfoMap[i.value]=i,this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}removeUniqueValueInfo(t){if(this.styleOrigin)return void yv.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");const e=this.uniqueValueInfos;if(e){for(let i=0;i<e.length;i++)if(e[i].value===t+""){delete this._valueInfoMap[t],e.splice(i,1);break}}this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}async getUniqueValueInfo(t,e){let i=e;return this.valueExpression&&(R(e)||R(e.arcade))&&(i={...i,arcade:await cy()}),this._getUniqueValueInfo(t,i)}getSymbol(t,e){if(this.valueExpression&&(R(e)||R(e.arcade)))return void yv.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this._getUniqueValueInfo(t,e);return i&&i.symbol||this.defaultSymbol}async getSymbolAsync(t,e){let i=e;if(this.valueExpression&&(R(i)||R(i.arcade))){const n=await cy(),{arcadeUtils:s}=n;s.hasGeometryOperations(this.valueExpression)&&await s.enableGeometryOperations(),i={...i,arcade:n}}const r=this._getUniqueValueInfo(t,i);return r&&r.symbol||this.defaultSymbol}getSymbols(){const t=[];for(const e of this.uniqueValueInfos??[])e.symbol&&t.push(e.symbol);return this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){var r;const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),i=(r=this.uniqueValueInfos)==null?void 0:r.reduce((n,s)=>n+s.getMeshHash(),"");return`${t}.${e}.${i}.${`${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}`}.${this.valueExpression}`}clone(){const t=new iI({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:se(this.defaultSymbol),orderByClassesEnabled:this.orderByClassesEnabled,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:se(this.visualVariables),legendOptions:se(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),backgroundFillSymbol:se(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(t._isDefaultSymbolDerived=!0),t._set("portal",this.portal);const e=se(this.uniqueValueInfos),i=se(this.uniqueValueGroups);return this.styleOrigin&&(t._set("styleOrigin",Object.freeze(se(this.styleOrigin))),Object.freeze(e),Object.freeze(i)),t._set("uniqueValueInfos",e),t._updateValueInfoMap(),t._set("uniqueValueGroups",i),t._isInfosSource=this._isInfosSource,t._watchUniqueValueInfosAndGroups(),t}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(t,e){const i=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(i)}async collectSymbolFields(t,e){const i=[...this.getSymbols().map(r=>r.collectRequiredFields(t,e)),Xc(t,e,this.valueExpression)];ed(t,e,this.field),ed(t,e,this.field2),ed(t,e,this.field3),await Promise.all(i)}populateFromStyle(){return Nnt(this.styleOrigin,{portal:this.portal}).then(t=>{var i;const e=[];return this._valueInfoMap={},t&&t.data&&Array.isArray(t.data.items)&&t.data.items.forEach(r=>{const n=new q2({styleUrl:t.styleUrl,styleName:t.styleName,portal:this.portal,name:r.name});this.defaultSymbol||r.name!==t.data.defaultItem||(this.defaultSymbol=n,this._isDefaultSymbolDerived=!0);const s=new F$({value:r.name,symbol:n});e.push(s),this._valueInfoMap[r.name]=s}),this._set("uniqueValueInfos",Object.freeze(e)),this._updateGroupsFromInfos(!0),this._isInfosSource=null,this._watchUniqueValueInfos(),!this.defaultSymbol&&((i=this.uniqueValueInfos)!=null&&i.length)&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateFieldDelimiter(){this.field&&this.field2&&!this.fieldDelimiter&&this._set("fieldDelimiter",knt)}_updateUniqueValues(){this._isInfosSource!=null&&(this._isInfosSource?this._updateGroupsFromInfos():this._updateInfosFromGroups())}_updateValueInfoMap(){this._valueInfoMap={};const{uniqueValueInfos:t}=this;if(t)for(const e of t)this._valueInfoMap[e.value+""]=e}_watchUniqueValueInfosAndGroups(){this._watchUniqueValueInfos(),this._watchUniqueValueGroups()}_watchUniqueValueInfos(){this.removeHandles(_fe);const{uniqueValueInfos:t}=this;if(t){const e=[];for(const i of t)e.push(ne(()=>({symbol:i.symbol,value:i.value,label:i.label,description:i.description}),(r,n)=>{r!==n&&(this._updateGroupsFromInfos(),this._isInfosSource=!0)},{sync:!0}));this.addHandles(e,_fe)}}_watchUniqueValueGroups(){this.removeHandles(vfe);const{uniqueValueGroups:t}=this;if(t){const e=[];for(const i of t){e.push(ne(()=>({classes:i.classes}),(r,n)=>{r!==n&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}));for(const r of i.classes??[])e.push(ne(()=>({symbol:r.symbol,values:r.values,label:r.label,description:r.description}),(n,s)=>{n!==s&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}))}this.addHandles(e,vfe)}}_updateInfosFromGroups(){if(!this.uniqueValueGroups)return this._set("uniqueValueInfos",null),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const t=[],{field:e,field2:i,field3:r,fieldDelimiter:n,uniqueValueGroups:s,valueExpression:o}=this;if(!e&&!o)return this._set("uniqueValueInfos",t),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const a=!(!e||!i);for(const l of s)for(const c of l.classes??[]){const{symbol:h,label:p,values:f,description:m}=c;for(const g of f??[]){const{value:_,value2:b,value3:w}=g,x=[_];i&&x.push(b),r&&x.push(w);const T=a?x.join(n||""):x[0];t.push(new F$({symbol:h,label:p,value:T,description:m}))}}this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._watchUniqueValueInfos()}_updateGroupsFromInfos(t=!1){if(!this.uniqueValueInfos)return this._set("uniqueValueGroups",null),void this._watchUniqueValueGroups();const{field:e,field2:i,valueExpression:r,fieldDelimiter:n,uniqueValueInfos:s}=this;if(!e&&!r||!s.length)return this._set("uniqueValueGroups",[]),void this._watchUniqueValueGroups();const o=!(!e||!i),a=s.map(c=>{var w;const{symbol:h,label:p,value:f,description:m}=c,[g,_,b]=o?((w=f==null?void 0:f.toString())==null?void 0:w.split(n||""))||[]:[f];return new o3e({symbol:h,label:p,description:m,values:[new NR({value:g,value2:_,value3:b})]})}),l=[new EK({classes:a})];t&&Object.freeze(l),this._set("uniqueValueGroups",l),this._watchUniqueValueGroups()}_getUniqueValueInfo(t,e){return this.valueExpression?this._getUnqiueValueInfoForExpression(t,e):this._getUnqiueValueInfoForFields(t)}_getUnqiueValueInfoForExpression(t,e){const{viewingMode:i,scale:r,spatialReference:n,arcade:s}=Nt(e,{});let o=this._cache.compiledFunc;const a=s.arcadeUtils;if(!o){const c=a.createSyntaxTree(this.valueExpression);o=a.createFunction(c),this._cache.compiledFunc=o}const l=a.executeFunction(o,a.createExecContext(t,a.getViewInfo({viewingMode:i,scale:r,spatialReference:n})));return this._valueInfoMap[l+""]}_getUnqiueValueInfoForFields(t){const e=this.field,i=t.attributes;let r;if(typeof e!="function"&&this.field2){const n=this.field2,s=this.field3,o=[];e&&o.push(i[e]),n&&o.push(i[n]),s&&o.push(i[s]),r=o.join(this.fieldDelimiter||"")}else typeof e=="function"?r=e(t):e&&(r=i[e]);return this._valueInfoMap[r+""]}static fromPortalStyle(t,e){const i=new iI(e&&e.properties);i._set("styleOrigin",Object.freeze({styleName:t})),i._set("portal",e&&e.portal||ya.getDefault());const r=i.populateFromStyle();return r.catch(n=>{yv.error(`#fromPortalStyle('${t}'[, ...])`,"Failed to create unique value renderer from style name",n)}),r}static fromStyleUrl(t,e){const i=new iI(e&&e.properties);i._set("styleOrigin",Object.freeze({styleUrl:t}));const r=i.populateFromStyle();return r.catch(n=>{yv.error(`#fromStyleUrl('${t}'[, ...])`,"Failed to create unique value renderer from style URL",n)}),r}};u([d({readOnly:!0})],ss.prototype,"_cache",null),u([ot({uniqueValue:"unique-value"})],ss.prototype,"type",void 0),u([d(HOe)],ss.prototype,"backgroundFillSymbol",void 0),u([d({value:null,json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],ss.prototype,"field",null),u([ri("field")],ss.prototype,"castField",null),u([Ne("field")],ss.prototype,"writeField",null),u([d({type:String,value:null,json:{write:!0}})],ss.prototype,"field2",null),u([d({type:String,value:null,json:{write:!0}})],ss.prototype,"field3",null),u([d({type:Boolean,json:{name:"drawInClassOrder",default:!1,write:!0,origins:{"web-scene":{write:!1}}}})],ss.prototype,"orderByClassesEnabled",void 0),u([d({type:String,value:null,json:{write:!0}})],ss.prototype,"valueExpression",null),u([d({type:String,json:{write:!0}})],ss.prototype,"valueExpressionTitle",void 0),u([d({type:DR,json:{write:!0}})],ss.prototype,"legendOptions",void 0),u([d({type:String,json:{write:!0}})],ss.prototype,"defaultLabel",void 0),u([d(DSe({...RO},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],ss.prototype,"defaultSymbol",null),u([d({type:String,value:null,json:{write:!0}})],ss.prototype,"fieldDelimiter",null),u([d({type:ya,readOnly:!0})],ss.prototype,"portal",void 0),u([Oe("portal",["styleName"])],ss.prototype,"readPortal",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],ss.prototype,"styleOrigin",void 0),u([Oe("styleOrigin",["styleName","styleUrl"])],ss.prototype,"readStyleOrigin",null),u([Ne("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],ss.prototype,"writeStyleOrigin",null),u([d({type:[EK],json:{read:{source:["uniqueValueGroups","uniqueValueInfos"],reader:(t,e,i)=>(e.uniqueValueGroups||Vnt(e)).map(r=>EK.fromJSON(r,i))},write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],ss.prototype,"uniqueValueGroups",null),u([d({type:[F$],json:{read:!1,write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],ss.prototype,"uniqueValueInfos",null),ss=iI=u([$(a3e)],ss);const NN=ss,CB={key:"type",base:B_,typeMap:{heatmap:n3e,simple:DM,"unique-value":NN,"class-breaks":WOe,"dot-density":mnt,dictionary:pnt,"pie-chart":Ant},errorContext:"renderer"},znt={key:"type",base:B_,typeMap:{simple:DM,"unique-value":NN,"class-breaks":WOe,heatmap:n3e},errorContext:"renderer"};function SBt(t,e){return lD(t,null,e)}const Bnt=Ow({types:CB});function lD(t,e,i){return t?t&&(t.styleName||t.styleUrl)&&t.type!=="uniqueValue"?(i&&i.messages&&i.messages.push(new Op("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+t.type+"'",{definition:t,context:i})),null):Bnt(t,e,i):null}let jnt=class l3e{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(dY),this._values=new Map,this.multipleOriginsSupported=!0}clone(e){const i=new l3e,r=this._originStores[Qi.DEFAULTS];r&&r.forEach((n,s)=>{i.set(s,se(n),Qi.DEFAULTS)});for(let n=Qi.SERVICE;n<dY;n++){const s=this._originStores[n];s&&s.forEach((o,a)=>{e&&e.has(a)||i.set(a,se(o),n)})}return i}get(e,i){const r=i===void 0?this._values:this._originStores[i];return r?r.get(e):void 0}keys(e){const i=e==null?this._values:this._originStores[e];return i?[...i.keys()]:[]}set(e,i,r=Qi.USER){let n=this._originStores[r];if(n||(n=new Map,this._originStores[r]=n),n.set(e,i),!this._values.has(e)||this._propertyOriginMap.get(e)<=r){const s=this._values.get(e);return this._values.set(e,i),this._propertyOriginMap.set(e,r),s!==i}return!1}delete(e,i=Qi.USER){const r=this._originStores[i];if(!r)return;const n=r.get(e);if(r.delete(e),this._values.has(e)&&this._propertyOriginMap.get(e)===i){this._values.delete(e);for(let s=i-1;s>=0;s--){const o=this._originStores[s];if(o&&o.has(e)){this._values.set(e,o.get(e)),this._propertyOriginMap.set(e,s);break}}}return n}has(e,i){const r=i===void 0?this._values:this._originStores[i];return!!r&&r.has(e)}revert(e,i){for(;i>0&&!this.has(e,i);)--i;const r=this._originStores[i],n=r&&r.get(e),s=this._values.get(e);return this._values.set(e,n),this._propertyOriginMap.set(e,i),s!==n}originOf(e){return this._propertyOriginMap.get(e)||Qi.DEFAULTS}forEach(e){this._values.forEach(e)}};const c3e=t=>{let e=class extends t{constructor(...i){super(...i);const r=Ql(this),n=r.store,s=new jnt;r.store=s,M2e(r,n,s)}read(i,r){P2e(this,i,r)}getAtOrigin(i,r){const n=AG(this),s=cb(r);if(typeof i=="string")return n.get(i,s);const o={};return i.forEach(a=>{o[a]=n.get(a,s)}),o}originOf(i){return H8(this.originIdOf(i))}originIdOf(i){return AG(this).originOf(i)}revert(i,r){const n=AG(this),s=cb(r),o=Ql(this);let a;a=typeof i=="string"?i==="*"?n.keys(s):[i]:i,a.forEach(l=>{o.invalidate(l),n.revert(l,s),o.commit(l)})}};return e=u([$("esri.core.ReadOnlyMultiOriginJSONSupport")],e),e};function AG(t){return Ql(t).store}let bfe=class extends c3e(ve){};bfe=u([$("esri.core.ReadOnlyMultiOriginJSONSupport")],bfe);const Gnt=t=>{let e=class extends t{constructor(...i){super(...i)}clear(i,r="user"){return RG(this).delete(i,cb(r))}write(i={},r){return L2e(this,i=i||{},r),i}setAtOrigin(i,r,n){Ql(this).setAtOrigin(i,r,cb(n))}removeOrigin(i){const r=RG(this),n=cb(i),s=r.keys(n);for(const o of s)r.originOf(o)===n&&r.set(o,r.get(o,n),Qi.USER)}updateOrigin(i,r){const n=RG(this),s=cb(r),o=this.get(i);for(let a=s+1;a<dY;++a)n.delete(i,a);n.set(i,o,s)}toJSON(i){return this.write({},i)}};return e=u([$("esri.core.WriteableMultiOriginJSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function RG(t){return Ql(t).store}const FN=t=>{let e=class extends Gnt(c3e(t)){constructor(...i){super(...i)}};return e=u([$("esri.core.MultiOriginJSONSupport")],e),e};let DV=class extends FN(ve){};DV=u([$("esri.core.MultiOriginJSONSupport")],DV);async function Hnt(t,e){const{WhereClause:i}=await Q(()=>import("./WhereClause-cdddccc4.js").then(r=>r.W),["assets/WhereClause-cdddccc4.js","assets/executionError-fb3f283a.js"]);return i.create(t,e)}function qnt(t,e){return v(t)?v(e)?`(${t}) AND (${e})`:t:e}var AK;let hT=AK=class extends fe{constructor(t){super(t),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new AK({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([d({type:String,json:{write:!0}})],hT.prototype,"expression",void 0),u([d({type:String,json:{write:!0}})],hT.prototype,"name",void 0),u([d({type:["boolean","date","number","string"],json:{write:!0}})],hT.prototype,"returnType",void 0),u([d({type:String,json:{write:!0}})],hT.prototype,"title",void 0),hT=AK=u([$("esri.form.ExpressionInfo")],hT);const Wnt=hT;let dT=class extends fe{constructor(e){super(e),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};u([d({type:String,json:{write:!0}})],dT.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],dT.prototype,"label",void 0),u([d()],dT.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],dT.prototype,"visibilityExpression",void 0),dT=u([$("esri.form.elements.Element")],dT);const NM=dT;var RK;let J6=RK=class extends fe{constructor(t){super(t),this.type=null}clone(){return new RK({type:this.type})}};u([d({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],J6.prototype,"type",void 0),J6=RK=u([$("esri.form.elements.inputs.AttachmentInput")],J6);const Xnt=J6;var MK;let pT=MK=class extends NM{constructor(t){super(t),this.attachmentKeyword=null,this.editable=!0,this.input=null,this.type="attachment"}clone(){return new MK({attachmentKeyword:this.attachmentKeyword,description:this.description,editable:this.editable,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}};u([d({type:String,json:{write:!0}})],pT.prototype,"attachmentKeyword",void 0),u([d({type:Boolean,json:{write:!0}})],pT.prototype,"editable",void 0),u([d({type:Xnt,json:{read:{source:"inputType"},write:{target:"inputType"}}})],pT.prototype,"input",void 0),u([d({type:["attachment"],json:{read:!1,write:!0}})],pT.prototype,"type",void 0),pT=MK=u([$("esri.form.elements.AttachmentElement")],pT);const wfe=pT;let K6=class extends fe{constructor(e){super(e),this.type=null}};u([d()],K6.prototype,"type",void 0),K6=u([$("esri.form.elements.inputs.Input")],K6);const MO=K6;let rI=class extends MO{constructor(e){super(e),this.maxLength=null,this.minLength=0}};u([d({type:Number,json:{write:!0}})],rI.prototype,"maxLength",void 0),u([d({type:Number,json:{write:!0}})],rI.prototype,"minLength",void 0),rI=u([$("esri.form.elements.inputs.TextInput")],rI);const uoe=rI;var OK;let Q6=OK=class extends uoe{constructor(t){super(t),this.type="barcode-scanner"}clone(){return new OK({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["barcode-scanner"],json:{read:!1,write:!0}})],Q6.prototype,"type",void 0),Q6=OK=u([$("esri.form.elements.inputs.BarcodeScannerInput")],Q6);const Ynt=Q6;var PK;let GC=PK=class extends MO{constructor(t){super(t),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="combo-box"}clone(){return new PK({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}};u([d({type:String,json:{write:!0}})],GC.prototype,"noValueOptionLabel",void 0),u([d({type:Boolean,json:{write:!0}})],GC.prototype,"showNoValueOption",void 0),u([d({type:["combo-box"],json:{read:!1,write:!0}})],GC.prototype,"type",void 0),GC=PK=u([$("esri.form.elements.inputs.ComboBoxInput")],GC);const Znt=GC;var IK;function xfe(t){return t!=null?new Date(t):null}function Tfe(t){return t?t.getTime():null}let yf=IK=class extends MO{constructor(t){super(t),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(t,e){return xfe(e.max)}writeMax(t,e){e.max=Tfe(t)}readMin(t,e){return xfe(e.min)}writeMin(t,e){e.min=Tfe(t)}clone(){return new IK({includeTime:this.includeTime,max:this.max,min:this.min})}};u([d({type:Boolean,json:{write:!0}})],yf.prototype,"includeTime",void 0),u([d({type:Date,json:{type:Number,write:!0}})],yf.prototype,"max",void 0),u([Oe("max")],yf.prototype,"readMax",null),u([Ne("max")],yf.prototype,"writeMax",null),u([d({type:Date,json:{type:Number,write:!0}})],yf.prototype,"min",void 0),u([Oe("min")],yf.prototype,"readMin",null),u([Ne("min")],yf.prototype,"writeMin",null),u([d({type:["datetime-picker"],json:{read:!1,write:!0}})],yf.prototype,"type",void 0),yf=IK=u([$("esri.form.elements.inputs.DateTimePickerInput")],yf);const Jnt=yf;var $K;let HC=$K=class extends MO{constructor(t){super(t),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="radio-buttons"}clone(){return new $K({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}};u([d({type:String,json:{write:!0}})],HC.prototype,"noValueOptionLabel",void 0),u([d({type:Boolean,json:{write:!0}})],HC.prototype,"showNoValueOption",void 0),u([d({type:["radio-buttons"],json:{read:!1,write:!0}})],HC.prototype,"type",void 0),HC=$K=u([$("esri.form.elements.inputs.RadioButtonsInput")],HC);const Knt=HC;var LK;let qC=LK=class extends MO{constructor(t){super(t),this.offValue=null,this.onValue=null,this.type="switch"}clone(){return new LK({offValue:this.offValue,onValue:this.onValue})}};u([d({type:[String,Number],json:{write:!0}})],qC.prototype,"offValue",void 0),u([d({type:[String,Number],json:{write:!0}})],qC.prototype,"onValue",void 0),u([d({type:["switch"],json:{read:!1,write:!0}})],qC.prototype,"type",void 0),qC=LK=u([$("esri.form.elements.inputs.SwitchInput")],qC);const Qnt=qC;var DK;let eU=DK=class extends uoe{constructor(t){super(t),this.type="text-area"}clone(){return new DK({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["text-area"],json:{read:!1,write:!0}})],eU.prototype,"type",void 0),eU=DK=u([$("esri.form.elements.inputs.TextAreaInput")],eU);const est=eU;var NK;let tU=NK=class extends uoe{constructor(t){super(t),this.type="text-box"}clone(){return new NK({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["text-box"],json:{read:!1,write:!0}})],tU.prototype,"type",void 0),tU=NK=u([$("esri.form.elements.inputs.TextBoxInput")],tU);const tst=tU,ist={base:MO,key:"type",typeMap:{"barcode-scanner":Ynt,"combo-box":Znt,"datetime-picker":Jnt,"radio-buttons":Knt,switch:Qnt,"text-area":est,"text-box":tst}};var FK;const u3e="esri.form.elements.FieldElement",Sfe=re.getLogger(u3e);let Dd=FK=class extends NM{constructor(t){super(t),this.domain=null,this.editableExpression=null,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field",this.valueExpression=null}get editable(){return fS(Sfe,"editable",{replacement:"editableExpression",version:"4.26",warnOnce:!0}),this._get("editable")??!0}set editable(t){fS(Sfe,"editable",{replacement:"editableExpression",version:"4.26",warnOnce:!0}),this._set("editable",t)}clone(){return new FK({description:this.description,domain:this.domain,editable:this.editable,editableExpression:this.editableExpression,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,valueExpression:this.valueExpression,visibilityExpression:this.visibilityExpression})}};u([d({types:oOe,json:{read:{reader:Gse},write:!0}})],Dd.prototype,"domain",void 0),u([d({type:Boolean,json:{write:!0}})],Dd.prototype,"editable",null),u([d({type:String,json:{write:!0}})],Dd.prototype,"editableExpression",void 0),u([d({type:String,json:{write:!0}})],Dd.prototype,"fieldName",void 0),u([d({type:String,json:{write:!0}})],Dd.prototype,"hint",void 0),u([d({types:ist,json:{read:{source:"inputType"},write:{target:"inputType"}}})],Dd.prototype,"input",void 0),u([d({type:String,json:{write:!0}})],Dd.prototype,"requiredExpression",void 0),u([d({type:String,json:{read:!1,write:!0}})],Dd.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Dd.prototype,"valueExpression",void 0),Dd=FK=u([$(u3e)],Dd);const Efe=Dd;var kK;let d0=kK=class extends NM{constructor(t){super(t),this.displayCount=null,this.displayType="list",this.editable=!0,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new kK({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editable:this.editable,label:this.label,orderByFields:se(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};u([d({type:Number,json:{write:!0}})],d0.prototype,"displayCount",void 0),u([d({type:["list"],json:{write:!0}})],d0.prototype,"displayType",void 0),u([d({type:Boolean,json:{write:!0}})],d0.prototype,"editable",void 0),u([d({type:[Tne],json:{write:!0}})],d0.prototype,"orderByFields",void 0),u([d({type:Number,json:{write:!0}})],d0.prototype,"relationshipId",void 0),u([d({type:["relationship"],json:{read:!1,write:!0}})],d0.prototype,"type",void 0),d0=kK=u([$("esri.form.elements.RelationshipElement")],d0);const Cfe=d0;function h3e(t){return{typesWithGroup:{base:NM,key:"type",typeMap:{attachment:wfe,field:Efe,group:t,relationship:Cfe}},typesWithoutGroup:{base:NM,key:"type",typeMap:{attachment:wfe,field:Efe,relationship:Cfe}}}}function d3e(t,e,i=!0){if(!t)return null;const r=i?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(n=>r[n.type]).map(n=>r[n.type].fromJSON(n))}function p3e(t,e,i=!0){if(!t)return null;const r=i?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(n=>r[n.type]).map(n=>n.toJSON())}function f3e(t,e,i=!0){return t?t.map(r=>pm(i?e.typesWithGroup:e.typesWithoutGroup,r)):null}var UK;let Ag=UK=class extends NM{constructor(t){super(t),this.elements=null,this.initialState="expanded",this.type="group"}castElements(t){return f3e(t,MG,!1)}readElements(t,e){return d3e(e.formElements,MG,!1)}writeElements(t,e){e.formElements=p3e(t,MG,!1)}clone(){return new UK({description:this.description,elements:se(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};u([d({json:{write:!0}})],Ag.prototype,"elements",void 0),u([ri("elements")],Ag.prototype,"castElements",null),u([Oe("elements",["formElements"])],Ag.prototype,"readElements",null),u([Ne("elements")],Ag.prototype,"writeElements",null),u([d({type:["collapsed","expanded"],json:{write:!0}})],Ag.prototype,"initialState",void 0),u([d({type:String,json:{read:!1,write:!0}})],Ag.prototype,"type",void 0),Ag=UK=u([$("esri.form.elements.GroupElement")],Ag);const MG=h3e(Ag),rst=Ag;var VK;const OG=h3e(rst);let _f=VK=class extends fe{constructor(t){super(t),this.description=null,this.elements=null,this.expressionInfos=null,this.preserveFieldValuesWhenHidden=!1,this.title=null}castElements(t){return f3e(t,OG)}readElements(t,e){return d3e(e.formElements,OG)}writeElements(t,e){e.formElements=p3e(t,OG)}clone(){return new VK({description:this.description,expressionInfos:se(this.expressionInfos),elements:se(this.elements),title:this.title,preserveFieldValuesWhenHidden:this.preserveFieldValuesWhenHidden})}};u([d({type:String,json:{write:!0}})],_f.prototype,"description",void 0),u([d({json:{write:!0}})],_f.prototype,"elements",void 0),u([ri("elements")],_f.prototype,"castElements",null),u([Oe("elements",["formElements"])],_f.prototype,"readElements",null),u([Ne("elements")],_f.prototype,"writeElements",null),u([d({type:[Wnt],json:{write:!0}})],_f.prototype,"expressionInfos",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],_f.prototype,"preserveFieldValuesWhenHidden",void 0),u([d({type:String,json:{write:!0}})],_f.prototype,"title",void 0),_f=VK=u([$("esri.form.FormTemplate")],_f);const nst=_f;async function sst(t){const e="portalItem"in t?t:{portalItem:t},i=await Q(()=>import("./portalLayers-5444e28e.js"),["assets/portalLayers-5444e28e.js","assets/lazyLayerLoader-47b7672a.js","assets/layersLoader-2d63a9c9.js","assets/fetchService-990f8c03.js","assets/jsonContext-7f6e363e.js"]);try{return await i.fromItem(e)}catch(r){const n=e&&e.portalItem,s=n&&n.id||"unset",o=n&&n.portal&&n.portal.url||nr.portalUrl;throw re.getLogger("esri.layers.support.fromPortalItem").error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+o+"', id: '"+s+"')",r),r}}let ost=0,ta=class extends An.EventedMixin(fO(Ju)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new ni(-180,-90,180,90,Je.WGS84),this.id=Date.now().toString(16)+"-layer-"+ost++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=Je.WGS84,this.title=null,this.type=null,this.url=null,this.visible=!0}static async fromArcGISServerUrl(e){const i=typeof e=="string"?{url:e}:e;return(await Q(()=>import("./arcgisLayers-75010661.js"),["assets/arcgisLayers-75010661.js","assets/fetchService-990f8c03.js","assets/lazyLayerLoader-47b7672a.js"])).fromUrl(i)}static fromPortalItem(e){return sst(e)}initialize(){this.when().catch(e=>{gs(e)||re.getLogger(this.declaredClass).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})})}destroy(){if(this.parent){const e=this,i=this.parent;"layers"in i&&i.layers.includes(e)?i.layers.remove(e):"tables"in i&&i.tables.includes(e)?i.tables.remove(e):"baseLayers"in i&&i.baseLayers.includes(e)?i.baseLayers.remove(e):"baseLayers"in i&&i.referenceLayers.includes(e)&&i.referenceLayers.remove(e)}}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){return Bo(this.url)}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await ir(e,{query:{f:"json"},responseType:"json"})).data;throw new H("layer:no-attribution-data","Layer does not have attribution data")}};u([d({type:String})],ta.prototype,"attributionDataUrl",void 0),u([d({type:ni})],ta.prototype,"fullExtent",void 0),u([d({readOnly:!0})],ta.prototype,"hasAttributionData",null),u([d({type:String,clonable:!1})],ta.prototype,"id",void 0),u([d({type:Boolean,nonNullable:!0})],ta.prototype,"legendEnabled",void 0),u([d({type:["show","hide","hide-children"]})],ta.prototype,"listMode",void 0),u([d({type:Number,range:{min:0,max:1},nonNullable:!0})],ta.prototype,"opacity",void 0),u([d({clonable:!1})],ta.prototype,"parent",void 0),u([d({readOnly:!0})],ta.prototype,"parsedUrl",null),u([d({type:Boolean})],ta.prototype,"popupEnabled",void 0),u([d({type:Boolean})],ta.prototype,"attributionVisible",void 0),u([d({type:Je})],ta.prototype,"spatialReference",void 0),u([d({type:String})],ta.prototype,"title",void 0),u([d({readOnly:!0,json:{read:!1}})],ta.prototype,"type",void 0),u([d()],ta.prototype,"url",void 0),u([d({type:Boolean,nonNullable:!0})],ta.prototype,"visible",void 0),ta=u([$("esri.layers.Layer")],ta);const cD=ta;function Afe(t,e,i){if(t.hasM==null||t.hasZ)for(const r of e)for(const n of r)n.length>2&&(n[2]*=i)}function ast(t,e,i){if(!t&&!e||!i)return;const r=r2(i);Rfe(t,i,r),Rfe(e,i,r)}function Rfe(t,e,i){if(t)for(const r of t)lst(r.geometry,e,i)}function lst(t,e,i){if(R(t)||!t.spatialReference||Dn(t.spatialReference,e))return;const r=r2(t.spatialReference)/i;if(r!==1){if("x"in t)t.z!=null&&(t.z*=r);else if("rings"in t)Afe(t,t.rings,r);else if("paths"in t)Afe(t,t.paths,r);else if("points"in t&&(t.hasM==null||t.hasZ))for(const n of t.points)n.length>2&&(n[2]*=r)}}let cst=0;const m3e="esri.layers.graphics.sources.MemorySource",PG=re.getLogger(m3e);let I0=class extends Ju.LoadableMixin(bO(Fw(tt))){constructor(e){super(e),this._idToClientGraphic=null,this.type="memory"}load(e){const i=v(e)?e.signal:null;return this.addResolvingPromise(this._startWorker(i)),Promise.resolve(this)}destroy(){var e;(e=this._connection)==null||e.close(),this._connection=null}get _workerGeometryType(){var i;const e=(i=this.layer)==null?void 0:i.geometryType;return e?this._geometryTypeRequiresClientGraphicMapping(e)?"polygon":e:null}applyEdits(e){return this.load().then(()=>this._applyEdits(e))}openPorts(){return this.load().then(()=>this._connection.openPorts())}async queryFeatures(e,i={}){await this.load(i);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,i);HJ(e,this.layer.spatialReference,r);const n=Xse.fromJSON(r);if(!this._requiresClientGraphicMapping())return n;const s=this.layer.objectIdField;for(const o of n.features){const a=o.attributes[s],l=this._idToClientGraphic.get(a);l&&(o.geometry=l.geometry)}return n.geometryType=this.layer.geometryType,n}async queryFeaturesJSON(e,i={}){if(this._requiresClientGraphicMapping())throw new H("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");await this.load(i);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,i);return HJ(e,this.layer.spatialReference,r),r}queryFeatureCount(e,i={}){return this.load(i).then(()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,i))}queryObjectIds(e,i={}){return this.load(i).then(()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,i))}queryExtent(e,i={}){return this.load(i).then(()=>this._connection.invoke("queryExtent",e?e.toJSON():null,i)).then(r=>({count:r.count,extent:ni.fromJSON(r.extent)}))}querySnapping(e,i={}){return this.load(i).then(()=>this._connection.invoke("querySnapping",e,i))}async _applyEdits(e){if(!this._connection)throw new H("feature-layer-source:edit-failure","Memory source not loaded");const i=this.layer.objectIdField;let r=null;const n=[],s=[];await Promise.all([this._prepareClientMapping(e.addFeatures,null),this._prepareClientMapping(e.updateFeatures,null)]);const o=h=>"objectId"in h&&h.objectId!=null?h.objectId:"attributes"in h&&h.attributes[i]!=null?h.attributes[i]:null;if(e.addFeatures&&(r=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(const h of e.deleteFeatures){const p=o(h);p!=null&&n.push(p)}const a=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures){for(const h of e.updateFeatures)if(s.push(this._serializeFeature(h)),a){const p=o(h);p!=null&&a.set(p,h)}}ast(r?r.features:null,s,this.layer.spatialReference);const{fullExtent:l,featureEditResults:c}=await this._connection.invoke("applyEdits",{adds:r?r.features:[],updates:s,deletes:n});return this.fullExtent=l,r&&r.finish(c.uidToObjectId),this._updateClientGraphicIds(a,c),this._createEditsResult(c)}async _prepareClientMapping(e,i){if(this._layerOrSourceGeometryType!=="mesh"||R(e))return;const r=[];for(const{geometry:n}of e)!v(n)||n.type!=="mesh"||n.hasExtent||n.loaded||r.push(n.load({signal:i}));r.length&&await Promise.all(r)}_updateClientGraphicIds(e,i){if(this._idToClientGraphic){if(e)for(const r of i.updateResults){if(!r.success)continue;const n=e.get(r.objectId);n!=null&&this._addIdToClientGraphic(n)}for(const r of i.deleteResults)r.success&&this._idToClientGraphic.delete(r.objectId)}}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const i=e.success===!0?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:i?new H("feature-layer-source:edit-failure",i.description,{code:i.code}):null}}_prepareAddFeatures(e){const i=new Map,r=new Array(e.length);let n=null;for(let o=0;o<e.length;o++){const a=e[o],l=this._serializeFeature(a);!n&&v(a.geometry)&&(n=a.geometry.type),r[o]=l,i.set(`${l.uid}`,a)}const s=this;return{features:r,inferredGeometryType:n,finish(o){const a=s.sourceJSON.objectIdField;for(const l in o){const c=o[l],h=i.get(l);h&&(h.attributes||(h.attributes={}),c===-1?delete h.attributes[a]:h.attributes[a]=c,s._addIdToClientGraphic(h))}}}}_addIdToClientGraphic(e){if(!this._idToClientGraphic)return;const i=this.sourceJSON.objectIdField,r=e.attributes&&e.attributes[i];r!=null&&this._idToClientGraphic.set(r,e)}get _layerOrSourceGeometryType(){var e,i;return((e=this.layer)==null?void 0:e.geometryType)??((i=this.sourceJSON)==null?void 0:i.geometryType)}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this._layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}_geometryTypeRequiresClientGraphicMapping(e){return e==="mesh"||e==="multipatch"||e==="extent"}_serializeFeature(e){const{attributes:i}=e,r=this._geometryForSerialization(e),n=(cst++).toString();return r?{uid:n,geometry:r.toJSON(),attributes:i}:{uid:n,attributes:i}}_geometryForSerialization(e){const{geometry:i}=e;return R(i)?null:this._geometryRequiresClientGraphicMapping(i)?i.extent?ec.fromExtent(i.extent):null:i}async _startWorker(e){this._connection=await OAe("MemorySourceWorker",{strategy:ue("feature-layers-workers")?"dedicated":"local",signal:e});const{fields:i,spatialReference:r,objectIdField:n,hasM:s,hasZ:o,timeInfo:a}=this.layer,l=this.layer.originOf("spatialReference")==="defaults";await this._prepareClientMapping(this.items,e);const c=this._prepareAddFeatures(this.items);this.handles.add(this.on("before-changes",m=>{PG.error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),m.preventDefault()}));const h={features:c.features,fields:i&&i.map(m=>m.toJSON()),geometryType:Yhe.toJSON(this._workerGeometryType),hasM:this._layerOrSourceGeometryType!=="mesh"&&s,hasZ:this._layerOrSourceGeometryType==="mesh"||o,objectIdField:n,spatialReference:l?null:r&&r.toJSON(),timeInfo:a?a.toJSON():null},p=await this._connection.invoke("load",h,{signal:e});for(const m of p.warnings)PG.warn(m.message,{layer:this.layer,warning:m});p.featureErrors.length&&PG.warn(`Encountered ${p.featureErrors.length} validation errors while loading features`,p.featureErrors);const f=p.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(c.inferredGeometryType)&&(f.geometryType=Yhe.toJSON(c.inferredGeometryType)),this.sourceJSON=f,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),c.finish(p.assignedObjectIds)}};u([mne({Type:Ha,ensureType:Ts(Ha)})],I0.prototype,"itemType",void 0),u([d()],I0.prototype,"type",void 0),u([d({constructOnly:!0})],I0.prototype,"layer",void 0),u([d({readOnly:!0})],I0.prototype,"_workerGeometryType",null),u([d()],I0.prototype,"sourceJSON",void 0),I0=u([$(m3e)],I0);function ust(t){return"portalItem"in t}const hst=t=>{let e=class extends t{get apiKey(){var i;return this._isOverridden("apiKey")?this._get("apiKey"):ust(this)?(i=this.portalItem)==null?void 0:i.apiKey:null}set apiKey(i){i!=null?this._override("apiKey",i):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return u([d({type:String})],e.prototype,"apiKey",null),e=u([$("esri.layers.mixins.APIKeyMixin")],e),e},g3e={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},y3e=Object.values(g3e),_3e=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${y3e.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),dst=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${y3e.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),pst=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function IBt(t){return!!_3e.test(t)}function dw(t){if(R(t))return null;const e=Bo(t),i=e.path.match(_3e)||e.path.match(dst);if(!i)return null;const[,r,n,s,o]=i,a=n.indexOf("/");return{title:hoe(a!==-1?n.slice(a+1):n),serverType:g3e[s.toLowerCase()],sublayer:o!=null&&o!==""?parseInt(o,10):null,url:{path:r}}}function fst(t){const e=Bo(t).path.match(pst);return e?{serviceUrl:e[1],sublayerId:Number(e[2])}:null}function hoe(t){return(t=t.replace(/\s*[/_]+\s*/g," "))[0].toUpperCase()+t.slice(1)}function mst(t,e){const i=[];if(t){const r=dw(t);v(r)&&r.title&&i.push(r.title)}if(e){const r=hoe(e);i.push(r)}if(i.length===2){if(i[0].toLowerCase().includes(i[1].toLowerCase()))return i[0];if(i[1].toLowerCase().includes(i[0].toLowerCase()))return i[1]}return i.join(" - ")}function v3e(t){if(!t)return!1;const e=".arcgis.com/",i="//services",r="//tiles",n="//features",s=(t=t.toLowerCase()).includes(e),o=t.includes(i)||t.includes(r)||t.includes(n);return s&&o}function gst(t,e){return t&&VCe(BCe(t,e))}function yst(t){let{url:e}=t;if(!e)return{url:e};e=BCe(e,t.logger);const i=Bo(e),r=dw(i.path);let n;if(v(r))r.sublayer!=null&&t.layer.layerId==null&&(n=r.sublayer),e=r.url.path;else if(t.nonStandardUrlAllowed){const s=fst(i.path);v(s)&&(e=s.serviceUrl,n=s.sublayerId)}return{url:VCe(e),layerId:n}}function _st(t,e,i,r,n){iw(e,r,"url",n),r.url&&t.layerId!=null&&(r.url=ew(r.url,i,t.layerId.toString()))}function $Bt(t){if(!t)return!1;const e=t.toLowerCase(),i=e.includes("/services/"),r=e.includes("/mapserver/wmsserver"),n=e.includes("/imageserver/wmsserver"),s=e.includes("/wmsserver");return i&&(r||n||s)}function vst(t){var i;if(!t)return!1;const e=(i=new Ub(zc(t)).authority)==null?void 0:i.toLowerCase();return e==="server.arcgisonline.com"||e==="services.arcgisonline.com"}const bst=t=>{let e=class extends t{get title(){if(this._get("title")&&this.originOf("title")!=="defaults")return this._get("title");if(this.url){const i=dw(this.url);if(v(i)&&i.title)return i.title}return this._get("title")||""}set title(i){this._set("title",i)}set url(i){this._set("url",gst(i,re.getLogger(this.declaredClass)))}};return u([d()],e.prototype,"title",null),u([d({type:String})],e.prototype,"url",null),e=u([$("esri.layers.mixins.ArcGISService")],e),e},Mfe={read:{reader:zse},write:{allowNull:!0,writer:Bse}},b3e=t=>{let e=class extends t{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return u([d({type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}})],e.prototype,"blendMode",void 0),u([d({json:{read:!1,write:!1,origins:{"web-map":Mfe,"portal-item":Mfe}}})],e.prototype,"effect",void 0),e=u([$("esri.layers.mixins.BlendLayer")],e),e},wst=t=>{let e=class extends t{constructor(){super(...arguments),this.customParameters=null}};return u([d({type:Object,json:{write:{overridePolicy:i=>({enabled:!!(i&&Object.keys(i).length>0)})}}})],e.prototype,"customParameters",void 0),e=u([$("esri.layers.mixins.CustomParametersMixin")],e),e},doe=new An.EventEmitter,w3e="esri.layers.mixins.EditBusLayer",x3e=Symbol(w3e);function LBt(t){return t!=null&&typeof t=="object"&&x3e in t}const xst=t=>{var e;let i=class extends t{constructor(...r){super(...r),this[e]=!0,this.when().then(()=>{this.own([doe.on("edits",n=>{var h,p,f;const s="layer"in n?n.layer:null,o="layer"in n?(h=n.layer)==null?void 0:h.url:n.serviceUrl,a="layer"in n?(p=n.layer)==null?void 0:p.layerId:n.layerId,l=n.event;if(s===this||o!==this.url)return;if(a!=null&&this.layerId!=null&&a===this.layerId)return void this.emit("edits",se(l));const c=(f=l.editedFeatures)==null?void 0:f.find(({layerId:m})=>m===this.layerId);if(c){const{adds:m,updates:g,deletes:_}=c.editedFeatures,b={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:m?m.map(({attributes:w})=>({objectId:this.objectIdField&&w[this.objectIdField],globalId:this.globalIdField&&w[this.globalIdField]})):[],deletedFeatures:_?_.map(({attributes:w})=>({objectId:this.objectIdField&&w[this.objectIdField],globalId:this.globalIdField&&w[this.globalIdField]})):[],updatedFeatures:g?g.map(({current:{attributes:w}})=>({objectId:this.objectIdField&&w[this.objectIdField],globalId:this.globalIdField&&w[this.globalIdField]})):[],editedFeatures:se(l.editedFeatures),exceededTransferLimit:!1};this.emit("edits",b)}})])},()=>{})}};return e=x3e,i=u([$(w3e)],i),i};var zK;const IG=new mi({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),$G=new mi({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let cg=zK=class extends fe{constructor(t){super(t),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(t={}){const{where:e,geometry:i,spatialRelationship:r,timeExtent:n,objectIds:s,units:o,distance:a}=this;return new xp({geometry:se(i),objectIds:se(s),spatialRelationship:r,timeExtent:se(n),where:e,units:o,distance:a,...t})}clone(){const{where:t,geometry:e,spatialRelationship:i,timeExtent:r,objectIds:n,units:s,distance:o}=this;return new zK({geometry:se(e),objectIds:se(n),spatialRelationship:i,timeExtent:se(r),where:t,units:s,distance:o})}};u([d({type:String,json:{write:!0}})],cg.prototype,"where",void 0),u([d({types:Iw,json:{write:!0}})],cg.prototype,"geometry",void 0),u([d({type:IG.apiValues,json:{name:"spatialRel",read:{reader:IG.read},write:{allowNull:!1,writer:IG.write,overridePolicy(){return{enabled:v(this.geometry)}}}}})],cg.prototype,"spatialRelationship",void 0),u([d({type:Number,json:{write:{overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],cg.prototype,"distance",void 0),u([d({type:[Number],json:{write:!0}})],cg.prototype,"objectIds",void 0),u([d({type:$G.apiValues,json:{read:$G.read,write:{writer:$G.write,overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],cg.prototype,"units",void 0),u([d({type:Zc,json:{write:!0}})],cg.prototype,"timeExtent",void 0),cg=zK=u([$("esri.layers.support.FeatureFilter")],cg);const Tst=cg;var BK;const Ofe={read:{reader:zse},write:{writer:Bse,overridePolicy(){return{allowNull:this.excludedEffect!=null,isRequired:this.excludedEffect==null}}}},Pfe={read:{reader:zse},write:{writer:Bse,overridePolicy(){return{allowNull:this.includedEffect!=null,isRequired:this.includedEffect==null}}}},Ife={name:"showExcludedLabels",default:!0};let fT=BK=class extends fe{constructor(t){super(t),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(t,e){var r,n;const i=super.write(t,e);if(e!=null&&e.origin){if(i.filter){const s=Object.keys(i.filter);if(s.length>1||s[0]!=="where")return(r=e.messages)==null||r.push(new H("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:e.layer,effect:this})),null}if("showExcludedLabels"in i)return(n=e.messages)==null||n.push(new H("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:e.layer,effect:this})),null}return i}clone(){return new BK({filter:v(this.filter)?this.filter.clone():null,includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};u([d({type:Tst,json:{write:{allowNull:!0,writer(t,e,i,r){const n=t==null?void 0:t.write({},r);n&&Object.keys(n).length!==0?va(i,n,e):va(i,null,e)}}}})],fT.prototype,"filter",void 0),u([d({json:{write:!0,origins:{"web-map":Ofe,"portal-item":Ofe}}})],fT.prototype,"includedEffect",void 0),u([d({json:{write:!0,origins:{"web-map":Pfe,"portal-item":Pfe}}})],fT.prototype,"excludedEffect",void 0),u([d({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":Ife,"portal-item":Ife}}})],fT.prototype,"excludedLabelsVisible",void 0),fT=BK=u([$("esri.layers.support.FeatureEffect")],fT);const Sst=fT,$fe={write:{allowNull:!0}},Est=t=>{let e=class extends t{constructor(){super(...arguments),this.featureEffect=null}};return u([d({type:Sst,json:{origins:{"web-map":$fe,"portal-item":$fe}}})],e.prototype,"featureEffect",void 0),e=u([$("esri.layers.mixins.FeatureEffectLayer")],e),e};var nI;const NV=Wa()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),T3e=NV.jsonValues.slice();NL(T3e,"orthometric");const k$=Wa()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let vf=nI=class extends fe{constructor(t){super(t),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(t,e,i){return NV.write(t,e,i)}readHeightModel(t,e,i){return NV.read(t)||(i&&i.messages&&i.messages.push(Cst(t,{context:i})),null)}readHeightUnit(t,e,i){return k$.read(t)||(i&&i.messages&&i.messages.push(Lfe(t,{context:i})),null)}readHeightUnitService(t,e,i){return q2e(t)||k$.read(t)||(i&&i.messages&&i.messages.push(Lfe(t,{context:i})),null)}readVertCRS(t,e){return e.vertCRS||e.ellipsoid||e.geoid}clone(){return new nI({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(t){return!!t&&(this===t||this.heightModel===t.heightModel&&this.heightUnit===t.heightUnit&&this.vertCRS===t.vertCRS)}static deriveUnitFromSR(t,e){const i=hGe(e);return new nI({heightModel:t.heightModel,heightUnit:i,vertCRS:t.vertCRS})}write(t,e){return e={origin:"web-scene",...e},super.write(t,e)}static fromJSON(t){if(!t)return null;const e=new nI;return e.read(t,{origin:"web-scene"}),e}};function Lfe(t,e){return new Op("height-unit:unsupported",`Height unit of value '${t}' is not supported`,e)}function Cst(t,e){return new Op("height-model:unsupported",`Height model of value '${t}' is not supported`,e)}u([d({type:NV.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:T3e,default:"ellipsoidal"}}}})],vf.prototype,"heightModel",void 0),u([Ne("web-scene","heightModel")],vf.prototype,"writeHeightModel",null),u([Oe(["web-scene","service"],"heightModel")],vf.prototype,"readHeightModel",null),u([d({type:k$.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:k$.jsonValues,write:k$.write}}}})],vf.prototype,"heightUnit",void 0),u([Oe("web-scene","heightUnit")],vf.prototype,"readHeightUnit",null),u([Oe("service","heightUnit")],vf.prototype,"readHeightUnitService",null),u([d({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],vf.prototype,"vertCRS",void 0),u([Oe("service","vertCRS",["vertCRS","ellipsoid","geoid"])],vf.prototype,"readVertCRS",null),vf=nI=u([$("esri.geometry.HeightModelInfo")],vf);const OO=vf;function Ast(t){if(!t)return t;const{start:e,end:i}=t;return new Zc({start:v(e)?NS(e,-e.getTimezoneOffset(),"minutes"):e,end:v(i)?NS(i,-i.getTimezoneOffset(),"minutes"):i})}function Rst(t){if(!t)return t;const{start:e,end:i}=t;return new Zc({start:v(e)?NS(e,e.getTimezoneOffset(),"minutes"):e,end:v(i)?NS(i,i.getTimezoneOffset(),"minutes"):i})}var jK;let sI=jK=class extends fe{constructor(t){super(t)}async collectRequiredFields(t,e){return Xc(t,e,this.expression)}clone(){return new jK({expression:this.expression,title:this.title})}equals(t){return this.expression===t.expression&&this.title===t.title}};u([d({type:String,json:{write:!0}})],sI.prototype,"expression",void 0),u([d({type:String,json:{write:!0}})],sI.prototype,"title",void 0),sI=jK=u([$("esri.layers.support.FeatureExpressionInfo")],sI);const Dfe=sI;function Mst(t){return!!t&&LM[t]!=null}function Ost(t){return 1/(LM[t]||1)}function Pst(){const t=Object.keys(LM);return t.sort(),t}const Ist=Pst();var GK;const c4=Wa()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),Nfe=new mi({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let p0=GK=class extends fe{constructor(t){super(t),this.offset=null}readFeatureExpressionInfo(t,e){return t??(e.featureExpression&&e.featureExpression.value===0?{expression:"0"}:void 0)}writeFeatureExpressionInfo(t,e,i,r){e[i]=t.write({},r),t.expression==="0"&&(e.featureExpression={value:0})}get mode(){const{offset:t,featureExpressionInfo:e}=this;return this._isOverridden("mode")?this._get("mode"):v(t)||e?"relative-to-ground":"on-the-ground"}set mode(t){this._override("mode",t)}set unit(t){this._set("unit",t)}write(t,e){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(t,e):null}clone(){return new GK({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(t){return this.mode===t.mode&&this.offset===t.offset&&this.unit===t.unit&&KBe(this.featureExpressionInfo,t.featureExpressionInfo)}};u([d({type:Dfe,json:{write:!0}})],p0.prototype,"featureExpressionInfo",void 0),u([Oe("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],p0.prototype,"readFeatureExpressionInfo",null),u([Ne("featureExpressionInfo",{featureExpressionInfo:{type:Dfe},"featureExpression.value":{type:[0]}})],p0.prototype,"writeFeatureExpressionInfo",null),u([d({type:c4.apiValues,nonNullable:!0,json:{type:c4.jsonValues,read:c4.read,write:{writer:c4.write,isRequired:!0}}})],p0.prototype,"mode",null),u([d({type:Number,json:{write:!0}})],p0.prototype,"offset",void 0),u([d({type:Ist,json:{type:String,read:Nfe.read,write:Nfe.write}})],p0.prototype,"unit",null),p0=GK=u([$("esri.layers.support.ElevationInfo")],p0);const $st=p0,Lst={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:!0}},poe={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(t,e)=>!e.disablePopup},write:{enabled:!0,writer(t,e,i){e[i]=!t}}}},foe={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:!0}},Dst={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:iw}}},Nst={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:!0}},Fst={value:null,type:$st,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:!0}};function DBt(t){return{type:t,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const S3e={write:!0,read:!0},HK={type:Number,json:{origins:{"web-document":S3e,"portal-item":{write:!0}}}},kst={...HK,json:{...HK.json,origins:{"web-document":{...S3e,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(t,e,i)=>i&&i.origin!=="service"||!e.drawingInfo||e.drawingInfo.transparency===void 0?e.layerDefinition&&e.layerDefinition.drawingInfo&&e.layerDefinition.drawingInfo.transparency!==void 0?YL(e.layerDefinition.drawingInfo.transparency):void 0:YL(e.drawingInfo.transparency)}}},NBt={type:Zc,readOnly:!0,get(){var a,l;if(!((a=this.layer)!=null&&a.timeInfo))return null;const{datesInUnknownTimezone:t,timeOffset:e,useViewTime:i}=this.layer,r=(l=this.view)==null?void 0:l.timeExtent;let n=this.layer.timeExtent;t&&(n=Rst(n));let s=i?r&&n?r.intersection(n):r||n:n;if(!s||s.isEmpty||s.isAllTime)return s;e&&(s=s.offset(-e.value,e.unit)),t&&(s=Ast(s));const o=this._get("timeExtent");return s.equals(o)?o:s}},FBt={type:ni,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(t,e)=>{const i=ni.fromJSON(t);return e.spatialReference!=null&&typeof e.spatialReference=="object"&&(i.spatialReference=Je.fromJSON(e.spatialReference)),i}}}},read:!1}},Ust={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},Vst={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}},zst={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}},E3e={json:{write:{ignoreOrigin:!0},origins:{"web-map":{read:!1,write:!1}}}},Ffe=new Map([["AUS Central Standard Time","Australia/Darwin"],["AUS Eastern Standard Time","Australia/Sydney"],["Afghanistan Standard Time","Asia/Kabul"],["Alaskan Standard Time","America/Anchorage"],["Aleutian Standard Time","America/Adak"],["Altai Standard Time","Asia/Barnaul"],["Arab Standard Time","Asia/Riyadh"],["Arabian Standard Time","Asia/Dubai"],["Arabic Standard Time","Asia/Baghdad"],["Argentina Standard Time","America/Buenos_Aires"],["Astrakhan Standard Time","Europe/Astrakhan"],["Atlantic Standard Time","America/Halifax"],["Aus Central W. Standard Time","Australia/Eucla"],["Azerbaijan Standard Time","Asia/Baku"],["Azores Standard Time","Atlantic/Azores"],["Bahia Standard Time","America/Bahia"],["Bangladesh Standard Time","Asia/Dhaka"],["Belarus Standard Time","Europe/Minsk"],["Bougainville Standard Time","Pacific/Bougainville"],["Canada Central Standard Time","America/Regina"],["Cape Verde Standard Time","Atlantic/Cape_Verde"],["Caucasus Standard Time","Asia/Yerevan"],["Cen. Australia Standard Time","Australia/Adelaide"],["Central America Standard Time","America/Guatemala"],["Central Asia Standard Time","Asia/Almaty"],["Central Brazilian Standard Time","America/Cuiaba"],["Central Europe Standard Time","Europe/Budapest"],["Central European Standard Time","Europe/Warsaw"],["Central Pacific Standard Time","Pacific/Guadalcanal"],["Central Standard Time","America/Chicago"],["Central Standard Time (Mexico)","America/Mexico_City"],["Chatham Islands Standard Time","Pacific/Chatham"],["China Standard Time","Asia/Shanghai"],["Cuba Standard Time","America/Havana"],["Dateline Standard Time","Etc/GMT+12"],["E. Africa Standard Time","Africa/Nairobi"],["E. Australia Standard Time","Australia/Brisbane"],["E. Europe Standard Time","Europe/Chisinau"],["E. South America Standard Time","America/Sao_Paulo"],["Easter Island Standard Time","Pacific/Easter"],["Eastern Standard Time","America/New_York"],["Eastern Standard Time (Mexico)","America/Cancun"],["Egypt Standard Time","Africa/Cairo"],["Ekaterinburg Standard Time","Asia/Yekaterinburg"],["FLE Standard Time","Europe/Kiev"],["Fiji Standard Time","Pacific/Fiji"],["GMT Standard Time","Europe/London"],["GTB Standard Time","Europe/Bucharest"],["Georgian Standard Time","Asia/Tbilisi"],["Greenland Standard Time","America/Godthab"],["Greenwich Standard Time","Atlantic/Reykjavik"],["Haiti Standard Time","America/Port-au-Prince"],["Hawaiian Standard Time","Pacific/Honolulu"],["India Standard Time","Asia/Calcutta"],["Iran Standard Time","Asia/Tehran"],["Israel Standard Time","Asia/Jerusalem"],["Jordan Standard Time","Asia/Amman"],["Kaliningrad Standard Time","Europe/Kaliningrad"],["Korea Standard Time","Asia/Seoul"],["Libya Standard Time","Africa/Tripoli"],["Line Islands Standard Time","Pacific/Kiritimati"],["Lord Howe Standard Time","Australia/Lord_Howe"],["Magadan Standard Time","Asia/Magadan"],["Magallanes Standard Time","America/Punta_Arenas"],["Marquesas Standard Time","Pacific/Marquesas"],["Mauritius Standard Time","Indian/Mauritius"],["Middle East Standard Time","Asia/Beirut"],["Montevideo Standard Time","America/Montevideo"],["Morocco Standard Time","Africa/Casablanca"],["Mountain Standard Time","America/Denver"],["Mountain Standard Time (Mexico)","America/Chihuahua"],["Myanmar Standard Time","Asia/Rangoon"],["N. Central Asia Standard Time","Asia/Novosibirsk"],["Namibia Standard Time","Africa/Windhoek"],["Nepal Standard Time","Asia/Katmandu"],["New Zealand Standard Time","Pacific/Auckland"],["Newfoundland Standard Time","America/St_Johns"],["Norfolk Standard Time","Pacific/Norfolk"],["North Asia East Standard Time","Asia/Irkutsk"],["North Asia Standard Time","Asia/Krasnoyarsk"],["North Korea Standard Time","Asia/Pyongyang"],["Omsk Standard Time","Asia/Omsk"],["Pacific SA Standard Time","America/Santiago"],["Pacific Standard Time","America/Los_Angeles"],["Pacific Standard Time (Mexico)","America/Tijuana"],["Pakistan Standard Time","Asia/Karachi"],["Paraguay Standard Time","America/Asuncion"],["Qyzylorda Standard Time","Asia/Qyzylorda"],["Romance Standard Time","Europe/Paris"],["Russia Time Zone 10","Asia/Srednekolymsk"],["Russia Time Zone 11","Asia/Kamchatka"],["Russia Time Zone 3","Europe/Samara"],["Russian Standard Time","Europe/Moscow"],["SA Eastern Standard Time","America/Cayenne"],["SA Pacific Standard Time","America/Bogota"],["SA Western Standard Time","America/La_Paz"],["SE Asia Standard Time","Asia/Bangkok"],["Saint Pierre Standard Time","America/Miquelon"],["Sakhalin Standard Time","Asia/Sakhalin"],["Samoa Standard Time","Pacific/Apia"],["Sao Tome Standard Time","Africa/Sao_Tome"],["Saratov Standard Time","Europe/Saratov"],["Singapore Standard Time","Asia/Singapore"],["South Africa Standard Time","Africa/Johannesburg"],["South Sudan Standard Time","Africa/Juba"],["Sri Lanka Standard Time","Asia/Colombo"],["Sudan Standard Time","Africa/Khartoum"],["Syria Standard Time","Asia/Damascus"],["Taipei Standard Time","Asia/Taipei"],["Tasmania Standard Time","Australia/Hobart"],["Tocantins Standard Time","America/Araguaina"],["Tokyo Standard Time","Asia/Tokyo"],["Tomsk Standard Time","Asia/Tomsk"],["Tonga Standard Time","Pacific/Tongatapu"],["Transbaikal Standard Time","Asia/Chita"],["Turkey Standard Time","Europe/Istanbul"],["Turks And Caicos Standard Time","America/Grand_Turk"],["US Eastern Standard Time","America/Indianapolis"],["US Mountain Standard Time","America/Phoenix"],["UTC","Etc/GMT"],["UTC+01","Etc/GMT-1"],["UTC+02","Etc/GMT-2"],["UTC+03","Etc/GMT-3"],["UTC+04","Etc/GMT-4"],["UTC+05","Etc/GMT-5"],["UTC+06","Etc/GMT-6"],["UTC+07","Etc/GMT-7"],["UTC+08","Etc/GMT-8"],["UTC+09","Etc/GMT-9"],["UTC+10","Etc/GMT-10"],["UTC+11","Etc/GMT-11"],["UTC+12","Etc/GMT-12"],["UTC+13","Etc/GMT-13"],["UTC+14","Etc/GMT-14"],["UTC-01","Etc/GMT+1"],["UTC-02","Etc/GMT+2"],["UTC-03","Etc/GMT+3"],["UTC-04","Etc/GMT+4"],["UTC-05","Etc/GMT+5"],["UTC-06","Etc/GMT+6"],["UTC-07","Etc/GMT+7"],["UTC-08","Etc/GMT+8"],["UTC-09","Etc/GMT+9"],["UTC-10","Etc/GMT+10"],["UTC-11","Etc/GMT+11"],["UTC-12","Etc/GMT+12"],["Ulaanbaatar Standard Time","Asia/Ulaanbaatar"],["Venezuela Standard Time","America/Caracas"],["Vladivostok Standard Time","Asia/Vladivostok"],["Volgograd Standard Time","Europe/Volgograd"],["W. Australia Standard Time","Australia/Perth"],["W. Central Africa Standard Time","Africa/Lagos"],["W. Europe Standard Time","Europe/Berlin"],["W. Mongolia Standard Time","Asia/Hovd"],["West Asia Standard Time","Asia/Tashkent"],["West Bank Standard Time","Asia/Hebron"],["West Pacific Standard Time","Pacific/Port_Moresby"],["Yakutsk Standard Time","Asia/Yakutsk"],["Yukon Standard Time","America/Whitehorse"]]);class X2 extends Error{}class Bst extends X2{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class jst extends X2{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class Gst extends X2{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class oI extends X2{}class C3e extends X2{constructor(e){super(`Invalid unit ${e}`)}}class np extends X2{}class _v extends X2{constructor(){super("Zone is an abstract class")}}const st="numeric",wm="short",id="long",FV={year:st,month:st,day:st},A3e={year:st,month:wm,day:st},Hst={year:st,month:wm,day:st,weekday:wm},R3e={year:st,month:id,day:st},M3e={year:st,month:id,day:st,weekday:id},O3e={hour:st,minute:st},P3e={hour:st,minute:st,second:st},I3e={hour:st,minute:st,second:st,timeZoneName:wm},$3e={hour:st,minute:st,second:st,timeZoneName:id},L3e={hour:st,minute:st,hourCycle:"h23"},D3e={hour:st,minute:st,second:st,hourCycle:"h23"},N3e={hour:st,minute:st,second:st,hourCycle:"h23",timeZoneName:wm},F3e={hour:st,minute:st,second:st,hourCycle:"h23",timeZoneName:id},k3e={year:st,month:st,day:st,hour:st,minute:st},U3e={year:st,month:st,day:st,hour:st,minute:st,second:st},V3e={year:st,month:wm,day:st,hour:st,minute:st},z3e={year:st,month:wm,day:st,hour:st,minute:st,second:st},qst={year:st,month:wm,day:st,weekday:wm,hour:st,minute:st},B3e={year:st,month:id,day:st,hour:st,minute:st,timeZoneName:wm},j3e={year:st,month:id,day:st,hour:st,minute:st,second:st,timeZoneName:wm},G3e={year:st,month:id,day:st,weekday:id,hour:st,minute:st,timeZoneName:id},H3e={year:st,month:id,day:st,weekday:id,hour:st,minute:st,second:st,timeZoneName:id};class kN{get type(){throw new _v}get name(){throw new _v}get ianaName(){return this.name}get isUniversal(){throw new _v}offsetName(e,i){throw new _v}formatOffset(e,i){throw new _v}offset(e){throw new _v}equals(e){throw new _v}get isValid(){throw new _v}}let LG=null;class AB extends kN{static get instance(){return LG===null&&(LG=new AB),LG}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:i,locale:r}){return W3e(e,i,r)}formatOffset(e,i){return V$(this.offset(e),i)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}}let iU={};function Wst(t){return iU[t]||(iU[t]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),iU[t]}const Xst={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function Yst(t,e){const i=t.format(e).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(i),[,n,s,o,a,l,c,h]=r;return[o,n,s,a,l,c,h]}function Zst(t,e){const i=t.formatToParts(e),r=[];for(let n=0;n<i.length;n++){const{type:s,value:o}=i[n],a=Xst[s];s==="era"?r[a]=o:Er(a)||(r[a]=parseInt(o,10))}return r}let u4={};class M_ extends kN{static create(e){return u4[e]||(u4[e]=new M_(e)),u4[e]}static resetCache(){u4={},iU={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch{return!1}}constructor(e){super(),this.zoneName=e,this.valid=M_.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:i,locale:r}){return W3e(e,i,r,this.name)}formatOffset(e,i){return V$(this.offset(e),i)}offset(e){const i=new Date(e);if(isNaN(i))return NaN;const r=Wst(this.name);let[n,s,o,a,l,c,h]=r.formatToParts?Zst(r,i):Yst(r,i);a==="BC"&&(n=-Math.abs(n)+1);const f=yoe({year:n,month:s,day:o,hour:l===24?0:l,minute:c,second:h,millisecond:0});let m=+i;const g=m%1e3;return m-=g>=0?g:1e3+g,(f-m)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}}let kfe={};function Jst(t,e={}){const i=JSON.stringify([t,e]);let r=kfe[i];return r||(r=new Intl.ListFormat(t,e),kfe[i]=r),r}let qK={};function WK(t,e={}){const i=JSON.stringify([t,e]);let r=qK[i];return r||(r=new Intl.DateTimeFormat(t,e),qK[i]=r),r}let XK={};function Kst(t,e={}){const i=JSON.stringify([t,e]);let r=XK[i];return r||(r=new Intl.NumberFormat(t,e),XK[i]=r),r}let YK={};function Qst(t,e={}){const{base:i,...r}=e,n=JSON.stringify([t,r]);let s=YK[n];return s||(s=new Intl.RelativeTimeFormat(t,e),YK[n]=s),s}let aI=null;function eot(){return aI||(aI=new Intl.DateTimeFormat().resolvedOptions().locale,aI)}function tot(t){const e=t.indexOf("-x-");e!==-1&&(t=t.substring(0,e));const i=t.indexOf("-u-");if(i===-1)return[t];{let r,n;try{r=WK(t).resolvedOptions(),n=t}catch{const l=t.substring(0,i);r=WK(l).resolvedOptions(),n=l}const{numberingSystem:s,calendar:o}=r;return[n,s,o]}}function iot(t,e,i){return(i||e)&&(t.includes("-u-")||(t+="-u"),i&&(t+=`-ca-${i}`),e&&(t+=`-nu-${e}`)),t}function rot(t){const e=[];for(let i=1;i<=12;i++){const r=Li.utc(2016,i,1);e.push(t(r))}return e}function not(t){const e=[];for(let i=1;i<=7;i++){const r=Li.utc(2016,11,13+i);e.push(t(r))}return e}function h4(t,e,i,r,n){const s=t.listingMode(i);return s==="error"?null:s==="en"?r(e):n(e)}function sot(t){return t.numberingSystem&&t.numberingSystem!=="latn"?!1:t.numberingSystem==="latn"||!t.locale||t.locale.startsWith("en")||new Intl.DateTimeFormat(t.intl).resolvedOptions().numberingSystem==="latn"}class oot{constructor(e,i,r){this.padTo=r.padTo||0,this.floor=r.floor||!1;const{padTo:n,floor:s,...o}=r;if(!i||Object.keys(o).length>0){const a={useGrouping:!1,...r};r.padTo>0&&(a.minimumIntegerDigits=r.padTo),this.inf=Kst(e,a)}}format(e){if(this.inf){const i=this.floor?Math.floor(e):e;return this.inf.format(i)}else{const i=this.floor?Math.floor(e):goe(e,3);return Lo(i,this.padTo)}}}class aot{constructor(e,i,r){this.opts=r;let n;if(e.zone.isUniversal){const o=-1*(e.offset/60),a=o>=0?`Etc/GMT+${o}`:`Etc/GMT${o}`;e.offset!==0&&M_.create(a).valid?(n=a,this.dt=e):(n="UTC",r.timeZoneName?this.dt=e:this.dt=e.offset===0?e:Li.fromMillis(e.ts+e.offset*60*1e3))}else e.zone.type==="system"?this.dt=e:(this.dt=e,n=e.zone.name);const s={...this.opts};s.timeZone=s.timeZone||n,this.dtf=WK(i,s)}format(){return this.dtf.format(this.dt.toJSDate())}formatToParts(){return this.dtf.formatToParts(this.dt.toJSDate())}resolvedOptions(){return this.dtf.resolvedOptions()}}class lot{constructor(e,i,r){this.opts={style:"long",...r},!i&&q3e()&&(this.rtf=Qst(e,r))}format(e,i){return this.rtf?this.rtf.format(e,i):Eot(i,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,i){return this.rtf?this.rtf.formatToParts(e,i):[]}}class cs{static fromOpts(e){return cs.create(e.locale,e.numberingSystem,e.outputCalendar,e.defaultToEN)}static create(e,i,r,n=!1){const s=e||Io.defaultLocale,o=s||(n?"en-US":eot()),a=i||Io.defaultNumberingSystem,l=r||Io.defaultOutputCalendar;return new cs(o,a,l,s)}static resetCache(){aI=null,qK={},XK={},YK={}}static fromObject({locale:e,numberingSystem:i,outputCalendar:r}={}){return cs.create(e,i,r)}constructor(e,i,r,n){const[s,o,a]=tot(e);this.locale=s,this.numberingSystem=i||o||null,this.outputCalendar=r||a||null,this.intl=iot(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=n,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=sot(this)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),i=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&i?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:cs.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,i=!1,r=!0){return h4(this,e,r,Z3e,()=>{const n=i?{month:e,day:"numeric"}:{month:e},s=i?"format":"standalone";return this.monthsCache[s][e]||(this.monthsCache[s][e]=rot(o=>this.extract(o,n,"month"))),this.monthsCache[s][e]})}weekdays(e,i=!1,r=!0){return h4(this,e,r,Q3e,()=>{const n=i?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},s=i?"format":"standalone";return this.weekdaysCache[s][e]||(this.weekdaysCache[s][e]=not(o=>this.extract(o,n,"weekday"))),this.weekdaysCache[s][e]})}meridiems(e=!0){return h4(this,void 0,e,()=>ePe,()=>{if(!this.meridiemCache){const i={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[Li.utc(2016,11,13,9),Li.utc(2016,11,13,19)].map(r=>this.extract(r,i,"dayperiod"))}return this.meridiemCache})}eras(e,i=!0){return h4(this,e,i,tPe,()=>{const r={era:e};return this.eraCache[e]||(this.eraCache[e]=[Li.utc(-40,1,1),Li.utc(2017,1,1)].map(n=>this.extract(n,r,"era"))),this.eraCache[e]})}extract(e,i,r){const n=this.dtFormatter(e,i),s=n.formatToParts(),o=s.find(a=>a.type.toLowerCase()===r);return o?o.value:null}numberFormatter(e={}){return new oot(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,i={}){return new aot(e,this.intl,i)}relFormatter(e={}){return new lot(this.intl,this.isEnglish(),e)}listFormatter(e={}){return Jst(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}}let DG=null;class Yl extends kN{static get utcInstance(){return DG===null&&(DG=new Yl(0)),DG}static instance(e){return e===0?Yl.utcInstance:new Yl(e)}static parseSpecifier(e){if(e){const i=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(i)return new Yl(MB(i[1],i[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${V$(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${V$(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,i){return V$(this.fixed,i)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}}class cot extends kN{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function J1(t,e){if(Er(t)||t===null)return e;if(t instanceof kN)return t;if(uot(t)){const i=t.toLowerCase();return i==="default"?e:i==="local"||i==="system"?AB.instance:i==="utc"||i==="gmt"?Yl.utcInstance:Yl.parseSpecifier(i)||M_.create(t)}else return FS(t)?Yl.instance(t):typeof t=="object"&&t.offset&&typeof t.offset=="number"?t:new cot(t)}let Ufe=()=>Date.now(),Vfe="system",zfe=null,Bfe=null,jfe=null,Gfe=60,Hfe;class Io{static get now(){return Ufe}static set now(e){Ufe=e}static set defaultZone(e){Vfe=e}static get defaultZone(){return J1(Vfe,AB.instance)}static get defaultLocale(){return zfe}static set defaultLocale(e){zfe=e}static get defaultNumberingSystem(){return Bfe}static set defaultNumberingSystem(e){Bfe=e}static get defaultOutputCalendar(){return jfe}static set defaultOutputCalendar(e){jfe=e}static get twoDigitCutoffYear(){return Gfe}static set twoDigitCutoffYear(e){Gfe=e%100}static get throwOnInvalid(){return Hfe}static set throwOnInvalid(e){Hfe=e}static resetCaches(){cs.resetCache(),M_.resetCache()}}function Er(t){return typeof t>"u"}function FS(t){return typeof t=="number"}function RB(t){return typeof t=="number"&&t%1===0}function uot(t){return typeof t=="string"}function hot(t){return Object.prototype.toString.call(t)==="[object Date]"}function q3e(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function dot(t){return Array.isArray(t)?t:[t]}function qfe(t,e,i){if(t.length!==0)return t.reduce((r,n)=>{const s=[e(n),n];return r&&i(r[0],s[0])===r[0]?r:s},null)[1]}function pot(t,e){return e.reduce((i,r)=>(i[r]=t[r],i),{})}function FM(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Z0(t,e,i){return RB(t)&&t>=e&&t<=i}function fot(t,e){return t-e*Math.floor(t/e)}function Lo(t,e=2){const i=t<0;let r;return i?r="-"+(""+-t).padStart(e,"0"):r=(""+t).padStart(e,"0"),r}function z1(t){if(!(Er(t)||t===null||t===""))return parseInt(t,10)}function Zw(t){if(!(Er(t)||t===null||t===""))return parseFloat(t)}function moe(t){if(!(Er(t)||t===null||t==="")){const e=parseFloat("0."+t)*1e3;return Math.floor(e)}}function goe(t,e,i=!1){const r=10**e;return(i?Math.trunc:Math.round)(t*r)/r}function UN(t){return t%4===0&&(t%100!==0||t%400===0)}function U$(t){return UN(t)?366:365}function kV(t,e){const i=fot(e-1,12)+1,r=t+(e-i)/12;return i===2?UN(r)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][i-1]}function yoe(t){let e=Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,t.second,t.millisecond);return t.year<100&&t.year>=0&&(e=new Date(e),e.setUTCFullYear(e.getUTCFullYear()-1900)),+e}function UV(t){const e=(t+Math.floor(t/4)-Math.floor(t/100)+Math.floor(t/400))%7,i=t-1,r=(i+Math.floor(i/4)-Math.floor(i/100)+Math.floor(i/400))%7;return e===4||r===3?53:52}function ZK(t){return t>99?t:t>Io.twoDigitCutoffYear?1900+t:2e3+t}function W3e(t,e,i,r=null){const n=new Date(t),s={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};r&&(s.timeZone=r);const o={timeZoneName:e,...s},a=new Intl.DateTimeFormat(i,o).formatToParts(n).find(l=>l.type.toLowerCase()==="timezonename");return a?a.value:null}function MB(t,e){let i=parseInt(t,10);Number.isNaN(i)&&(i=0);const r=parseInt(e,10)||0,n=i<0||Object.is(i,-0)?-r:r;return i*60+n}function X3e(t){const e=Number(t);if(typeof t=="boolean"||t===""||Number.isNaN(e))throw new np(`Invalid unit value ${t}`);return e}function VV(t,e){const i={};for(const r in t)if(FM(t,r)){const n=t[r];if(n==null)continue;i[e(r)]=X3e(n)}return i}function V$(t,e){const i=Math.trunc(Math.abs(t/60)),r=Math.trunc(Math.abs(t%60)),n=t>=0?"+":"-";switch(e){case"short":return`${n}${Lo(i,2)}:${Lo(r,2)}`;case"narrow":return`${n}${i}${r>0?`:${r}`:""}`;case"techie":return`${n}${Lo(i,2)}${Lo(r,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function OB(t){return pot(t,["hour","minute","second","millisecond"])}const mot=["January","February","March","April","May","June","July","August","September","October","November","December"],Y3e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],got=["J","F","M","A","M","J","J","A","S","O","N","D"];function Z3e(t){switch(t){case"narrow":return[...got];case"short":return[...Y3e];case"long":return[...mot];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const J3e=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],K3e=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],yot=["M","T","W","T","F","S","S"];function Q3e(t){switch(t){case"narrow":return[...yot];case"short":return[...K3e];case"long":return[...J3e];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const ePe=["AM","PM"],_ot=["Before Christ","Anno Domini"],vot=["BC","AD"],bot=["B","A"];function tPe(t){switch(t){case"narrow":return[...bot];case"short":return[...vot];case"long":return[..._ot];default:return null}}function wot(t){return ePe[t.hour<12?0:1]}function xot(t,e){return Q3e(e)[t.weekday-1]}function Tot(t,e){return Z3e(e)[t.month-1]}function Sot(t,e){return tPe(e)[t.year<0?0:1]}function Eot(t,e,i="always",r=!1){const n={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},s=["hours","minutes","seconds"].indexOf(t)===-1;if(i==="auto"&&s){const p=t==="days";switch(e){case 1:return p?"tomorrow":`next ${n[t][0]}`;case-1:return p?"yesterday":`last ${n[t][0]}`;case 0:return p?"today":`this ${n[t][0]}`}}const o=Object.is(e,-0)||e<0,a=Math.abs(e),l=a===1,c=n[t],h=r?l?c[1]:c[2]||c[1]:l?n[t][0]:t;return o?`${a} ${h} ago`:`in ${a} ${h}`}function Wfe(t,e){let i="";for(const r of t)r.literal?i+=r.val:i+=e(r.val);return i}const Cot={D:FV,DD:A3e,DDD:R3e,DDDD:M3e,t:O3e,tt:P3e,ttt:I3e,tttt:$3e,T:L3e,TT:D3e,TTT:N3e,TTTT:F3e,f:k3e,ff:V3e,fff:B3e,ffff:G3e,F:U3e,FF:z3e,FFF:j3e,FFFF:H3e};class Hl{static create(e,i={}){return new Hl(e,i)}static parseFormat(e){let i=null,r="",n=!1;const s=[];for(let o=0;o<e.length;o++){const a=e.charAt(o);a==="'"?(r.length>0&&s.push({literal:n,val:r}),i=null,r="",n=!n):n||a===i?r+=a:(r.length>0&&s.push({literal:!1,val:r}),r=a,i=a)}return r.length>0&&s.push({literal:n,val:r}),s}static macroTokenToFormatOpts(e){return Cot[e]}constructor(e,i){this.opts=i,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,i){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...i}).format()}formatDateTime(e,i={}){return this.loc.dtFormatter(e,{...this.opts,...i}).format()}formatDateTimeParts(e,i={}){return this.loc.dtFormatter(e,{...this.opts,...i}).formatToParts()}formatInterval(e,i={}){return this.loc.dtFormatter(e.start,{...this.opts,...i}).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,i={}){return this.loc.dtFormatter(e,{...this.opts,...i}).resolvedOptions()}num(e,i=0){if(this.opts.forceSimple)return Lo(e,i);const r={...this.opts};return i>0&&(r.padTo=i),this.loc.numberFormatter(r).format(e)}formatDateTimeFromString(e,i){const r=this.loc.listingMode()==="en",n=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",s=(m,g)=>this.loc.extract(e,m,g),o=m=>e.isOffsetFixed&&e.offset===0&&m.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,m.format):"",a=()=>r?wot(e):s({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(m,g)=>r?Tot(e,m):s(g?{month:m}:{month:m,day:"numeric"},"month"),c=(m,g)=>r?xot(e,m):s(g?{weekday:m}:{weekday:m,month:"long",day:"numeric"},"weekday"),h=m=>{const g=Hl.macroTokenToFormatOpts(m);return g?this.formatWithSystemDefault(e,g):m},p=m=>r?Sot(e,m):s({era:m},"era"),f=m=>{switch(m){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return o({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return o({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return o({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return a();case"d":return n?s({day:"numeric"},"day"):this.num(e.day);case"dd":return n?s({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return n?s({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return n?s({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return n?s({month:"numeric"},"month"):this.num(e.month);case"MM":return n?s({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return n?s({year:"numeric"},"year"):this.num(e.year);case"yy":return n?s({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return n?s({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return n?s({year:"numeric"},"year"):this.num(e.year,6);case"G":return p("short");case"GG":return p("long");case"GGGGG":return p("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return h(m)}};return Wfe(Hl.parseFormat(i),f)}formatDurationFromString(e,i){const r=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},n=l=>c=>{const h=r(c);return h?this.num(l.get(h),c.length):c},s=Hl.parseFormat(i),o=s.reduce((l,{literal:c,val:h})=>c?l:l.concat(h),[]),a=e.shiftTo(...o.map(r).filter(l=>l));return Wfe(s,n(a))}}class Qf{constructor(e,i){this.reason=e,this.explanation=i}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const iPe=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function PO(...t){const e=t.reduce((i,r)=>i+r.source,"");return RegExp(`^${e}$`)}function IO(...t){return e=>t.reduce(([i,r,n],s)=>{const[o,a,l]=s(e,n);return[{...i,...o},a||r,l]},[{},null,1]).slice(0,2)}function $O(t,...e){if(t==null)return[null,null];for(const[i,r]of e){const n=i.exec(t);if(n)return r(n)}return[null,null]}function rPe(...t){return(e,i)=>{const r={};let n;for(n=0;n<t.length;n++)r[t[n]]=z1(e[i+n]);return[r,null,i+n]}}const nPe=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,Aot=`(?:${nPe.source}?(?:\\[(${iPe.source})\\])?)?`,_oe=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,sPe=RegExp(`${_oe.source}${Aot}`),voe=RegExp(`(?:T${sPe.source})?`),Rot=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,Mot=/(\d{4})-?W(\d\d)(?:-?(\d))?/,Oot=/(\d{4})-?(\d{3})/,Pot=rPe("weekYear","weekNumber","weekDay"),Iot=rPe("year","ordinal"),$ot=/(\d{4})-(\d\d)-(\d\d)/,oPe=RegExp(`${_oe.source} ?(?:${nPe.source}|(${iPe.source}))?`),Lot=RegExp(`(?: ${oPe.source})?`);function FR(t,e,i){const r=t[e];return Er(r)?i:z1(r)}function Dot(t,e){return[{year:FR(t,e),month:FR(t,e+1,1),day:FR(t,e+2,1)},null,e+3]}function LO(t,e){return[{hours:FR(t,e,0),minutes:FR(t,e+1,0),seconds:FR(t,e+2,0),milliseconds:moe(t[e+3])},null,e+4]}function VN(t,e){const i=!t[e]&&!t[e+1],r=MB(t[e+1],t[e+2]),n=i?null:Yl.instance(r);return[{},n,e+3]}function zN(t,e){const i=t[e]?M_.create(t[e]):null;return[{},i,e+1]}const Not=RegExp(`^T?${_oe.source}$`),Fot=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function kot(t){const[e,i,r,n,s,o,a,l,c]=t,h=e[0]==="-",p=l&&l[0]==="-",f=(m,g=!1)=>m!==void 0&&(g||m&&h)?-m:m;return[{years:f(Zw(i)),months:f(Zw(r)),weeks:f(Zw(n)),days:f(Zw(s)),hours:f(Zw(o)),minutes:f(Zw(a)),seconds:f(Zw(l),l==="-0"),milliseconds:f(moe(c),p)}]}const Uot={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function boe(t,e,i,r,n,s,o){const a={year:e.length===2?ZK(z1(e)):z1(e),month:Y3e.indexOf(i)+1,day:z1(r),hour:z1(n),minute:z1(s)};return o&&(a.second=z1(o)),t&&(a.weekday=t.length>3?J3e.indexOf(t)+1:K3e.indexOf(t)+1),a}const Vot=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function zot(t){const[,e,i,r,n,s,o,a,l,c,h,p]=t,f=boe(e,n,r,i,s,o,a);let m;return l?m=Uot[l]:c?m=0:m=MB(h,p),[f,new Yl(m)]}function Bot(t){return t.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const jot=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,Got=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,Hot=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function Xfe(t){const[,e,i,r,n,s,o,a]=t;return[boe(e,n,r,i,s,o,a),Yl.utcInstance]}function qot(t){const[,e,i,r,n,s,o,a]=t;return[boe(e,a,i,r,n,s,o),Yl.utcInstance]}const Wot=PO(Rot,voe),Xot=PO(Mot,voe),Yot=PO(Oot,voe),Zot=PO(sPe),aPe=IO(Dot,LO,VN,zN),Jot=IO(Pot,LO,VN,zN),Kot=IO(Iot,LO,VN,zN),Qot=IO(LO,VN,zN);function eat(t){return $O(t,[Wot,aPe],[Xot,Jot],[Yot,Kot],[Zot,Qot])}function tat(t){return $O(Bot(t),[Vot,zot])}function iat(t){return $O(t,[jot,Xfe],[Got,Xfe],[Hot,qot])}function rat(t){return $O(t,[Fot,kot])}const nat=IO(LO);function sat(t){return $O(t,[Not,nat])}const oat=PO($ot,Lot),aat=PO(oPe),lat=IO(LO,VN,zN);function cat(t){return $O(t,[oat,aPe],[aat,lat])}const uat="Invalid Duration",lPe={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},hat={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...lPe},_d=146097/400,oE=146097/4800,dat={years:{quarters:4,months:12,weeks:_d/7,days:_d,hours:_d*24,minutes:_d*24*60,seconds:_d*24*60*60,milliseconds:_d*24*60*60*1e3},quarters:{months:3,weeks:_d/28,days:_d/4,hours:_d*24/4,minutes:_d*24*60/4,seconds:_d*24*60*60/4,milliseconds:_d*24*60*60*1e3/4},months:{weeks:oE/7,days:oE,hours:oE*24,minutes:oE*24*60,seconds:oE*24*60*60,milliseconds:oE*24*60*60*1e3},...lPe},mT=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],pat=mT.slice(0).reverse();function vv(t,e,i=!1){const r={values:i?e.values:{...t.values,...e.values||{}},loc:t.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||t.conversionAccuracy,matrix:e.matrix||t.matrix};return new Mr(r)}function fat(t){return t<0?Math.floor(t):Math.ceil(t)}function cPe(t,e,i,r,n){const s=t[n][i],o=e[i]/s,a=Math.sign(o)===Math.sign(r[n]),l=!a&&r[n]!==0&&Math.abs(o)<=1?fat(o):Math.trunc(o);r[n]+=l,e[i]-=l*s}function mat(t,e){pat.reduce((i,r)=>Er(e[r])?i:(i&&cPe(t,e,i,e,r),r),null)}function gat(t){const e={};for(const[i,r]of Object.entries(t))r!==0&&(e[i]=r);return e}class Mr{constructor(e){const i=e.conversionAccuracy==="longterm"||!1;let r=i?dat:hat;e.matrix&&(r=e.matrix),this.values=e.values,this.loc=e.loc||cs.create(),this.conversionAccuracy=i?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=r,this.isLuxonDuration=!0}static fromMillis(e,i){return Mr.fromObject({milliseconds:e},i)}static fromObject(e,i={}){if(e==null||typeof e!="object")throw new np(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new Mr({values:VV(e,Mr.normalizeUnit),loc:cs.fromObject(i),conversionAccuracy:i.conversionAccuracy,matrix:i.matrix})}static fromDurationLike(e){if(FS(e))return Mr.fromMillis(e);if(Mr.isDuration(e))return e;if(typeof e=="object")return Mr.fromObject(e);throw new np(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,i){const[r]=rat(e);return r?Mr.fromObject(r,i):Mr.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,i){const[r]=sat(e);return r?Mr.fromObject(r,i):Mr.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,i=null){if(!e)throw new np("need to specify a reason the Duration is invalid");const r=e instanceof Qf?e:new Qf(e,i);if(Io.throwOnInvalid)throw new Gst(r);return new Mr({invalid:r})}static normalizeUnit(e){const i={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!i)throw new C3e(e);return i}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,i={}){const r={...i,floor:i.round!==!1&&i.floor!==!1};return this.isValid?Hl.create(this.loc,r).formatDurationFromString(this,e):uat}toHuman(e={}){const i=mT.map(r=>{const n=this.values[r];return Er(n)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:r.slice(0,-1)}).format(n)}).filter(r=>r);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(i)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=goe(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const i=this.toMillis();if(i<0||i>=864e5)return null;e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e};const r=this.shiftTo("hours","minutes","seconds","milliseconds");let n=e.format==="basic"?"hhmm":"hh:mm";(!e.suppressSeconds||r.seconds!==0||r.milliseconds!==0)&&(n+=e.format==="basic"?"ss":":ss",(!e.suppressMilliseconds||r.milliseconds!==0)&&(n+=".SSS"));let s=r.toFormat(n);return e.includePrefix&&(s="T"+s),s}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.as("milliseconds")}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const i=Mr.fromDurationLike(e),r={};for(const n of mT)(FM(i.values,n)||FM(this.values,n))&&(r[n]=i.get(n)+this.get(n));return vv(this,{values:r},!0)}minus(e){if(!this.isValid)return this;const i=Mr.fromDurationLike(e);return this.plus(i.negate())}mapUnits(e){if(!this.isValid)return this;const i={};for(const r of Object.keys(this.values))i[r]=X3e(e(this.values[r],r));return vv(this,{values:i},!0)}get(e){return this[Mr.normalizeUnit(e)]}set(e){if(!this.isValid)return this;const i={...this.values,...VV(e,Mr.normalizeUnit)};return vv(this,{values:i})}reconfigure({locale:e,numberingSystem:i,conversionAccuracy:r,matrix:n}={}){const o={loc:this.loc.clone({locale:e,numberingSystem:i}),matrix:n,conversionAccuracy:r};return vv(this,o)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return mat(this.matrix,e),vv(this,{values:e},!0)}rescale(){if(!this.isValid)return this;const e=gat(this.normalize().shiftToAll().toObject());return vv(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(o=>Mr.normalizeUnit(o));const i={},r={},n=this.toObject();let s;for(const o of mT)if(e.indexOf(o)>=0){s=o;let a=0;for(const c in r)a+=this.matrix[c][o]*r[c],r[c]=0;FS(n[o])&&(a+=n[o]);const l=Math.trunc(a);i[o]=l,r[o]=(a*1e3-l*1e3)/1e3;for(const c in n)mT.indexOf(c)>mT.indexOf(o)&&cPe(this.matrix,n,c,i,o)}else FS(n[o])&&(r[o]=n[o]);for(const o in r)r[o]!==0&&(i[s]+=o===s?r[o]:r[o]/this.matrix[s][o]);return vv(this,{values:i},!0).normalize()}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const i of Object.keys(this.values))e[i]=this.values[i]===0?0:-this.values[i];return vv(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function i(r,n){return r===void 0||r===0?n===void 0||n===0:r===n}for(const r of mT)if(!i(this.values[r],e.values[r]))return!1;return!0}}const aE="Invalid Interval";function yat(t,e){return!t||!t.isValid?zs.invalid("missing or invalid start"):!e||!e.isValid?zs.invalid("missing or invalid end"):e<t?zs.invalid("end before start",`The end of an interval must be after its start, but you had start=${t.toISO()} and end=${e.toISO()}`):null}class zs{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,i=null){if(!e)throw new np("need to specify a reason the Interval is invalid");const r=e instanceof Qf?e:new Qf(e,i);if(Io.throwOnInvalid)throw new jst(r);return new zs({invalid:r})}static fromDateTimes(e,i){const r=S3(e),n=S3(i),s=yat(r,n);return s??new zs({start:r,end:n})}static after(e,i){const r=Mr.fromDurationLike(i),n=S3(e);return zs.fromDateTimes(n,n.plus(r))}static before(e,i){const r=Mr.fromDurationLike(i),n=S3(e);return zs.fromDateTimes(n.minus(r),n)}static fromISO(e,i){const[r,n]=(e||"").split("/",2);if(r&&n){let s,o;try{s=Li.fromISO(r,i),o=s.isValid}catch{o=!1}let a,l;try{a=Li.fromISO(n,i),l=a.isValid}catch{l=!1}if(o&&l)return zs.fromDateTimes(s,a);if(o){const c=Mr.fromISO(n,i);if(c.isValid)return zs.after(s,c)}else if(l){const c=Mr.fromISO(r,i);if(c.isValid)return zs.before(a,c)}}return zs.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds"){if(!this.isValid)return NaN;const i=this.start.startOf(e),r=this.end.startOf(e);return Math.floor(r.diff(i,e).get(e))+1}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:i}={}){return this.isValid?zs.fromDateTimes(e||this.s,i||this.e):this}splitAt(...e){if(!this.isValid)return[];const i=e.map(S3).filter(o=>this.contains(o)).sort(),r=[];let{s:n}=this,s=0;for(;n<this.e;){const o=i[s]||this.e,a=+o>+this.e?this.e:o;r.push(zs.fromDateTimes(n,a)),n=a,s+=1}return r}splitBy(e){const i=Mr.fromDurationLike(e);if(!this.isValid||!i.isValid||i.as("milliseconds")===0)return[];let{s:r}=this,n=1,s;const o=[];for(;r<this.e;){const a=this.start.plus(i.mapUnits(l=>l*n));s=+a>+this.e?this.e:a,o.push(zs.fromDateTimes(r,s)),r=s,n+=1}return o}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const i=this.s>e.s?this.s:e.s,r=this.e<e.e?this.e:e.e;return i>=r?null:zs.fromDateTimes(i,r)}union(e){if(!this.isValid)return this;const i=this.s<e.s?this.s:e.s,r=this.e>e.e?this.e:e.e;return zs.fromDateTimes(i,r)}static merge(e){const[i,r]=e.sort((n,s)=>n.s-s.s).reduce(([n,s],o)=>s?s.overlaps(o)||s.abutsStart(o)?[n,s.union(o)]:[n.concat([s]),o]:[n,o],[[],null]);return r&&i.push(r),i}static xor(e){let i=null,r=0;const n=[],s=e.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),o=Array.prototype.concat(...s),a=o.sort((l,c)=>l.time-c.time);for(const l of a)r+=l.type==="s"?1:-1,r===1?i=l.time:(i&&+i!=+l.time&&n.push(zs.fromDateTimes(i,l.time)),i=null);return zs.merge(n)}difference(...e){return zs.xor([this].concat(e)).map(i=>this.intersection(i)).filter(i=>i&&!i.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()}  ${this.e.toISO()})`:aE}toLocaleString(e=FV,i={}){return this.isValid?Hl.create(this.s.loc.clone(i),e).formatInterval(this):aE}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:aE}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:aE}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:aE}toFormat(e,{separator:i="  "}={}){return this.isValid?`${this.s.toFormat(e)}${i}${this.e.toFormat(e)}`:aE}toDuration(e,i){return this.isValid?this.e.diff(this.s,e,i):Mr.invalid(this.invalidReason)}mapEndpoints(e){return zs.fromDateTimes(e(this.s),e(this.e))}}class d4{static hasDST(e=Io.defaultZone){const i=Li.now().setZone(e).set({month:12});return!e.isUniversal&&i.offset!==i.set({month:6}).offset}static isValidIANAZone(e){return M_.isValidZone(e)}static normalizeZone(e){return J1(e,Io.defaultZone)}static months(e="long",{locale:i=null,numberingSystem:r=null,locObj:n=null,outputCalendar:s="gregory"}={}){return(n||cs.create(i,r,s)).months(e)}static monthsFormat(e="long",{locale:i=null,numberingSystem:r=null,locObj:n=null,outputCalendar:s="gregory"}={}){return(n||cs.create(i,r,s)).months(e,!0)}static weekdays(e="long",{locale:i=null,numberingSystem:r=null,locObj:n=null}={}){return(n||cs.create(i,r,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:i=null,numberingSystem:r=null,locObj:n=null}={}){return(n||cs.create(i,r,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return cs.create(e).meridiems()}static eras(e="short",{locale:i=null}={}){return cs.create(i,null,"gregory").eras(e)}static features(){return{relative:q3e()}}}function Yfe(t,e){const i=n=>n.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),r=i(e)-i(t);return Math.floor(Mr.fromMillis(r).as("days"))}function _at(t,e,i){const r=[["years",(l,c)=>c.year-l.year],["quarters",(l,c)=>c.quarter-l.quarter+(c.year-l.year)*4],["months",(l,c)=>c.month-l.month+(c.year-l.year)*12],["weeks",(l,c)=>{const h=Yfe(l,c);return(h-h%7)/7}],["days",Yfe]],n={},s=t;let o,a;for(const[l,c]of r)i.indexOf(l)>=0&&(o=l,n[l]=c(t,e),a=s.plus(n),a>e?(n[l]--,t=s.plus(n)):t=a);return[t,n,a,o]}function vat(t,e,i,r){let[n,s,o,a]=_at(t,e,i);const l=e-n,c=i.filter(p=>["hours","minutes","seconds","milliseconds"].indexOf(p)>=0);c.length===0&&(o<e&&(o=n.plus({[a]:1})),o!==n&&(s[a]=(s[a]||0)+l/(o-n)));const h=Mr.fromObject(s,r);return c.length>0?Mr.fromMillis(l,r).shiftTo(...c).plus(h):h}const woe={arab:"[-]",arabext:"[-]",bali:"[-]",beng:"[-]",deva:"[-]",fullwide:"[-]",gujr:"[-]",hanidec:"[|||||||||]",khmr:"[-]",knda:"[-]",laoo:"[-]",limb:"[-]",mlym:"[-]",mong:"[-]",mymr:"[-]",orya:"[-]",tamldec:"[-]",telu:"[-]",thai:"[-]",tibt:"[-]",latn:"\\d"},Zfe={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},bat=woe.hanidec.replace(/[\[|\]]/g,"").split("");function wat(t){let e=parseInt(t,10);if(isNaN(e)){e="";for(let i=0;i<t.length;i++){const r=t.charCodeAt(i);if(t[i].search(woe.hanidec)!==-1)e+=bat.indexOf(t[i]);else for(const n in Zfe){const[s,o]=Zfe[n];r>=s&&r<=o&&(e+=r-s)}}return parseInt(e,10)}else return e}function Zp({numberingSystem:t},e=""){return new RegExp(`${woe[t||"latn"]}${e}`)}const xat="missing Intl.DateTimeFormat.formatToParts support";function Hr(t,e=i=>i){return{regex:t,deser:([i])=>e(wat(i))}}const Tat=String.fromCharCode(160),uPe=`[ ${Tat}]`,hPe=new RegExp(uPe,"g");function Sat(t){return t.replace(/\./g,"\\.?").replace(hPe,uPe)}function Jfe(t){return t.replace(/\./g,"").replace(hPe," ").toLowerCase()}function Jp(t,e){return t===null?null:{regex:RegExp(t.map(Sat).join("|")),deser:([i])=>t.findIndex(r=>Jfe(i)===Jfe(r))+e}}function Kfe(t,e){return{regex:t,deser:([,i,r])=>MB(i,r),groups:e}}function NG(t){return{regex:t,deser:([e])=>e}}function Eat(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function Cat(t,e){const i=Zp(e),r=Zp(e,"{2}"),n=Zp(e,"{3}"),s=Zp(e,"{4}"),o=Zp(e,"{6}"),a=Zp(e,"{1,2}"),l=Zp(e,"{1,3}"),c=Zp(e,"{1,6}"),h=Zp(e,"{1,9}"),p=Zp(e,"{2,4}"),f=Zp(e,"{4,6}"),m=b=>({regex:RegExp(Eat(b.val)),deser:([w])=>w,literal:!0}),_=(b=>{if(t.literal)return m(b);switch(b.val){case"G":return Jp(e.eras("short",!1),0);case"GG":return Jp(e.eras("long",!1),0);case"y":return Hr(c);case"yy":return Hr(p,ZK);case"yyyy":return Hr(s);case"yyyyy":return Hr(f);case"yyyyyy":return Hr(o);case"M":return Hr(a);case"MM":return Hr(r);case"MMM":return Jp(e.months("short",!0,!1),1);case"MMMM":return Jp(e.months("long",!0,!1),1);case"L":return Hr(a);case"LL":return Hr(r);case"LLL":return Jp(e.months("short",!1,!1),1);case"LLLL":return Jp(e.months("long",!1,!1),1);case"d":return Hr(a);case"dd":return Hr(r);case"o":return Hr(l);case"ooo":return Hr(n);case"HH":return Hr(r);case"H":return Hr(a);case"hh":return Hr(r);case"h":return Hr(a);case"mm":return Hr(r);case"m":return Hr(a);case"q":return Hr(a);case"qq":return Hr(r);case"s":return Hr(a);case"ss":return Hr(r);case"S":return Hr(l);case"SSS":return Hr(n);case"u":return NG(h);case"uu":return NG(a);case"uuu":return Hr(i);case"a":return Jp(e.meridiems(),0);case"kkkk":return Hr(s);case"kk":return Hr(p,ZK);case"W":return Hr(a);case"WW":return Hr(r);case"E":case"c":return Hr(i);case"EEE":return Jp(e.weekdays("short",!1,!1),1);case"EEEE":return Jp(e.weekdays("long",!1,!1),1);case"ccc":return Jp(e.weekdays("short",!0,!1),1);case"cccc":return Jp(e.weekdays("long",!0,!1),1);case"Z":case"ZZ":return Kfe(new RegExp(`([+-]${a.source})(?::(${r.source}))?`),2);case"ZZZ":return Kfe(new RegExp(`([+-]${a.source})(${r.source})?`),2);case"z":return NG(/[a-z_+-/]{1,256}?/i);default:return m(b)}})(t)||{invalidReason:xat};return _.token=t,_}const Aat={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function Rat(t,e){const{type:i,value:r}=t;if(i==="literal")return{literal:!0,val:r};const n=e[i];let s=Aat[i];if(typeof s=="object"&&(s=s[n]),s)return{literal:!1,val:s}}function Mat(t){return[`^${t.map(i=>i.regex).reduce((i,r)=>`${i}(${r.source})`,"")}$`,t]}function Oat(t,e,i){const r=t.match(e);if(r){const n={};let s=1;for(const o in i)if(FM(i,o)){const a=i[o],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(n[a.token.val[0]]=a.deser(r.slice(s,s+l))),s+=l}return[r,n]}else return[r,{}]}function Pat(t){const e=s=>{switch(s){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let i=null,r;return Er(t.z)||(i=M_.create(t.z)),Er(t.Z)||(i||(i=new Yl(t.Z)),r=t.Z),Er(t.q)||(t.M=(t.q-1)*3+1),Er(t.h)||(t.h<12&&t.a===1?t.h+=12:t.h===12&&t.a===0&&(t.h=0)),t.G===0&&t.y&&(t.y=-t.y),Er(t.u)||(t.S=moe(t.u)),[Object.keys(t).reduce((s,o)=>{const a=e(o);return a&&(s[a]=t[o]),s},{}),i,r]}let FG=null;function Iat(){return FG||(FG=Li.fromMillis(1555555555555)),FG}function $at(t,e){if(t.literal)return t;const i=Hl.macroTokenToFormatOpts(t.val),r=fPe(i,e);return r==null||r.includes(void 0)?t:r}function dPe(t,e){return Array.prototype.concat(...t.map(i=>$at(i,e)))}function pPe(t,e,i){const r=dPe(Hl.parseFormat(i),t),n=r.map(o=>Cat(o,t)),s=n.find(o=>o.invalidReason);if(s)return{input:e,tokens:r,invalidReason:s.invalidReason};{const[o,a]=Mat(n),l=RegExp(o,"i"),[c,h]=Oat(e,l,a),[p,f,m]=h?Pat(h):[null,null,void 0];if(FM(h,"a")&&FM(h,"H"))throw new oI("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:r,regex:l,rawMatches:c,matches:h,result:p,zone:f,specificOffset:m}}}function Lat(t,e,i){const{result:r,zone:n,specificOffset:s,invalidReason:o}=pPe(t,e,i);return[r,n,s,o]}function fPe(t,e){return t?Hl.create(e,t).formatDateTimeParts(Iat()).map(n=>Rat(n,t)):null}const mPe=[0,31,59,90,120,151,181,212,243,273,304,334],gPe=[0,31,60,91,121,152,182,213,244,274,305,335];function gp(t,e){return new Qf("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${t}, which is invalid`)}function yPe(t,e,i){const r=new Date(Date.UTC(t,e-1,i));t<100&&t>=0&&r.setUTCFullYear(r.getUTCFullYear()-1900);const n=r.getUTCDay();return n===0?7:n}function _Pe(t,e,i){return i+(UN(t)?gPe:mPe)[e-1]}function vPe(t,e){const i=UN(t)?gPe:mPe,r=i.findIndex(s=>s<e),n=e-i[r];return{month:r+1,day:n}}function JK(t){const{year:e,month:i,day:r}=t,n=_Pe(e,i,r),s=yPe(e,i,r);let o=Math.floor((n-s+10)/7),a;return o<1?(a=e-1,o=UV(a)):o>UV(e)?(a=e+1,o=1):a=e,{weekYear:a,weekNumber:o,weekday:s,...OB(t)}}function Qfe(t){const{weekYear:e,weekNumber:i,weekday:r}=t,n=yPe(e,1,4),s=U$(e);let o=i*7+r-n-3,a;o<1?(a=e-1,o+=U$(a)):o>s?(a=e+1,o-=U$(e)):a=e;const{month:l,day:c}=vPe(a,o);return{year:a,month:l,day:c,...OB(t)}}function kG(t){const{year:e,month:i,day:r}=t,n=_Pe(e,i,r);return{year:e,ordinal:n,...OB(t)}}function eme(t){const{year:e,ordinal:i}=t,{month:r,day:n}=vPe(e,i);return{year:e,month:r,day:n,...OB(t)}}function Dat(t){const e=RB(t.weekYear),i=Z0(t.weekNumber,1,UV(t.weekYear)),r=Z0(t.weekday,1,7);return e?i?r?!1:gp("weekday",t.weekday):gp("week",t.week):gp("weekYear",t.weekYear)}function Nat(t){const e=RB(t.year),i=Z0(t.ordinal,1,U$(t.year));return e?i?!1:gp("ordinal",t.ordinal):gp("year",t.year)}function bPe(t){const e=RB(t.year),i=Z0(t.month,1,12),r=Z0(t.day,1,kV(t.year,t.month));return e?i?r?!1:gp("day",t.day):gp("month",t.month):gp("year",t.year)}function wPe(t){const{hour:e,minute:i,second:r,millisecond:n}=t,s=Z0(e,0,23)||e===24&&i===0&&r===0&&n===0,o=Z0(i,0,59),a=Z0(r,0,59),l=Z0(n,0,999);return s?o?a?l?!1:gp("millisecond",n):gp("second",r):gp("minute",i):gp("hour",e)}const UG="Invalid DateTime",tme=864e13;function p4(t){return new Qf("unsupported zone",`the zone "${t.name}" is not supported`)}function VG(t){return t.weekData===null&&(t.weekData=JK(t.c)),t.weekData}function x3(t,e){const i={ts:t.ts,zone:t.zone,c:t.c,o:t.o,loc:t.loc,invalid:t.invalid};return new Li({...i,...e,old:i})}function xPe(t,e,i){let r=t-e*60*1e3;const n=i.offset(r);if(e===n)return[r,e];r-=(n-e)*60*1e3;const s=i.offset(r);return n===s?[r,n]:[t-Math.min(n,s)*60*1e3,Math.max(n,s)]}function ime(t,e){t+=e*60*1e3;const i=new Date(t);return{year:i.getUTCFullYear(),month:i.getUTCMonth()+1,day:i.getUTCDate(),hour:i.getUTCHours(),minute:i.getUTCMinutes(),second:i.getUTCSeconds(),millisecond:i.getUTCMilliseconds()}}function rU(t,e,i){return xPe(yoe(t),e,i)}function rme(t,e){const i=t.o,r=t.c.year+Math.trunc(e.years),n=t.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,s={...t.c,year:r,month:n,day:Math.min(t.c.day,kV(r,n))+Math.trunc(e.days)+Math.trunc(e.weeks)*7},o=Mr.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),a=yoe(s);let[l,c]=xPe(a,i,t.zone);return o!==0&&(l+=o,c=t.zone.offset(l)),{ts:l,o:c}}function T3(t,e,i,r,n,s){const{setZone:o,zone:a}=i;if(t&&Object.keys(t).length!==0){const l=e||a,c=Li.fromObject(t,{...i,zone:l,specificOffset:s});return o?c:c.setZone(a)}else return Li.invalid(new Qf("unparsable",`the input "${n}" can't be parsed as ${r}`))}function f4(t,e,i=!0){return t.isValid?Hl.create(cs.create("en-US"),{allowZ:i,forceSimple:!0}).formatDateTimeFromString(t,e):null}function zG(t,e){const i=t.c.year>9999||t.c.year<0;let r="";return i&&t.c.year>=0&&(r+="+"),r+=Lo(t.c.year,i?6:4),e?(r+="-",r+=Lo(t.c.month),r+="-",r+=Lo(t.c.day)):(r+=Lo(t.c.month),r+=Lo(t.c.day)),r}function nme(t,e,i,r,n,s){let o=Lo(t.c.hour);return e?(o+=":",o+=Lo(t.c.minute),(t.c.second!==0||!i)&&(o+=":")):o+=Lo(t.c.minute),(t.c.second!==0||!i)&&(o+=Lo(t.c.second),(t.c.millisecond!==0||!r)&&(o+=".",o+=Lo(t.c.millisecond,3))),n&&(t.isOffsetFixed&&t.offset===0&&!s?o+="Z":t.o<0?(o+="-",o+=Lo(Math.trunc(-t.o/60)),o+=":",o+=Lo(Math.trunc(-t.o%60))):(o+="+",o+=Lo(Math.trunc(t.o/60)),o+=":",o+=Lo(Math.trunc(t.o%60)))),s&&(o+="["+t.zone.ianaName+"]"),o}const TPe={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},Fat={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},kat={ordinal:1,hour:0,minute:0,second:0,millisecond:0},SPe=["year","month","day","hour","minute","second","millisecond"],Uat=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],Vat=["year","ordinal","hour","minute","second","millisecond"];function sme(t){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[t.toLowerCase()];if(!e)throw new C3e(t);return e}function ome(t,e){const i=J1(e.zone,Io.defaultZone),r=cs.fromObject(e),n=Io.now();let s,o;if(Er(t.year))s=n;else{for(const c of SPe)Er(t[c])&&(t[c]=TPe[c]);const a=bPe(t)||wPe(t);if(a)return Li.invalid(a);const l=i.offset(n);[s,o]=rU(t,l,i)}return new Li({ts:s,zone:i,loc:r,o})}function ame(t,e,i){const r=Er(i.round)?!0:i.round,n=(o,a)=>(o=goe(o,r||i.calendary?0:2,!0),e.loc.clone(i).relFormatter(i).format(o,a)),s=o=>i.calendary?e.hasSame(t,o)?0:e.startOf(o).diff(t.startOf(o),o).get(o):e.diff(t,o).get(o);if(i.unit)return n(s(i.unit),i.unit);for(const o of i.units){const a=s(o);if(Math.abs(a)>=1)return n(a,o)}return n(t>e?-0:0,i.units[i.units.length-1])}function lme(t){let e={},i;return t.length>0&&typeof t[t.length-1]=="object"?(e=t[t.length-1],i=Array.from(t).slice(0,t.length-1)):i=Array.from(t),[e,i]}class Li{constructor(e){const i=e.zone||Io.defaultZone;let r=e.invalid||(Number.isNaN(e.ts)?new Qf("invalid input"):null)||(i.isValid?null:p4(i));this.ts=Er(e.ts)?Io.now():e.ts;let n=null,s=null;if(!r)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(i))[n,s]=[e.old.c,e.old.o];else{const a=i.offset(this.ts);n=ime(this.ts,a),r=Number.isNaN(n.year)?new Qf("invalid input"):null,n=r?null:n,s=r?null:a}this._zone=i,this.loc=e.loc||cs.create(),this.invalid=r,this.weekData=null,this.c=n,this.o=s,this.isLuxonDateTime=!0}static now(){return new Li({})}static local(){const[e,i]=lme(arguments),[r,n,s,o,a,l,c]=i;return ome({year:r,month:n,day:s,hour:o,minute:a,second:l,millisecond:c},e)}static utc(){const[e,i]=lme(arguments),[r,n,s,o,a,l,c]=i;return e.zone=Yl.utcInstance,ome({year:r,month:n,day:s,hour:o,minute:a,second:l,millisecond:c},e)}static fromJSDate(e,i={}){const r=hot(e)?e.valueOf():NaN;if(Number.isNaN(r))return Li.invalid("invalid input");const n=J1(i.zone,Io.defaultZone);return n.isValid?new Li({ts:r,zone:n,loc:cs.fromObject(i)}):Li.invalid(p4(n))}static fromMillis(e,i={}){if(FS(e))return e<-tme||e>tme?Li.invalid("Timestamp out of range"):new Li({ts:e,zone:J1(i.zone,Io.defaultZone),loc:cs.fromObject(i)});throw new np(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,i={}){if(FS(e))return new Li({ts:e*1e3,zone:J1(i.zone,Io.defaultZone),loc:cs.fromObject(i)});throw new np("fromSeconds requires a numerical input")}static fromObject(e,i={}){e=e||{};const r=J1(i.zone,Io.defaultZone);if(!r.isValid)return Li.invalid(p4(r));const n=Io.now(),s=Er(i.specificOffset)?r.offset(n):i.specificOffset,o=VV(e,sme),a=!Er(o.ordinal),l=!Er(o.year),c=!Er(o.month)||!Er(o.day),h=l||c,p=o.weekYear||o.weekNumber,f=cs.fromObject(i);if((h||a)&&p)throw new oI("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(c&&a)throw new oI("Can't mix ordinal dates with month/day");const m=p||o.weekday&&!h;let g,_,b=ime(n,s);m?(g=Uat,_=Fat,b=JK(b)):a?(g=Vat,_=kat,b=kG(b)):(g=SPe,_=TPe);let w=!1;for(const O of g){const D=o[O];Er(D)?w?o[O]=_[O]:o[O]=b[O]:w=!0}const x=m?Dat(o):a?Nat(o):bPe(o),T=x||wPe(o);if(T)return Li.invalid(T);const E=m?Qfe(o):a?eme(o):o,[C,A]=rU(E,s,r),I=new Li({ts:C,zone:r,o:A,loc:f});return o.weekday&&h&&e.weekday!==I.weekday?Li.invalid("mismatched weekday",`you can't specify both a weekday of ${o.weekday} and a date of ${I.toISO()}`):I}static fromISO(e,i={}){const[r,n]=eat(e);return T3(r,n,i,"ISO 8601",e)}static fromRFC2822(e,i={}){const[r,n]=tat(e);return T3(r,n,i,"RFC 2822",e)}static fromHTTP(e,i={}){const[r,n]=iat(e);return T3(r,n,i,"HTTP",i)}static fromFormat(e,i,r={}){if(Er(e)||Er(i))throw new np("fromFormat requires an input string and a format");const{locale:n=null,numberingSystem:s=null}=r,o=cs.fromOpts({locale:n,numberingSystem:s,defaultToEN:!0}),[a,l,c,h]=Lat(o,e,i);return h?Li.invalid(h):T3(a,l,r,`format ${i}`,e,c)}static fromString(e,i,r={}){return Li.fromFormat(e,i,r)}static fromSQL(e,i={}){const[r,n]=cat(e);return T3(r,n,i,"SQL",e)}static invalid(e,i=null){if(!e)throw new np("need to specify a reason the DateTime is invalid");const r=e instanceof Qf?e:new Qf(e,i);if(Io.throwOnInvalid)throw new Bst(r);return new Li({invalid:r})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,i={}){const r=fPe(e,cs.fromObject(i));return r?r.map(n=>n?n.val:null).join(""):null}static expandFormat(e,i={}){return dPe(Hl.parseFormat(e),cs.fromObject(i)).map(n=>n.val).join("")}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?VG(this).weekYear:NaN}get weekNumber(){return this.isValid?VG(this).weekNumber:NaN}get weekday(){return this.isValid?VG(this).weekday:NaN}get ordinal(){return this.isValid?kG(this.c).ordinal:NaN}get monthShort(){return this.isValid?d4.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?d4.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?d4.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?d4.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}get isInLeapYear(){return UN(this.year)}get daysInMonth(){return kV(this.year,this.month)}get daysInYear(){return this.isValid?U$(this.year):NaN}get weeksInWeekYear(){return this.isValid?UV(this.weekYear):NaN}resolvedLocaleOptions(e={}){const{locale:i,numberingSystem:r,calendar:n}=Hl.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:i,numberingSystem:r,outputCalendar:n}}toUTC(e=0,i={}){return this.setZone(Yl.instance(e),i)}toLocal(){return this.setZone(Io.defaultZone)}setZone(e,{keepLocalTime:i=!1,keepCalendarTime:r=!1}={}){if(e=J1(e,Io.defaultZone),e.equals(this.zone))return this;if(e.isValid){let n=this.ts;if(i||r){const s=e.offset(this.ts),o=this.toObject();[n]=rU(o,s,e)}return x3(this,{ts:n,zone:e})}else return Li.invalid(p4(e))}reconfigure({locale:e,numberingSystem:i,outputCalendar:r}={}){const n=this.loc.clone({locale:e,numberingSystem:i,outputCalendar:r});return x3(this,{loc:n})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const i=VV(e,sme),r=!Er(i.weekYear)||!Er(i.weekNumber)||!Er(i.weekday),n=!Er(i.ordinal),s=!Er(i.year),o=!Er(i.month)||!Er(i.day),a=s||o,l=i.weekYear||i.weekNumber;if((a||n)&&l)throw new oI("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(o&&n)throw new oI("Can't mix ordinal dates with month/day");let c;r?c=Qfe({...JK(this.c),...i}):Er(i.ordinal)?(c={...this.toObject(),...i},Er(i.day)&&(c.day=Math.min(kV(c.year,c.month),c.day))):c=eme({...kG(this.c),...i});const[h,p]=rU(c,this.o,this.zone);return x3(this,{ts:h,o:p})}plus(e){if(!this.isValid)return this;const i=Mr.fromDurationLike(e);return x3(this,rme(this,i))}minus(e){if(!this.isValid)return this;const i=Mr.fromDurationLike(e).negate();return x3(this,rme(this,i))}startOf(e){if(!this.isValid)return this;const i={},r=Mr.normalizeUnit(e);switch(r){case"years":i.month=1;case"quarters":case"months":i.day=1;case"weeks":case"days":i.hour=0;case"hours":i.minute=0;case"minutes":i.second=0;case"seconds":i.millisecond=0;break}if(r==="weeks"&&(i.weekday=1),r==="quarters"){const n=Math.ceil(this.month/3);i.month=(n-1)*3+1}return this.set(i)}endOf(e){return this.isValid?this.plus({[e]:1}).startOf(e).minus(1):this}toFormat(e,i={}){return this.isValid?Hl.create(this.loc.redefaultToEN(i)).formatDateTimeFromString(this,e):UG}toLocaleString(e=FV,i={}){return this.isValid?Hl.create(this.loc.clone(i),e).formatDateTime(this):UG}toLocaleParts(e={}){return this.isValid?Hl.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:i=!1,suppressMilliseconds:r=!1,includeOffset:n=!0,extendedZone:s=!1}={}){if(!this.isValid)return null;const o=e==="extended";let a=zG(this,o);return a+="T",a+=nme(this,o,i,r,n,s),a}toISODate({format:e="extended"}={}){return this.isValid?zG(this,e==="extended"):null}toISOWeekDate(){return f4(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:i=!1,includeOffset:r=!0,includePrefix:n=!1,extendedZone:s=!1,format:o="extended"}={}){return this.isValid?(n?"T":"")+nme(this,o==="extended",i,e,r,s):null}toRFC2822(){return f4(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return f4(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?zG(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:i=!1,includeOffsetSpace:r=!0}={}){let n="HH:mm:ss.SSS";return(i||e)&&(r&&(n+=" "),i?n+="z":e&&(n+="ZZ")),f4(this,n,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():UG}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const i={...this.c};return e.includeConfig&&(i.outputCalendar=this.outputCalendar,i.numberingSystem=this.loc.numberingSystem,i.locale=this.loc.locale),i}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,i="milliseconds",r={}){if(!this.isValid||!e.isValid)return Mr.invalid("created by diffing an invalid DateTime");const n={locale:this.locale,numberingSystem:this.numberingSystem,...r},s=dot(i).map(Mr.normalizeUnit),o=e.valueOf()>this.valueOf(),a=o?this:e,l=o?e:this,c=vat(a,l,s,n);return o?c.negate():c}diffNow(e="milliseconds",i={}){return this.diff(Li.now(),e,i)}until(e){return this.isValid?zs.fromDateTimes(this,e):this}hasSame(e,i){if(!this.isValid)return!1;const r=e.valueOf(),n=this.setZone(e.zone,{keepLocalTime:!0});return n.startOf(i)<=r&&r<=n.endOf(i)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const i=e.base||Li.fromObject({},{zone:this.zone}),r=e.padding?this<i?-e.padding:e.padding:0;let n=["years","months","days","hours","minutes","seconds"],s=e.unit;return Array.isArray(e.unit)&&(n=e.unit,s=void 0),ame(i,this.plus(r),{...e,numeric:"always",units:n,unit:s})}toRelativeCalendar(e={}){return this.isValid?ame(e.base||Li.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(Li.isDateTime))throw new np("min requires all arguments be DateTimes");return qfe(e,i=>i.valueOf(),Math.min)}static max(...e){if(!e.every(Li.isDateTime))throw new np("max requires all arguments be DateTimes");return qfe(e,i=>i.valueOf(),Math.max)}static fromFormatExplain(e,i,r={}){const{locale:n=null,numberingSystem:s=null}=r,o=cs.fromOpts({locale:n,numberingSystem:s,defaultToEN:!0});return pPe(o,e,i)}static fromStringExplain(e,i,r={}){return Li.fromFormatExplain(e,i,r)}static get DATE_SHORT(){return FV}static get DATE_MED(){return A3e}static get DATE_MED_WITH_WEEKDAY(){return Hst}static get DATE_FULL(){return R3e}static get DATE_HUGE(){return M3e}static get TIME_SIMPLE(){return O3e}static get TIME_WITH_SECONDS(){return P3e}static get TIME_WITH_SHORT_OFFSET(){return I3e}static get TIME_WITH_LONG_OFFSET(){return $3e}static get TIME_24_SIMPLE(){return L3e}static get TIME_24_WITH_SECONDS(){return D3e}static get TIME_24_WITH_SHORT_OFFSET(){return N3e}static get TIME_24_WITH_LONG_OFFSET(){return F3e}static get DATETIME_SHORT(){return k3e}static get DATETIME_SHORT_WITH_SECONDS(){return U3e}static get DATETIME_MED(){return V3e}static get DATETIME_MED_WITH_SECONDS(){return z3e}static get DATETIME_MED_WITH_WEEKDAY(){return qst}static get DATETIME_FULL(){return B3e}static get DATETIME_FULL_WITH_SECONDS(){return j3e}static get DATETIME_HUGE(){return G3e}static get DATETIME_HUGE_WITH_SECONDS(){return H3e}}function S3(t){if(Li.isDateTime(t))return t;if(t&&t.valueOf&&FS(t.valueOf()))return Li.fromJSDate(t);if(t&&typeof t=="object")return Li.fromObject(t);throw new np(`Unknown datetime argument: ${t}, of type ${typeof t}`)}function zat(t,e="system"){if(!t||!Ffe.has(t.timeZone))return e;const i=Ffe.get(t.timeZone);return jat(t.timeZone)||t.respectsDaylightSaving?i:Bat(i)}function Bat(t){const e=Li.local().setZone(t),i=Math.min(e.set({month:1,day:1}).offset,e.set({month:5}).offset);return i===0?"Etc/UTC":`Etc/GMT${Yl.instance(-i).formatOffset(0,"narrow")}`}function jat(t){return t.startsWith("UTC")}let p1=class extends xr(fe){constructor(e){super(e),this.legacy=null,this.timeZone="system"}readLegacy(e,i){const{timeZone:r,respectsDaylightSaving:n}=i;return{timeZone:r,respectsDaylightSaving:n}}readTimeZone(e,i){return"timeZoneIANA"in i?i.timeZoneIANA:zat(i)}writeTimeZone(e,i){i.timeZoneIANA=e}equals(e){return!(R(e)||R(this.timeZone)||R(e.timeZone))&&this.timeZone===e.timeZone}};u([d()],p1.prototype,"legacy",void 0),u([Oe("legacy",["timeZone"])],p1.prototype,"readLegacy",null),u([d({type:String,nonNullable:!0})],p1.prototype,"timeZone",void 0),u([Oe("timeZone",["timeZone","timeZoneIANA","respectsDaylightSaving"])],p1.prototype,"readTimeZone",null),u([Ne("timeZone")],p1.prototype,"writeTimeZone",null),p1=u([$("esri.time.TimeReference")],p1);const kM=p1;let f0=class extends xr(fe){constructor(e){super(e),this.creatorField=null,this.creationDateField=null,this.editorField=null,this.editDateField=null,this.realm=null,this.dateFieldsTimeReference=null}};u([d()],f0.prototype,"creatorField",void 0),u([d()],f0.prototype,"creationDateField",void 0),u([d()],f0.prototype,"editorField",void 0),u([d()],f0.prototype,"editDateField",void 0),u([d()],f0.prototype,"realm",void 0),u([d({type:kM})],f0.prototype,"dateFieldsTimeReference",void 0),f0=u([$("esri.layers.support.EditFieldsInfo")],f0);const Gat=f0;let Rg=class extends xr(fe){constructor(e){super(e)}};u([d({constructOnly:!0,json:{write:!0}})],Rg.prototype,"name",void 0),u([d({constructOnly:!0,json:{write:!0}})],Rg.prototype,"fields",void 0),u([d({constructOnly:!0,json:{write:!0}})],Rg.prototype,"isAscending",void 0),u([d({constructOnly:!0,json:{write:!0}})],Rg.prototype,"indexType",void 0),u([d({constructOnly:!0,json:{write:!0}})],Rg.prototype,"isUnique",void 0),u([d({constructOnly:!0,json:{write:!0}})],Rg.prototype,"description",void 0),Rg=u([$("esri.layers.support.FeatureIndex")],Rg);const KK=new mi({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function Hat(t,e,i,r){const n=await kw(t);if(await xoe(t,e,r),!n.addAttachment)throw new H(r,"Layer source does not support addAttachment capability");return n.addAttachment(e,i)}function xoe(t,e,i){const{attributes:r}=e,{objectIdField:n}=t;return t.get("capabilities.data.supportsAttachment")?e?r?n&&r[n]?Promise.resolve():Promise.reject(new H(i,`feature is missing the identifying attribute ${n}`)):Promise.reject(new H(i,"'attributes' are required on a feature to query attachments")):Promise.reject(new H(i,"A feature is required to add/delete/update attachments")):Promise.reject(new H(i,"this layer doesn't support attachments"))}async function qat(t,e,i,r,n){const s=await kw(t);if(await xoe(t,e,n),!s.updateAttachment)throw new H(n,"Layer source does not support updateAttachment capability");return s.updateAttachment(e,i,r)}async function Wat(t,e,i){const r=await Q(()=>import("./editingSupport-2a726b40.js"),["assets/editingSupport-2a726b40.js","assets/assetEditingSupport-2cebf928.js"]),n=await t.load();return r.applyEdits(n,n.source,e,i)}async function Xat(t,e,i,r){const n=await kw(t);if(await xoe(t,e,r),!n.deleteAttachments)throw new H(r,"Layer source does not support deleteAttachments capability");return n.deleteAttachments(e,i)}async function Yat(t,e,i){const r=(await t.load({signal:e==null?void 0:e.signal})).source;if(!r.fetchRecomputedExtents)throw new H(i,"Layer source does not support fetchUpdates capability");return r.fetchRecomputedExtents(e)}async function Zat(t,e,i,r){var m,g;e=SJ.from(e),await t.load();const n=t.source,s=t.capabilities;if(!((m=s==null?void 0:s.data)!=null&&m.supportsAttachment))throw new H(r,"this layer doesn't support attachments");const{attachmentTypes:o,objectIds:a,globalIds:l,num:c,size:h,start:p,where:f}=e;if(!((g=s==null?void 0:s.operations)!=null&&g.supportsQueryAttachments)&&((o==null?void 0:o.length)>0||(l==null?void 0:l.length)>0||(h==null?void 0:h.length)>0||c||p||f))throw new H(r,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",e);if(!(a!=null&&a.length||l!=null&&l.length||f))throw new H(r,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",e);if(!n.queryAttachments)throw new H(r,"Layer source does not support queryAttachments capability",e);return n.queryAttachments(e)}async function Jat(t,e,i,r){const n=await kw(t);if(!n.queryObjectIds)throw new H(r,"Layer source does not support queryObjectIds capability");return n.queryObjectIds(xp.from(e)??t.createQuery(),i)}async function Kat(t,e,i,r){const n=await kw(t);if(!n.queryFeatureCount)throw new H(r,"Layer source does not support queryFeatureCount capability");return n.queryFeatureCount(xp.from(e)??t.createQuery(),i)}async function Qat(t,e,i,r){const n=await kw(t);if(!n.queryExtent)throw new H(r,"Layer source does not support queryExtent capability");return n.queryExtent(xp.from(e)??t.createQuery(),i)}async function elt(t,e,i,r){const n=await kw(t);if(!n.queryRelatedFeatures)throw new H(r,"Layer source does not support queryRelatedFeatures capability");return n.queryRelatedFeatures($M.from(e),i)}async function tlt(t,e,i,r){const n=await kw(t);if(!n.queryRelatedFeaturesCount)throw new H(r,"Layer source does not support queryRelatedFeaturesCount capability");return n.queryRelatedFeaturesCount($M.from(e),i)}async function ilt(t){const e=t.source;if(e!=null&&e.refresh)try{const{dataChanged:i,updates:r}=await e.refresh();if(v(r)&&(t.sourceJSON={...t.sourceJSON,...r},t.read(r,{origin:"service",url:t.parsedUrl})),i)return!0}catch{}if(t.definitionExpression)try{return(await Hnt(t.definitionExpression,t.fieldsIndex)).hasDateFunctions}catch{}return!1}function rlt(t){const e=new xp,i=t.get("capabilities.data"),r=t.get("capabilities.query");e.historicMoment=t.historicMoment,e.gdbVersion=t.gdbVersion,e.returnGeometry=!0,r&&(e.compactGeometryEnabled=r.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=r.supportsDefaultSpatialReference),i&&(i.supportsZ&&t.returnZ!=null&&(e.returnZ=t.returnZ),i.supportsM&&t.returnM!=null&&(e.returnM=t.returnM)),e.outFields=["*"];const{timeOffset:n,timeExtent:s}=t;return e.timeExtent=n!=null&&s!=null?s.offset(-n.value,n.unit):s||null,e.multipatchOption=t.geometryType==="multipatch"?"xyFootprint":null,e}function EPe(t){const{globalIdField:e,fields:i}=t;if(e)return e;if(i){for(const r of i)if(r.type==="esriFieldTypeGlobalID")return r.name}}function CPe(t){const{objectIdField:e,fields:i}=t;if(e)return e;if(i){for(const r of i)if(r.type==="esriFieldTypeOID")return r.name}}function nlt(t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}async function kw(t){return(await t.load()).source}async function slt(t,e){if(!Ir||Ir.findCredential(t))return;let i;try{const r=await EMe(t,e);r&&(i=await Ir.checkSignInStatus(`${r}/sharing`))}catch{}if(i)try{const r=v(e)?e.signal:null;await Ir.getCredential(t,{signal:r})}catch{}}async function olt(t,e){var n;const i=(n=t.parsedUrl)==null?void 0:n.path;if(!i)return;const r=t.editFieldsInfo;(t.userHasUpdateItemPrivileges||t.userHasFullEditingPrivileges&&t.capabilities.operations.supportsEditing||r!=null&&r.creatorField||r!=null&&r.editorField)&&await slt(i,e)}function alt(t){var e;return!((e=t.sourceJSON)!=null&&e.isMultiServicesView)&&(t.userHasUpdateItemPrivileges||t.editingEnabled)}let WC=class extends xr(fe){constructor(e){super(e),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};u([d({type:String,json:{read:{source:"shapeAreaFieldName"}}})],WC.prototype,"shapeAreaField",void 0),u([d({type:String,json:{read:{source:"shapeLengthFieldName"}}})],WC.prototype,"shapeLengthField",void 0),u([d({type:String,json:{read:t=>_Ge.read(t)||vGe.read(t)}})],WC.prototype,"units",void 0),WC=u([$("esri.layers.support.GeometryFieldsInfo")],WC);const llt=WC;var QK;let XC=QK=class extends fe{constructor(t){super(t),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new tt}clone(){return new QK({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};u([d({type:String,json:{write:!0}})],XC.prototype,"floorField",void 0),u([d({json:{read:!1,write:!1}})],XC.prototype,"viewAllMode",void 0),u([d({json:{read:!1,write:!1}})],XC.prototype,"viewAllLevelIds",void 0),XC=QK=u([$("esri.layers.support.LayerFloorInfo")],XC);const clt=XC,cme=new mi({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),ume=new mi({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let Nd=class extends xr(fe){constructor(e){super(e),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};u([d({json:{read:cme.read,write:cme.write}})],Nd.prototype,"cardinality",void 0),u([d({json:{read:!0,write:!0}})],Nd.prototype,"composite",void 0),u([d({json:{read:!0,write:!0}})],Nd.prototype,"id",void 0),u([d({json:{read:!0,write:!0}})],Nd.prototype,"keyField",void 0),u([d({json:{read:!0,write:!0}})],Nd.prototype,"keyFieldInRelationshipTable",void 0),u([d({json:{read:!0,write:!0}})],Nd.prototype,"name",void 0),u([d({json:{read:!0,write:!0}})],Nd.prototype,"relatedTableId",void 0),u([d({json:{read:!0,write:!0}})],Nd.prototype,"relationshipTableId",void 0),u([d({json:{read:ume.read,write:ume.write}})],Nd.prototype,"role",void 0),Nd=u([$("esri.layers.support.Relationship")],Nd);const ult=Nd,hlt={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"};function ii(t,e,i){return!!(t&&t.hasOwnProperty(e)?t[e]:i)}function m4(t,e,i){return t&&t.hasOwnProperty(e)?t[e]:i}function dlt(t){var i;const e=(i=t==null?void 0:t.supportedSpatialAggregationStatistics)==null?void 0:i.map(r=>r.toLowerCase());return{envelope:!!(e!=null&&e.includes("envelopeaggregate")),centroid:!!(e!=null&&e.includes("centroidaggregate")),convexHull:!!(e!=null&&e.includes("convexhullaggregate"))}}function BN(t,e){var r;const i=(r=t==null?void 0:t.supportedOperationsWithCacheHint)==null?void 0:r.map(n=>n.toLowerCase());return!!(i!=null&&i.includes(e.toLowerCase()))}function APe(t,e){return{analytics:plt(t),attachment:flt(t),data:mlt(t),metadata:glt(t),operations:ylt(t.capabilities,t,e),query:_lt(t,e),queryRelated:vlt(t),queryTopFeatures:blt(t),editing:wlt(t)}}function plt(t){return{supportsCacheHint:BN(t.advancedQueryCapabilities,"queryAnalytics")}}function flt(t){const e=t.attachmentProperties,i={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:BN(t.advancedQueryCapabilities,"queryAttachments"),supportsResize:ii(t,"supportsAttachmentsResizing",!1)};return e&&Array.isArray(e)&&e.forEach(r=>{const n=hlt[r.name];n&&(i[n]=!!r.isEnabled)}),i}function mlt(t){return{isVersioned:ii(t,"isDataVersioned",!1),supportsAttachment:ii(t,"hasAttachments",!1),supportsM:ii(t,"hasM",!1),supportsZ:ii(t,"hasZ",!1)}}function glt(t){return{supportsAdvancedFieldProperties:ii(t,"supportsFieldDescriptionProperty",!1)}}function ylt(t,e,i){const r=t?t.toLowerCase().split(",").map(f=>f.trim()):[],n=i?dw(i):null,s=r.includes(v(n)&&n.serverType==="MapServer"?"data":"query"),o=r.includes("editing")&&!e.datesInUnknownTimezone;let a=o&&r.includes("create"),l=o&&r.includes("delete"),c=o&&r.includes("update");const h=r.includes("changetracking"),p=e.advancedQueryCapabilities;return o&&!(a||l||c)&&(a=l=c=!0),{supportsCalculate:ii(e,"supportsCalculate",!1),supportsTruncate:ii(e,"supportsTruncate",!1),supportsValidateSql:ii(e,"supportsValidateSql",!1),supportsAdd:a,supportsDelete:l,supportsEditing:o,supportsChangeTracking:h,supportsQuery:s,supportsQueryAnalytics:ii(p,"supportsQueryAnalytic",!1),supportsQueryAttachments:ii(p,"supportsQueryAttachments",!1),supportsQueryTopFeatures:ii(p,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:ii(e,"supportsAttachmentsResizing",!1),supportsSync:r.includes("sync"),supportsUpdate:c,supportsExceedsLimitStatistics:ii(e,"supportsExceedsLimitStatistics",!1)}}function _lt(t,e){const i=t.advancedQueryCapabilities,r=t.ownershipBasedAccessControlForFeatures,n=t.archivingInfo,s=t.currentVersion,o=e==null?void 0:e.includes("MapServer"),a=!o||s>=ue("mapserver-pbf-version-support"),l=v3e(e),c=new Set((t.supportedQueryFormats??"").split(",").map(h=>h.toLowerCase().trim()));return{supportsStatistics:ii(i,"supportsStatistics",t.supportsStatistics),supportsPercentileStatistics:ii(i,"supportsPercentileStatistics",!1),supportsSpatialAggregationStatistics:ii(i,"supportsSpatialAggregationStatistics",!1),supportedSpatialAggregationStatistics:dlt(i),supportsCentroid:ii(i,"supportsReturningGeometryCentroid",!1),supportsDistance:ii(i,"supportsQueryWithDistance",!1),supportsDistinct:ii(i,"supportsDistinct",t.supportsAdvancedQueries),supportsExtent:ii(i,"supportsReturningQueryExtent",!1),supportsGeometryProperties:ii(i,"supportsReturningGeometryProperties",!1),supportsHavingClause:ii(i,"supportsHavingClause",!1),supportsOrderBy:ii(i,"supportsOrderBy",t.supportsAdvancedQueries),supportsPagination:ii(i,"supportsPagination",!1),supportsQuantization:ii(t,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:ii(t,"supportsQuantizationEditMode",!1),supportsQueryGeometry:ii(t,"supportsReturningQueryGeometry",!1),supportsResultType:ii(i,"supportsQueryWithResultType",!1),supportsMaxRecordCountFactor:ii(i,"supportsMaxRecordCountFactor",!1),supportsSqlExpression:ii(i,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:ii(t,"useStandardizedQueries",!1),supportsTopFeaturesQuery:ii(i,"supportsTopFeaturesQuery",!1),supportsQueryByOthers:ii(r,"allowOthersToQuery",!0),supportsHistoricMoment:ii(n,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:a&&c.has("pbf"),supportsDisjointSpatialRelationship:ii(i,"supportsDisjointSpatialRel",!1),supportsCacheHint:ii(i,"supportsQueryWithCacheHint",!1)||BN(i,"query"),supportsDefaultSpatialReference:ii(i,"supportsDefaultSR",!1),supportsCompactGeometry:l,supportsFullTextSearch:ii(i,"supportsFullTextSearch",!1),maxRecordCountFactor:m4(t,"maxRecordCountFactor",void 0),maxRecordCount:m4(t,"maxRecordCount",void 0),standardMaxRecordCount:m4(t,"standardMaxRecordCount",void 0),tileMaxRecordCount:m4(t,"tileMaxRecordCount",void 0)}}function vlt(t){const e=t.advancedQueryCapabilities,i=ii(e,"supportsAdvancedQueryRelated",!1);return{supportsPagination:ii(e,"supportsQueryRelatedPagination",!1),supportsCount:i,supportsOrderBy:i,supportsCacheHint:BN(e,"queryRelated")}}function blt(t){return{supportsCacheHint:BN(t.advancedQueryCapabilities,"queryTopFilter")}}function wlt(t){const e=t.ownershipBasedAccessControlForFeatures;return{supportsGeometryUpdate:ii(t,"allowGeometryUpdates",!0),supportsGlobalId:ii(t,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:ii(t,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:ii(t,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:ii(t,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:ii(t,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:ii(e,"allowAnonymousToDelete",!0),supportsDeleteByOthers:ii(e,"allowOthersToDelete",!0),supportsUpdateByAnonymous:ii(e,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:ii(e,"allowOthersToUpdate",!0)}}const xlt=t=>{let e=class extends t{constructor(){super(...arguments),this.capabilities=null,this.copyright=null,this.dateFieldsTimeReference=null,this.datesInUnknownTimezone=!1,this.displayField=null,this.definitionExpression=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.floorInfo=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.isTable=!1,this.layerId=void 0,this.minScale=0,this.maxScale=0,this.globalIdField=null,this.objectIdField=null,this.preferredTimeReference=null,this.relationships=null,this.sourceJSON=null,this.returnM=void 0,this.returnZ=void 0,this.serviceDefinitionExpression=null,this.serviceItemId=null,this.spatialReference=Je.WGS84,this.subtypeField=null,this.trackIdField=null,this.indexes=new(tt.ofType(Rg)),this.version=void 0}readCapabilitiesFromService(i,r){return APe(r,this.url)}get effectiveCapabilities(){var o;const i=this.capabilities;if(!i)return null;const r=se(i),{operations:n,editing:s}=r;return(o=this.sourceJSON)!=null&&o.isMultiServicesView?(this.userHasUpdateItemPrivileges&&(n.supportsQuery=!0),r):this.userHasUpdateItemPrivileges?(n.supportsAdd=n.supportsDelete=n.supportsEditing=n.supportsQuery=n.supportsUpdate=s.supportsDeleteByOthers=s.supportsGeometryUpdate=s.supportsUpdateByOthers=!0,r):(this.userHasFullEditingPrivileges&&n.supportsEditing&&(n.supportsAdd=n.supportsDelete=n.supportsUpdate=s.supportsGeometryUpdate=!0),r)}readEditingInfo(i,r){const{editingInfo:n}=r;return n?{lastEditDate:n.lastEditDate!=null?new Date(n.lastEditDate):null}:null}readIsTableFromService(i,r){return r.type==="Table"}readMinScale(i,r){return r.effectiveMinScale||i||0}readMaxScale(i,r){return r.effectiveMaxScale||i||0}readGlobalIdFieldFromService(i,r){return EPe(r)}readObjectIdFieldFromService(i,r){return CPe(r)}readServiceDefinitionExpression(i,r){return r.definitionQuery||r.definitionExpression}set url(i){const r=yst({layer:this,url:i,nonStandardUrlAllowed:!0,logger:re.getLogger(this.declaredClass)});this._set("url",r.url),r.layerId!=null&&this._set("layerId",r.layerId)}writeUrl(i,r,n,s){_st(this,i,null,r,s)}readVersion(i,r){return nlt(r)}};return u([d({readOnly:!0,json:{read:!1,origins:{service:{read:{source:["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"]}}}}})],e.prototype,"capabilities",void 0),u([Oe("service","capabilities")],e.prototype,"readCapabilitiesFromService",null),u([d({readOnly:!0})],e.prototype,"effectiveCapabilities",null),u([d({type:String,json:{origins:{service:{read:{source:"copyrightText"}}}}})],e.prototype,"copyright",void 0),u([d({type:kM})],e.prototype,"dateFieldsTimeReference",void 0),u([d({type:Boolean})],e.prototype,"datesInUnknownTimezone",void 0),u([d({type:String,json:{origins:{service:{read:{source:"displayField"}}}}})],e.prototype,"displayField",void 0),u([d({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],e.prototype,"definitionExpression",void 0),u([d({readOnly:!0,type:Gat})],e.prototype,"editFieldsInfo",void 0),u([d({readOnly:!0})],e.prototype,"editingInfo",void 0),u([Oe("editingInfo")],e.prototype,"readEditingInfo",null),u([d((()=>{const i=se(Fst),r=i.json.origins;return r["web-map"]={read:!1,write:!1},r["portal-item"]={read:!1,write:!1},i})())],e.prototype,"elevationInfo",void 0),u([d({type:clt,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],e.prototype,"floorInfo",void 0),u([d({type:ni,json:{origins:{service:{read:{source:"extent"}}}}})],e.prototype,"fullExtent",void 0),u([d()],e.prototype,"gdbVersion",void 0),u([d({readOnly:!0,type:llt,json:{read:{source:"geometryProperties"}}})],e.prototype,"geometryFieldsInfo",void 0),u([d({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:KK.read}}}})],e.prototype,"geometryType",void 0),u([d({type:Boolean,json:{origins:{service:{read:!0}}}})],e.prototype,"hasM",void 0),u([d({type:Boolean,json:{origins:{service:{read:!0}}}})],e.prototype,"hasZ",void 0),u([d({readOnly:!0,type:OO})],e.prototype,"heightModelInfo",void 0),u([d({type:Date})],e.prototype,"historicMoment",void 0),u([d({readOnly:!0})],e.prototype,"isTable",void 0),u([Oe("service","isTable",["type"])],e.prototype,"readIsTableFromService",null),u([d({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],e.prototype,"layerId",void 0),u([d(Vst)],e.prototype,"minScale",void 0),u([Oe("service","minScale",["minScale","effectiveMinScale"])],e.prototype,"readMinScale",null),u([d(zst)],e.prototype,"maxScale",void 0),u([Oe("service","maxScale",["maxScale","effectiveMaxScale"])],e.prototype,"readMaxScale",null),u([d({type:String})],e.prototype,"globalIdField",void 0),u([Oe("service","globalIdField",["globalIdField","fields"])],e.prototype,"readGlobalIdFieldFromService",null),u([d({type:String})],e.prototype,"objectIdField",void 0),u([Oe("service","objectIdField",["objectIdField","fields"])],e.prototype,"readObjectIdFieldFromService",null),u([d({type:kM})],e.prototype,"preferredTimeReference",void 0),u([d({type:[ult],readOnly:!0})],e.prototype,"relationships",void 0),u([d()],e.prototype,"sourceJSON",void 0),u([d({type:Boolean})],e.prototype,"returnM",void 0),u([d({type:Boolean})],e.prototype,"returnZ",void 0),u([d({readOnly:!0})],e.prototype,"serviceDefinitionExpression",void 0),u([Oe("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],e.prototype,"readServiceDefinitionExpression",null),u([d({type:String,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],e.prototype,"serviceItemId",void 0),u([d({type:Je,json:{origins:{service:{read:{source:"extent.spatialReference"}}}}})],e.prototype,"spatialReference",void 0),u([d({type:String,readOnly:!0,json:{origins:{service:{read:!0}}}})],e.prototype,"subtypeField",void 0),u([d({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],e.prototype,"trackIdField",void 0),u([d({readOnly:!0,json:{write:!1}})],e.prototype,"serverGens",void 0),u([d({type:tt.ofType(Rg),readOnly:!0})],e.prototype,"indexes",void 0),u([d(Dst)],e.prototype,"url",null),u([Ne("url")],e.prototype,"writeUrl",null),u([d({json:{origins:{service:{read:!0}},read:!1}})],e.prototype,"version",void 0),u([Oe("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],e.prototype,"readVersion",null),e=u([$("esri.layers.mixins.FeatureLayerBase")],e),e};let YC=class extends xr(fe){constructor(e){super(e),this.expression=null,this.title=null,this.returnType=null}};u([d({type:String,json:{write:!0}})],YC.prototype,"expression",void 0),u([d({type:String,json:{write:!0}})],YC.prototype,"title",void 0),u([d({type:String,json:{write:!0}})],YC.prototype,"returnType",void 0),YC=u([$("esri.layers.support.ExpressionInfo")],YC);const Toe=YC;var eQ;let m0=eQ=class extends fe{constructor(t){super(t),this.isAutoGenerated=!1,this.name=null,this.alias=null,this.onStatisticField=null,this.onStatisticExpression=null,this.statisticType=null}clone(){return new eQ({name:this.name,alias:this.alias,isAutoGenerated:this.isAutoGenerated,onStatisticExpression:se(this.onStatisticExpression),onStatisticField:this.onStatisticField,statisticType:this.statisticType})}};u([d({type:Boolean,json:{write:!0}})],m0.prototype,"isAutoGenerated",void 0),u([d({type:String,json:{write:!0}})],m0.prototype,"name",void 0),u([d({type:String,json:{write:!0}})],m0.prototype,"alias",void 0),u([d({type:String,json:{write:!0}})],m0.prototype,"onStatisticField",void 0),u([d({type:Toe,json:{write:!0}})],m0.prototype,"onStatisticExpression",void 0),u([d({type:String,json:{write:!0}})],m0.prototype,"statisticType",void 0),m0=eQ=u([$("esri.layers.support.AggregateField")],m0);const g2=m0;let zb=class extends fe{constructor(){super(...arguments),this.type=null}};u([d({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],zb.prototype,"type",void 0),zb=u([$("esri.layers.support.FeatureReduction")],zb);const Soe="__begin__",Eoe="__end__",Tlt=new RegExp(Soe,"ig"),Slt=new RegExp(Eoe,"ig"),hme=new RegExp("^"+Soe,"i"),dme=new RegExp(Eoe+"$","i"),zV='"',Elt=zV+" + ",Clt=" + "+zV;function Alt(t){return t.replace(new RegExp("\\[","g"),"{").replace(new RegExp("\\]","g"),"}")}function Rlt(t){return t.replace(new RegExp("\\{","g"),"[").replace(new RegExp("\\}","g"),"]")}function PB(t){const e={expression:"",type:"none"};return t.labelExpressionInfo?t.labelExpressionInfo.value?(e.expression=t.labelExpressionInfo.value,e.type="conventional"):t.labelExpressionInfo.expression&&(e.expression=t.labelExpressionInfo.expression,e.type="arcade"):t.labelExpression!=null&&(e.expression=Alt(t.labelExpression),e.type="conventional"),e}function Mlt(t){const e=PB(t);if(!e)return null;switch(e.type){case"conventional":return tQ(e.expression);case"arcade":return e.expression}return null}function Olt(t){const e=PB(t);if(!e)return null;switch(e.type){case"conventional":return Ilt(e.expression);case"arcade":return Coe(e.expression)}return null}function tQ(t){let e;return t?(e=ay(t,i=>Soe+'$feature["'+i+'"]'+Eoe),e=hme.test(e)?e.replace(hme,""):zV+e,e=dme.test(e)?e.replace(dme,""):e+zV,e=e.replace(Tlt,Elt).replace(Slt,Clt)):e='""',e}const Plt=/^\s*\{([^}]+)\}\s*$/i;function Ilt(t){const e=t==null?void 0:t.match(Plt);return e&&e[1].trim()||null}const $lt=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,Llt=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,Dlt=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function Coe(t){if(!t)return null;let e=$lt.exec(t)||Llt.exec(t);return e?e[1]||e[3]:(e=Dlt.exec(t),e?e[2]:null)}var iQ;let f1=iQ=class extends fe{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(t,e){return e.value?tQ(e.value):t}writeExpression(t,e,i){this.value!=null&&(t=tQ(this.value)),t!=null&&(e[i]=t)}clone(){return new iQ({expression:this.expression,title:this.title,value:this.value})}};u([d({type:String,json:{write:{writerEnsuresNonNull:!0}}})],f1.prototype,"expression",void 0),u([Oe("expression",["expression","value"])],f1.prototype,"readExpression",null),u([Ne("expression")],f1.prototype,"writeExpression",null),u([d({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],f1.prototype,"title",void 0),u([d({json:{read:!1,write:!1}})],f1.prototype,"value",void 0),f1=iQ=u([$("esri.layers.support.LabelExpressionInfo")],f1);const RPe=f1,MPe=[252,146,31,255],HBt=[153,153,153,255],Nlt={type:"esriSMS",style:"esriSMSCircle",size:6,color:MPe,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},Flt={type:"esriSLS",style:"esriSLSSolid",width:.75,color:MPe},klt={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},Ult={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},Vlt={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},zlt={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},Blt={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null},qBt=Nw.fromJSON(Nlt),WBt=Vp.fromJSON(Flt),XBt=Dw.fromJSON(klt),jlt=xO.fromJSON(Ult),YBt=Nw.fromJSON(Vlt),ZBt=Vp.fromJSON(zlt),JBt=Dw.fromJSON(Blt);var rQ;const g4=new mi({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function y4(t,e,i){return{enabled:!TMe(i==null?void 0:i.layer)}}function OPe(t){var e;return!t||t.origin!=="service"&&((e=t.layer)==null?void 0:e.type)!=="map-image"}function Glt(t){return(t==null?void 0:t.type)==="map-image"}function PPe(t){var e,i;return!!Glt(t)&&!!((i=(e=t.capabilities)==null?void 0:e.exportMap)!=null&&i.supportsArcadeExpressionForLabeling)}function Hlt(t){return OPe(t)||PPe(t==null?void 0:t.layer)}let Ls=rQ=class extends fe{static evaluateWhere(t,e){const i=(r,n,s)=>{switch(n){case"=":return r==s;case"<>":return r!=s;case">":return r>s;case">=":return r>=s;case"<":return r<s;case"<=":return r<=s}return!1};try{if(t==null)return!0;const r=t.split(" ");if(r.length===3)return i(e[r[0]],r[1],r[2]);if(r.length===7){const n=i(e[r[0]],r[1],r[2]),s=r[3],o=i(e[r[4]],r[5],r[6]);switch(s){case"AND":return n&&o;case"OR":return n||o}}return!1}catch{console.log("Error.: can't parse = "+t)}}constructor(t){super(t),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=jlt,this.useCodedValues=void 0,this.where=null}readLabelExpression(t,e){const i=e.labelExpressionInfo;if(!i||!i.value&&!i.expression)return t}writeLabelExpression(t,e,i){if(this.labelExpressionInfo){if(this.labelExpressionInfo.value!=null)t=Rlt(this.labelExpressionInfo.value);else if(this.labelExpressionInfo.expression!=null){const r=Coe(this.labelExpressionInfo.expression);r&&(t="["+r+"]")}}t!=null&&(e[i]=t)}writeLabelExpressionInfo(t,e,i,r){if(t==null&&this.labelExpression!=null&&OPe(r))t=new RPe({expression:this.getLabelExpressionArcade()});else if(!t)return;const n=t.toJSON(r);n.expression&&(e[i]=n)}writeMaxScale(t,e){(t||this.minScale)&&(e.maxScale=t)}writeMinScale(t,e){(t||this.maxScale)&&(e.minScale=t)}getLabelExpression(){return PB(this)}getLabelExpressionArcade(){return Mlt(this)}getLabelExpressionSingleField(){return Olt(this)}hash(){return JSON.stringify(this)}clone(){return new rQ({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:se(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:se(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};u([d({type:String,json:{write:!0}})],Ls.prototype,"name",void 0),u([d({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1},"portal-item":{default:!1,write:{overridePolicy:y4}}}}})],Ls.prototype,"allowOverrun",void 0),u([d({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1},"portal-item":{default:"static",write:{overridePolicy:y4}}}}})],Ls.prototype,"deconflictionStrategy",void 0),u([d({type:String,json:{write:{overridePolicy(t,e,i){return this.labelExpressionInfo&&(i==null?void 0:i.origin)==="service"&&PPe(i.layer)?{enabled:!1}:{allowNull:!0}}}}})],Ls.prototype,"labelExpression",void 0),u([Oe("labelExpression")],Ls.prototype,"readLabelExpression",null),u([Ne("labelExpression")],Ls.prototype,"writeLabelExpression",null),u([d({type:RPe,json:{write:{overridePolicy:(t,e,i)=>Hlt(i)?{allowNull:!0}:{enabled:!1}}}})],Ls.prototype,"labelExpressionInfo",void 0),u([Ne("labelExpressionInfo")],Ls.prototype,"writeLabelExpressionInfo",null),u([d({type:g4.apiValues,json:{type:g4.jsonValues,read:g4.read,write:g4.write}})],Ls.prototype,"labelPlacement",void 0),u([d({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],Ls.prototype,"labelPosition",void 0),u([d({type:Number})],Ls.prototype,"maxScale",void 0),u([Ne("maxScale")],Ls.prototype,"writeMaxScale",null),u([d({type:Number})],Ls.prototype,"minScale",void 0),u([Ne("minScale")],Ls.prototype,"writeMinScale",null),u([d({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:y4}}}}})],Ls.prototype,"repeatLabel",void 0),u([d({type:Number,cast:vr,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:y4}}}}})],Ls.prototype,"repeatLabelDistance",void 0),u([d({types:sYe,json:{origins:{"web-scene":{types:oYe,write:hfe,default:null}},write:hfe,default:null}})],Ls.prototype,"symbol",void 0),u([d({type:Boolean,json:{write:!0}})],Ls.prototype,"useCodedValues",void 0),u([d({type:String,json:{write:!0}})],Ls.prototype,"where",void 0),Ls=rQ=u([$("esri.layers.support.LabelClass")],Ls);const IB=Ls;var nQ;const BG=Ow({types:iB}),qlt="esri.layers.support.FeatureReductionBinning";let bc=nQ=class extends zb{constructor(t){super(t),this.type="binning",this.binType="geohash",this.fixedBinLevel=3,this.labelingInfo=null,this.labelsVisible=!0,this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.fields=[],this.renderer=null}writeFields(t,e,i){const r=t.filter(n=>n.statisticType!=="avg_angle").map(n=>n.toJSON());va(i,r,e)}readRenderer(t,e,i){var n;const r=(n=e.drawingInfo)==null?void 0:n.renderer;return r?lD(r,e,i)??void 0:e.defaultSymbol?e.types&&e.types.length?new NN({defaultSymbol:BG(e.defaultSymbol,e,i),field:e.typeIdField,uniqueValueInfos:e.types.map(s=>({id:s.id,symbol:BG(s.symbol,s,i)}))}):new DM({symbol:BG(e.defaultSymbol,e,i)}):null}clone(){return new nQ({fields:se(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:se(this.labelingInfo),labelsVisible:this.labelsVisible,maxScale:this.maxScale,popupEnabled:this.popupEnabled,popupTemplate:se(this.popupTemplate),renderer:se(this.renderer)})}};u([ot({binning:"binning"})],bc.prototype,"type",void 0),u([ot({geohash:"geohash"})],bc.prototype,"binType",void 0),u([d({type:Number,range:{min:1,max:9},json:{write:!0}})],bc.prototype,"fixedBinLevel",void 0),u([d({type:[IB],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],bc.prototype,"labelingInfo",void 0),u([d(foe)],bc.prototype,"labelsVisible",void 0),u([d({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],bc.prototype,"maxScale",void 0),u([d(poe)],bc.prototype,"popupEnabled",void 0),u([d({type:vN,json:{name:"popupInfo",write:!0}})],bc.prototype,"popupTemplate",void 0),u([d({type:[g2],json:{write:!0}})],bc.prototype,"fields",void 0),u([Ne("fields")],bc.prototype,"writeFields",null),u([d({types:CB,json:{write:{target:"drawingInfo.renderer"}}})],bc.prototype,"renderer",void 0),u([Oe("renderer",["drawingInfo.renderer"])],bc.prototype,"readRenderer",null),bc=nQ=u([$(qlt)],bc);const IPe=bc;var sQ;const jG=Ow({types:iB}),Wlt="esri.layers.support.FeatureReductionCluster";function pme(t){var e;return t.type==="simple"&&!((e=t.visualVariables)!=null&&e.length)}let Eo=sQ=class extends fe{constructor(t){super(t),this.type="cluster",this.clusterRadius=vr("80px"),this.clusterMinSize=vr("12px"),this.clusterMaxSize=vr("50px"),this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=null}readRenderer(t,e,i){var n,s;const r=(n=e.drawingInfo)==null?void 0:n.renderer;return(s=r==null?void 0:r.authoringInfo)!=null&&s.isAutoGenerated?null:r?pme(r)?null:lD(r,e,i)??void 0:e.defaultSymbol?e.types&&e.types.length?new NN({defaultSymbol:jG(e.defaultSymbol,e,i),field:e.typeIdField,uniqueValueInfos:e.types.map(o=>({id:o.id,symbol:jG(o.symbol,o,i)}))}):new DM({symbol:jG(e.defaultSymbol,e,i)}):null}readSymbol(t,e,i){var n,s,o;const r=(n=e.drawingInfo)==null?void 0:n.renderer;return(s=r==null?void 0:r.authoringInfo)!=null&&s.isAutoGenerated?null:r&&pme(r)?(o=lD(r,e,i))==null?void 0:o.symbol:null}writeSymbol(t,e,i,r){var s,o;const n=(o=(s=this.renderer)==null?void 0:s.authoringInfo)==null?void 0:o.isAutoGenerated;if(!this.renderer||n){const a=new DM({symbol:t});e.drawingInfo={renderer:a.write({},r)}}}writeFields(t,e,i){const r=t.filter(n=>n.statisticType!=="avg_angle").map(n=>n.toJSON());va(i,r,e)}readFields(t,e,i){return t.filter(r=>!r.isAutoGenerated).map(r=>g2.fromJSON(r))}clone(){return new sQ({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:se(this.labelingInfo),labelsVisible:this.labelsVisible,fields:se(this.fields),maxScale:this.maxScale,renderer:se(this.renderer),symbol:se(this.symbol),popupEnabled:this.popupEnabled,popupTemplate:se(this.popupTemplate)})}};u([d({type:["cluster"],readOnly:!0,json:{write:!0}})],Eo.prototype,"type",void 0),u([d({type:Number,cast:t=>t==="auto"?t:vr(t),json:{write:!0}})],Eo.prototype,"clusterRadius",void 0),u([d({type:Number,cast:vr,json:{write:!0}})],Eo.prototype,"clusterMinSize",void 0),u([d({type:Number,cast:vr,json:{write:!0}})],Eo.prototype,"clusterMaxSize",void 0),u([d({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],Eo.prototype,"maxScale",void 0),u([d(poe)],Eo.prototype,"popupEnabled",void 0),u([d({type:vN,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],Eo.prototype,"popupTemplate",void 0),u([d({types:CB,json:{write:{target:"drawingInfo.renderer"}}})],Eo.prototype,"renderer",void 0),u([Oe("renderer",["drawingInfo.renderer"])],Eo.prototype,"readRenderer",null),u([d({types:rYe})],Eo.prototype,"symbol",void 0),u([Oe("symbol",["drawingInfo.renderer"])],Eo.prototype,"readSymbol",null),u([Ne("symbol")],Eo.prototype,"writeSymbol",null),u([d({type:[IB],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],Eo.prototype,"labelingInfo",void 0),u([d(foe)],Eo.prototype,"labelsVisible",void 0),u([d({type:[g2],json:{write:!0}})],Eo.prototype,"fields",void 0),u([Ne("fields")],Eo.prototype,"writeFields",null),u([Oe("fields")],Eo.prototype,"readFields",null),Eo=sQ=u([$(Wlt)],Eo);const $Pe=Eo;var oQ;let nU=oQ=class extends zb{constructor(t){super(t),this.type="selection"}clone(){return new oQ}};u([d({type:["selection"]})],nU.prototype,"type",void 0),nU=oQ=u([$("esri.layers.support.FeatureReductionSelection")],nU);const fme=nU,mme={key:"type",base:zb,typeMap:{cluster:$Pe,binning:IPe}},Xlt={types:{key:"type",base:zb,typeMap:{selection:fme,cluster:$Pe,binning:IPe}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:mme},"portal-item":{types:mme},"web-scene":{types:{key:"type",base:zb,typeMap:{selection:fme}}}}}},lE={Base64:0,Hex:1,String:2,Raw:3},kR=8,LPe=(1<<kR)-1;function wb(t,e){const i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i}function Ylt(t){const e=[];for(let i=0,r=t.length*kR;i<r;i+=kR)e[i>>5]|=(t.charCodeAt(i/kR)&LPe)<<i%32;return e}function Zlt(t){const e=[];for(let i=0,r=32*t.length;i<r;i+=kR)e.push(String.fromCharCode(t[i>>5]>>>i%32&LPe));return e.join("")}function Jlt(t){const e="0123456789abcdef",i=[];for(let r=0,n=4*t.length;r<n;r++)i.push(e.charAt(t[r>>2]>>r%4*8+4&15)+e.charAt(t[r>>2]>>r%4*8&15));return i.join("")}function Klt(t){const e="=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=[];for(let n=0,s=4*t.length;n<s;n+=3){const o=(t[n>>2]>>n%4*8&255)<<16|(t[n+1>>2]>>(n+1)%4*8&255)<<8|t[n+2>>2]>>(n+2)%4*8&255;for(let a=0;a<4;a++)8*n+6*a>32*t.length?r.push(e):r.push(i.charAt(o>>6*(3-a)&63))}return r.join("")}function Qlt(t,e){return t<<e|t>>>32-e}function $B(t,e,i,r,n,s){return wb(Qlt(wb(wb(e,t),wb(r,s)),n),i)}function El(t,e,i,r,n,s,o){return $B(e&i|~e&r,t,e,n,s,o)}function Cl(t,e,i,r,n,s,o){return $B(e&r|i&~r,t,e,n,s,o)}function Al(t,e,i,r,n,s,o){return $B(e^i^r,t,e,n,s,o)}function Rl(t,e,i,r,n,s,o){return $B(i^(e|~r),t,e,n,s,o)}function ect(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;let i=1732584193,r=-271733879,n=-1732584194,s=271733878;for(let o=0;o<t.length;o+=16){const a=i,l=r,c=n,h=s;i=El(i,r,n,s,t[o+0],7,-680876936),s=El(s,i,r,n,t[o+1],12,-389564586),n=El(n,s,i,r,t[o+2],17,606105819),r=El(r,n,s,i,t[o+3],22,-1044525330),i=El(i,r,n,s,t[o+4],7,-176418897),s=El(s,i,r,n,t[o+5],12,1200080426),n=El(n,s,i,r,t[o+6],17,-1473231341),r=El(r,n,s,i,t[o+7],22,-45705983),i=El(i,r,n,s,t[o+8],7,1770035416),s=El(s,i,r,n,t[o+9],12,-1958414417),n=El(n,s,i,r,t[o+10],17,-42063),r=El(r,n,s,i,t[o+11],22,-1990404162),i=El(i,r,n,s,t[o+12],7,1804603682),s=El(s,i,r,n,t[o+13],12,-40341101),n=El(n,s,i,r,t[o+14],17,-1502002290),r=El(r,n,s,i,t[o+15],22,1236535329),i=Cl(i,r,n,s,t[o+1],5,-165796510),s=Cl(s,i,r,n,t[o+6],9,-1069501632),n=Cl(n,s,i,r,t[o+11],14,643717713),r=Cl(r,n,s,i,t[o+0],20,-373897302),i=Cl(i,r,n,s,t[o+5],5,-701558691),s=Cl(s,i,r,n,t[o+10],9,38016083),n=Cl(n,s,i,r,t[o+15],14,-660478335),r=Cl(r,n,s,i,t[o+4],20,-405537848),i=Cl(i,r,n,s,t[o+9],5,568446438),s=Cl(s,i,r,n,t[o+14],9,-1019803690),n=Cl(n,s,i,r,t[o+3],14,-187363961),r=Cl(r,n,s,i,t[o+8],20,1163531501),i=Cl(i,r,n,s,t[o+13],5,-1444681467),s=Cl(s,i,r,n,t[o+2],9,-51403784),n=Cl(n,s,i,r,t[o+7],14,1735328473),r=Cl(r,n,s,i,t[o+12],20,-1926607734),i=Al(i,r,n,s,t[o+5],4,-378558),s=Al(s,i,r,n,t[o+8],11,-2022574463),n=Al(n,s,i,r,t[o+11],16,1839030562),r=Al(r,n,s,i,t[o+14],23,-35309556),i=Al(i,r,n,s,t[o+1],4,-1530992060),s=Al(s,i,r,n,t[o+4],11,1272893353),n=Al(n,s,i,r,t[o+7],16,-155497632),r=Al(r,n,s,i,t[o+10],23,-1094730640),i=Al(i,r,n,s,t[o+13],4,681279174),s=Al(s,i,r,n,t[o+0],11,-358537222),n=Al(n,s,i,r,t[o+3],16,-722521979),r=Al(r,n,s,i,t[o+6],23,76029189),i=Al(i,r,n,s,t[o+9],4,-640364487),s=Al(s,i,r,n,t[o+12],11,-421815835),n=Al(n,s,i,r,t[o+15],16,530742520),r=Al(r,n,s,i,t[o+2],23,-995338651),i=Rl(i,r,n,s,t[o+0],6,-198630844),s=Rl(s,i,r,n,t[o+7],10,1126891415),n=Rl(n,s,i,r,t[o+14],15,-1416354905),r=Rl(r,n,s,i,t[o+5],21,-57434055),i=Rl(i,r,n,s,t[o+12],6,1700485571),s=Rl(s,i,r,n,t[o+3],10,-1894986606),n=Rl(n,s,i,r,t[o+10],15,-1051523),r=Rl(r,n,s,i,t[o+1],21,-2054922799),i=Rl(i,r,n,s,t[o+8],6,1873313359),s=Rl(s,i,r,n,t[o+15],10,-30611744),n=Rl(n,s,i,r,t[o+6],15,-1560198380),r=Rl(r,n,s,i,t[o+13],21,1309151649),i=Rl(i,r,n,s,t[o+4],6,-145523070),s=Rl(s,i,r,n,t[o+11],10,-1120210379),n=Rl(n,s,i,r,t[o+2],15,718787259),r=Rl(r,n,s,i,t[o+9],21,-343485551),i=wb(i,a),r=wb(r,l),n=wb(n,c),s=wb(s,h)}return[i,r,n,s]}function DPe(t,e=lE.Hex){const i=e||lE.Base64,r=ect(Ylt(t),t.length*kR);switch(i){case lE.Raw:return r;case lE.Hex:return Jlt(r);case lE.String:return Zlt(r);case lE.Base64:return Klt(r)}}var aQ;let lI=aQ=class extends EB{writeLevels(t,e,i){for(const r in t){const n=this.levels[r];return void(e.stops=n)}}clone(){return new aQ({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:bb(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:bb(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(t=>t.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone(),levels:se(this.levels)})}};u([d()],lI.prototype,"levels",void 0),u([Ne("levels")],lI.prototype,"writeLevels",null),lI=aQ=u([$("esri.views.2d.engine.LevelDependentSizeVariable")],lI);const tct=re.getLogger("esri.views.2d.layers.support.clusterUtils");ue.add("esri-cluster-arcade-enabled",!0);const ict=ue("esri-cluster-arcade-enabled"),rct=(t,e,i,r,n)=>{const s=e.clone();if(!sct(s))return s;if(s.authoringInfo||(s.authoringInfo=new roe),s.authoringInfo.isAutoGenerated=!0,"visualVariables"in s){const o=(s.visualVariables||[]).filter(l=>l.valueExpression!=="$view.scale"),a=NPe(o);o.forEach(l=>{l.type==="rotation"?l.field?l.field=Jw(t,l.field,"avg_angle","number"):l.valueExpression&&(l.field=E3(t,l.valueExpression,"avg_angle","number"),l.valueExpression=null):l.normalizationField?(l.field=Jw(t,l.field,"avg_norm","number",l.normalizationField),l.normalizationField=null):l.field?l.field=Jw(t,l.field,"avg","number"):l.valueExpression&&(l.field=E3(t,l.valueExpression,"avg","number"),l.valueExpression=null)}),R(a)&&!nct(o)&&n&&(o.push(FPe(i,r)),s.dynamicClusterSize=!0),s.visualVariables=o}switch(s.type){case"simple":break;case"pie-chart":for(const o of s.attributes)o.field?o.field=Jw(t,o.field,"sum","number"):o.valueExpression&&(o.field=E3(t,o.valueExpression,"sum","number"),o.valueExpression=null);break;case"unique-value":s.field?s.field=Jw(t,s.field,"mode","string"):s.valueExpression&&(s.field=E3(t,s.valueExpression,"mode","string"),s.valueExpression=null);break;case"class-breaks":s.normalizationField?(s.field=Jw(t,s.field,"avg_norm","number",s.normalizationField),s.normalizationField=null):s.field?s.field=Jw(t,s.field,"avg","number"):s.valueExpression&&(s.field=E3(t,s.valueExpression,"avg","number"),s.valueExpression=null)}return s},NPe=t=>{for(const e of t)if(e.type==="size")return e;return null};function KBt(t,e,i){const r=t.clone();let n=!1;if("visualVariables"in r){const s=(r.visualVariables||[]).filter(a=>a.valueExpression!=="$view.scale"),o=NPe(s);R(o)&&(r.visualVariables||(r.visualVariables=[]),r.visualVariables.push(FPe(e,i)),r.dynamicClusterSize=!0,n=!0)}return{renderer:r,didInject:n}}const nct=t=>{for(const e of t)if(e.field==="cluster_count")return!0;return!1},FPe=(t,e)=>{const i=[new zC({value:0,size:0}),new zC({value:1})];if(R(e))return new EB({field:"cluster_count",stops:[...i,new zC({value:2,size:0})]});const r=Object.keys(e).reduce((n,s)=>({...n,[s]:[...i,new zC({value:Math.max(2,e[s].minValue),size:t.clusterMinSize}),new zC({value:Math.max(3,e[s].maxValue),size:t.clusterMaxSize})]}),{});return new lI({field:"cluster_count",levels:r})},sct=t=>{const e=i=>tct.error(new H("Unsupported-renderer",i,{renderer:t}));switch(t.type){case"unique-value":if(t.field2||t.field3)return e("FeatureReductionCluster does not support multi-field UniqueValueRenderers"),!1;break;case"class-breaks":if(t.normalizationField){const i=t.normalizationType;if(i!=="field")return e(`FeatureReductionCluster does not support a normalizationType of ${i}`),!1}break;case"simple":case"pie-chart":break;default:return e(`FeatureReductionCluster does not support renderers of type ${t.type}`),!1}if(!ict){if("valueExpression"in t&&t.valueExpression)return e("FeatureReductionCluster does not currently support renderer.valueExpression. Support will be added in a future release"),!1;if(("visualVariables"in t&&t.visualVariables||[]).some(i=>!(!("valueExpression"in i)||!i.valueExpression)))return e("FeatureReductionCluster does not currently support visualVariables with a valueExpression. Support will be added in a future release"),!1}return!0};function oct(t,e,i){switch(t){case"sum":return`cluster_sum_${e}`;case"avg":case"avg_angle":return`cluster_avg_${e}`;case"mode":return`cluster_type_${e}`;case"avg_norm":{const r=i,n="field",s=e.toLowerCase()+",norm:"+n+","+r.toLowerCase();return"cluster_avg_"+DPe(s)}}}function E3(t,e,i,r){const n=DPe(e),s=i==="mode"?`cluster_type_${n}`:i==="sum"?`cluster_sum_${n}`:`cluster_avg_${n}`;return t.some(o=>o.name===s)||t.push(new g2({name:s,isAutoGenerated:!0,onStatisticExpression:new Toe({expression:e,returnType:r}),statisticType:i})),s}function Jw(t,e,i,r,n){if(e==="cluster_count"||t.some(o=>o.name===e))return e;const s=oct(i,e,n);return t.some(o=>o.name===s)||(i==="avg_norm"?t.push(new g2({name:s,isAutoGenerated:!0,onStatisticExpression:new Toe({expression:`$feature.${e} / $feature.${n}`,returnType:r}),statisticType:"avg"})):t.push(new g2({name:s,isAutoGenerated:!0,onStatisticField:e,statisticType:i}))),s}const act=t=>{let e=class extends t{constructor(...i){super(...i),this.own(this.watch("renderer",()=>{if(this.featureReduction){const r=this._normalizeFeatureReduction(this.featureReduction);this._set("featureReduction",r)}},!0))}set featureReduction(i){const r=this._normalizeFeatureReduction(i);this._set("featureReduction",r)}set renderer(i){}_normalizeFeatureReduction(i){var a;if((i==null?void 0:i.type)!=="cluster")return i;const r=i.clone(),n=[new g2({name:"cluster_count",isAutoGenerated:!0,statisticType:"count"})],s=(r.fields??[]).filter(l=>!l.isAutoGenerated);if(i.renderer&&!((a=i.renderer.authoringInfo)!=null&&a.isAutoGenerated))return r.fields=[...n,...s],r;if(i.symbol)return r.fields=[...n,...s],r.renderer=null,r;if(!this.renderer)return i;const o=rct(n,this.renderer,i,null,!1);return r.fields=[...n,...s],r.renderer=o,r}};return u([d(Xlt)],e.prototype,"featureReduction",null),e=u([$("esri.layers.mixins.FeatureReductionLayer")],e),e},lct={"web-scene/operational-layers":{ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,GroupLayer:!0,IntegratedMeshLayer:!0,OGCFeatureLayer:!0,PointCloudLayer:!0,WebTiledLayer:!0,CSV:!0,GeoJSON:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,KML:!0,RasterDataLayer:!0,Voxel:!0,LineOfSightLayer:!0},"web-scene/basemap":{ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,WebTiledLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,ArcGISImageServiceLayer:!0,WMS:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-map/operational-layers":{ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CSV:!0,GeoRSS:!0,GeoJSON:!0,GroupLayer:!0,KML:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},"web-map/basemap":{ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0,BingMapsAerial:!0,BingMapsRoad:!0,BingMapsHybrid:!0},"web-map/tables":{ArcGISFeatureLayer:!0},"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISSceneServiceLayer:!0,PointCloudLayer:!0,BuildingSceneLayer:!0,IntegratedMeshLayer:!0,OrientedImageryLayer:!0}},kPe=t=>{let e=class extends t{constructor(){super(...arguments),this.title=null}writeListMode(i,r,n,s){(s&&s.layerContainerType==="ground"||i&&Yje(this,n,{},s))&&(r[n]=i)}writeOperationalLayerType(i,r,n,s){!i||s&&s.layerContainerType==="tables"||(r.layerType=i)}writeTitle(i,r){r.title=i??"Layer"}read(i,r){r&&(r.layer=this),I2e(this,i,n=>super.read(i,n),r)}write(i,r){var o,a;if(r!=null&&r.origin){const l=`${r.origin}/${r.layerContainerType||"operational-layers"}`,c=lct[l];let h=c&&c[this.operationalLayerType];if(this.operationalLayerType==="ArcGISTiledElevationServiceLayer"&&l==="web-scene/operational-layers"&&(h=!1),this.operationalLayerType==="ArcGISDimensionLayer"&&l==="web-map/operational-layers"&&(h=!1),!h)return(o=r.messages)==null||o.push(new H("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${l}'`,{layer:this})),null}const n=super.write(i,{...r,layer:this}),s=!!r&&!!r.messages&&!!r.messages.filter(l=>l instanceof H&&l.name==="web-document-write:property-required").length;return tw(n==null?void 0:n.url)?((a=r==null?void 0:r.messages)==null||a.push(new H("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&s?null:n}beforeSave(){}};return u([d({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],e.prototype,"id",void 0),u([d(E3e)],e.prototype,"listMode",void 0),u([Ne("listMode")],e.prototype,"writeListMode",null),u([d({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1}}}})],e.prototype,"operationalLayerType",void 0),u([Ne("operationalLayerType")],e.prototype,"writeOperationalLayerType",null),u([d(HK)],e.prototype,"opacity",void 0),u([d({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],e.prototype,"title",void 0),u([Ne("title"),Ne(["web-scene"],"title")],e.prototype,"writeTitle",null),u([d({type:Boolean,json:{name:"visibility"}})],e.prototype,"visible",void 0),e=u([$("esri.layers.mixins.OperationalLayer")],e),e};var lQ;const GG=new mi({asc:"ascending",desc:"descending"});let ZC=lQ=class extends fe{constructor(t){super(t),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new lQ({field:this.field,valueExpression:this.valueExpression,order:this.order})}};u([d({type:String,json:{write:!0}})],ZC.prototype,"field",void 0),u([d({type:String,json:{write:!0}})],ZC.prototype,"valueExpression",void 0),u([d({type:GG.apiValues,json:{read:GG.read,write:GG.write}})],ZC.prototype,"order",void 0),ZC=lQ=u([$("esri.layers.support.OrderByInfo")],ZC);const UPe=ZC;function cct(t,e,i){if(!t)return null;const r=t.find(s=>!!s.field);if(!r)return null;const n=new UPe;return n.read(r,i),[n]}function uct(t,e,i,r){const n=t.find(s=>!!s.field);n&&va(i,[n.toJSON()],e)}const hct=t=>{let e=class extends t{constructor(){super(...arguments),this.orderBy=null}};return u([d({type:[UPe],json:{origins:{"web-scene":{write:!1,read:!1}},read:{source:"layerDefinition.orderBy",reader:cct},write:{target:"layerDefinition.orderBy",writer:uct}}})],e.prototype,"orderBy",void 0),e=u([$("esri.layers.mixins.OrderedLayer")],e),e};let m1=class extends ve{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e&&e.portalItem&&e.path?{...e,path:this._normalizePath(e.path,e.portalItem)}:e}set path(e){v(e)&&Wu(e)?re.getLogger(this.declaredClass).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return this._normalizePath(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",i){const r=this.url;if(R(r))throw new H("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(r,{responseType:e,query:{token:this.portalItem.apiKey},signal:Js(i,"signal")})}async update(e,i){return(await Q(()=>import("./resourceUtils-04f3e5fb.js"),[])).addOrUpdateResource(this,"update",e,i)}hasPath(){return v(this.path)}_normalizePath(e,i){return R(e)?e:(e=e.replace(/^\/+/,""),v(i)&&Wu(e)&&(e=qne(e,i.itemUrl)),e==null?void 0:e.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}};u([d()],m1.prototype,"portalItem",void 0),u([d({type:String,value:null})],m1.prototype,"path",null),u([ri("path")],m1.prototype,"_castPath",null),u([d({type:String,readOnly:!0})],m1.prototype,"url",null),u([d({type:String,readOnly:!0})],m1.prototype,"itemRelativeUrl",null),m1=u([$("esri.portal.PortalItemResource")],m1);const dct=m1;let cI=class extends ve{constructor(e){super(e),this.created=null,this.rating=null}};u([d()],cI.prototype,"created",void 0),u([d()],cI.prototype,"rating",void 0),cI=u([$("esri.portal.PortalRating")],cI);const HG=cI;var gT;const pct=new Set(["Map Service","Feature Service","Feature Collection","Scene Service","Image Service","Stream Service","Vector Tile Service","GeoJson","CSV","KML","WFS","WMTS","WMS","Feed"]),fct=new Set(["KML","GeoJson","CSV"]);let Ti=gT=class extends Pw(Ju){static from(t){return uM(gT,t)}constructor(t){super(t),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const t=this.type,e=this.typeKeywords||[];let i=t;return t==="Feature Service"||t==="Feature Collection"?i=e.includes("Table")?"Table":e.includes("Route Layer")?"Route Layer":e.includes("Markup")?"Markup":"Feature Layer":t==="Image Service"?i=e.includes("Elevation 3D Layer")?"Elevation Layer":e.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":t==="Scene Service"?i="Scene Layer":t==="Video Service"?i="Video Layer":t==="Scene Package"?i="Scene Layer Package":t==="Stream Service"?i="Feature Layer":t==="Geoprocessing Service"&&this.portal&&this.portal.isPortal?i=e.includes("Web Tool")?"Tool":"Geoprocessing Service":t==="Geocoding Service"?i="Locator":t==="Geoenrichment Service"?i="GeoEnrichment Service":t==="Microsoft Powerpoint"?i="Microsoft PowerPoint":t==="GeoJson"?i="GeoJSON":t==="Globe Service"?i="Globe Layer":t==="Vector Tile Service"?i="Tile Layer":t==="netCDF"?i="NetCDF":t==="Map Service"?i=e.includes("Spatiotemporal")||!e.includes("Hosted Service")&&!e.includes("Tiled")||e.includes("Relational")?"Map Image Layer":"Tile Layer":t&&t.toLowerCase().includes("add in")?i=t.replace(/(add in)/gi,"Add-In"):t==="datastore catalog service"?i="Big Data File Share":t==="Compact Tile Package"?i="Tile Package (tpkx)":t==="OGCFeatureServer"?i="OGC Feature Layer":t==="web mapping application"&&e.includes("configurableApp")?i="Instant App":t==="Insights Page"&&(i="Insights Report"),i}readExtent(t){return t&&t.length?new ni(t[0][0],t[0][1],t[1][0],t[1][1]):null}get iconUrl(){const t=this.type&&this.type.toLowerCase()||"",e=this.typeKeywords||[],i="esri/images/portal/",r="16";let n,s=!1,o=!1,a=!1,l=!1,c=!1,h=!1;return t.indexOf("service")>0||t==="feature collection"||t==="kml"||t==="wms"||t==="wmts"||t==="wfs"?(s=e.includes("Hosted Service"),t==="feature service"||t==="feature collection"||t==="kml"||t==="wfs"?(o=e.includes("Table"),a=e.includes("Route Layer"),l=e.includes("Markup"),c=e.includes("Spatiotemporal"),h=e.includes("UtilityNetwork"),n=c&&o?"spatiotemporaltable":o?"table":a?"routelayer":l?"markup":c?"spatiotemporal":s?"featureshosted":h?"utilitynetwork":"features"):n=t==="map service"||t==="wms"||t==="wmts"?s||e.includes("Tiled")||t==="wmts"?"maptiles":"mapimages":t==="scene service"?e.includes("Line")?"sceneweblayerline":e.includes("3DObject")?"sceneweblayermultipatch":e.includes("Point")?"sceneweblayerpoint":e.includes("IntegratedMesh")?"sceneweblayermesh":e.includes("PointCloud")?"sceneweblayerpointcloud":e.includes("Polygon")?"sceneweblayerpolygon":e.includes("Building")?"sceneweblayerbuilding":e.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":t==="image service"?e.includes("Elevation 3D Layer")?"elevationlayer":e.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":t==="stream service"?"streamlayer":t==="video service"?"mediaservice":t==="vector tile service"?"vectortile":t==="datastore catalog service"?"datastorecollection":t==="geocoding service"?"geocodeservice":t==="geoprocessing service"?e.includes("Web Tool")&&this.portal&&this.portal.isPortal?"tool":"layers":t==="geodata service"?"geodataservice":"layers"):n=t==="web map"||t==="cityengine web scene"?"maps":t==="web scene"?e.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":t==="web mapping application"&&e.includes("configurableApp")?"instantapps":t==="web mapping application"||t==="mobile application"||t==="application"||t==="operation view"||t==="desktop application"?"apps":t==="map document"||t==="map package"||t==="published map"||t==="scene document"||t==="globe document"||t==="basemap package"||t==="mobile basemap package"||t==="mobile map package"||t==="project package"||t==="project template"||t==="pro map"||t==="layout"||t==="layer"&&e.includes("ArcGIS Pro")||t==="explorer map"&&e.indexOf("Explorer Document")?"mapsgray":t==="service definition"||t==="csv"||t==="shapefile"||t==="cad drawing"||t==="geojson"||t==="360 vr experience"||t==="netcdf"||t==="administrative report"?"datafiles":t==="explorer add in"||t==="desktop add in"||t==="windows viewer add in"||t==="windows viewer configuration"?"appsgray":t==="arcgis pro add in"||t==="arcgis pro configuration"?"addindesktop":t==="rule package"||t==="file geodatabase"||t==="sqlite geodatabase"||t==="csv collection"||t==="kml collection"||t==="windows mobile package"||t==="map template"||t==="desktop application template"||t==="gml"||t==="arcpad package"||t==="code sample"||t==="form"||t==="document link"||t==="earth configuration"||t==="operations dashboard add in"||t==="rules package"||t==="image"||t==="workflow manager package"||t==="explorer map"&&e.includes("Explorer Mapping Application")||e.includes("Document")?"datafilesgray":t==="network analysis service"||t==="geoprocessing service"||t==="geodata service"||t==="geometry service"||t==="geoprocessing package"||t==="locator package"||t==="geoprocessing sample"||t==="workflow manager service"?"toolsgray":t==="layer"||t==="layer package"||t==="explorer layer"?"layersgray":t==="scene package"?"scenepackage":t==="mobile scene package"?"mobilescenepackage":t==="tile package"||t==="compact tile package"?"tilepackage":t==="task file"?"taskfile":t==="report template"?"report-template":t==="statistical data collection"?"statisticaldatacollection":t==="insights workbook"?"workbook":t==="insights model"?"insightsmodel":t==="insights page"?"insightspage":t==="insights theme"?"insightstheme":t==="hub initiative"?"hubinitiative":t==="hubpage"?"hubpage":t==="hub event"?"hubevent":t==="hub site application"?"hubsite":t==="hub project"?"hubproject":t==="relational database connection"?"relationaldatabaseconnection":t==="big data file share"?"datastorecollection":t==="image collection"?"imagecollection":t==="style"?"style":t==="desktop style"?"desktopstyle":t==="dashboard"?"dashboard":t==="raster function template"?"rasterprocessingtemplate":t==="vector tile package"?"vectortilepackage":t==="ortho mapping project"?"orthomappingproject":t==="ortho mapping template"?"orthomappingtemplate":t==="solution"?"solutions":t==="geopackage"?"geopackage":t==="deep learning package"?"deeplearningpackage":t==="real time analytic"?"realtimeanalytics":t==="big data analytic"?"bigdataanalytics":t==="feed"?"feed":t==="excalibur imagery project"?"excaliburimageryproject":t==="notebook"?"notebook":t==="storymap"?"storymap":t==="survey123 add in"?"survey123addin":t==="mission"?"mission":t==="mission report"?"missionreport":t==="quickcapture project"?"quickcaptureproject":t==="pro report"?"proreport":t==="pro report template"?"proreporttemplate":t==="urban model"?"urbanmodel":t==="web experience"?"experiencebuilder":t==="web experience template"?"webexperiencetemplate":t==="experience builder widget"?"experiencebuilderwidget":t==="experience builder widget package"?"experiencebuilderwidgetpackage":t==="workflow"?"workflow":t==="insights script"?"insightsscript":t==="kernel gateway connection"?"kernelgatewayconnection":t==="hub initiative template"?"hubinitiativetemplate":t==="storymap theme"?"storymaptheme":t==="knowledge graph"?"knowledgegraph":t==="native application"?"nativeapp":t==="native application installer"?"nativeappinstaller":t==="link chart"?"linkchart":t==="investigation"?"investigation":t==="ogcfeatureserver"?"features":t==="pro project"?"proproject":t==="insights workbook package"?"insightsworkbookpackage":t==="apache parquet"?"apacheparquet":t==="notebook code snippets"||t==="notebook code snippet library"?"notebookcodesnippets":t==="suitability model"?"suitabilitymodel":t==="esri classifier definition"?"classifierdefinition":t==="esri classification schema"?"classificationschema":t==="insights data engineering workbook"?"dataengineeringworkbook":t==="insights data engineering model"?"dataengineeringmodel":t==="deep learning studio project"?"deeplearningproject":t==="discussion"?"discussion":t==="allsource project"?"allsourceproject":t==="api key"?"apikey":"maps",n?ar(i+n+r+".png"):null}get isLayer(){return this.type!=null&&pct.has(this.type)}get itemPageUrl(){var e;const t=(e=this.portal)==null?void 0:e.itemPageUrl;return t&&this.id?`${t}?id=${this.id}`:null}get itemUrl(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t&&this.id?`${t}/content/items/${this.id}`:null}get thumbnailUrl(){var i;const t=this.itemUrl,e=this.thumbnail;return t&&e?((i=this.portal)==null?void 0:i.normalizeUrl(`${t}/info/${e}?f=json`))??null:null}get userItemUrl(){const t=this.get("portal.restUrl");if(!t)return null;const e=this.owner||this.get("portal.user.username");return e?`${t}/content/users/${this.ownerFolder?`${e}/${this.ownerFolder}`:e}/items/${this.id}`:null}load(t){const e=this.portal??(this.portal=ya.getDefault()),i=e.load(t).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?e.request(this.itemUrl,{signal:v(t)?t.signal:null,query:{token:this.apiKey}}):{}).then(r=>{this.sourceJSON=r,this.read(r)});return this.addResolvingPromise(i),Promise.resolve(this)}async addRating(t){const e={method:"post",query:{}};return t instanceof HG&&(t=t.rating),t==null||isNaN(t)||typeof t!="number"||(e.query.rating=t),this.portal?(await this.portal.request(this.itemUrl+"/addRating",e),new HG({rating:t,created:new Date})):null}clone(){const t={access:this.access,accessInformation:this.accessInformation,applicationProxies:se(this.applicationProxies),avgRating:this.avgRating,categories:se(this.categories),created:se(this.created),culture:this.culture,description:this.description,extent:se(this.extent),groupCategories:se(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:se(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:se(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:se(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:se(this.typeKeywords),url:this.url};this.loaded&&(t.loadStatus="loaded");const e=new gT({sourceJSON:this.sourceJSON}).set(t);return e._set("isOrgItem",this.isOrgItem),e}createPostQuery(){const t=this.toJSON();for(const i of["tags","typeKeywords","categories"])t[i]&&(t[i]=t[i].join(", "));const{extent:e}=t;return e&&(t.extent=JSON.stringify(e)),t}async deleteRating(){await Nc(this.portal).request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(t="json",e){return Nc(this.portal).request(this.itemUrl+"/data",{responseType:t,...e,query:{token:this.apiKey}})}async fetchRating(t){const e=await Nc(this.portal).request(this.itemUrl+"/rating",{query:{token:this.apiKey},...t});return e.rating!=null?(e.created=new Date(e.created),new HG(e)):null}fetchRelatedItems(t,e){return Nc(this.portal).requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...t,token:this.apiKey},...e},gT)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}reload(){return Nc(this.portal).request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then(t=>(this.sourceJSON=t,this.read(t),this))}update(t){return this.id?this.load().then(()=>Nc(this.portal).signIn()).then(()=>{const e=t&&t.data,i={method:"post"};i.query=this.createPostQuery();for(const r in i.query)i.query[r]===null&&(i.query[r]="");return i.query.clearEmptyFields=!0,e!=null&&(typeof e=="string"?i.query.text=e:typeof e=="object"&&(i.query.text=JSON.stringify(e))),this.portal.request(`${this.userItemUrl}/update`,i).then(()=>this.reload())}):Promise.reject(new H("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(t){if(!this.id)throw new H("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:e,itemUrl:i}=this;await Nc(e).signIn();const{copyResources:r,folder:n,tags:s,title:o}=t||{},a={method:"post",query:{copyPrivateResources:r==="all",folder:typeof n=="string"?n:n==null?void 0:n.id,includeResources:!!r,tags:s==null?void 0:s.join(","),title:o}},{itemId:l}=await e.request(`${i}/copy`,a);return new gT({id:l,portal:e})}updateThumbnail(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t.thumbnail,i=t.filename,r={method:"post"};if(typeof e=="string")fd(e)?r.query={data:e}:r.query={url:zc(e)},v(i)&&(r.query.filename=i);else{const n=new FormData;v(i)?n.append("file",e,i):n.append("file",e),r.body=n}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,r).then(()=>this.reload())}):Promise.reject(new H("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(t={},e){return(await Q(()=>import("./resourceUtils-04f3e5fb.js"),[])).fetchResources(this,t,e)}async addResource(t,e,i){const r=await Q(()=>import("./resourceUtils-04f3e5fb.js"),[]);return t.portalItem=this,r.addOrUpdateResource(t,"add",e,i)}async removeResource(t,e){const i=await Q(()=>import("./resourceUtils-04f3e5fb.js"),[]);if(t.portalItem&&t.portalItem.itemUrl!==this.itemUrl)throw new H("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return i.removeResource(this,t,e)}async removeAllResources(t){return(await Q(()=>import("./resourceUtils-04f3e5fb.js"),[])).removeAllResources(this,t)}resourceFromPath(t){return new dct({portalItem:this,path:t})}toJSON(){const t=this.extent,e={accessInformation:this.accessInformation,categories:se(this.categories),created:this.created&&this.created.getTime(),description:this.description,extent:t&&[[t.xmin,t.ymin],[t.xmax,t.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:this.modified&&this.modified.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:se(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:se(this.typeKeywords),url:this.url};return OSe(e)}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new gT({sourceJSON:t})}_getPostQuery(){const t=this.toJSON();for(const e in t)e==="tags"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="typeKeywords"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="extent"&&t[e]&&(t[e]=JSON.stringify(t[e]));return t}};u([d({type:["private","shared","org","public"]})],Ti.prototype,"access",void 0),u([d()],Ti.prototype,"accessInformation",void 0),u([d({type:String})],Ti.prototype,"apiKey",void 0),u([d({json:{read:{source:"appProxies"}}})],Ti.prototype,"applicationProxies",void 0),u([d()],Ti.prototype,"avgRating",void 0),u([d()],Ti.prototype,"categories",void 0),u([d({type:Date})],Ti.prototype,"created",void 0),u([d()],Ti.prototype,"culture",void 0),u([d()],Ti.prototype,"description",void 0),u([d({readOnly:!0})],Ti.prototype,"displayName",null),u([d({type:ni})],Ti.prototype,"extent",void 0),u([Oe("extent")],Ti.prototype,"readExtent",null),u([d()],Ti.prototype,"groupCategories",void 0),u([d({readOnly:!0})],Ti.prototype,"iconUrl",null),u([d()],Ti.prototype,"id",void 0),u([d({readOnly:!0})],Ti.prototype,"isLayer",null),u([d({type:Boolean,readOnly:!0})],Ti.prototype,"isOrgItem",void 0),u([d()],Ti.prototype,"itemControl",void 0),u([d({readOnly:!0})],Ti.prototype,"itemPageUrl",null),u([d({readOnly:!0})],Ti.prototype,"itemUrl",null),u([d()],Ti.prototype,"licenseInfo",void 0),u([d({type:Date})],Ti.prototype,"modified",void 0),u([d()],Ti.prototype,"name",void 0),u([d()],Ti.prototype,"numComments",void 0),u([d()],Ti.prototype,"numRatings",void 0),u([d()],Ti.prototype,"numViews",void 0),u([d()],Ti.prototype,"owner",void 0),u([d()],Ti.prototype,"ownerFolder",void 0),u([d({type:ya})],Ti.prototype,"portal",void 0),u([d()],Ti.prototype,"screenshots",void 0),u([d()],Ti.prototype,"size",void 0),u([d()],Ti.prototype,"snippet",void 0),u([d()],Ti.prototype,"sourceJSON",void 0),u([d({type:String})],Ti.prototype,"sourceUrl",void 0),u([d({type:String})],Ti.prototype,"spatialReference",void 0),u([d()],Ti.prototype,"tags",void 0),u([d()],Ti.prototype,"thumbnail",void 0),u([d({readOnly:!0})],Ti.prototype,"thumbnailUrl",null),u([d()],Ti.prototype,"title",void 0),u([d()],Ti.prototype,"type",void 0),u([d()],Ti.prototype,"typeKeywords",void 0),u([d({type:String,json:{read(t,e){var i;if(fct.has(e.type)){const r=(i=this.portal)==null?void 0:i.restUrl;t||(t=r&&this.id?`${r}/content/items/${this.id}/data`:null)}return t}}})],Ti.prototype,"url",void 0),u([d({readOnly:!0})],Ti.prototype,"userItemUrl",null),Ti=gT=u([$("esri.portal.PortalItem")],Ti);const l_=Ti,VPe=Object.freeze(Object.defineProperty({__proto__:null,default:l_},Symbol.toStringTag,{value:"Module"}));async function mct(t){const e=t.spatialReference;if(e.isWGS84)return t.clone();if(e.isWebMercator)return mS(t);const i=Je.WGS84;return await WAe(e,i),Sm(t,i)}function cE(t,e){if(!JC(t,e)){const i=t.typeKeywords;i?i.push(e):t.typeKeywords=[e]}}function JC(t,e){var i;return!!((i=t.typeKeywords)!=null&&i.includes(e))}function lh(t,e){const i=t.typeKeywords;if(i){const r=i.indexOf(e);r>-1&&i.splice(r,1)}}async function t7t(t){const e=t.clone().normalize();let i;if(e.length>1)for(const r of e)i?r.width>i.width&&(i=r):i=r;else i=e[0];return mct(i)}const Aoe={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table"};function gme(t){var l;const{portal:e,isOrgItem:i,itemControl:r}=t,n=(l=e.user)==null?void 0:l.privileges;let s=!n||n.includes("features:user:edit"),o=!!i&&!!(n!=null&&n.includes("features:user:fullEdit"));const a=r==="update"||r==="admin";return a?o=s=!0:o&&(s=!0),{features:{edit:s,fullEdit:o},content:{updateItem:a}}}const gct=t=>{let e=class extends t{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=Ve(this.portalItem)}set portalItem(i){i!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",i))}readPortalItem(i,r,n){if(r.itemId)return new l_({id:r.itemId,portal:n&&n.portal})}writePortalItem(i,r){i&&i.id&&(r.itemId=i.id)}async loadFromPortal(i,r){if(this.portalItem&&this.portalItem.id)try{const n=await Q(()=>import("./layersLoader-2d63a9c9.js"),["assets/layersLoader-2d63a9c9.js","assets/fetchService-990f8c03.js","assets/jsonContext-7f6e363e.js"]);return ui(r),await n.load({instance:this,supportedTypes:i.supportedTypes,validateItem:i.validateItem,supportsData:i.supportsData,layerModuleTypeMap:i.layerModuleTypeMap},r)}catch(n){throw gs(n)||re.getLogger(this.declaredClass).warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})
  ${n}`),n}}async finishLoadEditablePortalLayer(i){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(i).catch(r=>(Du(r),!0)))}async _setUserPrivileges(i,r){if(!nr.userPrivilegesApplied)return this.finishLoadEditablePortalLayer(r);if(this.url)try{const{features:{edit:n,fullEdit:s},content:{updateItem:o}}=await this._fetchUserPrivileges(i,r);this._set("userHasEditingPrivileges",n),this._set("userHasFullEditingPrivileges",s),this._set("userHasUpdateItemPrivileges",o)}catch(n){Du(n)}}async _fetchUserPrivileges(i,r){let n=this.portalItem;if(!i||!n||!n.loaded||n.sourceUrl)return this._fetchFallbackUserPrivileges(r);const s=i===n.id;if(s&&n.portal.user)return gme(n);let o,a;if(s)o=n.portal.url;else try{o=await EMe(this.url,r)}catch(p){Du(p)}if(!o||!ZWe(o,n.portal.url))return this._fetchFallbackUserPrivileges(r);try{const p=v(r)?r.signal:null;a=await(Ir==null?void 0:Ir.getCredential(`${o}/sharing`,{prompt:!1,signal:p}))}catch(p){Du(p)}const l=!0,c=!1,h=!1;if(!a)return{features:{edit:l,fullEdit:c},content:{updateItem:h}};try{if(s?await n.reload():(n=new l_({id:i,portal:{url:o}}),await n.load(r)),n.portal.user)return gme(n)}catch(p){Du(p)}return{features:{edit:l,fullEdit:c},content:{updateItem:h}}}async _fetchFallbackUserPrivileges(i){let r=!0;try{r=await this._fetchUserHasEditingPrivileges(i)}catch(n){Du(n)}return{features:{edit:r,fullEdit:!1},content:{updateItem:!1}}}async _fetchUserHasEditingPrivileges(i){const r=this.url?Ir==null?void 0:Ir.findCredential(this.url):null;if(!r)return!0;const n=_4.credential===r?_4.user:await this._fetchEditingUser(i);return _4.credential=r,_4.user=n,R(n)||n.privileges==null||n.privileges.includes("features:user:edit")}async _fetchEditingUser(i){var h,p;const r=(p=(h=this.portalItem)==null?void 0:h.portal)==null?void 0:p.user;if(r)return r;const n=Ir.findServerInfo(this.url??"");if(!(n!=null&&n.owningSystemUrl))return null;const s=`${n.owningSystemUrl}/sharing/rest`,o=ya.getDefault();if(o&&o.loaded&&am(o.restUrl)===am(s))return o.user;const a=`${s}/community/self`,l=v(i)?i.signal:null,c=await _m(ir(a,{authMode:"no-prompt",query:{f:"json"},signal:l}));return c.ok?ese.fromJSON(c.value.data):null}read(i,r){r&&(r.layer=this),super.read(i,r)}write(i,r){const n=r&&r.portal,s=this.portalItem&&this.portalItem.id&&(this.portalItem.portal||ya.getDefault());return n&&s&&!FCe(s.restUrl,n.restUrl)?(r.messages&&r.messages.push(new H("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(i,{...r,layer:this})}};return u([d({type:l_})],e.prototype,"portalItem",null),u([Oe("web-document","portalItem",["itemId"])],e.prototype,"readPortalItem",null),u([Ne("web-document","portalItem",{itemId:{type:String}})],e.prototype,"writePortalItem",null),u([d({clonable:!1})],e.prototype,"resourceReferences",void 0),u([d({type:Boolean,readOnly:!0})],e.prototype,"userHasEditingPrivileges",void 0),u([d({type:Boolean,readOnly:!0})],e.prototype,"userHasFullEditingPrivileges",void 0),u([d({type:Boolean,readOnly:!0})],e.prototype,"userHasUpdateItemPrivileges",void 0),e=u([$("esri.layers.mixins.PortalLayer")],e),e},_4={credential:null,user:null};let uI=class extends ve{constructor(){super(...arguments),this.updating=!1,this.status="unknown"}};u([d()],uI.prototype,"updating",void 0),u([d()],uI.prototype,"status",void 0),uI=u([$("esri.layers.support.PublishingInfo")],uI);const yct=uI,zPe="esri.layers.mixins.PublishableLayer",_ct=Symbol(zPe),vct=t=>{var e;let i=class extends t{constructor(){super(...arguments),this[e]=!0}get publishingInfo(){if(this.destroyed)return null;const r=this._get("publishingInfo");if(r)return r;const n=new yct;return this._checkPublishingStatus(n),n}_checkPublishingStatus(r){let o=0;const a=async c=>{let h;r.updating=!0;try{h=await this.fetchPublishingStatus()}catch{h="unavailable"}h!=="published"&&h!=="unavailable"||(r.status==="publishing"&&this.refresh(),l.remove()),r.status=h,r.updating=!1,l.removed||(o=setTimeout(a,c,c+125))},l={removed:!1,remove(){this.removed=!0,clearTimeout(o)}};this.when().catch(()=>l.remove()),a(250),this.own(l)}};return e=_ct,u([d({readOnly:!0,clonable:!1})],i.prototype,"publishingInfo",null),i=u([$(zPe)],i),i},uD=new tt,z$=new WeakMap;function bct(t){BPe(t)&&uD.push(t)}function wct(t){BPe(t)&&uD.includes(t)&&uD.remove(t)}function BPe(t){return t!=null&&typeof t=="object"&&"refreshInterval"in t&&"refresh"in t}function jPe(t,e){return Number.isFinite(t)&&Number.isFinite(e)?e<=0?t:jPe(e,t%e):0}let qG=0,v4=0;function xct(){const t=Date.now();for(const e of uD)e.refreshInterval&&t-(z$.get(e)??0)+5>=6e4*e.refreshInterval&&(z$.set(e,t),e.refresh(t))}w2e(()=>{const t=Date.now();let e=0;for(const i of uD)e=jPe(Math.round(6e4*i.refreshInterval),e),i.refreshInterval?z$.get(i)||z$.set(i,t):z$.delete(i);if(e!==v4){if(v4=e,clearInterval(qG),v4===0)return void(qG=0);qG=setInterval(xct,v4)}});function Tct(t){return t!=null&&typeof t=="object"&&"refreshTimestamp"in t&&"refresh"in t}const Sct=t=>{let e=class extends t{constructor(...i){super(...i),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=f2e(()=>this.hasDataChanged()),this.when().then(()=>{bct(this)},()=>{})}destroy(){wct(this)}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(i=Date.now()){CR(this._debounceHasDataChanged()).then(r=>{r&&this._set("refreshTimestamp",i),this.emit("refresh",{dataChanged:r})},r=>{re.getLogger(this.declaredClass).error(r),this.emit("refresh",{dataChanged:!1,error:r})})}async hasDataChanged(){return!0}};return u([d({type:Number,cast:i=>i>=.1?i:i<=0?0:.1,json:{write:!0}})],e.prototype,"refreshInterval",void 0),u([d({readOnly:!0})],e.prototype,"refreshTimestamp",void 0),u([d()],e.prototype,"refreshParameters",null),e=u([$("esri.layers.mixins.RefreshableLayer")],e),e},GPe=t=>{let e=class extends t{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const i={minScale:this.minScale,maxScale:this.maxScale},r=this.parent;r&&"effectiveScaleRange"in r&&Ect(i,r.effectiveScaleRange);const n=this._get("effectiveScaleRange");return n&&n.minScale===i.minScale&&n.maxScale===i.maxScale?n:i}};return u([d({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"minScale",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"maxScale",void 0),u([d({readOnly:!0})],e.prototype,"effectiveScaleRange",null),e=u([$("esri.layers.mixins.ScaleRangeLayer")],e),e};function Ect(t,e){return t.minScale=t.minScale>0?e.minScale>0?Math.min(t.minScale,e.minScale):t.minScale:e.minScale,t.maxScale=t.maxScale>0?e.maxScale>0?Math.max(t.maxScale,e.maxScale):t.maxScale:e.maxScale,t}const HPe=Wa()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0});let hI=class extends xr(fe){constructor(e){super(e),this.unit="milliseconds",this.value=0}toMilliseconds(){return Git(this.value,this.unit,"milliseconds")}};u([ot(HPe,{nonNullable:!0})],hI.prototype,"unit",void 0),u([d({type:Number,json:{write:!0},nonNullable:!0})],hI.prototype,"value",void 0),hI=u([$("esri.TimeInterval")],hI);const UM=hI;function yme(t,e){return UM.fromJSON({value:t,unit:e})}let Dl=class extends xr(fe){constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeReference=null,this.trackIdField=null,this.useTime=!0}readFullTimeExtent(e,i){if(!i.timeExtent||!Array.isArray(i.timeExtent)||i.timeExtent.length!==2)return null;const r=new Date(i.timeExtent[0]),n=new Date(i.timeExtent[1]);return new Zc({start:r,end:n})}writeFullTimeExtent(e,i){e&&v(e.start)&&v(e.end)?i.timeExtent=[e.start.getTime(),e.end.getTime()]:i.timeExtent=null}readInterval(e,i){return i.timeInterval&&i.timeIntervalUnits?yme(i.timeInterval,i.timeIntervalUnits):i.defaultTimeInterval&&i.defaultTimeIntervalUnits?yme(i.defaultTimeInterval,i.defaultTimeIntervalUnits):null}writeInterval(e,i){i.timeInterval=(e==null?void 0:e.toJSON().value)??null,i.timeIntervalUnits=(e==null?void 0:e.toJSON().unit)??null}};u([d({type:Boolean,json:{name:"exportOptions.timeDataCumulative",write:!0}})],Dl.prototype,"cumulative",void 0),u([d({type:String,json:{name:"endTimeField",write:{enabled:!0,allowNull:!0}}})],Dl.prototype,"endField",void 0),u([d({type:Zc,json:{write:{enabled:!0,allowNull:!0}}})],Dl.prototype,"fullTimeExtent",void 0),u([Oe("fullTimeExtent",["timeExtent"])],Dl.prototype,"readFullTimeExtent",null),u([Ne("fullTimeExtent")],Dl.prototype,"writeFullTimeExtent",null),u([d({type:Boolean,json:{write:!0}})],Dl.prototype,"hasLiveData",void 0),u([d({type:UM,json:{write:{enabled:!0,allowNull:!0}}})],Dl.prototype,"interval",void 0),u([Oe("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],Dl.prototype,"readInterval",null),u([Ne("interval")],Dl.prototype,"writeInterval",null),u([d({type:String,json:{name:"startTimeField",write:{enabled:!0,allowNull:!0}}})],Dl.prototype,"startField",void 0),u([d({type:kM,json:{write:{enabled:!0,allowNull:!0}}})],Dl.prototype,"timeReference",void 0),u([d({type:String,json:{write:{enabled:!0,allowNull:!0}}})],Dl.prototype,"trackIdField",void 0),u([d({type:Boolean,json:{name:"exportOptions.useTime",write:!0}})],Dl.prototype,"useTime",void 0),Dl=u([$("esri.layers.support.TimeInfo")],Dl);const qPe=Dl,Cct=t=>{let e=class extends t{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(i,r){const n=r.timeInfo.exportOptions;if(!n)return null;const s=n.timeOffset,o=HPe.fromJSON(n.timeOffsetUnits);return s&&o?new UM({value:s,unit:o}):null}set timeInfo(i){TEe(i,this.fieldsIndex),this._set("timeInfo",i)}};return u([d({type:Zc,json:{write:!1}})],e.prototype,"timeExtent",void 0),u([d({type:UM})],e.prototype,"timeOffset",void 0),u([Oe("service","timeOffset",["timeInfo.exportOptions"])],e.prototype,"readOffset",null),u([d({value:null,type:qPe,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],e.prototype,"timeInfo",null),u([d({type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation"},origins:{"web-scene":{read:!1,write:!1}}}})],e.prototype,"useViewTime",void 0),e=u([$("esri.layers.mixins.TemporalLayer")],e),e},_me=new mi({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let g1=class extends xr(fe){constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}};u([d({json:{write:!0}})],g1.prototype,"name",void 0),u([d({json:{write:!0}})],g1.prototype,"description",void 0),u([d({json:{read:_me.read,write:_me.write}})],g1.prototype,"drawingTool",void 0),u([d({json:{write:!0}})],g1.prototype,"prototype",void 0),u([d({json:{write:!0}})],g1.prototype,"thumbnail",void 0),g1=u([$("esri.layers.support.FeatureTemplate")],g1);const Roe=g1;let g0=class extends xr(fe){constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const i={};for(const r of Object.keys(e))i[r]=Gse(e[r]);return i}writeDomains(e,i){var n;const r={};for(const s of Object.keys(e))e[s]&&(r[s]=(n=e[s])==null?void 0:n.toJSON());i.domains=r}};u([d({json:{write:!0}})],g0.prototype,"id",void 0),u([d({json:{write:!0}})],g0.prototype,"name",void 0),u([d({json:{write:!0}})],g0.prototype,"domains",void 0),u([Oe("domains")],g0.prototype,"readDomains",null),u([Ne("domains")],g0.prototype,"writeDomains",null),u([d({type:[Roe],json:{write:!0}})],g0.prototype,"templates",void 0),g0=u([$("esri.layers.support.FeatureType")],g0);const WPe=g0;function Act(t){return t.type==="date"||t.type==="esriFieldTypeDate"}function vme(t){return t.type==="oid"||t.type==="esriFieldTypeOID"}function bme(t){return t.type==="global-id"||t.type==="esriFieldTypeGlobalID"}let Rct=class{constructor(e=[]){if(this.fields=[],this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this.dateFields=[],this.numericFields=[],this._requiredFields=null,!e)return;this.fields=e;const i=[];for(const r of e){const n=r==null?void 0:r.name,s=xme(r==null?void 0:r.name);if(n&&s){const o=wme(n);this._fieldsMap.set(n,r),this._fieldsMap.set(o,r),this._normalizedFieldsMap.set(s,r),i.push(o),Act(r)?(this.dateFields.push(r),this._dateFieldsSet.add(r)):N9(r)&&(this._numericFieldsSet.add(r),this.numericFields.push(r)),vme(r)||bme(r)||(r.editable=r.editable==null||!!r.editable,r.nullable=r.nullable==null||!!r.nullable)}}i.sort(),this.uid=i.join(",")}destroy(){this._fieldsMap.clear()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)vme(e)||bme(e)||e.nullable||PHe(e)!==void 0||this._requiredFields.push(e)}return this._requiredFields}has(e){return this.get(e)!=null}get(e){if(!e)return;let i=this._fieldsMap.get(e);return i||(i=this._fieldsMap.get(wme(e))??this._normalizedFieldsMap.get(xme(e)),i&&this._fieldsMap.set(e,i),i)}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){const i=this.get(e);if(i)return i.name??void 0}};function wme(t){return t.trim().toLowerCase()}function xme(t){var e;return((e=xHe(t))==null?void 0:e.toLowerCase())??""}function Mct(){return{fields:{type:[xB],value:null},fieldsIndex:{readOnly:!0,get(){return new Rct(this.fields||[])}},outFields:{type:[String],json:{read:!1},set:function(t){this._userOutFields=t,this.notifyChange("outFields")},get:function(){var e;const t=this._userOutFields;if(!t||!t.length)return null;if(t.includes("*"))return["*"];if(!this.fields)return t;for(const i of t)((e=this.fieldsIndex)==null?void 0:e.has(i))||re.getLogger("esri.layers.support.fieldProperties").error("field-attributes-layer:invalid-field",`Invalid field ${i} found in outFields`,{layer:this,outFields:t});return SEe(this.fieldsIndex,t)}}}}const WG=re.getLogger("esri.layers.support.labelingInfo"),Oct=/\[([^\[\]]+)\]/gi;function Tme(t,e,i){return t?t.map(r=>{const n=new IB;if(n.read(r,i),n.labelExpression){const s=e.fields||e.layerDefinition&&e.layerDefinition.fields||this.fields;n.labelExpression=n.labelExpression.replace(Oct,(o,a)=>`[${Pct(a,s)}]`)}return n}):null}function Pct(t,e){if(!e)return t;const i=t.toLowerCase();for(let r=0;r<e.length;r++){const n=e[r].name;if(n.toLowerCase()===i)return n}return t}const Ict={esriGeometryPoint:["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along"],esriGeometryMultipoint:null};function l7t(t,e){const i=se(t);return i.some(r=>$ct(r,e))?[]:i}function $ct(t,e){const i=t.labelPlacement,r=Ict[e];if(!t.symbol)return WG.warn("No ILabelClass symbol specified."),!0;if(!r)return WG.error(new H("labeling:unsupported-geometry-type",`Unable to create labels for layer, geometry type '${e}' is not supported`)),!0;if(!r.includes(i)){const n=r[0];i&&WG.warn(`Found invalid label placement type ${i} for ${e}. Defaulting to ${n}`),t.labelPlacement=n}return!1}const bf=[];function Lct(t,e){if(v3e(t.url??""))return!0;const{wkid:i}=e;for(const r of bf){if((t.version??0)>=r[0])return!0;if(typeof r[1]=="function"&&(r[1]=r[1]()),r[1].has(i))return!1}return!0}bf.push([10.91,()=>{const t=new Set([9709,9716,9741,9761,9766]);for(let e=9712;e<=9713;e++)t.add(e);for(let e=9748;e<=9749;e++)t.add(e);for(let e=20904;e<=20932;e++)t.add(e);for(let e=21004;e<=21032;e++)t.add(e);for(let e=21207;e<=21264;e++)t.add(e);for(let e=21307;e<=21364;e++)t.add(e);for(let e=102759;e<=102760;e++)t.add(e);for(let e=102901;e<=102955;e++)t.add(e);return t}]),bf.push([10.9,()=>{const t=new Set([9300,9354,9364,9367,9373,9377,9387,9456,9473,9498,9678,9680,29874,103599,103872,104028]);for(let e=9356;e<=9360;e++)t.add(e);for(let e=9404;e<=9407;e++)t.add(e);for(let e=9476;e<=9482;e++)t.add(e);for(let e=9487;e<=9494;e++)t.add(e);for(let e=9697;e<=9699;e++)t.add(e);return t}]),bf.push([10.81,()=>{const t=new Set([9265,9333,103598,103699]);for(let e=9248;e<=9254;e++)t.add(e);for(let e=9271;e<=9273;e++)t.add(e);for(let e=9284;e<=9285;e++)t.add(e);for(let e=21453;e<=21463;e++)t.add(e);return t}]),bf.push([10.8,()=>{const t=new Set([8088,8395,8428,8433,8531,8687,8692,8694,8699,8900,9003,9006,9009,9012,9017,9191]);for(let e=8035;e<=8036;e++)t.add(e);for(let e=8455;e<=8456;e++)t.add(e);for(let e=8518;e<=8529;e++)t.add(e);for(let e=8533;e<=8536;e++)t.add(e);for(let e=8538;e<=8540;e++)t.add(e);for(let e=8677;e<=8679;e++)t.add(e);for(let e=8902;e<=8903;e++)t.add(e);for(let e=8907;e<=8910;e++)t.add(e);for(let e=8949;e<=8951;e++)t.add(e);for(let e=8972;e<=8987;e++)t.add(e);for(let e=9039;e<=9040;e++)t.add(e);for(let e=9068;e<=9069;e++)t.add(e);for(let e=9140;e<=9141;e++)t.add(e);for(let e=9148;e<=9150;e++)t.add(e);for(let e=9153;e<=9159;e++)t.add(e);for(let e=9205;e<=9218;e++)t.add(e);for(let e=9221;e<=9222;e++)t.add(e);for(let e=54098;e<=54101;e++)t.add(e);return t}]),bf.push([10.71,()=>{const t=new Set([6316]);for(let e=8351;e<=8353;e++)t.add(e);for(let e=9294;e<=9297;e++)t.add(e);for(let e=22619;e<=22621;e++)t.add(e);for(let e=103586;e<=103594;e++)t.add(e);return t}]),bf.push([10.7,()=>{const t=new Set([8387,8391,8427,8545,8682,8685,8818,31370,104022,104024,104975]);for(let e=8065;e<=8068;e++)t.add(e);for(let e=8082;e<=8083;e++)t.add(e);for(let e=8379;e<=8385;e++)t.add(e);for(let e=8836;e<=8840;e++)t.add(e);for(let e=8857;e<=8860;e++)t.add(e);for(let e=53035;e<=53037;e++)t.add(e);for(let e=54090;e<=54091;e++)t.add(e);for(let e=102498;e<=102499;e++)t.add(e);return t}]),bf.push([10.61,()=>new Set([102497])]),bf.push([10.6,()=>{const t=new Set([7803,7805,7887,8086,8232,8237,8240,8246,8249,8252,8255,9019,9391]);for(let e=7755;e<=7787;e++)t.add(e);for(let e=7791;e<=7795;e++)t.add(e);for(let e=7799;e<=7801;e++)t.add(e);for(let e=7825;e<=7831;e++)t.add(e);for(let e=7877;e<=7878;e++)t.add(e);for(let e=7882;e<=7883;e++)t.add(e);for(let e=7991;e<=7992;e++)t.add(e);for(let e=8042;e<=8043;e++)t.add(e);for(let e=8058;e<=8059;e++)t.add(e);for(let e=8311;e<=8348;e++)t.add(e);for(let e=9060;e<=9067;e++)t.add(e);for(let e=102562;e<=102568;e++)t.add(e);for(let e=102799;e<=102900;e++)t.add(e);return t}]),bf.push([10.51,()=>{const t=new Set([7683,7881,7886,7899,8888,9e3]);for(let e=8013;e<=8032;e++)t.add(e);for(let e=9053;e<=9057;e++)t.add(e);for(let e=104017;e<=104018;e++)t.add(e);for(let e=104971;e<=104974;e++)t.add(e);return t}]),bf.push([10.5,()=>{const t=new Set([6962,7035,7037,7039,7041,7084,7086,7133,7798,102399]);for(let e=4087;e<=4088;e++)t.add(e);for(let e=5896;e<=5899;e++)t.add(e);for(let e=7005;e<=7007;e++)t.add(e);for(let e=7057;e<=7070;e++)t.add(e);for(let e=7073;e<=7082;e++)t.add(e);for(let e=7109;e<=7128;e++)t.add(e);for(let e=7844;e<=7859;e++)t.add(e);return t}]);async function Dct(t,e,i){const r=t&&t.getAtOrigin&&t.getAtOrigin("renderer",e.origin);if(r&&r.type==="unique-value"&&r.styleOrigin){const n=await _m(r.populateFromStyle());if(ui(i),n.ok===!1){const s=n.error;e&&e.messages&&e.messages.push(new Op("renderer:style-reference",`Failed to create unique value renderer from style reference: ${s.message}`,{error:s,context:e})),t.clear("renderer",e==null?void 0:e.origin)}}}const Nct=["oid","global-id"],Fct=["oid","global-id","guid"];function kct({displayField:t,editFieldsInfo:e,fields:i,objectIdField:r,title:n},s){if(!i)return null;const o=Gct({editFieldsInfo:e,fields:i,objectIdField:r},s);if(!o.length)return null;const a=Wct({titleBase:n,fields:i,displayField:t}),l=qct();return new vN({title:a,content:l,fieldInfos:o})}const Uct=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i],Vct=(t,{editFieldsInfo:e,objectIdField:i,visibleFieldNames:r})=>r?r.has(t.name):!XPe(t.name,e)&&(!i||t.name!==i)&&!Nct.includes(t.type)&&!Uct.some(n=>n.test(t.name));function zct(t,e){const i=t;return e&&(t=t.filter(r=>!e.includes(r.type))),t===i&&(t=t.slice()),t.sort(Bct),t}function Bct(t,e){return t.type==="oid"?-1:e.type==="oid"?1:Sme(t)?-1:Sme(e)?1:(t.alias||t.name).toLocaleLowerCase().localeCompare((e.alias||e.name).toLocaleLowerCase())}function XPe(t,e){if(!t||!e)return!1;const{creationDateField:i,creatorField:r,editDateField:n,editorField:s}=e;return[i&&i.toLowerCase(),r&&r.toLowerCase(),n&&n.toLowerCase(),s&&s.toLowerCase()].includes(t.toLowerCase())}function jct(t,e){return t.editable&&!Fct.includes(t.type)&&!XPe(t.name,e)}function Gct({editFieldsInfo:t,fields:e,objectIdField:i},r){return zct(e??[],(r==null?void 0:r.ignoreFieldTypes)||Xct).map(n=>new _N({fieldName:n.name,isEditable:jct(n,t),label:n.alias,format:Hct(n),visible:Vct(n,{editFieldsInfo:t,objectIdField:i,visibleFieldNames:r==null?void 0:r.visibleFieldNames})}))}function Hct(t){switch(t.type){case"small-integer":case"integer":case"single":return new JA({digitSeparator:!0,places:0});case"double":return new JA({digitSeparator:!0,places:2});case"date":return new JA({dateFormat:"long-month-day-year"});default:return t.type==="string"&&OEe(t.name)?new JA({digitSeparator:!0,places:0}):null}}function qct(){return[new yM,new HL]}function Wct(t){const e=EHe(t),{titleBase:i}=t;return e?`${i}: {${e.trim()}}`:i??""}function Sme(t){return(t.name&&t.name.toLowerCase())==="name"?!0:(t.alias&&t.alias.toLowerCase())==="name"}const Xct=["geometry","blob","raster","guid","xml"],ac="FeatureLayer",YPe="esri.layers.FeatureLayer",Yct=re.getLogger(YPe);function b4(t,e){return new H("layer:unsupported",`Layer (${t.title}, ${t.id}) of type '${t.declaredClass}' ${e}`,{layer:t})}function Eme(t){return t&&t instanceof tt}const XG=Mct();function YG(t,e,i){const r=!!(i!=null&&i.writeLayerSchema);return{enabled:r,ignoreOrigin:r}}let Tt=class extends xlt(act(Est(vct(xst(b3e(hct(Cct(GPe(Sct(bst(kPe(gct(FN(wst(hst(xr(cD))))))))))))))))){constructor(...e){super(...e),this._handles=new Xi,this.charts=null,this.copyright=null,this.displayField=null,this.dynamicDataSource=null,this.fields=null,this.fieldsIndex=null,this.formTemplate=null,this.fullExtent=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.screenSizePerspectiveEnabled=!0,this.spatialReference=Je.WGS84,this.subtypeCode=null,this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.type="feature",this.typeIdField=null,this.types=null,this.visible=!0}destroy(){var e;(e=this.source)==null||e.destroy(),this._handles=Ve(this._handles)}normalizeCtorArgs(e,i){return typeof e=="string"?{url:e,...i}:e}load(e){var n;const i=v(e)?e.signal:null;if((n=this.portalItem)!=null&&n.loaded&&this.source)return this.addResolvingPromise(this.createGraphicsSource(i).then(s=>this.initLayerProperties(s))),Promise.resolve(this);const r=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection"]},e).catch(Du).then(async()=>{if(this.url&&this.layerId==null&&/FeatureServer|MapServer\/*$/i.test(this.url)){const s=await this._fetchFirstLayerId(i);s!=null&&(this.layerId=s)}if(!this.url&&!this._hasMemorySource())throw new H("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this.initLayerProperties(await this.createGraphicsSource(i))}).then(()=>this._setUserPrivileges(this.serviceItemId,e)).then(()=>olt(this,e));return this.addResolvingPromise(r),Promise.resolve(this)}readCapabilities(e,i){return i=i.layerDefinition||i,APe(i,this.url)}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")??0)+1}get editingEnabled(){var e;return!(this.loaded&&!((e=this.capabilities)!=null&&e.operations.supportsEditing))&&(this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges)}set editingEnabled(e){this._overrideIfSome("editingEnabled",e)}readEditingEnabled(e,i){return this._readEditingEnabled(i,!1)}readEditingEnabledFromWebMap(e,i,r){return this._readEditingEnabled(i,!0,r)}writeEditingEnabled(e,i){this._writeEditingEnabled(e,i,!1)}writeEditingEnabledToWebMap(e,i,r,n){this._writeEditingEnabled(e,i,!0,n)}get effectiveEditingEnabled(){return alt(this)}readIsTable(e,i){return(i=(i==null?void 0:i.layerDefinition)??i).type==="Table"||!i.geometryType}writeIsTable(e,i,r,n){n!=null&&n.writeLayerSchema&&va(r,e?"Table":"Feature Layer",i)}readGlobalIdField(e,i){return EPe(i.layerDefinition||i)}readObjectIdField(e,i){return CPe(i.layerDefinition||i)}get parsedUrl(){const e=Bo(this.url);return e!=null&&(this.dynamicDataSource!=null?e.path=ew(e.path,"dynamicLayer"):this.layerId!=null&&(e.path=ew(e.path,this.layerId.toString()))),e}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){Zhe(e,this.fieldsIndex),this._set("renderer",e)}readRenderer(e,i,r){var s;const n=(s=(i=i.layerDefinition||i).drawingInfo)==null?void 0:s.renderer;if(n){const o=lD(n,i,r)??void 0;return o||Yct.error("Failed to create renderer",{rendererDefinition:i.drawingInfo.renderer,layer:this,context:r}),o}if(i.defaultSymbol)return i.types&&i.types.length?new NN({defaultSymbol:ZG(i.defaultSymbol,i,r),field:i.typeIdField,uniqueValueInfos:i.types.map(o=>({id:o.id,symbol:ZG(o.symbol,o,r)}))}):new DM({symbol:ZG(i.defaultSymbol,i,r)})}set source(e){const i=this._get("source");i!==e&&(Eme(i)&&this._resetMemorySource(i),Eme(e)&&this._initMemorySource(e),this._set("source",e))}castSource(e){return e?Array.isArray(e)||e instanceof tt?new I0({layer:this,items:e}):e:null}readSource(e,i){const r=Xse.fromJSON(i.featureSet);return new I0({layer:this,items:(r==null?void 0:r.features)??[]})}readTemplates(e,i){const r=i.editFieldsInfo,n=r&&r.creatorField,s=r&&r.editorField;return e=e&&e.map(o=>Roe.fromJSON(o)),this._fixTemplates(e,n),this._fixTemplates(e,s),e}readTitle(e,i){var s;const r=((s=i.layerDefinition)==null?void 0:s.name)??i.name,n=i.title||i.layerDefinition&&i.layerDefinition.title;if(r){const o=this.portalItem&&this.portalItem.title;if(this.sublayerTitleMode==="item-title")return this.url?mst(this.url,r):r;let a=r;if(!a&&this.url){const l=dw(this.url);v(l)&&(a=l.title)}return a?(this.sublayerTitleMode==="item-title-and-service-name"&&o&&o!==a&&(a=o+" - "+a),hoe(a)):void 0}if(this.sublayerTitleMode==="item-title"&&n)return n}readTitleFromWebMap(e,i){return i.title||i.layerDefinition&&i.layerDefinition.name}readTypeIdField(e,i){let r=(i=i.layerDefinition||i).typeIdField;if(r&&i.fields){r=r.toLowerCase();const n=i.fields.find(s=>s.name.toLowerCase()===r);n&&(r=n.name)}return r}readTypes(e,i){e=(i=i.layerDefinition||i).types;const r=i.editFieldsInfo,n=r&&r.creatorField,s=r&&r.editorField;return e&&e.map(o=>(o=WPe.fromJSON(o),this._fixTemplates(o.templates,n),this._fixTemplates(o.templates,s),o))}readVisible(e,i){return i.layerDefinition&&i.layerDefinition.defaultVisibility!=null?!!i.layerDefinition.defaultVisibility:i.visibility!=null?!!i.visibility:void 0}async addAttachment(e,i){return Hat(this,e,i,ac)}async updateAttachment(e,i,r){return qat(this,e,i,r,ac)}async applyEdits(e,i){return Wat(this,e,i)}on(e,i){return super.on(e,i)}createPopupTemplate(e){return kct(this,e)}async createGraphicsSource(e){if(this._hasMemorySource()&&this.source)return this.source.load({signal:e});const{default:i}=await Qre(Q(()=>import("./FeatureLayerSource-cf2ee58c.js"),["assets/FeatureLayerSource-cf2ee58c.js","assets/assetEditingSupport-2cebf928.js","assets/clientSideDefaults-17bf364d.js","assets/QueryEngineCapabilities-42e44ded.js","assets/QueryTask-8f882280.js","assets/executeForIds-83f44725.js"]),e);return new i({layer:this}).load({signal:e})}createQuery(){const e=rlt(this);e.dynamicDataSource=this.dynamicDataSource;const i=v(this.subtypeCode)?`${this.subtypeField} = ${this.subtypeCode}`:null,r=qnt(this.definitionExpression,i);return e.where=r||"1=1",e}async deleteAttachments(e,i){return Xat(this,e,i,ac)}async fetchRecomputedExtents(e){return Yat(this,e,ac)}getFeatureType(e){const{typeIdField:i,types:r}=this;if(!i||!e)return null;const n=e.attributes?e.attributes[i]:void 0;if(n==null)return null;let s=null;return r==null||r.some(o=>{const{id:a}=o;return a!=null&&(a.toString()===n.toString()&&(s=o),!!s)}),s}getFieldDomain(e,i){const r=i&&i.feature,n=this.getFeatureType(r);if(n){const s=n.domains&&n.domains[e];if(s&&s.type!=="inherited")return s}return this._getLayerDomain(e)}getField(e){return this.fieldsIndex.get(e)}async queryAttachments(e,i){return Zat(this,e,i,ac)}async queryFeatures(e,i){const r=await this.load(),n=await r.source.queryFeatures(xp.from(e)??r.createQuery(),i);if(n!=null&&n.features)for(const s of n.features)s.layer=s.sourceLayer=r;return n}async queryObjectIds(e,i){return Jat(this,e,i,ac)}async queryFeatureCount(e,i){return Kat(this,e,i,ac)}async queryExtent(e,i){return Qat(this,e,i,ac)}async queryRelatedFeatures(e,i){return elt(this,e,i,ac)}async queryRelatedFeaturesCount(e,i){return tlt(this,e,i,ac)}async queryTopFeatures(e,i){var o;const{source:r,capabilities:n}=await this.load();if(!r.queryTopFeatures||!((o=n==null?void 0:n.query)!=null&&o.supportsTopFeaturesQuery))throw new H(ac,"Layer source does not support queryTopFeatures capability");const s=await r.queryTopFeatures(t4.from(e),i);if(s!=null&&s.features)for(const a of s.features)a.layer=a.sourceLayer=this;return s}async queryTopObjectIds(e,i){const{source:r,capabilities:n}=await this.load();if(!r.queryTopObjectIds||!(n!=null&&n.query.supportsTopFeaturesQuery))throw new H(ac,"Layer source does not support queryTopObjectIds capability");return r.queryTopObjectIds(t4.from(e),i)}async queryTopFeaturesExtent(e,i){var s;const{source:r,capabilities:n}=await this.load();if(!r.queryTopExtents||!((s=n==null?void 0:n.query)!=null&&s.supportsTopFeaturesQuery))throw new H(ac,"Layer source does not support queryTopExtents capability");return r.queryTopExtents(t4.from(e),i)}async queryTopFeatureCount(e,i){var s;const{source:r,capabilities:n}=await this.load();if(!r.queryTopCount||!((s=n==null?void 0:n.query)!=null&&s.supportsTopFeaturesQuery))throw new H(ac,"Layer source does not support queryFeatureCount capability");return r.queryTopCount(t4.from(e),i)}read(e,i){const r=e.featureCollection;if(r){const n=r.layers;n&&n.length===1&&(super.read(n[0],i),r.showLegend!=null&&super.read({showLegend:r.showLegend},i))}super.read(e,i),i&&i.origin==="service"&&(this.revert(["objectIdField","fields","timeInfo"],"service"),this.spatialReference||this.revert(["spatialReference"],"service"))}write(e,i){i={...i,origin:(i==null?void 0:i.origin)??void 0,writeLayerSchema:(i==null?void 0:i.writeLayerSchema)??this._hasMemorySource()};const{origin:r,layerContainerType:n,messages:s}=i;if(this.dynamicDataSource)return s==null||s.push(b4(this,"using a dynamic data source cannot be written to web scenes, web maps and feature service items")),null;if(this.isTable){if(r==="web-scene"||r==="web-map"&&n!=="tables")return s==null||s.push(b4(this,"using a table source cannot be written to web scenes and web maps")),null;if(this._hasMemorySource())return s==null||s.push(b4(this,"using an in-memory table source cannot be written to web scenes and web maps")),null}else if(this.loaded&&r==="web-map"&&n==="tables")return s==null||s.push(b4(this,"using a non-table source cannot be written to tables in web maps")),null;return super.write(e,i)}clone(){if(this._hasMemorySource())throw new H(ac,`FeatureLayer (title: ${this.title}, id: ${this.id}) created using in-memory source cannot be cloned`);return super.clone()}serviceSupportsSpatialReference(e){var i;return!!this.loaded&&(((i=this.source)==null?void 0:i.type)==="memory"||Lct(this,e))}async save(e){return(await Q(()=>import("./featureLayerUtils-ae4ada82.js"),["assets/featureLayerUtils-ae4ada82.js","assets/fetchService-990f8c03.js","assets/jsonContext-7f6e363e.js"])).save(this,e)}async saveAs(e,i){return(await Q(()=>import("./featureLayerUtils-ae4ada82.js"),["assets/featureLayerUtils-ae4ada82.js","assets/fetchService-990f8c03.js","assets/jsonContext-7f6e363e.js"])).saveAs(this,e,i)}_readEditingEnabled(e,i,r){var s;let n=(s=e.layerDefinition)==null?void 0:s.capabilities;return n?this._hasEditingCapability(n):(n=e.capabilities,i&&(r==null?void 0:r.origin)==="web-map"&&!this._hasMemorySource()&&n?this._hasEditingCapability(n):void 0)}_hasEditingCapability(e){return e.toLowerCase().split(",").map(i=>i.trim()).includes("editing")}_writeEditingEnabled(e,i,r,n){var s,o;if(!e){const a=(o=(s=this.capabilities)==null?void 0:s.operations)!=null&&o.supportsSync?"Query,Sync":"Query";va("layerDefinition.capabilities",a,i),r&&!(n!=null&&n.writeLayerSchema)&&(i.capabilities=a)}}_getLayerDomain(e){const i=this.fieldsIndex.get(e);return i?i.domain:null}_fetchFirstLayerId(e){return ir(this.url,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:e}).then(i=>{const r=i.data;if(r)return Array.isArray(r.layers)&&r.layers.length>0?r.layers[0].id:Array.isArray(r.tables)&&r.tables.length>0?r.tables[0].id:void 0})}async initLayerProperties(e){var i;return this._set("source",e),e.sourceJSON&&(this.sourceJSON=e.sourceJSON,this.read(e.sourceJSON,{origin:"service",portalItem:this.portalItem,portal:(i=this.portalItem)==null?void 0:i.portal,url:this.parsedUrl})),this._verifySource(),this._verifyFields(),Zhe(this.renderer,this.fieldsIndex),TEe(this.timeInfo,this.fieldsIndex),Dct(this,{origin:"service"})}async hasDataChanged(){return ilt(this)}async fetchPublishingStatus(){const e=this.source;return e!=null&&e.fetchPublishingStatus?e.fetchPublishingStatus():"unavailable"}_verifyFields(){var i,r;const e=((i=this.parsedUrl)==null?void 0:i.path)??"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+e+")"),this.isTable||this._hasMemorySource()||e.search(/\/FeatureServer\//i)!==-1||(r=this.fields)!=null&&r.some(n=>n.type==="geometry")||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+e+")")}_fixTemplates(e,i){e&&e.forEach(r=>{const n=r.prototype&&r.prototype.attributes;n&&i&&delete n[i]})}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new H("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new H("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(e){e.forEach(i=>{i.layer=this,i.sourceLayer=this}),this._handles.add([e.on("after-add",i=>{i.item.layer=this,i.item.sourceLayer=this}),e.on("after-remove",i=>{i.item.layer=null,i.item.sourceLayer=null})],"fl-source")}_resetMemorySource(e){e.forEach(i=>{i.layer=null,i.sourceLayer=null}),this._handles.remove("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}};u([Oe("service","capabilities")],Tt.prototype,"readCapabilities",null),u([d({json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Tt.prototype,"charts",void 0),u([d({readOnly:!0})],Tt.prototype,"createQueryVersion",null),u([d({json:{read:{source:"layerDefinition.copyrightText"}}})],Tt.prototype,"copyright",void 0),u([d({json:{read:{source:"layerDefinition.displayField"}}})],Tt.prototype,"displayField",void 0),u([d({types:LS,readOnly:!0})],Tt.prototype,"defaultSymbol",void 0),u([d({type:Vf})],Tt.prototype,"dynamicDataSource",void 0),u([d({type:Boolean})],Tt.prototype,"editingEnabled",null),u([Oe(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],Tt.prototype,"readEditingEnabled",null),u([Oe("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],Tt.prototype,"readEditingEnabledFromWebMap",null),u([Ne(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],Tt.prototype,"writeEditingEnabled",null),u([Ne("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],Tt.prototype,"writeEditingEnabledToWebMap",null),u([d({readOnly:!0})],Tt.prototype,"effectiveEditingEnabled",null),u([d({...XG.fields,json:{read:{source:"layerDefinition.fields"},origins:{service:{name:"fields"},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:YG}}}}})],Tt.prototype,"fields",void 0),u([d(XG.fieldsIndex)],Tt.prototype,"fieldsIndex",void 0),u([d({type:nst,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],Tt.prototype,"formTemplate",void 0),u([d({json:{read:{source:"layerDefinition.extent"}}})],Tt.prototype,"fullExtent",void 0),u([d({json:{origins:{"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:YG,writer(t,e,i){const r=t?KK.toJSON(t):null;r&&va(i,r,e)}}}},read:{source:"layerDefinition.geometryType",reader:KK.read}}})],Tt.prototype,"geometryType",void 0),u([d({json:{read:{source:"layerDefinition.hasM"}}})],Tt.prototype,"hasM",void 0),u([d({json:{read:{source:"layerDefinition.hasZ"}}})],Tt.prototype,"hasZ",void 0),u([d(Ust)],Tt.prototype,"id",void 0),u([d({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],Tt.prototype,"infoFor3D",void 0),u([d({json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],Tt.prototype,"isTable",void 0),u([Oe("service","isTable",["type","geometryType"]),Oe("isTable",["layerDefinition.type","layerDefinition.geometryType"])],Tt.prototype,"readIsTable",null),u([Ne("web-map","isTable")],Tt.prototype,"writeIsTable",null),u([d(foe)],Tt.prototype,"labelsVisible",void 0),u([d({type:[IB],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:Tme},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:Tme},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],Tt.prototype,"labelingInfo",void 0),u([d((()=>{const t=se(kst);return t.json.origins["portal-item"]={write:{target:"layerDefinition.drawingInfo.transparency",writer(e,i,r){va(r,G9(e),i)}}},t})())],Tt.prototype,"opacity",void 0),u([d(Nst)],Tt.prototype,"legendEnabled",void 0),u([d({type:["show","hide"],json:(()=>{const t=se(E3e.json);return t.origins["portal-item"]={read:!1,write:!1},t})()})],Tt.prototype,"listMode",void 0),u([Oe("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],Tt.prototype,"readGlobalIdField",null),u([d({json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:YG}}}}})],Tt.prototype,"objectIdField",void 0),u([Oe("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],Tt.prototype,"readObjectIdField",null),u([d({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],Tt.prototype,"operationalLayerType",void 0),u([d(XG.outFields)],Tt.prototype,"outFields",void 0),u([d({readOnly:!0})],Tt.prototype,"parsedUrl",null),u([d({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],Tt.prototype,"path",void 0),u([d(poe)],Tt.prototype,"popupEnabled",void 0),u([d({type:vN,json:{name:"popupInfo",write:!0}})],Tt.prototype,"popupTemplate",void 0),u([d({readOnly:!0})],Tt.prototype,"defaultPopupTemplate",null),u([d({types:CB,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:znt,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:(t,e,i)=>({ignoreOrigin:i==null?void 0:i.writeLayerSchema})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(t,e,i)=>({ignoreOrigin:i==null?void 0:i.writeLayerSchema})}}})],Tt.prototype,"renderer",null),u([Oe("service","renderer",["drawingInfo.renderer","defaultSymbol"]),Oe("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],Tt.prototype,"readRenderer",null),u([d((()=>{const t=se(Lst);return t.json.origins["portal-item"]={read:!1,write:!1},t})())],Tt.prototype,"screenSizePerspectiveEnabled",void 0),u([d({clonable:!1})],Tt.prototype,"source",null),u([ri("source")],Tt.prototype,"castSource",null),u([Oe("portal-item","source",["featureSet"]),Oe("web-map","source",["featureSet"])],Tt.prototype,"readSource",null),u([d({json:{read:{source:"layerDefinition.extent.spatialReference"}}})],Tt.prototype,"spatialReference",void 0),u([d({type:Number})],Tt.prototype,"subtypeCode",void 0),u([d({type:[Roe]})],Tt.prototype,"templates",void 0),u([Oe("templates",["editFieldsInfo","creatorField","editorField","templates"])],Tt.prototype,"readTemplates",null),u([d({type:qPe})],Tt.prototype,"timeInfo",void 0),u([d()],Tt.prototype,"title",void 0),u([Oe("service","title",["name"]),Oe("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],Tt.prototype,"readTitle",null),u([Oe("web-map","title",["layerDefinition.name","title"])],Tt.prototype,"readTitleFromWebMap",null),u([d({type:String})],Tt.prototype,"sublayerTitleMode",void 0),u([d({json:{read:!1}})],Tt.prototype,"type",void 0),u([d({type:String})],Tt.prototype,"typeIdField",void 0),u([Oe("service","typeIdField"),Oe("typeIdField",["layerDefinition.typeIdField"])],Tt.prototype,"readTypeIdField",null),u([d({type:[WPe]})],Tt.prototype,"types",void 0),u([Oe("service","types",["types"]),Oe("types",["layerDefinition.types"])],Tt.prototype,"readTypes",null),u([d({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],Tt.prototype,"visible",void 0),u([Oe("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],Tt.prototype,"readVisible",null),Tt=u([$(YPe)],Tt);const ZG=Ow({types:iB}),Moe=Tt,u7t=Object.freeze(Object.defineProperty({__proto__:null,default:Moe},Symbol.toStringTag,{value:"Module"})),Zct=["$datastore","$map","$layer","$aggregatedfeatures"],Jct="esri.widgets.Feature.support.arcadeFeatureUtils",Kct=re.getLogger(Jct);function Qct(t){return typeof t=="string"?MN(Ise(t)):Array.isArray(t)?eut(t):(t==null?void 0:t.declaredClass)==="esri.arcade.Dictionary"?tut(t):t}function eut(t){return`<ul class="esri-widget__list">${t.map(e=>`<li>${typeof e=="string"?MN(Ise(e)):e}</li>`).join("")}</ul>`}function tut(t){return`<table class="esri-widget__table">${t.keys().map(e=>{const i=t.field(e);return`<tr><th>${e}</th><td>${typeof i=="string"?MN(Ise(i)):i}</td></tr>`}).join("")}</table>`}function iut({aggregatedFeatures:t,arcadeUtils:e,featureSetVars:i,context:r,viewInfo:n,map:s,graphic:o,interceptor:a}){i.forEach(l=>{const c=l.toLowerCase(),h=n.sr,p={map:s,spatialReference:h,interceptor:a};if(c==="$map"&&(r.vars[c]=e.convertMapToFeatureSetCollection(p)),c==="$layer"&&(r.vars[c]=e.convertFeatureLayerToFeatureSet({layer:o.sourceLayer,spatialReference:h,interceptor:a})),c==="$datastore"&&(r.vars[c]=e.convertServiceUrlToWorkspace({url:o.sourceLayer.url,spatialReference:h,interceptor:a})),c==="$aggregatedfeatures"){const f=o.layer,{fields:m,objectIdField:g,geometryType:_,spatialReference:b,displayField:w}=f,x=new Moe({fields:m,objectIdField:g,geometryType:_,spatialReference:b,displayField:w,...f.type==="feature"?{templates:f.templates,typeIdField:f.typeIdField,types:f.types}:null,source:t});r.vars[c]=e.convertFeatureLayerToFeatureSet({layer:x,spatialReference:b,interceptor:a})}})}function ZPe(){return Q(()=>import("./arcadeUtils-39415c80.js").then(t=>t.ax),["assets/arcadeUtils-39415c80.js","assets/arcadeTimeUtils-21c68d00.js","assets/executionError-fb3f283a.js","assets/number-beae30ff.js","assets/hash-0ddfbf4b.js"])}function rut(t){return"createQuery"in t&&"queryFeatures"in t}async function nut({graphic:t,view:e}){const{isAggregate:i,layer:r}=t;if(!i||!r||(e==null?void 0:e.type)!=="2d")return[];const n=await e.whenLayerView(r);if(!rut(n))return[];const s=n.createQuery(),o=t.getObjectId();s.aggregateIds=o!=null?[o]:[];const{features:a}=await n.queryFeatures(s);return a}async function JPe({expressionInfo:t,arcadeUtils:e,interceptor:i,spatialReference:r,map:n,graphic:s,view:o}){if(!t||!t.expression)return null;const a=e.createSyntaxTree(t.expression),l=Zct.filter(m=>e.hasVariable(a,m)),[c]=await Promise.all([nut({graphic:s,view:o}),e.loadScriptDependencies(a,!0,l)]),h=e.getViewInfo({spatialReference:r}),p=e.createExecContext(s,h);p.interceptor=i,p.useAsync=!0,iut({aggregatedFeatures:c,arcadeUtils:e,featureSetVars:l,context:p,viewInfo:h,map:n,graphic:s,interceptor:i});const f=e.createFunction(a,p);return e.executeAsyncFunction(f,p).catch(m=>Kct.error("arcade-execution-error",{error:m,graphic:s,expressionInfo:t}))}async function sut({expressionInfos:t,spatialReference:e,graphic:i,interceptor:r,map:n,view:s}){if(!t||!t.length)return{};const o=await ZPe(),a={};for(const h of t)a[`expression/${h.name}`]=JPe({expressionInfo:h,arcadeUtils:o,interceptor:r,spatialReference:e,map:n,graphic:i,view:s});const l=await ma(a),c={};for(const h in l)c[h]=Qct(l[h].value);return c}const out=1;let xh=class extends Fw(ve){constructor(e){super(e),this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.view=null,this._cancelQuery=()=>{const{_abortController:i}=this;i&&i.abort(),this._abortController=null},this._createVM=()=>{var n,s;const i=(n=this.contentElement)==null?void 0:n.type;(s=this.contentElementViewModel)==null||s.destroy();const r=i==="fields"?new _B:i==="media"?new bS:i==="text"?new OV:null;this._set("contentElementViewModel",r)},this._compile=async()=>{this._cancelQuery();const i=new AbortController;this._abortController=i,await this._compileExpression(),this._abortController===i&&(this._abortController=null)},this._compileThrottled=PR(this._compile,out,this),this._compileExpression=async()=>{const{expressionInfo:i,graphic:r,interceptor:n,spatialReference:s,map:o,view:a,_abortController:l}=this;if(!(i&&r&&s&&o))return void this._set("contentElement",null);const c=await ZPe();if(l!==this._abortController)return;const h=await JPe({arcadeUtils:c,expressionInfo:i,graphic:r,interceptor:n,map:o,spatialReference:s,view:a});if(!h||h.declaredClass!=="esri.arcade.Dictionary")return void this._set("contentElement",null);const p=await h.castAsJsonAsync(l==null?void 0:l.signal),f=p==null?void 0:p.type,m=f==="media"?XL.fromJSON(p):f==="text"?_M.fromJSON(p):f==="fields"?yM.fromJSON(p):null;this._set("contentElement",m)},this.handles.add([ne(()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view],()=>this._compileThrottled(),zt),ne(()=>[this.contentElement],()=>this._createVM(),zt)])}destroy(){var e;this._cancelQuery(),(e=this.contentElementViewModel)==null||e.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){var e;return((e=this.view)==null?void 0:e.spatialReference)??null}set spatialReference(e){this._override("spatialReference",e)}get state(){const{_abortController:e,contentElement:i,contentElementViewModel:r}=this;return e?"loading":i||r?"ready":"disabled"}get map(){var e;return((e=this.view)==null?void 0:e.map)??null}set map(e){this._override("map",e)}};u([d()],xh.prototype,"_abortController",void 0),u([d({type:PEe})],xh.prototype,"expressionInfo",void 0),u([d({type:Ha})],xh.prototype,"graphic",void 0),u([d({readOnly:!0})],xh.prototype,"contentElement",void 0),u([d({readOnly:!0})],xh.prototype,"contentElementViewModel",void 0),u([d()],xh.prototype,"interceptor",void 0),u([d()],xh.prototype,"spatialReference",null),u([d({readOnly:!0})],xh.prototype,"state",null),u([d()],xh.prototype,"map",null),u([d()],xh.prototype,"view",void 0),xh=u([$("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],xh);const Ooe=xh,w4={iconLoading:"esri-icon-loading-indicator esri-rotating",base:"esri-feature-expression",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"};let sU=class extends Sa{constructor(e,i){super(e,i),this._contentWidget=null,this.viewModel=new Ooe}initialize(){this.addHandles(ne(()=>{var e;return(e=this.viewModel)==null?void 0:e.contentElementViewModel},()=>this._setupExpressionWidget(),zt))}destroy(){this._destroyContentWidget()}renderLoading(){return te("div",{key:"loading-container",class:w4.loadingSpinnerContainer},te("span",{class:this.classes(w4.iconLoading,w4.spinner)}))}render(){var i;const{state:e}=this.viewModel;return te("div",{class:w4.base},e==="loading"?this.renderLoading():e==="disabled"?null:(i=this._contentWidget)==null?void 0:i.render())}_destroyContentWidget(){const{_contentWidget:e}=this;e&&(e.viewModel=null,e.destroy()),this._contentWidget=null}_setupExpressionWidget(){const{contentElementViewModel:e,contentElement:i}=this.viewModel,r=i==null?void 0:i.type;this._destroyContentWidget();const n=e?r==="fields"?new zMe({viewModel:e}):r==="media"?new POe({viewModel:e}):r==="text"?new D6({viewModel:e}):null:null;this._contentWidget=n,this.scheduleRender()}};u([d({type:Ooe})],sU.prototype,"viewModel",void 0),sU=u([$("esri.widgets.Feature.FeatureExpression")],sU);const aut=sU,JG=100;let hn=class extends xr(fO(Fw(ve))){constructor(e){super(e),this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.featuresPerPage=10,this.description=null,this.graphic=null,this.layer=null,this.map=null,this.orderByFields=null,this.featureCount=0,this.relationshipId=null,this.showAllEnabled=!1,this.title=null,this._cancelQuery=()=>{const{_queryAbortController:i}=this;i&&i.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{const{_queryFeatureCountAbortController:i}=this;i&&i.abort(),this._queryFeatureCountAbortController=null},this._cancelQueryPage=()=>{const{_queryPageAbortController:i}=this;i&&i.abort(),this._queryPageAbortController=null},this._queryController=async()=>{this._cancelQuery();const i=new AbortController;this._queryAbortController=i,await CR(this._query()),this._queryAbortController===i&&(this._queryAbortController=null)},this._queryFeatureCountController=async()=>{this._cancelQueryFeatureCount();const i=new AbortController;this._queryFeatureCountAbortController=i,await CR(this._queryFeatureCount()),this._queryFeatureCountAbortController===i&&(this._queryFeatureCountAbortController=null)},this._queryPageController=async()=>{const i=new AbortController;this._queryPageAbortController=i,await CR(this._queryPage()),this._queryPageAbortController===i&&(this._queryPageAbortController=null)},this._queryThrottled=PR(this._queryController,JG,this),this._queryFeatureCountThrottled=PR(this._queryFeatureCountController,JG,this),this._queryPageThrottled=PR(this._queryPageController,JG,this),this._query=async()=>{const{_queryAbortController:i,relatedFeatures:r}=this;this._destroyRelatedFeatureViewModels(),this.featurePage=1,r.removeAll(),r.addMany(this._sliceFeatures(await this._queryRelatedFeatures({signal:i==null?void 0:i.signal})))},this.handles.add([ne(()=>[this.displayCount,this.graphic,this.layer,this.map,this.orderByFieldsFixedCasing,this.relationshipId,this.featuresPerPage,this.showAllEnabled,this.canQuery,this.featureCount],()=>this._queryThrottled(),zt),ne(()=>[this.featurePage,this.showAllEnabled],()=>this._queryPageThrottled()),ne(()=>[this.layer,this.relationshipId,this.objectId,this.canQuery],()=>this._queryFeatureCountThrottled())])}destroy(){this._destroyRelatedFeatureViewModels(),this.relatedFeatures.removeAll(),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage()}set featurePage(e){const{featuresPerPage:i,featureCount:r}=this,n=1,s=Math.ceil(r/i)||1;this._set("featurePage",Math.min(Math.max(e,n),s))}get featurePage(){return this._get("featurePage")}get orderByFieldsFixedCasing(){const{orderByFields:e,relatedLayer:i}=this;return e&&(i!=null&&i.loaded)?e.map(r=>{const n=r.clone(),s=nD(r.field,i);return n.field=s,n}):e??[]}get supportsCacheHint(){var e,i,r;return!!((r=(i=(e=this.layer)==null?void 0:e.capabilities)==null?void 0:i.queryRelated)!=null&&r.supportsCacheHint)}get canQuery(){var i,r;const e=(r=(i=this.layer)==null?void 0:i.capabilities)==null?void 0:r.queryRelated;return!!(this.relatedLayer&&this.relationship&&typeof this.relationshipId=="number"&&typeof this.objectId=="number"&&(e!=null&&e.supportsCount)&&(e!=null&&e.supportsPagination))}get itemDescriptionFieldName(){var e,i;return((i=(e=this.orderByFieldsFixedCasing)==null?void 0:e[0])==null?void 0:i.field)||null}set displayCount(e){this._set("displayCount",Math.min(Math.max(e,0),10))}get displayCount(){return this._get("displayCount")}get objectId(){var e,i;return(this.objectIdField&&((i=(e=this.graphic)==null?void 0:e.attributes)==null?void 0:i[this.objectIdField]))??null}get objectIdField(){var e;return((e=this.layer)==null?void 0:e.objectIdField)||null}get relatedFeatures(){return this._get("relatedFeatures")||new tt}get relatedLayer(){const{layer:e,map:i,relationship:r}=this;return e!=null&&e.loaded&&i&&r?wet(i,e,r)??null:null}get relationship(){var r;const{relationshipId:e,layer:i}=this;return typeof e=="number"?((r=i==null?void 0:i.relationships)==null?void 0:r.find(({id:n})=>n===e))??null:null}get relatedFeatureViewModels(){return this._get("relatedFeatureViewModels")||new tt}get state(){const{_queryAbortController:e,_queryFeatureCountAbortController:i,_queryPageAbortController:r,canQuery:n}=this;return i?"loading":e||r?"querying":n?"ready":"disabled"}_destroyRelatedFeatureViewModels(){var e;(e=this.relatedFeatureViewModels)==null||e.forEach(i=>!i.destroyed&&i.destroy()),this.relatedFeatureViewModels.removeAll()}async _queryFeatureCount(){const{layer:e,relatedLayer:i,relationshipId:r,objectId:n,_queryFeatureCountAbortController:s,canQuery:o,supportsCacheHint:a}=this;if(await(e==null?void 0:e.load()),await(i==null?void 0:i.load()),!o||!e||!i)return void this._set("featureCount",0);const l=i.createQuery(),c=new $M({cacheHint:a,relationshipId:r,returnGeometry:!1,objectIds:[n],where:mhe(l.where,void 0)}),h=await e.queryRelatedFeaturesCount(c,{signal:s==null?void 0:s.signal});this._set("featureCount",h[n]||0)}_sliceFeatures(e){const{showAllEnabled:i,displayCount:r}=this;return i?e:r?e.slice(0,r):[]}async _queryPage(){const{relatedFeatures:e,featurePage:i,showAllEnabled:r,_queryPageAbortController:n}=this;!r||i<2||e.addMany(await this._queryRelatedFeatures({signal:n==null?void 0:n.signal}))}async _queryRelatedFeatures(e){var A;const{orderByFieldsFixedCasing:i,showAllEnabled:r,featuresPerPage:n,displayCount:s,layer:o,relationshipId:a,featurePage:l,featureCount:c,relatedLayer:h,supportsCacheHint:p}=this,{canQuery:f,objectId:m}=this;if(!f||!o||!h)return[];const g=r?((l-1)*n+c)%c:0,_=r?n:s,b=h.objectIdField,w=[...i==null?void 0:i.map(I=>I.field),b].filter(v),x=i==null?void 0:i.map(I=>`${I.field} ${I.order}`),T=h.createQuery(),E=new $M({orderByFields:x,start:g,num:_,outFields:w,cacheHint:p,relationshipId:a,returnGeometry:!1,objectIds:[m],where:mhe(T.where,void 0)}),C=((A=(await o.queryRelatedFeatures(E,{signal:e==null?void 0:e.signal}))[m])==null?void 0:A.features)||[];return C.forEach(I=>{I.sourceLayer=h,I.layer=h}),C}};u([d()],hn.prototype,"_queryAbortController",void 0),u([d()],hn.prototype,"_queryPageAbortController",void 0),u([d()],hn.prototype,"_queryFeatureCountAbortController",void 0),u([d({value:1})],hn.prototype,"featurePage",null),u([d()],hn.prototype,"featuresPerPage",void 0),u([d({readOnly:!0})],hn.prototype,"orderByFieldsFixedCasing",null),u([d({readOnly:!0})],hn.prototype,"supportsCacheHint",null),u([d({readOnly:!0})],hn.prototype,"canQuery",null),u([d()],hn.prototype,"description",void 0),u([d({readOnly:!0})],hn.prototype,"itemDescriptionFieldName",null),u([d({value:3})],hn.prototype,"displayCount",null),u([d({type:Ha})],hn.prototype,"graphic",void 0),u([d()],hn.prototype,"layer",void 0),u([d()],hn.prototype,"map",void 0),u([d({readOnly:!0})],hn.prototype,"objectId",null),u([d({readOnly:!0})],hn.prototype,"objectIdField",null),u([d()],hn.prototype,"orderByFields",void 0),u([d({readOnly:!0})],hn.prototype,"relatedFeatures",null),u([d({readOnly:!0})],hn.prototype,"relatedLayer",null),u([d({readOnly:!0})],hn.prototype,"relationship",null),u([d()],hn.prototype,"featureCount",void 0),u([d({readOnly:!0})],hn.prototype,"relatedFeatureViewModels",null),u([d()],hn.prototype,"relationshipId",void 0),u([d()],hn.prototype,"showAllEnabled",void 0),u([d()],hn.prototype,"state",null),u([d()],hn.prototype,"title",void 0),hn=u([$("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],hn);const Poe=hn,dI="esri-feature",KG=`${dI}-relationship`,Fy={base:KG,esriWidget:"esri-widget",listContainer:`${KG}__list`,listContainerQuerying:`${KG}__list--querying`,featureObserver:`${dI}__feature-observer`,stickySpinnerContainer:`${dI}__sticky-loading-container`,loadingSpinnerContainer:`${dI}__loading-container`,spinner:`${dI}__loading-spinner`,iconLoading:"esri-icon-loading-indicator esri-rotating"},Cme={title:!0,description:!0};let wc=class extends Sa{constructor(e,i){super(e,i),this._featureElementInfo=null,this._relatedFeatureIntersectionObserverNode=null,this._relatedFeatureIntersectionObserver=new IntersectionObserver(([r])=>{r!=null&&r.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this.headingLevel=2,this.viewModel=new Poe,this.messages=null,this.messagesCommon=null,this.visibleElements={...Cme},this._increaseFeaturePage=()=>{const{state:r,showAllEnabled:n,relatedFeatures:s,featuresPerPage:o,featurePage:a}=this.viewModel;r==="ready"&&n&&s.length>=o*a&&this.viewModel.featurePage++}}initialize(){this._featureElementInfo=new yB,this.addHandles([ne(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),zt),ne(()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),Kn(()=>this.viewModel.relatedFeatureViewModels,"change",()=>this._setupRelatedFeatureViewModels())])}loadDependencies(){return Promise.all([Q(()=>import("./calcite-list-a40533e0.js"),["assets/calcite-list-a40533e0.js","assets/utils3-7e94db45.js","assets/debounce-d5abe404.js","assets/scrim-d7fb9038.js"]),Q(()=>import("./calcite-list-item-f0e131c4.js"),["assets/calcite-list-item-f0e131c4.js","assets/utils3-7e94db45.js"]),Q(()=>import("./calcite-icon-02de242a.js"),[]),Q(()=>import("./calcite-notice-7f3c5370.js"),[])])}destroy(){this._unobserveRelatedFeatureObserver(),this._featureElementInfo=Ve(this._featureElementInfo)}get displayShowAllButton(){const{showAllEnabled:e,featureCount:i,displayCount:r}=this.viewModel;return!e&&!!i&&(i>r||r===0)}get displayListItems(){return this.displayShowAllButton||this.viewModel.relatedFeatureViewModels.length>0}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get featureCountDescription(){const{messages:e}=this,{featureCount:i}=this.viewModel;return Lf(i===1?e==null?void 0:e.numberRecord:e==null?void 0:e.numberRecords,{number:i})}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}castVisibleElements(e){return{...Cme,...e}}renderStickyLoading(){return this.viewModel.state==="querying"?te("div",{key:"sticky-loader",class:Fy.stickySpinnerContainer},this.renderLoadingIcon()):null}renderLoadingIcon(){return te("span",{class:this.classes(Fy.iconLoading,Fy.spinner)})}renderLoading(){return te("div",{key:"loading-container",class:Fy.loadingSpinnerContainer},this.renderLoadingIcon())}renderShowAllIconNode(){return te("calcite-icon",{scale:"s",icon:"list",slot:"content-end"})}renderChevronIconNode(){const e=Bg(this.container)?"chevron-left":"chevron-right";return te("calcite-icon",{scale:"s",icon:e,slot:"content-end"})}renderRelatedFeature(e){var s,o;const{itemDescriptionFieldName:i}=this.viewModel,r=e.title;e.description=i&&((s=e.formattedAttributes)==null?void 0:s.global[i]);const n=e.state==="loading";return te("calcite-list-item",{key:e.uid,label:n?`${(o=this.messagesCommon)==null?void 0:o.loading}`:r,description:n?"":e.description??"",onCalciteListItemSelect:()=>this.emit("select-record",{featureViewModel:e})},this.renderChevronIconNode())}renderShowAllListItem(){var e;return this.displayShowAllButton?te("calcite-list-item",{key:"show-all-item",label:(e=this.messages)==null?void 0:e.showAll,description:this.featureCountDescription,onCalciteListItemSelect:()=>this.emit("show-all-records")},this.renderShowAllIconNode()):null}renderNoRelatedFeaturesMessage(){var e;return te("calcite-notice",{key:"no-related-features-message",icon:"information",open:!0,kind:"brand",scale:"s",width:"full"},te("div",{slot:"message"},(e=this.messages)==null?void 0:e.noRelatedFeatures))}renderFeatureObserver(){return te("div",{key:"feature-observer",class:Fy.featureObserver,bind:this,afterCreate:this._relatedFeatureIntersectionObserverCreated})}renderList(){const{relatedFeatureViewModels:e}=this.viewModel;return te("calcite-list",null,e.toArray().map(i=>this.renderRelatedFeature(i)),this.renderShowAllListItem())}renderRelatedFeatures(){const{displayListItems:e}=this,{state:i}=this.viewModel;return te("div",{key:"list-container",class:this.classes(Fy.listContainer,{[Fy.listContainerQuerying]:i==="querying"})},e?this.renderList():i==="ready"?this.renderNoRelatedFeaturesMessage():null,this.renderStickyLoading(),this.renderFeatureObserver())}renderRelationshipNotFound(){var e;return te("calcite-notice",{key:"relationship-not-found",icon:"exclamation-mark-triangle",open:!0,kind:"danger",scale:"s",width:"full"},te("div",{slot:"message"},(e=this.messages)==null?void 0:e.relationshipNotFound))}render(){var i;const{state:e}=this.viewModel;return te("div",{class:this.classes(Fy.base,Fy.esriWidget)},(i=this._featureElementInfo)==null?void 0:i.render(),e==="loading"?this.renderLoading():e==="disabled"?this.renderRelationshipNotFound():this.renderRelatedFeatures())}_setupRelatedFeatureViewModels(){const{relatedFeatureViewModels:e}=this.viewModel,i="related-feature-viewmodels";this.removeHandles(i),e==null||e.forEach(r=>{this.addHandles(ne(()=>[r.title,r.state],()=>this.scheduleRender(),zt),i)}),this.scheduleRender()}_setupFeatureElementInfo(){var s;const{headingLevel:e,visibleElements:i}=this,r=i.description&&this.description,n=i.title&&this.title;(s=this._featureElementInfo)==null||s.set({description:r,title:n,headingLevel:e})}async _handleRelatedFeatureObserverChange(){this._unobserveRelatedFeatureObserver();const{state:e,showAllEnabled:i}=this.viewModel;await t2(0),this._relatedFeatureIntersectionObserverNode&&e==="ready"&&i&&this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode)}_relatedFeatureIntersectionObserverCreated(e){this._relatedFeatureIntersectionObserverNode=e}_unobserveRelatedFeatureObserver(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}};u([d()],wc.prototype,"_relatedFeatureIntersectionObserverNode",void 0),u([d({readOnly:!0})],wc.prototype,"displayShowAllButton",null),u([d({readOnly:!0})],wc.prototype,"displayListItems",null),u([d()],wc.prototype,"description",null),u([d({readOnly:!0})],wc.prototype,"featureCountDescription",null),u([d()],wc.prototype,"headingLevel",void 0),u([d()],wc.prototype,"title",null),u([d({type:Poe})],wc.prototype,"viewModel",void 0),u([d(),Go("esri/widgets/Feature/t9n/Feature")],wc.prototype,"messages",void 0),u([d(),Go("esri/t9n/common")],wc.prototype,"messagesCommon",void 0),u([d()],wc.prototype,"visibleElements",void 0),u([ri("visibleElements")],wc.prototype,"castVisibleElements",null),wc=u([$("esri.widgets.Feature.FeatureRelationship")],wc);const Ame=wc;let lut=class{constructor(e,i){this.preLayerQueryCallback=e,this.preRequestCallback=i,this.preLayerQueryCallback||(this.preLayerQueryCallback=r=>{}),this.preRequestCallback||(this.preLayerQueryCallback=r=>{})}};var pI;const cut=1,Rme="content-view-models",Mme="relationship-view-models",Ome={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0};let Gn=pI=class extends fO(ve){constructor(t){super(t),this._handles=new Xi,this._error=null,this._featureAbortController=null,this._graphicChangedThrottled=PR(this._graphicChanged,cut,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities={...Ome},this.content=null,this.contentViewModels=[],this.description=null,this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=e=>{const{abilities:i}=this;return e.type==="attachments"&&!!i.attachmentsContent||e.type==="custom"&&!!i.customContent||e.type==="fields"&&!!i.fieldsContent||e.type==="media"&&!!i.mediaContent||e.type==="text"&&!!i.textContent||e.type==="expression"&&!!i.expressionContent||e.type==="relationship"&&!!i.relationshipContent},this._handles.add(ne(()=>[this.graphic,this._effectivePopupTemplate,this.abilities],()=>this._graphicChangedThrottled(),zt))}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this._handles.destroy(),this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return v(this.graphic)?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return fet(_pe(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return MMe(this.graphic)}castAbilities(t){return{...Ome,...t}}get isTable(){var t;return((t=this._sourceLayer)==null?void 0:t.isTable)||!1}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(t){this._set("graphic",t?t.clone():null)}get spatialReference(){var t;return((t=this.view)==null?void 0:t.spatialReference)??null}set spatialReference(t){this._override("spatialReference",t)}get map(){var t;return((t=this.view)==null?void 0:t.map)||null}set map(t){this._override("map",t)}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(t,e){const i=this.contentViewModels[t];i instanceof bS&&i.setActiveMedia(e)}nextMedia(t){const e=this.contentViewModels[t];e instanceof bS&&e.next()}previousMedia(t){const e=this.contentViewModels[t];e instanceof bS&&e.previous()}async updateGeometry(){var o,a;const{graphic:t,spatialReference:e,_sourceLayer:i}=this;await(i==null?void 0:i.load());const r=i==null?void 0:i.objectIdField;if(!r||!t||!i)return;const n=(o=t==null?void 0:t.attributes)==null?void 0:o[r];if(n==null)return;const s=[n];if(!t.geometry){const l=(a=await DMe({layer:i,graphic:t,outFields:[],objectIds:s,returnGeometry:!0,spatialReference:e}))==null?void 0:a.geometry;l&&(t.geometry=l)}}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}async _graphicChanged(){this._cancelFeatureQuery(),this._error=null,this._clear();const{graphic:t}=this;if(!t)return;const e=new AbortController;this._featureAbortController=e;try{await this._queryFeature({signal:e.signal})}catch(i){gs(i)||(this._error=i,re.getLogger(this.declaredClass).error("error","The popupTemplate could not be displayed for this feature.",{error:i,graphic:t,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===e&&(this._featureAbortController=null)}_cancelFeatureQuery(){const{_featureAbortController:t}=this;t&&t.abort(),this._featureAbortController=null}_compileContentElement(t,e){return t.type==="attachments"?this._compileAttachments(t,e):t.type==="custom"?this._compileCustom(t,e):t.type==="fields"?this._compileFields(t,e):t.type==="media"?this._compileMedia(t,e):t.type==="text"?this._compileText(t,e):t.type==="expression"?this._compileExpression(t,e):t.type==="relationship"?this._compileRelationship(t,e):void 0}_compileContent(t){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(t)?t.filter(this._isAllowedContentType).map((e,i)=>this._compileContentElement(e,i)).filter(v):typeof t=="string"?this._compileText(new _M({text:t}),0).text:t}_destroyContentViewModels(){var t,e;(t=this._handles)==null||t.remove(Mme),(e=this._handles)==null||e.remove(Rme),this.contentViewModels.forEach(i=>i&&!i.destroyed&&i.destroy()),this._set("contentViewModels",[])}_matchesFeature(t,e){var n;const i=(n=t==null?void 0:t.graphic)==null?void 0:n.getObjectId(),r=e==null?void 0:e.getObjectId();return v(i)&&v(r)&&i===r}_setRelatedFeaturesViewModels({relatedFeatureViewModels:t,relatedFeatures:e,map:i}){const{view:r,spatialReference:n}=this;e==null||e.filter(Boolean).forEach(s=>{t.find(o=>this._matchesFeature(o,s))||t.add(new pI({abilities:{relationshipContent:!1},map:i,view:r,spatialReference:n,graphic:s}))}),t.forEach(s=>{(e==null?void 0:e.find(a=>this._matchesFeature(s,a)))||t.remove(s)})}_setExpressionContentVM(t,e){const i=this.formattedAttributes,{contentElement:r,contentElementViewModel:n}=t,s=r==null?void 0:r.type;n&&s&&(s==="fields"&&(this._createFieldsFormattedAttributes({contentElement:r,contentElementIndex:e,formattedAttributes:i}),n.set(this._createFieldsVMParams(r,e))),s==="media"&&(this._createMediaFormattedAttributes({contentElement:r,contentElementIndex:e,formattedAttributes:i}),n.set(this._createMediaVMParams(r,e))),s==="text"&&n.set(this._createTextVMParams(r)))}_compileRelationship(t,e){const{displayCount:i,orderByFields:r,relationshipId:n,title:s,description:o}=t,{_sourceLayer:a,graphic:l,map:c}=this,h=new Poe({displayCount:i,graphic:l,orderByFields:r,relationshipId:n,layer:a,map:c,...this._compileTitleAndDesc({title:s,description:o})});return this.contentViewModels[e]=h,this._handles.add(Kn(()=>h.relatedFeatures,"change",()=>this._setRelatedFeaturesViewModels(h)),Mme),t}_compileExpression(t,e){const{expressionInfo:i}=t,{graphic:r,map:n,spatialReference:s,view:o}=this,a=new Ooe({expressionInfo:i,graphic:r,interceptor:pI.interceptor,map:n,spatialReference:s,view:o});return this.contentViewModels[e]=a,this._handles.add(ne(()=>a.contentElementViewModel,()=>this._setExpressionContentVM(a,e),zt),Rme),t}_compileAttachments(t,e){const{graphic:i}=this,{description:r,title:n}=t;return this.contentViewModels[e]=new Lse({graphic:i,...this._compileTitleAndDesc({title:n,description:r})}),t}_compileCustom(t,e){const{graphic:i}=this,{creator:r,destroyer:n}=t;return this.contentViewModels[e]=new OV({graphic:i,creator:r,destroyer:n}),t}_compileTitleAndDesc({title:t,description:e}){const{_fieldInfoMap:i,_sourceLayer:r,graphic:n,formattedAttributes:s}=this,o=n==null?void 0:n.attributes,a=this._expressionAttributes,l=s.global;return{title:vS({attributes:o,fieldInfoMap:i,globalAttributes:l,expressionAttributes:a,layer:r,text:t}),description:vS({attributes:o,fieldInfoMap:i,globalAttributes:l,expressionAttributes:a,layer:r,text:e})}}_createFieldsVMParams(t,e){var c;const i=this._effectivePopupTemplate,r=this.formattedAttributes,n={...r==null?void 0:r.global,...r==null?void 0:r.content[e]},s=(c=(t==null?void 0:t.fieldInfos)||(i==null?void 0:i.fieldInfos))==null?void 0:c.filter(({fieldName:h})=>Ose(h)||Y0(h)||n.hasOwnProperty(h)),o=i==null?void 0:i.expressionInfos,{description:a,title:l}=t;return{attributes:n,expressionInfos:o,fieldInfos:s,...this._compileTitleAndDesc({title:l,description:a})}}_compileFields(t,e){const i=t.clone(),r=new _B(this._createFieldsVMParams(t,e));return this.contentViewModels[e]=r,i.fieldInfos=r.formattedFieldInfos.slice(0),i}_createMediaVMParams(t,e){const{abilities:i,graphic:r,_fieldInfoMap:n,_effectivePopupTemplate:s,relatedInfos:o,_sourceLayer:a,_expressionAttributes:l}=this,c=this.formattedAttributes,h=(r==null?void 0:r.attributes)??{},{description:p,mediaInfos:f,title:m}=t;return{abilities:{chartAnimation:i.chartAnimation},activeMediaInfoIndex:t.activeMediaInfoIndex||0,attributes:h,isAggregate:r==null?void 0:r.isAggregate,layer:a,fieldInfoMap:n,formattedAttributes:{...c==null?void 0:c.global,...c==null?void 0:c.content[e]},expressionAttributes:l,mediaInfos:f,popupTemplate:s,relatedInfos:o,...this._compileTitleAndDesc({title:m,description:p})}}_compileMedia(t,e){const i=t.clone(),r=new bS(this._createMediaVMParams(t,e));return i.mediaInfos=r.formattedMediaInfos.slice(0),this.contentViewModels[e]=r,i}_createTextVMParams(t){var s;const{graphic:e,_fieldInfoMap:i,_sourceLayer:r,_expressionAttributes:n}=this;if(t&&t.text){const o=(e==null?void 0:e.attributes)??{},a=((s=this.formattedAttributes)==null?void 0:s.global)??{};t.text=vS({attributes:o,fieldInfoMap:i,globalAttributes:a,expressionAttributes:n,layer:r,text:t.text})}return{graphic:e,creator:t.text}}_compileText(t,e){const i=t.clone();return this.contentViewModels[e]=new OV(this._createTextVMParams(i)),i}_compileLastEditInfo(){const{_effectivePopupTemplate:t,_sourceLayer:e,graphic:i}=this;if(!t)return;const{lastEditInfoEnabled:r}=t,n=e==null?void 0:e.editFieldsInfo;return r&&n?pet(n,i==null?void 0:i.attributes):void 0}_compileTitle(t){var a;const{_fieldInfoMap:e,_sourceLayer:i,graphic:r,_expressionAttributes:n}=this,s=(r==null?void 0:r.attributes)??{},o=((a=this.formattedAttributes)==null?void 0:a.global)??{};return vS({attributes:s,fieldInfoMap:e,globalAttributes:o,expressionAttributes:n,layer:i,text:t})}async _getTitle(){const{_effectivePopupTemplate:t,graphic:e}=this;if(!e)return null;const i=t==null?void 0:t.title;return MV(i,{graphic:e})}async _getContent(){const{_effectivePopupTemplate:t,graphic:e}=this;if(!e)return null;const i=t==null?void 0:t.content;return MV(i,{graphic:e})}async _queryFeature(t){const{_featureAbortController:e,_sourceLayer:i,graphic:r,_effectivePopupTemplate:n}=this,s=this.map,o=this.view,a=this.spatialReference;if(e!==this._featureAbortController||!r)return;await get({graphic:r,popupTemplate:n,layer:i,spatialReference:a},t);const{content:{value:l},title:{value:c}}=await ma({content:this._getContent(),title:this._getTitle()}),{expressionAttributes:{value:h}}=await ma({checkForRelatedFeatures:this._checkForRelatedFeatures(t),expressionAttributes:sut({expressionInfos:n==null?void 0:n.expressionInfos,spatialReference:a,graphic:r,map:s,interceptor:pI.interceptor,view:o})});e===this._featureAbortController&&r&&(this._expressionAttributes=h,this._graphicExpressionAttributes={...r.attributes,...h},this._set("formattedAttributes",this._createFormattedAttributes(l)),this._set("title",this._compileTitle(c)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(l)||null))}_createMediaFormattedAttributes({contentElement:t,contentElementIndex:e,formattedAttributes:i}){const{_effectivePopupTemplate:r,graphic:n,relatedInfos:s,_sourceLayer:o,_fieldInfoMap:a,_graphicExpressionAttributes:l}=this;i.content[e]=lG({fieldInfos:r==null?void 0:r.fieldInfos,graphic:n,attributes:{...l,...t.attributes},layer:o,fieldInfoMap:a,relatedInfos:s})}_createFieldsFormattedAttributes({contentElement:t,contentElementIndex:e,formattedAttributes:i}){if(t.fieldInfos){const{graphic:r,relatedInfos:n,_sourceLayer:s,_fieldInfoMap:o,_graphicExpressionAttributes:a}=this;i.content[e]=lG({fieldInfos:t.fieldInfos,graphic:r,attributes:{...a,...t.attributes},layer:s,fieldInfoMap:o,relatedInfos:n})}}_createFormattedAttributes(t){const{_effectivePopupTemplate:e,graphic:i,relatedInfos:r,_sourceLayer:n,_fieldInfoMap:s,_graphicExpressionAttributes:o}=this,a=e==null?void 0:e.fieldInfos,l={global:lG({fieldInfos:a,graphic:i,attributes:o,layer:n,fieldInfoMap:s,relatedInfos:r}),content:[]};return Array.isArray(t)&&t.forEach((c,h)=>{c.type==="fields"&&this._createFieldsFormattedAttributes({contentElement:c,contentElementIndex:h,formattedAttributes:l}),c.type==="media"&&this._createMediaFormattedAttributes({contentElement:c,contentElementIndex:h,formattedAttributes:l})}),l}_checkForRelatedFeatures(t){const{graphic:e,_effectivePopupTemplate:i}=this;return this._queryRelatedInfos(e,_pe(i),t)}async _queryRelatedInfos(t,e,i){const{relatedInfos:r,_sourceLayer:n}=this;r.clear();const s=v(n==null?void 0:n.associatedLayer)?await(n==null?void 0:n.associatedLayer.load(i)):n;if(!s||!t)return;const o=e.filter(c=>c&&Y0(c.fieldName));if(!o||!o.length)return;e.forEach(c=>this._configureRelatedInfo(c,s));const a=await Srt({relatedInfos:r,layer:s},i);Object.keys(a).forEach(c=>{var f;const h=r.get(c.toString()),p=(f=a[c])==null?void 0:f.value;h&&p&&(h.layerInfo=p.data)});const l=await Ert({graphic:t,relatedInfos:r,layer:s},i);Object.keys(l).forEach(c=>{var h;vrt((h=l[c])==null?void 0:h.value,r.get(c.toString()))})}_configureRelatedInfo(t,e){const{relatedInfos:i}=this,r=V6(t.fieldName);if(!r)return;const{layerId:n,fieldName:s}=r;if(!n)return;const o=i.get(n.toString())||_rt(n,e);o&&(Crt({relatedInfo:o,fieldName:s,fieldInfo:t}),this.relatedInfos.set(n,o))}};Gn.interceptor=new lut(vet,bet),u([d()],Gn.prototype,"_error",void 0),u([d()],Gn.prototype,"_featureAbortController",void 0),u([d({readOnly:!0})],Gn.prototype,"_effectivePopupTemplate",null),u([d({readOnly:!0})],Gn.prototype,"_fieldInfoMap",null),u([d({readOnly:!0})],Gn.prototype,"_sourceLayer",null),u([d()],Gn.prototype,"abilities",void 0),u([ri("abilities")],Gn.prototype,"castAbilities",null),u([d({readOnly:!0})],Gn.prototype,"content",void 0),u([d({readOnly:!0})],Gn.prototype,"contentViewModels",void 0),u([d()],Gn.prototype,"description",void 0),u([d({type:Boolean})],Gn.prototype,"defaultPopupTemplateEnabled",void 0),u([d({readOnly:!0})],Gn.prototype,"isTable",null),u([d({readOnly:!0})],Gn.prototype,"state",null),u([d({readOnly:!0})],Gn.prototype,"formattedAttributes",void 0),u([d({type:Ha,value:null})],Gn.prototype,"graphic",null),u([d({readOnly:!0})],Gn.prototype,"lastEditInfo",void 0),u([d({readOnly:!0})],Gn.prototype,"relatedInfos",void 0),u([d()],Gn.prototype,"spatialReference",null),u([d({readOnly:!0})],Gn.prototype,"title",void 0),u([d()],Gn.prototype,"map",null),u([d({readOnly:!0})],Gn.prototype,"waitingForContent",null),u([d()],Gn.prototype,"view",void 0),Gn=pI=u([$("esri.widgets.FeatureViewModel")],Gn);const Ioe=Gn,Ya="esri-feature",vs={iconText:"esri-icon-font-fallback-text",iconLoading:"esri-icon-loading-indicator esri-rotating",esriTable:"esri-widget__table",esriWidget:"esri-widget",base:Ya,container:`${Ya}__size-container`,title:`${Ya}__title`,main:`${Ya}__main-container`,btn:`${Ya}__button`,icon:`${Ya}__icon`,content:`${Ya}__content`,contentNode:`${Ya}__content-node`,contentElement:`${Ya}__content-element`,text:`${Ya}__text`,lastEditedInfo:`${Ya}__last-edited-info`,fields:`${Ya}__fields`,fieldHeader:`${Ya}__field-header`,fieldData:`${Ya}__field-data`,fieldDataDate:`${Ya}__field-data--date`,loadingSpinnerContainer:`${Ya}__loading-container`,spinner:`${Ya}__loading-spinner`},KPe=t=>{let e=class extends t{constructor(){super(...arguments),this.renderNodeContent=i=>IV(i)&&!i.destroyed?te("div",{class:vs.contentNode,key:i},i.render()):i instanceof HTMLElement?te("div",{class:vs.contentNode,key:i,bind:i,afterCreate:this._attachToNode}):VMe(i)?te("div",{class:vs.contentNode,key:i,bind:i.domNode,afterCreate:this._attachToNode}):null}_attachToNode(i){const r=this;i.appendChild(r)}};return e=u([$("esri.widgets.Feature.ContentMixin")],e),e};var cQ;const Pme={title:!0,content:!0,lastEditedInfo:!0},Ime="relationship-handles";let ia=cQ=class extends KPe(Sa){constructor(t,e){super(t,e),this._contentWidgets=[],this.flowItems=null,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.messagesURIUtils=null,this.visibleElements={...Pme},this.viewModel=new Ioe}initialize(){this.addHandles(ne(()=>{var t;return(t=this.viewModel)==null?void 0:t.contentViewModels},()=>this._setupContentWidgets(),zt))}loadDependencies(){return Q(()=>import("./calcite-notice-7f3c5370.js"),[])}destroy(){this._destroyContentWidgets()}get graphic(){return this.viewModel.graphic}set graphic(t){this.viewModel.graphic=t}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(t){this.viewModel.defaultPopupTemplateEnabled=t}get isTable(){return this.viewModel.isTable}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(t){this.viewModel.spatialReference=t}get title(){return this.viewModel.title}castVisibleElements(t){return{...Pme,...t}}get map(){return this.viewModel.map}set map(t){this.viewModel.map=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}render(){const{state:t}=this.viewModel,e=te("div",{class:vs.container,key:"container"},this.renderTitle(),t==="error"?this.renderError():t==="loading"?this.renderLoading():this.renderContentContainer());return te("div",{class:this.classes(vs.base,vs.esriWidget)},e)}setActiveMedia(t,e){return this.viewModel.setActiveMedia(t,e)}nextMedia(t){return this.viewModel.nextMedia(t)}previousMedia(t){return this.viewModel.previousMedia(t)}renderError(){const{messagesCommon:t,messages:e,visibleElements:i}=this;return te("calcite-notice",{open:!0,kind:"danger",icon:"exclamation-mark-circle",scale:"s"},i.title?te("div",{key:"error-title",slot:"title"},t.errorMessage):null,te("div",{key:"error-message",slot:"message"},e.loadingError))}renderLoading(){return te("div",{key:"loading-container",class:vs.loadingSpinnerContainer},te("span",{class:this.classes(vs.iconLoading,vs.spinner)}))}renderContentContainer(){const{visibleElements:t}=this;return t.content?te("div",{class:vs.main},[this.renderContent(),this.renderLastEditInfo()]):null}renderTitle(){const{visibleElements:t,title:e}=this;return t.title?te(Dse,{level:this.headingLevel,class:vs.title,innerHTML:e}):null}renderContent(){const t=this.viewModel.content,e="content";if(!t)return null;if(Array.isArray(t))return t.length?te("div",{class:vs.contentNode,key:`${e}-content-elements`},t.map(this.renderContentElement,this)):null;if(typeof t=="string"){const i=this._contentWidgets[0];return!i||i.destroyed?null:te("div",{class:vs.contentNode,key:`${e}-content`},i.render())}return this.renderNodeContent(t)}renderContentElement(t,e){var r;const{visibleElements:i}=this;if(typeof i.content!="boolean"&&!((r=i.content)!=null&&r[t.type]))return null;switch(t.type){case"attachments":return this.renderAttachments(e);case"custom":return this.renderCustom(t,e);case"fields":return this.renderFields(e);case"media":return this.renderMedia(e);case"text":return this.renderText(t,e);case"expression":return this.renderExpression(e);case"relationship":return this.renderRelationship(e);default:return null}}renderAttachments(t){const e=this._contentWidgets[t];if(!e||e.destroyed)return null;const{state:i,attachmentInfos:r}=e.viewModel;return i==="loading"||r.length>0?te("div",{key:this._buildKey("attachments-element",t),class:this.classes(vs.contentElement)},e.render()):null}renderRelationship(t){const e=this._contentWidgets[t];return e&&!e.destroyed&&this.flowItems?te("div",{key:this._buildKey("relationship-element",t),class:vs.contentElement},e.render()):null}renderExpression(t){const e=this._contentWidgets[t];return!e||e.destroyed?null:te("div",{key:this._buildKey("expression-element",t),class:vs.contentElement},e.render())}renderCustom(t,e){const{creator:i}=t,r=this._contentWidgets[e];return!r||r.destroyed?null:i?te("div",{key:this._buildKey("custom-element",e),class:vs.contentElement},r.render()):null}renderFields(t){const e=this._contentWidgets[t];return!e||e.destroyed?null:te("div",{key:this._buildKey("fields-element",t),class:vs.contentElement},e.render())}renderMedia(t){const e=this._contentWidgets[t];return!e||e.destroyed?null:te("div",{key:this._buildKey("media-element",t),class:vs.contentElement},e.render())}renderLastEditInfo(){const{visibleElements:t,messages:e}=this,{lastEditInfo:i}=this.viewModel;if(!i||!t.lastEditedInfo)return null;const{date:r,user:n}=i,s=i.type==="edit"?n?e.lastEditedByUser:e.lastEdited:n?e.lastCreatedByUser:e.lastCreated,o=Lf(s,{date:r,user:n});return te("div",{key:"edit-info-element",class:this.classes(vs.lastEditedInfo,vs.contentElement)},o)}renderText(t,e){const i=t.text,r=this._contentWidgets[e];return!r||r.destroyed?null:i?te("div",{key:this._buildKey("text-element",e),class:this.classes(vs.contentElement,vs.text)},r.render()):null}_buildKey(t,...e){return`${t}__${this.get("viewModel.graphic.uid")||"0"}-${e.join("-")}`}_destroyContentWidget(t){t&&(t.viewModel=null,!t.destroyed&&t.destroy())}_destroyContentWidgets(){this.removeHandles(Ime),this._contentWidgets.forEach(t=>this._destroyContentWidget(t)),this._contentWidgets=[]}_addFeatureRelationshipHandles(t){const{flowItems:e,visibleElements:i}=this;this.addHandles([Kn(()=>t,"select-record",({featureViewModel:r})=>{e&&(r.abilities={relationshipContent:!0},e.push(new cQ({flowItems:e,viewModel:r,visibleElements:i})))}),Kn(()=>t,"show-all-records",()=>{if(!e)return;const{viewModel:r}=t;r.showAllEnabled=!0;const n=new Ame({visibleElements:{title:!1,description:!1},viewModel:r});this._addFeatureRelationshipHandles(n),e.push(n)})],Ime)}_setupContentWidgets(){this._destroyContentWidgets();const{headingLevel:t,visibleElements:e}=this,i=this.get("viewModel.content"),{contentViewModels:r}=this.viewModel;if(Array.isArray(i))i.forEach((n,s)=>{if(n.type==="attachments"&&(this._contentWidgets[s]=new Oet({displayType:n.displayType,headingLevel:e.title?t+1:t,viewModel:r[s]})),n.type==="fields"&&(this._contentWidgets[s]=new zMe({viewModel:r[s]})),n.type==="media"&&(this._contentWidgets[s]=new POe({viewModel:r[s]})),n.type==="text"&&(this._contentWidgets[s]=new D6({viewModel:r[s]})),n.type==="custom"&&(this._contentWidgets[s]=new D6({viewModel:r[s]})),n.type==="expression"&&(this._contentWidgets[s]=new aut({viewModel:r[s]})),n.type==="relationship"){const o=new Ame({viewModel:r[s]});this._addFeatureRelationshipHandles(o),this._contentWidgets[s]=o}},this);else{const n=r[0];n&&!n.destroyed&&(this._contentWidgets[0]=new D6({viewModel:n}))}this.scheduleRender()}};u([d()],ia.prototype,"graphic",null),u([d()],ia.prototype,"defaultPopupTemplateEnabled",null),u([d()],ia.prototype,"flowItems",void 0),u([d()],ia.prototype,"headingLevel",void 0),u([d({readOnly:!0})],ia.prototype,"isTable",null),u([d()],ia.prototype,"label",null),u([d(),Go("esri/widgets/Feature/t9n/Feature")],ia.prototype,"messages",void 0),u([d(),Go("esri/t9n/common")],ia.prototype,"messagesCommon",void 0),u([d(),Go("esri/widgets/support/t9n/uriUtils")],ia.prototype,"messagesURIUtils",void 0),u([d()],ia.prototype,"spatialReference",null),u([d({readOnly:!0})],ia.prototype,"title",null),u([d()],ia.prototype,"visibleElements",void 0),u([ri("visibleElements")],ia.prototype,"castVisibleElements",null),u([d()],ia.prototype,"map",null),u([d()],ia.prototype,"view",null),u([d({type:Ioe})],ia.prototype,"viewModel",void 0),ia=cQ=u([$("esri.widgets.Feature")],ia);const uut=ia;var QPe;const oU=Symbol("anchorHandles");let yT=class extends An.EventedAccessor{constructor(e){super(e),this[QPe]=new Xi,this.location=null,this.screenLocationEnabled=!1,this.view=null,this[oU].add([yo(()=>Vo(this.screenLocationEnabled?this.view:null,i=>[i.size,i.type==="3d"?i.camera:i.viewpoint]),()=>this.notifyChange("screenLocation")),ne(()=>this.screenLocation,(i,r)=>{v(i)&&v(r)&&this.emit("view-change")})])}destroy(){this.view=null,this[oU]=Ve(this[oU])}get screenLocation(){var n;const{location:e,view:i,screenLocationEnabled:r}=this;return r&&v(e)&&v(i)&&i.ready?(n=i.toScreen)==null?void 0:n.call(i,e):null}};QPe=oU,u([d()],yT.prototype,"location",void 0),u([d()],yT.prototype,"screenLocation",null),u([d()],yT.prototype,"screenLocationEnabled",void 0),u([d()],yT.prototype,"view",void 0),yT=u([$("esri.widgets.support.AnchorElementViewModel")],yT);const eIe=yT,hut="esri.widgets.CompassViewModel";let aU=class extends eIe{constructor(e){super(e),this.visible=!1}};u([d()],aU.prototype,"visible",void 0),aU=u([$(hut)],aU);const tIe=aU,QG="esri-spinner",eH={base:QG,spinnerStart:`${QG}--start`,spinnerFinish:`${QG}--finish`};let _T=class extends Sa{constructor(e,i){super(e,i),this._animationDelay=500,this._animationPromise=null,this.viewModel=new tIe}initialize(){this.addHandles(ne(()=>this.visible,e=>this._visibleChange(e)))}destroy(){this._animationPromise=null}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}show(e){const{location:i,promise:r}=e??{};i&&(this.viewModel.location=i),this.visible=!0;const n=()=>this.hide();r&&r.catch(()=>{}).then(n)}hide(){this.visible=!1}render(){const{visible:e}=this,{screenLocation:i}=this.viewModel,r=!!i,n=e&&r,s=!e&&r,o={[eH.spinnerStart]:n,[eH.spinnerFinish]:s},a=this._getPositionStyles();return te("div",{class:this.classes(eH.base,o),styles:a})}_visibleChange(e){if(e)return void(this.viewModel.screenLocationEnabled=!0);const i=t2(this._animationDelay);this._animationPromise=i,i.catch(()=>{}).then(()=>{this._animationPromise===i&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)})}_getPositionStyles(){const{screenLocation:e,view:i}=this.viewModel;if(R(i)||R(e))return{};const{padding:r}=i;return{left:e.x-r.left+"px",top:e.y-r.top+"px"}}};u([d()],_T.prototype,"location",null),u([d()],_T.prototype,"view",null),u([d({type:tIe})],_T.prototype,"viewModel",void 0),u([d()],_T.prototype,"visible",null),_T=u([$("esri.widgets.Spinner")],_T);const dut=_T,LB={iconZoom:"esri-icon-zoom-in-magnifying-glass",iconTrash:"esri-icon-trash",iconBrowseClusteredFeatures:"esri-icon-table"},wS=new mO({id:"zoom-to-feature",title:"{messages.zoom}",className:LB.iconZoom}),$me=new mO({id:"remove-selected-feature",title:"{messages.remove}",className:LB.iconTrash}),iR=new mO({id:"zoom-to-clustered-features",title:"{messages.zoom}",className:LB.iconZoom}),rR=new mO({id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:LB.iconBrowseClusteredFeatures}),put="esri.widgets.Popup.PopupViewModel",BV=re.getLogger(put),fut=t=>{const{event:e,view:i}=t,{action:r}=e,n=i&&i.popup;if(!r)return Promise.reject(new H("trigger-action:missing-arguments","Event has no action"));if(!n)return Promise.reject(new H("trigger-action:missing-arguments","view.popup is missing"));const{disabled:s,id:o}=r;if(!o)return Promise.reject(new H("trigger-action:invalid-action","action.id is missing"));if(s)return Promise.reject(new H("trigger-action:invalid-action","Action is disabled"));if(o===wS.id)return gut(n.viewModel).catch(fY);if(o===iR.id)return yut(n.viewModel);if(o===rR.id)return n.featureMenuOpen=!n.featureMenuOpen,n.viewModel.browseClusterEnabled=!n.viewModel.browseClusterEnabled,Promise.resolve();if(n.viewModel.browseClusterEnabled=!1,o===$me.id){n.close();const{selectedFeature:a}=n;if(!a)return Promise.reject(new H(`trigger-action:${$me.id}`,"selectedFeature is required",{selectedFeature:a}));const{sourceLayer:l}=a;return l?l.remove(a):i.graphics.remove(a),Promise.resolve()}return Promise.resolve()};function iIe(t){const{selectedFeature:e,location:i,view:r}=t;return r?r.type==="3d"?e??i??null:t.get("selectedFeature.geometry")||i:null}function KT(t){var e,i;return!!t&&t.isAggregate&&((i=(e=t.sourceLayer)==null?void 0:e.featureReduction)==null?void 0:i.type)==="cluster"}async function mut(t,e){if((e==null?void 0:e.type)!=="3d"||!t||t.declaredClass!=="esri.Graphic")return!0;const i=e.getViewForGraphic(t);if(i&&"whenGraphicBounds"in i){let r;try{r=await i.whenGraphicBounds(t,{useViewElevation:!0})}catch{}return!r||!r.boundingBox||r.boundingBox[0]===r.boundingBox[3]&&r.boundingBox[1]===r.boundingBox[4]&&r.boundingBox[2]===r.boundingBox[5]}return!0}async function gut(t){var h;const{location:e,selectedFeature:i,view:r,zoomFactor:n}=t,s=iIe(t);if(!r||!s){const p=new H("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:s,view:r});throw BV.error(p),p}const o=r.scale/n,a=(h=t.selectedFeature)==null?void 0:h.geometry,l=a??e,c=v(l)&&l.type==="point"&&await mut(i,r);wS.active=!0,wS.disabled=!0;try{await t.zoomTo({target:{target:s,scale:c?o:void 0}})}catch{const f=new H("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:i});BV.error(f)}finally{wS.active=!1,wS.disabled=!1,t.zoomToLocation=null,c&&(t.location=l)}}async function yut(t){const{selectedFeature:e,view:i}=t;if((i==null?void 0:i.type)!=="2d"){const o=new H("zoomToCluster:invalid-view","View must be 2d MapView.",{view:i});throw BV.error(o),o}if(!e||!KT(e)){const o=new H("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:e});throw BV.error(o),o}const[r,n]=await $oe(i,e);iR.active=!0,iR.disabled=!0;const{extent:s}=await r.queryExtent(n);await t.zoomTo({target:s}),iR.active=!1,iR.disabled=!1}async function _ut(t){const{view:e,selectedFeature:i}=t;if(!e||!i)return;const[r,n]=await $oe(e,i),{extent:s}=await r.queryExtent(n);t.selectedClusterBoundaryFeature.geometry=s,e.graphics.add(t.selectedClusterBoundaryFeature)}async function vut(t){var o;const{selectedFeature:e,view:i}=t;if(!i||!e)return;const[r,n]=await $oe(i,e);rR.active=!0,rR.disabled=!0;const{features:s}=await r.queryFeatures(n);rR.active=!1,rR.disabled=!1,(o=i.popup)==null||o.open({features:[e].concat(s),featureMenuOpen:!0})}async function $oe(t,e){const i=await t.whenLayerView(e.sourceLayer),r=i.createQuery(),n=e.getObjectId();return r.aggregateIds=n!=null?[n]:[],[i,r]}function but(t){const e=t.features.filter(i=>KT(i));e.length&&(t.features=e)}function rIe(t){var e;if(R(t))return null;switch(t.type){case"point":return t;case"extent":return t.center;case"polygon":return t.centroid;case"multipoint":case"polyline":return(e=t.extent)==null?void 0:e.center;default:return null}}const Vt="esri-popup",C3=`${Vt}__header`,Kw=`${Vt}--is-docked`,Ae={calciteThemeLight:"calcite-mode-light",calciteThemeDark:"calcite-mode-dark",iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow",iconDockToTop:"esri-icon-maximize",iconDockToBottom:"esri-icon-dock-bottom",iconDockToLeft:"esri-icon-dock-left",iconDockToRight:"esri-icon-dock-right",iconClose:"esri-icon-close",iconUndock:"esri-icon-minimize",iconCheckMark:"esri-icon-check-mark",iconLoading:"esri-icon-loading-indicator",iconDefaultAction:"esri-icon-default-action",iconActionsMenu:"esri-icon-handle-horizontal",rotating:"esri-rotating",base:Vt,widget:"esri-widget",main:`${Vt}__main-container`,loadingContainer:`${Vt}__loading-container`,isCollapsible:`${Vt}--is-collapsible`,isCollapsed:`${Vt}--is-collapsed`,shadow:`${Vt}--shadow`,isDocked:Kw,isDockedTopLeft:`${Kw}-top-left`,isDockedTopCenter:`${Kw}-top-center`,isDockedTopRight:`${Kw}-top-right`,isDockedBottomLeft:`${Kw}-bottom-left`,isDockedBottomCenter:`${Kw}-bottom-center`,isDockedBottomRight:`${Kw}-bottom-right`,alignTopCenter:`${Vt}--aligned-top-center`,alignBottomCenter:`${Vt}--aligned-bottom-center`,alignTopLeft:`${Vt}--aligned-top-left`,alignBottomLeft:`${Vt}--aligned-bottom-left`,alignTopRight:`${Vt}--aligned-top-right`,alignBottomRight:`${Vt}--aligned-bottom-right`,isFeatureMenuOpen:`${Vt}--feature-menu-open`,isActionsMenuOpen:`${Vt}--actions-menu-open`,hasFeatureUpdated:`${Vt}--feature-updated`,header:C3,headerButtons:`${C3}-buttons`,headerContainer:`${C3}-container`,headerContainerButton:`${C3}-container--button`,headerTitle:`${C3}-title`,content:`${Vt}__content`,contentHasFlows:"esri-content--has-flows",contentFlowItem:"esri-content__flow-item",footer:`${Vt}__footer`,footerHasPagination:`${Vt}__footer--has-pagination`,footerHasActions:`${Vt}__footer--has-actions`,footerHasActionsMenu:`${Vt}__footer--has-actions-menu`,button:`${Vt}__button`,buttonDisabled:`${Vt}__button--disabled`,buttonDock:`${Vt}__button--dock`,icon:`${Vt}__icon`,iconDock:`${Vt}__icon--dock-icon`,inlineActionsContainer:`${Vt}__inline-actions-container`,actionsMenuButton:`${Vt}__actions-menu-button`,actions:`${Vt}__actions`,action:`${Vt}__action`,actionImage:`${Vt}__action-image`,actionText:`${Vt}__action-text`,actionToggle:`${Vt}__action-toggle`,actionToggleOn:`${Vt}__action-toggle--on`,actionExit:`${Vt}__action--exit`,actionSelectFeature:`${Vt}__action--select-feature`,pointer:`${Vt}__pointer`,pointerDirection:`${Vt}__pointer-direction`,navigation:`${Vt}__navigation`,paginationPrevious:`${Vt}__pagination-previous`,paginationNext:`${Vt}__pagination-next`,paginationPreviousIconLTR:`${Vt}__pagination-previous-icon`,paginationPreviousIconRTL:`${Vt}__pagination-previous-icon--rtl`,paginationNextIconLTR:`${Vt}__pagination-next-icon`,paginationNextIconRTL:`${Vt}__pagination-next-icon--rtl`,featureMenu:`${Vt}__feature-menu`,featureMenuList:`${Vt}__feature-menu-list`,featureMenuItem:`${Vt}__feature-menu-item`,featureMenuViewport:`${Vt}__feature-menu-viewport`,featureMenuHeader:`${Vt}__feature-menu-header`,featureMenuNote:`${Vt}__feature-menu-note`,featureMenuSelected:`${Vt}__feature-menu-item--selected`,featureMenuButton:`${Vt}__feature-menu-button`,featureMenuTitle:`${Vt}__feature-menu-title`,featureMenuObserver:`${Vt}__feature-menu-observer`,featureMenuLoader:`${Vt}__feature-menu-loader`,collapseButton:`${Vt}__collapse-button`,collapseIcon:`${Vt}__collapse-icon`},nIe="OBJECTID";var y2;(function(t){t[t.size=22]="size",t[t.lineWidth=50]="lineWidth",t[t.maxSize=120]="maxSize",t[t.maxOutlineSize=80]="maxOutlineSize",t[t.tallSymbolWidth=20]="tallSymbolWidth"})(y2||(y2={}));function sIe(){const t=new Float32Array(6);return t[0]=1,t[3]=1,t}function wut(t){const e=new Float32Array(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function xut(t,e,i,r,n,s){const o=new Float32Array(6);return o[0]=t,o[1]=e,o[2]=i,o[3]=r,o[4]=n,o[5]=s,o}function Tut(t,e){return new Float32Array(t,e,6)}function oIe(t,e,i,r){const n=e[r],s=e[r+1];t[r]=i[0]*n+i[2]*s+i[4],t[r+1]=i[1]*n+i[3]*s+i[5]}function Sut(t,e,i,r=0,n=0,s=2){const o=n||e.length/s;for(let a=r;a<o;a++)oIe(t,e,i,a*s)}Object.freeze(Object.defineProperty({__proto__:null,clone:wut,create:sIe,createView:Tut,fromValues:xut,transform:oIe,transformMany:Sut},Symbol.toStringTag,{value:"Module"}));function Eut(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Cut(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function Aut(t,e,i,r,n,s,o){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=s,t[5]=o,t}function Loe(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5];let l=i*s-r*n;return l?(l=1/l,t[0]=s*l,t[1]=-r*l,t[2]=-n*l,t[3]=i*l,t[4]=(n*a-s*o)*l,t[5]=(r*o-i*a)*l,t):null}function Rut(t){return t[0]*t[3]-t[1]*t[2]}function aIe(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=i[0],h=i[1],p=i[2],f=i[3],m=i[4],g=i[5];return t[0]=r*c+s*h,t[1]=n*c+o*h,t[2]=r*p+s*f,t[3]=n*p+o*f,t[4]=r*m+s*g+a,t[5]=n*m+o*g+l,t}function DB(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=Math.sin(i),h=Math.cos(i);return t[0]=r*h+s*c,t[1]=n*h+o*c,t[2]=r*-c+s*h,t[3]=n*-c+o*h,t[4]=a,t[5]=l,t}function Doe(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=i[0],h=i[1];return t[0]=r*c,t[1]=n*c,t[2]=s*h,t[3]=o*h,t[4]=a,t[5]=l,t}function hD(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=i[0],h=i[1];return t[0]=r,t[1]=n,t[2]=s,t[3]=o,t[4]=r*c+s*h+a,t[5]=n*c+o*h+l,t}function lIe(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t[4]=0,t[5]=0,t}function cIe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function Noe(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function Mut(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function Out(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+1)}function Put(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t}function uIe(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t}function Iut(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t}function $ut(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t}function Lut(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function Dut(t,e){const i=t[0],r=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=e[0],c=e[1],h=e[2],p=e[3],f=e[4],m=e[5],g=bl();return Math.abs(i-l)<=g*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(r-c)<=g*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(n-h)<=g*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(s-p)<=g*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(o-f)<=g*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(a-m)<=g*Math.max(1,Math.abs(a),Math.abs(m))}const Nut=aIe,Fut=uIe;Object.freeze(Object.defineProperty({__proto__:null,add:Put,copy:Eut,determinant:Rut,equals:Dut,exactEquals:Lut,frob:Out,fromRotation:lIe,fromScaling:cIe,fromTranslation:Noe,identity:Cut,invert:Loe,mul:Nut,multiply:aIe,multiplyScalar:Iut,multiplyScalarAndAdd:$ut,rotate:DB,scale:Doe,set:Aut,str:Mut,sub:Fut,subtract:uIe,translate:hD},Symbol.toStringTag,{value:"Module"}));const Lme=ue("android");ue("chrome")||Lme&&Lme>=4;_J();function v7t(t){return t=t||globalThis.location.hostname,Uut.some(e=>(t==null?void 0:t.match(e))!=null)}function kut(t,e){return t&&(e=e||globalThis.location.hostname)?e.match(hIe)!=null||e.match(pIe)!=null?t.replace("static.arcgis.com","staticdev.arcgis.com"):e.match(dIe)!=null||e.match(fIe)!=null?t.replace("static.arcgis.com","staticqa.arcgis.com"):t:t}const hIe=/^devext.arcgis.com$/,dIe=/^qaext.arcgis.com$/,pIe=/^[\w-]*\.mapsdevext.arcgis.com$/,fIe=/^[\w-]*\.mapsqa.arcgis.com$/,Uut=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,hIe,dIe,/^jsapps.esri.com$/,pIe,fIe];y2.size;y2.maxSize;y2.maxOutlineSize;y2.lineWidth;y2.tallSymbolWidth;function mIe(t){return t&&"opacity"in t?t.opacity*mIe(t.parent):1}async function Vut(t,e){if(!t)return;const i=t.sourceLayer,r=(v(e)&&e.useSourceLayer?i:t.layer)??i,n=mIe(r);if(v(t.symbol)&&(!v(e)||e.ignoreGraphicSymbol!==!0)){const b=t.symbol.type==="web-style"?await Wtt(t.symbol,{...e,cache:v(e)?e.webStyleCache:null}):t.symbol.clone();return fG(b,null,n),b}const s=(v(e)?e.renderer:null)??(r&&"renderer"in r?r.renderer:null);let o=s&&"getSymbolAsync"in s?await s.getSymbolAsync(t,e):null;if(!o)return;if(o=o.type==="web-style"?await o.fetchSymbol({...e,cache:v(e)?e.webStyleCache:null}):o.clone(),!(s&&"visualVariables"in s&&s.visualVariables&&s.visualVariables.length))return fG(o,null,n),o;if("arcadeRequiredForVisualVariables"in s&&s.arcadeRequiredForVisualVariables&&(R(e)||R(e.arcade))){const b={...e};b.arcade=await cy(),e=b}const a=await Q(()=>Promise.resolve().then(()=>ooe),void 0),l=[],c=[],h=[],p=[];for(const b of s.visualVariables)switch(b.type){case"color":l.push(b);break;case"opacity":c.push(b);break;case"rotation":p.push(b);break;case"size":b.target||h.push(b)}const f=!!l.length&&l[l.length-1],m=f?a.getColor(f,t,e):null,g=!!c.length&&c[c.length-1];let _=g?a.getOpacity(g,t,e):null;if(n!=null&&(_=_!=null?_*n:n),fG(o,m,_),h.length){const b=a.getAllSizes(h,t,e);await Htt(o,b)}for(const b of p)qtt(o,a.getRotationAngle(b,t,e),b.axis);return o}let O_=class{constructor(e,i){this._owner=i,this._properties={},this._afterDispatchHandle=null;for(const r in e){const n=e[r],s=new h2e(n,void 0,void 0,2,2);this._properties[r]={pool:s,acquired:[]}}this._afterDispatchHandle=S2e(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const e in this._properties){const i=this._properties[e];for(const r of i.acquired)khe(r)||i.pool.release(r);i.pool.destroy(),i.pool=null,i.acquired=null}this._properties=null,this._owner=null}get(e){const i=this._owner._get(e),r=this._properties[e];let n=r.pool.acquire();for(r.acquired.push(n);n===i;)r.acquired.push(n),n=r.pool.acquire();return n}_release(){for(const e in this._properties){const i=this._properties[e];let r=0;for(const n of i.acquired)khe(n)?i.acquired[r++]=n:i.pool.release(n);i.acquired.length=r}}};const zut=ue("mac")?"Meta":"Ctrl",NB={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let t=48;t<58;t++)NB[t]=String.fromCharCode(t);for(let t=1;t<25;t++)NB[111+t]=`F${t}`;for(let t=65;t<91;t++)NB[t]=[String.fromCharCode(t+32),String.fromCharCode(t)];function But(t){if(t.key!==void 0)return up(t);const e=NB[t.keyCode];return Array.isArray(e)?t.shiftKey?e[1]:e[0]:e}function jut(t){switch(t){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}let Gut=class{constructor(e,i=[]){this.eventType=e,this.keyModifiers=i}matches(e){if(e.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const i=e.modifiers;for(const r of this.keyModifiers)if(!i.has(r))return!1;return!0}};const Dme=re.getLogger("esri.views.input.InputHandler");let an=class{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const i=this._incoming[e];for(const r of i)this._incomingEventMatches.push(r.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(e=>e.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager?Dme.error("This InputHandler has already been registered with an InputManager"):(e.setEventCallback(i=>this._handleEvent(i)),e.setUninstallCallback(()=>this._onUninstall()),this._manager=e)}onUninstall(){}registerIncoming(e,i,r){let n;typeof i=="function"?(r=i,n=[]):n=i||[];const s=typeof e=="string"?new Gut(e,n):e,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=h=>{const p=this._incoming[h.match.eventType];if(p){const f=p.indexOf(h);p.splice(f,1),o(),this._manager&&this._manager.updateDependencies()}},l=new Hut(s,r,{onPause:a,onRemove:a,onResume:h=>{const p=this._incoming[h.match.eventType];p&&!p.includes(h)&&(p.push(h),o(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[s.eventType];return c||(c=[],this._incoming[s.eventType]=c),c.push(l),o(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(e){if(this._outgoing[e])throw new Error("There is already a callback registered for this outgoing InputEvent: "+e);const i=new qut(e,{onEmit:(r,n,s,o)=>{var a;(a=this._manager)==null||a.emit(r.eventType,n,s,o)},onRemove:r=>{var n;delete this._outgoing[r.eventType],(n=this._manager)==null||n.updateDependencies()}});return this._outgoing[e]=i,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),i}startCapturingPointer(e){var i;(i=this._manager)==null||i.setPointerCapture(e,!0)}stopCapturingPointer(e){var i;(i=this._manager)==null||i.setPointerCapture(e,!1)}refreshHasPendingInputs(){var e;(e=this._manager)==null||e.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):Dme.error("This InputHandler is not registered with an InputManager")}_handleEvent(e){var r;const i=this._incoming[e.type];if(i){for(const n of i)if(n.match.matches(e)&&((r=n.callback)==null||r.call(n,e),e.shouldStopPropagation()))break}}},Hut=class{constructor(e,i,r){this.match=e,this._callback=i,this._handler=r}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}},qut=class{constructor(e,i){this.eventType=e,this._removed=!1,this._handler=i}emit(e,i,r){this._removed||this._handler.onEmit(this,e,i,r)}remove(){this._removed=!0,this._handler.onRemove(this)}},Wut=class extends an{constructor(e){super(!0),this._onChange=e,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",i=>{this._update(i.data)})}_update(e){const i=e.native.pointerType==="touch"?"touch":"mouse",{x:r,y:n}=e;i===this._value&&this._x===r&&this._y===n||(this._value=i,this._x=r,this._y=n,this._onChange(i,r,n))}},jV=class{constructor(e){this._observable=new gne,this._value=e}get(){return Ei(this._observable),this._value}set(e){e!==this._value&&(this._value=e,this._observable.notify())}},Xut=class extends an{get multiTouchActive(){return this._multiTouchActive.get()}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=new jV(!1),this._onPointerAdd=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.add(e.native.pointerId),this._update())},this._onPointerRemove=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.delete(e.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.set(this._activeTouchPointerIds.size>1)}},Of=class extends ve{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=zut,this._latestPointerType="mouse",this._propertiesPool=new O_({latestPointerLocation:Jut},this),this.latestPointerLocation=null,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const i of e)this.uninstallHandlers(i);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}installHandlers(e,i,r=ey.INTERNAL){if(this._nameToGroup[e])return void re.getLogger(this.declaredClass).error("There is already an InputHandler group registered under the name `"+e+"`");if(i.length===0)return void re.getLogger(this.declaredClass).error("Can't register a group of zero handlers");const n={name:e,handlers:i.map(s=>({handler:s,active:!0,removed:!1,priorityIndex:0,groupPriority:r,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=n;for(let s=n.handlers.length-1;s>=0;s--){const o=n.handlers[s];this._handlers.push(o),o.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(a,l,c,h,p)=>{this._emitInputEvent(o.priorityIndex+1,a,l,c,p,h)},setPointerCapture:(a,l)=>{this._setPointerCapture(n,o,a,l)},setEventCallback:a=>{o.eventCallback=a},setUninstallCallback:a=>{o.uninstallCallback=a},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const i=this._nameToGroup[e];i?(i.handlers.forEach(r=>{var n;r.removed=!0,(n=r.uninstallCallback)==null||n.call(r)}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):re.getLogger(this.declaredClass).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,i=new Set;this._handlersPriority=[];for(let r=this._handlers.length-1;r>=0;r--){const n=this._handlers[r];n.priorityIndex=r,this._handlersPriority.push(n)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let r=this._handlersPriority.length-1;r>=0;r--){const n=this._handlersPriority[r];n.priorityIndex=r;let s=n.handler.hasSideEffects;if(!s){for(const o of n.handler.outgoingEventTypes)if(e.has(o)){s=!0;break}}if(s)for(const o of n.handler.incomingEventMatches){e.add(o.eventType);for(const a of o.keyModifiers)jut(a)||i.add(a)}n.active=s}this._sourceEvents=e,this._keyModifiers=i,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,i,r){this._latestPointerType=e;const n=this._get("latestPointerLocation");if(R(n)||n.x!==i||n.y!==r){const s=this._propertiesPool.get("latestPointerLocation");s.x=i,s.y=r,this._set("latestPointerLocation",s)}}_onEventReceived(e,i){if(e==="pointer-capture-lost"){const s=i;this._pointerCaptures.delete(s.native.pointerId)}this._updateKeyModifiers(e,i);const r=this.test.timestamp!=null?this.test.timestamp:i.native?i.native.timestamp:void 0,n=i.native?i.native.cancelable:void 0;this._emitInputEventFromSource(e,i,r,n)}_updateKeyModifiers(e,i){if(!i)return;let r=!1;const n=()=>{if(!r){const a=new Set;this._activeKeyModifiers.forEach(l=>{a.add(l)}),this._activeKeyModifiers=a,r=!0}},s=(a,l)=>{l&&!this._activeKeyModifiers.has(a)?(n(),this._activeKeyModifiers.add(a)):!l&&this._activeKeyModifiers.has(a)&&(n(),this._activeKeyModifiers.delete(a))};if(e==="key-down"||e==="key-up"){const a=i.key;this._keyModifiers.has(a)&&s(a,e==="key-down")}const o=i.native;s("Alt",!(!o||!o.altKey)),s("Ctrl",!(!o||!o.ctrlKey)),s("Shift",!(!o||!o.shiftKey)),s("Meta",!(!o||!o.metaKey)),s("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new Wut((e,i,r)=>this._setLatestPointer(e,i,r)),this._multiTouchHandler=new Xut,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],ey.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,ey.INTERNAL)}_setPointerCapture(e,i,r,n){const s=e.name+"-"+i.priorityIndex,o=this._pointerCaptures.get(r.pointerId)||new Set;this._pointerCaptures.set(r.pointerId,o),n?(o.add(s),o.size===1&&this.eventSource&&this.eventSource.setPointerCapture(r,!0)):o.has(s)&&(o.delete(s),o.size===0&&(this._pointerCaptures.delete(r.pointerId),this.eventSource&&this.eventSource.setPointerCapture(r,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,i,r,n){this._emitInputEvent(0,e,i,r,n)}_emitInputEvent(e,i,r,n,s,o){const a=n!==void 0?n:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),l=s!==void 0&&s,c={event:new Yut(i,r,a,o||this._activeKeyModifiers,l),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(c):this._doNewPropagation(c)}_doNewPropagation(e){this._currentPropagation={events:new dV,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){var i,r;const e=Nc(this._currentPropagation);for(;e.events.length>0;){const{event:n,priorityIndex:s}=e.events.pop(),o=n.data&&n.data.eventId;if(!(o!=null&&this._stoppedPropagationEventIds.has(o)))for(e.currentHandler=this._handlersPriority[s];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!n.shouldStopPropagation()&&((r=(i=e.currentHandler).eventCallback)==null||r.call(i,n)),n.shouldStopPropagation()){o!=null&&this._stoppedPropagationEventIds.add(o);break}if(n.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:n,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}_pausePropagation(e){const i=new dV;i.push(e);const r=this._currentPropagation;if(r){for(;r.events.length;)i.push(r.events.pop());r.events=i,r.currentHandler=null}}_compareHandlerPriority(e,i){if(e.handler.hasSideEffects!==i.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==i.groupPriority)return e.groupPriority>i.groupPriority?-1:1;for(const r of e.handler.incomingEventMatches)for(const n of i.handler.incomingEventMatches){if(r.eventType!==n.eventType)continue;const s=r.keyModifiers.filter(o=>n.keyModifiers.includes(o));if(s.length===r.keyModifiers.length!=(s.length===n.keyModifiers.length))return r.keyModifiers.length>n.keyModifiers.length?-1:1}return e.priorityIndex>i.priorityIndex?-1:1}_sortHandlersPriority(e){const i=[];for(const r of e){let n=0;for(;n<i.length&&this._compareHandlerPriority(r,i[n])>=0;)n++;i.splice(n,0,r)}return i}get debug(){const e=i=>{const r=this._setPointerCapture;this._setPointerCapture=()=>{},i(),this._setPointerCapture=r};return{injectEvent:(i,r)=>{e(()=>{this._onEventReceived(i,r)})},disablePointerCapture:e}}};u([d({readOnly:!0})],Of.prototype,"hasPendingInputs",null),u([d({constructOnly:!0})],Of.prototype,"eventSource",void 0),u([d({constructOnly:!0})],Of.prototype,"recognizers",void 0),u([d()],Of.prototype,"_latestPointerType",void 0),u([d()],Of.prototype,"latestPointerType",null),u([d()],Of.prototype,"multiTouchActive",null),u([d({readOnly:!0})],Of.prototype,"latestPointerLocation",void 0),Of=u([$("esri.views.input.InputManager")],Of);let Yut=class{constructor(e,i,r,n,s){this.type=e,this.data=i,this.timestamp=r,this.modifiers=n,this.cancelable=s,this._propagationState=B1.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=B1.STOPPED}shouldStopPropagation(){return(this._propagationState&B1.STOPPED)!=0}async(e){this._propagationState|=B1.PAUSED;const i=(r,n)=>{this._propagationState&=~B1.PAUSED;const s=this._resumeCallback;if(this._resumeCallback=null,s&&s(),n)throw r;return r};return(typeof e=="function"?e():e).then(r=>i(r,!1),r=>i(r,!0))}shouldPausePropagation(e){return!!(this._propagationState&B1.PAUSED)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}};var B1;(function(t){t[t.NONE=0]="NONE",t[t.STOPPED=1]="STOPPED",t[t.PAUSED=2]="PAUSED"})(B1||(B1={}));const ey={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};let Zut=class{};const Jut=Zut;function Nme(t){return t&&typeof t.highlight=="function"}function Kut(t){return t&&typeof t.maskOccludee=="function"}function P7t(t,e,i){return R(t)||t>i&&(e===0||t<e)}function I7t(t,e){return v(t)&&t>0||v(e)&&e>0}function $7t(t){const e=t.effectiveScaleRange;return{minScale:(e==null?void 0:e.minScale)??0,maxScale:(e==null?void 0:e.maxScale)??0}}const gIe=t=>{let e=class extends t{constructor(...i){super(...i),this.goToOverride=null,this.view=null}callGoTo(i){const{view:r}=this;return C9(r),this.goToOverride?this.goToOverride(r,i):r.goTo(i.target,i.options)}};return u([d()],e.prototype,"goToOverride",void 0),u([d()],e.prototype,"view",void 0),e=u([$("esri.widgets.support.GoTo")],e),e},B$=tt.ofType({key:"type",defaultKeyValue:"button",base:z9,typeMap:{button:mO,toggle:qEe}}),Qut=()=>[wS.clone()],eht=()=>[iR.clone(),rR.clone()];let Zi=class extends gIe(eIe){get isLoadingFeature(){return this.featureViewModels.some(e=>e.waitingForContent)}constructor(e){super(e),this._handles=new Xi,this._pendingPromises=new Set,this._fetchFeaturesController=null,this._highlightSelectedFeaturePromise=null,this._highlightActiveFeaturePromise=null,this._selectedClusterFeature=null,this.featurePage=null,this.actions=new B$,this.activeFeature=null,this.defaultPopupTemplateEnabled=!1,this.autoCloseEnabled=!1,this.autoOpenEnabled=!0,this.browseClusterEnabled=!1,this.content=null,this.featuresPerPage=20,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new Ha({symbol:new Dw({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null}initialize(){this._handles.add([ne(()=>[this.autoOpenEnabled,this.view],()=>this._autoOpenEnabledChange()),this.on("view-change",()=>this._autoClose()),ne(()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view],()=>this._highlightSelectedFeature()),ne(()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view],()=>this._highlightActiveFeature()),ne(()=>{var e,i;return(i=(e=this.view)==null?void 0:e.animation)==null?void 0:i.state},e=>this._animationStateChange(e)),ne(()=>this.location,e=>this._locationChange(e)),ne(()=>this.selectedFeature,e=>this._selectedFeatureChange(e)),ne(()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage],()=>this._selectedFeatureIndexChange()),ne(()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels],()=>this._setGraphicOnFeatureViewModels()),ne(()=>this.featureViewModels,()=>this._featureViewModelsChange()),this.on("trigger-action",e=>fut({event:e,view:this.view})),yo(()=>!this.waitingForResult,()=>this._waitingForResultChange(),Ki),ne(()=>{var e,i;return[this.features,(e=this.view)==null?void 0:e.map,(i=this.view)==null?void 0:i.spatialReference]},()=>this._updateFeatureVMs()),ne(()=>{var e;return(e=this.view)==null?void 0:e.scale},()=>this._viewScaleChange()),yo(()=>!this.visible,()=>this.browseClusterEnabled=!1),ne(()=>this.browseClusterEnabled,e=>e?this.enableClusterBrowsing():this.disableClusterBrowsing())])}destroy(){this._cancelFetchingFeatures(),this._handles.destroy(),this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const e=this._get("allActions")||new B$;e.removeAll();const{actions:i,defaultActions:r,defaultPopupTemplateEnabled:n,includeDefaultActions:s,selectedFeature:o}=this,a=s?r.concat(i):i,l=o&&(typeof o.getEffectivePopupTemplate=="function"&&o.getEffectivePopupTemplate(n)||o.popupTemplate),c=l&&l.actions,h=l&&l.overwriteActions?c:c?c.concat(a):a;return h&&h.filter(Boolean).forEach(p=>e.add(p)),e}get defaultActions(){const e=this._get("defaultActions")||new B$;return e.removeAll(),e.addMany(KT(this.selectedFeature)?eht():Qut()),e}get featureCount(){return this.features.length}get features(){return this._get("features")||[]}set features(e){const i=e||[];this._set("features",i);const{pendingPromisesCount:r,promiseCount:n,selectedFeatureIndex:s}=this,o=n&&i.length;o&&r&&s===-1?this.selectedFeatureIndex=0:o&&s!==-1||(this.selectedFeatureIndex=i.length?0:-1)}get location(){return this._get("location")||null}set location(e){var n,s,o;let i=e;const r=(s=(n=this.view)==null?void 0:n.spatialReference)==null?void 0:s.isWebMercator;e&&((o=e==null?void 0:e.spatialReference)!=null&&o.isWGS84)&&r&&(i=Zg(e)),this._set("location",i)}get pendingPromisesCount(){return this._pendingPromises.size}get waitingForResult(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||this.featureCount!==0)}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(e){if(this._pendingPromises.clear(),this.features=[],!Array.isArray(e)||!e.length)return this._set("promises",[]),void this.notifyChange("pendingPromisesCount");this._set("promises",e),(e=e.slice(0)).forEach(i=>{this._pendingPromises.add(i);const r=s=>{this._pendingPromises.has(i)&&this._updateFeatures(s),this._updatePendingPromises(i)},n=()=>this._updatePendingPromises(i);i.then(r,n)}),this.notifyChange("pendingPromisesCount")}get selectedFeature(){const{features:e,selectedFeatureIndex:i}=this;return i===-1?null:e[i]||null}get selectedFeatureIndex(){const e=this._get("selectedFeatureIndex");return typeof e=="number"?e:-1}set selectedFeatureIndex(e){const{featureCount:i}=this;e=isNaN(e)||e<-1||!i?-1:(e+i)%i,this.activeFeature=null,this._set("selectedFeatureIndex",e)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get state(){return this.get("view.ready")?"ready":"disabled"}centerAtLocation(){const{view:e}=this,i=iIe(this);return i&&e?this.callGoTo({target:{target:i,scale:e.scale}}):Promise.reject(new H("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:i,view:e}))}zoomTo(e){return this.callGoTo(e)}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(e,i){const{view:r}=this;if(!r||!e)throw new H("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:r});return r.fetchPopupFeatures(e,{event:i&&i.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:i&&i.signal})}open(e){const i={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...e,visible:!0},{fetchFeatures:r}=i;delete i.fetchFeatures,r&&this._setFetchFeaturesPromises(i.location);const n=["actionsMenuOpen","collapsed","featureMenuOpen"];for(const s of n)delete i[s];this.set(i)}triggerAction(e){const i=this.allActions.getItemAt(e);i&&!i.disabled&&this.emit("trigger-action",{action:i})}next(){return this.selectedFeatureIndex=this.selectedFeatureIndex+1,this}previous(){return this.selectedFeatureIndex=this.selectedFeatureIndex-1,this}disableClusterBrowsing(){but(this),this._clearBrowsedClusterGraphics()}async enableClusterBrowsing(){const{view:e,selectedFeature:i}=this;(e==null?void 0:e.type)==="2d"?KT(i)?(await _ut(this),await vut(this)):re.getLogger(this.declaredClass).warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",i):re.getLogger(this.declaredClass).warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",i)}_animationStateChange(e){this.zoomToLocation||(wS.disabled=e==="waiting-for-target")}_clearBrowsedClusterGraphics(){var i;const e=(i=this.view)==null?void 0:i.graphics;e&&(e.remove(this.selectedClusterBoundaryFeature),this._selectedClusterFeature&&e.remove(this._selectedClusterFeature)),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if(KT(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=this.selectedFeature?[this.selectedFeature]:[])}_locationChange(e){const{selectedFeature:i,updateLocationEnabled:r}=this;r&&e&&(!i||i.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:e,featureCount:i,featurePage:r,featuresPerPage:n,featureViewModels:s}=this;if(r===null)return;const o=((r-1)*n+i)%i,a=o+n;s.slice(o,a).forEach((l,c)=>{l&&!l.graphic&&(l.graphic=e[o+c])})}async _selectedFeatureChange(e){const{location:i,updateLocationEnabled:r,view:n}=this;if(e&&n){if(this.browseClusterEnabled)return this._selectedClusterFeature&&(n.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),KT(e)?void 0:(e.symbol=await Vut(e),this._selectedClusterFeature=e,void n.graphics.add(this._selectedClusterFeature));!r&&i||!e.geometry?r&&!e.geometry&&this.centerAtLocation().then(()=>{var o;const s=(o=n.center)==null?void 0:o.clone();s&&(this.location=s)}):this.location=rIe(e.geometry)}}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(e){return this._fetchFeaturesWithController(this._getScreenPoint(e||this.location)).then(i=>{const{clientOnlyGraphics:r,promisesPerLayerView:n}=i,s=Promise.resolve(r),o=n.map(a=>a.promise);this.promises=[s,...o]})}_destroyFeatureVMs(){this.featureViewModels.forEach(e=>e&&!e.destroyed&&e.destroy()),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:e,features:i,featureViewModels:r}=this;if(KT(e)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!i||!i.length)return;const n=r.slice(0),s=[];i.forEach((o,a)=>{var c,h;if(!o)return;let l=null;if(n.some((p,f)=>(p&&p.graphic===o&&(l=p,n.splice(f,1)),!!l)),l)s[a]=l;else{const p=new Ioe({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:(c=this.view)==null?void 0:c.spatialReference,graphic:o===e?o:null,map:(h=this.view)==null?void 0:h.map,view:this.view});s[a]=p}}),n.forEach(o=>o&&!o.destroyed&&o.destroy()),this._set("featureViewModels",s)}_getScreenPoint(e){const{view:i}=this;return i&&e&&typeof i.toScreen=="function"?i.toScreen(e):null}_autoOpenEnabledChange(){const e="auto-fetch-features",{_handles:i,autoOpenEnabled:r}=this;if(i.remove(e),r&&this.view){const n=this.view.on("click",s=>{s.pointerType==="mouse"&&s.button!==0||this._fetchFeaturesAndOpen(s)},ey.WIDGET);i.add(n,e)}}_cancelFetchingFeatures(){const e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}_fetchFeaturesWithController(e,i){this._cancelFetchingFeatures();const r=new AbortController,{signal:n}=r;this._fetchFeaturesController=r,this.notifyChange("waitingForResult");const s=this.fetchFeatures(e,{signal:n,event:i});return s.catch(()=>{}).then(()=>{this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}),s}_fetchFeaturesAndOpen(e){const{screenPoint:i,mapPoint:r}=e,{view:n}=this;this._fetchFeaturesWithController(i,e).then(s=>{var h;const{clientOnlyGraphics:o,promisesPerLayerView:a,location:l}=s,c=[Promise.resolve(o),...a.map(p=>p.promise)];return(h=n==null?void 0:n.popup)==null||h.open({location:l||r,promises:c}),s})}_updatePendingPromises(e){e&&this._pendingPromises.has(e)&&(this._pendingPromises.delete(e),this.notifyChange("pendingPromisesCount"))}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}async _getLayerView(e,i){return await e.when(),e.whenLayerView(i)}_getHighlightLayer(e){const{layer:i,sourceLayer:r}=e;return r&&"layer"in r&&r.layer?r.layer:(r==null?void 0:r.type)==="map-notes"||(r==null?void 0:r.type)==="subtype-group"?r:i}_getHighlightTarget(e,i){const r=i.type==="imagery"?void 0:"objectIdField"in i?i.objectIdField||nIe:null,n=e.attributes;return n&&r&&n[r]||e}async _highlightActiveFeature(){const e="highlight-active-feature";this._handles.remove(e);const{highlightEnabled:i,view:r,activeFeature:n,visible:s}=this;if(!(n&&r&&i&&s))return;const o=this._getHighlightLayer(n);if(!(o&&o instanceof cD))return;const a=this._getLayerView(r,o);this._highlightActiveFeaturePromise=a;const l=await a;if(!(l&&Nme(l)&&this._highlightActiveFeaturePromise===a&&this.activeFeature&&this.highlightEnabled))return;const c=l.highlight(this._getHighlightTarget(n,o));this._handles.add(c,e)}async _highlightSelectedFeature(){const e="highlight-selected-feature";this._handles.remove(e);const{selectedFeature:i,highlightEnabled:r,view:n,visible:s}=this;if(!(i&&n&&r&&s))return;const o=this._getHighlightLayer(i);if(!(o&&o instanceof cD))return;const a=this._getLayerView(n,o);this._highlightSelectedFeaturePromise=a;const l=await a;if(!(l&&Nme(l)&&this._highlightSelectedFeaturePromise===a&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;const c=l.highlight(this._getHighlightTarget(i,o));this._handles.add(c,e)}_updateFeatures(e){const{features:i}=this;if(!e||!e.length)return;if(!i.length)return void(this.features=e);const r=e.filter(n=>!i.includes(n));this.features=i.concat(r)}};u([d()],Zi.prototype,"featurePage",void 0),u([d()],Zi.prototype,"isLoadingFeature",null),u([d({type:B$})],Zi.prototype,"actions",void 0),u([d({readOnly:!0})],Zi.prototype,"active",null),u([d()],Zi.prototype,"activeFeature",void 0),u([d({readOnly:!0})],Zi.prototype,"allActions",null),u([d({type:Boolean})],Zi.prototype,"defaultPopupTemplateEnabled",void 0),u([d()],Zi.prototype,"autoCloseEnabled",void 0),u([d()],Zi.prototype,"autoOpenEnabled",void 0),u([d()],Zi.prototype,"browseClusterEnabled",void 0),u([d()],Zi.prototype,"content",void 0),u([d({type:B$,readOnly:!0})],Zi.prototype,"defaultActions",null),u([d({readOnly:!0})],Zi.prototype,"featureCount",null),u([d()],Zi.prototype,"features",null),u([d()],Zi.prototype,"featuresPerPage",void 0),u([d()],Zi.prototype,"featureViewModelAbilities",void 0),u([d({readOnly:!0})],Zi.prototype,"featureViewModels",void 0),u([d()],Zi.prototype,"highlightEnabled",void 0),u([d()],Zi.prototype,"includeDefaultActions",void 0),u([d({type:Le})],Zi.prototype,"location",null),u([d({readOnly:!0})],Zi.prototype,"pendingPromisesCount",null),u([d({readOnly:!0})],Zi.prototype,"selectedClusterBoundaryFeature",void 0),u([d({readOnly:!0})],Zi.prototype,"waitingForResult",null),u([d({readOnly:!0})],Zi.prototype,"promiseCount",null),u([d()],Zi.prototype,"promises",null),u([d({value:null,readOnly:!0})],Zi.prototype,"selectedFeature",null),u([d({value:-1})],Zi.prototype,"selectedFeatureIndex",null),u([d({readOnly:!0})],Zi.prototype,"selectedFeatureViewModel",null),u([d({readOnly:!0})],Zi.prototype,"state",null),u([d()],Zi.prototype,"title",void 0),u([d()],Zi.prototype,"updateLocationEnabled",void 0),u([d()],Zi.prototype,"view",void 0),u([d()],Zi.prototype,"visible",void 0),u([d()],Zi.prototype,"zoomFactor",void 0),u([d()],Zi.prototype,"zoomToLocation",void 0),u([d()],Zi.prototype,"centerAtLocation",null),Zi=u([$("esri.widgets.Popup.PopupViewModel")],Zi);const yIe=Zi,Fme="selected-index",tht=0,kme="popup-spinner",Ume={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},Vme="esri-popup";function ky(t,e){return e===void 0?`${Vme}__${t}`:`${Vme}__${t}-${e}`}const zme={closeButton:!0,featureNavigation:!0};let Ut=class extends KPe(Sa){constructor(e,i){super(e,i),this._blurClose=!1,this._blurContainer=!1,this._containerNode=null,this._mainContainerNode=null,this._featureMenuNode=null,this._actionsMenuNode=null,this._focusClose=!1,this._focusContainer=!1,this._focusDockButton=!1,this._focusFeatureMenuButton=!1,this._focusActionsMenuButton=!1,this._focusFirstFeature=!1,this._focusFirstAction=!1,this._handles=new Xi,this._pointerOffsetInPx=16,this._spinner=null,this._feature=null,this._featureMenuIntersectionObserverNode=null,this._featureMenuViewportNode=null,this._rootFlowItemNode=null,this._featureMenuIntersectionObserverCallback=([r])=>{r!=null&&r.isIntersecting&&this.viewModel.featurePage!=null&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._displaySpinnerThrottled=PR(()=>this._displaySpinner(),tht),this._exitRelatedRecordsActions=new WeakMap,this._featureSelectionActions=new WeakMap,this._flowItems=new tt,this.alignment="auto",this.collapsed=!1,this.collapseEnabled=!0,this.dockEnabled=!1,this.featureMenuOpen=!1,this.headingLevel=2,this.maxInlineActions=3,this.messages=null,this.messagesCommon=null,this.spinnerEnabled=!0,this.viewModel=new yIe,this.visibleElements={...zme},this._handleOpenRelatedFeature=r=>{this._openRelatedFeature(r)},this._addSelectedFeatureIndexHandle(),this.addHandles([ne(()=>{var r;return(r=this.viewModel)==null?void 0:r.screenLocation},()=>this._positionContainer()),ne(()=>{var r;return[(r=this.viewModel)==null?void 0:r.active,this.dockEnabled]},()=>this._toggleScreenLocationEnabled()),ne(()=>{var r;return(r=this.viewModel)==null?void 0:r.screenLocation},(r,n)=>{!!r!=!!n&&this.reposition()}),ne(()=>{var r,n,s,o,a,l;return[(n=(r=this.viewModel)==null?void 0:r.view)==null?void 0:n.padding,(o=(s=this.viewModel)==null?void 0:s.view)==null?void 0:o.size,(a=this.viewModel)==null?void 0:a.active,(l=this.viewModel)==null?void 0:l.location,this.alignment]},()=>this.reposition()),ne(()=>this.spinnerEnabled,r=>this._spinnerEnabledChange(r)),ne(()=>{var r,n;return(n=(r=this.viewModel)==null?void 0:r.view)==null?void 0:n.size},(r,n)=>this._updateDockEnabledForViewSize(r,n)),ne(()=>{var r;return(r=this.viewModel)==null?void 0:r.view},(r,n)=>this._viewChange(r,n)),ne(()=>{var r,n;return(n=(r=this.viewModel)==null?void 0:r.view)==null?void 0:n.ready},(r,n)=>this._viewReadyChange(r??!1,n??!1)),ne(()=>{var r,n;return[(r=this.viewModel)==null?void 0:r.waitingForResult,(n=this.viewModel)==null?void 0:n.location]},()=>{this._hideSpinner(),this._displaySpinnerThrottled()}),ne(()=>this.selectedFeatureWidget,()=>this._destroyFlowItemWidgets()),ne(()=>{var r,n,s,o;return[(n=(r=this.selectedFeatureWidget)==null?void 0:r.viewModel)==null?void 0:n.title,(o=(s=this.selectedFeatureWidget)==null?void 0:s.viewModel)==null?void 0:o.state]},()=>this._setTitleFromFeatureWidget()),ne(()=>{var r,n,s,o;return[(n=(r=this.selectedFeatureWidget)==null?void 0:r.viewModel)==null?void 0:n.content,(o=(s=this.selectedFeatureWidget)==null?void 0:s.viewModel)==null?void 0:o.state]},()=>this._setContentFromFeatureWidget()),yo(()=>!this.collapsed,()=>{var r,n;((n=(r=this.viewModel)==null?void 0:r.view)==null?void 0:n.widthBreakpoint)==="xsmall"&&this.viewModel.active&&this.collapseEnabled&&this.viewModel.centerAtLocation()}),Kn(()=>{var r;return(r=this.viewModel)==null?void 0:r.allActions},"change",()=>this._watchActions()),ne(()=>{var r;return(r=this.viewModel)==null?void 0:r.allActions},()=>this._watchActions(),zt),ne(()=>{var r;return(r=this.viewModel)==null?void 0:r.featureViewModels},()=>this._featureMenuViewportScrollTop()),Kn(()=>this._flowItems,"change",()=>{this.notifyChange("_activeFlowItemWidget"),this.scheduleRender()}),ne(()=>{var r,n,s,o;return[(n=(r=this._activeFlowItemWidget)==null?void 0:r.viewModel)==null?void 0:n.state,(o=(s=this._activeFlowItemWidget)==null?void 0:s.viewModel)==null?void 0:o.title]},()=>this.scheduleRender())])}loadDependencies(){return Promise.all([Q(()=>import("./calcite-flow-7da67804.js"),[]),Q(()=>import("./calcite-flow-item-756ee99c.js"),["assets/calcite-flow-item-756ee99c.js","assets/action-07be223a.js","assets/tooltip-49c2c990.js","assets/debounce-d5abe404.js","assets/scrim-d7fb9038.js"]),Q(()=>import("./calcite-action-2dcd5ff1.js"),["assets/calcite-action-2dcd5ff1.js","assets/action-07be223a.js"]),Q(()=>import("./calcite-tooltip-940cca1d.js"),["assets/calcite-tooltip-940cca1d.js","assets/tooltip-49c2c990.js","assets/debounce-d5abe404.js"]),Q(()=>import("./calcite-icon-02de242a.js"),[])])}destroy(){var e,i;this._destroyFlowItemWidgets(),this._destroySelectedFeatureWidget(),this._destroySpinner(),(e=this._handles)==null||e.destroy(),this._unobserveFeatureMenuObserver(),(i=this._featureMenuIntersectionObserver)==null||i.disconnect()}get actionsMenuId(){return`${this.id}-actions-menu`}get actionsMenuButtonId(){return`${this.id}-actions-menu-button`}get featureMenuId(){return`${this.id}-feature-menu`}get titleId(){return`${this.id}-popup-title`}get contentId(){return`${this.id}-popup-content`}get hasContent(){const{selectedFeatureWidget:e,viewModel:i}=this;if(!e)return!!(i!=null&&i.content);const r=e.viewModel;if(r!=null&&r.waitingForContent||(r==null?void 0:r.state)==="error")return!0;const n=r==null?void 0:r.content;return Array.isArray(n)?!!n.length:!!n}get featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation!=null}get collapsible(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}get featureMenuVisible(){return this.featureNavigationVisible&&this.featureMenuOpen}get contentCollapsed(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}get dividedActions(){return this._divideActions()}get _activeFlowItemWidget(){const{_flowItems:e}=this;return e.getItemAt(e.length-1)||null}get actions(){return this.viewModel.actions}set actions(e){this.viewModel.actions=e}set actionsMenuOpen(e){this._set("actionsMenuOpen",!!e)}get actionsMenuOpen(){return!!this.viewModel.active&&this._get("actionsMenuOpen")}get autoCloseEnabled(){return this.viewModel.autoCloseEnabled}set autoCloseEnabled(e){this.viewModel.autoCloseEnabled=e}get autoOpenEnabled(){return this.viewModel.autoOpenEnabled}set autoOpenEnabled(e){this.viewModel.autoOpenEnabled=e}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(e){this.viewModel.defaultPopupTemplateEnabled=e}get content(){return this.viewModel.content}set content(e){this.viewModel.content=e}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||Ume}set dockOptions(e){var l,c;const i={...Ume},r=(c=(l=this.viewModel)==null?void 0:l.view)==null?void 0:c.breakpoints,n={};r&&(n.width=r.xsmall,n.height=r.xsmall);const s={...i,...e},o={...i.breakpoint,...n},{breakpoint:a}=s;typeof a=="object"?s.breakpoint={...o,...a}:a&&(s.breakpoint=o),this._set("dockOptions",s),this._setCurrentDockPosition(),this.reposition()}get featureCount(){return this.viewModel.featureCount}get features(){return this.viewModel.features}set features(e){this.viewModel.features=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(e){this.viewModel.highlightEnabled=e}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get promises(){return this.viewModel.promises}set promises(e){this.viewModel.promises=e}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(e){this.viewModel.selectedFeatureIndex=e}get selectedFeatureWidget(){const{_feature:e,visibleElements:i,headingLevel:r,_flowItems:n}=this,{selectedFeatureViewModel:s}=this.viewModel,o={...i,title:!1};return s?(e?(e.viewModel=s,e.visibleElements=o):this._feature=new uut({flowItems:n,headingLevel:r+1,viewModel:s,visibleElements:o}),this._feature):null}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(e){this.viewModel.updateLocationEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}castVisibleElements(e){return{...zme,...e}}blur(){const{active:e}=this.viewModel;e||re.getLogger(this.declaredClass).warn("Popup can only be blurred when currently active."),this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0,this.scheduleRender()}clear(){return this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(e,i){return this.viewModel.fetchFeatures(e,i)}focus(){const{active:e}=this.viewModel;e||re.getLogger(this.declaredClass).warn("Popup can only be focused when currently active."),this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0,this.scheduleRender()}next(){return this.viewModel.next()}open(e){var s,o;this._handles.remove(Fme);const i=!!e&&!!e.featureMenuOpen,r=!!e&&!!e.actionsMenuOpen,n={collapsed:!!e&&!!e.collapsed,actionsMenuOpen:r,featureMenuOpen:i};((o=(s=this.viewModel)==null?void 0:s.view)==null?void 0:o.widthBreakpoint)==="xsmall"&&(n.collapsed=!0),this.set(n),this.viewModel.open(e),this._shouldFocus(e),this._addSelectedFeatureIndexHandle()}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(e){return this.viewModel.triggerAction(e)}render(){var _,b,w,x;const{actionsMenuOpen:e,dockEnabled:i,featureMenuVisible:r,dividedActions:n,currentAlignment:s,currentDockPosition:o}=this,{active:a}=this.viewModel,{menuActions:l}=n,c=a&&l.length>1&&e,h=a&&i,p=a&&!i,f=(b=(_=this.selectedFeature)==null?void 0:_.layer)==null?void 0:b.title,m=(x=(w=this.selectedFeature)==null?void 0:w.layer)==null?void 0:x.id,g={[Ae.alignTopCenter]:s==="top-center",[Ae.alignBottomCenter]:s==="bottom-center",[Ae.alignTopLeft]:s==="top-left",[Ae.alignBottomLeft]:s==="bottom-left",[Ae.alignTopRight]:s==="top-right",[Ae.alignBottomRight]:s==="bottom-right",[Ae.isDocked]:h,[Ae.shadow]:p,[Ae.isDockedTopLeft]:o==="top-left",[Ae.isDockedTopCenter]:o==="top-center",[Ae.isDockedTopRight]:o==="top-right",[Ae.isDockedBottomLeft]:o==="bottom-left",[Ae.isDockedBottomCenter]:o==="bottom-center",[Ae.isDockedBottomRight]:o==="bottom-right",[Ae.isFeatureMenuOpen]:r,[Ae.isActionsMenuOpen]:c};return te("div",{class:this.classes(Ae.base,g),role:"presentation","data-layer-title":f,"data-layer-id":m,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},a?[this.renderMainContainer(),this.renderPointer()]:null)}renderLoadingIcon(){return te("span",{"aria-hidden":"true",class:this.classes(Ae.icon,Ae.iconLoading,Ae.rotating)})}renderNavigationLoading(){const{messagesCommon:e}=this;return this.viewModel.pendingPromisesCount?te("div",{key:ky("loading-container"),role:"presentation",class:Ae.loadingContainer,"aria-label":e.loading,title:e.loading},this.renderLoadingIcon()):null}renderPreviousIcon(){const e=Bg(this.container),i={[Ae.iconRightTriangleArrow]:e,[Ae.paginationPreviousIconRTL]:e,[Ae.iconLeftTriangleArrow]:!e,[Ae.paginationPreviousIconLTR]:!e};return te("span",{"aria-hidden":"true",class:this.classes(Ae.icon,i)})}renderPreviousButton(){const{messages:e}=this;return te("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes(Ae.button,Ae.paginationPrevious),"aria-label":e.previous,title:e.previous},this.renderPreviousIcon())}renderNextIcon(){const e=Bg(this.container),i={[Ae.iconLeftTriangleArrow]:e,[Ae.paginationNextIconRTL]:e,[Ae.iconRightTriangleArrow]:!e,[Ae.paginationNextIconLTR]:!e};return te("span",{"aria-hidden":"true",class:this.classes(Ae.icon,i)})}renderNextButton(){const{messages:e}=this;return te("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes(Ae.button,Ae.paginationNext),"aria-label":e.next,title:e.next},this.renderNextIcon())}renderFeatureMenuButton(){const{featureMenuOpen:e,featureMenuId:i,messagesCommon:r}=this,{featureCount:n,selectedFeatureIndex:s}=this.viewModel;return te("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes(Ae.button,Ae.featureMenuButton),"aria-haspopup":"true","aria-controls":i,"aria-expanded":e.toString(),"aria-label":r.menu,title:r.menu},this._getPageText(n,s))}renderNavigationButtons(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:[]}renderDockIcon(){const{dockEnabled:e}=this,i=this._wouldDockTo(),r={[Ae.iconUndock]:e,[Ae.iconDock]:!e,[Ae.iconDockToRight]:!e&&(i==="top-right"||i==="bottom-right"),[Ae.iconDockToLeft]:!e&&(i==="top-left"||i==="bottom-left"),[Ae.iconDockToTop]:!e&&i==="top-center",[Ae.iconDockToBottom]:!e&&i==="bottom-center"};return te("span",{"aria-hidden":"true",class:this.classes(r,Ae.icon)})}renderDockButton(){var s,o,a;const{dockEnabled:e,messages:i}=this,r=(o=(s=this.viewModel)==null?void 0:s.view)==null?void 0:o.widthBreakpoint,n=e?i.undock:i.dock;return r!=="xsmall"&&((a=this.dockOptions)!=null&&a.buttonEnabled)?te("div",{role:"button","aria-label":n,title:n,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(Ae.button,Ae.buttonDock)},this.renderDockIcon()):null}renderTitle(){const{title:e}=this.viewModel,{titleId:i,collapsible:r,contentCollapsed:n,messagesCommon:s}=this,o={[Ae.headerContainerButton]:r},a=te(Dse,{level:this.headingLevel,class:Ae.headerTitle,innerHTML:e??""}),l=r?te("button",{key:`${e}--collapsible`,id:i,title:n?s.expand:s.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(Ae.headerContainer,o),"aria-expanded":n?"false":"true",onclick:this._toggleCollapsed,type:"button"},a,te("calcite-icon",{class:Ae.collapseIcon,key:"collapse-icon",icon:n?"chevron-down":"chevron-up",scale:"m"})):te("div",{key:e??"title",id:i,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(Ae.headerContainer,o)},a);return e?l:null}renderCloseIcon(){return te("span",{"aria-hidden":"true",class:this.classes(Ae.icon,Ae.iconClose)})}renderCloseButton(){const{visibleElements:e,messagesCommon:i}=this;return e.closeButton?te("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:Ae.button,"aria-label":i.close,title:i.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null}renderHeader(){return te("header",{class:Ae.header},this.renderTitle(),te("div",{class:Ae.headerButtons},this.renderDockButton(),this.renderCloseButton()))}renderContentContainer(){const{contentId:e,hasContent:i,contentCollapsed:r,_flowItems:n}=this,{content:s}=this.viewModel,o=n.toArray(),a={[Ae.contentHasFlows]:!!o.length};return i&&!r?te("div",{key:s??"content",enterAnimation:this._createFeatureUpdatedAnimation(),id:e,class:this.classes(Ae.content,a)},te("calcite-flow",{bind:this},te("calcite-flow-item",{bind:this,"data-node-ref":"_rootFlowItemNode",afterCreate:vV,key:"root-flow-item",onCalciteFlowItemBack:this._handleBackClick},this.renderContent()),o.map(l=>this.renderFlowItem(l))),o.map(l=>this.renderFlowItemTooltips(l))):null}renderFlowItem(e){const{messages:i}=this,r=PV(),n="graphic"in e&&!e.isTable;return te("calcite-flow-item",{bind:this,class:this.classes({[Ae.calciteThemeDark]:!r,[Ae.calciteThemeLight]:r}),heading:e.title??"",description:this._getFlowItemDescription(e),onCalciteFlowItemBack:this._handleBackClick,key:`flow-item-${e.viewModel.uid}`},te("calcite-action",{class:Ae.actionExit,icon:"move-up",label:i==null?void 0:i.exitRelatedRecords,text:i==null?void 0:i.exitRelatedRecords,slot:"header-actions-start",bind:this,afterCreate:s=>this._storeExitRelatedRecordsAction(e,s),onclick:this._destroyFlowItemWidgets}),n?te("calcite-action",{class:Ae.actionSelectFeature,icon:"zoom-to-object",label:i==null?void 0:i.selectFeature,text:i==null?void 0:i.selectFeature,slot:"header-actions-end",bind:this,afterCreate:s=>this._storeFeatureSelectionAction(e,s),onclick:()=>this._handleOpenRelatedFeature(e)}):null,te("div",{class:this.classes(Ae.contentFlowItem,{[Ae.calciteThemeDark]:r,[Ae.calciteThemeLight]:!r})},e.render()))}renderFlowItemTooltips(e){const{messages:i,_exitRelatedRecordsActions:r,_featureSelectionActions:n}=this,s=PV(),o=n.get(e);return[te("calcite-tooltip",{class:this.classes({[Ae.calciteThemeDark]:!s,[Ae.calciteThemeLight]:s}),key:`exit-related-records-tooltip-${e.viewModel.uid}`,label:i==null?void 0:i.exitRelatedRecords,overlayPositioning:"fixed",referenceElement:r.get(e),placement:"top"},i==null?void 0:i.exitRelatedRecords),o?te("calcite-tooltip",{class:this.classes({[Ae.calciteThemeDark]:!s,[Ae.calciteThemeLight]:s}),key:`select-related-record-tooltip-${e.viewModel.uid}`,label:i==null?void 0:i.selectFeature,overlayPositioning:"fixed",referenceElement:o,placement:"top"},i==null?void 0:i.selectFeature):null]}renderActionsMenuButton(){const{actionsMenuId:e,actionsMenuButtonId:i,actionsMenuOpen:r,dividedActions:n,messagesCommon:s}=this,o=r?s.close:s.open,{menuActions:a}=n;return a.length?te("div",{key:ky("actions-menu-button"),class:this.classes(Ae.button,Ae.actionsMenuButton),role:"button",id:i,"aria-haspopup":"true","aria-controls":r?e:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":o,title:o},te("span",{"aria-hidden":"true",class:Ae.iconActionsMenu})):null}renderMenuActions(){const{actionsMenuId:e,actionsMenuButtonId:i,actionsMenuOpen:r,dividedActions:n}=this,{menuActions:s}=n;return s.length&&r?te("ul",{id:e,role:"menu","aria-labelledby":i,key:ky("actions"),class:Ae.actions,bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},s.toArray().map(o=>this.renderAction({action:o,type:"menu-item"}))):null}renderInlineActions(){const{inlineActions:e}=this.dividedActions;return e.length?e.toArray().map(i=>this.renderAction({action:i,type:"inline"})):[]}renderInlineActionsContainer(){const{inlineActions:e,menuActions:i}=this.dividedActions,r=!!e.length,n=!!i.length;return r||n?te("div",{key:"inline-actions-container","data-inline-actions":r.toString(),"data-menu-actions":n.toString(),class:Ae.inlineActionsContainer},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null}renderNavigation(){return this.featureNavigationVisible?te("section",{key:ky("navigation"),class:this.classes(Ae.navigation)},this.renderNavigationButtons()):null}renderFooter(){const{featureNavigationVisible:e,dividedActions:i}=this,{inlineActions:r,menuActions:n}=i,s=!!r.length,o=!!n.length,a={[Ae.footerHasPagination]:e,[Ae.footerHasActions]:s,[Ae.footerHasActionsMenu]:o};return e||s?te("div",{key:ky("feature-buttons"),class:this.classes(Ae.footer,a)},this.renderInlineActionsContainer(),this.renderNavigation()):null}renderFeatureMenuContainer(){const{messages:e}=this,{featureViewModels:i,isLoadingFeature:r}=this.viewModel,n=Lf(e.selectedFeatures,{total:i.length});return te("section",{key:ky("menu"),class:Ae.featureMenu},te("strong",{class:Ae.featureMenuHeader},n),te("nav",{bind:this,class:Ae.featureMenuViewport,"data-node-ref":"_featureMenuViewportNode",afterCreate:vV},this.renderFeatureMenu(),te("div",{class:Ae.featureMenuObserver,bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),r?te("div",{class:Ae.featureMenuLoader},this.renderLoadingIcon()):null))}renderPointer(){return this.dockEnabled?null:te("div",{key:ky("pointer"),class:Ae.pointer,role:"presentation"},te("div",{class:this.classes(Ae.pointerDirection,Ae.shadow)}))}renderMainContainer(){const{dockEnabled:e,currentAlignment:i,currentDockPosition:r,titleId:n,contentId:s,collapsible:o,hasContent:a,contentCollapsed:l,visibleElements:c}=this,{title:h}=this.viewModel,p=i==="bottom-left"||i==="bottom-center"||i==="bottom-right"||r==="top-left"||r==="top-center"||r==="top-right",f=i==="top-left"||i==="top-center"||i==="top-right"||r==="bottom-left"||r==="bottom-center"||r==="bottom-right",m={[Ae.shadow]:e,[Ae.isCollapsible]:o,[Ae.isCollapsed]:l};return te("div",{class:this.classes(Ae.main,Ae.widget,m),tabIndex:c.closeButton?void 0:-1,role:"dialog","aria-labelledby":h?n:"","aria-describedby":a&&!l?s:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},p?this.renderFooter():null,p?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),f?this.renderFooter():null,f?this.renderFeatureMenuContainer():null)}renderContent(){var i;const e=(i=this.viewModel)==null?void 0:i.content;return e?typeof e=="string"?te("div",{class:vs.contentNode,key:e,innerHTML:e}):this.renderNodeContent(e):null}renderActionText(e){return te("span",{key:"text",class:Ae.actionText},e)}renderActionIcon(e){const i=this._getActionClass(e),r=this._getActionImage(e),n={[Ae.iconLoading]:e.active,[Ae.rotating]:e.active,[Ae.icon]:!!i,[Ae.actionImage]:!e.active&&!!r};return i&&(n[i]=!e.active),te("span",{key:"icon","aria-hidden":"true",class:this.classes(Ae.icon,n),styles:this._getIconStyles(r)})}renderAction(e){const{action:i,type:r}=e,n=this._getActionTitle(i),s={[Ae.action]:i.type!=="toggle",[Ae.actionToggle]:i.type==="toggle",[Ae.actionToggleOn]:i.type==="toggle"&&i.value,[Ae.buttonDisabled]:i.disabled},o=[this.renderActionIcon(i),this.renderActionText(n)],a=r==="menu-item"?te("li",{key:i.uid,role:"menuitem",tabIndex:0,title:n,"aria-label":n,class:this.classes(Ae.button,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":i.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},o):te("div",{key:i.uid,role:"button",tabIndex:0,title:n,"aria-label":n,class:this.classes(Ae.button,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":i.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},o);return i.visible?a:null}renderFeatureMenuItem(e,i){const{messages:r,messagesCommon:n}=this,{selectedFeatureIndex:s,selectedFeatureViewModel:o}=this.viewModel,a=e===o,l={[Ae.featureMenuSelected]:a},c=a?te("span",{key:ky(`feature-menu-selected-feature-${s}`),title:r.selectedFeature,"aria-label":r.selectedFeature,class:Ae.iconCheckMark}):null,h=te("span",{innerHTML:e.title||n.untitled});return te("li",{role:"menuitem",tabIndex:-1,key:ky(`feature-menu-feature-${s}`),class:this.classes(l,Ae.featureMenuItem),bind:this,"data-feature-index":i,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature,onmouseover:this._setActiveFeature,onmouseleave:this._removeActiveFeature},te("span",{class:Ae.featureMenuTitle},h,c))}renderFeatureMenu(){const{featureMenuId:e}=this,{featureViewModels:i}=this.viewModel;return i.length>1?te("ol",{class:Ae.featureMenuList,id:e,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},i.filter(r=>!!r.graphic).map((r,n)=>this.renderFeatureMenuItem(r,n))):null}_storeFeatureSelectionAction(e,i){this._featureSelectionActions.set(e,i),this.scheduleRender()}_storeExitRelatedRecordsAction(e,i){this._exitRelatedRecordsActions.set(e,i),this.scheduleRender()}_getFlowItemDescription(e){return"featureCountDescription"in e?e.featureCountDescription:e.viewModel.description??""}async _openRelatedFeature(e){await e.viewModel.updateGeometry();const i=e.graphic,r=i==null?void 0:i.geometry;if(R(r)||R(i))return;this._destroyFlowItemWidgets(),await this.viewModel.zoomTo({target:r});const n=rIe(r);this.open({features:[i],location:v(n)?n:void 0})}_destroyFlowItemWidgets(){this._flowItems.removeAll().forEach(e=>{"showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e.viewModel=null,e.destroy()})}_handleBackClick(){const e=this._flowItems.pop();e&&(this._exitRelatedRecordsActions.delete(e),this._featureSelectionActions.delete(e),"showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e&&(e.viewModel=null,e.destroy()))}_getActionTitle(e){const{messages:i,selectedFeature:r,messagesCommon:n}=this,{id:s}=e,o=r==null?void 0:r.attributes,a=e.title??"",l=s==="zoom-to-feature"?Lf(a,{messages:i}):s==="remove-selected-feature"?Lf(a,{messages:n}):s==="zoom-to-clustered-features"||s==="browse-clustered-features"?Lf(a,{messages:i}):e.title;return l&&o?Lf(l,o):l??""}_getActionClass(e){const{selectedFeature:i}=this,r=i==null?void 0:i.attributes,{className:n,image:s}=e,o=s||n?n:Ae.iconDefaultAction;return o&&r?Lf(o,r):o??""}_getActionImage(e){const{selectedFeature:i}=this,r=i==null?void 0:i.attributes,{image:n}=e;return n&&r?Lf(n,r):n??""}_createFeatureUpdatedAnimation(){return UJe("enter",Ae.hasFeatureUpdated)}_getInlineActionCount(){const{maxInlineActions:e,featureNavigationVisible:i}=this;if(typeof e!="number")return null;const r=Math.round(e);return Math.max(i?r-1:r,0)}_watchActions(){const{allActions:e}=this.viewModel;this.notifyChange("dividedActions");const i="actions";this._handles.remove(i),e&&e.forEach(r=>{this._handles.add(ne(()=>[r.uid,r.active,r.className,r.disabled,r.id,r.title,r.image,r.visible],()=>this.scheduleRender()),i)})}_divideActions(){const{allActions:e}=this.viewModel,i=e.filter(o=>o.visible),r=this._getInlineActionCount(),n=r===null,s=r===0;return{inlineActions:n?i.slice(0):s?new tt:i.slice(0,r),menuActions:n?new tt:s?i.slice(0):i.slice(r)}}_featureMenuOpenChanged(e){e?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0}_actionsMenuOpenChanged(e){e?this._focusFirstAction=!0:this._focusActionsMenuButton=!0}_setTitleFromFeatureWidget(){var r,n;const{selectedFeatureWidget:e,messagesCommon:i}=this;e&&(this.viewModel.title=((r=e.viewModel)==null?void 0:r.state)==="error"?i.errorMessage:((n=e.viewModel)==null?void 0:n.title)||"")}_setContentFromFeatureWidget(){const{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}_handleFeatureMenuKeyup(e){up(e)==="Escape"&&(e.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())}_handleActionMenuKeyup(e){up(e)==="Escape"&&(e.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())}_setActiveFeature(e){const{viewModel:i}=this,r=e.currentTarget["data-feature-index"];i.activeFeature=i.features[r]||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_handleFeatureMenuItemKeyup(e){const i=up(e),{_featureMenuNode:r}=this,n=e.currentTarget["data-feature-index"];if(!r)return;const s=r.querySelectorAll("li"),o=s.length;i!=="ArrowUp"?i!=="ArrowDown"?i!=="Home"?i!=="End"||(e.stopPropagation(),s[s.length-1].focus()):(e.stopPropagation(),s[0].focus()):(e.stopPropagation(),s[(n+1+o)%o].focus()):(e.stopPropagation(),s[(n-1+o)%o].focus())}_handleActionMenuItemKeyup(e){const i=up(e),{_actionsMenuNode:r}=this,n=e.currentTarget.dataset.actionUid,{menuActions:s}=this.dividedActions,o=s.findIndex(c=>c.uid===n);if(!r)return;const a=r.querySelectorAll("li"),l=a.length;i!=="ArrowUp"?i!=="ArrowDown"?i!=="Home"?i!=="End"||(e.stopPropagation(),a[a.length-1].focus()):(e.stopPropagation(),a[0].focus()):(e.stopPropagation(),a[(o+1+l)%l].focus()):(e.stopPropagation(),a[(o-1+l)%l].focus())}_handleMainKeyup(e){const i=up(e);i==="ArrowLeft"&&(e.stopPropagation(),this.previous()),i==="ArrowRight"&&(e.stopPropagation(),this.next())}_spinnerEnabledChange(e){if(this._destroySpinner(),!e)return;const i=this.get("viewModel.view");this._createSpinner(i)}_hideSpinner(){const{_spinner:e}=this;e&&(e.location=null,e.hide())}_displaySpinner(){const{_spinner:e}=this;if(!e)return;const{location:i,waitingForResult:r}=this.viewModel;r&&i?e.show({location:i}):e.hide()}_getIconStyles(e){return{"background-image":e?`url(${e})`:""}}async _shouldFocus(e){e!=null&&e.shouldFocus&&(await ow(()=>{var i;return((i=this.viewModel)==null?void 0:i.active)===!0}),this.focus())}_addSelectedFeatureIndexHandle(){const e=ne(()=>{var i;return(i=this.viewModel)==null?void 0:i.selectedFeatureIndex},(i,r)=>this._selectedFeatureIndexUpdated(i,r));this._handles.add(e,Fme)}_selectedFeatureIndexUpdated(e,i){const{featureCount:r}=this;r&&e!==i&&e!==-1&&(this._destroyFlowItemWidgets(),this.actionsMenuOpen=!1,this.featureMenuOpen=!1,this._mainContainerNode&&(this._mainContainerNode.scrollTop=0),this._rootFlowItemNode&&this._rootFlowItemNode.scrollContentTo({top:0}))}_destroySelectedFeatureWidget(){const{_feature:e}=this;e&&(e.viewModel=null,e&&!e.destroyed&&e.destroy()),this._feature=null}_isScreenLocationWithinView(e,i){return e.x>-1&&e.y>-1&&e.x<=i.width&&e.y<=i.height}_isOutsideView(e){const{popupHeight:i,popupWidth:r,screenLocation:n,side:s,view:o}=e;if(isNaN(r)||isNaN(i)||!o||!n)return!1;const a=o.padding;return s==="right"&&n.x+r/2>o.width-a.right||s==="left"&&n.x-r/2<a.left||s==="top"&&n.y-i<a.top||s==="bottom"&&n.y+i>o.height-a.bottom}_calculateAutoAlignment(e){if(e!=="auto")return e;const{_pointerOffsetInPx:i,_containerNode:r,_mainContainerNode:n,viewModel:s}=this,{screenLocation:o,view:a}=s;if(R(o)||!a||!r)return"top-center";if(!this._isScreenLocationWithinView(o,a))return this._get("currentAlignment")||"top-center";function l(E){return parseInt(E.replace(/[^-\d\.]/g,""),10)}const c=n?window.getComputedStyle(n,null):null,h=c?l(c.getPropertyValue("max-height")):0,p=c?l(c.getPropertyValue("height")):0,{height:f,width:m}=r.getBoundingClientRect(),g=m+i,_=Math.max(f,h,p)+i,b=this._isOutsideView({popupHeight:_,popupWidth:g,screenLocation:o,side:"right",view:a}),w=this._isOutsideView({popupHeight:_,popupWidth:g,screenLocation:o,side:"left",view:a}),x=this._isOutsideView({popupHeight:_,popupWidth:g,screenLocation:o,side:"top",view:a}),T=this._isOutsideView({popupHeight:_,popupWidth:g,screenLocation:o,side:"bottom",view:a});return w?x?"bottom-right":"top-right":b?x?"bottom-left":"top-left":x?T?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(e){return typeof e=="function"?e.call(this):e}_getCurrentAlignment(){const{alignment:e,dockEnabled:i}=this;return i||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(e){const i=["left","right"];return Bg(this.container)&&i.reverse(),e.replace(/leading/gi,i[0]).replace(/trailing/gi,i[1])}_callDockPosition(e){return typeof e=="function"?e.call(this):e}_getDockPosition(){var e;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition((e=this.dockOptions)==null?void 0:e.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_wouldDockTo(){return this.dockEnabled?null:this._getDockPosition()}_calculateAutoDockPosition(e){var a;if(e!=="auto")return e;const i=(a=this.viewModel)==null?void 0:a.view,r=Bg(this.container)?"top-left":"top-right";if(!i)return r;const n=i.padding||{left:0,right:0,top:0,bottom:0},s=i.width-n.left-n.right,{breakpoints:o}=i;return o&&s<=o.xsmall?"bottom-center":r}_positionContainer(e=this._containerNode){if(e&&(this._containerNode=e),!this._containerNode)return;const{screenLocation:i}=this.viewModel,{width:r}=this._containerNode.getBoundingClientRect(),n=this._calculatePositionStyle(i,r);n&&Object.assign(this._containerNode.style,n)}_calculateFullWidth(e){const{currentAlignment:i,_pointerOffsetInPx:r}=this;return i==="top-left"||i==="bottom-left"||i==="top-right"||i==="bottom-right"?e+r:e}_calculateAlignmentPosition(e,i,r,n){const{currentAlignment:s,_pointerOffsetInPx:o}=this;if(!r)return;const{padding:a}=r,l=n/2,c=r.height-i,h=r.width-e;return s==="bottom-center"?{top:i+o-a.top,left:e-l-a.left}:s==="top-left"?{bottom:c+o-a.bottom,right:h+o-a.right}:s==="bottom-left"?{top:i+o-a.top,right:h+o-a.right}:s==="top-right"?{bottom:c+o-a.bottom,left:e+o-a.left}:s==="bottom-right"?{top:i+o-a.top,left:e+o-a.left}:s==="top-center"?{bottom:c+o-a.bottom,left:e-l-a.left}:void 0}_calculatePositionStyle(e,i){const{dockEnabled:r,view:n}=this;if(!n)return;if(r)return{left:"",top:"",right:"",bottom:""};if(R(e)||!i)return;const s=this._calculateFullWidth(i),o=this._calculateAlignmentPosition(e.x,e.y,n,s);return o?{top:o.top!==void 0?`${o.top}px`:"auto",left:o.left!==void 0?`${o.left}px`:"auto",bottom:o.bottom!==void 0?`${o.bottom}px`:"auto",right:o.right!==void 0?`${o.right}px`:"auto"}:void 0}_viewChange(e,i){e&&i&&(this.close(),this.clear())}_viewReadyChange(e,i){if(e){const r=this.get("viewModel.view");this._wireUpView(r)}else i&&(this.close(),this.clear())}_wireUpView(e){if(this._destroySpinner(),!e)return;const{spinnerEnabled:i}=this;i&&this._createSpinner(e),this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(e,i,r){const[n,s]=e,[o,a]=i,{width:l=0,height:c=0}=r??{};return n<=l&&o>l||n>l&&o<=l||s<=c&&a>c||s>c&&a<=c}_updateDockEnabledForViewSize(e,i){if(!e||!i)return;const r=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},n=r.left+r.right,s=r.top+r.bottom,o=[],a=[];o[0]=e[0]-n,o[1]=e[1]-s,a[0]=i[0]-n,a[1]=i[1]-s;const{dockOptions:l}=this,c=l.breakpoint;this._dockingThresholdCrossed(o,a,c)&&this._setDockEnabledForViewSize(l),this._setCurrentDockPosition()}_focusDockButtonNode(e){this._focusDockButton&&(this._focusDockButton=!1,e.focus())}_closeButtonNodeUpdated(e){return this._focusClose?(this._focusClose=!1,void e.focus()):this._blurClose?(this._blurClose=!1,void e.blur()):void 0}_mainContainerNodeUpdated(e){return this._mainContainerNode=e,this._focusContainer?(this._focusContainer=!1,void e.focus()):this._blurContainer?(this._blurContainer=!1,void e.blur()):void 0}_featureMenuNodeUpdated(e){if(this._featureMenuNode=e,!e||!this._focusFirstFeature)return;this._focusFirstFeature=!1;const i=e.querySelectorAll("li");i.length&&i[0].focus()}_actionsMenuNodeUpdated(e){if(this._actionsMenuNode=e,!e||!this._focusFirstAction)return;this._focusFirstAction=!1;const i=e.querySelectorAll("li");i.length&&i[0].focus()}_focusFeatureMenuButtonNode(e){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,e.focus())}_focusActionsMenuButtonNode(e){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,e.focus())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=0)}_toggleScreenLocationEnabled(){const{dockEnabled:e,viewModel:i}=this;if(!i)return;const r=i.active&&!e;i.screenLocationEnabled=r}_shouldDockAtCurrentViewSize(e){var l,c;const i=e.breakpoint,r=(c=(l=this.viewModel)==null?void 0:l.view)==null?void 0:c.ui;if(!r)return!1;const{width:n,height:s}=r;if(isNaN(n)||isNaN(s)||!i)return!1;const o=i.hasOwnProperty("width")&&n<=(i.width??0),a=i.hasOwnProperty("height")&&s<=(i.height??0);return o||a}_setDockEnabledForViewSize(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}_getPageText(e,i){return this.featureNavigationVisible?Lf(this.messages.pageText,{index:i+1,total:e}):null}_destroySpinner(){const{_spinner:e,view:i}=this;e&&(i&&i.ui&&i.ui.remove(e,kme),e.destroy(),this._spinner=null)}_createSpinner(e){e&&(this._spinner=new dut({view:e}),e.ui.add(this._spinner,{key:kme,position:"manual"}))}_toggleCollapsed(){this.collapsed=!this.collapsed}_close(){this.close(),this.view&&this.view.focus()}_toggleDockEnabled(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()}_toggleFeatureMenu(){const e=!this.featureMenuOpen;this._featureMenuOpenChanged(e),this.actionsMenuOpen=!1,this.featureMenuOpen=e}_toggleActionsMenu(){const e=!this.actionsMenuOpen;this._actionsMenuOpenChanged(e),this.featureMenuOpen=!1,this.actionsMenuOpen=e}_triggerAction(e){const i=e.currentTarget.dataset.actionUid,{allActions:r}=this.viewModel,n=r.findIndex(o=>o.uid===i),s=r.getItemAt(n);s&&s.type==="toggle"&&(s.value=!s.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(n)}_selectFeature(e){const i=e.currentTarget["data-feature-index"];isNaN(i)||(this.viewModel.selectedFeatureIndex=i),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()}_next(){this.next()}_previous(){this.previous()}};u([d({readOnly:!0})],Ut.prototype,"actionsMenuId",null),u([d({readOnly:!0})],Ut.prototype,"actionsMenuButtonId",null),u([d({readOnly:!0})],Ut.prototype,"featureMenuId",null),u([d({readOnly:!0})],Ut.prototype,"titleId",null),u([d({readOnly:!0})],Ut.prototype,"contentId",null),u([d({readOnly:!0})],Ut.prototype,"hasContent",null),u([d({readOnly:!0})],Ut.prototype,"featureNavigationVisible",null),u([d({readOnly:!0})],Ut.prototype,"collapsible",null),u([d({readOnly:!0})],Ut.prototype,"featureMenuVisible",null),u([d({readOnly:!0})],Ut.prototype,"contentCollapsed",null),u([d({readOnly:!0})],Ut.prototype,"dividedActions",null),u([d({readOnly:!0,dependsOn:["_flowItems.length"]})],Ut.prototype,"_activeFlowItemWidget",null),u([d()],Ut.prototype,"actions",null),u([d()],Ut.prototype,"actionsMenuOpen",null),u([d()],Ut.prototype,"alignment",void 0),u([d()],Ut.prototype,"autoCloseEnabled",null),u([d()],Ut.prototype,"autoOpenEnabled",null),u([d()],Ut.prototype,"defaultPopupTemplateEnabled",null),u([d()],Ut.prototype,"content",null),u([d()],Ut.prototype,"collapsed",void 0),u([d()],Ut.prototype,"collapseEnabled",void 0),u([d({readOnly:!0})],Ut.prototype,"currentAlignment",null),u([d({readOnly:!0})],Ut.prototype,"currentDockPosition",null),u([d()],Ut.prototype,"dockOptions",null),u([d()],Ut.prototype,"dockEnabled",void 0),u([d({readOnly:!0})],Ut.prototype,"featureCount",null),u([d()],Ut.prototype,"featureMenuOpen",void 0),u([d()],Ut.prototype,"features",null),u([d()],Ut.prototype,"goToOverride",null),u([d()],Ut.prototype,"headingLevel",void 0),u([d()],Ut.prototype,"highlightEnabled",null),u([d()],Ut.prototype,"location",null),u([d()],Ut.prototype,"label",null),u([d()],Ut.prototype,"maxInlineActions",void 0),u([d(),Go("esri/widgets/Popup/t9n/Popup")],Ut.prototype,"messages",void 0),u([d(),Go("esri/t9n/common")],Ut.prototype,"messagesCommon",void 0),u([d()],Ut.prototype,"promises",null),u([d({readOnly:!0})],Ut.prototype,"selectedFeature",null),u([d()],Ut.prototype,"selectedFeatureIndex",null),u([d({readOnly:!0})],Ut.prototype,"selectedFeatureWidget",null),u([d()],Ut.prototype,"spinnerEnabled",void 0),u([d()],Ut.prototype,"title",null),u([d()],Ut.prototype,"updateLocationEnabled",null),u([d()],Ut.prototype,"view",null),u([d({type:yIe}),$et(["triggerAction","trigger-action"])],Ut.prototype,"viewModel",void 0),u([d()],Ut.prototype,"visible",null),u([d()],Ut.prototype,"visibleElements",void 0),u([ri("visibleElements")],Ut.prototype,"castVisibleElements",null),u([Nh()],Ut.prototype,"_close",null),u([Nh()],Ut.prototype,"_toggleDockEnabled",null),u([Nh()],Ut.prototype,"_toggleFeatureMenu",null),u([Nh()],Ut.prototype,"_toggleActionsMenu",null),u([Nh()],Ut.prototype,"_triggerAction",null),u([Nh()],Ut.prototype,"_selectFeature",null),u([Nh()],Ut.prototype,"_next",null),u([Nh()],Ut.prototype,"_previous",null),Ut=u([$("esri.widgets.Popup")],Ut);const Bme=Ut,tH=[0,0];function iht(t){const e=(t.ownerDocument||window.document).defaultView,i=t.getBoundingClientRect();return tH[0]=i.left+((e==null?void 0:e.pageXOffset)??0),tH[1]=i.top+((e==null?void 0:e.pageYOffset)??0),tH}function jme(t){t&&(uRe(t),t.parentNode&&t.parentNode.removeChild(t))}function rht(t){const e=document.createElement("div");return t.appendChild(e),e}const A3=16,x4=750,nht=512,sht=2,_Ie=t=>{let e=class extends t{constructor(...i){var r;super(...i),this._freqInfo={freq:A3,time:x4},this._overlayRenderTaskHandle=null,this.height=0,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,i.length!==0&&((r=i[0])==null?void 0:r.popup)!==void 0||(this.popup=new Bme({view:this})),this.handles.add([ne(()=>this.cursor,n=>{const{surface:s}=this;s&&s.setAttribute("data-cursor",n)}),ne(()=>this.interacting,n=>{const{surface:s}=this;s&&s.setAttribute("data-interacting",n.toString())})])}initialize(){this.handles.add(ne(()=>this.ui,(i,r)=>this._handleUIChange(i,r))),this._wireUI(this.ui),this.handles.add([this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui=Ve(this.ui),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null)}get container(){return this._get("container")??null}set container(i){const r=this._get("container"),n=uB(i);if(n||typeof i!="string"||re.getLogger(this.declaredClass).error("#container",`element with id '${i}' not found`),r===n)return;const s="dom-size";if(this.handles.remove(s),this._stopMeasuring(),r&&(r.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(jme(this.root),this._set("root",null)),this.userContent&&(Ude(this.userContent,r),jme(this.userContent),this._set("userContent",null))),!n)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);n.classList.add("esri-view");const o=document.createElement("div");o.className="esri-view-user-storage",Ude(n,o),n.appendChild(o),this._set("userContent",o);const a=document.createElement("div");a.className="esri-view-root",n.insertBefore(a,n.firstChild),this._set("root",a);const l=document.createElement("div");l.className="esri-view-surface",l.setAttribute("role","application"),l.tabIndex=0,a.appendChild(l),this._set("surface",l);const c=new Yde;a.appendChild(c.surface),this._set("overlay",c),ne(()=>c.needsRender,h=>{h&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=E_({render:()=>{var p;return(p=this.overlay)==null?void 0:p.render()}}):this._overlayRenderTaskHandle=Nr(this._overlayRenderTaskHandle)}),this.forceDOMReadyCycle(),this.handles.add(ne(()=>this.size,h=>{const[p,f]=h,m="esri-view-surface--inset-outline";p>=document.body.clientWidth||f>=document.body.clientHeight?l.classList.add(m):l.classList.remove(m)},zt),s),this._set("container",n),this._startMeasuring()}get focused(){const i=document.activeElement===this.surface;return document.hasFocus()&&i}set popup(i){const r=this._get("popup");r&&r!==i&&r.destroy(),this._set("popup",i)}get size(){return[this.width,this.height]}blur(){this.surface&&this.surface.blur()}focus(){this.surface&&this.surface.focus()}pageToContainer(i,r,n){const s=this.position;return i-=s?s[0]:0,r-=s?s[1]:0,n?(n[0]=i,n[1]=r):n=[i,r],n}containerToPage(i,r,n){const s=this.position;return i+=s?s[0]:0,r+=s?s[1]:0,n?(n[0]=i,n[1]=r):n=[i,r],n}_handleUIChange(i,r){r&&(this.handles.remove("ui"),r.destroy()),i&&this._wireUI(i),this._set("ui",i)}_wireUI(i){this.handles.remove("ui"),i&&(i.view=this,this.handles.add([ne(()=>this.root,r=>{i.container=r?rht(r):null},zt),ne(()=>this.popup,(r,n)=>{const s="popup",o="manual";n&&i.remove(n,s),r&&(r.view=i.view,i.add(r,{key:s,position:o}))},zt)],"ui"))}_stopMeasuring(){this.handles.remove("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const i=this._freqInfo;i.freq=A3,i.time=x4,this.handles.add([(()=>{const r=()=>{i.freq=A3,i.time=x4};return window.addEventListener("resize",r),{remove(){window.removeEventListener("resize",r)}}})(),E_({prepare:r=>{const n=this._measure(),s=this._freqInfo;if(s.time+=r.deltaTime,n&&(s.freq=A3,this._get("resizing")||this._set("resizing",!0)),s.time<s.freq)return;s.time=0;const o=this._position();s.freq=o||n?A3:Math.min(x4,s.freq*sht),!n&&s.freq>=nht&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const i=this.container,r=i?i.clientWidth:0,n=i?i.clientHeight:0;if(r===0||n===0)return this.suspended||this._set("suspended",!0),!1;const s=this.width,o=this.height;return r===s&&n===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",r),this._set("height",n),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:s,oldHeight:o,width:r,height:n}),!0)}_position(){const i=this.container,r=this.position,n=i&&iht(i);return!!n&&(!r||n[0]!==r[0]||n[1]!==r[1])&&(this._set("position",[n[0],n[1]]),!0)}forceDOMReadyCycle(){}};return u([d()],e.prototype,"container",null),u([d({readOnly:!0})],e.prototype,"focused",null),u([d({readOnly:!0})],e.prototype,"height",void 0),u([d({type:Bme})],e.prototype,"popup",null),u([d({type:Yde})],e.prototype,"overlay",void 0),u([d({readOnly:!0})],e.prototype,"position",void 0),u([d({readOnly:!0})],e.prototype,"resizing",void 0),u([d({readOnly:!0})],e.prototype,"root",void 0),u([d({value:null,readOnly:!0})],e.prototype,"size",null),u([d({readOnly:!0})],e.prototype,"surface",void 0),u([d({readOnly:!0})],e.prototype,"suspended",void 0),u([d()],e.prototype,"ui",void 0),u([d({readOnly:!0})],e.prototype,"userContent",void 0),u([d({readOnly:!0})],e.prototype,"width",void 0),u([d()],e.prototype,"widthBreakpoint",void 0),e=u([$("esri.views.DOMContainer")],e),e},vIe=t=>{let e=class extends t{async fetchPopupFeatures(i,r){await this.when();const{location:n,queryArea:s,layerViewsAndGraphics:o,clientOnlyGraphics:a}=await this._prepareFetchPopupFeatures(i,r),l=Promise.resolve(a),c=this._queryLayerPopupFeatures(s,o,r),h=c.map(p=>p.promise);return{location:n,clientOnlyGraphics:a,allGraphicsPromise:mY([l,...h]).then(p=>Array.from(new Set(p.flat()))),promisesPerLayerView:c}}_queryLayerPopupFeatures(i,r,n){return r.map(({layerView:s,graphics:o})=>{const a={clientGraphics:o,event:v(n)?n.event:void 0,signal:v(n)?n.signal:void 0,defaultPopupTemplateEnabled:!!v(n)&&!!n.defaultPopupTemplateEnabled},l=s.fetchPopupFeatures(i,a);return{layerView:s,promise:l}})}_isValidPopupGraphic(i,r){return i&&!!i.getEffectivePopupTemplate(v(r)&&r.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(i,r){const{clientGraphics:n,queryArea:s,location:o}=await this._popupHitTestGraphics(i,r),a=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:l,clientOnlyGraphics:c}=this._graphicsPerFetchPopupLayerView(n,a);return{clientOnlyGraphics:c,layerViewsAndGraphics:l,queryArea:s,location:o}}async _popupHitTestGraphics(i,r){const n=await this.popupHitTest(i),s=n.results,o=n.mapPoint,a=s.filter(c=>c.type==="graphic"&&this._isValidPopupGraphic(c.graphic,r)),l=a.length?a[0].mapPoint:null;return{clientGraphics:a.map(c=>c.graphic),queryArea:o,location:o||l}}_getFetchPopupLayerViews(){const i=[];return this.allLayerViews.forEach(r=>{this._isValidPopupLayerView(r)&&i.push(r)}),v(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&i.push(this.graphicsView),i.reverse()}_isValidPopupLayerView(i){return v(i)&&(!("layer"in i)||!i.suspended)&&"fetchPopupFeatures"in i}_graphicsPerFetchPopupLayerView(i,r){const n=[],s=new Map,o=r.map(a=>{const l=[];return"layer"in a?s.set(a.layer,l):s.set(a.graphics,l),{layerView:a,graphics:l}});for(const a of i){const l=s.get(a.layer)||s.get(a.sourceLayer)||null;l?l.push(a):n.push(a)}return{layerViewsAndGraphics:o,clientOnlyGraphics:n}}};return e=u([$("esri.views.PopupView")],e),e};async function Foe(t,e){return await t.load(),oht(t,e)}async function oht(t,e){const i=[],r=(...s)=>{for(const o of s)R(o)||(Array.isArray(o)?r(...o):tt.isCollection(o)?o.forEach(a=>r(a)):Ju.isLoadable(o)&&i.push(o))};e(r);let n=null;if(await Het(i,async s=>{const o=await _m(aht(s)?s.loadAll():s.load());o.ok!==!1||n||(n=o)}),n)throw n.error;return t}function aht(t){return"loadAll"in t&&typeof t.loadAll=="function"}async function lht(t){if(!t)return;const e=t.includes("-vector")?t.slice(0,t.indexOf("-vector")):t,i=await CAe("esri/t9n/basemaps");return i[t]||i[e]}const uQ={streets:{id:"streets",classic:!0,deprecated:!0,get thumbnailUrl(){return ar("esri/images/basemap/streets.jpg")},baseMapLayers:[{id:"streets-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Street Map",showLegend:!1,visibility:!0,opacity:1}]},satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return ar("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return ar("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return ar("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},topo:{id:"topo",classic:!0,deprecated:!0,get thumbnailUrl(){return ar("esri/images/basemap/topo.jpg")},baseMapLayers:[{id:"topo-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Topo Map",showLegend:!1,visibility:!0,opacity:1}]},gray:{id:"gray",classic:!0,deprecated:!0,get thumbnailUrl(){return ar("esri/images/basemap/gray.jpg")},baseMapLayers:[{id:"gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"dark-gray":{id:"dark-gray",classic:!0,deprecated:!0,get thumbnailUrl(){return ar("esri/images/basemap/dark-gray.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"dark-gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return ar("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"national-geographic":{id:"national-geographic",classic:!0,deprecated:!0,get thumbnailUrl(){return ar("esri/images/basemap/national-geographic.jpg")},baseMapLayers:[{id:"national-geographic-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer",title:"NatGeo World Map",showLegend:!1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return ar("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return ar("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return ar("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return ar("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return ar("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return ar("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return ar("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return ar("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"arcgis-imagery":{get thumbnailUrl(){return ar("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return ar("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return ar("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return ar("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return ar("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return ar("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return ar("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return ar("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return ar("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return ar("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}},cht=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),uht=new Set(["csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","map-image","map-notes","media","ogc-feature","route","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function hht(t){return t.layerContainerType==="basemap"?cht:t.layerContainerType==="operational-layers"?uht:null}function dht(t,e){if(e.restrictedWebMapWriting){const i=hht(e);return!v(i)||i.has(t.type)&&!gB(t)}return!0}function pht(t,e){if(e)if(gB(t)){const i=cN("featureCollection.layers",e),r=i&&i[0]&&i[0].layerDefinition;r&&iH(t,r)}else t.type==="stream"?iH(t,e.layerDefinition=e.layerDefinition||{}):t.type!=="group"&&iH(t,e)}function iH(t,e){"maxScale"in t&&(e.maxScale=G8(t.maxScale)??void 0),"minScale"in t&&(e.minScale=G8(t.minScale)??void 0)}function fht(t,e){if(pht(t,e),e&&("blendMode"in t&&(e.blendMode=t.blendMode,e.blendMode==="normal"&&delete e.blendMode),e.opacity=G8(t.opacity)??void 0,e.title=t.title||"Layer",e.visibility=t.visible,"legendEnabled"in t&&t.type!=="wmts"))if(gB(t)){const i=e.featureCollection;i&&(i.showLegend=t.legendEnabled)}else e.showLegend=t.legendEnabled}function hQ(t,e,i){if(!("write"in t)||!t.write)return i&&i.messages&&i.messages.push(new H("layer:unsupported",`Layers (${t.title}, ${t.id}) of type '${t.declaredClass}' cannot be persisted`,{layer:t})),null;if(dht(t,i)){const r={};return t.write(r,i)?r:null}return v(e)&&fht(t,e=se(e)),e}var lU;let mht=0;const bIe="esri.Basemap";let Fd=lU=class extends Pw(Ju){constructor(t){super(t),this.id=null,this.portalItem=null,this.spatialReference=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+mht++,this.baseLayers=new tt,this.referenceLayers=new tt;const e=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type==="elevation"&&re.getLogger(this.declaredClass).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a basemap layer and will therefore be ignored.`)},i=r=>{r.parent=null};this.baseLayers.on("after-add",r=>e(r.item)),this.referenceLayers.on("after-add",r=>e(r.item)),this.baseLayers.on("after-remove",r=>i(r.item)),this.referenceLayers.on("after-remove",r=>i(r.item))}initialize(){this.when().catch(t=>{re.getLogger(this.declaredClass).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){var i;const t=this.baseLayers.removeAll();for(const r of t)r.destroy();const e=this.referenceLayers.removeAll();for(const r of e)r.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),(i=this.portalItem)==null||i.destroy(),this.portalItem=null}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set baseLayers(t){this._set("baseLayers",rw(t,this._get("baseLayers")))}_writeBaseLayers(t,e,i){const r=[];t&&(i={...i,layerContainerType:"basemap"},this.baseLayers.forEach(n=>{const s=hQ(n,i.webmap?i.webmap.getLayerJSONFromResourceInfo(n):null,i);v(s)&&r.push(s)}),this.referenceLayers.forEach(n=>{const s=hQ(n,i.webmap?i.webmap.getLayerJSONFromResourceInfo(n):null,i);v(s)&&(n.type!=="scene"&&(s.isReference=!0),r.push(s))})),e.baseMapLayers=r}set referenceLayers(t){this._set("referenceLayers",rw(t,this._get("referenceLayers")))}writeTitle(t,e){e.title=t||"Basemap"}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return Foe(this,t=>{t(this.baseLayers,this.referenceLayers)})}clone(){const t={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.slice(),referenceLayers:this.referenceLayers.slice()};return this.loaded&&(t.loadStatus="loaded"),new lU({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}write(t,e){return t=t||{},e&&e.origin||(e={origin:"web-map",...e}),super.write(t,e),!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(t.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(i=>{const r=se(i);return r.url&&fy(r.url)&&(r.url=`https:${r.url}`),r.templateUrl&&fy(r.templateUrl)&&(r.templateUrl=`https:${r.templateUrl}`),r})),t}async _loadFromSource(t){const{resourceInfo:e,portalItem:i}=this;ui(t);const r=[];if(e){const n=e.context?e.context.url:null;if(r.push(this._loadLayersFromJSON(e.data,n,t)),e.data.id&&!e.data.title){const s=e.data.id;r.push(lht(s).then(o=>{o&&this.read({title:o},e.context)}))}}else i&&r.push(this._loadFromItem(i,t));await Promise.all(r)}async _loadLayersFromJSON(t,e,i){const r=this.resourceInfo&&this.resourceInfo.context,n=this.portalItem&&this.portalItem.portal||r&&r.portal||null,s=r&&r.origin==="web-scene"?"web-scene":"web-map",{populateOperationalLayers:o}=await Q(()=>import("./layersCreator-2ab7566d.js"),["assets/layersCreator-2ab7566d.js","assets/lazyLayerLoader-47b7672a.js","assets/portalLayers-5444e28e.js","assets/layersLoader-2d63a9c9.js","assets/fetchService-990f8c03.js","assets/jsonContext-7f6e363e.js"]),a=[];if(ui(i),t.baseMapLayers&&Array.isArray(t.baseMapLayers)){const l={context:{origin:s,url:e,portal:n,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},c=f=>s==="web-scene"&&f.layerType==="ArcGISSceneServiceLayer"||f.isReference,h=o(this.baseLayers,t.baseMapLayers.filter(f=>!c(f)),l);a.push(h);const p=o(this.referenceLayers,t.baseMapLayers.filter(c),l);a.push(p)}await ma(a)}async _loadFromItem(t,e){const i=await t.load(e),r=await i.fetchData("json",e),n=Bo(t.itemUrl??"");return this._set("resourceInfo",{data:r.baseMap??{},context:{origin:t.type==="Web Scene"?"web-scene":"web-map",portal:t.portal||ya.getDefault(),url:n}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),this.read({title:t.title,thumbnailUrl:t.thumbnailUrl},{origin:"portal-item",portal:t.portal||ya.getDefault(),url:n}),this._loadLayersFromJSON(this.resourceInfo.data,n,e)}static fromId(t){const e=uQ[t];if(e){if(e.deprecated){let i=null;t==="dark-gray"?i="dark-gray-vector":t==="gray"?i="gray-vector":t==="streets"?i="streets-vector":t==="topo"&&(i="topo-vector"),d2e(re.getLogger(bIe),`The ${t} basemap has entered mature support and is no longer being updated.`,{replacement:i,see:"https://arcg.is/1iq8aD",warnOnce:!0})}return lU.fromJSON(e)}return null}};u([d({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(t,e,i,r){this._writeBaseLayers(t,e,r)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:tt}},writer(t,e,i,r){this._writeBaseLayers(t,e,r)}}}}}})],Fd.prototype,"baseLayers",null),u([d({type:String,json:{origins:{"web-scene":{write:!0}}}})],Fd.prototype,"id",void 0),u([d({type:l_})],Fd.prototype,"portalItem",void 0),u([d()],Fd.prototype,"referenceLayers",null),u([d({readOnly:!0})],Fd.prototype,"resourceInfo",void 0),u([d({type:Je})],Fd.prototype,"spatialReference",void 0),u([d()],Fd.prototype,"thumbnailUrl",void 0),u([d({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],Fd.prototype,"title",void 0),u([Ne("title")],Fd.prototype,"writeTitle",null),Fd=lU=u([$(bIe)],Fd);const GV=Fd,ght=Object.freeze(Object.defineProperty({__proto__:null,default:GV},Symbol.toStringTag,{value:"Module"}));var dQ;let cU=dQ=class extends fe{constructor(t){super(t),this.type="none"}clone(){return new dQ({type:this.type})}};u([ot({none:"none",stayAbove:"stay-above"})],cU.prototype,"type",void 0),cU=dQ=u([$("esri.ground.NavigationConstraint")],cU);let Hn=class extends ve{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1,this.TERRAIN_USE_LEGACY_SHADING=!1}};u([d()],Hn.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),u([d()],Hn.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),u([d()],Hn.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),u([d()],Hn.prototype,"DECONFLICTOR_SHOW_GRID",void 0),u([d()],Hn.prototype,"LABELS_SHOW_BORDER",void 0),u([d()],Hn.prototype,"TEXT_SHOW_BASELINE",void 0),u([d()],Hn.prototype,"TEXT_SHOW_BORDER",void 0),u([d()],Hn.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),u([d()],Hn.prototype,"OVERLAY_SHOW_CENTER",void 0),u([d()],Hn.prototype,"SHOW_POI",void 0),u([d()],Hn.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),u([d()],Hn.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),u([d()],Hn.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),u([d()],Hn.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),u([d()],Hn.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),u([d()],Hn.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),u([d()],Hn.prototype,"I3S_TREE_SHOW_TILES",void 0),u([d()],Hn.prototype,"I3S_SHOW_MODIFICATIONS",void 0),u([d()],Hn.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),u([d()],Hn.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),u([d()],Hn.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),u([d()],Hn.prototype,"LINE_WIREFRAMES",void 0),u([d()],Hn.prototype,"TERRAIN_USE_LEGACY_SHADING",void 0),Hn=u([$("esri.views.3d.support.DebugFlags")],Hn);const tr=new Hn;var pQ;let ug=pQ=class extends Pw(Ju){constructor(t){super(t),this.opacity=1,this.shading=!tr.TERRAIN_USE_LEGACY_SHADING,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new tt;const e=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type!=="elevation"&&r.type!=="base-elevation"&&re.getLogger(this.declaredClass).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},i=r=>{r.parent=null};this.layers.on("after-add",r=>e(r.item)),this.layers.on("after-remove",r=>i(r.item))}initialize(){this.when().catch(t=>{re.getLogger(this.declaredClass).error("#load()","Failed to load ground",t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.layers.removeAll();for(const e of t)e.destroy();this.layers.destroy()}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set layers(t){this._set("layers",rw(t,this._get("layers")))}writeLayers(t,e,i,r){const n=[];t&&(r={...r,layerContainerType:"ground"},t.forEach(s=>{if("write"in s){const o={};Hrt(s)().write(o,r)&&n.push(o)}else r&&r.messages&&r.messages.push(new H("layer:unsupported",`Layers (${s.title}, ${s.id}) of type '${s.declaredClass}' cannot be persisted in the ground`,{layer:s}))})),e.layers=n}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return Foe(this,t=>{t(this.layers)})}async queryElevation(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:i}=await Q(()=>import("./ElevationQuery-a5a47287.js"),[]);ui(e);const r=new i,n=this.layers.filter(Gme).toArray();return r.queryAll(n,t,e)}async createElevationSampler(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:i}=await Q(()=>import("./ElevationQuery-a5a47287.js"),[]);ui(e);const r=new i,n=this.layers.filter(Gme).toArray();return r.createSamplerAll(n,t,e)}clone(){const t={opacity:this.opacity,surfaceColor:se(this.surfaceColor),navigationConstraint:se(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(t.loadStatus="loaded"),new pQ({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}_loadFromSource(t){const e=this.resourceInfo;return e?this._loadLayersFromJSON(e.data,e.context,t):Promise.resolve()}_loadLayersFromJSON(t,e,i){const r=e&&e.origin||"web-scene",n=e&&e.portal||null,s=e&&e.url||null;return Q(()=>import("./layersCreator-2ab7566d.js"),["assets/layersCreator-2ab7566d.js","assets/lazyLayerLoader-47b7672a.js","assets/portalLayers-5444e28e.js","assets/layersLoader-2d63a9c9.js","assets/fetchService-990f8c03.js","assets/jsonContext-7f6e363e.js"]).then(({populateOperationalLayers:o})=>{ui(i);const a=[];if(t.layers&&Array.isArray(t.layers)){const l={context:{origin:r,url:s,portal:n,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,t.layers,l))}return ma(a)}).then(()=>{})}};function yht(t){return t&&"createElevationSampler"in t}function Gme(t){return t.type==="elevation"||yht(t)}u([d({json:{read:!1}})],ug.prototype,"layers",null),u([Ne("layers")],ug.prototype,"writeLayers",null),u([d({readOnly:!0})],ug.prototype,"resourceInfo",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:Kr,read:{reader:YL,source:"transparency"},write:{writer:(t,e)=>{e.transparency=G9(t)},target:"transparency"}}})],ug.prototype,"opacity",void 0),u([d({type:Boolean,nonNullable:!0,json:{read:!1}})],ug.prototype,"shading",void 0),u([d({type:Xe,json:{type:[Kr],write:(t,e)=>{e.surfaceColor=t.toJSON().slice(0,3)}}})],ug.prototype,"surfaceColor",void 0),u([d({type:cU,json:{write:!0}})],ug.prototype,"navigationConstraint",void 0),ug=pQ=u([$("esri.Ground")],ug);const HV=ug;function _ht(t){var e,i;return!(!(t!=null&&t.loaded)||!((i=(e=CMe(t))==null?void 0:e.operations)!=null&&i.supportsEditing)||"editingEnabled"in t&&!jQe(t))}const Hme=re.getLogger("esri.support.basemapUtils");function vht(){return{}}function bht(t){for(const e in t){const i=t[e];(i==null?void 0:i.destroyed)===!1&&i.destroy(),delete t[e]}}function wht(t,e){let i;if(typeof t=="string"){if(!(t in uQ)){const r=Object.entries(uQ).filter(([n,s])=>nr.apiKey&&!s.classic||!nr.apiKey&&s.classic&&!s.deprecated).map(([n])=>`"${n}"`).join(", ");return Hme.warn(`Unable to find basemap definition for: ${t}. Try one of these: ${r}`),null}e&&(i=e[t]),i||(i=GV.fromId(t),e&&(e[t]=i))}else i=Ts(GV,t);return i!=null&&i.destroyed&&(Hme.warn("The provided basemap is already destroyed",{basemap:i}),i=null),i}function xht(t){return!!(t!=null&&t.baseLayers.concat(t.referenceLayers).some(wIe))}function wIe(t){var e;if(qme(t.url))return!0;if(t.type==="vector-tile"){for(const i in t.sourceNameToSource)if(qme((e=t.sourceNameToSource[i])==null?void 0:e.sourceUrl))return!0}return!1}function Tht(t,e){var s;if(R(e)||R(t))return{spatialReference:null,updating:!1};if(e.loadStatus==="not-loaded")return e.load(),{spatialReference:null,updating:!0};if(e.spatialReference)return{spatialReference:e.spatialReference,updating:!1};if(e.baseLayers.length===0)return{spatialReference:null,updating:!1};const i=e.baseLayers.getItemAt(0);switch(i.loadStatus){case"not-loaded":i.load();case"loading":return{spatialReference:null,updating:!0};case"failed":return{spatialReference:null,updating:!1}}const r=(("supportedSpatialReferences"in i?i.supportedSpatialReferences:null)||["tileInfo"in i?(s=i.tileInfo)==null?void 0:s.spatialReference:i.spatialReference]).filter(Boolean),n=t.spatialReference;return n?{spatialReference:r.find(o=>n.equals(o))??r[0]??null,updating:!1}:{spatialReference:r[0],updating:!1}}const Sht=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;function qme(t){if(!t)return!1;const e=new Ub(zc(t));return!!e.authority&&Sht.test(e.authority)}function Eht(t){return new CM({getCollections:()=>[t.tables,t.layers],getChildrenFunction:e=>{const i=[];return"tables"in e&&i.push(e.tables),"layers"in e&&i.push(e.layers),i},itemFilterFunction:e=>{const i=e.parent;return!!i&&"tables"in i&&i.tables.includes(e)}})}const Wme={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function Cht(t){let e=null;if(typeof t=="string")if(t in Wme){const i=Wme[t];e=new HV({resourceInfo:{data:{layers:[i]}}})}else re.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${t}. Try "world-elevation"`);else e=Ts(HV,t);return e}function fQ(t,e,i){let r,n;if(t)for(let s=0,o=t.length;s<o;s++){if(r=t.getItemAt(s),r[e]===i)return r;if((r==null?void 0:r.type)==="group"&&(n=fQ(r.layers,e,i),n))return n}}const Aht=t=>{let e=class extends t{constructor(...i){super(...i),this.layers=new tt;const r=o=>{o.parent&&"remove"in o.parent&&o.parent.remove(o)},n=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||re.getLogger(this.declaredClass).error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},s=o=>{o.parent=null,this.layerRemoved(o)};this.layers.on("before-add",o=>r(o.item)),this.layers.on("after-add",o=>n(o.item)),this.layers.on("after-remove",o=>s(o.item))}destroy(){const i=this.layers.removeAll();for(const r of i)this.layerRemoved(r),r.destroy();this.layers.destroy()}set layers(i){this._set("layers",rw(i,this._get("layers")))}add(i,r){const n=this.layers;if(r=n.getNextIndex(r),i instanceof cD){const s=i;s.parent===this?this.reorder(s,r):n.add(s,r)}else ih(i)?i.then(s=>{this.destroyed||this.add(s,r)}):re.getLogger(this.declaredClass).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(i,r){const n=this.layers;let s=n.getNextIndex(r);i.slice().forEach(o=>{o.parent!==this?(n.add(o,s),s+=1):this.reorder(o,s)})}findLayerById(i){return fQ(this.layers,"id",i)}findLayerByUid(i){return fQ(this.layers,"uid",i)}remove(i){return this.layers.remove(i)}removeMany(i){return this.layers.removeMany(i)}removeAll(){return this.layers.removeAll()}reorder(i,r){return this.layers.reorder(i,r)}layerAdded(i){}layerRemoved(i){}};return u([d()],e.prototype,"layers",null),e=u([$("esri.support.LayersMixin")],e),e};function mQ(t,e,i){if(t)for(let r=0,n=t.length;r<n;r++){const s=t.getItemAt(r);if(s[e]===i)return s;if((s==null?void 0:s.type)==="group"){const o=mQ(s.tables,e,i);if(o)return o}}}const Rht=t=>{let e=class extends t{constructor(...i){super(...i),this.tables=new tt,this.tables.on("after-add",r=>{const n=r.item;n.parent&&n.parent!==this&&"tables"in n.parent&&n.parent.tables.remove(n),n.parent=this,n.type!=="feature"&&re.getLogger(this.declaredClass).error(`Layer 'title:${n.title}, id:${n.id}' of type '${n.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",r=>{r.item.parent=null})}destroy(){const i=this.tables.removeAll();for(const r of i)r.destroy();this.tables.destroy()}set tables(i){this._set("tables",rw(i,this._get("tables")))}findTableById(i){return mQ(this.tables,"id",i)}findTableByUid(i){return mQ(this.tables,"uid",i)}};return u([d()],e.prototype,"tables",null),e=u([$("esri.support.TablesMixin")],e),e};let hg=class extends Rht(Aht(An.EventedMixin(ve))){constructor(e){super(e),this.allLayers=new CM({getCollections:()=>{var i,r,n;return[(i=this.basemap)==null?void 0:i.baseLayers,(r=this.ground)==null?void 0:r.layers,this.layers,(n=this.basemap)==null?void 0:n.referenceLayers]},getChildrenFunction:i=>"layers"in i?i.layers:null}),this.allTables=Eht(this),this.basemap=null,this.editableLayers=new CM({getCollections:()=>[this.allLayers],itemFilterFunction:_ht}),this.ground=new HV,this._basemapCache=vht()}destroy(){var e,i;this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),(e=this.ground)==null||e.destroy(),(i=this.basemap)==null||i.destroy(),bht(this._basemapCache),this._basemapCache=null}castBasemap(e){return wht(e,this._basemapCache)}castGround(e){const i=Cht(e);return R(i)?this._get("ground"):i}findLayerById(e){return this.allLayers.find(i=>i.id===e)}findTableById(e){return this.allTables.find(i=>i.id===e)}};u([d({readOnly:!0,dependsOn:[]})],hg.prototype,"allLayers",void 0),u([d({readOnly:!0})],hg.prototype,"allTables",void 0),u([d({type:GV})],hg.prototype,"basemap",void 0),u([ri("basemap")],hg.prototype,"castBasemap",null),u([d({readOnly:!0})],hg.prototype,"editableLayers",void 0),u([d({type:HV,nonNullable:!0})],hg.prototype,"ground",void 0),u([ri("ground")],hg.prototype,"castGround",null),hg=u([$("esri.Map")],hg);const FB=hg;let j$=class extends Fw(tt){constructor(e){super(e),this.handles.add([this.on("before-add",i=>{R(i.item)&&i.preventDefault()}),this.on("after-add",i=>this._own(i.item)),this.on("after-remove",i=>this._release(i.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(tt.ofType(this.itemType.Type))(e):new tt(e)}};function gQ(t,e){return{type:t,cast:XCe,set(i){const r=rw(i,this._get(e),t);r.owner=this,this._set(e,r)}}}u([d()],j$.prototype,"owner",null),j$=u([$("esri.core.support.OwningCollection")],j$);let VM=class extends j${constructor(e){super(e),this.handles.add(this.on("before-add",i=>{R(i.item)||i.item.parent===this.owner&&(re.getLogger(this.declaredClass).warn("Analysis inside the collection must be unique. Not adding this element again."),i.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};VM=u([$("esri.support.AnalysesCollection")],VM);let G$=class extends j${_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};u([mne({Type:Ha,ensureType:Ts(Ha)})],G$.prototype,"itemType",void 0),G$=u([$("esri.support.GraphicsCollection")],G$);let y1=class extends ve{constructor(e){super(e),this.view=null,this.baseLayerViews=new tt,this.referenceLayerViews=new tt,this._loadingHandle=ne(()=>{var i,r;return(r=(i=this.view)==null?void 0:i.map)==null?void 0:r.basemap},i=>{i&&i.load().catch(()=>{})},zt)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null)}get suspended(){return!this.view||this.view.suspended}get updating(){var i,r;if(this.view&&this.view.suspended)return!1;const e=(r=(i=this.view)==null?void 0:i.map)==null?void 0:r.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(n=>n.updating)||this.referenceLayerViews.some(n=>n.updating))}};u([d({constructOnly:!0})],y1.prototype,"view",void 0),u([d({readOnly:!0})],y1.prototype,"baseLayerViews",void 0),u([d({readOnly:!0})],y1.prototype,"referenceLayerViews",void 0),u([d({readOnly:!0})],y1.prototype,"suspended",null),u([d({type:Boolean,readOnly:!0})],y1.prototype,"updating",null),y1=u([$("esri.views.BasemapView")],y1);function Mht(t){return"tryRecycleWith"in t}let Oht=class{constructor(e,i,r){this.layer=e,this.view=i,this.layerViewImporter=r,this._controller=new AbortController,this._deferred=S_(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,ja(this._controller.signal,()=>{const n=new H("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(n)})}tryRecycle(e){if(!this.done||!this.layerView||!Mht(this.layerView))return null;const i=this.layer.type,r=this._controller.signal;for(let n=0;n<e.length;n++){const s=e[n];if(s.type!==i)continue;const o=this.layerView.tryRecycleWith(s,{signal:r});if(o){e.splice(n,1),this.layer=s;const a=this.layerView,l=a.view;return this.promise=Promise.race([o.then(()=>(ui(this._controller.signal),s.emit("layerview-destroy",{view:l,layerView:a}),l.emit("layerview-destroy",{view:l,layerView:a}),s.emit("layerview-create",{view:l,layerView:a}),l.emit("layerview-create",{view:l,layerView:a}),a)),new Promise((c,h)=>ja(this._controller.signal,()=>h(Bi())))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:e}=this;if(!e)return;const{layer:i,view:r}=this;i.emit("layerview-destroy",{view:r,layerView:e}),r.emit("layerview-destroy",{layer:i,layerView:e}),this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null}async start(){var n,s,o;if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:i,view:r}=this;this._map=r.map;try{let a,l;if(await i.load({signal:e}),"prefetchResources"in i&&await((n=i.prefetchResources)==null?void 0:n.call(i,{signal:e})),Iht(i))a=await i.createLayerView(r,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(i))throw new H("layer:view-not-supported","No layerview implementation was found");const p=await this.layerViewImporter.importLayerView(i);ui(e),a="default"in p?new p.default({layer:i,view:r}):new p({layer:i,view:r})}const c=()=>{l=Nr(l),a.destroyed||a.destroy(),a.layer=null,a.parent=null,a.view=null,this.done=!0};l=ja(e,c),ui(e);try{await a.when()}catch(p){throw c(),p}if(!((o=(s=this._map)==null?void 0:s.allLayers)==null?void 0:o.includes(i)))return c(),void this._deferred.reject(new H("view:no-layerview-for-layer","The layer has been removed from the map",{layer:i}));this.layerView=a,i.emit("layerview-create",{view:r,layerView:a}),r.emit("layerview-create",{layer:i,layerView:a}),this.done=!0,this._deferred.resolve(a)}catch(a){i.emit("layerview-create-error",{view:r,error:a}),r.emit("layerview-create-error",{layer:i,error:a}),this.done=!0,this._deferred.reject(new H("layerview:create-error","layerview creation failed",{layer:i,error:a}))}}},kd=class extends ve{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new Jg,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var r;const i=(r=this.view.map)==null?void 0:r.allLayers;if(i)for(const n of i)this.layerViewImporter.hasLayerViewModule(n)&&this.layerViewImporter.importLayerView(n)},this._reschedule=()=>(R(this._workPromise)&&(this._workPromise=S_(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(V2(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var l,c,h;const i=this.view.map;if(this._map!==i&&(this.clear(),this._map=i),R(this._workPromise))return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const r=new Set,n=[],s=this.view.ready,o=p=>{if(!R(p)){for(const f of p)if(f){r.add(f);const m=this._layerLayerViewInfoMap.get(f);m&&s?m.start():m||this._recyclingInfoMap.has(f)||n.push(f),"layers"in f&&f.layers&&o(f.layers)}}};for(const p of this._rootCollectionNames)o(this.get(p));for(const[p,f]of this._layerLayerViewInfoMap)if(!r.has(p)){this._layerLayerViewInfoMap.delete(f.layer);const m=f.tryRecycle(n);m?(this._recyclingInfoMap.set(f.layer,f),m.then(()=>{this._recyclingInfoMap.delete(f.layer),this._layerLayerViewInfoMap.set(f.layer,f),this._reschedule()}).catch(()=>{this._recyclingInfoMap.delete(f.layer),f.destroy(),this._reschedule()})):f.destroy()}for(const[p,f]of this._recyclingInfoMap)r.has(p)||(this._recyclingInfoMap.delete(f.layer),f.destroy());for(const p of n)this._createLayerView(p);this._refreshCollections();const a=[(l=i==null?void 0:i.ground)==null?void 0:l.layers,(c=i==null?void 0:i.basemap)==null?void 0:c.baseLayers,(h=i==null?void 0:i.basemap)==null?void 0:h.referenceLayers,i==null?void 0:i.layers].filter(p=>!!p);r.forEach(p=>"layers"in p&&a.push(p.layers)),this.addHandles(a.map(p=>this._watchUpdatingTracking.addOnCollectionChange(()=>p,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.own([Kn(()=>{var e,i;return(i=(e=this.view)==null?void 0:e.map)==null?void 0:i.allLayers},"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),ne(()=>{const e=this.view,i=e==null?void 0:e.map;return[i==null?void 0:i.basemap,i==null?void 0:i.ground,i==null?void 0:i.layers,e==null?void 0:e.ready]},()=>this._reschedule(),Jr)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),this._watchUpdatingTracking.destroy(),this._map=null,v(this._workPromise)&&(this._workPromise.reject(Bi()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return v(this._workPromise)||this._watchUpdatingTracking.updating||pa(this._layerLayerViewInfoMap,e=>!e.done)}get updatingRemaining(){let e=0;for(const i of this._layerLayerViewInfoMap.values())i.done||++e;return e}clear(){if(!this.destroyed){for(const e of this._layerLayerViewInfoMap.values())e.destroy();this._layerLayerViewInfoMap.clear(),this._refreshCollections()}}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new H("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,i]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(e),this.get(i),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,i,r){if(!e||!i)return void(i&&i.removeAll());let n=0;for(const s of e){const o=this._layerLayerViewInfoMap.get(s);if(!o||!o.layerView)continue;const a=o.layerView;a.layer=s,a.parent=r,i.getItemAt(n)!==a&&i.splice(n,0,a),s.layers&&this._populateLayerViewsOwners(s.layers,a.layerViews,a),n+=1}n<i.length&&i.splice(n,i.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const i=new Oht(e,this.view,this.layerViewImporter);i.promise.then(()=>this._refreshCollections(),r=>{r&&(gs(r)||r.name==="cancelled:layerview-create")||re.getLogger(this.declaredClass).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:r}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,i),this.view.ready&&i.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};u([d()],kd.prototype,"_workPromise",void 0),u([d({readOnly:!0})],kd.prototype,"_watchUpdatingTracking",void 0),u([d({readOnly:!0})],kd.prototype,"_layersToLayerViews",null),u([d({readOnly:!0})],kd.prototype,"_rootCollectionNames",null),u([d()],kd.prototype,"layerViewImporter",void 0),u([d()],kd.prototype,"supportsGround",void 0),u([d({readOnly:!0})],kd.prototype,"updating",null),u([d({readOnly:!0})],kd.prototype,"updatingRemaining",null),u([d({constructOnly:!0})],kd.prototype,"view",void 0),kd=u([$("esri.views.LayerViewManager")],kd);const Pht=kd;function Iht(t){return"createLayerView"in t&&t.createLayerView!=null}let Th=class extends ve{constructor(e){super(e),this.factor=1.5,this.offset=Ws(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};u([d({type:Number})],Th.prototype,"factor",void 0),u([d({nonNullable:!0})],Th.prototype,"offset",void 0),u([d()],Th.prototype,"position",void 0),u([d({type:Number,range:{min:0}})],Th.prototype,"size",void 0),u([d()],Th.prototype,"maskUrl",void 0),u([d()],Th.prototype,"maskEnabled",void 0),u([d()],Th.prototype,"overlayUrl",void 0),u([d()],Th.prototype,"overlayEnabled",void 0),u([d({readOnly:!0})],Th.prototype,"version",null),u([d({type:Boolean})],Th.prototype,"visible",void 0),Th=u([$("esri.views.Magnifier")],Th);const xIe=Th;let $ht=class{constructor(){this._tasks=new Array,this._running=new jV(!1)}get length(){return this._tasks.length}get running(){return this._running.get()}destroy(){this.cancelAll()}runTask(e){for(;!e.done&&this._process(e);)e.madeProgress()}push(e,i,r){return this._running.set(!0),new Promise((n,s)=>this._tasks.push(new Xme(n,s,e,i,r)))}unshift(e,i,r){return this._running.set(!0),new Promise((n,s)=>this._tasks.unshift(new Xme(n,s,e,i,r)))}_process(e){var r;if(this._tasks.length===0)return!1;const i=this._tasks.shift();try{const n=fo(i.signal);if(n&&!i.abortCallback)i.reject(Bi());else{const s=n?(r=i.abortCallback)==null?void 0:r.call(i,Bi()):i.callback(e);ih(s)?s.then(i.resolve,i.reject):i.resolve(s)}}catch(n){i.reject(n)}return this._running.set(this._tasks.length>0),!0}cancelAll(){const e=Bi();for(const i of this._tasks)if(i.abortCallback){const r=i.abortCallback(e);i.resolve(r)}else i.reject(e);this._tasks.length=0,this._running.set(!1)}},Xme=class{constructor(e,i,r,n,s){this.resolve=e,this.reject=i,this.callback=r,this.signal=n,this.abortCallback=s}},fI=class extends ve{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};u([d()],fI.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),u([d()],fI.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),fI=u([$("esri.views.support.DebugFlags")],fI);const Lht=new fI;var Pi;(function(t){t[t.ANIMATING=0]="ANIMATING",t[t.INTERACTING=1]="INTERACTING",t[t.IDLE=2]="IDLE"})(Pi||(Pi={}));function Dht(){return new qV.Scheduler}var Ga,St;(function(t){t[t.YIELD=1]="YIELD"})(Ga||(Ga={})),function(t){t.RESOURCE_CONTROLLER_IMMEDIATE="immediate",t.RESOURCE_CONTROLLER="schedule",t.SLIDE="slide",t.STREAM_DATA_LOADER="stream loader",t.ELEVATION_QUERY="elevation query",t.TERRAIN_SURFACE="terrain",t.SURFACE_GEOMETRY_UPDATES="surface geometry updates",t.LOD_RENDERER="LoD renderer",t.GRAPHICS_CORE="Graphics3D",t.I3S_CONTROLLER="I3S",t.POINT_CLOUD_LAYER="point cloud",t.FEATURE_TILE_FETCHER="feature fetcher",t.OVERLAY="overlay",t.STAGE="stage",t.GRAPHICS_DECONFLICTOR="graphics deconflictor",t.FILTER_VISIBILITY="Graphics3D filter visibility",t.SCALE_VISIBILITY="Graphics3D scale visibility",t.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",t.POINT_OF_INTEREST_FREQUENT="POI frequent",t.POINT_OF_INTEREST_INFREQUENT="POI infrequent",t.LABELER="labeler",t.FEATURE_QUERY_ENGINE="feature query",t.FEATURE_TILE_TREE="feature tile tree",t.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",t.ELEVATION_ALIGNMENT="elevation alignment",t.TEXT_TEXTURE_ATLAS="text texture atlas",t.TEXTURE_UNLOAD="texture unload",t.LINE_OF_SIGHT_TOOL="line of sight tool",t.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",t.ELEVATION_PROFILE="elevation profile",t.SNAPPING="snapping",t.SHADOW_ACCUMULATOR="shadow accumulator",t.CLOUDS_GENERATOR="clouds generator",t[t.TEST_PRIO=1]="TEST_PRIO"}(St||(St={}));const Og=0,Yme=new Map([[St.RESOURCE_CONTROLLER_IMMEDIATE,Og],[St.RESOURCE_CONTROLLER,4],[St.SLIDE,Og],[St.STREAM_DATA_LOADER,Og],[St.ELEVATION_QUERY,Og],[St.TERRAIN_SURFACE,1],[St.SURFACE_GEOMETRY_UPDATES,1],[St.LOD_RENDERER,2],[St.GRAPHICS_CORE,2],[St.I3S_CONTROLLER,2],[St.POINT_CLOUD_LAYER,2],[St.FEATURE_TILE_FETCHER,2],[St.OVERLAY,4],[St.STAGE,4],[St.GRAPHICS_DECONFLICTOR,4],[St.FILTER_VISIBILITY,4],[St.SCALE_VISIBILITY,4],[St.FRUSTUM_VISIBILITY,4],[St.CLOUDS_GENERATOR,4],[St.POINT_OF_INTEREST_FREQUENT,6],[St.POINT_OF_INTEREST_INFREQUENT,30],[St.LABELER,8],[St.FEATURE_QUERY_ENGINE,8],[St.FEATURE_TILE_TREE,16],[St.FEATURE_TILE_TREE_ACTIVE,Og],[St.ELEVATION_ALIGNMENT,12],[St.TEXT_TEXTURE_ATLAS,12],[St.TEXTURE_UNLOAD,12],[St.LINE_OF_SIGHT_TOOL,16],[St.LINE_OF_SIGHT_TOOL_INTERACTIVE,Og],[St.SNAPPING,Og],[St.SHADOW_ACCUMULATOR,30]]);function Zme(t){return Yme.has(t)?Yme.get(t):typeof t=="number"?t:1}const Jme=6.5,Kme=1,Nht=30,Qme=1e3/30,ege=100,tge=.9;var qV,Qw;(function(t){class e{get updating(){return this._updating.get()}_updatingChanged(){this._updating.set(this._tasks.some(s=>s.needsUpdate))}constructor(){this._updating=new jV(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new X0("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new r,this._state=Pi.INTERACTING,this._tasks=new Wt,this._runQueue=new Wt,this._load=0,this._idleStateCallbacks=new Wt,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=ne(()=>Lht.SCHEDULER_LOG_SLOW_TASKS,o=>this._debug=o,zt);for(const o of Object.keys(St))this.performanceInfo.tasks.set(St[o],new X0(St[o]));const s=this;this._test={FRAME_SAFETY_BUDGET:Jme,INTERACTING_BUDGET:Qme,IDLE_BUDGET:ege,get availableBudget(){return s._budget.budget},usedBudget:0,getBudget:()=>s._budget,setBudget:o=>s._budget=o,updateTask:o=>this._updateTask(o),getState:o=>this._getState(o),getRuntime:o=>this._getRuntime(o),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(s=>s.remove()),this._tasks.clear(),Nr(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(s){this._updatingChanged(),s&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())}))}registerTask(s,o){const a=Zme(s),l=new i(this,s,o,a);return this._tasks.push(l),this._updatingChanged(),this.performanceInfo.tasks.has(s)||this.performanceInfo.tasks.set(s,new X0(s)),l}registerIdleStateCallbacks(s,o){const a={idleBegin:s,idleEnd:o};this._idleStateCallbacks.push(a),this.state===Pi.IDLE&&this._idleUpdatesStartFired&&a.idleBegin();const l=this;return{remove:()=>this._removeIdleStateCallbacks(a),set idleBegin(c){l._idleUpdatesStartFired&&(a.idleEnd(),l._state===Pi.IDLE&&c()),a.idleBegin=c},set idleEnd(c){a.idleEnd=c}}}get load(){return this._load}set state(s){this._state!==s&&(this._state=s,this.state!==Pi.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(o=>o.idleEnd())))}get state(){return this._state}updateBudget(s){this._test.usedBudget=0,++this._frameNumber;let o=Jme,a=s.frameDuration,l=Kme;switch(this.state){case Pi.IDLE:o=0,a=Math.max(ege,s.frameDuration),l=Nht;break;case Pi.INTERACTING:a=Math.max(Qme,s.frameDuration);case Pi.ANIMATING:}return a=a-s.elapsedFrameTime-o,this.state!==Pi.IDLE&&a<Kme&&!this._forceTask?(this._forceTask=!0,!1):(a=Math.max(a,l),this._budget.reset(a,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case Pi.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(s=>s.idleBegin())),this._runIdle();break;case Pi.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(s){this._idleUpdatesStartFired&&s.idleEnd(),this._idleStateCallbacks.removeUnordered(s)}removeTask(s){this._tasks.removeUnordered(s),this._runQueue.removeUnordered(s),this._updatingChanged()}_updateTask(s){this._tasks.forAll(o=>{o.name===s&&o.setPriority(s)})}_getState(s){if(this._runQueue.some(a=>a.name===s))return Qw.SCHEDULED;let o=Qw.IDLE;return this._tasks.forAll(a=>{a.name===s&&a.needsUpdate&&(a.schedulePriority<=1?o=Qw.READY:o!==Qw.READY&&(o=Qw.WAITING))}),o}_getRuntime(s){let o=0;return this._tasks.forAll(a=>{a.name===s&&(o+=a.runtime)}),o}_resetRuntimes(){this._tasks.forAll(s=>s.runtime=0)}_getRunning(){const s=new Map;if(this._tasks.forAll(a=>{a.needsUpdate&&s.set(a.name,(s.get(a.name)||0)+1)}),s.size===0)return null;let o="";return s.forEach((a,l)=>{o+=a>1?` ${a}x ${l}`:` ${l}`}),o}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const s=this._tasks.reduce((o,a)=>a.needsUpdate?++o:o,0);this._load=this._load*tge+s*(1-tge)}_schedule(){for(this._runQueue.filterInPlace(s=>!!s.needsUpdate||(s.schedulePriority=s.basePriority,!1)),this._tasks.forAll(s=>{s.basePriority===Og&&s.needsUpdate&&!this._runQueue.includes(s)&&s.blockFrame!==this._frameNumber&&this._runQueue.unshift(s)});this._runQueue.length===0;){let s=!1,o=0;if(this._tasks.forAll(a=>{a.needsUpdate&&a.schedulePriority!==0&&a.basePriority!==Og&&a.blockFrame!==this._frameNumber&&(s=!0,o=Math.max(o,a.basePriority),a.schedulePriority===1?(a.schedulePriority=0,this._runQueue.push(a)):--a.schedulePriority)}),!s)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const s=this._budget.now();this._startFrameTaskTimes();do for(;this._runQueue.length>0;){const o=this._budget.now(),a=this._runQueue.pop();this._budget.resetProgress();try{a.task.runTask(this._budget)===Ga.YIELD&&(a.blockFrame=this._frameNumber)}catch(c){re.getLogger("esri.views.support.Scheduler").error(`Exception in task "${a.name}"`,c)}!this._budget.hasProgressed&&a.blockFrame!==this._frameNumber&&a.needsUpdate&&(a.name,St.I3S_CONTROLLER,a.blockFrame=this._frameNumber),a.schedulePriority=a.basePriority;const l=this._budget.now()-o;if(a.runtime+=l,this._frameTaskTimes.set(a.priority,this._frameTaskTimes.get(a.priority)+l),this._debug&&l>2*this._budget.budget&&console.log("Task",a.name,"used",l,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-s)}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-s)}_startFrameTaskTimes(){for(const s of Object.keys(St))this._frameTaskTimes.set(St[s],0)}_recordFrameTaskTimes(s){this._frameTaskTimes.forEach((o,a)=>this.performanceInfo.tasks.get(a).record(o)),this.performanceInfo.total.record(s)}get test(){return this._test}}t.Scheduler=e;class i{get task(){return this._task.get()}get updating(){return this._queue.running}constructor(s,o,a,l){this._scheduler=s,this.name=o,this._basePriority=l,this.blockFrame=0,this.runtime=0,this._queue=new $ht,this._handles=new Xi,this.schedulePriority=this._basePriority,this._task=new jV(v(a)?a:this._queue),this._handles.add(yo(()=>this.task.running,c=>s.taskRunningChanged(c)))}remove(){this.processQueue(ql),this._scheduler.removeTask(this),this.schedule=zM.schedule,this.reschedule=zM.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(s){this.name=s;const o=Zme(s);this._basePriority!==Og&&this.schedulePriority===0||(this.schedulePriority=o),this._basePriority=o}get priority(){return this.name}set priority(s){this.setPriority(s)}get needsUpdate(){return this.updating||this.task.running}schedule(s,o,a){return this._queue.push(s,o,a)}reschedule(s,o,a){return this._queue.unshift(s,o,a)}processQueue(s){this._queue.runTask(s)}}class r{constructor(){this._begin=typeof performance<"u"?performance.now():0,this._budget=0,this._state=Pi.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(s){return!this.done&&(s()===!0&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(s){this._enabled=s}reset(s,o){this._begin=this.now(),this._budget=s,this._state=o,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}t.Budget=r})(qV||(qV={})),function(t){t.SCHEDULED="s",t.READY="r",t.WAITING="w",t.IDLE="i"}(Qw||(Qw={}));const ql=(()=>{const t=new qV.Budget;return t.enabled=!1,t})();let Fht=class{remove(){}processQueue(){}schedule(e,i,r){try{if(fo(i)){const n=Bi();return r?Promise.resolve(r(n)):Promise.reject(n)}return gY(e(ql))}catch(n){return Promise.reject(n)}}reschedule(e,i,r){return this.schedule(e,i,r)}};const zM=new Fht;let nR=class extends ve{constructor(e,i){super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=(i==null?void 0:i.registerTask(St.TEXTURE_UNLOAD))??zM}normalizeCtorArgs(){return{}}destroy(){super.destroy(),this._frameTask.remove(),this._textureRequests.forEach(e=>this._releaseTextureRequest(e)),this._textureRequests.clear()}get updating(){return this._frameTask.updating}fromData(e,i,r){const n=this.makeUid(e);let s=this._textureRequests.get(n);if(!s){const o=i();s={referenceCount:0,texture:o,textureAsync:null,abortController:null,onRemove:r},this._stage&&(this._stage.add(o),this._stage.loadImmediate(o)),this._textureRequests.set(n,s)}return s.referenceCount++,{uid:n,texture:s.texture,release:()=>this._release(n)}}_release(e){const i=this._textureRequests.get(e);i?(i.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),i.referenceCount--,i.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(e){if(!this._textureRequests)return;const i=this._textureRequests.get(e);!i||i.referenceCount>0||(this._releaseTextureRequest(i),this._textureRequests.delete(e))}_releaseTextureRequest(e){var i;e.onRemove&&e.onRemove(),e.texture?(i=this._stage)==null||i.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,i=null){return v(i)?`${e}.${i}px`:e}};u([d()],nR.prototype,"_frameTask",void 0),u([d()],nR.prototype,"updating",null),nR=u([$("esri.views.3d.support.TextureCollection")],nR);var ige;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right"})(ige||(ige={}));const TIe=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],SIe={};function EIe(t){return!!SIe[t]}function kht(t){for(const e of t)if(!EIe(e))return!1;return!0}TIe.forEach(t=>{SIe[t]=!0});let Uht=class{constructor(e){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this._handlers.forEach(({handler:i,priority:r},n)=>{var s;return(s=this.inputManager)==null?void 0:s.installHandlers(n,[i],r)})}disconnect(){this.inputManager&&this._handlers.forEach((e,i)=>{var r;return(r=this.inputManager)==null?void 0:r.uninstallHandlers(i)}),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(e,i,r,n){const s=Array.isArray(e)?e:e.split(",");if(!kht(s))return s.some(EIe)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,a;Array.isArray(i)?a=i:(o=i,a=[]),typeof r=="function"?o=r:n=r,n=n??ey.DEFAULT;const l=this._createUniqueGroupName(),c=new Vht(this.view,s,a,o);this._handlers.set(l,{handler:c,priority:n});for(const h of s){const p=this._handlerCounts.get(h)||0;this._handlerCounts.set(h,p+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],n),{remove:()=>this._removeHandler(l,s)}}hasHandler(e){return!!this._handlerCounts.get(e)}_removeHandler(e,i){if(this._handlers.has(e)){this._handlers.delete(e);for(const r of i){const n=this._handlerCounts.get(r);n===void 0?console.error("Trying to remove handler for event that has no handlers registered: ",r):n===1?this._handlerCounts.delete(r):this._handlerCounts.set(r,n-1)}}this.inputManager&&this.inputManager.uninstallHandlers(e)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},Vht=class extends an{constructor(e,i,r,n){super(!0),this._latestDragStart=void 0,this.view=e;for(const s of i)switch(s){case"click":this.registerIncoming("click",r,o=>n(this._wrapClick(o)));break;case"double-click":this.registerIncoming("double-click",r,o=>n(this._wrapDoubleClick(o)));break;case"immediate-click":this.registerIncoming("immediate-click",r,o=>n(this._wrapImmediateClick(o)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",r,o=>n(this._wrapImmediateDoubleClick(o)));break;case"hold":this.registerIncoming("hold",r,o=>n(this._wrapHold(o)));break;case"drag":this.registerIncoming("drag",r,o=>{const a=this._wrapDrag(o);a&&n(a)});break;case"key-down":this.registerIncoming("key-down",r,o=>n(this._wrapKeyDown(o)));break;case"key-up":this.registerIncoming("key-up",r,o=>n(this._wrapKeyUp(o)));break;case"pointer-down":this.registerIncoming("pointer-down",r,o=>n(this._wrapPointer(o,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",r,o=>n(this._wrapPointer(o,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",r,o=>n(this._wrapPointer(o,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",r,o=>n(this._wrapPointerDrag(o)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",r,o=>n(this._wrapMouseWheel(o)));break;case"pointer-enter":this.registerIncoming("pointer-enter",r,o=>n(this._wrapPointer(o,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",r,o=>n(this._wrapPointer(o,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",r,o=>{n(this._wrapGamepad(o))});break;case"focus":this.registerIncoming("focus",r,o=>{n(this._wrapFocus(o))});break;case"blur":this.registerIncoming("blur",r,o=>{n(this._wrapBlur(o))})}}_wrapFocus(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:i=>e.async(i),preventDefault:()=>e.preventDefault()}}_wrapBlur(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:i=>e.async(i),preventDefault:()=>e.preventDefault()}}_wrapClick(e){const{pointerType:i,button:r,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:h}=e;return{type:"click",pointerType:i,button:r,buttons:n,x:s,y:o,native:a,timestamp:h,screenPoint:Ws(s,o),mapPoint:this._getMapPoint(s,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}_wrapDoubleClick(e){const{pointerType:i,button:r,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:h}=e;return{type:"double-click",pointerType:i,button:r,buttons:n,x:s,y:o,native:a,timestamp:h,mapPoint:this._getMapPoint(s,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}_wrapImmediateClick(e){const{pointerType:i,button:r,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:h,timestamp:p}=e;return{type:"immediate-click",pointerId:c,pointerType:i,button:r,buttons:n,x:s,y:o,native:a,timestamp:p,mapPoint:this._getMapPoint(s,o),eventId:l,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}_wrapImmediateDoubleClick(e){const{pointerType:i,button:r,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:h,timestamp:p}=e;return{type:"immediate-double-click",pointerId:c,pointerType:i,button:r,buttons:n,x:s,y:o,native:a,timestamp:p,mapPoint:this._getMapPoint(s,o),eventId:l,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}_wrapHold(e){const{pointerType:i,button:r,buttons:n,x:s,y:o,native:a}=e.data,{cancelable:l,timestamp:c}=e;return{type:"hold",pointerType:i,button:r,buttons:n,x:s,y:o,native:a,timestamp:c,mapPoint:this._getMapPoint(s,o),cancelable:l,stopPropagation:()=>e.stopPropagation(),async:h=>e.async(h),preventDefault:()=>e.preventDefault()}}_getMapPoint(e,i){return this.view.toMap(Ws(e,i),{exclude:[]})}_wrapDrag(e){const i=e.data,{x:r,y:n}=i.center,{action:s,pointerType:o,button:a}=i;if(s==="start"&&(this._latestDragStart=i),!this._latestDragStart)return;const l=i.pointer.native,c=i.buttons,{cancelable:h,timestamp:p}=e,f={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return s==="end"&&(this._latestDragStart=void 0),{type:"drag",action:s,x:r,y:n,origin:f,pointerType:o,button:a,buttons:c,radius:i.radius,angle:ml(i.angle),native:l,timestamp:p,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}_wrapKeyDown(e){const{key:i,repeat:r,native:n}=e.data,{cancelable:s,timestamp:o}=e;return{type:"key-down",key:i,repeat:r,native:n,timestamp:o,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:a=>e.async(a),preventDefault:()=>e.preventDefault()}}_wrapKeyUp(e){const{key:i,native:r}=e.data,{cancelable:n,timestamp:s}=e;return{type:"key-up",key:i,native:r,timestamp:s,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:o=>e.async(o),preventDefault:()=>e.preventDefault()}}_wrapPointer(e,i){const{x:r,y:n,button:s,buttons:o,native:a,eventId:l}=e.data,c=a.pointerId,h=a.pointerType,{cancelable:p,timestamp:f}=e;return{type:i,x:r,y:n,pointerId:c,pointerType:h,button:s,buttons:o,native:a,timestamp:f,eventId:l,cancelable:p,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}_wrapPointerDrag(e){const{x:i,y:r,buttons:n,native:s,eventId:o}=e.data.currentEvent,{button:a}=e.data.startEvent,l=e.data.startEvent.native.pointerId,c=e.data.startEvent.native.pointerType,h=e.data.action,p={x:e.data.startEvent.x,y:e.data.startEvent.y},{cancelable:f,timestamp:m}=e;return{type:"pointer-drag",x:i,y:r,pointerId:l,pointerType:c,button:a,buttons:n,action:h,origin:p,native:s,timestamp:m,eventId:o,cancelable:f,stopPropagation:()=>e.stopPropagation(),async:g=>e.async(g),preventDefault:()=>e.preventDefault()}}_wrapMouseWheel(e){const{cancelable:i,data:r,timestamp:n}=e,{x:s,y:o,deltaY:a,native:l}=r;return{type:"mouse-wheel",x:s,y:o,deltaY:a,native:l,timestamp:n,cancelable:i,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}_wrapGamepad(e){const{action:i,state:r,device:n}=e.data,{cancelable:s,timestamp:o}=e,{buttons:a,axes:l}=r;return{type:"gamepad",device:n,timestamp:o,action:i,buttons:a,axes:l,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}};var dD,rge,nge;(function(t){t[t.USER=0]="USER",t[t.MANAGER=1]="MANAGER"})(dD||(dD={})),function(t){t[t.None=0]="None",t[t.Unfocused=1]="Unfocused",t[t.Focused=2]="Focused",t[t.Unselected=4]="Unselected",t[t.Selected=8]="Selected",t[t.All=15]="All"}(rge||(rge={})),function(t){t[t.None=0]="None",t[t.Custom1=16]="Custom1",t[t.Custom2=32]="Custom2",t[t.Custom3=64]="Custom3",t[t.Custom4=128]="Custom4",t[t.Custom5=256]="Custom5",t[t.Custom6=512]="Custom6",t[t.Custom7=1024]="Custom7",t[t.Custom8=2048]="Custom8",t[t.Custom9=4096]="Custom9",t[t.Custom10=8192]="Custom10",t[t.Custom11=16384]="Custom11",t[t.Custom12=32768]="Custom12",t[t.All=65520]="All"}(nge||(nge={}));function zht(t){return[t.on("before-add",e=>{const i=e.item;if(i==null||t.includes(i))return re.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void e.preventDefault();i.onAdd()}),t.on("after-remove",e=>{const i=e.item;i.active&&(i.view.activeTool=null),i.destroy()})]}function yQ(t){return t.visible&&t.getEditableFlag!=null&&t.getEditableFlag(dD.USER)&&t.getEditableFlag(dD.MANAGER)}function dg(t){return Ws(t.x,t.y)}function K7t(t){return Sn(t.x,t.y)}function CIe(t,e){var r;const i=(r=t instanceof HTMLElement?t:t.surface)==null?void 0:r.getBoundingClientRect();return i?Ws(e.clientX-i.left,e.clientY-i.top):Ws(0,0)}function WV(t,e){return e instanceof Event?CIe(t,e):dg(e)}function XV(t){if(t instanceof Event)return!0;if(typeof t=="object"&&"type"in t)switch(t.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}let Bht=class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}handleInputEvent(e,i){const r=()=>e.stopPropagation();switch(e.type){case"pointer-move":sge(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(r(),e.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!oge(e))break;const n=dg(e),s=this._intersect(n,e.pointerType,i.forEachTool);if(R(s))break;const o=s.manipulator,a=s.tool;!(v(o)&&v(a)&&o.interactive)||o.grabbable&&o.grabbableForEvent(e)||!o.grabbing||o.dragging||this._ungrabManipulatorBeforeDragging(o,e,i),v(o)&&v(a)&&o.interactive&&o.grabbable&&o.grabbableForEvent(e)&&!o.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:o,tool:a,start:n,pointerType:e.pointerType}),this._grabbedManipulators.size===1&&R(i.activeTool)&&(this._revertToNullActiveTool=!0,i.setActiveTool(s.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:n}),r());break}case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,i);break;case"pointer-drag":{if(!oge(e))break;const n=this._grabbedManipulators.get(e.pointerId),s=Vo(n,({manipulator:h})=>h),o=Vo(n,({tool:h})=>h);if(R(s)||R(o))break;const a=dg(e);a.x=_e(a.x,0,i.view.width),a.y=_e(a.y,0,i.view.height);const l=n.start,c=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":e.action!=="update"&&this._grabbedManipulators.size!==1||(s.dragging=!0,c?s.events.emit("drag",{action:"update",start:l,screenPoint:a}):s.events.emit("drag",{action:"start",start:l,screenPoint:a,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:o,manipulator:s,start:l}));break;case"end":s.dragging=!1,c&&s.events.emit("drag",{action:"end",start:l,screenPoint:a}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,i)}r();break}case"immediate-click":{const n=dg(e),s=this._intersect(n,e.pointerType,i.forEachTool);if(jht(e)||i.forEachTool(c=>{if((!v(s)||s.tool!==c||c.automaticManipulatorSelection)&&c.manipulators){let h=!1;c.manipulators.forEach(({manipulator:p})=>{p.selected&&(p.selected=!1,h=!0)}),h&&c.onManipulatorSelectionChanged&&c.onManipulatorSelectionChanged()}}),R(s))break;const{manipulator:o,tool:a}=s;if(!o.interactive)break;o.selectable&&a.automaticManipulatorSelection&&(o.selected=!o.selected,a.onManipulatorSelectionChanged&&a.onManipulatorSelectionChanged());const l=e.native.shiftKey;o.events.emit("immediate-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:l,stopPropagation:r});break}case"click":{const n=dg(e),s=this._intersect(n,e.pointerType,i.forEachTool),o=v(s)?s.manipulator:null;if(R(o)||!o.interactive)break;const a=e.native.shiftKey;o.events.emit(e.type,{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:a}),r();break}case"double-click":{const n=dg(e),s=this._intersect(n,e.pointerType,i.forEachTool),o=v(s)?s.manipulator:null;if(R(o)||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("double-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:r});break}case"immediate-double-click":{const n=dg(e),s=this._intersect(n,e.pointerType,i.forEachTool),o=v(s)?s.manipulator:null;if(R(o)||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:r});break}}this._onFocusChange(i.forEachTool)}_ungrabManipulatorBeforeDragging(e,i,r){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:i.pointerType,screenPoint:dg(i)}),this._grabbedManipulators.forEach(({manipulator:n},s)=>{n===e&&this._grabbedManipulators.delete(s)}),this._afterManipulatorUngrab(r.setActiveTool)}_handlePointerEnd(e,i){const r=Vo(this._grabbedManipulators.get(e.pointerId),({manipulator:n})=>n);R(r)||r.grabbing&&(r.grabbing=!1,r.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:dg(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorUngrab(i.setActiveTool))}_cursorFromMap(e){let i=null;return pa(e,({manipulator:r})=>!(R(r)||!r.interactive)&&(r.grabbing&&r.grabCursor?(i=r.grabCursor,!0):!!r.cursor&&(i=r.cursor,!0))),i}_onFocusChange(e){this._updateCursor(),this._updateFocusedManipulatorTools(e)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(e){const i=new Set,r=new Set;this._grabbedManipulators.forEach(({tool:n})=>{i.add(n)}),this._hoveredManipulators.forEach(({tool:n})=>{r.add(n)}),e(n=>{n.hasGrabbedManipulators=i.has(n),n.hasHoveredManipulators=r.has(n);const s=this._grabbedManipulators.values(),o=tje(s,({tool:a})=>a===n);n.firstGrabbedManipulator=v(o)?o.manipulator:null})}clearPointers(e,{forEachTool:i,setActiveTool:r},n=!0,s){const o=(a,l)=>a===e&&(R(s)||s===l);this._grabbedManipulators.forEach(({tool:a,manipulator:l,pointerType:c},h)=>{o(a,l)&&(this._grabbedManipulators.delete(h),l.grabbing=!1,l.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:c}))}),this._draggedManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._draggedManipulators.delete(c),l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}),n&&this._hoveredManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._hoveredManipulators.delete(c),l.hovering=!1)}),this._afterManipulatorUngrab(r),this._onFocusChange(i)}_intersect(e,i,r){let n=null;return r(s=>{if(s.manipulators==null||!yQ(s))return!1;const o=s.manipulators.intersect(e,i);return!R(o)&&(n={tool:s,manipulator:o},!0)}),n}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach((i,r)=>{this._updateHoveredStateForPointerAtScreenPosition(Ws(i.x,i.y),r,i.pointerType,e)})}handleHoverEvent(e,i){e.type!=="pointer-up"&&e.type!=="immediate-click"&&e.type!=="pointer-move"||!sge(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(dg(e),e.pointerId,e.pointerType,i)}_updateHoveredStateForPointerAtScreenPosition(e,i,r,n){let s=this._intersect(e,r,n);const o=Vo(this._hoveredManipulators.get(i),({manipulator:a})=>a);v(s)&&!s.manipulator.interactive&&(s=null),v(s)&&o===s.manipulator||(v(o)&&(o.hovering=!1),v(s)?(s.manipulator.hovering=!0,this._hoveredManipulators.set(i,s)):this._hoveredManipulators.delete(i),this._onFocusChange(n))}_afterManipulatorUngrab(e){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}};function sge(t){return t==="mouse"}function oge(t){return t.pointerType!=="mouse"||t.button===0}function jht(t){return!!t.native.shiftKey}const age="attached",rH="tools";let y0=class extends sD{constructor(e){super(e),this._manipulatorState=new Bht,this.tools=new tt,this.cursor=null,this._forEachTool=i=>{for(const r of this.tools.items)if(i(r))return}}initialize(){this.handles.add([this.view.on(TIe,e=>{this._handleInputEvent(e)},ey.TOOL),...zht(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.detach(),this.handles.removeAll()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(v(e)&&!this.view.ready)return void re.getLogger(this.declaredClass).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const i=this.activeTool;this._set("activeTool",e),v(i)&&i.deactivate(),v(e)&&e.activate(),this._removeIncompleteTools(e);for(const r of this.tools){this._updateToolEditableFlag(r);const n=yQ(r);!R(this.activeTool)&&n||this._manipulatorState.clearPointers(r,this._manipulatorStateEventArgs,!n)}this._updateCursor()}get updating(){var e;return this.updatingHandles.updating||this.tools.some(i=>i.updating)||(((e=this.textures)==null?void 0:e.updating)??!1)}attach(){var e;this.view.type==="3d"?(this._set("textures",new nR(this.view._stage,this.view.resourceController.scheduler)),this.handles.add([ne(()=>{const{state:i}=this.view;return"camera"in i&&i.camera},()=>this._forEachManipulator(i=>i.onViewChange())),(e=this.view.elevationProvider)==null?void 0:e.on("elevation-change",i=>this._forEachManipulator(r=>r.onElevationChange(i))),fm(()=>this._set("textures",Ve(this.textures)))],age)):this.handles.add(ne(()=>this.view.extent,()=>this._forEachManipulator(i=>i.onViewChange())))}detach(){v(this.activeTool)&&(this.activeTool=null),this.tools.removeAll(),this.handles.remove(age)}_forEachManipulator(e){this._forEachTool(i=>{i.manipulators&&i.manipulators.forEach(({manipulator:r})=>e(r,i))})}_handleInputEvent(e){let i=!1;const r={...e,stopPropagation:()=>{i=!0,e.stopPropagation()}};v(this.activeTool)?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(r):this._forEachTool(n=>{!i&&n.visible&&n.handleInputEvent(r)}),!i&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(r,this._manipulatorStateEventArgs),!i&&v(this.activeTool)&&this.activeTool.handleInputEventAfter(r),this._manipulatorState.handleHoverEvent(r,this._forEachTool),this._updateCursor()}_refreshToolWatchers(){this.handles.remove(rH),this._forEachTool(e=>{if(e instanceof ve){const i=ne(()=>[e.cursor,e.visible,e.editable],()=>{yQ(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.handles.add(i,rH)}e.manipulators&&this.handles.add([e.manipulators.on("after-remove",i=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,i.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],rH)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){var i;(i=e.setEditableFlag)==null||i.call(e,dD.MANAGER,R(this.activeTool)||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;R(e)&&this._forEachTool(i=>!(!v(i.cursor)||!i.visible)&&(e=i.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(i=>(R(e)||i!==e)&&!i.created&&i.removeIncompleteOnCancel).forEach(i=>{this.tools.remove(i)})}};u([d({constructOnly:!0,nonNullable:!0})],y0.prototype,"view",void 0),u([d({readOnly:!0,nonNullable:!0})],y0.prototype,"textures",void 0),u([d({value:null})],y0.prototype,"activeTool",null),u([d({readOnly:!0,type:tt})],y0.prototype,"tools",void 0),u([d({readOnly:!0})],y0.prototype,"cursor",void 0),u([d({readOnly:!0})],y0.prototype,"updating",null),y0=u([$("esri.views.ToolViewManager")],y0);const Ght=y0;let KC=class extends ve{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":Hht.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return qht[this.deviceType]}};u([d({nonNullable:!0,readOnly:!0})],KC.prototype,"nativeIndex",void 0),u([d({type:String,readOnly:!0})],KC.prototype,"deviceType",null),u([d({type:Number,readOnly:!0})],KC.prototype,"axisThreshold",null),KC=u([$("esri.views.input.gamepad.GamepadInputDevice")],KC);const Hht=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),qht={standard:.15,spacemouse:.025,unknown:0},koe=KC;let mI=class extends ve{constructor(...e){super(...e),this.devices=new tt,this.enabledFocusMode="document"}};u([d({type:tt.ofType(koe),readOnly:!0})],mI.prototype,"devices",void 0),u([d({type:["document","view","none"]})],mI.prototype,"enabledFocusMode",void 0),mI=u([$("esri.views.input.gamepad.GamepadSettings")],mI);const Wht=mI;let uU=class extends ve{constructor(){super(...arguments),this.gamepad=new Wht}};u([d({readOnly:!0})],uU.prototype,"gamepad",void 0),uU=u([$("esri.views.input.Input")],uU);const Xht=uU;let _1=class extends ve{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};u([d({type:Boolean,nonNullable:!0})],_1.prototype,"enabled",void 0),u([d({type:koe})],_1.prototype,"device",void 0),u([d({type:["pan","zoom"],nonNullable:!0})],_1.prototype,"mode",void 0),u([d({type:["forward-down","forward-up"],nonNullable:!0})],_1.prototype,"tiltDirection",void 0),u([d({type:Number,nonNullable:!0})],_1.prototype,"velocityFactor",void 0),_1=u([$("esri.views.navigation.gamepad.GamepadSettings")],_1);const AIe=_1;let vT=class extends ve{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new AIe,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};u([d({type:Boolean})],vT.prototype,"browserTouchPanEnabled",void 0),u([d({type:AIe,nonNullable:!0})],vT.prototype,"gamepad",void 0),u([d({type:Boolean})],vT.prototype,"momentumEnabled",void 0),u([d({type:Boolean})],vT.prototype,"mouseWheelZoomEnabled",void 0),vT=u([$("esri.views.navigation.Navigation")],vT);const RIe=vT;function ojt(t,e,i){const r=MIe(t),n=e,s=Yht(r,n,i);if(r){const o=OO.deriveUnitFromSR(r,t.spatialReference).heightUnit;if(!i&&o!==r.heightUnit){const a=new H("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${o})`,{horizontalUnit:o});return new H("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r,error:a})}}if(!Zht(t)||s===Mu.Unsupported)return new H("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r});switch(s){case Mu.Units:{const o=(r==null?void 0:r.heightUnit)||"unknown",a=(n==null?void 0:n.heightUnit)||"unknown",l=new H("layerview:incompatible-height-unit",`The vertical units of the layer (${o}) must match the vertical units of the scene (${a})`,{layerUnit:o,sceneUnit:a});return new H("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:n,error:l})}case Mu.HeightModel:{const o=(r==null?void 0:r.heightModel)||"unknown",a=(n==null?void 0:n.heightModel)||"unknown",l=new H("layerview:incompatible-height-model",`The height model of the layer (${o}) must match the height model of the scene (${a})`,{layerHeightModel:o,sceneHeightModel:a});return new H("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:n,error:l})}case Mu.CRS:{const o=(r==null?void 0:r.vertCRS)||"unknown",a=(n==null?void 0:n.vertCRS)||"unknown",l=new H("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${o}) must match the vertical datum of the scene (${a})`,{layerDatum:o,sceneDatum:a});return new H("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:n,error:l})}}return null}function Yht(t,e,i){if(!lge(t)||!lge(e))return Mu.Unsupported;if(t==null||e==null)return Mu.Ok;if(!i&&t.heightUnit!==e.heightUnit)return Mu.Units;if(t.heightModel!==e.heightModel)return Mu.HeightModel;switch(t.heightModel){case"gravity-related-height":return Mu.Ok;case"ellipsoidal":return t.vertCRS===e.vertCRS?Mu.Ok:Mu.CRS;default:return Mu.Unsupported}}var Mu;function lge(t){return t==null||t.heightModel!=null&&t.heightUnit!=null}function Zht(t){return"heightModelInfo"in t&&t.heightModelInfo!=null||t.spatialReference!=null||!IIe(t)}function MIe(t){var r;const e=t.url?dw(t.url):void 0;return!(((r=t.spatialReference)==null?void 0:r.vcsWkid)==null&&v(e)&&e.serverType==="ImageServer")&&OIe(t)&&t.heightModelInfo?t.heightModelInfo:IIe(t)?OO.deriveUnitFromSR(Kht,t.spatialReference):null}function OIe(t){return"heightModelInfo"in t}function PIe(t){if(t.type==="unknown"||!("capabilities"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function IIe(t){return PIe(t)?!!(t.capabilities&&t.capabilities.data&&t.capabilities.data.supportsZ):$Ie(t)}function Jht(t){return t.layers!=null||$Ie(t)||PIe(t)||OIe(t)}function $Ie(t){switch(t.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(t){t[t.Ok=0]="Ok",t[t.Units=1]="Units",t[t.HeightModel=2]="HeightModel",t[t.CRS=3]="CRS",t[t.Unsupported=4]="Unsupported"})(Mu||(Mu={}));const Kht=new OO({heightModel:"gravity-related-height"});var qe;function cge(t){return t==="global"?qe.Global:qe.Local}function nH(t){return t===qe.Global?"global":"local"}(function(t){t[t.Global=1]="Global",t[t.Local=2]="Local"})(qe||(qe={}));let _Q,sH=null;async function Qht(t){sH||(sH=Q(()=>Promise.resolve().then(()=>Zte),void 0).then(e=>_Q=e)),await sH,ui(t)}async function LIe(t,e,i,r){if(!t)return null;const n=t.spatialReference;return c2()||my(n,e)?Sm(t,e):_Q?_Q.projectGeometry(t,e,i,r):(await Promise.race([Qht(r),u2(r)]),LIe(t,e,i,r))}let dn=class extends ve{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=Mp(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return v(this.userSpatialReference)?this.userSpatialReference:this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return R(this.userSpatialReference)||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){var r,n,s,o;const e=(r=this.map)==null?void 0:r.call(this),i=[];return v(this.priorityCollection)&&i.push(this.priorityCollection),i.push({parent:e==null?void 0:e.basemap,layers:(n=e==null?void 0:e.basemap)==null?void 0:n.baseLayers},{layers:e==null?void 0:e.layers},{parent:e==null?void 0:e.ground,layers:(s=e==null?void 0:e.ground)==null?void 0:s.layers},{parent:e==null?void 0:e.basemap,layers:(o=e==null?void 0:e.basemap)==null?void 0:o.referenceLayers}),i}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};const{layers:e,updating:i}=this._allLayers;let r=null;for(const s of e){const o=this._getSupportedSpatialReferences(s);if(o.length>0){const a=this._narrowDownSpatialReferenceCandidates(r,o);v(a)&&(r=a)}if(v(r)&&r.length===1)break}if(i&&(R(r)||r.length!==1))return{updating:!0};const n=this._pickSpatialReferenceCandidate(r);return{spatialReference:v(n)?n.spatialReference:null,viewingMode:v(n)?n.viewingMode:null,updating:!1}}get _tileInfoTask(){var r,n,s,o,a,l,c;if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:i}=this._collectLayers([{parent:(n=(r=this.map)==null?void 0:r.call(this))==null?void 0:n.basemap,layers:(a=(o=(s=this.map)==null?void 0:s.call(this))==null?void 0:o.basemap)==null?void 0:a.baseLayers},{layers:(c=(l=this.map)==null?void 0:l.call(this))==null?void 0:c.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const h=e[0].tileInfo;return{tileInfo:h&&h.spatialReference.equals(this.spatialReference)?h:null,updating:!1}}return{updating:i}}get _heightModelInfoTask(){var r,n,s;if(!this.required.heightModelInfo||this.suspended&&((r=this._get("_heightModelInfoTask"))!=null&&r.heightModelInfo))return this._get("_heightModelInfoTask")??{updating:!1};const{layers:e,updating:i}=this._allLayers;for(const o of e)if(Jht(o)){const a=MIe(o);if(a)return{heightModelInfo:a,vcsWkid:(n=o.spatialReference)==null?void 0:n.vcsWkid,latestVcsWkid:(s=o.spatialReference)==null?void 0:s.latestVcsWkid,updating:!1}}return{updating:i}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,i=e.updating,r=[];for(const n of e.layers){const s="fullExtents"in n&&n.fullExtents||(v(n.fullExtent)?[n.fullExtent]:[]),o=this.requiresExtentInSpatialReference?null:s[0],a=s.find(l=>l.spatialReference.equals(this.spatialReference))??o;if(a)return{candidates:[{extent:a,layer:n}],updating:!1};if(this._getSupportedSpatialReferences(n).length>0)for(const l of s)r.push({extent:l,layer:n})}return{candidates:r,updating:i}}get _extentTask(){const{candidates:e,updating:i}=this._extentCandidatesTask;if(i)return{updating:i};if(R(e)||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const r=this._pickExtentCandidate(e),n=this.spatialReference;return r.extent.equals(this._projectExtentTask.input)&&n.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:v(this._projectExtentTask.task)&&!this._projectExtentTask.task.finished}:(v(this._projectExtentTask.task)&&(this._projectExtentTask.task=Mp(this._projectExtentTask.task)),this._projectExtentTask={input:r.extent.clone(),output:null,spatialReference:n.clone(),task:ON(async s=>{try{const o=await LIe(r.extent,n,r.layer.portalItem,s);this._projectExtentTask={...this._projectExtentTask,task:null,output:o}}catch{if(fo(s))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,i){if(R(e))return i;const r=[],n=(s,o)=>v(s)?v(o)?s===o&&s:s:o;for(const s of e)for(const o of i){if(!s.spatialReference.equals(o.spatialReference))continue;const a=n(s.viewingMode,o.viewingMode);if(a!==!1){r.push({spatialReference:s.spatialReference,viewingMode:a});break}}return r.length>0?r:null}_pickSpatialReferenceCandidate(e){const i=this.defaultSpatialReference;return R(e)||e.length<1?v(i)?{spatialReference:i,viewingMode:null}:null:(v(i)&&e.length>1&&e.some(({spatialReference:r})=>r.equals(i))&&(e=e.filter(({spatialReference:r})=>r.equals(i))),e.length>1&&e.some(({viewingMode:r})=>r!==qe.Local)&&(e=e.filter(({viewingMode:r})=>r!==qe.Local)),e[0])}_getSupportedSpatialReferences(e){const i="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(i.length===0)return[];const r=[];for(const n of i){const s=this.getSpatialReferenceSupport({spatialReference:n,layer:e});if(v(s)){const o=v(s.constraints)?s.constraints:[{spatialReference:n,viewingMode:null}];for(const{spatialReference:a,viewingMode:l}of o)(!this.requiresExtentInSpatialReference||R(this.userSpatialReference)||a.equals(this.userSpatialReference))&&r.push({spatialReference:a,viewingMode:l})}}return r}_pickExtentCandidate(e){const i=this.spatialReference;return e.find(({extent:r})=>i.equals(r.spatialReference))||e[0]}_collectLayers(e){var r;if(this._loadMaybe((r=this.map)==null?void 0:r.call(this))!=="loaded")return{layers:[],updating:!0};const i={layers:[],preloading:-1,updating:!1};for(const n of e)if(this._collectCollection(n,i),i.preloading===this.sourcePreloadCount)break;return{layers:i.layers,updating:i.updating}}_collectCollection(e,i){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return i.updating=!0,void++i.preloading;case"failed":return}for(const r of e.layers){switch(this._loadMaybe(r)){case"failed":continue;case"loading":i.updating=!0,++i.preloading;break;case"loaded":i.updating||i.layers.push(r),"layers"in r&&this._collectCollection({layers:r.layers},i)}if(i.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(()=>{}),"loading"):e.loadStatus:"loaded"}};u([d()],dn.prototype,"required",void 0),u([d({constructOnly:!0})],dn.prototype,"map",void 0),u([d({constructOnly:!0})],dn.prototype,"getSpatialReferenceSupport",void 0),u([d()],dn.prototype,"defaultSpatialReference",void 0),u([d()],dn.prototype,"userSpatialReference",void 0),u([d()],dn.prototype,"sourcePreloadCount",void 0),u([d()],dn.prototype,"priorityCollection",void 0),u([d()],dn.prototype,"requiresExtentInSpatialReference",void 0),u([d()],dn.prototype,"suspended",void 0),u([d({readOnly:!0})],dn.prototype,"ready",null),u([d({readOnly:!0})],dn.prototype,"heightModelInfoReady",null),u([d({readOnly:!0})],dn.prototype,"spatialReference",null),u([d({readOnly:!0})],dn.prototype,"extent",null),u([d({readOnly:!0})],dn.prototype,"heightModelInfo",null),u([d({readOnly:!0})],dn.prototype,"vcsWkid",null),u([d({readOnly:!0})],dn.prototype,"latestVcsWkid",null),u([d({readOnly:!0})],dn.prototype,"viewingMode",null),u([d({readOnly:!0})],dn.prototype,"tileInfo",null),u([d({readOnly:!0})],dn.prototype,"mapCollections",null),u([d({readOnly:!0})],dn.prototype,"_allLayers",null),u([d({readOnly:!0})],dn.prototype,"_spatialReferenceTask",null),u([d({readOnly:!0})],dn.prototype,"_tileInfoTask",null),u([d({readOnly:!0})],dn.prototype,"_heightModelInfoTask",null),u([d({readOnly:!0})],dn.prototype,"_extentCandidatesTask",null),u([d()],dn.prototype,"_extentTask",null),u([d()],dn.prototype,"_projectExtentTask",void 0),dn=u([$("esri.views.support.DefaultsFromMap")],dn);var hU;let Gt=hU=class extends Fw(An.EventedMixin(bO(ve))){constructor(t){super(t),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new CM({getCollections:()=>{var e,i,r;return[(e=this.basemapView)==null?void 0:e.baseLayerViews,(i=this.groundView)==null?void 0:i.layerViews,this.layerViews,(r=this.basemapView)==null?void 0:r.referenceLayerViews]},getChildrenFunction:e=>e.layerViews}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new G$,this.analyses=new VM,this.typeSpecificPreconditionsReady=!0,this.layerViews=new tt,this.magnifier=new xIe,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.timeReference=new kM,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new Xht,this.navigation=new RIe,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new Uht(this),this.persistableViewModels=new tt,this._isValid=!1,this._readyCycleForced=!1,this._currentSpatialReference=null,this.handles.add(ne(()=>this.preconditionsReady,e=>{var i,r;e?(this._currentSpatialReference=this.spatialReference,hU.views.add(this)):(this._currentSpatialReference=null,hU.views.remove(this)),this.notifyChange("spatialReference"),!e&&this.ready?((i=this.toolViewManager)==null||i.detach(),v(this.analysisViewManager)&&this.analysisViewManager.detach(),(r=this.layerViewManager)==null||r.clear(),this._teardown()):e&&!this.ready&&(this._startup(),v(this.analysisViewManager)&&this.analysisViewManager.attach(),this.toolViewManager.attach())},Ki))}initialize(){this.addResolvingPromise(this.validate().then(()=>(this._isValid=!0,ow(()=>this.ready)))),this.basemapView=new y1({view:this}),this.layerViewManager=new Pht({view:this,layerViewImporter:{importLayerView:t=>this.importLayerView(t),hasLayerViewModule:t=>this.hasLayerViewModule(t)},supportsGround:this.supportsGround}),this.toolViewManager=new Ght({view:this}),this._setupSpatialReferenceLogger(),this.handles.add([ne(()=>this.initialExtentRequired,t=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:t},{sync:!0,initial:!0}),ne(()=>this.ready,t=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=t,this.defaultsFromMap.userSpatialReference=t?this.spatialReference:this._userSpatialReference)},{sync:!0}),ne(()=>this._userSpatialReference,t=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=t)},{sync:!0,initial:!0})])}_setupSpatialReferenceLogger(){let t=null;this.handles.add([ne(()=>{var e;return(e=this.defaultsFromMap)==null?void 0:e.ready},e=>{var r;const i=((r=this.map)==null?void 0:r.allLayers.length)>0;if(e&&!this.spatialReference&&i){if(v(t))return;const n=fm(()=>t=Mp(t));t=ON(async s=>{try{await t2(this.spatialReferenceWarningDelay,null,s)}catch{return}finally{t=null}re.getLogger(this.declaredClass).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.handles.add(n,"spatial-reference-logger-task")}else this.handles.remove("spatial-reference-logger-task")},{sync:!0})])}destroy(){if(this.destroyed)return;this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=Ve(this.graphics),this.analyses=Ve(this.analyses),this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),Ve(this.analysisViewManager),this.toolViewManager=Ve(this.toolViewManager),this.layerViewManager=Ve(this.layerViewManager),this.basemapView=Ve(this.basemapView),this.invalidate(),this._emitter.clear(),this.handles.removeAll();const t=this.map;this.map=null,t==null||t.destroy()}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return re.getLogger(this.declaredClass).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){var t;return(t=this.toolViewManager)==null?void 0:t.activeTool}set activeTool(t){this.toolViewManager&&(this.toolViewManager.activeTool=t)}get animation(){return this._get("animation")}set animation(t){this._set("animation",t)}get center(){return null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new dn({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:t=>this.getSpatialReferenceSupport(t),...this._defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(t){this._set("extent",t)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){var t;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||Ju.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._currentSpatialReference&&!((t=this.defaultsFromMap)!=null&&t.ready)||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(t){t!==this._get("map")&&(t!=null&&t.destroyed&&(re.getLogger(this.declaredClass).warn("#map","The provided map is already destroyed",{map:t}),t=null),Ju.isLoadable(t)&&t.load().catch(()=>{}),this.constructed&&(this.forceReadyCycle(),this._currentSpatialReference=null),this._set("map",t))}get spatialReference(){var e,i;let t=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return t&&((i=(e=this.defaultsFromMap)==null?void 0:e.required)!=null&&i.heightModelInfo)&&(t=t.clone(),t.vcsWkid=this.defaultsFromMap.vcsWkid,t.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),t}set spatialReference(t){const e=!Dn(t,this._get("spatialReference"));this._set("_userSpatialReference",t),e&&(this._set("spatialReference",t),this._spatialReferenceChanged(t))}_spatialReferenceChanged(t){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get tools(){var t;return(t=this.toolViewManager)==null?void 0:t.tools}get initialExtent(){var t;return(t=this.defaultsFromMap)==null?void 0:t.extent}get cursor(){const t=this.toolViewManager?this.toolViewManager.cursor:null;return v(t)?t:this._cursor||"default"}set cursor(t){this._cursor=t,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(t){return this.layerViewManager.whenLayerView(t)}getDefaultSpatialReference(){var t;return(t=this.defaultsFromMap)==null?void 0:t.spatialReference}getDefaultHeightModelInfo(){var t;return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??((t=this.defaultsFromMap)==null?void 0:t.heightModelInfo)??null}importLayerView(t){throw new H("importLayerView() not implemented")}hasLayerViewModule(t){return!1}async validate(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(t){return v(this.getSpatialReferenceSupport({spatialReference:t}))}when(t,e){return this.isResolved()&&!this.ready&&re.getLogger(this.declaredClass).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(t,e)}forceReadyCycle(){this.ready&&(yo(()=>this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(t){this.toolViewManager.tools.add(t),this.activeTool=t}tryFatalErrorRecovery(){this.fatalError=null}};Gt.views=new tt,u([d()],Gt.prototype,"_userSpatialReference",void 0),u([d()],Gt.prototype,"activeTool",null),u([d({readOnly:!0})],Gt.prototype,"allLayerViews",void 0),u([d()],Gt.prototype,"groundView",void 0),u([d()],Gt.prototype,"animation",null),u([d()],Gt.prototype,"basemapView",void 0),u([d()],Gt.prototype,"center",null),u([d({readOnly:!0})],Gt.prototype,"_defaultsFromMapSettings",null),u([d()],Gt.prototype,"defaultsFromMap",null),u([d()],Gt.prototype,"fatalError",void 0),u([d({type:ni})],Gt.prototype,"extent",null),u([d(gQ(G$,"graphics"))],Gt.prototype,"graphics",void 0),u([d(gQ(VM,"analyses"))],Gt.prototype,"analyses",void 0),u([d({readOnly:!0,type:OO})],Gt.prototype,"heightModelInfo",null),u([d({readOnly:!0})],Gt.prototype,"interacting",null),u([d({readOnly:!0})],Gt.prototype,"navigating",null),u([d({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],Gt.prototype,"preconditionsReady",null),u([d({readOnly:!0})],Gt.prototype,"typeSpecificPreconditionsReady",void 0),u([d({type:tt,readOnly:!0})],Gt.prototype,"layerViews",void 0),u([d()],Gt.prototype,"resolution",null),u([d({type:xIe})],Gt.prototype,"magnifier",void 0),u([d({value:null,type:FB})],Gt.prototype,"map",null),u([d()],Gt.prototype,"padding",void 0),u([d({readOnly:!0})],Gt.prototype,"ready",void 0),u([d({type:Je})],Gt.prototype,"spatialReference",null),u([d()],Gt.prototype,"spatialReferenceWarningDelay",void 0),u([d()],Gt.prototype,"stationary",null),u([d({readOnly:!0})],Gt.prototype,"supportsGround",void 0),u([d({type:Zc})],Gt.prototype,"timeExtent",void 0),u([d({type:kM,nonNullable:!0})],Gt.prototype,"timeReference",void 0),u([d()],Gt.prototype,"tools",null),u([d()],Gt.prototype,"toolViewManager",void 0),u([d({readOnly:!0})],Gt.prototype,"type",void 0),u([d({type:Number})],Gt.prototype,"scale",void 0),u([d({readOnly:!0})],Gt.prototype,"updating",void 0),u([d({readOnly:!0})],Gt.prototype,"initialExtentRequired",void 0),u([d({readOnly:!0})],Gt.prototype,"initialExtent",null),u([d()],Gt.prototype,"cursor",null),u([d({readOnly:!0})],Gt.prototype,"input",void 0),u([d({type:RIe,nonNullable:!0})],Gt.prototype,"navigation",void 0),u([d()],Gt.prototype,"layerViewManager",void 0),u([d()],Gt.prototype,"analysisViewManager",void 0),u([d()],Gt.prototype,"width",void 0),u([d()],Gt.prototype,"height",void 0),u([d({readOnly:!0})],Gt.prototype,"resizing",void 0),u([d({value:null,readOnly:!0})],Gt.prototype,"size",null),u([d({readOnly:!0})],Gt.prototype,"suspended",void 0),u([d({readOnly:!0})],Gt.prototype,"viewEvents",void 0),u([d({readOnly:!0})],Gt.prototype,"persistableViewModels",void 0),u([d()],Gt.prototype,"_isValid",void 0),u([d()],Gt.prototype,"_readyCycleForced",void 0),u([d()],Gt.prototype,"_currentSpatialReference",void 0),Gt=hU=u([$("esri.views.View")],Gt);const DIe=Gt;let v1=class extends hV{constructor(e){super(e),this.state="running",this.target=null,this._dfd=null}initialize(){this.addResolvingPromise(new Promise((e,i)=>this._dfd={resolve:e,reject:i}))}get done(){return this.state==="finished"||this.state==="stopped"}stop(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),(e=this._dfd)==null||e.reject(new H("ViewAnimation stopped")))}finish(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),(e=this._dfd)==null||e.resolve())}update(e,i){i||(i=ih(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",i)}};u([d({readOnly:!0})],v1.prototype,"done",null),u([d({readOnly:!0,type:String})],v1.prototype,"state",void 0),u([d()],v1.prototype,"target",void 0),v1=u([$("esri.views.ViewAnimation")],v1),function(t){t.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(v1||(v1={}));const P_=v1;function QT(t,e,i,r){const n=3*t,s=3*(i-t)-n,o=1-n-s,a=3*e,l=3*(r-e)-a,c=1-a-l;function h(g){return((o*g+s)*g+n)*g}function p(g){return((c*g+l)*g+a)*g}function f(g){return(3*o*g+2*s)*g+n}function m(g,_){let b,w,x,T,E,C;for(x=g,C=0;C<8;C++){if(T=h(x)-g,Math.abs(T)<_)return x;if(E=f(x),Math.abs(E)<1e-6)break;x-=T/E}if(b=0,w=1,x=g,x<b)return b;if(x>w)return w;for(;b<w;){if(T=h(x),Math.abs(T-g)<_)return x;g>T?b=x:w=x,x=.5*(w-b)+b}return x}return function(g,_=1e-6){return p(m(g,_))}}const edt=/^cubic-bezier\((.*)\)/,Wd={};function tdt(t){let e=Wd[t]||null;if(!e){const i=edt.exec(t);if(i){const r=i[1].split(",").map(n=>parseFloat(n.trim()));r.length!==4||r.some(n=>isNaN(n))||(e=QT.apply(QT,r))}}return e}Wd.ease=QT(.25,.1,.25,1),Wd.linear=QT(0,0,1,1),Wd.easeIn=Wd["ease-in"]=QT(.42,0,1,1),Wd.easeOut=Wd["ease-out"]=QT(0,0,.58,1),Wd.easeInOut=Wd["ease-in-out"]=QT(.42,0,.58,1);function Bb(){return[1,0,0,1,0,0]}function idt(t){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function rdt(t,e,i,r,n,s){return[t,e,i,r,n,s]}function ndt(t,e){return new Float64Array(t,e,6)}Object.freeze(Object.defineProperty({__proto__:null,clone:idt,create:Bb,createView:ndt,fromValues:rdt},Symbol.toStringTag,{value:"Module"}));function io(t,e){return t[0]=e[0],t[1]=e[1],t}function dt(t,e,i){return t[0]=e,t[1]=i,t}function Jd(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function Xh(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function NIe(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t}function FIe(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t}function sdt(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function odt(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function adt(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t}function ldt(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t}function cdt(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function ll(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t}function udt(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t}function gy(t,e){const i=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(i*i+r*r)}function BM(t,e){const i=e[0]-t[0],r=e[1]-t[1];return i*i+r*r}function pD(t){const e=t[0],i=t[1];return Math.sqrt(e*e+i*i)}function kIe(t){const e=t[0],i=t[1];return e*e+i*i}function Uoe(t,e){return t[0]=-e[0],t[1]=-e[1],t}function hdt(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function _2(t,e){const i=e[0],r=e[1];let n=i*i+r*r;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n),t}function As(t,e){return t[0]*e[0]+t[1]*e[1]}function UIe(t,e,i){const r=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=r,t}function K1(t,e,i,r){const n=e[0],s=e[1];return t[0]=n+r*(i[0]-n),t[1]=s+r*(i[1]-s),t}function ddt(t,e){e=e||1;const i=2*bN()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t}function vQ(t,e,i){const r=e[0],n=e[1];return t[0]=i[0]*r+i[2]*n,t[1]=i[1]*r+i[3]*n,t}function $g(t,e,i){const r=e[0],n=e[1];return t[0]=i[0]*r+i[2]*n+i[4],t[1]=i[1]*r+i[3]*n+i[5],t}function pdt(t,e,i){const r=e[0],n=e[1];return t[0]=i[0]*r+i[3]*n+i[6],t[1]=i[1]*r+i[4]*n+i[7],t}function fdt(t,e,i){const r=e[0],n=e[1];return t[0]=i[0]*r+i[4]*n+i[12],t[1]=i[1]*r+i[5]*n+i[13],t}function xS(t,e,i,r){const n=e[0]-i[0],s=e[1]-i[1],o=Math.sin(r),a=Math.cos(r);return t[0]=n*a-s*o+i[0],t[1]=n*o+s*a+i[1],t}function mdt(t,e){const i=t[0],r=t[1],n=e[0],s=e[1];let o=i*i+r*r;o>0&&(o=1/Math.sqrt(o));let a=n*n+s*s;a>0&&(a=1/Math.sqrt(a));const l=(i*n+r*s)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function gdt(t){return"vec2("+t[0]+", "+t[1]+")"}function VIe(t,e){return t[0]===e[0]&&t[1]===e[1]}function zIe(t,e){const i=t[0],r=t[1],n=e[0],s=e[1],o=bl();return Math.abs(i-n)<=o*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-s)<=o*Math.max(1,Math.abs(r),Math.abs(s))}function ydt(t,e,i,r,n){let s=e[0]-i[0],o=e[1]-i[1];const a=(r[0]*s+r[1]*o)*(n-1);return s=r[0]*a,o=r[1]*a,t[0]=e[0]+s,t[1]=e[1]+o,t}const _dt=pD,Voe=Xh,vdt=NIe,bdt=FIe,BIe=gy,wdt=BM,xdt=kIe;Object.freeze(Object.defineProperty({__proto__:null,add:Jd,angle:mdt,ceil:sdt,copy:io,cross:UIe,dist:BIe,distance:gy,div:bdt,divide:FIe,dot:As,equals:zIe,exactEquals:VIe,floor:odt,inverse:hdt,len:_dt,length:pD,lerp:K1,max:ldt,min:adt,mul:vdt,multiply:NIe,negate:Uoe,normalize:_2,projectAndScale:ydt,random:ddt,rotate:xS,round:cdt,scale:ll,scaleAndAdd:udt,set:dt,sqrDist:wdt,sqrLen:xdt,squaredDistance:BM,squaredLength:kIe,str:gdt,sub:Voe,subtract:Xh,transformMat2:vQ,transformMat2d:$g,transformMat3:pdt,transformMat4:fdt},Symbol.toStringTag,{value:"Module"}));function Fe(){return[0,0]}function gI(t){return[t[0],t[1]]}function Mi(t,e){return[t,e]}function jIe(t){const e=Fe(),i=Math.min(2,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function GIe(t,e){return new Float64Array(t,e,2)}function HIe(){return Fe()}function qIe(){return Mi(1,1)}function WIe(){return Mi(1,0)}function XIe(){return Mi(0,1)}const Jc=HIe(),YIe=qIe(),Tdt=WIe(),Sdt=XIe();Object.freeze(Object.defineProperty({__proto__:null,ONES:YIe,UNIT_X:Tdt,UNIT_Y:Sdt,ZEROS:Jc,clone:gI,create:Fe,createView:GIe,fromArray:jIe,fromValues:Mi,ones:qIe,unitX:WIe,unitY:XIe,zeros:HIe},Symbol.toStringTag,{value:"Module"}));const ZIe=96,JIe=39.37,Edt=180/Math.PI;function KIe(t){return t.wkid?t:t.spatialReference||Je.WGS84}function zoe(t,e){return e.type?dt(t,e.x,e.y):io(t,e)}function QIe(t){return tc(t)}function H$(t,e){const i=Math.max(1,e[0]),r=Math.max(1,e[1]);return Math.max(t.width/i,t.height/r)*Ldt(t.spatialReference)}async function yI(t,e,i,r){let n,s;if(!t||Array.isArray(t)&&!t.length)return null;if(tt.isCollection(t)&&(t=t.toArray()),Array.isArray(t)&&t.length&&typeof t[0]=="object"){const a=t.every(h=>"attributes"in h),l=t.some(h=>!h.geometry);let c=t;if(a&&l&&e&&e.allLayerViews){const h=new Map;for(const g of t){const _=g.layer,b=h.get(_)||[],w=g.attributes[_.objectIdField];w!=null&&b.push(w),h.set(_,b)}const p=[];h.forEach((g,_)=>{const b=e.allLayerViews.find(w=>w.layer.id===_.id);if(b&&"queryFeatures"in b){const w=_.createQuery();w.objectIds=g,w.returnGeometry=!0,p.push(b.queryFeatures(w))}});const f=await Promise.all(p),m=[];for(const g of f)if(g&&g.features&&g.features.length)for(const _ of g.features)v(_.geometry)&&m.push(_.geometry);c=m}for(const h of c)r=await yI(h,e,i,r);return r}if(Array.isArray(t)&&t.length===2&&typeof t[0]=="number"&&typeof t[1]=="number")n=new Le(t);else if(t instanceof U_)n=t;else if("geometry"in t){if(t.geometry)n=t.geometry;else if(t.layer){const a=t.layer,l=e.allLayerViews.find(c=>c.layer.id===a.id);if(l&&"queryFeatures"in l){const c=a.createQuery();c.objectIds=[t.attributes[a.objectIdField]],c.returnGeometry=!0;const h=await l.queryFeatures(c);n=Js(h,"features",0,"geometry")}}}if(R(n)||(s=n.type==="point"?new ni({xmin:n.x,ymin:n.y,xmax:n.x,ymax:n.y,spatialReference:n.spatialReference}):n.extent,!s))return null;c2()||my(s.spatialReference,i)||await u2();const o=Sm(s,i);return o?r=r?r.union(o):o:null}function Cdt(t){if(t&&(!Array.isArray(t)||typeof t[0]!="number")&&(typeof t=="object"||Array.isArray(t)&&typeof t[0]=="object")){if("layer"in t&&t.layer&&t.layer.minScale&&t.layer.maxScale){const e=t.layer;return{min:e.minScale,max:e.maxScale}}if(Array.isArray(t)&&t.length&&t.every(e=>"layer"in e)){let e=0,i=0;for(const r of t){const n=r.layer;n&&n.minScale&&n.maxScale&&(e=n.minScale<e?n.minScale:e,i=n.maxScale>i?n.maxScale:i)}return e&&i?{min:e,max:i}:null}}}function oH(t,e){return Dn(KIe(t),e)?t:Sm(t,e)}async function Adt(t,e){if(!t||!e)return new Jn({targetGeometry:new Le,scale:0,rotation:0});let i=e.spatialReference;const{constraints:r,padding:n,viewpoint:s,size:o}=e,a=[n?o[0]-n.left-n.right:o[0],n?o[1]-n.top-n.bottom:o[1]];let l=null;t instanceof Jn?l=t:t.viewpoint?l=t.viewpoint:t.target&&t.target.declaredClass==="esri.Viewpoint"&&(l=t.target);let c=null;l&&l.targetGeometry?c=l.targetGeometry:t instanceof ni?c=t:(t||t&&("center"in t||"extent"in t||"target"in t))&&(c=await yI(t.center,e,i)||await yI(t.extent,e,i)||await yI(t.target,e,i)||await yI(t,e,i)),!c&&s&&s.targetGeometry?c=s.targetGeometry:!c&&e.extent&&(c=e.extent),i||(i=KIe(e.spatialReference||e.extent||c)),c2()||Dn(c.spatialReference,i)||my(c,i)||await u2();const h=oH(c.center?c.center:c,i);let p=0;if(l&&v(l.targetGeometry)&&l.targetGeometry.type==="point")p=l.scale;else if("scale"in t&&t.scale)p=t.scale;else if("zoom"in t&&t.zoom!==-1&&r&&r.effectiveLODs)p=r.zoomToScale(t.zoom);else if(Array.isArray(c)||c.type==="point"||c.type==="extent"&&c.width===0&&c.height===0){const _=oH(e.extent,i);p=v(_)?H$(_,a):e.extent?H$(e.extent,a):s.scale}else p=H$(oH(c.extent,i),a);const f=Cdt(t);f&&(f.min&&f.min>p?p=f.min:f.max&&f.max<p&&(p=f.max));let m=0;l?m=l.rotation:t.hasOwnProperty("rotation")?m=t.rotation:s&&(m=s.rotation);let g=new Jn({targetGeometry:h,scale:p,rotation:m});return r&&(g=r.fit(g),r.constrainByGeometry(g),r.rotationEnabled||(g.rotation=m)),g}function Em(t,e){const i=t.targetGeometry,r=e.targetGeometry;return i.x=r.x,i.y=r.y,i.spatialReference=r.spatialReference,t.scale=e.scale,t.rotation=e.rotation,t}function Rdt(t,e,i){return i?dt(t,.5*(e[0]-i.right+i.left),.5*(e[1]-i.bottom+i.top)):ll(t,e,.5)}const Mdt=function(){const t=Fe();return function(e,i,r){const n=i.targetGeometry;zoe(t,n);const s=.5*DO(i);return e.xmin=t[0]-s*r[0],e.ymin=t[1]-s*r[1],e.xmax=t[0]+s*r[0],e.ymax=t[1]+s*r[1],e.spatialReference=n.spatialReference,e}}();function Odt(t,e,i,r,n){return bQ(t,e,i.center),t.scale=H$(i,r),n&&n.constraints&&n.constraints.constrain(t),t}function Pdt(t,e,i,r){return Goe(t,e,i,r),Loe(t,t)}const e$e=function(){const t=Fe();return function(e,i,r){return Voe(e,Ddt(e,i),Rdt(t,i,r))}}(),Idt=function(){const t=Bb(),e=Fe();return function(i,r,n,s){const o=DO(r),a=Boe(r);return dt(e,o,o),cIe(t,e),DB(t,t,a),hD(t,t,e$e(e,n,s)),hD(t,t,[0,s.top-s.bottom]),dt(i,t[4],t[5])}}();function DO(t){return t.scale*$dt(t.targetGeometry)}function $dt(t){return v(t)&&Fa(t.spatialReference)?1/(QIe(t.spatialReference)*JIe*ZIe):1}function Boe(t){return wN(t.rotation)||0}function Ldt(t){return Fa(t)?QIe(t)*JIe*ZIe:1}function Ddt(t,e){return ll(t,e,.5)}const joe=function(){const t=Fe(),e=Fe(),i=Fe();return function(r,n,s,o,a,l){return Uoe(t,n),ll(e,s,.5*l),dt(i,1/o*l,-1/o*l),Noe(r,e),a&&DB(r,r,a),Doe(r,r,i),hD(r,r,t),r}}(),Goe=function(){const t=Fe();return function(e,i,r,n){const s=DO(i),o=Boe(i);return zoe(t,i.targetGeometry),joe(e,t,r,s,o,n)}}(),Ndt=function(){const t=Fe();return function(e,i,r,n){const s=DO(i);return zoe(t,i.targetGeometry),joe(e,t,r,s,0,n)}}();function Fdt(t){const e=bp(t);return e?e.valid[1]-e.valid[0]:0}function kdt(t,e){return Math.round(Fdt(t)/e)}const Udt=function(){const t=Fe(),e=Fe(),i=[0,0,0];return function(r,n,s){Xh(t,r,n),_2(t,t),Xh(e,r,s),_2(e,e),UIe(i,t,e);let o=Math.acos(As(t,e)/(pD(t)*pD(e)))*Edt;return i[2]<0&&(o=-o),isNaN(o)&&(o=0),o}}(),Vdt=function(){const t=Fe();return function(e,i,r,n){const s=e.targetGeometry;return Em(e,i),Idt(t,i,r,n),s.x+=t[0],s.y+=t[1],e}}(),bQ=function(t,e,i){Em(t,e);const r=t.targetGeometry;return r.x=i.x,r.y=i.y,r.spatialReference=i.spatialReference,t},zdt=function(){const t=Fe();return function(e,i,r,n,s){s||(s="center"),Voe(t,r,n),ll(t,t,.5);const o=t[0],a=t[1];switch(s){case"center":dt(t,0,0);break;case"left":dt(t,-o,0);break;case"top":dt(t,0,a);break;case"right":dt(t,o,0);break;case"bottom":dt(t,0,-a);break;case"top-left":dt(t,-o,a);break;case"bottom-left":dt(t,-o,-a);break;case"top-right":dt(t,o,a);break;case"bottom-right":dt(t,o,-a)}return kB(e,i,t),e}}();function cjt(t,e,i){return Em(t,e),t.rotation+=i,t}function Bdt(t,e,i){return Em(t,e),t.rotation=i,t}const jdt=function(){const t=Fe();return function(e,i,r,n,s){return Em(e,i),isNaN(r)||r===0||(i$e(t,n,i,s),e.scale=i.scale*r,r$e(t,t,e,s),kB(e,e,dt(t,t[0]-n[0],n[1]-t[1]))),e}}();function uge(t,e,i){return Em(t,e),t.scale=i,t}const t$e=function(){const t=Fe();return function(e,i,r,n,s,o){return Em(e,i),isNaN(r)||r===0||(i$e(t,s,i,o),e.scale=i.scale*r,e.rotation+=n,r$e(t,t,e,o),kB(e,e,dt(t,t[0]-s[0],s[1]-t[1]))),e}}(),ujt=function(){const t=Fe(),e=Fe();return function(i,r,n,s,o,a,l){return e$e(e,a,l),Jd(t,o,e),s?t$e(i,r,n,s,t,a):jdt(i,r,n,t,a)}}(),i$e=function(){const t=Bb();return function(e,i,r,n){return $g(e,i,Pdt(t,r,n,1))}}(),r$e=function(){const t=Bb();return function(e,i,r,n){return $g(e,i,Goe(t,r,n,1))}}(),kB=function(){const t=Fe(),e=Bb();return function(i,r,n){Em(i,r);const s=DO(r),o=i.targetGeometry;return lIe(e,Boe(r)),Doe(e,e,Mi(s,s)),$g(t,n,e),o.x+=t[0],o.y+=t[1],i}}();let Gdt=class{constructor(e,i,r,n){const s=e.targetGeometry,o=i.targetGeometry;n?typeof n=="string"&&(n=tdt(n)||Wd.ease):n=Wd.ease,this.easing=n,this.duration=r,this.sCenterX=s.x,this.sCenterY=s.y,this.sScale=e.scale,this.sRotation=e.rotation,this.tCenterX=o.x,this.tCenterY=o.y,this.tScale=i.scale,this.tRotation=i.rotation,this.dCenterX=this.tCenterX-this.sCenterX,this.dCenterY=this.tCenterY-this.sCenterY,this.dScale=this.tScale-this.sScale,this.dRotation=this.tRotation-this.sRotation,this.dRotation>180?this.dRotation-=360:this.dRotation<-180&&(this.dRotation+=360)}applyRatio(e,i){const r=this.easing(i);let n,s,o,a;i>=1?(n=this.tCenterX,s=this.tCenterY,o=this.tRotation,a=this.tScale):(n=this.sCenterX+r*this.dCenterX,s=this.sCenterY+r*this.dCenterY,o=this.sRotation+r*this.dRotation,a=this.sScale+r*this.dScale),e.targetGeometry.x=n,e.targetGeometry.y=s,e.scale=a,e.rotation=o}},_0=class extends ve{constructor(e){super(e),this.updateFunction=null,this.animation=null,this.duration=200,this.transition=null,this.easing=Wd.ease,this.view=null,this.viewpoint=new Jn({targetGeometry:new Le,scale:0,rotation:0}),this._updateTask=E_({postRender:this._postRender.bind(this)}),this._updateTask.pause()}destroy(){this._updateTask=Nr(this._updateTask)}animate(e,i,r){this.stop();const n=this.viewpoint;Em(n,i),this.transition=new Gdt(this.viewpoint,e.target,r&&r.duration||this.duration,r&&r.easing||this.easing);const s=()=>{var o,a;this.animation===e&&this._updateTask&&(e.state==="finished"&&((o=this.transition)==null||o.applyRatio(this.viewpoint,1),(a=this.view)!=null&&a.state&&(this.view.state.viewpoint=this.viewpoint.clone())),this.animation=null,this.updateFunction=null)};return e.when(s,s),this._startTime=performance.now(),this._updateTask.resume(),this.animation=e,e}animateContinous(e,i){this.stop(),this.updateFunction=i,this.viewpoint=e;const r=new P_({target:e.clone()}),n=()=>{this.animation===r&&this._updateTask&&(this.animation=null,this.updateFunction=null)};return r.when(n,n),this._startTime=performance.now(),this._updateTask.resume(),this.animation=r,r}stop(){this.animation&&(this.animation.stop(),this.animation=null,this.updateFunction=null)}_postRender(e){var r,n;const i=this.animation;if(i&&i.state!==P_.State.STOPPED){if(this.updateFunction)this.updateFunction(this.viewpoint,e.deltaTime);else{const s=this.transition,o=(performance.now()-this._startTime)/s.duration,a=o>=1;s.applyRatio(this.viewpoint,o),a&&((r=this.animation)==null||r.finish())}(n=this.view)!=null&&n.state&&(this.view.state.viewpoint=this.viewpoint.clone())}else this._updateTask.pause()}};u([d()],_0.prototype,"animation",void 0),u([d()],_0.prototype,"duration",void 0),u([d()],_0.prototype,"transition",void 0),u([d()],_0.prototype,"easing",void 0),u([d()],_0.prototype,"view",void 0),u([d()],_0.prototype,"viewpoint",void 0),_0=u([$("esri.views.2d.AnimationManager")],_0);const Hdt=_0;let qdt=class{constructor(e){this.view=e,this._stationaryHandle=null,this._frameTaskHandle=null,this._updateParameters=null,this._updateRequested=!1,this.stationary=!0,this.animationInProgress=!1,this.prepare=()=>{this._updateParameters&&(this._updateParameters.state=this.view.state,this._updateParameters.stationary=this.view.stationary,this._updateParameters.pixelRatio=window.devicePixelRatio,this._updateParameters.renderingOptions=this.view.renderingOptions)},this.update=()=>{var a;this._updateRequested=!1;const{basemapView:i,graphicsView:r,labelManager:n,layerViews:s,state:{id:o}}=this.view;i==null||i.baseLayerViews.forEach(this._updateLayerView,this),s.forEach(this._updateLayerView,this),i==null||i.referenceLayerViews.forEach(this._updateLayerView,this),v(n)&&(n.lastUpdateId!==o&&(n.viewChange(),n.lastUpdateId=o),n.updateRequested&&n.processUpdate(this._updateParameters)),v(r)&&(r.lastUpdateId!==o&&(r.viewChange(),r.lastUpdateId=o),r.updateRequested&&r.processUpdate(this._updateParameters)),this.view.graphicsTileStore.setViewState(this._updateParameters.state),this.animationInProgress||this._updateRequested||((a=this._frameTaskHandle)==null||a.pause())}}destroy(){this.stop()}start(){if(this._frameTaskHandle)return;const e=this.view;this.stationary=e.stationary,this._updateParameters={state:e.state,pixelRatio:window.devicePixelRatio,stationary:this.stationary,renderingOptions:e.renderingOptions},this._stationaryHandle=ne(()=>e.stationary,i=>{this.stationary=i,this.requestFrame()}),this._frameTaskHandle=E_(this),this.requestUpdate()}stop(){var e;this._frameTaskHandle&&(this._updateRequested=!1,(e=this._stationaryHandle)==null||e.remove(),this._frameTaskHandle.remove(),this._updateParameters=this._stationaryHandle=this._frameTaskHandle=null,this.stationary=!0,this.animationInProgress=!1)}requestUpdate(){this._updateRequested||(this._updateRequested=!0,this.requestFrame())}requestFrame(){this._frameTaskHandle&&this._frameTaskHandle.resume()}_updateLayerView(e){if(!e.attached)return void this.requestUpdate();const i=this.view.state,r=e.lastUpdateId;r!=null&&(this.stationary||e.moving)||(e.moving=!0,e.moveStart()),r!==i.id&&e.viewChange(),this.stationary&&e.moving&&(e.moving=!1,e.moveEnd()),e.lastUpdateId=i.id,e.updateRequested&&e.processUpdate(this._updateParameters),"layerViews"in e&&e.layerViews.forEach(this._updateLayerView,this)}};function Vs(){return Promise.all([Q(()=>import("./webglDeps-12d4b371.js"),["assets/webglDeps-12d4b371.js","assets/ShaderCompiler-77d0dcb6.js","assets/programUtils-f035fe8a.js","assets/ProgramTemplate-c9ea1109.js"]),Q(()=>import("./mapViewDeps-b13d25d0.js"),["assets/mapViewDeps-b13d25d0.js","assets/CIMResourceManager-5b9a3e6a.js","assets/Rasterizer-a13839c4.js","assets/_commonjsHelpers-2f3e7994.js","assets/cimAnalyzer-163ac770.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/enums-4b2a86a0.js","assets/alignmentUtils-ae955d28.js","assets/definitions-3ddd14a8.js","assets/number-b10bd8f5.js","assets/Rect-ea14f53a.js","assets/rasterizingUtils-37f0f33e.js","assets/imageutils-58ee6580.js","assets/Container-83d986f4.js","assets/BufferPool-81fcde76.js","assets/enums-b1d611e3.js","assets/WGLContainer-cca4133a.js","assets/WGLBrushVTLSymbol-e8c49a01.js","assets/StyleDefinition-7d58136b.js","assets/GeometryUtils-dd03fc25.js","assets/color-ecd22285.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-c9ea1109.js","assets/MaterialKey-c290b8d1.js","assets/utils-2b9e1dc7.js","assets/heatmapTextureUtils-e2b3289a.js","assets/VTLMaterialManager-c25094ad.js","assets/programUtils-f035fe8a.js","assets/MagnifierPrograms-8cd20d2d.js","assets/Matcher-8ef33fbf.js","assets/visualVariablesUtils-3c7f6581.js","assets/visualVariablesUtils-6323c511.js","assets/tileUtils-c2f19f52.js","assets/TurboLine-f2375728.js","assets/ExpandedCIM-1ac96b4c.js","assets/CircularArray-724bafc9.js","assets/ComputedAttributeStorage-a0054ede.js","assets/arcadeTimeUtils-21c68d00.js","assets/executionError-fb3f283a.js","assets/centroid-c62179b0.js","assets/MaterialPrograms-ea2ca365.js","assets/GraphicsView2D-569b3c38.js","assets/projectionSupport-2f167231.js","assets/json-48e3ea08.js","assets/AttributeStoreView-06ec49c7.js","assets/schemaUtils-9432c525.js","assets/util-b4eb6d10.js","assets/GraphicsView-b7bed666.js","assets/GraphicContainer-d3fa5611.js","assets/BaseGraphicContainer-3c39d579.js","assets/FeatureContainer-3eb11aab.js","assets/TileContainer-136758dc.js"])])}const R3=()=>Vs().then(()=>Q(()=>import("./TileLayerView2D-f845099d.js"),["assets/TileLayerView2D-f845099d.js","assets/Rasterizer-a13839c4.js","assets/_commonjsHelpers-2f3e7994.js","assets/cimAnalyzer-163ac770.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/enums-4b2a86a0.js","assets/alignmentUtils-ae955d28.js","assets/definitions-3ddd14a8.js","assets/number-b10bd8f5.js","assets/Rect-ea14f53a.js","assets/rasterizingUtils-37f0f33e.js","assets/Container-83d986f4.js","assets/BufferPool-81fcde76.js","assets/enums-b1d611e3.js","assets/WGLContainer-cca4133a.js","assets/WGLBrushVTLSymbol-e8c49a01.js","assets/StyleDefinition-7d58136b.js","assets/GeometryUtils-dd03fc25.js","assets/color-ecd22285.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-c9ea1109.js","assets/MaterialKey-c290b8d1.js","assets/utils-2b9e1dc7.js","assets/heatmapTextureUtils-e2b3289a.js","assets/MagnifierPrograms-8cd20d2d.js","assets/imageutils-58ee6580.js","assets/Matcher-8ef33fbf.js","assets/visualVariablesUtils-3c7f6581.js","assets/visualVariablesUtils-6323c511.js","assets/tileUtils-c2f19f52.js","assets/TurboLine-f2375728.js","assets/ExpandedCIM-1ac96b4c.js","assets/CircularArray-724bafc9.js","assets/ComputedAttributeStorage-a0054ede.js","assets/arcadeTimeUtils-21c68d00.js","assets/executionError-fb3f283a.js","assets/centroid-c62179b0.js","assets/GraphicsView2D-569b3c38.js","assets/projectionSupport-2f167231.js","assets/json-48e3ea08.js","assets/AttributeStoreView-06ec49c7.js","assets/schemaUtils-9432c525.js","assets/util-b4eb6d10.js","assets/GraphicsView-b7bed666.js","assets/imageUtils-e94d5dad.js","assets/BitmapTileContainer-1a0f1e5f.js","assets/Bitmap-d8ac0db6.js","assets/TileContainer-136758dc.js","assets/LayerView2D-ea94ade1.js","assets/HighlightGraphicContainer-52e9dfd7.js","assets/BaseGraphicContainer-3c39d579.js","assets/FeatureContainer-3eb11aab.js","assets/LayerView-db7ff94b.js","assets/RefreshableLayerView-8ec9084b.js","assets/MapServiceLayerViewHelper-3c93e294.js","assets/floorFilterUtils-080a7cd2.js","assets/sublayerUtils-78c9523d.js","assets/popupUtils-0740bfd4.js","assets/drapedUtils-0903c165.js"])),uE=()=>Vs().then(()=>Q(()=>import("./FeatureLayerView2D-388b15f8.js"),["assets/FeatureLayerView2D-388b15f8.js","assets/Container-83d986f4.js","assets/definitions-3ddd14a8.js","assets/LayerView2D-ea94ade1.js","assets/schemaUtils-9432c525.js","assets/enums-b1d611e3.js","assets/color-ecd22285.js","assets/enums-4b2a86a0.js","assets/number-b10bd8f5.js","assets/utils-2b9e1dc7.js","assets/MaterialKey-c290b8d1.js","assets/alignmentUtils-ae955d28.js","assets/visualVariablesUtils-6323c511.js","assets/cimAnalyzer-163ac770.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/Rect-ea14f53a.js","assets/ExpandedCIM-1ac96b4c.js","assets/util-b4eb6d10.js","assets/FeatureLayerView-0d0f168b.js","assets/floorFilterUtils-080a7cd2.js","assets/popupUtils-0740bfd4.js","assets/LayerView-db7ff94b.js","assets/RefreshableLayerView-8ec9084b.js"])),hge={"base-dynamic":()=>Vs().then(()=>Q(()=>import("./BaseDynamicLayerView2D-33bda59f.js"),["assets/BaseDynamicLayerView2D-33bda59f.js","assets/BitmapContainer-e6edece5.js","assets/WGLContainer-cca4133a.js","assets/definitions-3ddd14a8.js","assets/WGLBrushVTLSymbol-e8c49a01.js","assets/enums-b1d611e3.js","assets/number-b10bd8f5.js","assets/StyleDefinition-7d58136b.js","assets/enums-4b2a86a0.js","assets/GeometryUtils-dd03fc25.js","assets/color-ecd22285.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-c9ea1109.js","assets/MaterialKey-c290b8d1.js","assets/alignmentUtils-ae955d28.js","assets/utils-2b9e1dc7.js","assets/heatmapTextureUtils-e2b3289a.js","assets/Container-83d986f4.js","assets/LayerView2D-ea94ade1.js","assets/ExportStrategy-baa8cc49.js","assets/Bitmap-d8ac0db6.js","assets/LayerView-db7ff94b.js","assets/RefreshableLayerView-8ec9084b.js"])),"base-tile":R3,"bing-maps":R3,csv:uE,"geo-rss":()=>Vs().then(()=>Q(()=>import("./GeoRSSLayerView2D-4b552e08.js"),["assets/GeoRSSLayerView2D-4b552e08.js","assets/LayerView2D-ea94ade1.js","assets/Container-83d986f4.js","assets/definitions-3ddd14a8.js","assets/GraphicContainer-d3fa5611.js","assets/enums-b1d611e3.js","assets/BaseGraphicContainer-3c39d579.js","assets/FeatureContainer-3eb11aab.js","assets/AttributeStoreView-06ec49c7.js","assets/visualVariablesUtils-3c7f6581.js","assets/color-ecd22285.js","assets/enums-4b2a86a0.js","assets/number-b10bd8f5.js","assets/visualVariablesUtils-6323c511.js","assets/TileContainer-136758dc.js","assets/WGLContainer-cca4133a.js","assets/WGLBrushVTLSymbol-e8c49a01.js","assets/StyleDefinition-7d58136b.js","assets/GeometryUtils-dd03fc25.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-c9ea1109.js","assets/MaterialKey-c290b8d1.js","assets/alignmentUtils-ae955d28.js","assets/utils-2b9e1dc7.js","assets/heatmapTextureUtils-e2b3289a.js","assets/GraphicsView2D-569b3c38.js","assets/cimAnalyzer-163ac770.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/Rect-ea14f53a.js","assets/projectionSupport-2f167231.js","assets/json-48e3ea08.js","assets/Matcher-8ef33fbf.js","assets/tileUtils-c2f19f52.js","assets/TurboLine-f2375728.js","assets/ExpandedCIM-1ac96b4c.js","assets/schemaUtils-9432c525.js","assets/util-b4eb6d10.js","assets/ComputedAttributeStorage-a0054ede.js","assets/arcadeTimeUtils-21c68d00.js","assets/executionError-fb3f283a.js","assets/centroid-c62179b0.js","assets/GraphicsView-b7bed666.js","assets/LayerView-db7ff94b.js"])),feature:uE,geojson:uE,graphics:()=>Vs().then(()=>Q(()=>import("./GraphicsLayerView2D-8346647b.js"),["assets/GraphicsLayerView2D-8346647b.js","assets/LayerView2D-ea94ade1.js","assets/Container-83d986f4.js","assets/definitions-3ddd14a8.js","assets/GraphicContainer-d3fa5611.js","assets/enums-b1d611e3.js","assets/BaseGraphicContainer-3c39d579.js","assets/FeatureContainer-3eb11aab.js","assets/AttributeStoreView-06ec49c7.js","assets/visualVariablesUtils-3c7f6581.js","assets/color-ecd22285.js","assets/enums-4b2a86a0.js","assets/number-b10bd8f5.js","assets/visualVariablesUtils-6323c511.js","assets/TileContainer-136758dc.js","assets/WGLContainer-cca4133a.js","assets/WGLBrushVTLSymbol-e8c49a01.js","assets/StyleDefinition-7d58136b.js","assets/GeometryUtils-dd03fc25.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-c9ea1109.js","assets/MaterialKey-c290b8d1.js","assets/alignmentUtils-ae955d28.js","assets/utils-2b9e1dc7.js","assets/heatmapTextureUtils-e2b3289a.js","assets/GraphicsView2D-569b3c38.js","assets/cimAnalyzer-163ac770.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/Rect-ea14f53a.js","assets/projectionSupport-2f167231.js","assets/json-48e3ea08.js","assets/Matcher-8ef33fbf.js","assets/tileUtils-c2f19f52.js","assets/TurboLine-f2375728.js","assets/ExpandedCIM-1ac96b4c.js","assets/schemaUtils-9432c525.js","assets/util-b4eb6d10.js","assets/ComputedAttributeStorage-a0054ede.js","assets/arcadeTimeUtils-21c68d00.js","assets/executionError-fb3f283a.js","assets/centroid-c62179b0.js","assets/GraphicsView-b7bed666.js","assets/LayerView-db7ff94b.js"])),group:()=>Vs().then(()=>Q(()=>import("./GroupLayerView2D-c6222dc5.js"),["assets/GroupLayerView2D-c6222dc5.js","assets/GroupContainer-ac6030e0.js","assets/WGLContainer-cca4133a.js","assets/definitions-3ddd14a8.js","assets/WGLBrushVTLSymbol-e8c49a01.js","assets/enums-b1d611e3.js","assets/number-b10bd8f5.js","assets/StyleDefinition-7d58136b.js","assets/enums-4b2a86a0.js","assets/GeometryUtils-dd03fc25.js","assets/color-ecd22285.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-c9ea1109.js","assets/MaterialKey-c290b8d1.js","assets/alignmentUtils-ae955d28.js","assets/utils-2b9e1dc7.js","assets/heatmapTextureUtils-e2b3289a.js","assets/Container-83d986f4.js","assets/LayerView2D-ea94ade1.js","assets/GroupLayerView-5b39ea01.js","assets/LayerView-db7ff94b.js"])),imagery:()=>Vs().then(()=>Q(()=>import("./ImageryLayerView2D-ef8c4666.js"),["assets/ImageryLayerView2D-ef8c4666.js","assets/RasterVFDisplayObject-c6baf3ae.js","assets/dataUtils-6f18e1a2.js","assets/WGLBrushVTLSymbol-e8c49a01.js","assets/definitions-3ddd14a8.js","assets/enums-b1d611e3.js","assets/number-b10bd8f5.js","assets/StyleDefinition-7d58136b.js","assets/enums-4b2a86a0.js","assets/GeometryUtils-dd03fc25.js","assets/WGLContainer-cca4133a.js","assets/color-ecd22285.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-c9ea1109.js","assets/MaterialKey-c290b8d1.js","assets/alignmentUtils-ae955d28.js","assets/utils-2b9e1dc7.js","assets/heatmapTextureUtils-e2b3289a.js","assets/Container-83d986f4.js","assets/LayerView2D-ea94ade1.js","assets/GraphicsView2D-569b3c38.js","assets/cimAnalyzer-163ac770.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/Rect-ea14f53a.js","assets/projectionSupport-2f167231.js","assets/json-48e3ea08.js","assets/AttributeStoreView-06ec49c7.js","assets/visualVariablesUtils-3c7f6581.js","assets/visualVariablesUtils-6323c511.js","assets/Matcher-8ef33fbf.js","assets/tileUtils-c2f19f52.js","assets/TurboLine-f2375728.js","assets/ExpandedCIM-1ac96b4c.js","assets/schemaUtils-9432c525.js","assets/util-b4eb6d10.js","assets/ComputedAttributeStorage-a0054ede.js","assets/arcadeTimeUtils-21c68d00.js","assets/executionError-fb3f283a.js","assets/centroid-c62179b0.js","assets/GraphicsView-b7bed666.js","assets/HighlightGraphicContainer-52e9dfd7.js","assets/BaseGraphicContainer-3c39d579.js","assets/FeatureContainer-3eb11aab.js","assets/TileContainer-136758dc.js","assets/BitmapContainer-e6edece5.js","assets/Bitmap-d8ac0db6.js","assets/ExportStrategy-baa8cc49.js","assets/rasterProjectionHelper-c7164d08.js","assets/ImageryLayerView-b0f7303e.js","assets/popupUtils-0740bfd4.js","assets/LayerView-db7ff94b.js","assets/RefreshableLayerView-8ec9084b.js"])),"imagery-tile":()=>Vs().then(()=>Q(()=>import("./ImageryTileLayerView2D-1938e1fe.js"),["assets/ImageryTileLayerView2D-1938e1fe.js","assets/multidimensionalUtils-7e99fec9.js","assets/RasterVFDisplayObject-c6baf3ae.js","assets/dataUtils-6f18e1a2.js","assets/WGLBrushVTLSymbol-e8c49a01.js","assets/definitions-3ddd14a8.js","assets/enums-b1d611e3.js","assets/number-b10bd8f5.js","assets/StyleDefinition-7d58136b.js","assets/enums-4b2a86a0.js","assets/GeometryUtils-dd03fc25.js","assets/WGLContainer-cca4133a.js","assets/color-ecd22285.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-c9ea1109.js","assets/MaterialKey-c290b8d1.js","assets/alignmentUtils-ae955d28.js","assets/utils-2b9e1dc7.js","assets/heatmapTextureUtils-e2b3289a.js","assets/Container-83d986f4.js","assets/LayerView2D-ea94ade1.js","assets/TileContainer-136758dc.js","assets/RawBlockCache-7cc07e54.js","assets/rasterProjectionHelper-c7164d08.js","assets/util-b4eb6d10.js","assets/ImageryTileLayerView-363e3eef.js","assets/popupUtils-0740bfd4.js","assets/LayerView-db7ff94b.js","assets/RefreshableLayerView-8ec9084b.js"])),kml:()=>Vs().then(()=>Q(()=>import("./KMLLayerView2D-8ee3f1c0.js"),["assets/KMLLayerView2D-8ee3f1c0.js","assets/kmlUtils-74f5547b.js","assets/Bitmap-d8ac0db6.js","assets/BitmapContainer-e6edece5.js","assets/WGLContainer-cca4133a.js","assets/definitions-3ddd14a8.js","assets/WGLBrushVTLSymbol-e8c49a01.js","assets/enums-b1d611e3.js","assets/number-b10bd8f5.js","assets/StyleDefinition-7d58136b.js","assets/enums-4b2a86a0.js","assets/GeometryUtils-dd03fc25.js","assets/color-ecd22285.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-c9ea1109.js","assets/MaterialKey-c290b8d1.js","assets/alignmentUtils-ae955d28.js","assets/utils-2b9e1dc7.js","assets/heatmapTextureUtils-e2b3289a.js","assets/Container-83d986f4.js","assets/LayerView2D-ea94ade1.js","assets/GraphicContainer-d3fa5611.js","assets/BaseGraphicContainer-3c39d579.js","assets/FeatureContainer-3eb11aab.js","assets/AttributeStoreView-06ec49c7.js","assets/visualVariablesUtils-3c7f6581.js","assets/visualVariablesUtils-6323c511.js","assets/TileContainer-136758dc.js","assets/GraphicsView2D-569b3c38.js","assets/cimAnalyzer-163ac770.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/Rect-ea14f53a.js","assets/projectionSupport-2f167231.js","assets/json-48e3ea08.js","assets/Matcher-8ef33fbf.js","assets/tileUtils-c2f19f52.js","assets/TurboLine-f2375728.js","assets/ExpandedCIM-1ac96b4c.js","assets/schemaUtils-9432c525.js","assets/util-b4eb6d10.js","assets/ComputedAttributeStorage-a0054ede.js","assets/arcadeTimeUtils-21c68d00.js","assets/executionError-fb3f283a.js","assets/centroid-c62179b0.js","assets/GraphicsView-b7bed666.js","assets/LayerView-db7ff94b.js","assets/rasterProjectionHelper-c7164d08.js","assets/MaterialPrograms-ea2ca365.js","assets/programUtils-f035fe8a.js"])),"knowledge-graph":()=>Vs().then(()=>Q(()=>import("./KnowledgeGraphLayerView2D-9adac1ab.js"),["assets/KnowledgeGraphLayerView2D-9adac1ab.js","assets/LayerView2D-ea94ade1.js","assets/Container-83d986f4.js","assets/definitions-3ddd14a8.js","assets/LayerView-db7ff94b.js"])),"link-chart":()=>Vs().then(()=>Q(()=>import("./KnowledgeGraphLayerView2D-9adac1ab.js"),["assets/KnowledgeGraphLayerView2D-9adac1ab.js","assets/LayerView2D-ea94ade1.js","assets/Container-83d986f4.js","assets/definitions-3ddd14a8.js","assets/LayerView-db7ff94b.js"])),"knowledge-graph-sublayer":uE,"map-image":()=>Vs().then(()=>Q(()=>import("./MapImageLayerView2D-c3d2dbef.js"),["assets/MapImageLayerView2D-c3d2dbef.js","assets/BitmapContainer-e6edece5.js","assets/WGLContainer-cca4133a.js","assets/definitions-3ddd14a8.js","assets/WGLBrushVTLSymbol-e8c49a01.js","assets/enums-b1d611e3.js","assets/number-b10bd8f5.js","assets/StyleDefinition-7d58136b.js","assets/enums-4b2a86a0.js","assets/GeometryUtils-dd03fc25.js","assets/color-ecd22285.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-c9ea1109.js","assets/MaterialKey-c290b8d1.js","assets/alignmentUtils-ae955d28.js","assets/utils-2b9e1dc7.js","assets/heatmapTextureUtils-e2b3289a.js","assets/Container-83d986f4.js","assets/LayerView2D-ea94ade1.js","assets/GraphicsView2D-569b3c38.js","assets/cimAnalyzer-163ac770.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/Rect-ea14f53a.js","assets/projectionSupport-2f167231.js","assets/json-48e3ea08.js","assets/AttributeStoreView-06ec49c7.js","assets/visualVariablesUtils-3c7f6581.js","assets/visualVariablesUtils-6323c511.js","assets/Matcher-8ef33fbf.js","assets/tileUtils-c2f19f52.js","assets/TurboLine-f2375728.js","assets/ExpandedCIM-1ac96b4c.js","assets/schemaUtils-9432c525.js","assets/util-b4eb6d10.js","assets/ComputedAttributeStorage-a0054ede.js","assets/arcadeTimeUtils-21c68d00.js","assets/executionError-fb3f283a.js","assets/centroid-c62179b0.js","assets/GraphicsView-b7bed666.js","assets/HighlightGraphicContainer-52e9dfd7.js","assets/BaseGraphicContainer-3c39d579.js","assets/FeatureContainer-3eb11aab.js","assets/TileContainer-136758dc.js","assets/ExportStrategy-baa8cc49.js","assets/Bitmap-d8ac0db6.js","assets/LayerView-db7ff94b.js","assets/MapImageLayerView-5431461d.js","assets/ExportImageParameters-d00104d2.js","assets/floorFilterUtils-080a7cd2.js","assets/sublayerUtils-78c9523d.js","assets/RefreshableLayerView-8ec9084b.js","assets/MapServiceLayerViewHelper-3c93e294.js","assets/popupUtils-0740bfd4.js","assets/drapedUtils-0903c165.js"])),"map-notes":()=>Vs().then(()=>Q(()=>import("./MapNotesLayerView2D-2b8f2d9d.js"),["assets/MapNotesLayerView2D-2b8f2d9d.js","assets/Container-83d986f4.js","assets/definitions-3ddd14a8.js","assets/GroupContainer-ac6030e0.js","assets/WGLContainer-cca4133a.js","assets/WGLBrushVTLSymbol-e8c49a01.js","assets/enums-b1d611e3.js","assets/number-b10bd8f5.js","assets/StyleDefinition-7d58136b.js","assets/enums-4b2a86a0.js","assets/GeometryUtils-dd03fc25.js","assets/color-ecd22285.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-c9ea1109.js","assets/MaterialKey-c290b8d1.js","assets/alignmentUtils-ae955d28.js","assets/utils-2b9e1dc7.js","assets/heatmapTextureUtils-e2b3289a.js","assets/LayerView2D-ea94ade1.js","assets/GraphicContainer-d3fa5611.js","assets/BaseGraphicContainer-3c39d579.js","assets/FeatureContainer-3eb11aab.js","assets/AttributeStoreView-06ec49c7.js","assets/visualVariablesUtils-3c7f6581.js","assets/visualVariablesUtils-6323c511.js","assets/TileContainer-136758dc.js","assets/GraphicsView2D-569b3c38.js","assets/cimAnalyzer-163ac770.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/Rect-ea14f53a.js","assets/projectionSupport-2f167231.js","assets/json-48e3ea08.js","assets/Matcher-8ef33fbf.js","assets/tileUtils-c2f19f52.js","assets/TurboLine-f2375728.js","assets/ExpandedCIM-1ac96b4c.js","assets/schemaUtils-9432c525.js","assets/util-b4eb6d10.js","assets/ComputedAttributeStorage-a0054ede.js","assets/arcadeTimeUtils-21c68d00.js","assets/executionError-fb3f283a.js","assets/centroid-c62179b0.js","assets/GraphicsView-b7bed666.js","assets/LayerView-db7ff94b.js"])),media:()=>Vs().then(()=>Q(()=>import("./MediaLayerView2D-6aa5cd82.js"),["assets/MediaLayerView2D-6aa5cd82.js","assets/Rasterizer-a13839c4.js","assets/_commonjsHelpers-2f3e7994.js","assets/cimAnalyzer-163ac770.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/enums-4b2a86a0.js","assets/alignmentUtils-ae955d28.js","assets/definitions-3ddd14a8.js","assets/number-b10bd8f5.js","assets/Rect-ea14f53a.js","assets/rasterizingUtils-37f0f33e.js","assets/Container-83d986f4.js","assets/BufferPool-81fcde76.js","assets/enums-b1d611e3.js","assets/WGLContainer-cca4133a.js","assets/WGLBrushVTLSymbol-e8c49a01.js","assets/StyleDefinition-7d58136b.js","assets/GeometryUtils-dd03fc25.js","assets/color-ecd22285.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-c9ea1109.js","assets/MaterialKey-c290b8d1.js","assets/utils-2b9e1dc7.js","assets/heatmapTextureUtils-e2b3289a.js","assets/MagnifierPrograms-8cd20d2d.js","assets/imageutils-58ee6580.js","assets/Matcher-8ef33fbf.js","assets/visualVariablesUtils-3c7f6581.js","assets/visualVariablesUtils-6323c511.js","assets/tileUtils-c2f19f52.js","assets/TurboLine-f2375728.js","assets/ExpandedCIM-1ac96b4c.js","assets/CircularArray-724bafc9.js","assets/ComputedAttributeStorage-a0054ede.js","assets/arcadeTimeUtils-21c68d00.js","assets/executionError-fb3f283a.js","assets/centroid-c62179b0.js","assets/GraphicsView2D-569b3c38.js","assets/projectionSupport-2f167231.js","assets/json-48e3ea08.js","assets/AttributeStoreView-06ec49c7.js","assets/schemaUtils-9432c525.js","assets/util-b4eb6d10.js","assets/GraphicsView-b7bed666.js","assets/LayerView2D-ea94ade1.js","assets/LayerView-db7ff94b.js"])),"ogc-feature":()=>Vs().then(()=>Q(()=>import("./OGCFeatureLayerView2D-fb05e5af.js"),["assets/OGCFeatureLayerView2D-fb05e5af.js","assets/FeatureLayerView2D-388b15f8.js","assets/Container-83d986f4.js","assets/definitions-3ddd14a8.js","assets/LayerView2D-ea94ade1.js","assets/schemaUtils-9432c525.js","assets/enums-b1d611e3.js","assets/color-ecd22285.js","assets/enums-4b2a86a0.js","assets/number-b10bd8f5.js","assets/utils-2b9e1dc7.js","assets/MaterialKey-c290b8d1.js","assets/alignmentUtils-ae955d28.js","assets/visualVariablesUtils-6323c511.js","assets/cimAnalyzer-163ac770.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/Rect-ea14f53a.js","assets/ExpandedCIM-1ac96b4c.js","assets/util-b4eb6d10.js","assets/FeatureLayerView-0d0f168b.js","assets/floorFilterUtils-080a7cd2.js","assets/popupUtils-0740bfd4.js","assets/LayerView-db7ff94b.js","assets/RefreshableLayerView-8ec9084b.js","assets/OGCFeatureLayerView-9886b103.js"])),"open-street-map":R3,"oriented-imagery":uE,route:()=>Vs().then(()=>Q(()=>import("./RouteLayerView2D-bdeb7f2a.js"),["assets/RouteLayerView2D-bdeb7f2a.js","assets/Stop-32221191.js","assets/LayerView2D-ea94ade1.js","assets/Container-83d986f4.js","assets/definitions-3ddd14a8.js","assets/GraphicContainer-d3fa5611.js","assets/enums-b1d611e3.js","assets/BaseGraphicContainer-3c39d579.js","assets/FeatureContainer-3eb11aab.js","assets/AttributeStoreView-06ec49c7.js","assets/visualVariablesUtils-3c7f6581.js","assets/color-ecd22285.js","assets/enums-4b2a86a0.js","assets/number-b10bd8f5.js","assets/visualVariablesUtils-6323c511.js","assets/TileContainer-136758dc.js","assets/WGLContainer-cca4133a.js","assets/WGLBrushVTLSymbol-e8c49a01.js","assets/StyleDefinition-7d58136b.js","assets/GeometryUtils-dd03fc25.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-c9ea1109.js","assets/MaterialKey-c290b8d1.js","assets/alignmentUtils-ae955d28.js","assets/utils-2b9e1dc7.js","assets/heatmapTextureUtils-e2b3289a.js","assets/GraphicsView2D-569b3c38.js","assets/cimAnalyzer-163ac770.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/Rect-ea14f53a.js","assets/projectionSupport-2f167231.js","assets/json-48e3ea08.js","assets/Matcher-8ef33fbf.js","assets/tileUtils-c2f19f52.js","assets/TurboLine-f2375728.js","assets/ExpandedCIM-1ac96b4c.js","assets/schemaUtils-9432c525.js","assets/util-b4eb6d10.js","assets/ComputedAttributeStorage-a0054ede.js","assets/arcadeTimeUtils-21c68d00.js","assets/executionError-fb3f283a.js","assets/centroid-c62179b0.js","assets/GraphicsView-b7bed666.js","assets/LayerView-db7ff94b.js"])),stream:()=>Vs().then(()=>Q(()=>import("./StreamLayerView2D-6ff7a6dc.js"),["assets/StreamLayerView2D-6ff7a6dc.js","assets/FeatureLayerView2D-388b15f8.js","assets/Container-83d986f4.js","assets/definitions-3ddd14a8.js","assets/LayerView2D-ea94ade1.js","assets/schemaUtils-9432c525.js","assets/enums-b1d611e3.js","assets/color-ecd22285.js","assets/enums-4b2a86a0.js","assets/number-b10bd8f5.js","assets/utils-2b9e1dc7.js","assets/MaterialKey-c290b8d1.js","assets/alignmentUtils-ae955d28.js","assets/visualVariablesUtils-6323c511.js","assets/cimAnalyzer-163ac770.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/Rect-ea14f53a.js","assets/ExpandedCIM-1ac96b4c.js","assets/util-b4eb6d10.js","assets/FeatureLayerView-0d0f168b.js","assets/floorFilterUtils-080a7cd2.js","assets/popupUtils-0740bfd4.js","assets/LayerView-db7ff94b.js","assets/RefreshableLayerView-8ec9084b.js"])),"subtype-group":()=>Vs().then(()=>Q(()=>import("./SubtypeGroupLayerView2D-c254fe2c.js"),["assets/SubtypeGroupLayerView2D-c254fe2c.js","assets/FeatureLayerView2D-388b15f8.js","assets/Container-83d986f4.js","assets/definitions-3ddd14a8.js","assets/LayerView2D-ea94ade1.js","assets/schemaUtils-9432c525.js","assets/enums-b1d611e3.js","assets/color-ecd22285.js","assets/enums-4b2a86a0.js","assets/number-b10bd8f5.js","assets/utils-2b9e1dc7.js","assets/MaterialKey-c290b8d1.js","assets/alignmentUtils-ae955d28.js","assets/visualVariablesUtils-6323c511.js","assets/cimAnalyzer-163ac770.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/Rect-ea14f53a.js","assets/ExpandedCIM-1ac96b4c.js","assets/util-b4eb6d10.js","assets/FeatureLayerView-0d0f168b.js","assets/floorFilterUtils-080a7cd2.js","assets/popupUtils-0740bfd4.js","assets/LayerView-db7ff94b.js","assets/RefreshableLayerView-8ec9084b.js"])),tile:R3,"vector-tile":()=>Vs().then(()=>Q(()=>import("./VectorTileLayerView2D-4f4c8dd1.js"),["assets/VectorTileLayerView2D-4f4c8dd1.js","assets/TileInfoViewPOT-eafcecca.js","assets/Rect-ea14f53a.js","assets/rasterizingUtils-37f0f33e.js","assets/StyleDefinition-7d58136b.js","assets/enums-4b2a86a0.js","assets/enums-b1d611e3.js","assets/TileContainer-136758dc.js","assets/WGLContainer-cca4133a.js","assets/definitions-3ddd14a8.js","assets/WGLBrushVTLSymbol-e8c49a01.js","assets/number-b10bd8f5.js","assets/GeometryUtils-dd03fc25.js","assets/color-ecd22285.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-c9ea1109.js","assets/MaterialKey-c290b8d1.js","assets/alignmentUtils-ae955d28.js","assets/utils-2b9e1dc7.js","assets/heatmapTextureUtils-e2b3289a.js","assets/Container-83d986f4.js","assets/StyleRepository-30524876.js","assets/colorUtils-c0f43caf.js","assets/GeometryUtils-53652037.js","assets/LayerView2D-ea94ade1.js","assets/LayerView-db7ff94b.js"])),wcs:()=>Vs().then(()=>Q(()=>import("./ImageryTileLayerView2D-1938e1fe.js"),["assets/ImageryTileLayerView2D-1938e1fe.js","assets/multidimensionalUtils-7e99fec9.js","assets/RasterVFDisplayObject-c6baf3ae.js","assets/dataUtils-6f18e1a2.js","assets/WGLBrushVTLSymbol-e8c49a01.js","assets/definitions-3ddd14a8.js","assets/enums-b1d611e3.js","assets/number-b10bd8f5.js","assets/StyleDefinition-7d58136b.js","assets/enums-4b2a86a0.js","assets/GeometryUtils-dd03fc25.js","assets/WGLContainer-cca4133a.js","assets/color-ecd22285.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-c9ea1109.js","assets/MaterialKey-c290b8d1.js","assets/alignmentUtils-ae955d28.js","assets/utils-2b9e1dc7.js","assets/heatmapTextureUtils-e2b3289a.js","assets/Container-83d986f4.js","assets/LayerView2D-ea94ade1.js","assets/TileContainer-136758dc.js","assets/RawBlockCache-7cc07e54.js","assets/rasterProjectionHelper-c7164d08.js","assets/util-b4eb6d10.js","assets/ImageryTileLayerView-363e3eef.js","assets/popupUtils-0740bfd4.js","assets/LayerView-db7ff94b.js","assets/RefreshableLayerView-8ec9084b.js"])),"web-tile":R3,wfs:uE,wms:()=>Vs().then(()=>Q(()=>import("./WMSLayerView2D-902964c2.js"),["assets/WMSLayerView2D-902964c2.js","assets/BitmapContainer-e6edece5.js","assets/WGLContainer-cca4133a.js","assets/definitions-3ddd14a8.js","assets/WGLBrushVTLSymbol-e8c49a01.js","assets/enums-b1d611e3.js","assets/number-b10bd8f5.js","assets/StyleDefinition-7d58136b.js","assets/enums-4b2a86a0.js","assets/GeometryUtils-dd03fc25.js","assets/color-ecd22285.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-c9ea1109.js","assets/MaterialKey-c290b8d1.js","assets/alignmentUtils-ae955d28.js","assets/utils-2b9e1dc7.js","assets/heatmapTextureUtils-e2b3289a.js","assets/Container-83d986f4.js","assets/LayerView2D-ea94ade1.js","assets/ExportStrategy-baa8cc49.js","assets/Bitmap-d8ac0db6.js","assets/LayerView-db7ff94b.js","assets/RefreshableLayerView-8ec9084b.js","assets/WMSLayerView-798e7ab2.js","assets/ExportWMSImageParameters-3fec441b.js"])),wmts:()=>Vs().then(()=>Q(()=>import("./WMTSLayerView2D-32ae0363.js"),["assets/WMTSLayerView2D-32ae0363.js","assets/imageUtils-e94d5dad.js","assets/BitmapTileContainer-1a0f1e5f.js","assets/Bitmap-d8ac0db6.js","assets/WGLContainer-cca4133a.js","assets/definitions-3ddd14a8.js","assets/WGLBrushVTLSymbol-e8c49a01.js","assets/enums-b1d611e3.js","assets/number-b10bd8f5.js","assets/StyleDefinition-7d58136b.js","assets/enums-4b2a86a0.js","assets/GeometryUtils-dd03fc25.js","assets/color-ecd22285.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-c9ea1109.js","assets/MaterialKey-c290b8d1.js","assets/alignmentUtils-ae955d28.js","assets/utils-2b9e1dc7.js","assets/heatmapTextureUtils-e2b3289a.js","assets/Container-83d986f4.js","assets/TileContainer-136758dc.js","assets/LayerView2D-ea94ade1.js","assets/LayerView-db7ff94b.js","assets/RefreshableLayerView-8ec9084b.js"])),"line-of-sight":null,"base-elevation":null,"building-scene":null,dimension:null,elevation:null,"integrated-mesh":null,"point-cloud":null,voxel:null,scene:null,unknown:null,unsupported:null};function Wdt(t){const e=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",i=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new H(`${i}:view-not-supported`,`${e} is not supported in 2D`)}const dge={hasLayerViewModule:t=>v(hge[t.type]),importLayerView:t=>{const e=hge[t.type];if(R(e))throw Wdt(t);return e(t)}};function Xdt(t,e){const{spatialReference:i}=e,r=[e.x,e.y];let n=Number.POSITIVE_INFINITY,s=0,o=0;const a=[0,0],l=t.type==="extent"?[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]:t.rings;for(const c of l)for(let h=0;h<c.length-1;h++){zGe(a,r,c,h);const p=gy(r,a);p<n&&(n=p,s=a[0],o=a[1])}return{coordinate:new Le({x:s,y:o,spatialReference:i}),distance:n}}var wQ;let eS=wQ=class extends V9(ve){constructor(t){super(t),this.geometry=null,this.spatialReference=null}get normalizedGeometry(){if(R(this.geometry)||!this.spatialReference)return null;if(!this.spatialReference.equals(this.geometry.spatialReference))try{return Sm(this.geometry,this.spatialReference)}catch(t){return re.getLogger(this.declaredClass).error("#constraints.geometry","could not project the geometry to the view's spatial reference",{geometry:this.geometry,spatialReference:this.spatialReference,error:t}),null}return this.geometry}constrain(t,e){if(R(this.normalizedGeometry))return t;const i=t.targetGeometry;if(this.normalizedGeometry.type==="extent"?L9(this.normalizedGeometry,i):Z2e(this.normalizedGeometry,i))return t;const{coordinate:r}=Xdt(this.normalizedGeometry,i);return r&&(t.targetGeometry=r),t}clone(){var t,e;return new wQ({geometry:(t=this.geometry)==null?void 0:t.clone(),spatialReference:(e=this.spatialReference)==null?void 0:e.clone()})}};u([d({constructOnly:!0})],eS.prototype,"geometry",void 0),u([d({readOnly:!0})],eS.prototype,"normalizedGeometry",null),u([d({constructOnly:!0})],eS.prototype,"spatialReference",void 0),eS=wQ=u([$("esri.views.2d.constraints.GeometryConstraint")],eS);var xQ;let _I=xQ=class extends V9(ve){constructor(){super(...arguments),this.enabled=!0,this.rotationEnabled=!0}constrain(t,e){return this.enabled&&e&&(this.rotationEnabled||(t.rotation=e.rotation)),t}clone(){return new xQ({enabled:this.enabled,rotationEnabled:this.rotationEnabled})}};u([d()],_I.prototype,"enabled",void 0),u([d()],_I.prototype,"rotationEnabled",void 0),_I=xQ=u([$("esri.views.2d.constraints.RotationConstraint")],_I);const n$e=_I;var TQ;let _u=TQ=class extends V9(ve){constructor(t){super(t),this._lodByScale={},this._scales=[],this.effectiveLODs=null,this.effectiveMinZoom=-1,this.effectiveMaxZoom=-1,this.effectiveMinScale=0,this.effectiveMaxScale=0,this.lods=null,this.minZoom=-1,this.maxZoom=-1,this.minScale=0,this.maxScale=0,this.snapToZoom=!0}initialize(){let t,{lods:e,minScale:i,maxScale:r,minZoom:n,maxZoom:s}=this,o=-1,a=-1,l=!1,c=!1;if(i!==0&&r!==0&&i<r&&([i,r]=[r,i]),!e||!e.length)return this._set("effectiveMinScale",i),void this._set("effectiveMaxScale",r);e=e.map(h=>h.clone()),e.sort((h,p)=>p.scale-h.scale),e.forEach((h,p)=>h.level=p);for(const h of e)!l&&i>0&&i>=h.scale&&(o=h.level,l=!0),!c&&r>0&&r>=h.scale&&(a=t?t.level:-1,c=!0),t=h;n===-1&&(n=i===0?0:o),s===-1&&(s=r===0?e.length-1:a),n=Math.max(n,0),n=Math.min(n,e.length-1),s=Math.max(s,0),s=Math.min(s,e.length-1),n>s&&([n,s]=[s,n]),i=e[n].scale,r=e[s].scale,e.splice(0,n),e.splice(s-n+1,e.length),e.forEach((h,p)=>{this._lodByScale[h.scale]=h,this._scales[p]=h.scale}),this._set("effectiveLODs",e),this._set("effectiveMinZoom",n),this._set("effectiveMaxZoom",s),this._set("effectiveMinScale",i),this._set("effectiveMaxScale",r)}constrain(t,e){if(e&&t.scale===e.scale)return t;const i=this.effectiveMinScale,r=this.effectiveMaxScale,n=t.targetGeometry,s=e&&e.targetGeometry,o=r!==0&&t.scale<r,a=i!==0&&t.scale>i;if(o||a){const l=a?i:r;if(e&&s){const c=(l-e.scale)/(t.scale-e.scale);n.x=s.x+(n.x-s.x)*c,n.y=s.y+(n.y-s.y)*c}t.scale=l}return this.snapToZoom&&this.effectiveLODs&&(t.scale=this._getClosestScale(t.scale)),t}fit(t){if(!this.effectiveLODs||!this.snapToZoom)return this.constrain(t,null);const e=this.scaleToZoom(t.scale),i=Math.abs(e-Math.floor(e));return t.scale=this.zoomToScale(i>.99?Math.round(e):Math.floor(e)),t}zoomToScale(t){if(!this.effectiveLODs)return 0;t-=this.effectiveMinZoom,t=Math.max(0,t);const e=this._scales;if(t<=0)return e[0];if(t>=e.length)return e[e.length-1];const i=Math.round(t-.5),r=Math.round(t);return e[r]+(r-t)*(e[i]-e[r])}scaleToZoom(t){if(!this.effectiveLODs)return-1;const e=this._scales;let i,r;if(t>=e[0])return this.effectiveMinZoom;if(t<=e[e.length-1])return this.effectiveMaxZoom;for(let n=0;n<e.length-1;n++){if(i=e[n],r=e[n+1],r===t)return n+this.effectiveMinZoom+1;if(i>t&&r<t)return n+this.effectiveMinZoom+1-(t-r)/(i-r)}return-1}snapToClosestScale(t){if(!this.effectiveLODs)return t;const e=this.scaleToZoom(t);return this.zoomToScale(Math.round(e))}snapToNextScale(t,e=.5){if(!this.effectiveLODs)return t*e;const i=Math.round(this.scaleToZoom(t));return this.zoomToScale(i+1)}snapToPreviousScale(t,e=2){if(!this.effectiveLODs)return t*e;const i=Math.round(this.scaleToZoom(t));return this.zoomToScale(i-1)}clone(){return new TQ({lods:this.lods,minZoom:this.minZoom,maxZoom:this.maxZoom,minScale:this.minScale,maxScale:this.maxScale})}_getClosestScale(t){return this._lodByScale[t]||(t=this._scales.reduce((e,i)=>Math.abs(i-t)<=Math.abs(e-t)?i:e,this._scales[0])),this._lodByScale[t].scale}};u([d({readOnly:!0})],_u.prototype,"effectiveLODs",void 0),u([d({readOnly:!0})],_u.prototype,"effectiveMinZoom",void 0),u([d({readOnly:!0})],_u.prototype,"effectiveMaxZoom",void 0),u([d({readOnly:!0})],_u.prototype,"effectiveMinScale",void 0),u([d({readOnly:!0})],_u.prototype,"effectiveMaxScale",void 0),u([d()],_u.prototype,"lods",void 0),u([d()],_u.prototype,"minZoom",void 0),u([d()],_u.prototype,"maxZoom",void 0),u([d()],_u.prototype,"minScale",void 0),u([d()],_u.prototype,"maxScale",void 0),u([d()],_u.prototype,"snapToZoom",void 0),_u=TQ=u([$("esri.views.2d.constraints.ZoomConstraint")],_u);const s$e=_u,Ydt={base:null,key:"type",typeMap:{extent:ni,polygon:ec}};let Ds=class extends ve{constructor(e){super(e),this.lods=null,this.minScale=0,this.maxScale=0,this.minZoom=-1,this.maxZoom=-1,this.rotationEnabled=!0,this.snapToZoom=!0}destroy(){this.view=null}get effectiveLODs(){return this._zoom.effectiveLODs}get effectiveMinScale(){return this._zoom.effectiveMinScale}get effectiveMaxScale(){return this._zoom.effectiveMaxScale}get effectiveMinZoom(){return this._zoom.effectiveMinZoom}get effectiveMaxZoom(){return this._zoom.effectiveMaxZoom}set geometry(e){e?this._set("geometry",e):this._set("geometry",null)}get version(){var e,i,r;return`${(e=this._zoom)==null?void 0:e.uid}/${(i=this._rotation)==null?void 0:i.uid}/${(r=this._geometry)==null?void 0:r.uid}`}get _defaultLODs(){var r,n,s;const e=(n=(r=this.view)==null?void 0:r.defaultsFromMap)==null?void 0:n.tileInfo,i=(s=this.view)==null?void 0:s.spatialReference;return e&&i&&e.spatialReference.equals(i)?e.lods:null}get _geometry(){var e;return new eS({geometry:this.geometry,spatialReference:(e=this.view)==null?void 0:e.spatialReference})}get _rotation(){return new n$e({rotationEnabled:this.rotationEnabled})}get _zoom(){const e=this._get("_zoom"),i=this.lods||this._defaultLODs,r=this.minZoom,n=this.maxZoom,s=this.minScale,o=this.maxScale,a=this.snapToZoom;return e&&e.lods===i&&e.minZoom===r&&e.maxZoom===n&&e.minScale===s&&e.maxScale===o&&e.snapToZoom===a?e:new s$e({lods:i,minZoom:r,maxZoom:n,minScale:s,maxScale:o,snapToZoom:a})}canZoomInTo(e){const i=this.effectiveMaxScale;return i===0||e>=i}canZoomOutTo(e){const i=this.effectiveMinScale;return i===0||e<=i}constrain(e,i){return this._zoom.constrain(e,i),this._rotation.constrain(e,i),this._geometry.constrain(e,i),e}constrainByGeometry(e){return this._geometry.constrain(e)}fit(e){return this._zoom.fit(e)}zoomToScale(e){return this._zoom.zoomToScale(e)}scaleToZoom(e){return this._zoom.scaleToZoom(e)}snapScale(e){return this._zoom.snapToClosestScale(e)}snapToNextScale(e){return this._zoom.snapToNextScale(e)}snapToPreviousScale(e){return this._zoom.snapToPreviousScale(e)}};u([d({readOnly:!0})],Ds.prototype,"effectiveLODs",null),u([d({readOnly:!0})],Ds.prototype,"effectiveMinScale",null),u([d({readOnly:!0})],Ds.prototype,"effectiveMaxScale",null),u([d({readOnly:!0})],Ds.prototype,"effectiveMinZoom",null),u([d({readOnly:!0})],Ds.prototype,"effectiveMaxZoom",null),u([d({types:Ydt,value:null})],Ds.prototype,"geometry",null),u([d({type:[rp]})],Ds.prototype,"lods",void 0),u([d()],Ds.prototype,"minScale",void 0),u([d()],Ds.prototype,"maxScale",void 0),u([d()],Ds.prototype,"minZoom",void 0),u([d()],Ds.prototype,"maxZoom",void 0),u([d()],Ds.prototype,"rotationEnabled",void 0),u([d()],Ds.prototype,"snapToZoom",void 0),u([d()],Ds.prototype,"view",void 0),u([d({readOnly:!0})],Ds.prototype,"version",null),u([d()],Ds.prototype,"_defaultLODs",null),u([d({type:eS})],Ds.prototype,"_geometry",null),u([d({type:n$e})],Ds.prototype,"_rotation",null),u([d({readOnly:!0,type:s$e})],Ds.prototype,"_zoom",null),Ds=u([$("esri.views.2d.MapViewConstraints")],Ds);const o$e=Ds;function Dp(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function Zdt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function fD(t,e,i,r,n,s,o,a,l,c){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=s,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t}function Hoe(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Qu(t,e){if(t===e){const i=e[1],r=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=r,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function Uw(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=h*o-a*c,f=-h*s+a*l,m=c*s-o*l;let g=i*p+r*f+n*m;return g?(g=1/g,t[0]=p*g,t[1]=(-h*r+n*c)*g,t[2]=(a*r-n*o)*g,t[3]=f*g,t[4]=(h*i-n*l)*g,t[5]=(-a*i+n*s)*g,t[6]=m*g,t[7]=(-c*i+r*l)*g,t[8]=(o*i-r*s)*g,t):null}function qoe(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8];return t[0]=o*h-a*c,t[1]=n*c-r*h,t[2]=r*a-n*o,t[3]=a*l-s*h,t[4]=i*h-n*l,t[5]=n*s-i*a,t[6]=s*c-o*l,t[7]=r*l-i*c,t[8]=i*o-r*s,t}function Jdt(t){const e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*(c*s-o*l)+i*(-c*n+o*a)+r*(l*n-s*a)}function pw(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],p=e[8],f=i[0],m=i[1],g=i[2],_=i[3],b=i[4],w=i[5],x=i[6],T=i[7],E=i[8];return t[0]=f*r+m*o+g*c,t[1]=f*n+m*a+g*h,t[2]=f*s+m*l+g*p,t[3]=_*r+b*o+w*c,t[4]=_*n+b*a+w*h,t[5]=_*s+b*l+w*p,t[6]=x*r+T*o+E*c,t[7]=x*n+T*a+E*h,t[8]=x*s+T*l+E*p,t}function YV(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],p=e[8],f=i[0],m=i[1];return t[0]=r,t[1]=n,t[2]=s,t[3]=o,t[4]=a,t[5]=l,t[6]=f*r+m*o+c,t[7]=f*n+m*a+h,t[8]=f*s+m*l+p,t}function Woe(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],p=e[8],f=Math.sin(i),m=Math.cos(i);return t[0]=m*r+f*o,t[1]=m*n+f*a,t[2]=m*s+f*l,t[3]=m*o-f*r,t[4]=m*a-f*n,t[5]=m*l-f*s,t[6]=c,t[7]=h,t[8]=p,t}function Xoe(t,e,i){const r=i[0],n=i[1],s=i[2];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=s*e[6],t[7]=s*e[7],t[8]=s*e[8],t}function Kdt(t,e,i){const r=i[0],n=i[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t}function Qdt(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function ept(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=-i,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function tpt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function ipt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function Yoe(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=i+i,a=r+r,l=n+n,c=i*o,h=r*o,p=r*a,f=n*o,m=n*a,g=n*l,_=s*o,b=s*a,w=s*l;return t[0]=1-p-g,t[3]=h-w,t[6]=f+b,t[1]=h+w,t[4]=1-c-g,t[7]=m-_,t[2]=f-b,t[5]=m+_,t[8]=1-c-p,t}function a$e(t,e){const i=e[0],r=e[1],n=e[2],s=e[4],o=e[5],a=e[6],l=e[8],c=e[9],h=e[10],p=h*o-a*c,f=-h*s+a*l,m=c*s-o*l,g=i*p+r*f+n*m;if(!g)return null;const _=1/g;return t[0]=p*_,t[1]=(-h*r+n*c)*_,t[2]=(a*r-n*o)*_,t[3]=f*_,t[4]=(h*i-n*l)*_,t[5]=(-a*i+n*s)*_,t[6]=m*_,t[7]=(-c*i+r*l)*_,t[8]=(o*i-r*s)*_,t}function jM(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],m=e[11],g=e[12],_=e[13],b=e[14],w=e[15],x=i*a-r*o,T=i*l-n*o,E=i*c-s*o,C=r*l-n*a,A=r*c-s*a,I=n*c-s*l,O=h*_-p*g,D=h*b-f*g,U=h*w-m*g,V=p*b-f*_,B=p*w-m*_,ee=f*w-m*b;let ie=x*ee-T*B+E*V+C*U-A*D+I*O;return ie?(ie=1/ie,t[0]=(a*ee-l*B+c*V)*ie,t[1]=(l*U-o*ee-c*D)*ie,t[2]=(o*B-a*U+c*O)*ie,t[3]=(n*B-r*ee-s*V)*ie,t[4]=(i*ee-n*U+s*D)*ie,t[5]=(r*U-i*B-s*O)*ie,t[6]=(_*I-b*A+w*C)*ie,t[7]=(b*E-g*I-w*T)*ie,t[8]=(g*A-_*E+w*x)*ie,t):null}function rpt(t,e,i){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/i,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function npt(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function spt(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2)}function opt(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t}function l$e(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t}function apt(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t}function lpt(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t}function cpt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function upt(t,e){const i=t[0],r=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=e[0],f=e[1],m=e[2],g=e[3],_=e[4],b=e[5],w=e[6],x=e[7],T=e[8],E=bl();return Math.abs(i-p)<=E*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(r-f)<=E*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(n-m)<=E*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(s-g)<=E*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(o-_)<=E*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(a-b)<=E*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(l-w)<=E*Math.max(1,Math.abs(l),Math.abs(w))&&Math.abs(c-x)<=E*Math.max(1,Math.abs(c),Math.abs(x))&&Math.abs(h-T)<=E*Math.max(1,Math.abs(h),Math.abs(T))}function Zoe(t){const e=bl(),i=t[0],r=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8];return Math.abs(1-(i*i+s*s+l*l))<=e&&Math.abs(1-(r*r+o*o+c*c))<=e&&Math.abs(1-(n*n+a*a+h*h))<=e}const hpt=pw,dpt=l$e;Object.freeze(Object.defineProperty({__proto__:null,add:opt,adjoint:qoe,copy:Zdt,determinant:Jdt,equals:upt,exactEquals:cpt,frob:spt,fromMat2d:ipt,fromMat4:Dp,fromQuat:Yoe,fromRotation:ept,fromScaling:tpt,fromTranslation:Qdt,identity:Hoe,invert:Uw,isOrthoNormal:Zoe,mul:hpt,multiply:pw,multiplyScalar:apt,multiplyScalarAndAdd:lpt,normalFromMat4:jM,normalFromMat4Legacy:a$e,projection:rpt,rotate:Woe,scale:Xoe,scaleByVec2:Kdt,set:fD,str:npt,sub:dpt,subtract:l$e,translate:YV,transpose:Qu},Symbol.toStringTag,{value:"Module"}));function qc(){const t=new Float32Array(9);return t[0]=1,t[4]=1,t[8]=1,t}function c$e(t){const e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function dU(t,e,i,r,n,s,o,a,l){const c=new Float32Array(9);return c[0]=t,c[1]=e,c[2]=i,c[3]=r,c[4]=n,c[5]=s,c[6]=o,c[7]=a,c[8]=l,c}function ppt(t,e){return new Float32Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:c$e,create:qc,createView:ppt,fromValues:dU},Symbol.toStringTag,{value:"Module"}));function Joe(){return new Float32Array(2)}function fpt(t){const e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e}function sp(t,e){const i=new Float32Array(2);return i[0]=t,i[1]=e,i}function mpt(t,e){return new Float32Array(t,e,2)}function u$e(){return Joe()}function h$e(){return sp(1,1)}function d$e(){return sp(1,0)}function p$e(){return sp(0,1)}const f$e=u$e(),m$e=h$e(),gpt=d$e(),ypt=p$e();Object.freeze(Object.defineProperty({__proto__:null,ONES:m$e,UNIT_X:gpt,UNIT_Y:ypt,ZEROS:f$e,clone:fpt,create:Joe,createView:mpt,fromValues:sp,ones:h$e,unitX:d$e,unitY:p$e,zeros:u$e},Symbol.toStringTag,{value:"Module"}));function _pt(t){return t instanceof Float32Array&&t.length>=2}function vpt(t){return Array.isArray(t)&&t.length>=2}function aH(t){return _pt(t)||vpt(t)}var SQ;const Uy=[0,0];let b1=SQ=class extends fe{constructor(t){super(t),this._viewpoint2D={center:Fe(),rotation:0,scale:0,spatialReference:void 0},this.center=[0,0],this.extent=new ni,this.id=0,this.inverseTransform=Bb(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=Bb(),this.transformNoRotation=Bb(),this.displayMat3=qc(),this.displayViewMat3=qc(),this.viewMat3=qc(),this.viewMat2d=sIe(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(t){this._set("pixelRatio",t),this._update()}set size(t){this._set("size",t),this._update()}set viewpoint(t){if(t){const e=this._viewpoint2D,i=t.targetGeometry;e.center[0]=i.x,e.center[1]=i.y,e.rotation=t.rotation,e.scale=t.scale,e.spatialReference=i.spatialReference}this._update()}copy(t){const e=this.size,i=this.viewpoint;return i&&e?(this.viewpoint=Em(i,t.viewpoint),this._set("size",io(e,t.size))):(this.viewpoint=t.viewpoint.clone(),this._set("size",[t.size[0],t.size[1]])),this._set("pixelRatio",t.pixelRatio),this}clone(){return new SQ({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(t,e,i){return aH(e)?$g(t,e,this.inverseTransform):(Uy[0]=e,Uy[1]=i,$g(t,Uy,this.inverseTransform))}toScreen(t,e,i){return aH(e)?$g(t,e,this.transform):(Uy[0]=e,Uy[1]=i,$g(t,Uy,this.transform))}toScreenNoRotation(t,e,i){return aH(e)?$g(t,e,this.transformNoRotation):(Uy[0]=e,Uy[1]=i,$g(t,Uy,this.transformNoRotation))}getScreenTransform(t,e){const{center:i}=this._viewpoint2D,r=this._get("pixelRatio")||1,n=this._get("size");return joe(t,i,n,e,0,r),t}_update(){const{center:t,spatialReference:e,scale:i,rotation:r}=this._viewpoint2D,n=this._get("pixelRatio")||1,s=this._get("size"),o=new Jn({targetGeometry:new Le(t[0],t[1],e),scale:i,rotation:r});if(this._set("viewpoint",o),!s||!e||!i)return;this.resolution=DO(o),this.rotation=r,this.scale=i,this.spatialReference=e,io(this.center,t);const a=s[0]!==0?2/s[0]:0,l=s[1]!==0?-2/s[1]:0;fD(this.displayMat3,a,0,0,0,l,0,-1,1,1);const c=Hoe(this.viewMat3),h=sp(s[0]/2,s[1]/2),p=sp(-s[0]/2,-s[1]/2),f=wN(r);YV(c,c,h),Woe(c,c,f),YV(c,c,p),pw(this.displayViewMat3,this.displayMat3,c);const m=Noe(this.viewMat2d,h);return DB(m,m,f),hD(m,m,p),Mdt(this.extent,o,s),Goe(this.transform,o,s,n),Loe(this.inverseTransform,this.transform),Ndt(this.transformNoRotation,o,s,n),this.worldScreenWidth=kdt(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};u([d({readOnly:!0})],b1.prototype,"id",void 0),u([d({value:1,json:{write:!0}})],b1.prototype,"pixelRatio",null),u([d({json:{write:!0}})],b1.prototype,"size",null),u([d()],b1.prototype,"spatialReference",void 0),u([d({type:Jn,json:{write:!0}})],b1.prototype,"viewpoint",null),b1=SQ=u([$("esri.views.2d.ViewState")],b1);const EQ=b1;var CQ,AQ;let U0=CQ=class extends ve{constructor(){super(...arguments),this.left=0,this.top=0,this.right=0,this.bottom=0}clone(){return new CQ({left:this.left,top:this.top,right:this.right,bottom:this.bottom})}};u([d()],U0.prototype,"left",void 0),u([d()],U0.prototype,"top",void 0),u([d()],U0.prototype,"right",void 0),u([d()],U0.prototype,"bottom",void 0),U0=CQ=u([$("esri.views.2d.PaddedViewState.Padding")],U0);let QC=AQ=class extends EQ{constructor(...t){super(...t),this.paddedViewState=new EQ,this._updateContent=(()=>{const e=Fe();return()=>{const i=this._get("size"),r=this._get("padding");if(!i||!r)return;const n=this.paddedViewState;dt(e,r.left+r.right,r.top+r.bottom),Xh(e,i,e),io(n.size,e);const s=n.viewpoint;s&&(this.viewpoint=s)}})(),this.addHandles(ne(()=>[this.size,this.padding],()=>this._updateContent(),Ki)),this.padding=new U0,this.size=[0,0]}set padding(t){this._set("padding",t||new U0)}set viewpoint(t){if(t){const e=t.clone();this.paddedViewState.viewpoint=t,Vdt(e,t,this._get("size"),this._get("padding"));const i=this._viewpoint2D,r=e.targetGeometry;i.center[0]=r.x,i.center[1]=r.y,i.rotation=e.rotation,i.scale=e.scale,i.spatialReference=r.spatialReference,this._update()}}clone(){return new AQ({padding:this.padding.clone(),size:this.size.slice(),viewpoint:this.paddedViewState.viewpoint.clone(),pixelRatio:this.pixelRatio})}};u([d()],QC.prototype,"paddedViewState",void 0),u([d({type:U0})],QC.prototype,"padding",null),u([d()],QC.prototype,"viewpoint",null),QC=AQ=u([$("esri.views.2d.PaddedViewState")],QC);const bpt=QC;let wpt=class{constructor(e,i){this.item=e,this.controller=i,this.promise=null}},g$e=class{constructor(e){this._deferreds=new Map,this._controllers=new Map,this._processingItems=new Map,this._isPaused=!1,this._schedule=null,this._task=null,this.concurrency=1,e.concurrency&&(this.concurrency=e.concurrency),this._queue=new dV(e.peeker),this.process=e.process;const i=e.scheduler;e.priority&&v(i)&&(this._task=i.registerTask(e.priority,this))}destroy(){this.clear(),this._schedule&&(this._schedule.remove(),this._schedule=null),this._task&&(this._task.remove(),this._task=null)}get length(){return this._processingItems.size+this._queue.length}abort(e){const i=this._controllers.get(e);i&&i.abort()}clear(){this._queue.clear();const e=[];this._controllers.forEach(i=>e.push(i)),this._controllers.clear(),e.forEach(i=>i.abort()),this._processingItems.clear(),this._cancelNext()}forEach(e){this._deferreds.forEach((i,r)=>e(r))}get(e){const i=this._deferreds.get(e);return i?i.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._isPaused||(this._isPaused=!0,this._cancelNext())}push(e,i){const r=this.get(e);if(r)return r;const n=new AbortController;let s=null;i&&(s=ja(i,()=>n.abort()));const o=()=>{const h=this._processingItems.get(e);h&&h.controller.abort(),a(),c.reject(Bi())},a=()=>{l.remove(),v(s)&&s.remove(),this._deferreds.delete(e),this._controllers.delete(e),this._queue.remove(e),this._processingItems.delete(e),this._scheduleNext()},l=P9(n.signal,o),c=S_();return this._deferreds.set(e,c),this._controllers.set(e,n),c.promise.then(a,a),this._queue.push(e),this._scheduleNext(),c.promise}last(){return this._queue.last()}peek(){return this._queue.peek()}popLast(){return this._queue.popLast()}reset(){const e=[];this._processingItems.forEach(i=>e.push(i)),this._processingItems.clear();for(const i of e)this._queue.push(i.item),i.controller.abort();this._scheduleNext()}resume(){this._isPaused&&(this._isPaused=!1,this._scheduleNext())}takeAll(){const e=[];for(;this._queue.length;)e.push(this._queue.pop());return this.clear(),e}get running(){return!this._isPaused&&this._queue.length>0&&this._processingItems.size<this.concurrency}runTask(e){for(;!e.done&&this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),e.madeProgress()}_scheduleNext(){this._task||this._isPaused||this._schedule||(this._schedule=V2(()=>{this._schedule=null,this._next()}))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(e,i){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(i))}_processError(e,i){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(i))}_canProcessFulfillment(e){return!!this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e}_process(e){if(R(e))return;let i;const r=new AbortController,n=new wpt(e,r);this._processingItems.set(e,n);try{i=this.process(e,r.signal)}catch(s){this._processError(n,s)}ih(i)?(n.promise=i,i.then(s=>this._processResult(n,s),s=>this._processError(n,s))):this._processResult(n,i)}get test(){return{update:e=>this.runTask(e)}}};function xpt(t,e){return t.length=0,e.forEach(i=>t.push(i)),t}const lH=new Set,T4=[],hE=new Map,pge=[0,0];let bv=class extends ve{constructor(e){super(e),this._keyToItem=new Map,this.concurrency=6,this.strategy="scale-first",this.tileInfoView=null}initialize(){const{concurrency:e,process:i}=this;this._queue=new g$e({concurrency:e,process:(r,n)=>{const s=this._keyToItem.get(r);return i(s,{signal:n})},peeker:r=>r.values().next().value})}destroy(){this.clear(),this._queue=Ve(this._queue)}get length(){return this._queue?this._queue.length:0}get onGoingCount(){return this._keyToItem.size}get updating(){return this.length>0||this.onGoingCount>0}abort(e){const i=typeof e=="string"?e:e.id;this._queue.abort(i)}clear(){this._queue.clear(),this._keyToItem.clear(),this.notifyChange("updating")}has(e){return typeof e=="string"?this._keyToItem.has(e):this._keyToItem.has(e.id)}isOngoing(e){const i=typeof e=="string"?e:e.id;return this.has(i)&&this._queue.isOngoing(i)}pause(){this._queue.pause()}push(e,i){const r=e.key.id+"-"+i;if(this.has(r))return this.get(r);const n=this._queue.push(r),s=()=>{this._keyToItem.delete(r),this.notifyChange("updating")};return this._keyToItem.set(r,e),n.then(s,s),this.notifyChange("updating"),n}reset(){this._queue.reset(),this.notifyChange("updating")}resume(){this._queue.resume()}_peekByScaleFirst(e){if(!this.state)return e.values().next().value;const i=this.tileInfoView;let r=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY;e.forEach(h=>{const p=this._keyToItem.get(h),f=this.tileInfoView.getTileScale(p.key);hE.has(f)||(hE.set(f,[]),r=Math.max(f,r),n=Math.min(f,n)),hE.get(f).push(p.key),lH.add(f)});let s=this.state.scale;hE.has(s)||(xpt(T4,lH),T4.sort((h,p)=>h-p),s=T4.reduce((h,p)=>Math.abs(p-s)<Math.abs(h-s)?p:h,T4[0])),s=Math.min(s,r),s=Math.max(s,n);const o=hE.get(s),a=i.getClosestInfoForScale(s),l=a.getColumnForX(this.state.center[0]),c=a.getRowForY(this.state.center[1]);return o.sort((h,p)=>{const f=a.denormalizeCol(h.col,h.world),m=a.denormalizeCol(p.col,p.world);return Math.sqrt((l-f)*(l-f)+(c-h.row)*(c-h.row))-Math.sqrt((l-m)*(l-m)+(c-p.row)*(c-p.row))}),lH.clear(),hE.clear(),o[0].id}_peekByCenterFirst(e){if(!this.state)return e.values().next().value;const i=this.tileInfoView,r=this.state.center;let n,s=Number.POSITIVE_INFINITY;return e.forEach(o=>{const a=this._keyToItem.get(o);i.getTileCoords(pge,a.key);const l=gy(pge,r);l<s&&(s=l,n=a.key)}),n.id}};u([d({constructOnly:!0})],bv.prototype,"concurrency",void 0),u([d({constructOnly:!0})],bv.prototype,"process",void 0),u([d()],bv.prototype,"state",void 0),u([d({constructOnly:!0})],bv.prototype,"strategy",void 0),u([d({constructOnly:!0})],bv.prototype,"tileInfoView",void 0),u([d({readOnly:!0})],bv.prototype,"updating",null),bv=u([$("esri.views.2d.tiling.PagedTileQueue")],bv);let fw=class bT{static getId(e,i,r,n){return typeof e=="object"?`${e.level}/${e.row}/${e.col}/${e.world}`:`${e}/${i}/${r}/${n}`}constructor(e,i,r,n){this.set(e,i,r,n)}get key(){return this}get id(){return this.toString()}set id(e){this.set(e)}get hash(){const e=4095&this.row,i=4095&this.col,r=63&this.level;return(3&this.world)<<30|i<<22|e<<8|r}acquire(e,i,r,n){this.set(e,i,r,n)}contains(e){const i=e.level-this.level;return i>=0&&this.row===e.row>>i&&this.col===e.col>>i&&this.world===e.world}equals(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}clone(){return new bT(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(e,i,r,n){if(e==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof e=="object")this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if(typeof e=="string"){const[s,o,a,l]=e.split("/");this.level=parseFloat(s),this.row=parseFloat(o),this.col=parseFloat(a),this.world=parseFloat(l)}else this.level=+e,this.row=+i,this.col=+r,this.world=+n||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new bT(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){const e=this.level+1,i=this.row<<1,r=this.col<<1,n=this.world;return[new bT(e,i,r,n),new bT(e,i,r+1,n),new bT(e,i+1,r,n),new bT(e,i+1,r+1,n)]}compareRowMajor(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}};fw.pool=new zo(fw,null,null,25,50);function wv(t,e){return[t,e]}function ex(t,e,i){return t[0]=e,t[1]=i,t}function Tpt(t,e,i,r,n){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t}const Kp=new fw("0/0/0/0");let Spt=class y$e{static create(e,i,r=null){const n=bp(e.spatialReference),s=i.origin||wv(e.origin.x,e.origin.y),o=wv(e.size[0]*i.resolution,e.size[1]*i.resolution),a=wv(-1/0,-1/0),l=wv(1/0,1/0),c=wv(1/0,1/0);v(r)&&(ex(a,Math.max(0,Math.floor((r.xmin-s[0])/o[0])),Math.max(0,Math.floor((s[1]-r.ymax)/o[1]))),ex(l,Math.max(0,Math.floor((r.xmax-s[0])/o[0])),Math.max(0,Math.floor((s[1]-r.ymin)/o[1]))),ex(c,l[0]-a[0]+1,l[1]-a[1]+1));const{cols:h,rows:p}=i;let f,m,g,_;return!r&&h&&p&&(ex(a,h[0],p[0]),ex(l,h[1],p[1]),ex(c,h[1]-h[0]+1,p[1]-p[0]+1)),e.isWrappable?(f=wv(Math.ceil(Math.round((n.valid[1]-n.valid[0])/i.resolution)/e.size[0]),c[1]),m=wv(Math.floor((n.origin[0]-s[0])/o[0]),a[1]),g=wv(f[0]+m[0]-1,l[1]),_=!0):(m=a,g=l,f=c,_=!1),new y$e(i.level,i.resolution,i.scale,s,a,l,c,o,m,g,f,_)}constructor(e,i,r,n,s,o,a,l,c,h,p,f){this.level=e,this.resolution=i,this.scale=r,this.origin=n,this.first=s,this.last=o,this.size=a,this.norm=l,this.worldStart=c,this.worldEnd=h,this.worldSize=p,this.wrap=f}normalizeCol(e){if(!this.wrap)return e;const i=this.worldSize[0];return e<0?i-1-Math.abs((e+1)%i):e%i}denormalizeCol(e,i){return this.wrap?this.worldSize[0]*i+e:e}getWorldForColumn(e){return this.wrap?Math.floor(e/this.worldSize[0]):0}getFirstColumnForWorld(e){return e*this.worldSize[0]+this.first[0]}getLastColumnForWorld(e){return e*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(e){return(e-this.origin[0])/this.norm[0]}getXForColumn(e){return this.origin[0]+e*this.norm[0]}getRowForY(e){return(this.origin[1]-e)/this.norm[1]}getYForRow(e){return this.origin[1]-e*this.norm[1]}getTileBounds(e,i,r=!1){Kp.set(i);const n=r?Kp.col:this.denormalizeCol(Kp.col,Kp.world),s=Kp.row;return Tpt(e,this.getXForColumn(n),this.getYForRow(s+1),this.getXForColumn(n+1),this.getYForRow(s)),e}getTileCoords(e,i,r=!1){Kp.set(i);const n=r?Kp.col:this.denormalizeCol(Kp.col,Kp.world);return Array.isArray(e)?ex(e,this.getXForColumn(n),this.getYForRow(Kp.row)):(e.x=this.getXForColumn(n),e.y=this.getYForRow(Kp.row)),e}},GM=class{constructor(){this.spans=[]}acquire(e){this.lodInfo=e}release(){this.lodInfo=null,this.spans.length=0}forEach(e,i){const{spans:r,lodInfo:n}=this,{level:s}=n;if(r.length!==0)for(const{row:o,colFrom:a,colTo:l}of r)for(let c=a;c<=l;c++)e.call(i,s,o,n.normalizeCol(c),n.getWorldForColumn(c))}};GM.pool=new zo(GM);let cH=class{constructor(e,i,r){this.row=e,this.colFrom=i,this.colTo=r}};const is=new fw("0/0/0/0");let Ept=class _$e{static create(e,i){e[1]>i[1]&&([e,i]=[i,e]);const[r,n]=e,[s,o]=i,a=s-r,l=o-n,c=l!==0?a/l:0,h=(Math.ceil(n)-n)*c,p=(Math.floor(n)-n)*c;return new _$e(r,Math.floor(n),Math.ceil(o),c,a<0?h:p,a<0?p:h,a<0?s:r,a<0?r:s)}constructor(e,i,r,n,s,o,a,l){this.x=e,this.ymin=i,this.ymax=r,this.invM=n,this.leftAdjust=s,this.rightAdjust=o,this.leftBound=a,this.rightBound=l}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+this.rightAdjust,this.rightBound)}};const ch=[[0,0],[0,0],[0,0],[0,0]],Cpt=1e-6;let Apt=class{constructor(e,i=null){this.tileInfo=e,this.fullExtent=i,this.scales=[],this._infoByScale={},this._infoByLevel={};const r=e.lods.slice();r.sort((s,o)=>o.scale-s.scale);const n=this._lodInfos=r.map(s=>Spt.create(e,s,i));r.forEach((s,o)=>{this._infoByLevel[s.level]=n[o],this._infoByScale[s.scale]=n[o],this.scales[o]=s.scale},this),this._wrap=e.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(e){return this._infoByLevel[typeof e=="number"?e:e.level]}getTileBounds(e,i,r=!1){is.set(i);const n=this._infoByLevel[is.level];return n?n.getTileBounds(e,is,r):e}getTileCoords(e,i,r=!1){is.set(i);const n=this._infoByLevel[is.level];return n?n.getTileCoords(e,is,r):e}getTileCoverage(e,i=192,r="closest"){const n=r==="closest"?this.getClosestInfoForScale(e.scale):this.getSmallestInfoForScale(e.scale),s=GM.pool.acquire(n),o=this._wrap;let a,l,c,h=1/0,p=-1/0;const f=s.spans;ch[0][0]=ch[0][1]=ch[1][1]=ch[3][0]=-i,ch[1][0]=ch[2][0]=e.size[0]+i,ch[2][1]=ch[3][1]=e.size[1]+i;for(const b of ch)e.toMap(b,b),b[0]=n.getColumnForX(b[0]),b[1]=n.getRowForY(b[1]);const m=[];let g=3;for(let b=0;b<4;b++){if(ch[b][1]===ch[g][1]){g=b;continue}const w=Ept.create(ch[b],ch[g]);h=Math.min(w.ymin,h),p=Math.max(w.ymax,p),m[w.ymin]===void 0&&(m[w.ymin]=[]),m[w.ymin].push(w),g=b}if(h==null||p==null||p-h>100)return null;let _=[];for(a=h;a<p;){m[a]!=null&&(_=_.concat(m[a])),l=1/0,c=-1/0;for(let b=_.length-1;b>=0;b--){const w=_[b];l=Math.min(l,w.getLeftCol()),c=Math.max(c,w.getRightCol())}if(l=Math.floor(l),c=Math.floor(c),a>=n.first[1]&&a<=n.last[1])if(o)if(n.size[0]<n.worldSize[0]){const b=Math.floor(c/n.worldSize[0]);for(let w=Math.floor(l/n.worldSize[0]);w<=b;w++)f.push(new cH(a,Math.max(n.getFirstColumnForWorld(w),l),Math.min(n.getLastColumnForWorld(w),c)))}else f.push(new cH(a,l,c));else l>n.last[0]||c<n.first[0]||(l=Math.max(l,n.first[0]),c=Math.min(c,n.last[0]),f.push(new cH(a,l,c)));a+=1;for(let b=_.length-1;b>=0;b--){const w=_[b];w.ymax>=a?w.incrRow():_.splice(b,1)}}return s}getTileParentId(e){is.set(e);const i=this._infoByLevel[is.level],r=this._lodInfos.indexOf(i)-1;return r<0?null:(this._getTileIdAtLOD(is,this._lodInfos[r],is),is.id)}getTileResolution(e){const i=this._infoByLevel[typeof e=="object"?e.level:e];return i?i.resolution:-1}getTileScale(e){const i=this._infoByLevel[e.level];return i?i.scale:-1}intersects(e,i){is.set(i);const r=this._infoByLevel[is.level],n=e.lodInfo;if(n.resolution>r.resolution){this._getTileIdAtLOD(is,n,is);const o=n.denormalizeCol(is.col,is.world);for(const a of e.spans)if(a.row===is.row&&a.colFrom<=o&&a.colTo>=o)return!0}if(n.resolution<r.resolution){const[o,a,l,c]=e.spans.reduce((_,b)=>(_[0]=Math.min(_[0],b.row),_[1]=Math.max(_[1],b.row),_[2]=Math.min(_[2],b.colFrom),_[3]=Math.max(_[3],b.colTo),_),[1/0,-1/0,1/0,-1/0]),h=r.denormalizeCol(is.col,is.world),p=n.getColumnForX(r.getXForColumn(h)),f=n.getRowForY(r.getYForRow(is.row)),m=n.getColumnForX(r.getXForColumn(h+1))-1,g=n.getRowForY(r.getYForRow(is.row+1))-1;return!(p>c||m<l||f>a||g<o)}const s=n.denormalizeCol(is.col,is.world);return e.spans.some(o=>o.row===is.row&&o.colFrom<=s&&o.colTo>=s)}normalizeBounds(e,i,r){if(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],this._wrap){const n=bp(this.tileInfo.spatialReference),s=-r*(n.valid[1]-n.valid[0]);e[0]+=s,e[2]+=s}return e}getSmallestInfoForScale(e){const i=this.scales;if(this._infoByScale[e])return this._infoByScale[e];if(e>i[0])return this._infoByScale[i[0]];for(let r=1;r<i.length-1;r++)if(e>i[r]+Cpt)return this._infoByScale[i[r-1]];return this._infoByScale[i[i.length-1]]}getClosestInfoForScale(e){const i=this.scales;return this._infoByScale[e]||(e=i.reduce((r,n)=>Math.abs(n-e)<Math.abs(r-e)?n:r,i[0])),this._infoByScale[e]}scaleToLevel(e){const i=this.scales;if(this._infoByScale[e])return this._infoByScale[e].level;for(let r=i.length-1;r>=0;r--)if(e<i[r])return r===i.length-1?this._infoByScale[i[i.length-1]].level:this._infoByScale[i[r]].level+(i[r]-e)/(i[r]-i[r+1]);return this._infoByScale[i[0]].level}scaleToZoom(e){return this.tileInfo.scaleToZoom(e)}_getTileIdAtLOD(e,i,r){const n=this._infoByLevel[r.level];return e.set(r),i.resolution<n.resolution?null:(i.resolution===n.resolution||(e.level=i.level,e.col=Math.floor(r.col*n.resolution/i.resolution+.01),e.row=Math.floor(r.row*n.resolution/i.resolution+.01)),e)}};function Rpt(t,e){return t.length=0,e.forEach(i=>t.push(i)),t}const uH=new Set,S4=[],dE=new Map,fge=[0,0];let v0=class extends ve{constructor(e){super(e),this._keyToItem=new Map,this.concurrency=6,this.strategy="scale-first",this.tileInfoView=null}initialize(){const{concurrency:e,process:i,strategy:r}=this;this._queue=new g$e({concurrency:e,process:(n,s)=>{const o=this._keyToItem.get(n);return i(o,{signal:s})},peeker:r==="scale-first"?n=>this._peekByScaleFirst(n):n=>this._peekByCenterFirst(n)})}destroy(){this.clear(),this._queue=Ve(this._queue)}get length(){return this._queue?this._queue.length:0}get onGoingCount(){return this._keyToItem.size}get updating(){return this.length>0||this.onGoingCount>0}abort(e){const i=typeof e=="string"?e:e.id;this._queue.abort(i)}clear(){this._queue.clear(),this._keyToItem.clear(),this.notifyChange("updating")}has(e){return typeof e=="string"?this._keyToItem.has(e):this._keyToItem.has(e.id)}isOngoing(e){const i=typeof e=="string"?e:e.id;return this.has(i)&&this._queue.isOngoing(i)}pause(){this._queue.pause()}push(e){const i=e.key.id;if(this._queue.has(i))return this._queue.get(i);const r=this._queue.push(i),n=()=>{this._keyToItem.delete(i),this.notifyChange("updating")};return this._keyToItem.set(i,e),r.then(n,n),this.notifyChange("updating"),r}reset(){this._queue.reset()}resume(){this._queue.resume()}_peekByScaleFirst(e){if(!this.state)return e.values().next().value;const i=this.tileInfoView;let r=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY;e.forEach(h=>{const p=this._keyToItem.get(h),f=this.tileInfoView.getTileScale(p.key);dE.has(f)||(dE.set(f,[]),r=Math.max(f,r),n=Math.min(f,n)),dE.get(f).push(p.key),uH.add(f)});let s=this.state.scale;dE.has(s)||(Rpt(S4,uH),S4.sort((h,p)=>h-p),s=S4.reduce((h,p)=>Math.abs(p-s)<Math.abs(h-s)?p:h,S4[0])),s=Math.min(s,r),s=Math.max(s,n);const o=dE.get(s),a=i.getClosestInfoForScale(s),l=a.getColumnForX(this.state.center[0]),c=a.getRowForY(this.state.center[1]);return o.sort((h,p)=>{const f=a.denormalizeCol(h.col,h.world),m=a.denormalizeCol(p.col,p.world);return Math.sqrt((l-f)*(l-f)+(c-h.row)*(c-h.row))-Math.sqrt((l-m)*(l-m)+(c-p.row)*(c-p.row))}),uH.clear(),dE.clear(),o[0].id}_peekByCenterFirst(e){if(!this.state)return e.values().next().value;const i=this.tileInfoView,r=this.state.center;let n,s=Number.POSITIVE_INFINITY;return e.forEach(o=>{const a=this._keyToItem.get(o);i.getTileCoords(fge,a.key);const l=gy(fge,r);l<s&&(s=l,n=a.key)}),n.id}};u([d({constructOnly:!0})],v0.prototype,"concurrency",void 0),u([d({constructOnly:!0})],v0.prototype,"process",void 0),u([d()],v0.prototype,"state",void 0),u([d({constructOnly:!0})],v0.prototype,"strategy",void 0),u([d({constructOnly:!0})],v0.prototype,"tileInfoView",void 0),u([d({readOnly:!0})],v0.prototype,"updating",null),v0=u([$("esri.views.2d.tiling.TileQueue")],v0);const xjt=v0;let Mpt=class{constructor(e,i,r){this.maxSize=e,this._tileInfoView=i,this._removedFunc=r,this._tilePerId=new Map,this._tileKeysPerLevel=[]}has(e){return this._tilePerId.has(e)}get(e){return this._tilePerId.get(e)}pop(e){const i=this._tilePerId.get(e);if(!i)return;const r=i.key.level,n=this._tileKeysPerLevel[r];mge(this._tilePerId,e);for(let s=0;s<n.length;s++)if(n[s].id===e){n.splice(s,1);break}return i.visible=!0,i}add(e){e.visible=!1;const i=e.key,r=i.id;if(this._tilePerId.has(r))return;this._tilePerId.set(r,e);const n=i.level;this._tileKeysPerLevel[n]||(this._tileKeysPerLevel[n]=[]),this._tileKeysPerLevel[n].push(i)}prune(e,i,r){let n=this._tilePerId.size;if(n<=this.maxSize)return;let s=this._tileKeysPerLevel.length-1;for(;n>this.maxSize&&s>=0;)s!==e&&(n=this._pruneAroundCenterTile(n,i,r,s)),s--;n>this.maxSize&&(n=this._pruneAroundCenterTile(n,i,r,e))}_pruneAroundCenterTile(e,i,r,n){const s=this._tileKeysPerLevel[n];if(!s||s.length===0)return e;const{size:o,origin:a}=this._tileInfoView.tileInfo,l=r*o[0],c=r*o[1],h=[0,0],p=[0,0];for(s.sort((f,m)=>(h[0]=a.x+l*(f.col+.5),h[1]=a.y-c*(f.row+.5),p[0]=a.x+l*(m.col+.5),p[1]=a.y-c*(m.row+.5),BM(h,i)-BM(p,i)));s.length>0;){const f=s.pop();if(this._removeTile(f.id),--e===this.maxSize)break}return e}_removeTile(e){const i=this._tilePerId.get(e);this._removedFunc&&i&&this._removedFunc(i),mge(this._tilePerId,e)}};function mge(t,e){t.delete(e)}const tx=new fw(0,0,0,0),vd=new Map,pE=[],E4=[];let Sjt=class{constructor(e){this._previousScale=Number.POSITIVE_INFINITY,this.cachePolicy="keep",this.coveragePolicy="closest",this.resampling=!0,this.tileIndex=new Map,this.tiles=[],this.buffer=192,this.acquireTile=e.acquireTile,this.releaseTile=e.releaseTile,this.tileInfoView=e.tileInfoView,this.resampling=e.resampling==null||!!e.resampling,e.cachePolicy&&(this.cachePolicy=e.cachePolicy),e.coveragePolicy&&(this.coveragePolicy=e.coveragePolicy),e.buffer!=null&&(this.buffer=e.buffer),e.cacheSize&&(this._tileCache=new Mpt(e.cacheSize,this.tileInfoView,i=>{this.releaseTile(i)}))}destroy(){this.tileIndex.clear()}update(e){const{resampling:i,tileIndex:r}=this,n=this.tileInfoView.getTileCoverage(e.state,this.buffer,this.coveragePolicy);if(E4.length=0,pE.length=0,vd.clear(),!n)return;const{minScale:s,maxScale:o}=this.tileInfoView.tileInfo,{spans:a,lodInfo:l}=n,{level:c}=l,{scale:h,center:p,resolution:f}=e.state,m=!e.stationary&&h>this._previousScale;if(this._previousScale=h,this.tiles.length=0,!i&&(h>s||h<o))return this.tiles.length=0,vd.clear(),r.forEach(w=>{this.releaseTile(w)}),r.clear(),E4.length=0,pE.length=0,vd.clear(),GM.pool.release(n),!0;r.forEach(w=>w.visible=!0);let g=0,_=0;if(a.length>0)for(const{row:w,colFrom:x,colTo:T}of a)for(let E=x;E<=T;E++){g++;const C=tx.set(c,w,l.normalizeCol(E),l.getWorldForColumn(E)).id;if(r.has(C)){const A=r.get(C);A.isReady?(vd.set(C,A),_++):m||this._addParentTile(C,vd)}else{let A;if(this._tileCache&&this._tileCache.has(C)){if(A=this._tileCache.pop(C),this.tileIndex.set(C,A),A.isReady){vd.set(C,A),_++;continue}}else A=this.acquireTile(tx),this.tileIndex.set(C,A);m||this._addParentTile(C,vd)}}const b=_===g;r.forEach((w,x)=>{if(tx.set(x),vd.has(x))return;const T=this.tileInfoView.intersects(n,tx),E=this.cachePolicy==="purge"?tx.level!==c:tx.level>c;!T||!m&&b?!E&&T||pE.push(x):w.isReady?E&&this.cachePolicy==="purge"&&this._hasReadyAncestor(tx,c)?pE.push(x):E4.push(x):E&&pE.push(x)});for(const w of E4){const x=r.get(w);x&&x.isReady&&vd.set(w,x)}for(const w of pE){const x=r.get(w);this._tileCache?this._tileCache.add(x):this.releaseTile(x),r.delete(w)}return vd.forEach(w=>this.tiles.push(w)),r.forEach(w=>{vd.has(w.key.id)||(w.visible=!1)}),this._tileCache&&this._tileCache.prune(c,p,f),GM.pool.release(n),vd.clear(),b}clear(e=!0){const{tileIndex:i}=this;e&&i.forEach(r=>{this.releaseTile(r)}),i.clear()}updateCacheSize(e){this._tileCache&&(this._tileCache.maxSize=e)}_addParentTile(e,i){let r=e,n=null;for(;r=this.tileInfoView.getTileParentId(r),r;)if(this.tileIndex.has(r)){if(n=this.tileIndex.get(r),n&&n.isReady){i.has(n.key.id)||i.set(n.key.id,n);break}}else if(this._tileCache&&this._tileCache.has(r)&&(n=this._tileCache.pop(r),this.tileIndex.set(r,n),n&&n.isReady)){i.has(n.key.id)||i.set(n.key.id,n);break}}_hasReadyAncestor(e,i){const r=Kt();this.tileInfoView.getTileBounds(r,e,!0);for(const n of this.tileIndex.values())if(n.isReady&&n.key.level>=i&&n.key.level<e.level){const s=Kt();if(this.tileInfoView.getTileBounds(s,n.key,!0),mZ(s,r))return!0}return!1}};function UB(t,e){switch(e){case"primary":return t.pointerType==="touch"||t.button===0;case"secondary":return t.pointerType!=="touch"&&t.button===2;case"tertiary":return t.pointerType!=="touch"&&t.button===1}}function Koe(t,e){if(t.pointerType==="touch")return!1;switch(e){case"primary":return t.button===0;case"secondary":return t.button===2;case"tertiary":return t.button===1}}let gge=class extends an{constructor(e,i){super(!0),this._view=e,this.registerIncoming("double-click",i,r=>this._handleDoubleClick(r,i))}_handleDoubleClick(e,i){UB(e.data,"primary")&&(e.stopPropagation(),i?this._view.mapViewNavigation.zoomOut([e.data.x,e.data.y]):this._view.mapViewNavigation.zoomIn([e.data.x,e.data.y]))}},Opt=class extends an{constructor(e,i,r){super(!0),this.view=e,this.pointerType=i,this.registerIncoming("double-tap-drag",r,n=>this._handleDoubleTapDrag(n))}_handleDoubleTapDrag(e){const{data:i}=e,{pointerType:r}=i;if(r!==this.pointerType)return;e.stopPropagation();const{action:n,delta:s}=i,{view:o}=this,{mapViewNavigation:a}=o;switch(n){case"begin":{const{scale:l}=o;this._startScale=l,this._currentScale=l,this._previousDelta=s,a.begin();break}case"update":{if(this._previousDelta.y===s.y)return;this._previousDelta=s;const l=1.015**s.y,c=this._startScale*l,h=c/this._currentScale;a.setViewpointImmediate(h),this._currentScale=c;break}case"end":{const{constraints:l}=o,{effectiveLODs:c,snapToZoom:h}=l;if(!h||!c)return void a.end();const p=l.snapScale(this._currentScale),f=(s.y>0?Math.max(p,l.snapToPreviousScale(this._startScale)):Math.min(p,l.snapToNextScale(this._startScale)))/this._currentScale;a.zoom(f);break}}}},jN=class{constructor(e){this._callbacks=e,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(e){const i=e.data,r=i.pointers.size;switch(i.action){case"start":this._currentCount=r,this._emitStart(e);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(e);break;case"end":this._emitEnd(e),this._currentCount=0}this._previousEvent=e}_emitStart(e){var i,r;this._startEvent=e,(r=(i=this._callbacks).condition)!=null&&r.call(i,this._currentCount,e)&&this._callbacks.start(this._currentCount,e,this._startEvent)}_emitUpdate(e){var i,r;(r=(i=this._callbacks).condition)!=null&&r.call(i,this._currentCount,e)&&this._callbacks.update(this._currentCount,e,this._startEvent)}_emitEnd(e){var i,r;(r=(i=this._callbacks).condition)!=null&&r.call(i,this._currentCount,e)&&this._callbacks.end(this._currentCount,e,this._startEvent),this._startEvent=null}},Ppt=class extends an{constructor(e,i,r){super(!0),this.view=e,this.pointerAction=i,this.registerIncoming("drag",r,n=>this._handleDrag(n)),this.registerIncoming("pointer-down",()=>this.stopMomentumNavigation())}onInstall(e){super.onInstall(e),this._dragEventSeparator=new jN({start:(i,r)=>{this.view.mapViewNavigation.pan.begin(this.view,r.data),r.stopPropagation()},update:(i,r)=>{this.view.mapViewNavigation.pan.update(this.view,r.data),r.stopPropagation()},end:(i,r)=>{this.view.mapViewNavigation.pan.end(this.view,r.data),r.stopPropagation()},condition:(i,r)=>i===1&&UB(r.data,this.pointerAction)})}_handleDrag(e){const i=this.view.mapViewNavigation;i.pinch.zoomMomentum||i.pinch.rotateMomentum?this.stopMomentumNavigation():this._dragEventSeparator.handle(e)}stopMomentumNavigation(){this.view.mapViewNavigation.pan.stopMomentumNavigation()}},Ipt=class extends an{constructor(e,i,r){super(!0),this._view=e,this.pointerAction=i;const n=this._view.mapViewNavigation;this._dragEventSeparator=new jN({start:(s,o)=>{n.rotate.begin(this._view,o.data),o.stopPropagation()},update:(s,o)=>{n.rotate.update(this._view,o.data),o.stopPropagation()},end:(s,o)=>{n.rotate.end(),o.stopPropagation()},condition:(s,o)=>s===1&&UB(o.data,this.pointerAction)}),this.registerIncoming("drag",r,s=>this._dragEventSeparator.handle(s))}};function Qp(t){let e=t*t;return t<0&&(e*=-1),e}function $pt(t){return t.translation[0]=0,t.translation[1]=0,t.translation[2]=0,t.heading=0,t.tilt=0,t}function RQ(t,e,i){const r=i,n=t.state,s=t.device,o=e.tiltDirection==="forward-down"?1:-1,a=1;return s.deviceType==="standard"?(r.translation[0]=Qp(n.axes[0]),r.translation[1]=Qp(n.axes[1]),r.translation[2]=Qp(n.buttons[7])-Qp(n.buttons[6]),r.heading=Qp(n.axes[2]),r.tilt=Qp(n.axes[3])):s.deviceType==="spacemouse"&&(r.translation[0]=1.2*Qp(n.axes[0]),r.translation[1]=1.2*Qp(n.axes[1]),r.translation[2]=2*-Qp(n.axes[2]),r.heading=1.2*Qp(n.axes[5]),r.tilt=1.2*Qp(n.axes[3])),r.tilt*=o,le(r.translation,r.translation,a),r}function yge(t,e){const i=e;return i.translation[0]=t[1]-t[0],i.translation[1]=t[3]-t[2],i.translation[2]=t[4]-t[5],i.heading=t[7]-t[6],i.tilt=t[8]-t[9],i.zoom=t[10]-t[11],i}function pU(t){return t.translation[0]===0&&t.translation[1]===0&&t.translation[2]===0&&t.heading===0&&t.tilt===0&&t.zoom===0}let Lpt=class extends an{constructor(e){super(!0),this._view=e,this._frameTask=null,this._watchHandles=new Xi,this._currentDevice=null,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._handle=this.registerIncoming("gamepad",i=>this._handleGamePadEvent(i)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([ne(()=>{var i;return(i=this._view.navigation.gamepad)==null?void 0:i.enabled},i=>{i?(this._handle.resume(),this._frameTask||(this._frameTask=E_({update:r=>this._frameUpdate(r.deltaTime)}))):(this._handle.pause(),this._frameTask&&(this._frameTask.remove(),this._frameTask=null))},zt)])}onUninstall(){this._watchHandles.removeAll(),this._frameTask&&(this._frameTask.remove(),this._frameTask=null),super.onUninstall()}_handleGamePadEvent(e){const i=this._view.navigation.gamepad.device;i&&e.data.device!==i||this._currentDevice&&this._currentDevice!==e.data.device||(e.data.action==="end"?(this._currentDevice=null,$pt(this._transformation)):(this._currentDevice=e.data.device,RQ(e.data,this._view.navigation.gamepad,this._transformation)))}_frameUpdate(e){const i=this._transformation;if(pU(i))return;const r=this._view.viewpoint.clone(),n=this._view.navigation.gamepad.velocityFactor,s=Npt*n*e;kB(r,r,[i.translation[0]*s,-i.translation[1]*s]);const o=1+i.translation[2]*Fpt*e,a=this._view.constraints.rotationEnabled?-i.heading*Dpt*e:0,l=this._view.size,c=[l[0]/2,l[1]];t$e(r,r,o,a,c,l);const h=this._view.constraints.constrain(r,this._view.viewpoint);this._view.viewpoint=h}};const Dpt=.06,Npt=.7,Fpt=6e-4;let kpt=class extends an{constructor(e,i,r){super(!0),this.view=e,this.keys=i,this._pressed=!1,this._keyMap={[i.left]:"left",[i.right]:"right",[i.up]:"up",[i.down]:"down"},this.registerIncoming("key-down",r,n=>this._handleKeyDown(n)),this.registerIncoming("key-up",r,n=>this._handleKeyUp(n)),this.registerIncoming("blur",r,()=>this._handleBlur())}_handleKeyDown(e){e.data.repeat||this._handleKey(e,!0)}_handleKeyUp(e){this._handleKey(e,!1)}_handleBlur(){this._pressed&&(this._pressed=!1,this.view.mapViewNavigation.stop())}_handleKey(e,i){const r=this._keyMap[e.data.key];if(this._pressed=r!=null,this._pressed){if(i)switch(this.view.mapViewNavigation.begin(),r){case"left":this.view.mapViewNavigation.continousPanLeft();break;case"right":this.view.mapViewNavigation.continousPanRight();break;case"up":this.view.mapViewNavigation.continousPanUp();break;case"down":this.view.mapViewNavigation.continousPanDown()}else this._pressed=!1,this.view.mapViewNavigation.stop();e.stopPropagation()}}},Upt=class extends an{constructor(e,i,r){super(!0),this.view=e,this.keys=i,this._pressed=!1,this._keyToDirection={[i.clockwiseOption1]:"clockwise",[i.clockwiseOption2]:"clockwise",[i.counterClockwiseOption1]:"counterClockwise",[i.counterClockwiseOption2]:"counterClockwise",[i.resetOption1]:"reset",[i.resetOption2]:"reset"},this.registerIncoming("key-down",r,n=>this._handleKeyDown(n)),this.registerIncoming("key-up",r,n=>this._handleKeyUp(n)),this.registerIncoming("blur",r,()=>this._handleBlur())}_handleKeyDown(e){e.data.repeat||this._handleKey(e,!0)}_handleKeyUp(e){this._handleKey(e,!1)}_handleBlur(){this._pressed&&(this._pressed=!1,this.view.mapViewNavigation.stop())}_handleKey(e,i){const r=e.modifiers;if(r.size>0&&!r.has("Shift")||!this.view.constraints.rotationEnabled)return;const n=this._keyToDirection[e.data.key];if(this._pressed=n!=null,this._pressed){if(i)switch(this.view.mapViewNavigation.begin(),n){case"clockwise":this.view.mapViewNavigation.continousRotateClockwise();break;case"counterClockwise":this.view.mapViewNavigation.continousRotateCounterclockwise();break;case"reset":this.view.mapViewNavigation.resetRotation()}else this._pressed=!1,this.view.mapViewNavigation.stop();e.stopPropagation()}}};var sR;(function(t){t[t.IN=0]="IN",t[t.OUT=1]="OUT"})(sR||(sR={}));let Vpt=class extends an{constructor(e,i,r){super(!0),this.view=e,this.keys=i,this._keysToZoomAction={},this.registerIncoming("key-down",r,n=>this._handleKeyDown(n)),i.zoomIn.forEach(n=>this._keysToZoomAction[n]=sR.IN),i.zoomOut.forEach(n=>this._keysToZoomAction[n]=sR.OUT)}_handleKeyDown(e){this._handleKey(e)}_handleKey(e){const i=e.modifiers;if(i.size>0&&!i.has("Shift"))return;const{key:r}=e.data;if(!(r in this._keysToZoomAction))return;const n=this._keysToZoomAction[r],{mapViewNavigation:s}=this.view;let o=null;switch(n){case sR.IN:o=s.zoomIn();break;case sR.OUT:o=s.zoomOut();break;default:return}s.begin(),o.then(()=>s.end()),e.stopPropagation()}};const zpt=.6;let Bpt=class extends an{constructor(e,i){super(!0),this._view=e,this._canZoom=!0,this.registerIncoming("mouse-wheel",i,r=>this._handleMouseWheel(r))}_handleMouseWheel(e){if(!this._view.navigation.mouseWheelZoomEnabled||(e.preventDefault(),e.stopPropagation(),!this._canZoom))return;const i=this._view.mapViewNavigation,{x:r,y:n,deltaY:s}=e.data,o=1/zpt**(1/60*s),a=i.zoom(o,[r,n]);a&&(this._canZoom=!1,a.catch(()=>{}).then(()=>{this._canZoom=!0,i.end()}))}},jpt=class extends an{constructor(e){super(!0),this.view=e,this.registerIncoming("drag",r=>this._handleDrag(r)),this.registerIncoming("pointer-down",()=>this._stopMomentumNavigation());const i=this.view.mapViewNavigation;this._dragEventSeparator=new jN({start:(r,n)=>{i.pinch.begin(this.view,n.data),n.stopPropagation()},update:(r,n)=>{i.pinch.update(this.view,n.data),n.stopPropagation()},end:(r,n)=>{i.pinch.end(this.view),n.stopPropagation()},condition:r=>r>=2})}_handleDrag(e){this._dragEventSeparator.handle(e)}_stopMomentumNavigation(){this.view.mapViewNavigation.pinch.stopMomentumNavigation()}};function _ge(t){const e=t.native;return e?{buttons:e.buttons.map(i=>i.pressed?i.value?i.value:1:0),axes:e.axes.map(i=>qpt(i,t.axisThreshold))}:{buttons:[],axes:[]}}function Gpt(t,e){if(t.axes.length!==e.axes.length||t.buttons.length!==e.buttons.length)return!1;for(let i=0;i<t.axes.length;i++)if(t.axes[i]!==e.axes[i])return!1;for(let i=0;i<t.buttons.length;i++)if(t.buttons[i]!==e.buttons[i])return!1;return!0}function Hpt(t){for(let e=0;e<t.axes.length;e++)if(t.axes[e]!==0)return!1;for(let e=0;e<t.buttons.length;e++)if(t.buttons[e]!==0)return!1;return!0}function qpt(t,e){const i=Math.abs(t);return i<e?0:Math.sign(t)*(i-e)/(1-e)}let Wpt=class{constructor(e,i){this._element=e,this._input=i,this._hasEventListeners=!1,this._onConnectGamepad=s=>{this._connectGamepad(s.gamepad)},this._onDisconnectGamepad=s=>{const o=s.gamepad,a=o.index,l=this._inputDevices[a];l&&(this._emitGamepadEvent(o,_ge(l),!1),this._inputDevices.splice(a,1),this._latestUpdate.splice(a,1),this._input.gamepad.devices.remove(l),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const r="getGamepads"in window.navigator,n=window.isSecureContext;this.supported=r&&n,this.supported&&(this._forEachGamepad(s=>this._connectGamepad(s)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const i=new koe(e);i.deviceType!=="unknown"&&(this._inputDevices[e.index]=i,this._input.gamepad.devices.add(i)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=E_({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),i=this._element.contains(document.activeElement),r=this._input.gamepad.enabledFocusMode==="document"&&!e||this._input.gamepad.enabledFocusMode==="view"&&!i;this._forEachGamepad(n=>{const s=this._inputDevices[n.index];if(!s)return;const o=this._latestUpdate[n.index],a=_ge(s),l=r||Hpt(a);o&&(o.timestamp===n.timestamp||!o.active&&l||Gpt(o.state,a))||this._emitGamepadEvent(n,a,!l)})}_forEachGamepad(e){const i=window.navigator.getGamepads();for(let r=0;r<i.length;r++){const n=i[r];this._validate(n)&&e(n)}}_emitGamepadEvent(e,i,r){const n=this._latestUpdate[e.index],s=n&&n.active;if(!s&&!r)return;const o=!s&&r?"start":s&&r?"update":"end";this._latestUpdate[e.index]={timestamp:e.timestamp,state:i,active:r},this._callback&&this._callback({device:this._inputDevices[e.index],state:i,action:o})}_validate(e){if(!e||!e.connected)return!1;for(let i=0;i<e.axes.length;i++)if(isNaN(e.axes[i]))return!1;return!0}};const vge=ue("edge"),Xpt=ue("chrome"),Ypt=ue("ff"),Zpt=ue("safari"),bge="esri-view-surface",fE={touchNone:`${bge}--touch-none`,touchPan:`${bge}--touch-pan`};let Qoe=class v$e{constructor(e,i){this._input=i,this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new Wpt(e,this._input),this._gamepadSource.onEvent=r=>this._callback("gamepad",r)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(e=>{this._releasePointerCaptureSafe(e)}),this._gamepadSource=Ve(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const i in this._active)if(!e||!e.has(i)){const r=this._active[i];this._element.removeEventListener(hH[i],r),delete this._active[i]}e&&e.forEach(i=>{if(!this._active[i]&&hH[i]){const r=(this._eventHandlers[i]||this._handleDefault).bind(this,i);this._element.addEventListener(hH[i],r),this._active[i]=r}}),this._gamepadSource.hasEventListeners=(e==null?void 0:e.has("gamepad"))??!1}setPointerCapture(e,i){i?(this._element.setPointerCapture(e.pointerId),this._activePointerCaptures.add(e.pointerId)):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?fE.touchNone:fE.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?fE.touchPan:fE.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(fE.touchNone),this._element.classList.remove(fE.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch{}}_updateNormalizedPointerLikeEvent(e,i){const r=CIe(this._element,e);return v$e.test.disableSubpixelCoordinates&&(r.x=Math.round(r.x),r.y=Math.round(r.y)),i.x=r.x,i.y=r.y,i}_handleKey(e,i){const r=But(i);r&&e==="key-up"&&this._keyDownState.delete(r);const n={native:i,key:r,repeat:!!r&&this._keyDownState.has(r)};r&&e==="key-down"&&this._keyDownState.add(n.key),this._callback(e,n)}_handlePointer(e,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});this._callback(e,r)}_handlePointerPreventDefault(e,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});i.preventDefault(),this._callback(e,r)}_handleMouseWheel(e,i){let r=i.deltaY;switch(i.deltaMode){case 0:vge&&(r=r/document.documentElement.clientHeight*600);break;case 1:r*=30;break;case 2:r*=900}vge?r*=.7:Xpt||Zpt?r*=.6:Ypt&&(r*=1.375);const n=100,s=Math.abs(r);s>n&&(r=r/s*200/(1+Math.exp(-.02*(s-n))));const o=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,deltaY:r});this._callback(e,o)}_handlePointerCaptureLost(e,i){this._activePointerCaptures.delete(i.pointerId),this._handleDefault(e,i)}_handleDefault(e,i){const r={native:i};i.preventDefault(),this._callback(e,r)}_preventAltKeyDefault(e){e.key==="Alt"&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}};Qoe.test={disableSubpixelCoordinates:!1};const hH={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};let b$e=class extends an{constructor(){super(!0),this.registerIncoming("context-menu",e=>{e.data.native.preventDefault()})}};function eae(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}function Jpt(t,e){const i=e.x-t.x,r=e.y-t.y;return Math.sqrt(i*i+r*r)}function Kpt(t,e){if(e?(e.radius=0,e.center.x=0,e.center.y=0):e={radius:0,center:Ws()},t.length===0)return e;if(t.length===1)return e.center.x=t[0].x,e.center.y=t[0].y,e;if(t.length===2){const[T,E]=t,[C,A]=[E.x-T.x,E.y-T.y];return e.radius=Math.sqrt(C*C+A*A)/2,e.center.x=(T.x+E.x)/2,e.center.y=(T.y+E.y)/2,e}let i=0,r=0;for(let T=0;T<t.length;T++)i+=t[T].x,r+=t[T].y;i/=t.length,r/=t.length;const n=t.map(T=>T.x-i),s=t.map(T=>T.y-r);let o=0,a=0,l=0,c=0,h=0,p=0,f=0;for(let T=0;T<n.length;T++){const E=n[T],C=s[T],A=E*E,I=C*C;o+=A,a+=I,l+=E*C,c+=A*E,h+=I*C,p+=E*I,f+=C*A}const m=.5*(c+p),g=.5*(h+f),_=o*a-l*l,b=(m*a-g*l)/_,w=(o*g-l*m)/_,x=Ws(b+i,w+r);return{radius:Math.sqrt(b*b+w*w+(o+a)/t.length),center:x}}function kS(t){const{native:e}=t,{pointerId:i,button:r,pointerType:n}=e;return n==="mouse"?`${i}:${r}`:`${n}`}const yp={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};let w$e=class extends an{constructor(e=yp.maximumDoubleClickDelay,i=yp.maximumDoubleClickDistance,r=yp.maximumDoubleTouchDelay,n=yp.maximumDoubleTouchDistance,s=pN){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=n,this._clock=s,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach(e=>e.doubleClickTimer=Nr(e.doubleClickTimer))}get hasPendingInputs(){return pa(this._pointerState,e=>e.doubleClickTimer!=null)}_clearDoubleClickTimer(e,i){const r=this._pointerState.get(e);r&&(r.doubleClickTimer=Nr(r.doubleClickTimer),i&&this._click.emit(r.event.data,void 0,r.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const i=this._pointerState.get(e);i.pointerDownCount===1&&this._click.emit(i.event.data,void 0,i.event.modifiers),i.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_getPointerId(e){const{pointerId:i,pointerType:r,button:n}=e.native;return r==="mouse"?`${i}:${n}`:`${r}`}_handleImmediateClick(e){const i=e.data,{pointerType:r}=i.native,n=this._getPointerId(i);if(!this._pointerState.has(n))return void this._startClick(e);const s=this._pointerState.get(n),{data:o,modifiers:a}=s.event,l=r==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;eae(o,i)>l?(this._clearDoubleClickTimer(n,!0),this._startClick(e)):(this._clearDoubleClickTimer(n,!1),s.pointerDownCount===2&&this._doubleClick.emit(o,void 0,a))}_handlePointerDown(e){const i=kS(e.data),r=this._pointerState.get(i);r&&(r.pointerDownCount+=1)}_startClick(e){const{data:i}=e,{native:{pointerType:r}}=i,n=kS(i),s=r==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(n),s),a=1;this._pointerState.set(n,{event:e,doubleClickTimer:o,pointerDownCount:a}),this.refreshHasPendingInputs()}},Qpt=class extends an{constructor(e=yp.maximumDoubleClickDelay,i=yp.maximumDoubleClickDistance,r=yp.maximumDoubleTouchDelay,n=yp.maximumDoubleTouchDistance,s=pN){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=n,this._clock=s,this._doubleTapDragReady=!1,this._doubleTapDragActive=!1,this._dragStartCenter=Ws(0,0),this._pointerState=new Map,this._doubleTapDrag=this.registerOutgoing("double-tap-drag"),this._dragEventSeparator=new jN({start:(o,a)=>this._dragStart(o,a),update:(o,a)=>this._dragUpdate(a),end:(o,a)=>this._dragEnd(a)}),this.registerIncoming("drag",o=>this._dragEventSeparator.handle(o)),this.registerIncoming("pointer-down",o=>this._handlePointerDown(o)),this.registerIncoming("pointer-up",()=>this._handlePointerUp())}onUninstall(){this._pointerState.forEach(e=>{e.doubleTapTimeout=Nr(e.doubleTapTimeout)})}get hasPendingInputs(){return pa(this._pointerState,e=>e.doubleTapTimeout!=null)}_clearPointerDown(e){const i=this._pointerState.get(e);i&&(i.doubleTapTimeout=Nr(i.doubleTapTimeout),this._pointerState.delete(e),this.refreshHasPendingInputs())}_createDoubleTapDragData(e,i,r){const{button:n,buttons:s,pointer:o,pointers:a,pointerType:l,timestamp:c}=r;return{action:e,delta:i,button:n,buttons:s,pointer:o,pointers:a,pointerType:l,timestamp:c}}_dragStart(e,i){if(!this._doubleTapDragReady||e!==1)return;this._doubleTapDragReady=!1,this._doubleTapDragActive=!0;const{data:r,modifiers:n}=i,{center:s}=r;this._dragStartCenter=s;const o=this._createDoubleTapDragData("begin",Ws(0,0),r);this._doubleTapDrag.emit(o,void 0,n),i.stopPropagation()}_dragUpdate(e){if(!this._doubleTapDragActive)return;const{data:i,modifiers:r}=e,{center:n}=i,s=Ws(n.x-this._dragStartCenter.x,n.y-this._dragStartCenter.y),o=this._createDoubleTapDragData("update",s,i);this._doubleTapDrag.emit(o,void 0,r),e.stopPropagation()}_dragEnd(e){if(!this._doubleTapDragActive)return;const{data:i,modifiers:r}=e,{center:n}=i,s=Ws(n.x-this._dragStartCenter.x,n.y-this._dragStartCenter.y),o=this._createDoubleTapDragData("end",s,i);this._doubleTapDrag.emit(o,void 0,r),this._doubleTapDragActive=!1,e.stopPropagation()}_handlePointerDown(e){const{data:i}=e,r=kS(i),n=this._pointerState.get(r),{pointerType:s}=i.native;if(n){const o=s==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;this._clearPointerDown(r),eae(n.event.data,i)>o?this._storePointerDown(e):this._doubleTapDragReady=!0}else this._storePointerDown(e)}_handlePointerUp(){this._doubleTapDragReady=!1}_storePointerDown(e){const{data:i}=e,{pointerType:r}=i.native,n=kS(i),s=r==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._clearPointerDown(n),s);this._pointerState.set(n,{event:e,doubleTapTimeout:o}),this.refreshHasPendingInputs()}},x$e=class extends an{constructor(e){super(!1),this._navigationTouch=e,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(e,i,r,n){return{action:e,pointerType:this._pointerType,button:this._mouseButton,buttons:i.buttons,timestamp:n,pointers:eft(this._activePointerMap),pointer:i,angle:r.angle,radius:r.radius,center:r.center}}_addPointer(e){const i=e.native.pointerId,r=C4(this._activePointerMap).angle,n={event:e,initialAngle:0,lastAngle:0};this._activePointerMap.set(i,n);const s=fU(n,T$e(this._activePointerMap));n.initialAngle=s,n.lastAngle=s,this._updatePointerAngles(r)}_updatePointer(e){if(e&&e.x==null&&e.y==null)return;const i=e.native.pointerId,r=this._activePointerMap.get(i);r?r.event=e:this._addPointer(e)}_removePointer(e){const i=C4(this._activePointerMap).angle;this._activePointerMap.delete(e),this._updatePointerAngles(i)}_updatePointerAngles(e){const i=C4(this._activePointerMap);this._activePointerMap.forEach(r=>{r.initialAngle=fU(r,i)-e,r.lastAngle=fU(r,i)-e})}_emitEvent(e,i,r){const n=C4(this._activePointerMap);this._drag.emit(this._createPayload(e,i,n,r),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(e){const i=e.data.native.pointerId,r=e.timestamp;this._activePointerMap.get(i)&&(this._activePointerMap.size===1?(this._updatePointer(e.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",e.data,r),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(i)):(this._removePointer(i),this._emitEvent("removed",e.data,e.timestamp)))}_handlePointerDrag(e){const i=e.data,r=i.currentEvent,n=e.timestamp;switch(i.action){case"start":case"update":this._isDragging?this._activePointerMap.has(r.native.pointerId)?(this._updatePointer(r),!this._isCurrentDragSuppressed&&this._emitEvent("update",r,n)):(this._addPointer(r),this._emitEvent("added",r,n),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(r),this._pointerType=e.data.startEvent.pointerType,this._mouseButton=e.data.startEvent.button,this._startStateModifiers=e.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",r,n))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function T$e(t){const e=[];return t.forEach(i=>{e.push(Ws(i.event.x,i.event.y))}),Kpt(e)}function C4(t){const e=T$e(t);let i=0;return t.forEach(r=>{let n=fU(r,e),s=n-r.lastAngle;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;n=r.lastAngle+s,r.lastAngle=n;const o=n-r.initialAngle;i+=o}),i/=t.size||1,{angle:i,radius:e.radius,center:e.center}}function eft(t){const e=new Map;return t.forEach((i,r)=>e.set(r,i.event)),e}function fU(t,e){const i=t.event,r=i.x-e.center.x,n=i.y-e.center.y;return Math.atan2(n,r)}var wge;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right",t[t.Back=3]="Back",t[t.Forward=4]="Forward",t[t.Undefined=-1]="Undefined"})(wge||(wge={}));let S$e=class extends an{constructor(e=yp.maximumDoubleClickDelay,i=yp.maximumDoubleClickDistance,r=yp.maximumDoubleTouchDelay,n=yp.maximumDoubleTouchDistance,s=pN){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=n,this._clock=s,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(e){const i=e.data,r=kS(i);if(!this._pointerState.has(r)){const n={downButton:i.native.button,immediateDoubleClick:null};this._pointerState.set(r,n),this.startCapturingPointer(i.native)}}_handlePointerUp(e){const i=e.data,r=kS(i),n=this._pointerState.get(r);if(n&&n.downButton===i.native.button){const s=n.immediateDoubleClick;if(s){s.timeoutHandle.remove();const o=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;eae(s,e.data)>o?this._startImmediateDoubleClick(e,n):(this._immediateDoubleClick.emit(e.data,void 0,s.modifiers),this._removeState(i))}else this._startImmediateDoubleClick(e,n)}}_startImmediateDoubleClick(e,i){const r=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;i.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(e.data),r)}}_removeState(e){const i=kS(e);this._pointerState.delete(i),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}};const M3={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};let E$e=class extends an{constructor(e=M3.maximumClickDelay,i=M3.movementUntilMouseDrag,r=M3.movementUntilPenDrag,n=M3.movementUntilTouchDrag,s=M3.holdDelay,o=pN){super(!1),this._maximumClickDelay=e,this._movementUntilMouseDrag=i,this._movementUntilPenDrag=r,this._movementUntilTouchDrag=n,this._holdDelay=s,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",a=>{this._handlePointerLoss(a,"pointer-up")}),this.registerIncoming("pointer-capture-lost",a=>{this._handlePointerLoss(a,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",a=>{this._handlePointerLoss(a,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(e=>{e.holdTimeout=Nr(e.holdTimeout)}),super.onUninstall()}_handlePointerDown(e){const i=e.data,r=i.native.pointerId;let n=null;this._pointerState.size===0&&(n=this._clock.setTimeout(()=>{const o=this._pointerState.get(r);if(o){if(!o.isDragging){const a=o.previousEvent;this._pointerHold.emit(a,void 0,e.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this._holdDelay));const s={startEvent:i,previousEvent:i,startTimestamp:e.timestamp,isDragging:!1,downButton:i.native.button,holdTimeout:n,modifiers:new Set};this._pointerState.set(r,s),this.startCapturingPointer(i.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}_createPointerDragData(e,i,r){return{action:e,startEvent:i.startEvent,previousEvent:i.previousEvent,currentEvent:r}}_handlePointerMove(e){const i=e.data,r=i.native.pointerId,n=this._pointerState.get(r);n&&(n.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",n,i),void 0,n.modifiers):Jpt(i,n.startEvent)>this._getDragThreshold(i.native.pointerType)&&this._startDragging(e),n.previousEvent=i)}_getDragThreshold(e){switch(e){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(e){const i=e.data,r=i.native.pointerId;this._pointerState.forEach(n=>{n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging||(n.modifiers=e.modifiers,n.isDragging=!0,r===n.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",n,i)):this._pointerDrag.emit(this._createPointerDragData("start",n,n.previousEvent),e.timestamp))})}_handlePointerLoss(e,i){const r=e.data,n=r.native.pointerId,s=this._pointerState.get(n);s&&(s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",s,i==="pointer-up"?r:s.previousEvent),void 0,s.modifiers):i==="pointer-up"&&s.downButton===r.native.button&&e.timestamp-s.startTimestamp<=this._maximumClickDelay&&!s.holdEmitted&&this._immediateClick.emit(r),this._pointerState.delete(n),this.stopCapturingPointer(r.native),this._pointerState.size===0&&this._moveHandle.pause())}};const A4={counter:"Ctrl",pan:{left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown"},zoom:{zoomIn:["=","+"],zoomOut:["-","_"]},rotate:{clockwiseOption1:"a",clockwiseOption2:"A",counterClockwiseOption1:"d",counterClockwiseOption2:"D",resetOption1:"n",resetOption2:"N"}};let wT=class extends ve{constructor(){super(...arguments),this._handles=new Xi}initialize(){const e=()=>{var i;return(i=this.view)==null?void 0:i.ready};this._handles.add([yo(()=>!e(),()=>this._disconnect()),yo(e,()=>this._connect())])}destroy(){this._handles=Ve(this._handles),this._disconnect()}get latestPointerType(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerType}get latestPointerLocation(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerLocation}get multiTouchActive(){var e;return((e=this._inputManager)==null?void 0:e.multiTouchActive)??!1}_disconnect(){this.view.viewEvents.disconnect(),this._inputManager=Ve(this._inputManager)}_connect(){const e=this.view.surface,i=new Qoe(e,this.view.input),r=[new S$e,new E$e,new w$e,new x$e(this.view.navigation),new Qpt],n=new Of({eventSource:i,recognizers:r});n.installHandlers("prevent-context-menu",[new b$e],ey.INTERNAL),n.installHandlers("navigation",[new jpt(this.view),new Lpt(this.view),new Bpt(this.view),new gge(this.view),new gge(this.view,[A4.counter]),new Ppt(this.view,"primary"),new kpt(this.view,A4.pan),new Vpt(this.view,A4.zoom),new Upt(this.view,A4.rotate),new Ipt(this.view,"secondary"),new Opt(this.view,"touch")],ey.INTERNAL),this.view.viewEvents.connect(n),this._source=i,this._inputManager=n,ne(()=>{var s,o;return(o=(s=this.view)==null?void 0:s.navigation)==null?void 0:o.browserTouchPanEnabled},s=>{this._source&&(this._source.browserTouchPanningEnabled=!s)},zt)}get test(){return{inputManager:this._inputManager}}};u([d()],wT.prototype,"view",void 0),u([d()],wT.prototype,"latestPointerType",null),u([d()],wT.prototype,"latestPointerLocation",null),u([d()],wT.prototype,"multiTouchActive",null),wT=u([$("esri.views.2d.input.MapViewInputManager")],wT);const tft=wT;var xge,Tge,Sge,MQ={},ift={get exports(){return MQ},set exports(t){MQ=t}};xge=ift,Tge=function(){function t(n,s,o,a,l){e(n,s,o||0,a||n.length-1,l||r)}function e(n,s,o,a,l){for(;a>o;){if(a-o>600){var c=a-o+1,h=s-o+1,p=Math.log(c),f=.5*Math.exp(2*p/3),m=.5*Math.sqrt(p*f*(c-f)/c)*(h-c/2<0?-1:1);e(n,s,Math.max(o,Math.floor(s-h*f/c+m)),Math.min(a,Math.floor(s+(c-h)*f/c+m)),l)}var g=n[s],_=o,b=a;for(i(n,o,s),l(n[a],g)>0&&i(n,o,a);_<b;){for(i(n,_,b),_++,b--;l(n[_],g)<0;)_++;for(;l(n[b],g)>0;)b--}l(n[o],g)===0?i(n,o,b):i(n,++b,a),b<=s&&(o=b+1),s<=b&&(a=b-1)}}function i(n,s,o){var a=n[s];n[s]=n[o],n[o]=a}function r(n,s){return n<s?-1:n>s?1:0}return t},(Sge=Tge())!==void 0&&(xge.exports=Sge);const C$e=MQ;function ZV(t,e){if(!(this instanceof ZV))return new ZV(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&(typeof e=="function"?this.toBBox=e:this._initFormat(e)),this.clear()}function rft(t,e,i){if(!i)return e.indexOf(t);for(var r=0;r<e.length;r++)if(i(t,e[r]))return r;return-1}function mE(t,e){vI(t,0,t.children.length,e,t)}function vI(t,e,i,r,n){n||(n=eA(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(var s,o=e;o<i;o++)s=t.children[o],bI(n,t.leaf?r(s):s);return n}function bI(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function Ege(t,e){return t.minX-e.minX}function Cge(t,e){return t.minY-e.minY}function dH(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function R4(t){return t.maxX-t.minX+(t.maxY-t.minY)}function nft(t,e){return(Math.max(e.maxX,t.maxX)-Math.min(e.minX,t.minX))*(Math.max(e.maxY,t.maxY)-Math.min(e.minY,t.minY))}function sft(t,e){var i=Math.max(t.minX,e.minX),r=Math.max(t.minY,e.minY),n=Math.min(t.maxX,e.maxX),s=Math.min(t.maxY,e.maxY);return Math.max(0,n-i)*Math.max(0,s-r)}function pH(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function M4(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function eA(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Age(t,e,i,r,n){for(var s,o=[e,i];o.length;)(i=o.pop())-(e=o.pop())<=r||(s=e+Math.ceil((i-e)/r/2)*r,C$e(t,s,e,i,n),o.push(e,s,s,i))}ZV.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,i=[],r=this.toBBox;if(!M4(t,e))return i;for(var n,s,o,a,l=[];e;){for(n=0,s=e.children.length;n<s;n++)o=e.children[n],M4(t,a=e.leaf?r(o):o)&&(e.leaf?i.push(o):pH(t,a)?this._all(o,i):l.push(o));e=l.pop()}return i},collides:function(t){var e=this.data,i=this.toBBox;if(!M4(t,e))return!1;for(var r,n,s,o,a=[];e;){for(r=0,n=e.children.length;r<n;r++)if(s=e.children[r],M4(t,o=e.leaf?i(s):s)){if(e.leaf||pH(t,o))return!0;a.push(s)}e=a.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,i=t.length;e<i;e++)this.insert(t[e]);return this}var r=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var n=this.data;this.data=r,r=n}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=eA([]),this},remove:function(t,e){if(!t)return this;for(var i,r,n,s,o=this.data,a=this.toBBox(t),l=[],c=[];o||l.length;){if(o||(o=l.pop(),r=l[l.length-1],i=c.pop(),s=!0),o.leaf&&(n=rft(t,o.children,e))!==-1)return o.children.splice(n,1),l.push(o),this._condense(l),this;s||o.leaf||!pH(o,a)?r?(i++,o=r.children[i],s=!1):o=null:(l.push(o),c.push(i),i=0,r=o,o=o.children[0])}return this},toBBox:function(t){return t},compareMinX:Ege,compareMinY:Cge,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var i=[];t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},_build:function(t,e,i,r){var n,s=i-e+1,o=this._maxEntries;if(s<=o)return mE(n=eA(t.slice(e,i+1)),this.toBBox),n;r||(r=Math.ceil(Math.log(s)/Math.log(o)),o=Math.ceil(s/Math.pow(o,r-1))),(n=eA([])).leaf=!1,n.height=r;var a,l,c,h,p=Math.ceil(s/o),f=p*Math.ceil(Math.sqrt(o));for(Age(t,e,i,f,this.compareMinX),a=e;a<=i;a+=f)for(Age(t,a,c=Math.min(a+f-1,i),p,this.compareMinY),l=a;l<=c;l+=p)h=Math.min(l+p-1,c),n.children.push(this._build(t,l,h,r-1));return mE(n,this.toBBox),n},_chooseSubtree:function(t,e,i,r){for(var n,s,o,a,l,c,h,p;r.push(e),!e.leaf&&r.length-1!==i;){for(h=p=1/0,n=0,s=e.children.length;n<s;n++)l=dH(o=e.children[n]),(c=nft(t,o)-l)<p?(p=c,h=l<h?l:h,a=o):c===p&&l<h&&(h=l,a=o);e=a||e.children[0]}return e},_insert:function(t,e,i){var r=this.toBBox,n=i?t:r(t),s=[],o=this._chooseSubtree(n,this.data,e,s);for(o.children.push(t),bI(o,n);e>=0&&s[e].children.length>this._maxEntries;)this._split(s,e),e--;this._adjustParentBBoxes(n,s,e)},_split:function(t,e){var i=t[e],r=i.children.length,n=this._minEntries;this._chooseSplitAxis(i,n,r);var s=this._chooseSplitIndex(i,n,r),o=eA(i.children.splice(s,i.children.length-s));o.height=i.height,o.leaf=i.leaf,mE(i,this.toBBox),mE(o,this.toBBox),e?t[e-1].children.push(o):this._splitRoot(i,o)},_splitRoot:function(t,e){this.data=eA([t,e]),this.data.height=t.height+1,this.data.leaf=!1,mE(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,i){var r,n,s,o,a,l,c,h;for(l=c=1/0,r=e;r<=i-e;r++)o=sft(n=vI(t,0,r,this.toBBox),s=vI(t,r,i,this.toBBox)),a=dH(n)+dH(s),o<l?(l=o,h=r,c=a<c?a:c):o===l&&a<c&&(c=a,h=r);return h},_chooseSplitAxis:function(t,e,i){var r=t.leaf?this.compareMinX:Ege,n=t.leaf?this.compareMinY:Cge;this._allDistMargin(t,e,i,r)<this._allDistMargin(t,e,i,n)&&t.children.sort(r)},_allDistMargin:function(t,e,i,r){t.children.sort(r);var n,s,o=this.toBBox,a=vI(t,0,e,o),l=vI(t,i-e,i,o),c=R4(a)+R4(l);for(n=e;n<i-e;n++)s=t.children[n],bI(a,t.leaf?o(s):s),c+=R4(a);for(n=i-e-1;n>=e;n--)s=t.children[n],bI(l,t.leaf?o(s):s),c+=R4(l);return c},_adjustParentBBoxes:function(t,e,i){for(var r=i;r>=0;r--)bI(e[r],t)},_condense:function(t){for(var e,i=t.length-1;i>=0;i--)t[i].children.length===0?i>0?(e=t[i-1].children).splice(e.indexOf(t[i]),1):this.clear():mE(t[i],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}};let Rge=class A$e{constructor(e,i){this.key=new fw(0,0,0,0),this.bounds=Kt(),this.objectIds=new Set,this.key.set(i);const r=e.getLODInfoAt(this.key);this.tileInfoView=e,this.tileInfoView.getTileBounds(this.bounds,this.key,!0),this.resolution=r.resolution,this.scale=r.scale,this.level=r.level}get id(){return this.key.id}get extent(){return ni.fromBounds(this.bounds,this.tileInfoView.tileInfo.spatialReference)}get transform(){return{originPosition:"upperLeft",scale:[this.resolution,this.resolution],translate:[this.bounds[0],this.bounds[3]]}}createChildTiles(){const e=this.key.getChildKeys(),i=Vc.acquire();for(let r=0;r<e.length;r++)i[r]=new A$e(this.tileInfoView,e[r]);return i}getQuantizationParameters(){return mOe.fromJSON({mode:"view",originPosition:"upperLeft",tolerance:this.resolution,extent:{xmin:this.bounds[0],ymin:this.bounds[1],xmax:this.bounds[2],ymax:this.bounds[3],spatialReference:this.tileInfoView.tileInfo.spatialReference}})}};const ix={added:[],removed:[]},fH=new Set,oft=new fw(0,0,0,0);let aft=class extends An{constructor(e){super(),this._tiles=new Map,this._index=ZV(9,ue("esri-csp-restrictions")?i=>({minX:i.bounds[0],minY:i.bounds[1],maxX:i.bounds[2],maxY:i.bounds[3]}):[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]),this.tiles=[],this.tileScheme=e}destroy(){this.clear()}clear(){this.tiles.length=0,this._tiles.clear(),this._index.clear()}has(e){return this._tiles.has(e)}get(e){return this._tiles.get(e)}boundsIntersections(e){return this._index.search({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]})}updateTiles(e){const i={added:[],removed:[]};for(const r of e.added)if(!this.has(r)){const n=new Rge(this.tileScheme,r);this._tiles.set(r,n),this._index.insert(n),i.added.push(n)}for(const r of e.removed)if(this.has(r)){const n=this.get(r);this._tiles.delete(r),this._index.remove(n),i.removed.push(n)}this.tiles.length=0,this._tiles.forEach(r=>this.tiles.push(r)),(i.added.length||i.removed.length)&&this.emit("update",i)}setViewState(e){const i=this.tileScheme.getTileCoverage(e,0);if(!i)return;const{spans:r,lodInfo:n}=i,{level:s}=n;if(r.length>0)for(const{row:o,colFrom:a,colTo:l}of r)for(let c=a;c<=l;c++){const h=oft.set(s,o,n.normalizeCol(c),n.getWorldForColumn(c)).id;if(fH.add(h),!this.has(h)){const p=new Rge(this.tileScheme,h);this._tiles.set(h,p),this._index.insert(p),this.tiles.push(p),ix.added.push(p)}}for(let o=this.tiles.length-1;o>=0;o--){const a=this.tiles[o];fH.has(a.id)||(this._tiles.delete(a.id),this.tiles.splice(o,1),this._index.remove(a),ix.removed.push(a))}(ix.added.length||ix.removed.length)&&this.emit("update",ix),GM.pool.release(i),fH.clear(),ix.added.length=0,ix.removed.length=0}},xT=class extends ve{constructor(){super(...arguments),this.color=new Xe([0,255,255]),this.haloOpacity=1,this.fillOpacity=.25}equals(e){return this.color.equals(e.color)&&(this.haloColor||this.color).equals(e.haloColor||e.color)&&this.haloOpacity===e.haloOpacity&&this.fillOpacity===e.fillOpacity}};u([d({type:Xe})],xT.prototype,"color",void 0),u([d({type:Xe})],xT.prototype,"haloColor",void 0),u([d()],xT.prototype,"haloOpacity",void 0),u([d()],xT.prototype,"fillOpacity",void 0),xT=u([$("esri.views.2d.support.HighlightOptions")],xT);const R$e=xT,lft=t=>t.includes("Brush");let M$e=class{constructor(){this._names=new Map}begin(e){this._names.has(e)||(this._names.set(e,!1),lft(e)&&this.record("Esri.FirstDraw"),performance.mark(`Esri.${e}.Start`))}end(e){this._names.has(e)&&!this._names.get(e)&&(this._names.set(e,!0),performance.mark(`Esri.${e}.End`))}record(e){this._names.has(e)||(this._names.set(e,!0),performance.mark(`Esri.${e}`))}};function cft(t,e,i,r,n,s,o,a){t.ignorePadding&&(r={left:0,right:0,top:0,bottom:0});let l=null;t.width!=null&&t.height!=null?l=[t.width,t.height]:t.width==null&&t.height!=null?l=[t.height,t.height]:t.width!=null&&t.height==null?l=[t.width,t.width]:t.width==null&&t.height==null&&(l=null);const c=i[0]-(r.left+r.right),h=i[1]-(r.top+r.bottom);let p,f,m=t.area||{x:0,y:0,width:c,height:h};if(l){const g=c/h,_=l[0]/l[1];if(_>g){const b=m.width/_;m={x:m.x,y:Math.round(m.y+(m.height-b)/2),width:m.width,height:Math.round(b)}}else{const b=m.height*_;m={x:Math.round(m.x+(m.width-b)/2),y:m.y,width:Math.round(b),height:m.height}}}else l=[m.width,m.height];return l[0]>m.width?(p=Math.min(l[0]/m.width,e),f=l[0]/m.width/p):(p=1,f=l[0]/m.width),{resolutionScale:p,cropArea:{x:Math.round((m.x+r.left)*p),y:Math.round((m.y+r.top)*p),width:Math.round(m.width*p),height:Math.round(m.height*p)},outputScale:f,format:n,quality:s,children:o,rotation:a}}let O3=null,JV=!0;function mH(t,e,i){if(!t||!e)throw new Error("Cannot construct image data without dimensions");if(JV)try{return new ImageData(t,e)}catch{JV=!1}return O$e(t,e,i)}function uft(t,e,i,r){if(!e||!i)throw new Error("Cannot construct image data without dimensions");if(JV)try{return new ImageData(t,e,i)}catch{JV=!1}const n=O$e(e,i,r);return n.data.set(t,0),n}function hft(){return O3||(O3=document.createElement("canvas"),O3.width=1,O3.height=1),O3}function O$e(t,e,i){return i||(i=hft()),i.getContext("2d").createImageData(t,e)}const Mge=2048,dft=1.5,pft=8;function fft(t,e){const{format:i,quality:r,rotation:n,disableDecorations:s}=t||{},o=tae(t,e.padding),a=Tft(t,{width:e.width-o.left-o.right,height:e.height-o.top-o.bottom}),{width:l,height:c}=xft(t,a),h=$$e(i),p=L$e[h];return{format:h,quality:_e(r??p,0,100),area:a,width:l,height:c,rotation:n,disableDecorations:!!s,ignoreBackground:!(!t||!t.ignoreBackground),ignorePadding:!(!t||!t.ignorePadding)}}function mft(t,e){const i=fft(t,e),r=i.area,n=i.width/r.width,s=tae(i,e.padding),o=s.left+s.right,a=s.top+s.bottom,l=e.width-o,c=e.height-a,h=Math.floor(l*n+o),p=Math.floor(c*n+a),f=t&&t.layers?t.layers:[],m=i.ignoreBackground,g=i.ignorePadding;return{framebufferWidth:h,framebufferHeight:p,region:{x:Math.floor(r.x*n)+s.left,y:Math.floor(r.y*n)+s.top,width:i.width,height:i.height},format:i.format,quality:i.quality,rotation:i.rotation,pixelRatio:n,layers:f,disableDecorations:i.disableDecorations,ignoreBackground:m,ignorePadding:g,objectAndLayerIdColor:!1}}function mU(t,e,i){const{ctx:r,canvas:n}=P$e(t,i),s=r.getImageData(0,0,t.width,t.height),o=yft(n,e);return I$e(n),{dataUrl:o,data:s}}function gU(t,e){const{ctx:i,canvas:r}=P$e(t,e),n=i.getImageData(0,0,t.width,t.height);return I$e(r),n}function P$e(t,e){const i=gft();e.premultipliedAlpha&&Aft(t),i.width=t.width,i.height=t.height;const r=i.getContext("2d",{willReadFrequently:!0});return r.putImageData(t,0,0),e.flipY&&Cft(r),{ctx:r,canvas:i}}function I$e(t){t.width=0,t.height=0}function gft(){return R(gH)&&(gH=document.createElement("canvas")),gH}let gH=null;function yft(t,e){const i=Rft[e.format],r=e.quality/100;return t.toDataURL(i,r)}function _ft(t,e){const i=$$e(t),r=L$e[i];return{format:i,quality:_e(e??r,0,100)}}function vft(t,e){return e/Math.max(t[0],t[1])}function bft(t,e,i,r=0,n=0,s=t.width-r,o=t.height-n,a=!1){const{data:l}=t,{width:c,height:h,data:p}=e,f=s/c,m=o/h,g=Math.ceil(f/2),_=Math.ceil(m/2),b=t.width;for(let w=0;w<h;w++)for(let x=0;x<c;x++){const T=4*(x+(a?h-w-1:w)*c);let E=0,C=0,A=0,I=0,O=0,D=0;const U=(w+.5)*m;for(let V=Math.floor(w*m);V<(w+1)*m;V++){const B=Math.abs(U-(V+.5))/_,ee=(x+.5)*f,ie=B*B;for(let J=Math.floor(x*f);J<(x+1)*f;J++){const q=Math.abs(ee-(J+.5))/g,N=Math.sqrt(ie+q*q);if(N>=1)continue;let L=2*N*N*N-3*N*N+1;const F=4*(r+J+(n+V)*b);D+=L*l[F+3],C+=L,!i&&l[F+3]<255&&(L=L*l[F+3]/255),A+=L*l[F],I+=L*l[F+1],O+=L*l[F+2],E+=L}}p[T]=A/E,p[T+1]=I/E,p[T+2]=O/E,p[T+3]=D/C}return e}function wft(t,e,i){if(!e)return t;const{framebufferWidth:r,framebufferHeight:n,pixelRatio:s,region:o}=t,a=tae(t,i),l=a.left+a.right,c=a.top+a.bottom,h=r-l,p=n-c,f=Math.min(pft,Math.min((Mge-l)/h,(Mge-c)/p));return f<dft?t:{...t,framebufferWidth:Math.round(h*f)+l,framebufferHeight:Math.round(p*f)+c,pixelRatio:s*f,resample:{region:{x:Math.round((o.x-a.left)*f)+a.left,y:Math.round((o.y-a.top)*f)+a.top,width:Math.round(o.width*f),height:Math.round(o.height*f)},width:r,height:n}}}function xft(t,e){if(!t)return e;const i=t.width,r=t.height;if(i!=null&&r!=null)return{width:Math.floor(i),height:Math.floor(r)};if(i==null&&r==null)return e;const n=e.width/e.height;return r==null?{width:Math.floor(i),height:Math.floor(i/n)}:{width:Math.floor(r*n),height:Math.floor(r)}}function Tft(t,e){const i={x:0,y:0,width:e.width,height:e.height};if(t&&t.area){t.area.x!=null&&(i.x=Math.floor(t.area.x)),t.area.y!=null&&(i.y=Math.floor(t.area.y));const r=t.area.width!=null?Math.floor(t.area.width):null,n=t.area.height!=null?Math.floor(t.area.height):null;if(i.width=e.width-i.x,i.height=e.height-i.y,r!=null&&n!=null)i.width=Math.min(i.width,r),i.height=Math.min(i.height,n);else if(r==null&&n!=null){const s=Math.min(i.width,r);i.height=s/i.width*i.height,i.width=s}else if(r!=null&&n==null){const s=Math.min(i.height,n);i.width=s/i.height*i.width,i.height=s}}return Sft(Eft(i,t),e)}function Sft(t,e){const i=Math.floor(Math.max(t.x,0)),r=Math.floor(Math.max(t.y,0)),n={x:i,y:r,width:Math.floor(Math.min(t.width,e.width-i)),height:Math.floor(Math.min(t.height,e.height-r))},s=n.width/n.height,o=t.width/t.height;if(o===s)return n;if(o>s){const c=Math.floor(n.width/o),h=n.height-c;return{x:n.x,y:Math.floor(n.y+h/2),width:n.width,height:c}}const a=Math.floor(n.height*o),l=n.width-a;return{x:Math.floor(n.x+l/2),y:n.y,width:a,height:n.height}}function Eft(t,e){if(!e||e.width==null||e.height==null)return t;const i=e.width/e.height,r=t.width/t.height;if(r===i)return t;if(r<i){const s=Math.floor(t.height*i);return t.x-=(s-t.width)/2,t.width=s,t}const n=Math.floor(t.width/i);return t.y-=(n-t.height)/2,t.height=n,t}function tae(t,e){return!e||t&&t.ignorePadding?Oft:e}function $$e(t){switch(t){case"png":case"jpg":case"jpeg":return t;default:return Mft}}function Cft(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}function Aft(t){const e=t.data,i=e.length;for(let r=0;r<i;r+=4){const n=e[r+3];if(n!==255&&n>0){const s=255/n;e[r+0]=e[r+0]*s,e[r+1]=e[r+1]*s,e[r+2]=e[r+2]*s}}}const Rft={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},Oge=98,Mft="png",L$e={png:100,jpg:Oge,jpeg:Oge},Oft={top:0,right:0,bottom:0,left:0};var Et;function Pft(t,e,i={}){const r=D$e(t);for(;r.length>1;){const n=KV(e,r.shift(),i);if(v(n))return n}return Ift(e,r.shift(),i)}function D$e(t){const e=ue("esri-force-webgl");if(e===Et.WEBGL1||e===Et.WEBGL2)return[e];switch(t){case"2d":return ue("mac")&&ue("chrome")?[Et.WEBGL1,Et.WEBGL2]:[Et.WEBGL2,Et.WEBGL1];case"3d":return[Et.WEBGL2,Et.WEBGL1]}}function Ift(t,e,i={}){if(!window.WebGLRenderingContext)return Pge(t,$ft),null;const r=KV(t,e,i);return R(r)&&Pge(t,Lft),r}function KV(t,e,i={}){const r=e===Et.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"];let n=null;for(const s of r){try{n=t.getContext(s,i)}catch{}if(n)break}return n}function Pge(t,e){const i=t.parentNode;i&&(i.innerHTML='<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+e+"</div></div></td></tr></table>")}(function(t){t[t.WEBGL1=1]="WEBGL1",t[t.WEBGL2=2]="WEBGL2"})(Et||(Et={}));const $ft='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',Lft=`It doesn't appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>`;let yH,_H;function Dft(t){const e=D$e(t);for(;e.length>1;){const i=Ige(e.shift());if(i.available)return i}return Ige(e.shift())}function Ige(t){switch(t){case Et.WEBGL1:return Nft();case Et.WEBGL2:return Fft()}}function Nft(){return yH||(yH=Vft()),yH}function Fft(){return _H||(_H=zft()),_H}let N$e=class{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsElementIndexUint=!1,this.supportsStandardDerivatives=!1,this.supportsInstancedArrays=!1,this.supportsTextureFloat=!1,this.supportsTextureHalfFloat=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}},kft=class extends N$e{constructor(){super(...arguments),this.type=Et.WEBGL1}},Uft=class extends N$e{constructor(){super(...arguments),this.type=Et.WEBGL2,this.supportsElementIndexUint=!0,this.supportsStandardDerivatives=!0,this.supportsInstancedArrays=!0,this.supportsTextureFloat=!0,this.supportsTextureHalfFloat=!0}};function F$e(t,e){var s;if(t===Et.WEBGL1&&typeof WebGLRenderingContext>"u"||t===Et.WEBGL2&&typeof WebGL2RenderingContext>"u")return null;const i=document.createElement("canvas");if(!i)return null;let r=KV(i,t,{failIfMajorPerformanceCaveat:!0});if(R(r)&&(r=KV(i,t),v(r)&&(e.majorPerformanceCaveat=!0)),R(r))return r;if(t===Et.WEBGL1){const o=(s=r.getParameter(r.VERSION))==null?void 0:s.match(/^WebGL\s+([\d.]*)/);if(o){const a=parseFloat(o[1]);e.available=a>=.94}}else e.available=!0;e.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),e.supportsVertexShaderSamplers=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const n=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT);return n&&(e.supportsHighPrecisionFragment=n.precision>0),r}function Vft(){const t=new kft,e=F$e(Et.WEBGL1,t);return R(e)||(t.supportsElementIndexUint=e.getExtension("OES_element_index_uint")!==null,t.supportsStandardDerivatives=e.getExtension("OES_standard_derivatives")!==null,t.supportsInstancedArrays=e.getExtension("ANGLE_instanced_arrays")!==null,t.supportsTextureFloat=e.getExtension("OES_texture_float")!==null,t.supportsTextureHalfFloat=e.getExtension("OES_texture_half_float")!==null,t.supportsColorBufferFloat=e.getExtension("WEBGL_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=e.getExtension("EXT_color_buffer_half_float")!==null),t}function zft(){const t=new Uft,e=F$e(Et.WEBGL2,t);return R(e)||(t.supportsColorBufferFloat=e.getExtension("EXT_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=t.supportsColorBufferFloat||e.getExtension("EXT_color_buffer_half_float")!==null),t}function k$e(t){const e=Dft(t);if(!e.available)return new H("webgl:required","WebGL is required but not supported.");if(t==="3d"&&e.majorPerformanceCaveat)return new H("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!e.supportsHighPrecisionFragment)return new H("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!e.supportsVertexShaderSamplers)return new H("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(e.type===Et.WEBGL1){if(!e.supportsElementIndexUint)return new H("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!e.supportsStandardDerivatives)return new H("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!e.supportsInstancedArrays)return new H("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null}function Bft(t){return t&&"nodeType"in t}function jft(t){return t&&typeof t.render=="function"}const $ge={component:"esri-component"};let TT=class extends ve{constructor(){super(...arguments),this.widget=null}destroy(){this.widget&&this.widget.destroy(),this.node=null}get id(){return this.get("widget.id")||this.get("node.id")}set node(e){const i=this._get("node");e!==i&&(e&&e.classList.add($ge.component),i&&i.classList.remove($ge.component),this._set("node",e))}castNode(e){return e?typeof e=="string"||Bft(e)?(this._set("widget",null),uB(e)):(jft(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};u([d({dependsOn:[]})],TT.prototype,"id",null),u([d()],TT.prototype,"node",null),u([ri("node")],TT.prototype,"castNode",null),u([d({readOnly:!0})],TT.prototype,"widget",void 0),TT=u([$("esri.views.ui.Component")],TT);const yU=TT,Gft={left:0,top:0,bottom:0,right:0},U$e={bottom:30,top:15,right:15,left:15},vH="manual",Vy="esri-ui",lc={ui:Vy,corner:`${Vy}-corner`,innerContainer:`${Vy}-inner-container`,manualContainer:`${Vy}-manual-container`,cornerContainer:`${Vy}-corner-container`,topLeft:`${Vy}-top-left`,topRight:`${Vy}-top-right`,bottomLeft:`${Vy}-bottom-left`,bottomRight:`${Vy}-bottom-right`};function Hft(t){return t&&!t._started&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}function bH(t){const e=t,i=typeof e=="object"&&e!==null&&Object.getPrototypeOf(e);return(i===null||i===Object.prototype)&&("component"in e||"index"in e||"position"in e)?t:null}function wH(t,{top:e,bottom:i,left:r,right:n}){t.style.top=e,t.style.bottom=i,t.style.left=r,t.style.right=n}let pg=class extends An.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentToKey=new Map,this._locale=wp(),this.view=null,this._applyViewPadding=()=>{const i=this.container;i&&wH(i,this._toPxPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const i=this._innerContainer;i&&wH(i,this._toPxPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([ne(()=>{var e;return[(e=this.view)==null?void 0:e.padding,this.container]},this._applyViewPadding,zt),ne(()=>this.padding,this._applyUIPadding,zt),ne(()=>[this.container,this._locale],([e,i])=>{e&&e.setAttribute("lang",i)},zt),$Ee(e=>{this._locale=e})])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._componentToKey.clear()}set container(e){const i=this._get("container");e!==i&&(e&&(e.classList.add(lc.ui),Fet(e),this._attachContainers(e)),i&&(i.classList.remove(lc.ui),wH(i,{top:"",bottom:"",left:"",right:""}),uRe(i)),this._set("container",e))}get height(){const e=this.get("view.height")||0;if(e===0)return e;const i=this._getViewPadding(),r=i.top+i.bottom;return Math.max(e-r,0)}get padding(){return this._get("padding")}set padding(e){this._overrideIfSome("padding",e)}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:{...U$e,...e}}get width(){const e=this.get("view.width")||0;if(e===0)return e;const i=this._getViewPadding(),r=i.left+i.right;return Math.max(e-r,0)}add(e,i){let r,n;if(Array.isArray(e))return void e.forEach(o=>this.add(o,i));const s=bH(e);s&&({index:r,position:i,component:e,key:n}=s),i&&typeof i=="object"&&({index:r,key:n,position:i}=i),!e||i&&!this._isValidPosition(i)||this._add(e,i,r,n)}remove(e,i){if(!e)return;if(Array.isArray(e))return e.map(n=>this.remove(n,i));const r=this._find(e);if(r){const n=this._componentToKey;if(n.has(e)&&n.get(e)!==i)return;const s=this._components.indexOf(r);return r.node.parentNode&&r.node.parentNode.removeChild(r.node),this._componentToKey.delete(e),this._components.splice(s,1)[0]}}empty(e){return Array.isArray(e)?e.map(i=>this.empty(i)).reduce((i,r)=>i.concat(r)):(e=e||vH)===vH?Array.prototype.slice.call(this._manualContainer.children).filter(i=>!i.classList.contains(lc.corner)).map(i=>this.remove(i)):this._isValidPosition(e)?Array.prototype.slice.call(this._cornerNameToContainerLookup[e].children).map(this.remove,this):null}move(e,i){if(Array.isArray(e)&&e.forEach(o=>this.move(o,i)),!e)return;let r;const n=bH(e)||bH(i);if(n&&(r=n.index,i=n.position,e=n.component||e),i&&!this._isValidPosition(i))return;const s=this.remove(e);s&&this.add(s,{position:i,index:r})}find(e){if(!e)return null;const i=this._findById(e);return i&&(i.widget||i.node)}getPosition(e){for(const i in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[i].contains(e))return i;return null}_add(e,i,r,n){e instanceof yU||(e=new yU({node:e})),this._place({component:e,position:i,index:r}),this._components.push(e),n&&this._componentToKey.set(e,n)}_find(e){return e?e instanceof yU?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){return this.get("view.padding")||Gft}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(lc.innerContainer),e.classList.add(lc.cornerContainer);const i=document.createElement("div");i.classList.add(lc.innerContainer),i.classList.add(lc.manualContainer);const r=document.createElement("div");r.classList.add(lc.topLeft),r.classList.add(lc.corner),e.appendChild(r);const n=document.createElement("div");n.classList.add(lc.topRight),n.classList.add(lc.corner),e.appendChild(n);const s=document.createElement("div");s.classList.add(lc.bottomLeft),s.classList.add(lc.corner),e.appendChild(s);const o=document.createElement("div");o.classList.add(lc.bottomRight),o.classList.add(lc.corner),e.appendChild(o),this._innerContainer=e,this._manualContainer=i;const a=Bg();this._cornerNameToContainerLookup={"top-left":r,"top-right":n,"bottom-left":s,"bottom-right":o,"top-leading":a?n:r,"top-trailing":a?r:n,"bottom-leading":a?o:s,"bottom-trailing":a?s:o},this._positionNameToContainerLookup={manual:i,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const i=e.component,r=e.position||vH,n=e.index,s=this._positionNameToContainerLookup[r],o=n!=null&&n>-1;if(Hft(i.widget)&&i.widget.startup(),!o)return void s.appendChild(i.node);const a=Array.prototype.slice.call(s.children);if(n===0)return void(s.firstChild?kde(i.node,s.firstChild):s.appendChild(i.node));n>=a.length?s.appendChild(i.node):kde(i.node,a[n])}_toPxPosition(e){return{top:this._toPxUnit(e.top),left:this._toPxUnit(e.left),right:this._toPxUnit(e.right),bottom:this._toPxUnit(e.bottom)}}_toPxUnit(e){return e===0?"0":e+"px"}_findByComponent(e){let i,r=null;return this._components.some(n=>(i=n===e,i&&(r=n),i)),r}_findById(e){let i,r=null;return this._components.some(n=>(i=n.id===e,i&&(r=n),i)),r}_findByNode(e){let i,r=null;return this._components.some(n=>(i=n.node===e,i&&(r=n),i)),r}};u([d()],pg.prototype,"_locale",void 0),u([d()],pg.prototype,"container",null),u([d()],pg.prototype,"height",null),u([d({value:U$e})],pg.prototype,"padding",null),u([ri("padding")],pg.prototype,"castPadding",null),u([d()],pg.prototype,"view",void 0),u([d()],pg.prototype,"width",null),pg=u([$("esri.views.ui.UI")],pg);const qft=pg;function Lge(t,e){return t&&"copyright"in t&&(!e||typeof t.originOf=="function"&&t.originOf("copyright")==="user")}function Wft(t,e){return t.length!==e.length||t.some((i,r)=>i.text!==e[r].text)}function O4(t,e,i){!i||!e||t.find(r=>r.layerView===e&&r.text===i)||t.push({text:i,layerView:e})}function Xft(t){return t.type==="bing-maps"}const xv=[];let tA=class extends sD{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.handles.remove("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new tt,this.view=null,this._allLayerViewsChange=i=>{this.handles.remove("suspension");const r=this.get("view.allLayerViews");r&&this.handles.add(r.map(n=>ne(()=>{var s;return[n.suspended,(s=n.layer)==null?void 0:s.attributionVisible]},()=>this._updateAttributionItems())),"suspension"),i&&i.removed&&i.removed.forEach(n=>{this._pendingAttributions.delete(n),this._fetchedAttributionData.delete(n)}),this._updateAttributionItems()},this.handles.add([Kn(()=>{var i;return(i=this.view)==null?void 0:i.allLayerViews},"change",i=>this._allLayerViewsChange(i),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),yo(()=>{var i;return((i=this.view)==null?void 0:i.stationary)===!0},()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const e=this.view,i=e==null?void 0:e.allLayerViews;xv.length=0,e&&i?(i.forEach(r=>{var o;if(r.suspended||!((o=r.layer)!=null&&o.attributionVisible))return;const n=r.layer;if(Lge(n,"user"))return void O4(xv,r,n.copyright);if(n.hasAttributionData){if(this._fetchedAttributionData.has(r)){const a=this._fetchedAttributionData.get(r);return void(a?O4(xv,r,this._getDynamicAttribution(a,e,n)):Lge(n)&&O4(xv,r,n.copyright))}return void this._fetchAttributionData(r)}const s=n.get("portalItem.accessInformation");O4(xv,r,s||n.copyright)}),Wft(this.items,xv)&&(this.items.removeAll(),this.items.addMany(xv)),xv.length=0,this.notifyChange("state")):this._clear()}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const i=await _m(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const r=i.ok?this._createContributionIndex(i.value,Xft(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,r)}this._updateAttributionItems()}_createContributionIndex(e,i){const r=e.contributors,n={};if(!r)return n;for(let s=0;s<r.length;s++){const o=r[s],a=o.coverageAreas;if(!a)return;for(const l of a){const c=l.bbox,h=l.zoomMin-(i&&l.zoomMin?1:0),p=l.zoomMax-(i&&l.zoomMax?1:0),f={xmin:c[1],ymin:c[0],xmax:c[3],ymax:c[2],spatialReference:Je.WGS84},m={extent:Zg(f),attribution:o.attribution||"",score:l.score!=null?l.score:100,id:s};for(let g=h;g<=p;g++)n[g]=n[g]||[],n[g].push(m)}}return n.maxKey=Math.max.apply(null,Object.keys(n)),n}_getDynamicAttribution(e,i,r){var h;const{extent:n,scale:s}=i;let o=((h=r.tileInfo)==null?void 0:h.scaleToZoom(s))??0;if(o=Math.min(e.maxKey??0,Math.round(o)),!n||o==null||o<=-1)return"";const a=e[o],l=z2(n.center.clone().normalize(),i.spatialReference),c={};return a?a.filter(p=>{const f=p.id,m=!c[f]&&l&&p.extent&&L9(p.extent,l);return m&&(c[f]=!0),m}).sort((p,f)=>f.score-p.score||p.objectId-f.objectId).map(p=>p.attribution).join(", "):""}};u([d({readOnly:!0,type:tt})],tA.prototype,"items",void 0),u([d({readOnly:!0})],tA.prototype,"state",null),u([d()],tA.prototype,"view",void 0),tA=u([$("esri.widgets.Attribution.AttributionViewModel")],tA);const V$e=tA,gE="esri-attribution",Tv={base:`${gE} esri-widget`,poweredBy:`${gE}__powered-by`,sources:`${gE}__sources`,open:`${gE}--open`,sourcesOpen:`${gE}__sources--open`,link:`${gE}__link`,widgetIcon:"esri-icon-description",interactive:"esri-interactive"};let xc=class extends Sa{constructor(e,i){super(e,i),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(r=>r.forEach(({target:n})=>this._checkSourceTextOverflow(n))),this.iconClass=Tv.widgetIcon,this.itemDelimiter=" | ",this.messages=null,this.viewModel=new V$e}initialize(){this.addHandles(Kn(()=>{var e;return(e=this.viewModel)==null?void 0:e.items},"change",()=>this.scheduleRender()))}destroy(){var e;(e=this._resizeObserver)==null||e.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,i)=>(e.includes(i.text)||e.push(i.text),e),[]).join(this.itemDelimiter)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[Tv.open]:this._isOpen};return te("div",{bind:this,class:this.classes(Tv.base,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())}renderPoweredBy(){return te("div",{class:Tv.poweredBy},"Powered by"," ",te("a",{class:Tv.link,href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))}renderSourcesNode(){const e=this._isOpen,i=this._isInteractive,r=i?"0":"",{attributionText:n}=this,s={[Tv.sourcesOpen]:e,[Tv.interactive]:i};return te("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(Tv.sources,s),innerHTML:n,tabindex:r})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let i=!1;const{clientHeight:r,clientWidth:n,scrollWidth:s}=e,o=s>n,a=this._attributionTextOverflowed!==o;if(this._attributionTextOverflowed=o,a&&(i=!0),this._isOpen){const l=r<this._prevSourceNodeHeight;this._prevSourceNodeHeight=r,l&&(this._isOpen=!1,i=!0)}i&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};u([d()],xc.prototype,"_isOpen",void 0),u([d()],xc.prototype,"_isInteractive",null),u([d()],xc.prototype,"_attributionTextOverflowed",void 0),u([d()],xc.prototype,"_prevSourceNodeHeight",void 0),u([d({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],xc.prototype,"attributionText",null),u([d()],xc.prototype,"iconClass",void 0),u([d()],xc.prototype,"itemDelimiter",void 0),u([d()],xc.prototype,"label",null),u([d(),Go("esri/widgets/Attribution/t9n/Attribution")],xc.prototype,"messages",void 0),u([d()],xc.prototype,"view",null),u([d({type:V$e})],xc.prototype,"viewModel",void 0),u([Nh()],xc.prototype,"_toggleState",null),xc=u([$("esri.widgets.Attribution")],xc);const Yft=xc,Zft="esri.widgets.CompassViewModel";let ST=class extends gIe(ve){constructor(e){super(e),this._handles=new Xi,this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._handles.add(ne(()=>this.view,this._updateRotationWatcher,zt))}destroy(){Nr(this._handles),this.view=null}get canShowNorth(){const e=this.get("view.spatialReference");return!(!e||!e.isWebMercator&&!e.isGeographic)}get state(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}reset(){var i;if(!this.get("view.ready"))return;const e={};((i=this.view)==null?void 0:i.type)==="2d"?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){e!=null&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const i=-e.heading;this.orientation={x:0,y:0,z:i}}_updateRotationWatcher(e){this._handles.removeAll(),e&&this._handles.add(e.type==="2d"?ne(()=>e==null?void 0:e.rotation,this._updateForRotation,zt):ne(()=>e==null?void 0:e.camera,this._updateForCamera,zt))}};u([d({readOnly:!0})],ST.prototype,"canShowNorth",null),u([d()],ST.prototype,"orientation",void 0),u([d({readOnly:!0})],ST.prototype,"state",null),u([d()],ST.prototype,"view",void 0),ST=u([$(Zft)],ST);const z$e=ST,Sv={base:"esri-compass esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",icon:"esri-compass__icon",rotationIcon:"esri-icon-dial",northIcon:"esri-icon-compass",widgetIcon:"esri-icon-locate-circled",interactive:"esri-interactive",disabled:"esri-disabled"};let fg=class extends Sa{constructor(e,i){super(e,i),this.iconClass=Sv.widgetIcon,this.messages=null,this.viewModel=new z$e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:i}=this.viewModel,r=i==="disabled",n=(i==="rotation"?"rotation":"compass")=="compass",s=r?-1:0,o={[Sv.disabled]:r,[Sv.interactive]:!r},a={[Sv.northIcon]:n,[Sv.rotationIcon]:!n},{messages:l}=this;return te("div",{bind:this,class:this.classes(Sv.base,o),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:s,"aria-label":l.reset,title:l.reset},te("span",{"aria-hidden":"true",class:this.classes(Sv.icon,a),styles:this._toRotationTransform(e)}),te("span",{class:Sv.text},l.reset))}_reset(){this.viewModel.reset()}_toRotationTransform(e){return{transform:`rotateZ(${e.z}deg)`}}};u([d()],fg.prototype,"goToOverride",null),u([d()],fg.prototype,"iconClass",void 0),u([d()],fg.prototype,"label",null),u([d(),Go("esri/widgets/Compass/t9n/Compass")],fg.prototype,"messages",void 0),u([d()],fg.prototype,"view",null),u([d({type:z$e})],fg.prototype,"viewModel",void 0),u([Nh()],fg.prototype,"_reset",null),fg=u([$("esri.widgets.Compass")],fg);const Jft=fg,yE="esri-navigation-toggle",bd={base:`${yE} esri-widget`,button:`${yE}__button esri-widget--button`,activeButton:`${yE}__button--active`,panButton:`${yE}__button--pan`,rotateButton:`${yE}__button--rotate`,isLayoutHorizontal:`${yE}--horizontal`,rotationIcon:"esri-icon-rotate",panIcon:"esri-icon-pan",widgetIcon:"esri-icon-pan2",disabled:"esri-disabled"};let iA=class extends ve{constructor(e){super(e),this.navigationMode="pan",this.view=null}initialize(){this.own(yo(()=>{var e;return(e=this.view)==null?void 0:e.inputManager},()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){var e;return this.get("view.ready")&&((e=this.view)==null?void 0:e.type)==="3d"?"ready":"disabled"}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){this.get("view.inputManager").primaryDragAction=this.navigationMode==="pan"?"pan":"rotate"}};u([d({readOnly:!0})],iA.prototype,"state",null),u([d()],iA.prototype,"navigationMode",void 0),u([d()],iA.prototype,"view",void 0),iA=u([$("esri.widgets.NavigationToggleViewModel")],iA);const B$e=iA;let mg=class extends Sa{constructor(e,i){super(e,i),this.iconClass=bd.widgetIcon,this.messages=null,this.viewModel=new B$e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}toggle(){return this.viewModel.toggle()}render(){const e=this.get("viewModel.state")==="disabled",i=this.get("viewModel.navigationMode")==="pan",r={[bd.disabled]:e,[bd.isLayoutHorizontal]:this.layout==="horizontal"},n={[bd.activeButton]:i},s={[bd.activeButton]:!i},o=e?-1:0,a=this.messages.toggle;return te("div",{bind:this,class:this.classes(bd.base,r),onclick:this._toggle,onkeydown:this._toggle,tabIndex:o,"aria-label":a,title:a},te("div",{class:this.classes(bd.button,bd.panButton,n)},te("span",{class:bd.panIcon})),te("div",{class:this.classes(bd.button,bd.rotateButton,s)},te("span",{class:bd.rotationIcon})))}_toggle(){this.toggle()}};u([d()],mg.prototype,"iconClass",void 0),u([d()],mg.prototype,"label",null),u([d({value:"vertical"})],mg.prototype,"layout",null),u([d(),Go("esri/widgets/NavigationToggle/t9n/NavigationToggle")],mg.prototype,"messages",void 0),u([d()],mg.prototype,"view",null),u([d({type:B$e})],mg.prototype,"viewModel",void 0),u([Nh()],mg.prototype,"_toggle",null),mg=u([$("esri.widgets.NavigationToggle")],mg);const Kft=mg,P3={button:"esri-widget--button esri-widget",disabled:"esri-disabled",interactive:"esri-interactive",iconText:"esri-icon-font-fallback-text",icon:"esri-icon"};let w1=class extends Sa{constructor(){super(...arguments),this.enabled=!0,this.iconClass="",this.title=""}render(){const e=this.enabled?0:-1,i={[P3.disabled]:!this.enabled,[P3.interactive]:this.enabled},r={[this.iconClass]:!!this.iconClass};return te("div",{bind:this,class:this.classes(P3.button,i),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:e,title:this.title},te("span",{"aria-hidden":"true",role:"presentation",class:this.classes(P3.icon,r)}),te("span",{class:P3.iconText},this.title))}_triggerAction(){this.action.call(this)}};u([d()],w1.prototype,"action",void 0),u([d()],w1.prototype,"enabled",void 0),u([d()],w1.prototype,"iconClass",void 0),u([d()],w1.prototype,"title",void 0),u([Nh()],w1.prototype,"_triggerAction",null),w1=u([$("esri.widgets.IconButton")],w1);const Dge=w1;let rA=class extends ve{get canZoomIn(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),i=this.get("view.constraints.effectiveMaxScale");return i===0||e>i}get canZoomOut(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),i=this.get("view.constraints.effectiveMinScale");return i===0||e<i}};u([d({readOnly:!0})],rA.prototype,"canZoomIn",null),u([d({readOnly:!0})],rA.prototype,"canZoomOut",null),u([d()],rA.prototype,"view",void 0),rA=u([$("esri.widgets.Zoom.ZoomConditions2D")],rA);const Qft=rA;let nA=class extends ve{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};u([d({readOnly:!0})],nA.prototype,"canZoomIn",null),u([d({readOnly:!0})],nA.prototype,"canZoomOut",null),u([d()],nA.prototype,"view",void 0),nA=u([$("esri.widgets.Zoom.ZoomConditions3D")],nA);const emt=nA;let x1=class extends ve{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return v(this._zoomConditions)&&this._zoomConditions.canZoomIn}get canZoomOut(){var e;return v(this._zoomConditions)&&((e=this._zoomConditions)==null?void 0:e.canZoomOut)}get state(){var e;return(e=this.view)!=null&&e.ready?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new Qft({view:e}):e.type==="3d"&&(this._zoomConditions=new emt({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():CR(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():CR(e.goTo({zoomFactor:.5}))}};u([d()],x1.prototype,"_zoomConditions",void 0),u([d()],x1.prototype,"canZoomIn",null),u([d()],x1.prototype,"canZoomOut",null),u([d({readOnly:!0})],x1.prototype,"state",null),u([d()],x1.prototype,"view",null),x1=u([$("esri.widgets.Zoom.ZoomViewModel")],x1);const j$e=x1,I3={base:"esri-zoom esri-widget",horizontalLayout:"esri-zoom--horizontal",zoomInIcon:"esri-icon-plus",zoomOutIcon:"esri-icon-minus",widgetIcon:"esri-icon-zoom-in-magnifying-glass"};let b0=class extends Sa{constructor(e,i){super(e,i),this.iconClass=I3.widgetIcon,this.messages=null,this.viewModel=new j$e}initialize(){this._zoomInButton=new Dge({action:this.zoomIn.bind(this),iconClass:I3.zoomInIcon}),this._zoomOutButton=new Dge({action:this.zoomOut.bind(this),iconClass:I3.zoomOutIcon})}destroy(){this._zoomInButton=Ve(this._zoomInButton),this._zoomOutButton=Ve(this._zoomOutButton)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}set view(e){this.viewModel.view=e}get view(){return this.viewModel.view}render(){const e=this.viewModel,i={[I3.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:r,canZoomOut:n}=e;this._zoomInButton.enabled=r,this._zoomOutButton.enabled=n;const{zoomIn:s,zoomOut:o}=this.messages;return this._zoomInButton.title=s,this._zoomOutButton.title=o,te("div",{class:this.classes(I3.base,i)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};u([d()],b0.prototype,"iconClass",void 0),u([d()],b0.prototype,"label",null),u([d({value:"vertical"})],b0.prototype,"layout",null),u([d(),Go("esri/widgets/Zoom/t9n/Zoom")],b0.prototype,"messages",void 0),u([d()],b0.prototype,"view",null),u([d({type:j$e})],b0.prototype,"viewModel",void 0),b0=u([$("esri.widgets.Zoom")],b0);const tmt=b0;function imt(t){return t&&t.view!==void 0}let _U=class extends qft{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[]}initialize(){this.addHandles([ne(()=>this.components,this._componentsWatcher.bind(this),zt),ne(()=>this.view,this._updateViewAwareWidgets.bind(this),zt)])}_add(e,i,r,n){let s=e;if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;s=this._createComponent(e)}super._add(s,i,r,n)}_removeComponents(e){e.forEach(i=>{const r=this._find(i);r&&(this.remove(r),r.destroy())})}_updateViewAwareWidgets(e){this.components.forEach(i=>{const r=this._find(i),n=r&&r.widget;imt(n)&&(n.view=e)})}_componentsWatcher(e,i){this._removeComponents(i),this._addComponents(e),this._adjustPadding(e)}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:i}=this.padding;this.padding=i}}_addComponents(e){this.constructed&&e.forEach(i=>this.add(this._createComponent(i),this._defaultPositionLookup[i]))}_createComponent(e){const i=this._createWidget(e);if(i)return new yU({id:e,node:i})}_createWidget(e){return e==="attribution"?this._createAttribution():e==="compass"?this._createCompass():e==="navigation-toggle"?this._createNavigationToggle():e==="zoom"?this._createZoom():void 0}_createAttribution(){return new Yft({view:this.view})}_createCompass(){return new Jft({view:this.view})}_createNavigationToggle(){return new Kft({view:this.view})}_createZoom(){return new tmt({view:this.view})}};u([d()],_U.prototype,"components",void 0),_U=u([$("esri.views.ui.DefaultUI")],_U);const G$e=_U;let vU=class extends G$e{constructor(e){super(e),this.components=["attribution","zoom"]}};u([d()],vU.prototype,"components",void 0),vU=u([$("esri.views.ui.2d.DefaultUI2D")],vU);const H$e=vU;var OQ;let bU=OQ=class extends fe{constructor(t){super(t),this.color=new Xe([0,0,0,1])}clone(){return new OQ(se({color:this.color}))}};u([d({type:Xe,json:{write:!0}})],bU.prototype,"color",void 0),bU=OQ=u([$("esri.webmap.background.ColorBackground")],bU);const VB=bU;let q$e,W$e,X$e,Y$e,Z$e,J$e;async function rmt(){const[,{GraphicsView2D:t,GraphicContainer:e,LabelManager:i,MapViewNavigation:r,MagnifierView2D:n,Stage:s}]=await Promise.all([Q(()=>import("./webglDeps-12d4b371.js"),["assets/webglDeps-12d4b371.js","assets/ShaderCompiler-77d0dcb6.js","assets/programUtils-f035fe8a.js","assets/ProgramTemplate-c9ea1109.js"]),Q(()=>import("./mapViewDeps-b13d25d0.js"),["assets/mapViewDeps-b13d25d0.js","assets/CIMResourceManager-5b9a3e6a.js","assets/Rasterizer-a13839c4.js","assets/_commonjsHelpers-2f3e7994.js","assets/cimAnalyzer-163ac770.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/enums-4b2a86a0.js","assets/alignmentUtils-ae955d28.js","assets/definitions-3ddd14a8.js","assets/number-b10bd8f5.js","assets/Rect-ea14f53a.js","assets/rasterizingUtils-37f0f33e.js","assets/imageutils-58ee6580.js","assets/Container-83d986f4.js","assets/BufferPool-81fcde76.js","assets/enums-b1d611e3.js","assets/WGLContainer-cca4133a.js","assets/WGLBrushVTLSymbol-e8c49a01.js","assets/StyleDefinition-7d58136b.js","assets/GeometryUtils-dd03fc25.js","assets/color-ecd22285.js","assets/ShaderCompiler-77d0dcb6.js","assets/ProgramTemplate-c9ea1109.js","assets/MaterialKey-c290b8d1.js","assets/utils-2b9e1dc7.js","assets/heatmapTextureUtils-e2b3289a.js","assets/VTLMaterialManager-c25094ad.js","assets/programUtils-f035fe8a.js","assets/MagnifierPrograms-8cd20d2d.js","assets/Matcher-8ef33fbf.js","assets/visualVariablesUtils-3c7f6581.js","assets/visualVariablesUtils-6323c511.js","assets/tileUtils-c2f19f52.js","assets/TurboLine-f2375728.js","assets/ExpandedCIM-1ac96b4c.js","assets/CircularArray-724bafc9.js","assets/ComputedAttributeStorage-a0054ede.js","assets/arcadeTimeUtils-21c68d00.js","assets/executionError-fb3f283a.js","assets/centroid-c62179b0.js","assets/MaterialPrograms-ea2ca365.js","assets/GraphicsView2D-569b3c38.js","assets/projectionSupport-2f167231.js","assets/json-48e3ea08.js","assets/AttributeStoreView-06ec49c7.js","assets/schemaUtils-9432c525.js","assets/util-b4eb6d10.js","assets/GraphicsView-b7bed666.js","assets/GraphicContainer-d3fa5611.js","assets/BaseGraphicContainer-3c39d579.js","assets/FeatureContainer-3eb11aab.js","assets/TileContainer-136758dc.js"])]);W$e=t,X$e=e,Y$e=i,Z$e=r,J$e=n,q$e=s}const Nge=160;function nmt(t){return t&&t.declaredClass==="esri.Viewpoint"}let di=class extends cRe(_Ie(vIe(DIe))){constructor(e){super(e),this._magnifierView=null,this._stage=null,this._resolveWhenReady=[],this.rootLayerViews=new CM({getCollections:()=>{var i,r;return[(i=this.basemapView)==null?void 0:i.baseLayerViews,this.layerViews,(r=this.basemapView)==null?void 0:r.referenceLayerViews]},getChildrenFunction:()=>null}),this.featuresTilingScheme=null,this.fullOpacity=1,this.graphicsView=null,this.labelManager=null,this.mapViewNavigation=null,this.renderingOptions={samplingMode:"dynamic",edgeLabelsVisible:!0,labelsAnimationTime:125,labelCollisionsEnabled:!0},this.rendering=!1,this.supersampleScreenshotsEnabled=!0,this.supportsGround=!1,this._stationaryTimer=null,this._gotoTask=null,this.frameTask=new qdt(this),this._pePromise=null,this.floors=new tt,this.highlightOptions=new R$e,this.inputManager=new tft({view:this}),this.map=null,this.resizeAlign="center",this.spatialReferenceLocked=!1,this.timeline=new M$e,this.type="2d",this.ui=new H$e,this._pixelFormat={flipY:!0,premultipliedAlpha:!0},this.constraints=new o$e,this.padding={top:0,right:0,bottom:0,left:0},this.handles.add([ne(()=>this.viewpoint,()=>{this._lastStationaryEventTimestamp=performance.now(),this._flipStationary(Nge)},Ki),this.on("resize",i=>this._resizeHandler(i)),ne(()=>{var i;return(i=this.animationManager)==null?void 0:i.animation},i=>{this.animation=i})]),MAe()}destroy(){this._set("preconditionsReady",!1),this._gotoTask=this.frameTask=null,this.rootLayerViews.destroy(),this.inputManager.destroy(),this._set("inputManager",null)}get graphicsTileStore(){return new aft(this.featuresTilingScheme)}get initialExtentRequired(){var a;const{scale:e,constraints:i,center:r,viewpoint:n,extent:s}=this;let o=this.zoom;return!(this.map&&"initialViewProperties"in this.map&&((a=this.map.initialViewProperties)!=null&&a.viewpoint))&&!s&&(i!=null&&i.effectiveLODs||(o=-1),(!r||e===0&&o===-1)&&(!n||!v(n.targetGeometry)||n.targetGeometry.type!=="extent"&&!n.scale))}get resourceManager(){return this._stage.resourceManager}get textureManager(){return this._stage.painter.textureManager}get _defaultsFromMapSettings(){return{required:{tileInfo:!0,heightModelInfo:!1,extent:!1},requiresExtentInSpatialReference:this.spatialReferenceLocked}}get _projectionEngineLoaded(){return!!c2()||(this._pePromise||(this._pePromise=u2().finally(()=>{this._pePromise=null})),!1)}get typeSpecificPreconditionsReady(){const e=this._getDefaultViewpoint();if(!e)return!1;const i=this.spatialReference,r=e.targetGeometry;return!!my(r.spatialReference,i)||this._projectionEngineLoaded}set animation(e){const i=this._get("animation");if(e===i)return;if(i&&i.stop(),!e||e.isFulfilled())return void this._set("animation",null);this._set("animation",e),this.frameTask.animationInProgress=!0;const r=()=>{var n;e===this._get("animation")&&(this._set("animation",null),(n=this.frameTask)==null||n.requestFrame()),this.frameTask&&(this.frameTask.animationInProgress=!1)};e.when(r,r)}get background(){return smt(this.map)?this.map.initialViewProperties.background:null}set background(e){this._override("background",e)}get center(){if(!this.ready)return this._get("center");const{center:e,spatialReference:i}=this.state.paddedViewState;return new Le({x:e[0],y:e[1],spatialReference:i})}set center(e){if(e==null)return;if(!this.ready)return this._set("center",e),void this.notifyChange("initialExtentRequired");let i;try{i=this._project(e,this.spatialReference)}catch(n){return void re.getLogger(this.declaredClass).error(new H("mapview:invalid-center","could not project the value in the view's spatial reference",{input:e,error:n}))}const r=this.viewpoint;bQ(r,r,i),this.viewpoint=r}set constraints(e){const i=this._get("constraints");i&&(this.handles.remove("map-view-constraints"),i.destroy()),this._set("constraints",e),e&&(e.view=this,this.ready&&(this.state.viewpoint=e.fit(this.state.paddedViewState.viewpoint)),this.handles.add(ne(()=>e.version,()=>{this.ready&&this.state&&(this.state.viewpoint=e.fit(this.state.paddedViewState.viewpoint))},Ki),"map-view-constraints"))}get extent(){return this.ready?this.state.paddedViewState.extent.clone():this._get("extent")}set extent(e){if(e==null)return;if(!e.width||!e.height)return void re.getLogger(this.declaredClass).error(new H("mapview:invalid-extent","invalid extent size"));if(!this.ready)return this._set("extent",e),this._set("center",null),this._set("viewpoint",null),this._set("scale",0),this._set("zoom",-1),void this.notifyChange("initialExtentRequired");let i;try{i=this._project(e,this.spatialReference)}catch(n){return void re.getLogger(this.declaredClass).error(new H("mapview:invalid-extent","could not project the value in the view's spatial reference",{error:n}))}const r=this.viewpoint;Odt(r,r,i,this.size,{constraints:this.constraints}),this.viewpoint=r}get padding(){return this.ready?this.state.padding:this._get("padding")}set padding(e){this.ready?(this.state.padding=e,this._set("padding",this.state.padding)):this._set("padding",e)}get resolution(){return this.state?this.state.resolution:0}get rotation(){return this.ready?this.state.rotation:this._get("rotation")}set rotation(e){if(isNaN(e))return;if(!this.ready)return void this._set("rotation",e);const i=this.viewpoint;Bdt(i,i,e),this.viewpoint=i}get scale(){return this.ready?this.state.scale:this._get("scale")}set scale(e){if(!e||isNaN(e))return;if(!this.ready){this._set("scale",e),this._set("zoom",-1);const r=this._get("extent");return r&&(this._set("extent",null),this._set("center",r.center)),void this.notifyChange("initialExtentRequired")}const i=this.viewpoint;uge(i,i,e),this.viewpoint=i}get stationary(){return!(this.animation||this.navigating||this.resizing||this._stationaryTimer)}get updating(){var i,r,n;const e=!this.destroyed&&(!this.layerViewManager||!this.labelManager||!this.graphicsView||this.layerViewManager.updating===!0||this.labelManager.updating===!0||this.graphicsView.updating===!0||this.allLayerViews.some(s=>!s.destroyed&&!("layerViews"in s)&&s.updating===!0));if(ue("esri-2d-log-updating")){const s=this.allLayerViews.reduce((o,a)=>({...o,[a.layer.id]:!a.destroyed&&!("layerViews"in a)&&a.updating}),{});console.log(`Updating MapView: ${e}
-> Null LayerViewManager: ${!this.layerViewManager}
-> Null LabelManager: ${!this.labelManager}
-> Null GraphicsView: ${!this.graphicsView}
-> layerViewManager.updating: ${(i=this.layerViewManager)==null?void 0:i.updating}
-> labelManager.updating: ${(r=this.labelManager)==null?void 0:r.updating}
-> graphicsView.updating: ${(n=this.graphicsView)==null?void 0:n.updating}
-> allLayerViews: ${JSON.stringify(s)}
`)}return e}get viewpoint(){if(!this.ready)return this._get("viewpoint");const e=this.state.paddedViewState;return e&&e.viewpoint.clone()}set viewpoint(e){if(e==null)return;if(!this.ready)return this._set("viewpoint",e),this._set("extent",null),this._set("center",null),this._set("zoom",-1),this._set("scale",0),void this.notifyChange("initialExtentRequired");let i,r;try{i=this._project(e,this.spatialReference),!e.scale||isNaN(e.scale)?r=new H("mapview:invalid-viewpoint",`invalid scale value of ${e.scale}`):R(e.targetGeometry)&&(r=new H("mapview:invalid-viewpoint","geometry not defined"))}catch(s){r=new H("mapview:invalid-viewpoint","could not project the value in the view's spatial reference",{error:s})}if(r)return void re.getLogger(this.declaredClass).error(r);this._scaleBeforeChangingSpatialReference=null;const n=new Jn({targetGeometry:new Le,scale:0,rotation:0});Em(n,i),this.constraints.constrain(n,this.state.paddedViewState.viewpoint),this.state.viewpoint=n,this.frameTask.requestFrame(),this._set("viewpoint",n)}get zoom(){return this.ready?this.constraints.scaleToZoom(this.scale):this._get("zoom")}set zoom(e){if(e==null)return;if(!this.ready){this._set("zoom",e),this._set("scale",0);const r=this._get("extent");return r&&(this._set("extent",null),this._set("center",r.center)),void this.notifyChange("initialExtentRequired")}if(!this.constraints.effectiveLODs)return void this._set("zoom",-1);const i=this.viewpoint;uge(i,i,this.constraints.zoomToScale(e)),this.viewpoint=i,this._set("zoom",this.constraints.scaleToZoom(this.scale))}get navigating(){return!(!this.mapViewNavigation||!this.mapViewNavigation.interacting)}goTo(e,i){if(e)return this.animation&&(this.animation=null),this._createAnimation(),ow(()=>this.ready,i).then(()=>{var s;const r={animate:!0,...i},n=Adt(e,this);return(s=this.animation)==null||s.update(n),this._gotoTask={},r.animate?this._gotoAnimated(n,r):this._gotoImmediate(n,r)});re.getLogger(this.declaredClass).error("#goTo()","target cannot be null or undefined")}async hitTest(e,i){const r=XV(e)?WV(this,e):e;if(!this.ready||isNaN(r.x)||isNaN(r.y))return{screenPoint:r,results:[]};let n=new Set,s=!1,o=null,a=null;i!=null&&i.include?kge(i.include,Fge(this,p=>n.add(p),p=>{o||(o=new Set),o.add(p)},p=>n.add(p),()=>s=!0)):(s=!0,n=new Set(this.allLayerViews)),i!=null&&i.exclude&&kge(i.exclude,Fge(this,p=>n.delete(p),p=>{a||(a=new Set),a.add(p)}));const l=this.allLayerViews.filter(p=>!p.suspended&&n.has(p)).reverse(),c=this.toMap(r);let h=[...s?this.graphicsView.hitTest(c).map(p=>({type:"graphic",graphic:p,layer:null,mapPoint:c})):[],...await Promise.all(l.map(p=>p.hitTest(c,r)).toArray())].filter(v).flat().filter(v);return o&&(h=h.filter(p=>!("graphic"in p)||!p.graphic||(o==null?void 0:o.has(PQ(p.graphic))))),a&&(h=h.filter(p=>!("graphic"in p)||!p.graphic||(a==null?void 0:a.has(PQ(p.graphic))))),{screenPoint:r,results:h}}async takeScreenshot(e){const i=this._createScreenshotPlan(e),r=await this._stage.takeScreenshot(i);return mU(r,{format:i.format,quality:i.quality,rotation:0,disableDecorations:!1},this._pixelFormat)}async _takeScreenshot(e){const i=this._createScreenshotPlan(e),r=await this._stage.takeScreenshot(i);return gU(r,this._pixelFormat)}_createScreenshotPlan(e){e=e??{};const i=this.supersampleScreenshotsEnabled?Math.min(4,vft(this.size,Math.min(4096,this._stage.context.parameters.maxTextureSize))):1;let r;e.layers?(r=[],e.layers.forEach(o=>{const a=this.allLayerViews.find(l=>l.layer.id===o.id);a&&"container"in a&&a.container&&r.push(a.container)})):r=this._stage.children;const{format:n,quality:s}=_ft(e.format,e.quality);return cft(e,i,this.size,this.padding,n,s,r,e.rotation)}get test(){return{takeScreenshot:e=>this._takeScreenshot(e)}}toMap(e){if(!this.ready)return null;const i=XV(e)?WV(this,e):e,r=[0,0],[n,s]=this.state.toMap(r,[i.x,i.y]),o=this.spatialReference;return new Le({x:n,y:s,spatialReference:o})}toScreen(e){if(!this.ready)return null;const i=this._project(e,this.spatialReference),r=[i.x,i.y];return this.state.toScreen(r,r),Ws(r[0],r[1])}on(e,i,r,n){return this.inputManager&&this.viewEvents.on(e,i,r,n)||super.on(e,i)}hasEventListener(e){return super.hasEventListener(e)||this.viewEvents.hasHandler(e)}whenLayerView(e){return super.whenLayerView(e)}graphicChanged(e){this.graphicsView&&this.graphicsView.graphicUpdateHandler(e)}whenReady(){return new Promise(e=>{this.ready?e(this):this._resolveWhenReady.push(e)})}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var e,i,r;return this.map&&"initialViewProperties"in this.map&&((i=(e=this.map)==null?void 0:e.initialViewProperties)==null?void 0:i.spatialReference)||((r=this.defaultsFromMap)==null?void 0:r.spatialReference)||null}hasLayerViewModule(e){return dge.hasLayerViewModule(e)}importLayerView(e){return dge.importLayerView(e)}pixelSizeAt(){return this.ready?this.state.resolution:(re.getLogger(this.declaredClass).error("#pixelSizeAt()","Map view cannot be used before it is ready"),null)}popupHitTest(e){return this.hitTest(e).then(i=>({...i,mapPoint:this.toMap(e)}))}requestUpdate(){this.ready&&this.frameTask.requestUpdate()}validate(){let e=k$e(this.type);return ue("safari")&&ue("safari")<9&&(e=new H("mapview:browser-not-supported","This browser is not supported by MapView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:ue("safari")})),v(e)?(re.getLogger(this.declaredClass).warn("#validate()",e.message),Promise.reject(e)):rmt()}_createAnimation(){return this.animation&&!this.animation.done||(this.animation=new P_),this.animation}_cancellableGoTo(e,i,r){const n=()=>e===this._gotoTask,s=r.then(()=>{n()&&(this.animation=null)}).catch(a=>{throw n()&&(i&&!i.done&&(i.stop(),this.frameTask.animationInProgress=!1),this.animation=null),a}),o=new Promise(a=>a(s));return i.when().catch(()=>{n()&&o.cancel&&o.cancel()}),o}_gotoImmediate(e,i){const r=this._gotoTask,n=this.animation,s=e.then(o=>{if(ui(i),r!==this._gotoTask)throw new H("view:goto-interrupted","Goto was interrupted");this.viewpoint=n.target=o,n.finish()});return this._cancellableGoTo(r,n,s)}_flipStationary(e){return this._stationaryTimer!==null||(this._stationaryTimer=setTimeout(()=>{this._stationaryTimer=null;const i=performance.now()-this._lastStationaryEventTimestamp;i<Nge&&(this._stationaryTimer=this._flipStationary(i))},e)),this._stationaryTimer}_getDefaultViewpoint(){var w,x,T,E;const{constraints:e,initialExtent:i,map:r,padding:n,size:s}=this;if(!e)return null;const o=r&&"initialViewProperties"in r?r.initialViewProperties:void 0,a={zoom:this._get("zoom"),scale:this._get("scale"),center:this._get("center"),extent:this._get("extent"),rotation:this._get("rotation"),viewpoint:this._get("viewpoint"),spatialReference:this._userSpatialReference};e.effectiveLODs?a.zoom!==-1&&(a.scale=e.zoomToScale(a.zoom)):a.zoom=-1;let l=null,c=null,h=0;const p=a.viewpoint&&a.viewpoint.rotation,f=a.viewpoint&&a.viewpoint.targetGeometry;v(f)&&(f.type==="extent"?l=f:f.type==="point"&&(c=f,h=a.viewpoint.scale));const m=a.extent||l||((x=(w=o==null?void 0:o.viewpoint)==null?void 0:w.targetGeometry)==null?void 0:x.extent)||i,g=a.center||c||(m==null?void 0:m.center),_=a.scale||h||((T=o==null?void 0:o.viewpoint)==null?void 0:T.scale)||m&&H$(m,[s[0]-n.left-n.right,s[1]-n.top-n.bottom]),b=a.rotation||p||((E=o==null?void 0:o.viewpoint)==null?void 0:E.rotation)||0;return g&&_?new Jn({targetGeometry:g,scale:_,rotation:b}):null}_gotoAnimated(e,i){const r=this._gotoTask,n=this.animation;if(!n)return Promise.resolve();const s=e.then(o=>{if(ui(i),r!==this._gotoTask)throw new H("view:goto-interrupted","Goto was interrupted");return n.update(o),this.animationManager.animate(n,this.viewpoint,i),n.when().then(()=>{},()=>{})});return this._cancellableGoTo(r,n,s)}_project(e,i){var s;const r=e&&e.targetGeometry||e;if(!i)return e;if(!r)return null;if(i.imageCoordinateSystem||(s=r.spatialReference)!=null&&s.imageCoordinateSystem||Dn(i,r.spatialReference))return e;const n=Sm(r,i);if(!n)throw new H("mapview:projection-not-possible","projecting input geometry to target spatial reference returned a null value",{geometry:r,spatialReference:i});return nmt(e)?(e.targetGeometry=n,e):n}_resizeHandler(e){if(!this.ready)return;const i=this.state;let r=this.state.paddedViewState.viewpoint;const n=this.state.paddedViewState.size.concat();i.size=[e.width,e.height],zdt(r,r,n,this.state.paddedViewState.size,this.resizeAlign),r=this.constraints.constrain(r,void 0),this.state.viewpoint=r}_startup(){var l,c;this.timeline.begin("MapView Startup");const e=this._getDefaultViewpoint(),i=e.targetGeometry;try{this._project(e,this.spatialReference)}catch(h){re.getLogger(this.declaredClass).warn(new Op("mapview:startup-projection-error","projection of initial viewpoint to the view's spatial reference, defaulting to the initial viewpoint.",{center:i.toJSON(),spatialReference:this.spatialReference,error:h})),e.targetGeometry=((l=this.defaultsFromMap.extent)==null?void 0:l.center)||new Le({x:0,y:0,spatialReference:this.spatialReference})}(c=this.constraints)==null||c.fit(e),this._set("state",new bpt({padding:this._get("padding"),size:this.size,viewpoint:e})),this.graphics.owner=this;const r=new q$e(this.surface,{canvas:this.renderCanvas,supersampleScreenshots:this.supersampleScreenshotsEnabled,contextOptions:{disabledExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions},renderingOptions:this.renderingOptions,timeline:this.timeline});this._stage=r,this._magnifierView=new J$e,this._magnifierView.magnifier=this.magnifier;const n=new Y$e({view:this});this._set("labelManager",n);const s=new Hdt({view:this});this._set("animationManager",s);const o=new Z$e({view:this,animationManager:s});this._set("mapViewNavigation",o),this._setupSpatialReferenceDependentProperties(),this.handles.add([this.rootLayerViews.on("change",()=>this._updateStageChildren()),r.on("post-render",()=>this._set("rendering",r.renderRequested)),r.on("will-render",()=>this._set("rendering",r.renderRequested)),r.on("webgl-error",h=>this.fatalError=h.error),ne(()=>this.stationary,h=>r.stationary=h,Jr),ne(()=>this.background,h=>{r.background=h,this._magnifierView.background=h},Jr),ne(()=>this.magnifier,h=>this._magnifierView.magnifier=h,Jr),ne(()=>this.renderingOptions,h=>r.renderingOptions=h,Jr),ne(()=>this.highlightOptions,h=>r.highlightOptions=h,Jr),ne(()=>this.state.id,()=>r.state=this.state,Jr)],"map-view"),this._updateStageChildren();const a=this._resolveWhenReady;this._resolveWhenReady=[],a.forEach(h=>h(this)),this.timeline.end("MapView Startup"),this.frameTask&&this.frameTask.start(),this._set("ready",!0)}_teardown(){this._destroySpatialReferenceDependentProperties(),this.handles.remove("map-view"),this.mapViewNavigation.destroy(),this._set("mapViewNavigation",null),this.animationManager.destroy(),this._set("animationManager",null),this.layerViewManager.clear(),this.labelManager.destroy(),this._magnifierView.destroy(),this._stage.destroy(),this._stage=null,this._set("graphicsView",null),this._magnifierView=null,this._set("labelManager",null),this._set("mapViewNavigation",null),this.graphics.owner=null,this.frameTask&&this.frameTask.stop(),this._stationaryTimer&&(clearTimeout(this._stationaryTimer),this._stationaryTimer=null),this._set("ready",!1);const{center:[e,i],spatialReference:r,rotation:n,scale:s}=this.state.paddedViewState,o=new Le({x:e,y:i,spatialReference:r});this._set("viewpoint",null),this._set("extent",null),this._set("center",o),this._set("zoom",-1),this._set("rotation",n),this._set("scale",s),this._set("spatialReference",r),this._set("state",null),this.animation=null}_updateStageChildren(){this._stage.removeAllChildren(),this.rootLayerViews.forEach(i=>{this._stage.addChild(i.container)});const e=this.graphicsView;this._stage.addChild(e.container),this._stage.addChild(this._magnifierView)}_setupSpatialReferenceDependentProperties(){const e=new Apt(M$.create({spatialReference:this.spatialReference,size:512,numLODs:36}));this._set("featuresTilingScheme",e);const i=new W$e({view:this,graphics:this.graphics,requestUpdateCallback:()=>this.requestUpdate(),container:new X$e(e)});this.frameTask.graphicsView=i,this._set("graphicsView",i)}_destroySpatialReferenceDependentProperties(){const e=this.graphicsView;this._set("graphicsView",null),this.frameTask.graphicsView=null,e.destroy(),this._set("featuresTilingScheme",null)}_spatialReferenceChanged(e){if(!this.ready)return;this.frameTask.stop();for(const l of this.allLayerViews)l.processDetach();this._destroySpatialReferenceDependentProperties();const i=this.state.paddedViewState.clone();if(R(this._scaleBeforeChangingSpatialReference))this._scaleBeforeChangingSpatialReference=i.scale;else{const l=i.viewpoint.clone();l.scale=this._scaleBeforeChangingSpatialReference,i.viewpoint=l}const r=i.clone(),[n,s]=i.center;let o=null;try{o=this._project(new Le({x:n,y:s,spatialReference:i.spatialReference}),e)}catch(l){c2()||re.getLogger(this.declaredClass).warn(new Op("mapview:spatial-reference-change","could not project the view's center to the new spatial reference",{center:o==null?void 0:o.toJSON(),spatialReference:e,error:l}))}o||(o=new Le({x:0,y:0,spatialReference:e}));const a=bQ(new Jn({targetGeometry:new Le,scale:0,rotation:0}),i.viewpoint,o);r.viewpoint=a;try{const c=[i.size[0]/2,i.size[1]/2],h=[c[0]+20,c[1]],p=i.toMap([0,0],h),{x:f,y:m}=this._project(new Le({x:p[0],y:p[1],spatialReference:i.spatialReference}),e);p[0]=f,p[1]=m,r.toScreen(p,p);const g=Udt(c,p,h),_=Math.hypot(p[0]-c[0],p[1]-c[1])/20;!Number.isFinite(_)||Math.abs(_)>4?(a.rotation=0,a.targetGeometry=new Le({x:0,y:0,spatialReference:e})):(a.scale*=_,a.scale>ue("mapview-srswitch-adjust-rotation-scale-threshold")?a.rotation=0:a.rotation+=Number.isFinite(g)?g:0)}catch{}this._get("constraints").constrain(a,void 0),this._get("state").viewpoint=a,this._stage.state=this.state,this._setupSpatialReferenceDependentProperties();for(const l of this.allLayerViews)l.processAttach();this.frameTask.requestFrame(),this.frameTask.start(),this._updateStageChildren()}};di.type="2d",u([d({readOnly:!0})],di.prototype,"animationManager",void 0),u([d({constructOnly:!0})],di.prototype,"deactivatedWebGLExtensions",void 0),u([d({constructOnly:!0})],di.prototype,"debugWebGLExtensions",void 0),u([d({readOnly:!0})],di.prototype,"featuresTilingScheme",void 0),u([d({readOnly:!0})],di.prototype,"fullOpacity",void 0),u([d({readOnly:!0})],di.prototype,"graphicsTileStore",null),u([d()],di.prototype,"graphicsView",void 0),u([d({readOnly:!0})],di.prototype,"state",void 0),u([d()],di.prototype,"initialExtentRequired",null),u([d()],di.prototype,"labelManager",void 0),u([d({readOnly:!0})],di.prototype,"resourceManager",null),u([d({readOnly:!0})],di.prototype,"textureManager",null),u([d({readOnly:!0})],di.prototype,"mapViewNavigation",void 0),u([d({constructOnly:!0})],di.prototype,"renderCanvas",void 0),u([d()],di.prototype,"renderingOptions",void 0),u([d({readOnly:!0})],di.prototype,"rendering",void 0),u([d({constructOnly:!0})],di.prototype,"supersampleScreenshotsEnabled",void 0),u([d({readOnly:!0})],di.prototype,"supportsGround",void 0),u([d()],di.prototype,"_stationaryTimer",void 0),u([d()],di.prototype,"_defaultsFromMapSettings",null),u([d()],di.prototype,"_pePromise",void 0),u([d({readOnly:!0})],di.prototype,"typeSpecificPreconditionsReady",null),u([d()],di.prototype,"animation",null),u([d({type:VB})],di.prototype,"background",null),u([d({value:null,type:Le,dependsOn:["state.id","ready"]})],di.prototype,"center",null),u([d({type:o$e})],di.prototype,"constraints",null),u([d({value:null,type:ni,dependsOn:["state.id","ready"]})],di.prototype,"extent",null),u([d()],di.prototype,"floors",void 0),u([d({type:R$e})],di.prototype,"highlightOptions",void 0),u([d({readOnly:!0})],di.prototype,"inputManager",void 0),u([d()],di.prototype,"map",void 0),u([d({value:{top:0,right:0,bottom:0,left:0},cast:t=>({top:0,right:0,bottom:0,left:0,...t})})],di.prototype,"padding",null),u([d()],di.prototype,"resizeAlign",void 0),u([d({readOnly:!0,dependsOn:["state.id"]})],di.prototype,"resolution",null),u([d({value:0,type:Number,dependsOn:["state.id","ready"]})],di.prototype,"rotation",null),u([d({value:0,type:Number,dependsOn:["state.id","ready"]})],di.prototype,"scale",null),u([d({constructOnly:!0})],di.prototype,"spatialReferenceLocked",void 0),u([d()],di.prototype,"stationary",null),u([d({type:M$e,readOnly:!0})],di.prototype,"timeline",void 0),u([d({readOnly:!0})],di.prototype,"type",void 0),u([d({readOnly:!0})],di.prototype,"updating",null),u([d({value:null,type:Jn,dependsOn:["state.id","ready"]})],di.prototype,"viewpoint",null),u([d({value:-1,dependsOn:["state.id","ready"]})],di.prototype,"zoom",null),u([d({readOnly:!0})],di.prototype,"navigating",null),u([d({type:H$e})],di.prototype,"ui",void 0),di=u([$("esri.views.MapView")],di);const K$e=di;function PQ(t){var i,r;const e=t.getObjectId();return e?`${((i=t.layer)==null?void 0:i.uid)??((r=t.sourceLayer)==null?void 0:r.uid)??"MapView"}/${e}`:`"MapView/${t.uid}`}function Fge(t,e,i,r,n){return s=>{if(s instanceof Ha){if(s.layer===t)n==null||n();else{const o=t.allLayerViews.find(a=>a.layer===s.layer);o&&(r==null||r(o))}i(PQ(s))}else{const o=t.allLayerViews.find(a=>a.layer===s);o&&e(o)}}}function kge(t,e){if(t)if(UL(t))for(const i of t)if(UL(i))for(const r of i)e(r);else e(i);else e(t)}function smt(t){return(t==null?void 0:t.declaredClass)==="esri.WebMap"}function wr(){return[1,0,0,0,1,0,0,0,1]}function omt(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]}function Q$e(t,e,i,r,n,s,o,a,l){return[t,e,i,r,n,s,o,a,l]}function eLe(t,e){return new Float64Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:omt,create:wr,createView:eLe,fromValues:Q$e},Symbol.toStringTag,{value:"Module"}));const Ph=P(),sA=wr(),xH=wr(),Uge=wr();function xb(t,e,i){return he(Ph,e[0],e[1],1),Wl(Ph,Ph,Qu(sA,i)),Ph[2]===0?dt(t,Ph[0],Ph[1]):dt(t,Ph[0]/Ph[2],Ph[1]/Ph[2])}function amt(t,e,i){return Vge(xH,e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]),Vge(Uge,i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7]),pw(t,qoe(xH,xH),Uge),t[8]!==0&&(t[0]/=t[8],t[1]/=t[8],t[2]/=t[8],t[3]/=t[8],t[4]/=t[8],t[5]/=t[8],t[6]/=t[8],t[7]/=t[8],t[8]/=t[8]),t}function Vge(t,e,i,r,n,s,o,a,l){fD(t,e,r,s,i,n,o,1,1,1),he(Ph,a,l,1),qoe(sA,t);const[c,h,p]=Wl(Ph,Ph,Qu(sA,sA));return fD(sA,c,0,0,0,h,0,0,0,p),pw(t,sA,t)}let IQ=class extends RY{projectOrWarn(e,i){if(R(e))return e;const{geometry:r,pending:n}=yV(e,i);return n?null:n||r?r:(re.getLogger(this.declaredClass).warn("geometry could not be projected to the spatial reference",{georeference:this,geometry:e,sourceSpatialReference:e.spatialReference,targetSpatialReference:i}),null)}};IQ=u([$("esri.layers.support.GeoreferenceBase")],IQ);const zB=IQ,TH=wr(),wo=Fe();let wI=class extends ve{constructor(){super(...arguments),this.sourcePoint=null,this.mapPoint=null}};u([d()],wI.prototype,"sourcePoint",void 0),u([d({type:Le})],wI.prototype,"mapPoint",void 0),wI=u([$("esri.layers.support.ControlPoint")],wI);let wf=class extends Pw(zB){constructor(e){super(e),this.controlPoints=null,this.height=0,this.type="control-points",this.width=0}readControlPoints(e,i){const r=Je.fromJSON(i.spatialReference),n=Q$e(...i.coefficients,1);return e.map(s=>(dt(wo,s.x,s.y),xb(wo,wo,n),{sourcePoint:s,mapPoint:new Le({x:wo[0],y:wo[1],spatialReference:r})}))}writeControlPoints(e,i,r,n){if(R(this.transform)){const s=new H("web-document-write:invalid-georeference","Invalid 'controlPoints', 'width', 'height' configuration.",{layer:n==null?void 0:n.layer,georeference:this});n!=null&&n.messages?n.messages.push(s):re.getLogger(this.declaredClass).error(s.name,s.message)}else v(e)&&cc(e[0])&&(i.controlPoints=e.map(s=>{const o=s.sourcePoint;return{x:o.x,y:o.y}}),i.spatialReference=e[0].mapPoint.spatialReference.toJSON(),i.coefficients=this.transform.slice(0,8))}get coords(){if(R(this.controlPoints))return null;const e=this._updateTransform(TH);if(R(e)||!cc(this.controlPoints[0]))return null;const i=this.controlPoints[0].mapPoint.spatialReference;return dmt(e,this.width,this.height,i)}set coords(e){if(R(this.controlPoints)||!cc(this.controlPoints[0]))return;const i=this.controlPoints[0].mapPoint.spatialReference;if(e=this.projectOrWarn(e,i),R(e))return;const{width:r,height:n}=this,{rings:[[s,o,a,l]]}=e,c={sourcePoint:Ws(0,n),mapPoint:new Le({x:s[0],y:s[1],spatialReference:i})},h={sourcePoint:Ws(0,0),mapPoint:new Le({x:o[0],y:o[1],spatialReference:i})},p={sourcePoint:Ws(r,0),mapPoint:new Le({x:a[0],y:a[1],spatialReference:i})},f={sourcePoint:Ws(r,n),mapPoint:new Le({x:l[0],y:l[1],spatialReference:i})};cc(c)&&cc(h)&&cc(p)&&cc(f)&&(zge(TH,c,h,p,f),this.controlPoints=this.controlPoints.map(({sourcePoint:m})=>(dt(wo,m.x,m.y),xb(wo,wo,TH),{sourcePoint:m,mapPoint:new Le({x:wo[0],y:wo[1],spatialReference:i})})))}get inverseTransform(){return R(this.transform)?null:Uw(wr(),this.transform)}get transform(){return this._updateTransform()}toMap(e){if(R(e)||R(this.transform)||R(this.controlPoints)||!cc(this.controlPoints[0]))return null;dt(wo,e.x,e.y);const i=this.controlPoints[0].mapPoint.spatialReference;return xb(wo,wo,this.transform),new Le({x:wo[0],y:wo[1],spatialReference:i})}toSource(e){if(R(e)||R(this.inverseTransform)||R(this.controlPoints)||!cc(this.controlPoints[0]))return null;const i=this.controlPoints[0].mapPoint.spatialReference;return e=e.normalize(),e=yV(e,i).geometry,R(e)?null:(dt(wo,e.x,e.y),xb(wo,wo,this.inverseTransform),Ws(wo[0],wo[1]))}_updateTransform(e){const{controlPoints:i,width:r,height:n}=this;if(R(i)||!(r>0)||!(n>0))return null;const[s,o,a,l]=i;if(!cc(s))return null;const c=s.mapPoint.spatialReference,h=this._projectControlPoint(o,c),p=this._projectControlPoint(a,c),f=this._projectControlPoint(l,c);if(!h.valid||!p.valid||!f.valid||!cc(h.controlPoint))return null;R(e)&&(e=wr());let m=null;return m=cc(p.controlPoint)&&cc(f.controlPoint)?zge(e,s,h.controlPoint,p.controlPoint,f.controlPoint):cc(p.controlPoint)?cmt(e,s,h.controlPoint,p.controlPoint):lmt(e,s,h.controlPoint),m.every(g=>g===0)?null:m}_projectControlPoint(e,i){if(!cc(e))return{valid:!0,controlPoint:e};const{sourcePoint:r,mapPoint:n}=e,{geometry:s,pending:o}=yV(n,i);return o?{valid:!1,controlPoint:null}:o||s?{valid:!0,controlPoint:{sourcePoint:r,mapPoint:s}}:(re.getLogger(this.declaredClass).warn("map point could not be projected to the spatial reference",{georeference:this,controlPoint:e,sourceSpatialReference:n.spatialReference,targetSpatialReference:i}),{valid:!1,controlPoint:null})}};function cc(t){return v(t)&&v(t.sourcePoint)&&v(t.mapPoint)}u([d({type:[wI],json:{write:{allowNull:!1,isRequired:!0}}})],wf.prototype,"controlPoints",void 0),u([Oe("controlPoints")],wf.prototype,"readControlPoints",null),u([Ne("controlPoints")],wf.prototype,"writeControlPoints",null),u([d()],wf.prototype,"coords",null),u([d({json:{write:!0}})],wf.prototype,"height",void 0),u([d({readOnly:!0})],wf.prototype,"inverseTransform",null),u([d({readOnly:!0})],wf.prototype,"transform",null),u([d({json:{write:!0}})],wf.prototype,"width",void 0),wf=u([$("esri.layers.support.ControlPointsGeoreference")],wf);const J0=Fe(),K0=Fe(),US=Fe(),Tb=Fe(),Q0=Fe(),e_=Fe(),VS=Fe(),Sb=Fe(),P4=Math.PI/2;function t_(t,e,i){dt(t,i.sourcePoint.x,i.sourcePoint.y),dt(e,i.mapPoint.x,i.mapPoint.y)}function lmt(t,e,i){return t_(J0,Q0,e),t_(K0,e_,i),xS(US,K0,J0,P4),xS(Tb,J0,K0,P4),xS(VS,e_,Q0,-P4),xS(Sb,Q0,e_,-P4),iae(t,J0,K0,US,Tb,Q0,e_,VS,Sb)}function cmt(t,e,i,r){return t_(J0,Q0,e),t_(K0,e_,i),t_(US,VS,r),K1(Tb,J0,K0,.5),xS(Tb,US,Tb,Math.PI),K1(Sb,Q0,e_,.5),xS(Sb,VS,Sb,Math.PI),iae(t,J0,K0,US,Tb,Q0,e_,VS,Sb)}function zge(t,e,i,r,n){return t_(J0,Q0,e),t_(K0,e_,i),t_(US,VS,r),t_(Tb,Sb,n),iae(t,J0,K0,US,Tb,Q0,e_,VS,Sb)}const umt=new Array(8).fill(0),hmt=new Array(8).fill(0);function Bge(t,e,i,r,n){return t[0]=e[0],t[1]=e[1],t[2]=i[0],t[3]=i[1],t[4]=r[0],t[5]=r[1],t[6]=n[0],t[7]=n[1],t}function iae(t,e,i,r,n,s,o,a,l){return amt(t,Bge(umt,e,i,r,n),Bge(hmt,s,o,a,l))}function dmt(t,e,i,r){const n=Mi(0,i),s=Mi(0,0),o=Mi(e,0),a=Mi(e,i);return xb(n,n,t),xb(s,s,t),xb(o,o,t),xb(a,a,t),new ec({rings:[[n,s,o,a,n]],spatialReference:r})}const rae=wf;let T1=class extends zB{constructor(e){super(e),this.bottomLeft=null,this.bottomRight=null,this.topLeft=null,this.topRight=null,this.type="corners"}get coords(){let{topLeft:e,topRight:i,bottomLeft:r,bottomRight:n}=this;if(R(e)||R(i)||R(r)||R(n))return null;const s=e.spatialReference;return i=this.projectOrWarn(i,s),r=this.projectOrWarn(r,s),n=this.projectOrWarn(n,s),R(i)||R(r)||R(n)?null:new ec({rings:[[[r.x,r.y],[e.x,e.y],[i.x,i.y],[n.x,n.y],[r.x,r.y]]],spatialReference:s})}set coords(e){const{topLeft:i}=this;if(R(i))return;const r=i.spatialReference;if(e=this.projectOrWarn(e,r),R(e))return;const{rings:[[n,s,o,a]]}=e;this.bottomLeft=new Le({x:n[0],y:n[1],spatialReference:r}),this.topLeft=new Le({x:s[0],y:s[1],spatialReference:r}),this.topRight=new Le({x:o[0],y:o[1],spatialReference:r}),this.bottomRight=new Le({x:a[0],y:a[1],spatialReference:r})}};u([d()],T1.prototype,"coords",null),u([d({type:Le})],T1.prototype,"bottomLeft",void 0),u([d({type:Le})],T1.prototype,"bottomRight",void 0),u([d({type:Le})],T1.prototype,"topLeft",void 0),u([d({type:Le})],T1.prototype,"topRight",void 0),T1=u([$("esri.layers.support.CornersGeoreference")],T1);const pmt=T1;let oA=class extends zB{constructor(e){super(e),this.extent=null,this.rotation=0,this.type="extent-and-rotation"}get coords(){if(R(this.extent))return null;const{xmin:e,ymin:i,xmax:r,ymax:n,spatialReference:s}=this.extent;let o;if(this.rotation){const{x:a,y:l}=this.extent.center,c=jge(a,l,this.rotation);o=[c(e,i),c(e,n),c(r,n),c(r,i)],o.push(o[0])}else o=[[e,i],[e,n],[r,n],[r,i],[e,i]];return new ec({rings:[o],spatialReference:s})}set coords(e){if(R(e)||R(this.extent))return;const i=this.extent.spatialReference;if(e=this.projectOrWarn(e,i),R(e)||R(e.extent))return;const{rings:[[r,n,s]],extent:{center:{x:o,y:a}}}=e,l=ml(Math.PI/2-Math.atan2(n[1]-r[1],n[0]-r[0])),c=jge(o,a,-l),[h,p]=c(r[0],r[1]),[f,m]=c(s[0],s[1]);this.extent=new ni({xmin:h,ymin:p,xmax:f,ymax:m,spatialReference:i}),this.rotation=l}};function jge(t,e,i){const r=wN(i),n=Math.cos(r),s=Math.sin(r);return(o,a)=>[n*(o-t)+s*(a-e)+t,n*(a-e)-s*(o-t)+e]}u([d()],oA.prototype,"coords",null),u([d({type:ni})],oA.prototype,"extent",void 0),u([d({type:Number})],oA.prototype,"rotation",void 0),oA=u([$("esri.layers.support.ExtentAndRotationGeoreference")],oA);const nae=oA,fmt={key:"type",base:zB,typeMap:{"control-points":rae,corners:pmt,"extent-and-rotation":nae}};let aA=class extends V9(Pw(Ju)){constructor(){super(...arguments),this.georeference=null,this.opacity=1}readGeoreference(e){return rae.fromJSON(e)}};u([d({types:fmt,json:{write:!0}})],aA.prototype,"georeference",void 0),u([Oe("georeference")],aA.prototype,"readGeoreference",null),u([d()],aA.prototype,"opacity",void 0),aA=u([$("esri.layers.support.MediaElementBase")],aA);const sae=aA;function mmt(t){return oae[gmt(t)]||_mt}function gmt(t){return t instanceof Blob?t.type:ymt(t.url)}function ymt(t){const e=pXe(t);return $Q[e]||tLe}const oae={},tLe="text/plain",_mt=oae[tLe],$Q={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(const t in $Q)oae[$Q[t]]=t;let S1=class extends sae{constructor(e){super(e),this.content=null,this.image=null,this.type="image",this.image=null}load(){const e=this.image;if(typeof e=="string"){const i=ir(e,{responseType:"image"}).then(({data:r})=>{this._set("content",r)});this.addResolvingPromise(i)}else if(e instanceof HTMLImageElement){const i=e.decode().then(()=>{this._set("content",e)});this.addResolvingPromise(i)}else e?this._set("content",e):this.addResolvingPromise(Promise.reject(new H("image-element:invalid-image-type","Invalid image type",{image:e})));return Promise.resolve(this)}readImage(e,i,r){return G2(i.url,r)}writeImage(e,i,r,n){if(R(e))return;const s=n==null?void 0:n.portalItem,o=n==null?void 0:n.resources;if(!s||!o)return void(typeof e=="string"&&(i[r]=R_(e,n)));const a=typeof e!="string"||fd(e)||tw(e)?null:e;if(a){if(HCe(a)==null)return void(i[r]=a);const l=R_(a,{...n,verifyItemRelativeUrls:n&&n.verifyItemRelativeUrls?{writtenUrls:n.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},SM.NO);if(s&&l&&!Wu(l))return o.toKeep.push({resource:s.resourceFromPath(l),compress:!1}),void(i[r]=l)}i[r]="<pending>",o.pendingOperations.push(iLe(e).then(l=>{const c=bmt(l,s);i[r]=c.itemRelativeUrl,o.toAdd.push({resource:c,content:l,compress:!1,finish:h=>{this.image=h.url}})}))}};u([d({readOnly:!0})],S1.prototype,"content",void 0),u([d({json:{name:"url",type:String}})],S1.prototype,"image",void 0),u([Oe("image",["url"])],S1.prototype,"readImage",null),u([Ne("image")],S1.prototype,"writeImage",null),u([d({readOnly:!0,json:{name:"mediaType"}})],S1.prototype,"type",void 0),S1=u([$("esri.layers.support.ImageElement")],S1);const QV=S1;async function iLe(t){if(typeof t=="string"){if(tw(t)){const{data:e}=await ir(t,{responseType:"blob"});return e}return fd(t)?eXe(t):iLe((await ir(t,{responseType:"image"})).data)}return new Promise(e=>vmt(t).toBlob(e))}function vmt(t){if(t instanceof HTMLCanvasElement)return t;const e=t instanceof HTMLImageElement?t.naturalWidth:t.width,i=t instanceof HTMLImageElement?t.naturalHeight:t.height,r=document.createElement("canvas"),n=r.getContext("2d");return r.width=e,r.height=i,t instanceof HTMLImageElement?n.drawImage(t,0,0,t.width,t.height):t instanceof ImageData&&n.putImageData(t,0,0),r}function bmt(t,e){const i=NRe(),r=`${ew("media",i)}.${mmt(t)}`;return e.resourceFromPath(r)}let wmt=class{constructor(e=9,i){this._compareMinX=Gge,this._compareMinY=Hge,this._toBBox=r=>r,this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),i&&(typeof i=="function"?this._toBBox=i:this._initFormat(i)),this.clear()}destroy(){this.clear(),rx.prune(),L4.prune(),iu.prune(),D4.prune()}all(e){this._all(this._data,e)}search(e,i){let r=this._data;const n=this._toBBox;if($4(e,r))for(rx.clear();r;){for(let s=0,o=r.children.length;s<o;s++){const a=r.children[s],l=r.leaf?n(a):a;$4(e,l)&&(r.leaf?i(a):EH(e,l)?this._all(a,i):rx.push(a))}r=rx.pop()}}collides(e){let i=this._data;const r=this._toBBox;if(!$4(e,i))return!1;for(rx.clear();i;){for(let n=0,s=i.children.length;n<s;n++){const o=i.children[n],a=i.leaf?r(o):o;if($4(e,a)){if(i.leaf||EH(e,a))return!0;rx.push(o)}}i=rx.pop()}return!1}load(e){if(!e.length)return this;if(e.length<this._minEntries){for(let r=0,n=e.length;r<n;r++)this.insert(e[r]);return this}let i=this._build(e.slice(0,e.length),0,e.length-1,0);if(this._data.children.length)if(this._data.height===i.height)this._splitRoot(this._data,i);else{if(this._data.height<i.height){const r=this._data;this._data=i,i=r}this._insert(i,this._data.height-i.height-1,!0)}else this._data=i;return this}insert(e){return e&&this._insert(e,this._data.height-1),this}clear(){return this._data=new wU([]),this}remove(e){if(!e)return this;let i,r=this._data,n=null,s=0,o=!1;const a=this._toBBox(e);for(iu.clear(),D4.clear();r||iu.length>0;){if(r||(r=iu.pop(),n=iu.data[iu.length-1],s=D4.pop()??0,o=!0),r.leaf&&(i=DL(r.children,e,r.children.length,r.indexHint),i!==-1))return r.children.splice(i,1),iu.push(r),this._condense(iu),this;o||r.leaf||!EH(r,a)?n?(s++,r=n.children[s],o=!1):r=null:(iu.push(r),D4.push(s),s=0,n=r,r=r.children[0])}return this}toJSON(){return this._data}fromJSON(e){return this._data=e,this}_all(e,i){let r=e;for(L4.clear();r;){if(r.leaf===!0)for(const n of r.children)i(n);else L4.pushArray(r.children);r=L4.pop()??null}}_build(e,i,r,n){const s=r-i+1;let o=this._maxEntries;if(s<=o){const h=new wU(e.slice(i,r+1));return _E(h,this._toBBox),h}n||(n=Math.ceil(Math.log(s)/Math.log(o)),o=Math.ceil(s/o**(n-1)));const a=new CH([]);a.height=n;const l=Math.ceil(s/o),c=l*Math.ceil(Math.sqrt(o));qge(e,i,r,c,this._compareMinX);for(let h=i;h<=r;h+=c){const p=Math.min(h+c-1,r);qge(e,h,p,l,this._compareMinY);for(let f=h;f<=p;f+=l){const m=Math.min(f+l-1,p);a.children.push(this._build(e,f,m,n-1))}}return _E(a,this._toBBox),a}_chooseSubtree(e,i,r,n){for(;n.push(i),i.leaf!==!0&&n.length-1!==r;){let s,o=1/0,a=1/0;for(let l=0,c=i.children.length;l<c;l++){const h=i.children[l],p=SH(h),f=xmt(e,h)-p;f<a?(a=f,o=p<o?p:o,s=h):f===a&&p<o&&(o=p,s=h)}i=s||i.children[0]}return i}_insert(e,i,r){const n=this._toBBox,s=r?e:n(e);iu.clear();const o=this._chooseSubtree(s,this._data,i,iu);for(o.children.push(e),TI(o,s);i>=0&&iu.data[i].children.length>this._maxEntries;)this._split(iu,i),i--;this._adjustParentBBoxes(s,iu,i)}_split(e,i){const r=e.data[i],n=r.children.length,s=this._minEntries;this._chooseSplitAxis(r,s,n);const o=this._chooseSplitIndex(r,s,n);if(!o)return void console.log("  Error: assertion failed at PooledRBush._split: no valid split index");const a=r.children.splice(o,r.children.length-o),l=r.leaf?new wU(a):new CH(a);l.height=r.height,_E(r,this._toBBox),_E(l,this._toBBox),i?e.data[i-1].children.push(l):this._splitRoot(r,l)}_splitRoot(e,i){this._data=new CH([e,i]),this._data.height=e.height+1,_E(this._data,this._toBBox)}_chooseSplitIndex(e,i,r){let n,s,o;n=s=1/0;for(let a=i;a<=r-i;a++){const l=xI(e,0,a,this._toBBox),c=xI(e,a,r,this._toBBox),h=Tmt(l,c),p=SH(l)+SH(c);h<n?(n=h,o=a,s=p<s?p:s):h===n&&p<s&&(s=p,o=a)}return o}_chooseSplitAxis(e,i,r){const n=e.leaf?this._compareMinX:Gge,s=e.leaf?this._compareMinY:Hge;this._allDistMargin(e,i,r,n)<this._allDistMargin(e,i,r,s)&&e.children.sort(n)}_allDistMargin(e,i,r,n){e.children.sort(n);const s=this._toBBox,o=xI(e,0,i,s),a=xI(e,r-i,r,s);let l=I4(o)+I4(a);for(let c=i;c<r-i;c++){const h=e.children[c];TI(o,e.leaf?s(h):h),l+=I4(o)}for(let c=r-i-1;c>=i;c--){const h=e.children[c];TI(a,e.leaf?s(h):h),l+=I4(a)}return l}_adjustParentBBoxes(e,i,r){for(let n=r;n>=0;n--)TI(i.data[n],e)}_condense(e){for(let i=e.length-1;i>=0;i--){const r=e.data[i];if(r.children.length===0)if(i>0){const n=e.data[i-1],s=n.children;s.splice(DL(s,r,s.length,n.indexHint),1)}else this.clear();else _E(r,this._toBBox)}}_initFormat(e){const i=["return a"," - b",";"];this._compareMinX=new Function("a","b",i.join(e[0])),this._compareMinY=new Function("a","b",i.join(e[1])),this._toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}};function _E(t,e){xI(t,0,t.children.length,e,t)}function xI(t,e,i,r,n){n||(n=new wU([])),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(let s,o=e;o<i;o++)s=t.children[o],TI(n,t.leaf?r(s):s);return n}function TI(t,e){t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY)}function Gge(t,e){return t.minX-e.minX}function Hge(t,e){return t.minY-e.minY}function SH(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function I4(t){return t.maxX-t.minX+(t.maxY-t.minY)}function xmt(t,e){return(Math.max(e.maxX,t.maxX)-Math.min(e.minX,t.minX))*(Math.max(e.maxY,t.maxY)-Math.min(e.minY,t.minY))}function Tmt(t,e){const i=Math.max(t.minX,e.minX),r=Math.max(t.minY,e.minY),n=Math.min(t.maxX,e.maxX),s=Math.min(t.maxY,e.maxY);return Math.max(0,n-i)*Math.max(0,s-r)}function EH(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function $4(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function qge(t,e,i,r,n){const s=[e,i];for(;s.length;){const o=s.pop(),a=s.pop();if(o-a<=r)continue;const l=a+Math.ceil((o-a)/r/2)*r;C$e(t,l,a,o,n),s.push(a,l,l,o)}}const rx=new Wt,L4=new Wt,iu=new Wt,D4=new Wt({deallocator:void 0});let Smt=class{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}},rLe=class extends Smt{constructor(){super(...arguments),this.height=1,this.indexHint=new kre}},wU=class extends rLe{constructor(e){super(),this.children=e,this.leaf=!0}},CH=class extends rLe{constructor(e){super(),this.children=e,this.leaf=!1}};const Emt=5e4,SI={minX:0,minY:0,maxX:0,maxY:0};function Cmt(t){SI.minX=t[0],SI.minY=t[1],SI.maxX=t[2],SI.maxY=t[3]}function Amt(t,e,i){Cmt(e),t.search(SI,i)}let Rmt=class{constructor(){this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new wmt(9,ue("esri-csp-restrictions")?e=>({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}):["[0]","[1]","[2]","[3]"]),this._loadIndex=()=>{if(this._indexInvalid){const e=new Array(this._idByBounds.size);let i=0;this._idByBounds.forEach((r,n)=>{e[i++]=n}),this._indexInvalid=!1,this._index.clear(),this._index.load(e)}else this._boundsToLoad.length&&(this._index.load(Array.from(new Set(this._boundsToLoad.filter(e=>this._idByBounds.has(e))))),this._boundsToLoad.length=0)}}get fullBounds(){if(!this._boundsById.size)return null;const e=od();for(const i of this._boundsById.values())i&&(e[0]=Math.min(i[0],e[0]),e[1]=Math.min(i[1],e[1]),e[2]=Math.max(i[2],e[2]),e[3]=Math.max(i[3],e[3]));return e}get valid(){return!this._indexInvalid}clear(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}delete(e){const i=this._boundsById.get(e);this._boundsById.delete(e),i&&(this._idByBounds.delete(i),this._indexInvalid||this._index.remove(i))}forEachInBounds(e,i){this._loadIndex(),Amt(this._index,e,r=>i(this._idByBounds.get(r)))}get(e){return this._boundsById.get(e)}has(e){return this._boundsById.has(e)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(e,i){if(!this._indexInvalid){const r=this._boundsById.get(e);r&&(this._index.remove(r),this._idByBounds.delete(r))}this._boundsById.set(e,i),i&&(this._idByBounds.set(i,e),this._indexInvalid||(this._boundsToLoad.push(i),this._boundsToLoad.length>Emt&&this._loadIndex()))}};function Mmt(t){return nLe(t,!0)}function CGt(t){return nLe(t,!1)}function nLe(t,e){if(R(t))return null;const i=t.spatialReference,r=bp(i),n="toJSON"in t?t.toJSON():t;if(!r)return n;const s=Kb(i)?102100:4326,o=tR[s].maxX,a=tR[s].minX;if(yN(n))return Wge(n,o,a);if(gN(n))return n.points=n.points.map(l=>Wge(l,o,a)),n;if(D9(n))return Omt(n,r);if(s_(n)||dO(n)){const l=JGe(Imt,n),c={xmin:l[0],ymin:l[1],xmax:l[2],ymax:l[3]},h=mp(c.xmin,a)*(2*o),p=h===0?n:Wse(n,h);return c.xmin+=h,c.xmax+=h,c.xmax>o?Yge(p,o,e):c.xmin<a?Yge(p,a,e):p}return n}function Omt(t,e){if(!e)return t;const i=Pmt(t,e).map(r=>r.extent);return i.length<2?i[0]||t:i.length>2?(t.xmin=e.valid[0],t.xmax=e.valid[1],t):{rings:i.map(r=>[[r.xmin,r.ymin],[r.xmin,r.ymax],[r.xmax,r.ymax],[r.xmax,r.ymin],[r.xmin,r.ymin]])}}function Wge(t,e,i){if(Array.isArray(t)){const r=t[0];if(r>e){const n=mp(r,e);t[0]=r+n*(-2*e)}else if(r<i){const n=mp(r,i);t[0]=r+n*(-2*i)}}else{const r=t.x;if(r>e){const n=mp(r,e);t.x+=n*(-2*e)}else if(r<i){const n=mp(r,i);t.x+=n*(-2*i)}}return t}function Pmt(t,e){const i=[],{ymin:r,ymax:n,xmin:s,xmax:o}=t,a=t.xmax-t.xmin,[l,c]=e.valid,{x:h,frameId:p}=Xge(t.xmin,e),{x:f,frameId:m}=Xge(t.xmax,e),g=h===f&&a>0;if(a>2*c){const _={xmin:s<o?h:f,ymin:r,xmax:c,ymax:n},b={xmin:l,ymin:r,xmax:s<o?f:h,ymax:n},w={xmin:0,ymin:r,xmax:c,ymax:n},x={xmin:l,ymin:r,xmax:0,ymax:n},T=[],E=[];N4(_,w)&&T.push(p),N4(_,x)&&E.push(p),N4(b,w)&&T.push(m),N4(b,x)&&E.push(m);for(let C=p+1;C<m;C++)T.push(C),E.push(C);i.push(new nx(_,[p]),new nx(b,[m]),new nx(w,T),new nx(x,E))}else h>f||g?i.push(new nx({xmin:h,ymin:r,xmax:c,ymax:n},[p]),new nx({xmin:l,ymin:r,xmax:f,ymax:n},[m])):i.push(new nx({xmin:h,ymin:r,xmax:f,ymax:n},[p]));return i}function Xge(t,e){const[i,r]=e.valid,n=2*r;let s,o=0;return t>r?(s=Math.ceil(Math.abs(t-r)/n),t-=s*n,o=s):t<i&&(s=Math.ceil(Math.abs(t-i)/n),t+=s*n,o=-s),{x:t,frameId:o}}function N4(t,e){const{xmin:i,ymin:r,xmax:n,ymax:s}=e;return F4(t,i,r)&&F4(t,i,s)&&F4(t,n,s)&&F4(t,n,r)}function F4(t,e,i){return e>=t.xmin&&e<=t.xmax&&i>=t.ymin&&i<=t.ymax}function Yge(t,e,i=!0){const r=!dO(t);if(r&&nEe(t),i)return new $mt().cut(t,e);const n=r?t.rings:t.paths,s=r?4:2,o=n.length,a=-2*e;for(let l=0;l<o;l++){const c=n[l];if(c&&c.length>=s){const h=[];for(const p of c)h.push([p[0]+a,p[1]]);n.push(h)}}return r?t.rings=n:t.paths=n,t}let nx=class{constructor(e,i){this.extent=e,this.frameIds=i}};const Imt=Kt();let $mt=class{constructor(){this._linesIn=[],this._linesOut=[]}cut(e,i){let r;if(this._xCut=i,e.rings)this._closed=!0,r=e.rings,this._minPts=4;else{if(!e.paths)return null;this._closed=!1,r=e.paths,this._minPts=2}for(const s of r){if(!s||s.length<this._minPts)continue;let o=!0;for(const a of s)o?(this.moveTo(a),o=!1):this.lineTo(a);this._closed&&this.close()}this._pushLineIn(),this._pushLineOut(),r=[];for(const s of this._linesIn)s&&s.length>=this._minPts&&r.push(s);const n=-2*this._xCut;for(const s of this._linesOut)if(s&&s.length>=this._minPts){for(const o of s)o[0]+=n;r.push(s)}return this._closed?e.rings=r:e.paths=r,e}moveTo(e){this._pushLineIn(),this._pushLineOut(),this._prevSide=this._side(e[0]),this._moveTo(e[0],e[1],this._prevSide),this._prevPt=e,this._firstPt=e}lineTo(e){const i=this._side(e[0]);if(i*this._prevSide==-1){const r=this._intersect(this._prevPt,e);this._lineTo(this._xCut,r,0),this._prevSide=0,this._lineTo(e[0],e[1],i)}else this._lineTo(e[0],e[1],i);this._prevSide=i,this._prevPt=e}close(){const e=this._firstPt,i=this._prevPt;e[0]===i[0]&&e[1]===i[1]||this.lineTo(e),this._checkClosingPt(this._lineIn),this._checkClosingPt(this._lineOut)}_moveTo(e,i,r){this._closed?(this._lineIn.push([r<=0?e:this._xCut,i]),this._lineOut.push([r>=0?e:this._xCut,i])):(r<=0&&this._lineIn.push([e,i]),r>=0&&this._lineOut.push([e,i]))}_lineTo(e,i,r){this._closed?(this._addPolyVertex(this._lineIn,r<=0?e:this._xCut,i),this._addPolyVertex(this._lineOut,r>=0?e:this._xCut,i)):r<0?(this._prevSide===0&&this._pushLineOut(),this._lineIn.push([e,i])):r>0?(this._prevSide===0&&this._pushLineIn(),this._lineOut.push([e,i])):this._prevSide<0?(this._lineIn.push([e,i]),this._lineOut.push([e,i])):this._prevSide>0&&(this._lineOut.push([e,i]),this._lineIn.push([e,i]))}_addPolyVertex(e,i,r){const n=e.length;n>1&&e[n-1][0]===i&&e[n-2][0]===i?e[n-1][1]=r:e.push([i,r])}_checkClosingPt(e){const i=e.length;i>3&&e[0][0]===this._xCut&&e[i-2][0]===this._xCut&&e[1][0]===this._xCut&&(e[0][1]=e[i-2][1],e.pop())}_side(e){return e<this._xCut?-1:e>this._xCut?1:0}_intersect(e,i){const r=(this._xCut-e[0])/(i[0]-e[0]);return e[1]+r*(i[1]-e[1])}_pushLineIn(){this._lineIn&&this._lineIn.length>=this._minPts&&this._linesIn.push(this._lineIn),this._lineIn=[]}_pushLineOut(){this._lineOut&&this._lineOut.length>=this._minPts&&this._linesOut.push(this._lineOut),this._lineOut=[]}},w0=class extends ve{constructor(e){super(e)}get bounds(){const e=this.coords;return R(e)||R(e.extent)?null:ZL(e.extent)}get coords(){var i;const e=(i=this.element.georeference)==null?void 0:i.coords;return yV(e,this.spatialReference).geometry}get normalizedCoords(){return ec.fromJSON(Mmt(this.coords))}get normalizedBounds(){const e=v(this.normalizedCoords)?this.normalizedCoords.extent:null;return v(e)?ZL(e):null}};u([d()],w0.prototype,"spatialReference",void 0),u([d()],w0.prototype,"element",void 0),u([d()],w0.prototype,"bounds",null),u([d()],w0.prototype,"coords",null),u([d()],w0.prototype,"normalizedCoords",null),u([d()],w0.prototype,"normalizedBounds",null),w0=u([$("esri.layers.support.MediaElementView")],w0);let EI=class extends sae{constructor(e){super(e),this.content=null,this.type="video"}load(){const e=this.video;if(typeof e=="string"){const i=document.createElement("video");i.src=e,i.crossOrigin="anonymous",i.autoplay=!0,i.muted=!0,i.loop=!0,this.addResolvingPromise(this._loadVideo(i).then(()=>{this._set("content",i)}))}else e instanceof HTMLVideoElement?this.addResolvingPromise(this._loadVideo(e).then(()=>{this._set("content",e)})):this.addResolvingPromise(Promise.reject(new H("video-element:invalid-video-type","Invalid video type",{video:e})));return Promise.resolve(this)}set video(e){this.loadStatus==="not-loaded"?this._set("video",e):re.getLogger(this.declaredClass).error("#video","video cannot be changed after the element is loaded.")}_loadVideo(e){return new Promise((i,r)=>{e.oncanplay=()=>{e.oncanplay=null,e.play().then(i,r)},e.crossOrigin!=="anonymous"&&(e.crossOrigin="anonymous",e.src=e.src)})}};u([d({readOnly:!0})],EI.prototype,"content",void 0),u([d()],EI.prototype,"video",null),EI=u([$("esri.layers.support.VideoElement")],EI);const aae=EI,Lmt={key:"type",defaultKeyValue:"image",base:sae,typeMap:{image:QV,video:aae}},Zge=tt.ofType(Lmt);let lA=class extends Ju.LoadableMixin(bO(Fw(An.EventedAccessor))){constructor(e){super(e),this._index=new Rmt,this._elementViewsMap=new Map,this._elementsIndexes=new Map,this._elementsChangedHandler=i=>{for(const n of i.removed){const s=this._elementViewsMap.get(n);this._elementViewsMap.delete(n),this._index.delete(s),this.handles.remove(s),s.destroy(),this.notifyChange("fullExtent")}const{spatialReference:r}=this;for(const n of i.added){if(this._elementViewsMap.get(n))continue;const s=new w0({spatialReference:r,element:n});this._elementViewsMap.set(n,s);const o=ne(()=>s.coords,()=>this._updateIndexForElement(s,!1));this._updateIndexForElement(s,!0),this.handles.add(o,s)}this._elementsIndexes.clear(),this.elements.forEach((n,s)=>this._elementsIndexes.set(n,s)),this.emit("refresh")},this.elements=new Zge}async load(e){if(ui(e),!this.spatialReference){const i=this.elements.find(r=>v(r.georeference)&&v(r.georeference.coords));this._set("spatialReference",i?i.georeference.coords.spatialReference:Je.WGS84)}return this._elementsChangedHandler({added:this.elements.items,removed:[]}),this.handles.add(this.elements.on("change",this._elementsChangedHandler)),this}destroy(){this._index.clear(),this._elementViewsMap.clear(),this._elementsIndexes.clear()}set elements(e){this._set("elements",rw(e,this._get("elements"),Zge))}get fullExtent(){if(this.loadStatus==="not-loaded")return null;const e=this._index.fullBounds;return R(e)?null:new ni({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:this.spatialReference})}set spatialReference(e){this.loadStatus==="not-loaded"?this._set("spatialReference",e):re.getLogger(this.declaredClass).error("#spatialReference","spatialReference cannot be changed after the source is loaded.")}async queryElements(e,i){await this.load(),await WAe(e.spatialReference,this.spatialReference,null,i);const r=Dn(e.spatialReference,this.spatialReference)?e:Sm(e,this.spatialReference);if(!r)return[];const n=r.normalize(),s=[];for(const o of n)this._index.forEachInBounds(ZL(o),({normalizedCoords:a,element:l})=>{v(a)&&Q2e(o,a)&&s.push(l)});return s.sort((o,a)=>this._elementsIndexes.get(o)-this._elementsIndexes.get(a)),s}_updateIndexForElement(e,i){const r=e.normalizedBounds,n=this._index.has(e),s=v(r);this._index.delete(e),s&&this._index.set(e,r),this.notifyChange("fullExtent"),i||(n!==s?this.emit("refresh"):this.emit("change",{element:e.element}))}};u([d()],lA.prototype,"elements",null),u([d({readOnly:!0})],lA.prototype,"fullExtent",null),u([d()],lA.prototype,"spatialReference",null),lA=u([$("esri.layers.support.LocalMediaElementSource")],lA);const AH=lA;function Jge(t){return typeof t=="object"&&t!=null&&"type"in t}let vu=class extends b3e(GPe(kPe(FN(cD)))){constructor(e){super(e),this.effectiveSource=null,this.copyright=null,this.operationalLayerType="MediaLayer",this.spatialReference=null,this.type="media",this.source=new AH}load(e){const i=this.source;if(!i)return this.addResolvingPromise(Promise.reject(new H("media-layer:source-missing","Set 'MediaLayer.source' before loading the layer."))),Promise.resolve(this);const r=Jge(i)?new AH({elements:new tt([i])}):i;this._set("effectiveSource",r),this.spatialReference&&(r.spatialReference=this.spatialReference);const n=r.load(e).then(()=>{this.spatialReference=r.spatialReference});return this.addResolvingPromise(n),Promise.resolve(this)}destroy(){var e,i;(e=this.effectiveSource)==null||e.destroy(),(i=this.source)==null||i.destroy()}get fullExtent(){return this.loaded?this.effectiveSource.fullExtent:null}set source(e){this.loadStatus==="not-loaded"?this._set("source",e):re.getLogger(this.declaredClass).error("#source","source cannot be changed after the layer is loaded.")}castSource(e){return e?Array.isArray(e)||e instanceof tt?new AH({elements:e}):e:null}readSource(e,i,r){const n=i.mediaType==="image"?new QV:i.mediaType==="video"?new aae:null;return n==null||n.read(i,r),n}writeSource(e,i,r,n){var s;e&&Jge(e)&&e.type==="image"?e.write(i,n):n!=null&&n.messages&&((s=n==null?void 0:n.messages)==null||s.push(new H("media-layer:unsupported-source","source must be an 'ImageElement'")))}};u([d({readOnly:!0})],vu.prototype,"effectiveSource",void 0),u([d({type:String})],vu.prototype,"copyright",void 0),u([d({readOnly:!0})],vu.prototype,"fullExtent",null),u([d({type:["MediaLayer"]})],vu.prototype,"operationalLayerType",void 0),u([d({type:["show","hide"]})],vu.prototype,"listMode",void 0),u([d({nonNullable:!0,json:{write:{enabled:!0,allowNull:!1}}})],vu.prototype,"source",null),u([ri("source")],vu.prototype,"castSource",null),u([Oe("source",["url"])],vu.prototype,"readSource",null),u([Ne("source")],vu.prototype,"writeSource",null),u([d()],vu.prototype,"spatialReference",void 0),u([d({readOnly:!0})],vu.prototype,"type",void 0),vu=u([$("esri.layers.MediaLayer")],vu);const lae=vu,$Gt=Object.freeze(Object.defineProperty({__proto__:null,default:lae},Symbol.toStringTag,{value:"Module"}));let E1=class extends ve{constructor(e){super(e),this._viewpointHandle=null,this._handles=new Xi,this.group=null}initialize(){this._handles.add(Kn(()=>{var e;return(e=this.view)==null?void 0:e.ui},"expand",e=>{const{target:i}=e;i&&i!==this&&i.expanded&&i.group&&i.group===this.group&&this._collapse()}))}destroy(){this._viewpointHandle=null,this.view=null,this._handles.destroy(),this._handles=null}set autoCollapse(e){this._set("autoCollapse",e),this._watchViewpoint()}set expanded(e){const i=!!e;this._set("expanded",i);const r=this.get("view.ui");r&&r.emit("expand",{target:this}),this._viewpointHandleChange(i)}get state(){return this.get("view.ready")?"ready":"disabled"}set view(e){this._get("view")!==e&&(this._set("view",e),e&&yo(()=>e.ready,()=>{this.view===e&&this._watchViewpoint()},{once:!0,initial:!0}))}_viewpointHandleChange(e){this._viewpointHandle&&(e?yo(()=>this.view.stationary,()=>this._viewpointHandle.resume(),{once:!0,initial:!0}):this._viewpointHandle.pause())}_watchViewpoint(){const e="viewpoint";this._handles.remove(e),this._viewpointHandle=null;const{autoCollapse:i,view:r}=this;if(r&&i){const n=hYe(()=>r.type==="3d"?r.camera:r.viewpoint,()=>this._collapse());this._handles.add(n,e),this._viewpointHandle=n}}_collapse(){this.expanded=!1}};u([d({value:!1})],E1.prototype,"autoCollapse",null),u([d({value:!1})],E1.prototype,"expanded",null),u([d()],E1.prototype,"group",void 0),u([d({readOnly:!0})],E1.prototype,"state",null),u([d({value:null})],E1.prototype,"view",null),E1=u([$("esri.widgets.Expand.ExpandViewModel")],E1);const sLe=E1,ru="esri-expand",xo={base:`${ru} esri-widget`,modeAuto:`${ru}--auto`,modeDrawer:`${ru}--drawer`,modeFloating:`${ru}--floating`,container:`${ru}__container`,containerExpanded:`${ru}__container--expanded`,panel:`${ru}__panel`,button:"esri-widget--button",text:"esri-icon-font-fallback-text",icon:"esri-collapse__icon",iconExpanded:`${ru}__icon--expanded`,iconNumber:`${ru}__icon-number`,iconNumberExpanded:`${ru}__icon-number--expanded`,expandIcon:"esri-icon-expand",collapseIcon:"esri-icon-collapse",content:`${ru}__content`,contentExpanded:`${ru}__content--expanded`,expandMask:`${ru}__mask`,expandMaskExpanded:`${ru}__mask--expanded`};let Ns=class extends Sa{constructor(e,i){super(e,i),this.closeOnEsc=!0,this.collapseTooltip="",this.content="",this.expandTooltip="",this.iconNumber=0,this.messages=null,this.messagesCommon=null,this.mode="auto",this.viewModel=new sLe,this._handleKeyDown=r=>{const{closeOnEsc:n,_toggleButtonEl:s,expanded:o}=this;!o||!n||r.target===s||r.key!=="Escape"||(typeof n=="function"?n(r):n)&&(this.expanded=!1,s==null||s.focus())}}get contentId(){return`${this.id}_controls_content`}get expandTitle(){const{expanded:e,messagesCommon:i,collapseTooltip:r,expandTooltip:n}=this;return e?r||i.collapse:n||i.expand}get autoCollapse(){return this.viewModel.autoCollapse}set autoCollapse(e){this.viewModel.autoCollapse=e}get collapseIconClass(){return xo.collapseIcon}set collapseIconClass(e){this._overrideIfSome("collapseIconClass",e)}get expanded(){return this.viewModel.expanded}set expanded(e){this.viewModel.expanded=e}get expandIconClass(){return IV(this.content)?this.content.iconClass:xo.expandIcon}set expandIconClass(e){this._overrideIfSome("expandIconClass",e)}get group(){return this.viewModel.group}set group(e){this.viewModel.group=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}expand(){this.viewModel.expanded=!0}collapse(){this.viewModel.expanded=!1}toggle(){this.viewModel.expanded=!this.viewModel.expanded}render(){const{mode:e}=this,i={[xo.modeAuto]:e==="auto",[xo.modeDrawer]:e==="drawer",[xo.modeFloating]:e==="floating"};return te("div",{class:this.classes(xo.base,i),onkeydown:this._handleKeyDown},this.renderMask(),this.renderContainer())}renderContainer(){const{expanded:e}=this,i={[xo.containerExpanded]:e};return te("div",{class:this.classes(xo.container,i)},this.renderPanel(),this.renderContent())}renderMask(){const{expanded:e}=this,i={[xo.expandMaskExpanded]:e};return te("div",{bind:this,onclick:this._toggle,class:this.classes(xo.expandMask,i)})}renderBadgeNumber(){const{expanded:e,iconNumber:i}=this;return i&&!e?te("span",{key:"expand__icon-number",class:xo.iconNumber},i):null}renderPanelNumber(){const{iconNumber:e,expanded:i}=this;return e&&i?te("span",{key:"expand__expand-icon-number",class:this.classes(xo.iconNumber,xo.iconNumberExpanded)},e):null}renderIcon(){const{collapseIconClass:e,expandIconClass:i,expanded:r}=this,n={[xo.iconExpanded]:r,[e]:r,[i]:!r};return e===i&&(n[e]=!0),te("span",{"aria-hidden":"true",class:this.classes(xo.icon,n)})}renderTitle(){return te("span",{class:xo.text},this.expandTitle)}renderExpandButton(){const{expanded:e,expandTitle:i,contentId:r}=this;return te("div",{afterCreate:this._storeToggleButtonEl,"aria-controls":r,"aria-expanded":e?"true":"false",bind:this,class:xo.button,onclick:this._toggle,onkeydown:this._toggle,role:"button",tabindex:"0",title:i},this.renderBadgeNumber(),this.renderIcon(),this.renderTitle())}renderPanel(){return te("div",{class:xo.panel},this.renderExpandButton(),this.renderPanelNumber())}renderContent(){const{expanded:e,contentId:i,content:r}=this,n={[xo.contentExpanded]:e},s={id:i,role:"region",class:this.classes(xo.content,n)};return typeof r=="string"?te("div",{key:"content__string",innerHTML:r,...s}):IV(r)?te("div",{key:"content__widget",...s},r.render()):r instanceof HTMLElement?te("div",{key:"content__html-element",bind:r,afterCreate:this._attachToNode,...s}):VMe(r)?te("div",{key:"content__node",bind:r.domNode,afterCreate:this._attachToNode,...s}):null}_toggle(){this.toggle()}_attachToNode(e){const i=this;e.appendChild(i)}_storeToggleButtonEl(e){this._toggleButtonEl=e}};u([d({readOnly:!0})],Ns.prototype,"contentId",null),u([d({readOnly:!0})],Ns.prototype,"expandTitle",null),u([d()],Ns.prototype,"autoCollapse",null),u([d()],Ns.prototype,"closeOnEsc",void 0),u([d()],Ns.prototype,"collapseIconClass",null),u([d()],Ns.prototype,"collapseTooltip",void 0),u([d()],Ns.prototype,"content",void 0),u([d()],Ns.prototype,"expanded",null),u([d()],Ns.prototype,"expandIconClass",null),u([d()],Ns.prototype,"expandTooltip",void 0),u([d()],Ns.prototype,"group",null),u([d()],Ns.prototype,"iconNumber",void 0),u([d()],Ns.prototype,"label",null),u([d(),Go("esri/widgets/Expand/t9n/Expand")],Ns.prototype,"messages",void 0),u([d(),Go("esri/t9n/common")],Ns.prototype,"messagesCommon",void 0),u([d()],Ns.prototype,"mode",void 0),u([d()],Ns.prototype,"view",null),u([d({type:sLe})],Ns.prototype,"viewModel",void 0),u([Nh()],Ns.prototype,"_toggle",null),Ns=u([$("esri.widgets.Expand")],Ns);const LQ=Ns;let xU=class extends fe{get version(){return this.commitVersionProperties(),(this._get("version")||0)+1}};u([d({readOnly:!0})],xU.prototype,"version",null),xU=u([$("esri.views.layers.support.ClipArea")],xU);const Dmt=xU;var DQ;let ET=DQ=class extends Dmt{constructor(t){super(t),this.type="rect",this.left=null,this.right=null,this.top=null,this.bottom=null}clone(){return new DQ({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left"),this.commitProperty("right"),this.commitProperty("top"),this.commitProperty("bottom")}};u([d({type:[Number,String],json:{write:!0}})],ET.prototype,"left",void 0),u([d({type:[Number,String],json:{write:!0}})],ET.prototype,"right",void 0),u([d({type:[Number,String],json:{write:!0}})],ET.prototype,"top",void 0),u([d({type:[Number,String],json:{write:!0}})],ET.prototype,"bottom",void 0),ET=DQ=u([$("esri.views.layers.support.ClipRect")],ET);const k4=ET;function Nmt(t,e){const i=10**e;return Math.round(t*i)/i}const U4={left:0,right:0,top:0,bottom:0};let bu=class extends ve{constructor(e){super(e),this._leadingClips=new Map,this._trailingClips=new Map,this.direction="horizontal",this.leadingLayers=new tt,this.max=100,this.min=0,this.precision=4,this.step=.5,this.stepMultiplier=10,this.trailingLayers=new tt,this.view=null}initialize(){this.addHandles([ne(()=>{var e;return[this.view,(e=this.view)==null?void 0:e.ready,this.position,this.direction]},()=>this._clipLayers(),zt),Kn(()=>this.leadingLayers,"change",()=>this._clipLeadingLayers()),Kn(()=>this.trailingLayers,"change",()=>this._clipTrailingLayers())])}destroy(){this._removeExistingClips()}get position(){return 25}set position(e){const{precision:i,min:r,max:n}=this;this._set("position",Nmt(Math.max(Math.min(e,n),r),i))}get state(){const{view:e}=this;return e&&e.ready?"ready":"disabled"}_clipLayers(){this._clipLeadingLayers(),this._clipTrailingLayers()}_clipLeadingLayers(){this._removeClips("leading");const{leadingLayers:e}=this;e.forEach(i=>this._clipLayer({layer:i,type:"leading"}))}_clipTrailingLayers(){this._removeClips("trailing");const{trailingLayers:e}=this;e.forEach(i=>this._clipLayer({layer:i,type:"trailing"}))}async _getLayerView(e){const{view:i}=this;if(!e||!i)return null;const r=await i.whenLayerView(e);return"clips"in r?r:null}_getVerticalClipRect(e){const{position:i}=this;return e==="leading"?new k4({...U4,bottom:100-i+"%"}):e==="trailing"?new k4({...U4,top:`${i}%`}):null}_getHorizontalClipRect(e){const{position:i}=this;return e==="leading"?new k4({...U4,right:100-i+"%"}):e==="trailing"?new k4({...U4,left:`${i}%`}):null}_getClipRect(e){const{direction:i}=this;return i==="vertical"?this._getVerticalClipRect(e):i==="horizontal"?this._getHorizontalClipRect(e):null}async _clipLayer(e){const{_leadingClips:i,_trailingClips:r}=this,{layer:n,type:s}=e,o=s==="trailing"?r:s==="leading"?i:null,a=await this._getLayerView(n);if(!(a&&"clips"in a&&o&&a.hasOwnProperty("clips")))return;const l=o.get(a);l&&a.clips.remove(l);const c=this._getClipRect(s);c&&(o.set(a,c),a.clips.add(c))}_removeClips(e){const{_leadingClips:i,_trailingClips:r}=this,n=e==="trailing"?r:e==="leading"?i:null;n&&(n.forEach((s,o)=>{o&&o.hasOwnProperty("clips")&&o.clips.remove(s)}),n.clear())}_removeExistingClips(){this._removeClips("leading"),this._removeClips("trailing")}};u([d()],bu.prototype,"direction",void 0),u([d({type:tt,nonNullable:!0})],bu.prototype,"leadingLayers",void 0),u([d({readOnly:!0})],bu.prototype,"max",void 0),u([d({readOnly:!0})],bu.prototype,"min",void 0),u([d()],bu.prototype,"position",null),u([d()],bu.prototype,"precision",void 0),u([d({readOnly:!0})],bu.prototype,"state",null),u([d()],bu.prototype,"step",void 0),u([d()],bu.prototype,"stepMultiplier",void 0),u([d({type:tt,nonNullable:!0})],bu.prototype,"trailingLayers",void 0),u([d()],bu.prototype,"view",void 0),bu=u([$("esri.widgets.Swipe.SwipeViewModel")],bu);const oLe=bu,zy="esri-swipe",uc={base:zy,baseDisabled:`${zy}--disabled`,vertical:`${zy}--vertical`,horizontal:`${zy}--horizontal`,container:`${zy}__container`,divider:`${zy}__divider`,handle:`${zy}__handle`,handleHidden:`${zy}__handle--hidden`,widgetIcon:"esri-icon-up-down-arrows",handleIcon:`${zy}__handle-icon`,dragIconHorizontal:"esri-icon-drag-horizontal",dragIconVertical:"esri-icon-drag-vertical",widget:"esri-widget",disabled:"esri-disabled"},Kge={handle:!0,divider:!0};let Tc=class extends Sa{constructor(e,i){super(e,i),this.disabled=!1,this.iconClass=uc.widgetIcon,this.messages=null,this.viewModel=new oLe,this._pointerOffset=0,this._container=null,this._onContainerPointerDown=this._onContainerPointerDown.bind(this),this._onContainerPointerMove=this._onContainerPointerMove.bind(this),this._onContainerPointerUp=this._onContainerPointerUp.bind(this)}get direction(){return this.viewModel.direction}set direction(e){this.viewModel.direction=e}get dragLabel(){var e;return((e=this.messages)==null?void 0:e.dragLabel)??""}set dragLabel(e){this._overrideIfSome("dragLabel",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get leadingLayers(){return this.viewModel.leadingLayers}set leadingLayers(e){this.viewModel.leadingLayers=e}get position(){return this.viewModel.position}set position(e){this.viewModel.position=e}get trailingLayers(){return this.viewModel.trailingLayers}set trailingLayers(e){this.viewModel.trailingLayers=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}set visibleElements(e){this._set("visibleElements",{...Kge,...e})}get visibleElements(){return this._get("visibleElements")||Kge}render(){const{state:e,direction:i}=this.viewModel,r=e==="disabled"||this.disabled,n={[uc.disabled]:r,[uc.baseDisabled]:r,[uc.vertical]:i==="vertical",[uc.horizontal]:i==="horizontal"};return te("div",{class:this.classes(uc.base,uc.widget,n)},e==="disabled"?null:this.renderContainer())}renderHandle(){const{direction:e}=this.viewModel,{visibleElements:i}=this,r={[uc.dragIconHorizontal]:e==="vertical",[uc.dragIconVertical]:e==="horizontal"},n=this.classes(uc.handle,!i.handle&&uc.handleHidden);return te("div",{key:"handle",role:"presentation",class:n},te("span",{"aria-hidden":"true",class:this.classes(uc.handleIcon,r)}))}renderDivider(){const{visibleElements:e}=this;return e&&e.divider?te("div",{key:"divider",role:"presentation",class:uc.divider}):null}renderContent(){return[this.renderDivider(),this.renderHandle()]}renderContainer(){const{disabled:e,dragLabel:i,viewModel:r}=this,{max:n,min:s,direction:o,position:a}=r,l=`${a}%`,c={top:o==="vertical"?l:void 0,left:o==="vertical"?void 0:l},h=this.renderContent();return te("div",e?{key:"container",role:"presentation",styles:c,class:uc.container}:{tabIndex:0,key:"container",bind:this,afterCreate:this._afterContainerCreate,onkeydown:this._onContainerKeyDown,"touch-action":"none",role:"slider",title:i,"aria-label":i,"aria-orientation":o,"aria-valuemax":`${n}`,"aria-valuemin":`${s}`,"aria-valuenow":`${a}`,"aria-valuetext":l,styles:c,class:uc.container},h)}_afterContainerCreate(e){this._container=e,e.addEventListener("pointerdown",this._onContainerPointerDown)}_calculatePointerOffset(e){const{direction:i}=this,r=e.target,n=(i==="vertical"?r.clientHeight:r.clientWidth)/2,s=r.getBoundingClientRect(),o=e.clientX-s.left,a=e.clientY-s.top;this._pointerOffset=i==="vertical"?a-n:o-n}_onContainerPointerDown(e){e.preventDefault(),this._container&&document.activeElement!==this.container&&this._container.focus(),this._calculatePointerOffset(e),document.addEventListener("pointerup",this._onContainerPointerUp),document.addEventListener("pointermove",this._onContainerPointerMove)}_onContainerPointerUp(e){e.preventDefault(),document.removeEventListener("pointerup",this._onContainerPointerUp),document.removeEventListener("pointermove",this._onContainerPointerMove)}_onContainerPointerMove(e){e.preventDefault();const{_pointerOffset:i,container:r,direction:n}=this,{clientX:s,clientY:o}=e,{top:a,left:l,width:c,height:h}=r.getBoundingClientRect(),p=(n==="vertical"?o-a-i:s-l-i)/(n==="vertical"?h:c)*100;this.position=p}_getKeyPosition(e){const i=up(e),{position:r}=this,{max:n,min:s,step:o,stepMultiplier:a,direction:l}=this.viewModel,c=o*a;return["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Home","End","PageUp","PageDown"].includes(i)&&(e.preventDefault(),e.stopPropagation()),(l==="vertical"?i==="ArrowDown"||i==="ArrowRight":i==="ArrowUp"||i==="ArrowRight")?r+(e.shiftKey?c:o):(l==="vertical"?i==="ArrowUp"||i==="ArrowLeft":i==="ArrowDown"||i==="ArrowLeft")?r-(e.shiftKey?c:o):i==="Home"?s:i==="End"?n:(l==="vertical"?i==="PageDown":i==="PageUp")?r+c:(l==="vertical"?i==="PageUp":i==="PageDown")?r-c:null}_onContainerKeyDown(e){const i=this._getKeyPosition(e);typeof i=="number"&&(this.position=i)}};u([d()],Tc.prototype,"direction",null),u([d()],Tc.prototype,"disabled",void 0),u([d()],Tc.prototype,"dragLabel",null),u([d()],Tc.prototype,"iconClass",void 0),u([d()],Tc.prototype,"label",null),u([d()],Tc.prototype,"leadingLayers",null),u([d(),Go("esri/widgets/Swipe/t9n/Swipe")],Tc.prototype,"messages",void 0),u([d()],Tc.prototype,"position",null),u([d()],Tc.prototype,"trailingLayers",null),u([d()],Tc.prototype,"view",null),u([d({type:oLe})],Tc.prototype,"viewModel",void 0),u([d()],Tc.prototype,"visibleElements",null),Tc=u([$("esri.widgets.Swipe")],Tc);const Fmt=Tc;/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.7
 */const NQ="hidden-form-input";function cae(t){return"checked"in t}const FQ=new WeakMap,uae=new WeakSet;function kmt(t,e){const i="calciteInternalFormComponentRegister";let r=!1;return t.addEventListener(i,n=>{r=n.composedPath().some(s=>uae.has(s)),n.stopPropagation()},{once:!0}),e.dispatchEvent(new CustomEvent(i,{bubbles:!0,composed:!0})),r}function Umt(t){const{formEl:e}=t;return e?("requestSubmit"in e?e.requestSubmit():e.submit(),!0):!1}function Vmt(t){var e;(e=t.formEl)==null||e.reset()}function UGt(t){const{el:e,value:i}=t,r=SO(e,"form");if(!r||kmt(r,e))return;t.formEl=r,t.defaultValue=i,cae(t)&&(t.defaultChecked=t.checked);const n=(t.onFormReset||zmt).bind(t);r.addEventListener("reset",n),FQ.set(t.el,n),uae.add(e)}function zmt(){if(cae(this)){this.checked=this.defaultChecked;return}this.value=this.defaultValue}function VGt(t){const{el:e,formEl:i}=t;if(!i)return;const r=FQ.get(e);i.removeEventListener("reset",r),FQ.delete(e),t.formEl=null,uae.delete(e)}const aLe=t=>{t.target.dispatchEvent(new CustomEvent("calciteInternalHiddenInputChange",{bubbles:!0}))},Qge=t=>t.removeEventListener("change",aLe);function Bmt(t){const{el:e,formEl:i,name:r,value:n}=t,{ownerDocument:s}=e,o=e.querySelectorAll(`input[slot="${NQ}"]`);if(!i||!r){o.forEach(p=>{Qge(p),p.remove()});return}const a=Array.isArray(n)?n:[n],l=[],c=new Set;o.forEach(p=>{const f=a.find(m=>m==p.value);f!=null?(c.add(f),eye(t,p,f)):l.push(p)});let h;a.forEach(p=>{if(c.has(p))return;let f=l.pop();f||(f=s.createElement("input"),f.slot=NQ),h||(h=s.createDocumentFragment()),h.append(f),f.addEventListener("change",aLe),eye(t,f,p)}),h&&e.append(h),l.forEach(p=>{Qge(p),p.remove()})}function eye(t,e,i){var a;const{defaultValue:r,disabled:n,name:s,required:o}=t;e.defaultValue=r,e.disabled=n,e.name=s,e.required=o,e.tabIndex=-1,cae(t)?(e.checked=t.checked,e.defaultChecked=t.defaultChecked,e.value=t.checked?i||"on":""):e.value=i||"",(a=t.syncHiddenFormInput)==null||a.call(t,e)}const zGt=({component:t})=>(Bmt(t),ws("slot",{name:NQ}));/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.7
 */function jmt(){}function Gmt(t,e=!1){if(t.disabled){t.el.setAttribute("tabindex","-1"),t.el.setAttribute("aria-disabled","true"),t.el.contains(document.activeElement)&&document.activeElement.blur(),t.el.click=jmt;return}t.el.click=HTMLElement.prototype.click,typeof e=="function"?t.el.setAttribute("tabindex",e.call(t)?"0":"-1"):e===!0?t.el.setAttribute("tabindex","0"):e===!1&&t.el.removeAttribute("tabindex"),t.el.removeAttribute("aria-disabled")}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.7
 */const lLe="calciteInternalLabelClick",hae="calciteInternalLabelConnected",kQ="calciteInternaLabelDisconnected",tye="calcite-label",ez=new WeakMap,mD=new WeakMap,tz=new WeakMap,UR=new Set,Hmt=t=>{const{id:e}=t,i=e&&dQe(t,{selector:`${tye}[for="${e}"]`});if(i)return i;const r=SO(t,tye);return!r||qmt(r,t)?null:r};function qmt(t,e){let i;const r="custom-element-ancestor-check",n=o=>{o.stopImmediatePropagation();const a=o.composedPath();i=a.slice(a.indexOf(e),a.indexOf(t))};return t.addEventListener(r,n,{once:!0}),e.dispatchEvent(new CustomEvent(r,{composed:!0,bubbles:!0})),t.removeEventListener(r,n),i.filter(o=>o!==e&&o!==t).filter(o=>{var a;return(a=o.tagName)==null?void 0:a.includes("-")}).length>0}function cLe(t){const e=Hmt(t.el);if(ez.has(e)||!e&&UR.has(t))return;const i=Jmt.bind(t);if(e){t.labelEl=e;const r=Ymt.bind(t);ez.set(t.labelEl,r),t.labelEl.addEventListener(lLe,r),UR.delete(t),document.removeEventListener(hae,mD.get(t)),tz.set(t,i),document.addEventListener(kQ,i)}else UR.has(t)||(i(),document.removeEventListener(kQ,tz.get(t)))}function Wmt(t){if(UR.delete(t),document.removeEventListener(hae,mD.get(t)),document.removeEventListener(kQ,tz.get(t)),mD.delete(t),tz.delete(t),!t.labelEl)return;const e=ez.get(t.labelEl);t.labelEl.removeEventListener(lLe,e),ez.delete(t.labelEl)}function Xmt(t){var e,i;return t.label||((i=(e=t.labelEl)==null?void 0:e.textContent)==null?void 0:i.trim())||""}function Ymt(t){this.disabled||this.el.contains(t.detail.sourceEvent.target)||this.onLabelClick(t)}function Zmt(){UR.has(this)&&cLe(this)}function Jmt(){UR.add(this);const t=mD.get(this)||Zmt.bind(this);mD.set(this,t),document.addEventListener(hae,t)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.7
 */const uLe=new WeakMap,hLe=new WeakMap;function Kmt(t){hLe.set(t,new Promise(e=>uLe.set(t,e)))}function Qmt(t){uLe.get(t)()}function egt(t){return hLe.get(t)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.7
 */function BGt(t){return t==="Enter"||t===" "}const dLe=["0","1","2","3","4","5","6","7","8","9"];/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.7
 */function dae(t,e,i){const r=tgt(t);return new r(e,i)}function tgt(t){class e extends window.MutationObserver{constructor(r){super(r),this.observedEntry=[],this.callback=r}observe(r,n){return this.observedEntry.push({target:r,options:n}),super.observe(r,n)}unobserve(r){const n=this.observedEntry.filter(s=>s.target!==r);this.observedEntry=[],this.callback(super.takeRecords(),this),this.disconnect(),n.forEach(s=>this.observe(s.target,s.options))}}return function(){return t==="intersection"?window.IntersectionObserver:t==="mutation"?e:window.ResizeObserver}()}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.7
 */const igt=new RegExp("-","g"),rgt=new RegExp("\\.?0+$");class Wr{constructor(e){if(this.add=n=>Wr.fromBigInt(this.value+new Wr(n).value),this.subtract=n=>Wr.fromBigInt(this.value-new Wr(n).value),this.multiply=n=>Wr._divRound(this.value*new Wr(n).value,Wr.SHIFT),this.divide=n=>Wr._divRound(this.value*Wr.SHIFT,new Wr(n).value),e instanceof Wr)return e;const[i,r]=String(e).split(".").concat("");this.value=BigInt(i+r.padEnd(Wr.DECIMALS,"0").slice(0,Wr.DECIMALS))+BigInt(Wr.ROUNDED&&r[Wr.DECIMALS]>="5"),this.isNegative=e.charAt(0)==="-"}getIntegersAndDecimals(){const e=this.value.toString().replace(igt,"").padStart(Wr.DECIMALS+1,"0"),i=e.slice(0,-Wr.DECIMALS),r=e.slice(-Wr.DECIMALS).replace(rgt,"");return{integers:i,decimals:r}}toString(){const{integers:e,decimals:i}=this.getIntegersAndDecimals();return`${this.isNegative?"-":""}${e}${i.length?"."+i:""}`}formatToParts(e){const{integers:i,decimals:r}=this.getIntegersAndDecimals(),n=e.numberFormatter.formatToParts(BigInt(i));return this.isNegative&&n.unshift({type:"minusSign",value:e.minusSign}),r.length&&(n.push({type:"decimal",value:e.decimal}),r.split("").forEach(s=>n.push({type:"fraction",value:s}))),n}format(e){const{integers:i,decimals:r}=this.getIntegersAndDecimals(),n=`${this.isNegative?e.minusSign:""}${e.numberFormatter.format(BigInt(i))}`,s=r.length?`${e.decimal}${r.split("").map(o=>e.numberFormatter.format(Number(o))).join("")}`:"";return`${n}${s}`}}Wr.DECIMALS=100;Wr.ROUNDED=!0;Wr.SHIFT=BigInt("1"+"0".repeat(Wr.DECIMALS));Wr._divRound=(t,e)=>Wr.fromBigInt(t/e+(Wr.ROUNDED?t*BigInt(2)/e%BigInt(2):BigInt(0)));Wr.fromBigInt=t=>Object.assign(Object.create(Wr.prototype),{value:t});function pae(t){return!(!t||isNaN(Number(t)))}function jGt(t){return!t||!lgt(t)?"":iz(t,e=>{let i=!1;const r=e.split("").filter((n,s)=>n.match(/\./g)&&!i?(i=!0,!0):n.match(/\-/g)&&s===0?!0:dLe.includes(n)).reduce((n,s)=>n+s);return pae(r)?new Wr(r).toString():""})}const ngt=/^([-0])0+(?=\d)/,sgt=/(?!^\.)\.$/,ogt=/(?!^-)-/g,agt=/^-\b0\b\.?0*$/,GGt=t=>iz(t,e=>{const i=e.replace(ogt,"").replace(sgt,"").replace(ngt,"$1");return pae(i)?agt.test(i)?i:new Wr(i).toString():e});function iz(t,e){if(!t)return t;const i=t.toLowerCase().indexOf("e")+1;return i?t.replace(/[eE]*$/g,"").substring(0,i).concat(t.slice(i).replace(/[eE]/g,"")).split(/[eE]/).map((r,n)=>e(n===1?r.replace(/\./g,""):r)).join("e").replace(/^e/,"1e"):e(t)}function lgt(t){return dLe.some(e=>t.includes(e))}const mw="en",cgt=["ar","bg","bs","ca","cs","da","de","el",mw,"es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","no","nl","pl","pt-BR","pt-PT","ro","ru","sk","sl","sr","sv","th","tr","uk","vi","zh-CN","zh-HK","zh-TW"],ugt=["ar","bg","bs","ca","cs","da","de","de-CH","el",mw,"en-AU","en-CA","en-GB","es","es-MX","et","fi","fr","fr-CH","he","hi","hr","hu","id","it","it-CH","ja","ko","lt","lv","mk","no","nl","pl","pt","pt-PT","ro","ru","sk","sl","sr","sv","th","tr","uk","vi","zh-CN","zh-HK","zh-TW"],hgt=["arab","arabext","bali","beng","deva","fullwide","gujr","guru","hanidec","khmr","knda","laoo","latn","limb","mlym","mong","mymr","orya","tamldec","telu","thai","tibt"],pLe=t=>hgt.includes(t),RH=new Intl.NumberFormat().resolvedOptions().numberingSystem,fLe=RH==="arab"||!pLe(RH)?"latn":RH,dgt=t=>pLe(t)?t:fLe;function mLe(t,e="cldr"){const i=e==="cldr"?ugt:cgt;return t?i.includes(t)?t:(t=t.toLowerCase(),t==="nb"?"no":e==="t9n"&&t==="pt"?"pt-BR":(t.includes("-")&&(t=t.replace(/(\w+)-(\w+)/,(r,n,s)=>`${n}-${s.toUpperCase()}`),i.includes(t)||(t=t.split("-")[0])),t==="zh"?"zh-CN":i.includes(t)?t:(console.warn(`Translations for the "${t}" locale are not available and will fall back to the default, English (en).`),mw))):mw}const gD=new Set;function pgt(t){fgt(t),gD.size===0&&(TU==null||TU.observe(document.documentElement,{attributes:!0,attributeFilter:["lang"],subtree:!0})),gD.add(t)}function fgt(t){t.effectiveLocale=ggt(t)}function mgt(t){gD.delete(t),gD.size===0&&TU.disconnect()}const TU=dae("mutation",t=>{t.forEach(e=>{const i=e.target;gD.forEach(r=>{if(!fQe(i,r.el))return;const s=SO(r.el,"[lang]");if(!s){r.effectiveLocale=mw;return}const o=s.lang;r.effectiveLocale=s.hasAttribute("lang")&&o===""?mw:o})})});function ggt(t){var e;return t.el.lang||((e=SO(t.el,"[lang]"))==null?void 0:e.lang)||document.documentElement.lang||mw}class ygt{constructor(){this.delocalize=e=>this._numberFormatOptions?iz(e,i=>i.trim().replace(new RegExp(`[${this._minusSign}]`,"g"),"-").replace(new RegExp(`[${this._group}]`,"g"),"").replace(new RegExp(`[${this._decimal}]`,"g"),".").replace(new RegExp(`[${this._digits.join("")}]`,"g"),this._getDigitIndex)):e,this.localize=e=>this._numberFormatOptions?iz(e,i=>pae(i.trim())?new Wr(i.trim()).format(this).replace(new RegExp(`[${this._actualGroup}]`,"g"),this._group):i):e}get group(){return this._group}get decimal(){return this._decimal}get minusSign(){return this._minusSign}get digits(){return this._digits}get numberFormatter(){return this._numberFormatter}get numberFormatOptions(){return this._numberFormatOptions}set numberFormatOptions(e){if(e.locale=mLe(e==null?void 0:e.locale),e.numberingSystem=dgt(e==null?void 0:e.numberingSystem),!this._numberFormatOptions&&e.locale===mw&&e.numberingSystem===fLe&&Object.keys(e).length===2||JSON.stringify(this._numberFormatOptions)===JSON.stringify(e))return;this._numberFormatOptions=e,this._numberFormatter=new Intl.NumberFormat(this._numberFormatOptions.locale,this._numberFormatOptions),this._digits=[...new Intl.NumberFormat(this._numberFormatOptions.locale,{useGrouping:!1,numberingSystem:this._numberFormatOptions.numberingSystem}).format(9876543210)].reverse();const i=new Map(this._digits.map((n,s)=>[n,s])),r=new Intl.NumberFormat(this._numberFormatOptions.locale).formatToParts(-123456789e-1);this._actualGroup=r.find(n=>n.type==="group").value,this._group=this._actualGroup.trim().length===0?" ":this._actualGroup,this._decimal=r.find(n=>n.type==="decimal").value,this._minusSign=r.find(n=>n.type==="minusSign").value,this._getDigitIndex=n=>i.get(n)}}const HGt=new ygt;/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.7
 */const V4={};async function _gt(t,e){const i=`${e}_${t}`;return V4[i]||(V4[i]=fetch(URe(`./assets/${e}/t9n/messages_${t}.json`)).then(r=>(r.ok||iye(),r.json())).catch(()=>iye())),V4[i]}function iye(){throw new Error("could not fetch component message bundle")}function fae(t){t.messages={...t.defaultMessages,...t.messageOverrides}}async function vgt(t){t.defaultMessages=await gLe(t,t.effectiveLocale),fae(t)}async function gLe(t,e){const{el:i}=t,n=i.tagName.toLowerCase().replace("calcite-","");return _gt(mLe(e,"t9n"),n)}async function bgt(t,e){t.defaultMessages=await gLe(t,e),fae(t)}function wgt(t){t.onMessagesChange=Tgt}function xgt(t){t.onMessagesChange=void 0}function Tgt(){fae(this)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.7
 */const Sgt={icon:"icon",flipRtl:"flip-rtl"},MH={},OH={},yLe={s:16,m:24,l:32};async function Egt({icon:t,scale:e}){const i=yLe[e],r=Cgt(t),n=r.charAt(r.length-1)==="F",o=`${n?r.substring(0,r.length-1):r}${i}${n?"F":""}`;if(MH[o])return MH[o];OH[o]||(OH[o]=fetch(URe(`./assets/icon/${o}.json`)).then(l=>l.json()).catch(()=>(console.error(`"${o}" is not a valid calcite-ui-icon name`),"")));const a=await OH[o];return MH[o]=a,a}function Cgt(t){const e=!isNaN(Number(t.charAt(0))),i=t.split("-");if(i.length>0){const n=/[a-z]/i;t=i.map((s,o)=>s.replace(n,function(l,c){return o===0&&c===0?l:l.toUpperCase()})).join("")}return e?`i${t}`:t}const Agt="@keyframes in{0%{opacity:0}100%{opacity:1}}@keyframes in-down{0%{opacity:0;transform:translate3D(0, -5px, 0)}100%{opacity:1;transform:translate3D(0, 0, 0)}}@keyframes in-up{0%{opacity:0;transform:translate3D(0, 5px, 0)}100%{opacity:1;transform:translate3D(0, 0, 0)}}@keyframes in-scale{0%{opacity:0;transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;transform:scale3D(1, 1, 1)}}:root{--calcite-animation-timing:calc(150ms * var(--calcite-internal-duration-factor));--calcite-internal-duration-factor:var(--calcite-duration-factor, 1);--calcite-internal-animation-timing-fast:calc(100ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-medium:calc(200ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-slow:calc(300ms * var(--calcite-internal-duration-factor))}.calcite-animate{opacity:0;animation-fill-mode:both;animation-duration:var(--calcite-animation-timing)}.calcite-animate__in{animation-name:in}.calcite-animate__in-down{animation-name:in-down}.calcite-animate__in-up{animation-name:in-up}.calcite-animate__in-scale{animation-name:in-scale}@media (prefers-reduced-motion: reduce){:root{--calcite-internal-duration-factor:0}}:root{--calcite-floating-ui-transition:var(--calcite-animation-timing);--calcite-floating-ui-z-index:600}:host([hidden]){display:none}:host{display:inline-flex;color:var(--calcite-ui-icon-color)}:host([scale=s]){block-size:1rem;inline-size:1rem;min-inline-size:1rem;min-block-size:1rem}:host([scale=m]){block-size:1.5rem;inline-size:1.5rem;min-inline-size:1.5rem;min-block-size:1.5rem}:host([scale=l]){block-size:2rem;inline-size:2rem;min-inline-size:2rem;min-block-size:2rem}.flip-rtl{transform:scaleX(-1)}.svg{display:block}",Rgt=Ase(class extends Rse{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.icon=null,this.flipRtl=!1,this.scale="m",this.textLabel=void 0,this.pathData=void 0,this.visible=!1}connectedCallback(){this.waitUntilVisible(()=>{this.visible=!0,this.loadIconPathData()})}disconnectedCallback(){var t;(t=this.intersectionObserver)==null||t.disconnect(),this.intersectionObserver=null}async componentWillLoad(){this.loadIconPathData()}render(){const{el:t,flipRtl:e,pathData:i,scale:r,textLabel:n}=this,s=hQe(t),o=yLe[r],a=!!n,l=[].concat(i||"");return ws(Sse,{"aria-hidden":_Qe(!a),"aria-label":a?n:null,role:a?"img":null},ws("svg",{"aria-hidden":"true",class:{[Sgt.flipRtl]:s==="rtl"&&e,svg:!0},fill:"currentColor",height:"100%",viewBox:`0 0 ${o} ${o}`,width:"100%",xmlns:"http://www.w3.org/2000/svg"},l.map(c=>typeof c=="string"?ws("path",{d:c}):ws("path",{d:c.d,opacity:"opacity"in c?c.opacity:1}))))}async loadIconPathData(){const{icon:t,scale:e,visible:i}=this;!t||!i||(this.pathData=await Egt({icon:t,scale:e}))}waitUntilVisible(t){if(this.intersectionObserver=dae("intersection",e=>{e.forEach(i=>{i.isIntersecting&&(this.intersectionObserver.disconnect(),this.intersectionObserver=null,t())})},{rootMargin:"50px"}),!this.intersectionObserver){t();return}this.intersectionObserver.observe(this.el)}static get assetsDirs(){return["assets"]}get el(){return this}static get watchers(){return{icon:["loadIconPathData"],scale:["loadIconPathData"]}}static get style(){return Agt}},[1,"calcite-icon",{icon:[513],flipRtl:[516,"flip-rtl"],scale:[513],textLabel:[1,"text-label"],pathData:[32],visible:[32]}]);function _Le(){if(typeof customElements>"u")return;["calcite-icon"].forEach(e=>{switch(e){case"calcite-icon":customElements.get(e)||customElements.define(e,Rgt);break}})}_Le();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.7
 */const Mgt='@charset "UTF-8";@keyframes in{0%{opacity:0}100%{opacity:1}}@keyframes in-down{0%{opacity:0;transform:translate3D(0, -5px, 0)}100%{opacity:1;transform:translate3D(0, 0, 0)}}@keyframes in-up{0%{opacity:0;transform:translate3D(0, 5px, 0)}100%{opacity:1;transform:translate3D(0, 0, 0)}}@keyframes in-scale{0%{opacity:0;transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;transform:scale3D(1, 1, 1)}}:root{--calcite-animation-timing:calc(150ms * var(--calcite-internal-duration-factor));--calcite-internal-duration-factor:var(--calcite-duration-factor, 1);--calcite-internal-animation-timing-fast:calc(100ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-medium:calc(200ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-slow:calc(300ms * var(--calcite-internal-duration-factor))}.calcite-animate{opacity:0;animation-fill-mode:both;animation-duration:var(--calcite-animation-timing)}.calcite-animate__in{animation-name:in}.calcite-animate__in-down{animation-name:in-down}.calcite-animate__in-up{animation-name:in-up}.calcite-animate__in-scale{animation-name:in-scale}@media (prefers-reduced-motion: reduce){:root{--calcite-internal-duration-factor:0}}:root{--calcite-floating-ui-transition:var(--calcite-animation-timing);--calcite-floating-ui-z-index:600}:host([hidden]){display:none}:host{position:relative;margin-inline:auto;display:none;align-items:center;justify-content:center;opacity:1;min-block-size:var(--calcite-loader-size);font-size:var(--calcite-loader-font-size);stroke:var(--calcite-ui-brand);stroke-width:3;fill:none;transform:scale(1, 1);animation:loader-color-shift calc(var(--calcite-internal-animation-timing-slow) * 2) alternate-reverse infinite linear;padding-block:var(--calcite-loader-padding, 4rem)}:host([scale=s]){--calcite-loader-font-size:var(--calcite-font-size--2);--calcite-loader-size:2rem;--calcite-loader-size-inline:0.75rem}:host([scale=m]){--calcite-loader-font-size:var(--calcite-font-size-0);--calcite-loader-size:4rem;--calcite-loader-size-inline:1rem}:host([scale=l]){--calcite-loader-font-size:var(--calcite-font-size-2);--calcite-loader-size:6rem;--calcite-loader-size-inline:1.5rem}:host([no-padding]){padding-block:0px}:host{display:flex}.loader__text{display:block;text-align:center;font-size:var(--calcite-font-size--2);line-height:1rem;color:var(--calcite-ui-text-1);margin-block-start:calc(var(--calcite-loader-size) + 1.5rem)}.loader__percentage{position:absolute;display:block;text-align:center;color:var(--calcite-ui-text-1);font-size:var(--calcite-loader-font-size);inline-size:var(--calcite-loader-size);inset-inline-start:50%;margin-inline-start:calc(var(--calcite-loader-size) / 2 * -1);line-height:0.25;transform:scale(1, 1)}.loader__svgs{position:absolute;overflow:visible;opacity:1;inline-size:var(--calcite-loader-size);block-size:var(--calcite-loader-size);inset-inline-start:50%;margin-inline-start:calc(var(--calcite-loader-size) / 2 * -1);transform:scale(1, 1)}.loader__svg{position:absolute;inset-block-start:0px;transform-origin:center;overflow:visible;inset-inline-start:0;inline-size:var(--calcite-loader-size);block-size:var(--calcite-loader-size);animation-iteration-count:infinite;animation-timing-function:linear;animation-name:loader-clockwise}@supports (display: grid){.loader__svg--1{animation-name:loader-offset-1}.loader__svg--2{animation-name:loader-offset-2}.loader__svg--3{animation-name:loader-offset-3}}:host([type=determinate]){animation:none;stroke:var(--calcite-ui-border-3)}:host([type=determinate]) .loader__svg--3{animation:none;stroke:var(--calcite-ui-brand);stroke-dasharray:150.79632;transform:rotate(-90deg);transition:all var(--calcite-internal-animation-timing-fast) linear}:host([inline]){position:relative;margin:0px;animation:none;stroke:currentColor;stroke-width:2;padding-block:0px;block-size:var(--calcite-loader-size-inline);min-block-size:var(--calcite-loader-size-inline);inline-size:var(--calcite-loader-size-inline);margin-inline-end:calc(var(--calcite-loader-size-inline) * 0.5);vertical-align:calc(var(--calcite-loader-size-inline) * -1 * 0.2)}:host([inline]) .loader__svgs{inset-block-start:0px;margin:0px;inset-inline-start:0;inline-size:var(--calcite-loader-size-inline);block-size:var(--calcite-loader-size-inline)}:host([inline]) .loader__svg{inline-size:var(--calcite-loader-size-inline);block-size:var(--calcite-loader-size-inline)}:host([complete]){opacity:0;transform:scale(0.75, 0.75);transform-origin:center;transition:opacity var(--calcite-internal-animation-timing-medium) linear 1000ms, transform var(--calcite-internal-animation-timing-medium) linear 1000ms}:host([complete]) .loader__svgs{opacity:0;transform:scale(0.75, 0.75);transform-origin:center;transition:opacity calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms, transform calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms}:host([complete]) .loader__percentage{color:var(--calcite-ui-brand);transform:scale(1.05, 1.05);transform-origin:center;transition:color var(--calcite-internal-animation-timing-medium) linear, transform var(--calcite-internal-animation-timing-medium) linear}.loader__svg--1{stroke-dasharray:27.9252444444% 139.6262222222%;animation-duration:calc(var(--calcite-internal-animation-timing-slow) * 2.4)}@keyframes loader-offset-1{0%{stroke-dasharray:27.9252444444% 251.3272%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-83.7757333333%}100%{stroke-dasharray:27.9252444444% 251.3272%;stroke-dashoffset:-279.2524444444%}}.loader__svg--2{stroke-dasharray:55.8504888889% 139.6262222222%;animation-duration:calc(var(--calcite-internal-animation-timing-slow) * 3.2)}@keyframes loader-offset-2{0%{stroke-dasharray:55.8504888889% 223.4019555556%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-97.7383555556%}100%{stroke-dasharray:55.8504888889% 223.4019555556%;stroke-dashoffset:-279.2524444444%}}.loader__svg--3{stroke-dasharray:13.9626222222% 139.6262222222%;animation-duration:calc(var(--calcite-internal-animation-timing-slow) * 3.867)}@keyframes loader-offset-3{0%{stroke-dasharray:13.9626222222% 265.2898222222%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-76.7944222222%}100%{stroke-dasharray:13.9626222222% 265.2898222222%;stroke-dashoffset:-279.2524444444%}}@keyframes loader-color-shift{0%{stroke:var(--calcite-ui-brand)}33%{stroke:var(--calcite-ui-brand-press)}66%{stroke:var(--calcite-ui-brand-hover)}100%{stroke:var(--calcite-ui-brand)}}@keyframes loader-clockwise{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}',Ogt=Ase(class extends Rse{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.inline=!1,this.label=void 0,this.scale="m",this.type=void 0,this.value=0,this.text=""}render(){const{el:t,inline:e,label:i,scale:r,text:n,type:s,value:o}=this,a=t.id||XKe(),l=.45,c=e?this.getInlineSize(r):this.getSize(r),h=c*l,p=`0 0 ${c} ${c}`,f=s==="determinate",m=2*h*Math.PI,g=o/100*m,_=m-g,b=Math.floor(o),w={"aria-valuenow":b,"aria-valuemin":0,"aria-valuemax":100,complete:b===100},x={r:h,cx:c/2,cy:c/2},T={"stroke-dasharray":`${g} ${_}`};return ws(Sse,{"aria-label":i,id:a,role:"progressbar",...f?w:{}},ws("div",{class:"loader__svgs"},ws("svg",{"aria-hidden":"true",class:"loader__svg loader__svg--1",viewBox:p},ws("circle",{...x})),ws("svg",{"aria-hidden":"true",class:"loader__svg loader__svg--2",viewBox:p},ws("circle",{...x})),ws("svg",{"aria-hidden":"true",class:"loader__svg loader__svg--3",viewBox:p,...f?{style:T}:{}},ws("circle",{...x}))),n&&ws("div",{class:"loader__text"},n),f&&ws("div",{class:"loader__percentage"},o))}getSize(t){return{s:32,m:56,l:80}[t]}getInlineSize(t){return{s:12,m:16,l:20}[t]}get el(){return this}static get style(){return Mgt}},[1,"calcite-loader",{inline:[516],label:[1],scale:[513],type:[513],value:[2],text:[1]}]);function vLe(){if(typeof customElements>"u")return;["calcite-loader"].forEach(e=>{switch(e){case"calcite-loader":customElements.get(e)||customElements.define(e,Ogt);break}})}vLe();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.7
 */(function(t){if(typeof t.requestSubmit=="function")return;t.requestSubmit=function(r){r?(e(r,this),r.click()):(r=document.createElement("input"),r.type="submit",r.hidden=!0,this.appendChild(r),r.click(),this.removeChild(r))};function e(r,n){r instanceof HTMLElement||i(TypeError,"parameter 1 is not of type 'HTMLElement'"),r.type=="submit"||i(TypeError,"The specified element is not a submit button"),r.form==n||i(DOMException,"The specified element is not owned by this form element","NotFoundError")}function i(r,n,s){throw new r("Failed to execute 'requestSubmit' on 'HTMLFormElement': "+n+".",s)}})(HTMLFormElement.prototype);const uh={buttonLoader:"calcite-button--loader",content:"content",contentSlotted:"content--slotted",icon:"icon",iconStart:"icon--start",iconEnd:"icon--end",loadingIn:"loading-in",loadingOut:"loading-out",iconStartEmpty:"icon-start-empty",iconEndEmpty:"icon-end-empty",buttonPadding:"button-padding",buttonPaddingShrunk:"button-padding--shrunk"},Pgt="@keyframes in{0%{opacity:0}100%{opacity:1}}@keyframes in-down{0%{opacity:0;transform:translate3D(0, -5px, 0)}100%{opacity:1;transform:translate3D(0, 0, 0)}}@keyframes in-up{0%{opacity:0;transform:translate3D(0, 5px, 0)}100%{opacity:1;transform:translate3D(0, 0, 0)}}@keyframes in-scale{0%{opacity:0;transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;transform:scale3D(1, 1, 1)}}:root{--calcite-animation-timing:calc(150ms * var(--calcite-internal-duration-factor));--calcite-internal-duration-factor:var(--calcite-duration-factor, 1);--calcite-internal-animation-timing-fast:calc(100ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-medium:calc(200ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-slow:calc(300ms * var(--calcite-internal-duration-factor))}.calcite-animate{opacity:0;animation-fill-mode:both;animation-duration:var(--calcite-animation-timing)}.calcite-animate__in{animation-name:in}.calcite-animate__in-down{animation-name:in-down}.calcite-animate__in-up{animation-name:in-up}.calcite-animate__in-scale{animation-name:in-scale}@media (prefers-reduced-motion: reduce){:root{--calcite-internal-duration-factor:0}}:root{--calcite-floating-ui-transition:var(--calcite-animation-timing);--calcite-floating-ui-z-index:600}:host([hidden]){display:none}:host([disabled]){pointer-events:none;cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-ui-opacity-disabled)}:host{display:inline-block;inline-size:auto;vertical-align:middle}:host([round]){border-radius:50px}:host([round]) a,:host([round]) button{border-radius:50px}:host button,:host a{outline-color:transparent}:host button:focus,:host a:focus{outline:2px solid var(--calcite-ui-brand);outline-offset:2px}:host button,:host a{--calcite-button-content-margin-internal:0.5rem;--calcite-button-padding-x-internal:7px;--calcite-button-padding-y-internal:3px;padding-block:var(--calcite-button-padding-y-internal);padding-inline:var(--calcite-button-padding-x-internal);position:relative;box-sizing:border-box;display:flex;block-size:100%;inline-size:100%;cursor:pointer;-webkit-user-select:none;user-select:none;-webkit-appearance:none;appearance:none;align-items:center;justify-content:center;border-radius:0px;border-style:none;text-align:center;font-family:inherit;font-weight:var(--calcite-font-weight-normal);text-decoration-line:none;transition:color var(--calcite-animation-timing) ease-in-out, background-color var(--calcite-animation-timing) ease-in-out, box-shadow var(--calcite-animation-timing) ease-in-out, outline-color var(--calcite-internal-animation-timing-fast) ease-in-out}:host button:hover,:host a:hover{text-decoration-line:none}.content{display:flex;flex-basis:auto;margin-inline:var(--calcite-button-content-margin-internal)}.icon-start-empty .content{margin-inline-start:unset}.icon-end-empty .content{margin-inline-end:unset}:host([scale=m]) button,:host([scale=m]) a{--calcite-button-content-margin-internal:0.75rem}:host([scale=l]) button,:host([scale=l]) a{--calcite-button-content-margin-internal:1rem}:host([width=auto]){inline-size:auto}:host([width=half]){inline-size:50%}:host([width=full]){inline-size:100%}:host([alignment=center]:not([width=auto])) a,:host([alignment=center]:not([width=auto])) button{justify-content:center}:host([alignment=start]:not([width=auto])) a,:host([alignment=start]:not([width=auto])) button{justify-content:flex-start}:host([alignment=end]:not([width=auto])) a,:host([alignment=end]:not([width=auto])) button{justify-content:flex-end}:host([alignment*=space-between]:not([width=auto])) a,:host([alignment*=space-between]:not([width=auto])) button{justify-content:space-between}:host([alignment=icon-start-space-between]:not([width=auto])) .icon--start{margin-inline-end:auto}:host([alignment=icon-start-space-between]:not([width=auto])) a,:host([alignment=icon-start-space-between]:not([width=auto])) button{text-align:unset}:host([alignment=icon-end-space-between]:not([width=auto])) .icon--end{margin-inline-start:auto}:host([alignment=icon-end-space-between]:not([width=auto])) a,:host([alignment=icon-end-space-between]:not([width=auto])) button{text-align:unset}:host([alignment=center]) a:not(.content--slotted) .icon--start+.icon--end,:host([alignment=center]) button:not(.content--slotted) .icon--start+.icon--end{margin-inline-start:var(--calcite-button-content-margin-internal)}.icon{position:relative;margin:0px;display:inline-flex;font-weight:var(--calcite-font-weight-normal);line-height:inherit}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}:host([loading]){pointer-events:none}:host([loading]) button,:host([loading]) a{pointer-events:none;opacity:var(--calcite-ui-opacity-disabled)}@keyframes loader-in{0%{inline-size:0;opacity:0;transform:scale(0.5)}100%{inline-size:1em;opacity:1;transform:scale(1)}}@keyframes loader-out{0%{inline-size:1em;opacity:1;transform:scale(1)}100%{inline-size:0;opacity:0;transform:scale(0.5)}}.calcite-button--loader{display:flex}.calcite-button--loader calcite-loader{margin:0px;transition:inline-size var(--calcite-internal-animation-timing-slow) ease-in-out, opacity var(--calcite-internal-animation-timing-slow) ease-in-out, transform var(--calcite-internal-animation-timing-slow) ease-in-out}.calcite-button--loader calcite-loader.loading-in{animation-name:loader-in;animation-duration:var(--calcite-internal-animation-timing-slow)}.calcite-button--loader calcite-loader.loading-out{animation-name:loader-out;animation-duration:var(--calcite-internal-animation-timing-slow)}:host([loading]) button.content--slotted .calcite-button--loader calcite-loader,:host([loading]) a.content--slotted .calcite-button--loader calcite-loader{margin-inline-end:var(--calcite-button-content-margin-internal)}:host([loading]) button:not(.content--slotted) .icon--start,:host([loading]) button:not(.content--slotted) .icon--end,:host([loading]) a:not(.content--slotted) .icon--start,:host([loading]) a:not(.content--slotted) .icon--end{display:none}:host([appearance]) button,:host([appearance]) a{border-width:1px;border-style:solid;border-color:transparent}:host([kind=brand]) button,:host([kind=brand]) a{background-color:var(--calcite-ui-brand);color:var(--calcite-ui-text-inverse)}:host([kind=brand]) button:hover,:host([kind=brand]) button:focus,:host([kind=brand]) a:hover,:host([kind=brand]) a:focus{background-color:var(--calcite-ui-brand-hover)}:host([kind=brand]) button:active,:host([kind=brand]) a:active{background-color:var(--calcite-ui-brand-press)}:host([kind=brand]) button calcite-loader,:host([kind=brand]) a calcite-loader{color:var(--calcite-ui-text-inverse)}:host([kind=danger]) button,:host([kind=danger]) a{background-color:var(--calcite-ui-danger);color:var(--calcite-ui-text-inverse)}:host([kind=danger]) button:hover,:host([kind=danger]) button:focus,:host([kind=danger]) a:hover,:host([kind=danger]) a:focus{background-color:var(--calcite-ui-danger-hover)}:host([kind=danger]) button:active,:host([kind=danger]) a:active{background-color:var(--calcite-ui-danger-press)}:host([kind=danger]) button calcite-loader,:host([kind=danger]) a calcite-loader{color:var(--calcite-ui-text-inverse)}:host([kind=neutral]) button,:host([kind=neutral]) a{background-color:var(--calcite-ui-foreground-3);color:var(--calcite-ui-text-1)}:host([kind=neutral]) button:hover,:host([kind=neutral]) button:focus,:host([kind=neutral]) a:hover,:host([kind=neutral]) a:focus{background-color:var(--calcite-ui-foreground-2)}:host([kind=neutral]) button:active,:host([kind=neutral]) a:active{background-color:var(--calcite-ui-foreground-1)}:host([kind=neutral]) button calcite-loader,:host([kind=neutral]) a calcite-loader{color:var(--calcite-ui-text-1)}:host([kind=inverse]) button,:host([kind=inverse]) a{color:var(--calcite-ui-text-inverse);background-color:var(--calcite-ui-inverse)}:host([kind=inverse]) button:hover,:host([kind=inverse]) button:focus,:host([kind=inverse]) a:hover,:host([kind=inverse]) a:focus{background-color:var(--calcite-ui-inverse-hover)}:host([kind=inverse]) button:active,:host([kind=inverse]) a:active{background-color:var(--calcite-ui-inverse-press)}:host([kind=inverse]) button calcite-loader,:host([kind=inverse]) a calcite-loader{color:var(--calcite-ui-text-inverse)}:host([appearance=outline-fill]) button,:host([appearance=outline-fill]) a{border-width:1px;border-style:solid;background-color:var(--calcite-ui-foreground-1);box-shadow:inset 0 0 0 1px transparent}:host([appearance=outline-fill][kind=brand]) button,:host([appearance=outline-fill][kind=brand]) a{border-color:var(--calcite-ui-brand);background-color:var(--calcite-ui-foreground-1);color:var(--calcite-ui-brand)}:host([appearance=outline-fill][kind=brand]) button:hover,:host([appearance=outline-fill][kind=brand]) a:hover{border-color:var(--calcite-ui-brand-hover);color:var(--calcite-ui-brand-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-brand-hover)}:host([appearance=outline-fill][kind=brand]) button:focus,:host([appearance=outline-fill][kind=brand]) a:focus{border-color:var(--calcite-ui-brand);color:var(--calcite-ui-brand);box-shadow:inset 0 0 0 2px var(--calcite-ui-brand)}:host([appearance=outline-fill][kind=brand]) button:active,:host([appearance=outline-fill][kind=brand]) a:active{border-color:var(--calcite-ui-brand-press);color:var(--calcite-ui-brand-press);box-shadow:inset 0 0 0 2px var(--calcite-ui-brand-press)}:host([appearance=outline-fill][kind=brand]) button calcite-loader,:host([appearance=outline-fill][kind=brand]) a calcite-loader{color:var(--calcite-ui-brand)}:host([appearance=outline-fill][kind=danger]) button,:host([appearance=outline-fill][kind=danger]) a{border-color:var(--calcite-ui-danger);background-color:var(--calcite-ui-foreground-1);color:var(--calcite-ui-danger)}:host([appearance=outline-fill][kind=danger]) button:hover,:host([appearance=outline-fill][kind=danger]) a:hover{border-color:var(--calcite-ui-danger-hover);color:var(--calcite-ui-danger-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-danger-hover)}:host([appearance=outline-fill][kind=danger]) button:focus,:host([appearance=outline-fill][kind=danger]) a:focus{border-color:var(--calcite-ui-danger);color:var(--calcite-ui-danger);box-shadow:inset 0 0 0 2px var(--calcite-ui-danger)}:host([appearance=outline-fill][kind=danger]) button:active,:host([appearance=outline-fill][kind=danger]) a:active{border-color:var(--calcite-ui-danger-press);color:var(--calcite-ui-danger-press);box-shadow:inset 0 0 0 2px var(--calcite-ui-danger-press)}:host([appearance=outline-fill][kind=danger]) button calcite-loader,:host([appearance=outline-fill][kind=danger]) a calcite-loader{color:var(--calcite-ui-danger)}:host([appearance=outline-fill][kind=neutral]) button,:host([appearance=outline-fill][kind=neutral]) a{background-color:var(--calcite-ui-foreground-1);color:var(--calcite-ui-text-1);border-color:var(--calcite-ui-foreground-3)}:host([appearance=outline-fill][kind=neutral]) button:hover,:host([appearance=outline-fill][kind=neutral]) a:hover{box-shadow:inset 0 0 0 1px var(--calcite-ui-foreground-3)}:host([appearance=outline-fill][kind=neutral]) button:focus,:host([appearance=outline-fill][kind=neutral]) a:focus{box-shadow:inset 0 0 0 2px var(--calcite-ui-foreground-3)}:host([appearance=outline-fill][kind=neutral]) button:active,:host([appearance=outline-fill][kind=neutral]) a:active{box-shadow:inset 0 0 0 2px var(--calcite-ui-foreground-3)}:host([appearance=outline-fill][kind=neutral]) button calcite-loader,:host([appearance=outline-fill][kind=neutral]) a calcite-loader{color:var(--calcite-ui-text-1)}:host([appearance=outline-fill][kind=inverse]) button,:host([appearance=outline-fill][kind=inverse]) a{background-color:var(--calcite-ui-foreground-1);color:var(--calcite-ui-text-1);border-color:var(--calcite-ui-inverse)}:host([appearance=outline-fill][kind=inverse]) button:hover,:host([appearance=outline-fill][kind=inverse]) a:hover{border-color:var(--calcite-ui-inverse-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-inverse-hover)}:host([appearance=outline-fill][kind=inverse]) button:focus,:host([appearance=outline-fill][kind=inverse]) a:focus{border-color:var(--calcite-ui-inverse);box-shadow:inset 0 0 0 2px var(--calcite-ui-inverse)}:host([appearance=outline-fill][kind=inverse]) button:active,:host([appearance=outline-fill][kind=inverse]) a:active{border-color:var(--calcite-ui-inverse-press);box-shadow:inset 0 0 0 2px var(--calcite-ui-inverse-press)}:host([appearance=outline-fill][kind=inverse]) button calcite-loader,:host([appearance=outline-fill][kind=inverse]) a calcite-loader{color:var(--calcite-ui-text-1)}:host([appearance=outline]) button,:host([appearance=outline]) a{border-width:1px;border-style:solid;background-color:transparent;box-shadow:inset 0 0 0 1px transparent}:host([appearance=outline][kind=brand]) button,:host([appearance=outline][kind=brand]) a{border-color:var(--calcite-ui-brand);background-color:transparent;color:var(--calcite-ui-brand)}:host([appearance=outline][kind=brand]) button:hover,:host([appearance=outline][kind=brand]) a:hover{border-color:var(--calcite-ui-brand-hover);color:var(--calcite-ui-brand-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-brand-hover)}:host([appearance=outline][kind=brand]) button:focus,:host([appearance=outline][kind=brand]) a:focus{border-color:var(--calcite-ui-brand);color:var(--calcite-ui-brand);box-shadow:inset 0 0 0 2px var(--calcite-ui-brand)}:host([appearance=outline][kind=brand]) button:active,:host([appearance=outline][kind=brand]) a:active{border-color:var(--calcite-ui-brand-press);color:var(--calcite-ui-brand-press);box-shadow:inset 0 0 0 2px var(--calcite-ui-brand-press)}:host([appearance=outline][kind=brand]) button calcite-loader,:host([appearance=outline][kind=brand]) a calcite-loader{color:var(--calcite-ui-brand)}:host([appearance=outline][kind=danger]) button,:host([appearance=outline][kind=danger]) a{border-color:var(--calcite-ui-danger);background-color:transparent;color:var(--calcite-ui-danger)}:host([appearance=outline][kind=danger]) button:hover,:host([appearance=outline][kind=danger]) a:hover{border-color:var(--calcite-ui-danger-hover);color:var(--calcite-ui-danger-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-danger-hover)}:host([appearance=outline][kind=danger]) button:focus,:host([appearance=outline][kind=danger]) a:focus{border-color:var(--calcite-ui-danger);color:var(--calcite-ui-danger);box-shadow:inset 0 0 0 2px var(--calcite-ui-danger)}:host([appearance=outline][kind=danger]) button:active,:host([appearance=outline][kind=danger]) a:active{border-color:var(--calcite-ui-danger-press);color:var(--calcite-ui-danger-press);box-shadow:inset 0 0 0 2px var(--calcite-ui-danger-press)}:host([appearance=outline][kind=danger]) button calcite-loader,:host([appearance=outline][kind=danger]) a calcite-loader{color:var(--calcite-ui-danger)}:host([appearance=outline][kind=neutral]) button,:host([appearance=outline][kind=neutral]) a{background-color:transparent;color:var(--calcite-ui-text-1);border-color:var(--calcite-ui-border-1)}:host([appearance=outline][kind=neutral]) button:hover,:host([appearance=outline][kind=neutral]) a:hover{box-shadow:inset 0 0 0 1px var(--calcite-ui-foreground-3)}:host([appearance=outline][kind=neutral]) button:focus,:host([appearance=outline][kind=neutral]) a:focus{box-shadow:inset 0 0 0 2px var(--calcite-ui-foreground-3)}:host([appearance=outline][kind=neutral]) button:active,:host([appearance=outline][kind=neutral]) a:active{box-shadow:inset 0 0 0 2px var(--calcite-ui-foreground-3)}:host([appearance=outline][kind=neutral]) button calcite-loader,:host([appearance=outline][kind=neutral]) a calcite-loader{color:var(--calcite-ui-text-1)}:host([appearance=outline][kind=inverse]) button,:host([appearance=outline][kind=inverse]) a{background-color:transparent;color:var(--calcite-ui-text-1);border-color:var(--calcite-ui-inverse)}:host([appearance=outline][kind=inverse]) button:hover,:host([appearance=outline][kind=inverse]) a:hover{border-color:var(--calcite-ui-inverse-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-inverse-hover)}:host([appearance=outline][kind=inverse]) button:focus,:host([appearance=outline][kind=inverse]) a:focus{border-color:var(--calcite-ui-inverse);box-shadow:inset 0 0 0 2px var(--calcite-ui-inverse)}:host([appearance=outline][kind=inverse]) button:active,:host([appearance=outline][kind=inverse]) a:active{border-color:var(--calcite-ui-inverse-press);box-shadow:inset 0 0 0 2px var(--calcite-ui-inverse-press)}:host([appearance=outline][kind=inverse]) button calcite-loader,:host([appearance=outline][kind=inverse]) a calcite-loader{color:var(--calcite-ui-text-1)}:host([appearance=outline-fill][split-child=primary]) button,:host([appearance=outline][split-child=primary]) button{border-inline-end-width:0;border-inline-start-width:1px}:host([appearance=outline-fill][split-child=secondary]) button,:host([appearance=outline][split-child=secondary]) button{border-inline-start-width:0;border-inline-end-width:1px}:host([appearance=transparent]:not(.enable-editing-button)) button,:host([appearance=transparent]:not(.enable-editing-button)) a{background-color:transparent}:host([appearance=transparent]:not(.enable-editing-button)) button:hover,:host([appearance=transparent]:not(.enable-editing-button)) button:focus,:host([appearance=transparent]:not(.enable-editing-button)) a:hover,:host([appearance=transparent]:not(.enable-editing-button)) a:focus{background-color:var(--calcite-button-transparent-hover)}:host([appearance=transparent]:not(.enable-editing-button)) button:active,:host([appearance=transparent]:not(.enable-editing-button)) a:active{background-color:var(--calcite-button-transparent-press)}:host([appearance=transparent][kind=brand]) button,:host([appearance=transparent][kind=brand]) a{color:var(--calcite-ui-brand)}:host([appearance=transparent][kind=brand]) button:hover,:host([appearance=transparent][kind=brand]) a:hover{color:var(--calcite-ui-brand-hover)}:host([appearance=transparent][kind=brand]) button:focus,:host([appearance=transparent][kind=brand]) a:focus{color:var(--calcite-ui-brand)}:host([appearance=transparent][kind=brand]) button:active,:host([appearance=transparent][kind=brand]) a:active{color:var(--calcite-ui-brand-press)}:host([appearance=transparent][kind=brand]) button calcite-loader,:host([appearance=transparent][kind=brand]) a calcite-loader{color:var(--calcite-ui-brand)}:host([appearance=transparent][kind=danger]) button,:host([appearance=transparent][kind=danger]) a{color:var(--calcite-ui-danger)}:host([appearance=transparent][kind=danger]) button:hover,:host([appearance=transparent][kind=danger]) a:hover{color:var(--calcite-ui-danger-hover)}:host([appearance=transparent][kind=danger]) button:focus,:host([appearance=transparent][kind=danger]) a:focus{color:var(--calcite-ui-danger)}:host([appearance=transparent][kind=danger]) button:active,:host([appearance=transparent][kind=danger]) a:active{color:var(--calcite-ui-danger-press)}:host([appearance=transparent][kind=danger]) button calcite-loader,:host([appearance=transparent][kind=danger]) a calcite-loader{color:var(--calcite-ui-danger)}:host([appearance=transparent][kind=neutral]:not(.cancel-editing-button)) button,:host([appearance=transparent][kind=neutral]:not(.cancel-editing-button)) a,:host([appearance=transparent][kind=neutral]:not(.cancel-editing-button)) calcite-loader{color:var(--calcite-ui-text-1)}:host([appearance=transparent][kind=neutral].cancel-editing-button) button{border-block-start-width:1px;border-block-end-width:1px;color:var(--calcite-ui-text-3);border-block-start-color:var(--calcite-ui-border-input);border-block-end-color:var(--calcite-ui-border-input);border-block-style:solid}:host([appearance=transparent][kind=neutral].cancel-editing-button) button:not(.content--slotted){--calcite-button-padding-y-internal:0}:host([appearance=transparent][kind=neutral].cancel-editing-button) button:hover{color:var(--calcite-ui-text-1)}:host([appearance=transparent][kind=neutral].enable-editing-button) button{background-color:transparent}:host(.confirm-changes-button) button:focus,:host(.cancel-editing-button) button:focus,:host(.enable-editing-button) button:focus{outline-offset:-2px}:host([appearance=transparent][kind=inverse]) button,:host([appearance=transparent][kind=inverse]) a,:host([appearance=transparent][kind=inverse]) calcite-loader{color:var(--calcite-ui-text-inverse)}:host([scale=s]) button.content--slotted,:host([scale=s]) a.content--slotted{font-size:var(--calcite-font-size--2);line-height:1rem}:host([scale=s][appearance=transparent]) button.content--slotted,:host([scale=s][appearance=transparent]) a.content--slotted{--calcite-button-padding-x-internal:0.5rem}:host([scale=s]) button,:host([scale=s]) a{--calcite-button-padding-y-internal:3px}:host([scale=m]) button.content--slotted,:host([scale=m]) a.content--slotted{--calcite-button-padding-x-internal:11px;font-size:var(--calcite-font-size--1);line-height:1rem}:host([scale=m]) button,:host([scale=m]) a{--calcite-button-padding-y-internal:7px}:host([scale=m][appearance=transparent]) button.content--slotted,:host([scale=m][appearance=transparent]) a.content--slotted{--calcite-button-padding-x-internal:0.75rem}:host([scale=l]) button.content--slotted,:host([scale=l]) a.content--slotted{--calcite-button-padding-x-internal:15px;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=l]) .button-padding{--calcite-button-padding-x-internal:1rem;--calcite-button-padding-y-internal:11px}:host([scale=l]) .button-padding--shrunk{--calcite-button-padding-y-internal:9px}:host([scale=s]) button:not(.content--slotted),:host([scale=s]) a:not(.content--slotted){--calcite-button-padding-x-internal:0.125rem;--calcite-button-padding-y-internal:3px;inline-size:1.5rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;min-block-size:1.5rem}:host([scale=m]) button:not(.content--slotted),:host([scale=m]) a:not(.content--slotted){--calcite-button-padding-x-internal:0.125rem;--calcite-button-padding-y-internal:7px;inline-size:2rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;min-block-size:2rem}:host([scale=l]) button:not(.content--slotted),:host([scale=l]) a:not(.content--slotted){--calcite-button-padding-x-internal:0.125rem;--calcite-button-padding-y-internal:9px;inline-size:2.75rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;min-block-size:2.75rem}:host([scale=l][appearance=transparent]) button:not(.content--slotted),:host([scale=l][appearance=transparent]) a:not(.content--slotted){--calcite-button-padding-y-internal:0.625rem}:host([scale=s][icon-start][icon-end]) button:not(.content--slotted),:host([scale=s][icon-start][icon-end]) a:not(.content--slotted){--calcite-button-padding-x-internal:23px;block-size:1.5rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=s][icon-start][icon-end][appearance=transparent]) button:not(.content--slotted),:host([scale=s][icon-start][icon-end][appearance=transparent]) a:not(.content--slotted){--calcite-button-padding-x-internal:1.5rem}:host([scale=m][icon-start][icon-end]) button:not(.content--slotted),:host([scale=m][icon-start][icon-end]) a:not(.content--slotted){--calcite-button-padding-x-internal:2rem;block-size:2rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=m][icon-start][icon-end][appearance=transparent]) button:not(.content--slotted),:host([scale=m][icon-start][icon-end][appearance=transparent]) a:not(.content--slotted){--calcite-button-padding-x-internal:33px}:host([scale=l][icon-start][icon-end]) button:not(.content--slotted),:host([scale=l][icon-start][icon-end]) a:not(.content--slotted){--calcite-button-padding-x-internal:43px;block-size:2.75rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=l][icon-start][icon-end]) button:not(.content--slotted) .icon--start+.icon--end,:host([scale=l][icon-start][icon-end]) a:not(.content--slotted) .icon--start+.icon--end{margin-inline-start:1rem}:host([scale=l][icon-start][icon-end][appearance=transparent]) button:not(.content--slotted),:host([scale=l][icon-start][icon-end][appearance=transparent]) a:not(.content--slotted){--calcite-button-padding-x-internal:2.75rem}",Igt=Ase(class extends Rse{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.mutationObserver=dae("mutation",()=>this.updateHasContent()),this.handleClick=()=>{const{type:t}=this;this.href||(t==="submit"?Umt(this):t==="reset"&&Vmt(this))},this.alignment="center",this.appearance="solid",this.label=void 0,this.kind="brand",this.disabled=!1,this.href=void 0,this.iconEnd=void 0,this.iconFlipRtl=void 0,this.iconStart=void 0,this.loading=!1,this.name=void 0,this.rel=void 0,this.round=!1,this.scale="m",this.splitChild=!1,this.target=void 0,this.type="button",this.width="auto",this.messages=void 0,this.messageOverrides=void 0,this.hasContent=!1,this.hasLoader=!1,this.effectiveLocale="",this.defaultMessages=void 0}loadingChanged(t,e){t&&!e&&(this.hasLoader=!0),!t&&e&&window.setTimeout(()=>{this.hasLoader=!1},300)}onMessagesChange(){}async connectedCallback(){pgt(this),wgt(this),this.hasLoader=this.loading,this.setupTextContentObserver(),cLe(this),this.formEl=SO(this.el,"form")}disconnectedCallback(){var t;(t=this.mutationObserver)==null||t.disconnect(),Wmt(this),mgt(this),xgt(this),this.formEl=null}async componentWillLoad(){Kmt(this),this.updateHasContent(),await vgt(this)}componentDidLoad(){Qmt(this)}componentDidRender(){Gmt(this)}render(){const t=this.href?"a":"button",e=t,i=this.hasLoader?ws("div",{class:uh.buttonLoader},ws("calcite-loader",{class:this.loading?uh.loadingIn:uh.loadingOut,inline:!0,label:this.messages.loading,scale:this.scale==="l"?"m":"s"})):null,r=!this.iconStart&&!this.iconEnd,n=ws("calcite-icon",{class:{[uh.icon]:!0,[uh.iconStart]:!0},flipRtl:this.iconFlipRtl==="start"||this.iconFlipRtl==="both",icon:this.iconStart,scale:this.scale==="l"?"m":"s"}),s=ws("calcite-icon",{class:{[uh.icon]:!0,[uh.iconEnd]:!0},flipRtl:this.iconFlipRtl==="end"||this.iconFlipRtl==="both",icon:this.iconEnd,scale:this.scale==="l"?"m":"s"}),o=ws("span",{class:uh.content},ws("slot",null));return ws(e,{"aria-label":Xmt(this),class:{[uh.buttonPadding]:r,[uh.buttonPaddingShrunk]:!r,[uh.contentSlotted]:this.hasContent,[uh.iconStartEmpty]:!this.iconStart,[uh.iconEndEmpty]:!this.iconEnd},disabled:this.disabled||this.loading,href:t==="a"&&this.href,name:t==="button"&&this.name,onClick:this.handleClick,ref:a=>this.childEl=a,rel:t==="a"&&this.rel,tabIndex:this.disabled||this.loading?-1:null,target:t==="a"&&this.target,type:t==="button"&&this.type},i,this.iconStart?n:null,this.hasContent?o:null,this.iconEnd?s:null)}async setFocus(){var t;await egt(this),(t=this.childEl)==null||t.focus()}effectiveLocaleChange(){bgt(this,this.effectiveLocale)}updateHasContent(){var e,i;const t=this.el.textContent.trim().length>0||this.el.childNodes.length>0;this.hasContent=this.el.childNodes.length===1&&((e=this.el.childNodes[0])==null?void 0:e.nodeName)==="#text"?((i=this.el.textContent)==null?void 0:i.trim().length)>0:t}setupTextContentObserver(){var t;(t=this.mutationObserver)==null||t.observe(this.el,{childList:!0,subtree:!0})}onLabelClick(){this.handleClick(),this.setFocus()}static get assetsDirs(){return["assets"]}get el(){return this}static get watchers(){return{loading:["loadingChanged"],messageOverrides:["onMessagesChange"],effectiveLocale:["effectiveLocaleChange"]}}static get style(){return Pgt}},[1,"calcite-button",{alignment:[513],appearance:[513],label:[1],kind:[513],disabled:[516],href:[513],iconEnd:[513,"icon-end"],iconFlipRtl:[513,"icon-flip-rtl"],iconStart:[513,"icon-start"],loading:[516],name:[513],rel:[513],round:[516],scale:[513],splitChild:[520,"split-child"],target:[513],type:[1537],width:[513],messages:[1040],messageOverrides:[1040],hasContent:[32],hasLoader:[32],effectiveLocale:[32],defaultMessages:[32],setFocus:[64]}]);function $gt(){if(typeof customElements>"u")return;["calcite-button","calcite-icon","calcite-loader"].forEach(e=>{switch(e){case"calcite-button":customElements.get(e)||customElements.define(e,Igt);break;case"calcite-icon":customElements.get(e)||_Le();break;case"calcite-loader":customElements.get(e)||vLe();break}})}$gt();const Lgt=t=>t.toLowerCase().split("-").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(""),bLe=t=>t.replace(/([A-Z])/g,e=>`-${e[0].toLowerCase()}`),Dgt=(t,e,i={})=>{if(t instanceof Element){const r=Ngt(t.classList,e,i);r!==""&&(t.className=r),Object.keys(e).forEach(n=>{if(!(n==="children"||n==="style"||n==="ref"||n==="class"||n==="className"||n==="forwardedRef"))if(n.indexOf("on")===0&&n[2]===n[2].toUpperCase()){const s=n.substring(2),o=s[0].toLowerCase()+s.substring(1);wLe(o)||Fgt(t,o,e[n])}else t[n]=e[n],typeof e[n]==="string"&&t.setAttribute(bLe(n),e[n])})}},Ngt=(t,e,i)=>{const r=e.className||e.class,n=i.className||i.class,s=PH(t),o=PH(r?r.split(" "):[]),a=PH(n?n.split(" "):[]),l=[];return s.forEach(c=>{o.has(c)?(l.push(c),o.delete(c)):a.has(c)||l.push(c)}),o.forEach(c=>l.push(c)),l.join(" ")};/**
 * Checks if an event is supported in the current execution environment.
 * @license Modernizr 3.0.0pre (Custom Build) | MIT
 */const wLe=t=>{if(typeof document>"u")return!0;{const e="on"+t;let i=e in document;if(!i){const r=document.createElement("div");r.setAttribute(e,"return;"),i=typeof r[e]=="function"}return i}},Fgt=(t,e,i)=>{const r=t.__events||(t.__events={}),n=r[e];n&&t.removeEventListener(e,n),t.addEventListener(e,r[e]=function(o){i&&i.call(this,o)})},PH=t=>{const e=new Map;return t.forEach(i=>e.set(i,i)),e},kgt=(t,e)=>{typeof t=="function"?t(e):t!=null&&(t.current=e)},Ugt=(...t)=>e=>{t.forEach(i=>{kgt(i,e)})},Vgt=(t,e)=>{const i=(r,n)=>gL.createElement(t,Object.assign({},r,{forwardedRef:n}));return i.displayName=e,gL.forwardRef(i)};var zgt=globalThis&&globalThis.__rest||function(t,e){var i={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(i[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(t);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(t,r[n])&&(i[r[n]]=t[r[n]]);return i};const Bgt=(t,e,i,r)=>{r!==void 0&&r();const n=Lgt(t),s=class extends gL.Component{constructor(o){super(o),this.setComponentElRef=a=>{this.componentEl=a}}componentDidMount(){this.componentDidUpdate(this.props)}componentDidUpdate(o){Dgt(this.componentEl,this.props,o)}render(){const o=this.props,{children:a,forwardedRef:l,style:c,className:h,ref:p}=o,f=zgt(o,["children","forwardedRef","style","className","ref"]);let m=Object.keys(f).reduce((_,b)=>{const w=f[b];if(b.indexOf("on")===0&&b[2]===b[2].toUpperCase()){const x=b.substring(2).toLowerCase();typeof document<"u"&&wLe(x)&&(_[b]=w)}else{const x=typeof w;(x==="string"||x==="boolean"||x==="number")&&(_[bLe(b)]=w)}return _},{});i&&(m=i(this.props,m));const g=Object.assign(Object.assign({},m),{ref:Ugt(l,this.setComponentElRef),style:c});return ut.createElement(t,g,a)}static get displayName(){return n}};return e&&(s.contextType=e),Vgt(s,n)},UQ=Bgt("calcite-button");var VQ={},jgt={get exports(){return VQ},set exports(t){VQ=t}};(function(t){var e=typeof window<"u"?window:typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?self:{};/**
 * Prism: Lightweight, robust, elegant syntax highlighting
 *
 * @license MIT <https://opensource.org/licenses/MIT>
 * @author Lea Verou <https://lea.verou.me>
 * @namespace
 * @public
 */var i=function(r){var n=/(?:^|\s)lang(?:uage)?-([\w-]+)(?=\s|$)/i,s=0,o={},a={manual:r.Prism&&r.Prism.manual,disableWorkerMessageHandler:r.Prism&&r.Prism.disableWorkerMessageHandler,util:{encode:function x(T){return T instanceof l?new l(T.type,x(T.content),T.alias):Array.isArray(T)?T.map(x):T.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},type:function(x){return Object.prototype.toString.call(x).slice(8,-1)},objId:function(x){return x.__id||Object.defineProperty(x,"__id",{value:++s}),x.__id},clone:function x(T,E){E=E||{};var C,A;switch(a.util.type(T)){case"Object":if(A=a.util.objId(T),E[A])return E[A];C={},E[A]=C;for(var I in T)T.hasOwnProperty(I)&&(C[I]=x(T[I],E));return C;case"Array":return A=a.util.objId(T),E[A]?E[A]:(C=[],E[A]=C,T.forEach(function(O,D){C[D]=x(O,E)}),C);default:return T}},getLanguage:function(x){for(;x;){var T=n.exec(x.className);if(T)return T[1].toLowerCase();x=x.parentElement}return"none"},setLanguage:function(x,T){x.className=x.className.replace(RegExp(n,"gi"),""),x.classList.add("language-"+T)},currentScript:function(){if(typeof document>"u")return null;if("currentScript"in document&&1<2)return document.currentScript;try{throw new Error}catch(C){var x=(/at [^(\r\n]*\((.*):[^:]+:[^:]+\)$/i.exec(C.stack)||[])[1];if(x){var T=document.getElementsByTagName("script");for(var E in T)if(T[E].src==x)return T[E]}return null}},isActive:function(x,T,E){for(var C="no-"+T;x;){var A=x.classList;if(A.contains(T))return!0;if(A.contains(C))return!1;x=x.parentElement}return!!E}},languages:{plain:o,plaintext:o,text:o,txt:o,extend:function(x,T){var E=a.util.clone(a.languages[x]);for(var C in T)E[C]=T[C];return E},insertBefore:function(x,T,E,C){C=C||a.languages;var A=C[x],I={};for(var O in A)if(A.hasOwnProperty(O)){if(O==T)for(var D in E)E.hasOwnProperty(D)&&(I[D]=E[D]);E.hasOwnProperty(O)||(I[O]=A[O])}var U=C[x];return C[x]=I,a.languages.DFS(a.languages,function(V,B){B===U&&V!=x&&(this[V]=I)}),I},DFS:function x(T,E,C,A){A=A||{};var I=a.util.objId;for(var O in T)if(T.hasOwnProperty(O)){E.call(T,O,T[O],C||O);var D=T[O],U=a.util.type(D);U==="Object"&&!A[I(D)]?(A[I(D)]=!0,x(D,E,null,A)):U==="Array"&&!A[I(D)]&&(A[I(D)]=!0,x(D,E,O,A))}}},plugins:{},highlightAll:function(x,T){a.highlightAllUnder(document,x,T)},highlightAllUnder:function(x,T,E){var C={callback:E,container:x,selector:'code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code'};a.hooks.run("before-highlightall",C),C.elements=Array.prototype.slice.apply(C.container.querySelectorAll(C.selector)),a.hooks.run("before-all-elements-highlight",C);for(var A=0,I;I=C.elements[A++];)a.highlightElement(I,T===!0,C.callback)},highlightElement:function(x,T,E){var C=a.util.getLanguage(x),A=a.languages[C];a.util.setLanguage(x,C);var I=x.parentElement;I&&I.nodeName.toLowerCase()==="pre"&&a.util.setLanguage(I,C);var O=x.textContent,D={element:x,language:C,grammar:A,code:O};function U(B){D.highlightedCode=B,a.hooks.run("before-insert",D),D.element.innerHTML=D.highlightedCode,a.hooks.run("after-highlight",D),a.hooks.run("complete",D),E&&E.call(D.element)}if(a.hooks.run("before-sanity-check",D),I=D.element.parentElement,I&&I.nodeName.toLowerCase()==="pre"&&!I.hasAttribute("tabindex")&&I.setAttribute("tabindex","0"),!D.code){a.hooks.run("complete",D),E&&E.call(D.element);return}if(a.hooks.run("before-highlight",D),!D.grammar){U(a.util.encode(D.code));return}if(T&&r.Worker){var V=new Worker(a.filename);V.onmessage=function(B){U(B.data)},V.postMessage(JSON.stringify({language:D.language,code:D.code,immediateClose:!0}))}else U(a.highlight(D.code,D.grammar,D.language))},highlight:function(x,T,E){var C={code:x,grammar:T,language:E};if(a.hooks.run("before-tokenize",C),!C.grammar)throw new Error('The language "'+C.language+'" has no grammar.');return C.tokens=a.tokenize(C.code,C.grammar),a.hooks.run("after-tokenize",C),l.stringify(a.util.encode(C.tokens),C.language)},tokenize:function(x,T){var E=T.rest;if(E){for(var C in E)T[C]=E[C];delete T.rest}var A=new p;return f(A,A.head,x),h(x,A,T,A.head,0),g(A)},hooks:{all:{},add:function(x,T){var E=a.hooks.all;E[x]=E[x]||[],E[x].push(T)},run:function(x,T){var E=a.hooks.all[x];if(!(!E||!E.length))for(var C=0,A;A=E[C++];)A(T)}},Token:l};r.Prism=a;function l(x,T,E,C){this.type=x,this.content=T,this.alias=E,this.length=(C||"").length|0}l.stringify=function x(T,E){if(typeof T=="string")return T;if(Array.isArray(T)){var C="";return T.forEach(function(U){C+=x(U,E)}),C}var A={type:T.type,content:x(T.content,E),tag:"span",classes:["token",T.type],attributes:{},language:E},I=T.alias;I&&(Array.isArray(I)?Array.prototype.push.apply(A.classes,I):A.classes.push(I)),a.hooks.run("wrap",A);var O="";for(var D in A.attributes)O+=" "+D+'="'+(A.attributes[D]||"").replace(/"/g,"&quot;")+'"';return"<"+A.tag+' class="'+A.classes.join(" ")+'"'+O+">"+A.content+"</"+A.tag+">"};function c(x,T,E,C){x.lastIndex=T;var A=x.exec(E);if(A&&C&&A[1]){var I=A[1].length;A.index+=I,A[0]=A[0].slice(I)}return A}function h(x,T,E,C,A,I){for(var O in E)if(!(!E.hasOwnProperty(O)||!E[O])){var D=E[O];D=Array.isArray(D)?D:[D];for(var U=0;U<D.length;++U){if(I&&I.cause==O+","+U)return;var V=D[U],B=V.inside,ee=!!V.lookbehind,ie=!!V.greedy,J=V.alias;if(ie&&!V.pattern.global){var q=V.pattern.toString().match(/[imsuy]*$/)[0];V.pattern=RegExp(V.pattern.source,q+"g")}for(var N=V.pattern||V,L=C.next,F=A;L!==T.tail&&!(I&&F>=I.reach);F+=L.value.length,L=L.next){var G=L.value;if(T.length>x.length)return;if(!(G instanceof l)){var W=1,Z;if(ie){if(Z=c(N,F,x,ee),!Z||Z.index>=x.length)break;var ye=Z.index,X=Z.index+Z[0].length,oe=F;for(oe+=L.value.length;ye>=oe;)L=L.next,oe+=L.value.length;if(oe-=L.value.length,F=oe,L.value instanceof l)continue;for(var pe=L;pe!==T.tail&&(oe<X||typeof pe.value=="string");pe=pe.next)W++,oe+=pe.value.length;W--,G=x.slice(F,oe),Z.index-=F}else if(Z=c(N,0,G,ee),!Z)continue;var ye=Z.index,Se=Z[0],He=G.slice(0,ye),De=G.slice(ye+Se.length),Te=F+G.length;I&&Te>I.reach&&(I.reach=Te);var ke=L.prev;He&&(ke=f(T,ke,He),F+=He.length),m(T,ke,W);var ze=new l(O,B?a.tokenize(Se,B):Se,J,Se);if(L=f(T,ke,ze),De&&f(T,L,De),W>1){var bt={cause:O+","+U,reach:Te};h(x,T,E,L.prev,F,bt),I&&bt.reach>I.reach&&(I.reach=bt.reach)}}}}}}function p(){var x={value:null,prev:null,next:null},T={value:null,prev:x,next:null};x.next=T,this.head=x,this.tail=T,this.length=0}function f(x,T,E){var C=T.next,A={value:E,prev:T,next:C};return T.next=A,C.prev=A,x.length++,A}function m(x,T,E){for(var C=T.next,A=0;A<E&&C!==x.tail;A++)C=C.next;T.next=C,C.prev=T,x.length-=A}function g(x){for(var T=[],E=x.head.next;E!==x.tail;)T.push(E.value),E=E.next;return T}if(!r.document)return r.addEventListener&&(a.disableWorkerMessageHandler||r.addEventListener("message",function(x){var T=JSON.parse(x.data),E=T.language,C=T.code,A=T.immediateClose;r.postMessage(a.highlight(C,a.languages[E],E)),A&&r.close()},!1)),a;var _=a.util.currentScript();_&&(a.filename=_.src,_.hasAttribute("data-manual")&&(a.manual=!0));function b(){a.manual||a.highlightAll()}if(!a.manual){var w=document.readyState;w==="loading"||w==="interactive"&&_&&_.defer?document.addEventListener("DOMContentLoaded",b):window.requestAnimationFrame?window.requestAnimationFrame(b):window.setTimeout(b,16)}return a}(e);t.exports&&(t.exports=i),typeof Zce<"u"&&(Zce.Prism=i),i.languages.markup={comment:{pattern:/<!--(?:(?!<!--)[\s\S])*?-->/,greedy:!0},prolog:{pattern:/<\?[\s\S]+?\?>/,greedy:!0},doctype:{pattern:/<!DOCTYPE(?:[^>"'[\]]|"[^"]*"|'[^']*')+(?:\[(?:[^<"'\]]|"[^"]*"|'[^']*'|<(?!!--)|<!--(?:[^-]|-(?!->))*-->)*\]\s*)?>/i,greedy:!0,inside:{"internal-subset":{pattern:/(^[^\[]*\[)[\s\S]+(?=\]>$)/,lookbehind:!0,greedy:!0,inside:null},string:{pattern:/"[^"]*"|'[^']*'/,greedy:!0},punctuation:/^<!|>$|[[\]]/,"doctype-tag":/^DOCTYPE/i,name:/[^\s<>'"]+/}},cdata:{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,greedy:!0},tag:{pattern:/<\/?(?!\d)[^\s>\/=$<%]+(?:\s(?:\s*[^\s>\/=]+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))|(?=[\s/>])))+)?\s*\/?>/,greedy:!0,inside:{tag:{pattern:/^<\/?[^\s>\/]+/,inside:{punctuation:/^<\/?/,namespace:/^[^\s>\/:]+:/}},"special-attr":[],"attr-value":{pattern:/=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+)/,inside:{punctuation:[{pattern:/^=/,alias:"attr-equals"},{pattern:/^(\s*)["']|["']$/,lookbehind:!0}]}},punctuation:/\/?>/,"attr-name":{pattern:/[^\s>\/]+/,inside:{namespace:/^[^\s>\/:]+:/}}}},entity:[{pattern:/&[\da-z]{1,8};/i,alias:"named-entity"},/&#x?[\da-f]{1,8};/i]},i.languages.markup.tag.inside["attr-value"].inside.entity=i.languages.markup.entity,i.languages.markup.doctype.inside["internal-subset"].inside=i.languages.markup,i.hooks.add("wrap",function(r){r.type==="entity"&&(r.attributes.title=r.content.replace(/&amp;/,"&"))}),Object.defineProperty(i.languages.markup.tag,"addInlined",{value:function(n,s){var o={};o["language-"+s]={pattern:/(^<!\[CDATA\[)[\s\S]+?(?=\]\]>$)/i,lookbehind:!0,inside:i.languages[s]},o.cdata=/^<!\[CDATA\[|\]\]>$/i;var a={"included-cdata":{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,inside:o}};a["language-"+s]={pattern:/[\s\S]+/,inside:i.languages[s]};var l={};l[n]={pattern:RegExp(/(<__[^>]*>)(?:<!\[CDATA\[(?:[^\]]|\](?!\]>))*\]\]>|(?!<!\[CDATA\[)[\s\S])*?(?=<\/__>)/.source.replace(/__/g,function(){return n}),"i"),lookbehind:!0,greedy:!0,inside:a},i.languages.insertBefore("markup","cdata",l)}}),Object.defineProperty(i.languages.markup.tag,"addAttribute",{value:function(r,n){i.languages.markup.tag.inside["special-attr"].push({pattern:RegExp(/(^|["'\s])/.source+"(?:"+r+")"+/\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))/.source,"i"),lookbehind:!0,inside:{"attr-name":/^[^\s=]+/,"attr-value":{pattern:/=[\s\S]+/,inside:{value:{pattern:/(^=\s*(["']|(?!["'])))\S[\s\S]*(?=\2$)/,lookbehind:!0,alias:[n,"language-"+n],inside:i.languages[n]},punctuation:[{pattern:/^=/,alias:"attr-equals"},/"|'/]}}}})}}),i.languages.html=i.languages.markup,i.languages.mathml=i.languages.markup,i.languages.svg=i.languages.markup,i.languages.xml=i.languages.extend("markup",{}),i.languages.ssml=i.languages.xml,i.languages.atom=i.languages.xml,i.languages.rss=i.languages.xml,function(r){var n=/(?:"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"|'(?:\\(?:\r\n|[\s\S])|[^'\\\r\n])*')/;r.languages.css={comment:/\/\*[\s\S]*?\*\//,atrule:{pattern:RegExp("@[\\w-](?:"+/[^;{\s"']|\s+(?!\s)/.source+"|"+n.source+")*?"+/(?:;|(?=\s*\{))/.source),inside:{rule:/^@[\w-]+/,"selector-function-argument":{pattern:/(\bselector\s*\(\s*(?![\s)]))(?:[^()\s]|\s+(?![\s)])|\((?:[^()]|\([^()]*\))*\))+(?=\s*\))/,lookbehind:!0,alias:"selector"},keyword:{pattern:/(^|[^\w-])(?:and|not|only|or)(?![\w-])/,lookbehind:!0}}},url:{pattern:RegExp("\\burl\\((?:"+n.source+"|"+/(?:[^\\\r\n()"']|\\[\s\S])*/.source+")\\)","i"),greedy:!0,inside:{function:/^url/i,punctuation:/^\(|\)$/,string:{pattern:RegExp("^"+n.source+"$"),alias:"url"}}},selector:{pattern:RegExp(`(^|[{}\\s])[^{}\\s](?:[^{};"'\\s]|\\s+(?![\\s{])|`+n.source+")*(?=\\s*\\{)"),lookbehind:!0},string:{pattern:n,greedy:!0},property:{pattern:/(^|[^-\w\xA0-\uFFFF])(?!\s)[-_a-z\xA0-\uFFFF](?:(?!\s)[-\w\xA0-\uFFFF])*(?=\s*:)/i,lookbehind:!0},important:/!important\b/i,function:{pattern:/(^|[^-a-z0-9])[-a-z0-9]+(?=\()/i,lookbehind:!0},punctuation:/[(){};:,]/},r.languages.css.atrule.inside.rest=r.languages.css;var s=r.languages.markup;s&&(s.tag.addInlined("style","css"),s.tag.addAttribute("style","css"))}(i),i.languages.clike={comment:[{pattern:/(^|[^\\])\/\*[\s\S]*?(?:\*\/|$)/,lookbehind:!0,greedy:!0},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0,greedy:!0}],string:{pattern:/(["'])(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0},"class-name":{pattern:/(\b(?:class|extends|implements|instanceof|interface|new|trait)\s+|\bcatch\s+\()[\w.\\]+/i,lookbehind:!0,inside:{punctuation:/[.\\]/}},keyword:/\b(?:break|catch|continue|do|else|finally|for|function|if|in|instanceof|new|null|return|throw|try|while)\b/,boolean:/\b(?:false|true)\b/,function:/\b\w+(?=\()/,number:/\b0x[\da-f]+\b|(?:\b\d+(?:\.\d*)?|\B\.\d+)(?:e[+-]?\d+)?/i,operator:/[<>]=?|[!=]=?=?|--?|\+\+?|&&?|\|\|?|[?*/~^%]/,punctuation:/[{}[\];(),.:]/},i.languages.javascript=i.languages.extend("clike",{"class-name":[i.languages.clike["class-name"],{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$A-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\.(?:constructor|prototype))/,lookbehind:!0}],keyword:[{pattern:/((?:^|\})\s*)catch\b/,lookbehind:!0},{pattern:/(^|[^.]|\.\.\.\s*)\b(?:as|assert(?=\s*\{)|async(?=\s*(?:function\b|\(|[$\w\xA0-\uFFFF]|$))|await|break|case|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally(?=\s*(?:\{|$))|for|from(?=\s*(?:['"]|$))|function|(?:get|set)(?=\s*(?:[#\[$\w\xA0-\uFFFF]|$))|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)\b/,lookbehind:!0}],function:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*(?:\.\s*(?:apply|bind|call)\s*)?\()/,number:{pattern:RegExp(/(^|[^\w$])/.source+"(?:"+(/NaN|Infinity/.source+"|"+/0[bB][01]+(?:_[01]+)*n?/.source+"|"+/0[oO][0-7]+(?:_[0-7]+)*n?/.source+"|"+/0[xX][\dA-Fa-f]+(?:_[\dA-Fa-f]+)*n?/.source+"|"+/\d+(?:_\d+)*n/.source+"|"+/(?:\d+(?:_\d+)*(?:\.(?:\d+(?:_\d+)*)?)?|\.\d+(?:_\d+)*)(?:[Ee][+-]?\d+(?:_\d+)*)?/.source)+")"+/(?![\w$])/.source),lookbehind:!0},operator:/--|\+\+|\*\*=?|=>|&&=?|\|\|=?|[!=]==|<<=?|>>>?=?|[-+*/%&|^!=<>]=?|\.{3}|\?\?=?|\?\.?|[~:]/}),i.languages.javascript["class-name"][0].pattern=/(\b(?:class|extends|implements|instanceof|interface|new)\s+)[\w.\\]+/,i.languages.insertBefore("javascript","keyword",{regex:{pattern:RegExp(/((?:^|[^$\w\xA0-\uFFFF."'\])\s]|\b(?:return|yield))\s*)/.source+/\//.source+"(?:"+/(?:\[(?:[^\]\\\r\n]|\\.)*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}/.source+"|"+/(?:\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.)*\])*\])*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}v[dgimyus]{0,7}/.source+")"+/(?=(?:\s|\/\*(?:[^*]|\*(?!\/))*\*\/)*(?:$|[\r\n,.;:})\]]|\/\/))/.source),lookbehind:!0,greedy:!0,inside:{"regex-source":{pattern:/^(\/)[\s\S]+(?=\/[a-z]*$)/,lookbehind:!0,alias:"language-regex",inside:i.languages.regex},"regex-delimiter":/^\/|\/$/,"regex-flags":/^[a-z]+$/}},"function-variable":{pattern:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*[=:]\s*(?:async\s*)?(?:\bfunction\b|(?:\((?:[^()]|\([^()]*\))*\)|(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)\s*=>))/,alias:"function"},parameter:[{pattern:/(function(?:\s+(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)?\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\))/,lookbehind:!0,inside:i.languages.javascript},{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$a-z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*=>)/i,lookbehind:!0,inside:i.languages.javascript},{pattern:/(\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*=>)/,lookbehind:!0,inside:i.languages.javascript},{pattern:/((?:\b|\s|^)(?!(?:as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)(?![$\w\xA0-\uFFFF]))(?:(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*\s*)\(\s*|\]\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*\{)/,lookbehind:!0,inside:i.languages.javascript}],constant:/\b[A-Z](?:[A-Z_]|\dx?)*\b/}),i.languages.insertBefore("javascript","string",{hashbang:{pattern:/^#!.*/,greedy:!0,alias:"comment"},"template-string":{pattern:/`(?:\\[\s\S]|\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}|(?!\$\{)[^\\`])*`/,greedy:!0,inside:{"template-punctuation":{pattern:/^`|`$/,alias:"string"},interpolation:{pattern:/((?:^|[^\\])(?:\\{2})*)\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}/,lookbehind:!0,inside:{"interpolation-punctuation":{pattern:/^\$\{|\}$/,alias:"punctuation"},rest:i.languages.javascript}},string:/[\s\S]+/}},"string-property":{pattern:/((?:^|[,{])[ \t]*)(["'])(?:\\(?:\r\n|[\s\S])|(?!\2)[^\\\r\n])*\2(?=\s*:)/m,lookbehind:!0,greedy:!0,alias:"property"}}),i.languages.insertBefore("javascript","operator",{"literal-property":{pattern:/((?:^|[,{])[ \t]*)(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*:)/m,lookbehind:!0,alias:"property"}}),i.languages.markup&&(i.languages.markup.tag.addInlined("script","javascript"),i.languages.markup.tag.addAttribute(/on(?:abort|blur|change|click|composition(?:end|start|update)|dblclick|error|focus(?:in|out)?|key(?:down|up)|load|mouse(?:down|enter|leave|move|out|over|up)|reset|resize|scroll|select|slotchange|submit|unload|wheel)/.source,"javascript")),i.languages.js=i.languages.javascript,function(){if(typeof i>"u"||typeof document>"u")return;Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);var r="Loading",n=function(_,b){return" Error "+_+" while fetching file: "+b},s=" Error: File does not exist or is empty",o={js:"javascript",py:"python",rb:"ruby",ps1:"powershell",psm1:"powershell",sh:"bash",bat:"batch",h:"c",tex:"latex"},a="data-src-status",l="loading",c="loaded",h="failed",p="pre[data-src]:not(["+a+'="'+c+'"]):not(['+a+'="'+l+'"])';function f(_,b,w){var x=new XMLHttpRequest;x.open("GET",_,!0),x.onreadystatechange=function(){x.readyState==4&&(x.status<400&&x.responseText?b(x.responseText):x.status>=400?w(n(x.status,x.statusText)):w(s))},x.send(null)}function m(_){var b=/^\s*(\d+)\s*(?:(,)\s*(?:(\d+)\s*)?)?$/.exec(_||"");if(b){var w=Number(b[1]),x=b[2],T=b[3];return x?T?[w,Number(T)]:[w,void 0]:[w,w]}}i.hooks.add("before-highlightall",function(_){_.selector+=", "+p}),i.hooks.add("before-sanity-check",function(_){var b=_.element;if(b.matches(p)){_.code="",b.setAttribute(a,l);var w=b.appendChild(document.createElement("CODE"));w.textContent=r;var x=b.getAttribute("data-src"),T=_.language;if(T==="none"){var E=(/\.(\w+)$/.exec(x)||[,"none"])[1];T=o[E]||E}i.util.setLanguage(w,T),i.util.setLanguage(b,T);var C=i.plugins.autoloader;C&&C.loadLanguages(T),f(x,function(A){b.setAttribute(a,c);var I=m(b.getAttribute("data-range"));if(I){var O=A.split(/\r\n?|\n/g),D=I[0],U=I[1]==null?O.length:I[1];D<0&&(D+=O.length),D=Math.max(0,Math.min(D-1,O.length)),U<0&&(U+=O.length),U=Math.max(0,Math.min(U,O.length)),A=O.slice(D,U).join(`
`),b.hasAttribute("data-start")||b.setAttribute("data-start",String(D+1))}w.textContent=A,i.highlightElement(w)},function(A){b.setAttribute(a,h),w.textContent=A})}}),i.plugins.fileHighlight={highlight:function(b){for(var w=(b||document).querySelectorAll(p),x=0,T;T=w[x++];)i.highlightElement(T)}};var g=!1;i.fileHighlight=function(){g||(console.warn("Prism.fileHighlight is deprecated. Use `Prism.plugins.fileHighlight.highlight` instead."),g=!0),i.plugins.fileHighlight.highlight.apply(this,arguments)}}()})(jgt);const xLe=VQ;(function(){if(typeof Prism>"u"||typeof document>"u")return;var t="line-numbers",e=/\n(?!$)/g,i=Prism.plugins.lineNumbers={getLine:function(o,a){if(!(o.tagName!=="PRE"||!o.classList.contains(t))){var l=o.querySelector(".line-numbers-rows");if(l){var c=parseInt(o.getAttribute("data-start"),10)||1,h=c+(l.children.length-1);a<c&&(a=c),a>h&&(a=h);var p=a-c;return l.children[p]}}},resize:function(o){r([o])},assumeViewportIndependence:!0};function r(o){if(o=o.filter(function(l){var c=n(l),h=c["white-space"];return h==="pre-wrap"||h==="pre-line"}),o.length!=0){var a=o.map(function(l){var c=l.querySelector("code"),h=l.querySelector(".line-numbers-rows");if(!(!c||!h)){var p=l.querySelector(".line-numbers-sizer"),f=c.textContent.split(e);p||(p=document.createElement("span"),p.className="line-numbers-sizer",c.appendChild(p)),p.innerHTML="0",p.style.display="block";var m=p.getBoundingClientRect().height;return p.innerHTML="",{element:l,lines:f,lineHeights:[],oneLinerHeight:m,sizer:p}}}).filter(Boolean);a.forEach(function(l){var c=l.sizer,h=l.lines,p=l.lineHeights,f=l.oneLinerHeight;p[h.length-1]=void 0,h.forEach(function(m,g){if(m&&m.length>1){var _=c.appendChild(document.createElement("span"));_.style.display="block",_.textContent=m}else p[g]=f})}),a.forEach(function(l){for(var c=l.sizer,h=l.lineHeights,p=0,f=0;f<h.length;f++)h[f]===void 0&&(h[f]=c.children[p++].getBoundingClientRect().height)}),a.forEach(function(l){var c=l.sizer,h=l.element.querySelector(".line-numbers-rows");c.style.display="none",c.innerHTML="",l.lineHeights.forEach(function(p,f){h.children[f].style.height=p+"px"})})}}function n(o){return o?window.getComputedStyle?getComputedStyle(o):o.currentStyle||null:null}var s=void 0;window.addEventListener("resize",function(){i.assumeViewportIndependence&&s===window.innerWidth||(s=window.innerWidth,r(Array.prototype.slice.call(document.querySelectorAll("pre."+t))))}),Prism.hooks.add("complete",function(o){if(o.code){var a=o.element,l=a.parentNode;if(!(!l||!/pre/i.test(l.nodeName))&&!a.querySelector(".line-numbers-rows")&&Prism.util.isActive(a,t)){a.classList.remove(t),l.classList.add(t);var c=o.code.match(e),h=c?c.length+1:1,p,f=new Array(h+1).join("<span></span>");p=document.createElement("span"),p.setAttribute("aria-hidden","true"),p.className="line-numbers-rows",p.innerHTML=f,l.hasAttribute("data-start")&&(l.style.counterReset="linenumber "+(parseInt(l.getAttribute("data-start"),10)-1)),o.element.appendChild(p),r([l]),Prism.hooks.run("line-numbers",o)}}}),Prism.hooks.add("line-numbers",function(o){o.plugins=o.plugins||{},o.plugins.lineNumbers=!0})})();function Ggt(){const t=ut.useRef(null),e=ut.useRef(null),i=ut.useRef(null),[r,n]=ut.useState(null),[s,o]=ut.useState(null);ut.useEffect(()=>{a()},[]);async function a(){if(xLe.highlightAll(),!(t!=null&&t.current))return;nr.portalUrl="http://arcgis.com/";const f=new FB({basemap:"satellite"}),m=new K$e({container:t==null?void 0:t.current,map:f,zoom:3});m.ui.add([new LQ({view:m,content:e==null?void 0:e.current,expanded:!0,group:"group1",expandTooltip:"MediaLayer"}),new LQ({view:m,content:i==null?void 0:i.current,group:"group1",expandTooltip:"ControlPointsGeoreference"})],"top-left"),n(m)}async function l(){const f=new QV({image:"Liverpool.png",georeference:new nae({extent:new ni({spatialReference:{wkid:102100},xmin:-339441.5168570463,ymin:7051887318179514e-9,xmax:-324839.58261292917,ymax:7067371687353565e-9})})}),m=new lae({source:[f]});r.map.layers.add(m),await r.when(),await m.when(),o(m);const g=new Fmt({leadingLayers:[m],position:75,view:r});let _=!0,b=0;const w=setInterval(()=>{if(b===2){clearInterval(w);return}_?g.position=g.position-.05:g.position=g.position+.05,g.position===40?_=!1:g.position===75&&(_=!0,b++)},1);r.ui.add(g),r==null||r.goTo(new ni({spatialReference:{wkid:102100},xmin:-339441.5168570463,ymin:7051887318179514e-9,xmax:-324839.58261292917,ymax:7067371687353565e-9}).expand(1))}function c(){const f=new QV({image:"/Florence.jpeg",georeference:new rae({width:1e3,height:755,controlPoints:[{sourcePoint:{x:333.1103679715381,y:701.3716189418546},mapPoint:new Le({x:1253618039700887e-9,y:543197908855724e-8,spatialReference:{wkid:102100}})},{sourcePoint:{x:398.7804080468498,y:210.55393624690095},mapPoint:new Le({x:1.2533416272831117e6,y:5429407568274674e-9,spatialReference:{wkid:102100}})},{sourcePoint:{x:782.5730994340726,y:32.883345812941776},mapPoint:new Le({x:1.2513820560864767e6,y:5.4285155447955085e6,spatialReference:{wkid:102100}})},{sourcePoint:{x:584.0987277033045,y:575.8665575893785},mapPoint:new Le({x:1.2523046469130863e6,y:5431344704144045e-9,spatialReference:{wkid:102100}})}]})});s.source=f,r==null||r.goTo(new ni({spatialReference:{wkid:102100},xmax:1255341985632734e-9,xmin:1.2499465201307742e6,ymax:5432421928455123e-9,ymin:5428347876590912e-9}).expand(1.5))}return MS("div",{className:"App",children:[Cr("div",{id:"view",ref:t}),MS("div",{ref:e,className:"card",children:[Cr("p",{children:"MediaLayer"}),Cr("pre",{className:"line-numbers",children:Cr("code",{className:"language-js",children:`new MediaLayer({ 
  source: new ImageElement({
    image: "/Liverpool.png",
    georeference: new ExtentAndRotationGeoreference({
      extent: new Extent({
        spatialReference: { wkid: 102100 },
        xmin: -339441.5168570463,
        ymin: 7051887.318179514,
        xmax: -324839.58261292917,
        ymax: 7067371.687353565,
      })
    })
  })
});`})}),Cr(UQ,{className:"btn","icon-start":"play",onClick:l})]}),MS("div",{ref:i,className:"card",children:[Cr("p",{children:"ControlPointsGeoreference"}),Cr("pre",{className:"line-numbers",children:Cr("code",{className:"language-js",children:`new ControlPointsGeoreference({  
  controlPoints: [
    {
      sourcePoint: { x: 0, y: 669 },
      mapPoint: new Point({ 
        x: -10046739.695935503, 
        y: 3486942.691935667, 
        spatialReference: { wkid: 102100 } 
      }),
    },
    {
      sourcePoint: { x: 0, y: 0 },
      mapPoint: new Point({
        x: -10046739.695935503,
        y: 3514979.040597104,
        spatialReference: { wkid: 102100 },
      }),
    },
    {
      sourcePoint: { x: 1246, y: 0 },
      mapPoint: new Point({
        x: -10001415.789436923,
        y: 3514979.040597104,
        spatialReference: { wkid: 102100 },
      }),
    },
    {
      sourcePoint: { x: 1246, y: 669 },
      mapPoint: new Point({
        x: -10001415.789436923,
        y: 3486942.691935667,
        spatialReference: { wkid: 102100 },
      }),
    },
  ],
  width: 1246,
  height: 669
})`})}),Cr(UQ,{className:"btn","icon-start":"play",onClick:c})]})]})}let j_=class{constructor(e){this._allocator=e,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&dM(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*rye);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}_grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,rye));e++)this._items.push(this._allocator())}};const rye=1024;function $e(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function HM(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]}function mae(t,e,i,r,n,s,o,a,l,c,h,p,f,m,g,_){return[t,e,i,r,n,s,o,a,l,c,h,p,f,m,g,_]}function TLe(t,e){return new Float64Array(t,e,16)}const ld=$e();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:ld,clone:HM,create:$e,createView:TLe,fromValues:mae},Symbol.toStringTag,{value:"Module"}));var zu;(function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.Z=2]="Z"})(zu||(zu={}));function zp(){return[0,0,0,1]}function Hgt(t){return[t[0],t[1],t[2],t[3]]}function qgt(t,e,i,r){return[t,e,i,r]}function SLe(t,e){return new Float64Array(t,e,4)}const Wgt=zp();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:Wgt,clone:Hgt,create:zp,createView:SLe,fromValues:qgt},Symbol.toStringTag,{value:"Module"}));let NO=class CT{constructor(e,i,r){this._itemByteSize=e,this._itemCreate=i,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(r/this._itemByteSize)}get(){this._itemsPtr===0&&dM(()=>this._reset());const e=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=e;){const i=new ArrayBuffer(this._itemsPerBuffer*this._itemByteSize);for(let r=0;r<this._itemsPerBuffer;++r)this._items.push(this._itemCreate(i,r*this._itemByteSize));this._buffers.push(i)}return this._items[this._itemsPtr++]}_reset(){const e=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>e;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(e=vE){return new CT(16,GIe,e)}static createVec3f64(e=vE){return new CT(24,Ene,e)}static createVec4f64(e=vE){return new CT(32,ZOe,e)}static createMat3f64(e=vE){return new CT(72,eLe,e)}static createMat4f64(e=vE){return new CT(128,TLe,e)}static createQuatf64(e=vE){return new CT(32,SLe,e)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this._itemByteSize}}};const vE=4*PM.KILOBYTES,WGt=NO.createVec2f64(),Ye=NO.createVec3f64(),gae=NO.createVec4f64();NO.createMat3f64();const yae=NO.createMat4f64(),XGt=NO.createQuatf64();function Cm(t){return t?{origin:In(t.origin),vector:In(t.vector)}:{origin:P(),vector:P()}}function Xgt(t,e){const i=Zgt.get();return i.origin=t,i.vector=e,i}function YGt(t,e=Cm()){return Ygt(t.origin,t.vector,e)}function Ygt(t,e,i=Cm()){return ce(i.origin,t),ce(i.vector,e),i}function zS(t,e,i=Cm()){return ce(i.origin,t),ge(i.vector,e,t),i}function _ae(t,e){const i=ge(Ye.get(),e,t.origin),r=be(t.vector,i),n=be(t.vector,t.vector),s=_e(r/n,0,1),o=ge(Ye.get(),le(Ye.get(),t.vector,s),i);return be(o,o)}function ZGt(t,e,i){return zQ(t,e,0,1,i)}function JGt(t,e,i){return me(i,t.origin,le(i,t.vector,e))}function zQ(t,e,i,r,n){const{vector:s,origin:o}=t,a=ge(Ye.get(),e,o),l=be(s,a)/al(s);return le(n,s,_e(l,i,r)),me(n,n,t.origin)}function KGt(t,e){if(CLe(t,Xgt(e.origin,e.direction),!1,rz)){const{tA:i,pB:r,distance2:n}=rz;if(i>=0&&i<=1)return n;if(i<0)return ba(t.origin,r);if(i>1)return ba(me(Ye.get(),t.origin,t.vector),r)}return null}function ELe(t,e,i){return!!CLe(t,e,!0,rz)&&(ce(i,rz.pA),!0)}function CLe(t,e,i,r){const s=t.origin,o=me(Ye.get(),s,t.vector),a=e.origin,l=me(Ye.get(),a,e.vector),c=Ye.get(),h=Ye.get();if(c[0]=s[0]-a[0],c[1]=s[1]-a[1],c[2]=s[2]-a[2],h[0]=l[0]-a[0],h[1]=l[1]-a[1],h[2]=l[2]-a[2],Math.abs(h[0])<1e-6&&Math.abs(h[1])<1e-6&&Math.abs(h[2])<1e-6)return!1;const p=Ye.get();if(p[0]=o[0]-s[0],p[1]=o[1]-s[1],p[2]=o[2]-s[2],Math.abs(p[0])<1e-6&&Math.abs(p[1])<1e-6&&Math.abs(p[2])<1e-6)return!1;const f=c[0]*h[0]+c[1]*h[1]+c[2]*h[2],m=h[0]*p[0]+h[1]*p[1]+h[2]*p[2],g=c[0]*p[0]+c[1]*p[1]+c[2]*p[2],_=h[0]*h[0]+h[1]*h[1]+h[2]*h[2],b=(p[0]*p[0]+p[1]*p[1]+p[2]*p[2])*_-m*m;if(Math.abs(b)<1e-6)return!1;let w=(f*m-g*_)/b,x=(f+m*w)/_;i&&(w=_e(w,0,1),x=_e(x,0,1));const T=Ye.get(),E=Ye.get();return T[0]=s[0]+w*p[0],T[1]=s[1]+w*p[1],T[2]=s[2]+w*p[2],E[0]=a[0]+x*h[0],E[1]=a[1]+x*h[1],E[2]=a[2]+x*h[2],r.tA=w,r.tB=x,r.pA=T,r.pB=E,r.distance2=ba(T,E),!0}const rz={tA:0,tB:0,pA:P(),pB:P(),distance2:0},Zgt=new j_(()=>Cm());function ko(t){return t?nye(In(t.origin),In(t.direction)):nye(P(),P())}function nye(t,e){return{origin:t,direction:e}}function QGt(t,e){return x_(t.origin,e.origin)&&x_(t.direction,e.direction)}function cd(t,e){const i=eyt.get();return i.origin=t,i.direction=e,i}function nz(t,e=ko()){return ALe(t.origin,t.direction,e)}function Jgt(t,e,i=ko()){return ce(i.origin,t),ge(i.direction,e,t),i}function ALe(t,e,i=ko()){return ce(i.origin,t),ce(i.direction,e),i}function Kgt(t,e){const i=vt(Ye.get(),we(Ye.get(),t.direction),ge(Ye.get(),e,t.origin));return be(i,i)}function Qgt(t,e,i){const r=be(t.direction,ge(i,e,t.origin));return me(i,t.origin,le(i,t.direction,r)),i}const eyt=new j_(()=>ko());function q$(t,e){return be(t,e)/Pe(t)}function vae(t,e){const i=be(t,e)/(Pe(t)*Pe(e));return-eo(i)}function RLe(t,e,i){we(z4,t),we(IH,e);const r=be(z4,IH),n=eo(r),s=vt(z4,z4,IH);return be(s,i)<0?2*Math.PI-n:n}const z4=P(),IH=P();function Is(){return pi()}function qM(t,e=Is()){return Xf(e,t)}function MLe(t,e){return Zt(t[0],t[1],t[2],e)}function tyt(t){return t}function OLe(t){t[0]=t[1]=t[2]=t[3]=0}function BB(t,e){return t[0]=t[1]=t[2]=0,t[3]=e,t}function c_(t){return t[3]}function iyt(t){return t}function PLe(t,e,i,r){return Zt(t,e,i,r)}function ryt(t,e,i){return t!==i&&ce(i,t),i[3]=t[3]+e,i}function nyt(t,e,i){return re.getLogger("esri.geometry.support.sphere").error("sphere.setExtent is not yet supported"),t===i?i:qM(t,i)}function Vw(t,e,i){if(R(e))return!1;const{origin:r,direction:n}=e,s=syt;s[0]=r[0]-t[0],s[1]=r[1]-t[1],s[2]=r[2]-t[2];const o=n[0]*n[0]+n[1]*n[1]+n[2]*n[2];if(o===0)return!1;const a=2*(n[0]*s[0]+n[1]*s[1]+n[2]*s[2]),l=a*a-4*o*(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]-t[3]*t[3]);if(l<0)return!1;const c=Math.sqrt(l);let h=(-a-c)/(2*o);const p=(-a+c)/(2*o);return(h<0||p<h&&p>0)&&(h=p),!(h<0)&&(i&&(i[0]=r[0]+n[0]*h,i[1]=r[1]+n[1]*h,i[2]=r[2]+n[2]*h),!0)}const syt=P();function BQ(t,e){return Vw(t,e,null)}function oyt(t,e,i){if(Vw(t,e,i))return i;const r=FO(t,e,Ye.get());return me(i,e.origin,le(Ye.get(),e.direction,Lr(e.origin,r)/Pe(e.direction))),i}function FO(t,e,i){const r=Ye.get(),n=yae.get();vt(r,e.origin,e.direction);const s=c_(t);vt(i,r,e.origin),le(i,i,1/Pe(i)*s);const o=LLe(t,e.origin),a=vae(e.origin,i);return ad(n,a+o,r),Ke(i,i,n),i}function ayt(t,e,i){return Vw(t,e,i)?i:(Qgt(e,t,i),ILe(t,i,i))}function ILe(t,e,i){const r=ge(Ye.get(),e,t),n=le(Ye.get(),r,t[3]/Pe(r));return me(i,n,t)}function $Le(t,e){const i=ge(Ye.get(),e,t),r=al(i),n=t[3]*t[3];return Math.sqrt(Math.abs(r-n))}function LLe(t,e){const i=ge(Ye.get(),e,t),r=Pe(i),n=c_(t),s=n+Math.abs(n-r);return eo(n/s)}const $H=P();function DLe(t,e,i,r){const n=ge($H,e,t);switch(i){case zu.X:{const s=ide(n,$H)[2];return he(r,-Math.sin(s),Math.cos(s),0)}case zu.Y:{const s=ide(n,$H),o=s[1],a=s[2],l=Math.sin(o);return he(r,-l*Math.cos(a),-l*Math.sin(a),Math.cos(o))}case zu.Z:return we(r,n);default:return}}function NLe(t,e){const i=ge(jQ,e,t);return Pe(i)-t[3]}function lyt(t,e,i,r){const n=NLe(t,e),s=DLe(t,e,zu.Z,jQ),o=le(jQ,s,i-n);return me(r,e,o)}function cyt(t,e){const i=ba(t,e),r=c_(t);return i<=r*r}const jQ=P(),jB=Is(),uyt=Object.freeze(Object.defineProperty({__proto__:null,altitudeAt:NLe,angleToSilhouette:LLe,axisAt:DLe,clear:OLe,closestPoint:ayt,closestPointOnSilhouette:FO,containsPoint:cyt,copy:qM,create:Is,distanceToSilhouette:$Le,elevate:ryt,fromCenterAndRadius:MLe,fromRadius:BB,fromValues:PLe,getCenter:iyt,getRadius:c_,intersectRay:Vw,intersectRayClosestSilhouette:oyt,intersectsRay:BQ,projectPoint:ILe,setAltitudeAt:lyt,setExtent:nyt,tmpSphere:jB,wrap:tyt},Symbol.toStringTag,{value:"Module"}));function v2(t){const e=t[0]*t[0]+t[4]*t[4]+t[8]*t[8],i=t[1]*t[1]+t[5]*t[5]+t[9]*t[9],r=t[2]*t[2]+t[6]*t[6]+t[10]*t[10];return Math.sqrt(Math.max(e,i,r))}function hyt(t,e){const i=Math.sqrt(e[0]*e[0]+e[4]*e[4]+e[8]*e[8]),r=Math.sqrt(e[1]*e[1]+e[5]*e[5]+e[9]*e[9]),n=Math.sqrt(e[2]*e[2]+e[6]*e[6]+e[10]*e[10]);return he(t,i,r,n),t}function eHt(t,e,i){i=i||t;const r=be(t,e);he(i,t[0]-r*e[0],t[1]-r*e[1],t[2]-r*e[2]),we(i,i)}function tHt(t,e,i){Math.abs(t[0])>Math.abs(t[1])?he(e,0,1,0):he(e,1,0,0),vt(i,t,e),we(e,e),vt(e,i,t),we(i,i)}function B4(t,e,i,r,n,s){const o=t+(e-t)*n;return o+(i+(r-i)*n-o)*s}function dyt(t,e,i,r=P()){const n=Pe(t),s=Pe(e),o=be(t,e)/(n*s);if(o<.9999999999999999){const a=Math.acos(o),l=((1-i)*n+i*s)/Math.sin(a),c=l/n*Math.sin((1-i)*a),h=l/s*Math.sin(i*a);return le(TS,t,c),le(SS,e,h),me(r,TS,SS)}return ys(r,t,e,i)}function iHt(t,e,i,r=P(),n=P()){const s=Pe(t),o=Pe(e),a=be(t,e)/(s*o);if(a<.9999999999999999){const l=Math.acos(a),c=Math.sin(l),h=Math.sin(i*l),p=Math.sin((1-i)*l),f=(1-i)*s+i*o;{const m=f/c,g=m/o*h;le(TS,t,m/s*p),le(SS,e,g),me(r,TS,SS)}{const m=1/s*(-Math.cos((1-i)*l)*l*f+p*(-s+o));le(TS,t,m);const g=1/o*(Math.cos(i*l)*l*f+h*(-s+o));le(SS,e,g),me(n,TS,SS),le(n,n,1/c)}return n}return ys(r,t,e,i),ge(n,e,t),we(n,n),n}function SU(t,e,i){t=we(TS,t),e=we(SS,e);const r=eo(be(t,e));if(i){const n=vt(pyt,t,e);if(be(n,i)<0)return-r}return r}function EU(t){const e=t.length;return i=>{if(i<=t[0][0])return t[0][1];if(i>=t[e-1][0])return t[e-1][1];let r=1;for(;i>t[r][0];)r++;const n=t[r-1][0],s=t[r][0],o=(s-i)/(s-n);return o*t[r-1][1]+(1-o)*t[r][1]}}function rHt(t,e,i,r){ge(sye,e,t),ge(oye,i,t),vt(r,sye,oye),we(r,r),r[3]=-be(t,r)}const sye=P(),oye=P(),pyt=P(),TS=P(),SS=P();function Ji(t=CI){return[t[0],t[1],t[2],t[3]]}function fyt(t=CI[0],e=CI[1],i=CI[2],r=CI[3]){return bae(t,e,i,r,gae.get())}function GB(t,e){return bae(e[0],e[1],e[2],e[3],t)}function bae(t,e,i,r,n=Ji()){return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n}function FLe(t,e,i){return ce(i,t),i[3]=e,i}function GN(t,e,i){const r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=Math.abs(r-1)>1e-5&&r>1e-12?1/Math.sqrt(r):1;return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=-(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]),i}function sl(t,e,i,r=Ji()){const n=i[0]-e[0],s=i[1]-e[1],o=i[2]-e[2],a=t[0]-e[0],l=t[1]-e[1],c=t[2]-e[2],h=s*c-o*l,p=o*a-n*c,f=n*l-s*a,m=h*h+p*p+f*f,g=Math.abs(m-1)>1e-5&&m>1e-12?1/Math.sqrt(m):1;return r[0]=h*g,r[1]=p*g,r[2]=f*g,r[3]=-(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]),r}function kLe(t,e,i,r,n){const s=t.length/3;if(s<3)return!1;he($3,t[3*i],t[3*i+1],t[3*i+2]);let o=r,a=!1;for(;o<s-1&&!a;){const l=3*o;he(bE,t[l],t[l+1],t[l+2]),o++,a=!Xl($3,bE)}if(!a)return!1;for(o=Math.max(o,n),a=!1;o<s&&!a;){const l=3*o;he(tS,t[l],t[l+1],t[l+2]),o++,ge(j4,$3,bE),we(j4,j4),ge(G4,bE,tS),we(G4,G4),a=!Xl($3,tS)&&!Xl(bE,tS)&&Math.abs(be(j4,G4))<myt}return a?(sl($3,bE,tS,e),!0):(i!==0||r!==1||n!==2)&&kLe(t,e,0,1,2)}const myt=.99619469809,$3=P(),bE=P(),tS=P(),j4=P(),G4=P();function GQ(t,e,i){return e!==t&&GB(t,e),t[3]=-be(t,i),t}function HQ(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function yD(t,e,i,r){return vt(tS,e,t),GN(i,tS,r)}function nHt(t,e,i,r){return HB(t,e,ge(Ye.get(),i,e),wyt,r)}function Y2(t,e,i){return!!v(e)&&HB(t,e.origin,e.direction,xyt,i)}function gyt(t,e,i){return HB(t,e.origin,e.vector,ty.NONE,i)}function yyt(t,e,i){return HB(t,e.origin,e.vector,ty.CLAMP,i)}function ULe(t,e){return Pr(t,e)>=0}function _yt(t,e){const i=be(t,e.ray.direction),r=-Pr(t,e.ray.origin);if(r<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return r>0;if((r<0||i<0)&&!(r<0&&i<0))return!0;const n=r/i;return i>0?n<e.c1&&(e.c1=n):n>e.c0&&(e.c0=n),e.c0<=e.c1}function vyt(t,e){const i=be(t,e.ray.direction),r=-Pr(t,e.ray.origin);if(i>-1e-6&&i<1e-6)return r>0;const n=r/i;return i>0?n<e.c1&&(e.c1=n):n>e.c0&&(e.c0=n),e.c0<=e.c1}function byt(t,e,i){const r=le(Ye.get(),t,-t[3]),n=qQ(t,ge(Ye.get(),e,r),Ye.get());return me(i,n,r),i}function qQ(t,e,i){const r=le(Ye.get(),t,be(t,e));return ge(i,e,r),i}function Pr(t,e){return be(t,e)+t[3]}function HB(t,e,i,r,n){const s=be(t,i);if(s===0)return!1;let o=-(be(t,e)+t[3])/s;return r&ty.CLAMP&&(o=_e(o,0,1)),!(!(r&ty.INFINITE_MIN)&&o<0||!(r&ty.INFINITE_MAX)&&o>1)&&(me(n,e,le(n,i,o)),!0)}function sHt(t){return t}const CI=[0,0,1,0];var ty;(function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.INFINITE_MIN=4]="INFINITE_MIN",t[t.INFINITE_MAX=8]="INFINITE_MAX"})(ty||(ty={}));const wyt=ty.INFINITE_MIN|ty.INFINITE_MAX,xyt=ty.INFINITE_MAX,LH=re.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");let Tyt=class{constructor(){this.plane=Ji(),this.origin=P(),this.basis1=P(),this.basis2=P()}};const VLe=Tyt;function G_(t=JLe){return{plane:Ji(t.plane),origin:In(t.origin),basis1:In(t.basis1),basis2:In(t.basis2)}}function Syt(t,e,i){const r=Nyt.get();return r.origin=t,r.basis1=e,r.basis2=i,r.plane=fyt(0,0,0,0),qB(r),r}function Z2(t,e=G_()){return wae(t.origin,t.basis1,t.basis2,e)}function Eyt(t,e){ce(e.origin,t.origin),ce(e.basis1,t.basis1),ce(e.basis2,t.basis2),GB(e.plane,t.plane)}function wae(t,e,i,r=G_()){return ce(r.origin,t),ce(r.basis1,e),ce(r.basis2,i),qB(r),Lyt(r,"fromValues()"),r}function qB(t){yD(t.basis2,t.basis1,t.origin,t.plane)}function zLe(t,e,i){t!==i&&Z2(t,i);const r=le(Ye.get(),I_(t),e);return me(i.origin,i.origin,r),i.plane[3]-=e,i}function Cyt(t,e,i){return BLe(e,i),zLe(i,Eae(t,t.origin),i),i}function BLe(t,e=G_()){const i=(t[2]-t[0])/2,r=(t[3]-t[1])/2;return he(e.origin,t[0]+i,t[1]+r,0),he(e.basis1,i,0,0),he(e.basis2,0,r,0),bae(0,0,1,0,e.plane),e}function xae(t,e,i){return!!Y2(t.plane,e,i)&&YLe(t,i)}function Ayt(t,e,i){if(xae(t,e,i))return i;const r=jLe(t,e,Ye.get());return me(i,e.origin,le(Ye.get(),e.direction,Lr(e.origin,r)/Pe(e.direction))),i}function jLe(t,e,i){const r=sz.get();ZLe(t,e,r,sz.get());let n=Number.POSITIVE_INFINITY;for(const s of Aae){const o=Cae(t,s,WB.get()),a=Ye.get();if(gyt(r,o,a)){const l=V_(Ye.get(),e.origin,a),c=Math.abs(eo(be(e.direction,l)));c<n&&(n=c,ce(i,a))}}return n===Number.POSITIVE_INFINITY?GLe(t,e,i):i}function GLe(t,e,i){if(xae(t,e,i))return i;const r=sz.get(),n=sz.get();ZLe(t,e,r,n);let s=Number.POSITIVE_INFINITY;for(const o of Aae){const a=Cae(t,o,WB.get()),l=Ye.get();if(yyt(r,a,l)){const c=Kgt(e,l);if(!ULe(n,l))continue;c<s&&(s=c,ce(i,l))}}return Tae(t,e.origin)<s&&HLe(t,e.origin,i),i}function HLe(t,e,i){const r=byt(t.plane,e,Ye.get()),n=zQ(aye(t,t.basis1),r,-1,1,Ye.get()),s=zQ(aye(t,t.basis2),r,-1,1,Ye.get());return ge(i,me(Ye.get(),n,s),t.origin),i}function qLe(t,e,i){const{origin:r,basis1:n,basis2:s}=t,o=ge(Ye.get(),e,r),a=q$(n,o),l=q$(s,o),c=q$(I_(t),o);return he(i,a,l,c)}function Tae(t,e){const i=qLe(t,e,Ye.get()),{basis1:r,basis2:n}=t,s=Pe(r),o=Pe(n),a=Math.max(Math.abs(i[0])-s,0),l=Math.max(Math.abs(i[1])-o,0),c=i[2];return a*a+l*l+c*c}function Ryt(t,e){return Math.sqrt(Tae(t,e))}function Myt(t,e){let i=Number.NEGATIVE_INFINITY;for(const r of Aae){const n=Cae(t,r,WB.get()),s=_ae(n,e);s>i&&(i=s)}return Math.sqrt(i)}function Sae(t,e){return ULe(t.plane,e)&&YLe(t,e)}function Oyt(t,e,i,r){return $yt(t,i,r)}function Eae(t,e){const i=-t.plane[3];return q$(I_(t),e)-i}function Pyt(t,e,i,r){const n=Eae(t,e),s=le(Dyt,I_(t),i-n);return me(r,e,s),r}function WLe(t,e){return Xl(t.basis1,e.basis1)&&Xl(t.basis2,e.basis2)&&Xl(t.origin,e.origin)}function XLe(t,e,i){return t!==i&&Z2(t,i),wa(wE,e),Ku(wE,wE),Ke(i.basis1,t.basis1,wE),Ke(i.basis2,t.basis2,wE),Ke(i.plane,t.plane,wE),Ke(i.origin,t.origin,e),GQ(i.plane,i.plane,i.origin),i}function Iyt(t,e,i,r){return t!==r&&Z2(t,r),ad(DH,e,i),Ke(r.basis1,t.basis1,DH),Ke(r.basis2,t.basis2,DH),qB(r),r}function I_(t){return t.plane}function $yt(t,e,i){switch(e){case zu.X:ce(i,t.basis1),we(i,i);break;case zu.Y:ce(i,t.basis2),we(i,i);break;case zu.Z:ce(i,I_(t))}return i}function YLe(t,e){const i=ge(Ye.get(),e,t.origin),r=al(t.basis1),n=al(t.basis2),s=be(t.basis1,i),o=be(t.basis2,i);return-s-r<0&&s-r<0&&-o-n<0&&o-n<0}function aye(t,e){const i=WB.get();return ce(i.origin,t.origin),ce(i.vector,e),i}function Cae(t,e,i){const{basis1:r,basis2:n,origin:s}=t,o=le(Ye.get(),r,e.origin[0]),a=le(Ye.get(),n,e.origin[1]);me(i.origin,o,a),me(i.origin,i.origin,s);const l=le(Ye.get(),r,e.direction[0]),c=le(Ye.get(),n,e.direction[1]);return le(i.vector,me(l,l,c),2),i}function Lyt(t,e){Math.abs(be(t.basis1,t.basis2)/(Pe(t.basis1)*Pe(t.basis2)))>1e-6&&LH.warn(e,"Provided basis vectors are not perpendicular"),Math.abs(be(t.basis1,I_(t)))>1e-6&&LH.warn(e,"Basis vectors and plane normal are not perpendicular"),Math.abs(-be(I_(t),t.origin)-t.plane[3])>1e-6&&LH.warn(e,"Plane offset is not consistent with plane origin")}function ZLe(t,e,i,r){const n=I_(t);yD(n,e.direction,e.origin,i),yD(i,n,e.origin,r)}const JLe={plane:Ji(),origin:Ue(0,0,0),basis1:Ue(1,0,0),basis2:Ue(0,1,0)},sz=new j_(Ji),WB=new j_(Cm),Dyt=P(),Nyt=new j_(()=>G_()),Aae=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],wE=$e(),DH=$e(),Fyt=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:VLe,UP:JLe,altitudeAt:Eae,axisAt:Oyt,closestPoint:GLe,closestPointOnSilhouette:jLe,copy:Z2,copyWithoutVerify:Eyt,create:G_,distance:Ryt,distance2:Tae,distanceToSilhouette:Myt,elevate:zLe,equals:WLe,extrusionContainsPoint:Sae,fromAABoundingRect:BLe,fromValues:wae,intersectRay:xae,intersectRayClosestSilhouette:Ayt,normal:I_,projectPoint:HLe,projectPointLocal:qLe,rotate:Iyt,setAltitudeAt:Pyt,setExtent:Cyt,transform:XLe,updateUnboundedPlane:qB,wrap:Syt},Symbol.toStringTag,{value:"Module"})),kyt=new Je(k2e),lye=new Je(one),cye=new Je(ane),aHt=new Je(U2e);function XB(t){return t&&(wy(t)||Dn(t,lye))?lye:t&&(xy(t)||Dn(t,cye))?cye:kyt}function Uyt(t){const{value:e,operations:i}=t;return{operations:i,value:i.create(e)}}function Vyt(t,e,i){return t.operations.setExtent(t.value,e,i.value),i}function zyt(t){return{operations:t,value:t.create()}}function KLe(t,e,i=zyt(t)){return i.operations=t,t.copy(e,i.value),i}function Byt(t){return KLe(uyt,PLe(0,0,0,sr(t).radius))}const uye=2**50;function jyt(){return KLe(Fyt,wae([0,0,0],[uye,0,0],[0,uye,0]))}function Gyt(t,e,i){return t.operations.axisAt(t.value,e,zu.Z,i)}function Hyt(t,e,i,r){return t.operations.axisAt(t.value,e,i,r)}function qyt(t,e,i){return t.operations.intersectRay(t.value,e,i)}function Wyt(t,e,i){return t.operations.intersectRayClosestSilhouette(t.value,e,i)}function Xyt(t,e){return t.operations.altitudeAt(t.value,e)}function QLe(t,e,i,r){return t.operations.setAltitudeAt(t.value,e,i,r)}function Yyt(t,e,i,r){return e!==r&&go(r,e),he(xE,r[12],r[13],r[14]),QLe(t,xE,i,xE),r[12]=xE[0],r[13]=xE[1],r[14]=xE[2],r}function NH(t,e,i){return t.operations.elevate(t.value,e,i.value)}const xE=P();function hye(t,e,i,r,n){return n[0]=be(t,e),n[1]=be(t,i),n[2]=be(t,r),n}function WQ(t,e,i,r,n){ce(i,t),ce(H4,e),we(H4,H4),vt(r,H4,i),vt(n,r,i)}function eDe(t,e){return t?XB(e):e.isGeographic?Je.PlateCarree:e}const H4=P(),Rae=96;function lHt(t,e){const i=e||t.extent,r=t.width,n=tc(i&&i.spatialReference);return i&&r?i.width/r*n*lne*Rae:0}function Zyt(t,e){return t/(tc(e)*lne*Rae)}function Jyt(t){return t/(lne*Rae)}const Mae=re.getLogger("esri.layers.support.ElevationSampler");let tDe=class{queryElevation(e){return iDe(e.clone(),this)}on(){return i0t}projectIfRequired(e,i){return rDe(e,i)}},Kyt=class extends tDe{get spatialReference(){return this.extent.spatialReference}constructor(e,i,r){super(),this.tile=e,this.noDataValue=r;const n=e.tile.extent;this.extent=H9(n,i.spatialReference),this.extent.zmin=e.zmin,this.extent.zmax=e.zmax,this._aaExtent=n;const s=tc(i.spatialReference),o=i.lodAt(e.tile.level).resolution*s;this.demResolution={min:o,max:o}}contains(e){const i=this.projectIfRequired(e,this.spatialReference);return!R(i)&&this.containsAt(i.x,i.y)}containsAt(e,i){return q9(this._aaExtent,e,i)}elevationAt(e,i){if(!this.containsAt(e,i)){const r=this.extent,n=`${r.xmin}, ${r.ymin}, ${r.xmax}, ${r.ymax}`;return Mae.warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler extent (${n})`),this.noDataValue}return Nt(this.tile.sample(e,i),this.noDataValue)}},hHt=class extends tDe{get spatialReference(){return this.extent.spatialReference}constructor(e,i,r){let n;super(),typeof i=="number"?(this.noDataValue=i,n=null):(n=i,this.noDataValue=r),this.samplers=n?e.map(o=>new Kyt(o,n,this.noDataValue)):e;const s=this.samplers[0];if(s){this.extent=s.extent.clone();const{min:o,max:a}=s.demResolution;this.demResolution={min:o,max:a};for(let l=1;l<this.samplers.length;l++){const c=this.samplers[l];this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max)}}else this.extent=H9(Kt(),n.spatialReference),this.demResolution={min:0,max:0}}elevationAt(e,i){for(const r of this.samplers)if(r.containsAt(e,i))return r.elevationAt(e,i);return Mae.warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler`),this.noDataValue}};function iDe(t,e){const i=rDe(t,e.spatialReference);if(!i)return null;switch(t.type){case"point":Qyt(t,i,e);break;case"polyline":e0t(t,i,e);break;case"multipoint":t0t(t,i,e)}return t}function rDe(t,e){if(R(t))return null;const i=t.spatialReference;if(i.equals(e))return t;const r=z2(t,e);return r||Mae.error(`Cannot project geometry spatial reference (wkid:${i.wkid}) to elevation sampler spatial reference (wkid:${e.wkid})`),r}function Qyt(t,e,i){t.z=i.elevationAt(e.x,e.y)}function e0t(t,e,i){Ng.spatialReference=e.spatialReference;const r=t.hasM&&!t.hasZ;for(let n=0;n<t.paths.length;n++){const s=t.paths[n],o=e.paths[n];for(let a=0;a<s.length;a++){const l=s[a],c=o[a];Ng.x=c[0],Ng.y=c[1],r&&(l[3]=l[2]),l[2]=i.elevationAt(Ng.x,Ng.y)}}t.hasZ=!0}function t0t(t,e,i){Ng.spatialReference=e.spatialReference;const r=t.hasM&&!t.hasZ;for(let n=0;n<t.points.length;n++){const s=t.points[n],o=e.points[n];Ng.x=o[0],Ng.y=o[1],r&&(s[3]=s[2]),s[2]=i.elevationAt(Ng.x,Ng.y)}t.hasZ=!0}const Ng=new Le,i0t={remove(){}},r0t=12;let Nu=class Sc{constructor(e){const i=Sc.checkUnsupported(e);if(v(i))throw i;const r=e;this.spatialReference=r.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=d2(this.spatialReference)||wy(this.spatialReference)||xy(this.spatialReference),this.origin=[r.origin.x,r.origin.y],this.pixelSize=r.size[0],this.dpi=r.dpi;const n=r.lods.reduce((c,h,p)=>(h.level<c.min&&(c.min=h.level,c.minIndex=p),c.max=Math.max(c.max,h.level),c),{min:1/0,minIndex:0,max:-1/0}),s=r.lods[n.minIndex],o=2**s.level;let a=s.resolution*o,l=s.scale*o;this.levels=new Array(n.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:l,tileSize:[a*r.size[0],a*r.size[1]]},a/=2,l/=2}clone(){return new Sc(this.toTileInfo())}toTileInfo(){return new M$({dpi:this.dpi,origin:new Le({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((e,i)=>new rp({level:i,scale:e.scale,resolution:e.resolution}))})}getExtent(e,i,r,n){const s=this.levels[e],o=s.tileSize[0],a=s.tileSize[1];n[0]=this.origin[0]+r*o,n[2]=this.origin[0]+(r+1)*o,n[3]=this.origin[1]-i*a,n[1]=this.origin[1]-(i+1)*a}convertExtentToRadians(e,i){this._isWebMercator?(i[0]=Ghe(e[0]),i[1]=J8(e[1]),i[2]=Ghe(e[2]),i[3]=J8(e[3])):this._isGCS&&(i[0]=Xt(e[0]),i[1]=Xt(e[1]),i[2]=Xt(e[2]),i[3]=Xt(e[3]))}getExtentGeometry(e,i,r,n=new ni){return this.getExtent(e,i,r,Dm),n.spatialReference=this.spatialReference,n.xmin=Dm[0],n.ymin=Dm[1],n.xmax=Dm[2],n.ymax=Dm[3],n.zmin=void 0,n.zmax=void 0,n}ensureMaxLod(e){if(e==null)return!1;let i=!1;for(;this.levels.length<=e;){const r=this.levels[this.levels.length-1],n=r.resolution/2;this.levels.push({resolution:n,scale:r.scale/2,tileSize:[n*this.pixelSize,n*this.pixelSize]}),i=!0}return i}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const i=this.levels[0].scale;return e>=i?0:Math.log(i/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e){if(!(e instanceof Sc)){if(Sc.checkUnsupported(e))return!1;e=new Sc(e)}if(!e.spatialReference.equals(this.spatialReference)||e.pixelSize!==this.pixelSize)return!1;const i=Math.min(this.levels.length,e.levels.length)-1,r=this.levels[i].resolution;let n=.5*r;return!MR(e.origin[0],this.origin[0],n)||!MR(e.origin[1],this.origin[1],n)?!1:(n=.5*r/2**i/this.pixelSize*r0t,MR(r,e.levels[i].resolution,n))}rootTilesInExtent(e,i=null,r=1/0){const n=new Array,s=this.levels[0].tileSize;if(R(e)||s[0]===0||s[1]===0)return n;Sc.computeRowColExtent(e,s,this.origin,Dm);let o=Dm[1],a=Dm[3],l=Dm[0],c=Dm[2];const h=c-l,p=a-o;if(h*p>r){const f=Math.floor(Math.sqrt(r));p>f&&(o=o+Math.floor(.5*p)-Math.floor(.5*f),a=o+f),h>f&&(l=l+Math.floor(.5*h)-Math.floor(.5*f),c=l+f)}for(let f=o;f<a;f++)for(let m=l;m<c;m++)n.push([0,f,m]);return v(i)&&(i[0]=this.origin[0]+l*s[0],i[1]=this.origin[1]-a*s[1],i[2]=this.origin[0]+c*s[0],i[3]=this.origin[1]-o*s[1]),n}static computeRowColExtent(e,i,r,n){const s=.001*(e[2]-e[0]+(e[3]-e[1]));n[0]=Math.max(0,Math.floor((e[0]+s-r[0])/i[0])),n[2]=Math.max(0,Math.ceil((e[2]-s-r[0])/i[0])),n[1]=Math.max(0,Math.floor((r[1]-e[3]+s)/i[1])),n[3]=Math.max(0,Math.ceil((r[1]-e[1]-s)/i[1]))}static isPowerOfTwo(e){const i=e.lods,r=i[0].resolution*2**i[0].level;return!i.some(n=>!Jqe(n.resolution,r/2**n.level))}static hasGapInLevels(e){const i=e.lods.map(r=>r.level);i.sort((r,n)=>r-n);for(let r=1;r<i.length;r++)if(i[r]!==i[0]+r)return!0;return!1}static tileSizeSupported(e){const i=e.size[1];return i===e.size[0]&&(i&i-1)==0&&i>=128&&i<=512}static hasOriginPerLODs(e){const i=e.origin;return e.lods.some(r=>r.origin!=null&&(r.origin[0]!==i.x||r.origin[1]!==i.y))}static getMissingTileInfoError(){return new H("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(e){return R(e)?Oae():e.lods.length<1?new H("tilingscheme:generic","Tiling scheme must have at least one level"):Sc.isPowerOfTwo(e)?Sc.hasGapInLevels(e)?new H("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):Sc.tileSizeSupported(e)?Sc.hasOriginPerLODs(e)?new H("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new H("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new H("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(e,i){const r=e[2]-e[0],n=e[3]-e[1],s=tc(i),o=1.2*Math.max(r,n),a=256,l=96,c=.0254,h=new Sc(new M$({size:[a,a],origin:new Le({x:e[0]-.5*(o-r),y:e[3]+.5*(o-n)}),lods:[new rp({level:0,resolution:o/a,scale:1/(a/l*c/(o*s))})],spatialReference:i}));return h.ensureMaxLod(20),h}static makeWebMercatorAuxiliarySphere(e){const i=new Sc(Sc.WebMercatorAuxiliarySphereTileInfo);return i.ensureMaxLod(e),i}static makeGCSWithTileSize(e,i=256,r=16){const n=256/i,s=new Sc(new M$({size:[i,i],origin:new Le({x:-180,y:90,spatialReference:e}),spatialReference:e,lods:[new rp({level:0,resolution:.703125*n,scale:295497598570834e-6*n})]}));return s.ensureMaxLod(r),s}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}};function Oae(){return new H("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}Nu.WebMercatorAuxiliarySphereTileInfo=new M$({size:[256,256],origin:new Le({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:Je.WebMercator}),spatialReference:Je.WebMercator,lods:[new rp({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),Nu.WebMercatorAuxiliarySphere=Nu.makeWebMercatorAuxiliarySphere(19);const Dm=Kt(),oR=64,AI=512,n0t=2.5,_D=Kqe(rZ/10),nDe=2,sDe=Kt();Nu.WebMercatorAuxiliarySphere.getExtent(0,0,0,sDe);const s0t=Kt([-180,-90,180,90]),o0t="Cannot extend surface to encompass all layers because it would result in too many root tiles.",a0t="Surface extent is too large for tile resolution at level 0.",l0t=3;let c0t=l0t;function XQ(t){return t<4?3:c0t}let C1=class extends An.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=_D}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if(e==null||R(e.extent)||R(e.spatialReference))return null;const i=H9(e.extent,e.spatialReference);return i.zmin=e.visibleElevationBounds.min,i.zmax=e.visibleElevationBounds.max,i}get spatialReference(){var e;return Nt((e=this.view.basemapTerrain)==null?void 0:e.spatialReference,Je.WGS84)}elevationAt(e,i){var r;if(R(this.extent)||!zl(this.extent,e,i)){const n=v(this.extent)?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return re.getLogger(this.declaredClass).warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler extent (${n})`),this.noDataValue}return Nt((r=this.view.elevationProvider)==null?void 0:r.getElevation(e,i,0,this.spatialReference,"ground"),this.noDataValue)}queryElevation(e){return iDe(e.clone(),this)}};u([d({readOnly:!0})],C1.prototype,"demResolution",void 0),u([d({readOnly:!0})],C1.prototype,"extent",null),u([d({readOnly:!0})],C1.prototype,"noDataValue",void 0),u([d()],C1.prototype,"spatialReference",null),u([d({constructOnly:!0})],C1.prototype,"view",void 0),C1=u([$("esri.views.support.GroundViewElevationSampler")],C1);const u0t=C1;let A1=class extends ve{constructor(e){super(e),this._handles=new Xi,this.view=null,this.layerViews=new tt}initialize(){this._handles.add(yo(()=>{var e,i;return(i=(e=this.view)==null?void 0:e.map)==null?void 0:i.ground},e=>e.load())),this._handles.add(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null),this._handles&&(this._handles.destroy(),this._handles=null)}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new u0t({view:this.view}):null:null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this._handles.remove("updating"),this._handles.add(this.layerViews.map(e=>ne(()=>e.updating,()=>this._updateUpdating(),Ki)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};u([d({readOnly:!0})],A1.prototype,"elevationSampler",null),u([d({type:Boolean,readOnly:!0})],A1.prototype,"updating",null),u([d({constructOnly:!0})],A1.prototype,"view",void 0),u([d({type:tt,readOnly:!0})],A1.prototype,"layerViews",void 0),u([d({readOnly:!0})],A1.prototype,"suspended",null),A1=u([$("esri.views.GroundView")],A1);const h0t=A1,L3=()=>Q(()=>import("./TileLayerView3D-f0b61099.js"),["assets/TileLayerView3D-f0b61099.js","assets/LayerView3D-68bdf258.js","assets/TiledLayerView3D-5ca53d22.js","assets/LayerView-db7ff94b.js","assets/RefreshableLayerView-8ec9084b.js","assets/MapServiceLayerViewHelper-3c93e294.js","assets/floorFilterUtils-080a7cd2.js","assets/sublayerUtils-78c9523d.js","assets/popupUtils-0740bfd4.js","assets/drapedUtils-0903c165.js"]),dye=()=>Q(()=>import("./ElevationLayerView3D-795adf0c.js"),["assets/ElevationLayerView3D-795adf0c.js","assets/LayerView3D-68bdf258.js","assets/TiledLayerView3D-5ca53d22.js","assets/LayerView-db7ff94b.js"]),pye={"base-dynamic":()=>Q(()=>import("./BaseDynamicLayerView3D-9ad71dfd.js"),["assets/BaseDynamicLayerView3D-9ad71dfd.js","assets/DynamicLayerView3D-53bc4c49.js","assets/LayerView3D-68bdf258.js","assets/projectExtentUtils-55c9b2c9.js","assets/ImageMaterial-9dd7dfbf.js","assets/LayerView-db7ff94b.js","assets/RefreshableLayerView-8ec9084b.js"]),"base-elevation":dye,"base-tile":L3,"bing-maps":L3,"building-scene":()=>Q(()=>import("./BuildingSceneLayerView3D-969aad6a.js"),["assets/BuildingSceneLayerView3D-969aad6a.js","assets/BuildingGroupSublayer-3dfc37c5.js","assets/BuildingComponentSublayer-d29201a1.js","assets/capabilities-a18453f6.js","assets/I3SIndexInfo-bd5d64a7.js","assets/I3SLayerDefinitions-7f8195dd.js","assets/I3SUtil-fa4e3f4e.js","assets/I3SBinaryReader-099159c4.js","assets/popupUtils-0740bfd4.js","assets/WhereClause-cdddccc4.js","assets/executionError-fb3f283a.js","assets/I3SMeshView3D-1b864288.js","assets/I3SOverrides-fe35b64f.js","assets/I3SNode-ee019592.js","assets/RenderTexture-032510c3.js","assets/FeatureLayerView3D-81a3dab3.js","assets/FeatureLayerViewBase3D-28b5f015.js","assets/FeatureLikeLayerView3D-2041f299.js","assets/dehydratedFeatureComparison-db69a4fb.js","assets/queryForSymbologySnapping-e718fa2a.js","assets/elevationInfoUtils-5a8f681c.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-f17fb3b9.js","assets/optimizedFeatureQueryEngineAdapter-a67931c5.js","assets/centroid-c62179b0.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-e7f31776.js","assets/QueryEngineResult-2dd0323b.js","assets/utils-15a7108f.js","assets/generateRendererUtils-e2b7324f.js","assets/projectionSupport-2f167231.js","assets/json-48e3ea08.js","assets/utils-7734a0d6.js","assets/QueryEngineCapabilities-42e44ded.js","assets/timeSupport-d318046f.js","assets/FeatureStore-198512e7.js","assets/heatmapTextureUtils-e2b3289a.js","assets/projectExtentUtils-55c9b2c9.js","assets/LayerView3D-68bdf258.js","assets/EventedSet-c786378a.js","assets/FeatureLayerView-0d0f168b.js","assets/LayerView-db7ff94b.js","assets/RefreshableLayerView-8ec9084b.js","assets/SceneModification-0d6f6e31.js","assets/persistable-257e439a.js","assets/SceneLayerWorker-84f410be.js","assets/I3SQueryFeatureStore-bcd4156a.js","assets/DefinitionExpressionSceneLayerView-7b2aa390.js"]),csv:()=>Q(()=>import("./CSVLayerView3D-09c0c639.js"),["assets/CSVLayerView3D-09c0c639.js","assets/FeatureLayerViewBase3D-28b5f015.js","assets/FeatureLikeLayerView3D-2041f299.js","assets/dehydratedFeatureComparison-db69a4fb.js","assets/queryForSymbologySnapping-e718fa2a.js","assets/elevationInfoUtils-5a8f681c.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-f17fb3b9.js","assets/optimizedFeatureQueryEngineAdapter-a67931c5.js","assets/centroid-c62179b0.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-e7f31776.js","assets/QueryEngineResult-2dd0323b.js","assets/WhereClause-cdddccc4.js","assets/executionError-fb3f283a.js","assets/utils-15a7108f.js","assets/generateRendererUtils-e2b7324f.js","assets/projectionSupport-2f167231.js","assets/json-48e3ea08.js","assets/utils-7734a0d6.js","assets/QueryEngineCapabilities-42e44ded.js","assets/timeSupport-d318046f.js","assets/FeatureStore-198512e7.js","assets/heatmapTextureUtils-e2b3289a.js","assets/projectExtentUtils-55c9b2c9.js","assets/LayerView3D-68bdf258.js","assets/EventedSet-c786378a.js","assets/FeatureLayerView-0d0f168b.js","assets/popupUtils-0740bfd4.js","assets/LayerView-db7ff94b.js","assets/RefreshableLayerView-8ec9084b.js"]),dimension:()=>Q(()=>import("./DimensionLayerView3D-fdd71621.js"),["assets/DimensionLayerView3D-fdd71621.js","assets/LayerView3D-68bdf258.js","assets/LayerView-db7ff94b.js"]),elevation:dye,feature:()=>Q(()=>import("./FeatureLayerView3D-81a3dab3.js"),["assets/FeatureLayerView3D-81a3dab3.js","assets/FeatureLayerViewBase3D-28b5f015.js","assets/FeatureLikeLayerView3D-2041f299.js","assets/dehydratedFeatureComparison-db69a4fb.js","assets/queryForSymbologySnapping-e718fa2a.js","assets/elevationInfoUtils-5a8f681c.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-f17fb3b9.js","assets/optimizedFeatureQueryEngineAdapter-a67931c5.js","assets/centroid-c62179b0.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-e7f31776.js","assets/QueryEngineResult-2dd0323b.js","assets/WhereClause-cdddccc4.js","assets/executionError-fb3f283a.js","assets/utils-15a7108f.js","assets/generateRendererUtils-e2b7324f.js","assets/projectionSupport-2f167231.js","assets/json-48e3ea08.js","assets/utils-7734a0d6.js","assets/QueryEngineCapabilities-42e44ded.js","assets/timeSupport-d318046f.js","assets/FeatureStore-198512e7.js","assets/heatmapTextureUtils-e2b3289a.js","assets/projectExtentUtils-55c9b2c9.js","assets/LayerView3D-68bdf258.js","assets/EventedSet-c786378a.js","assets/FeatureLayerView-0d0f168b.js","assets/popupUtils-0740bfd4.js","assets/LayerView-db7ff94b.js","assets/RefreshableLayerView-8ec9084b.js"]),geojson:()=>Q(()=>import("./GeoJSONLayerView3D-0666aa38.js"),["assets/GeoJSONLayerView3D-0666aa38.js","assets/FeatureLayerViewBase3D-28b5f015.js","assets/FeatureLikeLayerView3D-2041f299.js","assets/dehydratedFeatureComparison-db69a4fb.js","assets/queryForSymbologySnapping-e718fa2a.js","assets/elevationInfoUtils-5a8f681c.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-f17fb3b9.js","assets/optimizedFeatureQueryEngineAdapter-a67931c5.js","assets/centroid-c62179b0.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-e7f31776.js","assets/QueryEngineResult-2dd0323b.js","assets/WhereClause-cdddccc4.js","assets/executionError-fb3f283a.js","assets/utils-15a7108f.js","assets/generateRendererUtils-e2b7324f.js","assets/projectionSupport-2f167231.js","assets/json-48e3ea08.js","assets/utils-7734a0d6.js","assets/QueryEngineCapabilities-42e44ded.js","assets/timeSupport-d318046f.js","assets/FeatureStore-198512e7.js","assets/heatmapTextureUtils-e2b3289a.js","assets/projectExtentUtils-55c9b2c9.js","assets/LayerView3D-68bdf258.js","assets/EventedSet-c786378a.js","assets/FeatureLayerView-0d0f168b.js","assets/popupUtils-0740bfd4.js","assets/LayerView-db7ff94b.js","assets/RefreshableLayerView-8ec9084b.js"]),graphics:()=>Q(()=>import("./GraphicsLayerView3D-44edbadc.js"),["assets/GraphicsLayerView3D-44edbadc.js","assets/LayerView3D-68bdf258.js","assets/queryForSymbologySnapping-e718fa2a.js","assets/elevationInfoUtils-5a8f681c.js","assets/GraphicsProcessor-9b8e4ce6.js","assets/Graphics3DObjectStates-f17fb3b9.js","assets/optimizedFeatureQueryEngineAdapter-a67931c5.js","assets/centroid-c62179b0.js","assets/projectExtentUtils-55c9b2c9.js","assets/LayerView-db7ff94b.js"]),group:()=>Q(()=>import("./GroupLayerView-5b39ea01.js"),["assets/GroupLayerView-5b39ea01.js","assets/LayerView-db7ff94b.js"]),imagery:()=>Q(()=>import("./ImageryLayerView3D-b9a4d378.js"),["assets/ImageryLayerView3D-b9a4d378.js","assets/DynamicLayerView3D-53bc4c49.js","assets/LayerView3D-68bdf258.js","assets/projectExtentUtils-55c9b2c9.js","assets/ImageMaterial-9dd7dfbf.js","assets/LayerView-db7ff94b.js","assets/RefreshableLayerView-8ec9084b.js","assets/ImageryLayerView-b0f7303e.js","assets/popupUtils-0740bfd4.js"]),"integrated-mesh":()=>Q(()=>import("./IntegratedMeshLayerView3D-a677d5f8.js"),["assets/IntegratedMeshLayerView3D-a677d5f8.js","assets/I3SMeshView3D-1b864288.js","assets/I3SOverrides-fe35b64f.js","assets/I3SNode-ee019592.js","assets/I3SUtil-fa4e3f4e.js","assets/I3SBinaryReader-099159c4.js","assets/RenderTexture-032510c3.js","assets/FeatureLayerView3D-81a3dab3.js","assets/FeatureLayerViewBase3D-28b5f015.js","assets/FeatureLikeLayerView3D-2041f299.js","assets/dehydratedFeatureComparison-db69a4fb.js","assets/queryForSymbologySnapping-e718fa2a.js","assets/elevationInfoUtils-5a8f681c.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-f17fb3b9.js","assets/optimizedFeatureQueryEngineAdapter-a67931c5.js","assets/centroid-c62179b0.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-e7f31776.js","assets/QueryEngineResult-2dd0323b.js","assets/WhereClause-cdddccc4.js","assets/executionError-fb3f283a.js","assets/utils-15a7108f.js","assets/generateRendererUtils-e2b7324f.js","assets/projectionSupport-2f167231.js","assets/json-48e3ea08.js","assets/utils-7734a0d6.js","assets/QueryEngineCapabilities-42e44ded.js","assets/timeSupport-d318046f.js","assets/FeatureStore-198512e7.js","assets/heatmapTextureUtils-e2b3289a.js","assets/projectExtentUtils-55c9b2c9.js","assets/LayerView3D-68bdf258.js","assets/EventedSet-c786378a.js","assets/FeatureLayerView-0d0f168b.js","assets/popupUtils-0740bfd4.js","assets/LayerView-db7ff94b.js","assets/RefreshableLayerView-8ec9084b.js","assets/SceneModification-0d6f6e31.js","assets/persistable-257e439a.js","assets/SceneLayerWorker-84f410be.js"]),"line-of-sight":()=>Q(()=>import("./LineOfSightLayerView3D-9f095f28.js"),["assets/LineOfSightLayerView3D-9f095f28.js","assets/LayerView3D-68bdf258.js","assets/LayerView-db7ff94b.js"]),"map-image":()=>Q(()=>import("./MapImageLayerView3D-cce338a9.js"),["assets/MapImageLayerView3D-cce338a9.js","assets/DynamicLayerView3D-53bc4c49.js","assets/LayerView3D-68bdf258.js","assets/projectExtentUtils-55c9b2c9.js","assets/ImageMaterial-9dd7dfbf.js","assets/LayerView-db7ff94b.js","assets/RefreshableLayerView-8ec9084b.js","assets/MapImageLayerView-5431461d.js","assets/ExportImageParameters-d00104d2.js","assets/floorFilterUtils-080a7cd2.js","assets/sublayerUtils-78c9523d.js","assets/MapServiceLayerViewHelper-3c93e294.js","assets/popupUtils-0740bfd4.js","assets/drapedUtils-0903c165.js"]),media:()=>Q(()=>import("./MediaLayerView3D-f1274d12.js"),["assets/MediaLayerView3D-f1274d12.js","assets/LayerView3D-68bdf258.js","assets/ImageMaterial-9dd7dfbf.js","assets/LayerView-db7ff94b.js"]),"ogc-feature":()=>Q(()=>import("./OGCFeatureLayerView3D-dd540fc7.js"),["assets/OGCFeatureLayerView3D-dd540fc7.js","assets/FeatureLayerViewBase3D-28b5f015.js","assets/FeatureLikeLayerView3D-2041f299.js","assets/dehydratedFeatureComparison-db69a4fb.js","assets/queryForSymbologySnapping-e718fa2a.js","assets/elevationInfoUtils-5a8f681c.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-f17fb3b9.js","assets/optimizedFeatureQueryEngineAdapter-a67931c5.js","assets/centroid-c62179b0.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-e7f31776.js","assets/QueryEngineResult-2dd0323b.js","assets/WhereClause-cdddccc4.js","assets/executionError-fb3f283a.js","assets/utils-15a7108f.js","assets/generateRendererUtils-e2b7324f.js","assets/projectionSupport-2f167231.js","assets/json-48e3ea08.js","assets/utils-7734a0d6.js","assets/QueryEngineCapabilities-42e44ded.js","assets/timeSupport-d318046f.js","assets/FeatureStore-198512e7.js","assets/heatmapTextureUtils-e2b3289a.js","assets/projectExtentUtils-55c9b2c9.js","assets/LayerView3D-68bdf258.js","assets/EventedSet-c786378a.js","assets/FeatureLayerView-0d0f168b.js","assets/popupUtils-0740bfd4.js","assets/LayerView-db7ff94b.js","assets/RefreshableLayerView-8ec9084b.js","assets/OGCFeatureLayerView-9886b103.js"]),"open-street-map":L3,"oriented-imagery":()=>Q(()=>import("./FeatureLayerView3D-81a3dab3.js"),["assets/FeatureLayerView3D-81a3dab3.js","assets/FeatureLayerViewBase3D-28b5f015.js","assets/FeatureLikeLayerView3D-2041f299.js","assets/dehydratedFeatureComparison-db69a4fb.js","assets/queryForSymbologySnapping-e718fa2a.js","assets/elevationInfoUtils-5a8f681c.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-f17fb3b9.js","assets/optimizedFeatureQueryEngineAdapter-a67931c5.js","assets/centroid-c62179b0.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-e7f31776.js","assets/QueryEngineResult-2dd0323b.js","assets/WhereClause-cdddccc4.js","assets/executionError-fb3f283a.js","assets/utils-15a7108f.js","assets/generateRendererUtils-e2b7324f.js","assets/projectionSupport-2f167231.js","assets/json-48e3ea08.js","assets/utils-7734a0d6.js","assets/QueryEngineCapabilities-42e44ded.js","assets/timeSupport-d318046f.js","assets/FeatureStore-198512e7.js","assets/heatmapTextureUtils-e2b3289a.js","assets/projectExtentUtils-55c9b2c9.js","assets/LayerView3D-68bdf258.js","assets/EventedSet-c786378a.js","assets/FeatureLayerView-0d0f168b.js","assets/popupUtils-0740bfd4.js","assets/LayerView-db7ff94b.js","assets/RefreshableLayerView-8ec9084b.js"]),"point-cloud":()=>Q(()=>import("./PointCloudLayerView3D-d304454d.js").then(t=>t.P),["assets/PointCloudLayerView3D-d304454d.js","assets/LayerView3D-68bdf258.js","assets/I3SUtil-fa4e3f4e.js","assets/I3SBinaryReader-099159c4.js","assets/PointCloudWorkerUtil-a766efc2.js","assets/PointCloudUniqueValueRenderer-f4ad8c34.js","assets/PopupSceneLayerView-73adc98c.js","assets/popupUtils-0740bfd4.js","assets/LayerView-db7ff94b.js"]),voxel:()=>Q(()=>import("./VoxelLayerView3D-9ed95377.js"),["assets/VoxelLayerView3D-9ed95377.js","assets/LayerView3D-68bdf258.js","assets/PopupSceneLayerView-73adc98c.js","assets/popupUtils-0740bfd4.js","assets/LayerView-db7ff94b.js"]),route:()=>Q(()=>import("./RouteLayerView3D-2d2022dd.js"),["assets/RouteLayerView3D-2d2022dd.js","assets/Stop-32221191.js","assets/LayerView3D-68bdf258.js","assets/GraphicsProcessor-9b8e4ce6.js","assets/Graphics3DObjectStates-f17fb3b9.js","assets/optimizedFeatureQueryEngineAdapter-a67931c5.js","assets/centroid-c62179b0.js","assets/projectExtentUtils-55c9b2c9.js","assets/EventedSet-c786378a.js","assets/LayerView-db7ff94b.js"]),scene:t=>t.profile==null||t.profile==="mesh-pyramids"?Q(()=>import("./SceneLayerView3D-f2531099.js"),["assets/SceneLayerView3D-f2531099.js","assets/WhereClause-cdddccc4.js","assets/executionError-fb3f283a.js","assets/floorFilterUtils-080a7cd2.js","assets/I3SMeshView3D-1b864288.js","assets/I3SOverrides-fe35b64f.js","assets/I3SNode-ee019592.js","assets/I3SUtil-fa4e3f4e.js","assets/I3SBinaryReader-099159c4.js","assets/RenderTexture-032510c3.js","assets/FeatureLayerView3D-81a3dab3.js","assets/FeatureLayerViewBase3D-28b5f015.js","assets/FeatureLikeLayerView3D-2041f299.js","assets/dehydratedFeatureComparison-db69a4fb.js","assets/queryForSymbologySnapping-e718fa2a.js","assets/elevationInfoUtils-5a8f681c.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-f17fb3b9.js","assets/optimizedFeatureQueryEngineAdapter-a67931c5.js","assets/centroid-c62179b0.js","assets/QueryEngine-e7f31776.js","assets/QueryEngineResult-2dd0323b.js","assets/utils-15a7108f.js","assets/generateRendererUtils-e2b7324f.js","assets/projectionSupport-2f167231.js","assets/json-48e3ea08.js","assets/utils-7734a0d6.js","assets/QueryEngineCapabilities-42e44ded.js","assets/timeSupport-d318046f.js","assets/FeatureStore-198512e7.js","assets/heatmapTextureUtils-e2b3289a.js","assets/projectExtentUtils-55c9b2c9.js","assets/LayerView3D-68bdf258.js","assets/EventedSet-c786378a.js","assets/FeatureLayerView-0d0f168b.js","assets/popupUtils-0740bfd4.js","assets/LayerView-db7ff94b.js","assets/RefreshableLayerView-8ec9084b.js","assets/SceneModification-0d6f6e31.js","assets/persistable-257e439a.js","assets/SceneLayerWorker-84f410be.js","assets/SceneLayerView-9ebca405.js","assets/DefinitionExpressionSceneLayerView-7b2aa390.js","assets/I3SQueryFeatureStore-bcd4156a.js","assets/PopupSceneLayerView-73adc98c.js"]):Q(()=>import("./SceneLayerGraphicsView3D-0a03db6e.js"),["assets/SceneLayerGraphicsView3D-0a03db6e.js","assets/I3SOverrides-fe35b64f.js","assets/I3SNode-ee019592.js","assets/I3SUtil-fa4e3f4e.js","assets/I3SBinaryReader-099159c4.js","assets/RenderTexture-032510c3.js","assets/FeatureLayerView3D-81a3dab3.js","assets/FeatureLayerViewBase3D-28b5f015.js","assets/FeatureLikeLayerView3D-2041f299.js","assets/dehydratedFeatureComparison-db69a4fb.js","assets/queryForSymbologySnapping-e718fa2a.js","assets/elevationInfoUtils-5a8f681c.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-f17fb3b9.js","assets/optimizedFeatureQueryEngineAdapter-a67931c5.js","assets/centroid-c62179b0.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-e7f31776.js","assets/QueryEngineResult-2dd0323b.js","assets/WhereClause-cdddccc4.js","assets/executionError-fb3f283a.js","assets/utils-15a7108f.js","assets/generateRendererUtils-e2b7324f.js","assets/projectionSupport-2f167231.js","assets/json-48e3ea08.js","assets/utils-7734a0d6.js","assets/QueryEngineCapabilities-42e44ded.js","assets/timeSupport-d318046f.js","assets/FeatureStore-198512e7.js","assets/heatmapTextureUtils-e2b3289a.js","assets/projectExtentUtils-55c9b2c9.js","assets/LayerView3D-68bdf258.js","assets/EventedSet-c786378a.js","assets/FeatureLayerView-0d0f168b.js","assets/popupUtils-0740bfd4.js","assets/LayerView-db7ff94b.js","assets/RefreshableLayerView-8ec9084b.js","assets/SceneLayerView-9ebca405.js","assets/DefinitionExpressionSceneLayerView-7b2aa390.js","assets/PopupSceneLayerView-73adc98c.js"]),stream:()=>Q(()=>import("./StreamLayerView3D-27288937.js"),["assets/StreamLayerView3D-27288937.js","assets/StreamFeatureManager-74396e01.js","assets/CircularArray-724bafc9.js","assets/createConnection-2241a850.js","assets/EventedSet-c786378a.js","assets/FeatureLikeLayerView3D-2041f299.js","assets/dehydratedFeatureComparison-db69a4fb.js","assets/queryForSymbologySnapping-e718fa2a.js","assets/elevationInfoUtils-5a8f681c.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-f17fb3b9.js","assets/optimizedFeatureQueryEngineAdapter-a67931c5.js","assets/centroid-c62179b0.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-e7f31776.js","assets/QueryEngineResult-2dd0323b.js","assets/WhereClause-cdddccc4.js","assets/executionError-fb3f283a.js","assets/utils-15a7108f.js","assets/generateRendererUtils-e2b7324f.js","assets/projectionSupport-2f167231.js","assets/json-48e3ea08.js","assets/utils-7734a0d6.js","assets/QueryEngineCapabilities-42e44ded.js","assets/timeSupport-d318046f.js","assets/FeatureStore-198512e7.js","assets/heatmapTextureUtils-e2b3289a.js","assets/projectExtentUtils-55c9b2c9.js","assets/LayerView3D-68bdf258.js","assets/LayerView-db7ff94b.js"]),tile:L3,"imagery-tile":()=>Q(()=>import("./ImageryTileLayerView3D-90f3ab9c.js"),["assets/ImageryTileLayerView3D-90f3ab9c.js","assets/LayerView3D-68bdf258.js","assets/TiledLayerView3D-5ca53d22.js","assets/ImageryTileLayerView-363e3eef.js","assets/rasterProjectionHelper-c7164d08.js","assets/popupUtils-0740bfd4.js","assets/LayerView-db7ff94b.js","assets/RefreshableLayerView-8ec9084b.js","assets/drapedUtils-0903c165.js"]),"vector-tile":()=>Q(()=>import("./VectorTileLayerView3D-c3cea836.js"),["assets/VectorTileLayerView3D-c3cea836.js","assets/TileInfoViewPOT-eafcecca.js","assets/Rect-ea14f53a.js","assets/rasterizingUtils-37f0f33e.js","assets/StyleDefinition-7d58136b.js","assets/enums-4b2a86a0.js","assets/WGLBrushVTLSymbol-e8c49a01.js","assets/definitions-3ddd14a8.js","assets/enums-b1d611e3.js","assets/number-b10bd8f5.js","assets/GeometryUtils-dd03fc25.js","assets/VTLMaterialManager-c25094ad.js","assets/ShaderCompiler-77d0dcb6.js","assets/programUtils-f035fe8a.js","assets/StyleRepository-30524876.js","assets/colorUtils-c0f43caf.js","assets/GeometryUtils-53652037.js","assets/LayerView3D-68bdf258.js","assets/TiledLayerView3D-5ca53d22.js","assets/LayerView-db7ff94b.js"]),wcs:()=>Q(()=>import("./ImageryTileLayerView3D-90f3ab9c.js"),["assets/ImageryTileLayerView3D-90f3ab9c.js","assets/LayerView3D-68bdf258.js","assets/TiledLayerView3D-5ca53d22.js","assets/ImageryTileLayerView-363e3eef.js","assets/rasterProjectionHelper-c7164d08.js","assets/popupUtils-0740bfd4.js","assets/LayerView-db7ff94b.js","assets/RefreshableLayerView-8ec9084b.js","assets/drapedUtils-0903c165.js"]),"web-tile":L3,wfs:()=>Q(()=>import("./WFSLayerView3D-c3880cf7.js"),["assets/WFSLayerView3D-c3880cf7.js","assets/FeatureLayerViewBase3D-28b5f015.js","assets/FeatureLikeLayerView3D-2041f299.js","assets/dehydratedFeatureComparison-db69a4fb.js","assets/queryForSymbologySnapping-e718fa2a.js","assets/elevationInfoUtils-5a8f681c.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-f17fb3b9.js","assets/optimizedFeatureQueryEngineAdapter-a67931c5.js","assets/centroid-c62179b0.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-e7f31776.js","assets/QueryEngineResult-2dd0323b.js","assets/WhereClause-cdddccc4.js","assets/executionError-fb3f283a.js","assets/utils-15a7108f.js","assets/generateRendererUtils-e2b7324f.js","assets/projectionSupport-2f167231.js","assets/json-48e3ea08.js","assets/utils-7734a0d6.js","assets/QueryEngineCapabilities-42e44ded.js","assets/timeSupport-d318046f.js","assets/FeatureStore-198512e7.js","assets/heatmapTextureUtils-e2b3289a.js","assets/projectExtentUtils-55c9b2c9.js","assets/LayerView3D-68bdf258.js","assets/EventedSet-c786378a.js","assets/FeatureLayerView-0d0f168b.js","assets/popupUtils-0740bfd4.js","assets/LayerView-db7ff94b.js","assets/RefreshableLayerView-8ec9084b.js"]),wms:()=>Q(()=>import("./WMSLayerView3D-da0660b7.js"),["assets/WMSLayerView3D-da0660b7.js","assets/DynamicLayerView3D-53bc4c49.js","assets/LayerView3D-68bdf258.js","assets/projectExtentUtils-55c9b2c9.js","assets/ImageMaterial-9dd7dfbf.js","assets/LayerView-db7ff94b.js","assets/RefreshableLayerView-8ec9084b.js","assets/WMSLayerView-798e7ab2.js","assets/ExportWMSImageParameters-3fec441b.js"]),wmts:()=>Q(()=>import("./WMTSLayerView3D-0778a032.js"),["assets/WMTSLayerView3D-0778a032.js","assets/LayerView3D-68bdf258.js","assets/TiledLayerView3D-5ca53d22.js","assets/LayerView-db7ff94b.js","assets/RefreshableLayerView-8ec9084b.js"]),"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null};function d0t(t){const e=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",i=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new H(`${i}:view-not-supported`,`${e} is not supported in 3D`)}const fye={hasLayerViewModule:t=>v(pye[t.type]),importLayerView:t=>{const e=pye[t.type];if(R(e))throw d0t(t);return e(t)}},mye="analyses-owner-handles";var aR,iS;(function(t){t[t.PENDING=0]="PENDING",t[t.CREATED=1]="CREATED"})(aR||(aR={})),function(t){t[t.ADDED=0]="ADDED",t[t.REMOVED=1]="REMOVED"}(iS||(iS={}));let AT=class extends sD{constructor(e){super(e),this._allAnalysisViews=new tt,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=gye(),this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(Bi("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(Bi()),this._attachedToViewResolver=gye()}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const i=this._items.get(e);if(R(i)||i.state.list===iS.REMOVED)throw new H("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return i.createAnalysisViewTask.promise}_connectOwners(){this.handles.add(this._connectAnalysesCollection(this.view.analyses),mye)}_disconnectOwners(){this.handles.remove(mye),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const n of e)this._addAnalysis(n);const i=e.on("after-add",n=>this._addAnalysis(n.item)),r=e.on("after-remove",n=>this._removeAnalysis(n.item));return{remove:()=>{i.remove(),r.remove();for(const n of e)this._removeAnalysis(n)}}}_addAnalysis(e){const i=this._items.get(e);if(i==null){const r={state:{view:aR.PENDING,list:iS.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,r),r.createAnalysisViewTask=ON(n=>this._createAnalysisViewPromise(r,n))}else i.state.list=iS.ADDED}_removeAnalysis(e){const i=this._items.get(e);i!=null?(i.state.list=iS.REMOVED,this._scheduleUpdate()):re.getLogger(this.declaredClass).error("Trying to remove analysis which was not added")}_scheduleUpdate(){v(this._scheduledUpdateHandle)||(this._scheduledUpdateHandle=V2(()=>this._update()))}_update(){this._scheduledUpdateHandle=Nr(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===iS.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case aR.PENDING:e.createAnalysisViewTask=Mp(e.createAnalysisViewTask);break;case aR.CREATED:v(e.view)&&(this._allAnalysisViews.remove(e.view),e.view=Ve(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,i){const r=e.analysis,n=r.type,s=this._analysisModules[n];if(this._creatingViewCount+=1,R(s.module))try{s.module=await this._loadAnalysisModule(n)}catch(a){throw this._creatingViewCount-=1,a}if(fo(i))throw this._creatingViewCount-=1,Bi("AnalysisView creation aborted");const o=new s.module.default({analysis:r,view:this.view});try{await o.when()}catch(a){throw this._creatingViewCount-=1,a}if(fo(i))throw this._creatingViewCount-=1,o.destroy(),Bi("AnalysisView creation aborted");return e.view=o,e.state.view=aR.CREATED,this._allAnalysisViews.add(o),this._creatingViewCount-=1,o}_loadAnalysisModule(e){switch(e){case"area-measurement":return Q(()=>import("./AreaMeasurementAnalysisView3D-98ff974a.js").then(i=>i.A),["assets/AreaMeasurementAnalysisView3D-98ff974a.js","assets/analysisThemeUtils-535d8cf0.js","assets/Segment-dc74be5b.js","assets/LineVisualElement-0fb6f749.js","assets/elevationInfoUtils-5a8f681c.js","assets/geometryEngine-aa479c6a.js","assets/geometryEngineBase-e1a33b0a.js","assets/hydrated-343069df.js","assets/EditGeometryOperations-f905e5cf.js"]);case"dimension":return Q(()=>import("./DimensionAnalysisView3D-85a89167.js").then(i=>i.D),["assets/DimensionAnalysisView3D-85a89167.js","assets/LineVisualElement-0fb6f749.js","assets/LengthDimension-da2ed2fb.js","assets/Segment-dc74be5b.js","assets/elevationInfoUtils-5a8f681c.js","assets/analysisViewUtils-f44c5db2.js","assets/ImageMaterial-9dd7dfbf.js","assets/Factory-cba43f08.js","assets/RightAngleQuadVisualElement-70c6775c.js","assets/VisualElementResources-bec0225b.js","assets/PointVisualElement-1fa72e4f.js","assets/colorUtils-c0f43caf.js","assets/EditGeometryOperations-f905e5cf.js","assets/QueryEngineResult-2dd0323b.js","assets/WhereClause-cdddccc4.js","assets/executionError-fb3f283a.js","assets/utils-15a7108f.js","assets/generateRendererUtils-e2b7324f.js","assets/projectionSupport-2f167231.js","assets/json-48e3ea08.js","assets/utils-7734a0d6.js","assets/dehydratedFeatureComparison-db69a4fb.js","assets/RenderTexture-032510c3.js"]);case"direct-line-measurement":return Q(()=>import("./DirectLineMeasurementAnalysisView3D-4d3e3b99.js").then(i=>i.D),["assets/DirectLineMeasurementAnalysisView3D-4d3e3b99.js","assets/analysisThemeUtils-535d8cf0.js","assets/Segment-dc74be5b.js","assets/LineVisualElement-0fb6f749.js","assets/elevationInfoUtils-5a8f681c.js","assets/geometryEngine-aa479c6a.js","assets/geometryEngineBase-e1a33b0a.js","assets/hydrated-343069df.js","assets/RightAngleQuadVisualElement-70c6775c.js","assets/VisualElementResources-bec0225b.js"]);case"line-of-sight":return Q(()=>import("./LineOfSightAnalysisView3D-dd29f638.js"),["assets/LineOfSightAnalysisView3D-dd29f638.js","assets/LineVisualElement-0fb6f749.js","assets/LineOfSightAnalysisTarget-19283a24.js","assets/persistable-257e439a.js","assets/elevationInfoUtils-5a8f681c.js","assets/analysisViewUtils-f44c5db2.js","assets/ImageMaterial-9dd7dfbf.js","assets/PointVisualElement-1fa72e4f.js","assets/VisualElementResources-bec0225b.js"]);case"slice":return Q(()=>import("./SliceAnalysisView3D-56114bfd.js").then(i=>i.S),["assets/SliceAnalysisView3D-56114bfd.js","assets/LineVisualElement-0fb6f749.js","assets/persistable-257e439a.js","assets/BuildingComponentSublayer-d29201a1.js","assets/capabilities-a18453f6.js","assets/I3SIndexInfo-bd5d64a7.js","assets/I3SLayerDefinitions-7f8195dd.js","assets/I3SUtil-fa4e3f4e.js","assets/I3SBinaryReader-099159c4.js","assets/popupUtils-0740bfd4.js","assets/analysisViewUtils-f44c5db2.js","assets/ImageMaterial-9dd7dfbf.js","assets/Factory-cba43f08.js"])}}};function gye(){const t=Jb();return t.promise.catch(()=>{}),t}u([d()],AT.prototype,"updating",null),u([d({constructOnly:!0})],AT.prototype,"view",void 0),u([d()],AT.prototype,"_allAnalysisViews",void 0),u([d()],AT.prototype,"_creatingViewCount",void 0),AT=u([$("esri.views.3d.analysis.AnalysisViewManager3D")],AT);const p0t=AT;let x0=class extends ve{constructor(e){super(e),this.collision=new RI,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===qe.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==qe.Local?this._set("altitude",e):re.getLogger(this.declaredClass).warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?_e(e,this.altitude.min,this.altitude.max):e}clampTilt(e,i){if(!this.tilt)return i;const r=this.tilt(e);return _e(i,r.min,r.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===qe.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(i,r=FH)=>(r.min=La.min,r.max=e,r)}_createDefaultTiltLocal(){const e=this.collision.enabled?EU([[4e3,La.max],[1e4,Xt(88)],[6e6,Xt(88)]]):()=>La.max;return(i,r=FH)=>(r.min=La.min,r.max=e(i),r)}_createDefaultTiltGlobal(){const e=this.collision.enabled?EU([[4e3,La.max],[5e4,Xt(88)],[6e6,Xt(88)],[2e7,La.min]]):EU([[3e5,La.max],[3e6,Xt(88)],[6e6,Xt(88)],[2e7,La.min]]);return(i,r=FH)=>(r.min=La.min,r.max=e(i),r)}};function f0t(t){return{min:-2e5,max:4*t.radius}}u([d()],x0.prototype,"altitude",null),u([d({readOnly:!0})],x0.prototype,"collision",void 0),u([d()],x0.prototype,"distance",void 0),u([d({readOnly:!0})],x0.prototype,"minimumPoiDistance",void 0),u([d()],x0.prototype,"tilt",void 0),u([d({constructOnly:!0})],x0.prototype,"mode",void 0),x0=u([$("esri.views.3d.state.Constraints")],x0);const yye=f0t(Ci),La={min:Xt(.5),max:Xt(179.5)},FH={min:0,max:0};let RI=class extends ve{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};u([d({type:Boolean})],RI.prototype,"enabled",void 0),u([d({type:Number})],RI.prototype,"elevationMargin",void 0),RI=u([$("esri.views.3d.state.Constraints.CollisionConstraint")],RI);let lR=class extends ve{constructor(){super(...arguments),this.min=yye.min,this.max=yye.max}};u([d({type:Number})],lR.prototype,"min",void 0),u([d({type:Number})],lR.prototype,"max",void 0),lR=u([$("esri.views.3d.constraints.AltitudeConstraint")],lR);let $0=class extends ve{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,i){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==i&&this._set("far",i))}};u([d({type:Number,value:1e-8})],$0.prototype,"near",null),u([ri("near")],$0.prototype,"castNear",null),u([d({type:Number,value:1e-8})],$0.prototype,"far",null),u([ri("far")],$0.prototype,"castFar",null),u([d({type:["auto","manual"]})],$0.prototype,"mode",void 0),$0=u([$("esri.views.3d.constraints.ClipDistanceConstraint")],$0);const YQ={min:ml(La.min),max:ml(La.max)};let rS=class extends ve{constructor(){super(...arguments),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return _e(e,YQ.min,YQ.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};u([d({type:["auto","manual"]})],rS.prototype,"mode",void 0),u([d({type:Number,value:YQ.max})],rS.prototype,"max",null),u([ri("max")],rS.prototype,"castMax",null),rS=u([$("esri.views.3d.constraints.TiltConstraint")],rS);let nS=class extends ve{constructor(){super(...arguments),this.tilt=new rS,this.altitude=new lR,this.clipDistance=new $0}};u([d({type:rS})],nS.prototype,"tilt",void 0),u([d({type:lR})],nS.prototype,"altitude",void 0),u([d({type:$0})],nS.prototype,"clipDistance",void 0),nS=u([$("esri.views.3d.constraints.Constraints")],nS);var ZQ;let Ud=ZQ=class extends fe{constructor(t){super(t),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(t,e){return e.datetime!=null&&new Date(e.datetime)||null}writeDate(t,e,i){e[i]=t.getTime()}readDirectShadowsEnabled(t,e){return!!e.directShadows}writedirectShadowsEnabled(t,e,i){t&&(e[i]=t)}writeDisplayUTCOffset(t,e){t!=null&&(e.displayUTCOffset=t)}clone(){return new ZQ(this.cloneConstructProperties())}cloneConstructProperties(){const t={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(t.date=new Date(this.date.getTime())),t}};u([d({readOnly:!0,type:["sun"],json:{write:!0}})],Ud.prototype,"type",void 0),u([d({type:Date,json:{type:Number,write:{target:"datetime"}}})],Ud.prototype,"date",void 0),u([Oe("date",["datetime"])],Ud.prototype,"readDate",null),u([Ne("date")],Ud.prototype,"writeDate",null),u([d({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],Ud.prototype,"directShadowsEnabled",void 0),u([Oe("directShadowsEnabled",["directShadows"])],Ud.prototype,"readDirectShadowsEnabled",null),u([Ne("directShadowsEnabled")],Ud.prototype,"writedirectShadowsEnabled",null),u([d({type:Number,json:{write:!0}})],Ud.prototype,"displayUTCOffset",void 0),u([Ne("displayUTCOffset")],Ud.prototype,"writeDisplayUTCOffset",null),Ud=ZQ=u([$("esri.webscene.SunLighting")],Ud);const vD=Ud;var cA;let gg=cA=class extends An.EventedMixin(vD){constructor(t){super(t),this.cameraTrackingEnabled=!0,this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const e=new Date().getFullYear(),i=new Date("March 15, "+e+" 12:00:00 UTC");this._set("defaultDate",i),this._set("date",i)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(t){return new cA(t.cloneConstructProperties())}set defaultDate(t){const e=this._get("date")===this._get("defaultDate");t=new Date(t.getTime()),this._set("defaultDate",t),e&&this._set("date",t)}set date(t){t!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(t.getTime())))}autoUpdate(t,e){const i=cA.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=e.hours,this.positionTimezoneInfo.minutes=e.minutes,this.positionTimezoneInfo.seconds=e.seconds;let r=null;v(t)&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(t.getTime())?(r=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(r=this.date&&this.date.getTime(),this._set("date",new Date(t.getTime()))));const n=cA.calculateTimezoneOffset(this.positionTimezoneInfo);if(i!==n&&(kH.target=this,kH.timezoneOffset=n,this.emit("timezone-will-change",kH)),v(t))return!!isNaN(t.getTime())||r!==t.getTime()}clone(){const t=this._get("date")===this._get("defaultDate"),e=new cA({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled});return t&&e._set("date",e._get("defaultDate")),e.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,e.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,e.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,e.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,e}cloneWithWebsceneLighting(t){const e=this.clone();return t.date!=null&&(e.date=t.date),e.directShadowsEnabled=t.directShadowsEnabled,e.displayUTCOffset=t.displayUTCOffset,e}cloneNonPersistentConstructProperties(){return{ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled,cameraTrackingEnabled:this.cameraTrackingEnabled}}};u([d({type:Boolean})],gg.prototype,"cameraTrackingEnabled",void 0),u([d({type:Boolean})],gg.prototype,"ambientOcclusionEnabled",void 0),u([d({type:Boolean})],gg.prototype,"waterReflectionEnabled",void 0),u([d({type:Date})],gg.prototype,"defaultDate",null),u([d({type:Date})],gg.prototype,"date",null),gg=cA=u([$("esri.views.3d.environment.SunLighting")],gg),function(t){function e({hours:i,minutes:r,seconds:n}){return Math.round(i+r/60+n/3600)}t.calculateTimezoneOffset=e}(gg||(gg={}));const kH={target:null,timezoneOffset:0},R1=gg;var JQ;let MI=JQ=class extends fe{constructor(t){super(t),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new JQ(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};u([d({readOnly:!0,type:["virtual"],json:{write:!0}})],MI.prototype,"type",void 0),u([d({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],MI.prototype,"directShadowsEnabled",void 0),MI=JQ=u([$("esri.webscene.VirtualLighting")],MI);const YB=MI;var CU;let uA=CU=class extends An.EventedMixin(YB){constructor(t){super(t),this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1,this.cameraTrackingEnabled=!0}clone(){return new CU({...this.cloneConstructProperties(),ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled,cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(t){return new CU(t.cloneConstructProperties())}cloneWithWebsceneLighting(t){const e=this.clone();return e.directShadowsEnabled=t.directShadowsEnabled,e}cloneNonPersistentConstructProperties(){return{ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled,cameraTrackingEnabled:this.cameraTrackingEnabled}}};u([d({type:Boolean})],uA.prototype,"ambientOcclusionEnabled",void 0),u([d({type:Boolean})],uA.prototype,"waterReflectionEnabled",void 0),u([d({type:Boolean})],uA.prototype,"cameraTrackingEnabled",void 0),uA=CU=u([$("esri.views.3d.environment.VirtualLighting")],uA);const OI=uA,m0t={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:R1,virtual:OI}};var KQ;let W$=KQ=class extends ve{set quality(t){["low","high"].includes(t)&&this._set("quality",t)}clone(){return new KQ({quality:this.quality})}};u([d({type:["low","high"],value:"low"})],W$.prototype,"quality",null),W$=KQ=u([$("esri.views.3d.environment.SceneViewAtmosphere")],W$);var QQ;let PI=QQ=class extends fe{constructor(t){super(t),this.type="sunny",this.cloudCover=.5}clone(){return new QQ({cloudCover:this.cloudCover})}};u([ot({sunny:"sunny"})],PI.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],PI.prototype,"cloudCover",void 0),PI=QQ=u([$("esri.views.3d.environment.SunnyWeather")],PI);const eee=PI;var tee;let II=tee=class extends fe{constructor(t){super(t),this.type="cloudy",this.cloudCover=.5}clone(){return new tee({cloudCover:this.cloudCover})}};u([ot({cloudy:"cloudy"})],II.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],II.prototype,"cloudCover",void 0),II=tee=u([$("esri.views.3d.environment.CloudyWeather")],II);const g0t=II;var iee;let $I=iee=class extends fe{constructor(t){super(t),this.type="foggy",this.fogStrength=.5}clone(){return new iee({fogStrength:this.fogStrength})}};u([ot({foggy:"foggy"})],$I.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],$I.prototype,"fogStrength",void 0),$I=iee=u([$("esri.views.3d.environment.FoggyWeather")],$I);const y0t=$I;var ree;let hA=ree=class extends fe{constructor(t){super(t),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new ree({cloudCover:this.cloudCover,precipitation:this.precipitation})}};u([ot({rainy:"rainy"})],hA.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],hA.prototype,"cloudCover",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],hA.prototype,"precipitation",void 0),hA=ree=u([$("esri.views.3d.environment.RainyWeather")],hA);const _0t=hA;var nee;let RT=nee=class extends fe{constructor(t){super(t),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new nee({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};u([ot({snowy:"snowy"})],RT.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],RT.prototype,"cloudCover",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],RT.prototype,"precipitation",void 0),u([d({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],RT.prototype,"snowCover",void 0),RT=nee=u([$("esri.views.3d.environment.SnowyWeather")],RT);const v0t=RT,oDe={key:"type",base:eee,typeMap:{sunny:eee,cloudy:g0t,rainy:_0t,snowy:v0t,foggy:y0t}},b0t=Object.keys(oDe.typeMap);function w0t(t,e){return!!b0t.includes(t)||(e.error(`"${t}" is not a valid weather type`),!1)}const Kd=1e4,x0t={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:vD,virtual:YB}};let AU=class extends fe{constructor(e){super(e)}clone(){}};u([d({readOnly:!0,json:{read:!1}})],AU.prototype,"type",void 0),AU=u([$("esri.webscene.background.Background")],AU);const aDe=AU;var see;const T0t={...z_,nonNullable:!0};let LI=see=class extends aDe{constructor(t){super(t),this.type="color",this.color=new Xe([0,0,0,1])}clone(){return new see(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};u([ot({color:"color"},{readOnly:!0})],LI.prototype,"type",void 0),u([d(T0t)],LI.prototype,"color",void 0),LI=see=u([$("esri.webscene.background.ColorBackground")],LI);const lDe=LI,_ye={base:aDe,key:"type",typeMap:{color:lDe}};function S0t(t){return(e,i,r)=>{if(!e)return e;for(const n in t.typeMap)if(e.type===n){const s=new t.typeMap[n];return s.read(e,r),s}}}const E0t={types:_ye,json:{read:S0t(_ye),write:{overridePolicy:(t,e,i)=>({enabled:!i||!i.isPresentation})}}};var oee;const cDe="esri.webscene.Environment",C0t=re.getLogger(cDe),vye=(t,e,i)=>({enabled:!i||!i.isPresentation});let M1=oee=class extends fe{constructor(t){super(t),this.lighting=new vD,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(t){w0t(t==null?void 0:t.type,C0t)&&this._set("weather",t)}clone(){return new oee(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?YB.prototype.clone.call(this.lighting):vD.prototype.clone.call(this.lighting),background:se(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};u([d({types:x0t,nonNullable:!0,json:{write:!0}})],M1.prototype,"lighting",void 0),u([d(E0t)],M1.prototype,"background",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:vye}}})],M1.prototype,"atmosphereEnabled",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:vye}}})],M1.prototype,"starsEnabled",void 0),u([d({types:oDe,nonNullable:!0,json:{write:!0},value:new eee})],M1.prototype,"weather",null),M1=oee=u([$(cDe)],M1);const uDe=M1;var DI;let dA=DI=class extends uDe{constructor(t){super(t),this.atmosphere=new W$,this.lighting=new R1,this.cachedCameraTrackingEnabled=null}static fromWebsceneEnvironment(t){const e=t.cloneConstructProperties();return new DI({...e,lighting:e.lighting?e.lighting.type==="virtual"?OI.fromWebsceneLighting(e.lighting):R1.fromWebsceneLighting(e.lighting):void 0})}castLighting(t){return this._convertLighting(t)}applyLighting(t){this.lighting=this._convertLighting(t)}_convertLighting(t){var e,i;return t?t instanceof R1||t instanceof OI?t:t instanceof vD?this.lighting&&this.lighting.type!=="virtual"?this.lighting.cloneWithWebsceneLighting(t):new R1({...t.cloneConstructProperties(),...(e=this.lighting)==null?void 0:e.cloneNonPersistentConstructProperties()}):t instanceof YB?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t):new OI({...t.cloneConstructProperties(),...(i=this.lighting)==null?void 0:i.cloneNonPersistentConstructProperties()}):pm(m0t,t):new R1}clone(){return new DI({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:se(this.background)})}cloneWithWebsceneEnvironment(t){return new DI({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:se(this.background),...t.cloneConstructProperties(),lighting:this._getLighting(t)})}_getLighting(t){switch(t.lighting.type){case"sun":return this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(t.lighting):R1.fromWebsceneLighting(t.lighting);case"virtual":return this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t.lighting):OI.fromWebsceneLighting(t.lighting);default:return t.lighting,R1.fromWebsceneLighting(t.lighting)}}};u([d({type:W$,json:{read:!1},nonNullable:!0})],dA.prototype,"atmosphere",void 0),u([d({nonNullable:!0})],dA.prototype,"lighting",void 0),u([ri("lighting")],dA.prototype,"castLighting",null),dA=DI=u([$("esri.views.3d.environment.SceneViewEnvironment")],dA);const pA=dA;var so;(function(t){t[t.Simple=0]="Simple",t[t.Realistic=1]="Realistic",t[t.Panoramic=2]="Panoramic",t[t.None=3]="None"})(so||(so={}));function Pae(t){return _e((t-1e5)/(1e6-1e5),0,1)}const aee=1e4,A0t=.085,bD=1e5;let R0t=class{};const Tr=R0t;function S(t,...e){let i="";for(let r=0;r<e.length;r++)i+=t[r]+e[r];return i+=t[t.length-1],i}(function(t){function e(r){return Math.round(r).toString()}function i(r){return r.toPrecision(8)}t.int=e,t.float=i})(S||(S={}));var M;(function(t){t.POSITION="position",t.NORMAL="normal",t.UV0="uv0",t.AUXPOS1="auxpos1",t.AUXPOS2="auxpos2",t.COLOR="color",t.SYMBOLCOLOR="symbolColor",t.SIZE="size",t.TANGENT="tangent",t.OFFSET="offset",t.SUBDIVISIONFACTOR="subdivisionFactor",t.COLORFEATUREATTRIBUTE="colorFeatureAttribute",t.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",t.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",t.DISTANCETOSTART="distanceToStart",t.UVMAPSPACE="uvMapSpace",t.BOUNDINGRECT="boundingRect",t.UVREGION="uvRegion",t.NORMALCOMPRESSED="normalCompressed",t.PROFILERIGHT="profileRight",t.PROFILEUP="profileUp",t.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",t.FEATUREVALUE="featureValue",t.MODELORIGINHI="modelOriginHi",t.MODELORIGINLO="modelOriginLo",t.MODEL="model",t.MODELNORMAL="modelNormal",t.INSTANCECOLOR="instanceColor",t.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",t.LOCALTRANSFORM="localTransform",t.GLOBALTRANSFORM="globalTransform",t.BOUNDINGSPHERE="boundingSphere",t.MODELORIGIN="modelOrigin",t.MODELSCALEFACTORS="modelScaleFactors",t.FEATUREATTRIBUTE="featureAttribute",t.STATE="state",t.LODLEVEL="lodLevel",t.POSITION0="position0",t.POSITION1="position1",t.NORMALA="normalA",t.NORMALB="normalB",t.COMPONENTINDEX="componentIndex",t.VARIANTOFFSET="variantOffset",t.VARIANTSTROKE="variantStroke",t.VARIANTEXTENSION="variantExtension",t.U8PADDING="u8padding",t.U16PADDING="u16padding",t.SIDENESS="sideness",t.START="start",t.END="end",t.UP="up",t.EXTRUDE="extrude",t.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",t.OBJECTANDLAYERIDCOLOR_INSTANCED="objectAndLayerIdColor_instanced"})(M||(M={}));var ds;function iy(t,e){switch(e.textureCoordinateType){case ds.Default:return t.attributes.add(M.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(S`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case ds.Compressed:return t.attributes.add(M.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(S`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case ds.Atlas:return t.attributes.add(M.UV0,"vec2"),t.varyings.add("vuv0","vec2"),t.attributes.add(M.UVREGION,"vec4"),t.varyings.add("vuvRegion","vec4"),void t.vertex.code.add(S`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:e.textureCoordinateType;case ds.None:return void t.vertex.code.add(S`void forwardTextureCoordinates() {}`);case ds.COUNT:return}}(function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Atlas=2]="Atlas",t[t.Compressed=3]="Compressed",t[t.COUNT=4]="COUNT"})(ds||(ds={}));function nh(t){t.code.add(S`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}function ud(t){t.include(nh),t.code.add(S`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture2D(depthTex, uv)), nearFar);
}`)}function ZB(t){t.fragment.code.add(S`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var br;(function(t){t[t.Pass=0]="Pass",t[t.Draw=1]="Draw"})(br||(br={}));let Fn=class{constructor(e,i,r,n,s=null){this.name=e,this.type=i,this.arraySize=s,this.bind={[br.Pass]:null,[br.Draw]:null},v(r)&&v(n)&&(this.bind[r]=n)}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}},Jt=class extends Fn{constructor(e,i){super(e,"vec3",br.Pass,(r,n,s)=>r.setUniform3fv(e,i(n,s)))}},Ie=class extends Fn{constructor(e,i){super(e,"float",br.Pass,(r,n,s)=>r.setUniform1f(e,i(n,s)))}};function H_(t){t.uniforms.add(new Jt("mainLightDirection",(e,i)=>i.lighting.mainLight.direction))}function Ey(t){t.uniforms.add(new Jt("mainLightIntensity",(e,i)=>i.lighting.mainLight.intensity))}function M0t(t,e){e.useLegacyTerrainShading?t.uniforms.add(new Ie("lightingFixedFactor",(i,r)=>r.lighting.noonFactor*(1-r.lighting.globalFactor))):t.constants.add("lightingFixedFactor","float",0)}function oz(t,e){const i=t.fragment;H_(i),Ey(i),M0t(i,e),i.code.add(S`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
dotVal = mix(dotVal, 1.0, lightingFixedFactor);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)}let Wi=class extends Fn{constructor(e,i){super(e,"vec2",br.Pass,(r,n,s)=>r.setUniform2fv(e,i(n,s)))}},bi=class extends Fn{constructor(e,i){super(e,"vec4",br.Pass,(r,n,s)=>r.setUniform4fv(e,i(n,s)))}},on=class extends Fn{constructor(e,i){super(e,"mat4",br.Pass,(r,n,s)=>r.setUniformMatrix4fv(e,i(n,s)))}};const hDe=re.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");let dDe=class{constructor(){this._includedModules=new Map}include(e,i){if(this._includedModules.has(e)){const r=this._includedModules.get(e);if(r!==i){hDe.error("Trying to include shader module multiple times with different sets of options.");const n=new Set;for(const s of Object.keys(r))r[s]!==e[s]&&n.add(s);for(const s of Object.keys(e))r[s]!==e[s]&&n.add(s);n.forEach(s=>console.error(`  ${s}: current ${r[s]} new ${e[s]}`))}}else this._includedModules.set(e,i),e(this.builder,i)}},ji=class extends dDe{constructor(){super(...arguments),this.vertex=new bye,this.fragment=new bye,this.attributes=new I0t,this.varyings=new $0t,this.extensions=new lee,this.constants=new pDe}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e){const i=this.extensions.generateSource(e),r=this.attributes.generateSource(e),n=this.varyings.generateSource(),s=e==="vertex"?this.vertex:this.fragment,o=s.uniforms.generateSource(),a=s.code.generateSource(),l=e==="vertex"?D0t:L0t,c=this.constants.generateSource().concat(s.constants.generateSource());return`
${i.join(`
`)}

${l}

${c.join(`
`)}

${o.join(`
`)}

${r.join(`
`)}

${n.join(`
`)}

${a.join(`
`)}`}generateBind(e,i){const r=new Map;this.vertex.uniforms.entries.forEach(o=>{const a=o.bind[e];v(a)&&r.set(o.name,a)}),this.fragment.uniforms.entries.forEach(o=>{const a=o.bind[e];v(a)&&r.set(o.name,a)});const n=Array.from(r.values()),s=n.length;return(o,a,l)=>{for(let c=0;c<s;++c)n[c](i,o,a,l)}}},O0t=class{constructor(){this._entries=new Map}add(e){if(!Array.isArray(e))return this._add(e);for(const i of e)this._add(i)}get(e){return this._entries.get(e)}_add(e){if(R(e))hDe.error(`Trying to add null Uniform from ${new Error().stack}.`);else{if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new H(`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}}generateSource(){return Array.from(this._entries.values()).map(e=>v(e.arraySize)?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`)}get entries(){return Array.from(this._entries.values())}},P0t=class{constructor(){this._entries=new Array}add(e){this._entries.push(e)}generateSource(){return this._entries}},bye=class extends dDe{constructor(){super(...arguments),this.uniforms=new O0t,this.code=new P0t,this.constants=new pDe}get builder(){return this}},I0t=class{constructor(){this._entries=new Array}add(e,i){this._entries.push([e,i])}generateSource(e){return e==="fragment"?[]:this._entries.map(i=>`attribute ${i[1]} ${i[0]};`)}},$0t=class{constructor(){this._entries=new Array}add(e,i){this._entries.push([e,i])}generateSource(){return this._entries.map(e=>`varying ${e[1]} ${e[0]};`)}},lee=class cee{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const i=e==="vertex"?cee.ALLOWLIST_VERTEX:cee.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(r=>i.includes(r)).map(r=>`#extension ${r} : enable`)}};lee.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],lee.ALLOWLIST_VERTEX=[];let pDe=class Fs{constructor(){this._entries=new Set}add(e,i,r){let n="ERROR_CONSTRUCTOR_STRING";switch(i){case"float":n=Fs._numberToFloatStr(r);break;case"int":n=Fs._numberToIntStr(r);break;case"bool":n=r.toString();break;case"vec2":n=`vec2(${Fs._numberToFloatStr(r[0])},                            ${Fs._numberToFloatStr(r[1])})`;break;case"vec3":n=`vec3(${Fs._numberToFloatStr(r[0])},                            ${Fs._numberToFloatStr(r[1])},                            ${Fs._numberToFloatStr(r[2])})`;break;case"vec4":n=`vec4(${Fs._numberToFloatStr(r[0])},                            ${Fs._numberToFloatStr(r[1])},                            ${Fs._numberToFloatStr(r[2])},                            ${Fs._numberToFloatStr(r[3])})`;break;case"ivec2":n=`ivec2(${Fs._numberToIntStr(r[0])},                             ${Fs._numberToIntStr(r[1])})`;break;case"ivec3":n=`ivec3(${Fs._numberToIntStr(r[0])},                             ${Fs._numberToIntStr(r[1])},                             ${Fs._numberToIntStr(r[2])})`;break;case"ivec4":n=`ivec4(${Fs._numberToIntStr(r[0])},                             ${Fs._numberToIntStr(r[1])},                             ${Fs._numberToIntStr(r[2])},                             ${Fs._numberToIntStr(r[3])})`;break;case"mat2":case"mat3":case"mat4":n=`${i}(${Array.prototype.map.call(r,s=>Fs._numberToFloatStr(s)).join(", ")})`}return this._entries.add(`const ${i} ${e} = ${n};`),this}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}};const L0t=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif`,D0t=`precision highp float;
precision highp sampler2D;`,Iae="Size",JB="InvSize";function Tp(t,e,i=!1,r=0){if(t.hasWebGL2Context){const n=S`vec2(textureSize(${e}, ${S.int(r)}))`;return i?"(1.0 / "+n+")":n}return i?e+JB:e+Iae}function Zl(t,e,i,r=null,n=0){if(t.hasWebGL2Context)return S`texelFetch(${e}, ivec2(${i}), ${S.int(n)})`;let s=S`texture2D(${e}, ${i} * `;return s+=r?S`(${r}))`:S`${e+JB})`,s}var lr;(function(t){t[t.None=0]="None",t[t.Size=1]="Size",t[t.InvSize=2]="InvSize"})(lr||(lr={}));let Dt=class extends Fn{constructor(e,i){super(e,"sampler2D",br.Pass,(r,n,s)=>r.bindTexture(e,i(n,s)))}};function cm(t,e,i=lr.None){const r=[new Dt(t,e)];if(i&lr.Size){const n=t+Iae;r.push(new Wi(n,(s,o)=>{const a=e(s,o);return v(a)?dt(wye,a.descriptor.width,a.descriptor.height):Jc}))}if(i&lr.InvSize){const n=t+JB;r.push(new Wi(n,(s,o)=>{const a=e(s,o);return v(a)?dt(wye,1/a.descriptor.width,1/a.descriptor.height):Jc}))}return r}const wye=Fe(),X$=Ue(parseFloat(Number(5802e-9).toFixed(6)),parseFloat(Number(13558e-9).toFixed(6)),parseFloat(Number(331e-7).toFixed(6))),UH=3,VH=Ue(UH*parseFloat(Number(65e-8).toFixed(6)),UH*parseFloat(Number(1881e-9).toFixed(6)),UH*parseFloat(Number(85e-9).toFixed(6))),N0t=3996e-9,F0t=Ue(parseFloat(Number(X$[0]+VH[0]).toFixed(6)),parseFloat(Number(X$[1]+VH[1]).toFixed(6)),parseFloat(Number(X$[2]+VH[2]).toFixed(6)));function k0t(t){const e=new ji;e.attributes.add(M.POSITION,"vec2"),e.include(iy,{textureCoordinateType:ds.Default}),e.varyings.add("worldRay","vec3"),e.varyings.add("eyeDir","vec3");const{vertex:i,fragment:r}=e;return i.uniforms.add([new on("inverseProjectionMatrix",(n,s)=>s.camera.inverseProjectionMatrix),new on("inverseViewMatrix",(n,s)=>TO(U0t,s.camera.viewMatrix))]),i.code.add(S`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add([new Wi("radii",n=>n.radii),new Jt("cameraPosition",(n,s)=>s.camera.eye),new bi("heightParameters",n=>n.heightParameters),new Ie("innerFadeDistance",n=>n.innerFadeDistance),new Ie("altitudeFade",n=>n.altitudeFade),new Dt("depthTex",n=>n.depthTex),new Ie("hazeStrength",n=>n.hazeStrength)]),r.constants.add("betaRayleigh","vec3",X$),r.constants.add("betaCombined","vec3",F0t),r.constants.add("betaMie","float",N0t),r.constants.add("scaleHeight","float",A0t*bD),H_(r),e.include(ZB),t.haze&&(r.include(ud),r.uniforms.add(new Wi("nearFar",(n,s)=>s.camera.nearFar))),r.code.add(S`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(S`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),r.code.add(S`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),r.code.add(S`
    const int STEPS = 6;

    float getGlow(float dist, float radius, float intensity) {
      return pow(radius / max(dist, 1e-6), intensity);
    }

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${t.haze?S`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${t.haze?S``:" mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * "} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${t.haze?"":S`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${t.haze?S`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:S`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie += getGlow(1.0 - mu, 5e-5, 3.0) * smoothstep(0.01, 0.1, length(scattering));
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
      vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
      if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
        return fragColor;
      }

      float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
      vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
      float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
      if (relDist > 1.0) {
        return surfaceColor;
      }

      return mix(gl_FragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${t.haze?S`
          vec4 depthSample = texture2D(depthTex, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;
            cameraSpaceRay *= -linearDepthFromTexture(depthTex, vuv0, nearFar);
            terrainDepth = max(0.0, length(cameraSpaceRay));
          }`:S`
          float depthSample = texture2D(depthTex, vuv0).r;
          if (depthSample != 1.0) {
            gl_FragColor = vec4(0);
            return;
          }`}

      ${t.haze?S`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            float alpha = 1.0 - fadeOut;`:S`
            vec3 col = getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);;
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}
      col = tonemapACES(col);
      gl_FragColor = delinearizeGamma(vec4(col, alpha));
      ${t.haze?"":S`
          if (depthSample == 1.0) {
            gl_FragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, gl_FragColor);
          }`}
    }
  `),e}const U0t=$e(),V0t=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:X$,build:k0t},Symbol.toStringTag,{value:"Module"}));let Gi=class{constructor(e,i){this._module=e,this._loadModule=i}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}};var Yr,Ft,Ce,yy,Lt,em,WM,ft,Gr,Qn,nt,$t,Ct,Ge,Mt,kt,Bl,zi,Gh,Po,En,Vi;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(Yr||(Yr={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(Ft||(Ft={})),function(t){t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(Ce||(Ce={})),function(t){t[t.ADD=32774]="ADD",t[t.SUBTRACT=32778]="SUBTRACT",t[t.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(yy||(yy={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"}(Lt||(Lt={})),function(t){t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(em||(em={})),function(t){t[t.CW=2304]="CW",t[t.CCW=2305]="CCW"}(WM||(WM={})),function(t){t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT"}(ft||(ft={})),function(t){t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS"}(Gr||(Gr={})),function(t){t[t.ZERO=0]="ZERO",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP"}(Qn||(Qn={})),function(t){t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(nt||(nt={})),function(t){t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}($t||($t={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(Ct||(Ct={})),function(t){t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.RED=6403]="RED",t[t.RG=33319]="RG",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER"}(Ge||(Ge={})),function(t){t[t.RGBA4=32854]="RGBA4",t[t.R16F=33325]="R16F",t[t.RG16F=33327]="RG16F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.R32F=33326]="R32F",t[t.RG32F=33328]="RG32F",t[t.RGBA32F=34836]="RGBA32F",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB5_A1=32855]="RGB5_A1",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.RGB16F=34843]="RGB16F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.RGB565=36194]="RGB565",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2=32857]="RGB10_A2",t[t.RGB10_A2UI=36975]="RGB10_A2UI"}(Mt||(Mt={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.INT=5124]="INT",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(kt||(kt={})),function(t){t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(Bl||(Bl={})),function(t){t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.STATIC_READ=35045]="STATIC_READ",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.STREAM_COPY=35042]="STREAM_COPY"}(zi||(zi={})),function(t){t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER"}(Gh||(Gh={})),function(t){t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(Po||(Po={})),function(t){t[t.TEXTURE=0]="TEXTURE",t[t.RENDER_BUFFER=1]="RENDER_BUFFER",t[t.CUBEMAP=2]="CUBEMAP"}(En||(En={})),function(t){t[t.NONE=0]="NONE",t[t.DEPTH_RENDER_BUFFER=1]="DEPTH_RENDER_BUFFER",t[t.STENCIL_RENDER_BUFFER=2]="STENCIL_RENDER_BUFFER",t[t.DEPTH_STENCIL_RENDER_BUFFER=3]="DEPTH_STENCIL_RENDER_BUFFER",t[t.DEPTH_STENCIL_TEXTURE=4]="DEPTH_STENCIL_TEXTURE"}(Vi||(Vi={}));const zH=33984;var mo,Ih;(function(t){t[t.Texture=0]="Texture",t[t.BufferObject=1]="BufferObject",t[t.VertexArrayObject=2]="VertexArrayObject",t[t.Shader=3]="Shader",t[t.Program=4]="Program",t[t.FramebufferObject=5]="FramebufferObject",t[t.Renderbuffer=6]="Renderbuffer",t[t.Sync=7]="Sync",t[t.COUNT=8]="COUNT"})(mo||(mo={})),function(t){t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(Ih||(Ih={}));const xye=33306;var qn,Ul,Tye,Sye,az,uee,Eye;(function(t){t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(qn||(qn={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT=5124]="INT",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(Ul||(Ul={})),function(t){t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS"}(Tye||(Tye={})),function(t){t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED"}(Sye||(Sye={})),function(t){t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED"}(az||(az={})),function(t){t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(uee||(uee={})),function(t){t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(Eye||(Eye={}));let Yi=class{constructor(e,i,r){this.release=r,this.initializeConfiguration(e,i),this._configuration=i.snapshot(),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}destroy(){this._program=rt(this._program),this._pipeline=this._configuration=null}reload(e){rt(this._program),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}get program(){return this._program}get compiled(){return this.program.compiled}get key(){return this._configuration.key}get configuration(){return this._configuration}bindPipelineState(e,i=null,r){e.setPipelineState(this.getPipelineState(i,r))}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}get primitiveType(){return Ft.TRIANGLES}getPipelineState(e,i){return this._pipeline}initializeConfiguration(e,i){}};const Di=new Map([[M.POSITION,0],[M.NORMAL,1],[M.UV0,2],[M.COLOR,3],[M.SIZE,4],[M.TANGENT,4],[M.AUXPOS1,5],[M.SYMBOLCOLOR,5],[M.AUXPOS2,6],[M.FEATUREATTRIBUTE,6],[M.INSTANCEFEATUREATTRIBUTE,6],[M.INSTANCECOLOR,7],[M.OBJECTANDLAYERIDCOLOR,7],[M.OBJECTANDLAYERIDCOLOR_INSTANCED,7],[M.MODEL,8],[M.MODELNORMAL,12],[M.MODELORIGINHI,11],[M.MODELORIGINLO,15]]),z0t=re.getLogger("esri.views.webgl.checkWebGLError");function B0t(t,e){switch(e){case t.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case t.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case t.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case t.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case t.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case t.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const fDe=!!ue("enable-feature:webgl-debug");function Fh(){return fDe}function hee(){return fDe}function Q1(t){if(Fh()){const e=t.getError();if(e){const i=B0t(t,e),r=new Error().stack;z0t.error(new H("webgl-error","WebGL error occured",{message:i,stack:r}))}}}let Hi=class{constructor(e,i,r){this._context=e,this._locations=r,this._textures=new Map,this._freeTextureUnits=new Wt({deallocator:null}),this._glProgram=e.programCache.acquire(i.generate("vertex"),i.generate("fragment"),r),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=i.generateBind(br.Pass,this),this.bindDraw=i.generateBind(br.Draw,this),this._fragmentUniforms=Fh()?i.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get compiled(){return this._glProgram.compiled}setUniform1b(e,i){this._glProgram.setUniform1i(e,i?1:0)}setUniform1i(e,i){this._glProgram.setUniform1i(e,i)}setUniform1f(e,i){this._glProgram.setUniform1f(e,i)}setUniform2fv(e,i){this._glProgram.setUniform2fv(e,i)}setUniform3fv(e,i){this._glProgram.setUniform3fv(e,i)}setUniform4fv(e,i){this._glProgram.setUniform4fv(e,i)}setUniformMatrix3fv(e,i){this._glProgram.setUniformMatrix3fv(e,i)}setUniformMatrix4fv(e,i){this._glProgram.setUniformMatrix4fv(e,i)}setUniform1fv(e,i){this._glProgram.setUniform1fv(e,i)}setUniform1iv(e,i){this._glProgram.setUniform1iv(e,i)}setUniform2iv(e,i){this._glProgram.setUniform3iv(e,i)}setUniform3iv(e,i){this._glProgram.setUniform3iv(e,i)}setUniform4iv(e,i){this._glProgram.setUniform4iv(e,i)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,i){if(R(i)||i.glName==null){const n=this._textures.get(e);return n&&(this._context.bindTexture(null,n.unit),this._freeTextureUnit(n),this._textures.delete(e)),null}let r=this._textures.get(e);return r==null?(r=this._allocTextureUnit(i),this._textures.set(e,r)):r.texture=i,this._context.useProgram(this),this.setUniform1i(e,r.unit),this._context.bindTexture(i,r.unit),r.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach((e,i)=>{this._context.bindTexture(e.texture,e.unit),this.setUniform1i(i,e.unit)}),v(this._fragmentUniforms)&&this._fragmentUniforms.forEach(e=>{e.type!=="sampler2D"&&e.type!=="samplerCube"||this._textures.has(e.name)||console.error(`Texture sampler ${e.name} has no bound texture`)})}_allocTextureUnit(e){return{texture:e,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}};var Dr,b2,Wn,u_,Wc,$_,jb,XM,_r,w2,j0;(function(t){t[t.None=0]="None",t[t.Front=1]="Front",t[t.Back=2]="Back",t[t.COUNT=3]="COUNT"})(Dr||(Dr={})),function(t){t[t.Less=0]="Less",t[t.Lequal=1]="Lequal",t[t.COUNT=2]="COUNT"}(b2||(b2={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.UPDATE=1]="UPDATE"}(Wn||(Wn={})),function(t){t[t.NOT_LOADED=0]="NOT_LOADED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED"}(u_||(u_={})),function(t){t[t.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",t[t.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(Wc||(Wc={})),function(t){t[t.Highlight=0]="Highlight",t[t.MaskOccludee=1]="MaskOccludee",t[t.COUNT=2]="COUNT"}($_||($_={})),function(t){t[t.STRETCH=1]="STRETCH",t[t.PAD=2]="PAD"}(jb||(jb={})),function(t){t[t.CHANGED=0]="CHANGED",t[t.UNCHANGED=1]="UNCHANGED"}(XM||(XM={})),function(t){t[t.Blend=0]="Blend",t[t.Opaque=1]="Opaque",t[t.Mask=2]="Mask",t[t.MaskBlend=3]="MaskBlend",t[t.COUNT=4]="COUNT"}(_r||(_r={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(w2||(w2={})),function(t){t.DDS_ENCODING="image/vnd-ms.dds",t.KTX2_ENCODING="image/ktx2",t.BASIS_ENCODING="image/x.basis"}(j0||(j0={}));function Am(t,e,i=yy.ADD,r=[0,0,0,0]){return{srcRgb:t,srcAlpha:t,dstRgb:e,dstAlpha:e,opRgb:i,opAlpha:i,color:{r:r[0],g:r[1],b:r[2],a:r[3]}}}function _o(t,e,i,r,n=yy.ADD,s=yy.ADD,o=[0,0,0,0]){return{srcRgb:t,srcAlpha:e,dstRgb:i,dstAlpha:r,opRgb:n,opAlpha:s,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const $ae={face:em.BACK,mode:WM.CCW},mDe={face:em.FRONT,mode:WM.CCW},KB=t=>t===Dr.Back?$ae:t===Dr.Front?mDe:null,Kc={zNear:0,zFar:1},si={r:!0,g:!0,b:!0,a:!0};function j0t(t){return J0t.intern(t)}function G0t(t){return K0t.intern(t)}function H0t(t){return Q0t.intern(t)}function q0t(t){return e_t.intern(t)}function W0t(t){return t_t.intern(t)}function X0t(t){return i_t.intern(t)}function Y0t(t){return r_t.intern(t)}function Z0t(t){return n_t.intern(t)}function Ht(t){return s_t.intern(t)}let q_=class{constructor(e,i){this._makeKey=e,this._makeRef=i,this._interns=new Map}intern(e){if(!e)return null;const i=this._makeKey(e),r=this._interns;return r.has(i)||r.set(i,this._makeRef(e)),r.get(i)??null}};function W_(t){return"["+t.join(",")+"]"}const J0t=new q_(gDe,t=>({__tag:"Blending",...t}));function gDe(t){return t?W_([t.srcRgb,t.srcAlpha,t.dstRgb,t.dstAlpha,t.opRgb,t.opAlpha,t.color.r,t.color.g,t.color.b,t.color.a]):null}const K0t=new q_(yDe,t=>({__tag:"Culling",...t}));function yDe(t){return t?W_([t.face,t.mode]):null}const Q0t=new q_(_De,t=>({__tag:"PolygonOffset",...t}));function _De(t){return t?W_([t.factor,t.units]):null}const e_t=new q_(vDe,t=>({__tag:"DepthTest",...t}));function vDe(t){return t?W_([t.func]):null}const t_t=new q_(bDe,t=>({__tag:"StencilTest",...t}));function bDe(t){return t?W_([t.function.func,t.function.ref,t.function.mask,t.operation.fail,t.operation.zFail,t.operation.zPass]):null}const i_t=new q_(wDe,t=>({__tag:"DepthWrite",...t}));function wDe(t){return t?W_([t.zNear,t.zFar]):null}const r_t=new q_(xDe,t=>({__tag:"ColorWrite",...t}));function xDe(t){return t?W_([t.r,t.g,t.b,t.a]):null}const n_t=new q_(TDe,t=>({__tag:"StencilWrite",...t}));function TDe(t){return t?W_([t.mask]):null}const s_t=new q_(o_t,t=>({blending:j0t(t.blending),culling:G0t(t.culling),polygonOffset:H0t(t.polygonOffset),depthTest:q0t(t.depthTest),stencilTest:W0t(t.stencilTest),depthWrite:X0t(t.depthWrite),colorWrite:Y0t(t.colorWrite),stencilWrite:Z0t(t.stencilWrite)}));function o_t(t){return t?W_([gDe(t.blending),yDe(t.culling),_De(t.polygonOffset),vDe(t.depthTest),bDe(t.stencilTest),wDe(t.depthWrite),xDe(t.colorWrite),TDe(t.stencilWrite)]):null}let a_t=class{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setSubState(e,i,r,n){return(r||e!==i)&&(n(e),this._pipelineInvalid=!0),e}},l_t=class extends Tr{constructor(){super(...arguments),this.heightParameters=pi(),this.radii=Fe(),this.innerFadeDistance=0,this.altitudeFade=0,this.hazeStrength=1}},dee=class SDe extends Yi{initializeProgram(e){return new Hi(e.rctx,SDe.shader.get().build(this.configuration),Di)}initializePipeline(){return this.configuration.haze?Ht({blending:_o(Ce.ONE,Ce.ZERO,Ce.ONE_MINUS_SRC_COLOR,Ce.ONE),colorWrite:si}):Ht({blending:_o(Ce.SRC_ALPHA,Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA,Ce.ONE_MINUS_SRC_ALPHA),depthTest:{func:Gr.LEQUAL},colorWrite:si})}};dee.shader=new Gi(V0t,()=>Q(()=>import("./ChapmanAtmosphere.glsl-d3ad6802.js"),[]));let wl=class extends Tr{constructor(){super(),this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const e=this._parameterNames,i={key:this.key};for(const r of e)i[r]=this[r];return i}};function j(t={}){return(e,i)=>{if(e._parameterNames=e._parameterNames??[],e._parameterNames.push(i),t.constValue!=null)Object.defineProperty(e,i,{get:()=>t.constValue});else{const r=e._parameterNames.length-1,n=t.count||2,s=Math.ceil(Math.log2(n)),o=e._parameterBits??[0];let a=0;for(;o[a]+s>16;)a++,a>=o.length&&o.push(0);e._parameterBits=o;const l=o[a],c=(1<<s)-1<<l;o[a]+=s,Object.defineProperty(e,i,{get(){return this[r]},set(h){if(this[r]!==h&&(this[r]=h,this._keyDirty=!0,this._parameterBits[a]=this._parameterBits[a]&~c|+h<<l&c,typeof h!="number"&&typeof h!="boolean"))throw new Error("Configuration value for "+i+" must be boolean or number, got "+typeof h)}})}}}let EDe=class extends wl{constructor(){super(...arguments),this.haze=!1}};u([j()],EDe.prototype,"haze",void 0);let xa=class{constructor(e,i,r,n,s,o=!1,a=0){this.name=e,this.count=i,this.type=r,this.offset=n,this.stride=s,this.normalized=o,this.divisor=a}};new xa(M.POSITION,3,ft.FLOAT,0,12);new xa(M.POSITION,3,ft.FLOAT,0,20),new xa(M.UV0,2,ft.FLOAT,12,20);new xa(M.POSITION,3,ft.FLOAT,0,32),new xa(M.NORMAL,3,ft.FLOAT,12,32),new xa(M.UV0,2,ft.FLOAT,24,32);new xa(M.POSITION,3,ft.FLOAT,0,16),new xa(M.COLOR,4,ft.UNSIGNED_BYTE,12,16);const Lae=[new xa(M.POSITION,2,ft.FLOAT,0,8)],kO=[new xa(M.POSITION,2,ft.FLOAT,0,16),new xa(M.UV0,2,ft.FLOAT,8,16)];function Cye(t){const e=t.gl;switch(e.getError()){case e.NO_ERROR:return null;case e.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case e.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case e.INVALID_OPERATION:return"The specified command is not allowed for the current state";case e.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case e.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case e.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function Ua(t,e){return t.vertexBuffers[e].size/c_t(t.layout[e])}function c_t(t){return t[0].stride}function Dae(t,e,i,r,n=0){const s=t.gl,o=t.capabilities.instancing;t.bindBuffer(i);for(const a of r){const l=e.get(a.name);l===void 0&&console.error(`There is no location for vertex attribute '${a.name}' defined.`);const c=n*a.stride;if(a.count<=4)s.vertexAttribPointer(l,a.count,a.type,a.normalized,a.stride,a.offset+c),s.enableVertexAttribArray(l),a.divisor>0&&o&&o.vertexAttribDivisor(l,a.divisor);else if(a.count===9)for(let h=0;h<3;h++)s.vertexAttribPointer(l+h,3,a.type,a.normalized,a.stride,a.offset+12*h+c),s.enableVertexAttribArray(l+h),a.divisor>0&&o&&o.vertexAttribDivisor(l+h,a.divisor);else if(a.count===16)for(let h=0;h<4;h++)s.vertexAttribPointer(l+h,4,a.type,a.normalized,a.stride,a.offset+16*h+c),s.enableVertexAttribArray(l+h),a.divisor>0&&o&&o.vertexAttribDivisor(l+h,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count)}}function Nae(t,e,i,r){const n=t.gl,s=t.capabilities.instancing;t.bindBuffer(i);for(const o of r){const a=e.get(o.name);if(o.count<=4)n.disableVertexAttribArray(a),o.divisor&&o.divisor>0&&s&&s.vertexAttribDivisor(a,0);else if(o.count===9)for(let l=0;l<3;l++)n.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&s&&s.vertexAttribDivisor(a+l,0);else if(o.count===16)for(let l=0;l<4;l++)n.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&s&&s.vertexAttribDivisor(a+l,0);else console.error("Unsupported vertex attribute element count: "+o.count)}t.unbindBuffer(Lt.ARRAY_BUFFER)}function CDe(t){switch(t){case Ge.ALPHA:case Ge.LUMINANCE:case Ge.RED:case Ge.RED_INTEGER:case Mt.R8:case Mt.R8I:case Mt.R8UI:case Mt.R8_SNORM:case Bl.STENCIL_INDEX8:return 1;case Ge.LUMINANCE_ALPHA:case Ge.RG:case Ge.RG_INTEGER:case Mt.RGBA4:case Mt.R16F:case Mt.R16I:case Mt.R16UI:case Mt.RG8:case Mt.RG8I:case Mt.RG8UI:case Mt.RG8_SNORM:case Mt.RGB565:case Mt.RGB5_A1:case Bl.DEPTH_COMPONENT16:return 2;case Ge.DEPTH_COMPONENT:case Ge.RGB:case Ge.RGB_INTEGER:case Mt.RGB8:case Mt.RGB8I:case Mt.RGB8UI:case Mt.RGB8_SNORM:case Mt.SRGB8:case Bl.DEPTH_COMPONENT24:return 3;case Ge.DEPTH_STENCIL:case Ge.RGBA:case Ge.RGBA_INTEGER:case Mt.RGBA8:case Mt.R32F:case Mt.R11F_G11F_B10F:case Mt.RG16F:case Mt.R32I:case Mt.R32UI:case Mt.RG16I:case Mt.RG16UI:case Mt.RGBA8I:case Mt.RGBA8UI:case Mt.RGBA8_SNORM:case Mt.SRGB8_ALPHA8:case Mt.RGB9_E5:case Mt.RGB10_A2UI:case Mt.RGB10_A2:case Bl.DEPTH_STENCIL:case Bl.DEPTH_COMPONENT32F:case Bl.DEPTH24_STENCIL8:return 4;case Bl.DEPTH32F_STENCIL8:return 5;case Mt.RGB16F:case Mt.RGB16I:case Mt.RGB16UI:return 6;case Mt.RG32F:case Mt.RG32I:case Mt.RG32UI:case Mt.RGBA16F:case Mt.RGBA16I:case Mt.RGBA16UI:return 8;case Mt.RGB32F:case Mt.RGB32I:case Mt.RGB32UI:return 12;case Mt.RGBA32F:case Mt.RGBA32I:case Mt.RGBA32UI:return 16;case qn.COMPRESSED_RGB_S3TC_DXT1_EXT:case qn.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case qn.COMPRESSED_RGBA_S3TC_DXT3_EXT:case qn.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case qn.COMPRESSED_R11_EAC:case qn.COMPRESSED_SIGNED_R11_EAC:case qn.COMPRESSED_RGB8_ETC2:case qn.COMPRESSED_SRGB8_ETC2:case qn.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case qn.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case qn.COMPRESSED_RG11_EAC:case qn.COMPRESSED_SIGNED_RG11_EAC:case qn.COMPRESSED_RGBA8_ETC2_EAC:case qn.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}function x2(t){if(R(t))return 0;if("descriptor"in t)return t.glName?x2(t.descriptor):0;const e=t.internalFormat||"pixelFormat"in t&&t.pixelFormat;if(!e)return 0;const i="hasMipmap"in t&&t.hasMipmap?1.3:1,r=t.width*t.height;return CDe(e)*r*i}const sx=re.getLogger("esri.views.webgl.VertexArrayObject");let Np=class{constructor(e,i,r,n,s=null){this._context=e,this._locations=i,this._layout=r,this._buffers=n,this._indexBuffer=s,this._glName=null,this._initialized=!1,e.instanceCounter.increment(mo.VertexArrayObject,this)}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get size(){return Object.keys(this._buffers).reduce((e,i)=>e+this._buffers[i].size,v(this._indexBuffer)?this._indexBuffer.size:0)}get layout(){return this._layout}get locations(){return this._locations}dispose(e=!0){var i,r,n;if(!this._context)return void((this._glName||e&&Object.getOwnPropertyNames(this._buffers).length>0)&&sx.warn("Leaked WebGL VAO"));if(this._glName){const s=(r=(i=this._context)==null?void 0:i.capabilities)==null?void 0:r.vao;s?(s.deleteVertexArray(this._glName),this._glName=null):sx.warn("Leaked WebGL VAO")}if(this._context.getBoundVAO()===this&&this._context.bindVAO(null),e){for(const s in this._buffers)(n=this._buffers[s])==null||n.dispose(),delete this._buffers[s];this._indexBuffer=rt(this._indexBuffer)}this._context.instanceCounter.decrement(mo.VertexArrayObject,this),this._context=e2(this._context)}initialize(){if(this._initialized)return;const e=this._context.capabilities.vao;if(e){const i=e.createVertexArray();e.bindVertexArray(i),this._bindLayout(),e.bindVertexArray(null),this._glName=i}this._initialized=!0}bind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:e,_layout:i,_indexBuffer:r}=this;e||sx.error("Vertex buffer dictionary is empty!");const n=this._context.gl;for(const s in e){const o=e[s];o||sx.error("Vertex buffer is uninitialized!");const a=i[s];a||sx.error("Vertex element descriptor is empty!"),Dae(this._context,this._locations,o,a)}v(r)&&(this._context.capabilities.vao?n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,r.glName):this._context.bindBuffer(r))}unbind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:e,_layout:i}=this;e||sx.error("Vertex buffer dictionary is empty!");for(const r in e){const n=e[r];n||sx.error("Vertex buffer is uninitialized!");const s=i[r];Nae(this._context,this._locations,n,s)}v(this._indexBuffer)&&this._context.unbindBuffer(this._indexBuffer.bufferType)}},Rm=class extends Np{};const Nm=re.getLogger("esri.views.webgl.BufferObject");let er=class fA{static createIndex(e,i,r){return new fA(e,Lt.ELEMENT_ARRAY_BUFFER,i,r)}static createVertex(e,i,r){return new fA(e,Lt.ARRAY_BUFFER,i,r)}static createUniform(e,i,r){if(e.type!==Et.WEBGL2)throw new Error("Uniform buffers are supported in WebGL2 only!");return new fA(e,Lt.UNIFORM_BUFFER,i,r)}static createPixelPack(e,i=zi.STREAM_READ,r){if(e.type!==Et.WEBGL2)throw new Error("Pixel pack buffers are supported in WebGL2 only!");const n=new fA(e,Lt.PIXEL_PACK_BUFFER,i);return r&&n.setSize(r),n}static createPixelUnpack(e,i=zi.STREAM_DRAW,r){if(e.type!==Et.WEBGL2)throw new Error("Pixel unpack buffers are supported in WebGL2 only!");return new fA(e,Lt.PIXEL_UNPACK_BUFFER,i,r)}constructor(e,i,r,n){this._context=e,this.bufferType=i,this.usage=r,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(mo.BufferObject,this),this._glName=this._context.gl.createBuffer(),Q1(this._context.gl),n&&this.setData(n)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteSize(){return this.bufferType===Lt.ELEMENT_ARRAY_BUFFER?this._indexType===ft.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===Lt.ELEMENT_ARRAY_BUFFER||this.bufferType===Lt.ARRAY_BUFFER}dispose(){var e;(e=this._context)!=null&&e.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(mo.BufferObject,this),this._context=e2(this._context)):this._glName&&Nm.warn("Leaked WebGL buffer object")}setSize(e,i=null){if(e<=0&&Nm.error("Buffer size needs to be positive!"),this.bufferType===Lt.ELEMENT_ARRAY_BUFFER&&v(i))switch(this._indexType=i,i){case ft.UNSIGNED_SHORT:e*=2;break;case ft.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let i=e.byteLength;this.bufferType===Lt.ELEMENT_ARRAY_BUFFER&&(Vre(e)&&(i/=2,this._indexType=ft.UNSIGNED_SHORT),zre(e)&&(i/=4,this._indexType=ft.UNSIGNED_INT)),this._setBufferData(i,e)}_setBufferData(e,i=null){this._size=e;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const n=this._context.gl;v(i)?n.bufferData(this.bufferType,i,this.usage):n.bufferData(this.bufferType,e,this.usage),Q1(n),this._isVAOAware&&this._context.bindVAO(r)}setSubData(e,i,r,n){if(!e)return;(i<0||i*e.BYTES_PER_ELEMENT>=this.byteSize)&&Nm.error("offset is out of range!"),r>=n&&Nm.error("end must be bigger than start!"),(i+(n-r))*e.BYTES_PER_ELEMENT>this.byteSize&&Nm.error("An attempt to write beyond the end of the buffer!");const s=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const o=this._context.gl;if(this._context.type===Et.WEBGL2)o.bufferSubData(this.bufferType,i*e.BYTES_PER_ELEMENT,e,r,n-r);else{const a=r===0&&n===e.length?e:e.subarray(r,n);o.bufferSubData(this.bufferType,i*e.BYTES_PER_ELEMENT,a)}Q1(o),this._isVAOAware&&this._context.bindVAO(s)}getSubData(e,i=0,r,n){if(this._context.type!==Et.WEBGL2)return void Nm.error("Get buffer subdata is supported in WebGL2 only!");if(r<0||n<0)return void Nm.error("Problem getting subdata: offset and length were less than zero!");const s=u_t(e)?e.BYTES_PER_ELEMENT:1;if(s*((r??0)+(n??0))>e.byteLength)return void Nm.error("Problem getting subdata: offset and length exceeded destination size!");i+s*(n??0)>this.byteSize&&Nm.warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this._context.bindBuffer(this,Lt.COPY_READ_BUFFER),o.getBufferSubData(Lt.COPY_READ_BUFFER,i,e,r,n),this._context.unbindBuffer(Lt.COPY_READ_BUFFER)}async getSubDataAsync(e,i=0,r,n){this._context.type===Et.WEBGL2?(await this._context.clientWaitAsync(),this.getSubData(e,i,r,n)):Nm.error("Get buffer subdata is supported in WebGL2 only!")}};function u_t(t){return e7e(t)}const BH={target:Ct.TEXTURE_2D,samplingMode:nt.LINEAR,wrapMode:$t.REPEAT,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,isImmutable:!1},Aye=4;let mt=class{constructor(e,i,r=null){this._context=e,this.type="texture",this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,e.instanceCounter.increment(mo.Texture,this),this._descriptor={...BH,...i};for(const n in BH)this._descriptor[n]===void 0&&(this._descriptor[n]=BH[n]);if(e.type!==Et.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),ox(this._descriptor.target)))throw new Error("3D and array textures are not supported in WebGL1");this._descriptor.target===Ct.TEXTURE_CUBE_MAP?this._setDataCubeMap(r):this.setData(r)}get glName(){return this._glName}get descriptor(){return this._descriptor}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._context.gl&&this._glName&&(this._context.unbindTexture(this),this._context.gl.deleteTexture(this._glName),this._glName=null,this._context.instanceCounter.decrement(mo.Texture,this))}release(){this.dispose()}resize(e,i){const r=this._descriptor;if(r.width!==e||r.height!==i){if(this._wasImmutablyAllocated)throw new Error("Immutable textures can't be resized!");r.width=e,r.height=i,this._descriptor.target===Ct.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(e=null){for(let i=Ct.TEXTURE_CUBE_MAP_POSITIVE_X;i<=Ct.TEXTURE_CUBE_MAP_NEGATIVE_Z;i++)this._setData(e,i)}setData(e){this._setData(e)}_setData(e,i){if(!this._context||!this._context.gl)return;const r=this._context.gl;this._glName||(this._glName=r.createTexture()),e===void 0&&(e=null);const n=this._descriptor,s=i??n.target,o=ox(s);e===null&&(n.width=n.width||Aye,n.height=n.height||Aye,o&&(n.depth=n.depth??1));const a=this._context.bindTexture(this,mt.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(mt.TEXTURE_UNIT_FOR_UPDATES),mt._validateTexture(this._context,n),this._configurePixelStorage(),Q1(r);const l=n.pixelFormat;let c=n.internalFormat??this._deriveInternalFormat(l,n.dataType);if(jH(e)){let h=e.width,p=e.height;const f=1;e instanceof HTMLVideoElement&&(h=e.videoWidth,p=e.videoHeight),n.width&&n.height,o&&n.depth,n.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(s,c,n.hasMipmap,h,p,f),this._texImage(s,0,c,h,p,f,e),Q1(r),n.hasMipmap&&this.generateMipmap(),n.width===void 0&&(n.width=h),n.height===void 0&&(n.height=p),o&&n.depth===void 0&&(n.depth=f)}else{const{width:h,height:p,depth:f}=n;if(h==null||p==null)throw new Error("Width and height must be specified!");if(o&&f==null)throw new Error("Depth must be specified!");if(n.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(s,c,n.hasMipmap,h,p,f),r.DEPTH24_STENCIL8&&c===r.DEPTH_STENCIL&&(c=r.DEPTH24_STENCIL8),RU(e)){const m=e.levels,g=Rye(s,h,p,f),_=Math.min(g-1,m.length-1);v(this._context.gl2)?r.texParameteri(n.target,this._context.gl2.TEXTURE_MAX_LEVEL,_):n.hasMipmap=n.hasMipmap&&g===m.length;const b=c;if(!d_t(b))throw new Error("Attempting to use compressed data with an umcompressed format!");this._forEachMipmapLevel((w,x,T,E)=>{const C=m[Math.min(w,m.length-1)];this._compressedTexImage(s,w,b,x,T,E,C)},_)}else v(e)?(this._texImage(s,0,c,h,p,f,e),Q1(r),n.hasMipmap&&this.generateMipmap()):this._forEachMipmapLevel((m,g,_,b)=>{this._texImage(s,m,c,g,_,b,null),Q1(r)})}mt._applySamplingMode(r,this._descriptor),mt._applyWrapMode(r,this._descriptor),mt._applyAnisotropicFilteringParameters(this._context,this._descriptor),Q1(r),this._context.bindTexture(a,mt.TEXTURE_UNIT_FOR_UPDATES)}updateData(e,i,r,n,s,o,a=0){o||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const l=this._context.gl,c=this._descriptor,{pixelFormat:h,dataType:p,target:f,isImmutable:m}=c,g=c.internalFormat??this._deriveInternalFormat(h,p);if(m&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");const _=this._context.bindTexture(this,mt.TEXTURE_UNIT_FOR_UPDATES,!0);if((i<0||r<0||n>c.width||s>c.height||i+n>c.width||r+s>c.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),a){if(R(this._context.gl2))return void console.error("Webgl2 must be enabled to use dataRowOffset!");l.pixelStorei(this._context.gl2.UNPACK_SKIP_ROWS,a)}if(jH(o)?v(this._context.gl2)?this._context.gl2.texSubImage2D(f,e,i,r,n,s,h,p,o):l.texSubImage2D(f,e,i,r,h,p,o):RU(o)?l.compressedTexSubImage2D(f,e,i,r,n,s,g,o.levels[e]):l.texSubImage2D(f,e,i,r,n,s,h,p,o),a){if(R(this._context.gl2))return void console.error("Webgl2 must be enabled to use dataRowOffset!");l.pixelStorei(this._context.gl2.UNPACK_SKIP_ROWS,0)}this._context.bindTexture(_,mt.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(e,i,r,n,s,o,a,l){l||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._context.gl2;if(R(c))throw new Error("3D textures are not supported in WebGL1");const h=this._descriptor,{pixelFormat:p,dataType:f,isImmutable:m,target:g}=h,_=h.internalFormat??this._deriveInternalFormat(p,f);if(m&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");ox(g)||console.warn("Attempting to set 3D texture data on a non-3D texture");const b=this._context.bindTexture(this,mt.TEXTURE_UNIT_FOR_UPDATES);if(this._context.setActiveTexture(mt.TEXTURE_UNIT_FOR_UPDATES),(i<0||r<0||n<0||s>h.width||o>h.height||a>h.depth||i+s>h.width||r+o>h.height||n+a>h.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),RU(l))l=l.levels[e],c.compressedTexSubImage3D(g,e,i,r,n,s,o,a,_,l);else{const w=l;c.texSubImage3D(g,e,i,r,n,s,o,a,p,f,w)}this._context.bindTexture(b,mt.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;if(!e.hasMipmap){if(this._wasImmutablyAllocated)throw new Error("Cannot add mipmaps to immutable texture after allocation");e.hasMipmap=!0,this._samplingModeDirty=!0,mt._validateTexture(this._context,e)}e.samplingMode===nt.LINEAR?(this._samplingModeDirty=!0,e.samplingMode=nt.LINEAR_MIPMAP_NEAREST):e.samplingMode===nt.NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=nt.NEAREST_MIPMAP_NEAREST);const i=this._context.bindTexture(this,mt.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(mt.TEXTURE_UNIT_FOR_UPDATES),this._context.gl.generateMipmap(e.target),this._context.bindTexture(i,mt.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,mt._validateTexture(this._context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._context.gl,i=this._descriptor;this._samplingModeDirty&&(mt._applySamplingMode(e,i),this._samplingModeDirty=!1),this._wrapModeDirty&&(mt._applyWrapMode(e,i),this._wrapModeDirty=!1)}_deriveInternalFormat(e,i){if(this._context.type===Et.WEBGL1)return e;switch(i){case kt.FLOAT:switch(e){case Ge.RGBA:return Mt.RGBA32F;case Ge.RGB:return Mt.RGB32F;default:throw new Error("Unable to derive format")}case kt.UNSIGNED_BYTE:switch(e){case Ge.RGBA:return Mt.RGBA8;case Ge.RGB:return Mt.RGB8}default:return e}}_configurePixelStorage(){const e=this._context.gl,{unpackAlignment:i,flipped:r,preMultiplyAlpha:n}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,i),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n?1:0)}_texStorage(e,i,r,n,s,o){const a=this._context.gl2;if(R(a))throw new Error("Immutable textures are not supported in WebGL1");if(!h_t(i))throw new Error("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=r?Rye(e,n,s,o):1;if(ox(e)){if(o==null)throw new Error("Missing depth dimension for 3D texture upload");a.texStorage3D(e,l,i,n,s,o)}else a.texStorage2D(e,l,i,n,s);this._wasImmutablyAllocated=!0}_texImage(e,i,r,n,s,o,a){const l=this._context.gl;let c=null;const h=this._context.type===Et.WEBGL2,p=ox(e),{isImmutable:f,pixelFormat:m,dataType:g}=this._descriptor;if(h&&(c=l),h||!jH(a))if(f){if(v(a)){const _=a;if(p){if(o==null)throw new Error("Missing depth dimension for 3D texture upload");c.texSubImage3D(e,i,0,0,0,n,s,o,m,g,_)}else l.texSubImage2D(e,i,0,0,n,s,m,g,_)}}else{const _=a;if(p){if(o==null)throw new Error("Missing depth dimension for 3D texture upload");c.texImage3D(e,i,r,n,s,o,0,m,g,_)}else l.texImage2D(e,i,r,n,s,0,m,g,_)}else l.texImage2D(e,0,r,m,g,a)}_compressedTexImage(e,i,r,n,s,o,a){const l=this._context.gl;let c=null;const h=ox(e),p=this._descriptor.isImmutable;if(h){if(this._context.type!==Et.WEBGL2)throw new Error("3D textures are not supported in WebGL1");c=l}if(p){if(v(a))if(h){if(o==null)throw new Error("Missing depth dimension for 3D texture upload");c.compressedTexSubImage3D(e,i,0,0,0,n,s,o,r,a)}else l.compressedTexSubImage2D(e,i,0,0,n,s,r,a)}else if(h){if(o==null)throw new Error("Missing depth dimension for 3D texture upload");c.compressedTexImage3D(e,i,r,n,s,o,0,a)}else l.compressedTexImage2D(e,i,r,n,s,0,a)}_forEachMipmapLevel(e,i=1/0){let{width:r,height:n,depth:s,hasMipmap:o,target:a}=this._descriptor;const l=a===Ct.TEXTURE_3D;if(r==null||n==null||l&&s==null)throw new Error("Missing texture dimensions for mipmap calculation");for(let c=0;e(c,r,n,s),o&&(r!==1||n!==1||l&&s!==1)&&!(c>=i);++c)r=Math.max(1,r>>1),n=Math.max(1,n>>1),l&&(s=Math.max(1,s>>1))}static _validateTexture(e,i){(i.width!=null&&i.width<0||i.height!=null&&i.height<0||i.depth!=null&&i.depth<0)&&console.error("Negative dimension parameters are not allowed!");const r=e.type===Et.WEBGL2,n=i.width!=null&&mm(i.width)&&i.height!=null&&mm(i.height);r||!i.isImmutable&&!ox(i.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!"),r||n||(typeof i.wrapMode=="number"?i.wrapMode!==$t.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):i.wrapMode.s===$t.CLAMP_TO_EDGE&&i.wrapMode.t===$t.CLAMP_TO_EDGE||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),i.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))}static _applySamplingMode(e,i){let r=i.samplingMode,n=i.samplingMode;r===nt.LINEAR_MIPMAP_NEAREST||r===nt.LINEAR_MIPMAP_LINEAR?(r=nt.LINEAR,i.hasMipmap||(n=nt.LINEAR)):r!==nt.NEAREST_MIPMAP_NEAREST&&r!==nt.NEAREST_MIPMAP_LINEAR||(r=nt.NEAREST,i.hasMipmap||(n=nt.NEAREST)),e.texParameteri(i.target,e.TEXTURE_MAG_FILTER,r),e.texParameteri(i.target,e.TEXTURE_MIN_FILTER,n)}static _applyWrapMode(e,i){typeof i.wrapMode=="number"?(e.texParameteri(i.target,e.TEXTURE_WRAP_S,i.wrapMode),e.texParameteri(i.target,e.TEXTURE_WRAP_T,i.wrapMode)):(e.texParameteri(i.target,e.TEXTURE_WRAP_S,i.wrapMode.s),e.texParameteri(i.target,e.TEXTURE_WRAP_T,i.wrapMode.t))}static _applyAnisotropicFilteringParameters(e,i){const r=e.capabilities.textureFilterAnisotropic;r&&e.gl.texParameterf(i.target,r.TEXTURE_MAX_ANISOTROPY,i.maxAnisotropy??1)}};function h_t(t){return t in Mt}function d_t(t){return t in qn}function RU(t){return v(t)&&"type"in t&&t.type==="compressed"}function p_t(t){return v(t)&&"byteLength"in t}function jH(t){return v(t)&&!RU(t)&&!p_t(t)}function ox(t){return t===Ct.TEXTURE_3D||t===Ct.TEXTURE_2D_ARRAY}function Rye(t,e,i,r=1){let n=Math.max(e,i);return t===Ct.TEXTURE_3D&&(n=Math.max(n,r)),Math.round(Math.log(n)/Math.LN2)+1}mt.TEXTURE_UNIT_FOR_UPDATES=0;function xl(t,e=Lae,i=Di,r=-1,n=1){let s=null;return e===kO?s=new Float32Array([r,r,0,0,n,r,1,0,r,n,0,1,n,n,1,1]):s=new Float32Array([r,r,n,r,r,n,n,n]),new Rm(t,i,{geometry:e},{geometry:er.createVertex(t,zi.STATIC_DRAW,s)})}function f_t(t,e=Lae,i=Di){const r=new Float32Array([-1,-1,3,-1,-1,3]);return new Rm(t,i,{geometry:e},{geometry:er.createVertex(t,zi.STATIC_DRAW,r)})}const ADe=4;function RDe(t,e=ADe){return new mt(t,{target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:nt.NEAREST,width:e,height:e})}function m_t(t,e,i=ADe){const r=new Uint8Array(i*i*4);for(let n=0;n<r.length;n+=4)r[n+0]=255*e[0],r[n+1]=255*e[1],r[n+2]=255*e[2],r[n+3]=255*e[3];return new mt(t,{target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:nt.NEAREST,width:i,height:i},r)}function MDe(t){return new mt(t,{target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:nt.NEAREST,width:1,height:1},new Uint8Array([255,255,255,255]))}let GH=class{constructor(e,i){this._view=e,this.type=so.Realistic,this._handles=new Xi,this._passParameters=new l_t,this._rootTileElevationMin=NaN,this._lowerBoundEarthRadius=Ci.radius,this._fadeHaze=0,this._updateRadius(Ci.radius);const r=i.renderContext.rctx;this._updateRootTileElevationBounds(),this._handles.add([ne(()=>this._view.basemapTerrain.rootTileElevationBounds,()=>this._updateRootTileElevationBounds()),ne(()=>this._view.basemapTerrain.visibleElevationBounds,()=>this._updateVisibleElevationBounds())]);const n=new EDe;n.haze=!1,this._atmosphereTechnique=i.techniqueRepository.acquire(dee,n),n.haze=!0,this._atmosphereHazeTechnique=i.techniqueRepository.acquire(dee,n),this._vao=xl(r,kO)}destroy(){this._atmosphereTechnique.release(),this._atmosphereHazeTechnique.release(),this._vao.dispose(),this._handles.destroy()}render(e){this._render(e,this._atmosphereTechnique,e.offscreenRenderingHelper.depthTexture)}renderHaze(e,i){this._fadeHaze=i,this._render(e,this._atmosphereHazeTechnique,e.offscreenRenderingHelper.linearDepthTexture)}_render(e,i,r){if(R(r))return;this._update(e.bindParameters.camera),this._passParameters.depthTex=r;const n=e.rctx.bindTechnique(i,this._passParameters,e.bindParameters);e.offscreenRenderingHelper.renderDepthDetached(()=>this._renderCommon(n,e))}_renderCommon(e,i){R(this._vao)||(i.rctx.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.rctx.drawArrays(Ft.TRIANGLE_STRIP,0,4))}_adjustRadiusForTesselation(e){return e*Math.cos(Math.PI/16/16)}_updateRootTileElevationBounds(){const e=this._view.basemapTerrain.rootTileElevationBounds.min;e!==this._rootTileElevationMin&&(this._rootTileElevationMin=e,this._lowerBoundEarthRadius=Ci.radius,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const e=this._adjustRadiusForTesselation(Ci.radius+this._view.basemapTerrain.visibleElevationBounds.min);e<this._lowerBoundEarthRadius&&this._updateRadius(e)}_updateRadius(e){this._lowerBoundEarthRadius=e,dt(this._passParameters.radii,e,e+bD),this._passParameters.innerFadeDistance=2*Math.sqrt((2*e-aee)*aee)}_update(e){if(R(e))return;const i=al(e.eye),r=Math.sqrt(i),n=i-this._passParameters.radii[1]*this._passParameters.radii[1],s=_e((r-this._passParameters.radii[0])/bD,0,1);cr(this._passParameters.heightParameters,r,i,n,s),this._passParameters.altitudeFade=Pae(r-this._lowerBoundEarthRadius),this._passParameters.hazeStrength=Bt(Bt(.6,1,bM(9500,10500,r-Ci.radius)),1,this._fadeHaze)}static isSupported(e){return e.renderContext.rctx.capabilities.depthTexture}};function rn(){return new Float32Array(3)}function lz(t){const e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function rr(t,e,i){const r=new Float32Array(3);return r[0]=t,r[1]=e,r[2]=i,r}function ODe(t,e){return new Float32Array(t,e,3)}function Fae(){return rn()}function PDe(){return rr(1,1,1)}function IDe(){return rr(1,0,0)}function $De(){return rr(0,1,0)}function LDe(){return rr(0,0,1)}const g_t=Fae(),y_t=PDe(),__t=IDe(),v_t=$De(),b_t=LDe();Object.freeze(Object.defineProperty({__proto__:null,ONES:y_t,UNIT_X:__t,UNIT_Y:v_t,UNIT_Z:b_t,ZEROS:g_t,clone:lz,create:rn,createView:ODe,fromValues:rr,ones:PDe,unitX:IDe,unitY:$De,unitZ:LDe,zeros:Fae},Symbol.toStringTag,{value:"Module"}));function DDe(t){t.extensions.add("GL_EXT_shader_texture_lod"),t.extensions.add("GL_OES_standard_derivatives"),t.fragment.code.add(S`#ifndef GL_EXT_shader_texture_lod
float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {
float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));
return max(0.0, 0.5 * log2(deltaMaxSqr));
}
#endif
vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
#ifdef GL_EXT_shader_texture_lod
return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);
#else
vec2 dUVdxAuto = dFdx(uvAtlas);
vec2 dUVdyAuto = dFdy(uvAtlas);
float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);
float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);
return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);
#endif
}`)}function kae(t,e){switch(t.include(iy,e),t.fragment.code.add(S`
  struct TextureLookupParameter {
    vec2 uv;
    ${e.supportsTextureAtlas?"vec2 size;":""}
  } vtc;
  `),e.textureCoordinateType){case ds.Default:case ds.Compressed:return void t.fragment.code.add(S`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return texture2D(texture, params.uv);
}`);case ds.Atlas:return t.include(DDe),void t.fragment.code.add(S`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return textureAtlasLookup(texture, params.size, params.uv, vuvRegion);
}`);default:e.textureCoordinateType;case ds.None:case ds.COUNT:return}}let rd=class extends Fn{constructor(e,i){super(e,"vec3",br.Draw,(r,n,s,o)=>r.setUniform3fv(e,i(n,s,o)))}},wD=class extends Fn{constructor(e,i){super(e,"vec2",br.Draw,(r,n,s,o)=>r.setUniform2fv(e,i(n,s,o)))}},HN=class extends Fn{constructor(e,i){super(e,"sampler2D",br.Draw,(r,n,s)=>r.bindTexture(e,i(n,s)))}};function Gb(t,e,i=lr.None){const r=[new HN(t,e)];if(i&lr.Size){const n=t+Iae;r.push(new wD(n,(s,o)=>{const a=e(s,o);return v(a)?dt(Mye,a.descriptor.width,a.descriptor.height):Jc}))}if(i&lr.InvSize){const n=t+JB;r.push(new wD(n,(s,o)=>{const a=e(s,o);return v(a)?dt(Mye,1/a.descriptor.width,1/a.descriptor.height):Jc}))}return r}const Mye=Fe();let zw=class{constructor(e){this._material=e.material,this._techniqueRepository=e.techniqueRep,this._output=e.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}get _stippleTextureRepository(){return this._techniqueRepository.constructionContext.stippleTextureRepository}ensureTechnique(e,i){return this._technique=this._techniqueRepository.releaseAndAcquire(e,this._material.getConfiguration(this._output,i),this._technique),this._technique}ensureResources(e){return u_.LOADED}},Uae=class extends zw{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textureRepository=e.textureRep,this._textureId=e.textureId,this._acquire(e.textureId,i=>this._texture=i),this._acquire(e.normalTextureId,i=>this._textureNormal=i),this._acquire(e.emissiveTextureId,i=>this._textureEmissive=i),this._acquire(e.occlusionTextureId,i=>this._textureOcclusion=i),this._acquire(e.metallicRoughnessTextureId,i=>this._textureMetallicRoughness=i)}dispose(){this._texture=nn(this._texture),this._textureNormal=nn(this._textureNormal),this._textureEmissive=nn(this._textureEmissive),this._textureOcclusion=nn(this._textureOcclusion),this._textureMetallicRoughness=nn(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return this._numLoading===0?u_.LOADED:u_.LOADING}get textureBindParameters(){return new NDe(v(this._texture)?this._texture.glTexture:null,v(this._textureNormal)?this._textureNormal.glTexture:null,v(this._textureEmissive)?this._textureEmissive.glTexture:null,v(this._textureOcclusion)?this._textureOcclusion.glTexture:null,v(this._textureMetallicRoughness)?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){(R(this._texture)||e!==this._texture.id)&&(this._texture=nn(this._texture),this._textureId=e,this._acquire(this._textureId,i=>this._texture=i))}_acquire(e,i){if(R(e))return void i(null);const r=this._textureRepository.acquire(e);if(ih(r))return++this._numLoading,void r.then(n=>{if(this._disposed)return nn(n),void i(null);i(n)}).finally(()=>--this._numLoading);i(r)}},NDe=class extends Tr{constructor(e=null,i=null,r=null,n=null,s=null){super(),this.texture=e,this.textureNormal=i,this.textureEmissive=r,this.textureOcclusion=n,this.textureMetallicRoughness=s}};const rqt=rr(0,.6,.2);var _t;(function(t){t[t.Disabled=0]="Disabled",t[t.Normal=1]="Normal",t[t.Schematic=2]="Schematic",t[t.Water=3]="Water",t[t.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",t[t.Terrain=5]="Terrain",t[t.TerrainWithWater=6]="TerrainWithWater",t[t.COUNT=7]="COUNT"})(_t||(_t={}));function Vae(t,e){const i=t.fragment,r=e.hasMetallicRoughnessTexture||e.hasEmissionTexture||e.hasOcclusionTexture;if(e.pbrMode===_t.Normal&&r&&t.include(kae,e),e.pbrMode!==_t.Schematic)if(e.pbrMode!==_t.Disabled){if(e.pbrMode===_t.Normal){i.code.add(S`vec3 mrr;
vec3 emission;
float occlusion;`);const n=e.supportsTextureAtlas?e.hasWebGL2Context?lr.None:lr.Size:lr.None,s=e.pbrTextureBindType;e.hasMetallicRoughnessTexture&&(i.uniforms.add(s===br.Pass?cm("texMetallicRoughness",o=>o.textureMetallicRoughness,n):Gb("texMetallicRoughness",o=>o.textureMetallicRoughness,n)),i.code.add(S`void applyMetallnessAndRoughness(TextureLookupParameter params) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),e.hasEmissionTexture&&(i.uniforms.add(s===br.Pass?cm("texEmission",o=>o.textureEmissive,n):Gb("texEmission",o=>o.textureEmissive,n)),i.code.add(S`void applyEmission(TextureLookupParameter params) {
emission *= textureLookup(texEmission, params).rgb;
}`)),e.hasOcclusionTexture?(i.uniforms.add(s===br.Pass?cm("texOcclusion",o=>o.textureOcclusion,n):Gb("texOcclusion",o=>o.textureOcclusion,n)),i.code.add(S`void applyOcclusion(TextureLookupParameter params) {
occlusion *= textureLookup(texOcclusion, params).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):i.code.add(S`float getBakedOcclusion() { return 1.0; }`),i.uniforms.add(s===br.Pass?[new Jt("emissionFactor",o=>o.emissiveFactor),new Jt("mrrFactors",o=>o.mrrFactors)]:[new rd("emissionFactor",o=>o.emissiveFactor),new rd("mrrFactors",o=>o.mrrFactors)]),i.code.add(S`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;
      ${r?S`vtc.uv = vuv0;`:""}
      ${e.hasMetallicRoughnessTextureTransform?S`vtc.uv = metallicRoughnessUV;`:""}
      ${e.hasMetallicRoughnessTexture?e.supportsTextureAtlas?S`
                vtc.size = ${Tp(e,"texMetallicRoughness")};
                applyMetallnessAndRoughness(vtc);`:S`applyMetallnessAndRoughness(vtc);`:""}
      ${e.hasEmissiveTextureTransform?S`vtc.uv = emissiveUV;`:""}
      ${e.hasEmissionTexture?e.supportsTextureAtlas?S`
                vtc.size = ${Tp(e,"texEmission")};
                applyEmission(vtc);`:S`applyEmission(vtc);`:""}
      ${e.hasOcclusionTextureTransform?S`vtc.uv = occlusionUV;`:""}
      ${e.hasOcclusionTexture?e.supportsTextureAtlas?S`
                vtc.size = ${Tp(e,"texOcclusion")};
                applyOcclusion(vtc);`:S`applyOcclusion(vtc);`:""}
    }
  `)}}else i.code.add(S`float getBakedOcclusion() { return 1.0; }`);else i.code.add(S`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}function zae(t,e){const i=t.fragment,r=e.lightingSphericalHarmonicsOrder!==void 0?e.lightingSphericalHarmonicsOrder:2;r===0?(i.uniforms.add(new Jt("lightingAmbientSH0",(n,s)=>he(Oye,s.lighting.sh.r[0],s.lighting.sh.g[0],s.lighting.sh.b[0]))),i.code.add(S`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===1?(i.uniforms.add([new bi("lightingAmbientSH_R",(n,s)=>cr(By,s.lighting.sh.r[0],s.lighting.sh.r[1],s.lighting.sh.r[2],s.lighting.sh.r[3])),new bi("lightingAmbientSH_G",(n,s)=>cr(By,s.lighting.sh.g[0],s.lighting.sh.g[1],s.lighting.sh.g[2],s.lighting.sh.g[3])),new bi("lightingAmbientSH_B",(n,s)=>cr(By,s.lighting.sh.b[0],s.lighting.sh.b[1],s.lighting.sh.b[2],s.lighting.sh.b[3]))]),i.code.add(S`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===2&&(i.uniforms.add([new Jt("lightingAmbientSH0",(n,s)=>he(Oye,s.lighting.sh.r[0],s.lighting.sh.g[0],s.lighting.sh.b[0])),new bi("lightingAmbientSH_R1",(n,s)=>cr(By,s.lighting.sh.r[1],s.lighting.sh.r[2],s.lighting.sh.r[3],s.lighting.sh.r[4])),new bi("lightingAmbientSH_G1",(n,s)=>cr(By,s.lighting.sh.g[1],s.lighting.sh.g[2],s.lighting.sh.g[3],s.lighting.sh.g[4])),new bi("lightingAmbientSH_B1",(n,s)=>cr(By,s.lighting.sh.b[1],s.lighting.sh.b[2],s.lighting.sh.b[3],s.lighting.sh.b[4])),new bi("lightingAmbientSH_R2",(n,s)=>cr(By,s.lighting.sh.r[5],s.lighting.sh.r[6],s.lighting.sh.r[7],s.lighting.sh.r[8])),new bi("lightingAmbientSH_G2",(n,s)=>cr(By,s.lighting.sh.g[5],s.lighting.sh.g[6],s.lighting.sh.g[7],s.lighting.sh.g[8])),new bi("lightingAmbientSH_B2",(n,s)=>cr(By,s.lighting.sh.b[5],s.lighting.sh.b[6],s.lighting.sh.b[7],s.lighting.sh.b[8]))]),i.code.add(S`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),e.pbrMode!==_t.Normal&&e.pbrMode!==_t.Schematic||i.code.add(S`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const Oye=P(),By=pi();function qN(t){t.vertex.code.add(S`const float PI = 3.141592653589793;`),t.fragment.code.add(S`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}var Xn,T2;function w_t(t){return v(t)&&v(t.cubeMap)}function Bae(t){return v(t)&&!t.running}(function(t){t[t.RENDERING=0]="RENDERING",t[t.FINISHED_RENDERING=1]="FINISHED_RENDERING",t[t.FADING_TEXTURE_CHANNELS=2]="FADING_TEXTURE_CHANNELS",t[t.SWITCH_CHANNELS=3]="SWITCH_CHANNELS",t[t.FINISHED=4]="FINISHED"})(Xn||(Xn={})),function(t){t[t.RG=0]="RG",t[t.BA=1]="BA"}(T2||(T2={}));let x_t=class{constructor(){this.readChannels=T2.RG,this.renderingStage=Xn.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=P(),this.isCameraPositionFinal=!0,this.parallax=new Pye,this.parallaxNew=new Pye,this.crossFade={enabled:!1,factor:1,distanceThresholdFactor:.3},this.fadeInOut={stage:oo.FINISHED,factor:1,distanceThresholdFactor:.6},this.fadeIn={stage:Iu.FINISHED,factor:1,distanceThresholdFactor:2},this.fadeInOutHeight={stage:gw.FINISHED,factor:-1}}get isFading(){return this.fadeInOut.stage===oo.FADE_OUT||this.fadeInOut.stage===oo.FADE_IN||this.fadeIn.stage===Iu.FADE_IN||this.fadeInOutHeight.stage!==gw.FINISHED||this.renderingStage===Xn.FADING_TEXTURE_CHANNELS}};var Iu,oo,gw;(function(t){t[t.FINISHED=0]="FINISHED",t[t.CHANGE_ANCHOR=1]="CHANGE_ANCHOR",t[t.FADE_IN=2]="FADE_IN"})(Iu||(Iu={})),function(t){t[t.FINISHED=0]="FINISHED",t[t.FADE_OUT=1]="FADE_OUT",t[t.SWITCH=2]="SWITCH",t[t.FADE_IN=3]="FADE_IN"}(oo||(oo={})),function(t){t[t.FINISHED=0]="FINISHED",t[t.HEIGHT_FADE=1]="HEIGHT_FADE"}(gw||(gw={}));let Pye=class{constructor(){this.anchorPointClouds=P(),this.cloudsHeight=1e5,this.radiusCurvatureCorrectionFactor=0,this.transform=$e()}},h_=class extends Fn{constructor(e,i){super(e,"bool",br.Pass,(r,n,s)=>r.setUniform1b(e,i(n,s)))}},T_t=class extends Fn{constructor(e,i){super(e,"samplerCube",br.Pass,(r,n,s)=>r.bindTexture(e,i(n,s)))}};function FDe(t){const e=t.fragment;e.uniforms.add([new on("rotationMatrixClouds",(i,r)=>r.cloudsFade.parallax.transform),new on("rotationMatrixCloudsCrossFade",(i,r)=>r.cloudsFade.parallaxNew.transform),new Jt("anchorPosition",(i,r)=>r.cloudsFade.parallax.anchorPointClouds),new Jt("anchorPositionCrossFade",(i,r)=>r.cloudsFade.parallaxNew.anchorPointClouds),new Ie("cloudsHeight",(i,r)=>r.cloudsFade.parallax.cloudsHeight),new Ie("radiusCurvatureCorrectionFactor",(i,r)=>r.cloudsFade.parallax.radiusCurvatureCorrectionFactor),new Ie("totalFadeInOut",(i,r)=>r.cloudsFade.fadeInOut.stage===oo.FINISHED?r.cloudsFade.fadeInOutHeight.factor+1-r.cloudsFade.fadeIn.factor:r.cloudsFade.fadeInOutHeight.factor+1-r.cloudsFade.fadeInOut.factor),new Ie("crossFadeAnchorFactor",(i,r)=>_e(r.cloudsFade.crossFade.factor,0,1)),new T_t("cubeMap",(i,r)=>v(r.cloudsFade.data)&&v(r.cloudsFade.data.cubeMap)?r.cloudsFade.data.cubeMap.colorTexture:null),new h_("crossFade",(i,r)=>r.cloudsFade.crossFade.enabled),new h_("readChannelsRG",(i,r)=>r.cloudsFade.readChannels===T2.RG),new h_("fadeTextureChannels",(i,r)=>r.cloudsFade.renderingStage===Xn.FADING_TEXTURE_CHANNELS)]),e.constants.add("planetRadius","float",Ci.radius),e.code.add(S`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),e.code.add(S`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),e.code.add(S`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),H_(e),Ey(e),e.code.add(S`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),e.code.add(S`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = textureCube(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`),e.code.add(S`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),e.code.add(S`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),e.code.add(S`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}function Cy(t){t.code.add(S`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function S_t(){const t=new ji;t.attributes.add(M.POSITION,"vec2"),t.varyings.add("worldRay","vec3");const{vertex:e,fragment:i}=t;return e.uniforms.add([new on("inverseProjectionMatrix",(r,n)=>n.camera.inverseProjectionMatrix),new on("inverseViewMatrix",(r,n)=>TO(E_t,n.camera.viewMatrix))]),e.code.add(S`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),i.include(Cy),i.include(nh),t.include(zae,{pbrMode:_t.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(qN),t.include(ZB),t.include(oz,{useLegacyTerrainShading:!1}),t.include(FDe,{instancedDoublePrecision:!1,useLegacyTerrainShading:!1}),i.uniforms.add([new Jt("cameraPosition",(r,n)=>n.camera.eye)]),i.code.add(S`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
gl_FragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),t}const E_t=$e(),C_t=Object.freeze(Object.defineProperty({__proto__:null,build:S_t},Symbol.toStringTag,{value:"Module"}));let kDe=class UDe extends Yi{constructor(e){super(e,new wl,()=>this.destroy())}initializeProgram(e){return new Hi(e.rctx,UDe.shader.get().build(),Di)}initializePipeline(){return Ht({blending:_o(Ce.ONE,Ce.ZERO,Ce.SRC_ALPHA,Ce.ONE),depthTest:{func:Gr.LEQUAL},colorWrite:si})}};kDe.shader=new Gi(C_t,()=>Q(()=>import("./CloudsComposition.glsl-aba9bb3e.js"),[]));let MT=class extends ve{constructor(e){super(e),this._technique=new kDe(e),this._vao=xl(e.rctx)}destroy(){this._technique=nn(this._technique),this._vao=rt(this._vao)}render(e){const i=e.bindParameters.cloudsFade;if(R(this._vao)||R(i.data))return;if(!this._technique.compiled)return void this.requestRender();const r=e.rctx.bindTechnique(this._technique,A_t,e.bindParameters);e.rctx.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays(Ft.TRIANGLE_STRIP,0,4)}};u([d({constructOnly:!0})],MT.prototype,"rctx",void 0),u([d({constructOnly:!0})],MT.prototype,"viewingMode",void 0),u([d({constructOnly:!0})],MT.prototype,"planetRadius",void 0),u([d({constructOnly:!0})],MT.prototype,"requestRender",void 0),MT=u([$("esri.views.3d.environment.CloudsComposition")],MT);const A_t=new Tr;var jc;(function(t){t[t.SIXTEEN=0]="SIXTEEN",t[t.HUNDRED=1]="HUNDRED",t[t.TWOHUNDRED=2]="TWOHUNDRED",t[t.COUNT=3]="COUNT"})(jc||(jc={}));let MU=class extends wl{constructor(){super(...arguments),this.steps=jc.SIXTEEN,this.writeTextureChannels=T2.RG}};u([j({count:jc.COUNT})],MU.prototype,"steps",void 0),u([j({constValue:ue("esri-mobile")?1024:2048})],MU.prototype,"cubeMapSize",void 0),u([j()],MU.prototype,"writeTextureChannels",void 0);let NI=class{constructor(e,i,r,n,s,o,a,l,c=.5){this.coverage=e,this.density=i,this.absorption=r,this.cloudSize=n,this.detailSize=s,this.smoothness=o,this.cloudHeight=a,this.raymarchingSteps=l,this.median=c}};const Iye=new NI([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],jc.SIXTEEN),tl={sunny:Iye,cloudy:new NI([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],jc.TWOHUNDRED,.6),rainy:new NI([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],jc.TWOHUNDRED,.4),snowy:new NI([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],jc.HUNDRED,.65),foggy:new NI([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],jc.SIXTEEN),default:Iye},Qd=ue("esri-mobile")?64:128,R_t=Qd/128,Pf=Math.ceil(Math.sqrt(Qd)),Gf=(Qd+2)*Pf,M_t=1e5,HH=128,O_t=Gf/1560;function Bp(t,e=!0){t.attributes.add(M.POSITION,"vec2"),e&&t.varyings.add("uv","vec2"),t.vertex.code.add(S`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${e?S`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}let xD=class extends Fn{constructor(e,i){super(e,"mat3",br.Draw,(r,n,s)=>r.setUniformMatrix3fv(e,i(n,s)))}},VDe=class extends Tr{constructor(){super(...arguments),this.cloudRadius=0,this.cloudSize=0,this.detailSize=0,this.absorption=0,this.density=0,this.smoothness=0,this.cloudHeight=0,this.coverage=0,this.raymarchingSteps=tl.default.raymarchingSteps,this.weatherTile=Fe()}},zDe=class extends Tr{constructor(){super(...arguments),this.viewMatrix=wr()}};function P_t(t){const e=new ji;e.include(Bp,!1);const i=e.fragment;return i.uniforms.add([new Ie("cloudRadius",r=>r.cloudRadius),new Ie("power",r=>Bt(35,120,r.absorption)),new Ie("sigmaE",r=>1+r.absorption),new Ie("density",r=>Bt(0,.3,r.density)),new Ie("cloudSize",r=>Bt(0,.02,Math.max(.01,1-r.cloudSize))),new Ie("detailSize",r=>Bt(0,.2,Math.max(.01,1-r.detailSize))),new Ie("smoothness",r=>Bt(0,.5,1-r.smoothness)),new Ie("cloudHeight",r=>Bt(0,1500,r.cloudHeight)),new Ie("coverage",r=>r.coverage),new xD("view",r=>r.viewMatrix),new Dt("cloudShapeTexture",r=>v(r.noiseTexture)?r.noiseTexture.textureAtlas:null),new Wi("cloudVariables",r=>dt(I_t,r.coverage,r.absorption))]),i.constants.add("halfCubeMapSize","float",.5*t.cubeMapSize),i.code.add(S`
    const int STEPS = ${t.steps===jc.SIXTEEN?S`16`:t.steps===jc.HUNDRED?S`100`:S`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),i.code.add(S`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${S.float(Gf)};
      const float dataWidth = ${S.float(Gf)};
      const float tileRows = ${S.float(Pf)};
      const vec3 atlasDimensions = vec3(${S.float(Qd)}, ${S.float(Qd)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${S.float(R_t)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture2D(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Non-power-of-two textures can't be tiled using WebGL1
      // Get fractional part of uv to tile
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = fract((${S.float(O_t)} * p) / ${S.float(Gf)} + 0.5);

      return texture2D(cloudShapeTexture, uv).a;
    }
    `),i.code.add(S`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),i.code.add(S`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),i.code.add(`
    float multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      float luminance = 0.0;

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),i.code.add(S`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),i.code.add(S`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`),i.code.add(S`void main() {
if (coverage ==  0.0) {
gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
gl_FragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
gl_FragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`),e}const I_t=Fe(),$_t=Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:zDe,CloudsPassParameters:VDe,build:P_t},Symbol.toStringTag,{value:"Module"}));let BDe=class jDe extends Yi{constructor(e,i){super(e,i,()=>this.destroy())}initializeProgram(e){return new Hi(e.rctx,jDe.shader.get().build(this.configuration),Di)}initializePipeline(){return Ht({blending:Am(Ce.CONSTANT_COLOR,Ce.ONE_MINUS_CONSTANT_COLOR,yy.ADD,this.configuration.writeTextureChannels===T2.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:Gr.LEQUAL},colorWrite:si})}};BDe.shader=new Gi($_t,()=>Q(()=>import("./Clouds.glsl-2b3c21d5.js"),[]));var Yh;(function(t){t[t.Full=0]="Full",t[t.WeatherMap=1]="WeatherMap",t[t.COUNT=2]="COUNT"})(Yh||(Yh={}));let pee=class extends wl{constructor(){super(...arguments),this.mode=Yh.Full}};u([j({count:Yh.COUNT})],pee.prototype,"mode",void 0);let GDe=class extends Tr{constructor(){super(...arguments),this.weatherTile=Mi(0,0)}};function L_t(t){const e=new ji;return e.include(Bp,!1),e.fragment.code.add(S`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),t.mode===Yh.Full&&e.fragment.code.add(S`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${S.float(Pf)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${S.float(8)});

      float worley0 = worley(p, ${S.float(2)} * 2.0);
      float worley1 = worley(p, ${S.float(2)} * 8.0);
      float worley2 = worley(p, ${S.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${S.float(2)});
      float worley1 = worley(p, ${S.float(2)} * 2.0);
      float worley2 = worley(p, ${S.float(2)} * 4.0);
      float worley3 = worley(p, ${S.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),e.fragment.uniforms.add(new Wi("weatherTile",i=>i.weatherTile)),e.fragment.code.add(S`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${S.float(HH)});

      // Get global coordinates of p
      p += weatherTile * ${S.float(HH)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${S.float(M_t)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),e.fragment.code.add(S`void main() {`),t.mode===Yh.Full&&e.fragment.code.add(S`
        float padWidth = 1.0;
        float paddedSize = ${S.float(Qd)} + 2.0 * padWidth;
        float tileCount = ${S.float(Pf)} * ${S.float(Pf)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${S.float(Qd)};
          }

          if (startPadY) {
            pixel.y += ${S.float(Qd)};
          }

          if (endPadX) {
            pixel.x -= ${S.float(Qd)};
          }

          if (endPadY) {
            pixel.y -= ${S.float(Qd)};
          }

          uv = vec2(pixel.xy / ${S.float(Qd)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${S.float(Qd)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${S.float(Pf)} * ${S.float(Pf)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${S.float(Pf)} * ${S.float(Pf)});
        p = p_;
        p.z /= (${S.float(Pf)} * ${S.float(Pf)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),e.fragment.code.add(S`
      vec2 mapUV = ${S.float(HH)} * (gl_FragCoord.xy / ${S.float(Gf)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${t.mode===Yh.Full?S`gl_FragColor.ba = vec2(0.0, map);`:S`gl_FragColor = vec4(map);`};
    }
  `),e}const D_t=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:GDe,build:L_t},Symbol.toStringTag,{value:"Module"}));let fee=class HDe extends Yi{initializeProgram(e){return new Hi(e.rctx,HDe.shader.get().build(this.configuration),Di)}initializePipeline(){return Ht({blending:this.configuration.mode===Yh.Full?Am(Ce.ONE,Ce.ZERO):_o(Ce.ZERO,Ce.ONE,Ce.ONE,Ce.ZERO),depthTest:{func:Gr.ALWAYS},colorWrite:si})}};fee.shader=new Gi(D_t,()=>Q(()=>import("./NoiseTextureAtlas.glsl-310d0cae.js"),[]));let mA=class{constructor(e,i){this._context=e,this._desc=i,this.type="renderbuffer",this._context.instanceCounter.increment(mo.Renderbuffer,this);const r=this._context.gl;this.glName=r.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:n,height:s,internalFormat:o,multisampled:a}=i;if(a){if(this._context.type!==Et.WEBGL2)throw new Error("Multisampled renderbuffers are not supported in WebGL1!");r.renderbufferStorageMultisample(r.RENDERBUFFER,this.samples,o,n,s)}else r.renderbufferStorage(r.RENDERBUFFER,o,n,s)}get descriptor(){return this._desc}get samples(){const e=this._desc.samples,i=this._context.parameters.maxSamples;return e?Math.min(e,i):i}resize(e,i){const r=this._desc;if(r.width===e&&r.height===i)return;r.width=e,r.height=i;const n=this._context.gl;this._context.bindRenderbuffer(this),r.multisampled?n.renderbufferStorageMultisample(n.RENDERBUFFER,this.samples,r.internalFormat,r.width,r.height):n.renderbufferStorage(n.RENDERBUFFER,r.internalFormat,r.width,r.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(mo.Renderbuffer,this),this._context=e2(this._context))}},es=class gA{constructor(e,i,r=null,n=null){if(this._context=e,this._glName=null,this._depthAttachment=null,this._stencilAttachment=null,this._colorAttachments=new Map,this._depthStencilTexture=null,this._initialized=!1,this._desc={...i},e.instanceCounter.increment(mo.FramebufferObject,this),v(r)){Array.isArray(r)||(r=[r]);for(let s=0;s<r.length;++s){const o=r[s],a=Ih.COLOR_ATTACHMENT0+s;let l;Lye(o)?(T0(o)?(l=o.descriptor,this._colorAttachments.set(a,o)):(l=o,this._colorAttachments.set(a,new mt(this._context,l))),q4(l,this._desc)):($ye(o)?(l=o.descriptor,this._colorAttachments.set(a,o)):(l=o,this._colorAttachments.set(a,new mA(this._context,l))),qH(l,this._desc)),this._validateColorAttachmentPoint(a)}}if(v(n)){let s,o;if(Lye(n))this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),T0(n)?(o=n.descriptor,this._depthStencilTexture=n):(o=n,this._depthStencilTexture=new mt(this._context,o)),q4(o,this._desc);else{$ye(n)?(o=n.descriptor,s=n):(o=n,s=new mA(this._context,o));const a=this._desc.depthStencilTarget??Vi.DEPTH_STENCIL_RENDER_BUFFER;a===Vi.STENCIL_RENDER_BUFFER?this._stencilAttachment=s:a===Vi.DEPTH_RENDER_BUFFER||a===Vi.DEPTH_STENCIL_RENDER_BUFFER?this._depthAttachment=s:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),this._desc.depthStencilTarget=a,qH(o,this._desc)}}}dispose(){if(!this._desc)return;const e=this._context.getBoundFramebufferObject();this._disposeColorAttachments(),this._disposeDepthStencilAttachments(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(e),this._context.instanceCounter.decrement(mo.FramebufferObject,this),this._desc=null}get glName(){return this._glName}get descriptor(){return this._desc}get colorTexture(){const e=this._colorAttachments.get(Ih.COLOR_ATTACHMENT0);return e&&T0(e)?e:null}get colorAttachment(){return this._colorAttachments.get(Ih.COLOR_ATTACHMENT0)}get depthStencilAttachment(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._desc.width??0}get height(){return this._desc.height??0}get gpuMemoryUsage(){return[...this._colorAttachments].reduce((e,[i,r])=>e+x2(r),0)+x2(this.depthStencilAttachment)}getColorTexture(e){const i=this._colorAttachments.get(e);return i&&T0(i)?i:null}attachColorTexture(e,i=Ih.COLOR_ATTACHMENT0){e&&(this._validateColorAttachmentPoint(i),q4(e.descriptor,this._desc),this._disposeColorAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,i)),this._colorAttachments.set(i,e))}detachColorTexture(e=Ih.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(e);if(T0(i)){const r=i;return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e)),this._colorAttachments.delete(e),r}}setColorTextureTarget(e,i=Ih.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(i);T0(r)&&this._framebufferTexture2D(r.glName,i,e)}attachDepthStencilTexture(e){if(R(e))return;const i=e.descriptor;i.pixelFormat!==Ge.DEPTH_STENCIL&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),i.dataType!==kt.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),q4(i,this._desc),this._desc.depthStencilTarget&&this._desc.depthStencilTarget!==Vi.DEPTH_STENCIL_TEXTURE&&(this._desc.depthStencilTarget=Vi.DEPTH_STENCIL_TEXTURE),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,xye)),this._depthStencilTexture=e}detachDepthStencilTexture(){const e=this._depthStencilTexture;return e&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,xye)),this._depthStencilTexture=null,e}attachDepthStencilBuffer(e){if(R(e))return;const i=e.descriptor;if(i.internalFormat!==Bl.DEPTH_STENCIL&&i.internalFormat!==Bl.DEPTH_COMPONENT16&&console.error("Depth/Stencil buffer must have correct internalFormat"),qH(i,this._desc),this._disposeDepthStencilAttachments(),this._desc.depthStencilTarget=i.internalFormat===Bl.DEPTH_STENCIL?Vi.DEPTH_STENCIL_RENDER_BUFFER:Vi.DEPTH_RENDER_BUFFER,this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl,n=this._desc.depthStencilTarget===Vi.DEPTH_RENDER_BUFFER?r.DEPTH_ATTACHMENT:r.DEPTH_STENCIL_ATTACHMENT;r.framebufferRenderbuffer(Po.FRAMEBUFFER,n,r.RENDERBUFFER,e.glName)}this._depthAttachment=e}detachDepthStencilBuffer(){const e=this._context.gl,i=this._depthAttachment;if(i&&this._initialized){this._context.bindFramebuffer(this);const r=this._desc.depthStencilTarget===Vi.DEPTH_RENDER_BUFFER?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(Po.FRAMEBUFFER,r,e.RENDERBUFFER,null)}return this._depthAttachment=null,i}detachAll(){this._colorAttachments.forEach((e,i)=>this._detachColorAttachment(i)),this.detachDepthStencilBuffer(),this.detachDepthStencilTexture()}copyToTexture(e,i,r,n,s,o,a){(e<0||i<0||s<0||o<0)&&console.error("Offsets cannot be negative!"),(r<=0||n<=0)&&console.error("Copy width and height must be greater than zero!");const l=this._desc,c=a.descriptor;a.descriptor.target!==Ct.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),((l==null?void 0:l.width)==null||(l==null?void 0:l.height)==null||(c==null?void 0:c.width)==null||(c==null?void 0:c.height)==null||e+r>l.width||i+n>l.height||s+r>c.width||o+n>c.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const h=this._context,p=h.bindTexture(a,mt.TEXTURE_UNIT_FOR_UPDATES);h.setActiveTexture(mt.TEXTURE_UNIT_FOR_UPDATES),h.bindFramebuffer(this),h.gl.copyTexSubImage2D(Ct.TEXTURE_2D,0,s,o,e,i,r,n),h.bindTexture(p,mt.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,i,r,n,s,o,a){(r<=0||n<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,i,r,n,s,o,a)}async readPixelsAsync(e,i,r,n,s,o,a){if(this._context.type!==Et.WEBGL2)return Fh()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),void this.readPixels(e,i,r,n,s,o,a);const l=this._context.gl,c=er.createPixelPack(this._context,zi.STREAM_READ,a.byteLength);this._context.bindBuffer(c),this._context.bindFramebuffer(this),l.readPixels(e,i,r,n,s,o,0),this._context.unbindBuffer(Lt.PIXEL_PACK_BUFFER),await c.getSubDataAsync(a),c.dispose()}resize(e,i){const r=this._desc;if(r.width!==e||r.height!==i){if(r.width=e,r.height=i,!this._initialized)return this._colorAttachments.forEach(n=>{n&&n.resize(e,i)}),void(this._depthStencilTexture&&this._depthStencilTexture.resize(e,i));this._colorAttachments.forEach(n=>{n&&n.resize(e,i)}),this._depthStencilTexture!=null?this._depthStencilTexture.resize(e,i):(this._depthAttachment||this._stencilAttachment)&&(this._depthAttachment&&this._depthAttachment.resize(e,i),this._stencilAttachment&&this._stencilAttachment.resize(e,i)),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1}}initializeAndBind(e=Po.FRAMEBUFFER){const i=this._context.gl;if(this._initialized)return void i.bindFramebuffer(e,this.glName);this._glName&&i.deleteFramebuffer(this._glName);const r=this._context,n=i.createFramebuffer(),s=this._desc,o=s.colorTarget??En.RENDER_BUFFER,a=s.width??1,l=s.height??1;if(i.bindFramebuffer(e,n),this._colorAttachments.size===0)if(o===En.TEXTURE||o===En.CUBEMAP)this._colorAttachments.set(Ih.COLOR_ATTACHMENT0,N_t(r,s,this.descriptor.colorTarget===En.CUBEMAP?Ct.TEXTURE_CUBE_MAP:Ct.TEXTURE_2D));else{const h=new mA(r,{internalFormat:Mt.RGBA4,width:a,height:l});this._colorAttachments.set(Ih.COLOR_ATTACHMENT0,h)}this._colorAttachments.forEach((h,p)=>{h&&(T0(h)?this._framebufferTexture2D(h.glName,p,Dye(h),e):i.framebufferRenderbuffer(e,p,i.RENDERBUFFER,h.glName))});const c=s.depthStencilTarget??Vi.NONE;switch(c){case Vi.DEPTH_RENDER_BUFFER:case Vi.DEPTH_STENCIL_RENDER_BUFFER:{this._depthAttachment||(this._depthAttachment=new mA(r,{internalFormat:s.depthStencilTarget===Vi.DEPTH_RENDER_BUFFER?Bl.DEPTH_COMPONENT16:Bl.DEPTH_STENCIL,width:a,height:l}));const h=c===Vi.DEPTH_RENDER_BUFFER?i.DEPTH_ATTACHMENT:i.DEPTH_STENCIL_ATTACHMENT;i.framebufferRenderbuffer(e,h,i.RENDERBUFFER,this._depthAttachment.glName);break}case Vi.STENCIL_RENDER_BUFFER:this._stencilAttachment||(this._stencilAttachment=new mA(r,{internalFormat:Bl.STENCIL_INDEX8,width:a,height:l})),i.framebufferRenderbuffer(e,i.STENCIL_ATTACHMENT,i.RENDERBUFFER,this._stencilAttachment.glName);break;case Vi.DEPTH_STENCIL_TEXTURE:if(!this._depthStencilTexture){r.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!");const h={target:Ct.TEXTURE_2D,pixelFormat:Ge.DEPTH_STENCIL,dataType:kt.UNSIGNED_INT_24_8,samplingMode:nt.NEAREST,wrapMode:$t.CLAMP_TO_EDGE,width:a,height:l};this._depthStencilTexture=new mt(r,h)}this._framebufferTexture2D(this._depthStencilTexture.glName,i.DEPTH_STENCIL_ATTACHMENT,Dye(this._depthStencilTexture),e)}Fh()&&i.checkFramebufferStatus(e)!==i.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=n,this._initialized=!0}_framebufferTexture2D(e,i=Ih.COLOR_ATTACHMENT0,r=Ct.TEXTURE_2D,n=Po.FRAMEBUFFER,s=0){this._context.gl.framebufferTexture2D(n,i,r,e,s)}_detachColorAttachment(e){Fh()&&console.warn("Detaching an FBO attachment can be a slow due to invalidating framebuffer completeness!");const i=this._context.gl,r=this._colorAttachments.get(e);return T0(r)?this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e)):this._initialized&&(this._context.bindFramebuffer(this),i.framebufferRenderbuffer(Po.FRAMEBUFFER,e,i.RENDERBUFFER,null)),this._colorAttachments.delete(e),r}_disposeColorAttachments(){this._colorAttachments.forEach((e,i)=>{this._detachColorAttachment(i),e.dispose()}),this._colorAttachments.clear()}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthAttachment){if(this._initialized){this._context.bindFramebuffer(this);const i=this._desc.depthStencilTarget===Vi.DEPTH_RENDER_BUFFER?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(Po.FRAMEBUFFER,i,e.RENDERBUFFER,null)}this._depthAttachment.dispose(),this._depthAttachment=null}this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),e.framebufferRenderbuffer(Po.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)}_validateColorAttachmentPoint(e){if(gA._MAX_COLOR_ATTACHMENTS===-1){const r=this._context.capabilities.drawBuffers;if(r){const n=this._context.gl;gA._MAX_COLOR_ATTACHMENTS=n.getParameter(r.MAX_COLOR_ATTACHMENTS)}else gA._MAX_COLOR_ATTACHMENTS=1}const i=e-Ih.COLOR_ATTACHMENT0;i+1>gA._MAX_COLOR_ATTACHMENTS&&re.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${i+1}. Implementation supports up to ${gA._MAX_COLOR_ATTACHMENTS} color attachments`)}};function T0(t){return t!=null&&"type"in t&&t.type==="texture"}function $ye(t){return t!=null&&"type"in t&&t.type==="renderbuffer"}function Lye(t){return T0(t)||t!=null&&"pixelFormat"in t}function N_t(t,e,i){return new mt(t,{target:i,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:nt.NEAREST,wrapMode:$t.CLAMP_TO_EDGE,width:e.width,height:e.height})}function q4(t,e){t.target!==Ct.TEXTURE_2D&&t.target!==Ct.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),e.width!==void 0&&e.width>=0&&e.height!==void 0&&e.height>=0?e.width===t.width&&e.height===t.height||console.error("Color attachment texture must match the framebuffer's!"):(e.width=t.width,e.height=t.height)}function qH(t,e){e.width!==void 0&&e.width>=0&&e.height!==void 0&&e.height>=0?e.width===t.width&&e.height===t.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(e.width=t.width,e.height=t.height)}function Dye(t){return t.descriptor.target===Ct.TEXTURE_CUBE_MAP?Ct.TEXTURE_CUBE_MAP_POSITIVE_X:Ct.TEXTURE_2D}es._MAX_COLOR_ATTACHMENTS=-1;let FI=class extends ve{constructor(e){super(e),this._needsRender=!0,this._passParameters=new GDe,this._frameBuffer=new es(e.context.renderContext.rctx,{colorTarget:En.TEXTURE,width:Gf,height:Gf},{target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE,samplingMode:nt.LINEAR,hasMipmap:!1,width:Gf,height:Gf}),this._vao=xl(e.context.renderContext.rctx)}get _techniqueRepository(){return this.context.techniqueRepository}get textureAtlas(){return v(this._texture)?v(this._weatherMapTechnique)&&this._weatherMapTechnique.compiled&&this._needsRender&&(this._texture=this._render(Yh.WeatherMap)):v(this._fullTechnique)&&this._fullTechnique.compiled&&(this._texture=this._render(Yh.Full)),this._texture}_setDirty(){this._needsRender=!0}updateWeatherMap(e){this._passParameters.weatherTile[0]===e[0]&&this._passParameters.weatherTile[1]===e[1]||(io(this._passParameters.weatherTile,e),this._setDirty())}destroy(){this._fullTechniqueCached=nn(this._fullTechniqueCached),this._weatherMapTechniqueCached=nn(this._weatherMapTechniqueCached),this._frameBuffer=rt(this._frameBuffer),this._vao=rt(this._vao)}get _fullTechnique(){if(R(this._fullTechniqueCached)){const e=new pee;e.mode=Yh.Full,this._fullTechniqueCached=this._techniqueRepository.acquire(fee,e)}return this._fullTechniqueCached}get _weatherMapTechnique(){if(R(this._weatherMapTechniqueCached)){const e=new pee;e.mode=Yh.WeatherMap,this._weatherMapTechniqueCached=this._techniqueRepository.acquire(fee,e)}return this._weatherMapTechniqueCached}_render(e){if(R(this._vao)||R(this._frameBuffer))return null;const i=e===Yh.Full?this._fullTechnique:this._weatherMapTechnique,r=this.context.renderContext.rctx,n=r.getViewport();r.setViewport(0,0,Gf,Gf),r.bindFramebuffer(this._frameBuffer);const s=r.bindTechnique(i,this._passParameters,null);return r.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao),r.gl.drawArrays(r.gl.TRIANGLE_STRIP,0,4),r.setViewport(n.x,n.y,n.width,n.height),this._needsRender=!1,this._frameBuffer.colorTexture}};u([d({constructOnly:!0})],FI.prototype,"context",void 0),u([d({readOnly:!0})],FI.prototype,"_techniqueRepository",null),FI=u([$("esri.views.3d.environment.NoiseTextureAtlas")],FI);function qDe(t){t.include(ud),t.uniforms.add([new Dt("geometryDepthTexture",(e,i)=>i.multipassGeometry.linearDepthTexture),new Wi("nearFar",(e,i)=>i.camera.nearFar)]),t.code.add(S`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}let F_t=class{constructor(){this.enabled=!1}};function hd(t,e){e.hasMultipassTerrain&&(t.fragment.include(ud),t.fragment.uniforms.add(new Dt("terrainDepthTexture",(i,r)=>r.multipassTerrain.linearDepthTexture)),t.fragment.uniforms.add(new Wi("nearFar",(i,r)=>r.camera.nearFar)),t.fragment.uniforms.add(new Wi("inverseViewport",(i,r)=>r.inverseViewport)),t.fragment.code.add(S`
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){
      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${e.cullAboveGround?">":"<="} terrainDepth){
        discard;
      }
    }
  `))}let k_t=class{constructor(){this.enabled=!1,this.cullAboveGround=!1}};function U_t(t,e){const i=t.fragment;i.include(ud),i.uniforms.add(new Wi("nearFar",(r,n)=>n.camera.nearFar)),i.uniforms.add(new Dt("depthMap",(r,n)=>n.linearDepthTexture)),i.uniforms.add(new on("proj",(r,n)=>n.ssr.camera.projectionMatrix)),i.uniforms.add(new Ie("invResolutionHeight",(r,n)=>1/n.ssr.camera.height)),i.uniforms.add(new on("reprojectionMatrix",(r,n)=>n.ssr.reprojectionMatrix)),i.code.add(S`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${e.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}let V_t=class{constructor(){this.enabled=!1,this.fadeFactor=1,this.reprojectionMatrix=$e()}};function QB(t){return t?{ray:ko(t.ray),c0:t.c0,c1:t.c1}:{ray:ko(),c0:0,c1:Number.MAX_VALUE}}function z_t(t,e=QB()){return nz(t,e.ray),e.c0=0,e.c1=Number.MAX_VALUE,e}function B_t(t,e,i=QB()){const r=Pe(t.vector);return ALe(t.origin,e,i.ray),i.c0=0,i.c1=r,i}function wqt(t,e){return WDe(t,t.c0,e)}function xqt(t,e){return WDe(t,t.c1,e)}function WDe(t,e,i){return me(i,t.ray.origin,le(i,t.ray.direction,e))}new j_(()=>QB());function TD(t){return t?[Ji(t[0]),Ji(t[1]),Ji(t[2]),Ji(t[3]),Ji(t[4]),Ji(t[5])]:[Ji(),Ji(),Ji(),Ji(),Ji(),Ji()]}function XDe(){return[P(),P(),P(),P(),P(),P(),P(),P()]}function cz(t,e){for(let i=0;i<yw.NUM;i++)GB(t[i],e[i])}function YDe(t,e,i,r=W_t){const n=$n(yae.get(),e,t);wa(n,n);for(let s=0;s<mee.NUM;++s){const o=Jh(gae.get(),q_t[s],n);he(r[s],o[0]/o[3],o[1]/o[3],o[2]/o[3])}ZDe(i,r)}function ZDe(t,e){sl(e[ct.FAR_BOTTOM_LEFT],e[ct.NEAR_BOTTOM_LEFT],e[ct.NEAR_TOP_LEFT],t[Or.LEFT]),sl(e[ct.NEAR_BOTTOM_RIGHT],e[ct.FAR_BOTTOM_RIGHT],e[ct.FAR_TOP_RIGHT],t[Or.RIGHT]),sl(e[ct.FAR_BOTTOM_LEFT],e[ct.FAR_BOTTOM_RIGHT],e[ct.NEAR_BOTTOM_RIGHT],t[Or.BOTTOM]),sl(e[ct.NEAR_TOP_LEFT],e[ct.NEAR_TOP_RIGHT],e[ct.FAR_TOP_RIGHT],t[Or.TOP]),sl(e[ct.NEAR_BOTTOM_LEFT],e[ct.NEAR_BOTTOM_RIGHT],e[ct.NEAR_TOP_RIGHT],t[Or.NEAR]),sl(e[ct.FAR_BOTTOM_RIGHT],e[ct.FAR_BOTTOM_LEFT],e[ct.FAR_TOP_LEFT],t[Or.FAR])}function Eb(t,e){for(let i=0;i<yw.NUM;i++){const r=t[i];if(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]>=e[3])return!1}return!0}function j_t(t,e){return KDe(t,z_t(e,QDe.get()))}function Tqt(t,e){for(let i=0;i<yw.NUM;i++){const r=t[i];if(!vyt(r,e))return!1}return!0}function G_t(t,e,i){return KDe(t,B_t(e,i,QDe.get()))}function JDe(t,e){for(let i=0;i<yw.NUM;i++)if(Pr(t[i],e)>0)return!1;return!0}function KDe(t,e){for(let i=0;i<yw.NUM;i++)if(!_yt(t[i],e))return!1;return!0}var Or,ct;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.TOP=3]="TOP",t[t.NEAR=4]="NEAR",t[t.FAR=5]="FAR"})(Or||(Or={})),function(t){t[t.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",t[t.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",t[t.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",t[t.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",t[t.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",t[t.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",t[t.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",t[t.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(ct||(ct={}));const H_t={bottom:[ct.FAR_BOTTOM_RIGHT,ct.NEAR_BOTTOM_RIGHT,ct.NEAR_BOTTOM_LEFT,ct.FAR_BOTTOM_LEFT],near:[ct.NEAR_BOTTOM_LEFT,ct.NEAR_BOTTOM_RIGHT,ct.NEAR_TOP_RIGHT,ct.NEAR_TOP_LEFT],far:[ct.FAR_BOTTOM_RIGHT,ct.FAR_BOTTOM_LEFT,ct.FAR_TOP_LEFT,ct.FAR_TOP_RIGHT],right:[ct.NEAR_BOTTOM_RIGHT,ct.FAR_BOTTOM_RIGHT,ct.FAR_TOP_RIGHT,ct.NEAR_TOP_RIGHT],left:[ct.FAR_BOTTOM_LEFT,ct.NEAR_BOTTOM_LEFT,ct.NEAR_TOP_LEFT,ct.FAR_TOP_LEFT],top:[ct.FAR_TOP_LEFT,ct.NEAR_TOP_LEFT,ct.NEAR_TOP_RIGHT,ct.FAR_TOP_RIGHT]};var yw,mee;(function(t){t[t.NUM=6]="NUM"})(yw||(yw={})),function(t){t[t.NUM=8]="NUM"}(mee||(mee={}));const q_t=[Zt(-1,-1,-1,1),Zt(1,-1,-1,1),Zt(1,1,-1,1),Zt(-1,1,-1,1),Zt(-1,-1,1,1),Zt(1,-1,1,1),Zt(1,1,1,1),Zt(-1,1,1,1)],QDe=new j_(QB),W_t=XDe();function X_t(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/e)}function Y_t(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/i)}function Z_t(t,e,i){return 2*Math.atan(e*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}function J_t(t,e,i){return 2*Math.atan(i*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}var gee;let Pt=gee=class extends ve{constructor(t={}){super(t),this._center=P(),this._up=P(),this._viewUp=P(),this._viewForward=P(),this._viewRight=P(),this._ray=ko(),this._viewport=Zt(0,0,1,1),this._padding=Zt(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=Mi(1,1e3),this._viewDirty=!0,this._viewMatrix=$e(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=$e(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=$e(),this._frustumDirty=!0,this._frustum=TD(),this._fullViewport=pi(),this._pixelRatio=1,this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center,"_center")}get ray(){return ge(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){go(this._viewMatrix,t),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get screenViewport(){if(this.pixelRatio===1)return this._viewport;const t=gO(pi(),this._viewport,1/this.pixelRatio),e=this._get("screenViewport");return e&&Ine(t,e)?e:t}get x(){return this._viewport[0]}set x(t){t+=this._padding[yi.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(t){t+=this._padding[yi.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[yi.RIGHT]+this._padding[yi.LEFT]}set fullWidth(t){this.width=t-(this._padding[yi.RIGHT]+this._padding[yi.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[yi.TOP]+this._padding[yi.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[yi.TOP]+this._padding[yi.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[yi.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[yi.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){RR(this._padding,t)||(this._viewport[0]+=t[yi.LEFT]-this._padding[yi.LEFT],this._viewport[1]+=t[yi.BOTTOM]-this._padding[yi.BOTTOM],this._viewport[2]-=t[yi.RIGHT]+t[yi.LEFT]-(this._padding[yi.RIGHT]+this._padding[yi.LEFT]),this._viewport[3]-=t[yi.TOP]+t[yi.BOTTOM]-(this._padding[yi.TOP]+this._padding[yi.BOTTOM]),Xf(this._padding,t),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&($n(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){const t=this.width,e=this.height,i=this.near*Math.tan(this.fovY/2),r=i*this._aspect,n=NAe($e(),-r*(1+2*this._padding[yi.LEFT]/t),r*(1+2*this._padding[yi.RIGHT]/t),-i*(1+2*this._padding[yi.BOTTOM]/e),i*(1+2*this._padding[yi.TOP]/e),this.near,this.far),s=this._get("projectionMatrix");return s&&use(s,n)?s:n}get inverseProjectionMatrix(){return wa($e(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||$e()}get fov(){return this._fov}set fov(t){this._fov=t,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return Z_t(this._fov,this.width,this.height)}set fovX(t){this._fov=X_t(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return J_t(this._fov,this.width,this.height)}set fovY(t){this._fov=Y_t(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return Lr(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(wa(this._viewInverseTransposeMatrix,this.viewMatrix),Ku(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const e=2*t-1;return 2*this.near*this.far/(this.far+this.near-e*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation!=null&&this.relativeElevation>=0}copyFrom(t){ce(this._ray.origin,t.eye),this.center=t.center,this.up=t.up,Xf(this._viewport,t.viewport),this.notifyChange("_viewport"),Xf(this._padding,t.padding),this.notifyChange("_padding"),io(this._nearFar,t.nearFar),this.notifyChange("_nearFar"),this._fov=t.fov,this.relativeElevation=t.relativeElevation;const e=t;return this._viewDirty=e._viewDirty,this._viewDirty||(go(this._viewMatrix,t.viewMatrix),ce(this._viewRight,t.viewRight),ce(this._viewUp,t.viewUp),ce(this._viewForward,t.viewForward)),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||(cz(this._frustum,t.frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(go(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),Xf(this._fullViewport,t.fullViewport),this.pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up}clone(){return new gee().copyFrom(this)}equals(t){return Xl(this.eye,t.eye)&&Xl(this.center,t.center)&&Xl(this.up,t.up)&&RR(this._viewport,t.viewport)&&RR(this._padding,t.padding)&&VIe(this.nearFar,t.nearFar)&&this._fov===t.fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation}almostEquals(t){if(Math.abs(t.fov-this._fov)>=.001||nV(t.padding,this._padding)>=.5||nV(this.screenViewport,t.screenViewport)>=.5)return!1;Fo(Za,t.eye,t.center),Fo(WH,this.eye,this.center);const e=be(Za,WH),i=iZ(Za),r=iZ(WH),n=5e-4;return e*e>=(1-1e-10)*i*r&&Rne(t.eye,this.eye)<Math.max(i,r)*n*n}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(q$(this.viewForward,ge(Za,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,e){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(e||1)))}getScreenCenter(t=Sn()){return t[0]=(this.padding[yi.LEFT]+this.width/2)/this.pixelRatio,t[1]=(this.padding[yi.TOP]+this.height/2)/this.pixelRatio,t}getRenderCenter(t,e=.5,i=.5){return t[0]=this.padding[yi.LEFT]+this.width*e,t[1]=this.padding[yi.BOTTOM]+this.height*i,t[2]=.5,t}setGLViewport(t){const e=this.viewport,i=this.padding;t.setViewport(e[0]-i[3],e[1]-i[2],e[2]+i[1]+i[3],e[3]+i[0]+i[2])}applyProjection(t,e){t!==gi&&ce(gi,t),gi[3]=1,Jh(gi,gi,this.projectionMatrix);const i=Math.abs(gi[3]);le(gi,gi,1/i);const r=this.fullViewport;e[0]=Bt(0,r[0]+r[2],.5+.5*gi[0]),e[1]=Bt(0,r[1]+r[3],.5+.5*gi[1]),e[2]=.5*(gi[2]+1),e[3]=i}unapplyProjection(t,e){const i=this.fullViewport;gi[0]=(t[0]/(i[0]+i[2])*2-1)*t[3],gi[1]=(t[1]/(i[1]+i[3])*2-1)*t[3],gi[2]=(2*t[2]-1)*t[3],gi[3]=t[3],this.inverseProjectionMatrix!=null&&(Jh(gi,gi,this.inverseProjectionMatrix),e[0]=gi[0],e[1]=gi[1],e[2]=gi[2])}projectToScreen(t,e){return this.projectToRenderScreen(t,XH),this.renderToScreen(XH,e),e}projectToRenderScreen(t,e){if(gi[0]=t[0],gi[1]=t[1],gi[2]=t[2],gi[3]=1,Jh(gi,gi,this.viewProjectionMatrix),gi[3]===0)return null;le(gi,gi,1/Math.abs(gi[3]));const i=this.fullViewport;return"x"in e?(e.x=Bt(0,i[0]+i[2],.5+.5*gi[0]),e.y=Bt(0,i[1]+i[3],.5+.5*gi[1])):(e[0]=Bt(0,i[0]+i[2],.5+.5*gi[0]),e[1]=Bt(0,i[1]+i[3],.5+.5*gi[1]),e.length>2&&(e[2]=.5*(gi[2]+1))),e}unprojectFromScreen(t,e){return this.unprojectFromRenderScreen(this.screenToRender(t,XH),e)}unprojectFromRenderScreen(t,e){if($n(W4,this.projectionMatrix,this.viewMatrix),!wa(W4,W4))return null;const i=this.fullViewport;return gi[0]=2*(t[0]-i[0])/i[2]-1,gi[1]=2*(t[1]-i[1])/i[3]-1,gi[2]=2*t[2]-1,gi[3]=1,Jh(gi,gi,W4),gi[3]===0?null:(e[0]=gi[0]/gi[3],e[1]=gi[1]/gi[3],e[2]=gi[2]/gi[3],e)}constrainWindowSize(t,e,i,r){const n=t*this.pixelRatio,s=e*this.pixelRatio,o=Math.max(n-i/2,0),a=Math.max(this.fullHeight-s-r/2,0),l=-Math.min(n-i/2,0),c=-Math.min(this.fullHeight-s-r/2,0);return[o,a,i-l- -Math.min(this.fullWidth-n-i/2,0),r-c- -Math.min(s-r/2,0)]}computeUp(t){t===qe.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,e){const i=t[0]*this.pixelRatio,r=this.fullHeight-t[1]*this.pixelRatio;return e[0]=i,e[1]=r,e}renderToScreen(t,e){const i=t[0]/this.pixelRatio,r=(this.fullHeight-t[1])/this.pixelRatio;e[0]=i,e[1]=r}_computeUpGlobal(){ge(Za,this.center,this.eye);const t=Pe(this.center);t<1?(he(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(be(Za,this.center))>.9999*Pe(Za)*t||(vt(this._up,Za,this.center),vt(this._up,this._up,Za),we(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){V_(Za,this.eye,this.center),Math.abs(Za[2])<=.9999&&(le(Za,Za,Za[2]),he(this._up,-Za[0],-Za[1],1-Za[2]),we(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(t,e,i=""){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?Xl(t,e)||(ce(e,t),this._markViewDirty(),i.length&&this.notifyChange(i)):re.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(YDe(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(oB(this._viewMatrix,this.eye,this.center,this.up),he(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),he(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),he(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};u([d()],Pt.prototype,"_center",void 0),u([d()],Pt.prototype,"_up",void 0),u([d()],Pt.prototype,"_viewport",void 0),u([d()],Pt.prototype,"_padding",void 0),u([d()],Pt.prototype,"_fov",void 0),u([d()],Pt.prototype,"_nearFar",void 0),u([d()],Pt.prototype,"_pixelRatio",void 0),u([d()],Pt.prototype,"pixelRatio",null),u([d()],Pt.prototype,"eye",null),u([d()],Pt.prototype,"center",null),u([d()],Pt.prototype,"up",null),u([d({readOnly:!0})],Pt.prototype,"nearFar",null),u([d()],Pt.prototype,"near",null),u([d()],Pt.prototype,"far",null),u([d()],Pt.prototype,"viewport",null),u([d({readOnly:!0})],Pt.prototype,"screenViewport",null),u([d()],Pt.prototype,"x",null),u([d()],Pt.prototype,"y",null),u([d()],Pt.prototype,"width",null),u([d()],Pt.prototype,"height",null),u([d()],Pt.prototype,"fullWidth",null),u([d()],Pt.prototype,"fullHeight",null),u([d({readOnly:!0})],Pt.prototype,"_aspect",null),u([d()],Pt.prototype,"padding",null),u([d({readOnly:!0})],Pt.prototype,"projectionMatrix",null),u([d({readOnly:!0})],Pt.prototype,"inverseProjectionMatrix",null),u([d()],Pt.prototype,"fov",null),u([d()],Pt.prototype,"fovX",null),u([d()],Pt.prototype,"fovY",null),Pt=gee=u([$("esri.views.3d.webgl-engine.lib.Camera")],Pt);const gi=pi(),W4=$e(),Za=P(),WH=P(),XH=ka();var yi;(function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT"})(yi||(yi={}));var Ee;(function(t){t[t.INTEGRATED_MESH=0]="INTEGRATED_MESH",t[t.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",t[t.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",t[t.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL",t[t.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN",t[t.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",t[t.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN",t[t.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL",t[t.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL",t[t.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",t[t.POSTPROCESSING_ENVIRONMENT_OPAQUE=10]="POSTPROCESSING_ENVIRONMENT_OPAQUE",t[t.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT",t[t.LASERLINES=12]="LASERLINES",t[t.LASERLINES_CONTRAST_CONTROL=13]="LASERLINES_CONTRAST_CONTROL",t[t.HUD_MATERIAL=14]="HUD_MATERIAL",t[t.LABEL_MATERIAL=15]="LABEL_MATERIAL",t[t.LINE_CALLOUTS=16]="LINE_CALLOUTS",t[t.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH",t[t.DRAPED_MATERIAL=18]="DRAPED_MATERIAL",t[t.DRAPED_WATER=19]="DRAPED_WATER",t[t.VOXEL=20]="VOXEL",t[t.MAX_SLOTS=21]="MAX_SLOTS"})(Ee||(Ee={}));var At;(function(t){t[t.Color=0]="Color",t[t.Alpha=1]="Alpha",t[t.FrontFace=2]="FrontFace",t[t.NONE=3]="NONE",t[t.COUNT=4]="COUNT"})(At||(At={}));let jae=class{constructor(e=P()){this.intensity=e}},eNe=class{constructor(e=P(),i=Ue(.57735,.57735,.57735)){this.intensity=e,this.direction=i}},uz=class{constructor(e=P(),i=Ue(.57735,.57735,.57735),r=!0,n=1,s=1){this.intensity=e,this.direction=i,this.castShadows=r,this.specularStrength=n,this.environmentStrength=s}},tNe=class{constructor(){this.r=[0],this.g=[0],this.b=[0]}};function K_t(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]*e[r];return i}function YH(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]*e;return i}function VR(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]+e[r];return i}function iNe(t){return(t+1)*(t+1)}function Q_t(t){return _e(Math.floor(Math.sqrt(t)-1),0,2)}function rNe(t,e,i){const r=t[0],n=t[1],s=t[2],o=i||[];return o.length=iNe(e),e>=0&&(o[0]=.28209479177),e>=1&&(o[1]=.4886025119*r,o[2]=.4886025119*s,o[3]=.4886025119*n),e>=2&&(o[4]=1.09254843059*r*n,o[5]=1.09254843059*n*s,o[6]=.31539156525*(3*s*s-1),o[7]=1.09254843059*r*s,o[8]=.54627421529*(r*r-n*n)),o}function evt(t,e){const i=iNe(t),r=e||{r:[],g:[],b:[]};r.r.length=r.g.length=r.b.length=i;for(let n=0;n<i;n++)r.r[n]=r.g[n]=r.b[n]=0;return r}function tvt(t,e){const i=Q_t(e.r.length);for(const r of t)pl(yee,r.direction),rNe(yee,i,G0),K_t(G0,OU),YH(G0,r.intensity[0],TE),VR(e.r,TE),YH(G0,r.intensity[1],TE),VR(e.g,TE),YH(G0,r.intensity[2],TE),VR(e.b,TE);return e}function ivt(t,e){rNe(yee,0,G0);for(const i of t)e.r[0]+=G0[0]*OU[0]*i.intensity[0]*4*Math.PI,e.g[0]+=G0[0]*OU[0]*i.intensity[1]*4*Math.PI,e.b[0]+=G0[0]*OU[0]*i.intensity[2]*4*Math.PI;return e}function rvt(t,e,i,r){evt(e,r),he(i.intensity,0,0,0);let n=!1;const s=nvt,o=svt,a=ovt;s.length=0,o.length=0,a.length=0;for(const l of t)l instanceof uz&&!n?(ce(i.direction,l.direction),ce(i.intensity,l.intensity),i.specularStrength=l.specularStrength,i.environmentStrength=l.environmentStrength,i.castShadows=l.castShadows,n=!0):l instanceof uz||l instanceof eNe?s.push(l):l instanceof jae?o.push(l):l instanceof tNe&&a.push(l);tvt(s,r),ivt(o,r);for(const l of a)VR(r.r,l.r),VR(r.g,l.g),VR(r.b,l.b)}const nvt=[],svt=[],ovt=[],G0=[0],TE=[0],yee=P(),OU=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];let Nye=class{constructor(){this.color=P(),this.intensity=1}},avt=class{constructor(){this.direction=P(),this.ambient=new Nye,this.diffuse=new Nye}};const nNe=.4;let ZH=class{constructor(){this._shOrder=2,this._legacy=new avt,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new tNe,this._mainLight=new uz(P(),Ue(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(e){rvt(e,this._shOrder,this._mainLight,this._sphericalHarmonics),ce(this._legacy.direction,this._mainLight.direction);const i=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*i,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*i,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*i,le(this._legacy.diffuse.color,this._mainLight.intensity,i),ce(X4,this._legacy.diffuse.color),le(X4,X4,nNe*this.globalFactor),me(this._legacy.ambient.color,this._legacy.ambient.color,X4)}copyFrom(e){this._sphericalHarmonics.r=Array.from(e.sh.r),this._sphericalHarmonics.g=Array.from(e.sh.g),this._sphericalHarmonics.b=Array.from(e.sh.b),this._mainLight.direction=In(e.mainLight.direction),this._mainLight.intensity=In(e.mainLight.intensity),this._mainLight.castShadows=e.mainLight.castShadows,this._mainLight.specularStrength=e.mainLight.specularStrength,this._mainLight.environmentStrength=e.mainLight.environmentStrength,this.globalFactor=e.globalFactor,this.noonFactor=e.noonFactor}lerpLighting(e,i,r){if(ys(this._mainLight.intensity,e.mainLight.intensity,i.mainLight.intensity,r),this._mainLight.environmentStrength=Bt(e.mainLight.environmentStrength,i.mainLight.environmentStrength,r),this._mainLight.specularStrength=Bt(e.mainLight.specularStrength,i.mainLight.specularStrength,r),ce(this._mainLight.direction,i.mainLight.direction),this._mainLight.castShadows=i.mainLight.castShadows,this.globalFactor=Bt(e.globalFactor,i.globalFactor,r),this.noonFactor=Bt(e.noonFactor,i.noonFactor,r),e.sh.r.length===i.sh.r.length)for(let n=0;n<i.sh.r.length;n++)this._sphericalHarmonics.r[n]=Bt(e.sh.r[n],i.sh.r[n],r),this._sphericalHarmonics.g[n]=Bt(e.sh.g[n],i.sh.g[n],r),this._sphericalHarmonics.b[n]=Bt(e.sh.b[n],i.sh.b[n],r);else for(let n=0;n<i.sh.r.length;n++)this._sphericalHarmonics.r[n]=i.sh.r[n],this._sphericalHarmonics.g[n]=i.sh.g[n],this._sphericalHarmonics.b[n]=i.sh.b[n]}};const X4=P();let e7=class{constructor(e,i,r){this.shadowMap=e,this.ssaoHelper=i,this.slicePlane=r,this.slot=Ee.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=At.NONE,this._camera=new Pt,this._inverseViewport=Fe(),this.oldLighting=new ZH,this.newLighting=new ZH,this._fadedLighting=new ZH,this._lighting=this.newLighting,this.ssr=new V_t,this.multipassTerrain=new k_t,this.multipassGeometry=new F_t,this.overlays=[],this.cloudsFade=new x_t}get camera(){return this._camera}set camera(e){this._camera=this.ssr.camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(e){const{oldLighting:i,newLighting:r}=this;e>=1?this._lighting=r:(this._fadedLighting.lerpLighting(i,r,e),this._lighting=this._fadedLighting)}},Ec=class extends ve{constructor(e){super(e),this._handles=new Xi,this._techniques=new Array,this._techniqueConfiguration=new MU,this._bindParameters=new e7(null,null,null),this._passParameters=new VDe,this._drawParameters=new zDe,this._weatherTile=Fe(),this._weatherTileCount=128,this._faceIndex=0,this._tileIndex=0,this.coverage=Bt(tl.default.coverage[0],tl.default.coverage[1],.5),this.density=Bt(tl.default.density[0],tl.default.density[1],.5),this.absorption=Bt(tl.default.absorption[0],tl.default.absorption[1],.5),this.cloudSize=Bt(tl.default.cloudSize[0],tl.default.cloudSize[1],.5),this.detailSize=Bt(tl.default.detailSize[0],tl.default.detailSize[1],.5),this.smoothness=Bt(tl.default.smoothness[0],tl.default.smoothness[1],.5),this.cloudHeight=Bt(tl.default.cloudHeight[0],tl.default.cloudHeight[1],.5),this.raymarchingSteps=tl.default.raymarchingSteps,this._viewMatrix=$e(),this._dirty=!1,this.running=!1}_getTechnique(e){const i=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,r=i===T2.RG?2*e:2*e+1;return this._techniques[r]||(this._techniqueConfiguration.writeTextureChannels=i,this._techniqueConfiguration.steps=e,this._techniques[r]=new BDe({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[r])}updateWeatherTile(){const e=this.view.camera.position.latitude,i=this.view.camera.position.longitude;if(e==null||i==null)return;dt(this._weatherTile,(e+90)/180,(i+180)/360);const r=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1));this._weatherTile[0]=Math.floor(2*this._weatherTileCount*this._weatherTile[0]),this._weatherTile[1]=Math.floor(4*(this._weatherTileCount-r)*this._weatherTile[1]);let n=0,s=0;if(v(this.view.environment)&&this.view.environment.lighting.type!=="virtual"&&v(this.view.environment.lighting.date)){const o=new Date(this.view.environment.lighting.date);o.setUTCHours(this.view.environment.lighting.date.getUTCHours()+(this.view.environment.lighting.displayUTCOffset??0)),n=31*o.getUTCMonth()+o.getUTCDate(),s=o.getUTCFullYear()}this._weatherTile[0]=(this._weatherTile[0]+n)%(2*this._weatherTileCount),this._weatherTile[1]=(this._weatherTile[1]+s%100)%(4*this._weatherTileCount),zIe(this._passParameters.weatherTile,this._weatherTile)||this.setDirty()}initialize(){this._vao=xl(this.context.renderContext.rctx);const e=sr(this.view.spatialReference);this._passParameters.cloudRadius=.5*e.radius,this.setDirty(),this.updateWeatherTile(),this._handles.add([this.view.resourceController.scheduler.registerTask(St.CLOUDS_GENERATOR,this),ne(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingSteps],()=>this.setDirty(),zt)])}destroy(){this._handles.destroy(),this._techniques.forEach(e=>nn(e)),this._frameBufferCube=rt(this._frameBufferCube),this._techniques.length=0,this._vao=rt(this._vao),this._passParameters.noiseTexture=Ve(this._passParameters.noiseTexture)}get _tilesPerFace(){switch(this._techniqueConfiguration.steps){case jc.SIXTEEN:return 1;case jc.HUNDRED:return 4;case jc.COUNT:case jc.TWOHUNDRED:return 8}}_ensureNoiseTexture(){if(v(this._passParameters.noiseTexture))this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile);else{const e=this.context;this._passParameters.noiseTexture=new FI({context:e}),this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile)}return v(this._passParameters.noiseTexture.textureAtlas)}_ensureFrameBufferCube(e){if(R(this._frameBufferCube)){const i={target:Ct.TEXTURE_CUBE_MAP,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE,samplingMode:nt.LINEAR,hasMipmap:!1,width:e,height:e};this._frameBufferCube=new es(this.context.renderContext.rctx,{colorTarget:En.CUBEMAP,width:e,height:e},i)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}destroyFrameBufferCube(){this._frameBufferCube=rt(this._frameBufferCube)}applyPreset(e,i){const r=e.median,n=s=>{const o=Bt(s[0],s[1],r);return i<.5?Bt(s[0],o,2*i):Bt(o,s[1],2*(i-.5))};this.coverage=n(e.coverage),this.density=n(e.density),this.absorption=n(e.absorption),this.cloudSize=n(e.cloudSize),this.detailSize=n(e.detailSize),this.smoothness=n(e.smoothness),this.cloudHeight=n(e.cloudHeight),this.raymarchingSteps=e.raymarchingSteps}setDirty(){this._dirty=this.running=!0}runTask(e){if(R(this._vao))return this._dirty=this.running=!1,this.context.renderContext.bindParameters.cloudsFade.renderingStage=Xn.FINISHED_RENDERING,void e.madeProgress();this._faceIndex===0&&this._tileIndex===0&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,this.updateWeatherTile(),io(this._passParameters.weatherTile,this._weatherTile));const i=this._getTechnique(this._passParameters.raymarchingSteps);if(!i.compiled||!this.context.renderContext.bindParameters.cloudsFade.isCameraPositionFinal||this.context.renderContext.bindParameters.cloudsFade.isFading||!this._ensureNoiseTexture())return Ga.YIELD;this._faceIndex===0&&this._tileIndex===0&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=Xn.RENDERING,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._dirty=!1);const r=this.context.renderContext.rctx,n=r.bindTechnique(i,this._passParameters,this._bindParameters);r.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao);const s=r.getViewport(),o=i.configuration.cubeMapSize,a=o/this._tilesPerFace,l=this._tileIndex*a;r.setViewport(0,l,o,a);const c=this._ensureFrameBufferCube(o);r.bindFramebuffer(c);const h=lvt[this._faceIndex],p=cvt[this._faceIndex];kAe(this._viewMatrix,uvt,h,p),Dp(this._drawParameters.viewMatrix,this._viewMatrix);const f=Ct.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex;return c.setColorTextureTarget(f),n.bindDraw(this._drawParameters,this._bindParameters,this._passParameters),r.gl.drawArrays(r.gl.TRIANGLE_STRIP,0,4),r.gl.flush(),r.setViewport(s.x,s.y,s.width,s.height),this.requestRender(),++this._tileIndex,this._faceIndex===4&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._faceIndex=0,this._tileIndex=0,this.context.renderContext.bindParameters.cloudsFade.renderingStage=Xn.FINISHED_RENDERING):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0),e.madeProgress(),Ga.YIELD}};u([d({constructOnly:!0})],Ec.prototype,"context",void 0),u([d({constructOnly:!0})],Ec.prototype,"view",void 0),u([d({constructOnly:!0})],Ec.prototype,"requestRender",void 0),u([d()],Ec.prototype,"coverage",void 0),u([d()],Ec.prototype,"density",void 0),u([d()],Ec.prototype,"absorption",void 0),u([d()],Ec.prototype,"cloudSize",void 0),u([d()],Ec.prototype,"detailSize",void 0),u([d()],Ec.prototype,"smoothness",void 0),u([d()],Ec.prototype,"cloudHeight",void 0),u([d()],Ec.prototype,"raymarchingSteps",void 0),u([d()],Ec.prototype,"running",void 0),Ec=u([$("esri.views.3d.environment.CloudsGenerator")],Ec);const lvt=[rr(1,0,0),rr(-1,0,0),rr(0,1,0),rr(0,-1,0),rr(0,0,1)],cvt=[rr(0,1,0),rr(0,1,0),rr(0,0,-1),rr(0,0,1),rr(0,1,0)],uvt=Fae();let Gae=class extends Tr{constructor(){super(...arguments),this.fogColor=P(),this.hazeColor=P(),this.fogStrength=4e-6,this.hazeStrength=4e-6,this.atmosphereC=1,this.fogAmount=0,this.hazeAmount=0}};function hvt(t){const e=new ji;e.attributes.add(M.POSITION,"vec2"),e.include(iy,{textureCoordinateType:ds.Default}),e.varyings.add("worldRay","vec3"),e.varyings.add("eyeDir","vec3");const{vertex:i,fragment:r}=e;return i.uniforms.add([new on("inverseProjectionMatrix",(n,s)=>s.camera.inverseProjectionMatrix),new on("inverseViewMatrix",(n,s)=>TO(dvt,s.camera.viewMatrix))]),i.code.add(S`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add(new Ie("atmosphereC",n=>n.atmosphereC)),r.uniforms.add(new Jt("cameraPosition",(n,s)=>s.camera.eye)),r.uniforms.add(new Wi("nearFar",(n,s)=>s.camera.nearFar)),r.uniforms.add(new Dt("depthTex",n=>n.depthTexture)),r.uniforms.add(new Ie("fogStrength",n=>t.haze?n.hazeStrength:n.fogStrength)),r.uniforms.add(new Ie("fogAmount",n=>t.haze?n.hazeAmount:n.fogAmount)),r.uniforms.add(new Jt("fogColor",n=>t.haze?n.hazeColor:n.fogColor)),e.include(ZB),r.include(ud),r.code.add(S`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(S`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),r.code.add(S`
    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;

      float depthSample = texture2D(depthTex, vuv0).r;
      float zNorm = 2.0 * depthSample - 1.0;
      float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
      if(depthSample < 1.0 && depthSample > 0.0){
        vec3 cameraSpaceRay = normalize(eyeDir);
        cameraSpaceRay /= cameraSpaceRay.z;
        cameraSpaceRay *= linDepth;
        terrainDepth = max(0.0, length(cameraSpaceRay));
      }

      ${t.haze?S`
          if(terrainDepth == -1.0){
            gl_FragColor = vec4(0);
            return;
          }`:""}

      vec4 fog = applyFog(terrainDepth, rayDir);

      gl_FragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
    }
  `),e}const dvt=$e(),sNe=Object.freeze(Object.defineProperty({__proto__:null,FogHazePassParameters:Gae,build:hvt},Symbol.toStringTag,{value:"Module"}));let oNe=class aNe extends Yi{initializeProgram(e){return new Hi(e.rctx,aNe.shader.get().build(this.configuration),Di)}initializePipeline(){return this.configuration.haze?Ht({blending:_o(Ce.ONE,Ce.ZERO,Ce.ONE_MINUS_SRC_COLOR,Ce.ONE),colorWrite:si}):Ht({blending:_o(Ce.SRC_ALPHA,Ce.ZERO,Ce.ONE_MINUS_SRC_ALPHA,Ce.ONE),colorWrite:si})}};oNe.shader=new Gi(sNe,()=>Q(()=>import("./FogHaze.glsl-34ab975f.js"),[]));let Hae=class extends wl{constructor(){super(...arguments),this.haze=!1}};u([j()],Hae.prototype,"haze",void 0);const pvt=.95,fvt=1;let kI=class extends ve{constructor(e){super(e),this._passParameters=new Gae;const i=e.context.renderContext.rctx;this._vao=xl(i,kO),this._technique=e.context.techniqueRepository.acquire(oNe,new Hae);const r=sr(e.view.spatialReference);this._planetRadius=r.radius,this._atmosphereRadius=r.radius+bD}destroy(){this._technique.release(),this._vao.dispose()}set strength(e){this._passParameters.fogStrength=e}get strength(){return this._passParameters.fogStrength}render(e,i){if(this._update(e,i),this._passParameters.fogAmount<=0)return;const r=this._technique;if(!r.compiled)return void this.context.requestRender();const n=e.offscreenRenderingHelper;n.renderDepthDetached(()=>{this._passParameters.depthTexture=n.depthTexture;const s=e.rctx.bindTechnique(r,this._passParameters,e.bindParameters);this._renderFog(s,e)})}_renderFog(e,i){const r=i.rctx;r.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(Ft.TRIANGLE_STRIP,0,4)}_update(e,i){const r=e.bindParameters.camera;we(Fye,r.eye);const n=Math.max(0,be(Fye,e.bindParameters.lighting.mainLight.direction)),s=i.color;le(kye,s,.1),ys(this._passParameters.fogColor,kye,s,n);const o=Pe(r.eye),a=o*o;this._passParameters.atmosphereC=a-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.fogAmount=(1-bM(pvt*Kd,fvt*Kd,Math.abs(o-this._planetRadius)))*i.amount,this._passParameters.fogStrength=i.strength}static isSupported(e){return e.capabilities.depthTexture}};u([d({constructOnly:!0})],kI.prototype,"context",void 0),u([d({constructOnly:!0})],kI.prototype,"view",void 0),kI=u([$("esri.views.3d.environment.Fog")],kI);let mvt=class{constructor(){this.color=P(),this.strength=0,this.amount=0}};const Fye=P(),kye=P();let Do=class extends wl{constructor(){super(...arguments),this.hasWebGL2Context=!1}};u([j({constValue:!0})],Do.prototype,"hasSliceHighlight",void 0),u([j({constValue:!1})],Do.prototype,"hasSliceInVertexProgram",void 0),u([j({constValue:!1})],Do.prototype,"instancedDoublePrecision",void 0),u([j({constValue:!1})],Do.prototype,"useLegacyTerrainShading",void 0),u([j({constValue:!1})],Do.prototype,"hasModelTransformation",void 0),u([j({constValue:br.Pass})],Do.prototype,"pbrTextureBindType",void 0),u([j()],Do.prototype,"hasWebGL2Context",void 0);var _y;(function(t){t[t.Cone=0]="Cone",t[t.Cylinder=1]="Cylinder",t[t.Underground=2]="Underground",t[t.COUNT=3]="COUNT"})(_y||(_y={}));let qae=class extends Do{constructor(){super(...arguments),this.geometry=_y.Cone}};u([j({count:_y.COUNT})],qae.prototype,"geometry",void 0);var z;(function(t){t[t.Color=0]="Color",t[t.Depth=1]="Depth",t[t.Normal=2]="Normal",t[t.Shadow=3]="Shadow",t[t.ShadowHighlight=4]="ShadowHighlight",t[t.ShadowExcludeHighlight=5]="ShadowExcludeHighlight",t[t.Highlight=6]="Highlight",t[t.Alpha=7]="Alpha",t[t.ObjectAndLayerIdColor=8]="ObjectAndLayerIdColor",t[t.COUNT=9]="COUNT"})(z||(z={}));function WN(t){t.attributes.add(M.POSITION,"vec3"),t.vertex.code.add(S`vec3 positionModel() { return position; }`)}function hz({code:t},e){e.doublePrecisionRequiresObfuscation?t.add(S`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):t.add(S`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}let Ay=class extends Fn{constructor(e,i){super(e,"mat3",br.Pass,(r,n,s)=>r.setUniformMatrix3fv(e,i(n,s)))}};function zR(t,e){t.include(WN);const i=t.vertex;i.include(hz,e),t.varyings.add("vPositionWorldCameraRelative","vec3"),t.varyings.add("vPosition_view","vec3"),i.uniforms.add([new Jt("transformWorldFromViewTH",r=>r.transformWorldFromViewTH),new Jt("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new Ay("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new on("transformProjFromView",r=>r.transformProjFromView),new xD("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new rd("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new rd("transformWorldFromModelTL",r=>r.transformWorldFromModelTL)]),i.code.add(S`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),i.code.add(S`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${e.spherical?S`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:S`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),t.fragment.uniforms.add(new Jt("transformWorldFromViewTL",r=>r.transformWorldFromViewTL)),i.code.add(S`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),t.fragment.code.add(S`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}let lNe=class extends Tr{constructor(){super(...arguments),this.transformWorldFromViewTH=P(),this.transformWorldFromViewTL=P(),this.transformViewFromCameraRelativeRS=wr(),this.transformProjFromView=$e()}},cNe=class extends Tr{constructor(){super(...arguments),this.transformWorldFromModelRS=wr(),this.transformWorldFromModelTH=rn(),this.transformWorldFromModelTL=rn()}};function _w(t){t.varyings.add("linearDepth","float")}function S2(t){t.vertex.uniforms.add(new Wi("nearFar",(e,i)=>i.camera.nearFar))}function t7(t){t.vertex.code.add(S`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function UO(t,e){const{vertex:i}=t;switch(e.output){case z.Color:if(e.receiveShadows)return _w(t),void i.code.add(S`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case z.Depth:case z.Shadow:case z.ShadowHighlight:case z.ShadowExcludeHighlight:return t.include(zR,e),_w(t),S2(t),t7(t),void i.code.add(S`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}i.code.add(S`void forwardLinearDepth() {}`)}function Gc(t,e){if(t7(t),e.hasModelTransformation)return t.vertex.code.add(S`vec4 transformPositionWithDepth(mat4 proj, mat4 view, mat4 model, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * (model * vec4(pos, 1.0));
depth = calculateLinearDepth(nearFar, eye.z);
return proj * eye;
}`),void t.vertex.code.add(S`vec4 transformPosition(mat4 proj, mat4 view, mat4 model, vec3 pos) {
return proj * (view * (model * vec4(pos, 1.0)));
}`);t.vertex.code.add(S`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),t.vertex.code.add(S`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}let Wae=class extends Tr{constructor(){super(...arguments),this.texV=Fe(),this.altitudeFade=0,this.innerScale=0,this.undergroundFadeAlpha=0,this.silhouette=new uNe}},uNe=class{constructor(){this.center=P(),this.v1=P(),this.v2=P()}};function gvt(t){const e=new ji,{vertex:i,fragment:r}=e;if(H_(i),t.geometry===_y.Underground)e.attributes.add(M.POSITION,"vec2"),e.varyings.add("color","vec4"),i.uniforms.add([new Jt("cameraPosition",(n,s)=>s.camera.eye),new Ie("undergroundFadeAlpha",n=>n.undergroundFadeAlpha)]),i.code.add(S`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),r.code.add(S`void main() {
gl_FragColor = color;
}`);else{e.include(Gc,t),e.attributes.add(M.POSITION,"vec3"),e.varyings.add("vtc","vec2"),e.varyings.add("falloff","float");const n=t.geometry===_y.Cylinder;i.uniforms.add([new on("proj",(a,l)=>l.camera.projectionMatrix),new on("view",(a,l)=>l.camera.viewMatrix)]),n||(e.varyings.add("innerFactor","float"),i.uniforms.add(new Jt("silCircleCenter",a=>a.silhouette.center)),i.uniforms.add(new Jt("silCircleV1",a=>a.silhouette.v1)),i.uniforms.add(new Jt("silCircleV2",a=>a.silhouette.v2)),i.uniforms.add(new Wi("texV",a=>a.texV)),i.uniforms.add(new Ie("innerScale",a=>a.innerScale)));const s=6.2831853,o=1/128;i.code.add(S`
		void main(void) {
      ${n?S`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:S`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${S.float(s*o)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${S.float(o)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),r.uniforms.add(new Dt("tex",a=>a.texture)),n||r.uniforms.add(new Ie("altitudeFade",a=>a.altitudeFade)),r.code.add(S`
		void main() {
			vec4 atmosphereColor = texture2D(tex, vtc) * falloff;
      ${n?S`gl_FragColor = atmosphereColor;`:S`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			gl_FragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return e}const yvt=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:uNe,SimpleAtmospherePassParameters:Wae,build:gvt},Symbol.toStringTag,{value:"Module"}));let dz=class hNe extends Yi{initializeProgram(e){return new Hi(e.rctx,hNe.shader.get().build(this.configuration),Di)}initializePipeline(){return this.configuration.geometry===_y.Cylinder?Ht({blending:_o(Ce.SRC_ALPHA,Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA,Ce.ONE_MINUS_SRC_ALPHA),culling:$ae,depthTest:{func:Gr.LEQUAL},colorWrite:si}):Ht({blending:_o(Ce.SRC_ALPHA,Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA,Ce.ONE_MINUS_SRC_ALPHA),depthTest:{func:Gr.LEQUAL},colorWrite:si})}};dz.shader=new Gi(yvt,()=>Q(()=>import("./SimpleAtmosphere.glsl-58c839eb.js"),[]));const dNe=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);function sh(t,e=0){const i=t.stride;return t.fieldNames.filter(r=>{const n=t.fields.get(r).optional;return!(n&&n.glPadding)}).map(r=>{const n=t.fields.get(r),s=n.constructor.ElementCount,o=_vt(n.constructor.ElementType),a=n.offset,l=!(!n.optional||!n.optional.glNormalized);return new xa(r,s,o,a,i,l,e)})}function _vt(t){const e=vvt[t];if(e)return e;throw new Error("BufferType not supported in WebGL")}const vvt={u8:ft.UNSIGNED_BYTE,u16:ft.UNSIGNED_SHORT,u32:ft.UNSIGNED_INT,i8:ft.BYTE,i16:ft.SHORT,i32:ft.INT,f32:ft.FLOAT};let Xae=class{constructor(e,i,r=0,n,s){this.TypedArrayConstructor=e,this.elementCount=9;const o=this.TypedArrayConstructor;n===void 0&&(n=9*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=s==null?new o(i,a):new o(i,a,(s-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const n=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,n,this.stride,n+r*this.stride)}getMat(e,i){let r=e*this.typedBufferStride;for(let n=0;n<9;n++)i[n]=this.typedBuffer[r++];return i}setMat(e,i){let r=e*this.typedBufferStride;for(let n=0;n<9;n++)this.typedBuffer[r++]=i[n]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}copyFrom(e,i,r){const n=this.typedBuffer,s=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;for(let l=0;l<9;++l)n[o++]=s[a++]}get buffer(){return this.typedBuffer.buffer}};Xae.ElementCount=9;let Yae=class{constructor(e,i,r=0,n,s){this.TypedArrayConstructor=e,this.elementCount=16;const o=this.TypedArrayConstructor;n===void 0&&(n=16*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=s==null?new o(i,a):new o(i,a,(s-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const n=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,n,this.stride,n+r*this.stride)}getMat(e,i){let r=e*this.typedBufferStride;for(let n=0;n<16;n++)i[n]=this.typedBuffer[r++];return i}setMat(e,i){let r=e*this.typedBufferStride;for(let n=0;n<16;n++)this.typedBuffer[r++]=i[n]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}copyFrom(e,i,r){const n=this.typedBuffer,s=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;for(let l=0;l<16;++l)n[o++]=s[a++]}get buffer(){return this.typedBuffer.buffer}};Yae.ElementCount=16;let X_=class{constructor(e,i,r=0,n,s){this.TypedArrayConstructor=e,this.elementCount=1;const o=this.TypedArrayConstructor;n===void 0&&(n=o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=s==null?new o(i,a):new o(i,a,(s-r)/o.BYTES_PER_ELEMENT),this.stride=n,this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(e,i,r=this.count-i){const n=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,n,this.stride,n+r*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,i){this.typedBuffer[e*this.typedBufferStride]=i}get buffer(){return this.typedBuffer.buffer}};X_.ElementCount=1;let Y_=class{constructor(e,i,r=0,n,s){this.TypedArrayConstructor=e,this.elementCount=2;const o=this.TypedArrayConstructor;n===void 0&&(n=2*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=s==null?new o(i,a):new o(i,a,(s-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const n=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,n,this.stride,n+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,dt(i,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e]=i[1]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e]=r}copyFrom(e,i,r){const n=this.typedBuffer,s=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;n[o++]=s[a++],n[o]=s[a]}get buffer(){return this.typedBuffer.buffer}};Y_.ElementCount=2;let Z_=class{constructor(e,i,r=0,n,s){this.TypedArrayConstructor=e,this.elementCount=3;const o=this.TypedArrayConstructor;n===void 0&&(n=3*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=s==null?new o(i,a):new o(i,a,(s-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const n=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,n,this.stride,n+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,he(i,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e++]=i[1],this.typedBuffer[e]=i[2]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r,n){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e++]=r,this.typedBuffer[e]=n}copyFrom(e,i,r){const n=this.typedBuffer,s=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;n[o++]=s[a++],n[o++]=s[a++],n[o]=s[a]}get buffer(){return this.typedBuffer.buffer}};Z_.ElementCount=3;let J_=class{constructor(e,i,r=0,n,s){this.TypedArrayConstructor=e,this.start=r,this.elementCount=4;const o=this.TypedArrayConstructor;n===void 0&&(n=4*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=s==null?new o(i,a):new o(i,a,(s-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const n=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,n,this.stride,n+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,cr(i,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e++]=i[1],this.typedBuffer[e++]=i[2],this.typedBuffer[e]=i[3]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r,n,s){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e++]=r,this.typedBuffer[e++]=n,this.typedBuffer[e]=s}copyFrom(e,i,r){const n=this.typedBuffer,s=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;n[o++]=s[a++],n[o++]=s[a++],n[o++]=s[a++],n[o]=s[a]}get buffer(){return this.typedBuffer.buffer}};J_.ElementCount=4;let Zae=class pNe extends X_{constructor(e,i=0,r,n){super(Float32Array,e,i,r,n),this.elementType="f32"}static fromTypedArray(e,i){return new pNe(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Zae.ElementType="f32";let K_=class _ee extends Y_{constructor(e,i=0,r,n){super(Float32Array,e,i,r,n),this.elementType="f32"}slice(e,i){return this.sliceBuffer(_ee,e,i)}static fromTypedArray(e,i){return new _ee(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};K_.ElementType="f32";let jr=class vee extends Z_{constructor(e,i=0,r,n){super(Float32Array,e,i,r,n),this.elementType="f32"}slice(e,i){return this.sliceBuffer(vee,e,i)}static fromTypedArray(e,i){return new vee(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};jr.ElementType="f32";let eh=class bee extends J_{constructor(e,i=0,r,n){super(Float32Array,e,i,r,n),this.elementType="f32"}slice(e,i){return this.sliceBuffer(bee,e,i)}static fromTypedArray(e,i){return new bee(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};eh.ElementType="f32";let vw=class wee extends Xae{constructor(e,i=0,r,n){super(Float32Array,e,i,r,n),this.elementType="f32"}slice(e,i){return this.sliceBuffer(wee,e,i)}static fromTypedArray(e,i){return new wee(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};vw.ElementType="f32";let Jae=class xee extends Xae{constructor(e,i=0,r,n){super(Float64Array,e,i,r,n),this.elementType="f64"}slice(e,i){return this.sliceBuffer(xee,e,i)}static fromTypedArray(e,i){return new xee(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Jae.ElementType="f64";let Kae=class Tee extends Yae{constructor(e,i=0,r,n){super(Float32Array,e,i,r,n),this.elementType="f32"}slice(e,i){return this.sliceBuffer(Tee,e,i)}static fromTypedArray(e,i){return new Tee(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Kae.ElementType="f32";let SD=class See extends Yae{constructor(e,i=0,r,n){super(Float64Array,e,i,r,n),this.elementType="f64"}slice(e,i){return this.sliceBuffer(See,e,i)}static fromTypedArray(e,i){return new See(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};SD.ElementType="f64";let Qae=class Eee extends X_{constructor(e,i=0,r,n){super(Float64Array,e,i,r,n),this.elementType="f64"}slice(e,i){return this.sliceBuffer(Eee,e,i)}static fromTypedArray(e,i){return new Eee(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Qae.ElementType="f64";let ele=class Cee extends Y_{constructor(e,i=0,r,n){super(Float64Array,e,i,r,n),this.elementType="f64"}slice(e,i){return this.sliceBuffer(Cee,e,i)}static fromTypedArray(e,i){return new Cee(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};ele.ElementType="f64";let _l=class Aee extends Z_{constructor(e,i=0,r,n){super(Float64Array,e,i,r,n),this.elementType="f64"}slice(e,i){return this.sliceBuffer(Aee,e,i)}static fromTypedArray(e,i){return new Aee(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};_l.ElementType="f64";let i7=class Ree extends J_{constructor(e,i=0,r,n){super(Float64Array,e,i,r,n),this.elementType="f64"}slice(e,i){return this.sliceBuffer(Ree,e,i)}static fromTypedArray(e,i){return new Ree(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};i7.ElementType="f64";let YM=class Mee extends X_{constructor(e,i=0,r,n){super(Uint8Array,e,i,r,n),this.elementType="u8"}slice(e,i){return this.sliceBuffer(Mee,e,i)}static fromTypedArray(e,i){return new Mee(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};YM.ElementType="u8";let r7=class Oee extends Y_{constructor(e,i=0,r,n){super(Uint8Array,e,i,r,n),this.elementType="u8"}slice(e,i){return this.sliceBuffer(Oee,e,i)}static fromTypedArray(e,i){return new Oee(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};r7.ElementType="u8";let ED=class Pee extends Z_{constructor(e,i=0,r,n){super(Uint8Array,e,i,r,n),this.elementType="u8"}slice(e,i){return this.sliceBuffer(Pee,e,i)}static fromTypedArray(e,i){return new Pee(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};ED.ElementType="u8";let vl=class Iee extends J_{constructor(e,i=0,r,n){super(Uint8Array,e,i,r,n),this.elementType="u8"}slice(e,i){return this.sliceBuffer(Iee,e,i)}static fromTypedArray(e,i){return new Iee(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};vl.ElementType="u8";let n7=class $ee extends X_{constructor(e,i=0,r,n){super(Uint16Array,e,i,r,n),this.elementType="u16"}slice(e,i){return this.sliceBuffer($ee,e,i)}static fromTypedArray(e,i){return new $ee(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};n7.ElementType="u16";let tle=class Lee extends Y_{constructor(e,i=0,r,n){super(Uint16Array,e,i,r,n),this.elementType="u16"}slice(e,i){return this.sliceBuffer(Lee,e,i)}static fromTypedArray(e,i){return new Lee(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};tle.ElementType="u16";let s7=class Dee extends Z_{constructor(e,i=0,r,n){super(Uint16Array,e,i,r,n),this.elementType="u16"}slice(e,i){return this.sliceBuffer(Dee,e,i)}static fromTypedArray(e,i){return new Dee(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};s7.ElementType="u16";let XN=class Nee extends J_{constructor(e,i=0,r,n){super(Uint16Array,e,i,r,n),this.elementType="u16"}slice(e,i){return this.sliceBuffer(Nee,e,i)}static fromTypedArray(e,i){return new Nee(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};XN.ElementType="u16";let o7=class Fee extends X_{constructor(e,i=0,r,n){super(Uint32Array,e,i,r,n),this.elementType="u32"}slice(e,i){return this.sliceBuffer(Fee,e,i)}static fromTypedArray(e,i){return new Fee(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};o7.ElementType="u32";let ile=class kee extends Y_{constructor(e,i=0,r,n){super(Uint32Array,e,i,r,n),this.elementType="u32"}slice(e,i){return this.sliceBuffer(kee,e,i)}static fromTypedArray(e,i){return new kee(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};ile.ElementType="u32";let fNe=class Uee extends Z_{constructor(e,i=0,r,n){super(Uint32Array,e,i,r,n),this.elementType="u32"}slice(e,i){return this.sliceBuffer(Uee,e,i)}static fromTypedArray(e,i){return new Uee(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};fNe.ElementType="u32";let mNe=class Vee extends J_{constructor(e,i=0,r,n){super(Uint32Array,e,i,r,n),this.elementType="u32"}slice(e,i){return this.sliceBuffer(Vee,e,i)}static fromTypedArray(e,i){return new Vee(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};mNe.ElementType="u32";let rle=class zee extends X_{constructor(e,i=0,r,n){super(Int8Array,e,i,r,n),this.elementType="i8"}slice(e,i){return this.sliceBuffer(zee,e,i)}static fromTypedArray(e,i){return new zee(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};rle.ElementType="i8";let a7=class Bee extends Y_{constructor(e,i=0,r,n){super(Int8Array,e,i,r,n),this.elementType="i8"}slice(e,i){return this.sliceBuffer(Bee,e,i)}static fromTypedArray(e,i){return new Bee(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};a7.ElementType="i8";let gNe=class jee extends Z_{constructor(e,i=0,r,n){super(Int8Array,e,i,r,n),this.elementType="i8"}slice(e,i){return this.sliceBuffer(jee,e,i)}static fromTypedArray(e,i){return new jee(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};gNe.ElementType="i8";let yNe=class Gee extends J_{constructor(e,i=0,r,n){super(Int8Array,e,i,r,n),this.elementType="i8"}slice(e,i){return this.sliceBuffer(Gee,e,i)}static fromTypedArray(e,i){return new Gee(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};yNe.ElementType="i8";let _Ne=class Hee extends X_{constructor(e,i=0,r,n){super(Int16Array,e,i,r,n),this.elementType="i16"}slice(e,i){return this.sliceBuffer(Hee,e,i)}static fromTypedArray(e,i){return new Hee(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};_Ne.ElementType="i16";let l7=class qee extends Y_{constructor(e,i=0,r,n){super(Int16Array,e,i,r,n),this.elementType="i16"}slice(e,i){return this.sliceBuffer(qee,e,i)}static fromTypedArray(e,i){return new qee(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};l7.ElementType="i16";let vNe=class Wee extends Z_{constructor(e,i=0,r,n){super(Int16Array,e,i,r,n),this.elementType="i16"}slice(e,i){return this.sliceBuffer(Wee,e,i)}static fromTypedArray(e,i){return new Wee(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};vNe.ElementType="i16";let bNe=class Xee extends J_{constructor(e,i=0,r,n){super(Int16Array,e,i,r,n),this.elementType="i16"}slice(e,i){return this.sliceBuffer(Xee,e,i)}static fromTypedArray(e,i){return new Xee(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};bNe.ElementType="i16";let wNe=class Yee extends X_{constructor(e,i=0,r,n){super(Int32Array,e,i,r,n),this.elementType="i32"}slice(e,i){return this.sliceBuffer(Yee,e,i)}static fromTypedArray(e,i){return new Yee(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};wNe.ElementType="i32";let xNe=class Zee extends Y_{constructor(e,i=0,r,n){super(Int32Array,e,i,r,n),this.elementType="i32"}slice(e,i){return this.sliceBuffer(Zee,e,i)}static fromTypedArray(e,i){return new Zee(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};xNe.ElementType="i32";let TNe=class Jee extends Z_{constructor(e,i=0,r,n){super(Int32Array,e,i,r,n),this.elementType="i32"}slice(e,i){return this.sliceBuffer(Jee,e,i)}static fromTypedArray(e,i){return new Jee(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};TNe.ElementType="i32";let SNe=class Kee extends J_{constructor(e,i=0,r,n){super(Int32Array,e,i,r,n),this.elementType="i32"}slice(e,i){return this.sliceBuffer(Kee,e,i)}static fromTypedArray(e,i){return new Kee(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};SNe.ElementType="i32";function ENe(t){switch(t){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}function bvt(t){switch(t){case"u8":case"u16":case"u32":return!1;case"i8":case"i16":case"i32":case"f32":case"f64":return!0}}function wvt(t){switch(t){case"u8":case"u16":case"u32":case"i8":case"i16":case"i32":return!0;case"f32":case"f64":return!1}}function xvt(t){switch(t){case"u8":return 255;case"u16":return 65535;case"u32":return 4294967295;case"i8":return 127;case"i16":return 32767;case"i32":return 2147483647;case"f32":return 3402823e32;case"f64":return 179769e303}}let Uye=class CNe{constructor(e,i){this.layout=e,this.buffer=typeof i=="number"?new ArrayBuffer(i*e.stride):i;for(const r of e.fieldNames){const n=e.fields.get(r);this[r]=new n.constructor(this.buffer,n.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,i){const r=this[e];return r&&r.elementCount===i.ElementCount&&r.elementType===i.ElementType?r:null}slice(e,i){return new CNe(this.layout,this.buffer.slice(e*this.stride,i*this.stride))}copyFrom(e,i,r,n){const s=this.stride;if(s%4==0){const o=new Uint32Array(e.buffer,i*s,n*s/4);new Uint32Array(this.buffer,r*s,n*s/4).set(o)}else{const o=new Uint8Array(e.buffer,i*s,n*s);new Uint8Array(this.buffer,r*s,n*s).set(o)}}},Tvt=class ANe{constructor(){this.stride=0,this.fields=new Map,this.fieldNames=[]}vec2f(e,i){return this._appendField(e,K_,i),this}vec2f64(e,i){return this._appendField(e,ele,i),this}vec3f(e,i){return this._appendField(e,jr,i),this}vec3f64(e,i){return this._appendField(e,_l,i),this}vec4f(e,i){return this._appendField(e,eh,i),this}vec4f64(e,i){return this._appendField(e,i7,i),this}mat3f(e,i){return this._appendField(e,vw,i),this}mat3f64(e,i){return this._appendField(e,Jae,i),this}mat4f(e,i){return this._appendField(e,Kae,i),this}mat4f64(e,i){return this._appendField(e,SD,i),this}vec4u8(e,i){return this._appendField(e,vl,i),this}f32(e,i){return this._appendField(e,Zae,i),this}f64(e,i){return this._appendField(e,Qae,i),this}u8(e,i){return this._appendField(e,YM,i),this}u16(e,i){return this._appendField(e,n7,i),this}i8(e,i){return this._appendField(e,rle,i),this}vec2i8(e,i){return this._appendField(e,a7,i),this}vec2i16(e,i){return this._appendField(e,l7,i),this}vec2u8(e,i){return this._appendField(e,r7,i),this}vec4u16(e,i){return this._appendField(e,XN,i),this}u32(e,i){return this._appendField(e,o7,i),this}_appendField(e,i,r){const n=i.ElementCount*ENe(i.ElementType),s=this.stride;this.fields.set(e,{size:n,constructor:i,offset:s,optional:r}),this.stride+=n,this.fieldNames.push(e)}alignTo(e){return this.stride=Math.floor((this.stride+e-1)/e)*e,this}hasField(e){return this.fieldNames.includes(e)}createBuffer(e){return new Uye(this,e)}createView(e){return new Uye(this,e)}clone(){const e=new ANe;return e.stride=this.stride,e.fields=new Map,this.fields.forEach((i,r)=>e.fields.set(r,i)),e.fieldNames=this.fieldNames.slice(),e.BufferType=this.BufferType,e}};function _n(){return new Tvt}let Qe=class{constructor(e,i,r=!1,n=i){this.data=e,this.size=i,this.exclusive=r,this.stride=n}};var Qee;(function(t){function e(o,a){const l=o[a],c=o[a+1],h=o[a+2];return Math.sqrt(l*l+c*c+h*h)}function i(o,a){const l=o[a],c=o[a+1],h=o[a+2],p=1/Math.sqrt(l*l+c*c+h*h);o[a]*=p,o[a+1]*=p,o[a+2]*=p}function r(o,a,l){o[a]*=l,o[a+1]*=l,o[a+2]*=l}function n(o,a,l,c,h,p=a){(h=h||o)[p]=o[a]+l[c],h[p+1]=o[a+1]+l[c+1],h[p+2]=o[a+2]+l[c+2]}function s(o,a,l,c,h,p=a){(h=h||o)[p]=o[a]-l[c],h[p+1]=o[a+1]-l[c+1],h[p+2]=o[a+2]-l[c+2]}t.length=e,t.normalize=i,t.scale=r,t.add=n,t.subtract=s})(Qee||(Qee={}));var Zn;(function(t){t[t.Layer=0]="Layer",t[t.Object=1]="Object",t[t.Mesh=2]="Mesh",t[t.Line=3]="Line",t[t.Point=4]="Point",t[t.Material=5]="Material",t[t.Texture=6]="Texture",t[t.COUNT=7]="COUNT"})(Zn||(Zn={}));function th(t,e=!1){return t<=oy?e?new Array(t).fill(0):new Array(t):new Float64Array(t)}function Svt(t){return length<=oy?Array.from(t):new Float64Array(t)}function Sp(t,e,i){return Array.isArray(t)?t.slice(e,e+i):t.subarray(e,e+i)}function ps(t,e=!1){return t<=oy?e?new Array(t).fill(0):new Array(t):new Float32Array(t)}function Vye(t){return length<=oy?Array.from(t):new Float32Array(t)}function zye(t,e,i){return Array.isArray(t)?t.slice(e,e+i):t.subarray(e,e+i)}function Evt(t){if(t.length<oy)return Array.from(t);if(Array.isArray(t))return Float64Array.from(t);switch(t.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(t);case 2:return Uint16Array.from(t);case 4:return Float32Array.from(t);default:return Float64Array.from(t)}}const Ml=pi();let Cvt=class{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}};function wt(t,e){if(!t){e=e||"Assertion";const i=new Error(e).stack;throw new Cvt(`${e} at ${i}`)}}function SE(t,e){t||(e=e||"",console.warn("Verify failed: "+e+`
`+new Error("verify").stack))}function Bye(t,e,i,r){let n,s=(i[0]-t[0])/e[0],o=(r[0]-t[0])/e[0];s>o&&(n=s,s=o,o=n);let a=(i[1]-t[1])/e[1],l=(r[1]-t[1])/e[1];if(a>l&&(n=a,a=l,l=n),s>l||a>o)return!1;a>s&&(s=a),l<o&&(o=l);let c=(i[2]-t[2])/e[2],h=(r[2]-t[2])/e[2];return c>h&&(n=c,c=h,h=n),!(s>h||c>o)&&(h<o&&(o=h),!(o<0))}function Y4(t,e,i,r,n,s=Fe()){const o=(r[n]-i[n])*(e[0]-t[0])-(r[0]-i[0])*(e[n]-t[n]),a=(r[0]-i[0])*(t[n]-i[n])-(r[n]-i[n])*(t[0]-i[0]);if(o===0)return!1;const l=a/o;return s[0]=t[0]+l*(e[0]-t[0]),s[1]=t[n]+l*(e[n]-t[n]),!0}function jye(t,e,i,r,n){Ml[0]=t[0],Ml[1]=t[1],Ml[2]=t[2],Ml[3]=1,Jh(Ml,Ml,e),n.length>2&&(n[2]=-Ml[2]),Jh(Ml,Ml,i),wt(Ml[3]!==0),n[0]=Ml[0]/Ml[3],n[1]=Ml[1]/Ml[3],n[2]=Ml[2]/Ml[3],n[0]=(.5*n[0]+.5)*r[2]+r[0],n[1]=(.5*n[1]+.5)*r[3]+r[1]}function Avt(t,e){return Math.log(t)/Math.log(e)}function Rvt(t,e,i,r){t[12]=e,t[13]=i,t[14]=r}function RNe(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[7]===0&&t[8]===0&&t[9]===0&&t[10]===1&&t[11]===0&&t[15]===1}let MNe=class ONe{constructor(e,i,r,n){this.primitiveIndices=e,this._numIndexPerPrimitive=i,this.indices=r,this.position=n,this._children=void 0,wt(e.length>=1),wt(r.length%this._numIndexPerPrimitive==0),wt(r.length>=e.length*this._numIndexPerPrimitive),wt(n.size===3||n.size===4);const{data:s,size:o}=n,a=e.length;let l=o*r[this._numIndexPerPrimitive*e[0]];ax.clear(),ax.push(l);const c=Ue(s[l],s[l+1],s[l+2]),h=In(c);for(let m=0;m<a;++m){const g=this._numIndexPerPrimitive*e[m];for(let _=0;_<this._numIndexPerPrimitive;++_){l=o*r[g+_],ax.push(l);let b=s[l];c[0]=Math.min(b,c[0]),h[0]=Math.max(b,h[0]),b=s[l+1],c[1]=Math.min(b,c[1]),h[1]=Math.max(b,h[1]),b=s[l+2],c[2]=Math.min(b,c[2]),h[2]=Math.max(b,h[2])}}this.bbMin=c,this.bbMax=h;const p=ys(P(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(h[0]-c[0],h[1]-c[1]),h[2]-c[2]);let f=this.radius*this.radius;for(let m=0;m<ax.length;++m){l=ax.getItemAt(m);const g=s[l]-p[0],_=s[l+1]-p[1],b=s[l+2]-p[2],w=g*g+_*_+b*b;if(w<=f)continue;const x=Math.sqrt(w),T=.5*(x-this.radius);this.radius=this.radius+T,f=this.radius*this.radius;const E=T/x;p[0]+=g*E,p[1]+=_*E,p[2]+=b*E}this.center=p,ax.clear()}getChildren(){if(this._children||ba(this.bbMin,this.bbMax)<=1)return this._children;const e=ys(P(),this.bbMin,this.bbMax,.5),i=this.primitiveIndices.length,r=new Uint8Array(i),n=new Array(8);for(let c=0;c<8;++c)n[c]=0;const{data:s,size:o}=this.position;for(let c=0;c<i;++c){let h=0;const p=this._numIndexPerPrimitive*this.primitiveIndices[c];let f=o*this.indices[p],m=s[f],g=s[f+1],_=s[f+2];for(let b=1;b<this._numIndexPerPrimitive;++b){f=o*this.indices[p+b];const w=s[f],x=s[f+1],T=s[f+2];w<m&&(m=w),x<g&&(g=x),T<_&&(_=T)}m<e[0]&&(h|=1),g<e[1]&&(h|=2),_<e[2]&&(h|=4),r[c]=h,++n[h]}let a=0;for(let c=0;c<8;++c)n[c]>0&&++a;if(a<2)return;const l=new Array(8);for(let c=0;c<8;++c)l[c]=n[c]>0?new Uint32Array(n[c]):void 0;for(let c=0;c<8;++c)n[c]=0;for(let c=0;c<i;++c){const h=r[c];l[h][n[h]++]=this.primitiveIndices[c]}this._children=new Array;for(let c=0;c<8;++c)l[c]!==void 0&&this._children.push(new ONe(l[c],this._numIndexPerPrimitive,this.indices,this.position));return this._children}static prune(){ax.prune()}};const ax=new Wt({deallocator:null});let YN=class{constructor(){this.id=qu()}unload(){}};function Mvt(t){return t?{p0:In(t.p0),p1:In(t.p1),p2:In(t.p2)}:{p0:P(),p1:P(),p2:P()}}function Gye(t,e,i){const r=e[0]-t[0],n=e[1]-t[1],s=i[0]-t[0],o=i[1]-t[1];return .5*Math.abs(r*o-n*s)}function Ovt(t,e,i){return ge(JH,e,t),ge(Hye,i,t),Pe(vt(JH,JH,Hye))/2}new j_(Cm);new j_(()=>Mvt());const JH=P(),Hye=P();function Pvt(t,e,i){if(!t||!e)return!1;const{size:r,data:n}=t;he(i,0,0,0),he(Xd,0,0,0);let s=0,o=0;for(let a=0;a<e.length-2;a+=3){const l=e[a+0]*r,c=e[a+1]*r,h=e[a+2]*r;he($o,n[l+0],n[l+1],n[l+2]),he(H0,n[c+0],n[c+1],n[c+2]),he(Z4,n[h+0],n[h+1],n[h+2]);const p=Ovt($o,H0,Z4);p?(me($o,$o,H0),me($o,$o,Z4),le($o,$o,1/3*p),me(i,i,$o),s+=p):(me(Xd,Xd,$o),me(Xd,Xd,H0),me(Xd,Xd,Z4),o+=3)}return(o!==0||s!==0)&&(s!==0?(le(i,i,1/s),!0):o!==0&&(le(i,Xd,1/o),!0))}function Ivt(t,e,i){if(!t||!e)return!1;const{size:r,data:n}=t;he(i,0,0,0);let s=-1,o=0;for(let a=0;a<e.length;a++){const l=e[a]*r;s!==l&&(i[0]+=n[l+0],i[1]+=n[l+1],i[2]+=n[l+2],o++),s=l}return o>1&&le(i,i,1/o),o>0}function $vt(t,e,i,r){if(!t)return!1;he(r,0,0,0),he(Xd,0,0,0);let n=0,s=0;const{size:o,data:a}=t,l=e?e.length-1:a.length/o-1,c=l+(i?2:0);for(let h=0;h<c;h+=2){const p=h<l?h:l,f=h<l?h+1:0,m=(e?e[p]:p)*o,g=(e?e[f]:f)*o;$o[0]=a[m],$o[1]=a[m+1],$o[2]=a[m+2],H0[0]=a[g],H0[1]=a[g+1],H0[2]=a[g+2],le($o,me($o,$o,H0),.5);const _=xN($o,H0);_>0?(me(r,r,le($o,$o,_)),n+=_):n===0&&(me(Xd,Xd,$o),s++)}return n!==0?(le(r,r,1/n),!0):s!==0&&(le(r,Xd,1/s),!0)}const $o=P(),H0=P(),Z4=P(),Xd=P();function BR(t){if(Array.isArray(t)){if(t.length<oy)return t;for(const e of t)if(e>=65536)return new Uint32Array(t);return new Uint16Array(t)}if(t.length<oy)return Array.from(t);if(t.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return t;for(const e of t)if(e>=65536)return t;return new Uint16Array(t)}function PNe(t){const e=3*t;return e<=oy?new Array(e):e<=65536?new Uint16Array(e):new Uint32Array(e)}let j1=(()=>{const t=new Uint32Array(131072);for(let e=0;e<t.length;++e)t[e]=e;return t})();const INe=[0],jR=(()=>{const t=new Uint16Array(65536);for(let e=0;e<t.length;++e)t[e]=e;return t})();function ZM(t){if(t===1)return INe;if(t<oy)return Array.from(new Uint16Array(jR.buffer,0,t));if(t<jR.length)return new Uint16Array(jR.buffer,0,t);if(t>j1.length){const e=Math.max(2*j1.length,t);j1=new Uint32Array(e);for(let i=0;i<j1.length;i++)j1[i]=i}return new Uint32Array(j1.buffer,0,t)}function Qqt(t){if(t===1)return INe;if(t<oy)return Array.from(new Uint16Array(jR.buffer,0,t));if(t<jR.length)return new Uint16Array(jR.slice(0,t));if(t>j1.length){const e=new Uint32Array(t);for(let i=0;i<e.length;i++)e[i]=i;return e}return new Uint32Array(j1.slice(0,t))}let pz=class{constructor(e){this.channel=e,this.id=qu()}};function ete(t,e,i){for(let r=0;r<i;++r)e[2*r]=t[r],e[2*r+1]=t[r]-e[2*r]}function Lvt(t,e){const i=t.length;for(let r=0;r<i;++r)cR[0]=t[r],e[r]=cR[0];return e}function Dvt(t,e){const i=t.length;for(let r=0;r<i;++r)cR[0]=t[r],cR[1]=t[r]-cR[0],e[r]=cR[1];return e}const cR=new Float32Array(2);function tte(t,e){return R(t)&&(t=[]),t.push(e),t}function ite(t,e){if(R(t))return null;const i=t.filter(r=>r!==e);return i.length===0?null:i}function Nvt(t,e,i,r,n){J4[0]=t.get(e,0),J4[1]=t.get(e,1),J4[2]=t.get(e,2),ete(J4,lx,3),i.set(n,0,lx[0]),r.set(n,0,lx[1]),i.set(n,1,lx[2]),r.set(n,1,lx[3]),i.set(n,2,lx[4]),r.set(n,2,lx[5])}const J4=P(),lx=new Float32Array(6);let Os=class $Ne extends YN{constructor(e,i,r=[],n=null,s=Zn.Mesh,o=null,a=-1){super(),this.material=e,this.mapPositions=n,this.type=s,this.objectAndLayerIdColor=o,this.edgeIndicesLength=a,this.visible=!0,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[l,c]of i)c&&this._vertexAttributes.set(l,{...c});if(r==null||r.length===0){const l=Fvt(this._vertexAttributes),c=ZM(l);this.edgeIndicesLength=this.edgeIndicesLength<0?l:this.edgeIndicesLength;for(const h of this._vertexAttributes.keys())this._indices.set(h,c)}else for(const[l,c]of r)c&&(this._indices.set(l,BR(c)),l===M.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(l).length:this.edgeIndicesLength))}instantiate(e={}){const i=new $Ne(e.material||this.material,[],void 0,this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._vertexAttributes.forEach((r,n)=>{r.exclusive=!1,i._vertexAttributes.set(n,r)}),this._indices.forEach((r,n)=>i._indices.set(n,r)),i._boundingInfo=this._boundingInfo,i.transformation=e.transformation||this.transformation,i}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(e){let i=this._vertexAttributes.get(e);return i&&!i.exclusive&&(i={...i,exclusive:!0,data:Evt(i.data)},this._vertexAttributes.set(e,i)),i}get indices(){return this._indices}get indexCount(){const e=this._indices.values().next().value;return e?e.length:0}get faceCount(){return this.indexCount/3}get boundingInfo(){return R(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===Zn.Mesh?this._computeAttachmentOriginTriangles(e):this.type===Zn.Line?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(v(this._transformation)&&Ke(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){const i=this.indices.get(M.POSITION),r=this.vertexAttributes.get(M.POSITION);return Pvt(r,i,e)}_computeAttachmentOriginLines(e){const i=this.vertexAttributes.get(M.POSITION),r=this.indices.get(M.POSITION);return $vt(i,r,r&&kvt(this.material.parameters,i,r),e)}_computeAttachmentOriginPoints(e){const i=this.indices.get(M.POSITION),r=this.vertexAttributes.get(M.POSITION);return Ivt(r,i,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.indices.get(M.POSITION),i=this.vertexAttributes.get(M.POSITION);if(!e||e.length===0||!i)return null;const r=this.type===Zn.Mesh?3:1;wt(e.length%r==0,"Indexing error: "+e.length+" not divisible by "+r);const n=ZM(e.length/r);return new MNe(n,r,e,i)}get transformation(){return Nt(this._transformation,ld)}set transformation(e){this._transformation=e&&e!==ld?HM(e):null}get shaderTransformation(){return v(this._shaderTransformer)?this._shaderTransformer(this.transformation):this.transformation}get shaderTransformer(){return this._shaderTransformer}set shaderTransformer(e){this._shaderTransformer=e}get hasVolatileTransformation(){return v(this._shaderTransformer)}addHighlight(){const e=new pz($_.Highlight);return this.highlights=tte(this.highlights,e),e}removeHighlight(e){this.highlights=ite(this.highlights,e)}};function Fvt(t){const e=t.values().next().value;return e==null?0:e.data.length/e.size}function kvt(t,e,i){return!(!("isClosed"in t)||!t.isClosed)&&(i?i.length>2:e.data.length>6)}const EE=Qee,KH=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],Uvt=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],Vvt=[0,0,1,0,1,1,0,1],zvt=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],LNe=new Array(36);for(let t=0;t<6;t++)for(let e=0;e<6;e++)LNe[6*t+e]=t;const OT=new Array(36);for(let t=0;t<6;t++)OT[6*t+0]=0,OT[6*t+1]=1,OT[6*t+2]=2,OT[6*t+3]=2,OT[6*t+4]=3,OT[6*t+5]=0;function Bvt(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(24);for(let r=0;r<8;r++)i[3*r]=KH[r][0]*e[0],i[3*r+1]=KH[r][1]*e[1],i[3*r+2]=KH[r][2]*e[2];return new Os(t,[[M.POSITION,new Qe(i,3,!0)],[M.NORMAL,new Qe(Uvt,3)],[M.UV0,new Qe(Vvt,2)]],[[M.POSITION,zvt],[M.NORMAL,LNe],[M.UV0,OT]])}const QH=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],jvt=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],Gvt=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],Hvt=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function qvt(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(18);for(let r=0;r<6;r++)i[3*r]=QH[r][0]*e[0],i[3*r+1]=QH[r][1]*e[1],i[3*r+2]=QH[r][2]*e[2];return new Os(t,[[M.POSITION,new Qe(i,3,!0)],[M.NORMAL,new Qe(jvt,3)]],[[M.POSITION,Gvt],[M.NORMAL,Hvt]])}const PU=rr(-.5,0,-.5),IU=rr(.5,0,-.5),$U=rr(0,0,.5),LU=rr(0,.5,0),CE=rn(),AE=rn(),GR=rn(),HR=rn(),qR=rn();ge(CE,PU,LU),ge(AE,PU,IU),vt(GR,CE,AE),we(GR,GR),ge(CE,IU,LU),ge(AE,IU,$U),vt(HR,CE,AE),we(HR,HR),ge(CE,$U,LU),ge(AE,$U,PU),vt(qR,CE,AE),we(qR,qR);const eq=[PU,IU,$U,LU],Wvt=[0,-1,0,GR[0],GR[1],GR[2],HR[0],HR[1],HR[2],qR[0],qR[1],qR[2]],Xvt=[0,1,2,3,1,0,3,2,1,3,0,2],Yvt=[0,0,0,1,1,1,2,2,2,3,3,3];function Zvt(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(12);for(let r=0;r<4;r++)i[3*r]=eq[r][0]*e[0],i[3*r+1]=eq[r][1]*e[1],i[3*r+2]=eq[r][2]*e[2];return new Os(t,[[M.POSITION,new Qe(i,3,!0)],[M.NORMAL,new Qe(Wvt,3)]],[[M.POSITION,Xvt],[M.NORMAL,Yvt]])}function tWt(t,e,i,r,n={uv:!0}){const s=-Math.PI,o=2*Math.PI,a=-Math.PI/2,l=Math.PI,c=Math.max(3,Math.floor(i)),h=Math.max(2,Math.floor(r)),p=(c+1)*(h+1),f=ps(3*p),m=ps(3*p),g=ps(2*p),_=[];let b=0;for(let E=0;E<=h;E++){const C=[],A=E/h,I=a+A*l,O=Math.cos(I);for(let D=0;D<=c;D++){const U=D/c,V=s+U*o,B=Math.cos(V)*O,ee=Math.sin(I),ie=-Math.sin(V)*O;f[3*b]=B*e,f[3*b+1]=ee*e,f[3*b+2]=ie*e,m[3*b]=B,m[3*b+1]=ee,m[3*b+2]=ie,g[2*b]=U,g[2*b+1]=A,C.push(b),++b}_.push(C)}const w=new Array;for(let E=0;E<h;E++)for(let C=0;C<c;C++){const A=_[E][C],I=_[E][C+1],O=_[E+1][C+1],D=_[E+1][C];E===0?(w.push(A),w.push(O),w.push(D)):E===h-1?(w.push(A),w.push(I),w.push(O)):(w.push(A),w.push(I),w.push(O),w.push(O),w.push(D),w.push(A))}const x=[[M.POSITION,w],[M.NORMAL,w]],T=[[M.POSITION,new Qe(f,3,!0)],[M.NORMAL,new Qe(m,3,!0)]];return n.uv&&(T.push([M.UV0,new Qe(g,2,!0)]),x.push([M.UV0,w])),n.offset&&(x[0][0]=M.OFFSET,T[0][0]=M.OFFSET,x.push([M.POSITION,new Array(w.length).fill(0)]),T.push([M.POSITION,new Qe(Float64Array.from(n.offset),3,!0)])),new Os(t,T,x)}function Jvt(t,e,i,r){const{vertexAttributes:n,indices:s}=DNe(e,i,r);return new Os(t,n,s)}function DNe(t,e,i){const r=t;let n,s;if(i)n=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],s=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const h=r*(1+Math.sqrt(5))/2;n=[-r,h,0,r,h,0,-r,-h,0,r,-h,0,0,-r,h,0,r,h,0,-r,-h,0,r,-h,h,0,-r,h,0,r,-h,0,-r,-h,0,r],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let h=0;h<n.length;h+=3)EE.scale(n,h,t/EE.length(n,h));let o={};function a(h,p){h>p&&([h,p]=[p,h]);const f=h.toString()+"."+p.toString();if(o[f])return o[f];let m=n.length;return n.length+=3,EE.add(n,3*h,n,3*p,n,m),EE.scale(n,m,t/EE.length(n,m)),m/=3,o[f]=m,m}for(let h=0;h<e;h++){const p=s.length,f=new Array(4*p);for(let m=0;m<p;m+=3){const g=s[m],_=s[m+1],b=s[m+2],w=a(g,_),x=a(_,b),T=a(b,g),E=4*m;f[E]=g,f[E+1]=w,f[E+2]=T,f[E+3]=_,f[E+4]=x,f[E+5]=w,f[E+6]=b,f[E+7]=T,f[E+8]=x,f[E+9]=w,f[E+10]=x,f[E+11]=T}s=f,o={}}const l=Vye(n);for(let h=0;h<l.length;h+=3)EE.normalize(l,h);const c=[[M.POSITION,s],[M.NORMAL,s]];return{vertexAttributes:[[M.POSITION,new Qe(Vye(n),3,!0)],[M.NORMAL,new Qe(l,3,!0)]],indices:c}}function rte(t,e,i,r,n,s,o,a,l=null){const c=i?[i[0],i[1],i[2]]:[0,0,0],h=e?[e[0],e[1],e[2]]:[0,0,1];o=o||[0,0];const p=r?[255*r[0],255*r[1],255*r[2],r.length>3?255*r[3]:255]:[255,255,255,255],f=v(n)&&n.length===2?n:[1,1],m=[[M.POSITION,new Qe(c,3,!0)],[M.NORMAL,new Qe(h,3,!0)],[M.UV0,new Qe(o,o.length)],[M.COLOR,new Qe(p,4,!0)],[M.SIZE,new Qe(f,2)]];if(s!=null){const g=[s[0],s[1],s[2],s[3]];m.push([M.AUXPOS1,new Qe(g,4)])}if(a!=null){const g=[a[0],a[1],a[2],a[3]];m.push([M.AUXPOS2,new Qe(g,4)])}return new Os(t,m,null,null,Zn.Point,l)}const Kvt=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function iWt(t,e=Kvt){const i=new Array(12);for(let h=0;h<4;h++)for(let p=0;p<3;p++)i[3*h+p]=e[h][p];const r=[0,1,2,2,3,0],n=[0,0,1],s=[0,0,0,0,0,0],o=[0,0,1,0,1,1,0,1],a=[255,255,255,255],l=[[M.POSITION,r],[M.NORMAL,s],[M.UV0,r],[M.COLOR,s]],c=[[M.POSITION,new Qe(i,3,!0)],[M.NORMAL,new Qe(n,3,!0)],[M.UV0,new Qe(o,2,!0)],[M.COLOR,new Qe(a,4,!0)]];return new Os(t,c,l)}function qye(t,e,i,r,n,s=!0,o=!0){let a=0;const l=i,c=e;let h=rr(0,a,0),p=rr(0,a+c,0),f=rr(0,-1,0),m=rr(0,1,0);n&&(a=c,p=rr(0,0,0),h=rr(0,a,0),f=rr(0,1,0),m=rr(0,-1,0));const g=[p,h],_=[f,m],b=r+2,w=Math.sqrt(c*c+l*l);if(n)for(let O=r-1;O>=0;O--){const D=O*(2*Math.PI/r),U=rr(Math.cos(D)*l,a,Math.sin(D)*l);g.push(U);const V=rr(c*Math.cos(D)/w,-l/w,c*Math.sin(D)/w);_.push(V)}else for(let O=0;O<r;O++){const D=O*(2*Math.PI/r),U=rr(Math.cos(D)*l,a,Math.sin(D)*l);g.push(U);const V=rr(c*Math.cos(D)/w,l/w,c*Math.sin(D)/w);_.push(V)}const x=new Array,T=new Array;if(s){for(let O=3;O<g.length;O++)x.push(1),x.push(O-1),x.push(O),T.push(0),T.push(0),T.push(0);x.push(g.length-1),x.push(2),x.push(1),T.push(0),T.push(0),T.push(0)}if(o){for(let O=3;O<g.length;O++)x.push(O),x.push(O-1),x.push(0),T.push(O),T.push(O-1),T.push(1);x.push(0),x.push(2),x.push(g.length-1),T.push(1),T.push(2),T.push(_.length-1)}const E=ps(3*b);for(let O=0;O<b;O++)E[3*O]=g[O][0],E[3*O+1]=g[O][1],E[3*O+2]=g[O][2];const C=ps(3*b);for(let O=0;O<b;O++)C[3*O]=_[O][0],C[3*O+1]=_[O][1],C[3*O+2]=_[O][2];const A=[[M.POSITION,x],[M.NORMAL,T]],I=[[M.POSITION,new Qe(E,3,!0)],[M.NORMAL,new Qe(C,3,!0)]];return new Os(t,I,A)}function Qvt(t,e,i,r,n,s,o){const a=n?lz(n):rr(1,0,0),l=s?lz(s):rr(0,0,0);o=o??!0;const c=rn();we(c,a);const h=rn();le(h,c,Math.abs(e));const p=rn();le(p,h,-.5),me(p,p,l);const f=rr(0,1,0);Math.abs(1-be(c,f))<.2&&he(f,0,0,1);const m=rn();vt(m,c,f),we(m,m),vt(f,m,c);const g=2*r+(o?2:0),_=r+(o?2:0),b=ps(3*g),w=ps(3*_),x=ps(2*g),T=new Array(3*r*(o?4:2)),E=new Array(3*r*(o?4:2));o&&(b[3*(g-2)+0]=p[0],b[3*(g-2)+1]=p[1],b[3*(g-2)+2]=p[2],x[2*(g-2)]=0,x[2*(g-2)+1]=0,b[3*(g-1)+0]=b[3*(g-2)+0]+h[0],b[3*(g-1)+1]=b[3*(g-2)+1]+h[1],b[3*(g-1)+2]=b[3*(g-2)+2]+h[2],x[2*(g-1)]=1,x[2*(g-1)+1]=1,w[3*(_-2)+0]=-c[0],w[3*(_-2)+1]=-c[1],w[3*(_-2)+2]=-c[2],w[3*(_-1)+0]=c[0],w[3*(_-1)+1]=c[1],w[3*(_-1)+2]=c[2]);const C=(V,B,ee)=>{T[V]=B,E[V]=ee};let A=0;const I=rn(),O=rn();for(let V=0;V<r;V++){const B=V*(2*Math.PI/r);le(I,f,Math.sin(B)),le(O,m,Math.cos(B)),me(I,I,O),w[3*V+0]=I[0],w[3*V+1]=I[1],w[3*V+2]=I[2],le(I,I,i),me(I,I,p),b[3*V+0]=I[0],b[3*V+1]=I[1],b[3*V+2]=I[2],x[2*V+0]=V/r,x[2*V+1]=0,b[3*(V+r)+0]=b[3*V+0]+h[0],b[3*(V+r)+1]=b[3*V+1]+h[1],b[3*(V+r)+2]=b[3*V+2]+h[2],x[2*(V+r)+0]=V/r,x[2*V+1]=1;const ee=(V+1)%r;C(A++,V,V),C(A++,V+r,V),C(A++,ee,ee),C(A++,ee,ee),C(A++,V+r,V),C(A++,ee+r,ee)}if(o){for(let V=0;V<r;V++){const B=(V+1)%r;C(A++,g-2,_-2),C(A++,V,_-2),C(A++,B,_-2)}for(let V=0;V<r;V++){const B=(V+1)%r;C(A++,V+r,_-1),C(A++,g-1,_-1),C(A++,B+r,_-1)}}const D=[[M.POSITION,T],[M.NORMAL,E],[M.UV0,T]],U=[[M.POSITION,new Qe(b,3,!0)],[M.NORMAL,new Qe(w,3,!0)],[M.UV0,new Qe(x,2,!0)]];return new Os(t,U,D)}function rWt(t,e,i,r,n,s,o=rr(0,0,0)){const a=e.length,l=ps(i.length*a*3+(6*r.length||0)),c=ps(i.length*a*3+(r?6:0)),h=new Array,p=new Array;let f=0,m=0;const g=rn(),_=rn(),b=rn(),w=rn(),x=rn(),T=rn(),E=rn(),C=P(),A=rn(),I=rn(),O=rn(),D=rn(),U=rn(),V=Ji();he(A,0,1,0),ge(_,i[1],i[0]),we(_,_),s?(me(C,i[0],o),we(b,C)):he(b,0,0,1),fz(_,b,A,A,x,b,Wye),ce(w,b),ce(D,x);for(let F=0;F<r.length;F++)le(T,x,r[F][0]),le(C,b,r[F][2]),me(T,T,C),me(T,T,i[0]),l[f++]=T[0],l[f++]=T[1],l[f++]=T[2];c[m++]=-_[0],c[m++]=-_[1],c[m++]=-_[2];for(let F=0;F<n.length;F++)h.push(n[F][0]>0?n[F][0]:-n[F][0]-1+r.length),h.push(n[F][1]>0?n[F][1]:-n[F][1]-1+r.length),h.push(n[F][2]>0?n[F][2]:-n[F][2]-1+r.length),p.push(0),p.push(0),p.push(0);let B=r.length;const ee=r.length-1;for(let F=0;F<i.length;F++){let G=!1;F>0&&(ce(g,_),F<i.length-1?(ge(_,i[F+1],i[F]),we(_,_)):G=!0,me(I,g,_),we(I,I),me(O,i[F-1],w),GN(i[F],I,V),Y2(V,cd(O,g),C)?(ge(C,C,i[F]),we(b,C),vt(x,I,b),we(x,x)):fz(I,w,D,A,x,b,Wye),ce(w,b),ce(D,x)),s&&(me(C,i[F],o),we(U,C));for(let W=0;W<a;W++)if(le(T,x,e[W][0]),le(C,b,e[W][1]),me(T,T,C),we(E,T),c[m++]=E[0],c[m++]=E[1],c[m++]=E[2],me(T,T,i[F]),l[f++]=T[0],l[f++]=T[1],l[f++]=T[2],!G){const Z=(W+1)%a;h.push(B+W),h.push(B+a+W),h.push(B+Z),h.push(B+Z),h.push(B+a+W),h.push(B+a+Z);for(let X=0;X<6;X++){const oe=h.length-6;p.push(h[oe+X]-ee)}}B+=a}const ie=i[i.length-1];for(let F=0;F<r.length;F++)le(T,x,r[F][0]),le(C,b,r[F][1]),me(T,T,C),me(T,T,ie),l[f++]=T[0],l[f++]=T[1],l[f++]=T[2];const J=m/3;c[m++]=_[0],c[m++]=_[1],c[m++]=_[2];const q=B-a;for(let F=0;F<n.length;F++)h.push(n[F][0]>=0?B+n[F][0]:-n[F][0]-1+q),h.push(n[F][2]>=0?B+n[F][2]:-n[F][2]-1+q),h.push(n[F][1]>=0?B+n[F][1]:-n[F][1]-1+q),p.push(J),p.push(J),p.push(J);const N=[[M.POSITION,h],[M.NORMAL,p]],L=[[M.POSITION,new Qe(l,3,!0)],[M.NORMAL,new Qe(c,3,!0)]];return new Os(t,L,N)}function nWt(t,e,i,r){wt(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),wt(e[0].length===3,"createPolylineGeometry(): malformed vertex"),wt(i==null||i.length===e.length,"createPolylineGeometry: need same number of points and normals"),wt(i==null||i[0].length===3,"createPolylineGeometry(): malformed normal");const n=th(3*e.length),s=new Array(2*(e.length-1));let o=0,a=0;for(let h=0;h<e.length;h++){for(let p=0;p<3;p++)n[o++]=e[h][p];h>0&&(s[a++]=h-1,s[a++]=h)}const l=[],c=[];if(l.push([M.POSITION,s]),c.push([M.POSITION,new Qe(n,3,!0)]),i){const h=ps(3*i.length);let p=0;for(let f=0;f<e.length;f++)for(let m=0;m<3;m++)h[p++]=i[f][m];l.push([M.NORMAL,s]),c.push([M.NORMAL,new Qe(h,3,!0)])}return r&&(c.push([M.COLOR,new Qe(r,4)]),l.push([M.COLOR,ZM(r.length/4)])),new Os(t,c,l,null,Zn.Line)}function e1t(t,e=t){const i=t.vertexAttributes,r=i.get(M.POSITION).data,n=i.get(M.NORMAL).data;if(n){const s=e.getMutableAttribute(M.NORMAL).data;for(let o=0;o<n.length;o+=3){const a=n[o+1];s[o+1]=-n[o+2],s[o+2]=a}}if(r){const s=e.getMutableAttribute(M.POSITION).data;for(let o=0;o<r.length;o+=3){const a=r[o+1];s[o+1]=-r[o+2],s[o+2]=a}}}function tq(t,e,i,r,n){return!(Math.abs(be(e,t))>n)&&(vt(i,t,e),we(i,i),vt(r,i,t),we(r,r),!0)}function fz(t,e,i,r,n,s,o){return tq(t,e,n,s,o)||tq(t,i,n,s,o)||tq(t,r,n,s,o)}const Wye=.99619469809;let t1t=class{constructor(e,i){this.type=so.Panoramic,this._configuration=new qae,this._passParameters=new Wae,this._configuration.geometry=_y.Cylinder,this._technique=i.techniqueRepository.acquire(dz,this._configuration);const r=i.renderContext.rctx;this._vao=this._createVertexArrayObject(r),this._vaoCount=Ua(this._vao,"geometry"),this._passParameters.texture=new mt(r,{pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE,samplingMode:nt.LINEAR,flipped:!0,width:1,height:512},dNe)}destroy(){this._passParameters.texture=rt(this._passParameters.texture),this._vao.dispose(),this._technique.release()}render(e){const i=e.rctx,r=i.bindTechnique(this._technique,this._passParameters,e.bindParameters);i1t(Xye,e.bindParameters.camera.viewMatrix),r.setUniformMatrix4fv("view",Xye),i.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(Ft.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(e){const i=DNe(1,2,!1),r=i.indices[0][1],n=i.vertexAttributes[0][1];for(let l=0;l<r.length;l+=3){const c=r[l];r[l]=r[l+2],r[l+2]=c}const s=n.data,o=Yye.createBuffer(r.length),a=o.position;for(let l=0;l<r.length;++l){const c=3*r[l];a.set(l,0,s[c]),a.set(l,1,s[c+1]),a.set(l,2,s[c+2])}return new Rm(e,Di,{geometry:sh(Yye)},{geometry:er.createVertex(e,zi.STATIC_DRAW,o.buffer)})}};function i1t(t,e){go(t,e),t[12]=0,t[13]=0,t[14]=0,t[15]=1}const Xye=$e(),Yye=_n().vec3f(M.POSITION);var L_;(function(t){t[t.Rain=0]="Rain",t[t.Snow=1]="Snow",t[t.COUNT=2]="COUNT"})(L_||(L_={}));let nte=class extends wl{constructor(){super(...arguments),this.type=L_.Rain}};u([j({count:L_.COUNT})],nte.prototype,"type",void 0);function r1t(t){const e=new ji;return e.attributes.add(M.POSITION,"vec3"),e.attributes.add(M.INSTANCEFEATUREATTRIBUTE,"float"),e.vertex.uniforms.add(new Jt("cameraPosition",(i,r)=>r.camera.eye)),e.vertex.uniforms.add(new Jt("offset",(i,r)=>n1t(i,r))),e.vertex.uniforms.add(new Ie("width",i=>i.width)),e.vertex.uniforms.add(new on("proj",(i,r)=>r.camera.projectionMatrix)),e.vertex.uniforms.add(new on("view",(i,r)=>r.camera.viewMatrix)),e.vertex.uniforms.add(new Ie("time",i=>i.time)),e.varyings.add("vUv","vec2"),e.vertex.code.add(S`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${t.type===L_.Rain?S`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:S`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),e.fragment.uniforms.add([new Ie("opacity",i=>i.opacity),new Jt("particleColor",(i,r)=>s1t(r,t))]),e.fragment.code.add(S`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${t.type===L_.Rain?S`d = 0.35 * smoothstep(0.5, 0.0, d);`:S`d = smoothstep(0.5, 0.1, d);`}
      gl_FragColor = opacity * vec4(particleColor * d, d);
    }
  `),e}function n1t(t,e){const i=e.camera.eye,r=.5*t.width,n=1/t.width,s=eCe(ste,he(ste,(i[0]+r)*n,(i[1]+r)*n,(i[2]+r)*n));return Fo(s,i,le(s,s,t.width))}function s1t(t,e){const i=e.type===L_.Rain?a1t:o1t,r=le(ste,i,l1t),n=t.camera.eye;we(Zye,n);const s=Math.max(0,be(Zye,t.lighting.mainLight.direction));return ys(r,r,i,s)}const ste=P(),Zye=P(),o1t=Ue(1,1,1),a1t=Ue(.85,.85,.85),l1t=.7,c1t=Object.freeze(Object.defineProperty({__proto__:null,build:r1t},Symbol.toStringTag,{value:"Module"}));let u1t=class extends Tr{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=1}},ote=class NNe extends Yi{initializeProgram(e){return new Hi(e.rctx,NNe.shader.get().build(this.configuration),DU)}initializePipeline(){return Ht({blending:_o(Ce.ONE,Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA,Ce.ONE_MINUS_SRC_ALPHA),depthTest:{func:Gr.LEQUAL},colorWrite:si})}};ote.shader=new Gi(c1t,()=>Q(()=>import("./Precipitation.glsl-4b6f7611.js"),[]));const DU=new Map([[M.POSITION,0],[M.INSTANCEFEATUREATTRIBUTE,1]]);let FNe=class{constructor(){this.enabled=!0,this._time=0}get time(){return this._time}advance({deltaTime:e,fixedTime:i}){return v(i)?this._time!==i&&(this._time=i,!0):(this._time=this._time+e,e!==0)}},h1t=class{constructor(e,i){this.deltaTime=e,this.fixedTime=i}},PT=class extends ve{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._passParameters=new u1t,this._animation=new FNe,this._updatingTracking=new Jg,this._passParameters.time=0,this._passParameters.radius=sr(e.view.spatialReference).radius,this._techniqueRepository=e.context.techniqueRepository}destroy(){this._updatingTracking.destroy(),this._numParticles=0,this._snowTechniqueCached=nn(this._snowTechniqueCached),this._rainTechniqueCached=nn(this._rainTechniqueCached),this._vao=rt(this._vao),this._instanceIdBuffer=rt(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get _rainTechnique(){if(R(this._rainTechniqueCached)){const e=new nte;e.type=L_.Rain,this._rainTechniqueCached=this._techniqueRepository.acquire(ote,e)}return this._rainTechniqueCached}get _snowTechnique(){if(R(this._snowTechniqueCached)){const e=new nte;e.type=L_.Snow,this._snowTechniqueCached=this._techniqueRepository.acquire(ote,e)}return this._snowTechniqueCached}update(e){return this._animation.advance(e)}render(e,i,r){var l;const n=r==="rainy"?this._rainTechnique:this._snowTechnique;if(!n.compiled)return void this.context.requestRender();const s=e.rctx;if(this._ensureResources(s),R(n)||R(this._vao)||R(this._instanceIdBuffer)||(v(e.bindParameters.cloudsFade.data)&&(this._passParameters.opacity=1-e.bindParameters.cloudsFade.fadeInOutHeight.factor),this._passParameters.opacity<=0))return;const o=.35;i=i<.5?Bt(0,o,2*i):Bt(o,1,2*(i-.5)),this._passParameters.time=(r==="rainy"?this._rainSpeed:this._snowSpeed)*ene(this._animation.time)%1e5;const a=s.bindTechnique(n,this._passParameters,e.bindParameters);s.bindVAO(this._vao),a.assertCompatibleVertexAttributeLocations(this._vao),Dae(s,DU,this._instanceIdBuffer,Jye,0),(l=s.capabilities.instancing)==null||l.drawArraysInstanced(Ft.TRIANGLES,0,3,this._numParticles*i),Nae(s,DU,this._instanceIdBuffer,Jye)}_ensureResources(e){R(this._vao)&&(this._vao=this._createVertexArrayObject(e)),R(this._instanceIdBuffer)&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const i=[];for(let r=0;r<this._numParticles;r++)i.push(r);return er.createVertex(e,zi.STATIC_DRAW,new Float32Array(i))}_createVertexArrayObject(e){const i=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new Rm(e,DU,{geometry:sh(d1t)},{geometry:er.createVertex(e,zi.STATIC_DRAW,i)})}};u([d({constructOnly:!0})],PT.prototype,"context",void 0),u([d({constructOnly:!0})],PT.prototype,"view",void 0),u([d({readOnly:!0})],PT.prototype,"updating",null),u([d()],PT.prototype,"_updatingTracking",void 0),PT=u([$("esri.views.3d.environment.Precipitation")],PT);const d1t=_n().vec3f(M.POSITION),Jye=sh(_n().f32(M.INSTANCEFEATUREATTRIBUTE),1),p1t=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]),K4=128,Kye=-aee,Qye=0,iq=50,f1t=()=>1-511/512,m1t=EU([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);let g1t=class{constructor(e,i){this.view=e,this.type=so.Simple,this._passParameters=new Wae,this._vaoCount=0,this._texV1=1,this._isMars=wy(e.spatialReference);const r=sr(e.spatialReference);this._planetRadius=r.radius,this._outerRimWidth=r.outerAtmosphereRimWidth,this._innerRimFactor=(this._planetRadius+Kye)/this._planetRadius,this._middleRimFactor=(this._planetRadius+Qye)/this._planetRadius,this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius,this._texV0=Qye/this._outerRimWidth,this._texVScale=this._texV1-this._texV0,this._techniqueRepository=i.techniqueRepository;const n=i.renderContext.rctx;this._cameraChangeHandle=ne(()=>{var a;return(a=this.view.state)==null?void 0:a.camera},()=>i.requestRender(),Jr),this._vao=this._createRibbon(n),this._vaoCount=Ua(this._vao,"geometry"),this._fadeVao=xl(n),this._fadeVaoCount=Ua(this._fadeVao,"geometry");const s=this._isMars?p1t:dNe;this._passParameters.texture=new mt(n,{pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE,samplingMode:nt.LINEAR,flipped:!0,width:1,height:512},s);const o=new qae;o.geometry=_y.Cone,this._coneTechnique=this._techniqueRepository.acquire(dz,o),o.geometry=_y.Underground,this._undergroundTechnique=this._techniqueRepository.acquire(dz,o)}destroy(){this._coneTechnique.release(),this._undergroundTechnique.release(),this._cameraChangeHandle.remove(),this._passParameters.texture=rt(this._passParameters.texture),this._fadeVao.dispose(),this._vao.dispose()}render(e){const i=e.bindParameters.camera;this._update(i);const r=e.rctx;this._passParameters.undergroundFadeAlpha<1&&(r.bindTechnique(this._coneTechnique,this._passParameters,e.bindParameters),r.bindVAO(this._vao),r.drawArrays(Ft.TRIANGLES,0,this._vaoCount)),this._passParameters.undergroundFadeAlpha>0&&(r.bindTechnique(this._undergroundTechnique,this._passParameters,e.bindParameters),r.bindVAO(this._fadeVao),r.drawArrays(Ft.TRIANGLE_STRIP,0,this._fadeVaoCount))}renderHaze(){}_update(e){const i=P(),r=this._planetRadius,n=Pe(e.eye),s=n-r;if(s<0){const m=Math.min(-s/5e3,1);this._passParameters.undergroundFadeAlpha=m}else this._passParameters.undergroundFadeAlpha=0;const o=Math.max(iq,s),a=r+Kye;this._passParameters.innerScale=y1t(r+o,r,a)-1,this._passParameters.altitudeFade=Pae(s),le(i,e.eye,(r+iq)/n),e0e(i,e.center,e.up,r,this._passParameters.silhouette);const l=this._computeScreenRimWidth(e,i,e.up,this._passParameters.silhouette),c=f1t(),h=m1t(s);let p=this._texV0+c*this._texVScale,f=this._texV0+l*h*this._texVScale;if(s>iq){e0e(e.eye,e.center,e.up,r,this._passParameters.silhouette);const m=this._computeScreenRimWidth(e,e.eye,e.up,this._passParameters.silhouette),g=_e((m-1.5)/(l-1.5),0,1);p=this._texV0+g*c*this._texVScale,f=this._texV0+Bt(this._texV1,l*h,g)*this._texVScale}dt(this._passParameters.texV,p,f)}_createRibbon(e){const i=ps(3+3*K4*3),r=new Uint32Array(3*K4*5);i[0]=0,i[1]=0,i[2]=-1;for(let o=0;o<K4;o++){const a=9*o+3;i[a+0]=o,i[a+1]=this._innerRimFactor,i[a+2]=-1,i[a+3]=o,i[a+4]=this._middleRimFactor,i[a+5]=0,i[a+6]=o,i[a+7]=this._outerRimFactor,i[a+8]=1;const l=3*o+1,c=o===K4-1?1:l+3,h=15*o;r[h+0]=l,r[h+1]=l+1,r[h+2]=c+1,r[h+3]=c+1,r[h+4]=c,r[h+5]=l,r[h+6]=l+1,r[h+7]=l+2,r[h+8]=c+2,r[h+9]=c+2,r[h+10]=c+1,r[h+11]=l+1,r[h+12]=l,r[h+13]=c,r[h+14]=0}const n=t0e.createBuffer(r.length),s=n.position;for(let o=0;o<r.length;++o){const a=3*r[o];s.set(o,0,i[a]),s.set(o,1,i[a+1]),s.set(o,2,i[a+2])}return new Rm(e,Di,{geometry:sh(t0e)},{geometry:er.createVertex(e,zi.STATIC_DRAW,n.buffer)})}_computeScreenRimWidth(e,i,r,n){return me(RE,n.center,n.v2),le(Q4,RE,this._outerRimFactor),oB(rq,i,RE,r),jye(RE,rq,e.projectionMatrix,e.viewport,RE),jye(Q4,rq,e.projectionMatrix,e.viewport,Q4),Lr(RE,Q4)/e.height}};function e0e(t,e,i,r,n){const s=Pe(t),o=r*Math.sqrt(s*s-r*r)/s,a=Math.sqrt(r*r-o*o),l=n.v1,c=n.v2;return le(n.center,t,a/s),vt(l,t,e),al(l)<1&&vt(l,t,i),le(l,l,o/Pe(l)),vt(c,l,t),le(c,c,o/Pe(c)),o}const rq=$e(),RE=P(),Q4=P();function y1t(t,e,i){return t*t/(Math.sqrt(t*t-e*e)*Math.sqrt(t*t-i*i)+e*i)}const t0e=_n().vec3f(M.POSITION);let kNe=class UNe extends Yi{initializeProgram(e){return new Hi(e.rctx,UNe.shader.get().build(this.configuration),Di)}initializePipeline(){return Ht({blending:_o(Ce.ONE,Ce.ZERO,Ce.ONE_MINUS_SRC_COLOR,Ce.ONE),colorWrite:si})}};kNe.shader=new Gi(sNe,()=>Q(()=>import("./FogHaze.glsl-34ab975f.js"),[]));const _1t=.7,v1t=1;let UI=class extends ve{constructor(e){super(e),this._passParameters=new Gae;const i=e.context.renderContext.rctx;this._vao=xl(i,kO);const r=sr(e.view.spatialReference);this._planetRadius=r.radius,this._atmosphereRadius=r.radius+bD;const n=new Hae;n.haze=!0,this._hazeTechnique=e.context.techniqueRepository.acquire(kNe,n)}destroy(){this._hazeTechnique.release(),this._vao.dispose()}set strength(e){this._passParameters.hazeStrength=e}get strength(){return this._passParameters.hazeStrength}render(e,i){if(this.view.basemapTerrain.baseOpacity===0||(this._update(e,i),this._passParameters.hazeAmount<=0))return;const r=this._hazeTechnique;if(!r.compiled)return void this.context.requestRender();const n=e.offscreenRenderingHelper;n.renderDepthDetached(()=>{this._passParameters.depthTexture=n.depthTexture;const s=e.rctx.bindTechnique(r,this._passParameters,e.bindParameters);this._renderSimpleHaze(s,e)})}_renderSimpleHaze(e,i){const r=i.rctx;r.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(Ft.TRIANGLE_STRIP,0,4)}_update(e,i){const r=e.bindParameters.camera;we(i0e,r.eye);const n=Math.max(0,be(i0e,e.bindParameters.lighting.mainLight.direction)),s=w1t;le(r0e,s,0),ys(this._passParameters.hazeColor,r0e,s,n);const o=Pe(r.eye),a=o*o;this._passParameters.atmosphereC=a-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.hazeAmount=(1-bM(_1t*Kd,v1t*Kd,Math.abs(o-this._planetRadius)))*i.amount,this._passParameters.fogStrength=i.strength}static isSupported(e){return e.capabilities.depthTexture}};u([d({constructOnly:!0})],UI.prototype,"context",void 0),u([d({constructOnly:!0})],UI.prototype,"view",void 0),UI=u([$("esri.views.3d.environment.SimpleHaze")],UI);let b1t=class{constructor(){this.strength=0,this.amount=0}};const w1t=Ue(.24,.44,.8),i0e=P(),r0e=P();function nle(t){const e=S`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,i=S`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;t.vertex.code.add(e),t.vertex.code.add(i),t.fragment.code.add(e),t.fragment.code.add(i)}function x1t(){const t=new ji;return t.attributes.add(M.POSITION,"vec3"),t.attributes.add(M.COLOR,"vec4"),t.attributes.add(M.SIZE,"float"),t.varyings.add("vcolor","vec4"),t.varyings.add("vsize","float"),t.vertex.uniforms.add([new on("transform",(e,i)=>T1t(e,i)),new bi("viewport",(e,i)=>i.camera.fullViewport),new Ie("pixelRatio",(e,i)=>i.camera.pixelRatio)]),t.include(nle),t.vertex.code.add(S`void main(void) {
vec4 posProj = transform * vec4(position, 0);
gl_Position = alignToPixelCenter(posProj, viewport.zw);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),t.fragment.code.add(S`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
gl_FragColor = vec4(vcolor.xyz, intensity);
}`),t}function T1t(t,e){return go(Ev,e.camera.projectionMatrix),Ev[10]=24e-8-1,Ev[11]=-1,Ev[14]=(24e-8-2)*e.camera.near,$n(Ev,Ev,e.camera.viewMatrix),$n(Ev,Ev,t.modelMatrix)}const Ev=$e(),S1t=Object.freeze(Object.defineProperty({__proto__:null,build:x1t},Symbol.toStringTag,{value:"Module"}));let E1t=class extends Tr{constructor(){super(...arguments),this.modelMatrix=$e()}},VNe=class zNe extends Yi{constructor(e){super(e,new wl,()=>this.destroy())}initializeProgram(e){return new Hi(e.rctx,zNe.shader.get().build(),Di)}initializePipeline(){return Ht({blending:_o(Ce.SRC_ALPHA,Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA,Ce.ONE_MINUS_SRC_ALPHA),depthTest:{func:Gr.LEQUAL},colorWrite:si})}};VNe.shader=new Gi(S1t,()=>Q(()=>import("./Stars.glsl-bbc5d143.js"),[]));let O1=class extends ve{get updating(){return this._updatingTracking.updating||this.loading}get loading(){return v(this._loadDataTask)&&!this._loadDataTask.finished}constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._renderParameter=new E1t,this._updatingTracking=new Jg}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=Mp(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=nn(this._technique),this._vao=rt(this._vao)}render(e){const{rctx:i}=e;if(this._ensureResources(i),R(this._technique)||R(this._vao))return;if(!this._technique.compiled)return void this.requestRender();const r=i.bindTechnique(this._technique,this._renderParameter,e.bindParameters);i.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(Ft.POINTS,0,this._numPoints)}_ensureResources(e){if(v(this._technique)||R(ME))return;this._technique=new VNe({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=ME.byteLength/n0e;const i=new Float32Array(ME,0,2*this._numPoints),r=new Uint8Array(ME,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(e,i,r,this._numPoints),this._updatingTracking.add(()=>this.view.environment.lighting.type!=="virtual"?this.view.environment.lighting.date:null,n=>this._update(n),zt)}_computeDayDuration(e){const i=e,r=new Date(e.getFullYear(),0,1,11,58,56);return(+i-+r)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+r)}_update(e){if(!e)return;const i=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,r=2*this._computeDayDuration(e),n=go(this._renderParameter.modelMatrix,R1t);RM(n,n,-r*Math.PI),$n(n,A1t,n),RM(n,n,-i*Math.PI),this.requestRender()}_hexToRGB(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}_unpackUint8Attributes(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}_createVertexArrayObject(e,i,r,n){const s=s0e.createBuffer(n),o=s.position,a=s.color,l=s.size;for(let c=0;c<n;c++){const h=i[2*c+0],p=i[2*c+1];o.set(c,0,-Math.cos(h)*Math.sin(p)),o.set(c,1,-Math.sin(h)*Math.sin(p)),o.set(c,2,-Math.cos(p));const f=this._unpackUint8Attributes(r[c]),m=this._hexToRGB(C1t[f[1]]);a.set(c,0,255*m[0]),a.set(c,1,255*m[1]),a.set(c,2,255*m[2]),a.set(c,3,255),l.set(c,f[0])}return new Rm(e,Di,{geometry:sh(s0e)},{geometry:er.createVertex(e,zi.STATIC_DRAW,s.buffer)})}_createLoadDataTask(){if(v(ME))return null;const e=ON(async i=>{const{data:r}=await wYe("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:i});this._verifyStarData(r),ME=r});return e.promise.catch(i=>{gs(i)||re.getLogger(this.declaredClass).error(i)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}_verifyStarData(e){if(!e)throw new H("stars:no-data-received","Failed to create stars because star catalogue is missing");const i=e.byteLength/n0e;if(i%1!=0||i>5e4||i<5e3)throw new H("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};u([d({constructOnly:!0})],O1.prototype,"view",void 0),u([d({constructOnly:!0})],O1.prototype,"requestRender",void 0),u([d({readOnly:!0})],O1.prototype,"updating",null),u([d()],O1.prototype,"_loadDataTask",void 0),u([d()],O1.prototype,"_updatingTracking",void 0),O1=u([$("esri.views.3d.environment.Stars")],O1);const C1t=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],A1t=mae(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),R1t=mae(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),n0e=9,s0e=_n().vec3f(M.POSITION).vec4u8(M.COLOR).f32(M.SIZE);let ME=null;function M1t(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function mz(t,e,i){i*=.5;const r=Math.sin(i);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i),t}function sle(t,e){const i=2*Math.acos(e[3]),r=Math.sin(i/2);return r>bl()?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),i}function ole(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=i[0],l=i[1],c=i[2],h=i[3];return t[0]=r*h+o*a+n*c-s*l,t[1]=n*h+o*l+s*a-r*c,t[2]=s*h+o*c+r*l-n*a,t[3]=o*h-r*a-n*l-s*c,t}function O1t(t,e,i){i*=.5;const r=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+o*a,t[1]=n*l+s*a,t[2]=s*l-n*a,t[3]=o*l-r*a,t}function P1t(t,e,i){i*=.5;const r=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l-s*a,t[1]=n*l+o*a,t[2]=s*l+r*a,t[3]=o*l-n*a,t}function I1t(t,e,i){i*=.5;const r=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+n*a,t[1]=n*l-r*a,t[2]=s*l+o*a,t[3]=o*l-s*a,t}function $1t(t,e){const i=e[0],r=e[1],n=e[2];return t[0]=i,t[1]=r,t[2]=n,t[3]=Math.sqrt(Math.abs(1-i*i-r*r-n*n)),t}function NU(t,e,i,r){const n=e[0],s=e[1],o=e[2],a=e[3];let l,c,h,p,f,m=i[0],g=i[1],_=i[2],b=i[3];return c=n*m+s*g+o*_+a*b,c<0&&(c=-c,m=-m,g=-g,_=-_,b=-b),1-c>bl()?(l=Math.acos(c),h=Math.sin(l),p=Math.sin((1-r)*l)/h,f=Math.sin(r*l)/h):(p=1-r,f=r),t[0]=p*n+f*m,t[1]=p*s+f*g,t[2]=p*o+f*_,t[3]=p*a+f*b,t}function L1t(t){const e=bN,i=e(),r=e(),n=e(),s=Math.sqrt(1-i),o=Math.sqrt(i);return t[0]=s*Math.sin(2*Math.PI*r),t[1]=s*Math.cos(2*Math.PI*r),t[2]=o*Math.sin(2*Math.PI*n),t[3]=o*Math.cos(2*Math.PI*n),t}function D1t(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=i*i+r*r+n*n+s*s,a=o?1/o:0;return t[0]=-i*a,t[1]=-r*a,t[2]=-n*a,t[3]=s*a,t}function E2(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function BNe(t,e){const i=e[0]+e[4]+e[8];let r;if(i>0)r=Math.sqrt(i+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{let n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);const s=(n+1)%3,o=(n+2)%3;r=Math.sqrt(e[3*n+n]-e[3*s+s]-e[3*o+o]+1),t[n]=.5*r,r=.5/r,t[3]=(e[3*s+o]-e[3*o+s])*r,t[s]=(e[3*s+n]+e[3*n+s])*r,t[o]=(e[3*o+n]+e[3*n+o])*r}return t}function N1t(t,e,i,r){const n=.5*Math.PI/180;e*=n,i*=n,r*=n;const s=Math.sin(e),o=Math.cos(e),a=Math.sin(i),l=Math.cos(i),c=Math.sin(r),h=Math.cos(r);return t[0]=s*l*h-o*a*c,t[1]=o*a*h+s*l*c,t[2]=o*l*c-s*a*h,t[3]=o*l*h+s*a*c,t}function F1t(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}const ale=Xf,k1t=cr,U1t=Mne,V1t=ole,z1t=gO,B1t=cCe,j1t=j9,jNe=One,G1t=jNe,GNe=Pne,H1t=GNe,lle=lCe,q1t=RR,W1t=Ine;function X1t(t,e,i){const r=be(e,i);return r<-.999999?(vt(Fm,Y1t,e),Ru(Fm)<1e-6&&vt(Fm,Z1t,e),we(Fm,Fm),mz(t,Fm,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(vt(Fm,e,i),t[0]=Fm[0],t[1]=Fm[1],t[2]=Fm[2],t[3]=1+r,lle(t,t))}const Fm=P(),Y1t=Ue(1,0,0),Z1t=Ue(0,1,0);function J1t(t,e,i,r,n,s){return NU(o0e,e,n,s),NU(a0e,i,r,s),NU(t,o0e,a0e,2*s*(1-s)),t}const o0e=zp(),a0e=zp();function K1t(t,e,i,r){const n=Q1t;return n[0]=i[0],n[3]=i[1],n[6]=i[2],n[1]=r[0],n[4]=r[1],n[7]=r[2],n[2]=-e[0],n[5]=-e[1],n[8]=-e[2],lle(t,BNe(t,n))}const Q1t=wr();Object.freeze(Object.defineProperty({__proto__:null,add:U1t,calculateW:$1t,conjugate:E2,copy:ale,dot:B1t,equals:W1t,exactEquals:q1t,fromEuler:N1t,fromMat3:BNe,getAxisAngle:sle,identity:M1t,invert:D1t,len:G1t,length:jNe,lerp:j1t,mul:V1t,multiply:ole,normalize:lle,random:L1t,rotateX:O1t,rotateY:P1t,rotateZ:I1t,rotationTo:X1t,scale:z1t,set:k1t,setAxes:K1t,setAxisAngle:mz,slerp:NU,sqlerp:J1t,sqrLen:H1t,squaredLength:GNe,str:F1t},Symbol.toStringTag,{value:"Module"}));function ZN(t=tbt){return[t[0],t[1],t[2],t[3]]}function gWt(t,e,i=ZN()){return ce(i,t),i[3]=e,i}function l0e(t,e,i=ZN()){return vt(i,t,e),we(i,i),i[3]=-rCe(t,e),i}function yWt(t,e,i=ZN()){return mz(e5,t,c0e(t)),mz(u0e,e,c0e(e)),ole(e5,u0e,e5),ebt(i,ml(sle(i,e5)))}function _Wt(t){return t}function c0e(t){return Xt(t[3])}function ebt(t,e){return t[3]=e,t}const tbt=[0,0,1,0],e5=zp(),u0e=zp();ZN();function ibt(t,e,i){const r=t.parallax.anchorPointClouds;t.fadeIn.stage===Iu.FINISHED&&(t.fadeIn.factor=0,ce(r,Fg),t.fadeIn.stage=Iu.CHANGE_ANCHOR,t.crossFade.enabled=!1,t.fadeInOut.stage=oo.FINISHED),t.fadeIn.stage===Iu.CHANGE_ANCHOR&&t.isCameraPositionFinal&&(Bae(t.data)&&t.renderingStage!==Xn.RENDERING||t.renderingStage===Xn.FADING_TEXTURE_CHANNELS)&&(ce(r,Fg),t.fadeIn.stage=Iu.FADE_IN,t.startTime=e,t.renderingStage===Xn.FADING_TEXTURE_CHANNELS&&(t.renderingStage=Xn.SWITCH_CHANNELS)),t.fadeIn.factor<1&&t.fadeIn.stage===Iu.FADE_IN?t.fadeIn.factor=i?_e((e-t.startTime)/(HNe*i),0,1):1:t.fadeIn.factor>=1&&t.fadeIn.stage===Iu.FADE_IN&&(t.fadeIn.stage=Iu.FINISHED,t.fadeIn.factor=1)}function rbt(t,e,i){const{fadeInOut:r,crossFade:n}=t;r.stage===oo.FINISHED&&(t.startTime=e,r.factor=1,r.stage=oo.FADE_OUT),r.factor>0&&r.stage===oo.FADE_OUT?r.factor=i?1-_e((e-t.startTime)/(lbt*i),0,1):0:(r.factor<=0&&r.stage===oo.FADE_OUT&&(r.factor=0,ce(t.parallax.anchorPointClouds,Fg)),r.factor<=0&&r.stage===oo.FADE_OUT&&t.isCameraPositionFinal&&(r.factor=0,r.stage=oo.SWITCH,t.crossFade.enabled=!1,n.factor=1),r.stage===oo.SWITCH&&(Bae(t.data)&&t.renderingStage!==Xn.RENDERING||t.renderingStage===Xn.FADING_TEXTURE_CHANNELS)&&(t.startTime=e,r.factor=0,r.stage=oo.FADE_IN,ce(t.parallax.anchorPointClouds,Fg),t.crossFade.enabled=!1,n.factor=1,t.renderingStage===Xn.FADING_TEXTURE_CHANNELS&&(t.renderingStage=Xn.SWITCH_CHANNELS)),r.factor<1&&r.stage===oo.FADE_IN?r.factor=i?_e((e-t.startTime)/(HNe*i),0,1):1:r.factor>=1&&r.stage===oo.FADE_IN&&(r.stage=oo.FINISHED,r.factor=1))}function nbt(t,e,i,r){const{crossFade:n}=t,s=t.parallax.anchorPointClouds;t.crossFade.enabled&&!r||(ce(t.parallaxNew.anchorPointClouds,Fg),t.startTime=e,n.factor=0,t.crossFade.enabled=!0),n.factor<1&&t.crossFade.enabled?n.factor=i?_e((e-t.startTime)/(cbt*i),0,1):1:n.factor>=1&&t.crossFade.enabled&&(t.crossFade.enabled=!1,n.factor=1,ce(s,t.parallaxNew.anchorPointClouds),t.renderingStage===Xn.FADING_TEXTURE_CHANNELS&&(t.renderingStage=Xn.SWITCH_CHANNELS))}function h0e(t,e,i,r){const n=t.fadeInOutHeight,s=n.stage===gw.FINISHED?i:t.startTimeHeightFade;if(r!==0){const o=(i-s)/(ubt*r);n.factor+=e?-o:o}else n.factor=e?0:1;t.startTimeHeightFade=i,n.factor=_e(n.factor,0,1),n.stage=gw.HEIGHT_FADE}function sbt(t,e,i,r,n){t.renderingStage===Xn.FINISHED_RENDERING&&(t.renderingStage=Xn.FADING_TEXTURE_CHANNELS);const s=Pe(e.eye);t.fadeInOutHeight.factor<0&&(t.fadeInOutHeight.factor=s-Ci.radius>Kd?1:0),t.isCameraPositionFinal=Qb(t.cameraPositionLastFrame,e.eye),we(Fg,e.eye),le(Fg,Fg,Ci.radius);const o=t.parallax;o.anchorPointClouds[0]===0&&o.anchorPointClouds[1]===0&&o.anchorPointClouds[2]===0&&ce(o.anchorPointClouds,Fg);const a=Pe(ge(abt,o.anchorPointClouds,Fg));let l=!0;a>t.fadeIn.distanceThresholdFactor*o.cloudsHeight||t.fadeIn.stage!==Iu.FINISHED?ibt(t,r,n):a>t.fadeInOut.distanceThresholdFactor*o.cloudsHeight||t.fadeInOut.stage!==oo.FINISHED?rbt(t,r,n):a>t.crossFade.distanceThresholdFactor*o.cloudsHeight||t.crossFade.enabled||t.renderingStage===Xn.FADING_TEXTURE_CHANNELS?nbt(t,r,n,(i!==Pi.IDLE||!Bae(t.data))&&t.renderingStage!==Xn.FADING_TEXTURE_CHANNELS):l=!1;const c=s-Ci.radius;if((c>1.7*Kd||c<-Kd)&&t.fadeInOutHeight.factor<1?t.fadeInOutHeight.factor=1:(c>Kd||c<-.35*Kd)&&t.fadeInOutHeight.factor<1?h0e(t,!1,r,n):c<Kd&&c>-.35*Kd&&t.fadeInOutHeight.factor>0?h0e(t,!0,r,n):t.fadeInOutHeight.stage=gw.FINISHED,t.renderingStage===Xn.SWITCH_CHANNELS&&(t.readChannels=1-t.readChannels,t.renderingStage=Xn.FINISHED),o.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(s*s-Ci.radius*Ci.radius,0))/s,l0e(d0e,o.anchorPointClouds,OE),Vu(o.transform,ld,OE[3],OE),l){const{parallaxNew:h}=t;l0e(d0e,h.anchorPointClouds,OE),Vu(h.transform,ld,OE[3],OE)}ce(t.cameraPositionLastFrame,e.eye)}function obt(t){return t.crossFade.enabled||t.fadeInOut.stage!==oo.FINISHED||t.fadeIn.stage!==Iu.FINISHED||t.fadeInOutHeight.stage!==gw.FINISHED||t.renderingStage!==Xn.FINISHED}const d0e=Ue(0,0,1),OE=ZN(),Fg=P(),abt=P(),HNe=1,lbt=.5,cbt=1.3,ubt=1;let VO=class{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(e,i){var r;return(r=this._outer.get(e))==null?void 0:r.get(i)}set(e,i,r){const n=this._outer.get(e);n?n.set(i,r):this._outer.set(e,new Map([[i,r]]))}delete(e,i){const r=this._outer.get(e);r&&(r.delete(i),r.size===0&&this._outer.delete(e))}forEach(e){this._outer.forEach((i,r)=>e(i,r))}};var ls;function p0e(t=ue("enable-feature:high-quality-idle")){const e=new VO;return t&&(e.set(Pi.INTERACTING,ls.Antialiasing,!0),e.set(Pi.IDLE,ls.Antialiasing,!0),e.set(Pi.INTERACTING,ls.HighQualityTransparency,!0),e.set(Pi.IDLE,ls.HighQualityTransparency,!0),e.set(Pi.INTERACTING,ls.RealisticAtmosphere,!0),e.set(Pi.IDLE,ls.RealisticAtmosphere,!0),e.set(Pi.IDLE,ls.SSAO,!0),e.set(Pi.IDLE,ls.WaterReflection,!0),e.set(Pi.IDLE,ls.PhysicalPixelRendering,!0)),e.set(Pi.ANIMATING,ls.ShadowMapUpdate,!0),e.set(Pi.INTERACTING,ls.ShadowMapUpdate,!0),e.set(Pi.IDLE,ls.ShadowMapUpdate,!0),e.set(Pi.IDLE,ls.HighQualityVoxel,!0),e}(function(t){t[t.Antialiasing=0]="Antialiasing",t[t.HighQualityTransparency=1]="HighQualityTransparency",t[t.HighQualityVoxel=2]="HighQualityVoxel",t[t.RealisticAtmosphere=3]="RealisticAtmosphere",t[t.SSAO=4]="SSAO",t[t.WaterReflection=5]="WaterReflection",t[t.ShadowMapUpdate=6]="ShadowMapUpdate",t[t.PhysicalPixelRendering=7]="PhysicalPixelRendering"})(ls||(ls={}));var WR;(function(t){t[t.Immediate=0]="Immediate",t[t.Faded=1]="Faded"})(WR||(WR={}));var VI;const hbt=[Ee.POSTPROCESSING_ENVIRONMENT_OPAQUE,Ee.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];let Co=VI=class extends ve{constructor(t){super(t),this._context=null,this._atmosphere=null,this._hqAtmosphere=null,this._oldWeatherParameters=new nq,this._newWeatherParameters=new nq,this._fadedWeatherParameters=new nq,this._weatherParameters=this._newWeatherParameters}initialize(){this.view._stage.addRenderPlugin(hbt,this)}destroy(){var t;this.removeHandles(),((t=this.view)==null?void 0:t._stage)!=null&&this.view._stage.removeRenderPlugin(this),this._set("view",null)}get atmosphere(){return v(this._hqAtmosphere)&&this.view._stage.renderer.isFeatureEnabled(ls.RealisticAtmosphere)?this._hqAtmosphere:this._atmosphere}get _atmosphereType(){return v(this.atmosphere)?this.atmosphere.type:so.None}get canRender(){var t;return!!((t=this.view.basemapTerrain)!=null&&t.renderer.canRender)||this.view.viewingMode!=="global"}get needsLinearDepth(){return this._atmosphereType===so.Realistic}updateAnimation(t){return!!v(this._precipitation)&&this._precipitation.update(t)}get updating(){return v(this._stars)&&this._stars.updating||v(this._clouds)&&this._clouds.running}get weatherVisible(){return Pe(this.view.state.camera.eye)-sr(this.view.spatialReference).radius<=Kd}get _stars(){var r;const t=this.view,e=((r=t.environment)==null?void 0:r.starsEnabled)??!1,i=this._get("_stars");return!e||R(this._context)?(Ve(i),null):v(i)?i:new O1({view:t,requestRender:()=>this._setNeedsRender()})}get _precipitation(){const t=this._get("_precipitation");if(!this._precipitationEnabled||R(this._context))return Ve(t),null;const e=this.view,i=this._context;return v(t)&&t.context===i?t:(Ve(t),new PT({context:i,view:e}))}get _clouds(){const t=this._get("_clouds");if(!this.weatherEnabled||R(this._context))return Ve(t),null;if(v(t))return t;const e=this.view,i=this._context;return Ve(t),new Ec({context:i,view:e,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const t=this._get("_cloudsComposition");if(!this.weatherEnabled||R(this._context))return Ve(t),null;const e=this.view.state.viewingMode,i=this._context.renderContext.rctx,r=sr(this.view.spatialReference).radius;return v(t)&&t.viewingMode===e&&t.planetRadius===r?t:(Ve(t),new MT({rctx:i,viewingMode:e,planetRadius:r,requestRender:()=>this._setNeedsRender()}))}get _fog(){const t=this._get("_fog");if(!this.weatherEnabled||R(this._context))return Ve(t),null;if(v(t))return t;const e=this.view,i=this._context;return new kI({context:i,view:e})}get _simpleHaze(){const t=this._get("_simpleHaze");if(!this.weatherEnabled||R(this._context))return Ve(t),null;if(v(t))return t;const e=this.view,i=this._context;return new UI({context:i,view:e})}get weatherEnabled(){var t,e;return!!((e=(t=this.view)==null?void 0:t.environmentManager)!=null&&e.weatherEnabled)}get _precipitationEnabled(){return this.weatherEnabled&&(this.view.environment.weather.type==="rainy"||this.view.environment.weather.type==="snowy")}initializeRenderContext(t=null){this._context=t;const e=()=>this._setNeedsRender();this.addHandles([yo(()=>{var i;return(i=this.view)==null?void 0:i.basemapTerrain},()=>this._updateBasemapTerrain(),Jr),ne(()=>({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled,quality:this.view.environment.atmosphere.quality}),i=>this._updateAtmosphere(i),Jr),ne(()=>this._stars,e),ne(()=>this._precipitation,e),ne(()=>this._clouds,()=>this._updateWeather(),zt),ne(()=>this._fog,()=>this._updateFogHaze(),zt),ne(()=>this._simpleHaze,()=>this._updateFogHaze(),zt),ne(()=>this.view.state.mode,()=>{this._setNeedsRender()},Ki),ne(()=>this._atmosphereType,()=>this._updateBasemapTerrain(),Jr),ne(()=>this._weatherUpdateParameters,()=>{this._updateWeather(),this._updateFogHaze()},Jr)])}uninitializeRenderContext(){this._context=null,this._atmosphere=Ve(this._atmosphere),this._hqAtmosphere=Ve(this._hqAtmosphere),this._set("_stars",Ve(this._stars)),this._set("_precipitation",Ve(this._precipitation)),this._set("_clouds",Ve(this._clouds)),this._set("_cloudsComposition",Ve(this._cloudsComposition)),this._set("_fog",Ve(this._fog)),this._set("_simpleHaze",Ve(this._simpleHaze))}prepareRender(t){t.bindParameters.cloudsFade.data=w_t(this._clouds)?this._clouds:null,this.view.viewingMode!=="local"&&(sbt(t.bindParameters.cloudsFade,t.bindParameters.camera,this.view.state.mode,t.time,this.view.qualitySettings.fadeDuration),this._updateWeatherFading(t.bindParameters),t.bindParameters.cloudsFade.renderingStage===Xn.FINISHED&&v(this._clouds)&&this._clouds.coverage===0&&this._clouds.running===!1&&(this._clouds.destroyFrameBufferCube(),t.bindParameters.cloudsFade.data=null))}render(t){if(t.output===z.Color)switch(t.bindParameters.slot){case Ee.POSTPROCESSING_ENVIRONMENT_OPAQUE:v(this._stars)&&this._stars.render(t),v(this.atmosphere)&&(this.atmosphere.render(t),v(this._cloudsComposition)&&v(t.bindParameters.cloudsFade.data)&&(this.weatherVisible&&v(this._clouds)&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(t)),obt(t.bindParameters.cloudsFade)&&v(this._context)&&this._context.requestRender());break;case Ee.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:if(v(this.atmosphere)&&(this.atmosphere.renderHaze(t,this._weatherParameters.haze.amount),this._weatherParameters.haze.amount>0&&this._atmosphereType!==so.Realistic&&v(this._simpleHaze)&&this._simpleHaze.render(t,this._weatherParameters.haze),this._weatherParameters.fog.amount>0&&v(this._fog)&&this._fog.render(t,this._weatherParameters.fog),v(this._precipitation))){const e=this.view.environment.weather;e.type!=="rainy"&&e.type!=="snowy"||this._precipitation.render(t,e.precipitation,e.type)}}}updateLightSources(t,e,i,r){if(v(this._context)){const n=this._context.renderContext;n.bindParameters.oldLighting.copyFrom(n.bindParameters.lighting),n.bindParameters.newLighting.noonFactor=e,n.bindParameters.newLighting.globalFactor=i,n.bindParameters.newLighting.set(t),r===WR.Faded||n.bindParameters.weatherFading?n.bindParameters.fadeLighting(0):n.bindParameters.fadeLighting(1),this._context.requestRender()}}get _weatherUpdateParameters(){const t=this.weatherEnabled?this.view.environment.weather:null;return R(t)?null:t.type==="rainy"||t.type==="snowy"?{type:t.type,weatherAdjustment:t.cloudCover,effect:t.precipitation}:{type:t.type,weatherAdjustment:t.type==="foggy"?t.fogStrength:t.cloudCover}}_updateWeatherFading(t){if(!t.weatherFading)return;const e=t.cloudsFade;return e.fadeIn.stage===Iu.FADE_IN?(t.fadeLighting(e.fadeIn.factor),void this._fadeWeather(e.fadeIn.factor)):e.fadeInOut.stage===oo.FADE_IN?(t.fadeLighting(e.fadeInOut.factor),void this._fadeWeather(e.fadeInOut.factor)):e.crossFade.enabled?(t.fadeLighting(e.crossFade.factor),void this._fadeWeather(e.crossFade.factor)):(t.fadeLighting(0),void this._fadeWeather(0))}_fadeWeather(t){const{_newWeatherParameters:e,_oldWeatherParameters:i}=this;t>=1?this._weatherParameters=e:(this._fadedWeatherParameters.lerp(i,e,t),this._weatherParameters=this._fadedWeatherParameters)}_updateWeather(){const t=this._weatherUpdateParameters;R(t)||R(this._clouds)||(this._clouds.applyPreset(tl[t.type],t.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){v(this._context)&&this._context.requestRender()}_updateFogHaze(){const t=this._weatherUpdateParameters;if(R(this._fog)||R(this._simpleHaze)||R(t)||R(this._context))return;const e=this._context.renderContext.bindParameters;switch(this._oldWeatherParameters.copyFrom(this._weatherParameters),t.type){case"foggy":this._newWeatherParameters.fog.strength=Bt(3e-5,.005,t.weatherAdjustment**3),ce(this._newWeatherParameters.fog.color,f0e),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.haze.strength=0,this._newWeatherParameters.haze.amount=this._atmosphereType===so.Realistic?1:0,this._setNeedsRender();break;case"rainy":this._newWeatherParameters.fog.strength=Bt(4e-6,2e-4,(t.effect??0)**3),ce(this._newWeatherParameters.fog.color,dbt),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.haze.strength=0,this._newWeatherParameters.haze.amount=0,this._setNeedsRender();break;case"snowy":this._newWeatherParameters.fog.strength=Bt(4e-6,2e-4,(t.effect??0)**3),ce(this._newWeatherParameters.fog.color,f0e),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.haze.strength=0,this._newWeatherParameters.haze.amount=this._atmosphereType===so.Realistic?1:0,this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,this._newWeatherParameters.haze.strength=4e-6,this._newWeatherParameters.haze.amount=1,this._setNeedsRender()}e.weatherFading?this._fadeWeather(0):this._fadeWeather(1)}_updateAtmosphere(t){const e=this._selectAtmosphereType(t);if(v(this._atmosphere)?this._atmosphere.type===e:e===so.None)return;this._atmosphere=Ve(this._atmosphere),this._hqAtmosphere=Ve(this._hqAtmosphere);const i=this._getAtmosphereClass(e);i&&v(this._context)&&(this._atmosphere=new i(this.view,this._context),e===so.Simple&&(this._hqAtmosphere=new GH(this.view,this._context))),this._setNeedsRender(),this._updateBasemapTerrain()}_getAtmosphereClass(t){switch(t){case so.Realistic:return GH;case so.Panoramic:return t1t;case so.Simple:return g1t;default:case so.None:return null}}_selectAtmosphereType(t){const{enabled:e,quality:i,viewingMode:r}=t;return!e||xy(this.view.spatialReference)?so.None:r===qe.Local?so.Panoramic:v(this._context)&&i==="high"&&GH.isSupported(this._context)&&zL(this.view.spatialReference)?so.Realistic:so.Simple}_updateBasemapTerrain(){this.view.basemapTerrain&&(this.view.basemapTerrain.velvetOverground=this._atmosphereType===so.Simple)}get test(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled,quality:this.view.environment.atmosphere.quality}),stubGetAtmosphereClass:t=>{m0e=VI.prototype._getAtmosphereClass,VI.prototype._getAtmosphereClass=t},restoreGetAtmosphereClass:()=>{VI.prototype._getAtmosphereClass=m0e}}}};u([d({constructOnly:!0})],Co.prototype,"view",void 0),u([d({readOnly:!0})],Co.prototype,"atmosphere",null),u([d({readOnly:!0})],Co.prototype,"_atmosphereType",null),u([d({type:Boolean,readOnly:!0})],Co.prototype,"updating",null),u([d({readOnly:!0})],Co.prototype,"weatherVisible",null),u([d()],Co.prototype,"_context",void 0),u([d()],Co.prototype,"_atmosphere",void 0),u([d()],Co.prototype,"_hqAtmosphere",void 0),u([d({readOnly:!0})],Co.prototype,"_stars",null),u([d({readOnly:!0})],Co.prototype,"_precipitation",null),u([d({readOnly:!0})],Co.prototype,"_clouds",null),u([d({readOnly:!0})],Co.prototype,"_cloudsComposition",null),u([d({readOnly:!0})],Co.prototype,"_fog",null),u([d({readOnly:!0})],Co.prototype,"_simpleHaze",null),u([d({readOnly:!0})],Co.prototype,"weatherEnabled",null),u([d({readOnly:!0})],Co.prototype,"_precipitationEnabled",null),u([d({readOnly:!0})],Co.prototype,"_weatherUpdateParameters",null),Co=VI=u([$("esri.views.3d.environment.EnvironmentRenderer")],Co);let nq=class{constructor(){this.fog=new mvt,this.haze=new b1t}copyFrom(e){this.fog.amount=e.fog.amount,this.haze.amount=e.haze.amount,this.fog.strength=e.fog.strength,this.haze.strength=e.haze.strength,ce(this.fog.color,e.fog.color)}lerp(e,i,r){this.fog.amount=Bt(e.fog.amount,i.fog.amount,r),this.haze.amount=Bt(e.haze.amount,i.haze.amount,r),this.fog.strength=Bt(e.fog.strength,i.fog.strength,r),this.haze.strength=Bt(e.haze.strength,i.haze.strength,r),ys(this.fog.color,e.fog.color,i.fog.color,r)}};const dbt=Ue(.5,.5,.5),f0e=Ue(1.5,1.5,1.5);let m0e;function g0e(t,e,i){if(R(e.longitude)||R(e.latitude)||R(i.longitude)||R(i.latitude))throw new Error("Invalid points: no lon/lat");return pbt(t,e.longitude,e.latitude,i.longitude,i.latitude)}function pbt(t,e,i,r,n){const s=Xt(i),o=Xt(n),a=s-o,l=Xt(e)-Xt(r),c=Math.sin(a/2),h=Math.sin(l/2),p=2*Pp(Math.sqrt(c*c+Math.cos(s)*Math.cos(o)*h*h))*t;return Math.round(1e4*p)/1e4}function fbt(t,e,i){const r=e.spatialReference,n=sr(r),s=new Le(e.x,t.y,r),o=new Le(i.x,t.y,r),a=new Le(t.x,e.y,r),l=new Le(t.x,i.y,r);return{lon:g0e(n.radius,s,o),lat:g0e(n.radius,a,l)}}function mbt(t,e,i){const r=e/i,n=Xt(t),s=Math.sin(r/2),o=Math.cos(n),a=2*Pp(Math.sqrt(s*s/(o*o)));return ml(a)}function gbt(t,e){let i=t/15;return e||(i=Math.round(i)),i}function y0e(t,e){const i=t==null?void 0:t[0];if(i==null)return null;e||(e={hours:0,minutes:0,seconds:0}),e.hours=gbt(i,!0);const r=e.hours%1;e.hours-=r,e.minutes=60*r;const n=e.minutes%1;return e.minutes-=n,e.seconds=Math.round(60*n),e}var _0e,v0e,b0e,ate={},ybt={get exports(){return ate},set exports(t){ate=t}};_0e=ybt,v0e=function(){var t=Math.PI,e=Math.sin,i=Math.cos,r=Math.tan,n=Math.asin,s=Math.atan2,o=Math.acos,a=t/180,l=864e5,c=2440588,h=2451545,p={dec:0,ra:0};function f(N){return N.valueOf()/l-.5+c}function m(N){return new Date((N+.5-c)*l)}function g(N){return f(N)-h}var _=23.4397*a;function b(N,L){return s(e(N)*i(_)-r(L)*e(_),i(N))}function w(N,L){return n(e(L)*i(_)+i(L)*e(_)*e(N))}function x(N,L,F){return s(e(N),i(N)*e(L)-r(F)*i(L))}function T(N,L,F){return n(e(L)*e(F)+i(L)*i(F)*i(N))}function E(N,L){return a*(280.16+360.9856235*N)-L}function C(N){return a*(357.5291+.98560028*N)}function A(N){return a*(1.9148*e(N)+.02*e(2*N)+3e-4*e(3*N))}function I(N,L){return N+L+102.9372*a+t}function O(N,L){var F=C(N),G=I(F,A(F));return L||(L={dec:0,ra:0}),L.dec=w(G,0),L.ra=b(G,0),L}var D={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(N,L,F,G){var W=a*-F,Z=a*L,X=g(N),oe=O(X,p),pe=E(X,W)-oe.ra;return G||(G={azimuth:0,altitude:0}),G.azimuth=x(pe,Z,oe.dec),G.altitude=T(pe,Z,oe.dec),G}},U=[[-.83,"sunrise","sunset"]];D.addTime=function(N,L,F){U.push([N,L,F])};var V=9e-4;function B(N,L){return Math.round(N-V-L/(2*t))}function ee(N,L,F){return V+(N+L)/(2*t)+F}function ie(N,L,F){return h+N+.0053*e(L)-.0069*e(2*F)}function J(N,L,F){return o((e(N)-e(L)*e(F))/(i(L)*i(F)))}function q(N){var L=a*(134.963+13.064993*N),F=a*(93.272+13.22935*N),G=a*(218.316+13.176396*N)+6.289*a*e(L),W=5.128*a*e(F),Z=385001-20905*i(L);return{ra:b(G,W),dec:w(G,W),dist:Z}}return D.getTimes=function(N,L,F){var G=a*-F,W=a*L,Z=B(g(N),G),X=ee(0,G,Z),oe=C(X),pe=A(oe),ye=I(oe,pe),Se=w(ye,0),He=ie(X,oe,ye);function De(oi){return ie(ee(J(oi,W,Se),G,Z),oe,ye)}function Te(oi){var ei=(e(oi)-e(W)*e(Se))/(i(W)*i(Se));return ei<-1?D.PolarException.MIDNIGHT_SUN:ei>1?D.PolarException.POLAR_NIGHT:D.PolarException.NORMAL}var ke,ze,bt,it,jt,Qt={solarNoon:m(He),nadir:m(He-.5),polarException:D.PolarException.NORMAL};for(ke=0,ze=U.length;ke<ze;ke+=1)jt=He-((it=De((bt=U[ke])[0]*a))-He),Qt[bt[1]]=m(jt),Qt[bt[2]]=m(it);return Qt.polarException=Te(U[0][0]*a),Qt},D.getMoonPosition=function(N,L,F){var G=a*-F,W=a*L,Z=g(N),X=q(Z),oe=E(Z,G)-X.ra,pe=T(oe,W,X.dec);return pe+=.017*a/r(pe+10.26*a/(pe+5.1*a)),{azimuth:x(oe,W,X.dec),altitude:pe,distance:X.dist}},D.getMoonFraction=function(N){var L=g(N),F=O(L),G=q(L),W=149598e3,Z=o(e(F.dec)*e(G.dec)+i(F.dec)*i(G.dec)*i(F.ra-G.ra)),X=s(W*e(Z),G.dist-W*i(Z));return(1+i(X))/2},D},(b0e=v0e())!==void 0&&(_0e.exports=b0e);const C2=ate,Pg={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};function _bt(t,e,i,r,n,s){he(s.ambient.color,1,1,1),s.ambient.intensity=Pg.global.ambient,he(s.direct.color,1,1,1),s.direct.intensity=Pg.global.direct;const o=e[2],a=_e((Math.abs(o)-Pg.local.altitude)/(Pg.global.altitude-Pg.local.altitude),0,1);let l;if(s.globalFactor=a,v(t)&&(l=C2.getTimes(t,e[1],e[0])),a<1){let c;if(v(t))c=Ebt(t,l,r);else{const h=XNe(r);c={direct:{intensity:Pg.local.directAtNoon*h.direct,color:Ue(1,1,1)},ambient:{intensity:Pg.local.ambientAtNoon*h.ambient,color:Ue(1,1,1)},timeOfDay:"early afternoon"}}ys(s.ambient.color,c.ambient.color,s.ambient.color,a),s.ambient.intensity=Bt(c.ambient.intensity,s.ambient.intensity,a),ys(s.direct.color,c.direct.color,s.direct.color,a),s.direct.intensity=Bt(c.direct.intensity,s.direct.intensity,a),s.specularStrength=r==="rainy"||r==="snowy"||r==="foggy"?0:1,s.environmentStrength=r==="rainy"?.7:r==="snowy"||r==="foggy"?.75:1}s.noonFactor=v(t)?Sbt(t,l):1,v(t)?vbt(t,e,i,s.direct.directionToLightSource):qNe(n,i,s.direct.directionToLightSource)}function qNe(t,e,i){e===qe.Global?we(sq,t.eye):he(sq,0,0,1),le(oq,t.viewForward,-1);const r=SU(oq,sq),n=Math.max(r-2*aq,0),s=.85*n/(n+1),o=Math.max(aq,r-aq-s);ad(x0e,-o,t.viewRight),Ke(i,oq,x0e),me(i,i,le(Cbt,t.viewRight,Abt)),we(i,i)}function vbt(t,e,i,r){const n=Tbt,s=Lp(xbt);if(i===qe.Global)C2.getPosition(t,0,0,n),he(r,0,0,-1),AM(s,s,-n.azimuth),nB(s,s,-n.altitude),Ke(r,r,s);else{const o=Pg.planarDirection,a=o.globalAngles,l=e[2];let c=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);c=_e(c,0,1),c<1?(C2.getPosition(t,e[1],e[0],n),n.azimuth=(1-c)*n.azimuth+c*a.azimuth,n.altitude=(1-c)*n.altitude+c*a.altitude):(n.azimuth=a.azimuth,n.altitude=a.altitude),he(r,0,-1,0),RM(s,s,-n.azimuth),AM(s,s,-n.altitude),Ke(r,r,s)}}function bbt(t,e){if(e===qe.Global)return!0;const i=Pg.planarDirection;return Math.abs(t)<i.localAltitude}const wbt=Ue(.5773502691896258,-.5773502691896258,.5773502691896258);let WNe=class{constructor(){this.ambient={color:Ue(1,1,1),intensity:.55},this.direct={color:Ue(1,1,1),intensity:.55,directionToLightSource:In(wbt)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}};const xbt=$e(),Tbt={azimuth:0,altitude:0};function Sbt(t,e){const i=t.valueOf();let r,n;e.polarException===C2.PolarException.MIDNIGHT_SUN?(r=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,n=r+432e6):e.polarException===C2.PolarException.POLAR_NIGHT?(r=i-2,n=i-1):(r=e.sunrise.valueOf(),n=e.sunset.valueOf());const s=r+(n-r)/2;return 1-_e(Math.abs(i-s)/432e5,0,1)}function XNe(t){switch(t){case"disabled":case"sunny":case"cloudy":return{direct:1,ambient:1};case"rainy":return{direct:.4,ambient:1.2};case"snowy":return{direct:.5,ambient:1.3};case"foggy":return{direct:.2,ambient:1.6}}}function w0e(t,e){const i=(t[0]+t[1]+t[2])/3;for(let r=0;r<3;r++)t[r]=t[r]+(i-t[r])*e;return t}function Ebt(t,e,i){const r=t.valueOf();let n,s;e.polarException===C2.PolarException.MIDNIGHT_SUN?(n=r-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,s=n+432e6):e.polarException===C2.PolarException.POLAR_NIGHT?(n=r-2,s=r-1):(n=e.sunrise.valueOf(),s=e.sunset.valueOf());const o=s-n,a=n+o/2,l=o/4,c=a-l,h=a+l,p=.06*o,f=n-p/2,m=n+p/2,g=s-p/2,_=s+p/2,b=Pg.local,w=[.01,b.ambientAtNight],x=[.8,.8,1],T=[.01,.01,.01],E=[b.directAtTwilight,b.ambientAtTwilight],C=[1,.6,.5],A=[.8,.8,1],I=[.9*b.directAtNoon,b.ambientAtNoon],O=[1,.98,.98],D=[.98,.98,1],U=[b.directAtNoon,b.ambientAtNoon],V=[1,1,1],B=[1,1,1],ee=I,ie=O,J=D,q=E,N=C,L=A;let F,G,W=[0,0],Z=[0,0,0],X=[0,0,0];r<f||r>_?(W=w,Z=T,X=x,G="night"):r<m?(F=m-f,W=Ra(r-f,F,w,E),Z=Ra(r-f,F,T,C),X=Ra(r-f,F,x,A),G="sun rising"):r<c?(F=c-m,W=Ra(r-m,F,E,I),Z=Ra(r-m,F,C,O),X=Ra(r-m,F,A,D),G="early morning"):r<a?(F=a-c,W=Ra(r-c,F,I,U),Z=Ra(r-c,F,O,V),X=Ra(r-c,F,D,B),G="late morning"):r<h?(F=h-a,W=Ra(r-a,F,U,ee),Z=Ra(r-a,F,V,ie),X=Ra(r-a,F,B,J),G="early afternoon"):r<g?(F=g-h,W=Ra(r-h,F,ee,q),Z=Ra(r-h,F,ie,N),X=Ra(r-h,F,J,L),G="late afternoon"):r<_&&(F=_-g,W=Ra(r-g,F,q,w),Z=Ra(r-g,F,N,T),X=Ra(r-g,F,L,x),G="sun setting");let oe=0;switch(i){case"rainy":case"foggy":case"snowy":oe=.5}oe>0&&(Z=w0e(Z,oe),X=w0e(X,oe));const pe=Ue(Z[0],Z[1],Z[2]),ye=Ue(X[0],X[1],X[2]),Se=XNe(i);return{direct:{intensity:W[0]*Se.direct,color:pe},ambient:{intensity:W[1]*Se.ambient,color:ye},timeOfDay:G}}function Ra(t,e,i,r){const n=[];for(let s=0;s<i.length;s++)n[s]=(r[s]-i[s])*t/e+i[s];return n}const x0e=$e(),sq=P(),oq=P(),Cbt=P(),aq=.25,Abt=.2;let xf=class extends An.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandles=new Xi,this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new uz,this._ambientLight=new jae,this._moonLight=new eNe,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView(),this._viewHandles.destroy()}get _view(){var e;return(e=this._renderer)==null?void 0:e.view}get updating(){var e;return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!((e=this._renderer)!=null&&e.updating))}get weatherEnabled(){var e,i,r;return((e=this._view)==null?void 0:e.environment.atmosphereEnabled)&&!this._disableWeather&&((r=(i=this._view)==null?void 0:i.state)==null?void 0:r.viewingMode)===qe.Global&&zL(this._view.spatialReference)}get weatherVisible(){var e;return this.weatherEnabled&&((e=this._renderer)==null?void 0:e.weatherVisible)}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){if(this._renderer)return;this._renderer=new Co({view:e});const i=()=>this._updateRenderParameters(),r=()=>this._cameraHandler();this._viewHandles.add([ne(()=>e.environment.lighting,n=>this._updateLightingHandler(n),Ki),ne(()=>e.environment.lighting.type!=="virtual"?e.environment.lighting.date:null,n=>this._lightingDateHandler(n),Ki),ne(()=>e.stationary,()=>this._interactingStationaryHandler()),ne(()=>e.environment.lighting.directShadowsEnabled,i,Ki),ne(()=>e.environment.lighting.ambientOcclusionEnabled,i,Ki),ne(()=>e.environment.lighting.waterReflectionEnabled,i,Ki),ne(()=>{var n;return(n=e.environment.background)==null?void 0:n.color},i,Ki),ne(()=>e.spatialReference,()=>this._resetReferencePosition(!0),Ki),ne(()=>e.environment.weather.type,()=>this._updateLighting(null,WR.Faded),Ki),ne(()=>this.weatherEnabled,()=>this._updateLighting(null,WR.Faded),Ki),ne(()=>e.viewingMode,()=>this._resetReferencePosition(!0),Jr),ne(()=>e.environment.lighting.type!=="virtual"&&e.environment.lighting.cameraTrackingEnabled,n=>this._updateCameraTracking(n),Jr),ne(()=>e.state.camera,r,Jr),ne(()=>this.disableQueries,r)]),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer=Ve(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type!=="virtual"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type!=="virtual"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const i=this._view.environment.lighting;(i==null?void 0:i.type)!=="virtual"&&(i.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const i=this._view.environment.lighting;if((i==null?void 0:i.type)!=="virtual"){if(e){if(!i.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const r=this._view.spatialReference;if(!d2(r)){const n=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(n))return void this._requestReferencePositionUpdate(n)}if(this._preupdateTracking(e),v(this._referencePosWGS84Comparable)){const n=y0e(this._referencePosWGS84Comparable,T0e);v(n)&&(i.autoUpdate(null,n),this._trackingEnabled&&(i.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type!=="virtual"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const i=this._view;if(!i.ready)return;const r=i.stateManager.camera;r&&(this._cameraHandlerClientSide(r,e)||this._cameraHandlerServerSide(r))}_cameraHandlerClientSide(e,i){const r=zL(this._view.spatialReference);if(r&&!d2(this._view.spatialReference))return this._view.environment.lighting.type==="virtual"&&this._updateLighting(),!1;const n=e.position;return R(this._referencePosWGS84Comparable)&&(this._referencePosWGS84Comparable=P()),r?CZe(n,this._referencePosWGS84Comparable):he(this._referencePosWGS84Comparable,n.longitude??0,n.latitude??0,n.z??0),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,i)||this._updateLighting(i),!0}_cameraHandlerServerSide(e){const i=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(i))&&this._requestReferencePositionUpdate(i,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=(i.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e,i=WR.Immediate){const r=this._view;e=e||(r.environment.lighting.type==="virtual"?null:r.environment.lighting.date);const n=this._referencePosWGS84Comparable,s=v(n)?Rbt:Mbt,o=this.weatherVisible?r.environment.weather.type:"disabled";v(n)?_bt(e,n,r.state.viewingMode,o,r.state.camera,s):r.environment.lighting.type==="virtual"&&qNe(r.state.camera,r.state.viewingMode,s.direct.directionToLightSource);const a=this._mainLight,l=s.direct;le(a.intensity,l.color,l.intensity*Math.PI),ce(a.direction,l.directionToLightSource),a.specularStrength=s.specularStrength,a.environmentStrength=s.environmentStrength;const c=this._ambientLight;le(c.intensity,s.ambient.color,s.ambient.intensity);const h=this._moonLight;ys(h.intensity,Pbt,Ibt,s.globalFactor);const p=(1-.5*s.globalFactor)*(1-.4*s.noonFactor*(1-s.globalFactor));le(h.intensity,h.intensity,p),ce(h.direction,l.directionToLightSource),this._renderer.updateLightSources([a,c,h],s.noonFactor,s.globalFactor,i),this._updateRenderParameters()}_autoUpdateTimezone(e,i=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||R(e))return!1;const r=Obt;r.setTime((i||this._view.environment.lighting.date).getTime());const n=y0e(e,T0e);if(R(n))return!1;let s=this._view.environment.lighting.positionTimezoneInfo;if(s.autoUpdated){if(s.hours===n.hours&&s.minutes===n.minutes&&s.seconds===n.seconds)return!1}else s=n;const o=r.getUTCHours()-(n.hours-s.hours),a=r.getUTCMinutes()-(n.minutes-s.minutes),l=r.getUTCSeconds()-(n.seconds-s.seconds);return r.setUTCHours(o),r.setUTCMinutes(a),r.setUTCSeconds(l),!i&&this._view.environment.lighting.autoUpdate(r,n)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const i=jh(this._referencePosWGS84Comparable,!0,s=>bbt(s[2],this._view.state.viewingMode)),r=this._view.environment.background,n=r instanceof lDe?{type:"color",color:loe(Xe.toUnitRGBA(r.color))}:{type:"color",color:Zt(0,0,0,1)};e.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&i,background:n,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,i=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!i,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const r=this._referencePosUpdateQuery=t2(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===r){const s=()=>this._referencePosUpdateQuery!==r;return this._doReferencePositionUpdateQuery(s)}}).catch(s=>{s.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===r&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),n=this._referencePosUpdateTimer=t2(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===n&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const i=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(i[0])&&!isNaN(i[1])){const r=(this._referencePosMapCoords.z??0)*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=i[0],this._referencePosWGS84Comparable[1]=i[1],this._referencePosWGS84Comparable[2]=r):this._referencePosWGS84Comparable=[i[0],i[1],r],this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let i=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(i*=this._view.mapCoordsHelper.unitInMeters),i>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){const e=this;return{get renderer(){return e._renderer},set referencePointUpdateInterval(i){e._referencePointUpdateInterval=i},set referencePointUpdateDistThreshold(i){e._referencePointUpdateDistThreshold=i},set referencePosUpdateTimer(i){e._referencePosUpdateTimer=i},set referencePointUpdateDelay(i){e._referencePointUpdateDelay=i},set disableWeather(i){e._disableWeather=i}}}};u([d({type:Boolean,readOnly:!0})],xf.prototype,"updating",null),u([d()],xf.prototype,"disableQueries",void 0),u([d()],xf.prototype,"_disableWeather",void 0),u([d()],xf.prototype,"weatherEnabled",null),u([d()],xf.prototype,"weatherVisible",null),u([d()],xf.prototype,"referencePositionWGS84Comparable",null),u([d()],xf.prototype,"_renderer",void 0),u([d()],xf.prototype,"_referencePosWGS84Comparable",void 0),xf=u([$("esri.views.3d.environment.SceneViewEnvironmentManager")],xf);const Rbt=new WNe,Mbt=new WNe,Obt=new Date,T0e={hours:0,minutes:0,seconds:0},Pbt=Ue(.22,.22,.33),Ibt=Ue(.22,.22,.22);var Zr;(function(t){t[t.NONE=0]="NONE",t[t.TILT=1]="TILT",t[t.ALTITUDE=2]="ALTITUDE",t[t.DISTANCE=4]="DISTANCE",t[t.COLLISION=8]="COLLISION",t[t.ALL=15]="ALL",t[t.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"})(Zr||(Zr={}));var fi;(function(t){t[t.NONE=0]="NONE",t[t.ZOOM=1]="ZOOM",t[t.TUMBLE=2]="TUMBLE",t[t.LOOK_AROUND=3]="LOOK_AROUND",t[t.PAN=4]="PAN",t[t.ASCEND=5]="ASCEND"})(fi||(fi={}));var Ho;(function(t){t[t.TUMBLE=0]="TUMBLE",t[t.LOOK_AROUND=1]="LOOK_AROUND"})(Ho||(Ho={}));function CD(t,e){return(t&e)!=0}function gz(t,e,i,r,n,s){t!==0&&(i?(s.min=Math.min(s.min,e),s.max=Math.max(s.max,e)):r!=null?(s.min-=Math.max(0,(e-s.min)*(1-r)),s.max+=Math.max(0,(e-s.max)*(1-r))):n&&(s.min-=Math.max(0,e-s.min-n),s.max+=Math.max(0,e-s.max-n)))}const bw={selection:Zr.NONE,interactionType:fi.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Ho.TUMBLE};function YNe(t,e,i,r){return e=e||t.viewForward,ce(r,e),le(r,r,Math.sign(be(e,i))),r}function $bt(t,e,i,r){return kbt(t,e,i,Nbt(r,e,i,!0))}function Lbt(t,e,i,r){const n=be(i,ge(t,r,e));return me(t,e,le(t,i,n))}const Dbt={dir:P(),len:0,clip:Fe()};function Nbt(t,e,i,r){const n=Dbt;return t?(i&&r&&(n.len=Lr(e,i)),ce(n.dir,t)):r?(n.len=Lr(e,i),ge(n.dir,i,e),le(n.dir,n.dir,1/n.len)):(ge(n.dir,i,e),we(n.dir,n.dir)),n}function Fbt(t,e,i){const r=be(t,i.dir),n=-Pr(t,e);if(n<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return n>0;if((n<0||r<0)&&!(n<0&&r<0))return!0;const s=n/r;return r>0?s<i.clip[1]&&(i.clip[1]=s):s>i.clip[0]&&(i.clip[0]=s),i.clip[0]<=i.clip[1]}function kbt(t,e,i,r){r.clip[0]=0,r.clip[1]=i?r.len:Number.MAX_VALUE;for(let n=0;n<t.length;n++)if(!Fbt(t[n],e,r))return!1;return!0}function Ubt(t,e,i=bw){const r=cle(t,e,i);if(r===0)return!1;const n=t.renderCoordsHelper,s=n.getAltitude(e.eye)+r,o=YNe(e,i.interactionDirection,Bbt(t,e,Math.sign(r),qbt),Hbt),a=ce(Wbt,e.viewForward),l=n.intersectInfiniteManifold(cd(e.eye,o),s,lq);return e.eye=v(l)?l:n.setAltitude(lq,s,e.eye),e.center=Lbt(lq,e.eye,a,e.center),!0}function cle(t,e,i=bw){if(!Vbt(t,i)||!t.state.constraints.altitude)return 0;const r=jbt(t.state.constraints.altitude,Gbt);zbt(t,i,r);const n=t.renderCoordsHelper.getAltitude(e.eye),s=_e(n,r.min,r.max)-n;return Math.abs(s)<=1e-6?0:s}function Vbt(t,e){const i=t.state.constraints.altitude;return!(!t.state.isGlobal||!i)&&(e.interactionType!==fi.TUMBLE||!CD(e.selection,Zr.TILT))}function zbt(t,e,i){const r=e.interactionType;if(r===fi.NONE)return;const{min:n,max:s}=i,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=r===fi.TUMBLE||r===fi.ZOOM,c=cle(t,o),h=c===0?0:t.renderCoordsHelper.getAltitude(o.eye);i.min=n,i.max=s,gz(c,h,l,a,.05*h,i)}function Bbt(t,e,i,r){return t.renderCoordsHelper.worldUpAtPosition(e.eye,r),le(r,r,i),r}function jbt(t,e){return e.min=t.min,e.max=t.max,e}const Gbt={min:0,max:0},Hbt=P(),qbt=P(),Wbt=P(),lq=P();function ule(t,e,i=bw){if(!t.state.isLocal)return 0;const r=t.state.constraints.distance;if(!t.pointsOfInterest.surfaceOrigin.renderLocation||r===1/0)return 0;t5.min=0,t5.max=r,Ybt(t,i,t5);const n=hle(t,e),s=t5.max-n;return s>=-1e-6?0:s}function Xbt(t,e,i=bw){const r=ule(t,e,i);if(r===0)return!1;const n=t.pointsOfInterest.surfaceOrigin;if(!n.renderLocation)return!1;const s=hle(t,e)+r,o=ce(Jbt,e.eye),a=YNe(e,i.interactionDirection,Zbt(e,n.renderLocation,ewt),Qbt);if(!Vw(MLe(n.renderLocation,s),cd(e.eye,a),i5))return!1;e.eye=i5;const l=ge(Kbt,e.eye,o);e.center=me(i5,e.center,l);const c=t.renderCoordsHelper.getAltitude(e.center),h=t.renderCoordsHelper.intersectInfiniteManifold(e.ray,c,i5);return v(h)&&(e.center=h),!0}function Ybt(t,e,i){const r=e.interactionType;if(r===fi.NONE)return;const{min:n,max:s}=i,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=r===fi.ZOOM||r===fi.PAN,c=ule(t,o),h=c===0?0:hle(t,o);i.min=n,i.max=s,gz(c,h,l,a,.05*h,i)}function hle(t,e){const i=t.pointsOfInterest.surfaceOrigin;return i.renderLocation?Lr(e.eye,i.renderLocation):0}function Zbt(t,e,i){return V_(i,t.eye,e)}const t5={min:0,max:0},Jbt=P(),Kbt=P(),Qbt=P(),ewt=P(),i5=P();var gn,Ta;(function(t){t[t.OBJECT=0]="OBJECT",t[t.HUD=1]="HUD",t[t.TERRAIN=2]="TERRAIN",t[t.OVERLAY=3]="OVERLAY",t[t.I3S=4]="I3S",t[t.PCL=5]="PCL",t[t.LOD=6]="LOD",t[t.VOXEL=7]="VOXEL"})(gn||(gn={}));let twt=class{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=Ta.ALL}};(function(t){t[t.MIN=0]="MIN",t[t.MINMAX=1]="MINMAX",t[t.ALL=2]="ALL"})(Ta||(Ta={}));let iwt=class{constructor(e,i,r){this.object=e,this.geometryId=i,this.triangleNr=r}},rwt=class extends iwt{constructor(e,i,r,n){super(e,i,r),this.center=v(n)?In(n):null}},ZNe=class{constructor(e){this.layerUid=e}},c7=class extends ZNe{constructor(e,i){super(e),this.graphicUid=i}};function Mm(t){return v(t)&&v(t.dist)}function S0e(t){return(e,i,r)=>(ys(E0e,e,i,r),!Sae(t,E0e))}function u7(t){return Mm(t)&&t.intersector===gn.OBJECT&&!!t.target}function h7(t){return Mm(t)&&t.intersector===gn.HUD&&!!t.target&&"center"in t.target&&v(t.target.center)}const E0e=P();let nwt=class{constructor(){this._transform=$e(),this._transformInverse=new r5({value:this._transform},wa,$e),this._transformInverseTranspose=new r5(this._transformInverse,Ku,$e),this._transformTranspose=new r5({value:this._transform},Ku,$e),this._transformInverseRotation=new r5({value:this._transform},a$e,wr)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){go(this._transform,e)}multiplyTransform(e){$n(this._transform,this._transform,e)}set(e){go(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,i){this.setTransformMatrix(e),this.multiplyTransform(i),this._invalidateLazyTransforms()}},r5=class{constructor(e,i,r){this._original=e,this._update=i,this._dirty=!0,this._transform=r()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}},swt=class{constructor(e=0){this.offset=e,this.tmpVertex=P()}applyToVertex(e,i,r){const n=e+this.localOrigin[0],s=i+this.localOrigin[1],o=r+this.localOrigin[2],a=this.offset/Math.sqrt(n*n+s*s+o*o);return this.tmpVertex[0]=e+n*a,this.tmpVertex[1]=i+s*a,this.tmpVertex[2]=r+o*a,this.tmpVertex}applyToAabb(e){for(let s=0;s<3;++s)Cv[s]=e[0+s]+this.localOrigin[s],n5[s]=e[3+s]+this.localOrigin[s],PE[s]=Cv[s];const i=this.applyToVertex(Cv[0],Cv[1],Cv[2]);for(let s=0;s<3;++s)e[s]=i[s],e[s+3]=i[s];const r=s=>{const o=this.applyToVertex(s[0],s[1],s[2]);for(let a=0;a<3;++a)e[a+0]=Math.min(e[a+0],o[a]),e[a+3]=Math.max(e[a+3],o[a])};for(let s=1;s<8;++s){for(let o=0;o<3;++o)PE[o]=s&1<<o?n5[o]:Cv[o];r(PE)}let n=0;for(let s=0;s<3;++s)Cv[s]*n5[s]<0&&(n|=1<<s);if(n!==0&&n!==7){for(let s=0;s<8;++s)if(!(n&s)){for(let o=0;o<3;++o)n[o]?PE[o]=0:PE[o]=s&1<<o?Cv[o]:n5[o];r(PE)}}for(let s=0;s<3;++s)e[s+0]-=this.localOrigin[s],e[s+3]-=this.localOrigin[s];return e}};const Cv=P(),n5=P(),PE=P();let owt=class{constructor(e=0){this.componentLocalOriginLength=0,this._tmpVertex=P(),this._mbs=Is(),this._obb={center:P(),halfSize:rn(),quaternion:null},this._totalOffset=0,this._offset=0,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}applyToVertex(e,i,r){const n=e,s=i,o=r+this.componentLocalOriginLength,a=this._totalOffset/Math.sqrt(n*n+s*s+o*o);return this._tmpVertex[0]=e+n*a,this._tmpVertex[1]=i+s*a,this._tmpVertex[2]=r+o*a,this._tmpVertex}applyToAabb(e){const i=e[0],r=e[1],n=e[2]+this.componentLocalOriginLength,s=e[3],o=e[4],a=e[5]+this.componentLocalOriginLength,l=i*s<0?0:Math.min(Math.abs(i),Math.abs(s)),c=r*o<0?0:Math.min(Math.abs(r),Math.abs(o)),h=n*a<0?0:Math.min(Math.abs(n),Math.abs(a)),p=Math.sqrt(l*l+c*c+h*h);if(p<this._totalOffset)return e[0]-=i<0?this._totalOffset:0,e[1]-=r<0?this._totalOffset:0,e[2]-=n<0?this._totalOffset:0,e[3]+=s>0?this._totalOffset:0,e[4]+=o>0?this._totalOffset:0,e[5]+=a>0?this._totalOffset:0,e;const f=Math.max(Math.abs(i),Math.abs(s)),m=Math.max(Math.abs(r),Math.abs(o)),g=Math.max(Math.abs(n),Math.abs(a)),_=Math.sqrt(f*f+m*m+g*g),b=this._totalOffset/_,w=this._totalOffset/p;return e[0]+=i*(i>0?b:w),e[1]+=r*(r>0?b:w),e[2]+=n*(n>0?b:w),e[3]+=s*(s<0?b:w),e[4]+=o*(o<0?b:w),e[5]+=a*(a<0?b:w),e}applyToMbs(e){const i=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),r=this._totalOffset/i;return this._mbs[0]=e[0]+e[0]*r,this._mbs[1]=e[1]+e[1]*r,this._mbs[2]=e[2]+e[2]*r,this._mbs[3]=e[3]+e[3]*this._totalOffset/i,this._mbs}applyToObb(e){const i=e.center,r=this._totalOffset/Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);this._obb.center[0]=i[0]+i[0]*r,this._obb.center[1]=i[1]+i[1]*r,this._obb.center[2]=i[2]+i[2]*r,om(this._obb.halfSize,e.halfSize,e.quaternion),me(this._obb.halfSize,this._obb.halfSize,e.center);const n=this._totalOffset/Math.sqrt(this._obb.halfSize[0]*this._obb.halfSize[0]+this._obb.halfSize[1]*this._obb.halfSize[1]+this._obb.halfSize[2]*this._obb.halfSize[2]);return this._obb.halfSize[0]+=this._obb.halfSize[0]*n,this._obb.halfSize[1]+=this._obb.halfSize[1]*n,this._obb.halfSize[2]+=this._obb.halfSize[2]*n,ge(this._obb.halfSize,this._obb.halfSize,e.center),E2(M0e,e.quaternion),om(this._obb.halfSize,this._obb.halfSize,M0e),this._obb.halfSize[0]*=this._obb.halfSize[0]<0?-1:1,this._obb.halfSize[1]*=this._obb.halfSize[1]<0?-1:1,this._obb.halfSize[2]*=this._obb.halfSize[2]<0?-1:1,this._obb.quaternion=e.quaternion,this._obb}},awt=class{constructor(e=0){this.offset=e,this.sphere=Is(),this.tmpVertex=P()}applyToVertex(e,i,r){const n=this.objectTransform.transform;let s=n[0]*e+n[4]*i+n[8]*r+n[12],o=n[1]*e+n[5]*i+n[9]*r+n[13],a=n[2]*e+n[6]*i+n[10]*r+n[14];const l=this.offset/Math.sqrt(s*s+o*o+a*a);s+=s*l,o+=o*l,a+=a*l;const c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*s+c[4]*o+c[8]*a+c[12],this.tmpVertex[1]=c[1]*s+c[5]*o+c[9]*a+c[13],this.tmpVertex[2]=c[2]*s+c[6]*o+c[10]*a+c[14],this.tmpVertex}applyToMinMax(e,i){const r=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*r,e[1]+=e[1]*r,e[2]+=e[2]*r;const n=this.offset/Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);i[0]+=i[0]*n,i[1]+=i[1]*n,i[2]+=i[2]*n}applyToAabb(e){const i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i;const r=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*r,e[4]+=e[4]*r,e[5]+=e[5]*r,e}applyToBoundingSphere(e){const i=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),r=this.offset/i;return this.sphere[0]=e[0]+e[0]*r,this.sphere[1]=e[1]+e[1]*r,this.sphere[2]=e[2]+e[2]*r,this.sphere[3]=e[3]+e[3]*this.offset/i,this.sphere}};const C0e=new awt;function lte(t){return v(t)?(C0e.offset=t,C0e):null}const A0e=new owt;function lwt(t){return v(t)?(A0e.offset=t,A0e):null}const R0e=new swt;function cwt(t){return v(t)?(R0e.offset=t,R0e):null}const eb="terrain",M0e=zp(),JM=1e-5;let uwt=class{constructor(e){this.options=new twt,this._results=new hwt,this.transform=new nwt,this.tolerance=JM,this.verticalOffset=null,this._ray=ko(),this._rayEnd=P(),this._rayBeginTransformed=P(),this._rayEndTransformed=P(),this.viewingMode=e??qe.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,i,r){this.resetWithRay(Jgt(e,i,this._ray),r)}resetWithRay(e,i){this.camera=i,e!==this._ray&&nz(e,this._ray),this.options.verticalOffset!==0?this.viewingMode===qe.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,me(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,i,r,n,s){this.point=i,this.filterPredicate=n,this.tolerance=r??JM;const o=lte(this.verticalOffset);if(v(e)&&e.length>0){const a=s?l=>{s(l)&&this.intersectObject(l)}:l=>{this.intersectObject(l)};for(const l of e){const c=l.getSpatialQueryAccelerator&&l.getSpatialQueryAccelerator();v(c)?(v(o)?c.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,a,o):c.forEachAlongRay(this._ray.origin,this._ray.direction,a),this.options.selectionMode&&this.options.hud&&c.forEachDegenerateObject(a)):l.objects.forAll(h=>a(h))}}this.sortResults()}intersectObject(e){const i=e.geometries;if(!i)return;const r=e.transformation,n=lte(this.verticalOffset);for(const s of i){if(!s.visible)continue;const{material:o,id:a}=s;this.transform.setAndInvalidateLazyTransforms(r,s.shaderTransformation),Ke(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),Ke(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;v(n)&&(n.objectTransform=this.transform),o.intersect(s,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(c,h,p,f,m,g)=>{if(c>=0){if(v(this.filterPredicate)&&!this.filterPredicate(this._ray.origin,this._rayEnd,c))return;const _=f?this._results.hud:this._results,b=f?w=>{const x=new rwt(e,a,p,g);w.set(gn.HUD,x,c,h,ld,m)}:w=>w.set(gn.OBJECT,{object:e,geometryId:a,triangleNr:p},c,h,l,m);if((_.min.drapedLayerOrder==null||m>=_.min.drapedLayerOrder)&&(_.min.dist==null||c<_.min.dist)&&b(_.min),this.options.store!==Ta.MIN&&(_.max.drapedLayerOrder==null||m<_.max.drapedLayerOrder)&&(_.max.dist==null||c>_.max.dist)&&b(_.max),this.options.store===Ta.ALL)if(f){const w=new cte(this._ray);b(w),this._results.hud.all.push(w)}else{const w=new XR(this._ray);b(w),this._results.all.push(w)}}})}}sortResults(e=this._results.all){e.sort((i,r)=>i.dist!==r.dist?Nt(i.dist,0)-Nt(r.dist,0):i.drapedLayerOrder!==r.drapedLayerOrder?Nt(i.drapedLayerOrder,Number.MAX_VALUE)-Nt(r.drapedLayerOrder,Number.MAX_VALUE):Nt(r.drapedLayerGraphicOrder,Number.MIN_VALUE)-Nt(i.drapedLayerGraphicOrder,Number.MIN_VALUE))}};function Fp(t){return new uwt(t)}let hwt=class{constructor(){this.min=new XR(ko()),this.max=new XR(ko()),this.hud={min:new cte(ko()),max:new cte(ko()),all:new Array},this.ground=new XR(ko()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}},XR=class{get ray(){return this._ray}get distanceInRenderSpace(){return v(this.dist)?(le(s5,this.ray.direction,this.dist),Pe(s5)):null}getIntersectionPoint(e){return!!Mm(this)&&(le(s5,this.ray.direction,this.dist),me(e,this.ray.origin,s5),!0)}getTransformedNormal(e){return ce(D3,this.normal),D3[3]=0,Jh(D3,D3,this.transformation),ce(e,D3),we(e,e)}constructor(e){this.intersector=gn.OBJECT,this.normal=P(),this.transformation=$e(),this._ray=ko(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=gn.OBJECT,nz(e,this._ray)}set(e,i,r,n,s,o,a){this.intersector=e,this.dist=r,ce(this.normal,Nt(n,QEe)),go(this.transformation,Nt(s,ld)),this.target=i,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(e){nz(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,ce(this.normal,e.normal),go(this.transformation,e.transformation)}},cte=class extends XR{constructor(){super(...arguments),this.intersector=gn.HUD}};function dle(t){return new XR(t)}const s5=P(),D3=pi();function JNe(t,e,i,r){return v(t.renderCoordsHelper.fromRenderCoords(e.eye,yz,r))&&TCe(i,yz)}function d7(t,e){return t.elevationProvider?Nt(t.elevationProvider.getElevation(e[0],e[1],e[2],t.renderCoordsHelper.spatialReference,"ground"),0):0}function J2(t,e,i,r){const n=t.state.camera.clone();e&&i&&r&&(n.eye=e,n.center=i,n.up=r),dwt(t,n.ray,Av)||ce(Av,n.center);const s=t.state.constraints,o=s.minimumPoiDistance;if(ba(n.eye,Av)<o){const a=s.collision.enabled;ce(cx,n.viewForward),le(cx,cx,o),a?n.eye=ge(yz,Av,cx):me(Av,n.eye,cx);const l=t.renderCoordsHelper,c=l.getAltitude(n.eye),h=s.collision.elevationMargin;a&&c<h&&(ge(cx,Av,n.eye),n.eye=l.setAltitude(yz,h,n.eye),me(Av,n.eye,cx))}return n.center=Av,n}function O0e(t,e,i){if(!t.state.isGlobal||!t.stateManager.constraintsManager)return!1;const r=d7(t,e),n=t.stateManager.constraintsManager.nearFarHeuristic,{far:s}=n.compute(e,i,t.renderDataExtent,r,fwt),o=s*s;return ba(e,i)>o}function dwt(t,e,i){let r=P0e[t.viewingMode];r||(r=Fp(t.state.viewingMode),r.options.backfacesTerrain=!t.state.isGlobal,r.options.invisibleTerrain=!0,P0e[t.viewingMode]=r);const{isGlobal:n}=t.state;return!(!t.sceneIntersectionHelper.intersectRay(e,r,i)||O0e(t,e.origin,i))||!(!t.renderCoordsHelper.intersectManifold(e,0,i)||O0e(t,e.origin,i))||!!n&&pwt(e,i,sr(t.spatialReference).radius)}function pwt(t,e,i){const r=be(t.origin,t.origin)-i*i,n=r>0?Math.sqrt(r)/3:1;return le(e,t.direction,n/Pe(t.direction)),me(e,e,t.origin),!0}const P0e={},yz=P(),Av=P(),cx=P(),fwt={near:0,far:0};function zO(t,e,i=_p.EYE){const r=t.state.constraints;if(!r.collision.enabled)return!1;const n=d7(t,e.eye),s=t.renderCoordsHelper.getAltitude(e.eye),o=n+r.collision.elevationMargin;if(s>=o)return!1;const a=Pe(e.eye);if(ge(o5,e.center,e.eye),e.eye=t.renderCoordsHelper.setAltitude(mwt,o,e.eye),i===_p.EYE_AND_CENTER)e.center=me(o5,e.eye,o5);else if(i===_p.EYE_AND_CENTER_SCALE){const l=(a-s+o)/a;e.center=le(o5,e.center,l)}return!0}var _p;(function(t){t[t.EYE=0]="EYE",t[t.EYE_AND_CENTER=1]="EYE_AND_CENTER",t[t.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(_p||(_p={}));const o5=P(),mwt=P();function ww(t,e,i){t.worldUpAtPosition(e,I0e),ge(cq,i,e);const r=Pe(cq);return r===0?0:eo(be(cq,I0e)/r)}const I0e=P(),cq=P();function KNe(t,e,i=bw,r=!0){N3.eyeCenterDistance=0,N3.requiresTwoSteps=!1;const n=ple(t,e,i,void 0,N3);if(n===0)return!1;switch(ad(a5,-n,e.viewRight),i.tiltMode){case Ho.LOOK_AROUND:Ke(Rv,e.viewForward,a5),le(Rv,Rv,N3.eyeCenterDistance),e.center=me(tb,e.eye,Rv);break;case Ho.TUMBLE:ge(Rv,e.center,e.eye),Ke(Rv,Rv,a5),e.eye=ge(tb,e.center,Rv);break;default:i.tiltMode}return e.up=Ke(tb,e.up,a5),!N3.requiresTwoSteps||!r||KNe(t,e,i,!1)}function ple(t,e,i=bw,r=bw,n){if(!t.state.constraints.tilt)return 0;const s=e.distance,o=t.state.constraints.tilt(s,Ewt);return Swt(t,i,o),r.interactionType===fi.TUMBLE&&CD(r.selection,Zr.ALTITUDE)&&QNe(t,r.interactionStartCamera,o),i.tiltMode===Ho.LOOK_AROUND||r.tiltMode===Ho.LOOK_AROUND?ywt(t,e,o,n):gwt(t,e,o)}function gwt(t,e,i){const r=ww(t.renderCoordsHelper,e.center,e.eye),n=r-_e(r,i.min,i.max);return AD(n)?n:0}function ywt(t,e,i,r){switch(r&&(r.requiresTwoSteps=!1),t.viewingMode){case"global":return vwt(t,e,i,r);case"local":return _wt(t,e,i,r)}}function _wt(t,e,i,r){const n=ww(t.renderCoordsHelper,e.center,e.eye),s=_e(n,i.min,i.max),o=n-s;if(!AD(o))return 0;if(r){const a=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=t.renderCoordsHelper.getAltitude(e.eye)-a,c=Math.cos(s);Math.abs(c)>1e-4?r.eyeCenterDistance=l/c:r.eyeCenterDistance=e.distance}return o}function vwt(t,e,i,r){const n=bwt(t,e,Cwt),s=_e(n.tiltAtCenter,i.min,i.max);if(!AD(n.tiltAtCenter-s))return 0;let o,a;return n.centerIsOnSurface?(o=wwt(n),a=xwt(n,o)):(o=n.constraints.clampTilt(n.eyeCenterDistance,n.tiltAtCenter),r&&o<Math.PI/2&&(r.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=Twt(n,o)),r&&(r.eyeCenterDistance=ute(n,o)),a}function bwt(t,e,i){const r=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,n=r+sr(t.spatialReference).radius,s=t.renderCoordsHelper.intersectManifold(e.ray,r,tb);return i.eyeCenterDistance=e.distance,i.centerIsOnSurface=!1,v(s)?(i.eyeCenterDistance=Lr(e.eye,s),i.tiltAtCenter=ww(t.renderCoordsHelper,s,e.eye),i.centerIsOnSurface=!0):t.state.isLocal?i.tiltAtCenter=ww(t.renderCoordsHelper,e.center,e.eye):(FO(BB(jB,n),e.ray,tb),i.eyeCenterDistance=Lr(e.eye,tb),i.tiltAtCenter=eo(-be(e.viewForward,we(tb,tb)))),i.radius=n,i.eyeRadius=Pe(e.eye),i.constraints=t.state.constraints,i}function AD(t){return Math.abs(t)>1e-9}function wwt(t){const{constraints:e,eyeCenterDistance:i,tiltAtCenter:r}=t;let n=r,s=e.clampTilt(i,r);const o=ute(t,s);if(e.clampTilt(o,r)===s)return s;let a=0;for(;a<10&&AD(s-n);){const l=(n+s)/2,c=ute(t,l);AD(e.clampTilt(c,l)-l)?n=l:s=l,a++}return s}function ute(t,e){if(!t.centerIsOnSurface)return t.eyeCenterDistance;const i=Math.PI-_e(e,0,Math.PI),r=Pp(t.radius/t.eyeRadius*Math.sin(i)),n=Math.PI-i-r,s=Math.sin(n)/Math.sin(i);if(t.eyeRadius<t.radius&&s>1){const o=Math.PI-r,a=Math.PI-i-o;return Math.sin(a)/Math.sin(i)*t.eyeRadius}return s*t.eyeRadius}function xwt(t,e){const i=Pp(t.radius/t.eyeRadius*Math.sin(t.tiltAtCenter)),r=Pp(t.radius/t.eyeRadius*Math.sin(e));return t.eyeRadius>t.radius?i-r:r-i}function Twt(t,e){return t.tiltAtCenter-Math.PI/2-(e-Math.PI/2)}function Swt(t,e,i){if(e.interactionType===fi.NONE)return;const{interactionStartCamera:r,interactionFactor:n}=e;if(!r)return;const{min:s,max:o}=i,a=ple(t,r,bw,e),l=a===0?0:ww(t.renderCoordsHelper,r.center,r.eye);i.min=s,i.max=o,e.interactionType===fi.TUMBLE?(CD(e.selection,Zr.ALTITUDE)&&QNe(t,r,i),gz(a,l,!0,n,$0e,i)):gz(a,l,!1,n,$0e,i)}function QNe(t,e,i){const r=t.state.constraints;if(t.state.isLocal||!r.altitude||!e)return;const n=al(e.center),s=Math.sqrt(n),o=e.distance,a=sr(t.spatialReference).radius,l=r.altitude.min+a,c=r.altitude.max+a,h=(l*l-o*o-n)/(-2*s*o),p=(c*c-o*o-n)/(-2*s*o);i.min=Math.max(i.min,Math.min(Math.PI-eo(p),i.max)),i.max=Math.min(i.max,Math.PI-eo(h))}const Rv=P(),a5=$e(),tb=P(),$0e=Xt(5),Ewt={min:0,max:0},Cwt={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},N3={eyeCenterDistance:0,requiresTwoSteps:!1};function Awt(t){return t}const p7=t=>t*t,fle=t=>1-p7(1-t),Rwt=t=>t<.5?p7(2*t)/2:(fle(2*(t-.5))+1)/2,mle=t=>t*t*t,eFe=t=>1-mle(1-t),tFe=t=>t<.5?mle(2*t)/2:(eFe(2*(t-.5))+1)/2,gle=t=>t*t*t*t,iFe=t=>1-gle(1-t),Mwt=t=>t<.5?gle(2*t)/2:(iFe(2*(t-.5))+1)/2,yle=t=>t*t*t*t*t,rFe=t=>1-yle(1-t),Owt=t=>t<.5?yle(2*t)/2:(rFe(2*(t-.5))+1)/2,_le=t=>1-Math.cos(t*Math.PI/2),nFe=t=>1-_le(1-t),Pwt=t=>t<.5?_le(2*t)/2:(nFe(2*(t-.5))+1)/2,vle=t=>2**(10*(t-1)),JN=t=>1-vle(1-t),Iwt=t=>t<.5?vle(2*t)/2:(JN(2*(t-.5))+1)/2,ble=t=>-(Math.sqrt(1-t*t)-1),sFe=t=>1-ble(1-t),$wt=t=>t<.5?ble(2*t)/2:(sFe(2*(t-.5))+1)/2;function jp(t){const e=2*(t-Math.sqrt((t-1)*t)),i=e/2/t;return r=>r<i?t*r*r:e*r-e+1}function Gp(t,e){return(i,r)=>i<e?e*t(i/e,r):1-t((1-i)/(1-e),r)*(1-e)}const Lwt=Gp(jp(1),1),Dwt=Gp(jp(1),0),oFe=Gp(jp(1),.5),Nwt=Gp(jp(2),1),Fwt=Gp(jp(2),0),kwt=Gp(jp(2),.5),Uwt=Gp(jp(3),1),Vwt=Gp(jp(3),0),zwt=Gp(jp(3),.5),Bwt=Gp(jp(4),1),jwt=Gp(jp(4),0),Gwt=Gp(jp(4),.5),Hwt={linear:Awt,"in-quad":p7,"out-quad":fle,"in-out-quad":Rwt,"in-coast-quad":Lwt,"out-coast-quad":Dwt,"in-out-coast-quad":oFe,"in-cubic":mle,"out-cubic":eFe,"in-out-cubic":tFe,"in-coast-cubic":Nwt,"out-coast-cubic":Fwt,"in-out-coast-cubic":kwt,"in-quart":gle,"out-quart":iFe,"in-out-quart":Mwt,"in-coast-quart":Uwt,"out-coast-quart":Vwt,"in-out-coast-quart":zwt,"in-quint":yle,"out-quint":rFe,"in-out-quint":Owt,"in-coast-quint":Bwt,"out-coast-quint":jwt,"in-out-coast-quint":Gwt,"in-sine":_le,"out-sine":nFe,"in-out-sine":Pwt,"in-expo":vle,"out-expo":JN,"in-out-expo":Iwt,"in-circ":ble,"out-circ":sFe,"in-out-circ":$wt};function hs(t,e,i=Ywt,r=e){r!==e&&r.copyFrom(e),r.computeUp(t.state.viewingMode);let n=!1;for(let a=0;a<Zwt;a++){let l=0;for(const c of Xwt)if(CD(i.selection,c.type)){const h=Math.abs(c.error(t,r,i));c.apply(t,r,i)&&(n=!0,l+=h)}if(l===0)break}const s=CD(i.selection,Zr.COLLISION),o=qwt(i.interactionType,t);return s&&zO(t,r,o)&&(n=!0),n&&r.computeUp(t.state.viewingMode),n}function qwt(t,e){switch(t){case fi.PAN:return _p.EYE_AND_CENTER;case fi.ASCEND:return e.state.isGlobal?_p.EYE_AND_CENTER_SCALE:_p.EYE_AND_CENTER;default:return _p.EYE}}function Hf(t){const e=Math.min(1,t/150);return tFe(e)}function Wwt(t,e,i){return ple(t,e,i)*e.distance}const Xwt=[{type:Zr.TILT,error:Wwt,apply:KNe},{type:Zr.ALTITUDE,error:cle,apply:Ubt},{type:Zr.DISTANCE,error:ule,apply:Xbt}],Ywt={selection:Zr.ALL,interactionType:fi.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Ho.TUMBLE},Zwt=5,hh=P(),nu=P(),Mv=P(),Ja=P(),ux=P(),Jwt=P(),dh={upward:Ue(0,0,1),forward:Ue(0,1,0),sideway:Ue(1,0,0)},L0e=wr();let D0e=class{constructor(e=qe.Global){this.viewingMode=e,this.center=P(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=In(dh.forward)}pixelsPerPanAtZoom(e){return this.size/2/(this._zoomToPanScale*e)}zoomAtPixelsPerPan(e){return this.size/2/(this._zoomToPanScale*e)}pixelsPerRotateAtZoom(){const e=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/e}compareTo(e,i){if(i||(i={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===qe.Global){const s=(Pe(this.center)+Pe(e.center))/2;i.pan=SU(this.center,e.center)*s}else i.pan=Lr(this.center,e.center);let r=Math.abs(e.yaw-this.yaw);r>=Math.PI&&(r=2*Math.PI-r);const n=Math.abs(e.pitch-this.pitch);return i.rotate=Math.max(r,n),i.sourceZoom=this.distance,i.targetZoom=e.distance,i}interpolate(e,i,r){this.viewingMode===qe.Global?dyt(e.center,i.center,r.pan,this.center):ys(this.center,e.center,i.center,r.pan),this.distance=isFinite(i.distance)?Bt(e.distance,i.distance,r.zoom):e.distance,this.pitch=Bt(e.pitch,i.pitch,r.rotate);let n=e.yaw;const s=i.yaw;Math.abs(s-n)>=Math.PI&&(n+=2*(n<s?1:-1)*Math.PI),this.yaw=Bt(n,s,r.rotate)}copyFrom(e){ce(this.center,e.center),this.pitch=e.pitch,this.yaw=e.yaw,this.distance=e.distance,ce(this.lookAtDirection,e.lookAtDirection),this.size=e.size,this.copyFromCommon(e),this.viewingMode=e.viewingMode}copyFromRenderCamera(e){const i=this._lookAtOrientation(e.center,L0e);ce(this.center,e.center),ge(Ja,e.center,e.eye),Wl(Ja,Ja,i),Wl(ux,e.up,i),this.distance=Pe(Ja),this.distance!==0&&(Ja[0]/=this.distance,Ja[1]/=this.distance,Ja[2]/=this.distance),this.pitch=this._eyeUpToPitch(Ja),this.yaw=this._eyeUpToYaw(Ja,ux),this.size=Math.sqrt(e.width*e.width+e.height*e.height),this.copyFromCommon(e)}copyFromCommon(e){this.fov=e.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(e){const i=this._lookAtOrientation(this.center,L0e);Qu(i,i),this._axisAngleVec3(dh.sideway,this.pitch-Math.PI/2,dh.forward,Ja),this._axisAngleVec3(dh.upward,this.yaw,Ja),this._axisAngleVec3(dh.sideway,this.pitch-Math.PI/2,dh.upward,ux),this._axisAngleVec3(dh.upward,this.yaw,ux),le(Ja,Ja,this.distance),Wl(Ja,Ja,i),Wl(ux,ux,i),e.center=this.center,e.eye=ge(Ja,this.center,Ja),e.up=ux}_axisAngleVec3(e,i,r,n=r){const s=Math.cos(i),o=Math.sin(i);return le(hh,r,s),vt(nu,e,r),le(nu,nu,o),le(Mv,e,(1-s)*be(e,r)),me(n,me(n,hh,nu),Mv)}_lookAtOrientation(e,i=wr()){return this._upAtLookAt(e,Mv),vt(hh,this.lookAtDirection,Mv),we(hh,hh),hh[0]===0&&hh[1]===0&&hh[2]===0&&ce(hh,dh.sideway),vt(nu,Mv,hh),we(nu,nu),i[0]=hh[0],i[1]=nu[0],i[2]=Mv[0],i[3]=hh[1],i[4]=nu[1],i[5]=Mv[1],i[6]=hh[2],i[7]=nu[2],i[8]=Mv[2],i}_upAtLookAt(e,i){return this.viewingMode===qe.Local?ce(i,dh.upward):we(i,e)}_eyeUpToPitch(e){return Math.PI-SU(dh.upward,e)}_eyeUpToYaw(e,i){const r=Jwt;return Math.abs(i[2])<.5?(ce(r,i),e[2]>0&&le(r,r,-1)):ce(r,e),vt(nu,r,dh.upward),we(nu,nu),SU(dh.sideway,nu,dh.upward)}};const _z={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};let Kwt=class aFe{constructor(e){this._createCamera=e,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:_z.desiredScreenFlow},this.source=e(),this.target=e()}clone(){const e=new aFe(this._createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings)}update(e,i,r){this.source!==e&&this.source.copyFrom(e),this.target!==i&&this.target.copyFrom(i),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=r.desiredScreenFlow!=null?r.desiredScreenFlow:_z.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(e){const i=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/i}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}},Qwt=class{constructor(){this.segments=[]}get time(){return this.segments.reduce((e,i)=>e+i.time,0)}interpolateComponentsAt(e,i){e=Math.min(Math.max(e,0),1),e*=this.time;let r=0,n=0;const s=this.definition;for(let o=0;o<this.segments.length;o++){const a=this.segments[o],l=a.definition;if(e<=a.time||o===this.segments.length-1){if(i=this.segmentInterpolateComponentsAt(a,a.time===0?0:e/a.time,i),s.hasPan&&!isNaN(i.pan)&&isFinite(s.compared.pan)?i.pan=(r+l.compared.pan*i.pan)/s.compared.pan:i.pan=1,s.hasRotate&&!isNaN(i.rotate)&&isFinite(s.compared.rotate)?i.rotate=(n+l.compared.rotate*i.rotate)/s.compared.rotate:i.rotate=1,s.hasZoom&&!isNaN(i.zoom)&&isFinite(l.compared.targetZoom)){const c=i.zoom*(l.compared.targetZoom-l.compared.sourceZoom)+l.compared.sourceZoom,h=this.segments[0].definition.compared.sourceZoom,p=this.segments[this.segments.length-1].definition.compared.targetZoom;i.zoom=(c-h)/(p-h)}else i.zoom=1;return i}e-=a.time,r+=l.compared.pan,n+=l.compared.rotate}}segmentInterpolateComponentsAt(e,i,r){return e.interpolateComponentsAt(i,r)}},uq=class{get time(){return this._time}constructor(e){e&&this.update(e)}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,i=e.compared,r=i.sourceZoom,n=i.targetZoom;this._zoomSign=r>n?1:-1,this._panPixelsAtSource=i.pan*e.source.pixelsPerPanAtZoom(r);const s=(e.source.pixelsPerRotateAtZoom(r)+e.target.pixelsPerRotateAtZoom(n))/2;this._rotatePixels=i.rotate*s}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom,{hasZoom:r,hasPan:n,hasRotate:s}=this.definition;let o=0,a=0;r&&(n&&(o=(i/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),s&&(a=this._zoomSign*(Math.log(e/i)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(r&&n&&s){const c=o+a+o*a;this._zoomPixelFlow=o*a/c*l,this._panPixelFlow=a/c*l,this._rotatePixelFlow=o/c*l}else if(r&&n){const c=1+o;this._zoomPixelFlow=o/c*l,this._panPixelFlow=1/c*l}else if(r&&s){const c=1+a;this._zoomPixelFlow=a/c*l,this._rotatePixelFlow=1/c*l}else if(n&&s){const c=this._panPixelsAtSource/this._rotatePixels,h=1+c;this._panPixelFlow=c/h*l,this._rotatePixelFlow=1/h*l}else n?this._panPixelFlow=l:r?this._zoomPixelFlow=l:s&&(this._rotatePixelFlow=l);this._time=s?this.rotateTime:r?this.zoomTime:n?this.panTime:0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,i=e*this._panPixelsAtSource;return Math.log(i*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0}_interpolateComponentsZoom(e){if(e===0||e===1)return e;if(this.definition.hasZoom){const i=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom;return(i*(i/r)**-e-i)/(r-i)}return e}_interpolateComponentsPan(e){if(e===0||e===1)return e;if(this.definition.hasPan&&this.definition.hasZoom){const i=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(i*e*this._time)-1))/(i*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,i){e=Math.min(Math.max(e,0),1);const r=this._interpolateComponentsZoom(e),n=this._interpolateComponentsPan(e),s=this._interpolateComponentsRotate(e);return i?(i.zoom=r,i.pan=n,i.rotate=s):i={zoom:r,pan:n,rotate:s},i}};function ext(t,e,i){const r=e-t.compared.sourceZoom,n=t.halfWindowPanAtZoom(r);return-t.halfWindowSize*(i.ascensionFactor*Math.LN2*t.compared.pan+n)*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2*n)}function txt(t,e,i){const r=1/e,n=Math.log(t.compared.sourceZoom*r),s=1/t.desiredPixelFlow,o=1/Math.LN2,a=e-t.compared.sourceZoom,l=1/a,c=(i.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(a))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*r*s*o*l*c-t.halfWindowSize*n*s*o*l+t.halfWindowSize*n*s*o*c/(a*a)}function ixt(t,e,i){const r=e-t.compared.sourceZoom,n=1/r,s=1/e,o=Math.log(t.compared.sourceZoom*s),a=(i.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(r))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*n*(-2*n*s*a+2*n*o+2*s-2*o*a/(r*r)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function rxt(t,e){return-t.halfWindowSize*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2)}function nxt(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function sxt(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function oxt(t,e,i){return-t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e))}function axt(t,e,i){return t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e))}function lxt(t,e,i){return-2*t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e*e))}function cxt(t,e,i){return t.halfWindowSize*(-t.halfWindowPanAtZoom(e)-i.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*t.halfWindowPanAtZoom(-e+t.compared.targetZoom))}function uxt(t,e,i){const r=Math.log(e/t.compared.targetZoom),n=1/t.desiredPixelFlow,s=1/Math.LN2,o=-e+t.compared.targetZoom,a=1/o,l=(-t.halfWindowPanAtZoom(e)-i.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return-t.halfWindowSize*r*n*s*a+t.halfWindowSize*r*n*s*l/(o*o)+t.halfWindowSize*n*s*a*l/e}function hxt(t,e,i){const r=e-t.compared.targetZoom,n=1/r,s=1/e,o=Math.log(e/t.compared.targetZoom),a=(t.halfWindowPanAtZoom(e)+i.descensionFactor*Math.LN2*t.compared.pan-t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*n*(-2*n*s*a-2*n*o+2*s+2*o*a/(r*r)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function dxt(t,e){return t.halfWindowSize*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2)}function pxt(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function fxt(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function mxt(t){const e=Math.LN2*t.compared.pan,i=t.compared.sourceZoom-t.compared.targetZoom,r=t.halfWindowPanAtZoom(i),n=t.halfWindowSize*Math.log(t.compared.sourceZoom/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*r);return t.compared.sourceZoom<=t.compared.targetZoom?n*(e-r):n*(e+r)}function gxt(t,e){let i=yxt(t,e);const r={ascensionFactor:e.ascensionFactor!=null?e.ascensionFactor:.5,descensionFactor:e.descensionFactor!=null?e.descensionFactor:.5},n=r.ascensionFactor===0,s=r.descensionFactor===0,o=n?rxt:ext,a=n?nxt:txt,l=n?sxt:ixt,c=s?dxt:cxt,h=s?pxt:uxt,p=s?fxt:hxt,f=E=>o(t,E,r)+oxt(t,E,r)+c(t,E,r),m=E=>a(t,E,r)+axt(t,E,r)+h(t,E,r),g=E=>l(t,E,r)+lxt(t,E,r)+p(t,E,r);let _=f(i);const b=mxt(t);let w;const x=e.maximumIterations||20,T=e.maximumDistance!=null?e.maximumDistance:1/0;for(w=0;w<x;w++){const C=(m(i)+1e-6)/g(i);if(isNaN(C)||i>=T&&C<0){if(!isFinite(T))return null;i=T,_=f(i);break}if(i-=C,i<t.compared.sourceZoom||i<t.compared.targetZoom)return null;const A=f(i);if(Math.abs(A-_)/_<=.005)break;_=A}return _>b*(1-.3)||i<t.compared.sourceZoom||i<t.compared.targetZoom?null:i}function yxt(t,e){const i=Math.max(t.compared.sourceZoom,t.compared.targetZoom),r=t.source.zoomAtPixelsPerPan(t.desiredPixelFlow/t.compared.pan)/2;return r<i?e.maximumDistance!=null?i+(e.maximumDistance-i)/2:1.5*i:e.maximumDistance?Math.min(e.maximumDistance,r):r}let _xt=class extends Qwt{constructor(e,i){super(),this._preallocSegments=[new uq,new uq,new uq],this._ascensionSegment=null,this._descensionSegment=null,this.update(e,i)}update(e,i){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();let r=null;i&&i.apex&&(r=gxt(e,i.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,r==null?this._updateWithoutApex():this._updateWithApex(r,i==null?void 0:i.apex)}segmentInterpolateComponentsAt(e,i,r){return r=e.interpolateComponentsAt(i,r),e===this._ascensionSegment?r.zoom=fle(r.zoom):e===this._descensionSegment&&(r.zoom=p7(r.zoom)),r}_updateWithApex(e,i){const[r,n,s]=this._preallocSegments,o=(i==null?void 0:i.ascensionFactor)??.5,a=Math.min(1-o,(i==null?void 0:i.ascensionFactor)!=null&&i.descensionFactor!=null?i.descensionFactor:.5),l=1-o-a;r.definition?r.definition.copyFrom(this.definition):r.definition=this.definition.clone(),r.definition.compared.targetZoom=e,r.definition.compared.pan=this.definition.compared.pan*o,r.definition.compared.rotate=this.definition.compared.rotate*o,r.update(),this._ascensionSegment=r,this.segments.push(r),l>0&&(n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.copyFrom(this.definition),n.definition.compared.sourceZoom=e,n.definition.compared.targetZoom=e,n.definition.compared.pan=this.definition.compared.pan*l,n.definition.compared.rotate=this.definition.compared.rotate*l,n.update(),this.segments.push(n)),s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.compared.sourceZoom=e,s.definition.compared.pan=this.definition.compared.pan*a,s.definition.compared.rotate=this.definition.compared.rotate*a,s.update(),this._descensionSegment=s,this.segments.push(s)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}};const vxt={zoom:0,pan:0,rotate:0};let bxt=class{get time(){return this._time}constructor(e){this._createCamera=e,this._time=0,this.definition=new Kwt(e),this.path=new _xt}update(e,i,r){this.definition.update(e,i,r),this.path.update(this.definition,r),this._time=this._applyTimeSettings(m2e(isFinite(this.path.time)?this.path.time:0),r),this._easing=r.easing?r.easing:this._time>=1e3?oFe:JN}cameraAt(e,i){i=i||this._createCamera(),e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const r=this.path.interpolateComponentsAt(e,vxt);return i.interpolate(this.definition.source,this.definition.target,r),i}_normalizedEasing(e){const i=this._easing(0,this._time),r=this._easing(1,this._time);return(this._easing(e,this._time)-i)/(r-i)}_applyTimeSettings(e,i){const r=i.speedFactor!=null?i.speedFactor:1;i.duration!=null?e=i.duration:i.speedFactor!=null&&(e=e/r);const n=i.minDuration!=null?i.minDuration:_z.minDuration/r,s=i.maxDuration!=null?i.maxDuration:_z.maxDuration/r;return Math.min(Math.max(n,e),s)}};const wxt=P();let xxt=class{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(e){this.currentTime=0,this._animation=new bxt(()=>new D0e(e)),this._current=new D0e(e)}update(e,i,r){const n=this._animation.definition.source,s=this._animation.definition.target,o=ge(wxt,i.center,e.center),a=Pe(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),ce(n.lookAtDirection,o),ce(s.lookAtDirection,o),n.copyFromRenderCamera(e),s.copyFromRenderCamera(i),this._current.copyFrom(n),this._animation.update(n,s,r),this.currentTime=0,e.almostEquals(i)&&(this.currentTime=this._animation.time)}cameraAt(e,i){return this._animation.cameraAt(e,this._current),i=i||new Pt,this._current.copyToRenderCamera(i),i}step(e,i){return this.finished||(this.currentTime=this.currentTime+m2e(e),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,i)}};var Tn;(function(t){t.Ready="ready",t.Rejected="rejected",t.Running="running",t.Stopped="stopped",t.Finished="finished"})(Tn||(Tn={}));let V0=class extends ve{constructor(e){super(e),this.state=Tn.Ready}get active(){return this.state===Tn.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=Tn.Stopped,!0)}finishController(){this.state=Tn.Finished}get steppingFinished(){return!1}};u([d({constructOnly:!0})],V0.prototype,"view",void 0),u([d({readOnly:!0})],V0.prototype,"active",null),u([d()],V0.prototype,"state",void 0),u([d({readOnly:!0})],V0.prototype,"isInteractive",null),V0=u([$("esri.views.3d.state.controllers.CameraController")],V0);let RD=class extends V0{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(Bi()),this._asyncResult=null),this.state===Tn.Finished||this.state===Tn.Stopped?(C9(e),this.state===Tn.Finished?e.resolve():e.reject(Bi())):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=Tn.Running,v(this.viewAnimation)&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){!v(this.viewAnimation)||this.state!==Tn.Ready&&this.state!==Tn.Running||(this.viewAnimation.state===P_.State.FINISHED?this.finish():this.viewAnimation.state===P_.State.STOPPED&&(this.state=Tn.Stopped))}onControllerEnd(){v(this.viewAnimation)&&!this.viewAnimation.done&&(this.state===Tn.Finished?this.viewAnimation.finish():this.state===Tn.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===Tn.Finished?this._asyncResult.resolve():this._asyncResult.reject(Bi()))}finish(){this.finishController()}};RD=u([$("esri.views.3d.state.controllers.AnimationController")],RD);let i_=class extends RD{get intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.mode="interaction",this._hasTarget=!1}initialize(){this.animation=new xxt(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new P_}get isInteractive(){return this.mode==="interaction"}begin(e,i){this._hasTarget=!0;const r=this.animationSettings(i);l5.copyFrom(this.view.state.camera);const n=Fp(this.view.state.viewingMode);this.intersectionHelper.intersectRay(l5.ray,n,N0e)&&(l5.center=N0e),this.animation.update(l5,e,r),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(e,i){this._hasTarget&&this.animation.step(e,i)}onControllerEnd(e){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:typeof e.easing=="string"?Hwt[e.easing]:e.easing}}};u([d({constructOnly:!0})],i_.prototype,"mode",void 0),u([d({readOnly:!0})],i_.prototype,"isInteractive",null),i_=u([$("esri.views.3d.state.controllers.PointToPointAnimationController")],i_);const l5=new Pt,N0e=P();function f7(t=Sxt){return[t[0],t[1],t[2],t[3]]}function MD(t,e){return Txt(t[0],t[1],t[2],e,gae.get())}function Txt(t,e,i,r,n=f7()){return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n}function wle(t,e,i){return vt(i,t,e),we(i,i),i[3]=vae(t,e),i}const Sxt=[0,0,1,0];function lFe(t,e,i){return Ext(t,t.screenToRender(e,Ye.get()),i)}function Ext(t,e,i){const r=io(Ye.get(),e);if(r[2]=0,!t.unprojectFromRenderScreen(r,i.origin))return null;const n=io(Ye.get(),e);n[2]=1;const s=t.unprojectFromRenderScreen(n,Ye.get());return R(s)?null:(ge(i.direction,s,i.origin),i)}function BO(t,e,i){return xle(t,t.screenToRender(e,Ye.get()),i)}function xle(t,e,i){ce(i.origin,t.eye);const r=he(Ye.get(),e[0],e[1],1),n=t.unprojectFromRenderScreen(r,Ye.get());return R(n)?null:(ge(i.direction,n,i.origin),i)}function Tle(t,e,i,r){const n=BO(e,i,Cxt);return Vw(t,n,r)}const Cxt=ko();var KM;(function(t){t[t.Ellipsoid=0]="Ellipsoid",t[t.Silhouette=1]="Silhouette"})(KM||(KM={}));const cFe=30,vz=[1,3e8],m7=80,uFe=8,hFe=200,dFe=1508e5,pFe=5,fFe=50,Axt=5,Rxt=10,hq=90,K2={exclude:new Set([eb])};function BS(t,e,i){return i[0]=e[0]/(t.fullWidth/t.pixelRatio),i[1]=e[1]/(t.fullHeight/t.pixelRatio),i}function hte(t){for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;return t}function xw(t,e,i){const r=ad(yae.get(),i[3],i);R(r)||VAe(r,ld)||(ge(yr,t.eye,e),Ke(yr,yr,r),t.eye=me(yr,yr,e),ge(yr,t.center,e),Ke(yr,yr,r),t.center=me(yr,yr,e),t.up=Ke(yr,t.up,r))}function Mxt(t,e,i,r){return Y2(t,lFe(e,i,Cle),r)}function dte(t,e,i,r){return Y2(t,BO(e,i,Cle),r)}function Sle(t,e,i,r){const n=Ye.get();let s=1-i;ge(n,e,t.eye);const o=Pe(n);let a=o*(1-s);s>=0&&a<r&&(a=r,s=-(a-o)/o),Math.abs(o-a)<1e-6||(le(n,n,s),t.eye=me(yr,t.eye,n),t.center=ys(yr,t.center,e,s))}function mFe(t,e,i){e.getScreenCenter(F0e),Tle(t,e,F0e,yr)&&(e.center=yr);const r=e.distance,n=r*i;if(Math.abs(r-n)<1e-6)return;const s=le(Ye.get(),e.viewForward,n);e.eye=ge(yr,e.center,s)}const F0e=Sn();function dq(t,e){he(e,0,0,0);for(const i of t)me(e,e,i);le(e,e,1/t.length)}function FU(t,e,i,r){return Math.sin(t/Pe(e))*(i+r.radius)}function k0e(t,e,i,r){return FU(Math.PI/2,e,i,r)+(t-Math.PI/2)}var Uo;(function(t){t[t.Vertical=0]="Vertical",t[t.Horizontal=1]="Horizontal"})(Uo||(Uo={}));const U0e={Elevation:3e4,Angle:Xt(16)},c5={Pole:.95,Angle:Xt(18),Tilt:45},gFe=Xt(80);function yFe(t,e,i,r,n,s){const o=P(),a=Is();let l=!0,c=!0;return t.intersectScreen(i,o,s)?a[3]=Pe(o):(c=!1,e.aboveGround&&n!==KM.Ellipsoid?a[3]=Math.max(Pe(e.center),.9*r.radius):a[3]=Pe(e.eye)-e.relativeElevation,n===KM.Silhouette?OD(a,e,i,o):l=Tle(a,e,i,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function g7(t,e,i){return Pe(t.eye)-i.radius>U0e.Elevation?Uo.Horizontal:(BO(t,e,W0e),-Math.sign(t.relativeElevation)*(.5*Math.PI+vae(t.eye,W0e.direction))<U0e.Angle?Uo.Vertical:Uo.Horizontal)}function _Fe(t,e,i){ge(pq,i,e),t.eye=ge(yr,t.eye,pq),t.center=ge(yr,t.center,pq)}const pq=P();function OD(t,e,i,r){const n=BO(e,i,Cle);return!R(n)&&(FO(t,n,u5),Vw(t,n,r)?!(ba(u5,n.origin)<ba(r,n.origin))||(ce(r,u5),!1):(ge(IE,e.eye,e.center),we(IE,IE),FLe(IE,-be(we(IE,IE),u5),V0e),Y2(V0e,n,r),!1))}const u5=P(),IE=P(),V0e=Ji();function vFe(t,e,i,r,n,s){let o=0;if(vt(xz,t,e),ge(f5,t,e),Pe(t)<=n||!r.aboveGround){vt(i,f5,r.eye);const a=be(t,e)/(Pe(t)*Pe(e));if(a<.9999)o=eo(a);else{const c=Pe(vt(P(),t,e))/(Pe(t)*Pe(e));o=Pp(c)}const l=Math.cos(_e(sw.normalize(Xt(s)),0,gFe));o=-o-Math.max(0,Pe(e)-n)/(l*n)}else ge(z0e,r.eye,r.center),vt(i,f5,z0e),o=-Pe(f5)/n;return we(i,i),le(i,i,Pe(xz)),o}const z0e=P();function B0e(t,e,i,r){let n,s;const o=Math.cos(_e(sw.normalize(Xt(r)),0,gFe));return n=e>i?-(e-i)/(o*i):e<-i?Math.PI-(e+i)/(o*i):eo(e/i),s=t>i?-(t-i)/(o*i):t<-i?Math.PI-(t+i)/(o*i):eo(t/i),(s-n)*i}function Oxt(t,e,i,r,n,s,o,a,l,c){const h=B0e(t[2],e[2],s[3],a),p=l?B0e(t[0],e[0],s[3],180):e[0]-t[0],f=Math.sin(o)*p-Math.cos(o)*h,m=Math.cos(o)*p+Math.sin(o)*h;we(yr,n);const g=l?f/Math.sqrt(Math.abs(s[3]**2-be(i,yr)**2)):f/s[3],_=m/Math.sqrt(Math.abs(s[3]**2-be(i,r)**2));dt(c,g,_)}function bFe(t,e,i,r,n,s,o,a,l,c){vt(xz,t,e),WQ(s.up,s.eye,h5,d5,p5),WQ([0,0,1],s.eye,d_,Hb,SFe),ce(i,Hb),ce(r,d_),we(i,i),le(i,i,Pe(xz)),hye(t,we(d5,d5),we(p5,p5),we(h5,h5),j0e),hye(e,d5,p5,h5,G0e),Oxt(j0e,G0e,t,d_,Hb,o,a,l,c,n)}function Pxt(t,e,i,r,n,s,o){ad(bz,n,r),ad(wz,o,s),$n(uR,bz,wz),ge(e,t,i),Ke(e,e,uR),me(e,e,i)}function wFe(t,e,i,r,n,s){ad(bz,r,i),ad(wz,s,n),$n(uR,bz,wz),ge(yr,t.eye,e),Ke(yr,yr,uR),t.eye=me(yr,yr,e),ge(yr,t.center,e),Ke(yr,yr,uR),t.center=me(yr,yr,e),ge(yr,t.up,e),Ke(yr,yr,uR),t.up=me(yr,yr,e)}function Ele(t,e,i,r,n,s){return(Math.abs(r)>Math.PI-c5.Angle||Math.abs(r)<c5.Angle)&&(Math.abs(t[2])<i*c5.Pole||Math.abs(e)>i)&&s.aboveGround&&n<c5.Tilt}function xFe(t,e,i,r,n,s){if(s)wle(i,r,H0e),xw(e,t,H0e);else{const o=vFe(i,r,q0e,e,t[3],n);xw(e,t,MD(q0e,o))}}function TFe(t,e,i,r,n,s,o){const a=o?20:1,l=1e-12;let c,h;ce(hx,r),m5.copyFrom(e);for(let p=0;p<a&&ba(i,hx)>l&&(c=ba(i,hx),bFe(i,hx,Hb,d_,F3,m5,t,n,s,o),wFe(m5,t,d_,F3[1],Hb,F3[0]),Pxt(hx,hx,t,d_,F3[1],Hb,F3[0]),h=ba(i,hx),h<c||p===0);p++)e.copyFrom(m5)}function Ixt(t,e,i,r,n,s,o){Ele(i,be(e.up,i),t[3],-sw.normalize(Xt(n)),s,e)?TFe(t,e,i,r,-sw.normalize(Xt(n)),s,o):xFe(t,e,i,r,s,o)}function $xt(t,e,i,r,n,s){const{eye:o}=t;WQ([0,0,1],o,d_,Hb,SFe);const a=e.translation[0]*i.pan,l=n.mode==="zoom"?0:e.translation[1]*i.pan,c=Math.max(Math.sqrt(Math.abs(1-be(t.center,d_)**2/Pe(t.center)**2)),.5),h=(Math.sin(s)*l+Math.cos(s)*a)/c,p=-Math.cos(s)*l+Math.sin(s)*a;switch(Vu(r.pan.matrix,r.pan.matrix,h,d_),r.pan.enabled=!0,n.mode){case"pan":Vu(r.pan.matrix,r.pan.matrix,p,Hb),r.pan.enabled=!0;break;case"zoom":r.zoom=-e.translation[1]*i.zoom}}function Lxt(t,e,i,r,n){const{eye:s,viewRight:o}=t,a=vt(Ye.get(),o,s),l=e.translation[0]*i.pan;switch(l!==0&&(Vu(r.pan.matrix,r.pan.matrix,-l,a),r.pan.enabled=!0),n.mode){case"pan":{const c=e.translation[1]*i.pan;c!==0&&(Vu(r.pan.matrix,r.pan.matrix,c,o),r.pan.enabled=!0);break}case"zoom":r.zoom=-e.translation[1]*i.zoom}}function Dxt(t,e,i,r,n,s,o,a,l){Ele(t.center,be(t.up,t.center),Pe(t.center),-sw.normalize(Xt(s)),o,e)?$xt(e,i,r,a,l,-sw.normalize(Xt(n))):Lxt(e,i,r,a,l)}const d_=P(),Hb=P(),SFe=P(),h5=P(),d5=P(),p5=P(),j0e=P(),G0e=P(),F3=Fe(),H0e=f7(),bz=$e(),wz=$e(),uR=$e(),hx=P(),yr=P(),f5=P(),m5=new Pt,xz=P(),q0e=P(),Cle={origin:P(),direction:P()},W0e={origin:P(),direction:P()},X0e=.6,fq=4,Nxt=60;let Tz=class extends i_{constructor(){super(...arguments),this._zoomLocation=P(),this._tmpCamera=new Pt,this._tmpViewDir=P(),this._tmpRayDir={origin:P(),direction:P()},this._targetOnSphere=P(),this._tmpCenter=P(),this._constraintOptions={selection:Zr.ALL_EXCEPT_COLLISION,interactionType:fi.ZOOM,interactionFactor:null,interactionStartCamera:new Pt,interactionDirection:null,tiltMode:Ho.TUMBLE},this._sphere=Is()}initialize(){this._intersector=Fp(this.view.state.viewingMode)}zoomStep(e,i){if(!this.active)return;const r=this.view.state,{interactionStartCamera:n}=this._constraintOptions;n&&(this.animation.finished?n.copyFrom(r.camera):this.animation.cameraAt(1,n));let s=!1,o=!1;this.intersectionHelper.intersectScreen(i,this._zoomLocation,this.view.map.ground.opacity===0?K2:{})&&(s=e>0,o=!0),this._tmpCamera.copyFrom(r.camera),s?this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:ce(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,e,this._zoomLocation,i,o),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:JN}}_updateCamera(e,i,r,n,s){const o=sr(this.view.spatialReference),a=g7(e,n,o),l=Math.abs(this.view.camera.position.z);we(y5,e.eye),le(y5,y5,-1),BO(e,n,this._tmpRayDir),we(this._tmpRayDir.direction,this._tmpRayDir.direction);const c=_e(Math.min(uFe,1/Math.abs(be(y5,this._tmpRayDir.direction)))*l,hFe,dFe);if(a===Uo.Horizontal){let h=X0e**i;this._sphere[3]=Pe(r),ge(this._tmpViewDir,e.center,e.eye);const p=Math.min(Pe(this._tmpViewDir),c);let f=p*h;if(h<=1&&f<fq&&(f=fq,h=f/p),Math.abs(p-f)<1e-6)return;const m=Pe(e.center);if(this._sphere[3]!==m){const g=this._sphere[3]+h*(m-this._sphere[3]);e.center=le(g5,e.center,g/m)}le(this._tmpViewDir,this._tmpViewDir,-h),e.eye=me(g5,e.center,this._tmpViewDir),hs(this.view,e,this._constraintOptions),ba(r,e.center)>1e-12&&Tle(this._sphere,e,n,this._targetOnSphere)&&Ixt(this._sphere,e,r,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let h=X0e**Math.abs(i);const p=i>0?1:-1;ge(this._tmpViewDir,r,e.eye);const f=Pe(this._tmpViewDir),m=this.view._stage.renderView.getMinimalDepthForArea(null,n[0],n[1],this.view.state.camera,Nxt);let g=v(m)?m:c;g=s&&i>0?Math.min(g,f):g,le(this._tmpRayDir.direction,this._tmpRayDir.direction,g),me(r,this._tmpRayDir.origin,this._tmpRayDir.direction);let _=g*h;const b=Math.max(fq,1.01*e.nearFar[0]);if(i>0&&_<b&&(_=b,h=_/g),Math.abs(g-_)<1e-6)return;le(this._tmpRayDir.direction,this._tmpRayDir.direction,p*(1-h)),e.eye=me(g5,e.eye,this._tmpRayDir.direction),e.center=me(g5,e.center,this._tmpRayDir.direction)}zO(this.view,e)}};Tz=u([$("esri.views.3d.state.controllers.global.ZoomStepController")],Tz);const g5=P(),y5=P(),Fxt=.6,kxt=4,Uxt=60;let Sz=class extends i_{constructor(){super(...arguments),this._zoomLocation=P(),this._tmpCamera=new Pt,this._tmpRayDir=P(),this._tmpCenter=P(),this._constraintOptions={selection:Zr.ALL,interactionType:fi.ZOOM,interactionFactor:null,interactionStartCamera:new Pt,interactionDirection:null,tiltMode:Ho.TUMBLE}}zoomStep(e,i){if(!this.active)return;const r=this.view.state,{interactionStartCamera:n}=this._constraintOptions;n&&(this.animation.finished?n.copyFrom(r.camera):this.animation.cameraAt(1,n)),this._tmpCamera.copyFrom(r.camera);const s=Fp(this.view.state.viewingMode);let o=!1;e>0?(o=this.intersectionHelper.intersectScreenFreePointFallback(i,this._zoomLocation,this.view.map.ground.opacity===0?K2:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:ce(this._zoomLocation,this._tmpCamera.center);const a=Fxt**e;let l=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,i[0],i[1],this.view.state.camera,Uxt);ge(_5,this._tmpCamera.eye,this._zoomLocation),we(_5,_5);const c=_e(Math.min(uFe,1/Math.abs(be(Vxt,_5)))*Math.abs(this.view.camera.position.z),hFe,dFe);if(l=v(l)?l:c,l){const h=P();ge(h,this._zoomLocation,this._tmpCamera.eye),(l<Pe(h)||!o)&&(we(h,h),me(this._zoomLocation,this._tmpCamera.eye,le(h,h,l)))}this._updateCamera(this._tmpCamera,a,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:JN}}_updateCamera(e,i,r){ge(this._tmpRayDir,r,e.eye);const n=Pe(this._tmpRayDir);let s=n*i;const o=i<=1,a=Math.max(kxt,1.01*e.nearFar[0]);s!==0&&(o&&s<a&&(s=a,i=s/n),Math.abs(n-s)<1e-6||(le(this._tmpRayDir,this._tmpRayDir,i),e.eye=ge(Y0e,r,this._tmpRayDir),e.center=ys(Y0e,e.center,r,1-i),hs(this.view,e,this._constraintOptions)))}};Sz=u([$("esri.views.3d.state.controllers.local.ZoomStepController")],Sz);const Y0e=P(),Vxt=Ue(0,0,1),_5=P();let zxt=class extends an{constructor(e,i){super(!0),this._view=e,this.registerIncoming("double-click",i,r=>this._handleDoubleClick(r))}_handleDoubleClick(e){const i=e.data;if(UB(i,"primary")){const r=this._view.state.isGlobal?new Tz({view:this._view,mode:"animation"}):new Sz({view:this._view,mode:"animation"});this._view.state.switchCameraController(r),r.zoomStep(Math.log(.5)/Math.log(.6),Sn(i.x,i.y)),e.stopPropagation()}}};function Bxt(t,e,i){return t===qe.Global?new Gxt(i):new jxt(e,i)}let jxt=class{constructor(e,i){this._elevationProvider=e,this._referenceEllipsoid=sr(i),this._unitInMeters=tc(i,this._referenceEllipsoid.metersPerDegree)}compute(e,i,r,n,s){var T;s||(s={near:0,far:0});let o=e[2]*this._unitInMeters;const a=o,l=o-n,c=(T=this._elevationProvider)==null?void 0:T.visibleElevationBounds;c&&(o=l>=0?a-this._unitInMeters*c.min:this._unitInMeters*c.max-a);const h={x:(r=v(r)?r:new ni({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-r.xmin,y:r.ymax-r.ymin,z:4*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},p=Math.max(h.x,h.y,h.z);ge(dx,i,e),$E[0]=dx[0]>0?r.xmax:r.xmin,$E[1]=dx[1]>0?r.ymax:r.ymin,$E[2]=dx[2]>0?p/2:-p/2,ge($E,$E,e),we(dx,dx);const f=1.1*be($E,dx)*this._unitInMeters,m=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),g=Math.max(r.xmax-r.xmin,r.ymax-r.ymin),_=g*Wxt*this._unitInMeters,b=g*Xxt*this._unitInMeters,w=_e((o-b)/(_-b),0,1)**3,x=Math.min(Bt(m,f,w),m)*Math.max(Math.log(Math.abs(l)),1);return EFe(Math.min(x,Math.max(34064e4,p))/this._unitInMeters,Hxt,this._unitInMeters,s)}},Gxt=class{constructor(e){this._referenceEllipsoid=sr(e)}compute(e,i,r,n,s){s||(s={near:0,far:0});const o=Pe(e),a=o-this._referenceEllipsoid.radius,l=this._referenceEllipsoid.radius+Math.min(0,n),c=Math.abs(a-n),h=Math.max(c,Math.abs(a)),p=Math.sqrt(h*(h+2*l)),f=o+this._referenceEllipsoid.radius;return EFe(1.2*Bt(p,f,Pae(h)),_e(2e4-(Math.log(h)-7.983)/9.011*19e3,1e3,2e4),1,s)}};function EFe(t,e,i,r){const n=qxt/i;return t/e>n?(r.far=t,r.near=r.far/e):(r.near=n,r.far=r.near*e),r}const Hxt=2e4,qxt=2,Wxt=.001,Xxt=1e-4,$E=P(),dx=P();let kU=class extends ve{constructor(e){super(e)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const i=this.view.state.camera;v(e.spatialReference)&&JNe(this.view,i,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>zO(this.view,e,_p.EYE_AND_CENTER))}};u([d({constructOnly:!0})],kU.prototype,"view",void 0),kU=u([$("esri.views.3d.state.ElevationCollisionConstraint")],kU);let zI=class extends ve{constructor(e){super(e),this.nearFarHeuristic=Bxt(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([ne(()=>{var e,i,r,n;return[(i=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:i.near,(n=(r=this.view.constraints)==null?void 0:r.clipDistance)==null?void 0:n.far]},()=>this._clipDistanceNearFarChanged()),ne(()=>{var e,i;return(i=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:i.mode},()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e)),ne(()=>this.view.renderDataExtent,()=>this._updateNearFar(),Ki),ne(()=>{var e,i,r,n;return[(i=(e=this.view.constraints)==null?void 0:e.altitude)==null?void 0:i.min,(n=(r=this.view.constraints)==null?void 0:r.altitude)==null?void 0:n.max]},()=>this._updateAltitude(),Ki),ne(()=>{var e,i;return(i=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:i.max},()=>this._updateTiltMax(),Ki),ne(()=>{var e,i;return(i=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:i.mode},()=>this._updateTilt(),Ki),ne(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this._updateTiltAutoMax(),Ki),ne(()=>{var e,i,r,n,s,o;return[(r=(i=(e=this.view.map)==null?void 0:e.ground)==null?void 0:i.navigationConstraint)==null?void 0:r.type,(o=(s=(n=this.view.state)==null?void 0:n.constraints)==null?void 0:s.collision)==null?void 0:o.enabled]},()=>this._updateCollision(),Ki)]),this.view.state.isLocal&&this.addHandles(ne(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),zt)),this._updateNearFar(),this.view.state.viewingMode!==qe.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new kU({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){var i;const e=(i=this.view.constraints)==null?void 0:i.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(r=>this._updateCameraNearFarManual(r,e))}_updateNearFar(){this.view.state.updateCamera(e=>this._updateCameraNearFar(e))}_updateCameraNearFar(e){const i=this.view.constraints&&this.view.constraints.clipDistance;(i?i.mode:"auto")==="manual"?this._updateCameraNearFarManual(e,i):this._updateCameraNearFarAuto(e,i)}_updateCameraNearFarAuto(e,i){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,d7(this.view,e.eye),e),i&&i.autoUpdate(e.near,e.far)}_updateCameraNearFarManual(e,i){i&&(e.near=i.near,e.far=i.far)}_updateCollision(){var n,s,o;const e=(o=(s=(n=this.view.map)==null?void 0:n.ground)==null?void 0:s.navigationConstraint)==null?void 0:o.type,i=!e||e==="stay-above",r=this.view.state.constraints.collision;if(i!==r.enabled){r.enabled=i,i&&this._reapplyConstraints(Zr.COLLISION);const a=this.view.constraints&&this.view.constraints.tilt;a&&a.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==qe.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const i=this.view.state.constraints;i.tilt=i.createConstantMaxTilt(Xt(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const i=this.view.state.constraints;if(i.tilt){const r=i.tilt(this.view.state.camera.distance).max;e.autoUpdate(ml(r))}}_updateLocalSurfaceDistance(e){if(R(e))return;let i=Math.max(e.width,e.height);if(i<=0)return;e.zmax!=null&&e.zmin!=null&&(i=Math.max(i,e.zmax-e.zmin));const r=this.view.state,n=3*i/Math.atan(r.camera.fov/2);n!==r.constraints.distance&&(r.constraints.distance=n)}_reapplyConstraints(e=Zr.ALL){this.view.state.updateCamera(i=>hs(this.view,i,{selection:e,interactionType:fi.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:Ho.TUMBLE}))}};u([d({constructOnly:!0})],zI.prototype,"view",void 0),u([d({readOnly:!0})],zI.prototype,"surfaceCollisionConstraint",void 0),zI=u([$("esri.views.3d.state.ConstraintsManager")],zI);let ib=class{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}constructor(e){this.renderCoordsHelper=e,this.frustum=TD(),this._points=XDe(),this.lines=new Array(12),this._origin=P(),this._direction=P(),this._altitude=null;for(let i=0;i<12;i++)this.lines[i]={origin:null,direction:P(),endpoint:null}}update(e){YDe(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),ce(this._origin,e.eye),ce(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(e){for(let i=0;i<this._points.length;i++)ce(this._points[i],e[i]);ZDe(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return Eb(this.frustum,e)}intersectsRay(e){return j_t(this.frustum,e)}intersectsLineSegment(e,i){return G_t(this.frustum,e,i)}intersectsPoint(e){return JDe(this.frustum,e)}_updateLines(){const e=this._points;for(let i=0;i<4;i++){const r=i+4;mq(this.lines[i],e[i],e[r]),mq(this.lines[i+4],e[i],i===3?e[0]:e[i+1]),mq(this.lines[i+8],e[r],i===3?e[4]:e[r+1])}}};function mq(t,e,i){t.origin=e,t.endpoint=i,V_(t.direction,e,i)}ib.planePointIndices=H_t,ib.nearFarLineIndices=[[ct.NEAR_BOTTOM_LEFT,ct.FAR_BOTTOM_LEFT],[ct.NEAR_BOTTOM_RIGHT,ct.FAR_BOTTOM_RIGHT],[ct.NEAR_TOP_RIGHT,ct.FAR_TOP_RIGHT],[ct.NEAR_TOP_LEFT,ct.FAR_TOP_LEFT]];let Y$=class extends V0{set desiredCamera(e){this._set("desiredCamera",e.clone())}constructor(e){super(e),this._handles=new Xi}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=Tn.Running,this._handles.add(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this._handles.removeAll()}stepController(){}_handleElevationChangeEvent(e){v(e.spatialReference)&&!JNe(this.view,this.desiredCamera,e.extent,e.spatialReference)||this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),zO(this.view,e,_p.EYE_AND_CENTER)||this.constraintEnabled||(this.state=Tn.Stopped)})}};u([d({constructOnly:!0})],Y$.prototype,"desiredCamera",null),Y$=u([$("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],Y$);const Yxt=P(),v5=P();function Ale(){return{direction:P(),up:P()}}function CFe(t,e,i,r,n){let s=we(Yxt,t),o=be(s,r);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(be(e,r)),o<.99?(ce(s,e),a&&le(s,s,-1)):s=null);let l=0;if(s){le(v5,r,be(r,s)),ge(s,s,v5);const h=be(s,n)/(Pe(s)*Pe(n));vt(v5,s,n),l=(be(v5,r)>0?1:-1)*ml(eo(h))}const c=ml(eo(-be(r,t)/Pe(t)));return i?(i.heading=l,i.tilt=c,i):{heading:l,tilt:c}}const AFe=Ue(0,1,0),RFe=Ue(0,0,1),k3=$e(),jy=P(),Gy=P();function MFe(t,e,i,r=Ale()){const{direction:n,up:s}=r;return $Ae(k3,-Xt(e)),AM(k3,k3,Xt(i)),Ke(n,RFe,k3),le(n,n,-1),Ke(s,AFe,k3),r}function Zxt(t,e,i,r){return CFe(e,i,r,RFe,AFe)}function Jxt(t,e,i,r){const n=MFe(t,i,r),s=P();return le(s,n.direction,-e),me(s,s,t),{up:n.up,eye:s,heading:i,tilt:r}}function Kxt(t){return ml(t)}function Qxt(t){return Xt(t)}function OFe(t,e,i,r,n){const s=t.renderSpatialReference,o=t.map&&t.spatialReference||e.spatialReference;return qa(e,jy,s),qa(e,Gy,s),jy[0]-=i/2,Gy[0]+=i/2,jy[1]-=r/2,Gy[1]+=r/2,jo(jy,s,jy,o),jo(Gy,s,Gy,o),n?(n.xmin=jy[0],n.ymin=jy[1],n.xmax=Gy[0],n.ymax=Gy[1],n.spatialReference=o):n=new ni(jy[0],jy[1],Gy[0],Gy[1],o),n}const eTt=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:Zxt,eyeForCenterWithHeadingTilt:Jxt,eyeTiltToLookAtTilt:Qxt,headingTiltToDirectionUp:MFe,lookAtTiltToEyeTilt:Kxt,toExtent:OFe},Symbol.toStringTag,{value:"Module"})),PFe=Ue(0,0,1),IFe=we(P(),Ue(1,1,1)),tTt=new nw(-180,180),U3=$e(),G1=P(),LE=P();function $Fe(t,e,i,r=Ale()){vt(G1,t,PFe),be(G1,G1)===0&&vt(G1,t,IFe),ad(U3,-Xt(e),t),Vu(U3,U3,-Xt(i),G1);const{up:n,direction:s}=r;return vt(n,G1,t),we(n,n),Ke(n,n,U3),we(s,t),pl(s,s),Ke(s,s,U3),r}function iTt(t,e,i,r){const n=G1,s=LE;return we(n,t),vt(LE,n,PFe),be(LE,LE)===0&&vt(LE,n,IFe),vt(s,LE,n),CFe(e,i,r,n,s)}function rTt(t,e,i,r){const n={eye:P(),up:null,tilt:r,heading:i},s=G1;s[0]=t[0],s[1]=t[2],s[2]=-t[1];const o=e,a=Xt(i),l=Xt(r),c=Math.sin(a),h=Math.cos(a),p=Math.sin(l),f=Math.cos(l),m=Pe(s);let g;if(Math.abs(l)<1e-8)g=o+m;else{const q=m/p,N=Pp(o/q),L=Math.PI-l-N;g=q*Math.sin(L)}const _=f*o,b=o*o*(p*p),w=h*h*b,x=g-_,T=x*x,E=w*(w+T-s[1]*s[1]);if(E<0)return le(n.eye,s,g/m),n.tilt=0,b5(n,t);const C=Math.sqrt(E),A=s[1]*x,I=w+T;let O;if(O=h>0?-C+A:C+A,Math.abs(I)<1e-8)return m<1e-8?(n.eye[0]=0,n.eye[1]=0,n.eye[2]=o):le(n.eye,s,g/m),n.tilt=0,gq(n.eye),b5(n,t);n.eye[1]=O/I;const D=c*c*b,U=p*o,V=h*U*n.eye[1],B=n.eye[1]*n.eye[1],ee=1-B,ie=Math.sqrt(ee),J=w*B+D-2*V*ie*x+ee*T;return Math.abs(J)<1e-8?(le(n.eye,s,g/m),n.tilt=0,gq(n.eye),b5(n,t)):(n.eye[0]=(ee*(g*s[0]-_*s[0])-U*ie*(s[0]*n.eye[1]*h+s[2]*c))/J,n.eye[2]=(ee*(g*s[2]-_*s[2])-U*ie*(s[2]*n.eye[1]*h-s[0]*c))/J,le(n.eye,n.eye,g),gq(n.eye),b5(n,t))}function gq(t){const e=t[1];t[1]=-t[2],t[2]=e}function b5(t,e){const i=$Fe(e,t.heading,t.tilt);return t.up=i.up,t}function nTt(t,e,i){const r=Pe(e),n=Math.sqrt(i*i+r*r-2*i*r*Math.cos(Math.PI-t)),s=Pp(i/(n/Math.sin(t)));return ml(t-s)}function sTt(t,e,i){const r=Xt(t),n=Pe(e);return Pp(i/(n/Math.sin(r)))+r}function LFe(t,e,i,r,n){let s,o,a,l;const c=e.latitude,h=sr(t.spatialReference).radius,p=e.longitude,f=mbt(c,i,h)/2;s=p-f,o=p+f;const m=Xt(c),g=(1+Math.sin(m))/(1-Math.sin(m)),_=(g+1)*Math.tan(r/h/2),b=_*_;function w(T){const E=Math.PI/2;return(T=cYe.normalize(T,-E))>E&&(T=Math.PI-T),T}if(a=1.5*Math.PI-2*Math.atan(.5*(_+Math.sqrt(4*g+b))),l=a+r/h,a=w(a),l=w(l),l<a){const T=l;l=a,a=T}if(a=Math.max(ml(a),-90),l=Math.min(ml(l),90),o=tTt.monotonic(s,o),o-s>180){const T=(o-s-180)/2;s+=T,o-=T}const x=t.spatialReference&&t.spatialReference.isGeographic?t.spatialReference:Je.WGS84;return n?(n.xmin=s,n.ymin=a,n.xmax=o,n.ymax=l,n.spatialReference=x):n=new ni(s,a,o,l,x),t.spatialReference&&t.spatialReference.isWebMercator&&Zg(n,!1,n),n}const oTt=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:iTt,eyeForCenterWithHeadingTilt:rTt,eyeTiltToLookAtTilt:sTt,headingTiltToDirectionUp:$Fe,lookAtTiltToEyeTilt:nTt,toExtent:LFe},Symbol.toStringTag,{value:"Module"}));function Ez(t){return t.type==="point"}let DFe=class{constructor(e,i=null,r=0){this.array=e,this.spatialReference=i,this.offset=r}};function NFe(t){return"array"in t}function jg(t,e,i="ground"){if(Ez(e))return t.getElevation(e.x,e.y,e.z||0,e.spatialReference,i);if(NFe(e)){let r=e.offset;return t.getElevation(e.array[r++],e.array[r++],e.array[r]||0,Nt(e.spatialReference,t.spatialReference),i)}return t.getElevation(e[0],e[1],e[2]||0,t.spatialReference,i)}function Cz(t,e){return t!=null&&(e==null||(e===qe.Local?!t.isGeographic||t.isWGS84||t.wkid===hp.CGCS2000:t.isWebMercator||t.isWGS84||t.wkid===hp.CGCS2000||t.wkid===hp.GCSMARS2000||t.wkid===hp.GCSMARS2000_SPHERE||t.wkid===hp.GCSMOON2000))}const FFe=re.getLogger("esri.views.3d.support.cameraUtils"),kFe=39.37,UFe=96,pte=1,aTt=8,lTt=5,VFe=1,Z0e=P(),cTt={heading:0,tilt:0},rb=new Le,uTt=new nw(-20037508342788905e-9,20037508342788905e-9),hTt=new nw(-180,180);var Va;function KN(t){return t.spatialReference||Je.WGS84}function jO(t){return t.viewingMode==="global"?oTt:eTt}function dTt(t,e,i,r,n){return jO(t).headingTiltToDirectionUp(e,i,r,n)}function L0(t,e){if(R(e))return null;const i=t.renderSpatialReference,r=jO(t).headingTiltToDirectionUp,n=P();if(!qa(e.position,n,i))return null;const s=r(n,e.heading,e.tilt);le(s.direction,s.direction,t.state.camera.distance),me(s.direction,s.direction,n);const o=J2(t,n,s.direction,s.up);return o.fov=Xt(e.fov),o}(function(t){t[t.LOCKED=0]="LOCKED",t[t.ADJUST=1]="ADJUST"})(Va||(Va={}));const DE=P();function QM(t,e,i){const r=t.renderSpatialReference,n=y7(t,e.eye,e.viewForward,e.up,cTt);let s=KN(t);return jo(e.eye,r,DE,s)||(s=Je.WGS84,jo(e.eye,r,DE,s)),R(i)?new $p(new Le(DE,s),n.heading,n.tilt,ml(e.fov)):(i.position.x=DE[0],i.position.y=DE[1],i.position.z=DE[2],i.position.spatialReference=s,i.heading=n.heading,i.tilt=n.tilt,i.fov=ml(e.fov),i)}function Rle(t,e,i){const r=t.state.camera,n=r.width/2/r.pixelRatio;return t.renderCoordsHelper.viewingMode===qe.Global&&i!=null&&(e*=Math.cos(Xt(i))),e/=t.renderCoordsHelper.unitInMeters,n/(UFe*kFe/e)/Math.tan(r.fovX/2)}function A2(t,e,i){const r=t.state.camera,n=e*Math.tan(r.fovX/2),s=r.width/2/r.pixelRatio;let o=UFe*kFe/(s/n);return t.renderCoordsHelper.viewingMode===qe.Global&&i!=null&&(o/=Math.cos(Xt(i))),o*=t.renderCoordsHelper.unitInMeters,o}function zFe(t,e,i,r,n,s){return BFe(t,e,Rle(t,i,e.latitude),r,n,s)}function BFe(t,e,i,r,n,s){if(jS(s)){const a=new GO(s.signal);return PD(t,r.heading,r.tilt,e,i,n,a),void a.resolver.promise.then(l=>{const c=Rz(t,l,r.fov);if(!R(c))return s.resolver.resolve(c);s.resolver.reject()},l=>s.resolver.reject(l))}const o=PD(t,r.heading,r.tilt,e,i,n);return Rz(t,o,r.fov,s)}function y7(t,e,i,r,n){return jO(t).directionToHeadingTilt(e,i,r,n)}function pTt(t,e){return!!(t.basemapTerrain&&t.renderCoordsHelper.fromRenderCoords(e,rb,t.spatialReference)&&t.elevationProvider&&Nt(jg(t.elevationProvider,rb),0)>(rb.z??0)-VFe)}async function fTt(t,e,i){if(!t.renderCoordsHelper.fromRenderCoords(e,rb,t.spatialReference)||!t.elevationProvider)return!1;const r=rb.z??0,n=await t.elevationProvider.queryElevation(rb.x,rb.y,r,rb.spatialReference,"ground",i);return Nt(n,0)>r-VFe}async function mTt(t,e,i){const r=P();if(e)if(e instanceof Le){if(qa(e,r,t.renderSpatialReference),e.z==null&&t.basemapTerrain!=null&&t.elevationProvider!=null){const n=await t.elevationProvider.queryElevation(e.x,e.y,e.z??0,e.spatialReference,"ground",i);return v(n)&&t.renderCoordsHelper.setAltitude(r,n),r}}else ce(r,e);else ce(r,t.state.camera.center);return r}function gTt(t,e){const i=P();if(e&&e instanceof Le){if(qa(e,i,t.renderSpatialReference),e.z==null&&t.basemapTerrain!=null&&t.elevationProvider!=null){const r=jg(t.elevationProvider,e);v(r)&&t.renderCoordsHelper.setAltitude(i,r)}}else ce(i,e||t.state.camera.center);return i}function PD(t,e,i,r,n,s,o){const a=r&&r instanceof Le?r:null;if(jS(o))return mTt(t,r,o.signal).then(c=>{fte(t,e,i,a,c,n,s,o)},c=>o.resolver.reject(c)),null;const l=gTt(t,r);return fte(t,e,i,a,l,n,s,o)}function fte(t,e,i,r,n,s,o,a){if(R(r)){const p=t.renderSpatialReference;if(r=lw(n,p,KN(t)),R(r))return null}s=Math.max(s,t.state.constraints.minimumPoiDistance);const l=vTt(t,e,i,n,s,o),c=(0,jO(t).eyeForCenterWithHeadingTilt)(n,s,l.heading,l.tilt);if(o===Va.ADJUST&&t.viewingMode==="global"&&i>0){const p=()=>{const m=jFe(t,n,s,wTt(t,s,i,n));return o=i-m<1?Va.LOCKED:Va.ADJUST,fte(t,e,m,r,n,s,o,a)},f=t.map.ground.navigationConstraint;if(!f||f.type==="stay-above"){if(pTt(t,c.eye))return p();if(jS(a))return fTt(t,c.eye,a.signal).then(m=>m?p():(a.resolver.resolve({eye:c.eye,up:c.up,center:In(n),heading:c.heading,tilt:c.tilt}),null)),null}}const h=!a||jS(a)?{center:P(),eye:P(),up:P(),tilt:0,heading:0}:a;return h.eye=c.eye,h.up=c.up,h.center=In(n),h.heading=c.heading,h.tilt=c.tilt,jS(a)&&a.resolver.resolve(h),h}function Z$(t,e,i,r,n,s=null){let o,a,l;if(t.state.isGlobal){if(!Cz(e.spatialReference,qe.Global))return jS(s)&&s.resolver.reject(),null;const b=new Le(e.xmin,e.ymin,e.spatialReference),w=new Le(e.xmax,e.ymax,e.spatialReference),x=e.spatialReference.isGeographic?hTt:uTt;o=new Le({x:x.center(b.x,w.x),y:(w.y+b.y)/2,z:e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0,spatialReference:e.spatialReference});const T=sr(e.spatialReference),E=fbt(o,b,w);a=E.lon,l=E.lat,x.diff(b.x,w.x)>x.range/2&&(a+=T.halfCircumference),a=Math.min(a,T.halfCircumference),l=Math.min(l,T.halfCircumference)}else{const b=Nt(t.renderSpatialReference,e.spatialReference);b.equals(e.spatialReference)||(e=Sm(e,b)),a=e.xmax-e.xmin,l=e.ymax-e.ymin;const w=e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0;o=new Le({x:e.xmin+.5*a,y:e.ymin+.5*l,z:w,spatialReference:b})}const c=e.zmax!=null&&e.zmin!=null?e.zmax-e.zmin:0,h=t.state.camera,p=1/Math.tan(h.fovX/2),f=1/Math.tan(h.fovY/2),m=1/Math.tan(h.fov/2),g=Math.max(.5*a*p,.5*l*f,.5*c*m)/pte;if(jS(s)){const b=new GO(s.signal);return PD(t,i,r,o,g,n,b),void b.resolver.promise.then(w=>{const x=Rz(t,w,t.camera.fov);if(!R(x))return s.resolver.resolve(x);s.resolver.reject()},w=>s.resolver.reject(w))}const _=PD(t,i,r,o,g,n);return Rz(t,_,t.camera.fov,s)}function yTt(t,e,i){const r=t.renderSpatialReference,n=lw(i,r,KN(t));if(R(n))return null;const s=Math.tan(e.fovX/2),o=Math.tan(e.fovY/2),a=xN(e.eye,i),l=2*a*s*pte,c=2*a*o*pte;return t.viewingMode==="global"?LFe(t,n,l,c):OFe(t,n,l,c)}function _Tt(t,e,i){const r=t.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(i/r)/Math.LN2>aTt)return!0;const n=t.renderSpatialReference,s=KN(t),o=lw(e,n,s),a=lw(t.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,n,s);if(R(o)||R(a))return!1;const l=Math.tan(.5*t.state.camera.fov)*r;return a.distance(o)/l>lTt}function vTt(t,e,i,r,n,s){let o=0;return s===Va.ADJUST&&_Tt(t,r,n)?(e=0,o=bTt(t,n,i,r)):o=Mle(t,r,n,i),o=t.state.constraints.clampTilt(n,o),{heading:e,tilt:i=jFe(t,r,n,o)}}const Az=.7;function bTt(t,e,i,r){const n=Mle(t,r,e,i);if(!t.state.constraints.tilt)return n;const s=t.state.constraints.tilt(e);s.max=Math.min(s.max,.5*Math.PI);const o=s.min*(1-Az)+s.max*Az;return Math.min(n,o)}function wTt(t,e,i,r){let n=Mle(t,r,e,i);if(!t.state.constraints.tilt)return n;const s=t.state.constraints.tilt(e);return n=Math.min(n,.5*Math.PI),s.min*(1-Az)+n*Az}function jFe(t,e,i,r){return jO(t).lookAtTiltToEyeTilt(r,e,i)}function Mle(t,e,i,r){return jO(t).eyeTiltToLookAtTilt(r,e,i)}function Rz(t,e,i,r){if(R(e))return null;const n=t.renderSpatialReference,s=lw(e.eye,n,KN(t));return R(s)?null:v(r)?(r.position=s,r.heading=e.heading,r.tilt=e.tilt,r.fov=i,r):new $p(s,e.heading,e.tilt,i)}function xTt(t,e){var r;const i=(r=t.basemapTerrain)==null?void 0:r.tilingScheme;if(i)return i.levelAtScale(e);FFe.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function GFe(t,e){var r;const i=(r=t.basemapTerrain)==null?void 0:r.tilingScheme;if(i)return i.scaleAtLevel(e);FFe.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function HFe(t,e){return jo(e.center,t.renderSpatialReference,Z0e,Je.WGS84),A2(t,e.distance,Z0e[1])}let GO=class{constructor(e){this.signal=e,this.resolver=Jb()}};function jS(t){return t&&"resolver"in t}const TTt=.66;function qFe(t){return 360-ose.normalize(t)}function _7(t){return ose.normalize(360-t)}function V3(t){return v(t)&&t.resolver&&t.resolver.reject(),null}function STt(t,e){return v(t)&&t.resolver&&t.resolver.resolve(e),e}function WFe(t,e,i,r=null){if(!e)return V3(r);const n=t.spatialReference||Je.WGS84;if(v(e.camera)){const c=z2(e.camera.position,n);if(R(c))return V3(r);const h=e.camera.clone();return h.position=c,STt(r,h)}if(R(e.targetGeometry))return V3(r);const s=e.get("targetGeometry.spatialReference");if(s&&!Fb(s,n))return V3(r);const o=QM(t,t.state.camera);let a=Va.ADJUST;if(e.rotation!=null&&(o.heading=qFe(e.rotation),a=Va.LOCKED),i!=null&&(o.tilt=i),e.targetGeometry.type==="point"){const c=e.targetGeometry;let h;const p=e.targetGeometry.clone();return h=e.scale!=null?Rle(t,e.scale,c.latitude):t.state.camera.distance,BFe(t,p,h,o,a,r)}const l=e.targetGeometry.extent;return l?Z$(t,l,o.heading,o.tilt,a,r):V3(r)}function ETt(t,e,i=null){return R(i)&&(i=new Jn),Ile(t,null,e.clone(),i)}async function CTt(t,e,i){const r=NTt(t,e);if(!r)throw new H("viewpointutils-create:no-target","Missing target for creating viewpoint");const n=new $p({fov:t.camera.fov}),s=new Jn({camera:n});if(r.target instanceof Jn)return px(await MTt(t,r.target,r,i,s));if(r.target instanceof $p)return px(YFe(t,r.target,s));const o=r.scale!=null||r.zoom!=null;if(r.target instanceof ni){const c=r.target.xmin===r.target.xmax||r.target.ymin===r.target.ymax;return px(o||c?await mte(t,r,r.target.center,n,i,s):await $Tt(t,r,r.target,n,i,s))}const a={boundingBox:Br(),hasZ:!1,screenSpaceObjects:[]},l=o?ATt(t,r):void 0;if(await XFe(t,r.target,l,a),isFinite(a.boundingBox[0])){let c;if(Yf(a.boundingBox,us),kh.x=us[0],kh.y=us[1],kh.z=us[2],kh.spatialReference=t.spatialReference,isFinite(kh.z)&&a.hasZ?c=Vne(a.boundingBox):(kh.z=void 0,c=yWe(Une(a.boundingBox,kTt))),o||c)return px(await mte(t,r,kh,n,i,s));const h=FTt(t,a.screenSpaceObjects);return px(await DTt(t,r,kh,a.boundingBox,h,n,i,s))}return r.position?px(PTt(t,r,n,s)):px(await ITt(t,r,n,i,s))}function Ole(t,e){return e.scale==null&&e.zoom!=null?GFe(t,e.zoom):e.scale}function ATt(t,e){const i=Ole(t,e);return i?Jyt(i):void 0}function Ple(t,e){let i=!1;return e.heading!=null?(t.heading=e.heading,i=!0):e.rotation!=null&&(t.heading=qFe(e.rotation),i=!0),e.tilt!=null&&(t.tilt=e.tilt,i=!0),e.fov!=null&&(t.fov=e.fov),i}function Ile(t,e,i,r){const n=t.spatialReference||Je.WGS84;return e=v(e)?e:L0(t,i),R(e)||(r.targetGeometry=lw(e.center,t.renderSpatialReference,n),r.scale=HFe(t,e),r.rotation=_7(i.heading),r.camera=i),r}function Mz(t,e,i){var a,l;const r=()=>new H("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!e)throw r();if(!Fb(e.spatialReference,t.spatialReference))throw new H("viewpointutils:incompatible-spatialreference",`Spatial reference (${e.spatialReference?e.spatialReference.wkid:"unknown"}) is incompatible with the view (${(a=t.spatialReference)==null?void 0:a.wkid})`,{geometry:e});const n=[];if(!e.hasZ&&t.basemapTerrain){let c;switch(e.type){case"point":c=e;break;case"multipoint":case"polyline":c=(l=e.extent)==null?void 0:l.center;break;case"mesh":c=e.origin;break;case"extent":c=e.center;break;case"polygon":c=e.centroid}c&&v(t.basemapTerrain.spatialReference)&&Fb(c,t.basemapTerrain.spatialReference)&&t.elevationProvider?us[2]=Nt(jg(t.elevationProvider,c),0):us[2]=0}(0,UTt[e.type])(e,c=>{n.push(c[0],c[1],c[2])},us);const s=n.length/3;if(s===0)throw r();const o=new Array(n.length);if(Nn(n,e.spatialReference,0,o,t.spatialReference,0,s)){e.hasZ&&(i.hasZ=!0);for(let c=0;c<o.length;c+=3)e.hasZ?(us[0]=o[c+0],us[1]=o[c+1],us[2]=o[c+2]):(us[0]=o[c+0],us[1]=o[c+1]),py(i.boundingBox,us)}}async function RTt(t,e,i,r){const n=await _m(t.whenViewForGraphic(e));if(n.ok===!1||R(n.value)||!("whenGraphicBounds"in n.value))return void Mz(t,e.geometry,r);const s=n.value,o=await _m(s.whenGraphicBounds(e,{minDemResolution:i}));if(o.ok===!1)return void Mz(t,e.geometry,r);const{screenSpaceObjects:a,boundingBox:l}=o.value;wM(r.boundingBox,l),a&&a.forEach(c=>{r.screenSpaceObjects.push(c)}),isFinite(l[2])&&(r.hasZ=!0)}async function XFe(t,e,i,r){var n;if(Array.isArray(e)&&e.length===2){const s=e[0],o=e[1];if(typeof s=="number"&&typeof o=="number")return kh.x=s,kh.y=o,kh.z=void 0,kh.spatialReference=(n=t.spatialReference)!=null&&n.isGeographic?t.spatialReference:Je.WGS84,void Mz(t,kh,r)}e&&typeof e.map=="function"?await ma(e.map(s=>XFe(t,s,i,r))):e instanceof U_?Mz(t,e,r):e instanceof Ha&&await RTt(t,e,i,r)}async function MTt(t,e,i,r,n){if(v(e.camera))return YFe(t,e.camera,n);n.scale=e.scale,n.rotation=e.rotation,n.targetGeometry=v(e.targetGeometry)?e.targetGeometry.clone():null,n.camera=null,i.heading!=null?n.rotation=_7(i.heading):i.rotation!=null&&(n.rotation=i.rotation);const s=Ole(t,i);s!=null&&(n.scale=s);const o=new GO(r);return WFe(t,n,i.tilt,o),n.camera=await o.resolver.promise,n}function YFe(t,e,i){const r=t.spatialReference,n=z2(e.position,r);return R(n)?null:((e=e.clone()).fov=t.camera.fov,e.position=n,Ile(t,null,e,i))}function OTt(t,e,i,r,n,s){const o=t.renderSpatialReference;return qa(i,x5,o),qa(e,yq,o),s.targetGeometry=new Le(e),n.position=new Le(i),ge(Oz,yq,x5),y7(t,x5,Oz,r.up,n),s.scale=A2(t,Lr(x5,yq),s.targetGeometry.latitude),s.rotation=_7(n.heading),s.camera=n,s}async function mte(t,e,i,r,n,s){if(R(i))throw new H("createfromcenter","invalid point");s.targetGeometry=i.clone();const o=J2(t);if(e.position)return OTt(t,s.targetGeometry,e.position,o,r,s);if(e.zoomFactor){const l=o.distance/e.zoomFactor,c=le(us,o.viewForward,-l);o.eye=me(us,o.center,c),s.scale=A2(t,l,i.latitude)}QM(t,o,r);const a=Ple(r,e)?Va.LOCKED:Va.ADJUST;if(!e.zoomFactor){const l=Ole(t,e);l==null?(qa(i,us,t.renderSpatialReference),JDe(o.frustum,us)?s.scale=A2(t,Lr(o.eye,us),i.latitude):s.scale=HFe(t,o)):s.scale=l;const c=new GO(n);zFe(t,s.targetGeometry,s.scale,r,a,c),s.camera=await c.resolver.promise}return s}function PTt(t,e,i,r){const n=J2(t);return ce(Oz,n.viewForward),y7(t,n.eye,Oz,n.up,_q),i.position=new Le(e.position),i.heading=e.heading!=null?e.heading:_q.heading,i.tilt=e.tilt!=null?e.tilt:_q.tilt,Ile(t,null,i,r)}async function ITt(t,e,i,r,n){const s=J2(t);return mte(t,e,lw(s.center,t.renderSpatialReference,t.spatialReference),i,r,n)}async function $Tt(t,e,i,r,n,s){s.targetGeometry=i.clone();const o=J2(t);QM(t,o,r);const a=Ple(r,e)?Va.LOCKED:Va.ADJUST,l=new GO(n);return Z$(t,i,r.heading,r.tilt,a,l),s.camera=await l.resolver.promise,s}function LTt(t,e,i,r,n){let s=0;i.z!=null?s=i.z:t.basemapTerrain&&t.elevationProvider&&(s=jg(t.elevationProvider,i)),he(us,i.x,i.y,s),ym(t.spatialReference,us,J0e,t.renderSpatialReference),Dp(w5,J0e),Qu(w5,w5),Br(z3);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let g=0;g<o.length;g++){const _=o[g];let b=r[_[2]];isFinite(b)||(b=s),he(us,r[_[0]],r[_[1]],b),jo(us,t.spatialReference,us,t.renderSpatialReference),py(z3,Wl(us,us,w5))}const a=B2(z3),l=Lw(z3),c=j2(z3),h=1/Math.tan(e.fovX/2),p=1/Math.tan(e.fovY/2),f=.5*Math.sqrt(a*a+c*c)*Math.max(p,h)+.5*l,m=.5*l*p+.5*Math.max(a,c);return Math.max(f,m)/n}async function DTt(t,e,i,r,n,s,o,a){a.targetGeometry=i.clone();const l=J2(t),c=LTt(t,l,i,r,n);QM(t,l,s);const h=Ple(s,e)?Va.LOCKED:Va.ADJUST;a.scale=A2(t,c,a.targetGeometry.latitude);const p=new GO(o);return zFe(t,a.targetGeometry,a.scale,s,h,p),a.camera=await p.resolver.promise,a}function NTt(t,e){if(!e||!t.spatialReference)return null;const i={target:void 0};if("declaredClass"in e||Array.isArray(e))i.target=e;else{for(const r in e)i[r]=e[r];e.center&&!i.target&&(i.target=e.center)}return i}function px(t){return t&&v(t.camera)&&(t.rotation=_7(t.camera.heading)),t}function FTt(t,e){const i=TTt;if(!e.length)return i;let r=Number.NEGATIVE_INFINITY;for(let n=0;n<e.length;n++){const s=e[n].screenSpaceBoundingRect;r=Math.max(r,Math.abs(s[0]),Math.abs(s[1]),Math.abs(s[2]),Math.abs(s[3]))}return i-r/Math.min(t.width,t.height)*2}const us=P(),J0e=$e(),w5=wr(),z3=to(),kTt=Kt(),Oz=P(),x5=P(),yq=P(),_q={heading:0,tilt:0},kh=new Le,UTt={point(t,e,i){i[0]=t.x,i[1]=t.y,t.z!=null&&(i[2]=t.z),e(i)},polygon(t,e,i){const r=t.hasZ;for(let n=0;n<t.rings.length;n++){const s=t.rings[n];for(let o=0;o<s.length;o++)i[0]=s[o][0],i[1]=s[o][1],r&&(i[2]=s[o][2]),e(i)}},polyline(t,e,i){const r=t.hasZ;for(let n=0;n<t.paths.length;n++){const s=t.paths[n];for(let o=0;o<s.length;o++)i[0]=s[o][0],i[1]=s[o][1],r&&(i[2]=s[o][2]),e(i)}},multipoint(t,e,i){const r=t.points,n=t.hasZ;for(let s=0;s<r.length;s++)i[0]=r[s][0],i[1]=r[s][1],n&&(i[2]=r[s][2]),e(i)},extent(t,e,i){t.zmin!=null&&t.zmax!=null?(e(he(i,t.xmin,t.ymin,t.zmin)),e(he(i,t.xmax,t.ymin,t.zmin)),e(he(i,t.xmin,t.ymax,t.zmin)),e(he(i,t.xmax,t.ymax,t.zmin)),e(he(i,t.xmin,t.ymin,t.zmax)),e(he(i,t.xmax,t.ymin,t.zmax)),e(he(i,t.xmin,t.ymax,t.zmax)),e(he(i,t.xmax,t.ymax,t.zmax))):(e(he(i,t.xmin,t.ymin,i[2])),e(he(i,t.xmax,t.ymin,i[2])),e(he(i,t.xmin,t.ymax,i[2])),e(he(i,t.xmax,t.ymax,i[2])))},mesh(t,e,i){const r=t.vertexAttributes&&t.vertexAttributes.position;if(r)for(let n=0;n<r.length;n+=3)e(he(i,r[n+0],r[n+1],r[n+2]))}};let VTt=class{constructor(e,i,r){this.target=e,this.options=i,this.view=r,this.state="pending",this._animationController=null,this._promise=new Promise((n,s)=>{this._resolveCallback=n,this._rejectCallback=s;const o=new AbortController;v(this.options.signal)&&ja(this.options.signal,()=>{this.abort()}),this._abortController=o,this.waitForReady()})}then(e,i){return this._promise.then(e,i)}catch(e){return this._promise.catch(e)}resolve(e){if(this.state!=="finished")return this.state="finished",this._resolveCallback(e)}reject(e){if(this.state!=="finished")return this.state="finished",this._rejectCallback(e)}abort(e=!1){this._abortController.abort(),this.state==="wait-for-animation-finish"&&!e&&v(this._animationController)&&this.view.state.cameraController===this._animationController&&this._animationController.active&&this._animationController.stopController(),this.reject(Bi())}async waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await ow(()=>this.view.ready,this._abortController.signal)}catch(e){return this.reject(e)}this.createViewPoint()}createViewPoint(){this.state!=="finished"&&(this.state="wait-for-viewpoint",this._animationController=this.options.animate?this._getAnimationController():null,CTt(this.view,this.target,this._abortController.signal).then(e=>{if(this.state==="finished")return;const i=e?this._getCameraFromViewpoint(e):null;if(!R(i))if(this.options.animate){if(R(this._animationController))return;this.startAnimation(i,this._animationController)}else this.view.stateManager.setStateCamera(i.camera,{applyConstraints:!i.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()},e=>{this.reject(e)}))}_getCameraFromViewpoint(e){var s;const i=!!(this.target instanceof Jn&&this.target.camera||this.target instanceof $p),r=e.camera;if(R(r))return null;if(!this.view.stateManager.isCompatible(r)){const o=r.position,a=o&&o.spatialReference,l=a?a.wkid:"none",c=(s=this.view.spatialReference)==null?void 0:s.wkid;return this.reject(new H("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${l}, view: ${c})`,{camera:r})),null}const n=L0(this.view,r);return R(n)?(this.reject(new H("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:e,camera:n,isFullySpecified:i}}startAnimation(e,i){this.state="wait-for-animation-finish";const r=i.viewAnimation;if(R(r))return void this.reject(new H("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(r.update(e.viewpoint,"running"),!i.active||R(i.viewAnimation)||i.viewAnimation.target!==e.viewpoint||this.view.state.cameraController!==i)return this.abort();let n;e.isFullySpecified?(n=new Y$({view:this.view,desiredCamera:e.camera}),zO(this.view,e.camera,_p.EYE_AND_CENTER)):hs(this.view,e.camera),i.begin(e.camera,this.options);const s=()=>{const a=this.view.state.cameraController;n&&(a&&a.active?a instanceof i_&&v(a.viewAnimation)&&a.viewAnimation.target===e.viewpoint&&(this.view.state.cameraController=n):v(i.viewAnimation)&&i.viewAnimation.target===e.viewpoint&&i.state==="finished"&&(this.view.state.cameraController=n))},o=a=>{if(!R(this.view.state))switch(i.state){case Tn.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case Tn.Ready:case Tn.Rejected:case Tn.Running:case Tn.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(a)}}};r.when(s,a=>o(a)),i.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let e=null,i=null;const r=this.view.state.cameraController;return r instanceof i_&&(r.updateStateFromViewAnimation(),r.active&&(e=r,i=e.viewAnimation)),e!=null||(e=new i_({view:this.view,mode:"animation"}),i=e.viewAnimation,this.view.state.switchCameraController(e))?e:(v(i)&&i.stop(),this.reject(new H("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}},ks=class extends ve{get camera(){const e=this._get("camera");if(!this.ready)return e;const i=QM(this.view,this.view.state.camera,vq);return i&&e&&i.equals(e)?e:i.clone()}set camera(e){var i,r;this._updatePropertyBeforeReady("camera",e)||((i=this.view.elevationProvider)==null||i.enableElevationCache(!0),this.setStateCamera(L0(this.view,e),{applyConstraints:!1})||re.getLogger(this.declaredClass).error("#camera=","Invalid camera",e),(r=this.view.elevationProvider)==null||r.enableElevationCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const i=QM(this.view,this.view.state.contentCamera,vq);return i&&e&&i.equals(e)?e:i.clone()}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const i=L0(this.view,e);R(i)?this.view.state.contentCamera=null:(this._updateElevation(i),this.view.state.contentCamera=i)}installContentCameraReset(e){if(this.removeHandles(bq),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const i=this.zoom,r=this.view.state.camera.distance**2,n=Fc(this.view.state.camera.center),s=e.sticky?this.contentCamera.clone():null;return this.addHandles([ne(()=>this.contentCamera,()=>{e.sticky||(this.removeHandles(bq),this.test.contentCameraResetState.clear())}),ne(()=>this.zoom,o=>{o!==void 0&&i!==void 0&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(o-i)/2),Math.abs(o-i)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s))}),ne(()=>this.view.state.camera,o=>{const a=ba(n,o.center);this.test.contentCameraResetState.set("camera.center",a/r),a>r?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s)})],bq),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){var i;this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():re.getLogger(this.declaredClass).error("#center=","Invalid center",e):re.getLogger(this.declaredClass).error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((i=this.view.spatialReference)==null?void 0:i.wkid)+")",e):re.getLogger(this.declaredClass).error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,i=yTt(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return v(i)?i:this._get("extent")}set extent(e){var i;this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||re.getLogger(this.declaredClass).error("#extent=","Invalid extent",e):re.getLogger(this.declaredClass).error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((i=this.view.spatialReference)==null?void 0:i.wkid)+")",e):re.getLogger(this.declaredClass).error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this._propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get hasInitialView(){return!!this.view.get("map.initialViewProperties.viewpoint")}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return A2(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||re.getLogger(this.declaredClass).error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,i=e.padding,r=e.pixelRatio,n=this._get("padding"),s=Math.round(i[yi.TOP]/r),o=Math.round(i[yi.RIGHT]/r),a=Math.round(i[yi.BOTTOM]/r),l=Math.round(i[yi.LEFT]/r);return n!=null&&n.top===s&&n.right===o&&n.bottom===a&&n.left===l?n:{top:s,right:o,bottom:a,left:l}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,T5),this.view.state.updateCamera(i=>i.padding=T5))}_paddingToArray(e,i,r){e?cr(r,e.top||0,e.right||0,e.bottom||0,e.left||0):cr(r,0,0,0,0);for(let n=0;n<4;n++)r[n]=Math.round(r[n]*i)}get screenCenter(){const e=this.padding;return Ws((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?ETt(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){var i;if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||re.getLogger(this.declaredClass).error("#viewpoint=","Invalid viewpoint",e);else{const r=v(e.camera)?e.camera.position:e.targetGeometry,n=v(r)&&r.spatialReference;re.getLogger(this.declaredClass).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(n?n.wkid:"none")+", view: "+((i=this.view.spatialReference)==null?void 0:i.wkid)+")",e)}else re.getLogger(this.declaredClass).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?xTt(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||e===void 0||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||re.getLogger(this.declaredClass).error("#zoom=","Invalid zoom",e)}get _pixelRatio(){var e;return v(this._devicePixelRatioOverride)?this._devicePixelRatioOverride:this._usePhysicalPixelRendering?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,(e=this.view)==null?void 0:e.qualitySettings.maximumPixelRatio)}get _rasterPixelRatio(){return v(this._devicePixelRatioOverride)?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){var e,i;return((i=(e=this.view)==null?void 0:e._stage)==null?void 0:i.renderer.isFeatureEnabled(ls.PhysicalPixelRendering))??!1}get _usePhysicalPixelRenderingAny(){var i,r;const e=(r=(i=this.view)==null?void 0:i._stage)==null?void 0:r.renderer;return e&&(e.isFeatureEnabled(ls.PhysicalPixelRendering,Pi.IDLE)||e.isFeatureEnabled(ls.PhysicalPixelRendering,Pi.INTERACTING)||e.isFeatureEnabled(ls.PhysicalPixelRendering,Pi.ANIMATING))}constructor(e){super(e),this._propertiesPool=new O_({frustum:ib},this),this._cameraSetByUser=!1,this._gotoOperation=null,this.constraintsManager=null,this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._cameraChangeTime=0,this._updatingIgnoreRenderState=!1,this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:i=>this._devicePixelRatioOverride=i,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},set updatingIgnoreRenderState(i){this.viewStateManager._updatingIgnoreRenderState=i},get updatingIgnoreRenderState(){return this.viewStateManager._updatingIgnoreRenderState||v(this.renderState)}}}initialize(){this._cameraChangeTime=performance.now(),this.addHandles([Kn(()=>this.view.state.events,"before-camera-change",e=>e&&this._updateElevation(e)),ne(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},(e,i)=>this._cameraChangedHandler(e,i),Ki)]),yo(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},e=>this._updateElevation(e),{once:!0,sync:!0}),this.addHandles([E_({prepare:()=>this._prepareFrame()}),ne(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0,this.removeHandles(S5)}),Kn(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit(),this._propertiesPool=Ve(this._propertiesPool)}init(){this.constraintsManager=new zI({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(const i of e)this.set(i.name,i.value);if(!this._cameraSetByUser){const i=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent;i&&this.isCompatible(i)?this._setInitialView(i):this.view.state.viewingMode===qe.Local&&this.addHandles(yo(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles(S5),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),S5)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles(S5),this.constraintsManager=Ve(this.constraintsManager))}async goTo(e,i){const r={animate:!0,...i};return v(this._gotoOperation)&&this._gotoOperation.abort(r.animate),this._gotoOperation=new VTt(e,r,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation}debugSetCameraOnContent(){this.setStateCamera(J2(this.view),{applyConstraints:!1})}step(e){const i=this.view.state,r=i==null?void 0:i.cameraController;r&&(i.updateCamera(n=>r.stepController(e,n)),r.steppingFinished&&r.finishController())}_cancelGoToOperation(){v(this._gotoOperation)&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const e=new Set,i=[];for(const{propertyName:r,overrides:n}of BTt){const s=e.has(r),o=this._isOverridden(r);!s&&o&&i.push({name:r,value:this._get(r)}),this._clearOverride(r),(s||o)&&n.forEach(a=>e.add(a))}return i}_setInitialView(e){if(R(e)||this._cameraSetByUser)return;if(e instanceof $p)return void this.setStateCamera(L0(this.view,e),{applyConstraints:!1});if(e instanceof Jn){if(e.targetGeometry instanceof ni){const s=Z$(this.view,e.targetGeometry,0,.5,Va.LOCKED);return void(v(s)&&this.setStateCamera(L0(this.view,s),{applyConstraints:!0}))}const r={applyConstraints:!e.camera},n=this._viewpointToCamera(e);return void this.setStateCamera(n,r)}const i=Z$(this.view,e,0,.5,Va.LOCKED);v(i)&&this.setStateCamera(L0(this.view,i),{applyConstraints:!0})}_updatePropertyBeforeReady(e,i){return!this.ready&&(this._override(e,i),i&&zTt.includes(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return!R(e)&&(e instanceof Jn?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof $p?this.isCompatible(e.position):e.spatialReference&&Fb(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=jTt){return this._cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,i,r=Ov){const{heading:n,tilt:s}=this._getPreservingHeadingTilt(),o=PD(this.view,n,s,e,i,Va.ADJUST);return R(o)?null:(r.copyFrom(this.view.state.camera),r.eye=o.eye,r.center=o.center,r.up=o.up,r)}_centerToCamera(e){const i=this.view.pointsOfInterest.centerOnContent;i.runTask();const r=i.distance;return this._centerPointAtDistanceToCamera(e,r)}_extentToCamera(e){const{heading:i,tilt:r}=this._getPreservingHeadingTilt(),n=Z$(this.view,e,i,r,Va.ADJUST,vq);return n?L0(this.view,n):null}_scaleToCamera(e){if(e==null)return null;const i=this.view.pointsOfInterest.centerOnContent;i.runTask();const r=i.renderLocation,n=i.location.latitude;if(n==null)return null;const s=Rle(this.view,e,n);return this._centerPointAtDistanceToCamera(r,s)}_zoomToCamera(e){return this._scaleToCamera(GFe(this.view,e))}_viewpointToCamera(e){return L0(this.view,WFe(this.view,e))}setStateCamera(e,i){return!(R(e)||!this.view.state.stopActiveCameraController())&&(this._cameraSetByUser=!0,i.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(r=>{i.positionAndOrientationOnly?(r.eye=e.eye,r.center=e.center,r.up=e.up):r.copyFrom(e),i.applyConstraints&&hs(this.view,r)}),i.applyConstraints||(this.view.state.cameraController=new Y$({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:i}=this.view;if(!e||!i)return;this._windowDevicePixelRatio=window.devicePixelRatio;const r=this._pixelRatio,n=Math.round(e.clientWidth*r),s=Math.round(e.clientHeight*r);if(n!==0&&s!==0&&(i.width===n&&i.height===s||(i.width=n,i.height=s),this.view.state)){const o=this.view.state.camera;o.fullWidth===n&&o.fullHeight===s&&o.pixelRatio===r||(Ov.copyFrom(o),Ov.pixelRatio!==r&&(this._paddingToArray(this.padding,r,T5),Ov.padding=T5),Ov.fullWidth=n,Ov.fullHeight=s,Ov.pixelRatio=r,this.view.state.camera=Ov),this._updateViewState()}}_updateElevation(e){var s;const i=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,r=((s=this.view.renderCoordsHelper)==null?void 0:s.getAltitude(e.eye))??0,n=i?d7(this.view,e.eye):0;e.relativeElevation=r-n}_updateViewState(){v(this.test.renderState)?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=Pi.ANIMATING:this.view.interacting?this.view.state.mode=Pi.INTERACTING:(this.view.state.mode===Pi.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<=GTt?this.view.state.mode=Pi.INTERACTING:this.view.state.mode=Pi.IDLE),this.view.state.rasterPixelRatio=this._rasterPixelRatio,this.view.state.contentPixelRatio=Math.min(this._pixelRatio,this.view.qualitySettings.maximumPixelRatio)}_cameraChangedHandler(e,i){e&&i&&e.almostEquals(i)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};u([d({type:$p,dependsOn:["view.state.camera","ready"]})],ks.prototype,"camera",null),u([d({type:$p,dependsOn:["view.state.contentCamera","ready"]})],ks.prototype,"contentCamera",null),u([d({type:Le})],ks.prototype,"center",null),u([d({type:ni})],ks.prototype,"extent",null),u([d({readOnly:!0})],ks.prototype,"frustum",null),u([d({readOnly:!0})],ks.prototype,"hasInitialView",null),u([d({readOnly:!0,type:Boolean})],ks.prototype,"ready",void 0),u([d({type:Number})],ks.prototype,"scale",null),u([d()],ks.prototype,"padding",null),u([d({readOnly:!0})],ks.prototype,"screenCenter",null),u([d({constructOnly:!0})],ks.prototype,"view",void 0),u([d({type:Jn})],ks.prototype,"viewpoint",null),u([d({type:Number})],ks.prototype,"zoom",null),u([d({readOnly:!0})],ks.prototype,"_pixelRatio",null),u([d({readOnly:!0})],ks.prototype,"_rasterPixelRatio",null),u([d({readOnly:!0})],ks.prototype,"_usePhysicalPixelRendering",null),u([d({readOnly:!0})],ks.prototype,"_usePhysicalPixelRenderingAny",null),u([d()],ks.prototype,"_windowDevicePixelRatio",void 0),u([d()],ks.prototype,"_devicePixelRatioOverride",void 0),ks=u([$("esri.views.3d.state.ViewStateManager")],ks);const zTt=["camera","viewpoint","extent","scale","center","zoom"],BTt=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],jTt={heading:0,tilt:0},vq=new $p,Ov=new Pt,T5=pi(),S5="pending-initial-view",bq="content-camera-reset",GTt=300,K0e=100;let Gg=class extends V0{constructor(){super(...arguments),this.startCamera=new Pt,this.currentCamera=new Pt,this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<K0e}stepController(e,i){i.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(i)}onControllerStart(e){this.state=Tn.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=performance.now(),setTimeout(()=>this.notifyChange("isInteractive"),K0e),this.view.state.updateCamera(e=>this.stepController(0,e)),this.steppingFinished&&this.finishController()}};u([d({readOnly:!0})],Gg.prototype,"isInteractive",null),u([d()],Gg.prototype,"_lastInteraction",void 0),Gg=u([$("esri.views.3d.state.controllers.InteractiveController")],Gg);var Ou;(function(t){t[t.CENTER=0]="CENTER",t[t.EYE=1]="EYE"})(Ou||(Ou={}));let J$=class extends Gg{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.pivot=Ou.CENTER,this._rotScale=0,this._lastPoint=Fe(),this._tmpWorldUp=P(),this._tmpViewDir=P(),this._tmpRotCurPoint=Fe(),this._tmpTransf=$e(),this._tmpAxis=P(),this._tmpPivotPoint=P(),this._pivotPos=P(),this._constraintOptions={selection:Zr.ALL,interactionType:fi.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Ho.TUMBLE}}initialize(){this._rotScale=this.pivot===Ou.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case Ou.EYE:ce(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=fi.LOOK_AROUND,this._constraintOptions.tiltMode=Ho.LOOK_AROUND,this._constraintOptions.selection=Zr.NONE;break;case Ou.CENTER:{const i=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,this.view.map.ground.opacity===0?K2:{});i||ce(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(e,i),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=fi.TUMBLE,this._constraintOptions.tiltMode=Ho.TUMBLE,this._constraintOptions.selection=Zr.ALL&~Zr.DISTANCE;break}}this._constraintOptions.interactionStartCamera=this.startCamera,BS(this.startCamera,e,this._lastPoint)}}_constrainPivotPoint(e,i){const r=this.startCamera,n=P();ge(n,this._pivotPos,r.eye);const s=Pe(n),o=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(r.eye,Q0e);let a=Math.max(Math.min(Axt,1/Math.abs(be(Q0e,r.viewForward)))*o,Rxt);i&&(a=Math.min(s,a));const l=sr(this.view.spatialReference),c=Sn(r.width/r.pixelRatio*.5,r.height/r.pixelRatio*.5),h=g7(this.startCamera,c,l);let p=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,r.fullWidth/r.pixelRatio*.5,r.fullHeight/r.pixelRatio*.5,r,2.5*hq,hq),f=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],r,hq);(v(p)||v(f))&&(p=Nt(p,f),f=R(f)||h===Uo.Horizontal?p:f,a=p>f?f:p,a=i?Math.min(a,s):a),we(n,n),ce(this._pivotPos,me(this._tmpPivotPoint,r.eye,le(this._tmpPivotPoint,n,a)))}update(e){if(this.active){switch(this.pivot){case Ou.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this._pivotPos);break;case Ou.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this._pivotPos)}hs(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.active&&this.finishController()}_applyRotation(e,i,r,n){this.view.renderCoordsHelper.worldUpAtPosition(n,this._tmpWorldUp),BS(e,i,this._tmpRotCurPoint);let s=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,o=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;ge(this._tmpViewDir,r,n);const a=Pe(this._tmpViewDir),l=eo(be(this._tmpViewDir,this._tmpWorldUp)/a);if(this.pivot===Ou.EYE){s*=-.5;const c=.5*Math.PI-l,h=.5*Math.PI*.99;s=c-Math.max(-h,Math.min(h,c+s))}return s=_e(s+l,La.min,La.max)-l,vt(this._tmpAxis,e.up,this._tmpViewDir),this.pivot===Ou.CENTER&&(o=-o),ad(this._tmpTransf,o,this._tmpWorldUp),Vu(this._tmpTransf,this._tmpTransf,s,this._tmpAxis),Ke(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),e.up=Ke(wq,e.up,this._tmpTransf),me(wq,n,this._tmpViewDir),io(this._lastPoint,this._tmpRotCurPoint),wq}};u([d()],J$.prototype,"pivot",void 0),J$=u([$("esri.views.3d.state.controllers.RotateController")],J$);const wq=P(),Q0e=P();let xq=class extends an{constructor(e,i,r,n){super(!0),this._view=e,this.pointerAction=i,this._pivot=r,this.registerIncoming("drag",n,s=>this._handleDrag(s))}_handleDrag(e){const i=e.data;if(i.pointers.size>1||!Koe(e.data,this.pointerAction))return;const r=Sn(i.center.x,i.center.y);switch(i.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new J$({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController&&this._cameraController.update(r);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}},gte=class extends Gg{constructor(){super(...arguments),this._pickPoint=P(),this._tmpP0=Fe(),this._panAxisAngle=f7(),this._tmpRayDir=P(),this._tmpRayDirPick=P(),this._targetOnSphere=P(),this._navMode=Uo.Horizontal,this._tmpRay={origin:P(),direction:P()},this.dragBeginPoint=Sn(),this._normalizedAnchorPoint=Fe(),this._constraintOptions={selection:Zr.ALL_EXCEPT_COLLISION,interactionType:fi.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Ho.TUMBLE},this._sphere=Is(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;io(this.dragBeginPoint,e),BS(this.startCamera,e,this._normalizedAnchorPoint);const i=sr(this.view.spatialReference),r=yFe(this._intersectionHelper,this.startCamera,e,i,KM.Ellipsoid,this.view.map.ground.opacity===0?K2:{});if(this._navMode=g7(this.startCamera,e,i),this._navMode===Uo.Horizontal)this._hasPickPoint=!!r.scenePickPoint,this._pickPoint=Nt(r.scenePickPoint,this._pickPoint),this._sphere=r.sphere;else{let n;BO(this.startCamera,e,this._tmpRay),we(this._tmpRay.direction,this._tmpRay.direction),v(r.scenePickPoint)&&(ge(this._tmpRayDirPick,this.startCamera.eye,r.scenePickPoint),n=Pe(this._tmpRayDirPick));const s=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,e_e);let o=_e(Math.min(cFe,1/Math.abs(be(e_e,this._tmpRay.direction)))*s,vz[0],vz[1]);const a=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,m7);o=v(a)?a:o,o=n!=null?Math.min(o,n):o,this._hasPickPoint=!0,le(this._tmpRay.direction,this._tmpRay.direction,o),me(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navMode===Uo.Horizontal){ge(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const i=Pe(this._tmpRayDir);BS(this.currentCamera,e,this._tmpP0);const r=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let n=i*2**r;const s=this.view.state.constraints.minimumPoiDistance;if(r<0&&n<s&&(n=s),Math.abs(i-n)<1e-6)return;if(this._hasPickPoint&&n<i){const o=1-(1-n/i)*(1-this._sphere[3]/Pe(this.currentCamera.center));this.currentCamera.center=le(E5,this.currentCamera.center,o)}le(this._tmpRayDir,this._tmpRayDir,-n/i),this.currentCamera.eye=me(E5,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=Hf(gy(this.dragBeginPoint,e)),hs(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(OD(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),wle(this._pickPoint,this._targetOnSphere,this._panAxisAngle),xw(this.currentCamera,this._sphere,this._panAxisAngle))}else{const i=Pe(this._tmpRay.direction);BS(this.currentCamera,e,this._tmpP0);const r=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let n=i*2**r;const s=this.view.state.constraints.minimumPoiDistance;if(r<0&&n<s&&(n=s),Math.abs(i-n)<1e-6)return;le(this._tmpRayDir,this._tmpRay.direction,1-n/i),this.currentCamera.eye=me(E5,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=me(E5,this.currentCamera.center,this._tmpRayDir)}zO(this.view,this.currentCamera),this.commitCamera()}}end(){this.active&&this.finishController()}};gte=u([$("esri.views.3d.state.controllers.global.ZoomController")],gte);const E5=P(),e_e=P();let yte=class extends Gg{constructor(){super(...arguments),this._tmpP=P(),this._tmpDir=P(),this._tmpN=P(),this._tmpP0=Fe(),this._tmpPoi=P(),this._tmpRayDir=P(),this.dragBeginPoint=Sn(),this._normalizedAnchorPoint=Fe(),this._constraintOptions={selection:Zr.ALL,interactionType:fi.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:P(),tiltMode:Ho.TUMBLE},this._plane=Ji()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;io(this.dragBeginPoint,e),BS(this.startCamera,e,this._normalizedAnchorPoint);const i=this._intersectionHelper.intersectScreenFreePointFallback(e,this._tmpP,this.view.map.ground.opacity===0?K2:{});ge(this._tmpDir,this._tmpP,this.startCamera.eye);const r=Pe(this._tmpDir);we(this._tmpDir,this._tmpDir);const n=Math.abs(this.view.camera.position.z);let s=_e(Math.min(cFe,1/Math.abs(be(HTt,this._tmpDir)))*n,vz[0],vz[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],this.view.state.camera,m7);s=v(o)?o:s,s=i?Math.min(s,r):s,le(this._tmpDir,this._tmpDir,s),me(this._tmpP,this.startCamera.eye,this._tmpDir),ge(this._tmpN,this.startCamera.eye,this.startCamera.center),we(this._tmpN,this._tmpN),this._tmpN[1]<0&&pl(this._tmpN,this._tmpN),GN(this._tmpP,this._tmpN,this._plane),this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(!this.active)return;Mxt(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||ce(this._tmpPoi,this.currentCamera.center),BS(this.currentCamera,e,this._tmpP0);let i=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);io(this._normalizedAnchorPoint,this._tmpP0),ge(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const r=Pe(this._tmpRayDir);let n=r*(1-i);this._constraintOptions.interactionDirection&&(ce(this._constraintOptions.interactionDirection,this._tmpRayDir),le(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(i)/r));const s=this.view.state.constraints.minimumPoiDistance;i>=0&&n<s&&(n=s,i=-(n-r)/r),Math.abs(r-n)<1e-6||(le(this._tmpRayDir,this._tmpRayDir,i),this.currentCamera.eye=me(fx,this.currentCamera.eye,this._tmpRayDir),ys(fx,this.currentCamera.center,this._tmpPoi,i),this._tmpPoi[2]>this.startCamera.center[2]?fx[2]=Math.max(this.startCamera.center[2],fx[2]):fx[2]=Math.min(this.startCamera.center[2],fx[2]),this.currentCamera.center=fx,this._constraintOptions.interactionFactor=Hf(gy(this.dragBeginPoint,e)),hs(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}end(){this.active&&this.finishController()}};yte=u([$("esri.views.3d.state.controllers.local.ZoomController")],yte);const fx=P(),HTt=Ue(0,0,1);let qTt=class extends an{constructor(e,i,r){super(!0),this._view=e,this.pointerAction=i,this.registerIncoming("drag",r,n=>this._handleDrag(n))}_handleDrag(e){const i=e.data;if(i.pointers.size>1||!Koe(e.data,this.pointerAction))return;const r=Sn(i.center.x,i.center.y);switch(i.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._view.state.isGlobal?this._cameraController=new gte({view:this._view}):this._cameraController=new yte({view:this._view}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController&&this._cameraController.update(r);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}},ES=class extends Gg{constructor(e){super(e),this._filteredSurfaceElevation=0,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new Pt,this._headingStart=0,this._constraintOptions={selection:Zr.ALL,interactionType:fi.NONE,interactionStartCamera:new Pt,interactionFactor:0,interactionDirection:null,tiltMode:Ho.LOOK_AROUND}}handleEventGamepad(e){const i=RQ(e,this.view.navigation.gamepad,this._transformation);(e.action==="end"||pU(i))&&this.finishController()}activateDirection(e){this._keysButtonState[e]=1,yge(this._keysButtonState,this._transformation)}deactivateDirection(e){this._keysButtonState[e]=0;const i=yge(this._keysButtonState,this._transformation);pU(i)&&this.finishController()}onControllerStart(e){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const i=this.view.pointsOfInterest.cameraOnSurface.location.z,r=1;this._filteredSurfaceElevation+=r*(i-this._filteredSurfaceElevation)*e}stepController(e,i){var r;this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(i),this._updateCameraCenter(),(r=this._constraintOptions.interactionStartCamera)==null||r.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,mx),this._applyDisabledMovementTypes(mx),this._applyPan(mx.pan),this._applyRotate(mx.rotate),this._applyZoom(mx.zoom),this._applyAscend(mx.ascend),this._constraintOptions.interactionType=fi.NONE,this._constraintOptions.selection=Zr.COLLISION,hs(this.view,this.currentCamera,this._constraintOptions),super.stepController(e,i)}_updateStartHeading(){this._transformation.heading!==0&&(this._headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const i=this.currentCamera;ge(hc,i.center,i.eye),Ke(hc,hc,e.matrix),i.center=me(hc,hc,i.eye),i.up=Ke(hc,i.up,e.matrix),this._constraintOptions.interactionType=fi.LOOK_AROUND,this._constraintOptions.selection=Zr.ALL_EXCEPT_COLLISION,hs(this.view,i,this._constraintOptions)}_applyPan(e,i=this.currentCamera){e.enabled&&(i.eye=Ke(hc,i.eye,e.matrix),i.center=Ke(hc,i.center,e.matrix),this.view.state.isGlobal&&(i.up=Ke(hc,i.up,e.matrix)),this._constraintOptions.interactionType=fi.PAN,this._constraintOptions.selection=Zr.ALL,hs(this.view,i,this._constraintOptions))}_applyZoom(e){if(!e)return;const i=this.currentCamera.viewForward;this.currentCamera.eye=me(hc,this.currentCamera.eye,le(Ye.get(),i,e)),ce(B3,i),pl(B3,B3),this._constraintOptions.interactionDirection=B3,this._constraintOptions.interactionType=fi.ZOOM,this._constraintOptions.selection=Zr.ALL_EXCEPT_COLLISION,hs(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const i=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,Ye.get());if(this._constraintOptions.interactionDirection=ce(B3,i),this.view.state.isGlobal){const r=Pe(this.currentCamera.eye),n=(r+e)/r;this.currentCamera.eye=le(hc,this.currentCamera.eye,n),this.currentCamera.center=le(hc,this.currentCamera.center,n)}else{const r=le(Ye.get(),i,e);this.currentCamera.eye=me(hc,this.currentCamera.eye,r),this.currentCamera.center=me(hc,this.currentCamera.center,r)}this._updateCameraCenter(),this._constraintOptions.interactionType=fi.ASCEND,this._constraintOptions.selection=Zr.COLLISION,hs(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=Zr.ALL_EXCEPT_COLLISION,hs(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(e,i,r){QTt(r);const n=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(n,i,r):this._calculateControlTransformationGlobal(n,i,r)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,i=this.view.renderCoordsHelper,r=this.currentCamera.ray;this.currentCamera.center=i.intersectManifoldClosestSilhouette(r,e,hc)}_calculateControlTransformationLocal(e,i,r){const{viewRight:n,viewForward:s}=i,o=this._transformation,a=this.view.navigation.gamepad,l=he(Ye.get(),s[0],s[1],0);we(l,l);const c=o.translation[0]*e.pan;if(c!==0){const _=le(Ye.get(),n,c);Yc(r.pan.matrix,r.pan.matrix,_),r.pan.enabled=!0}switch(a.mode){case"pan":{const _=-o.translation[1]*e.pan;if(_!==0){const b=le(Ye.get(),l,_);Yc(r.pan.matrix,r.pan.matrix,b),r.pan.enabled=!0}r.zoom=o.zoom*e.zoom;break}case"zoom":r.zoom=(-o.translation[1]+o.zoom)*e.zoom;break;default:a.mode}const h=o.translation[2]*e.ascend;r.ascend=h;const p=-o.heading*e.rotate;p!==0&&(Vu(r.rotate.matrix,r.rotate.matrix,p,this.view.renderCoordsHelper.worldUpAtPosition(i.eye,Ye.get())),r.rotate.enabled=!0);const f=o.tilt*e.rotate,m=ww(this.view.renderCoordsHelper,i.center,i.eye),g=_e(m+f,La.min,La.max)-m;g&&(Vu(r.rotate.matrix,r.rotate.matrix,g,n),r.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,i,r){const{eye:n,viewRight:s}=i,o=this._transformation,a=this.view.navigation.gamepad,l=vt(Ye.get(),s,n);we(l,l),pl(l,l),Dxt(this.startCamera,i,o,e,this.view.camera.heading,this._headingStart,this.view.camera.tilt,r,a),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(mx.pan,this._tmpCamera);const c=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,h=o.translation[2]*e.ascend;r.ascend=h;const p=-o.heading*e.rotate;p!==0&&(Vu(r.rotate.matrix,r.rotate.matrix,p,this._tmpCamera.eye),r.rotate.enabled=!0);const f=o.tilt*e.rotate,m=this._clampTiltDeltaGlobalToValidRange(f,i.ray,c);m!==0&&(Vu(r.rotate.matrix,r.rotate.matrix,m,this._tmpCamera.viewRight),r.rotate.enabled=!0),r.zoom+=o.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,i,r){const n=sr(this.view.spatialReference),s=FU(La.min,i.origin,r,n);let o=0,a=0;const l=Ye.get();if(this.view.renderCoordsHelper.intersectManifold(i,r,l)){const c=ww(this.view.renderCoordsHelper,l,i.origin);o=FU(c,i.origin,r,n),a=FU(La.max,i.origin,r,n)}else{FO(BB(jB,r+n.radius),i,l);const c=eo(-be(i.direction,we(l,l)));o=k0e(c,i.origin,r,n),a=k0e(La.max,i.origin,r,n)}return _e(o+e,s,a)-o}_getPointAbsoluteSurfaceElevation(e,i,r){const{renderCoordsHelper:n}=this.view,s=n.getAltitude(e),o=i+Math.abs(s-i);return n.setAltitude(r,o,e),o}_clampedDistanceToSurface(e,i){const{renderCoordsHelper:r}=this.view,{camera:n}=this.view.state,{direction:s}=dTt(this.view,i,0,ZFe,KTt),o=r.intersectManifoldClosestSilhouette(cd(i,s),e,Ye.get()),a=Lr(i,o),l=r.intersectManifoldClosestSilhouette(cd(i,V_(Ye.get(),i,n.center)),e,Ye.get()),c=Lr(i,l);return Math.min(a,c)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:i,state:r}=this.view,{camera:n,isGlobal:s}=r,o=i.intersectManifoldClosestSilhouette(n.ray,this._filteredSurfaceElevation,Ye.get());if(s){const a=ge(Ye.get(),e,o),l=Pe(a);le(a,a,1/l);const c=we(Ye.get(),e),h=eo(be(c,a));return l*Math.sin(Math.min(XTt,h))}{const a=ce(Ye.get(),e);return i.setAltitude(a,this._filteredSurfaceElevation),Lr(o,a)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:YTt}_computeVelocities(e){const i=this._filteredSurfaceElevation,r=i+sr(this.view.spatialReference).radius,{camera:n,isGlobal:s}=this.view.state,o=Ye.get(),a=this._getPointAbsoluteSurfaceElevation(n.eye,i,o),l=this._clampedDistanceToSurface(i,o),c=n.width/2,h=t_e*n.width,p=t_e*n.width,f=l*Math.tan(.5*n.fovX)/c,m=f/r,g=f/this._computeHeadingRotateRadius(o),_=a-i;return{pan:(s?m:f)*h*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(h*e/c)*_-_),zoom:2**(h*e/c)*l-l,rotate:_e(g*p,ZTt,JTt)*e}}_applyDisabledMovementTypes(e){!v(this.disableMovements)||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&Lp(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&Lp(e.rotate.matrix))}static activatesFor(e,i){const r=RQ(i,e.navigation.gamepad,WTt);return!(i.action==="end"||pU(r))}};u([d({constructOnly:!0})],ES.prototype,"gamepadDevice",void 0),u([d({constructOnly:!0})],ES.prototype,"disableMovements",void 0),ES=u([$("esri.views.3d.state.controllers.GamepadKeyboardController")],ES);const WTt={translation:[0,0,0],heading:0,tilt:0,zoom:0},ZFe=80,XTt=Xt(ZFe),t_e=.75,YTt=5,ZTt=Xt(30),JTt=Xt(80),mx={zoom:0,ascend:0,pan:{enabled:!1,matrix:$e()},rotate:{enabled:!1,matrix:$e()}},hc=P(),B3=P(),KTt=Ale();function QTt(t){t.zoom=0,t.ascend=0,t.pan.enabled=!1,Lp(t.pan.matrix),t.rotate.enabled=!1,Lp(t.rotate.matrix)}let eSt=class extends an{constructor(e){super(!0),this._view=e,this._watchHandles=new Xi,this._handle=this.registerIncoming("gamepad",i=>this._handleEventGamepad(i)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([ne(()=>this._view.navigation.gamepad.enabled,i=>{i?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},zt),ne(()=>this._view.navigation.gamepad.device,i=>{this._cameraControllerGamepad&&i&&this._cameraControllerGamepad.gamepadDevice!==i&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(e){const i=this._view.navigation.gamepad.device;if(i&&e.data.device!==i)return;const r=this._cameraControllerGamepad&&this._cameraControllerGamepad.active;if(r||ES.activatesFor(this._view,e.data)){if(!r){const n=new ES({view:this._view,gamepadDevice:e.data.device});this._view.state.switchCameraController(n)&&(this._cameraControllerGamepad=n)}this._cameraControllerGamepad&&this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===e.data.device&&this._cameraControllerGamepad.handleEventGamepad(e.data)}}};var Eu;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.FORWARD=2]="FORWARD",t[t.BACKWARD=3]="BACKWARD",t[t.UP=4]="UP",t[t.DOWN=5]="DOWN",t[t.HEADINGLEFT=6]="HEADINGLEFT",t[t.HEADINGRIGHT=7]="HEADINGRIGHT",t[t.TILTUP=8]="TILTUP",t[t.TILTDOWN=9]="TILTDOWN",t[t.ZOOMIN=10]="ZOOMIN",t[t.ZOOMOUT=11]="ZOOMOUT"})(Eu||(Eu={}));let tSt=class extends an{constructor(e,i){super(!0),this._view=e,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:qe.Local},this._keyToNumber={[i.left]:Eu.LEFT,[i.right]:Eu.RIGHT,[i.forward]:Eu.FORWARD,[i.backward]:Eu.BACKWARD,[i.up]:Eu.UP,[i.down]:Eu.DOWN,[i.headingLeft]:Eu.HEADINGLEFT,[i.headingRight]:Eu.HEADINGRIGHT,[i.tiltUp]:Eu.TILTUP,[i.tiltDown]:Eu.TILTDOWN,[i.zoomIn]:Eu.ZOOMIN,[i.zoomOut]:Eu.ZOOMOUT},this.registerIncoming("key-down",null,r=>this._handleKeyDown(r)),this.registerIncoming("key-up",null,r=>this._handleKeyUp(r)),this.registerIncoming("blur",null,()=>this._handleBlur())}_handleKeyDown(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const i=this._keyToNumber[e.data.key];i!=null&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||(this._cameraControllerKeyboard=new ES({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(i),e.stopPropagation()))}_handleBlur(){this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const i=this._keyToNumber[e.data.key];i!=null&&this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.deactivateDirection(i),e.stopPropagation())}},iSt=class extends an{constructor(e,i){super(!0),this._view=e,this.registerIncoming("mouse-wheel",i,r=>this._handleMouseWheel(r))}_handleMouseWheel(e){if(!this._view.navigation.mouseWheelZoomEnabled)return;const i=e.data;this._cameraController&&this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new Tz({view:this._view,mode:"interaction"}):new Sz({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._cameraController)),this._cameraController.zoomStep(-1/60*i.deltaY,Sn(i.x,i.y)),e.preventDefault(),e.stopPropagation()}},Pz=class{constructor(e){this._gain=e}reset(e){this._value=e}set gain(e){this._gain=e}get value(){return this._value===void 0?0:this._value}update(e){this._value===void 0?this._value=e:this._value=this._gain*e+(1-this._gain)*this._value}},R2=class extends RD{constructor(){super(...arguments),this._beginCamera=new Pt,this._elapsedTimeSec=0,this.constraintOptions={selection:Zr.ALL,interactionType:fi.PAN,interactionFactor:0,interactionStartCamera:new Pt,interactionDirection:null,tiltMode:Ho.TUMBLE}}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new P_}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(e){this._beginCamera.copyFrom(e),this.constraintOptions.interactionStartCamera=this._beginCamera,super.onControllerStart(e)}stepController(e,i){i.copyViewFrom(this._beginCamera),this._elapsedTimeSec+=e,this.momentumStep(this._elapsedTimeSec,i),hs(this.view,i,this.constraintOptions)}};R2=u([$("esri.views.3d.state.controllers.momentum.MomentumController")],R2);let K$=class extends R2{constructor(e){super(e),this.interactionType=fi.PAN,this._tmpPan=P()}momentumStep(e,i){const r=this.momentum.value(e);le(this._tmpPan,this.momentum.direction,r),i.eye=ge(i_e,i.eye,this._tmpPan),i.center=ge(i_e,i.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};u([d({constructOnly:!0})],K$.prototype,"momentum",void 0),K$=u([$("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],K$);const i_e=P(),rSt=P(),C5=P();let UU=class extends R2{constructor(e){super(e),this.interactionType=fi.PAN}momentumStep(e,i){const r=this.momentum.value1(e),n=this.momentum.value2(e);ce(C5,i.eye),we(C5,C5),vt(this.momentum.axis2,C5,this.momentum.axis1),wFe(i,rSt,this.momentum.axis1,r,this.momentum.axis2,n)}};u([d({constructOnly:!0})],UU.prototype,"momentum",void 0),UU=u([$("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],UU);let sS=class extends R2{set center(e){this._set("center",In(e))}set axis(e){this._set("axis",In(e))}constructor(e){super(e),this.interactionType=fi.TUMBLE}momentumStep(e,i){const r=this.momentum.value(e);xw(i,this.center,MD(this.axis,r))}};u([d({constructOnly:!0})],sS.prototype,"momentum",void 0),u([d({constructOnly:!0})],sS.prototype,"center",null),u([d({constructOnly:!0})],sS.prototype,"axis",null),sS=u([$("esri.views.3d.state.controllers.momentum.MomentumController")],sS);let hR=class extends R2{set zoomCenter(e){this._set("zoomCenter",In(e))}constructor(e){super(e),this.interactionType=fi.ZOOM,this.constraintOptions.interactionDirection=P()}momentumStep(e,i){const{interactionDirection:r}=this.constraintOptions;if(!r)return;ce(r,i.eye);const n=this.momentum.valueDelta(0,e);Sle(i,this.zoomCenter,n,this.view.state.constraints.minimumPoiDistance),V_(r,i.eye,r)}};u([d({constructOnly:!0})],hR.prototype,"momentum",void 0),u([d({constructOnly:!0})],hR.prototype,"zoomCenter",null),hR=u([$("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],hR);let IT=class extends R2{set screenCenter(e){this._set("screenCenter",Sn(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",In(e))}constructor(e){super(e),this.interactionType=fi.ZOOM,this.radius=0,this._tmpSceneCenter=P(),this._tmpZoomAxisAngle=f7(),this._sphere=Is()}initialize(){this._sphere[3]=this.radius}momentumStep(e,i){const r=this.momentum.valueDelta(0,e);mFe(this._sphere,i,r),this.constraintOptions.interactionType=fi.ZOOM,hs(this.view,i,this.constraintOptions),OD(this._sphere,i,this.screenCenter,this._tmpSceneCenter),wle(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),xw(i,this._sphere,this._tmpZoomAxisAngle),this.constraintOptions.interactionType=fi.PAN}};u([d({constructOnly:!0})],IT.prototype,"momentum",void 0),u([d({constructOnly:!0})],IT.prototype,"screenCenter",null),u([d({constructOnly:!0})],IT.prototype,"sceneCenter",null),u([d({constructOnly:!0})],IT.prototype,"radius",void 0),IT=u([$("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],IT);let qf=class{constructor(e){this._gain=e,this.lastValue=void 0,this.filteredDelta=void 0}update(e){if(this.hasLastValue()){const i=this.computeDelta(e);this._updateDelta(i)}this.lastValue=e}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return this.lastValue!==void 0}hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(e){return this.lastValue===void 0?NaN:e-this.lastValue}_updateDelta(e){this.filteredDelta!==void 0?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*e:this.filteredDelta=e}},v7=class{constructor(e,i,r){this._initialVelocity=e,this._stopVelocity=i,this._friction=r,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(e){return e>this.duration}get friction(){return this._friction}value(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}valueDelta(e,i){const r=this.value(e);return this.value(e+i)-r}valueFromInitialVelocity(e,i){i=Math.min(i,this.duration);const r=1-this.friction;return e*(r**i-1)/Math.log(r)}},nSt=class extends v7{constructor(e,i,r,n,s){super(e,i,r),this._sceneVelocity=n,this.direction=s}value(e){return super.valueFromInitialVelocity(this._sceneVelocity,e)}},JFe=class{constructor(e=300,i=12,r=.84){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this.enabled=!0,this._time=new qf(.6),this._screen=[new qf(.4),new qf(.4)],this._scene=[new qf(.6),new qf(.6),new qf(.6)],this._tmpDirection=P()}add(e,i,r){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(r)<.015)return;this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._scene[0].update(i[0]),this._scene[1].update(i[1]),this._scene[2].update(i[2]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,i=this._screen[1].filteredDelta,r=e==null||i==null?0:Math.sqrt(e*e+i*i),n=this._time.filteredDelta,s=n==null||r==null?0:r/n;return Math.abs(s)<this._minimumInitialVelocity?null:this.createMomentum(s,this._stopVelocity,this._friction)}createMomentum(e,i,r){he(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const n=Pe(this._tmpDirection);n>0&&le(this._tmpDirection,this._tmpDirection,1/n);const s=this._time.filteredDelta;return new nSt(e,i,r,s==null?0:n/s,this._tmpDirection)}},r_e=class{constructor(e){this._gain=e}update(e){this.filteredValue!==void 0?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*e:this.filteredValue=e}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}};const n_e=1e-5;let sSt=class extends v7{constructor(e,i,r,n,s,o=0,a){super(e,i,r),this._angularVelocity1=n,this.axis1=s,this.angularVelocity2=o,this.axis2=a}value1(e){return super.valueFromInitialVelocity(this._angularVelocity1,e)}value2(e){return super.valueFromInitialVelocity(this.angularVelocity2,e)}},oSt=class{constructor(e=300,i=12,r=.84){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this.enabled=!0,this._tmpAxis1=P(),this._tmpAxis2=P(),this._tmpAngles=Fe(),this._time=new qf(.3),this._screen=[new qf(.4),new qf(.4)],this._angle1=new r_e(.6),this._angle2=new r_e(.6),this._axis1=P(),this._axis2=P(),this._lastScene=P()}addMomentumDirectRotation(e,i,r,n,s,o){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;let a=vFe(this._lastScene,i,this._tmpAxis2,n,s,o);this._angle2.update(0),al(this._tmpAxis2)<n_e?a=0:we(this._axis1,this._tmpAxis2),this._angle1.update(a),ce(this._lastScene,i)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(r)}}addMomentumPreserveHeading(e,i,r,n,s,o,a){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;bFe(this._lastScene,i,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,n,s,o,a,!1),al(this._tmpAxis2)<n_e?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),we(this._axis1,this._tmpAxis1),we(this._axis2,this._tmpAxis2)),ce(this._lastScene,i)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,i=this._screen[1].filteredDelta,r=e==null||i==null?null:Math.sqrt(e*e+i*i),n=this._time.filteredDelta,s=r==null||n==null?0:r/n;return Math.abs(s)<this._minimumInitialVelocity?null:this.createMomentum(s,this._stopVelocity,this._friction)}createMomentum(e,i,r){const n=this._time.filteredDelta,s=this._angle1.filteredValue,o=this._angle2.filteredValue,a=n==null||o==null?0:o/n;return new sSt(e,i,r,n==null||s==null?0:s/n,this._axis1,a,this._axis2)}},KFe=class{constructor(e=2.5,i=.01,r=.95,n=12){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this._maxVelocity=n,this.enabled=!0,this.value=new qf(.8),this.time=new qf(.3)}add(e,i){if(this.enabled&&i!=null){if(this.time.hasLastValue()){if(this.time.computeDelta(i)<.01)return;if(this.value.hasFilteredDelta()){const r=this.value.computeDelta(e);this.value.filteredDelta*r<0&&this.value.reset()}}this.time.update(i),this.value.update(e)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=_e(e,-this._maxVelocity,this._maxVelocity),Math.abs(e)<this._minimumInitialVelocity?null:this.createMomentum(e,this._stopVelocity,this._friction)}createMomentum(e,i,r){return new v7(e,i,r)}},QFe=class extends KFe{constructor(e=3,i=.01,r=.95,n=12){super(e,i,r,n)}add(e,i){const r=this.value.lastValue;if(r!=null){let n=e-r;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;e=r+n}super.add(e,i)}},aSt=class extends v7{constructor(e,i,r){super(e,i,r)}value(e){const i=super.value(e);return Math.exp(i)}valueDelta(e,i){const r=super.value(e),n=super.value(e+i)-r;return Math.exp(n)}},e4e=class extends KFe{constructor(e=2.5,i=.01,r=.95,n=12){super(e,i,r,n)}add(e,i){super.add(Math.log(e),i)}createMomentum(e,i,r){return new aSt(e,i,r)}},_te=class extends Gg{constructor(){super(...arguments),this._smoothRotation=new Pz(.05),this._rotationAxis=P(),this._beginAngle=0,this._beginHeading=0,this._panningPlane=Ji(),this._beginRadius=0,this._smoothScaling=new Pz(.05),this._zoomCenterScreen=Sn(),this._zoomMomentumEstimator=new e4e,this._rotationMomentumEstimator=new QFe,this._panSphericalMomentumEstimator=new oSt,this._panPlanarMomentumEstimator=new JFe,this._adjustedSphere=Is(),this._tmp3d=P(),this._tmpScreenPointArray=Sn(),this._beginScreenPoint=Sn(),this._beginScenePoint=P(),this._screenPickPoint=Sn(),this._scenePickPoint=P(),this._mode=Uo.Horizontal,this._sphere=Is(),this._pointerCount=0,this._tmpInteractionDirection=P(),this._constraintOptions={selection:Zr.ALL,interactionType:fi.NONE,interactionFactor:0,interactionStartCamera:new Pt,interactionDirection:null,tiltMode:Ho.TUMBLE}}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){var s;if(!this.active)return;const i=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=i,this._rotationMomentumEstimator.enabled=i,this._panPlanarMomentumEstimator.enabled=i,this._panSphericalMomentumEstimator.enabled=i,this._beginHeading=-sw.normalize(Xt(this.view.camera.heading)),this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._smoothRotation.reset(),Dg(e.center,this._screenPickPoint),io(this._beginScreenPoint,this._screenPickPoint);const r=sr(this.view.spatialReference),n=yFe(this._intersectionHelper,this.startCamera,this._screenPickPoint,r,KM.Silhouette,this.view.map.ground.opacity===0?K2:{});R(n.scenePickPoint)||(this._scenePickPoint=n.scenePickPoint,this._sphere=n.sphere,ce(this._beginScenePoint,this._scenePickPoint),this._mode=g7(this.startCamera,this._screenPickPoint,r),this._mode===Uo.Vertical&&this._preparePlanarPanMode(e,n.hasGeometryIntersection),(s=this._constraintOptions.interactionStartCamera)==null||s.copyFrom(this.startCamera))}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const i=e.pointers.size>1;this._mode===Uo.Horizontal?(i&&this._zoomSpherical(e),this._panningSpherical(e),i&&this._rotateSpherical(e)):(i&&this._zoomPlanar(e),this._panningPlanar(e),i&&this._rotatePlanar(e)),this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const i=this._zoomMomentumEstimator.evaluateMomentum();if(i)return this._mode===Uo.Horizontal?new IT({view:this.view,momentum:i,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new hR({view:this.view,momentum:i,zoomCenter:this._beginScenePoint});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new sS({view:this.view,momentum:r,center:this._sphere,axis:this._rotationAxis});if(this._mode===Uo.Horizontal){const n=this._panSphericalMomentumEstimator.evaluateMomentum();if(n)return new UU({view:this.view,momentum:n})}else{const n=this._panPlanarMomentumEstimator.evaluateMomentum();if(n)return new K$({view:this.view,momentum:n})}return null}_preparePlanarPanMode(e,i){const r=pl(this._tmp3d,this.startCamera.viewForward);GN(this._scenePickPoint,r,this._panningPlane);const n=Sn(this._screenPickPoint[0],0),s=P(),o=Pe(this.startCamera.eye);this._adjustedSphere[3]=o<this._sphere[3]?o-100:this._sphere[3],OD(this._adjustedSphere,this.startCamera,n,s);const a=ka();this.startCamera.projectToRenderScreen(s,a);const l=P(),c=P(),h=P();ge(l,this._scenePickPoint,this.currentCamera.eye);const p=Pe(l);we(l,l);const f=pFe*Math.max(Math.abs(this.view.camera.position.z),fFe),m=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,m7);let g=v(m)?m:f;g=i?Math.min(g,p):g,ce(h,me(c,this.currentCamera.eye,le(c,l,g))),this._panningPlane[3]=-be(this._panningPlane,h),this.startCamera.center=me(c,this.startCamera.eye,le(c,this.startCamera.viewForward,g));const _=Dg(e.center,this._tmpScreenPointArray);dte(this._panningPlane,this.startCamera,_,this._beginScenePoint)}_zoomSpherical(e){const i=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(i),mFe(this._sphere,this.currentCamera,this._smoothScaling.value),Dg(e.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),this._constraintOptions.interactionType=fi.ZOOM,this._constraintOptions.interactionFactor=Hf(e.radius-this._beginRadius),hs(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(e){const i=Dg(e.center,this._tmpScreenPointArray);OD(this._sphere,this.currentCamera,i,this._tmp3d),Ele(this._beginScenePoint,be(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(TFe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(i,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(xFe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(i,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=fi.PAN,this._constraintOptions.interactionFactor=Hf(gy(this._screenPickPoint,i)),hs(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(e){we(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||pl(this._rotationAxis,this._rotationAxis);const i=this._smoothRotation.value,r=i+hte(e.angle-i),n=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=n,this._smoothRotation.update(r);const s=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(s,.001*e.timestamp),xw(this.currentCamera,this._sphere,MD(this._rotationAxis,s)),this._constraintOptions.interactionType=fi.TUMBLE,this._constraintOptions.interactionFactor=Hf(e.radius*r),hs(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(e){const i=Dg(e.center,this._tmpScreenPointArray);dte(this._panningPlane,this.currentCamera,i,this._tmp3d)&&(_Fe(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(i,this._tmp3d,.001*e.timestamp),this._constraintOptions.interactionType=fi.PAN,this._constraintOptions.interactionFactor=Hf(gy(this._beginScreenPoint,i)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),hs(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(e){const i=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(i),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),Sle(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=fi.ZOOM,this._constraintOptions.interactionFactor=Hf(e.radius-this._beginRadius),hs(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(e){ce(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||pl(this._rotationAxis,this._rotationAxis);const i=this._smoothRotation.value;let r=e.angle-i;r=hte(r);const n=i+r,s=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=s,this._smoothRotation.update(n);const o=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(o,.001*e.timestamp),xw(this.currentCamera,this._sphere,MD(this._rotationAxis,o)),this._constraintOptions.interactionType=fi.TUMBLE,this._constraintOptions.interactionFactor=Hf(e.radius*o),hs(this.view,this.currentCamera,this._constraintOptions)}};_te=u([$("esri.views.3d.state.controllers.global.PinchAndPanController")],_te);const s_e=Ue(0,0,1),lSt={ELEVATION_THRESHOLD:3e4,ANGLE_THRESHOLD:16/180*Math.PI};let vte=class extends Gg{constructor(){super(...arguments),this._rotationValueSmooth=new Pz(.05),this._scalingValueSmooth=new Pz(.05),this._planeHorizontal=Ji(),this._planeVertical=Ji(),this._rotationMomentumEstimator=new QFe,this._panMomentumEstimator=new JFe(300,12,.9),this._zoomMomentumEstimator=new e4e,this._beginRadius=0,this._beginCenter=P(),this._beginAngle=0,this._tmpPoints=[],this._panMode=Uo.Horizontal,this._beginCenterScreen=Sn(),this._tmpCentroid3d=P(),this._tmpCentroid2d=Sn(),this._tmp2d=Sn(),this._pointerCount=0,this._constraintOptions={selection:Zr.ALL,interactionType:fi.NONE,interactionFactor:0,interactionStartCamera:new Pt,interactionDirection:null,tiltMode:Ho.TUMBLE}}begin(e){var g;if(!this.active)return;const i=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=i,this._rotationMomentumEstimator.enabled=i,this._panMomentumEstimator.enabled=i,this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),Dg(e.center,this._beginCenterScreen),FLe(s_e,0,this._planeHorizontal);const r=P(),n=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,r,this.view.map.ground.opacity===0?K2:{}),s=P();pl(s,this.startCamera.viewForward);const o=P();ce(o,s_e);const a=be(s,o),l=Pp(a<0?-a:a);this._panMode=l>=lSt.ANGLE_THRESHOLD?Uo.Horizontal:Uo.Vertical;const c=Math.min(pFe,1/Math.abs(be(o,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),fFe);GQ(this._planeHorizontal,this._planeHorizontal,r),this.startCamera.aboveGround||HQ(this._planeHorizontal,this._planeHorizontal);const h=P(),p=P(),f=P();ge(h,r,this.currentCamera.eye);const m=Pe(h);if(we(h,h),this._panMode===Uo.Vertical){le(o,o,a),ge(this._planeVertical,s,o),we(this._planeVertical,this._planeVertical),GQ(this._planeVertical,this._planeVertical,r);const _=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,m7);let b=v(_)?_:c;b=n?Math.min(b,m):b,ce(f,me(p,this.currentCamera.eye,le(p,h,b))),this._planeVertical[3]=-be(this._planeVertical,f),this._computePlanePoints(e.pointers,this._planeVertical,this.startCamera,this._tmpPoints),dq(this._tmpPoints,this._beginCenter)}else{const _=n?m:c;ce(f,me(p,this.currentCamera.eye,le(p,h,_))),this._planeHorizontal[3]=-be(this._planeHorizontal,f),this._computePlanePoints(e.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),dq(this._tmpPoints,this._beginCenter)}(g=this._constraintOptions.interactionStartCamera)==null||g.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const i=e.pointers.size>1,r=this._panMode===Uo.Horizontal?this._planeHorizontal:this._planeVertical,n=this._beginCenter;if(i){const s=this._beginRadius/e.radius,o=.001875*Math.min(Math.max(e.radius,40),120);this._scalingValueSmooth.gain=o,this._scalingValueSmooth.update(s),Sle(this.currentCamera,n,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*e.timestamp),this._constraintOptions.interactionType=fi.ZOOM,this._constraintOptions.interactionFactor=Hf(Math.abs(e.radius-this._beginRadius)),hs(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(e.pointers,r,this.currentCamera,this._tmpPoints),dq(this._tmpPoints,this._tmpCentroid3d),Dg(e.center,this._tmpCentroid2d),_Fe(this.currentCamera,n,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*e.timestamp),this._constraintOptions.interactionType=fi.PAN,this._constraintOptions.interactionFactor=Hf(gy(this._beginCenterScreen,this._tmpCentroid2d)),hs(this.view,this.currentCamera,this._constraintOptions),i){const s=this._planeHorizontal,o=n,a=this._rotationValueSmooth.value,l=a+hte(e.angle-a),c=.00125*Math.min(Math.max(e.radius,40),120);this._rotationValueSmooth.gain=c,this._rotationValueSmooth.update(l);const h=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(h,.001*e.timestamp),xw(this.currentCamera,o,MD(s,h)),this._constraintOptions.interactionType=fi.TUMBLE,this._constraintOptions.interactionFactor=Hf(Math.abs(e.radius*h)),hs(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const i=this._zoomMomentumEstimator.evaluateMomentum();if(i)return new hR({view:this.view,momentum:i,zoomCenter:this._beginCenter});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new sS({view:this.view,momentum:r,center:this._beginCenter,axis:this._planeHorizontal});const n=this._panMomentumEstimator.evaluateMomentum();return n?new K$({view:this.view,momentum:n}):null}_computePlanePoints(e,i,r,n){n.length=e.size;const s=this._tmp2d;let o=0;return e.forEach(a=>{s[0]=a.x,s[1]=a.y,n[o]===void 0&&(n[o]=P()),dte(i,r,s,n[o]),o+=1}),n}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};vte=u([$("esri.views.3d.state.controllers.local.PinchAndPanController")],vte);let o_e=class extends an{constructor(e,i,r){super(!0),this._view=e,this.pointerAction=i,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",r,n=>this._handleDrag(n))}_handleDrag(e){if(e.data.pointerType==="mouse"&&!Koe(e.data,this.pointerAction))return;const i=e.timestamp-this._lastEndTimestamp,r=40,n=this._momentum&&this._momentum.active&&i<r;switch(e.data.action){case"start":case"update":if(n)break;this._controller&&this._controller.active?e.data.timestamp-this._lastTimestamp>2&&(this._controller.update(e.data),this._lastTimestamp=e.timestamp):this._startController(e);break;case"end":case"removed":this._endController(e,!0);break;case"added":this._endController(e,!1),this._startController(e)}e.stopPropagation()}_endController(e,i){if(this._controller&&this._controller.active){this._lastEndTimestamp=e.timestamp;const r=this._controller.end(e.data);i&&r&&(this._momentum=r,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(e){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(e.data),this._lastTimestamp=e.timestamp}_createController(){return this._view.state.isGlobal?new _te({view:this._view}):new vte({view:this._view})}},cSt=class extends an{constructor(e,i){super(!0),this.view=e,this.registerIncoming("pointer-down",i,()=>this.view.state.stopActiveCameraController())}},t4e=class extends an{constructor(e,i){super(!0),this.key=e,this.registerIncoming("key-down",i,r=>this._handleKeyDown(r))}_handleKeyDown(e){e.data.key===this.key&&(this.activate(),e.stopPropagation())}},uSt=class extends t4e{constructor(e,i,r){super(i,r),this.view=e}activate(){this.view.goTo({heading:0}).catch(()=>{})}},hSt=class extends t4e{constructor(e,i,r){super(i,r),this.view=e}activate(){this.view.goTo({tilt:0}).catch(()=>{})}},dSt=class extends an{constructor(e,i=!1){super(!0),this._view=e,this._invert=i,this.registerIncoming("vertical-two-finger-drag",r=>this._handleTwoFinger(r))}_handleTwoFinger(e){var n,s,o;const i=this._invert?-1:1,r=Sn(0,e.data.delta*i);switch(e.data.action){case"begin":(n=this._cameraController)==null||n.end(),this._cameraController=new J$({view:this._view,pivot:Ou.CENTER}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":(s=this._cameraController)==null||s.update(r);break;case"end":(o=this._cameraController)==null||o.end(),this._cameraController=null}}},pSt=class extends an{constructor(e=20,i=40){super(!1),this._threshold=e,this._maxDelta=i,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new jN({start:(r,n)=>this._observeStart(r,n),update:(r,n,s)=>this._observeUpdate(r,n,s),end:(r,n)=>this._observeEnd(n)}),this.registerIncoming("drag",r=>this._dragEventSeparator.handle(r))}get failed(){return this._state==="failed"}_observeStart(e,i){e===1&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),i.stopPropagation()),this._state=e===2?"ready":"failed"}_observeUpdate(e,i,r){if(this._state!=="failed"&&e===2)return this._state==="active"?(this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void i.stopPropagation()):void(this._checkMovementWithinLimits(i.data,r.data)?this._checkVerticalThresholdReached(i.data,r.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=i.data.center,this._artificalDrag.emit({action:"end",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),i.stopPropagation()):this._state="failed")}_observeEnd(e){this._state==="active"&&(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",e.stopPropagation())}_checkMovementWithinLimits(e,i){let r=-1/0,n=1/0,s=-1/0,o=1/0;for(const{x:_,y:b}of i.pointers.values())r=Math.max(r,_),n=Math.min(n,_),s=Math.max(s,b),o=Math.min(o,b);let a=-1/0,l=1/0,c=-1/0,h=1/0;for(const{x:_,y:b}of e.pointers.values())a=Math.max(a,_),l=Math.min(l,_),c=Math.max(c,b),h=Math.min(h,b);const p=r-n,f=s-o,m=a-l,g=c-h;return Math.abs(e.center.x-i.center.x)<this._threshold&&Math.abs(m-p)<=this._maxDelta&&Math.abs(g-f)<=this._maxDelta}_checkVerticalThresholdReached(e,i){let r=Math.abs(e.center.y-i.center.y);return e.pointers.forEach((n,s)=>{const o=i.pointers.get(s);r=Math.min(r,Math.abs(n.y-o.y))}),r>=this._threshold}},Tf=class extends ve{constructor(){super(...arguments),this._handles=new Xi}destroy(){this._handles=Ve(this._handles),this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get hasPendingInputs(){var e;return!!((e=this._inputManager)!=null&&e.hasPendingInputs)}get latestPointerType(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerType}get latestPointerLocation(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerLocation}get multiTouchActive(){var e;return((e=this._inputManager)==null?void 0:e.multiTouchActive)??!1}disconnect(){this.view.viewEvents.disconnect(),this._inputManager=Ve(this._inputManager)}connect(){const e=this.view;this._source=new Qoe(this.view.surface,e.input);const i=[new S$e,new E$e,new w$e,new x$e(this.view.navigation),new pSt],r=new Of({eventSource:this._source,recognizers:i});this._inputManager=r,r.installHandlers("prevent-context-menu",[new b$e],ey.INTERNAL),this._modeDragPan=new o_e(e,"primary"),this._modeDragRotate=new xq(e,"secondary",Ou.CENTER),this._modeDragZoom=new qTt(e,"tertiary");const n={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};r.installHandlers("navigation",[new cSt(e),new zxt(e),new eSt(e),new tSt(e,n.pan),new iSt(e),new hSt(e,n.resetTilt),new uSt(e,n.resetHeading),new xq(e,"primary",Ou.EYE,[n.lookAround]),new xq(e,"secondary",Ou.CENTER,[n.lookAround]),new o_e(e,"tertiary",[n.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new dSt(e)],ey.INTERNAL),this.view.viewEvents.connect(r),this._updateMode(),this._handles.add(ne(()=>{var s;return(s=this.view.navigation)==null?void 0:s.browserTouchPanEnabled},s=>{this._source.browserTouchPanningEnabled=!s},zt))}_updateMode(){var n;const e=this.mode,i=this.primaryDragAction,r=(n=bte.get(e))==null?void 0:n.get(i);r&&(this._modeDragPan&&(this._modeDragPan.pointerAction=r.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=r.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=r.zoom))}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};u([d()],Tf.prototype,"view",void 0),u([d({value:"pan"})],Tf.prototype,"primaryDragAction",null),u([d({value:"default"})],Tf.prototype,"mode",null),u([d({readOnly:!0})],Tf.prototype,"hasPendingInputs",null),u([d()],Tf.prototype,"latestPointerType",null),u([d()],Tf.prototype,"latestPointerLocation",null),u([d()],Tf.prototype,"multiTouchActive",null),u([d()],Tf.prototype,"_inputManager",void 0),Tf=u([$("esri.views.3d.input.SceneInputManager")],Tf);const bte=new Map,Tq=new Map,Sq=new Map;Tq.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),Tq.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),Sq.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),Sq.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),bte.set("default",Tq),bte.set("pro",Sq);const fSt=Tf;let Uh,YR,wte=!1,xte=!1,Tte=!1,Ste=!1,Q$=null;function mSt(t,e){if(!xte||!YR)return;i4e();const i=YR;let r=0;for(let n=0;n<t.accBinsNumX;n++)for(let s=0;s<t.accBinsNumY;s++){const o=t.accBins[n][t.accBinsNumY-1-s];r+=o.length;const a=n*t.accBinsSizeX,l=(n+1)*t.accBinsSizeX,c=s*t.accBinsSizeY,h=(s+1)*t.accBinsSizeY;i.fillText(o.length.toFixed(),a+5,c+15),r4e(a,l,c,h,"blue")}i.fillText("total totalShownLabels: "+r,70,40),i.fillText("total visible labels: "+e.size,70,50),i.fillText("total numTests: "+t.accNumTests,70,30)}function gSt(t){Tte=tr.DECONFLICTOR_SHOW_VISIBLE,Ste=tr.DECONFLICTOR_SHOW_INVISIBLE,wte=Tte||Ste,xte=tr.DECONFLICTOR_SHOW_GRID,Q$=null,wte||xte?Q$=()=>ySt(t):Uh&&(Uh.parentElement.removeChild(Uh),Uh=null)}function i4e(){Q$&&(Q$(),Q$=null)}function ySt(t){Uh==null&&(Uh=document.createElement("canvas"),Uh.setAttribute("id","canvas2d"),t.surface.parentElement.style.position="relative",t.surface.parentElement.appendChild(Uh));const{state:e}=t,{camera:i,pixelRatio:r}=e,{width:n,height:s}=i,o=n*r,a=s*r;Uh.setAttribute("width",`${o}px`),Uh.setAttribute("height",`${a}px`),Uh.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${n}px;height:${s}px`),YR=Uh.getContext("2d"),YR.clearRect(0,0,n,s),YR.font="12px Arial"}function r4e(t,e,i,r,n){i4e();const s=Uh.height,o=YR;o.beginPath(),o.lineWidth=1,o.strokeStyle=n,o.moveTo(t,s-i),o.lineTo(e,s-i),o.stroke(),o.lineTo(e,s-r),o.stroke(),o.lineTo(e,s-i),o.stroke(),o.lineTo(t,s-i),o.stroke(),o.lineTo(t,s-i),o.stroke(),o.closePath()}function _St(t,e){wte&&(e&&Tte||!e&&Ste)&&r4e(t.aabr[0],t.aabr[2],t.aabr[1],t.aabr[3],e?"green":"red")}var ha,Fu;(function(t){t[t.GRAPHIC=0]="GRAPHIC",t[t.LABEL=1]="LABEL",t[t._COUNT=2]="_COUNT"})(ha||(ha={})),function(t){t[t.USER_SETTING=0]="USER_SETTING",t[t.SCALE_RANGE=1]="SCALE_RANGE",t[t.FILTER=2]="FILTER",t[t.DECONFLICTION=3]="DECONFLICTION",t[t._COUNT=4]="_COUNT"}(Fu||(Fu={}));function n4e(t,e){return new l4e(t,u4e,e)}function vSt(t,e){const{curvatureDependent:i,scaleStart:r,scaleFallOffRange:n}=u4e;return new l4e(t,{curvatureDependent:{min:{curvature:i.min.curvature,tiltAngle:i.min.tiltAngle,scaleFallOffFactor:Eq.curvatureDependent.min.scaleFallOffFactor},max:{curvature:i.max.curvature,tiltAngle:i.max.tiltAngle,scaleFallOffFactor:Eq.curvatureDependent.max.scaleFallOffFactor}},scaleStart:r,scaleFallOffRange:n,minPixelSize:Eq.minPixelSize},e)}function bSt(t){return Math.abs(t*t*t)}function s4e(t,e,i){const r=i.parameters,n=i.paddingPixelsOverride;return j3.scale=Math.min(r.divisor/(e-r.offset),1),j3.factor=bSt(t),j3.minPixelSize=r.minPixelSize,j3.paddingPixels=n,j3}function o4e(t,e){return t===0?e.minPixelSize:e.minPixelSize*(1+2*e.paddingPixels/t)}function $le(t,e){return Math.max(Bt(t*e.scale,t,e.factor),o4e(t,e))}function wSt(t,e,i){const r=s4e(t,e,i);return r.minPixelSize=0,r.paddingPixels=0,$le(1,r)}function a_e(t,e,i,r){r.scale=wSt(t,e,i),r.factor=0,r.minPixelSize=i.parameters.minPixelSize,r.paddingPixels=i.paddingPixelsOverride}function a4e(t,e,i=[0,0]){const r=Math.min(Math.max(e.scale,o4e(t[1],e)/Math.max(1e-5,t[1])),1);return i[0]=t[0]*r,i[1]=t[1]*r,i}function xSt(t,e,i,r){return $le(t,s4e(e,i,r))}let l4e=class c4e{get paddingPixelsOverride(){return this._paddingPixelsOverride||this.parameters.paddingPixels}constructor(e,i,r,n=TSt(),s){this._viewingMode=e,this._description=i,this._ellipsoidRadius=r,this.parameters=n,this._paddingPixelsOverride=s,this._viewingMode===qe.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(e){return(!this.parameters||this.parameters.camera.fovY!==e.fovY||this.parameters.camera.distance!==e.distance)&&(this._calculateParameters(e,this._ellipsoidRadius,this.parameters),!0)}overridePadding(e){return e!==this.paddingPixelsOverride?new c4e(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,e):this}_calculateParameters(e,i,r){const{scaleStart:n,scaleFallOffRange:s,minPixelSize:o}=this._description,{fovY:a,distance:l}=e,c=this._calculateCurvatureDependentParameters(e,i),h=this._coverageCompensation(e,i,c),{tiltAngle:p,scaleFallOffFactor:f}=c,m=Math.sin(p)*l,g=.5*Math.PI-p-a*(.5-n*h),_=m/Math.cos(g),b=g+a*s*h,w=(_-f*(m/Math.cos(b)))/(1-f);return r.camera.fovY=e.fovY,r.camera.distance=e.distance,r.offset=w,r.divisor=_-w,r.minPixelSize=o,r}_calculateCurvatureDependentParametersLocal(e,i,r=l_e){return r.tiltAngle=this._description.curvatureDependent.min.tiltAngle,r.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,r}_calculateCurvatureDependentParametersGlobal(e,i,r=l_e){const n=this._description.curvatureDependent,s=1+e.distance/i,o=Math.sqrt(s*s-1),[a,l]=[n.min.curvature,n.max.curvature],c=_e((o-a)/(l-a),0,1),[h,p]=[n.min,n.max];return r.tiltAngle=Bt(h.tiltAngle,p.tiltAngle,c),r.scaleFallOffFactor=Bt(h.scaleFallOffFactor,p.scaleFallOffFactor,c),r}_surfaceCoverageCompensationLocal(e,i,r){return(e.fovY-r.tiltAngle)/e.fovY}_surfaceCoverageCompensationGlobal(e,i,r){const n=i*i,s=r.tiltAngle+.5*Math.PI,{fovY:o,distance:a}=e,l=a*a+n-2*Math.cos(s)*a*i,c=Math.sqrt(l),h=Math.sqrt(l-n);return(Math.acos(h/c)-Math.asin(i/(c/Math.sin(s)))+.5*o)/o}};const u4e={curvatureDependent:{min:{curvature:Xt(10),tiltAngle:Xt(12),scaleFallOffFactor:.5},max:{curvature:Xt(70),tiltAngle:Xt(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},Eq={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function TSt(){return{camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0}}const j3={scale:0,factor:0,minPixelSize:0,paddingPixels:0},l_e={tiltAngle:0,scaleFallOffFactor:0};function SSt(t){return t instanceof Float32Array&&t.length>=16}function ESt(t){return Array.isArray(t)&&t.length>=16}function CSt(t){return SSt(t)||ESt(t)}function Lle(t){t.vertex.code.add(S`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`),t.vertex.code.add(S`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),t.vertex.code.add(S`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`),t.vertex.code.add(S`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`),t.vertex.code.add(S`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),t.vertex.code.add(S`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`),t.vertex.code.add(S`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function ASt(t){t.uniforms.add(new bi("screenSizePerspective",e=>h4e(e.screenSizePerspective)))}function b7(t){t.uniforms.add(new bi("screenSizePerspectiveAlignment",e=>h4e(e.screenSizePerspectiveAlignment||e.screenSizePerspective)))}function h4e(t){return cr(RSt,t.parameters.divisor,t.parameters.offset,t.parameters.minPixelSize,t.paddingPixelsOverride)}const RSt=pi();let d4e=class extends Fn{constructor(e,i){super(e,"mat4",br.Draw,(r,n,s)=>r.setUniformMatrix4fv(e,i(n,s)))}};function xm(t,e){e.instancedDoublePrecision?t.constants.add("cameraPosition","vec3",dl):t.uniforms.add(new rd("cameraPosition",(i,r)=>he(p4e,r.camera.viewInverseTransposeMatrix[3]-i.origin[0],r.camera.viewInverseTransposeMatrix[7]-i.origin[1],r.camera.viewInverseTransposeMatrix[11]-i.origin[2])))}function Yu(t,e){if(!e.instancedDoublePrecision)return void t.uniforms.add([new on("proj",(r,n)=>n.camera.projectionMatrix),new d4e("view",(r,n)=>Yc(c_e,n.camera.viewMatrix,r.origin)),new rd("localOrigin",r=>r.origin)]);const i=r=>he(p4e,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]);t.uniforms.add([new on("proj",(r,n)=>n.camera.projectionMatrix),new on("view",(r,n)=>Yc(c_e,n.camera.viewMatrix,i(n))),new Jt("localOrigin",(r,n)=>i(n))])}const c_e=PN(),p4e=P();function eO(t){t.uniforms.add(new on("viewNormal",(e,i)=>i.camera.viewInverseTransposeMatrix))}function f4e(t,e){const i=t.vertex;e.hasVerticalOffset?(m4e(i),e.hasScreenSizePerspective&&(t.include(Lle),b7(i),xm(t.vertex,e)),i.code.add(S`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${e.spherical?S`vec3 worldNormal = normalize(worldPos + localOrigin);`:S`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${e.hasScreenSizePerspective?S`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:S`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):i.code.add(S`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const MSt=pi();function m4e(t){t.uniforms.add(new bi("verticalOffset",(e,i)=>{const{minWorldLength:r,maxWorldLength:n,screenLength:s}=e.verticalOffset,o=Math.tan(.5*i.camera.fovY)/(.5*i.camera.fullViewport[3]),a=i.camera.pixelRatio||1;return cr(MSt,s*a,o,r,n)}))}var $h;(function(t){t[t.Occluded=0]="Occluded",t[t.NotOccluded=1]="NotOccluded",t[t.Both=2]="Both",t[t.COUNT=3]="COUNT"})($h||($h={}));var Bc;function g4e(t,e){t.include(Lle),t.attributes.add(M.POSITION,"vec3"),t.attributes.add(M.NORMAL,"vec3"),t.attributes.add(M.AUXPOS1,"vec4");const i=t.vertex;Yu(i,e),xm(i,e),i.uniforms.add([new bi("viewport",(r,n)=>n.camera.fullViewport),new Ie("polygonOffset",r=>r.shaderPolygonOffset),new Ie("cameraGroundRelative",(r,n)=>n.camera.aboveGround?1:-1),new Ie("renderTransparentlyOccludedHUD",(r,n)=>n.renderTransparentlyOccludedHUD===$h.Occluded?1:n.renderTransparentlyOccludedHUD===$h.NotOccluded?0:.75),new Dt("hudVisibilityTexture",(r,n)=>n.hudVisibilityTexture)]),e.hasVerticalOffset&&m4e(i),i.constants.add("smallOffsetAngle","float",.984807753012208),i.code.add(S`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),i.code.add(S`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),e.isDraped&&!e.hasVerticalOffset||eO(i),e.isDraped||(i.uniforms.add(new Ie("perDistancePixelRatio",(r,n)=>Math.tan(n.camera.fovY/2)/(n.camera.fullViewport[2]/2))),i.code.add(S`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`)),e.screenCenterOffsetUnitsEnabled===Bc.Screen&&i.uniforms.add(new Ie("pixelRatio",(r,n)=>n.camera.pixelRatio)),e.hasScreenSizePerspective&&b7(i),i.code.add(S`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${e.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${e.hasScreenSizePerspective&&(e.hasVerticalOffset||e.screenCenterOffsetUnitsEnabled===Bc.Screen)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${e.hasVerticalOffset?e.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${e.hasVerticalOffset?S`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${e.screenCenterOffsetUnitsEnabled!==Bc.Screen?S`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${e.screenCenterOffsetUnitsEnabled===Bc.Screen?e.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${e.screenCenterOffsetUnitsEnabled===Bc.Screen?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),i.code.add(S`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}(function(t){t[t.World=0]="World",t[t.Screen=1]="Screen",t[t.COUNT=2]="COUNT"})(Bc||(Bc={}));const A5=to();function y4e(t,e,i,r,n,s){if(t.visible)if(t.boundingInfo){wt(t.type===Zn.Mesh);const o=e.tolerance;_4e(t.boundingInfo,i,r,o,n,s)}else{const o=t.indices.get(M.POSITION),a=t.vertexAttributes.get(M.POSITION);QN(i,r,0,o.length/3,o,a,void 0,n,s)}}const OSt=P();function _4e(t,e,i,r,n,s){if(R(t))return;const o=b4e(e,i,OSt);if(CCe(A5,t.bbMin),ACe(A5,t.bbMax),v(n)&&n.applyToAabb(A5),Nle(A5,e,o,r)){const{primitiveIndices:a,indices:l,position:c}=t,h=a?a.length:l.length/3;if(h>LSt){const p=t.getChildren();if(p!==void 0){for(const f of p)_4e(f,e,i,r,n,s);return}}QN(e,i,0,h,l,c,a,n,s)}}const v4e=P();function QN(t,e,i,r,n,s,o,a,l){if(o)return PSt(t,e,i,r,n,s,o,a,l);const{data:c,stride:h}=s,p=t[0],f=t[1],m=t[2],g=e[0]-p,_=e[1]-f,b=e[2]-m;for(let w=i,x=3*i;w<r;++w){let T=h*n[x++],E=c[T++],C=c[T++],A=c[T];T=h*n[x++];let I=c[T++],O=c[T++],D=c[T];T=h*n[x++];let U=c[T++],V=c[T++],B=c[T];v(a)&&([E,C,A]=a.applyToVertex(E,C,A,w),[I,O,D]=a.applyToVertex(I,O,D,w),[U,V,B]=a.applyToVertex(U,V,B,w));const ee=I-E,ie=O-C,J=D-A,q=U-E,N=V-C,L=B-A,F=_*L-N*b,G=b*q-L*g,W=g*N-q*_,Z=ee*F+ie*G+J*W;if(Math.abs(Z)<=Number.EPSILON)continue;const X=p-E,oe=f-C,pe=m-A,ye=X*F+oe*G+pe*W;if(Z>0){if(ye<0||ye>Z)continue}else if(ye>0||ye<Z)continue;const Se=oe*J-ie*pe,He=pe*ee-J*X,De=X*ie-ee*oe,Te=g*Se+_*He+b*De;if(Z>0){if(Te<0||ye+Te>Z)continue}else if(Te>0||ye+Te<Z)continue;const ke=(q*Se+N*He+L*De)/Z;ke>=0&&l(ke,Dle(ee,ie,J,q,N,L,v4e),w,!1)}}function PSt(t,e,i,r,n,s,o,a,l){const{data:c,stride:h}=s,p=t[0],f=t[1],m=t[2],g=e[0]-p,_=e[1]-f,b=e[2]-m;for(let w=i;w<r;++w){const x=o[w];let T=3*x,E=h*n[T++],C=c[E++],A=c[E++],I=c[E];E=h*n[T++];let O=c[E++],D=c[E++],U=c[E];E=h*n[T];let V=c[E++],B=c[E++],ee=c[E];v(a)&&([C,A,I]=a.applyToVertex(C,A,I,w),[O,D,U]=a.applyToVertex(O,D,U,w),[V,B,ee]=a.applyToVertex(V,B,ee,w));const ie=O-C,J=D-A,q=U-I,N=V-C,L=B-A,F=ee-I,G=_*F-L*b,W=b*N-F*g,Z=g*L-N*_,X=ie*G+J*W+q*Z;if(Math.abs(X)<=Number.EPSILON)continue;const oe=p-C,pe=f-A,ye=m-I,Se=oe*G+pe*W+ye*Z;if(X>0){if(Se<0||Se>X)continue}else if(Se>0||Se<X)continue;const He=pe*q-J*ye,De=ye*ie-q*oe,Te=oe*J-ie*pe,ke=g*He+_*De+b*Te;if(X>0){if(ke<0||Se+ke>X)continue}else if(ke>0||Se+ke<X)continue;const ze=(N*He+L*De+F*Te)/X;ze>=0&&l(ze,Dle(ie,J,q,N,L,F,v4e),x,!1)}}const u_e=P(),h_e=P();function Dle(t,e,i,r,n,s,o){return he(u_e,t,e,i),he(h_e,r,n,s),vt(o,u_e,h_e),we(o,o),o}function b4e(t,e,i){return he(i,1/(e[0]-t[0]),1/(e[1]-t[1]),1/(e[2]-t[2]))}function Nle(t,e,i,r){return Fle(t,e,i,r,1/0)}function Fle(t,e,i,r,n){const s=(t[0]-r-e[0])*i[0],o=(t[3]+r-e[0])*i[0];let a=Math.min(s,o),l=Math.max(s,o);const c=(t[1]-r-e[1])*i[1],h=(t[4]+r-e[1])*i[1];if(l=Math.min(l,Math.max(c,h)),l<0||(a=Math.max(a,Math.min(c,h)),a>l))return!1;const p=(t[2]-r-e[2])*i[2],f=(t[5]+r-e[2])*i[2];return l=Math.min(l,Math.max(p,f)),!(l<0)&&(a=Math.max(a,Math.min(p,f)),!(a>l)&&a<n)}function w4e(t,e,i,r,n){let s=(i.screenLength||0)*t.pixelRatio;v(n)&&(s=xSt(s,r,e,n));const o=s*Math.tan(.5*t.fovY)/(.5*t.fullHeight);return _e(o*e,i.minWorldLength||0,i.maxWorldLength!=null?i.maxWorldLength:1/0)}function x4e(t,e){const i=e?x4e(e):{};for(const r in t){let n=t[r];n&&n.forEach&&(n=$St(n)),n==null&&r in i||(i[r]=n)}return i}function ISt(t,e){let i=!1;for(const r in e){const n=e[r];n!==void 0&&(Array.isArray(n)?t[r]===null?(t[r]=n.slice(),i=!0):Fre(t[r],n)&&(i=!0):t[r]!==n&&(i=!0,t[r]=n))}return i}function $St(t){const e=[];return t.forEach(i=>e.push(i)),e}const T4e={multiply:1,ignore:2,replace:3,tint:4},LSt=1e3;let Bw=class extends YN{constructor(e,i){super(),this.type=Zn.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=Di,this._pp0=Ue(0,0,1),this._pp1=Ue(0,0,0),this._parameters=x4e(e,i),this.validateParameters(this._parameters)}dispose(){}get parameters(){return this._parameters}update(e){return!1}setParameters(e,i=!0){ISt(this._parameters,e)&&(this.validateParameters(this._parameters),i&&this.parametersChanged())}validateParameters(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}shouldRender(e){return this.isVisible()&&this.isVisibleForOutput(e.output)&&(this.renderOccluded&e.renderOccludedMask)!=0}isVisibleForOutput(e){return!0}get renderOccluded(){return this.parameters.renderOccluded}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}get insertOrder(){return this._insertOrder}set insertOrder(e){e!==this._insertOrder&&(this._insertOrder=e,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){v(this.repository)&&this.repository.materialChanged(this)}intersectDraped(e,i,r,n,s,o){return this._pp0[0]=this._pp1[0]=n[0],this._pp0[1]=this._pp1[1]=n[1],this.intersect(e,i,r,this._pp0,this._pp1,s)}},S4e=class extends h1t{constructor(e,i,r){super(i,r),this.camera=e}};var xn;(function(t){t[t.Occlude=1]="Occlude",t[t.Transparent=2]="Transparent",t[t.OccludeAndTransparent=4]="OccludeAndTransparent",t[t.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",t[t.Opaque=16]="Opaque"})(xn||(xn={}));let HO=class extends Tr{constructor(){super(...arguments),this.renderOccluded=xn.Occlude}},E4e=class{constructor(){this.factor=new d_e,this.factorAlignment=new d_e}},d_e=class{constructor(){this.scale=0,this.factor=0,this.minPixelSize=0,this.paddingPixels=0}};function YXt(t,e,i,r,n=1){const s=i.typedBuffer,o=i.typedBufferStride,a=t.length;if(r*=o,n===1)for(let l=0;l<a;++l)s[r]=e[t[l]],r+=o;else for(let l=0;l<a;++l){const c=e[t[l]];for(let h=0;h<n;h++)s[r]=c,r+=o}}function DSt(t,e,i,r){const n=i.typedBuffer,s=i.typedBufferStride,o=t.length;r*=s;for(let a=0;a<o;++a){const l=2*t[a];n[r]=e[l],n[r+1]=e[l+1],r+=s}}function C4e(t,e,i,r,n){const s=i.typedBuffer,o=i.typedBufferStride,a=t.length;if(r*=o,n==null||n===1)for(let l=0;l<a;++l){const c=3*t[l];s[r]=e[c],s[r+1]=e[c+1],s[r+2]=e[c+2],r+=o}else for(let l=0;l<a;++l){const c=3*t[l];for(let h=0;h<n;++h)s[r]=e[c],s[r+1]=e[c+1],s[r+2]=e[c+2],r+=o}}function tO(t,e,i,r,n=1){const s=i.typedBuffer,o=i.typedBufferStride,a=t.length;if(r*=o,n===1)for(let l=0;l<a;++l){const c=4*t[l];s[r]=e[c],s[r+1]=e[c+1],s[r+2]=e[c+2],s[r+3]=e[c+3],r+=o}else for(let l=0;l<a;++l){const c=4*t[l];for(let h=0;h<n;++h)s[r]=e[c],s[r+1]=e[c+1],s[r+2]=e[c+2],s[r+3]=e[c+3],r+=o}}function p_e(t,e,i){const r=t.typedBuffer,n=t.typedBufferStride;e*=n;for(let s=0;s<i;++s)r[e]=0,r[e+1]=0,r[e+2]=0,r[e+3]=0,e+=n}function w7(t,e,i,r,n,s=1){if(!i)return void C4e(t,e,r,n,s);const o=r.typedBuffer,a=r.typedBufferStride,l=t.length,c=i[0],h=i[1],p=i[2],f=i[4],m=i[5],g=i[6],_=i[8],b=i[9],w=i[10],x=i[12],T=i[13],E=i[14];n*=a;let C=0,A=0,I=0;const O=aB(i)?D=>{C=e[D]+x,A=e[D+1]+T,I=e[D+2]+E}:D=>{const U=e[D],V=e[D+1],B=e[D+2];C=c*U+f*V+_*B+x,A=h*U+m*V+b*B+T,I=p*U+g*V+w*B+E};if(s===1)for(let D=0;D<l;++D)O(3*t[D]),o[n]=C,o[n+1]=A,o[n+2]=I,n+=a;else for(let D=0;D<l;++D){O(3*t[D]);for(let U=0;U<s;++U)o[n]=C,o[n+1]=A,o[n+2]=I,n+=a}}function kle(t,e,i,r,n,s=1){if(!i)return void C4e(t,e,r,n,s);const o=i,a=r.typedBuffer,l=r.typedBufferStride,c=t.length,h=o[0],p=o[1],f=o[2],m=o[4],g=o[5],_=o[6],b=o[8],w=o[9],x=o[10],T=!hse(o),E=1e-6,C=1-E;n*=l;let A=0,I=0,O=0;const D=aB(o)?U=>{A=e[U],I=e[U+1],O=e[U+2]}:U=>{const V=e[U],B=e[U+1],ee=e[U+2];A=h*V+m*B+b*ee,I=p*V+g*B+w*ee,O=f*V+_*B+x*ee};if(s===1)if(T)for(let U=0;U<c;++U){D(3*t[U]);const V=A*A+I*I+O*O;if(V<C&&V>E){const B=1/Math.sqrt(V);a[n]=A*B,a[n+1]=I*B,a[n+2]=O*B}else a[n]=A,a[n+1]=I,a[n+2]=O;n+=l}else for(let U=0;U<c;++U)D(3*t[U]),a[n]=A,a[n+1]=I,a[n+2]=O,n+=l;else for(let U=0;U<c;++U){if(D(3*t[U]),T){const V=A*A+I*I+O*O;if(V<C&&V>E){const B=1/Math.sqrt(V);A*=B,I*=B,O*=B}}for(let V=0;V<s;++V)a[n]=A,a[n+1]=I,a[n+2]=O,n+=l}}function NSt(t,e,i,r,n,s=1){if(!i)return void tO(t,e,r,n,s);const o=i,a=r.typedBuffer,l=r.typedBufferStride,c=t.length,h=o[0],p=o[1],f=o[2],m=o[4],g=o[5],_=o[6],b=o[8],w=o[9],x=o[10],T=!hse(o),E=1e-6,C=1-E;if(n*=l,s===1)for(let A=0;A<c;++A){const I=4*t[A],O=e[I],D=e[I+1],U=e[I+2],V=e[I+3];let B=h*O+m*D+b*U,ee=p*O+g*D+w*U,ie=f*O+_*D+x*U;if(T){const J=B*B+ee*ee+ie*ie;if(J<C&&J>E){const q=1/Math.sqrt(J);B*=q,ee*=q,ie*=q}}a[n]=B,a[n+1]=ee,a[n+2]=ie,a[n+3]=V,n+=l}else for(let A=0;A<c;++A){const I=4*t[A],O=e[I],D=e[I+1],U=e[I+2],V=e[I+3];let B=h*O+m*D+b*U,ee=p*O+g*D+w*U,ie=f*O+_*D+x*U;if(T){const J=B*B+ee*ee+ie*ie;if(J<C&&J>E){const q=1/Math.sqrt(J);B*=q,ee*=q,ie*=q}}for(let J=0;J<s;++J)a[n]=B,a[n+1]=ee,a[n+2]=ie,a[n+3]=V,n+=l}}function Ule(t,e,i,r,n,s=1){const o=r.typedBuffer,a=r.typedBufferStride,l=t.length;if(n*=a,i!==e.length||i!==4)if(s!==1)if(i!==4)for(let c=0;c<l;++c){const h=3*t[c];for(let p=0;p<s;++p)o[n]=e[h],o[n+1]=e[h+1],o[n+2]=e[h+2],o[n+3]=255,n+=a}else for(let c=0;c<l;++c){const h=4*t[c];for(let p=0;p<s;++p)o[n]=e[h],o[n+1]=e[h+1],o[n+2]=e[h+2],o[n+3]=e[h+3],n+=a}else{if(i===4){for(let c=0;c<l;++c){const h=4*t[c];o[n]=e[h],o[n+1]=e[h+1],o[n+2]=e[h+2],o[n+3]=e[h+3],n+=a}return}for(let c=0;c<l;++c){const h=3*t[c];o[n]=e[h],o[n+1]=e[h+1],o[n+2]=e[h+2],o[n+3]=255,n+=a}}else{o[n]=e[0],o[n+1]=e[1],o[n+2]=e[2],o[n+3]=e[3];const c=new Uint32Array(r.typedBuffer.buffer,r.start),h=a/4,p=c[n/=4];n+=h;const f=l*s;for(let m=1;m<f;++m)c[n]=p,n+=h}}function A4e(t,e,i,r,n=1){const s=e.typedBuffer,o=e.typedBufferStride;if(r*=o,n===1)for(let a=0;a<i;++a)s[r]=t[0],s[r+1]=t[1],s[r+2]=t[2],s[r+3]=t[3],r+=o;else for(let a=0;a<i;++a)for(let l=0;l<n;++l)s[r]=t[0],s[r+1]=t[1],s[r+2]=t[2],s[r+3]=t[3],r+=o}function R4e(t,e,i,r,n,s){for(const o of e.fieldNames){const a=t.vertexAttributes.get(o),l=t.indices.get(o);if(a&&l)switch(o){case M.POSITION:{wt(a.size===3);const c=n.getField(o,jr);wt(!!c,`No buffer view for ${o}`),c&&w7(l,a.data,i,c,s);break}case M.NORMAL:{wt(a.size===3);const c=n.getField(o,jr);wt(!!c,`No buffer view for ${o}`),c&&kle(l,a.data,r,c,s);break}case M.UV0:{wt(a.size===2);const c=n.getField(o,K_);wt(!!c,`No buffer view for ${o}`),c&&DSt(l,a.data,c,s);break}case M.COLOR:case M.SYMBOLCOLOR:{wt(a.size===3||a.size===4);const c=n.getField(o,vl);wt(!!c,`No buffer view for ${o}`),c&&Ule(l,a.data,a.size,c,s);break}case M.TANGENT:{wt(a.size===4);const c=n.getField(o,eh);wt(!!c,`No buffer view for ${o}`),c&&NSt(l,a.data,r,c,s);break}case M.PROFILERIGHT:case M.PROFILEUP:case M.PROFILEVERTEXANDNORMAL:case M.FEATUREVALUE:{wt(a.size===4);const c=n.getField(o,eh);wt(!!c,`No buffer view for ${o}`),c&&tO(l,a.data,c,s)}}else if(o===M.OBJECTANDLAYERIDCOLOR&&v(t.objectAndLayerIdColor)){const c=t.indices.get(M.POSITION);if(wt(!!c,`No buffer view for ${o}`),c){const h=c.length,p=n.getField(o,vl);A4e(t.objectAndLayerIdColor,p,h,s)}}}}function ID(t,e,i=0){const r=_e(t,0,USt);for(let n=0;n<4;n++)e[i+n]=Math.floor(256*VSt(r*FSt[n]))}function Vle(t,e=0){let i=0;for(let r=0;r<4;r++)i+=t[e+r]*kSt[r];return i}const FSt=[1,256,65536,16777216],kSt=[1/256,1/65536,1/16777216,1/4294967296],USt=Vle(new Uint8ClampedArray([255,255,255,255]));function VSt(t){return t-Math.floor(t)}async function D_(t,e){const{data:i}=await ir(t,{responseType:"image",...e});return i}let zle=class extends Tr{constructor(){super(...arguments),this.color=Zt(1,1,1,1)}};function zSt(){const t=new ji;return t.include(Bp),t.fragment.uniforms.add([new Dt("tex",e=>e.texture),new bi("uColor",e=>e.color)]),t.fragment.code.add(S`void main() {
vec4 texColor = texture2D(tex, uv);
gl_FragColor = texColor * uColor;
}`),t}const BSt=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:zle,build:zSt},Symbol.toStringTag,{value:"Module"}));function jSt(){if(R(Cq)){const t=e=>ar(`esri/libs/basisu/${e}`);Cq=Q(()=>import("./basis_transcoder-e0466ff6.js"),["assets/basis_transcoder-e0466ff6.js","assets/_commonjsHelpers-2f3e7994.js"]).then(e=>e.b).then(({default:e})=>e({locateFile:t}).then(i=>(i.initializeBasis(),delete i.then,i)))}return Cq}let Cq;var oS;(function(t){t[t.ETC1_RGB=0]="ETC1_RGB",t[t.ETC2_RGBA=1]="ETC2_RGBA",t[t.BC1_RGB=2]="BC1_RGB",t[t.BC3_RGBA=3]="BC3_RGBA",t[t.BC4_R=4]="BC4_R",t[t.BC5_RG=5]="BC5_RG",t[t.BC7_M6_RGB=6]="BC7_M6_RGB",t[t.BC7_M5_RGBA=7]="BC7_M5_RGBA",t[t.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",t[t.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",t[t.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",t[t.ATC_RGB=11]="ATC_RGB",t[t.ATC_RGBA=12]="ATC_RGBA",t[t.FXT1_RGB=17]="FXT1_RGB",t[t.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",t[t.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",t[t.ETC2_EAC_R11=20]="ETC2_EAC_R11",t[t.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",t[t.RGBA32=13]="RGBA32",t[t.RGB565=14]="RGB565",t[t.BGR565=15]="BGR565",t[t.RGBA4444=16]="RGBA4444"})(oS||(oS={}));let um=null,R5=null;async function M4e(){return R(R5)&&(R5=jSt(),um=await R5),R5}function GSt(t,e){if(R(um))return t.byteLength;const i=new um.BasisFile(new Uint8Array(t)),r=P4e(i)?O4e(i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),e):0;return i.close(),i.delete(),r}function HSt(t,e){if(R(um))return t.byteLength;const i=new um.KTX2File(new Uint8Array(t)),r=I4e(i)?O4e(i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),e):0;return i.close(),i.delete(),r}function O4e(t,e,i,r,n){const s=CDe(e?qn.COMPRESSED_RGBA8_ETC2_EAC:qn.COMPRESSED_RGB8_ETC2),o=n&&t>1?(4**t-1)/(3*4**(t-1)):1;return Math.ceil(i*r*s*o)}function P4e(t){return t.getNumImages()>=1&&!t.isUASTC()}function I4e(t){return t.getFaces()>=1&&t.isETC1S()}async function qSt(t,e,i){R(um)&&(um=await M4e());const r=new um.BasisFile(new Uint8Array(i));if(!P4e(r))return null;r.startTranscoding();const n=$4e(t,e,r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),(s,o)=>r.getImageTranscodedSizeInBytes(0,s,o),(s,o,a)=>r.transcodeImage(a,0,s,o,0,0));return r.close(),r.delete(),n}async function WSt(t,e,i){R(um)&&(um=await M4e());const r=new um.KTX2File(new Uint8Array(i));if(!I4e(r))return null;r.startTranscoding();const n=$4e(t,e,r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),(s,o)=>r.getImageTranscodedSizeInBytes(s,0,0,o),(s,o,a)=>r.transcodeImage(a,s,0,0,o,0,-1,-1));return r.close(),r.delete(),n}function $4e(t,e,i,r,n,s,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=t.capabilities,[h,p]=l?r?[oS.ETC2_RGBA,qn.COMPRESSED_RGBA8_ETC2_EAC]:[oS.ETC1_RGB,qn.COMPRESSED_RGB8_ETC2]:c?r?[oS.BC3_RGBA,qn.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[oS.BC1_RGB,qn.COMPRESSED_RGB_S3TC_DXT1_EXT]:[oS.RGBA32,Ge.RGBA],f=e.hasMipmap?i:Math.min(1,i),m=[];for(let w=0;w<f;w++)m.push(new Uint8Array(o(w,h))),a(w,h,m[w]);const g=m.length>1,_=g?nt.LINEAR_MIPMAP_LINEAR:nt.LINEAR,b={...e,samplingMode:_,hasMipmap:g,internalFormat:p,width:n,height:s};return new mt(t,b,{type:"compressed",levels:m})}const G3=re.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),XSt=542327876,YSt=131072,ZSt=4;function Ble(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function JSt(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)}const KSt=Ble("DXT1"),QSt=Ble("DXT3"),e2t=Ble("DXT5"),t2t=31,i2t=0,r2t=1,n2t=2,s2t=3,o2t=4,a2t=7,l2t=20,c2t=21;function u2t(t,e,i){const{textureData:r,internalFormat:n,width:s,height:o}=Nc(h2t(i,e.hasMipmap??!1));return e.samplingMode=r.levels.length>1?nt.LINEAR_MIPMAP_LINEAR:nt.LINEAR,e.hasMipmap=r.levels.length>1,e.internalFormat=n,e.width=s,e.height=o,new mt(t,e,r)}function h2t(t,e){const i=new Int32Array(t,0,t2t);if(i[i2t]!==XSt)return G3.error("Invalid magic number in DDS header"),null;if(!(i[l2t]&ZSt))return G3.error("Unsupported format, must contain a FourCC code"),null;const r=i[c2t];let n,s;switch(r){case KSt:n=8,s=qn.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case QSt:n=16,s=qn.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case e2t:n=16,s=qn.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return G3.error("Unsupported FourCC code:",JSt(r)),null}let o=1,a=i[o2t],l=i[s2t];!(3&a)&&!(3&l)||(G3.warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,h=l;let p,f;i[n2t]&YSt&&e!==!1&&(o=Math.max(1,i[a2t])),o===1||mm(a)&&mm(l)||(G3.warn("Ignoring mipmaps of non power of two sized compressed texture."),o=1);let m=i[r2t]+4;const g=[];for(let _=0;_<o;++_)f=(a+3>>2)*(l+3>>2)*n,p=new Uint8Array(t,m,f),g.push(p),m+=f,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:g},internalFormat:s,width:c,height:h}}let Q2=class VU extends YN{constructor(e,i){super(),this._data=e,this.type=Zn.Texture,this._glTexture=null,this._powerOfTwoStretchInfo=null,this._loadingPromise=null,this._loadingController=null,this.events=new An,this._passParameters=new zle,this.params=i||{},this.params.mipmap=this.params.mipmap!==!1,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:$t.REPEAT,t:$t.REPEAT},this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||jb.STRETCH,this.estimatedTexMemRequired=VU._estimateTexMemRequired(this._data,this.params),this._startPreload()}_startPreload(){const e=this._data;R(e)||(e instanceof HTMLVideoElement?this._startPreloadVideoElement(e):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){if(!(tw(e.src)||e.preload==="auto"&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";const i=!e.paused;if(e.src=e.src,i&&e.autoplay){const r=()=>{e.removeEventListener("canplay",r),e.play()};e.addEventListener("canplay",r)}}}_startPreloadImageElement(e){fd(e.src)||tw(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}static _getDataDimensions(e){return e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e}static _estimateTexMemRequired(e,i){if(R(e))return 0;if(o3(e)||qT(e))return i.encoding===j0.KTX2_ENCODING?HSt(e,!!i.mipmap):i.encoding===j0.BASIS_ENCODING?GSt(e,!!i.mipmap):e.byteLength;const{width:r,height:n}=e instanceof Image||e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?VU._getDataDimensions(e):i;return(i.mipmap?4/3:1)*r*n*(i.components||4)||0}dispose(){this._data=void 0}get width(){return this.params.width}get height(){return this.params.height}_createDescriptor(e){return{target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?nt.LINEAR_MIPMAP_LINEAR:nt.LINEAR,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:this.params.maxAnisotropy??(this.params.mipmap?e.parameters.maxMaxAnisotropy:1)}}get glTexture(){return this._glTexture}load(e,i){if(v(this._glTexture))return this._glTexture;if(v(this._loadingPromise))return this._loadingPromise;const r=this._data;return R(r)?(this._glTexture=new mt(e,this._createDescriptor(e),null),this._glTexture):typeof r=="string"?this._loadFromURL(e,i,r):r instanceof Image?this._loadFromImageElement(e,i,r):r instanceof HTMLVideoElement?this._loadFromVideoElement(e,i,r):r instanceof ImageData||r instanceof HTMLCanvasElement?this._loadFromImage(e,r,i):(o3(r)||qT(r))&&this.params.encoding===j0.DDS_ENCODING?(this._data=void 0,this._loadFromDDSData(e,r)):(o3(r)||qT(r))&&this.params.encoding===j0.KTX2_ENCODING?(this._data=void 0,this._loadFromKTX2(e,r)):(o3(r)||qT(r))&&this.params.encoding===j0.BASIS_ENCODING?(this._data=void 0,this._loadFromBasis(e,r)):qT(r)?this._loadFromPixelData(e,r):o3(r)?this._loadFromPixelData(e,new Uint8Array(r)):null}get requiresFrameUpdates(){return this._data instanceof HTMLVideoElement}frameUpdate(e,i,r){if(!(this._data instanceof HTMLVideoElement)||R(this._glTexture)||this._data.readyState<eL.HAVE_CURRENT_DATA||r===this._data.currentTime)return r;if(v(this._powerOfTwoStretchInfo)){const{framebuffer:n,vao:s,sourceTexture:o}=this._powerOfTwoStretchInfo;o.setData(this._data),this._drawStretchedTexture(e,i,n,s,o,this._glTexture)}else{const{videoWidth:n,videoHeight:s}=this._data,{width:o,height:a}=this._glTexture.descriptor;n!==o||s!==a?this._glTexture.updateData(0,0,0,Math.min(n,o),Math.min(s,a),this._data):this._glTexture.setData(this._data)}return this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this.params.updateCallback&&this.params.updateCallback(),this._data.currentTime}_loadFromDDSData(e,i){return this._glTexture=u2t(e,this._createDescriptor(e),i),this._glTexture}_loadFromKTX2(e,i){return this._loadAsync(()=>WSt(e,this._createDescriptor(e),i).then(r=>(this._glTexture=r,r)))}_loadFromBasis(e,i){return this._loadAsync(()=>qSt(e,this._createDescriptor(e),i).then(r=>(this._glTexture=r,r)))}_loadFromPixelData(e,i){wt(this.params.width>0&&this.params.height>0);const r=this._createDescriptor(e);return r.pixelFormat=this.params.components===1?Ge.LUMINANCE:this.params.components===3?Ge.RGB:Ge.RGBA,r.width=this.params.width,r.height=this.params.height,this._glTexture=new mt(e,r,i),this._glTexture}_loadFromURL(e,i,r){return this._loadAsync(async n=>{const s=await D_(r,{signal:n});return ui(n),this._loadFromImage(e,s,i)})}_loadFromImageElement(e,i,r){return r.complete?this._loadFromImage(e,r,i):this._loadAsync(async n=>{const s=await KCe(r,r.src,!1,n);return ui(n),this._loadFromImage(e,s,i)})}_loadFromVideoElement(e,i,r){return r.readyState>=eL.HAVE_CURRENT_DATA?this._loadFromImage(e,r,i):this._loadFromVideoElementAsync(e,i,r)}_loadFromVideoElementAsync(e,i,r){return this._loadAsync(n=>new Promise((s,o)=>{const a=()=>{r.removeEventListener("loadeddata",l),r.removeEventListener("error",c),Nr(h)},l=()=>{r.readyState>=eL.HAVE_CURRENT_DATA&&(a(),s(this._loadFromImage(e,r,i)))},c=p=>{a(),o(p||new H("Failed to load video"))};r.addEventListener("loadeddata",l),r.addEventListener("error",c);const h=ja(n,()=>c(Bi()))}))}_loadFromImage(e,i,r){const n=VU._getDataDimensions(i);this.params.width=n.width,this.params.height=n.height;const s=this._createDescriptor(e);return s.pixelFormat=this.params.components===3?Ge.RGB:Ge.RGBA,!this._requiresPowerOfTwo(e,s)||mm(n.width)&&mm(n.height)?(s.width=n.width,s.height=n.height,this._glTexture=new mt(e,s,i),this._glTexture):(this._glTexture=this._makePowerOfTwoTexture(e,i,n,s,r),this._glTexture)}_loadAsync(e){const i=new AbortController;this._loadingController=i;const r=e(i.signal);this._loadingPromise=r;const n=()=>{this._loadingController===i&&(this._loadingController=null),this._loadingPromise===r&&(this._loadingPromise=null)};return r.then(n,n),r}_requiresPowerOfTwo(e,i){const r=$t.CLAMP_TO_EDGE,n=typeof i.wrapMode=="number"?i.wrapMode===r:i.wrapMode.s===r&&i.wrapMode.t===r;return e.type===Et.WEBGL1&&(i.hasMipmap||!n)}_makePowerOfTwoTexture(e,i,r,n,s){const{width:o,height:a}=r,l=vM(o),c=vM(a);let h;switch(n.width=l,n.height=c,this.params.powerOfTwoResizeMode){case jb.PAD:n.textureCoordinateScaleFactor=[o/l,a/c],h=new mt(e,n),h.updateData(0,0,0,o,a,i);break;case jb.STRETCH:case null:case void 0:h=this._stretchToPowerOfTwo(e,i,n,s());break;default:this.params.powerOfTwoResizeMode}return n.hasMipmap&&h.generateMipmap(),h}_stretchToPowerOfTwo(e,i,r,n){const s=new mt(e,r),o=new es(e,{colorTarget:En.TEXTURE,depthStencilTarget:Vi.NONE},s),a=new mt(e,{target:Ct.TEXTURE_2D,pixelFormat:r.pixelFormat,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE,samplingMode:nt.LINEAR,flipped:!!r.flipped,maxAnisotropy:8,preMultiplyAlpha:r.preMultiplyAlpha},i),l=xl(e),c=e.getBoundFramebufferObject();return this._drawStretchedTexture(e,n,o,l,a,s),this.requiresFrameUpdates?this._powerOfTwoStretchInfo={vao:l,sourceTexture:a,framebuffer:o}:(l.dispose(!0),a.dispose(),o.detachColorTexture(),o.dispose()),e.bindFramebuffer(c),s}_drawStretchedTexture(e,i,r,n,s,o){this._passParameters.texture=s,e.bindFramebuffer(r);const a=e.getViewport();e.setViewport(0,0,o.descriptor.width,o.descriptor.height),e.bindTechnique(i,this._passParameters,null),e.bindVAO(n),e.drawArrays(Ft.TRIANGLE_STRIP,0,Ua(n,"geometry")),e.bindFramebuffer(null),e.setViewport(a.x,a.y,a.width,a.height),this._passParameters.texture=null}unload(){if(v(this._powerOfTwoStretchInfo)){const{framebuffer:e,vao:i,sourceTexture:r}=this._powerOfTwoStretchInfo;i.dispose(!0),r.dispose(),e.dispose(),this._glTexture=null,this._powerOfTwoStretchInfo=null}if(v(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null),v(this._loadingController)){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}};var eL;(function(t){t[t.HAVE_NOTHING=0]="HAVE_NOTHING",t[t.HAVE_METADATA=1]="HAVE_METADATA",t[t.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t[t.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t[t.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(eL||(eL={}));const $D=128,jle=.5;function L4e(t,e=$D,i=e*jle,r=0){const n=d2t(t,e,i,r);return new Q2(n,{mipmap:!1,wrap:{s:$t.CLAMP_TO_EDGE,t:$t.CLAMP_TO_EDGE},width:e,height:e,components:4,noUnpackFlip:!0})}function d2t(t,e=$D,i=e*jle,r=0){switch(t){case"circle":default:return p2t(e,i);case"square":return f2t(e,i);case"cross":return g2t(e,i,r);case"x":return y2t(e,i,r);case"kite":return m2t(e,i);case"triangle":return _2t(e,i);case"arrow":return v2t(e,i)}}function p2t(t,e){const i=t/2-.5;return eF(t,F4e(i,i,e/2))}function f2t(t,e){return D4e(t,e,!1)}function m2t(t,e){return D4e(t,e,!0)}function g2t(t,e,i=0){return N4e(t,e,!1,i)}function y2t(t,e,i=0){return N4e(t,e,!0,i)}function _2t(t,e){return eF(t,k4e(t/2,e,e/2))}function v2t(t,e){const i=e,r=e/2,n=t/2,s=.8*i,o=F4e(n,(t-e)/2-s,Math.sqrt(s*s+r*r)),a=k4e(n,i,r);return eF(t,(l,c)=>Math.max(a(l,c),-o(l,c)))}function D4e(t,e,i){return i&&(e/=Math.SQRT2),eF(t,(r,n)=>{let s=r-.5*t+.25,o=.5*t-n-.75;if(i){const a=(s+o)/Math.SQRT2;o=(o-s)/Math.SQRT2,s=a}return Math.max(Math.abs(s),Math.abs(o))-.5*e})}function N4e(t,e,i,r=0){e-=r,i&&(e*=Math.SQRT2);const n=.5*e;return eF(t,(s,o)=>{let a,l=s-.5*t,c=.5*t-o-1;if(i){const h=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=h}return l=Math.abs(l),c=Math.abs(c),a=l>c?l>n?Math.sqrt((l-n)*(l-n)+c*c):c:c>n?Math.sqrt(l*l+(c-n)*(c-n)):l,a-=r/2,a})}function F4e(t,e,i){return(r,n)=>{const s=r-t,o=n-e;return Math.sqrt(s*s+o*o)-i}}function k4e(t,e,i){const r=Math.sqrt(e*e+i*i);return(n,s)=>{const o=Math.abs(n-t)-i,a=s-t+e/2+.75,l=(e*o+i*a)/r,c=-a;return Math.max(l,c)}}function eF(t,e){const i=new Uint8Array(4*t*t);for(let r=0;r<t;r++)for(let n=0;n<t;n++){const s=n+t*r;let o=e(n,r);o=o/t+.5,ID(o,i,4*s)}return i}let JXt=class extends Tr{constructor(e){super(),this.slicePlaneLocalOrigin=e}};function b2t(t,e){U4e(t,e,[new Jt("slicePlaneOrigin",(i,r)=>j4e(e,i,r)),new Jt("slicePlaneBasis1",(i,r)=>{var n;return Iz(e,i,r,(n=r.slicePlane)==null?void 0:n.basis1)}),new Jt("slicePlaneBasis2",(i,r)=>{var n;return Iz(e,i,r,(n=r.slicePlane)==null?void 0:n.basis2)})])}function fs(t,e){U4e(t,e,[new rd("slicePlaneOrigin",(i,r)=>j4e(e,i,r)),new rd("slicePlaneBasis1",(i,r)=>{var n;return Iz(e,i,r,(n=r.slicePlane)==null?void 0:n.basis1)}),new rd("slicePlaneBasis2",(i,r)=>{var n;return Iz(e,i,r,(n=r.slicePlane)==null?void 0:n.basis2)})])}function U4e(t,e,i){if(!e.hasSlicePlane){const o=S`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return e.hasSliceInVertexProgram&&t.vertex.code.add(o),void t.fragment.code.add(o)}t.extensions.add("GL_OES_standard_derivatives"),e.hasSliceInVertexProgram&&t.vertex.uniforms.add(i),t.fragment.uniforms.add(i);const r=S`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,n=S`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,s=e.hasSliceHighlight?S`
        ${n}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:S`#define highlightSlice(_color_, _pos_) (_color_)`;e.hasSliceInVertexProgram&&t.vertex.code.add(r),t.fragment.code.add(r),t.fragment.code.add(s)}function V4e(t,e,i){return t.instancedDoublePrecision?he(w2t,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]):e.slicePlaneLocalOrigin}function z4e(t,e){return v(t)?ge($z,e.origin,t):e.origin}function B4e(t,e,i){return t.hasSliceTranslatedView?v(e)?Yc(x2t,i.camera.viewMatrix,e):i.camera.viewMatrix:null}function j4e(t,e,i){if(R(i.slicePlane))return dl;const r=V4e(t,e,i),n=z4e(r,i.slicePlane),s=B4e(t,r,i);return v(s)?Ke($z,n,s):n}function Iz(t,e,i,r){if(R(r)||R(i.slicePlane))return dl;const n=V4e(t,e,i),s=z4e(n,i.slicePlane),o=B4e(t,n,i);return v(o)?(me(H3,r,s),Ke($z,s,o),Ke(H3,H3,o),ge(H3,H3,$z)):r}const w2t=P(),$z=P(),H3=P(),x2t=$e();function x7(t,e){const i=e.output===z.ObjectAndLayerIdColor,r=e.objectAndLayerIdColorInstanced;i&&(t.varyings.add("objectAndLayerIdColorVarying","vec4"),r?t.attributes.add(M.OBJECTANDLAYERIDCOLOR_INSTANCED,"vec4"):t.attributes.add(M.OBJECTANDLAYERIDCOLOR,"vec4")),t.vertex.code.add(S`
     void forwardObjectAndLayerIdColor() {
      ${i?r?S`objectAndLayerIdColorVarying = objectAndLayerIdColor_instanced * 0.003921568627451;`:S`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:S``} }`),t.fragment.code.add(S`
      void outputObjectAndLayerIdColor() {
        ${i?S`gl_FragColor = objectAndLayerIdColorVarying;`:S``} }`)}function T2t(t,e){const{vertex:i,fragment:r}=t;e.hasMultipassGeometry&&i.include(qDe),e.hasMultipassTerrain&&t.varyings.add("depth","float"),i.code.add(S`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${e.hasMultipassGeometry?S`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${e.hasMultipassTerrain?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),e.hasMultipassTerrain&&r.include(ud),e.hasMultipassTerrain&&r.uniforms.add([...cm("terrainDepthTexture",(n,s)=>s.multipassTerrain.linearDepthTexture,e.hasWebGL2Context?lr.None:lr.InvSize),new Wi("nearFar",(n,s)=>s.camera.nearFar)]),r.include(nh),r.code.add(S`
  void main() {
    gl_FragColor = vec4(1, 1, 1, 1);
    ${e.hasMultipassTerrain?S`
          vec2 uv = gl_FragCoord.xy;

          // Read the rgba data from the texture linear depth
          vec4 terrainDepthData = ${Zl(e,"terrainDepthTexture","uv")};

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          // If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          // Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            gl_FragColor.g = 0.5;
          }`:""}
  }
  `)}const S2t=Zt(1,1,0,1),G4e=Zt(1,0,1,1);function Q_(t,e){t.fragment.uniforms.add(cm("depthTex",(i,r)=>r.highlightDepthTexture,e.hasWebGL2Context?lr.None:lr.InvSize)),t.fragment.constants.add("occludedHighlightFlag","vec4",S2t).add("unoccludedHighlightFlag","vec4",G4e),t.fragment.code.add(S`
    void outputHighlight() {
      vec3 fragCoord = gl_FragCoord.xyz;

      float sceneDepth = ${Zl(e,"depthTex","fragCoord.xy")}.x;
      if (fragCoord.z > sceneDepth + 5e-7) {
        gl_FragColor = occludedHighlightFlag;
      }
      else {
        gl_FragColor = unoccludedHighlightFlag;
      }
    }
  `)}let T7=class extends Fn{constructor(e,i,r){super(e,"vec4",br.Pass,(n,s,o)=>n.setUniform4fv(e,i(s,o)),r)}},cl=class extends Fn{constructor(e,i,r){super(e,"float",br.Pass,(n,s,o)=>n.setUniform1fv(e,i(s,o)),r)}},Gle=class extends HO{constructor(){super(...arguments),this.vvSizeEnabled=!1,this.vvSizeMinSize=Ue(1,1,1),this.vvSizeMaxSize=Ue(100,100,100),this.vvSizeOffset=Ue(0,0,0),this.vvSizeFactor=Ue(1,1,1),this.vvSizeValue=Ue(1,1,1),this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvOpacityEnabled=!1,this.vvOpacityValues=[0,0,0,0,0,0,0,0],this.vvOpacityOpacities=[1,1,1,1,1,1,1,1],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=wr()}};const hm=8;function ZR(t,e){e.hasVvInstancing&&(e.vvSize||e.vvColor)&&t.attributes.add(M.INSTANCEFEATUREATTRIBUTE,"vec4");const i=t.vertex;e.vvSize?(i.uniforms.add(new Jt("vvSizeMinSize",r=>r.vvSizeMinSize)),i.uniforms.add(new Jt("vvSizeMaxSize",r=>r.vvSizeMaxSize)),i.uniforms.add(new Jt("vvSizeOffset",r=>r.vvSizeOffset)),i.uniforms.add(new Jt("vvSizeFactor",r=>r.vvSizeFactor)),i.uniforms.add(new Ay("vvSymbolRotationMatrix",r=>r.vvSymbolRotationMatrix)),i.uniforms.add(new Jt("vvSymbolAnchor",r=>r.vvSymbolAnchor)),i.code.add(S`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),i.code.add(S`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${e.hasVvInstancing?S`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):i.code.add(S`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),e.vvColor?(i.constants.add("vvColorNumber","int",hm),e.hasVvInstancing&&i.uniforms.add([new cl("vvColorValues",r=>r.vvColorValues,hm),new T7("vvColorColors",r=>r.vvColorColors,hm)]),i.code.add(S`
      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {
        float value = featureAttribute.y;
        if (value <= values[0]) {
          return colors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (values[i] >= value) {
            float f = (value - values[i-1]) / (values[i] - values[i-1]);
            return mix(colors[i-1], colors[i], f);
          }
        }
        return colors[vvColorNumber - 1];
      }

      ${e.hasVvInstancing?S`
      vec4 vvColor() {
        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);
      }`:""}
    `)):i.code.add(S`vec4 vvColor() { return vec4(1.0); }`)}const Lz=.1,za=.001;function E2t(t){const e=new ji,i=t.signedDistanceFieldEnabled;if(e.include(nle),e.include(g4e,t),e.include(fs,t),t.occlusionPass)return e.include(T2t,t),e;const{vertex:r,fragment:n}=e;e.include(Lle),n.include(nh),n.include(Cy),e.include(ZR,t),e.include(x7,t),e.varyings.add("vcolor","vec4"),e.varyings.add("vtc","vec2"),e.varyings.add("vsize","vec2"),t.binaryHighlightOcclusionEnabled&&e.varyings.add("voccluded","float"),r.uniforms.add([new bi("viewport",(c,h)=>h.camera.fullViewport),new Wi("screenOffset",(c,h)=>dt(H4e,2*c.screenOffset[0]*h.camera.pixelRatio,2*c.screenOffset[1]*h.camera.pixelRatio)),new Wi("anchorPosition",c=>Dz(c)),new bi("materialColor",c=>c.color),new Ie("pixelRatio",(c,h)=>h.camera.pixelRatio)]),i&&(r.uniforms.add(new bi("outlineColor",c=>c.outlineColor)),n.uniforms.add([new bi("outlineColor",c=>f_e(c)?c.outlineColor:Qg),new Ie("outlineSize",c=>f_e(c)?c.outlineSize:0)])),t.hasScreenSizePerspective&&(ASt(r),b7(r)),(t.debugDrawLabelBorder||t.binaryHighlightOcclusionEnabled)&&e.varyings.add("debugBorderCoords","vec4"),e.attributes.add(M.UV0,"vec2"),e.attributes.add(M.COLOR,"vec4"),e.attributes.add(M.SIZE,"vec2"),e.attributes.add(M.AUXPOS2,"vec4"),r.code.add(S`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${t.hasScreenSizePerspective?S`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:S`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${t.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${t.occlusionTestEnabled||t.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${t.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const s=S`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,o=t.pixelSnappingEnabled?i?S`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:S`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:S`posProj += quadOffset;`;t.vvColor&&r.uniforms.add([new T7("vvColorColors",c=>c.vvColorColors,hm),new cl("vvColorValues",c=>c.vvColorValues,hm)]),r.uniforms.add(new Wi("textureCoordinateScaleFactor",c=>v(c.texture)&&v(c.texture.descriptor.textureCoordinateScaleFactor)?c.texture.descriptor.textureCoordinateScaleFactor:YIe)),r.code.add(S`
    ${t.occlusionTestEnabled?"if (visible) {":""}
    ${s}
    ${t.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${t.output===z.ObjectAndLayerIdColor?S`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${S.float(za)};
    ${i?`alphaDiscard = alphaDiscard && outlineColor.a < ${S.float(za)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${o}
      gl_Position = posProj;
    }

    vtc = uv * textureCoordinateScaleFactor;

    ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${t.occlusionTestEnabled?S`} else { vtc = vec2(0.0);
      ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),n.uniforms.add(new Dt("tex",c=>c.texture));const a=t.debugDrawLabelBorder?S`(isBorder > 0.0 ? 0.0 : ${S.float(Lz)})`:S.float(Lz),l=S`
    ${t.debugDrawLabelBorder?S`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${i?S`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${S.float($D)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${S.float(za)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:S`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${t.debugDrawLabelBorder?S`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;return t.output===z.Alpha&&n.code.add(S`
      void main() {
        ${l}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `),t.output===z.ObjectAndLayerIdColor&&n.code.add(S`
      void main() {
        ${l}
        outputObjectAndLayerIdColor();
      }
      `),t.output===z.Color&&n.code.add(S`
    void main() {
      ${l}
      ${t.transparencyPassType===At.FrontFace?"gl_FragColor.rgb /= gl_FragColor.a;":""}
    }
    `),t.output===z.Highlight&&(e.include(Q_,t),n.code.add(S`
    void main() {
      ${l}
      ${t.binaryHighlightOcclusionEnabled?S`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),e}function f_e(t){return t.outlineColor[3]>0&&t.outlineSize>0}function Dz(t,e=H4e){return t.textureIsSignedDistanceField?C2t(t.anchorPosition,t.distanceFieldBoundingBox,e):io(e,t.anchorPosition),e}function C2t(t,e,i){v(e)?dt(i,t[0]*(e[2]-e[0])+e[0],t[1]*(e[3]-e[1])+e[1]):dt(i,0,0)}const H4e=Fe(),A2t=Object.freeze(Object.defineProperty({__proto__:null,build:E2t,calculateAnchorPosForRendering:Dz},Symbol.toStringTag,{value:"Module"})),nd=_o(Ce.SRC_ALPHA,Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA,Ce.ONE_MINUS_SRC_ALPHA),R2t=Am(Ce.ONE,Ce.ONE),q4e=Am(Ce.ZERO,Ce.ONE_MINUS_SRC_ALPHA);function ev(t){return t===At.FrontFace?null:t===At.Alpha?q4e:R2t}function S7(t){return t===At.FrontFace?Kc:null}const E7=5e5,C7={factor:-1,units:-2};function A7(t){return t?C7:null}function jw(t,e=Gr.LESS){return t===At.NONE||t===At.FrontFace?e:Gr.LEQUAL}let W4e=class X4e extends Yi{initializeConfiguration(e,i){i.hasWebGL2Context=e.rctx.type===Et.WEBGL2,i.spherical=e.viewingMode===qe.Global}initializeProgram(e){return new Hi(e.rctx,X4e.shader.get().build(this.configuration),Di)}_setPipelineState(e){const i=this.configuration,r=e===At.NONE,n=e===At.FrontFace,s=this.configuration.hasPolygonOffset?M2t:null,o=(r||n)&&i.output!==z.Highlight&&(i.depthEnabled||i.occlusionPass)?Kc:null;return Ht({blending:i.output===z.Color||i.output===z.Alpha||i.output===z.Highlight?r?O2t:ev(e):null,depthTest:{func:Gr.LEQUAL},depthWrite:o,colorWrite:si,polygonOffset:s})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return this.configuration.occlusionPass?Ft.POINTS:Ft.TRIANGLES}};W4e.shader=new Gi(A2t,()=>Q(()=>import("./HUDMaterial.glsl-b27d1ea7.js"),[]));const M2t={factor:0,units:-4},O2t=Am(Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA);let os=class extends Do{constructor(){super(...arguments),this.output=z.Color,this.screenCenterOffsetUnitsEnabled=Bc.World,this.transparencyPassType=At.NONE,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.binaryHighlightOcclusionEnabled=!0,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.isDraped=!1,this.hasMultipassGeometry=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}};u([j({count:z.COUNT})],os.prototype,"output",void 0),u([j({count:Bc.COUNT})],os.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([j({count:At.COUNT})],os.prototype,"transparencyPassType",void 0),u([j()],os.prototype,"spherical",void 0),u([j()],os.prototype,"occlusionTestEnabled",void 0),u([j()],os.prototype,"signedDistanceFieldEnabled",void 0),u([j()],os.prototype,"vvSize",void 0),u([j()],os.prototype,"vvColor",void 0),u([j()],os.prototype,"hasVerticalOffset",void 0),u([j()],os.prototype,"hasScreenSizePerspective",void 0),u([j()],os.prototype,"debugDrawLabelBorder",void 0),u([j()],os.prototype,"binaryHighlightOcclusionEnabled",void 0),u([j()],os.prototype,"hasSlicePlane",void 0),u([j()],os.prototype,"hasPolygonOffset",void 0),u([j()],os.prototype,"depthEnabled",void 0),u([j()],os.prototype,"pixelSnappingEnabled",void 0),u([j()],os.prototype,"isDraped",void 0),u([j()],os.prototype,"hasMultipassGeometry",void 0),u([j()],os.prototype,"hasMultipassTerrain",void 0),u([j()],os.prototype,"cullAboveGround",void 0),u([j()],os.prototype,"occlusionPass",void 0),u([j()],os.prototype,"objectAndLayerIdColorInstanced",void 0),u([j({constValue:!0})],os.prototype,"hasSliceInVertexProgram",void 0),u([j({constValue:!1})],os.prototype,"hasVvInstancing",void 0);let iO=class extends Bw{constructor(e){super(e,new V2t),this._configuration=new os}getConfiguration(e,i){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?Bc.Screen:Bc.World,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.isDraped=this.parameters.isDraped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.vvSize=!!this.parameters.vvSizeEnabled,this._configuration.vvColor=!!this.parameters.vvColorEnabled,this._configuration.occlusionPass=i.slot===Ee.OCCLUSION_PIXELS&&this.parameters.occlusionTest&&(e===z.Color||e===z.Alpha),e===z.Color&&(this._configuration.debugDrawLabelBorder=!!tr.LABELS_SHOW_BORDER),e===z.Highlight&&(this._configuration.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.hasMultipassGeometry=i.multipassGeometry.enabled,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}intersect(e,i,r,n,s,o){if(!r.options.selectionMode||!r.options.hud||!e.visible)return;const a=this.parameters;let l=1,c=1;if(Dp(Rq,i),v(e.shaderTransformer)){const x=e.shaderTransformer(y_e);l=x[0],c=x[5],$2t(Rq)}const h=e.vertexAttributes.get(M.POSITION),p=e.vertexAttributes.get(M.SIZE),f=e.vertexAttributes.get(M.NORMAL),m=e.vertexAttributes.get(M.AUXPOS1);wt(h.size>=3);const g=r.point,_=r.camera,b=Dz(a);l*=_.pixelRatio,c*=_.pixelRatio;const w=this.parameters.centerOffsetUnits==="screen";for(let x=0;x<h.data.length/h.size;x++){const T=x*h.size;he(Ka,h.data[T],h.data[T+1],h.data[T+2]),Ke(Ka,Ka,i);const E=x*p.size;Pv[0]=p.data[E]*l,Pv[1]=p.data[E+1]*c,Ke(Ka,Ka,_.viewMatrix);const C=x*m.size;if(he(ph,m.data[C+0],m.data[C+1],m.data[C+2]),!w&&(Ka[0]+=ph[0],Ka[1]+=ph[1],ph[2]!==0)){const I=ph[2];we(ph,Ka),ge(Ka,Ka,le(ph,ph,I))}const A=x*f.size;if(he(q3,f.data[A],f.data[A+1],f.data[A+2]),this._normalAndViewAngle(q3,Rq,_,Mq),this._applyVerticalOffsetTransformationView(Ka,Mq,_,Aq),_.applyProjection(Ka,Ol),Ol[0]>-1){Ol[0]=Math.floor(Ol[0]),Ol[1]=Math.floor(Ol[1]),w&&(ph[0]||ph[1])&&(Ol[0]+=ph[0],ph[1]!==0&&(Ol[1]+=$le(ph[1],Aq.factorAlignment)),_.unapplyProjection(Ol,Ka)),Ol[0]+=this.parameters.screenOffset[0],Ol[1]+=this.parameters.screenOffset[1],a4e(Pv,Aq.factor,Pv);const I=F2t*_.pixelRatio;let O=0;if(a.textureIsSignedDistanceField&&(O=a.outlineSize*_.pixelRatio/2),g&&m_e(g,Ol[0],Ol[1],Pv,I,O,a,b)){const D=r.ray;if(Ke(g_e,Ka,wa(N2t,_.viewMatrix)),Ol[0]=g[0],Ol[1]=g[1],_.unprojectFromRenderScreen(Ol,Ka)){const U=P();ce(U,D.direction);const V=1/Pe(U);le(U,U,V),o(Lr(D.origin,Ka)*V,U,-1,!0,1,g_e)}}}}}intersectDraped(e,i,r,n,s,o){const a=e.vertexAttributes.get(M.POSITION),l=e.vertexAttributes.get(M.SIZE),c=this.parameters,h=Dz(c);let p=1,f=1;if(v(e.shaderTransformer)){const g=e.shaderTransformer(y_e);p=g[0],f=g[5]}p*=e.screenToWorldRatio,f*=e.screenToWorldRatio;const m=k2t*e.screenToWorldRatio;for(let g=0;g<a.data.length/a.size;g++){const _=g*a.size,b=a.data[_],w=a.data[_+1],x=g*l.size;Pv[0]=l.data[x]*p,Pv[1]=l.data[x+1]*f;let T=0;c.textureIsSignedDistanceField&&(T=c.outlineSize*e.screenToWorldRatio/2),m_e(n,b,w,Pv,m,T,c,h)&&s(o.dist,o.normal,-1,!1)}}createBufferWriter(){return new B2t(this)}_normalAndViewAngle(e,i,r,n){return CSt(i)&&(i=Dp(D2t,i)),Wl(n.normal,e,i),Ke(n.normal,n.normal,r.viewInverseTransposeMatrix),n.cosAngle=be(Y4e,U2t),n}_updateScaleInfo(e,i,r){const n=this.parameters;v(n.screenSizePerspective)?a_e(r,i,n.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),v(n.screenSizePerspectiveAlignment)?a_e(r,i,n.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)}applyShaderOffsetsView(e,i,r,n,s,o,a){const l=this._normalAndViewAngle(i,r,s,Mq);return this._applyVerticalGroundOffsetView(e,l,s,a),this._applyVerticalOffsetTransformationView(a,l,s,o),this._applyPolygonOffsetView(a,l,n[3],s,a),this._applyCenterOffsetView(a,n,a),a}applyShaderOffsetsNDC(e,i,r,n,s){return this._applyCenterOffsetNDC(e,i,r,n),v(s)&&ce(s,n),this._applyPolygonOffsetNDC(n,i,r,n),n}_applyPolygonOffsetView(e,i,r,n,s){const o=n.aboveGround?1:-1;let a=Math.sign(r);a===0&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return ce(s,e);const c=_e(Math.abs(i.cosAngle),.01,1),h=1-Math.sqrt(1-c*c)/c/n.viewport[2];return le(s,e,l>0?h:1/h),s}_applyVerticalGroundOffsetView(e,i,r,n){const s=Pe(e),o=r.aboveGround?1:-1,a=.5*r.computeRenderPixelSizeAtDist(s),l=le(Ka,i.normal,o*a);return me(n,e,l),n}_applyVerticalOffsetTransformationView(e,i,r,n){const s=this.parameters;if(!s.verticalOffset||!s.verticalOffset.screenLength){if(s.screenSizePerspective||s.screenSizePerspectiveAlignment){const c=Pe(e);this._updateScaleInfo(n,c,i.cosAngle)}else n.factor.scale=1,n.factorAlignment.scale=1;return e}const o=Pe(e),a=Nt(s.screenSizePerspectiveAlignment,s.screenSizePerspective),l=w4e(r,o,s.verticalOffset,i.cosAngle,a);return this._updateScaleInfo(n,o,i.cosAngle),le(i.normal,i.normal,l),me(e,e,i.normal)}_applyCenterOffsetView(e,i,r){const n=this.parameters.centerOffsetUnits!=="screen";return r!==e&&ce(r,e),n&&(r[0]+=i[0],r[1]+=i[1],i[2]&&(we(q3,r),me(r,r,le(q3,q3,i[2])))),r}_applyCenterOffsetNDC(e,i,r,n){const s=this.parameters.centerOffsetUnits!=="screen";return n!==e&&ce(n,e),s||(n[0]+=i[0]/r.fullWidth*2,n[1]+=i[1]/r.fullHeight*2),n}_applyPolygonOffsetNDC(e,i,r,n){const s=this.parameters.shaderPolygonOffset;if(e!==n&&ce(n,e),s){const o=r.aboveGround?1:-1,a=o*Math.sign(i[3]);n[2]-=(a||o)*s}return n}requiresSlot(e,i){if(i===z.Color||i===z.Alpha||i===z.Highlight||i===z.ObjectAndLayerIdColor){if(e===Ee.DRAPED_MATERIAL)return!0;const{drawInSecondSlot:r,occlusionTest:n}=this.parameters;return e===(r?Ee.LABEL_MATERIAL:Ee.HUD_MATERIAL)||n&&e===Ee.OCCLUSION_PIXELS}return!1}createGLMaterial(e){return new P2t(e)}calculateRelativeScreenBounds(e,i,r=Kt()){return I2t(this.parameters,e,i,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r}},P2t=class extends Uae{constructor(e){super({...e,...e.material.parameters})}selectProgram(e){return this.ensureTechnique(W4e,e)}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}};function I2t(t,e,i,r=L2t){return io(r,t.anchorPosition),r[0]*=-e[0],r[1]*=-e[1],r[0]+=t.screenOffset[0]*i,r[1]+=t.screenOffset[1]*i,r}function $2t(t){const e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=1/Math.sqrt(e*e+i*i+r*r),p=1/Math.sqrt(n*n+s*s+o*o),f=1/Math.sqrt(a*a+l*l+c*c);return t[0]=e*h,t[1]=i*h,t[2]=r*h,t[3]=n*p,t[4]=s*p,t[5]=o*p,t[6]=a*f,t[7]=l*f,t[8]=c*f,t}function m_e(t,e,i,r,n,s,o,a){let l=e-n-(a[0]>0?r[0]*a[0]:0),c=l+r[0]+2*n,h=i-n-(a[1]>0?r[1]*a[1]:0),p=h+r[1]+2*n;const f=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&v(f)&&(l+=r[0]*f[0],h+=r[1]*f[1],c-=r[0]*(1-f[2]),p-=r[1]*(1-f[3]),l-=s,c+=s,h-=s,p+=s),t[0]>l&&t[0]<c&&t[1]>h&&t[1]<p}const Aq=new E4e,L2t=Fe(),Ka=P(),q3=P(),Ol=pi(),Y4e=P(),g_e=P(),Rq=wr(),D2t=wr(),N2t=$e(),ph=P(),Mq={normal:Y4e,cosAngle:0},y_e=$e(),F2t=1,k2t=2,Pv=[0,0],U2t=Ue(0,0,1);let V2t=class extends NDe{constructor(){super(...arguments),this.renderOccluded=xn.Occlude,this.color=Zt(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=Mi(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.outlineColor=Zt(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.binaryHighlightOcclusion=!0,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1}};const Z4e=_n().vec3f(M.POSITION).vec3f(M.NORMAL).vec2f(M.UV0).vec4u8(M.COLOR).vec2f(M.SIZE).vec4f(M.AUXPOS1).vec4f(M.AUXPOS2),z2t=Z4e.clone().vec4u8(M.OBJECTANDLAYERIDCOLOR);let B2t=class{constructor(e){this._material=e,this.vertexBufferLayout=ue("enable-feature:objectAndLayerId-rendering")?z2t:Z4e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 6*e.indices.get(M.POSITION).length}write(e,i,r,n,s){w7(r.indices.get(M.POSITION),r.vertexAttributes.get(M.POSITION).data,e,n.position,s,6),kle(r.indices.get(M.NORMAL),r.vertexAttributes.get(M.NORMAL).data,i,n.normal,s,6);const o=r.vertexAttributes.get(M.UV0).data;let a,l,c,h;if(o==null||o.length<4){const w=this._material.parameters;a=0,l=0,c=w.texCoordScale[0],h=w.texCoordScale[1]}else a=o[0],l=o[1],c=o[2],h=o[3];c=Math.min(1.99999,c+1),h=Math.min(1.99999,h+1);let p=r.indices.get(M.POSITION).length,f=s;const m=n.uv0;for(let w=0;w<p;++w)m.set(f,0,a),m.set(f,1,l),f+=1,m.set(f,0,c),m.set(f,1,l),f+=1,m.set(f,0,c),m.set(f,1,h),f+=1,m.set(f,0,c),m.set(f,1,h),f+=1,m.set(f,0,a),m.set(f,1,h),f+=1,m.set(f,0,a),m.set(f,1,l),f+=1;Ule(r.indices.get(M.COLOR),r.vertexAttributes.get(M.COLOR).data,4,n.color,s,6);const g=r.indices.get(M.SIZE),_=r.vertexAttributes.get(M.SIZE).data;p=g.length;const b=n.size;f=s;for(let w=0;w<p;++w){const x=_[2*g[w]],T=_[2*g[w]+1];for(let E=0;E<6;++E)b.set(f,0,x),b.set(f,1,T),f+=1}if(r.indices.get(M.AUXPOS1)&&r.vertexAttributes.get(M.AUXPOS1)?tO(r.indices.get(M.AUXPOS1),r.vertexAttributes.get(M.AUXPOS1).data,n.auxpos1,s,6):p_e(n.auxpos1,s,6*p),r.indices.get(M.AUXPOS2)&&r.vertexAttributes.get(M.AUXPOS2)?tO(r.indices.get(M.AUXPOS2),r.vertexAttributes.get(M.AUXPOS2).data,n.auxpos2,s,6):p_e(n.auxpos2,s,6*p),v(r.objectAndLayerIdColor)&&r.indices.get(M.POSITION)){const w=r.indices.get(M.POSITION).length,x=n.getField(M.OBJECTANDLAYERIDCOLOR,vl);A4e(r.objectAndLayerIdColor,x,w,s,6)}}};const km=P(),NE=pi(),W3=pi(),Oq=P(),j2t=$e(),G2t=Is(),Pq=ko(),H2t=P(),q2t=Kt();class W2t{constructor(){this.aabr=Kt(),this.distance=0,this.culled=!1,this.visible=!1}}class X2t{constructor(e,i){this.graphics3DGraphic=e,this.slicePlaneEnabled=i,this.info={}}}var Au;(function(t){t[t.Idle=0]="Idle",t[t.Process=1]="Process",t[t.Sort=2]="Sort",t[t.Deconflict=3]="Deconflict",t[t.NumStates=4]="NumStates"})(Au||(Au={}));class J4e{constructor(){this.camera=new Pt,this.slicePlane=G_(),this.slicePlaneEnabled=!1}copyFrom(e){this.camera.copyFrom(e.camera),Z2(e.slicePlane,this.slicePlane),this.slicePlaneEnabled=e.slicePlaneEnabled}}let dR=class extends ve{get dirty(){return this._dirty}get state(){return this._state}constructor(t){super(t),this._dirty=!1,this._runningViewState=new J4e,this._state=Au.Idle,this._active=new Map,this._visible=new Map,this._iterators=new K2t,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null,this.accNumTests=0}destroy(){this._active.clear(),this._visible.clear(),this._iterators=null}setDirty(){!this._dirty&&this._active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==Au.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const t=this._state/Au.NumStates;return this._dirty?.5*t:t}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(t){switch(this._state){case Au.Idle:this._startUpdate(),t.madeProgress();case Au.Process:if(this._state=Au.Process,!this._processActiveGraphics(t))return;case Au.Sort:if(this._state=Au.Sort,!this._sortVisibleGraphics(t))return;case Au.Deconflict:if(this._state=Au.Deconflict,!this._deconflictVisibleGraphics(t))return;default:mSt(this,this._visible),this._state=Au.Idle,this.notifyChange("updating")}}modifyGraphics(t,e){e?t.forEach(i=>this.addToActiveGraphics(i)):t.forEach(i=>this.removeFromActiveGraphics(i)),this.setDirty()}layerSupportsDeconfliction(t){if(R(t)||t.type!=="object3d")return!1;const e=t.stageObject;if((e?e.geometries.length:0)!==1)return!1;const i=e==null?void 0:e.geometries[0];return(i==null?void 0:i.material)instanceof iO}_startUpdate(){gSt(this.view),this._dirty=!1,this._runningViewState.copyFrom(this.viewState);const{fullWidth:t,fullHeight:e}=this._runningViewState.camera;this._initBins(t,e),this._resetIterators()}addToActiveGraphics(t){t.info[this.visibilityGroup]=new W2t,this._active.set(t.graphics3DGraphic.graphic.uid,t),this.setDirty()}removeFromActiveGraphics(t){this._visible.delete(t.graphics3DGraphic.graphic.uid),Y2t(t,this.visibilityGroup),delete t.info[this.visibilityGroup],this._active.delete(t.graphics3DGraphic.graphic.uid),this.setDirty()}_processActiveGraphics(t){const e=this._ensureActiveGraphicsIterator(),i=TO(j2t,this._runningViewState.camera.projectionMatrix),r=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._runningViewState.camera.relativeElevation>0?G2t:null;let n=0;for(v(r)&&(Ke(r,dl,this._runningViewState.camera.viewMatrix),r[3]=sr(this.view.spatialReference).radius,n=$Le(r,dl));!t.done;){t.madeProgress();const s=e.next();if(s.done===!0)return this._resetActiveGraphicsIterator(),!0;const o=s.value,a=o&&o.info[this.visibilityGroup];a&&(this._collectGraphics3DGraphics(o,i,r,n),a.culled?this._visible.delete(o.graphics3DGraphic.graphic.uid):this._visible.set(o.graphics3DGraphic.graphic.uid,o))}return!1}_sortVisibleGraphics(t){const e=this._ensureSortGraphicsIterator();for(;!t.done;){const i=e.next();if(t.madeProgress(),i.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(t){const e=this._ensureVisibleGraphicsIterator(),i=this.visibilityGroup===ha.LABEL;for(;!t.done;){t.madeProgress();const r=e.next();if(r.done===!0)return this._resetVisibleGraphicsIterator(),!0;const n=r.value,s=n.info[this.visibilityGroup];if(!s||s.culled)continue;const o=n.graphics3DGraphic,a=(!i||o.isVisible())&&!this._isConflicted(n);a&&this._addToBins(n),s.visible=a,this._setGraphicVisibility(n,a),_St(s,a)}return!1}_resetIterators(){this._iterators.active=null,this._iterators.visible=null,this._iterators.sort=null}_ensureActiveGraphicsIterator(){return this._iterators.active||(this._iterators.active=__e(this._active)),this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){return this._iterators.visible||(this._iterators.visible=__e(this._visible)),this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){return this._iterators.sort||(this._iterators.sort=Z2t(this._visible,this._iterators.sortArray,this.visibilityGroup)),this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(t,e,i,r){const n=t.graphics3DGraphic;if(n.destroyed)return;const s=t.info[this.visibilityGroup];if(!n.isVisible(ha.GRAPHIC,Fu.DECONFLICTION))return void(s.culled=!0);const o=this.getGraphicsLayers(n);od(s.aabr);let a=null;for(const l of o){if(!this.layerSupportsDeconfliction(l))continue;const c=l.stageObject.geometries[0].material;if(R(a)){if(a=tEt,this._getProjectionInfo(l,e,a),a.isOutsideScreen||this._isCulledBySlice(t,km)||v(i)&&this._isCulledByHorizon(a,i,r))return void(s.culled=!0);!tr.TESTS_DISABLE_OPTIMIZATIONS&&s.visible&&(a.distance*=.7)}this._expandBoundingRect(s,l,c,a)}R(a)?s.culled=!0:(s.distance=a.distance,s.culled=!1)}_getProjectionInfo(t,e,i){const r=this._runningViewState.camera,n=t.stageObject,s=n.geometries[0],o=s.material,a=n.boundingVolumeWorldSpace.bounds;Ke(km,a,r.viewMatrix);const l=s.vertexAttributes,c=l.get(M.NORMAL).data,h=l.get(M.AUXPOS1).data;o.applyShaderOffsetsView(km,c,n.transformation,h,r,i.scaleInfo,km),cr(NE,km[0],km[1],km[2],1),Jh(W3,NE,r.projectionMatrix),le(i.positionNDC,W3,1/W3[3]),o.applyShaderOffsetsNDC(i.positionNDC,h,r,i.positionNDC,Oq),i.distanceWithoutPolygonOffset=r.depthNDCToWorld(Oq[2]),i.distance=Oq[2]===i.positionNDC[2]?i.distanceWithoutPolygonOffset:r.depthNDCToWorld(i.positionNDC[2]),cr(W3,i.positionNDC[0],i.positionNDC[1],i.positionNDC[2],1),Jh(NE,W3,e),gO(NE,NE,1/NE[3]),he(i.positionView,km[0],km[1],km[2])}_isCulledByHorizon(t,e,i){return ce(Pq.direction,t.positionView),he(Pq.origin,0,0,0),!!Vw(e,Pq,H2t)&&t.distanceWithoutPolygonOffset>i}_isCulledBySlice(t,e){return t.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&Sae(this._runningViewState.slicePlane,e)}_expandBoundingRect(t,e,i,{positionNDC:r,scaleInfo:n}){const s=this._runningViewState.camera,o=e.getScreenSize(Q2t);a4e(o,n.factor,o),o[0]*=s.pixelRatio,o[1]*=s.pixelRatio;const a=oV(i.calculateRelativeScreenBounds(o,n.factorAlignment.scale,q2t),Bt(0,s.fullWidth,.5+.5*r[0]),Bt(0,s.fullHeight,.5+.5*r[1])),l=this.iconMarginFactor;if(l!==0){const c=l*Math.min(Wh(a),gm(a));a[0]-=c,a[1]-=c,a[2]+=c,a[3]+=c}kb(t.aabr,a,t.aabr)}_isConflicted(t){const e=t.graphics3DGraphic.graphic.uid,i=t.info[this.visibilityGroup];for(let r=Math.floor(i.aabr[0]/this._accBinsSizeX);r<=Math.floor(i.aabr[2]/this._accBinsSizeX);r++)if(!(r<0||r>=this._accBinsNumX))for(let n=Math.floor(i.aabr[1]/this._accBinsSizeY);n<=Math.floor(i.aabr[3]/this._accBinsSizeY);n++){if(n<0||n>=this._accBinsNumY)continue;const s=this._accBins[r][n];for(let o=0;o<s.length;o++){const a=s.data[o],l=a.info[this.visibilityGroup];if(l&&l.visible&&a.graphics3DGraphic.graphic.uid!==e&&(this.accNumTests++,W9(l.aabr,i.aabr)))return!0}}return!1}_initBins(t,e){if(this._accBins==null){this._accBins=[];for(let i=0;i<this._accBinsNumX;i++){this._accBins.push([]);const r=this._accBins[this._accBins.length-1];for(let n=0;n<this._accBinsNumY;n++)r.push(new Wt)}}else for(let i=0;i<this._accBinsNumX;i++)for(let r=0;r<this._accBinsNumY;r++)this._accBins[i][r].clear();this._accBinsSizeX=t/this._accBinsNumX,this._accBinsSizeY=e/this._accBinsNumY,this.accNumTests=0}_addToBins(t){const e=t.info[this.visibilityGroup],i=Math.floor(e.aabr[0]/this._accBinsSizeX),r=Math.floor(e.aabr[2]/this._accBinsSizeX),n=Math.floor(e.aabr[1]/this._accBinsSizeY),s=Math.floor(e.aabr[3]/this._accBinsSizeY);for(let o=i;o<=r;o++)if(!(o<0||o>=this._accBinsNumX))for(let a=n;a<=s;a++)a<0||a>=this._accBinsNumY||this._accBins[o][a].push(t)}_setGraphicVisibility(t,e){const i=t.graphics3DGraphic;i.destroyed||(i.setVisibilityFlag(Fu.DECONFLICTION,e,this.visibilityGroup),this.visibilityGroup===ha.LABEL&&this.view.labeler.setLabelGraphicVisibility(i,e))}};function Y2t(t,e){const i=t.graphics3DGraphic;i.destroyed||i.clearVisibilityFlag(Fu.DECONFLICTION,e)}function*__e(t){if(Map.prototype.entries){const e=t.entries();for(let i=e.next();!i.done;i=e.next())yield i.value[1]}else yield*t.values()}function*Z2t(t,e,i){e.clear(),t.forEach((n,s)=>{const o=e.pushNew();o.id=s,o.visible=n.graphics3DGraphic.hasVisibilityFlag(Fu.DECONFLICTION,i),o.prio=n.info?n.info[i].distance:Number.MAX_VALUE}),yield;const r=e.iterableSort((n,s)=>n.visible!==s.visible?n.visible?-1:1:n.prio!==s.prio?n.prio-s.prio:n.id-s.id);for(let n=r.next();!n.done;n=r.next())yield;e.forAll(n=>{const s=t.get(n.id);s&&(t.delete(n.id),t.set(n.id,s))}),e.clear()}u([d({constructOnly:!0})],dR.prototype,"view",void 0),u([d({type:Boolean,readOnly:!0})],dR.prototype,"updating",null),dR=u([$("esri.views.3d.layers.graphics.Deconflictor")],dR);class J2t{}class K2t{constructor(e=null,i=null,r=null){this.active=e,this.visible=i,this.sort=r,this.sortArray=new Wt({allocator:n=>n||new J2t})}}const Q2t=Fe();class eEt{constructor(){this.positionView=P(),this.positionNDC=P(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo=new E4e}get isOutsideScreen(){const e=this.positionNDC;return e[0]<-1||e[1]<-1||e[2]<-1||e[0]>=1||e[1]>=1}}const tEt=new eEt,iEt=2e3;let zU=class extends dR{constructor(e){super(e),this.visibilityGroup=ha.LABEL,this.iconMarginFactor=0,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return Ga.YIELD;const i=performance.now();if(e.state!==Pi.IDLE&&i-this._lastDeconfliction<iEt)return Ga.YIELD;super.runTask(e),this.state===Au.Idle&&(this._lastDeconfliction=i)}enabledChanged(e,i){this.modifyGraphics(i,e.labelsEnabled)}getGraphicsLayers(e){return e.labelLayers}};u([d({constructOnly:!0})],zU.prototype,"parent",void 0),zU=u([$("esri.views.3d.layers.graphics.LabelDeconflictor")],zU);let Ete=class extends dR{constructor(){super(...arguments),this._handles=new Xi,this._contexts=new Map,this._viewState=new J4e,this.visibilityGroup=ha.GRAPHIC,this._iconMarginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._handles.add([ne(()=>{var e,i;return(i=(e=this.view)==null?void 0:e.state)==null?void 0:i.camera},()=>{this._updateViewState(),this.setDirty()}),ne(()=>{var e,i,r;return(r=(i=(e=this.view)==null?void 0:e.map)==null?void 0:i.ground)==null?void 0:r.opacity},(e,i)=>{e!==1&&i!==1||this.setDirty()}),ne(()=>{var e;return(e=this.view)==null?void 0:e.slicePlane},()=>{this._updateSlicePlane(),this._slicePlaneChanged()},zt)]),this._frameTask=this.view.resourceController.scheduler.registerTask(St.GRAPHICS_DECONFLICTOR,this),this._labels=new zU({view:this.view,parent:this})}destroy(){this._labels.destroy(),this._labels=null,this._handles.destroy(),this._handles=null,this._frameTask&&(this._frameTask.remove(),this._frameTask=null)}get iconMarginFactor(){return this._iconMarginFactor}set iconMarginFactor(e){this._iconMarginFactor=e,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(e,i){const r=!(this._graphicSupportsDeconfliction(i)&&Iq(e));i.setVisibilityFlag(Fu.DECONFLICTION,r,ha.GRAPHIC)}_updateViewState(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;v(e)&&XLe(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=v(e)}_slicePlaneChanged(){pa(this._contexts,(e,i)=>i.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){const i=this._getGraphicsContext(e);return{addGraphic:r=>this._addGraphic(e,i,r),removeGraphic:r=>this._removeGraphic(i,r),labelingInfoChange:()=>this._labels.enabledChanged(e,i),featureReductionChange:()=>this.enabledChanged(e,i),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,i),clear:()=>i.forEach(r=>this._removeGraphic(i,r.graphics3DGraphic))}}removeGraphicsOwner(e){const i=this._contexts.get(e);i&&(i.forEach(r=>this._removeGraphic(i,r.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,i,r){const n=r.graphic.uid,s=new X2t(r,e.symbolCreationContext.slicePlaneEnabled);i.set(n,s),Iq(e)&&this.addToActiveGraphics(s),e.labelsEnabled&&this._labels.addToActiveGraphics(s)}_removeGraphic(e,i){const r=i.graphic.uid,n=e.get(r);n&&(this.removeFromActiveGraphics(n),this._labels.removeFromActiveGraphics(n),e.delete(r),this.setDirty())}enabledChanged(e,i){const r=Iq(e);r||rEt(e),this.modifyGraphics(i,r)}_slicePlaneEnabledChanged(e,i){const r=e.symbolCreationContext.slicePlaneEnabled;i.forEach(n=>n.slicePlaneEnabled=r),this.setDirty()}getGraphicsLayers(e){return e.layers}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const i=e.layers;if(!i||!i.length)return!1;for(const r of i)if(this.layerSupportsDeconfliction(r))return!0;return!1}_getGraphicsContext(e){const i=this._contexts.get(e);if(i)return i;const r=new Map;return this._contexts.set(e,r),this.setDirty(),r}};function Iq(t){const e=t.layer;return!(!e||!e.featureReduction||e.featureReduction.type!=="selection")}function rEt(t){const e=t.graphics3DGraphics;e&&e.forEach(i=>i.clearVisibilityFlag(Fu.DECONFLICTION))}Ete=u([$("esri.views.3d.layers.graphics.GraphicsDeconflictor")],Ete);const qO=(t,e,i)=>[e,i],kp=(t,e,i)=>[e,i,t[2]],WO=(t,e,i)=>[e,i,t[2],t[3]];function cYt(t){return t?{originPosition:t.originPosition==="upper-left"?"upperLeft":t.originPosition==="lower-left"?"lowerLeft":t.originPosition,scale:t.tolerance?[t.tolerance,t.tolerance]:[1,1],translate:v(t.extent)?[t.extent.xmin,t.extent.ymax]:[0,0]}:null}function LD({scale:t,translate:e},i){return Math.round((i-e[0])/t[0])}function DD({scale:t,translate:e},i){return Math.round((e[1]-i)/t[1])}function Hle(t,e,i){const r=[];let n,s,o,a;for(let l=0;l<i.length;l++){const c=i[l];l>0?(o=LD(t,c[0]),a=DD(t,c[1]),o===n&&a===s||(r.push(e(c,o-n,a-s)),n=o,s=a)):(n=LD(t,c[0]),s=DD(t,c[1]),r.push(e(c,n,s)))}return r.length>0?r:null}function nEt(t,e,i,r){return Hle(t,i?r?WO:kp:r?kp:qO,e)}function sEt(t,e,i,r){const n=[],s=i?r?WO:kp:r?kp:qO;for(let o=0;o<e.length;o++){const a=Hle(t,s,e[o]);a&&a.length>=3&&n.push(a)}return n.length?n:null}function oEt(t,e,i,r){const n=[],s=i?r?WO:kp:r?kp:qO;for(let o=0;o<e.length;o++){const a=Hle(t,s,e[o]);a&&a.length>=2&&n.push(a)}return n.length?n:null}function K4e({scale:t,translate:e},i){return i*t[0]+e[0]}function Q4e({scale:t,translate:e},i){return e[1]-i*t[1]}function e5e(t,e,i){const r=new Array(i.length);if(!i.length)return r;const[n,s]=t.scale;let o=K4e(t,i[0][0]),a=Q4e(t,i[0][1]);r[0]=e(i[0],o,a);for(let l=1;l<i.length;l++){const c=i[l];o+=c[0]*n,a-=c[1]*s,r[l]=e(c,o,a)}return r}function t5e(t,e,i){const r=new Array(i.length);for(let n=0;n<i.length;n++)r[n]=e5e(t,e,i[n]);return r}function aEt(t,e,i,r){return e5e(t,i?r?WO:kp:r?kp:qO,e)}function lEt(t,e,i,r){return t5e(t,i?r?WO:kp:r?kp:qO,e)}function cEt(t,e,i,r){return t5e(t,i?r?WO:kp:r?kp:qO,e)}function uEt(t,e,i,r,n){return e.xmin=LD(t,i.xmin),e.ymin=DD(t,i.ymin),e.xmax=LD(t,i.xmax),e.ymax=DD(t,i.ymax),e!==i&&(r&&(e.zmin=i.zmin,e.zmax=i.zmax),n&&(e.mmin=i.mmin,e.mmax=i.mmax)),e}function hEt(t,e,i,r,n){return e.points=nEt(t,i.points,r,n)??[],e}function dEt(t,e,i,r,n){return e.x=LD(t,i.x),e.y=DD(t,i.y),e!==i&&(r&&(e.z=i.z),n&&(e.m=i.m)),e}function pEt(t,e,i,r,n){const s=sEt(t,i.rings,r,n);return s?(e.rings=s,e):null}function fEt(t,e,i,r,n){const s=oEt(t,i.paths,r,n);return s?(e.paths=s,e):null}function uYt(t,e){return t&&e?yN(e)?dEt(t,{},e,!1,!1):dO(e)?fEt(t,{},e,!1,!1):s_(e)?pEt(t,{},e,!1,!1):gN(e)?hEt(t,{},e,!1,!1):D9(e)?uEt(t,{},e,!1,!1):null:null}function i5e(t,e,i,r,n){return v(i)&&(e.points=aEt(t,i.points,r,n)),e}function r5e(t,e,i,r,n){return R(i)||(e.x=K4e(t,i.x),e.y=Q4e(t,i.y),e!==i&&(r&&(e.z=i.z),n&&(e.m=i.m))),e}function n5e(t,e,i,r,n){return v(i)&&(e.rings=cEt(t,i.rings,r,n)),e}function s5e(t,e,i,r,n){return v(i)&&(e.paths=lEt(t,i.paths,r,n)),e}let hYt=class{constructor(e,i,r){this.uid=e,this.geometry=i,this.attributes=r,this.visible=!0,this.objectId=null,this.centroid=null}};function pYt(t){return v(t.geometry)}let fYt=class{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}};function gYt(t){var s;const e=vEe.fromJSON(t.geometryType),i=Je.fromJSON(t.spatialReference),r=t.transform,n=t.features.map(o=>{const a=mEt(o,e,i,t.objectIdFieldName),l=a.geometry;if(v(l)&&r)switch(l.type){case"point":a.geometry=r5e(r,l,l,l.hasZ,l.hasM);break;case"multipoint":a.geometry=i5e(r,l,l,!!l.hasZ,!!l.hasM);break;case"polygon":a.geometry=n5e(r,l,l,!!l.hasZ,!!l.hasM);break;case"polyline":a.geometry=s5e(r,l,l,!!l.hasZ,!!l.hasM);break;case"extent":case"mesh":a.geometry=l}return a});return{geometryType:e,features:n,spatialReference:i,fields:((s=t.fields)==null?void 0:s.map(o=>xB.fromJSON(o)))??[],objectIdFieldName:t.objectIdFieldName,globalIdFieldName:t.globalIdFieldName,geohashFieldName:t.geohashFieldName,geometryProperties:t.geometryProperties,hasZ:t.hasZ,hasM:t.hasM,exceededTransferLimit:t.exceededTransferLimit,transform:null}}function mEt(t,e,i,r){return{uid:qu(),objectId:r&&t.attributes?t.attributes[r]:null,attributes:t.attributes,geometry:gEt(t.geometry,e,i),visible:!0}}function gEt(t,e,i){if(R(t))return null;switch(e){case"point":{const r=t;return{x:r.x,y:r.y,z:r.z,m:r.m,hasZ:r.z!=null,hasM:r.m!=null,type:"point",spatialReference:i}}case"polyline":{const r=t;return{paths:r.paths,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polyline",spatialReference:i}}case"polygon":{const r=t;return{rings:r.rings,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polygon",spatialReference:i}}case"multipoint":{const r=t;return{points:r.points,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"multipoint",spatialReference:i}}}}function tv(t,e,i,r){return{x:t,y:e,z:i,hasZ:i!=null,hasM:!1,spatialReference:r,type:"point"}}function yEt(t){if(R(t))return 0;let e=32;switch(t.type){case"point":e+=42;break;case"polyline":case"polygon":{let i=0;const r=2+(t.hasZ?1:0)+(t.hasM?1:0),n=t.type==="polyline"?t.paths:t.rings;for(const s of n)i+=s.length;e+=8*i*r+64,e+=128*i,e+=34,e+=32*(n.length+1);break}case"multipoint":{const i=2+(t.hasZ?1:0)+(t.hasM?1:0),r=t.points.length;e+=8*r*i+64,e+=128*r,e+=34,e+=32;break}case"extent":e+=98,t.hasM&&(e+=32),t.hasZ&&(e+=32);break;case"mesh":e+=OF(t.vertexAttributes.position),e+=OF(t.vertexAttributes.normal),e+=OF(t.vertexAttributes.uv),e+=OF(t.vertexAttributes.tangent)}return e}function yYt(t){let e=32;return e+=_Me(t.attributes),e+=3,e+=8+yEt(t.geometry),e}function _Et(t){if(R(t))return 0;switch(t.type){case"point":return 1;case"polyline":{let e=0;for(const i of t.paths)e+=i.length;return e}case"polygon":{let e=0;for(const i of t.rings)e+=i.length;return e}case"multipoint":return t.points.length;case"extent":return 2;case"mesh":{const e=t.vertexAttributes&&t.vertexAttributes.position;return e?e.length/3:0}default:return}}function _Yt(t){if(R(t))return!1;switch(t.type){case"extent":case"point":return!0;case"polyline":for(const e of t.paths)if(e.length>0)return!0;return!1;case"polygon":for(const e of t.rings)if(e.length>0)return!0;return!1;case"multipoint":return t.points.length>0;case"mesh":return!t.loaded||t.vertexAttributes.position.length>0}}function vYt(t,e){switch(Br(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[3]=t.x,e[1]=e[4]=t.y,t.hasZ&&(e[2]=e[5]=t.z);break;case"polyline":for(let i=0;i<t.paths.length;i++)qj(e,t.paths[i],!!t.hasZ);break;case"polygon":for(let i=0;i<t.rings.length;i++)qj(e,t.rings[i],!!t.hasZ);break;case"multipoint":qj(e,t.points,!!t.hasZ);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[3]=t.xmax,e[4]=t.ymax,t.zmin!=null&&(e[2]=t.zmin),t.zmax!=null&&(e[5]=t.zmax)}}function vEt(t,e){switch(od(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[2]=t.x,e[1]=e[3]=t.y;break;case"polyline":for(let i=0;i<t.paths.length;i++)Hj(e,t.paths[i]);break;case"polygon":for(let i=0;i<t.rings.length;i++)Hj(e,t.rings[i]);break;case"multipoint":Hj(e,t.points);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax}}function bYt(t,e){return t.objectId!=null?t.objectId:t.attributes&&e?t.attributes[e]:null}function o5e(t){return"declaredClass"in t}function v_e(t){return"declaredClass"in t}function bEt(t){return"declaredClass"in t}function wEt(t,e){return t?bEt(t)?t:new Ha({layer:e,sourceLayer:e,visible:t.visible,symbol:se(t.symbol),attributes:se(t.attributes),geometry:a5e(t.geometry)}):null}function a5e(t){return R(t)?null:o5e(t)?t:ly(xEt(t))}function xEt(t){const{wkid:e,wkt:i,latestWkid:r}=t.spatialReference,n={wkid:e,wkt:i,latestWkid:r};switch(t.type){case"point":{const{x:s,y:o,z:a,m:l}=t;return{x:s,y:o,z:a,m:l,spatialReference:n}}case"polygon":{const{rings:s,hasZ:o,hasM:a}=t;return{rings:b_e(s),hasZ:o,hasM:a,spatialReference:n}}case"polyline":{const{paths:s,hasZ:o,hasM:a}=t;return{paths:b_e(s),hasZ:o,hasM:a,spatialReference:n}}case"extent":{const{xmin:s,xmax:o,ymin:a,ymax:l,zmin:c,zmax:h,mmin:p,mmax:f,hasZ:m,hasM:g}=t;return{xmin:s,xmax:o,ymin:a,ymax:l,zmin:c,zmax:h,mmin:p,mmax:f,hasZ:m,hasM:g,spatialReference:n}}case"multipoint":{const{points:s,hasZ:o,hasM:a}=t;return{points:c5e(s)?l5e(s):s,hasZ:o,hasM:a,spatialReference:n}}default:return}}function b_e(t){return TEt(t)?t.map(e=>l5e(e)):t}function l5e(t){return t.map(e=>Array.from(e))}function TEt(t){for(const e of t)if(e.length!==0)return c5e(e);return!1}function c5e(t){return t.length>0&&(Bre(t[0])||jre(t[0]))}function SEt(t,e){if(!t)return null;let i;if(v_e(t)){if(e==null)return t.clone();if(v_e(e))return e.copy(t)}return e!=null?(i=e,i.x=t.x,i.y=t.y,i.spatialReference=t.spatialReference,t.hasZ?(i.z=t.z,i.hasZ=t.hasZ):(i.z=void 0,i.hasZ=!1),t.hasM?(i.m=t.m,i.hasM=!0):(i.m=void 0,i.hasM=!1)):(i=tv(t.x,t.y,t.z,t.spatialReference),t.hasM&&(i.m=t.m,i.hasM=!0)),i}function wYt(t){const{wkid:e,wkt:i,latestWkid:r}=t,n={wkid:e,wkt:i,latestWkid:r};return Je.fromJSON(n)}const $q=re.getLogger("esri.layers.support.labelFormatUtils"),Lq={type:"simple",evaluate:()=>null},EEt={getAttribute:(t,e)=>t.field(e)};async function u5e(t,e,i){if(!t||!t.symbol||!e)return Lq;const r=t.where,n=PB(t),s=r?await Q(()=>import("./WhereClause-cdddccc4.js").then(a=>a.W),["assets/WhereClause-cdddccc4.js","assets/executionError-fb3f283a.js"]):null;let o;if(n.type==="arcade"){const a=await fHe(n.expression,i,e);if(R(a))return Lq;o={type:"arcade",evaluate(l){try{const c=a.evaluate({$feature:"attributes"in l?a.repurposeFeature(l):l});if(c!=null)return c.toString()}catch{$q.error(new H("arcade-expression-error","Encountered an error when evaluating label expression for feature",{feature:l,expression:n}))}return null},needsHydrationToEvaluate:()=>Coe(n.expression)==null}}else o={type:"simple",evaluate:a=>n.expression.replace(/{[^}]*}/g,l=>{const c=l.slice(1,-1),h=e.get(c);if(!h)return l;let p=null;return"attributes"in a?a&&a.attributes&&(p=a.attributes[h.name]):p=a.field(h.name),p==null?"":h5e(p,h)})};if(r){let a;try{a=s.WhereClause.create(r,e)}catch(c){return $q.error(new H("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:r,error:c})),Lq}const l=o.evaluate;o.evaluate=c=>{const h="attributes"in c?void 0:EEt;try{if(a.testFeature(c,h))return l(c)}catch(p){$q.error(new H("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:r,feature:c,error:p}))}return null}}return o}function h5e(t,e){if(t==null)return"";const i=e.domain;if(i){if(i.type==="codedValue"||i.type==="coded-value"){const n=t;for(const s of i.codedValues)if(s.code===n)return s.name}else if(i.type==="range"){const n=+t,s="range"in i?i.range[0]:i.minValue,o="range"in i?i.range[1]:i.maxValue;if(s<=n&&n<=o)return i.name}}let r=t;return e.type==="date"||e.type==="esriFieldTypeDate"?r=uy(r,F9("short-date")):N9(e)&&(r=hy(+r)),r||""}const xYt=Object.freeze(Object.defineProperty({__proto__:null,createLabelFunction:u5e,formatField:h5e},Symbol.toStringTag,{value:"Module"}));let d5e=class{constructor(e=null,i="center",r="center",n=null,s=[0,0,0],o=0,a=[0,0,0,1],l=[0,0],c="world",h=0,p=0){this.verticalOffset=e,this.horizontalPlacement=i,this.verticalPlacement=r,this.text=n,this.translation=s,this.elevationOffset=o,this.centerOffset=a,this.screenOffset=l,this.centerOffsetUnits=c,this.displayWidth=h,this.displayHeight=p}};function qle(t,e){if(t.type==="point")return Iv(t,e,!1);if(o5e(t))switch(t.type){case"extent":return Iv(t.center,e,!1);case"polygon":return Iv(t.centroid,e,!1);case"polyline":return Iv(w_e(t),e,!0);case"mesh":return Iv(t.origin,e,!1)}else switch(t.type){case"extent":return Iv(CEt(t),e,!0);case"polygon":return Iv(AEt(t),e,!0);case"polyline":return Iv(w_e(t),e,!0)}}function w_e(t){const e=t.paths[0];if(!e||e.length===0)return null;const i=rEe(e,iEe(e)/2);return tv(i[0],i[1],i[2],t.spatialReference)}function CEt(t){return tv(.5*(t.xmax+t.xmin),.5*(t.ymax+t.ymin),t.zmin!=null&&t.zmax!=null&&isFinite(t.zmin)&&isFinite(t.zmax)?.5*(t.zmax+t.zmin):void 0,t.spatialReference)}function AEt(t){const e=t.rings[0];if(!e||e.length===0)return null;const i=hne(t.rings,!!t.hasZ);return tv(i[0],i[1],i[2],t.spatialReference)}function Iv(t,e,i){const r=i?t:SEt(t);return e&&t?xZe(t,r,e)?r:null:r}function SYt(t,e,i,r=0){if(t){e||(e=Kt());const n=t;let s=.5*n.width*(i-1),o=.5*n.height*(i-1);return n.width<1e-7*n.height?s+=o/20:n.height<1e-7*n.width&&(o+=s/20),cr(e,n.xmin-s-r,n.ymin-o-r,n.xmax+s+r,n.ymax+o+r),e}return null}function p5e(t,e){for(let i=0;i<t.geometries.length;++i){const r=t.geometries[i].getMutableAttribute(M.AUXPOS1);r&&r.data[3]!==e&&(r.data[3]=e,t.geometryVertexAttrsUpdated(t.geometries[i]))}}function tL(t,e){const i=DN(dp);return v(t)&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),v(e)?i[3]=e:v(t)&&t.length>3&&(i[3]=t[3]),i}function EYt(t,e,i,r,n,s=[0,0,0,0]){for(let o=0;o<3;++o)v(t)&&t[o]!=null?s[o]=t[o]:v(i)&&i[o]!=null?s[o]=i[o]:s[o]=n[o];return v(e)?s[3]=e:v(r)?s[3]=r:s[3]=n[3],s}function x_e(t=Vg,e,i,r=1){const n=new Array(3);if(R(e)||R(i))n[0]=1,n[1]=1,n[2]=1;else{let s,o=0;for(let a=2;a>=0;a--){const l=t[a];let c;const h=l!=null,p=a===0&&!s&&!h,f=i[a];l==="symbol-value"||p?c=f!==0?e[a]/f:1:h&&l!=="proportional"&&isFinite(l)&&(c=f!==0?l/f:1),c!=null&&(n[a]=c,s=c,o=Math.max(o,Math.abs(c)))}for(let a=2;a>=0;a--)n[a]==null?n[a]=s:n[a]===0&&(n[a]=.001*o)}for(let s=2;s>=0;s--)n[s]/=r;return Fc(n)}function REt(t){return t.isPrimitive!=null}function R7(t){return Nz(REt(t)?[t.width,t.depth,t.height]:t)?null:"Symbol sizes may not be negative values"}function Nz(t){if(Array.isArray(t)){for(const e of t)if(!Nz(e))return!1;return!0}return t==null||t>=0}function MEt(t,e,i,r=$e()){const n=t||0,s=e||0,o=i||0;return n!==0&&RM(r,r,-n/180*Math.PI),s!==0&&AM(r,r,s/180*Math.PI),o!==0&&nB(r,r,o/180*Math.PI),r}function Wle(t,e,i){if(i.minDemResolution!=null)return i.minDemResolution;const r=tc(e),n=B2(t)*r,s=j2(t)*r,o=Lw(t)*(e.isGeographic?1:r);return n===0&&s===0&&o===0?i.minDemResolutionForPoints:.01*Math.max(n,s,o)}function f5e(t,e,i,r,n,s,o,a,l,c,h){const p=FEt[h.mode];let f,m,g=0;if(Nn(t,e,i,r,l.spatialReference,n,a))return p.requiresAlignment(h)?(g=p.applyElevationAlignmentBuffer(r,n,s,o,a,l,c,h),f=s,m=o):(f=r,m=n),Nn(f,l.spatialReference,m,s,c.spatialReference,o,a)?g:void 0}function XO(t,e,i,r,n){const s=(Ez(t)?t.z:NFe(t)?t.array[t.offset+2]:t[2])||0;switch(i.mode){case"on-the-ground":{const o=Nt(jg(e,t,"ground"),0);return n.verticalDistanceToGround=0,n.sampledElevation=o,void(n.z=o)}case"relative-to-ground":{const o=Nt(jg(e,t,"ground"),0),a=i.geometryZWithOffset(s,r);return n.verticalDistanceToGround=a,n.sampledElevation=o,void(n.z=a+o)}case"relative-to-scene":{const o=Nt(jg(e,t,"scene"),0),a=i.geometryZWithOffset(s,r);return n.verticalDistanceToGround=a,n.sampledElevation=o,void(n.z=a+o)}case"absolute-height":{const o=i.geometryZWithOffset(s,r),a=Nt(jg(e,t,"ground"),0);return n.verticalDistanceToGround=o-a,n.sampledElevation=a,void(n.z=o)}default:return void(n.z=0)}}function OEt(t,e,i,r){return XO(t,e,i,r,pR),pR.z}function tF(t,e,i){return e==null||i==null?t.definedChanged:e==="on-the-ground"&&i==="on-the-ground"?t.staysOnTheGround:e===i||e!=="on-the-ground"&&i!=="on-the-ground"?Ln.UPDATE:t.onTheGroundChanged}function Up(t){return t==="relative-to-ground"||t==="relative-to-scene"}function Tw(t){return t!=="absolute-height"}function PEt(t,e,i,r,n){XO(e,i,n,r,pR),p5e(t,pR.verticalDistanceToGround);const s=pR.sampledElevation,o=go(kEt,t.transformation);return M5[0]=e.x,M5[1]=e.y,M5[2]=pR.z,ym(e.spatialReference,M5,o,r.spatialReference)?t.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),s}function IEt(t,e,i,r,n,s){let o=0;const a=s.spatialReference;e*=3,r*=3;for(let l=0;l<n;++l){const c=t[e+0],h=t[e+1],p=t[e+2],f=Nt(s.getElevation(c,h,p,a,"ground"),0);o+=f,i[r+0]=c,i[r+1]=h,i[r+2]=f,e+=3,r+=3}return o/n}function $Et(t,e,i,r,n,s,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,p=s.spatialReference;e*=3,r*=3;for(let f=0;f<n;++f){const m=t[e+0],g=t[e+1],_=t[e+2],b=Nt(s.getElevation(m,g,_,p,"ground"),0);l+=b,i[r+0]=m,i[r+1]=g,i[r+2]=h==null?_+b+c:b+c,e+=3,r+=3}return l/n}function LEt(t,e,i,r,n,s,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,p=s.spatialReference;e*=3,r*=3;for(let f=0;f<n;++f){const m=t[e+0],g=t[e+1],_=t[e+2],b=Nt(s.getElevation(m,g,_,p,"scene"),0);l+=b,i[r+0]=m,i[r+1]=g,i[r+2]=h==null?_+b+c:b+c,e+=3,r+=3}return l/n}function DEt(t){const e=t.meterUnitOffset,i=t.featureExpressionInfoContext;return e!==0||i!=null}function NEt(t,e,i,r,n,s,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;e*=3,r*=3;for(let h=0;h<n;++h){const p=t[e+0],f=t[e+1],m=t[e+2];i[r+0]=p,i[r+1]=f,i[r+2]=c==null?m+l:l,e+=3,r+=3}return 0}let iF=class{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}};var Ln;(function(t){t[t.NONE=0]="NONE",t[t.UPDATE=1]="UPDATE",t[t.RECREATE=2]="RECREATE"})(Ln||(Ln={}));const FEt={"absolute-height":{applyElevationAlignmentBuffer:NEt,requiresAlignment:DEt},"on-the-ground":{applyElevationAlignmentBuffer:IEt,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:$Et,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:LEt,requiresAlignment:()=>!0}},kEt=$e(),pR=new iF,M5=P();function Xle(t){return v(t.mapPositions)}function m5e(t,e,i,r,n){const s=t.stageObject,o=s.geometries;let a=0;for(const l of o){if(!Xle(l))continue;const{update:c,averageGeometrySampledElevation:h}=y5e(l,e,i,r,n);a+=h,c&&s.geometryVertexAttrsUpdated(l)}return a/o.length}function ND(t,e,i,r,n){var p;const s=t.stageObject,o=e.centerPointInElevationSR;let a=0;(p=s.metadata)!=null&&p.usesVerticalDistanceToGround?(r(o,Uc),p5e(s,Uc.verticalDistanceToGround),a=Uc.sampledElevation):(r(o,Uc),e.mode!=="absolute-height"&&(a=Uc.sampledElevation));const l=go(UEt,s.transformation),c=he(g5e,l[12],l[13],l[14]);tr.TESTS_DISABLE_OPTIMIZATIONS?(kc[0]=o.x,kc[1]=o.y,kc[2]=Uc.z,ym(o.spatialReference,kc,l,n.spatialReference)&&(s.transformation=l)):n.setAltitudeOfTransformation(Uc.z,l);const h=Yle/n.unitInMeters;return(Math.abs(l[12]-c[0])>=h||Math.abs(l[13]-c[1])>=h||Math.abs(l[14]-c[2])>=h)&&(s.transformation=l),a}const UEt=$e();function VEt(t,e,i,r,n){const s=t.graphics3DSymbolLayer.lodRenderer;if(R(s))return 0;const o=e.centerPointInElevationSR;r(o,Uc);const a=e.mode!=="absolute-height"?Uc.sampledElevation:0,l=s.instanceData,c=t.instanceIndex,h=BEt;l.getGlobalTransform(c,h);const p=he(g5e,h[12],h[13],h[14]);tr.TESTS_DISABLE_OPTIMIZATIONS?(kc[0]=o.x,kc[1]=o.y,kc[2]=Uc.z,ym(o.spatialReference,kc,h,n.spatialReference)&&l.setGlobalTransform(c,h)):n.setAltitudeOfTransformation(Uc.z,h);const f=Yle/n.unitInMeters;return(tr.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(h[12]-p[0])>=f||Math.abs(h[13]-p[1])>=f||Math.abs(h[14]-p[2])>=f)&&l.setGlobalTransform(c,h),a}function zEt(t,e,i,r,n){const s=t.stageObject,o=s.geometries;if(o.length===0)return 0;let a=0,l=null,c=0,h=!1;for(const p of o){if(!Xle(p))continue;const f=p.vertexAttributes.get(M.POSITION);if(f!==l){const{update:m,averageGeometrySampledElevation:g}=y5e(p,e,i,r,n);c=g,l=f,h=m}h&&s.geometryVertexAttrsUpdated(p),a+=c}return a/o.length}const Yle=.01,kc=P(),wd=P(),FE=P(),BEt=$e(),g5e=P(),Uc=new iF;function y5e(t,e,i,r,n){let s=!1;const o=t.shaderTransformation,a=e.requiresSampledElevationInfo;wd[0]=o[12],wd[1]=o[13],wd[2]=o[14],t.invalidateBoundingInfo();const l=t.getMutableAttribute(M.POSITION),c=l.data,h=l.size,p=c.length/h,f=new DFe(t.mapPositions,i);let m=0,g=0;for(let _=0;_<p;_++){if(FE[0]=c[m],FE[1]=c[m+1],FE[2]=c[m+2],r(f,Uc),a&&(g+=Uc.sampledElevation),tr.TESTS_DISABLE_OPTIMIZATIONS)c[m]=f.array[f.offset],c[m+1]=f.array[f.offset+1],c[m+2]=Uc.z,Nn(c,i,m,c,n.spatialReference,m,1),c[m]-=wd[0],c[m+1]-=wd[1],c[m+2]-=wd[2],s=!0;else{kc[0]=c[m]+wd[0],kc[1]=c[m+1]+wd[1],kc[2]=c[m+2]+wd[2],n.setAltitude(kc,Uc.z),c[m]=kc[0]-wd[0],c[m+1]=kc[1]-wd[1],c[m+2]=kc[2]-wd[2];const b=Yle/n.unitInMeters;(Math.abs(FE[0]-c[m])>=b||Math.abs(FE[1]-c[m+1])>=b||Math.abs(FE[2]-c[m+2])>=b)&&(s=!0)}m+=h,f.offset+=3}return g/=p,{update:s,averageGeometrySampledElevation:g}}const jEt=re.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function GEt(t){return{cachedResult:t.cachedResult,arcade:t.arcade?{func:t.arcade.func,context:t.arcade.modules.arcadeUtils.createExecContext(null,{sr:t.arcade.context.spatialReference}),modules:t.arcade.modules}:null}}function AYt(t){const e=t&&t.expression;if(typeof e=="string"){const i=b5e(e);if(i!=null)return{cachedResult:i}}return null}async function RYt(t,e,i,r){const n=t&&t.expression;if(typeof n!="string")return null;const s=b5e(n);if(s!=null)return{cachedResult:s};const o=await cy();ui(i);const a=o.arcadeUtils,l=a.createSyntaxTree(n);return a.dependsOnView(l)?(r!=null&&r.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:a.createFunction(l),context:a.createExecContext(null,{sr:e}),modules:o}}}function _5e(t,e,i){return t.arcadeUtils.createFeature(e.attributes,e.geometry,i)}function Zle(t,e){if(t!=null&&!v5e(t)){if(!e||!t.arcade)return void jEt.errorOncePerTick("Arcade support required but not provided");const i=e;i._geometry&&(i._geometry=a5e(i._geometry)),t.arcade.modules.arcadeUtils.updateExecContext(t.arcade.context,e)}}function HEt(t){if(t!=null){if(v5e(t))return t.cachedResult;const e=t.arcade;let i=e==null?void 0:e.modules.arcadeUtils.executeFunction(e.func,e.context);return typeof i!="number"&&(t.cachedResult=0,i=0),i}return 0}function MYt(t,e=!1){let i=t&&t.featureExpressionInfo;const r=i&&i.expression;return e||r==="0"||(i=null),i??null}const qEt={cachedResult:0};function v5e(t){return t.cachedResult!=null}function b5e(t){return t==="0"?0:null}let Om=class w5e{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=Ost(e)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,i){const r=this.calculateOffsetRenderUnits(i);return this.featureExpressionInfoContext!=null?r:e+r}calculateOffsetRenderUnits(e){let i=this._meterUnitOffset;const r=this.featureExpressionInfoContext;return r!=null&&(i+=HEt(r)*this._metersPerElevationInfoUnit),i/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=Mst(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=Nt(e.offset,0)}updateFeatureExpressionInfoContext(e,i,r){if(R(e))return void(this._featureExpressionInfoContext=null);const n=e&&e.arcade;n&&v(i)&&v(r)?(this._featureExpressionInfoContext=GEt(e),Zle(this._featureExpressionInfoContext,_5e(n.modules,i,r))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const i=new w5e;return v(e)&&i.setFromElevationInfo(e),i}},WEt=class{constructor(e,i,r){this.graphic=e,this.renderingInfo=i,this.layer=r}};var ci;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.TRANSPARENT=1]="TRANSPARENT",t[t.OPAQUE=2]="OPAQUE"})(ci||(ci={}));let XEt=class{constructor(e,i,r){this.baseMaterial=e,this.edgeMaterials=i,this.properties=r}},Ry=class{get isElevationSource(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}constructor(e,i,r,n,s,o,a,l=null){this.graphics3DSymbolLayer=e,this.stageObject=i,this._uniqueGeometries=r,this._uniqueMaterials=n,this._sharedResource=s,this.elevationAligner=o,this.elevationContext=a,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._stage=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e,i){this._stageLayer=i,this._stage=e,e.addMany(this._uniqueMaterials),e.addMany(this._uniqueGeometries),e.add(this.stageObject)}destroy(){const e=this._stage;this._stageLayer&&(e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries)),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);const i=this._stage.renderer.ensureEdgeView();i.hasObject(this.stageObject)&&i.removeObject(this.stageObject),this.stageObject.dispose(),v(this._sharedResource)&&this._sharedResource.release(),this._visible=!1,this._stageLayer=null,this._stage=null}layerOpacityChanged(e,i){if(R(this._edgeState))return;const r=T_e(this._edgeState.baseMaterial);let n=!1;for(const s of this._edgeState.edgeMaterials)s.objectTransparency!==r&&(s.objectTransparency=r,n=!0);n&&this._resetEdgeObject(i),this._stage.renderer.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[e])}slicePlaneEnabledChanged(e,i){R(this._edgeState)||(this._stage.renderer.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:e},!i),this._edgeState.properties.hasSlicePlane=e)}setVisibility(e){if(this._stage!=null&&this._visible!==e&&(this._visible=e,this.stageObject.visible=e,this._visible&&!this._addedToStage&&(this._stageLayer.add(this.stageObject),this._addedToStage=!0),v(this._edgeState))){const i=this._stage.renderer.ensureEdgeView();i.hasObject(this.stageObject)?i.updateObjectVisibility(this.stageObject,e):e&&this._addOrUpdateEdgeObject(i,!1)}}get visible(){return this._visible}alignWithElevation(e,i,r,n){if(this.elevationAligner==null)return;v(r)&&Zle(this.elevationContext.featureExpressionInfoContext,r);const s=(o,a)=>XO(o,e,this.elevationContext,i,a);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,s,i),this._resetEdgeObject(n)}alignWithAbsoluteElevation(e,i,r){const n=(s,o)=>{o.sampledElevation=e,o.verticalDistanceToGround=0,o.z=e};this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,n,i),this._resetEdgeObject(r)}getCenterObjectSpace(e=P()){return ce(e,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(e=to()){const i=this.stageObject.boundingVolumeObjectSpace;return CCe(e,i.min),ACe(e,i.max),e}computeAttachmentOrigin(e){if(this.useObjectOriginAsAttachmentOrigin){const i=this.stageObject.transformation;e.render.origin[0]+=i[12],e.render.origin[1]+=i[13],e.render.origin[2]+=i[14],e.render.num++}else for(const i of this.stageObject.geometries)i.computeAttachmentOrigin(Hy)&&(Ke(Hy,Hy,this.stageObject.transformation),me(e.render.origin,e.render.origin,Hy),e.render.num++)}async getProjectedBoundingBox(e,i,r,n,s){const o=this.getBoundingBoxObjectSpace(s),a=YEt,l=Vne(o)?1:a.length;for(let h=0;h<l;h++){const p=a[h];$v[0]=o[p[0]],$v[1]=o[p[1]],$v[2]=o[p[2]],Ke($v,$v,this.stageObject.transformation),gx[3*h+0]=$v[0],gx[3*h+1]=$v[1],gx[3*h+2]=$v[2]}if(!e(gx,0,l))return null;Br(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let p=0;p<3;p++)o[p]=Math.min(o[p],gx[h+p]),o[p+3]=Math.max(o[p+3],gx[h+p]);c&&r.push({location:gx.slice(h,h+3),screenSpaceBoundingRect:c})}if(i&&i.service&&this.elevationContext.mode!=="absolute-height"){Yf(o,Hy);const h=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let p=0;if(i.useViewElevation)p=Nt(i.service.getElevation(Hy[0],Hy[1],h),0);else try{const f=Wle(o,i.service.spatialReference,i);p=Nt(await i.service.queryElevation(Hy[0],Hy[1],n,f,h),0)}catch{}ECe(o,0,0,-this.alignedSampledElevation+p)}return o}addObjectState(e,i){e===$_.Highlight&&i.addObject(this.stageObject,this.stageObject.highlight()),e===$_.MaskOccludee&&i.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeObject(this.stageObject)}_resetEdgeObject(e){if(R(this._edgeState))return;const i=this._stage.renderer.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(i,e):i.removeObject(this.stageObject)}_addOrUpdateEdgeObject(e,i){const r=this._edgeState;if(R(r))return;const n=T_e(r.baseMaterial);for(const s of r.edgeMaterials)s.objectTransparency=n;e.addOrUpdateObject3D(this.stageObject,r.edgeMaterials,r.properties,!i).then(()=>{var s;return(s=this._stageLayer)==null?void 0:s.sync()})}};function T_e(t){return t.isVisible()?t.parameters.transparent?ci.TRANSPARENT:ci.OPAQUE:ci.INVISIBLE}const gx=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],$v=P(),Hy=P(),YEt=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];let x5e=class{constructor(e,i=null){this.labelText=i,this.elevationOffset=Nt(e,0)}};var Ks;(function(t){t[t.Recreate_Symbol=0]="Recreate_Symbol",t[t.Recreate_Graphics=1]="Recreate_Graphics",t[t.Fast_Update=2]="Fast_Update"})(Ks||(Ks={}));let Jle=class{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=Bh.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,i){return this._loadStatus===Bh.LOADED?(e&&e(),Nt(this._loader,Promise.resolve())):this._loadStatus===Bh.FAILED?(i&&i(this._loadError),Nt(this._loader,Promise.resolve())):(R(this._loader)&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=Bh.LOADED},r=>{throw this._loadError=r,this._abortController=null,this._loadStatus=Bh.FAILED,!gs(r)&&this.logger&&r.message&&this.logger.warn(r.message),r})),this._loader.then(e,i).catch(()=>{}),this._loader)}abortLoad(){v(this._abortController)?this._abortController=Mp(this._abortController):this._loadStatus===Bh.LOADING&&(this._loadStatus=Bh.FAILED),this._loader=null}};var Bh;(function(t){t[t.LOADING=0]="LOADING",t[t.LOADED=1]="LOADED",t[t.FAILED=2]="FAILED"})(Bh||(Bh={}));const T5e=3,Cte=3,S5e=10;let E5e=class{constructor(e,i=null){this.geometry=e,this.textures=i}};function O5(t){const e=[];return t.levels.forEach(i=>i.components.forEach(r=>e.push(r.geometry.material))),lN(e)}function S_e(t){const e=new Array;return t.levels.forEach(i=>{i.components.forEach(r=>{v(r.textures)&&e.push(...r.textures)})}),lN(e)}function C5e(t){const e=t.components.map(i=>i.geometry);return lN(e)}function E_e(t){const e=[];return t.levels.forEach(i=>{i.components.forEach(r=>{e.push(r.geometry)})}),lN(e)}function ZEt(t){switch(t){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function A5e(t,e){const i=(r,n,s=!1)=>({levels:r.map(o=>{const a=n(o.tesselation);return s&&e1t(a),{components:[new E5e(a)],faceCount:a.indexCount/3,minScreenSpaceRadius:o.minScreenSpaceRadius}})});switch(t){case"sphere":return i([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],r=>Jvt(e,.5,r,!0));case"cube":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>Bvt(e,1));case"cone":return i(Dq,r=>qye(e,1,.5,r,!1),!0);case"inverted-cone":return i(Dq,r=>qye(e,1,.5,r,!0),!0);case"cylinder":return i(Dq,r=>Qvt(e,1,.5,r,[0,0,1],[0,0,.5]));case"tetrahedron":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>Zvt(e,1),!0);case"diamond":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>qvt(e,1),!0);default:return}}const Dq=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];function JEt(t){return t.type==="fill"}function KEt(t){return t.type==="extrude"}function QEt(t){return t&&t.enabled&&(KEt(t)||JEt(t))&&v(t.edges)}function eCt(t){return t&&t.enabled&&t.edges||null}function R5e(t,e){return tCt(eCt(t),e)}function tCt(t,e){if(R(t))return null;const i=v(t.color)?loe(Xe.toUnitRGBA(t.color)):Zt(0,0,0,0),r=ga(t.size),n=ga(t.extensionLength);switch(t.type){case"solid":return iCt({color:i,size:r,extensionLength:n,...e});case"sketch":return rCt({color:i,size:r,extensionLength:n,...e});default:return}}function iCt(t){return{...nCt,...t,type:"solid"}}function rCt(t){return{...sCt,...t,type:"sketch"}}const nCt={color:Zt(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:ci.OPAQUE,hasSlicePlane:!1},sCt={color:Zt(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:ci.OPAQUE,hasSlicePlane:!1},Kle={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};function NYt(t){return t.type==="web-style"?Kle:Qle(t.symbolLayers.toArray().map(e=>M5e(t,e)))}function Qle(t){let e=0,i=0,r=0,n=!1,s=0;const o={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const a of t)R(a)||(e+=a.primitivesPerFeature,i+=a.primitivesPerCoordinate,r+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.bytesPerCoordinate+=a.memory.bytesPerCoordinate,o.resourceBytes+=a.memory.resourceBytes,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.draped.bytesPerCoordinate+=a.memory.bytesPerCoordinate,n=n||a.estimated,++s);return{primitivesPerFeature:e,primitivesPerCoordinate:i,drawCallsPerFeature:r,estimated:n,memory:o,numComplexities:s}}function FYt(t){const e=Qle(t);return e.numComplexities>0&&(e.primitivesPerFeature/=e.numComplexities,e.primitivesPerCoordinate/=e.numComplexities,e.drawCallsPerFeature/=e.numComplexities,e.memory.bytesPerFeature/=e.numComplexities,e.memory.bytesPerFeatureLabel/=e.numComplexities,e.memory.bytesPerCoordinate/=e.numComplexities,e.memory.resourceBytes/=e.numComplexities,e.memory.draped.bytesPerFeature/=e.numComplexities,e.memory.draped.bytesPerFeatureLabel/=e.numComplexities,e.memory.draped.bytesPerCoordinate/=e.numComplexities),e}const C_e={};function M5e(t,e){const i=O5e(t,e),r=QEt(e)?2:0;switch(e.type){case"extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:r,estimated:!1,memory:i};case"fill":return t.type==="mesh-3d"?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:r,estimated:!1,memory:i}:v(e.outline)&&e.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:i}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:i};case"water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:i};case"line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:i};case"object":return e.resource&&e.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:i}:{...oCt(e.resource&&e.resource.primitive||iAe),memory:i};case"path":{let n=0,s=0;switch(e.profile){case"circle":n=S5e;break;case"quad":n=4;break;default:return void(e.profile,void 0)}switch(e.join??"simple"){case"round":s=T5e;break;case"miter":case"bevel":s=1;break;default:return}const o=2*n,a=n*s*2;let l=-2*a-o;switch(e.cap){case"none":break;case"butt":case"square":l+=2*(n-1);break;case"round":l+=2*(n*(Cte-1)*2+n);break;default:return}return{primitivesPerFeature:l,primitivesPerCoordinate:a+o,drawCallsPerFeature:0,estimated:!1,memory:i}}case"text":case"icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:i};default:return}}function O5e(t,e){const i=t.type==="point-3d";switch(e.type){case"extrude":return e.edges&&e.edges.size>0?dc.EXTRUDE_EDGES:dc.EXTRUDE;case"fill":return v(e.outline)&&e.outline.size>0?dc.FILL_OUTLINE:dc.FILL;case"water":return dc.FILL;case"line":return e.join==="round"?dc.LINE_ROUND:dc.LINE_MITER;case"path":switch(e.join){case"round":switch(e.profile){case"circle":return dc.PATH_ROUND_CIRCLE;case"quad":return dc.PATH_ROUND_QUAD;default:return void(e.profile,void 0)}case"miter":case"bevel":switch(e.profile){case"circle":return dc.PATH_MITER_CIRCLE;case"quad":return dc.PATH_MITER_QUAD;default:return void(e.profile,void 0)}default:return}case"object":return i?dc.OBJECT_POINT:dc.OBJECT_POLYGON;case"icon":case"text":return i?dc.ICON_POINT:dc.ICON_POLYGON;default:return}}function oCt(t){let e=C_e[t];if(e)return e;const i=A5e(t,null);return e={primitivesPerFeature:C5e(i.levels[0]).reduce((r,n)=>r+n.indices.get(M.POSITION).length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1},C_e[t]=e,e}const dc={ICON_POINT:{bytesPerFeature:3293.7707557538765,bytesPerFeatureLabel:1020.2764,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:2213.51585392203,bytesPerFeatureLabel:1008.84664,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:4745.397589234022,bytesPerFeatureLabel:1006.5440666666666,bytesPerCoordinate:3.8971910718981526,resourceBytes:0,draped:{bytesPerFeature:3711.9299672493826,bytesPerFeatureLabel:991.1003999999999,bytesPerCoordinate:3.916858016273668}},OBJECT_POINT:{bytesPerFeature:1751.6405617660876,bytesPerFeatureLabel:1024.7827699999998,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:1751.6405617660876,bytesPerFeatureLabel:1024.7827699999998,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:3265.877223973855,bytesPerFeatureLabel:1002.3207366666666,bytesPerCoordinate:4.003101524580855,resourceBytes:0,draped:{bytesPerFeature:3265.877223973855,bytesPerFeatureLabel:1002.3207366666666,bytesPerCoordinate:4.003101524580855}},LINE_MITER:{bytesPerFeature:5757.019675077085,bytesPerFeatureLabel:998.6150266666667,bytesPerCoordinate:24.456810187064043,resourceBytes:0,draped:{bytesPerFeature:4101.480288021862,bytesPerFeatureLabel:1007.7540599999999,bytesPerCoordinate:18.25629912730874}},LINE_ROUND:{bytesPerFeature:5770.95297166408,bytesPerFeatureLabel:1017.77396,bytesPerCoordinate:24.60919037084966,resourceBytes:0,draped:{bytesPerFeature:4089.5796612121826,bytesPerFeatureLabel:987.8320266666666,bytesPerCoordinate:18.43599029126731}},PATH_MITER_CIRCLE:{bytesPerFeature:36120.81813311945,bytesPerFeatureLabel:977.3815,bytesPerCoordinate:2713.2216607858863,resourceBytes:0,draped:{bytesPerFeature:36120.81813311945,bytesPerFeatureLabel:977.3815,bytesPerCoordinate:2713.2216607858863}},PATH_ROUND_CIRCLE:{bytesPerFeature:23268.96777866874,bytesPerFeatureLabel:985.2637,bytesPerCoordinate:5284.873051323177,resourceBytes:0,draped:{bytesPerFeature:23268.96777866874,bytesPerFeatureLabel:985.2637,bytesPerCoordinate:5284.873051323177}},PATH_MITER_QUAD:{bytesPerFeature:24548.629753007182,bytesPerFeatureLabel:964.6924,bytesPerCoordinate:2114.107276663994,resourceBytes:0,draped:{bytesPerFeature:24548.629753007182,bytesPerFeatureLabel:964.6924,bytesPerCoordinate:2114.107276663994}},PATH_ROUND_QUAD:{bytesPerFeature:34316.219663191616,bytesPerFeatureLabel:975.7985,bytesPerCoordinate:3331.3952550120293,resourceBytes:0,draped:{bytesPerFeature:34316.219663191616,bytesPerFeatureLabel:975.7985,bytesPerCoordinate:3331.3952550120293}},FILL:{bytesPerFeature:6141.501452970723,bytesPerFeatureLabel:1008.2056066666665,bytesPerCoordinate:9.669541106191478,resourceBytes:0,draped:{bytesPerFeature:4615.812654782311,bytesPerFeatureLabel:1004.2114200000001,bytesPerCoordinate:7.378043214430644}},FILL_OUTLINE:{bytesPerFeature:9038.575581319641,bytesPerFeatureLabel:1017.9996066666668,bytesPerCoordinate:14.96569682175086,resourceBytes:0,draped:{bytesPerFeature:6369.386021594582,bytesPerFeatureLabel:1008.9863733333334,bytesPerCoordinate:10.25287774000214}},EXTRUDE:{bytesPerFeature:20071.2337049912,bytesPerFeatureLabel:1019.49468,bytesPerCoordinate:49.39369614206849,resourceBytes:0,draped:{bytesPerFeature:20071.2337049912,bytesPerFeatureLabel:1019.49468,bytesPerCoordinate:49.39369614206849}},EXTRUDE_EDGES:{bytesPerFeature:22300.21739345088,bytesPerFeatureLabel:1017.4348466666665,bytesPerCoordinate:49.40242281963031,resourceBytes:0,draped:{bytesPerFeature:22300.21739345088,bytesPerFeatureLabel:1017.4348466666665,bytesPerCoordinate:49.40242281963031}}},kE=re.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");let My=class extends Jle{constructor(e,i,r,n){super(r.schedule),this.symbol=e,this.symbolLayer=i,this._context=r,this._elevationInfoOverride=null,this._ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this.complexity=null,this.logger=kE,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this._renderPriority=n.renderPriority,this._renderPriorityStep=n.renderPriorityStep,this._elevationContext=new Om,this.complexity=this.computeComplexity(),this._ignoreDrivers=n.ignoreDrivers,this._ignoreDrivers||(this._drivenProperties=A_e(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}_drivenPropertiesChanged(e){if(this._ignoreDrivers)return!1;const i=this._drivenProperties,r=A_e(e);return r.color!==i.color||r.opacity!==i.opacity||r.opacityAlwaysOpaque!==i.opacityAlwaysOpaque||r.size!==i.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,i,r,n){const s=e.projectionSuccess,o="polygons"in e?e.polygons:null,a=`${n} geometry failed to be created`;let l=null;s?!this._logGeometryValidationWarnings(i,r,n)&&o&&o.length===0&&r==="rings"&&i.length>0&&i[0].length>2&&(l=`${a} (filled rings should use clockwise winding - try reversing the order of vertices)`):l=`${a} (failed to project geometry to view spatial reference)`,l&&kE.warnOncePerTick(l)}_logGeometryValidationWarnings(e,i,r){const n=`${r} geometry failed to be created`;return!e.length||e.length===1&&!e[0].length?(kE.warnOncePerTick(`${n} (no ${i} were defined)`),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(kE.warnOncePerTick(`${n} (${i} should be defined as a 2D array)`),!0)}_validateGeometry(e,i=null,r=null){if(v(i)&&!i.includes(e.type))return this.logger.warn("unsupported geometry type for "+r+` symbol: ${e.type}`),!1;if(e.type==="point"){const n=e;if(!isFinite(n.x)||!isFinite(n.y))return kE.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return aCt}_defaultElevationInfoZ(){return lCt}_updateElevationContext(){v(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,i=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||i.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,i){const r=e.geometry,n=this.getDefaultElevationInfo(r);i.unit=this._elevationContext.unit!=null?this._elevationContext.unit:n.unit,i.mode=this.getGeometryElevationMode(r,n),i.offsetMeters=Nt(this._elevationContext.meterUnitOffset,Nt(n.offset,0));const s=!this._elevationOptions.supportsOnTheGround&&i.mode==="on-the-ground";s&&(i.mode="relative-to-ground",i.offsetMeters=0);const o=s?qEt:this._elevationContext.featureExpressionInfoContext;return i.updateFeatureExpressionInfoContext(o,e,this._context.layer),i}prepareSymbolLayerPatch(e){}updateGeometry(e,i){return!1}onRemoveGraphic(e){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity??0:this._context.layer.opacity??1}_getCombinedOpacity(e,i=R_e){let r=1;return this.draped||(r*=this._getLayerOpacity()),this._drivenProperties.opacity||(v(e)?r*=e.a:i.hasIntrinsicColor||(r=0)),r}_getCombinedOpacityAndColor(e,i=R_e){const r=this._getCombinedOpacity(e,i);if(this._drivenProperties.color)return tL(null,r);const n=v(e)?Xe.toUnitRGB(e):Vg;return tL(n,r)}_getVertexOpacityAndColor(e,i=null){const r=this._drivenProperties.color?e.color:null,n=this._drivenProperties.opacity?e.opacity:null,s=tL(r,n);return v(i)&&(s[0]*=i,s[1]*=i,s[2]*=i,s[3]*=i),s}isFastUpdatesEnabled(){return this._fastUpdates&&this._fastUpdates.enabled}computeComplexity(){return M5e(this.symbol,this.symbolLayer)}globalPropertyChanged(e,i,r){switch(e){case"opacity":return this.layerOpacityChanged(i,r),!0;case"elevationInfo":{const n=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(i,r,n)!==Ln.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(i,r);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged();case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged();default:return!1}}updateGraphics3DGraphicElevationInfo(e,i,r){let n=Ln.UPDATE;return e.forEach(s=>{const o=i(s);if(v(o)){const a=s.graphic;this.setGraphicElevationContext(a,o.elevationContext),o.needsElevationUpdates=r(o.elevationContext.mode)}else n=Ln.RECREATE}),n}applyRendererDiff(e,i){return Ks.Recreate_Symbol}getFastUpdateAttrValues(e){if(!this._fastUpdates.enabled)return null;const i=this._fastUpdates.visualVariables,r=i.size?p_(i.size.field,e):0,n=i.color?p_(i.color.field,e):0,s=i.opacity?p_(i.opacity.field,e):0;return Zt(r,n,s,0)}get draped(){return this._draped}ensureDrapedStatus(e){return this._draped==null?(this._draped=e,!0):(e!==this.draped&&kE.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const e=()=>{var i,r,n,s,o,a,l,c,h,p,f,m;return{size:((n=(r=(i=this._fastUpdates)==null?void 0:i.visualVariables)==null?void 0:r.size)==null?void 0:n.field)??null,color:((a=(o=(s=this._fastUpdates)==null?void 0:s.visualVariables)==null?void 0:o.color)==null?void 0:a.field)??null,opacity:((h=(c=(l=this._fastUpdates)==null?void 0:l.visualVariables)==null?void 0:c.opacity)==null?void 0:h.field)??null,rotation:((m=(f=(p=this._fastUpdates)==null?void 0:p.visualVariables)==null?void 0:f.rotation)==null?void 0:m.field)??null}};return{drivenProperties:this._drivenProperties,getVisVarFields:e}}};function p_(t,e){const i=t!=null?e.attributes[t]:0;return i!=null&&isFinite(i)?i:0}function A_e(t){const e={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return t&&"visualVariables"in t&&t.visualVariables&&t.visualVariables.forEach(i=>{switch(i.type){case"color":if(e.color=!0,i.stops)for(let r=0;r<i.stops.length;r++){const n=i.stops[r].color;n&&(e.opacity=!0,n.a<1&&(e.opacityAlwaysOpaque=!1))}break;case"opacity":e.opacity=!0,e.opacityAlwaysOpaque=!1;break;case"size":e.size=!0}}),e}const aCt={mode:"on-the-ground",offset:0,unit:"meters"},lCt={mode:"absolute-height",offset:0,unit:"meters"},R_e={hasIntrinsicColor:!1};let iv=class extends YN{get geometries(){return this._geometries}get transformation(){return this._transformation}set transformation(e){go(this._transformation,e),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}constructor(e={}){super(),this.type=Zn.Object,this._geometries=new Array,this._transformation=$e(),this._bvObjectSpace=new M_e,this._bvWorldSpace=new M_e,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._visible=!0,this.castShadow=e.castShadow==null||e.castShadow,this.metadata=e.metadata,this.metadata&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new P5e);const i=e.geometries;v(i)&&(this._geometries=Array.from(i))}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){wt(this._parentLayer==null||e==null,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._hasVolatileTransformation=this._hasVolatileTransformation||e.hasVolatileTransformation,this._emit("objectGeometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){const i=this._geometries.splice(e,1)[0];i&&(this._emit("objectGeometryRemoved",{object:this,geometry:i}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(e){this._emit("objectGeometryUpdated",{object:this,geometry:e}),this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const i of this._geometries)i.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new pz($_.MaskOccludee);for(const i of this._geometries)i.occludees=tte(i.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const i of this._geometries)i.occludees=ite(i.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new pz($_.Highlight);for(const i of this._geometries)i.highlights=tte(i.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const i of this._geometries)i.highlights=ite(i.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,i){return $n(i,this.transformation,e.transformation)}_getCombinedShaderTransformation(e){return $n($e(),this.transformation,e.shaderTransformation)}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._validateBoundingVolume(),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._validateBoundingVolume(),this._bvObjectSpace}_validateBoundingVolume(){if(!this._bvDirty&&!this._hasVolatileTransformation)return;this._bvObjectSpace.init(),this._bvWorldSpace.init();for(const n of this._geometries){const s=n.boundingInfo;v(s)&&(O_e(s,this._bvObjectSpace,n.shaderTransformation),O_e(s,this._bvWorldSpace,this._getCombinedShaderTransformation(n)))}ys(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),ys(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);const e=P(),i=P(),r=v2(this.transformation);for(const n of this._geometries){const s=n.boundingInfo;if(R(s))continue;const o=n.shaderTransformation,a=v2(o);Ke(e,s.center,o);const l=Lr(e,this._bvObjectSpace.bounds),c=s.radius*a;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],l+c),Ke(i,e,this.transformation);const h=Lr(i,this._bvWorldSpace.bounds),p=c*r;this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],h+p)}this._bvDirty=!1}_invalidateBoundingVolume(){this._bvDirty=!0,v(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)}_emit(e,i){v(this._parentLayer)&&this._parentLayer.events.emit(e,i)}get test(){const e=this;return{hasGeometry:i=>e._geometries.includes(i),getGeometryIndex:i=>e._geometries.indexOf(i)}}},P5e=class{constructor(){this.min=Ue(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Ue(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}},M_e=class extends P5e{constructor(){super(...arguments),this.bounds=Is()}init(){he(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),he(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),OLe(this.bounds)}};function O_e(t,e,i){const r=t.bbMin,n=t.bbMax;if(aB(i)){const s=he(cCt,i[12],i[13],i[14]);me(fh,r,s),me(ef,n,s);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],fh[o]),e.max[o]=Math.max(e.max[o],ef[o])}else if(Ke(fh,r,i),Xl(r,n))for(let s=0;s<3;++s)e.min[s]=Math.min(e.min[s],fh[s]),e.max[s]=Math.max(e.max[s],fh[s]);else{Ke(ef,n,i);for(let s=0;s<3;++s)e.min[s]=Math.min(e.min[s],fh[s],ef[s]),e.max[s]=Math.max(e.max[s],fh[s],ef[s]);for(let s=0;s<3;++s){ce(fh,r),ce(ef,n),fh[s]=n[s],ef[s]=r[s],Ke(fh,fh,i),Ke(ef,ef,i);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],fh[o],ef[o]),e.max[o]=Math.max(e.max[o],fh[o],ef[o])}}}const cCt=P(),fh=P(),ef=P();function ece(t,e,i,r,n,s){const o=t.clippingExtent;if(qa(e,Cb,t.elevationProvider.spatialReference),v(o)&&!kne(o,Cb))return null;qa(e,Cb,t.renderCoordsHelper.spatialReference);const a=t.localOriginFactory.getOrigin(Cb),l=new iv({castShadow:!1,metadata:{layerUid:t.layer.uid,graphicUid:n,usesVerticalDistanceToGround:!0}});return i.shaderTransformer=s,i.localOrigin=a,l.addGeometry(i),{object:l,sampledElevation:PEt(l,e,t.elevationProvider,t.renderCoordsHelper,r)}}function FD(t,e,i){const r=t.elevationContext,n=i.spatialReference;qa(e,Cb,n),r.centerPointInElevationSR=tv(Cb[0],Cb[1],e.hasZ?Cb[2]:0,v(n)?n:null)}function kD(t){switch(t.type){case"point":return t;case"polygon":case"extent":return qle(t);case"polyline":{const e=t.paths[0];if(!e||e.length===0)return null;const i=rEe(e,iEe(e)/2);return tv(i[0],i[1],i[2],t.spatialReference)}case"mesh":return t.origin}return null}const Cb=P();function uCt(t){const e=new ji;e.include(nle),e.include(g4e,t),e.include(fs,t),e.attributes.add(M.UV0,"vec2");const{vertex:i,fragment:r}=e;return i.uniforms.add([new bi("viewport",(n,s)=>s.camera.fullViewport),new Ie("lineSize",(n,s)=>Math.ceil(n.size)*s.camera.pixelRatio),new Wi("pixelToNDC",(n,s)=>dt(I_e,2/s.camera.fullViewport[2],2/s.camera.fullViewport[3])),new Ie("borderSize",(n,s)=>v(n.borderColor)?s.camera.pixelRatio:0),new Wi("screenOffset",(n,s)=>dt(I_e,n.screenOffset[0]*s.camera.pixelRatio,n.screenOffset[1]*s.camera.pixelRatio))]),e.varyings.add("coverageSampling","vec4"),e.varyings.add("lineSizes","vec2"),t.hasMultipassGeometry&&e.varyings.add("depth","float"),t.hasScreenSizePerspective&&b7(i),i.code.add(S`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${t.occlusionTestEnabled?S`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${t.hasScreenSizePerspective?S`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:S`
      vec2 screenOffsetScaled = screenOffset;
        `}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly
      // used to get the correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${t.hasMultipassGeometry?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${t.depthHudEnabled?t.depthHudAlignStartEnabled?S`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:S`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${t.hasScreenSizePerspective?S`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:S`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;
      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned
      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,
      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel
      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).
      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;
      float halfPixelSizeInt = floor(halfWholePixelSize);

      // Sub-pixel offset if we need to grow sub-pixels to the left
      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);

      // Pixel offset aligning to whole pixels and adding subpixel offset if needed
      float pixelOffset = -halfPixelSizeInt + subpixelOffset;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),r.uniforms.add([new bi("uColor",n=>P_e(n.color)),new bi("borderColor",n=>P_e(n.borderColor))]),t.hasMultipassGeometry&&(r.include(qDe,t),r.uniforms.add(new Wi("inverseViewport",(n,s)=>s.inverseViewport))),r.code.add(S`
    void main() {
      ${t.hasMultipassGeometry?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line
      // blends on top of the border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage
      // and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${t.depthHudEnabled?S`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:S`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      gl_FragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),e}function P_e(t){return v(t)?t:Qg}const I_e=Fe(),hCt=Object.freeze(Object.defineProperty({__proto__:null,build:uCt},Symbol.toStringTag,{value:"Module"}));let I5e=class $5e extends Yi{initializeConfiguration(e,i){i.spherical=e.viewingMode===qe.Global}initializeProgram(e){return new Hi(e.rctx,$5e.shader.get().build(this.configuration),Di)}setPipelineState(e){const i=e?Gr.ALWAYS:Gr.LESS;return this.configuration.depthHudEnabled?Ht({depthTest:{func:i},depthWrite:Kc}):Ht({blending:_o(Ce.ONE,Ce.SRC_ALPHA,Ce.ONE_MINUS_SRC_ALPHA,Ce.ONE_MINUS_SRC_ALPHA),depthTest:{func:i},colorWrite:si})}initializePipeline(){return this.setPipelineState(this.configuration.hasMultipassGeometry)}};I5e.shader=new Gi(hCt,()=>Q(()=>import("./LineCallout.glsl-4070306d.js"),[]));let Vd=class extends Do{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=Bc.World,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.hasMultipassGeometry=!1}};u([j({count:Bc.COUNT})],Vd.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([j()],Vd.prototype,"spherical",void 0),u([j()],Vd.prototype,"occlusionTestEnabled",void 0),u([j()],Vd.prototype,"hasVerticalOffset",void 0),u([j()],Vd.prototype,"hasScreenSizePerspective",void 0),u([j()],Vd.prototype,"depthHudEnabled",void 0),u([j()],Vd.prototype,"depthHudAlignStartEnabled",void 0),u([j()],Vd.prototype,"hasSlicePlane",void 0),u([j()],Vd.prototype,"hasMultipassGeometry",void 0),u([j({constValue:!0})],Vd.prototype,"hasSliceInVertexProgram",void 0),u([j({constValue:!1})],Vd.prototype,"isDraped",void 0);let P5=class Ate extends Bw{get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}constructor(e){super(e,new L5e),this._configuration=new Vd,this._uniqueMaterialIdentifier=Ate.uniqueMaterialIdentifier(this.parameters)}getPassParameters(){return this.parameters}getConfiguration(e,i){const r=(i==null?void 0:i.slot)!==Ee.LINE_CALLOUTS;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=v(this.parameters.verticalOffset),this._configuration.hasScreenSizePerspective=v(this.parameters.screenSizePerspective),this._configuration.depthHudEnabled=r,this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?Bc.Screen:Bc.World,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasMultipassGeometry=i.multipassGeometry.enabled,this._configuration}intersect(){}requiresSlot(e,i){if(i===z.Color)switch(e){case Ee.LINE_CALLOUTS:case Ee.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1}createGLMaterial(e){return new dCt(e)}createBufferWriter(){return new fCt}validateParameters(e){const i=Ate.uniqueMaterialIdentifier(e);i!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=i)}static uniqueMaterialIdentifier(e){return JSON.stringify({screenOffset:e.screenOffset||[0,0],centerOffsetUnits:e.centerOffsetUnits||"world"})}},dCt=class extends zw{beginSlot(e){return this.ensureTechnique(I5e,e)}},L5e=class extends HO{constructor(){super(...arguments),this.screenOffset=Jc,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}};const pCt=_n().vec3f(M.POSITION).vec3f(M.NORMAL).vec2f(M.UV0).vec4f(M.AUXPOS1),$_e=[sp(0,0),sp(1,0),sp(0,1),sp(1,0),sp(1,1),sp(0,1)];let fCt=class{constructor(){this.vertexBufferLayout=pCt}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 6*e.indices.get(M.POSITION).length}write(e,i,r,n,s){w7(r.indices.get(M.POSITION),r.vertexAttributes.get(M.POSITION).data,e,n.position,s,6),kle(r.indices.get(M.NORMAL),r.vertexAttributes.get(M.NORMAL).data,i,n.normal,s,6),tO(r.indices.get(M.AUXPOS1),r.vertexAttributes.get(M.AUXPOS1).data,n.auxpos1,s,6);for(let o=0;o<$_e.length;++o)n.uv0.setVec(s+o,$_e[o])}},D5e=class N5e extends My{constructor(e,i){super(e,null,i,yCt),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._material=new P5(this._materialParameters),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}_perInstanceMaterialParameters(e){const i=this._materialParameters;return i.screenOffset=e.screenOffset||Jc,i.centerOffsetUnits=e.centerOffsetUnits||"world",i}get _materialParameters(){const e=new L5e,i=this.symbol,r=i.callout;if(e.color=v(r.color)?Xe.toUnitRGBA(r.color):[0,0,0,0],e.color[3]*=this._getLayerOpacity(),e.size=ga(r.size||0),i.verticalOffset){const{screenLength:o,minWorldLength:a,maxWorldLength:l}=i.verticalOffset;e.verticalOffset={screenLength:ga(o),minWorldLength:a||0,maxWorldLength:v(l)?l:1/0}}e.borderColor=v(r.border)&&v(r.border.color)?Xe.toUnitRGBA(r.border.color):null;const n=i.symbolLayers.getItemAt(0).type==="object",s=i.type==="label-3d";return e.occlusionTest=!n,e.shaderPolygonOffset=n?0:void 0,e.depthHUDAlignStart=s,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}_defaultElevationInfoNoZ(){return gCt}createGraphics3DGraphic(e){const i=e.renderingInfo,r=e.graphic,n=this.setGraphicElevationContext(r,new Om,i.elevationOffset||0),s=i.symbol,o=this._elevationContext.mode==="on-the-ground"&&(s.type==="cim"||!s.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(s.type!=="label-3d"&&o||s.type==="point-3d"&&s.symbolLayers.every(l=>l.type==="text"&&!lAe(l)))return null;const a=qle(r.geometry);return R(a)?null:this._createAs3DShape(a,n,i,r.uid)}layerOpacityChanged(){v(this._material)&&this._material.setParameters(this._materialParameters)}layerElevationInfoChanged(e,i,r){const n=this._elevationContext.mode,s=tF(N5e.elevationModeChangeTypes,r,n);return s!==Ln.UPDATE||e.forEach(o=>{const a=i(o);v(a)&&this.updateGraphicElevationContext(o.graphic,a)}),s}slicePlaneEnabledChanged(){return R(this._material)||this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}setGraphicElevationContext(e,i,r=0){const n=super.setGraphicElevationContext(e,i);return n.addOffsetRenderUnits(r),n}updateGraphicElevationContext(e,i){this.setGraphicElevationContext(e,i.elevationContext,v(i.metadata)?i.metadata.elevationOffset:0),i.needsElevationUpdates=Up(i.elevationContext.mode)}computeComplexity(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:Kle.memory}}_createVertexData(e){const{translation:i,centerOffset:r}=e,n=new Qe(i?[i[0],i[1],i[2]]:[0,0,0],3,!0),s=new Qe(r?[r[0],r[1],r[2],r[3]]:[0,0,0,1],4,!0);return[[M.POSITION,n],[M.NORMAL,new Qe([0,0,1],3,!0)],[M.AUXPOS1,s]]}_getOrCreateMaterial(e){const i=this._perInstanceMaterialParameters(e),r=P5.uniqueMaterialIdentifier(i);if(v(this._material)&&r===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(v(e.materialCollection)){let n=e.materialCollection.get(r);return R(n)&&(n=new P5(i),e.materialCollection.add(r,n)),{material:n,isUnique:!1}}return{material:new P5(i),isUnique:!0}}_createAs3DShape(e,i,r,n){const s=this._context.layer.uid,o=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:s}),a=this._getOrCreateMaterial(r),l=new Os(a.material,this._createVertexData(r),mCt,null,Zn.Point,o),c=ece(this._context,e,l,i,n);if(R(c))return null;const h=new Ry(this,c.object,[l],a.isUnique?[a.material]:null,null,ND,i);return h.metadata=new x5e(r.elevationOffset),h.alignedSampledElevation=c.sampledElevation,h.needsElevationUpdates=Up(i.mode),FD(h,e,this._context.elevationProvider),h}};D5e.elevationModeChangeTypes={definedChanged:Ln.UPDATE,staysOnTheGround:Ln.UPDATE,onTheGroundChanged:Ln.RECREATE};const Nq=[0],mCt=[[M.POSITION,Nq],[M.NORMAL,Nq],[M.AUXPOS1,Nq]],gCt={mode:"relative-to-ground",offset:0},yCt={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};let _Ct=class{constructor(e,i,r=P(),n=pi(),s=Fe(),o="world",a=0,l=null){this.renderer=e,this.symbol=i,this.translation=r,this.centerOffset=n,this.screenOffset=s,this.centerOffsetUnits=o,this.elevationOffset=a,this.materialCollection=l}},vCt=class extends WEt{};const L_e=re.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function bCt(t,e){if(!nse(t))return L_e.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${t.type}' does not support callouts`),null;if(!t.callout)return null;const i=wCt[t.callout.type];return i?new i(t,e):(L_e.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${t.callout.type}`),null)}const wCt={line:D5e},D_e=new zo(Array,t=>X9(t,RCe),null,10,5),xCt=Kt();let TCt=class{get labelLayers(){return this._labelLayers}get extent(){return this._extent}constructor(e,i,r,n,s){this.graphic=e,this.graphics3DSymbol=i,this.layers=r,this._labelLayers=new Array,this._auxiliaryLayers=new Array,this._visibilityFlags=SCt(ha._COUNT,Fu._COUNT),this._featureExpressionFeature=null,this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1},this._extent=null,this.isElevationSource=!1,++i.referenced,this._featureExpressionFeature=s?_5e(s,e,n):null;for(const o of r)v(o)&&(this.isElevationSource=this.isElevationSource||o.isElevationSource)}initialize(e,i){this._layer=i,this._stage=e,this._forEachSymbolLayerGraphic(r=>{r.initialize(e,i),r.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(e=>e.destroy()),this.layers=null,this._auxiliaryLayers=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.layers==null}clearLabelGraphics(){this._forEachLabelGraphic(e=>e.destroy()),this._labelLayers.length=0}addLabelGraphic(e,i,r){this._labelLayers.push(e),e.initialize(i,r),e.setVisibility(this.isVisible(ha.LABEL))}addAuxiliaryGraphic(e){this._auxiliaryLayers.push(e),this._layer&&(e.initialize(this._stage,this._layer),e.setVisibility(this.isVisible()))}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic(i=>{i.type==="draped"&&(e=!0)}),e}isVisible(e=ha.GRAPHIC,i){for(let r=0;r<=e;r++){const n=this._visibilityFlags[r];for(let s=0;s<n.length;++s)if(n[s]===!1&&s!==i)return!1}return!0}hasVisibilityFlag(e,i){return this._visibilityFlags[i][e]!=null}setVisibilityFlag(e,i,r){const n=this.isVisible(r);this._visibilityFlags[r][e]=i;const s=this.isVisible(r);if(n===s)return!1;if(r===ha.LABEL)this._forEachLabelGraphic(o=>o.setVisibility(s));else{this._forEachSymbolLayerGraphic(a=>a.setVisibility(s));const o=this.isVisible(ha.LABEL);this._forEachLabelGraphic(a=>a.setVisibility(o))}return!0}clearVisibilityFlag(e,i=ha.GRAPHIC){return this.setVisibilityFlag(e,void 0,i)}computeExtent(e){if(!this._extent){const i=this.graphic.geometry;if(R(i))return!1;this._extent=Kt(),vEt(i,this._extent);const r=i.spatialReference;if(!Dn(r,e)&&!lB(this._extent,r,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,i){return v(this._optimizedGeometry.geometry)&&this._optimizedGeometry.hasZ===e&&this._optimizedGeometry.hasM===i||(this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,i),this._optimizedGeometry.hasZ=e,this._optimizedGeometry.hasM=i),this._optimizedGeometry.geometry}_convertGraphicToOptimizedGeometry(e,i,r){let n=e.geometry;return n.type!=="mesh"&&n.type!=="extent"||(n=ec.fromExtent(n.type==="mesh"?n.extent:n)),art(n,i,r)}get usedMemory(){let e=_Me(this.graphic.attributes);return this._forEachSymbolLayerGraphic(i=>{const r=i.graphics3DSymbolLayer.complexity;if(R(r))return;const n=i.type==="draped"?r.memory.draped:r.memory;e+=n.bytesPerFeature,n.bytesPerCoordinate&&(e+=_Et(this.graphic.geometry)*n.bytesPerCoordinate)}),e}computeAttachmentOrigin(){const e={render:{origin:P(),num:0},draped:{origin:Fe(),num:0}};for(const i of this.layers)R(i)||i.computeAttachmentOrigin(e);return e.render.num>1&&le(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&ll(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,i,r,n,s){return s||(s={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),s.boundingBox?Br(s.boundingBox):s.boundingBox=Br(),s.requiresDrapedElevation=!1,await vB(this.layers,async o=>{if(R(o))return;const a=o.type==="draped"?i:e,l=D_e.acquire(),c=await o.getProjectedBoundingBox(a,r,s.screenSpaceObjects,n,l);isFinite(c[2])&&isFinite(c[5])||(s.requiresDrapedElevation=!0),c&&wM(s.boundingBox,l),D_e.release(l)}),bWe(s.boundingBox)||fZ(Une(s.boundingBox,xCt))?s:null}needsElevationUpdates(){for(const e of this.layers)if(v(e)&&(e.type==="object3d"||e.type==="lod-instance")&&e.needsElevationUpdates)return!0;for(const e of this._labelLayers)if(e&&e.needsElevationUpdates)return!0;return!1}alignWithElevation(e,i,r){this._forEachRenderedGraphic(n=>{n.type!=="object3d"&&n.type!=="lod-instance"||n.alignWithElevation(e,i,this._featureExpressionFeature,r)})}alignWithAbsoluteElevation(e,i,r){this._forEachRenderedGraphic(n=>{n.type==="object3d"&&n.alignWithAbsoluteElevation(e,i,r)})}addObjectStateSet(e,i){this._forEachSymbolLayerGraphic(r=>r.addObjectState(e,i))}removeObjectState(e){this._forEachSymbolLayerGraphic(i=>i.removeObjectState(e))}_forEachGraphicList(e,i){e.forEach(r=>r&&i(r))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._forEachGraphicList(this._auxiliaryLayers,e)}_forEachLabelGraphic(e){this._forEachGraphicList(this._labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}};function SCt(t,e){const i=new Array(t);for(let r=0;r<i.length;r++)i[r]=new Array(e);return i}var N_e,F_e,k_e,Sw={},ECt={get exports(){return Sw},set exports(t){Sw=t}};N_e=ECt,F_e=function(){function t(N,L,F){F=F||2;var G,W,Z,X,oe,pe,ye,Se=L&&L.length,He=Se?L[0]*F:N.length,De=e(N,0,He,F,!0),Te=[];if(!De||De.next===De.prev)return Te;if(Se&&(De=l(N,L,De,F)),N.length>80*F){G=Z=N[0],W=X=N[1];for(var ke=F;ke<He;ke+=F)(oe=N[ke])<G&&(G=oe),(pe=N[ke+1])<W&&(W=pe),oe>Z&&(Z=oe),pe>X&&(X=pe);ye=(ye=Math.max(Z-G,X-W))!==0?1/ye:0}return r(De,Te,F,G,W,ye),Te}function e(N,L,F,G,W){var Z,X;if(W===q(N,L,F,G)>0)for(Z=L;Z<F;Z+=G)X=ee(Z,N[Z],N[Z+1],X);else for(Z=F-G;Z>=L;Z-=G)X=ee(Z,N[Z],N[Z+1],X);if(X&&C(X,X.next)){var oe=X.next;ie(X),X=oe}return X}function i(N,L){if(!N)return N;L||(L=N);var F,G=N;do if(F=!1,G.steiner||!C(G,G.next)&&E(G.prev,G,G.next)!==0)G=G.next;else{var W=G.prev;if(ie(G),(G=L=W)===G.next)break;F=!0}while(F||G!==L);return L}function r(N,L,F,G,W,Z,X){if(N){!X&&Z&&g(N,G,W,Z);for(var oe,pe,ye=N;N.prev!==N.next;)if(oe=N.prev,pe=N.next,Z?s(N,G,W,Z):n(N))L.push(oe.i/F),L.push(N.i/F),L.push(pe.i/F),ie(N),N=pe.next,ye=pe.next;else if((N=pe)===ye){X?X===1?r(N=o(i(N),L,F),L,F,G,W,Z,2):X===2&&a(N,L,F,G,W,Z):r(i(N),L,F,G,W,Z,1);break}}}function n(N){var L=N.prev,F=N,G=N.next;if(E(L,F,G)>=0)return!1;for(var W=N.next.next;W!==N.prev;){if(x(L.x,L.y,F.x,F.y,G.x,G.y,W.x,W.y)&&E(W.prev,W,W.next)>=0)return!1;W=W.next}return!0}function s(N,L,F,G){var W=N.prev,Z=N,X=N.next;if(E(W,Z,X)>=0)return!1;for(var oe=W.x<Z.x?W.x<X.x?W.x:X.x:Z.x<X.x?Z.x:X.x,pe=W.y<Z.y?W.y<X.y?W.y:X.y:Z.y<X.y?Z.y:X.y,ye=W.x>Z.x?W.x>X.x?W.x:X.x:Z.x>X.x?Z.x:X.x,Se=W.y>Z.y?W.y>X.y?W.y:X.y:Z.y>X.y?Z.y:X.y,He=b(oe,pe,L,F,G),De=b(ye,Se,L,F,G),Te=N.prevZ,ke=N.nextZ;Te&&Te.z>=He&&ke&&ke.z<=De;){if(Te!==N.prev&&Te!==N.next&&x(W.x,W.y,Z.x,Z.y,X.x,X.y,Te.x,Te.y)&&E(Te.prev,Te,Te.next)>=0||(Te=Te.prevZ,ke!==N.prev&&ke!==N.next&&x(W.x,W.y,Z.x,Z.y,X.x,X.y,ke.x,ke.y)&&E(ke.prev,ke,ke.next)>=0))return!1;ke=ke.nextZ}for(;Te&&Te.z>=He;){if(Te!==N.prev&&Te!==N.next&&x(W.x,W.y,Z.x,Z.y,X.x,X.y,Te.x,Te.y)&&E(Te.prev,Te,Te.next)>=0)return!1;Te=Te.prevZ}for(;ke&&ke.z<=De;){if(ke!==N.prev&&ke!==N.next&&x(W.x,W.y,Z.x,Z.y,X.x,X.y,ke.x,ke.y)&&E(ke.prev,ke,ke.next)>=0)return!1;ke=ke.nextZ}return!0}function o(N,L,F){var G=N;do{var W=G.prev,Z=G.next.next;!C(W,Z)&&A(W,G,G.next,Z)&&U(W,Z)&&U(Z,W)&&(L.push(W.i/F),L.push(G.i/F),L.push(Z.i/F),ie(G),ie(G.next),G=N=Z),G=G.next}while(G!==N);return i(G)}function a(N,L,F,G,W,Z){var X=N;do{for(var oe=X.next.next;oe!==X.prev;){if(X.i!==oe.i&&T(X,oe)){var pe=B(X,oe);return X=i(X,X.next),pe=i(pe,pe.next),r(X,L,F,G,W,Z),void r(pe,L,F,G,W,Z)}oe=oe.next}X=X.next}while(X!==N)}function l(N,L,F,G){var W,Z,X,oe=[];for(W=0,Z=L.length;W<Z;W++)(X=e(N,L[W]*G,W<Z-1?L[W+1]*G:N.length,G,!1))===X.next&&(X.steiner=!0),oe.push(w(X));for(oe.sort(c),W=0;W<oe.length;W++)F=i(F=p(oe[W],F),F.next);return F}function c(N,L){return N.x-L.x}function h(N){if(N.next.prev===N)return N;let L=N;for(;;){const F=L.next;if(F.prev===L||F===L||F===N)break;L=F}return L}function p(N,L){var F=f(N,L);if(!F)return L;var G=B(F,N),W=i(F,F.next);let Z=h(G);return i(Z,Z.next),W=h(W),h(L===F?W:L)}function f(N,L){var F,G=L,W=N.x,Z=N.y,X=-1/0;do{if(Z<=G.y&&Z>=G.next.y&&G.next.y!==G.y){var oe=G.x+(Z-G.y)*(G.next.x-G.x)/(G.next.y-G.y);if(oe<=W&&oe>X){if(X=oe,oe===W){if(Z===G.y)return G;if(Z===G.next.y)return G.next}F=G.x<G.next.x?G:G.next}}G=G.next}while(G!==L);if(!F)return null;if(W===X)return F;var pe,ye=F,Se=F.x,He=F.y,De=1/0;G=F;do W>=G.x&&G.x>=Se&&W!==G.x&&x(Z<He?W:X,Z,Se,He,Z<He?X:W,Z,G.x,G.y)&&(pe=Math.abs(Z-G.y)/(W-G.x),U(G,N)&&(pe<De||pe===De&&(G.x>F.x||G.x===F.x&&m(F,G)))&&(F=G,De=pe)),G=G.next;while(G!==ye);return F}function m(N,L){return E(N.prev,N,L.prev)<0&&E(L.next,N,N.next)<0}function g(N,L,F,G){var W=N;do W.z===null&&(W.z=b(W.x,W.y,L,F,G)),W.prevZ=W.prev,W.nextZ=W.next,W=W.next;while(W!==N);W.prevZ.nextZ=null,W.prevZ=null,_(W)}function _(N){var L,F,G,W,Z,X,oe,pe,ye=1;do{for(F=N,N=null,Z=null,X=0;F;){for(X++,G=F,oe=0,L=0;L<ye&&(oe++,G=G.nextZ);L++);for(pe=ye;oe>0||pe>0&&G;)oe!==0&&(pe===0||!G||F.z<=G.z)?(W=F,F=F.nextZ,oe--):(W=G,G=G.nextZ,pe--),Z?Z.nextZ=W:N=W,W.prevZ=Z,Z=W;F=G}Z.nextZ=null,ye*=2}while(X>1);return N}function b(N,L,F,G,W){return(N=1431655765&((N=858993459&((N=252645135&((N=16711935&((N=32767*(N-F)*W)|N<<8))|N<<4))|N<<2))|N<<1))|(L=1431655765&((L=858993459&((L=252645135&((L=16711935&((L=32767*(L-G)*W)|L<<8))|L<<4))|L<<2))|L<<1))<<1}function w(N){var L=N,F=N;do(L.x<F.x||L.x===F.x&&L.y<F.y)&&(F=L),L=L.next;while(L!==N);return F}function x(N,L,F,G,W,Z,X,oe){return(W-X)*(L-oe)-(N-X)*(Z-oe)>=0&&(N-X)*(G-oe)-(F-X)*(L-oe)>=0&&(F-X)*(Z-oe)-(W-X)*(G-oe)>=0}function T(N,L){return N.next.i!==L.i&&N.prev.i!==L.i&&!D(N,L)&&(U(N,L)&&U(L,N)&&V(N,L)&&(E(N.prev,N,L.prev)||E(N,L.prev,L))||C(N,L)&&E(N.prev,N,N.next)>0&&E(L.prev,L,L.next)>0)}function E(N,L,F){return(L.y-N.y)*(F.x-L.x)-(L.x-N.x)*(F.y-L.y)}function C(N,L){return N.x===L.x&&N.y===L.y}function A(N,L,F,G){var W=O(E(N,L,F)),Z=O(E(N,L,G)),X=O(E(F,G,N)),oe=O(E(F,G,L));return W!==Z&&X!==oe||!(W!==0||!I(N,F,L))||!(Z!==0||!I(N,G,L))||!(X!==0||!I(F,N,G))||!(oe!==0||!I(F,L,G))}function I(N,L,F){return L.x<=Math.max(N.x,F.x)&&L.x>=Math.min(N.x,F.x)&&L.y<=Math.max(N.y,F.y)&&L.y>=Math.min(N.y,F.y)}function O(N){return N>0?1:N<0?-1:0}function D(N,L){var F=N;do{if(F.i!==N.i&&F.next.i!==N.i&&F.i!==L.i&&F.next.i!==L.i&&A(F,F.next,N,L))return!0;F=F.next}while(F!==N);return!1}function U(N,L){return E(N.prev,N,N.next)<0?E(N,L,N.next)>=0&&E(N,N.prev,L)>=0:E(N,L,N.prev)<0||E(N,N.next,L)<0}function V(N,L){var F=N,G=!1,W=(N.x+L.x)/2,Z=(N.y+L.y)/2;do F.y>Z!=F.next.y>Z&&F.next.y!==F.y&&W<(F.next.x-F.x)*(Z-F.y)/(F.next.y-F.y)+F.x&&(G=!G),F=F.next;while(F!==N);return G}function B(N,L){var F=new J(N.i,N.x,N.y),G=new J(L.i,L.x,L.y),W=N.next,Z=L.prev;return N.next=L,L.prev=N,F.next=W,W.prev=F,G.next=F,F.prev=G,Z.next=G,G.prev=Z,G}function ee(N,L,F,G){var W=new J(N,L,F);return G?(W.next=G.next,W.prev=G,G.next.prev=W,G.next=W):(W.prev=W,W.next=W),W}function ie(N){N.next.prev=N.prev,N.prev.next=N.next,N.prevZ&&(N.prevZ.nextZ=N.nextZ),N.nextZ&&(N.nextZ.prevZ=N.prevZ)}function J(N,L,F){this.i=N,this.x=L,this.y=F,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function q(N,L,F,G){for(var W=0,Z=L,X=F-G;Z<F;Z+=G)W+=(N[X]-N[Z])*(N[Z+1]+N[X+1]),X=Z;return W}return t.deviation=function(N,L,F,G){var W=L&&L.length,Z=W?L[0]*F:N.length,X=Math.abs(q(N,0,Z,F));if(W)for(var oe=0,pe=L.length;oe<pe;oe++){var ye=L[oe]*F,Se=oe<pe-1?L[oe+1]*F:N.length;X-=Math.abs(q(N,ye,Se,F))}var He=0;for(oe=0;oe<G.length;oe+=3){var De=G[oe]*F,Te=G[oe+1]*F,ke=G[oe+2]*F;He+=Math.abs((N[De]-N[ke])*(N[Te+1]-N[De+1])-(N[De]-N[Te])*(N[ke+1]-N[De+1]))}return X===0&&He===0?0:Math.abs((He-X)/X)},t.flatten=function(N){for(var L=N[0][0].length,F={vertices:[],holes:[],dimensions:L},G=0,W=0;W<N.length;W++){for(var Z=0;Z<N[W].length;Z++)for(var X=0;X<L;X++)F.vertices.push(N[W][Z][X]);W>0&&(G+=N[W-1].length,F.holes.push(G))}return F},t},(k_e=F_e())!==void 0&&(N_e.exports=k_e);const M7=re.getLogger("esri.views.3d.support.buffer.math");function rF(t,e,i){if(t.count!==e.count)return void M7.error("source and destination buffers need to have the same number of elements");const r=t.count,n=i[0],s=i[1],o=i[2],a=i[4],l=i[5],c=i[6],h=i[8],p=i[9],f=i[10],m=i[12],g=i[13],_=i[14],b=t.typedBuffer,w=t.typedBufferStride,x=e.typedBuffer,T=e.typedBufferStride;for(let E=0;E<r;E++){const C=E*w,A=E*T,I=x[A],O=x[A+1],D=x[A+2];b[C]=n*I+a*O+h*D+m,b[C+1]=s*I+l*O+p*D+g,b[C+2]=o*I+c*O+f*D+_}}function Ew(t,e,i){if(t.count!==e.count)return void M7.error("source and destination buffers need to have the same number of elements");const r=t.count,n=i[0],s=i[1],o=i[2],a=i[3],l=i[4],c=i[5],h=i[6],p=i[7],f=i[8],m=t.typedBuffer,g=t.typedBufferStride,_=e.typedBuffer,b=e.typedBufferStride;for(let w=0;w<r;w++){const x=w*g,T=w*b,E=_[T],C=_[T+1],A=_[T+2];m[x]=n*E+a*C+h*A,m[x+1]=s*E+l*C+p*A,m[x+2]=o*E+c*C+f*A}}function Rte(t,e,i){const r=Math.min(t.count,e.count),n=t.typedBuffer,s=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;for(let l=0;l<r;l++){const c=l*s,h=l*a;n[c]=i*o[h],n[c+1]=i*o[h+1],n[c+2]=i*o[h+2]}}function tce(t,e){const i=Math.min(t.count,e.count),r=t.typedBuffer,n=t.typedBufferStride,s=e.typedBuffer,o=e.typedBufferStride;for(let a=0;a<i;a++){const l=a*n,c=a*o,h=s[c],p=s[c+1],f=s[c+2],m=h*h+p*p+f*f;if(m>0){const g=1/Math.sqrt(m);r[l]=g*h,r[l+1]=g*p,r[l+2]=g*f}}}function CCt(t,e,i){const r=Math.min(t.count,e.count),n=t.typedBuffer,s=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;for(let l=0;l<r;l++){const c=l*s,h=l*a;n[c]=o[h]>>i,n[c+1]=o[h+1]>>i,n[c+2]=o[h+2]>>i}}Object.freeze(Object.defineProperty({__proto__:null,normalize:tce,scale:Rte,shiftRight:CCt,transformMat3:Ew,transformMat4:rF},Symbol.toStringTag,{value:"Module"}));function ACt(t,e,i){return{objectId:t,target:e,distance:i,type:"vertex"}}function U_e(t,e,i,r,n,s=!1){return{objectId:t,target:e,distance:i,type:"edge",start:r,end:n,draped:s}}function O7(t,e){if(!t||t.symbol)return null;const i=e&&e.renderer;return t&&v(i)&&i.getObservationRenderer?i.getObservationRenderer(t):i}function RCt(t,e){if(v(t.symbol))return t.symbol;const i=O7(t,e);return v(i)&&i.type!=="dot-density"?i.getSymbol(t,e):null}function YYt(t,e){const i=O7(t,e),r=RCt(t,e);if(R(r))return null;const n={renderer:i,symbol:r};if(R(i)||!("visualVariables"in i)||!i.visualVariables)return n;const s=noe(i,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of s)switch(a.type){case"color":n.color=l.toRgba();break;case"size":if(a.target==="outline")n.outlineSize=l;else{const c=a.axis,h=a.useSymbolValue?"symbol-value":l;switch(c){case"width":o[0]=h;break;case"depth":o[1]=h;break;case"height":o[2]=h;break;case"width-and-depth":o[0]=o[1]=h;break;default:o[0]=o[1]=o[2]=h}}break;case"opacity":n.opacity=l;break;case"rotation":switch(a.axis){case"tilt":n.tilt=l;break;case"roll":n.roll=l;break;default:n.heading=l}}return o[0]==="proportional"&&o[1]==="proportional"&&o[2]==="proportional"||(n.size=o),n}async function MCt(t,e){if(v(t.symbol))return t.symbol;const i=O7(t,e);return v(i)?i.getSymbolAsync(t,e):null}async function ZYt(t,e){const i=O7(t,e),r=await MCt(t,e);if(!r)return null;const n={renderer:i,symbol:r};if(!i||!("visualVariables"in i)||!i.visualVariables)return n;const s=noe(i,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of s)if(a.type==="color")n.color=Xe.toUnitRGBA(l);else if(a.type==="size")if(a.target==="outline")n.outlineSize=l;else{const c=a.axis,h=a.useSymbolValue?"symbol-value":l;c==="width"?o[0]=h:c==="depth"?o[1]=h:c==="height"?o[2]=h:o[0]=o[1]=c==="width-and-depth"?h:o[2]=h}else a.type==="opacity"?n.opacity=l:a.type==="rotation"&&a.axis==="tilt"?n.tilt=l:a.type==="rotation"&&a.axis==="roll"?n.roll=l:a.type==="rotation"&&(n.heading=l);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(n.size=o),n}function OCt(t,e=0){const i=t[e];return typeof i=="number"&&isFinite(i)?i:null}function PCt(t){for(let e=0;e<3;e++){const i=t[e];if(typeof i=="number")return isFinite(i)?i:0}return 0}function V_e(t){const e=[[M.POSITION,t.indices]],i=[[M.POSITION,new Qe(t.attributeData.position,3,!0)]];return v(t.attributeData.color)&&(i.push([M.COLOR,new Qe(t.attributeData.color,4,!0)]),e.push([M.COLOR,new Array(t.indices.length).fill(0)])),v(t.attributeData.uvMapSpace)&&(i.push([M.UVMAPSPACE,new Qe(t.attributeData.uvMapSpace,4,!0)]),e.push([M.UVMAPSPACE,t.indices])),v(t.attributeData.boundingRect)&&(i.push([M.BOUNDINGRECT,new Qe(t.attributeData.boundingRect,9,!0)]),e.push([M.BOUNDINGRECT,t.indices])),new Os(t.material,i,e,t.mapPositions,Zn.Mesh,t.attributeData.objectAndLayerIdColor)}function z_e(t){const e=[[M.POSITION,t.indices],[M.UV0,t.indices]],i=[[M.POSITION,new Qe(t.attributeData.position,3,!0)],[M.UV0,new Qe(t.attributeData.uv0,2,!0)]];return new Os(t.material,i,e,t.mapPositions)}function UD(t){switch(t.type){case"extent":if(t instanceof ni)return ec.fromExtent(t);break;case"polygon":return t}return null}let P7=class{constructor(e,i,r){this.renderData=e,this.layerUid=i,this.graphicUid=r,this.outGeometries=new Array}};function Mte(t,e,i){const r=Array.isArray(t),n=r?t.length/e:t.byteLength/(4*e),s=r?t:new Uint32Array(t,0,n*e),o=(i==null?void 0:i.minReduction)??0,a=(i==null?void 0:i.originalIndices)||null,l=a?a.length:0,c=(i==null?void 0:i.componentOffsets)||null;let h=0;if(c)for(let A=0;A<c.length-1;A++){const I=c[A+1]-c[A];I>h&&(h=I)}else h=n;const p=Math.floor(1.1*h)+1;(Um==null||Um.length<2*p)&&(Um=new Uint32Array(vM(2*p)));for(let A=0;A<2*p;A++)Um[A]=0;let f=0;const m=!!c&&!!a,g=m?l:n;let _=PNe(n/3);const b=new Uint32Array(l),w=1.96;let x=o!==0?Math.ceil(4*w*w/(o*o)*o*(1-o)):g,T=1,E=c?c[1]:g;for(let A=0;A<g;A++){if(A===x){const B=1-f/A;if(B+w*Math.sqrt(B*(1-B)/A)<o)return null;x*=2}if(A===E){for(let B=0;B<2*p;B++)Um[B]=0;if(a)for(let B=c[T-1];B<c[T];B++)b[B]=_[a[B]];E=c[++T]}const I=m?a[A]:A,O=I*e,D=LCt(s,O,e);let U=D%p,V=f;for(;Um[2*U+1]!==0;){if(Um[2*U]===D){const B=Um[2*U+1]-1;if(ICt(s,O,B*e,e)){V=_[B];break}}U++,U>=p&&(U-=p)}V===f&&(Um[2*U]=D,Um[2*U+1]=I+1,f++),_[I]=V}if(o!==0&&1-f/n<o)return null;if(m){for(let A=c[T-1];A<b.length;A++)b[A]=_[a[A]];_=BR(b)}const C=r?new Array(f):new Uint32Array(f*e);f=0;for(let A=0;A<g;A++)_[A]===f&&($Ct(s,(m?a[A]:A)*e,C,f*e,e),f++);if(a&&!m){const A=new Uint32Array(l);for(let I=0;I<A.length;I++)A[I]=_[a[I]];_=BR(A)}return{buffer:Array.isArray(C)?C:C.buffer,indices:_,uniqueCount:f}}function ICt(t,e,i,r){for(let n=0;n<r;n++)if(t[e+n]!==t[i+n])return!1;return!0}function $Ct(t,e,i,r,n){for(let s=0;s<n;s++)i[r+s]=t[e+s]}function LCt(t,e,i){let r=0;for(let n=0;n<i;n++)r=t[e+n]+r|0,r=r+(r<<11)+(r>>>2)|0;return r>>>0}let Um=null;function KYt(t){const e=nF(t.rings,t.hasZ,vy.CCW_IS_HOLE),i=new Array;let r=0,n=0;for(const a of e.polygons){const l=a.count,c=a.index,h=Sp(e.position,3*c,3*l),p=a.holeIndices.map(m=>m-c),f=new Uint32Array(Sw(h,p,3));i.push({position:h,faces:f}),r+=h.length,n+=f.length}const s=DCt(i,r,n),o=Array.isArray(s.position)?Mte(s.position,3,{originalIndices:s.faces}):Mte(s.position.buffer,6,{originalIndices:s.faces});return s.position=new Float64Array(o.buffer),s.faces=o.indices,s}function DCt(t,e,i){if(t.length===1)return t[0];const r=th(e),n=new Uint32Array(i);let s=0,o=0,a=0;for(const l of t){for(let c=0;c<l.position.length;c++)r[s++]=l.position[c];for(let c=0;c<l.faces.length;c++)n[o++]=l.faces[c]+a;a=s/3}return{position:r,faces:n}}function nF(t,e,i){const r=t.length,n=new Array(r),s=new Array(r),o=new Array(r);let a=0,l=0,c=0,h=0;for(let m=0;m<r;++m)h+=t[m].length;const p=th(3*h);let f=0;for(let m=r-1;m>=0;m--){const g=t[m],_=i===vy.CCW_IS_HOLE&&NCt(g);if(_&&r!==1)n[a++]=g;else{let b=g.length;for(let x=0;x<a;++x)b+=n[x].length;const w={index:f,pathLengths:new Array(a+1),count:b,holeIndices:new Array(a)};w.pathLengths[0]=g.length,g.length>0&&(o[c++]={index:f,count:g.length}),f=_?I5(g,g.length-1,-1,p,f,g.length,e):I5(g,0,1,p,f,g.length,e);for(let x=0;x<a;++x){const T=n[x];w.holeIndices[x]=f,w.pathLengths[x+1]=T.length,T.length>0&&(o[c++]={index:f,count:T.length}),f=I5(T,0,1,p,f,T.length,e)}a=0,w.count>0&&(s[l++]=w)}}for(let m=0;m<a;++m){const g=n[m];g.length>0&&(o[c++]={index:f,count:g.length}),f=I5(g,0,1,p,f,g.length,e)}return s.length=l,o.length=c,{position:p,polygons:s,outlines:o}}function I5(t,e,i,r,n,s,o){n*=3;for(let a=0;a<s;++a){const l=t[e];r[n++]=l[0],r[n++]=l[1],r[n++]=o?l[2]:0,e+=i}return n/3}function NCt(t){return!une(t,!1,!1)}var vy;(function(t){t[t.NONE=0]="NONE",t[t.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(vy||(vy={}));var iL,Fz,Ote;(function(t){t[t.RasterImage=0]="RasterImage",t[t.Features=1]="Features"})(iL||(iL={})),function(t){t[t.MapLayer=0]="MapLayer",t[t.ViewLayer=1]="ViewLayer",t[t.Outline=2]="Outline",t[t.SnappingHint=3]="SnappingHint"}(Fz||(Fz={})),function(t){t[t.WithRasterImage=0]="WithRasterImage",t[t.WithoutRasterImage=1]="WithoutRasterImage"}(Ote||(Ote={}));var mn,op,It,rL,Pn,qs,nl;(function(t){t[t.INNER=0]="INNER",t[t.OUTER=1]="OUTER"})(mn||(mn={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",t[t.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",t[t.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(op||(op={})),function(t){t[t.NORTH=0]="NORTH",t[t.NORTH_EAST=1]="NORTH_EAST",t[t.EAST=2]="EAST",t[t.SOUTH_EAST=3]="SOUTH_EAST",t[t.SOUTH=4]="SOUTH",t[t.SOUTH_WEST=5]="SOUTH_WEST",t[t.WEST=6]="WEST",t[t.NORTH_WEST=7]="NORTH_WEST"}(It||(It={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(rL||(rL={})),function(t){t[t.Color=0]="Color",t[t.ColorNoRasterImage=1]="ColorNoRasterImage",t[t.Highlight=2]="Highlight",t[t.Water=3]="Water",t[t.Occluded=4]="Occluded",t[t.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"}(Pn||(Pn={})),function(t){t[t.FADING=0]="FADING",t[t.IMMEDIATE=1]="IMMEDIATE",t[t.UNFADED=2]="UNFADED"}(qs||(qs={})),function(t){t[t.INSIDE=0]="INSIDE",t[t.INTERSECTS=1]="INTERSECTS",t[t.OUTSIDE=2]="OUTSIDE"}(nl||(nl={}));let FCt=class{constructor(e,i){this.vec3=e,this.id=i}};function nL(t,e,i,r){return new FCt(Ue(t,e,i),r)}var Dc;(function(t){t[t.None=0]="None",t[t.ColorAndWater=1]="ColorAndWater",t[t.Highlight=2]="Highlight",t[t.Occluded=3]="Occluded",t[t.ObjectAndLayerIdColor=4]="ObjectAndLayerIdColor"})(Dc||(Dc={}));let B_e=class{get extent(){return this._extent}constructor(e,i){this.index=e,this.renderTargets=i,this._extent=Kt(),this.resolution=0,this.renderLocalOrigin=nL(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new kCt,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=e,this.validTargets=new Array(i.renderTargets.length).fill(!1)}getValidTexture(e){return this.validTargets[e]?this.renderTargets.getTarget(e).getTexture():null}get _needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(e){const i=e===Dc.ColorAndWater?this.renderTargets.getTarget(Pn.Color):e===Dc.Highlight?this.renderTargets.getTarget(Pn.Highlight):e===Dc.ObjectAndLayerIdColor?this.renderTargets.getTarget(Pn.ObjectAndLayerIdColor):this.renderTargets.getTarget(Pn.Occluded);return i?i.getTexture():null}getColorTextureNoRasterImage(){return this._needsColorWithoutRasterImage?this.getValidTexture(Pn.ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(Pn.Color):null}getNormalTexture(e){const i=e===Dc.ColorAndWater?this.renderTargets.getTarget(Pn.Water):null;return i?i.getTexture():null}draw(e,i){const r=this.computeRenderTargetValidityBitfield();for(const n of this.renderTargets.renderTargets)n.type!==Pn.ColorNoRasterImage||this._needsColorWithoutRasterImage?this.validTargets[n.type]=e.drawTarget(this,n,i):this.validTargets[n.type]=!1;return r^this.computeRenderTargetValidityBitfield()?XM.CHANGED:XM.UNCHANGED}computeRenderTargetValidityBitfield(){const e=this.validTargets;return+e[Pn.Color]|+e[Pn.ColorNoRasterImage]<<1|+e[Pn.Highlight]<<2|+e[Pn.Water]<<3|+e[Pn.Occluded]<<4}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const i=.001*e.range;if(this._extent[0]-i<=e.min){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];oV(this._extent,e.range,0,r)}if(this._extent[2]+i>=e.max){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];oV(this._extent,-e.range,0,r)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,A_(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const i=this.canvasGeometries.extents[e];if(i[0]!==i[2]&&i[1]!==i[3])return!0}return!1}applyViewport(e){e.setViewport(this.index===mn.INNER?0:this.resolution,0,this.resolution,this.resolution)}},kCt=class{constructor(){this.extents=[Kt(),Kt(),Kt()],this.numViews=0}},F5e=class{constructor(e,i){this._size=Joe(),this._fbo=null,this._fbo=new es(e,{colorTarget:En.TEXTURE,depthStencilTarget:Vi.NONE},{target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE,samplingMode:nt.LINEAR_MIPMAP_LINEAR,hasMipmap:i,maxAnisotropy:8,width:0,height:0})}dispose(){this._fbo=rt(this._fbo)}getTexture(){return this._fbo?this._fbo.colorTexture:null}isValid(){return this._fbo!==null}resize(e,i){this._size[0]=e,this._size[1]=i,this._fbo.resize(this._size[0],this._size[1])}bind(e){e.bindFramebuffer(this._fbo)}generateMipMap(){const e=this._fbo.colorTexture;e.descriptor.hasMipmap&&e.generateMipmap()}disposeRenderTargetMemory(){var e;(e=this._fbo)==null||e.resize(0,0)}get gpuMemoryUsage(){var e;return((e=this._fbo)==null?void 0:e.gpuMemoryUsage)??0}},UE=class{constructor(e,i,r,n=!0){this.output=i,this.type=r,this.valid=!1,this.lastUsed=1/0,this.fbo=new F5e(e,n)}},UCt=class{constructor(e){this.renderTargets=[new UE(e,z.Color,Pn.Color),new UE(e,z.Color,Pn.ColorNoRasterImage),new UE(e,z.Highlight,Pn.Highlight,!1),new UE(e,z.Normal,Pn.Water),new UE(e,z.Color,Pn.Occluded)],ue("enable-feature:objectAndLayerId-rendering")&&this.renderTargets.push(new UE(e,z.ObjectAndLayerIdColor,Pn.ObjectAndLayerIdColor))}getTarget(e){return this.renderTargets[e].fbo}dispose(){for(const e of this.renderTargets)e.fbo.dispose()}disposeRenderTargetMemory(){for(const e of this.renderTargets)e.fbo.disposeRenderTargetMemory()}validateUsageForTarget(e,i,r){if(e)i.lastUsed=r;else if(r-i.lastUsed>VCt)i.fbo.disposeRenderTargetMemory(),i.lastUsed=1/0;else if(i.lastUsed<1/0)return!0;return!1}get gpuMemoryUsage(){return this.renderTargets.reduce((e,i)=>e+i.fbo.gpuMemoryUsage,0)}};const VCt=1e3;let k5e=class{constructor(e){this._context=e,this._perConstructorInstances=new VO,this._frameCounter=0,this._keepAliveFrameCount=j_e}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach(e=>e.forEach(i=>i.technique.destroy())),this._perConstructorInstances.clear()}acquire(e,i=BCt){const r=i.key;let n=this._perConstructorInstances.get(e,r);if(R(n)){const s=new e(this._context,i,()=>this.release(s));n=new zCt(s),this._perConstructorInstances.set(e,r,n)}return++n.refCount,n.technique}releaseAndAcquire(e,i,r){if(v(r)){if(i.key===r.key)return r;this.release(r)}return this.acquire(e,i)}release(e){if(R(e)||this._perConstructorInstances.empty)return;const i=this._perConstructorInstances.get(e.constructor,e.key);R(i)||(--i.refCount,i.refCount===0&&(i.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==j_e&&this._perConstructorInstances.forEach((e,i)=>{e.forEach((r,n)=>{r.refCount===0&&r.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(r.technique.destroy(),this._perConstructorInstances.delete(i,n))})})}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach((i,r)=>{const n=async(s,o)=>{const a=o.shader;a&&(await a.reload(),s.forEach(l=>l.technique.reload(this._context)))};e.push(n(i,r))}),await Promise.all(e)}},zCt=class{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}};const j_e=-1,BCt=new wl;let U5e=class{constructor(e,i,r,n){this._textureRepository=e,this._techniqueRepository=i,this.materialChanged=r,this.requestRender=n,this._id2glMaterialRef=new VO}dispose(){this._textureRepository.destroy()}acquire(e,i,r){if(this._ownMaterial(e),!e.requiresSlot(i,r))return null;let n=this._id2glMaterialRef.get(r,e.id);if(R(n)){const s=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:r});n=new jCt(s),this._id2glMaterialRef.set(r,e.id,n)}return n.ref(),n.glMaterial}release(e,i){const r=this._id2glMaterialRef.get(i,e.id);v(r)&&(r.unref(),r.referenced||(rt(r.glMaterial),this._id2glMaterialRef.delete(i,e.id)))}_ownMaterial(e){v(e.repository)&&e.repository!==this&&re.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}},jCt=class{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,wt(this._refCnt>=0)}get referenced(){return this._refCnt>0}};const GCt={orderedRepackingEnabled:!1},HCt={rootOrigin:null},qCt=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","objectGeometryUpdated"];let Pte=class Ite{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(e,i){this._objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new Mo,this._objectCount=0,i&&(i.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=i.maximumObjectsPerNode),i.maximumDepth!==void 0&&(this._maximumDepth=i.maximumDepth))}destroy(){this._degenerateObjects.clear(),Mo.clearPool(),$te[0]=null,yx.prune(),$T.prune()}add(e,i=e.length){this._objectCount+=i,this._grow(e,i);const r=Mo.acquire();for(let n=0;n<i;n++){const s=e[n];this._isDegenerate(s)?this._degenerateObjects.add(s):(r.init(this._root),this._add(s,r))}Mo.release(r)}remove(e,i=null){this._objectCount-=e.length;const r=Mo.acquire();for(const n of e){const s=v(i)?i:qM(this._objectToBoundingSphere(n),JCt);BI(s[3])?(r.init(this._root),this._remove(n,s,r)):this._degenerateObjects.delete(n)}Mo.release(r),this._shrink()}update(e,i){if(!BI(i[3])&&this._isDegenerate(e))return;const r=ZCt(e);this.remove(r,i),this.add(r)}forEachAlongRay(e,i,r){const n=cd(e,i);this._forEachNode(this._root,s=>{if(!this._intersectsNode(n,s))return!1;const o=s.node;return o.terminals.forAll(a=>{this._intersectsObject(n,a)&&r(a)}),o.residents!==null&&o.residents.forAll(a=>{this._intersectsObject(n,a)&&r(a)}),!0})}forEachAlongRayWithVerticalOffset(e,i,r,n){const s=cd(e,i);this._forEachNode(this._root,o=>{if(!this._intersectsNodeWithOffset(s,o,n))return!1;const a=o.node;return a.terminals.forAll(l=>{this._intersectsObjectWithOffset(s,l,n)&&r(l)}),a.residents!==null&&a.residents.forAll(l=>{this._intersectsObjectWithOffset(s,l,n)&&r(l)}),!0})}forEach(e){this._forEachNode(this._root,i=>{const r=i.node;return r.terminals.forAll(e),r.residents!==null&&r.residents.forAll(e),!0}),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,i,r,n=()=>!0,s=1/0){let o=1/0,a=1/0,l=null;const c=Fq(e,i),h=p=>{if(--s,!n(p))return;const f=this._objectToBoundingSphere(p);if(!Eb(r,f))return;const m=H1(e,i,f),g=m-f[3],_=m+f[3];g<o&&(o=g,a=_,l=p)};return this._forEachNodeDepthOrdered(this._root,p=>{if(s<=0||!Eb(r,p.bounds)||(le(xd,c,p.halfSize),me(xd,xd,p.bounds),H1(e,i,xd)>a))return!1;const f=p.node;return f.terminals.forAll(m=>h(m)),f.residents!==null&&f.residents.forAll(m=>h(m)),!0},e,i),l}forEachInDepthRange(e,i,r,n,s,o,a){let l=-1/0,c=1/0;const h={setRange:_=>{r===Ite.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,_.near),c=Math.min(c,_.far)):(l=Math.max(l,-_.far),c=Math.min(c,-_.near))}};h.setRange(n);const p=H1(i,r,e),f=Fq(i,r),m=Fq(i,-r),g=_=>{if(!a(_))return;const b=this._objectToBoundingSphere(_),w=b,x=H1(i,r,w)-p,T=x-b[3],E=x+b[3];T>c||E<l||!Eb(o,b)||s(_,h)};this._forEachNodeDepthOrdered(this._root,_=>{if(!Eb(o,_.bounds)||(le(xd,f,_.halfSize),me(xd,xd,_.bounds),H1(i,r,xd)-p>c)||(le(xd,m,_.halfSize),me(xd,xd,_.bounds),H1(i,r,xd)-p<l))return!1;const b=_.node;return b.terminals.forAll(w=>g(w)),b.residents!==null&&b.residents.forAll(w=>g(w)),!0},i,r)}forEachNode(e){this._forEachNode(this._root,i=>e(i.node,i.bounds,i.halfSize))}forEachNeighbor(e,i){const r=c_(i),n=i,s=l=>{const c=this._objectToBoundingSphere(l),h=c_(c),p=r+h;return!(ba(c,n)-p*p<=0)||e(l)};let o=!0;const a=l=>{o&&(o=s(l))};this._forEachNode(this._root,l=>{const c=c_(l.bounds),h=r+c;if(ba(l.bounds,n)-h*h>0)return!1;const p=l.node;return p.terminals.forAll(a),o&&p.residents!==null&&p.residents.forAll(a),o}),o&&this.forEachDegenerateObject(a)}_intersectsNode(e,i){return $5(i.bounds,2*-i.halfSize,Vh),$5(i.bounds,2*i.halfSize,zh),Bye(e.origin,e.direction,Vh,zh)}_intersectsNodeWithOffset(e,i,r){return $5(i.bounds,2*-i.halfSize,Vh),$5(i.bounds,2*i.halfSize,zh),r.applyToMinMax(Vh,zh),Bye(e.origin,e.direction,Vh,zh)}_intersectsObject(e,i){const r=this._objectToBoundingSphere(i);return!(r[3]>0)||BQ(r,e)}_intersectsObjectWithOffset(e,i,r){const n=this._objectToBoundingSphere(i);return!(n[3]>0)||BQ(r.applyToBoundingSphere(n),e)}_forEachNode(e,i){let r=Mo.acquire().init(e);const n=[r];for(;n.length!==0;){if(r=n.pop(),i(r)&&!r.isLeaf())for(let s=0;s<r.node.children.length;s++)r.node.children[s]&&n.push(Mo.acquire().init(r).advance(s));Mo.release(r)}}_forEachNodeDepthOrdered(e,i,r,n=Ite.DepthOrder.FRONT_TO_BACK){let s=Mo.acquire().init(e);const o=[s];for(YCt(r,n,q_e);o.length!==0;){if(s=o.pop(),i(s)&&!s.isLeaf())for(let a=7;a>=0;--a){const l=q_e[a];s.node.children[l]&&o.push(Mo.acquire().init(s).advance(l))}Mo.release(s)}}_remove(e,i,r){yx.clear();const n=r.advanceTo(i,(s,o)=>{yx.push(s.node),yx.push(o)})?r.node.terminals:r.node.residents;if(n.removeUnordered(e),n.length===0)for(let s=yx.length-2;s>=0;s-=2){const o=yx.data[s],a=yx.data[s+1];if(!this._purge(o,a))break}}_nodeIsEmpty(e){if(e.terminals.length!==0)return!1;if(e.residents!==null)return e.residents.length===0;for(let i=0;i<e.children.length;i++)if(e.children[i])return!1;return!0}_purge(e,i){return i>=0&&(e.children[i]=null),!!this._nodeIsEmpty(e)&&(e.residents===null&&(e.residents=new Wt({shrink:!0})),!0)}_add(e,i){i.advanceTo(this._objectToBoundingSphere(e))?i.node.terminals.push(e):(i.node.residents.push(e),i.node.residents.length>this._maximumObjectsPerNode&&i.depth<this._maximumDepth&&this._split(i))}_split(e){const i=e.node.residents;e.node.residents=null;for(let r=0;r<i.length;r++){const n=Mo.acquire().init(e);this._add(i.getItemAt(r),n),Mo.release(n)}}_grow(e,i){if(i!==0&&(G_e(e,i,r=>this._objectToBoundingSphere(r),qy),BI(qy[3])&&!this._fitsInsideTree(qy)))if(this._nodeIsEmpty(this._root.node))qM(qy,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const r=this._rootBoundsForRootAsSubNode(qy);this._placingRootViolatesMaxDepth(r)?this._rebuildTree(qy,r):this._growRootAsSubNode(r),Mo.release(r)}}_rebuildTree(e,i){ce(Uq,i.bounds),Uq[3]=i.halfSize,G_e([e,Uq],2,n=>n,Vq);const r=Mo.acquire().init(this._root);this._root.initFrom(null,Vq,Vq[3]),this._root.increaseHalfSize(1.25),this._forEachNode(r,n=>(this.add(n.node.terminals.data,n.node.terminals.length),n.node.residents!==null&&this.add(n.node.residents.data,n.node.residents.length),!0)),Mo.release(r)}_placingRootViolatesMaxDepth(e){const i=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let r=0;return this._forEachNode(this._root,n=>(r=Math.max(r,n.depth),r+i<=this._maximumDepth)),r+i>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const i=e[3],r=e;let n=-1/0;const s=this._root.bounds,o=this._root.halfSize;for(let l=0;l<3;l++){const c=s[l]-o-(r[l]-i),h=r[l]+i-(s[l]+o),p=Math.max(0,Math.ceil(c/(2*o))),f=Math.max(0,Math.ceil(h/(2*o)))+1,m=2**Math.ceil(Math.log(p+f)*Math.LOG2E);n=Math.max(n,m),L5[l].min=p,L5[l].max=f}for(let l=0;l<3;l++){let c=L5[l].min,h=L5[l].max;const p=(n-(c+h))/2;c+=Math.ceil(p),h+=Math.floor(p);const f=s[l]-o-c*o*2;kq[l]=f+(h+c)*o}const a=n*o;return kq[3]=a*z5e,Mo.acquire().initFrom(null,kq,a,0)}_growRootAsSubNode(e){const i=this._root.node;ce(qy,this._root.bounds),qy[3]=this._root.halfSize,this._root.init(e),e.advanceTo(qy,null,!0),e.node.children=i.children,e.node.residents=i.residents,e.node.terminals=i.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(e===-1)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let e=null;const i=this._root.node.children;let r=0,n=0;for(;n<i.length&&e==null;)r=n++,e=i[r];for(;n<i.length;)if(i[n++])return-1;return r}_isDegenerate(e){return!BI(this._objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const i=this._root.bounds,r=this._root.halfSize;return e[3]<=r&&e[0]>=i[0]-r&&e[0]<=i[0]+r&&e[1]>=i[1]-r&&e[1]<=i[1]+r&&e[2]>=i[2]-r&&e[2]<=i[2]+r}},Mo=class yA{constructor(){this.bounds=Is(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,i,r,n=this.depth){return this.node=v(e)?e:yA.createEmptyNode(),v(i)&&qM(i,this.bounds),this.halfSize=r,this.depth=n,this}increaseHalfSize(e){this.halfSize*=e,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*z5e}advance(e){let i=this.node.children[e];i||(i=yA.createEmptyNode(),this.node.children[e]=i),this.node=i,this.halfSize/=2,this.depth++;const r=V5e[e];return this.bounds[0]+=r[0]*this.halfSize,this.bounds[1]+=r[1]*this.halfSize,this.bounds[2]+=r[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(e,i,r=!1){for(;;){if(this.isTerminalFor(e))return i&&i(this,-1),!0;if(this.isLeaf()){if(!r)return i&&i(this,-1),!1;this.node.residents=null}const n=this._childIndex(e);i&&i(this,n),this.advance(n)}}isLeaf(){return this.node.residents!=null}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const i=this.bounds;return(i[0]<e[0]?1:0)+(i[1]<e[1]?2:0)+(i[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new Wt({shrink:!0}),residents:new Wt({shrink:!0})}}static acquire(){return yA._pool.acquire()}static release(e){yA._pool.release(e)}static clearPool(){yA._pool.prune()}};function WCt(t,e){t[0]=Math.min(t[0],e[0]-e[3]),t[1]=Math.min(t[1],e[1]-e[3]),t[2]=Math.min(t[2],e[2]-e[3])}function XCt(t,e){t[0]=Math.max(t[0],e[0]+e[3]),t[1]=Math.max(t[1],e[1]+e[3]),t[2]=Math.max(t[2],e[2]+e[3])}function $5(t,e,i){i[0]=t[0]+e,i[1]=t[1]+e,i[2]=t[2]+e}function G_e(t,e,i,r){if(e===1){const n=i(t[0]);qM(n,r)}else{Vh[0]=1/0,Vh[1]=1/0,Vh[2]=1/0,zh[0]=-1/0,zh[1]=-1/0,zh[2]=-1/0;for(let n=0;n<e;n++){const s=i(t[n]);BI(s[3])&&(WCt(Vh,s),XCt(zh,s))}ys(r,Vh,zh,.5),r[3]=Math.max(zh[0]-Vh[0],zh[1]-Vh[1],zh[2]-Vh[2])/2}}function YCt(t,e,i){if(!$T.length)for(let r=0;r<8;++r)$T.push({index:0,distance:0});for(let r=0;r<8;++r){const n=V5e[r];$T.data[r].index=r,$T.data[r].distance=H1(t,e,n)}$T.sort((r,n)=>r.distance-n.distance);for(let r=0;r<8;++r)i[r]=$T.data[r].index}function Fq(t,e){let i,r=1/0;for(let n=0;n<8;++n){const s=H1(t,e,H_e[n]);s<r&&(r=s,i=H_e[n])}return i}function H1(t,e,i){return e*(t[0]*i[0]+t[1]*i[1]+t[2]*i[2])}function BI(t){return!isNaN(t)&&t!==-1/0&&t!==1/0&&t>0}Mo._pool=new zo(Mo),function(t){var e;(e=t.DepthOrder||(t.DepthOrder={}))[e.FRONT_TO_BACK=1]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(Pte||(Pte={}));const V5e=[Ue(-1,-1,-1),Ue(1,-1,-1),Ue(-1,1,-1),Ue(1,1,-1),Ue(-1,-1,1),Ue(1,-1,1),Ue(-1,1,1),Ue(1,1,1)],H_e=[Ue(-1,-1,-1),Ue(-1,-1,1),Ue(-1,1,-1),Ue(-1,1,1),Ue(1,-1,-1),Ue(1,-1,1),Ue(1,1,-1),Ue(1,1,1)],z5e=Math.sqrt(3),$te=[null];function ZCt(t){return $te[0]=t,$te}const kq=Is(),xd=P(),Vh=P(),zh=P(),yx=new Wt,JCt=Is(),qy=Is(),Uq=Is(),Vq=Is(),L5=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],$T=new Wt,q_e=[0,0,0,0,0,0,0,0],tm=Pte;var qb;(function(t){t[t.ASYNC=0]="ASYNC",t[t.SYNC=1]="SYNC"})(qb||(qb={}));let B5e=class extends YN{get objects(){return this._objects}constructor(e,i=""){super(),this.apiLayerUid=i,this.type=Zn.Layer,this.events=new An,this.sliceable=!1,this._objects=new Wt,this._objectsAdded=new Wt,this._stageHandles=new Xi,this.apiLayerUid=i,this.visible=(e==null?void 0:e.visible)??!0,this.pickable=(e==null?void 0:e.pickable)??!0,this.updatePolicy=(e==null?void 0:e.updatePolicy)??qb.ASYNC,this._disableOctree=(e==null?void 0:e.disableOctree)??!1}destroy(){this.detachStage(),this._stage=null}attachStage(e){this.detachStage(),this._stage=e;for(const i of qCt)this._stageHandles.add(this.events.on(i,r=>e.handleEvent(i,r)))}detachStage(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),v(this._octree)&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),v(this._octree)&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const i of e)i.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),v(this._octree)&&this._objectsAdded.pushArray(e)}removeMany(e){const i=new Array;if(this._objects.removeUnorderedMany(e,e.length,i),i.length!==0){for(const r of i)r.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:i}),v(this._octree)){for(let r=0;r<i.length;)this._objectsAdded.removeUnordered(i[r])?(i[r]=i[i.length-1],i.length-=1):++r;this._octree.remove(i)}}}sync(){v(this._stage)&&this.updatePolicy!==qb.SYNC&&this._stage.syncLayer(this.id)}notifyObjectBBChanged(e,i){v(this._octree)&&!this._objectsAdded.includes(e)&&this._octree.update(e,i)}getSpatialQueryAccelerator(){return R(this._octree)&&this._objects.length>50&&!this._disableOctree?(this._octree=new tm(e=>e.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):v(this._octree)&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=Ve(this._octree),this._objectsAdded.clear()}};function kz(t){return v(t)&&t.type===Zn.Layer}var Ep,M2;(function(t){t[t.Draped=0]="Draped",t[t.Screen=1]="Screen",t[t.World=2]="World",t[t.COUNT=3]="COUNT"})(Ep||(Ep={})),function(t){t[t.Center=0]="Center",t[t.Tip=1]="Tip",t[t.COUNT=2]="COUNT"}(M2||(M2={}));let ra=class extends Do{constructor(){super(...arguments),this.output=z.Color,this.transparencyPassType=At.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.space=Ep.Screen,this.hideOnShortSegments=!1,this.hasCap=!1,this.anchor=M2.Center,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}};u([j({count:z.COUNT})],ra.prototype,"output",void 0),u([j({count:At.COUNT})],ra.prototype,"transparencyPassType",void 0),u([j()],ra.prototype,"occluder",void 0),u([j()],ra.prototype,"hasSlicePlane",void 0),u([j()],ra.prototype,"writeDepth",void 0),u([j({count:Ep.COUNT})],ra.prototype,"space",void 0),u([j()],ra.prototype,"hideOnShortSegments",void 0),u([j()],ra.prototype,"hasCap",void 0),u([j({count:M2.COUNT})],ra.prototype,"anchor",void 0),u([j()],ra.prototype,"hasTip",void 0),u([j()],ra.prototype,"vvSize",void 0),u([j()],ra.prototype,"vvColor",void 0),u([j()],ra.prototype,"vvOpacity",void 0),u([j()],ra.prototype,"hasOccludees",void 0),u([j()],ra.prototype,"hasMultipassTerrain",void 0),u([j()],ra.prototype,"cullAboveGround",void 0),u([j({constValue:!0})],ra.prototype,"hasVvInstancing",void 0),u([j({constValue:!0})],ra.prototype,"hasSliceTranslatedView",void 0);const W_e=8;function j5e(t,e){const i=t.vertex;i.uniforms.add(new Ie("intrinsicWidth",r=>r.width)),e.vvSize?(t.attributes.add(M.SIZEFEATUREATTRIBUTE,"float"),i.uniforms.add(new Jt("vvSizeMinSize",r=>r.vvSizeMinSize)),i.uniforms.add(new Jt("vvSizeMaxSize",r=>r.vvSizeMaxSize)),i.uniforms.add(new Jt("vvSizeOffset",r=>r.vvSizeOffset)),i.uniforms.add(new Jt("vvSizeFactor",r=>r.vvSizeFactor)),i.code.add(S`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(t.attributes.add(M.SIZE,"float"),i.code.add(S`float getSize(){
return intrinsicWidth * size;
}`)),e.vvOpacity?(t.attributes.add(M.OPACITYFEATUREATTRIBUTE,"float"),i.constants.add("vvOpacityNumber","int",8),i.uniforms.add([new cl("vvOpacityValues",r=>r.vvOpacityValues,W_e),new cl("vvOpacityOpacities",r=>r.vvOpacityOpacities,W_e)]),i.code.add(S`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):i.code.add(S`vec4 applyOpacity( vec4 color ){
return color;
}`),e.vvColor?(t.attributes.add(M.COLORFEATUREATTRIBUTE,"float"),i.constants.add("vvColorNumber","int",hm),i.uniforms.add(new cl("vvColorValues",r=>r.vvColorValues,hm)),i.uniforms.add(new T7("vvColorColors",r=>r.vvColorColors,hm)),i.code.add(S`vec4 interpolateColor( float value ) {
if (value <= vvColorValues[0]) {
return vvColorColors[0];
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return mix(vvColorColors[i-1], vvColorColors[i], f);
}
}
return vvColorColors[vvColorNumber - 1];
}
vec4 getColor(){
return applyOpacity(interpolateColor(colorFeatureAttribute));
}`)):(t.attributes.add(M.COLOR,"vec4"),i.code.add(S`vec4 getColor(){
return applyOpacity(color);
}`))}function N_(t,e){switch(t.fragment.include(nh),e.output){case z.Shadow:case z.ShadowHighlight:case z.ShadowExcludeHighlight:t.extensions.add("GL_OES_standard_derivatives"),t.fragment.code.add(S`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`);break;case z.Depth:t.fragment.code.add(S`void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_linearDepth);
}`)}}let G5e=class{constructor(e){this._rctx=e,this._cache=new Map}destroy(){this._cache.forEach(e=>rt(e.stippleTexture)),this._cache.clear()}_acquire(e){if(R(e))return null;const i=this._patternId(e),r=this._cache.get(i);if(r)return r.refCount++,r;const{encodedData:n,paddedPixels:s}=QCt(e),o=new KCt(new mt(this._rctx,{width:s,height:1,internalFormat:Ge.RGBA,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE},n));return this._cache.set(i,o),o}release(e){if(R(e))return;const i=this._patternId(e),r=this._cache.get(i);r&&(r.refCount--,r.refCount===0&&(v(r.stippleTexture)&&r.stippleTexture.dispose(),this._cache.delete(i)))}swap(e,i){const r=this._acquire(i);return this.release(e),r}_patternId(e){return`${e.pattern.join(",")}-r${e.pixelRatio}`}},KCt=class extends Tr{constructor(e){super(),this.stippleTexture=e,this.refCount=1}};function QCt(t){const e=ice(t),i=1/t.pixelRatio,r=H5e(t),n=q5e(t),s=(Math.floor(.5*(n-1))+.5)*i,o=[];let a=1;for(const m of e){for(let g=0;g<m;g++){const _=a*(Math.min(g,m-1-g)+.5)*i/s*.5+.5;o.push(_)}a=-a}const l=Math.round(e[0]/2),c=[...o.slice(l),...o.slice(0,l)],h=r+W5e,p=new Uint8Array(4*h);let f=4;for(const m of c)ID(m,p,f),f+=4;return p.copyWithin(0,f-4,f),p.copyWithin(f,4,8),{encodedData:p,paddedPixels:h}}function ice(t){return t.pattern.map(e=>Math.round(e*t.pixelRatio))}function H5e(t){if(R(t))return 1;const e=ice(t);return Math.floor(e.reduce((i,r)=>i+r))}function q5e(t){return ice(t).reduce((e,i)=>Math.max(e,i))}const W5e=2;function eAt(t){return R(t)?Qg:t.length===4?t:cr(tAt,t[0],t[1],t[2],1)}const tAt=pi();function X5e(t,e){t.constants.add("stippleAlphaColorDiscard","float",.001),t.constants.add("stippleAlphaHighlightDiscard","float",.5),e.stippleEnabled?iAt(t,e):rAt(t)}function iAt(t,e){const i=!(e.draped&&e.stipplePreferContinuous),{vertex:r,fragment:n}=t;n.include(nh),e.draped||(xm(r,e),r.uniforms.add(new Ie("worldToScreenPerDistanceRatio",(o,a)=>1/a.camera.perScreenPixelRatio)),r.code.add(S`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),t.varyings.add("vStippleDistance","float"),e.stippleRequiresClamp&&t.varyings.add("vStippleDistanceLimits","vec2"),e.stippleRequiresStretchMeasure&&t.varyings.add("vStipplePatternStretch","float"),r.code.add(S`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${sAt};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),r.code.add(S`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),r.code.add(S`
    if (segmentLengthPseudoScreen >= ${i?"patternLength":"1e4"}) {
  `),r.uniforms.add(new Ie("pixelRatio",(o,a)=>a.camera.pixelRatio)),r.code.add(S`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${e.stippleRequiresStretchMeasure?S`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `),n.constants.add("stippleTexturePadding","float",W5e);const s=e.hasWebGL2Context?lr.None:lr.Size;n.uniforms.add(cm("stipplePatternTexture",o=>o.stippleTexture,s)),n.uniforms.add([new Ie("stipplePatternSDFNormalizer",o=>nAt(o.stipplePattern)),new Ie("stipplePatternPixelSizeInv",o=>1/rce(o))]),n.code.add(S`
    float padStippleTexture(float u) {
      float paddedTextureSize = ${Tp(e,"stipplePatternTexture")}.x;
      float unpaddedTextureSize = paddedTextureSize - stippleTexturePadding;

      return (u * unpaddedTextureSize + stippleTexturePadding * 0.5) / paddedTextureSize;
    }
  `),n.code.add(S`
    float getStippleSDF(out bool isClamped) {
      ${e.stippleRequiresClamp?S`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:S`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${e.stippleScaleWithLineWidth?S`u *= vLineSizeInv;`:""}
      u = padStippleTexture(fract(u));

      float encodedSDF = rgba2float(texture2D(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${e.stippleRequiresStretchMeasure?S`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:S`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${e.stippleScaleWithLineWidth?S`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:S`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `),e.stippleOffColorEnabled?(n.uniforms.add(new bi("stippleOffColor",o=>eAt(o.stippleOffColor))),n.code.add(S`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):n.code.add(S`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function rAt(t){t.fragment.code.add(S`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}function nAt(t){return v(t)?(Math.floor(.5*(q5e(t)-1))+.5)/t.pixelRatio:1}function rce(t){const e=t.stipplePattern;return v(e)?H5e(t.stipplePattern)/e.pixelRatio:1}const sAt=S.float(.4),VD=64,nce=VD/2,Y5e=nce/5,oAt=VD/Y5e,aAt=.25;function lAt(t,e){return t.fromData(`${e}-marker`,()=>L4e(e,VD,nce,Y5e))}function Z5e(t,e){const i=t.vertex;t.constants.add("markerSizePerLineWidth","float",oAt),i.uniforms.add(new Ie("pixelRatio",(r,n)=>n.camera.pixelRatio)),R(i.uniforms.get("markerScale"))&&i.constants.add("markerScale","float",1),i.code.add(S`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`),e.space===Ep.World&&(i.constants.add("maxSegmentLengthFraction","float",.45),i.uniforms.add(new Ie("perRenderPixelRatio",(r,n)=>n.camera.perRenderPixelRatio)),i.code.add(S`float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}
bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}`))}var Cp;(function(t){t[t.BUTT=0]="BUTT",t[t.SQUARE=1]="SQUARE",t[t.ROUND=2]="ROUND",t[t.COUNT=3]="COUNT"})(Cp||(Cp={}));let pn=class extends Do{constructor(){super(...arguments),this.output=z.Color,this.capType=Cp.BUTT,this.transparencyPassType=At.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.wireframe=!1,this.objectAndLayerIdColorInstanced=!1}};u([j({count:z.COUNT})],pn.prototype,"output",void 0),u([j({count:Cp.COUNT})],pn.prototype,"capType",void 0),u([j({count:At.COUNT})],pn.prototype,"transparencyPassType",void 0),u([j()],pn.prototype,"occluder",void 0),u([j()],pn.prototype,"hasSlicePlane",void 0),u([j()],pn.prototype,"hasPolygonOffset",void 0),u([j()],pn.prototype,"writeDepth",void 0),u([j()],pn.prototype,"draped",void 0),u([j()],pn.prototype,"stippleEnabled",void 0),u([j()],pn.prototype,"stippleOffColorEnabled",void 0),u([j()],pn.prototype,"stippleScaleWithLineWidth",void 0),u([j()],pn.prototype,"stipplePreferContinuous",void 0),u([j()],pn.prototype,"roundJoins",void 0),u([j()],pn.prototype,"applyMarkerOffset",void 0),u([j()],pn.prototype,"vvSize",void 0),u([j()],pn.prototype,"vvColor",void 0),u([j()],pn.prototype,"vvOpacity",void 0),u([j()],pn.prototype,"falloffEnabled",void 0),u([j()],pn.prototype,"innerColorEnabled",void 0),u([j()],pn.prototype,"hasOccludees",void 0),u([j()],pn.prototype,"hasMultipassTerrain",void 0),u([j()],pn.prototype,"cullAboveGround",void 0),u([j()],pn.prototype,"wireframe",void 0),u([j({constValue:!0})],pn.prototype,"stippleRequiresClamp",void 0),u([j({constValue:!0})],pn.prototype,"stippleRequiresStretchMeasure",void 0),u([j({constValue:!0})],pn.prototype,"hasVvInstancing",void 0),u([j({constValue:!0})],pn.prototype,"hasSliceTranslatedView",void 0),u([j()],pn.prototype,"objectAndLayerIdColorInstanced",void 0);const Uz=1;function cAt(t){const e=new ji,{vertex:i,fragment:r}=e,n=t.hasMultipassTerrain&&(t.output===z.Color||t.output===z.Alpha);e.include(qN),e.include(j5e,t),e.include(X5e,t);const s=t.applyMarkerOffset&&!t.draped;s&&(i.uniforms.add(new Ie("markerScale",m=>m.markerScale)),e.include(Z5e,{space:Ep.World})),t.output===z.Depth&&e.include(N_,t),e.include(x7,t),Yu(i,t),i.uniforms.add([new on("inverseProjectionMatrix",(m,g)=>g.camera.inverseProjectionMatrix),new Wi("nearFar",(m,g)=>g.camera.nearFar),new Ie("miterLimit",m=>m.join!=="miter"?0:m.miterLimit),new bi("viewport",(m,g)=>g.camera.fullViewport)]),i.constants.add("LARGE_HALF_FLOAT","float",65500),e.attributes.add(M.POSITION,"vec3"),e.attributes.add(M.SUBDIVISIONFACTOR,"float"),e.attributes.add(M.UV0,"vec2"),e.attributes.add(M.AUXPOS1,"vec3"),e.attributes.add(M.AUXPOS2,"vec3"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),_w(e),n&&e.varyings.add("depth","float");const o=t.capType===Cp.ROUND,a=t.stippleEnabled&&t.stippleScaleWithLineWidth||o;a&&e.varyings.add("vLineWidth","float");const l=t.stippleEnabled&&t.stippleScaleWithLineWidth;l&&e.varyings.add("vLineSizeInv","float");const c=t.innerColorEnabled||o;c&&e.varyings.add("vLineDistance","float");const h=t.stippleEnabled&&o,p=t.falloffEnabled||h;p&&e.varyings.add("vLineDistanceNorm","float"),o&&(e.varyings.add("vSegmentSDF","float"),e.varyings.add("vReverseSegmentSDF","float")),i.code.add(S`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),i.code.add(S`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),t7(e),i.code.add(S`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${n?"depth = pos.z;":""}
      linearDepth = calculateLinearDepth(nearFar,pos.z);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),i.uniforms.add(new Ie("pixelRatio",(m,g)=>g.camera.pixelRatio)),i.code.add(S`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${a?S`vLineWidth = lineWidth;`:""}
      ${l?S`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);
  `),s&&i.code.add(S`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`),i.code.add(S`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),(t.stippleEnabled||o)&&i.code.add(S`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${o?S`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),i.code.add(S`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),t.roundJoins?i.code.add(S`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${t.stippleEnabled?S`min(1.0, subdivisionFactor * ${S.float((Uz+2)/(Uz+1))})`:S`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):i.code.add(S`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const f=t.capType!==Cp.BUTT;return i.code.add(S`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${f?S`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),i.code.add(S`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${p||c?S`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${c?S`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${p?S`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),o&&i.code.add(S`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),t.stippleEnabled&&(t.draped?i.uniforms.add(new Ie("worldToScreenRatio",(m,g)=>1/g.screenToPCSRatio)):i.code.add(S`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),i.code.add(S`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),t.draped?i.code.add(S`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):i.code.add(S`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),i.uniforms.add(new Ie("stipplePatternPixelSize",m=>rce(m))),i.code.add(S`
      float patternLength = ${t.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `)),i.code.add(S`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${t.wireframe&&!t.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `),n&&e.include(hd,t),e.include(fs,t),r.include(Cy),r.code.add(S`
  void main() {
    discardBySlice(vpos);
    ${n?"terrainDepthTest(gl_FragCoord, depth);":""}
  `),t.wireframe?r.code.add(S`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(o&&r.code.add(S`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${S.float(za)}) {
        discard;
      }
    `),h?r.code.add(S`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${S.float(za)}, stippleCoverage);
      `):r.code.add(S`float stippleAlpha = getStippleAlpha();`),r.uniforms.add(new bi("intrinsicColor",m=>m.color)),t.output!==z.ObjectAndLayerIdColor&&r.code.add(S`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);`),r.code.add(S`vec4 color = intrinsicColor * vColor;`),t.innerColorEnabled&&(r.uniforms.add(new bi("innerColor",m=>Nt(m.innerColor,m.color))),r.uniforms.add(new Ie("innerWidth",(m,g)=>m.innerWidth*g.camera.pixelRatio)),r.code.add(S`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),r.code.add(S`vec4 finalColor = blendStipple(color, stippleAlpha);`),t.falloffEnabled&&(r.uniforms.add(new Ie("falloff",m=>m.falloff)),r.code.add(S`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`))),r.code.add(S`
    ${t.output===z.ObjectAndLayerIdColor?S`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${S.float(za)}) {
      discard;
    }

    ${t.output===z.Alpha?S`gl_FragColor = vec4(finalColor.a);`:""}
    ${t.output===z.Color?S`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===z.Color&&t.transparencyPassType===At.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${t.output===z.Highlight?S`gl_FragColor = vec4(1.0);`:""}
    ${t.output===z.Depth?S`outputDepth(linearDepth);`:""}
    ${t.output===z.ObjectAndLayerIdColor?S`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const uAt=Object.freeze(Object.defineProperty({__proto__:null,RIBBONLINE_NUM_ROUND_JOIN_SUBDIVISIONS:Uz,build:cAt},Symbol.toStringTag,{value:"Module"})),sce={func:Gr.LESS},Vz={func:Gr.ALWAYS},by={mask:255},J5e={mask:0},hAt=t=>({function:{func:Gr.NOTEQUAL,ref:t,mask:t},operation:{fail:Qn.KEEP,zFail:Qn.KEEP,zPass:Qn.KEEP}}),dAt=t=>({function:{func:Gr.ALWAYS,ref:t,mask:t},operation:{fail:Qn.KEEP,zFail:Qn.KEEP,zPass:Qn.REPLACE}}),Gw={function:{func:Gr.ALWAYS,ref:Wc.OutlineVisualElementMask,mask:Wc.OutlineVisualElementMask},operation:{fail:Qn.KEEP,zFail:Qn.KEEP,zPass:Qn.ZERO}},Cw={function:{func:Gr.ALWAYS,ref:Wc.OutlineVisualElementMask,mask:Wc.OutlineVisualElementMask},operation:{fail:Qn.KEEP,zFail:Qn.KEEP,zPass:Qn.REPLACE}},K5e={function:{func:Gr.EQUAL,ref:Wc.OutlineVisualElementMask,mask:Wc.OutlineVisualElementMask},operation:{fail:Qn.KEEP,zFail:Qn.KEEP,zPass:Qn.KEEP}},Q5e={function:{func:Gr.NOTEQUAL,ref:Wc.OutlineVisualElementMask,mask:Wc.OutlineVisualElementMask},operation:{fail:Qn.KEEP,zFail:Qn.KEEP,zPass:Qn.KEEP}},eke=new Map([[M.POSITION,0],[M.SUBDIVISIONFACTOR,1],[M.UV0,2],[M.AUXPOS1,3],[M.AUXPOS2,4],[M.COLOR,5],[M.COLORFEATUREATTRIBUTE,5],[M.SIZE,6],[M.SIZEFEATUREATTRIBUTE,6],[M.OPACITYFEATUREATTRIBUTE,7],[M.OBJECTANDLAYERIDCOLOR,8]]);let tke=class ike extends Yi{initializeProgram(e){return new Hi(e.rctx,ike.shader.get().build(this.configuration),eke)}_makePipelineState(e,i){const r=this.configuration,n=e===At.NONE,s=e===At.FrontFace;return Ht({blending:r.output===z.Color||r.output===z.Alpha?n?nd:ev(e):null,depthTest:{func:jw(e)},depthWrite:n?r.writeDepth?Kc:null:S7(e),colorWrite:si,stencilWrite:r.hasOccludees?by:null,stencilTest:r.hasOccludees?i?Cw:Gw:null,polygonOffset:n||s?r.hasPolygonOffset?X_e:null:C7})}initializePipeline(){const e=this.configuration;if(e.occluder){const i=e.hasPolygonOffset?X_e:null;this._occluderPipelineTransparent=Ht({blending:nd,polygonOffset:i,depthTest:Vz,depthWrite:null,colorWrite:si,stencilWrite:null,stencilTest:Q5e}),this._occluderPipelineOpaque=Ht({blending:nd,polygonOffset:i,depthTest:Vz,depthWrite:null,colorWrite:si,stencilWrite:J5e,stencilTest:K5e}),this._occluderPipelineMaskWrite=Ht({blending:null,polygonOffset:i,depthTest:sce,depthWrite:null,colorWrite:null,stencilWrite:by,stencilTest:Cw})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?Ft.LINES:Ft.TRIANGLE_STRIP}getPipelineState(e,i){return i?this._occludeePipelineState:this.configuration.occluder?e===Ee.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===Ee.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,i)}};tke.shader=new Gi(uAt,()=>Q(()=>import("./RibbonLine.glsl-f3a5f694.js"),[]));const X_e={factor:0,units:-4};var Cu;(function(t){t[t.LEFT_JOIN_START=-2]="LEFT_JOIN_START",t[t.LEFT_JOIN_END=-1]="LEFT_JOIN_END",t[t.LEFT_CAP_START=-4]="LEFT_CAP_START",t[t.LEFT_CAP_END=-5]="LEFT_CAP_END",t[t.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",t[t.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",t[t.RIGHT_CAP_START=4]="RIGHT_CAP_START",t[t.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(Cu||(Cu={}));let fR=class extends Bw{constructor(e){super(e,new fAt),this._configuration=new pn,this._vertexAttributeLocations=eke,this._layout=this.createLayout()}isClosed(e,i){return nke(this.parameters,e,i)}getConfiguration(e,i){this._configuration.output=e,this._configuration.draped=i.slot===Ee.DRAPED_MATERIAL;const r=v(this.parameters.stipplePattern)&&e!==z.Highlight;return this._configuration.stippleEnabled=r,this._configuration.stippleOffColorEnabled=r&&v(this.parameters.stippleOffColor),this._configuration.stippleScaleWithLineWidth=r&&this.parameters.stippleScaleWithLineWidth,this._configuration.stipplePreferContinuous=r&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins=this.parameters.join==="round",this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=!!v(this.parameters.markerParameters)&&gAt(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&v(this.parameters.innerColor),this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===xn.OccludeAndTransparentStencil,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersectDraped(e,i,r,n,s,o){if(!r.options.selectionMode)return;const a=e.vertexAttributes.get(M.POSITION).data,l=e.vertexAttributes.get(M.SIZE);let c=this.parameters.width;if(this.parameters.vvSizeEnabled){const _=e.vertexAttributes.get(M.SIZEFEATUREATTRIBUTE).data[0];c*=_e(this.parameters.vvSizeOffset[0]+_*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else l&&(c*=l.data[0]);const h=n[0],p=n[1],f=(c/2+4)*e.screenToWorldRatio;let m=Number.MAX_VALUE,g=0;for(let _=0;_<a.length-5;_+=3){const b=a[_],w=a[_+1],x=h-b,T=p-w,E=a[_+3]-b,C=a[_+4]-w,A=_e((E*x+C*T)/(E*E+C*C),0,1),I=E*A-x,O=C*A-T,D=I*I+O*O;D<m&&(m=D,g=_/3)}m<f*f&&s(o.dist,o.normal,g,!1)}intersect(e,i,r,n,s,o){if(!r.options.selectionMode||!e.visible)return;if(!RNe(i))return void re.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const a=e.vertexAttributes,l=a.get(M.POSITION).data;let c=this.parameters.width;if(this.parameters.vvSizeEnabled){const x=a.get(M.SIZEFEATUREATTRIBUTE).data[0];c*=_e(this.parameters.vvSizeOffset[0]+x*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else a.has(M.SIZE)&&(c*=a.get(M.SIZE).data[0]);const h=r.camera,p=yAt;io(p,r.point);const f=c*h.pixelRatio/2+4*h.pixelRatio;he(X3[0],p[0]-f,p[1]+f,0),he(X3[1],p[0]+f,p[1]+f,0),he(X3[2],p[0]+f,p[1]-f,0),he(X3[3],p[0]-f,p[1]-f,0);for(let x=0;x<4;x++)if(!h.unprojectFromRenderScreen(X3[x],Wy[x]))return;sl(h.eye,Wy[0],Wy[1],Bq),sl(h.eye,Wy[1],Wy[2],jq),sl(h.eye,Wy[2],Wy[3],Gq),sl(h.eye,Wy[3],Wy[0],Hq);let m=Number.MAX_VALUE,g=0;const _=rke(this.parameters,a,e.indices)?l.length-2:l.length-5;for(let x=0;x<_;x+=3){pc[0]=l[x]+i[12],pc[1]=l[x+1]+i[13],pc[2]=l[x+2]+i[14];const T=(x+3)%l.length;if(fc[0]=l[T]+i[12],fc[1]=l[T+1]+i[13],fc[2]=l[T+2]+i[14],Pr(Bq,pc)<0&&Pr(Bq,fc)<0||Pr(jq,pc)<0&&Pr(jq,fc)<0||Pr(Gq,pc)<0&&Pr(Gq,fc)<0||Pr(Hq,pc)<0&&Pr(Hq,fc)<0)continue;if(h.projectToRenderScreen(pc,vx),h.projectToRenderScreen(fc,bx),vx[2]<0&&bx[2]>0){ge(Vm,pc,fc);const C=h.frustum,A=-Pr(C[Or.NEAR],pc)/be(Vm,C[Or.NEAR]);le(Vm,Vm,A),me(pc,pc,Vm),h.projectToRenderScreen(pc,vx)}else if(vx[2]>0&&bx[2]<0){ge(Vm,fc,pc);const C=h.frustum,A=-Pr(C[Or.NEAR],fc)/be(Vm,C[Or.NEAR]);le(Vm,Vm,A),me(fc,fc,Vm),h.projectToRenderScreen(fc,bx)}else if(vx[2]<0&&bx[2]<0)continue;vx[2]=0,bx[2]=0;const E=_ae(zS(vx,bx,J_e),p);E<m&&(m=E,ce(Y_e,pc),ce(Z_e,fc),g=x/3)}const b=r.rayBegin,w=r.rayEnd;if(m<f*f){let x=Number.MAX_VALUE;if(ELe(zS(Y_e,Z_e,J_e),zS(b,w,_At),_x)){ge(_x,_x,b);const T=Pe(_x);le(_x,_x,1/T),x=T/Lr(b,w)}o(x,_x,g,!1)}}createLayout(){const e=_n().vec3f(M.POSITION).f32(M.SUBDIVISIONFACTOR).vec2f(M.UV0).vec3f(M.AUXPOS1).vec3f(M.AUXPOS2);return this.parameters.vvSizeEnabled?e.f32(M.SIZEFEATUREATTRIBUTE):e.f32(M.SIZE),this.parameters.vvColorEnabled?e.f32(M.COLORFEATUREATTRIBUTE):e.vec4f(M.COLOR),this.parameters.vvOpacityEnabled&&e.f32(M.OPACITYFEATUREATTRIBUTE),ue("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(M.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new mAt(this._layout,this.parameters)}requiresSlot(e,i){return i===z.Color||i===z.Alpha||i===z.Highlight||i===z.Depth||i===z.ObjectAndLayerIdColor?e===Ee.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===xn.OccludeAndTransparentStencil?e===Ee.OPAQUE_MATERIAL||e===Ee.OCCLUDER_MATERIAL||e===Ee.TRANSPARENT_OCCLUDER_MATERIAL:i===z.Color||i===z.Alpha?e===(this.parameters.writeDepth?Ee.TRANSPARENT_MATERIAL:Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===Ee.OPAQUE_MATERIAL:!1}createGLMaterial(e){return new pAt(e)}validateParameters(e){e.join!=="miter"&&(e.miterLimit=0),v(e.markerParameters)&&(e.markerScale=e.markerParameters.width/e.width)}},pAt=class extends zw{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==z.Color&&this._output!==z.Alpha||this._updateOccludeeState(e);const i=this._material.parameters.stipplePattern;return this._stipplePattern!==i&&(this._material.setParameters(this._stippleTextureRepository.swap(this._stipplePattern,i)),this._stipplePattern=i),this.ensureTechnique(tke,e)}},fAt=class extends Gle{constructor(){super(...arguments),this.width=0,this.color=dp,this.join="miter",this.cap=Cp.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}},mAt=class{constructor(e,i){this._parameters=i,this.numJoinSubdivisions=0,this.vertexBufferLayout=e;const r=i.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=r;break;case"round":this.numJoinSubdivisions=Uz+r}}_isClosed(e){return rke(this._parameters,e.vertexAttributes,e.indices)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const r=e.indices.get(M.POSITION).length/2+1,n=this._isClosed(e);let s=n?2:2*2;return s+=((n?r:r-1)-(n?0:1))*(2*this.numJoinSubdivisions+4),s+=2,this._parameters.wireframe&&(s=2+4*(s-2)),s}write(e,i,r,n,s){var J;const o=vAt,a=bAt,l=wAt,c=r.vertexAttributes.get(M.POSITION).data,h=r.indices&&r.indices.get(M.POSITION),p=(J=r.vertexAttributes.get(M.DISTANCETOSTART))==null?void 0:J.data;h&&h.length!==2*(c.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let f=1,m=0;this._parameters.vvSizeEnabled?m=r.vertexAttributes.get(M.SIZEFEATUREATTRIBUTE).data[0]:r.vertexAttributes.has(M.SIZE)&&(f=r.vertexAttributes.get(M.SIZE).data[0]);let g=[1,1,1,1],_=0;this._parameters.vvColorEnabled?_=r.vertexAttributes.get(M.COLORFEATUREATTRIBUTE).data[0]:r.vertexAttributes.has(M.COLOR)&&(g=r.vertexAttributes.get(M.COLOR).data);const b=ue("enable-feature:objectAndLayerId-rendering")?r.objectAndLayerIdColor:null;let w=0;this._parameters.vvOpacityEnabled&&(w=r.vertexAttributes.get(M.OPACITYFEATUREATTRIBUTE).data[0]);const x=c.length/3,T=new Float32Array(n.buffer),E=ue("enable-feature:objectAndLayerId-rendering")?new Uint8Array(n.buffer):null,C=this.vertexBufferLayout.stride/4;let A=s*C;const I=A;let O=0;const D=p?(q,N,L)=>O=p[L]:(q,N,L)=>O+=Lr(q,N),U=ue("enable-feature:objectAndLayerId-rendering"),V=(q,N,L,F,G,W,Z)=>{if(T[A++]=N[0],T[A++]=N[1],T[A++]=N[2],T[A++]=F,T[A++]=Z,T[A++]=G,T[A++]=q[0],T[A++]=q[1],T[A++]=q[2],T[A++]=L[0],T[A++]=L[1],T[A++]=L[2],this._parameters.vvSizeEnabled?T[A++]=m:T[A++]=f,this._parameters.vvColorEnabled)T[A++]=_;else{const X=Math.min(4*W,g.length-4);T[A++]=g[X],T[A++]=g[X+1],T[A++]=g[X+2],T[A++]=g[X+3]}this._parameters.vvOpacityEnabled&&(T[A++]=w),U&&(v(b)&&(E[4*A]=b[0],E[4*A+1]=b[1],E[4*A+2]=b[2],E[4*A+3]=b[3]),A++)};A+=C,he(a,c[0],c[1],c[2]),e&&Ke(a,a,e);const B=this._isClosed(r);if(B){const q=c.length-3;he(o,c[q],c[q+1],c[q+2]),e&&Ke(o,o,e)}else he(l,c[3],c[4],c[5]),e&&Ke(l,l,e),V(a,a,l,1,Cu.LEFT_CAP_START,0,0),V(a,a,l,1,Cu.RIGHT_CAP_START,0,0),ce(o,a),ce(a,l);const ee=B?0:1,ie=B?x:x-1;for(let q=ee;q<ie;q++){const N=(q+1)%x*3;he(l,c[N],c[N+1],c[N+2]),e&&Ke(l,l,e),D(o,a,q),V(o,a,l,0,Cu.LEFT_JOIN_END,q,O),V(o,a,l,0,Cu.RIGHT_JOIN_END,q,O);const L=this.numJoinSubdivisions;for(let F=0;F<L;++F){const G=(F+1)/(L+1);V(o,a,l,G,Cu.LEFT_JOIN_END,q,O),V(o,a,l,G,Cu.RIGHT_JOIN_END,q,O)}V(o,a,l,1,Cu.LEFT_JOIN_START,q,O),V(o,a,l,1,Cu.RIGHT_JOIN_START,q,O),ce(o,a),ce(a,l)}B?(he(l,c[3],c[4],c[5]),e&&Ke(l,l,e),O=D(o,a,ie),V(o,a,l,0,Cu.LEFT_JOIN_END,ee,O),V(o,a,l,0,Cu.RIGHT_JOIN_END,ee,O)):(O=D(o,a,ie),V(o,a,a,0,Cu.LEFT_CAP_END,ie,O),V(o,a,a,0,Cu.RIGHT_CAP_END,ie,O)),zq(T,I+C,T,I,C),A=zq(T,A-C,T,A,C),this._parameters.wireframe&&this._addWireframeVertices(n,I,A,C)}_addWireframeVertices(e,i,r,n){const s=new Float32Array(e.buffer,r*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(e.buffer,i*Float32Array.BYTES_PER_ELEMENT,r-i);let a=0;const l=c=>a=zq(o,c,s,a,n);for(let c=0;c<o.length-1;c+=2*n)l(c),l(c+2*n),l(c+1*n),l(c+2*n),l(c+1*n),l(c+3*n)}};function zq(t,e,i,r,n){for(let s=0;s<n;s++)i[r++]=t[e++];return r}function rke(t,e,i){return nke(t,e.get(M.POSITION).data,i?i.get(M.POSITION):null)}function nke(t,e,i){return!!t.isClosed&&(i?i.length>2:e.length>6)}function gAt(t){return t.anchor===M2.Tip&&t.hideOnShortSegments&&t.placement==="begin-end"&&t.worldSpace}const pc=P(),fc=P(),Vm=P(),_x=P(),yAt=P(),vx=ka(),bx=ka(),Y_e=P(),Z_e=P(),J_e=Cm(),_At=Cm(),vAt=P(),bAt=P(),wAt=P(),X3=[ka(),ka(),ka(),ka()],Wy=[P(),P(),P(),P()],Bq=Ji(),jq=Ji(),Gq=Ji(),Hq=Ji();let oce=class{constructor(e){this._originSR=e,this._origins=new Map,this._objects=new Map,this._gridSize=5e5,this._rootOriginId="root/"+qu()}getOrigin(e){const i=this._origins.get(this._rootOriginId);if(i==null){const h=HCt.rootOrigin;if(v(h))return this._origins.set(this._rootOriginId,nL(h[0],h[1],h[2],this._rootOriginId)),this.getOrigin(e);const p=nL(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,p),p}const r=this._gridSize,n=Math.round(e[0]/r),s=Math.round(e[1]/r),o=Math.round(e[2]/r),a=`${n}/${s}/${o}`;let l=this._origins.get(a);const c=.5*r;if(ge(Wo,e,i.vec3),Wo[0]=Math.abs(Wo[0]),Wo[1]=Math.abs(Wo[1]),Wo[2]=Math.abs(Wo[2]),Wo[0]<c&&Wo[1]<c&&Wo[2]<c){if(l){const h=Math.max(...Wo);if(ge(Wo,e,l.vec3),Wo[0]=Math.abs(Wo[0]),Wo[1]=Math.abs(Wo[1]),Wo[2]=Math.abs(Wo[2]),Math.max(...Wo)<h)return l}return i}return l||(l=nL(n*r,s*r,o*r,a),this._origins.set(a,l)),l}_drawOriginBox(e,i=Zt(1,1,0,1)){const r=window.view,n=r._stage,s=i.toString();if(!this._objects.has(s)){this._material=new fR({width:2,color:i}),n.add(this._material);const m=new B5e({pickable:!1}),g=new iv({castShadow:!1});n.add(g),m.add(g),n.add(m),this._objects.set(s,g)}const o=this._objects.get(s),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=a.length,c=new Array(3*l),h=new Array,p=.5*this._gridSize;for(let m=0;m<l;m++)c[3*m+0]=e[0]+(1&a[m]?p:-p),c[3*m+1]=e[1]+(2&a[m]?p:-p),c[3*m+2]=e[2]+(4&a[m]?p:-p),m>0&&h.push(m-1,m);Nn(c,this._originSR,0,c,r.renderSpatialReference,0,l);const f=new Os(this._material,[[M.POSITION,new Qe(c,3,!0)]],[[M.POSITION,h]],null,Zn.Line);n.add(f),o.addGeometry(f)}get test(){const e=this;return{set gridSize(i){e._gridSize=i}}}};const Wo=P();let ske=class{constructor(e,i,r,n=null){this.rctx=e,this.sliceHelper=n,this.lastFrameCamera=new Pt,this.output=z.Color,this.renderOccludedMask=K_e,this.bindParameters=new e7(i,r,v(n)?n.plane:null)}resetRenderOccludedMask(){this.renderOccludedMask=K_e}},xAt=class extends ske{constructor(e,i,r,n,s){super(e,r,n,s),this.offscreenRenderingHelper=i,this.sliceHelper=s,this.time=0}};const K_e=xn.Occlude|xn.OccludeAndTransparent|xn.OccludeAndTransparentStencil;let jI=class extends Pt{constructor(){super(...arguments),this._projectionMatrix=$e()}get projectionMatrix(){return this._projectionMatrix}};u([d()],jI.prototype,"_projectionMatrix",void 0),u([d({readOnly:!0})],jI.prototype,"projectionMatrix",null),jI=u([$("esri.views.3d.webgl-engine.lib.CascadeCamera")],jI);var rO;(function(t){t[t.Highlight=0]="Highlight",t[t.Default=1]="Default"})(rO||(rO={}));let D5=class{constructor(){this.camera=new jI,this.lightMat=$e()}},ace=class{get depthTexture(){return this._depthTexture}get textureSize(){return this._textureSize}get numCascades(){return this._numCascades}get cascadeDistances(){return cr(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}constructor(e,i){this._rctx=e,this._viewingMode=i,this._enabled=!1,this._snapshots=new Array,this._textureSize=0,this._numCascades=1,this._maxNumCascades=4,this._projectionView=$e(),this._projectionViewInverse=$e(),this._modelViewLight=$e(),this._splitSchemeLambda=0,this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=pi(),this._cascades=[new D5,new D5,new D5,new D5],this._lastOrigin=null,this._maxTextureSize=Math.min(ue("esri-mobile")?2048:8192,this._rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}disposeOffscreenBuffers(){this._discardDepthTexture(),this._discardAllSnapshots()}set maxCascades(e){this._maxNumCascades=_e(Math.floor(e),1,4)}get maxCascades(){return this._maxNumCascades}set enabled(e){this._enabled=e,e||(this._discardDepthTexture(),this._discardAllSnapshots())}get enabled(){return this._enabled}get ready(){return this._enabled&&v(this._depthTexture)}getSnapshot(e){return this.enabled?this._snapshots[e]:null}get cascades(){for(let e=0;e<this._numCascades;++e)Wq[e]=this._cascades[e];return Wq.length=this._numCascades,Wq}start(e,i,r){wt(this.enabled),this._textureSize=this._computeTextureSize(e.fullWidth,e.fullHeight),this._ensureDepthTexture();const{near:n,far:s}=this._clampNearFar(r);this._computeCascadeDistances(s,n),this._setupMatrices(e,i);const{viewMatrix:o,projectionMatrix:a}=e;for(let l=0;l<this._numCascades;++l)this._constructCascade(l,a,o,i);this._lastOrigin=null,this.clear()}finish(e){wt(this.enabled),this._rctx.bindFramebuffer(e)}getShadowMapMatrices(e){if(!this._lastOrigin||!Xl(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||P(),ce(this._lastOrigin,e);for(let i=0;i<this._numCascades;++i){Yc(nve,this._cascades[i].lightMat,e);for(let r=0;r<16;++r)sve[16*i+r]=nve[r]}}return sve}takeCascadeSnapshotTo(e,i){wt(this.enabled);const r=this._ensureSnapshot(i);this._bindFbo();const n=this._rctx,s=n.bindTexture(r,mt.TEXTURE_UNIT_FOR_UPDATES);n.gl.copyTexSubImage2D(Ct.TEXTURE_2D,0,e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[2],e.camera.viewport[3]),n.bindTexture(s,mt.TEXTURE_UNIT_FOR_UPDATES)}clear(){const e=this._rctx;this._bindFbo(),e.setClearColor(1,1,1,1),e.clearSafe(Yr.COLOR_BUFFER_BIT|Yr.DEPTH_BUFFER_BIT)}_computeTextureSize(e,i){const r=.5*Math.log(e*e+i*i)*Math.LOG2E,n=.35,s=2**Math.round(r+n);return Math.min(this._maxTextureSize,2*s)}_ensureDepthTexture(){if(v(this._depthTexture)&&this._depthTexture.descriptor.width===this._textureSize)return;this._discardDepthTexture();const e={target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE,samplingMode:nt.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};this._depthTexture=new mt(this._rctx,e),this._fbo=new es(this._rctx,{colorTarget:En.TEXTURE,depthStencilTarget:Vi.DEPTH_RENDER_BUFFER,width:this._textureSize,height:this._textureSize},this._depthTexture)}_ensureSnapshot(e){let i=this._snapshots[e];if(v(i)&&i.descriptor.width===this._textureSize)return i;this._discardSnapshot(e);const r={target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE,samplingMode:nt.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};return i=new mt(this._rctx,r),this._snapshots[e]=i,i}_discardDepthTexture(){this._fbo=rt(this._fbo),this._depthTexture=rt(this._depthTexture)}_discardSnapshot(e){this._snapshots[e]=rt(this._snapshots[e])}_discardAllSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){const e=this._rctx;e.unbindTexture(this._depthTexture),e.bindFramebuffer(this._fbo)}_constructCascade(e,i,r,n){const s=this._cascades[e],o=-this._cascadeDistances[e],a=-this._cascadeDistances[e+1],l=(i[10]*o+i[14])/Math.abs(i[11]*o+i[15]),c=(i[10]*a+i[14])/Math.abs(i[11]*a+i[15]);wt(l<c);for(let m=0;m<8;++m){cr(Q_e,m%4==0||m%4==3?-1:1,m%4==0||m%4==1?-1:1,m<4?l:c,1);const g=Yd[m];Jh(g,Q_e,this._projectionViewInverse),g[0]/=g[3],g[1]/=g[3],g[2]/=g[3]}pl(qq,Yd[0]),s.camera.viewMatrix=Yc(TAt,this._modelViewLight,qq);for(let m=0;m<8;++m)Ke(Yd[m],Yd[m],s.camera.viewMatrix);let h=Yd[0][2],p=Yd[0][2];for(let m=1;m<8;++m)h=Math.min(h,Yd[m][2]),p=Math.max(p,Yd[m][2]);h-=200,p+=200,s.camera.near=-p,s.camera.far=-h,AAt(r,n,h,p,s.camera),$n(s.lightMat,s.camera.projectionMatrix,s.camera.viewMatrix);const f=this._textureSize/2;s.camera.viewport=[e%2==0?0:f,Math.floor(e/2)===0?0:f,f,f]}_setupMatrices(e,i){$n(this._projectionView,e.projectionMatrix,e.viewMatrix),wa(this._projectionViewInverse,this._projectionView);const r=this._viewingMode===qe.Global?e.eye:he(qq,0,0,1);oB(this._modelViewLight,[0,0,0],[-i[0],-i[1],-i[2]],r)}_clampNearFar(e){let{near:i,far:r}=e;return i<2&&(i=2),r<2&&(r=2),i>=r&&(i=2,r=4),{near:i,far:r}}_computeCascadeDistances(e,i){this._numCascades=Math.min(1+Math.floor(Avt(e/i,4)),this._maxNumCascades);const r=(e-i)/this._numCascades,n=(e/i)**(1/this._numCascades);let s=i,o=i;for(let a=0;a<this._numCascades+1;++a)this._cascadeDistances[a]=Bt(s,o,this._splitSchemeLambda),s*=n,o+=r}get gpuMemoryUsage(){var e;return this._snapshots.reduce((i,r)=>i+x2(r),((e=this._fbo)==null?void 0:e.gpuMemoryUsage)??0)}get test(){const e=this;return{maxNumCascades:this._maxNumCascades,cascades:this._cascades,textureSize:this._textureSize,set splitSchemeLambda(i){e._splitSchemeLambda=i},get splitSchemeLambda(){return e._splitSchemeLambda}}}};const TAt=$e(),Q_e=pi(),Yd=[];for(let t=0;t<8;++t)Yd.push(pi());const eve=Fe(),tve=Fe(),SAt=Fe(),ive=Fe(),rve=Fe(),qq=P(),Wq=[],nve=$e(),sve=new Float32Array(64),mh=Fe(),VE=Fe(),wx=[Fe(),Fe(),Fe(),Fe()],ro=Fe(),Xq=Fe(),Lv=Fe(),Y3=Fe(),zE=Fe(),BE=Fe(),N5=Fe();function EAt(t,e,i,r,n,s,o,a){dt(mh,0,0);for(let C=0;C<4;++C)Jd(mh,mh,t[C]);ll(mh,mh,.25),dt(VE,0,0);for(let C=4;C<8;++C)Jd(VE,VE,t[C]);ll(VE,VE,.25),K1(wx[0],t[4],t[5],.5),K1(wx[1],t[5],t[6],.5),K1(wx[2],t[6],t[7],.5),K1(wx[3],t[7],t[4],.5);let l=0,c=BM(wx[0],mh);for(let C=1;C<4;++C){const A=BM(wx[C],mh);A<c&&(c=A,l=C)}Xh(ro,wx[l],t[l+4]);const h=ro[0];let p,f;ro[0]=-ro[1],ro[1]=h,Xh(Xq,VE,mh),As(Xq,ro)<0&&Uoe(ro,ro),K1(ro,ro,Xq,i),_2(ro,ro),p=f=As(Xh(Lv,t[0],mh),ro);for(let C=1;C<8;++C){const A=As(Xh(Lv,t[C],mh),ro);A<p?p=A:A>f&&(f=A)}io(r,mh),ll(Lv,ro,p-e),Jd(r,r,Lv);let m=-1,g=1,_=0,b=0;for(let C=0;C<8;++C){Xh(Y3,t[C],r),_2(Y3,Y3);const A=ro[0]*Y3[1]-ro[1]*Y3[0];A>0?A>m&&(m=A,_=C):A<g&&(g=A,b=C)}SE(m>0,"leftArea"),SE(g<0,"rightArea"),ll(zE,ro,p),Jd(zE,zE,mh),ll(BE,ro,f),Jd(BE,BE,mh),N5[0]=-ro[1],N5[1]=ro[0];const w=Y4(r,t[b],BE,Jd(Lv,BE,N5),1,n),x=Y4(r,t[_],BE,Lv,1,s),T=Y4(r,t[_],zE,Jd(Lv,zE,N5),1,o),E=Y4(r,t[b],zE,Lv,1,a);SE(w,"rayRay"),SE(x,"rayRay"),SE(T,"rayRay"),SE(E,"rayRay")}function $i(t,e){return 3*e+t}const ove=Fe();function su(t,e){return dt(ove,t[e],t[e+3]),ove}const mc=Fe(),lt=wr();function CAt(t,e,i,r,n){Xh(mc,i,r),ll(mc,mc,.5),lt[0]=mc[0],lt[1]=mc[1],lt[2]=0,lt[3]=mc[1],lt[4]=-mc[0],lt[5]=0,lt[6]=mc[0]*mc[0]+mc[1]*mc[1],lt[7]=mc[0]*mc[1]-mc[1]*mc[0],lt[8]=1,lt[$i(0,2)]=-As(su(lt,0),t),lt[$i(1,2)]=-As(su(lt,1),t);let s=As(su(lt,0),i)+lt[$i(0,2)],o=As(su(lt,1),i)+lt[$i(1,2)],a=As(su(lt,0),r)+lt[$i(0,2)],l=As(su(lt,1),r)+lt[$i(1,2)];s=-(s+a)/(o+l),lt[$i(0,0)]+=lt[$i(1,0)]*s,lt[$i(0,1)]+=lt[$i(1,1)]*s,lt[$i(0,2)]+=lt[$i(1,2)]*s,s=1/(As(su(lt,0),i)+lt[$i(0,2)]),o=1/(As(su(lt,1),i)+lt[$i(1,2)]),lt[$i(0,0)]*=s,lt[$i(0,1)]*=s,lt[$i(0,2)]*=s,lt[$i(1,0)]*=o,lt[$i(1,1)]*=o,lt[$i(1,2)]*=o,lt[$i(2,0)]=lt[$i(1,0)],lt[$i(2,1)]=lt[$i(1,1)],lt[$i(2,2)]=lt[$i(1,2)],lt[$i(1,2)]+=1,s=As(su(lt,1),e)+lt[$i(1,2)],o=As(su(lt,2),e)+lt[$i(2,2)],a=As(su(lt,1),i)+lt[$i(1,2)],l=As(su(lt,2),i)+lt[$i(2,2)],s=-.5*(s/o+a/l),lt[$i(1,0)]+=lt[$i(2,0)]*s,lt[$i(1,1)]+=lt[$i(2,1)]*s,lt[$i(1,2)]+=lt[$i(2,2)]*s,s=As(su(lt,1),e)+lt[$i(1,2)],o=As(su(lt,2),e)+lt[$i(2,2)],a=-o/s,lt[$i(1,0)]*=a,lt[$i(1,1)]*=a,lt[$i(1,2)]*=a,n[0]=lt[0],n[1]=lt[1],n[2]=0,n[3]=lt[2],n[4]=lt[3],n[5]=lt[4],n[6]=0,n[7]=lt[5],n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=lt[6],n[13]=lt[7],n[14]=0,n[15]=lt[8]}function AAt(t,e,i,r,n){const s=1/Yd[0][3],o=1/Yd[4][3];wt(s<o);let a=s+Math.sqrt(s*o);const l=Math.sin(eo(t[2]*e[0]+t[6]*e[1]+t[10]*e[2]));a/=l,EAt(Yd,a,l,eve,tve,SAt,ive,rve),CAt(eve,tve,ive,rve,n.projectionMatrix),n.projectionMatrix[10]=2/(i-r),n.projectionMatrix[14]=-(i+r)/(i-r)}function RAt(t){return Mm(t)&&t.intersector===gn.TERRAIN&&!!t.target}let MAt=class extends c7{constructor(e,i,r){super(e,i),this.triangleNr=r}};function oke(t){return Mm(t)&&t.intersector===gn.OVERLAY&&!!t.target}let Lte=class{constructor(){this.adds=new Wt,this.removes=new Wt,this.updates=new Wt({allocator:e=>e||new OAt,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return this.adds.length===0&&this.removes.length===0&&this.updates.length===0}},OAt=class{},PAt=class{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}};var wn,co;(function(t){t[t.ADD=0]="ADD",t[t.UPDATE=1]="UPDATE",t[t.REMOVE=2]="REMOVE"})(wn||(wn={})),function(t){t[t.NONE=0]="NONE",t[t.VISIBILITY=1]="VISIBILITY",t[t.GEOMETRY=2]="GEOMETRY",t[t.TRANSFORMATION=4]="TRANSFORMATION",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.OCCLUDEE=16]="OCCLUDEE"}(co||(co={}));function ake(t){const e=new Map,i=r=>{let n=e.get(r);return n||(n=new PAt,e.set(r,n)),n};return t.removes.forAll(r=>{Yq(r)&&i(r.material).removes.push(r)}),t.adds.forAll(r=>{Yq(r)&&i(r.material).adds.push(r)}),t.updates.forAll(r=>{Yq(r.renderGeometry)&&i(r.renderGeometry.material).updates.push(r)}),e}function Yq(t){return t.geometry.indexCount>=1}let IAt=class{constructor(e){this._rctx=e,this._indexBuffer=this._createIndexbuffer(),this._program=this._createProgram()}_createProgram(){const e=`
    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,i=`
    void main(void) {
      gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`;return this._rctx.programCache.acquire(e,i,new Map([]))}_createIndexbuffer(){return er.createIndex(this._rctx,zi.STATIC_DRAW,new Uint32Array([0]))}resetIndicesType(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,Lt.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(Ft.POINTS,1,ft.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}},lke=class{constructor(e,i){this._material=e,this._repository=i,this._map=new Map}destroy(){this._map.forEach((e,i)=>{v(e)&&this._repository.release(this._material,i)})}load(e,i,r){if(!this._material.requiresSlot(i,r))return null;this._map.has(r)||this._map.set(r,this._repository.acquire(this._material,i,r));const n=this._map.get(r);if(v(n)){if(n.ensureResources(e)===u_.LOADED)return n;this._repository.requestRender()}return null}};function $At(t){const e=S`vec3 decodeNormal(vec2 f) {
float z = 1.0 - abs(f.x) - abs(f.y);
return vec3(f + sign(f) * min(z, 0.0), z);
}`;t.vertex.code.add(e)}function sF(t,e){switch(e.normalType){case hr.CompressedAttribute:t.include($At),t.attributes.add(M.NORMALCOMPRESSED,"vec2"),t.vertex.code.add(S`vec3 normalModel() {
return decodeNormal(normalCompressed);
}`);break;case hr.Attribute:t.attributes.add(M.NORMAL,"vec3"),t.vertex.code.add(S`vec3 normalModel() {
return normal;
}`);break;case hr.ScreenDerivative:t.extensions.add("GL_OES_standard_derivatives"),t.fragment.code.add(S`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:e.normalType;case hr.COUNT:case hr.Ground:}}var hr;(function(t){t[t.Attribute=0]="Attribute",t[t.CompressedAttribute=1]="CompressedAttribute",t[t.Ground=2]="Ground",t[t.ScreenDerivative=3]="ScreenDerivative",t[t.COUNT=4]="COUNT"})(hr||(hr={}));function I7(t,e){switch(e.normalType){case hr.Attribute:case hr.CompressedAttribute:t.include(sF,e),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("vNormalView","vec3"),t.vertex.uniforms.add([new xD("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel),new Ay("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal)]),t.vertex.code.add(S`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case hr.Ground:t.include(zR,e),t.varyings.add("vNormalWorld","vec3"),t.vertex.code.add(S`
        void forwardNormal() {
          vNormalWorld = ${e.spherical?S`normalize(vPositionWorldCameraRelative);`:S`vec3(0.0, 0.0, 1.0);`}
        }
        `);break;case hr.ScreenDerivative:t.vertex.code.add(S`void forwardNormal() {}`);break;default:e.normalType;case hr.COUNT:}}let cke=class extends lNe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=wr()}},uke=class extends cNe{constructor(){super(...arguments),this.transformNormalGlobalFromModel=wr(),this.toMapSpace=pi()}},Dte=class extends uke{constructor(e=P()){super(),this.origin=e,this.slicePlaneLocalOrigin=this.origin}},YO=class{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(M.POSITION).length}write(e,i,r,n,s){R4e(r,this.vertexBufferLayout,e,i,n,s)}};const LAt=_n().vec3f(M.POSITION),DAt=_n().vec3f(M.POSITION).vec2f(M.UV0),hke=_n().vec3f(M.POSITION).vec4u8(M.COLOR);_n().vec3f(M.POSITION).vec4u8(M.OBJECTANDLAYERIDCOLOR);_n().vec3f(M.POSITION).vec2f(M.UV0).vec4u8(M.OBJECTANDLAYERIDCOLOR);const NAt=_n().vec3f(M.POSITION).vec4u8(M.COLOR).vec4u8(M.OBJECTANDLAYERIDCOLOR);let lce=class extends Bw{intersect(e,i,r,n,s,o){return y4e(e,r,n,s,void 0,o)}};function FAt(t){t.fragment.code.add(S`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function kAt(t){t.fragment.code.add(S`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}function ave(t){t.fragment.uniforms.add(new Dt("texWaveNormal",e=>e.waveNormal)),t.fragment.uniforms.add(new Dt("texWavePerturbation",e=>e.wavePertubation)),t.fragment.uniforms.add([new bi("waveParams",e=>cr(UAt,e.waveStrength,e.waveTextureRepeat,e.flowStrength,e.flowOffset)),new Wi("waveDirection",e=>dt(VAt,e.waveDirection[0]*e.waveVelocity,e.waveDirection[1]*e.waveVelocity))]),t.include(FAt),t.fragment.code.add(S`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture2D(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const UAt=pi(),VAt=Fe();function zD(t,e){e.spherical?t.vertex.code.add(S`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):t.vertex.code.add(S`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),e.spherical?t.vertex.code.add(S`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):t.vertex.code.add(S`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}let oF=class extends Fn{constructor(e,i){super(e,"int",br.Pass,(r,n,s)=>r.setUniform1i(e,i(n,s)))}},zAt=class extends Fn{constructor(e,i,r){super(e,"mat4",br.Draw,(n,s,o)=>n.setUniformMatrix4fv(e,i(s,o)),r)}},BAt=class extends Fn{constructor(e,i,r){super(e,"mat4",br.Pass,(n,s,o)=>n.setUniformMatrix4fv(e,i(s,o)),r)}},dke=class extends Tr{constructor(){super(...arguments),this.origin=P()}};function $7(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new BAt("shadowMapMatrix",(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),pke(t,e))}function O2(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new zAt("shadowMapMatrix",(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),pke(t,e))}function pke(t,e){const i=t.fragment;i.include(nh),i.uniforms.add([...cm("shadowMapTex",(r,n)=>n.shadowMap.depthTexture,e.hasWebGL2Context?lr.None:lr.Size),new oF("numCascades",(r,n)=>n.shadowMap.numCascades),new bi("cascadeDistances",(r,n)=>n.shadowMap.cascadeDistances)]),i.code.add(S`
    int chooseCascade(float depth, out mat4 mat) {
      vec4 distance = cascadeDistances;

      // choose correct cascade
      int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;

      mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];

      return i;
    }

    vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
      vec4 lv = mat * vec4(_vpos, 1.0);
      lv.xy /= lv.w;
      return 0.5 * lv.xyz + vec3(0.5);
    }

    vec2 cascadeCoordinates(int i, vec3 lvpos) {
      return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;
    }

    float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
      return rgba2float(texture2D(_depthTex, uv));
    }

    float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
      return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
    }

    float filterShadow(vec2 uv, vec3 lvpos, float textureSize, sampler2D _depthTex) {
      float halfPixelSize = 0.5 / textureSize;

      // filter, offset by half pixels
      vec2 st = fract((vec2(halfPixelSize) + uv) * textureSize);

      float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
      float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
      float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
      float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);

      return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
    }

    float readShadowMap(const in vec3 _vpos, float _linearDepth) {
      mat4 mat;
      int i = chooseCascade(_linearDepth, mat);

      if (i >= numCascades) { return 0.0; }

      vec3 lvpos = lightSpacePosition(_vpos, mat);

      // vertex completely outside? -> no shadow
      if (lvpos.z >= 1.0) { return 0.0; }
      if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }

      // calc coord in cascade texture
      vec2 uv = cascadeCoordinates(i, lvpos);

      vec2 textureSize = ${Tp(e,"shadowMapTex")};

      return filterShadow(uv, lvpos, textureSize.x, shadowMapTex);
    }
  `)}function jAt(t){const e=t.fragment.code;e.add(S`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),e.add(S`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),e.add(S`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function cce(t,e){const i=t.fragment.code;t.include(qN),e.pbrMode!==_t.Normal&&e.pbrMode!==_t.Schematic&&e.pbrMode!==_t.Terrain&&e.pbrMode!==_t.TerrainWithWater||(i.add(S`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),i.add(S`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),e.pbrMode!==_t.Normal&&e.pbrMode!==_t.Schematic||(t.include(jAt),i.add(S`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),i.add(S`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),i.add(S`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),i.add(S`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function GAt(t,e){const i=t.fragment.code;t.include(qN),i.add(S`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${e.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),i.add(S`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),i.add(S`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),i.add(S`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),i.add(S`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)}function fke(t,e){t.include(GAt,e),t.include(ZB),t.include(kAt),e.hasCloudsReflections&&t.include(FDe,e),e.hasScreenSpaceReflections&&t.include(U_t,e);const i=t.fragment;i.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),i.code.add(S`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),i.uniforms.add([new Ie("lightingSpecularStrength",(r,n)=>n.lighting.mainLight.specularStrength),new Ie("lightingEnvironmentStrength",(r,n)=>n.lighting.mainLight.environmentStrength)]),i.code.add(S`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),e.hasCloudsReflections&&i.code.add(S`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y*cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),e.hasScreenSpaceReflections?(i.uniforms.add([new on("view",(r,n)=>n.ssr.camera.viewMatrix),new Dt("lastFrameColorTexture",(r,n)=>n.ssr.lastFrameColorTexture),new Ie("fadeFactor",(r,n)=>n.ssr.fadeFactor)]),i.code.add(S`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactor;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture2D(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`)):i.code.add(S`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),e.hasCloudsReflections?e.hasScreenSpaceReflections?i.code.add(S`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):i.code.add(S`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):i.code.add(S`return waterRenderedColor;
}`)}function HAt(t){const e=new ji,{vertex:i,fragment:r}=e;Yu(i,t),e.include(Gc,t),e.attributes.add(M.POSITION,"vec3"),e.attributes.add(M.UV0,"vec2");const n=new bi("waterColor",s=>s.color);if(t.output===z.Color&&t.isDraped)return e.varyings.add("vpos","vec3"),i.uniforms.add(n),i.code.add(S`
        void main(void) {
          if (waterColor.a < ${S.float(za)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),r.uniforms.add(n),r.code.add(S`void main() {
gl_FragColor = waterColor;
}`),e;switch(t.output!==z.Color&&t.output!==z.Alpha||(e.include(zD,t),e.include(UO,t),e.varyings.add("vuv","vec2"),e.varyings.add("vpos","vec3"),e.varyings.add("vnormal","vec3"),e.varyings.add("vtbnMatrix","mat3"),t.hasMultipassTerrain&&e.varyings.add("depth","float"),i.uniforms.add(n),i.code.add(S`
      void main(void) {
        if (waterColor.a < ${S.float(za)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${t.output===z.Color?"forwardLinearDepth();":""}
      }
    `)),e.include(hd,t),t.output){case z.Alpha:e.include(fs,t),r.uniforms.add(n),r.code.add(S`
        void main() {
          discardBySlice(vpos);
          ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `);break;case z.Color:e.include(oz,t),e.include(zae,{pbrMode:_t.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(ave),e.include(fs,t),e.include(O2,t),e.include(fke,t),r.uniforms.add([n,new Ie("timeElapsed",s=>s.timeElapsed),i.uniforms.get("view"),i.uniforms.get("localOrigin")]),xm(r,t),r.include(Cy),H_(r),Ey(r),r.code.add(S`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${t.receiveShadows?S`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${t.transparencyPassType===At.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `);break;case z.Normal:e.include(zD,t),e.include(ave,t),e.include(fs,t),e.varyings.add("vpos","vec3"),e.varyings.add("vuv","vec2"),i.uniforms.add(n),i.code.add(S`
        void main(void) {
          if (waterColor.a < ${S.float(za)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),r.uniforms.add(new Ie("timeElapsed",s=>s.timeElapsed)),r.code.add(S`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case z.Highlight:e.include(Q_,t),e.varyings.add("vpos","vec3"),i.uniforms.add(n),i.code.add(S`
      void main(void) {
        if (waterColor.a < ${S.float(za)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),e.include(fs,t),r.code.add(S`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return e}const qAt=Object.freeze(Object.defineProperty({__proto__:null,build:HAt},Symbol.toStringTag,{value:"Module"}));let mke=class gke extends Yi{initializeConfiguration(e,i){i.hasWebGL2Context=e.rctx.type===Et.WEBGL2,i.spherical=e.viewingMode===qe.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Hi(e.rctx,gke.shader.get().build(this.configuration),Di)}_setPipelineState(e){const i=this.configuration,r=e===At.NONE,n=e===At.FrontFace;return Ht({blending:i.output!==z.Normal&&i.output!==z.Highlight&&i.transparent?r?nd:ev(e):null,depthTest:{func:jw(e)},depthWrite:r?i.writeDepth?Kc:null:S7(e),colorWrite:si,polygonOffset:r||n?null:A7(i.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};mke.shader=new Gi(qAt,()=>Q(()=>import("./WaterSurface.glsl-8da26ff0.js"),[]));let na=class extends Do{constructor(){super(...arguments),this.output=z.Color,this.transparencyPassType=At.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.isDraped=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}};u([j({count:z.COUNT})],na.prototype,"output",void 0),u([j({count:At.COUNT})],na.prototype,"transparencyPassType",void 0),u([j()],na.prototype,"spherical",void 0),u([j()],na.prototype,"receiveShadows",void 0),u([j()],na.prototype,"hasSlicePlane",void 0),u([j()],na.prototype,"transparent",void 0),u([j()],na.prototype,"enableOffset",void 0),u([j()],na.prototype,"writeDepth",void 0),u([j()],na.prototype,"hasScreenSpaceReflections",void 0),u([j()],na.prototype,"doublePrecisionRequiresObfuscation",void 0),u([j()],na.prototype,"hasCloudsReflections",void 0),u([j()],na.prototype,"isDraped",void 0),u([j()],na.prototype,"hasMultipassTerrain",void 0),u([j()],na.prototype,"cullAboveGround",void 0),u([j({constValue:_t.Water})],na.prototype,"pbrMode",void 0),u([j({constValue:!0})],na.prototype,"useCustomDTRExponentForWater",void 0),u([j({constValue:!0})],na.prototype,"highStepCount",void 0),u([j({constValue:!1})],na.prototype,"useFillLights",void 0);let WAt=class extends zw{_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}_updateSSRState(e){e.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:e.ssr.enabled})}_updateCloudsReflectionState(e){const i=v(e.cloudsFade.data);i!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:i})}ensureResources(e){return this._techniqueRepository.constructionContext.waterTextureRepository.ensureResources(e)}beginSlot(e){return this._output===z.Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e)),this._material.setParameters(this._techniqueRepository.constructionContext.waterTextureRepository.passParameters),this.ensureTechnique(mke,e)}},yke=class extends lce{constructor(e){super(e,new _ke),this._configuration=new na,this.animation=new FNe}getConfiguration(e,i){return this._configuration.output=e,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.isDraped=this.parameters.isDraped,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<E7,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}update(e){const i=Math.min(e.camera.relativeElevation,e.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*i<XAt;const r=this.animation.advance(e);return this.setParameters({timeElapsed:ene(this.animation.time)*this.parameters.animationSpeed},!1),this.animation.enabled&&r}requiresSlot(e,i){switch(i){case z.Normal:return e===Ee.DRAPED_WATER;case z.Color:if(this.parameters.isDraped)return e===Ee.DRAPED_MATERIAL;break;case z.Alpha:break;case z.Highlight:return e===Ee.OPAQUE_MATERIAL||e===Ee.DRAPED_MATERIAL;default:return!1}let r=Ee.OPAQUE_MATERIAL;return this.parameters.transparent&&(r=this.parameters.writeDepth?Ee.TRANSPARENT_MATERIAL:Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===r}createGLMaterial(e){return new WAt(e)}createBufferWriter(){return new YO(DAt)}},_ke=class extends HO{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=Mi(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=Zt(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1}};const XAt=35e3;let uce=class{constructor(e=0,i=0){this.from=e,this.to=i}get numElements(){return this.to-this.from}};function lve(t){const e=new Map;t.forAll(r=>e.set(r.from,r));let i=!0;for(;i;)i=!1,t.forEach(r=>{const n=e.get(r.to);n&&(r.to=n.to,e.delete(n.from),t.removeUnordered(n),i=!0)})}let cve=class extends uce{constructor(e,i,r){super(i,r),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return v(this.geometry.highlights)&&this.isVisible}get hasOccludees(){return v(this.geometry.occludees)}},YAt=class{constructor(){this.first=0,this.count=0}},ZAt=class{constructor(){this._numElements=0,this._instances=new Map,this.holes=new Wt({allocator:e=>e||new uce,deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=F5(),this.drawCommandsHighlight=F5(),this.drawCommandsOccludees=F5(),this.drawCommandsShadowHighlightRest=F5()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(e,i){this.deleteInstance(e),this._instances.set(e,i),this._numElements+=i.numElements}deleteInstance(e){const i=this._instances.get(e);i&&(this._numElements-=i.numElements,this._instances.delete(e))}updateInstance(e,i,r){const n=this._instances.get(e);n&&(this._numElements-=n.numElements,n.from=i,n.to=r,this._numElements+=n.numElements)}updateDrawState(e){e.isVisible?(e.hasHighlights&&(this.hasHighlights=!0),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,this._instances.size===0)return;if(!this.needsMultipleCommands()){const r=this.drawCommandsDefault.pushNew(),n=this.holes.front();return v(this.vao)&&this.holes.length===1&&n.to===Math.floor(this.vao.size/e)?(r.first=0,void(r.count=n.from)):(r.first=1/0,r.count=0,this._instances.forEach(s=>{r.first=Math.min(r.first,s.from),r.count=Math.max(r.count,s.to)}),void(r.count-=r.first))}const i=Array.from(this._instances.values()).sort((r,n)=>r.from===n.from?r.to-n.to:r.from-n.from);for(const r of i)r.isVisible&&(uve(r.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,r),uve(r.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,r))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}};function JAt(t){return v(t.vao)}function F5(){return new Wt({allocator:t=>t||new YAt,deallocator:t=>t})}function uve(t,e){const i=t.back();if(i==null){const r=t.pushNew();return r.first=e.from,void(r.count=e.numElements)}if(KAt(i,e)){const r=e.from-i.first+e.numElements;i.count=r}else{const r=t.pushNew();r.first=e.from,r.count=e.numElements}}function KAt(t,e){return t.first+t.count>=e.from}let QAt=class{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach(e=>e.vao.dispose()),this.buffers.length=0}findBuffer(e){return this.buffers.find(i=>i.instances.has(e))}};const eRt=N6+1;let tRt=class{constructor(e,i,r){this._rctx=e,this._locations=i,this._layout=r,this._cache=e.newCache(`VaoCache ${qu()}`,iRt)}dispose(){this._cache.destroy()}newVao(e){const i=e.toString(),r=this._cache.pop(i);if(v(r)){const s=r.pop();return r.length>0&&this._cache.put(i,r,e*r.length,eRt),s}const n=new Rm(this._rctx,this._locations,{geometry:this._layout},{geometry:er.createVertex(this._rctx,zi.STATIC_DRAW)});return n.vertexBuffers.geometry.setSize(e),n}deleteVao(e){if(R(e))return null;const i=e.size,r=i.toString(),n=this._cache.pop(r);return v(n)?(n.push(e),this._cache.put(r,n,i*n.length,-1)):this._cache.put(r,[e],i,-1),null}};function iRt(t,e){if(e===k0.ALL)return void t.forEach(n=>n.dispose());const i=t.pop(),r=t.length*i.size;return i.dispose(),r}let vke=class{constructor(e,i,r){this._rctx=e,this._materialRepository=i,this.material=r,this._dataByOrigin=new Map,this._appleAmdDriverHelper=null,this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new lke(this.material,this._materialRepository),this._bufferWriter=r.createBufferWriter(),this._vaoCache=new tRt(e,r.vertexAttributeLocations,sh(this._bufferWriter.vertexBufferLayout)),this._rctx.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper=new IAt(this._rctx))}dispose(){var e;this._glMaterials.destroy(),this._dataByOrigin.forEach(i=>i.dispose()),this._dataByOrigin.clear(),this._vaoCache.dispose(),(e=this._appleAmdDriverHelper)==null||e.dispose()}get isEmpty(){return this._dataByOrigin.size===0}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this.material instanceof yke}get rendersOccluded(){return!this.isEmpty&&this.material.renderOccluded!==xn.Occlude}get numGeometries(){let e=0;return this._dataByOrigin.forEach(i=>e+=i.buffers.reduce((r,n)=>r+n.instances.size,0)),e}forEachGeometry(e){this._dataByOrigin.forEach(i=>i.buffers.forEach(r=>r.instances.forEach(n=>e(n.geometry))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){var n;const i=this._bufferWriter,r=i.vertexBufferLayout.stride/4;for(const s of e){const o=s.renderGeometry,a=(n=this._dataByOrigin.get(o.localOrigin.id))==null?void 0:n.findBuffer(o.id);if(R(a))return;const l=a.instances.get(o.id);if(s.updateType&(co.GEOMETRY|co.TRANSFORMATION)){const c=z5(i.elementCount(l.geometry.geometry)*r),h=i.vertexBufferLayout.createView(c.buffer);this._writeGeometry(o,h,0),a.vao.vertexBuffers.geometry.setSubData(c,l.from*r,0,l.numElements*r)}s.updateType&(co.HIGHLIGHT|co.OCCLUDEE|co.VISIBILITY)&&(a.drawCommandsDirty=!0)}}_computeDeltas(e,i){var n;const r=new VO;for(const s of e){const o=s.localOrigin;if(R(o))continue;let a=r.get(o.id,null);R(a)&&(a=new hve(o.vec3),r.set(o.id,null,a)),a.changes.push(s)}for(const s of i){const o=s.localOrigin;if(R(o))continue;const a=(n=this._dataByOrigin.get(o.id))==null?void 0:n.findBuffer(s.id);if(R(a))continue;let l=r.get(o.id,a);R(l)&&(l=new hve(o.vec3),r.set(o.id,a,l)),l.changes.push(s)}return r}_addAndRemoveGeometries(e,i){const{_bufferWriter:r,_dataByOrigin:n}=this,s=r.vertexBufferLayout.stride/4,o=this._computeDeltas(e,i);o.forEach((a,l)=>{const c=a.get(null),h=v(c)?c.changes:[];o.delete(l,null);let p=n.get(l);if(a.forEach((f,m)=>{if(o.delete(l,m),R(m))return void wt(!1,"No VAO for removed geometries");if(m.instances.size===f.changes.length)return this._vaoCache.deleteVao(m.vao),NL(p.buffers,m),void(p.buffers.length===0&&h.length===0&&n.delete(l));const g=m.numElements,_=m.vao.size/4,b=h.reduce((E,C)=>E+r.elementCount(C.geometry),0),w=f.changes.reduce((E,C)=>E+r.elementCount(C.geometry),0),x=Math.min((g+b-w)*s,V5),T=x>_;x>zz&&x<_/2?(f.changes.forEach(({id:E})=>m.deleteInstance(E)),m.instances.forEach(({geometry:E})=>h.push(E)),this._vaoCache.deleteVao(m.vao),NL(p.buffers,m)):T?this._applyAndRebuild(m,h,f):this._applyRemoves(m,f)}),h.length>0)for(R(p)&&(p=new QAt(c.origin),n.set(l,p)),p.buffers.forEach(f=>this._applyAdds(f,h));h.length>0;)p.buffers.push(this._applyAndRebuild(new ZAt,h,null))})}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(e=>{e.buffers.forEach(i=>{i.drawCommandsDirty&&(i.hasHiddenInstances=!1,i.hasHighlights=!1,i.hasOccludees=!1,pa(i.instances,r=>(i.updateDrawState(r),i.hasHiddenInstances&&i.hasHighlights&&i.hasOccludees)),i.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride)),this._hasHighlights=this._hasHighlights||i.hasHighlights,this._hasOccludees=this._hasOccludees||i.hasOccludees})})}_applyAndRebuild(e,i,r){if(v(r))for(const g of r.changes)e.deleteInstance(g.id);const n=this._bufferWriter,s=n.vertexBufferLayout.stride,o=s/4,a=Math.floor(V5/o);let l=e.numElements;for(;i.length>0;){const g=i.pop(),_=n.elementCount(g.geometry);if(l+_>a&&l>0){i.push(g);break}l+=_;const b=new cve(g,0,0);wt(e.instances.get(g.id)==null),e.addInstance(g.id,b)}const c=l*o,h=z5(c),p=n.vertexBufferLayout.createView(h.buffer);let f=0;e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,e.instances.forEach((g,_)=>{this._writeGeometry(g.geometry,p,f);const b=f;f+=n.elementCount(g.geometry.geometry),e.updateInstance(_,b,f),e.updateDrawState(g)}),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(pve(c)),e.vao.vertexBuffers.geometry.setSubData(h,0,0,f*o),e.holes.clear();const m=e.holes.pushNew();return m.from=f,m.to=Math.floor(e.vao.size/s),e.updateDrawCommands(s),e}_applyRemoves(e,i){if(i.changes.length===0)return;for(const a of i.changes){const l=a.id,c=e.instances.get(l);if(!c)continue;e.deleteInstance(l);const h=zm.back();if(h){if(h.to===c.from){h.to=c.to;continue}if(h.from===c.to){h.from=c.from;continue}}const p=zm.pushNew();p.from=c.from,p.to=c.to}lve(zm);const r=this._bufferWriter.vertexBufferLayout.stride/4,n=zm.reduce((a,l)=>Math.max(a,l.numElements),0)*r,s=z5(n);s.fill(0,0,n);const o=e.vao.vertexBuffers.geometry;zm.forAll(a=>o.setSubData(s,a.from*r,0,a.numElements*r)),e.holes.pushArray(zm.data,zm.length),zm.forAll((a,l)=>zm.data[l]=null),zm.clear(),e.drawCommandsDirty=!0}_applyAdds(e,i){if(i.length===0)return;if(!JAt(e))return void this._applyAndRebuild(e,i,null);const r=this._bufferWriter,n=r.vertexBufferLayout.stride/4,s=e.numElements,o=i.reduce((w,x)=>w+r.elementCount(x.geometry),0),a=Math.min((s+o)*n,V5),l=4*a;if(e.vao.size<pve(V5-zz)&&l>e.vao.size)return void this._applyAndRebuild(e,i,null);lve(e.holes);const c=new Array;for(const w of i){const x=r.elementCount(w.geometry),T=rRt(e.holes,x);c.push(T)}const h=e.vao.vertexBuffers.geometry;let p=0,f=0,m=0;const g=z5(a),_=r.vertexBufferLayout.createView(g.buffer);i.forEach((w,x)=>{const T=c[x];if(R(T))return;if(m!==T){const A=m-f;A>0&&h.setSubData(g,f*n,0,A*n),f=T,p=0}const E=r.elementCount(w.geometry);this._writeGeometry(w,_,p),p+=E,m=T+E;const C=new cve(w,T,T+E);wt(e.instances.get(w.id)==null),e.addInstance(w.id,C),e.drawCommandsDirty=!0});const b=m-f;b>0&&h.setSubData(g,f*n,0,b*n),s7e(i,(w,x)=>R(c[x]))}_writeGeometry(e,i,r){const n=e.localOrigin.vec3;Rvt(dve,-n[0],-n[1],-n[2]);const s=$n(nRt,dve,e.transformation);wa(k5,s),Ku(k5,k5),this._bufferWriter.write(s,k5,e.geometry,i,r)}updateAnimation(e){return this.material.update(e)}requiresSlot(e,i){return this.material.requiresSlot(e,i)}render(e,i){var c;if(!this.requiresSlot(i.slot,e))return!1;const r=e===z.Highlight||e===z.ShadowHighlight;if(r&&!this._hasHighlights)return!1;const n=e===z.ShadowExcludeHighlight,s=!(r||n),o=this._rctx;let a;const l=()=>{if(v(a))return a;const h=this._glMaterials.load(o,i.slot,e);return R(h)?null:(a=h.beginSlot(i),R(a)?null:(o.bindTechnique(a,this.material.parameters,i),a))};(c=this._appleAmdDriverHelper)==null||c.resetIndicesType();for(const h of this._dataByOrigin.values())for(const p of h.buffers){if(r&&!p.hasHighlights)continue;const f=(r?p.drawCommandsHighlight:n&&p.needsMultipleCommands()?p.drawCommandsShadowHighlightRest:p.drawCommandsDefault)||null,m=s&&p.drawCommandsOccludees||null;if(f!=null&&f.length||m!=null&&m.length){const g=l();if(R(g))return!1;g.program.bindDraw(new Dte(h.origin),i,this.material.parameters),g.ensureAttributeLocations(p.vao),o.bindVAO(p.vao),f!=null&&f.length&&(g.bindPipelineState(o,i.slot,!1),f.forAll(_=>o.drawArrays(g.primitiveType,_.first,_.count))),m!=null&&m.length&&(g.bindPipelineState(o,i.slot,!0),m.forAll(_=>o.drawArrays(g.primitiveType,_.first,_.count)))}}return v(a)}get test(){return{material:this.material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}},hve=class{constructor(e){this.origin=e,this.changes=new Array}};function rRt(t,e){let i;if(!t.some(n=>!(n.numElements<e)&&(i=n,!0)))return null;const r=i.from;return i.from+=e,i.from>=i.to&&t.removeUnordered(i),r}const dve=$e(),nRt=$e(),k5=$e(),zm=new Wt({allocator:t=>t||new uce,deallocator:null}),zz=65536,U5=4*zz,bke=16777216,V5=bke/4;let Zq=new Float32Array(zz);function z5(t){return Zq.length<t&&(Zq=new Float32Array(t)),Zq}function pve(t){const e=4*t;return e<U5?U5:Math.max(Math.min(Math.ceil(1.5*e/U5)*U5,bke),e)}let Rh=class extends ve{constructor(e){super(e),this._pending=new sRt,this._changes=new Lte,this._materialRenderers=new Map,this._sortedMaterialRenderers=new Wt,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return pa(this._materialRenderers,e=>e.rendersOccluded)}get isEmpty(){return!this.updating&&this._materialRenderers.size===0&&this._geometries.size===0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=ake(this._changes);let i=!1,r=!1,n=!1;return e.forEach((s,o)=>{let a=this._materialRenderers.get(o);if(!a&&s.adds.length>0&&(a=new vke(this.rctx,this._materialRepository,o),this._materialRenderers.set(o,a),i=!0,r=!0,n=!0),!a)return;const l=r||a.hasHighlights,c=n||a.hasWater;a.modify(s),r=r||l!==a.hasHighlights,n=n||c!==a.hasWater,a.isEmpty&&(this._materialRenderers.delete(o),a.dispose(),i=!0)}),this._changes.clear(),i&&this._updateSortedMaterialRenderers(),r&&(this._hasHighlights=pa(this._materialRenderers,s=>s.hasHighlights)),n&&(this._hasWater=pa(this._materialRenderers,s=>s.hasWater)),this.notifyChange("updating"),!0}addGeometries(e,i){if(e.length===0)return;const r=this._validateRenderGeometries(e);for(const s of r)this._geometries.set(s.id,s);const n=this._pending.empty;for(const s of r)this._pending.adds.add(s);n&&this.notifyChange("updating"),i===wn.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,i){const r=this._pending.empty,n=this._pending.adds;for(const s of e)n.has(s)?(this._pending.removed.add(s),n.delete(s)):this._pending.removed.has(s)||this._pending.removes.add(s),this._geometries.delete(s.id);r&&!this._pending.empty&&this.notifyChange("updating"),i===wn.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,i){const r=this._changes.updates.length===0;for(const n of e){const s=this._changes.updates.pushNew();s.renderGeometry=this._validateRenderGeometry(n),s.updateType=i}switch(r&&this._changes.updates.length>0&&this.notifyChange("updating"),i){case co.TRANSFORMATION:case co.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case co.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let i=!1;return this._sortedMaterialRenderers.forAll(r=>i=r.updateAnimation(e)||i),i}render(e){this._sortedMaterialRenderers.forAll(i=>{i.material.shouldRender(e)&&i.render(e.output,e.bindParameters)})}intersect(e,i,r,n,s){return this._geometries.forEach(o=>{if(n&&!n(o))return;this._intersectRenderGeometry(o,r,i,0,e,s);const a=this.rendererContext.longitudeCyclical;a&&(o.boundingSphere[0]-o.boundingSphere[3]<a.min&&this._intersectRenderGeometry(o,r,i,a.range,e,s),o.boundingSphere[0]+o.boundingSphere[3]>a.max&&this._intersectRenderGeometry(o,r,i,-a.range,e,s)),s++}),s}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach((i,r)=>{r.insertOrder=e++,this._sortedMaterialRenderers.push(i)}),this._sortedMaterialRenderers.sort((i,r)=>{const n=r.material.renderPriority-i.material.renderPriority;return n!==0?n:i.material.insertOrder-r.material.insertOrder})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const i=this._changes.updates.data[e];this._pending.has(i.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,i,r,n,s,o){if(!e.visible)return;let a=0;n+=e.transformation[12],a=e.transformation[13],Jq[0]=r[0]-n,Jq[1]=r[1]-a,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,s,Jq,(l,c,h)=>{oRt(i,h,e.material.renderPriority,o,s,e.layerUid,e.graphicUid)},i)}_notifyGraphicGeometryChanged(e){if(R(this.drapeSource.notifyGraphicGeometryChanged))return;let i;for(const r of e){const n=r.graphicUid;v(n)&&n!==i&&(this.drapeSource.notifyGraphicGeometryChanged(n),i=n)}}_notifyGraphicVisibilityChanged(e){if(R(this.drapeSource.notifyGraphicVisibilityChanged))return;let i;for(const r of e){const n=r.graphicUid;v(n)&&n!==i&&(this.drapeSource.notifyGraphicVisibilityChanged(n),i=n)}}_validateRenderGeometries(e){for(const i of e)this._validateRenderGeometry(i);return e}_validateRenderGeometry(e){return R(e.localOrigin)&&(e.localOrigin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};u([d()],Rh.prototype,"drapeSource",void 0),u([d()],Rh.prototype,"updating",null),u([d()],Rh.prototype,"rctx",null),u([d()],Rh.prototype,"rendererContext",void 0),u([d()],Rh.prototype,"_materialRepository",null),u([d()],Rh.prototype,"_localOriginFactory",null),u([d({readOnly:!0})],Rh.prototype,"isEmpty",null),u([d()],Rh.prototype,"_materialRenderers",void 0),u([d()],Rh.prototype,"_geometries",void 0),Rh=u([$("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],Rh);let sRt=class{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}};function oRt(t,e,i,r,n,s,o){const a=new MAt(s,o,e),l=c=>{c.set(gn.OVERLAY,a,t.dist,t.normal,t.transformation,i,r)};if((n.results.min.drapedLayerOrder==null||i>=n.results.min.drapedLayerOrder)&&(n.results.min.dist==null||n.results.ground.dist<=n.results.min.dist)&&l(n.results.min),n.options.store!==Ta.MIN&&(n.results.max.drapedLayerOrder==null||i<n.results.max.drapedLayerOrder)&&(n.results.max.dist==null||n.results.ground.dist>n.results.max.dist)&&l(n.results.max),n.options.store===Ta.ALL){const c=dle(n.ray);l(c),n.results.all.push(c)}}const Jq=Fe(),Kq=4;function aRt(){const t=new ji,e=t.fragment;t.include(Bp);const i=(Kq+1)/2,r=1/(2*i*i);return e.include(ud),e.uniforms.add([new Dt("depthMap",n=>n.depthTexture),new HN("tex",n=>n.colorTexture),new wD("blurSize",n=>n.blurSize),new Ie("projScale",(n,s)=>{const o=Lr(s.camera.eye,s.camera.center);return o>5e4?Math.max(0,n.projScale-(o-5e4)):n.projScale}),new Wi("nearFar",(n,s)=>s.camera.nearFar)]),e.code.add(S`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture2D(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv, nearFar);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${S.float(r)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),e.code.add(S`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${S.int(Kq)}; r <= ${S.int(Kq)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      gl_FragColor = vec4(b / w_total);
    }
  `),t}const lRt=Object.freeze(Object.defineProperty({__proto__:null,build:aRt},Symbol.toStringTag,{value:"Module"}));let wke=class xke extends Yi{initializeProgram(e){return new Hi(e.rctx,xke.shader.get().build(),Di)}initializePipeline(){return Ht({colorWrite:si})}};wke.shader=new Gi(lRt,()=>Q(()=>import("./SSAOBlur.glsl-73907755.js"),[]));const cRt="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";function L7(t){t.fragment.uniforms.add(new bi("projInfo",(e,i)=>uRt(i))),t.fragment.uniforms.add(new Wi("zScale",(e,i)=>Tke(i))),t.fragment.code.add(S`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function uRt(t){const e=t.camera.projectionMatrix;return e[11]===0?cr(fve,2/(t.camera.fullWidth*e[0]),2/(t.camera.fullHeight*e[5]),(1+e[12])/e[0],(1+e[13])/e[5]):cr(fve,-2/(t.camera.fullWidth*e[0]),-2/(t.camera.fullHeight*e[5]),(1-e[8])/e[0],(1-e[9])/e[5])}const fve=pi();function Tke(t){return t.camera.projectionMatrix[11]===0?dt(mve,0,1):dt(mve,1,0)}const mve=Fe(),gve=16;function hRt(){const t=new ji,e=t.fragment;return t.include(Bp),e.include(ud),t.include(L7),e.uniforms.add(new Ie("radius",(i,r)=>hce(r.camera))),e.code.add(S`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn-bias, 0.0);
}`),e.code.add(S`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),e.uniforms.add([new Wi("nearFar",(i,r)=>r.camera.nearFar),new Dt("normalMap",i=>i.normalTexture),new Dt("depthMap",i=>i.depthTexture),new Wi("zScale",(i,r)=>Tke(r)),new Ie("projScale",i=>i.projScale),new Dt("rnm",i=>i.noiseTexture),new Wi("rnmScale",(i,r)=>dt(yve,r.camera.fullWidth/i.noiseTexture.descriptor.width,r.camera.fullHeight/i.noiseTexture.descriptor.height)),new Ie("intensity",i=>i.intensity),new Wi("screenSize",(i,r)=>dt(yve,r.camera.fullWidth,r.camera.fullHeight))]),e.code.add(S`
    void main(void) {
      fillSphere();
      vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));
      float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

      if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
        gl_FragColor = vec4(0.0);
        return;
      }

      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

      // get the normal of current fragment
      vec4 norm4 = texture2D(normalMap, uv);
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
      bool isTerrain = norm4.w<0.5;

      float sum = .0;
      vec3 tapPixelPos;

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${S.int(gve)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        //don't use current or very nearby samples
        if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

        if (isTerrain) {
          bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;
          if (isTerrainTap) {
            continue;
          }
        }

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${S.int(gve)}),0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4)/2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
      gl_FragColor = vec4(A);
    }
  `),t}function hce(t){return Math.max(10,20*t.computeRenderPixelSizeAtDist(Math.abs(4*t.relativeElevation)))}const yve=Fe(),dRt=Object.freeze(Object.defineProperty({__proto__:null,build:hRt,getRadius:hce},Symbol.toStringTag,{value:"Module"}));let Ske=class Eke extends Yi{initializeProgram(e){return new Hi(e.rctx,Eke.shader.get().build(),Di)}initializePipeline(){return Ht({colorWrite:si})}};Ske.shader=new Gi(dRt,()=>Q(()=>import("./SSAO.glsl-f9ef2d09.js"),[]));let pRt=class extends Tr{constructor(){super(...arguments),this.projScale=1}},fRt=class extends pRt{constructor(){super(...arguments),this.intensity=1}},mRt=class extends Tr{},gRt=class extends mRt{constructor(){super(...arguments),this.blurSize=Fe()}};const GI=2;let Cke=class{constructor(e,i,r,n){this._view=e,this._techniqueRepository=i,this._rctx=r,this._requestRender=n,this._quadVAO=null,this._passParameters=new fRt,this._drawParameters=new gRt}dispose(){this.enabled=!1,this._quadVAO=rt(this._quadVAO)}disposeOffscreenBuffers(){Vo(this._ssaoFBO,e=>e.resize(0,0)),Vo(this._blur0FBO,e=>e.resize(0,0)),Vo(this._blur1FBO,e=>e.resize(0,0))}set enabled(e){e?this._enable():this._disable()}get enabled(){return v(this._enableTime)}get active(){return this.enabled&&this._ssaoTechnique.compiled&&this._blurTechnique.compiled}get colorTexture(){return v(this._blur1FBO)?this._blur1FBO.colorTexture:null}render(e,i,r,n){if(R(this._enableTime)||R(r)||R(n)||R(this._ssaoFBO)||R(this._blur0FBO)||R(this._blur1FBO))return;if(!this.active)return this._enableTime=i,void this._requestRender();this._enableTime===0&&(this._enableTime=i);const s=this._rctx,o=e.camera,a=this._view.qualitySettings.fadeDuration,l=a>0?Math.min(a,i-this._enableTime)/a:1;this._passParameters.normalTexture=n,this._passParameters.depthTexture=r,this._passParameters.projScale=1/o.computeRenderPixelSizeAtDist(1),this._passParameters.intensity=4*yRt/hce(o)**6*l;const c=o.fullViewport,h=c[2],p=c[3],f=h/GI,m=p/GI;this._ssaoFBO.resize(h,p),this._blur0FBO.resize(f,m),this._blur1FBO.resize(f,m),R(this._quadVAO)&&(this._quadVAO=xl(this._rctx)),s.bindFramebuffer(this._ssaoFBO),s.setViewport(0,0,h,p),s.bindTechnique(this._ssaoTechnique,this._passParameters,e).bindDraw(this._drawParameters,e,this._passParameters),s.bindVAO(this._quadVAO);const g=Ua(this._quadVAO,"geometry");s.drawArrays(Ft.TRIANGLE_STRIP,0,g);const _=s.bindTechnique(this._blurTechnique,this._passParameters,e);s.setViewport(0,0,f,m),s.bindFramebuffer(this._blur0FBO),this._drawParameters.colorTexture=this._ssaoFBO.colorTexture,dt(this._drawParameters.blurSize,0,GI/p),_.bindDraw(this._drawParameters,e,this._passParameters),s.setViewport(0,0,f,m),s.drawArrays(Ft.TRIANGLE_STRIP,0,g),s.bindFramebuffer(this._blur1FBO),this._drawParameters.colorTexture=this._blur0FBO.colorTexture,dt(this._drawParameters.blurSize,GI/h,0),_.bindDraw(this._drawParameters,e,this._passParameters),s.drawArrays(Ft.TRIANGLE_STRIP,0,g),s.setViewport(c[0],c[1],c[2],c[3]),l<1&&this._requestRender()}_enable(){if(v(this._enableTime))return;const e={target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:nt.LINEAR,wrapMode:$t.CLAMP_TO_EDGE,width:0,height:0},i={colorTarget:En.TEXTURE,depthStencilTarget:Vi.NONE};this._ssaoFBO=new es(this._rctx,i,e),this._blur0FBO=new es(this._rctx,i,e),this._blur1FBO=new es(this._rctx,i,e);const r=Uint8Array.from(atob(cRt),n=>n.charCodeAt(0));this._passParameters.noiseTexture=new mt(this._rctx,{target:Ct.TEXTURE_2D,pixelFormat:Ge.RGB,dataType:kt.UNSIGNED_BYTE,hasMipmap:!0,width:32,height:32},r),R(this._ssaoTechnique)&&(this._ssaoTechnique=this._techniqueRepository.acquire(Ske)),R(this._blurTechnique)&&(this._blurTechnique=this._techniqueRepository.acquire(wke)),this._enableTime=0,this._requestRender()}_disable(){this._enableTime=null,this._passParameters.noiseTexture=rt(this._passParameters.noiseTexture),this._blur1FBO=rt(this._blur1FBO),this._blur0FBO=rt(this._blur0FBO),this._ssaoFBO=rt(this._ssaoFBO)}get gpuMemoryUsage(){return(v(this._blur0FBO)?this._blur0FBO.gpuMemoryUsage:0)+(v(this._blur1FBO)?this._blur1FBO.gpuMemoryUsage:0)+(v(this._ssaoFBO)?this._ssaoFBO.gpuMemoryUsage:0)}get test(){return{ssao:this._ssaoFBO,blur:this._blur1FBO}}};const yRt=.5;let dce=class Ake extends Yi{initializeProgram(e){return new Hi(e.rctx,Ake.shader.get().build(),Di)}initializePipeline(){return this.configuration.hasAlpha?Ht({blending:_o(Ce.SRC_ALPHA,Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA,Ce.ONE_MINUS_SRC_ALPHA),colorWrite:si}):Ht({colorWrite:si})}};dce.shader=new Gi(BSt,()=>Q(()=>import("./TextureOnly.glsl-c5b84d3d.js"),[]));let pce=class extends wl{constructor(){super(...arguments),this.hasAlpha=!1}};u([j()],pce.prototype,"hasAlpha",void 0);let Sf=class extends ve{get _bindParameters(){return this._renderContext.bindParameters}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}constructor(e){super(e),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._handles=new Xi,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new Wt,this._passParameters=new zle,this._rctx=null,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this._camera=new Pt,this.worldToPCSRatio=1,this.events=new An,this.longitudeCyclical=null}initialize(){const e=this.view._stage.renderView;this._rctx=e.renderingContext;const i=e.waterTextureRepository;this._stippleTextureRepository=new G5e(e.renderingContext),this._shaderTechniqueRepository=new k5e({rctx:this._rctx,viewingMode:qe.Local,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:i}),this._renderContext=new ske(this._rctx,new ace(this._rctx,this.view.state.viewingMode),new Cke(this.view,this._shaderTechniqueRepository,this._rctx,()=>{})),this._handles.add([ne(()=>i.updating,()=>this.events.emit("content-changed"),Jr),ne(()=>this.spatialReference,r=>this._localOriginFactory=new oce(r),Jr),Kn(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materialRepository=new U5e(e.textureRepository,this._shaderTechniqueRepository,r=>{(r.renderOccluded&Bz)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")},()=>this.events.emit("content-changed")),this._bindParameters.slot=Ee.DRAPED_MATERIAL,this._bindParameters.highlightDepthTexture=MDe(this._rctx),this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=At.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new jae(Ue(1,1,1))]),this._handles.add(this.view.resourceController.scheduler.registerTask(St.STAGE,this))}destroy(){this._handles.destroy(),this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._debugTextureTechnique=nn(this._debugTextureTechnique),this._passParameters.texture=rt(this._passParameters.texture),this._bindParameters.highlightDepthTexture=rt(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=Ve(this._shaderTechniqueRepository),this._temporaryFBO=rt(this._temporaryFBO),this._quadVAO=rt(this._quadVAO),this.disposeOverlays()}get updating(){return this._sortedDrapeSourceRenderersDirty||pa(this._renderers,e=>e.updating)}get hasOverlays(){return v(this._overlays)&&v(this._overlayRenderTarget)}get gpuMemoryUsage(){return v(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,Rh)}createDrapeSourceRenderer(e,i,r){const n=this._renderers.get(e);v(n)&&n.destroy();const s=new i({...r,rendererContext:this,drapeSource:e});return this._renderers.set(e,s),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(ne(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),s}removeDrapeSourceRenderer(e){if(R(e))return;const i=this._renderers.get(e);R(i)||(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this._handles.remove(e),i.destroy())}collectUnusedRenderTargetMemory(e){let i=!1;if(v(this._overlayRenderTarget))for(const r of this._overlayRenderTarget.renderTargets){const[n,s]=this.overlays,o=n.validTargets[r.type]||!s.validTargets[r.type];i=this._overlayRenderTarget.validateUsageForTarget(o,r,e)||i}return i}get overlays(){return Nt(this._overlays,[])}ensureDrapeTargets(e){v(this._overlays)&&this._overlays.forEach(i=>i.hasTargetWithoutRasterImage=a6(e,r=>r.drapeTargetType===Ote.WithoutRasterImage))}ensureDrapeSources(e){v(this._overlays)&&this._overlays.forEach(i=>{i.hasDrapedFeatureSource=a6(e,r=>r.drapeSourceType===iL.Features),i.hasDrapedRasterSource=a6(e,r=>r.drapeSourceType===iL.RasterImage)})}ensureOverlays(e,i){R(this._overlays)&&(this._overlayRenderTarget=new UCt(this._rctx),this._overlays=[new B_e(mn.INNER,this._overlayRenderTarget),new B_e(mn.OUTER,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(i)}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=rt(this._overlayRenderTarget),this.events.emit("textures-disposed")}get running(){return this.updating}runTask(e){this._processDrapeSources(e,()=>!0)}_processDrapeSources(e,i){let r=!1;for(const[n,s]of this._renderers){if(e.done)break;(n.destroyed||i(n))&&s.commitChanges()&&(r=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,r=!0,this._updateSortedDrapeSourceRenderers()),r&&(v(this._overlays)&&this._renderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(ql,e=>e.updatePolicy===qb.SYNC)}get isEmpty(){return!tr.OVERLAY_DRAW_DEBUG_TEXTURE&&!pa(this._renderers,e=>!e.isEmpty)}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateAnimation(e){let i=!1;return this._renderers.forEach(r=>i=r.updateAnimation(e)||i),i}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawTarget(e,i,r){const n=e.canvasGeometries;if(n.numViews===0)return!1;this._screenToWorldRatio=r*e.mapUnitsPerPixel;const s=i.output;if(this.isEmpty||s===z.Highlight&&!this.hasHighlights||s===z.Normal&&!this.hasWater||!e.hasSomeSizedView())return!1;const o=i.fbo;if(!o.isValid())return!1;const a=2*e.resolution,l=e.resolution;o.resize(a,l);const c=this._rctx;if(this._camera.pixelRatio=e.pixelRatio*r,this._renderContext.output=s,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=s===z.Normal?Ee.DRAPED_WATER:Ee.DRAPED_MATERIAL,e.applyViewport(this._rctx),o.bind(c),e.index===mn.INNER&&(c.setClearColor(0,0,0,0),c.clearSafe(Yr.COLOR_BUFFER_BIT)),i.type===Pn.Occluded&&(this._renderContext.renderOccludedMask=Bz),tr.OVERLAY_DRAW_DEBUG_TEXTURE&&i.type!==Pn.Occluded)for(let h=0;h<n.numViews;h++)this._setViewParameters(n.extents[h],e),this._drawDebugTexture(e.resolution,vRt[e.index]);return this._renderers.size>0&&this._sortedRenderers.forAll(({drapeSource:h,renderer:p})=>{if(i.type===Pn.ColorNoRasterImage&&h.drapeSourceType===iL.RasterImage)return;const{fullOpacity:f}=h,m=v(f)&&f<1&&s===z.Color;m&&(this.bindTemporaryFramebuffer(this._rctx,a,l),c.clearSafe(Yr.COLOR_BUFFER_BIT));for(let g=0;g<n.numViews;g++)this._setViewParameters(n.extents[g],e),p.render(this._renderContext);m&&v(this._temporaryFBO)&&(o.bind(c),this.view._stage.renderView.compositingHelper.compositeOverlay(this._renderContext.bindParameters,this._temporaryFBO.getTexture(),f,e.index))}),c.bindFramebuffer(null),o.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,i,r){R(this._temporaryFBO)&&(this._temporaryFBO=new F5e(e,!1)),this._temporaryFBO.resize(i,r),this._temporaryFBO.bind(e)}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,i,r,n){var o;let s=0;for(const a of this._renderers.values())s=((o=a.intersect)==null?void 0:o.call(a,e,i,r,n,s))??s}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),this._renderers.size===0)return;const e=this.view.map.allLayers;this._renderers.forEach((i,r)=>{const n=e.indexOf(r.layer),s=n>=0,o=this._renderers.size*(r.renderGroup??(s?Fz.MapLayer:Fz.ViewLayer))+(s?n:0);this._sortedRenderers.push(new _Rt(r,i,o))}),this._sortedRenderers.sort((i,r)=>i.index-r.index)}_setViewParameters(e,i){const r=this._camera;r.viewport=[0,0,i.resolution,i.resolution],FAe(r.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],r.near,r.far),sB(r.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=pa(this._renderers,i=>i.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_updateHasHighlights(){const e=pa(this._renderers,i=>i.hasHighlights);e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}_updateRendersOccluded(){const e=pa(this._renderers,i=>i.rendersOccluded);e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}_drawDebugTexture(e,i){this._ensureDebugPatternResources(e,e,i);const r=this._rctx;r.bindTechnique(this._debugTextureTechnique,this._passParameters,null),r.bindVAO(this._quadVAO),r.drawArrays(Ft.TRIANGLE_STRIP,0,Ua(this._quadVAO,"geometry"))}_ensureDebugPatternResources(e,i,r){if(he(this._passParameters.color,r[0],r[1],r[2]),this._passParameters.texture)return;const n=new Uint8Array(e*i*4);let s=0;for(let a=0;a<i;a++)for(let l=0;l<e;l++){const c=Math.floor(l/10),h=Math.floor(a/10);c<2||h<2||10*c>e-20||10*h>i-20?(n[s++]=255,n[s++]=255,n[s++]=255,n[s++]=255):(n[s++]=255,n[s++]=255,n[s++]=255,n[s++]=1&c&&1&h?1&l^1&a?0:255:1&c^1&h?0:128)}this._passParameters.texture=new mt(this._rctx,{target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:nt.NEAREST,width:e,height:i},n);const o=new pce;o.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(dce,o),this._quadVAO=xl(this._rctx)}get test(){return{drapedRenderers:Array.from(this._renderers.values()),getDrapeSourceRenderer:e=>this._renderers.get(e)}}};u([d()],Sf.prototype,"_sortedDrapeSourceRenderersDirty",void 0),u([d({autoDestroy:!0})],Sf.prototype,"_shaderTechniqueRepository",void 0),u([d({autoDestroy:!0})],Sf.prototype,"_stippleTextureRepository",void 0),u([d({constructOnly:!0})],Sf.prototype,"view",void 0),u([d()],Sf.prototype,"worldToPCSRatio",void 0),u([d()],Sf.prototype,"spatialReference",void 0),u([d({type:Boolean,readOnly:!0})],Sf.prototype,"updating",null),u([d()],Sf.prototype,"isEmpty",null),Sf=u([$("esri.views.3d.terrain.OverlayRenderer")],Sf);let _Rt=class{constructor(e,i,r){this.drapeSource=e,this.renderer=i,this.index=r}};const vRt=[[1,.5,.5],[.5,.5,1]],fce=-2,Bz=xn.OccludeAndTransparent;function mce(t,e,i,r){const n=nF(t.rings,!!t.hasZ,vy.CCW_IS_HOLE),s=th(n.position.length),o=f5e(n.position,t.spatialReference,0,s,0,n.position,0,n.position.length/3,e,i,r),a=o!=null;return new xRt(n.position,s,Oke(n.polygons,n.position,s),Mke(n.outlines,n.position,s),a,o)}function Rke(t,e){const i=nF(t.rings,!1,vy.CCW_IS_HOLE),r=Nn(i.position,t.spatialReference,0,i.position,e,0,i.position.length/3);for(let n=2;n<i.position.length;n+=3)i.position[n]=fce;return{position:i.position,polygons:Oke(i.polygons,i.position),outlines:Mke(i.outlines,i.position),projectionSuccess:r}}function Mke(t,e,i=null){return t.filter(({count:r})=>r>1).map(({index:r,count:n})=>{const s=3*r,o=3*n;return v(i)?new Pke(r,n,Sp(e,s,o),Sp(i,s,o)):new gce(r,n,Sp(e,s,o))})}function Oke(t,e,i=null){const r=new Array;for(const{index:n,count:s,holeIndices:o,pathLengths:a}of t){if(s<=1)continue;const l=3*n,c=3*s,h=o.map(f=>f-n),p=v(i)?new bRt(n,s,Sp(e,3*n,3*s),Sp(i,l,c),h,a):new wRt(n,s,Sp(e,3*n,3*s),h,a);r.push(p)}return r}let gce=class{constructor(e,i,r){this.index=e,this.count=i,this.position=r}},Pke=class extends gce{constructor(e,i,r,n){super(e,i,r),this.mapPositions=n}},bRt=class extends Pke{constructor(e,i,r,n,s,o){super(e,i,r,n),this.holeIndices=s,this.pathLengths=o}},wRt=class extends gce{constructor(e,i,r,n,s){super(e,i,r),this.holeIndices=n,this.pathLengths=s}},xRt=class{constructor(e,i,r,n,s,o){this.position=e,this.mapPositions=i,this.polygons=r,this.outlines=n,this.projectionSuccess=s,this.sampledElevation=o}};function Ike(t,e){const i=t.fragment;switch(i.code.add(S`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),e.doubleSidedMode){case Cn.None:i.code.add(S`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case Cn.View:i.code.add(S`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case Cn.WindingOrder:i.code.add(S`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:e.doubleSidedMode;case Cn.COUNT:}}var Cn;(function(t){t[t.None=0]="None",t[t.View=1]="View",t[t.WindingOrder=2]="WindingOrder",t[t.COUNT=3]="COUNT"})(Cn||(Cn={}));function $ke(t){t.vertex.code.add(S`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}let TRt=class extends wl{constructor(){super(...arguments),this.instancedDoublePrecision=!1}};function Lke(t,e){e.instanced&&e.instancedDoublePrecision&&(t.attributes.add(M.MODELORIGINHI,"vec3"),t.attributes.add(M.MODELORIGINLO,"vec3"),t.attributes.add(M.MODEL,"mat3"),t.attributes.add(M.MODELNORMAL,"mat3"));const i=t.vertex;e.instancedDoublePrecision&&(i.include(hz,e),i.uniforms.add(new rd("viewOriginHi",(r,n)=>Lvt(he(B5,n.camera.viewInverseTransposeMatrix[3],n.camera.viewInverseTransposeMatrix[7],n.camera.viewInverseTransposeMatrix[11]),B5))),i.uniforms.add(new rd("viewOriginLo",(r,n)=>Dvt(he(B5,n.camera.viewInverseTransposeMatrix[3],n.camera.viewInverseTransposeMatrix[7],n.camera.viewInverseTransposeMatrix[11]),B5)))),i.code.add(S`
    vec3 calculateVPos() {
      ${e.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `),i.code.add(S`
    vec3 subtractOrigin(vec3 _pos) {
      ${e.instancedDoublePrecision?S`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),i.code.add(S`
    vec3 dpNormal(vec4 _normal) {
      ${e.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `),e.output===z.Normal&&(eO(i),i.code.add(S`
    vec3 dpNormalView(vec4 _normal) {
      ${e.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `)),e.hasVertexTangents&&i.code.add(S`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${e.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `)}u([j()],TRt.prototype,"instancedDoublePrecision",void 0);const B5=P();var Xs;function SRt(t){switch(t){case"multiply":default:return Xs.Multiply;case"ignore":return Xs.Ignore;case"replace":return Xs.Replace;case"tint":return Xs.Tint}}function Dke(t,e,i){if(R(t)||e===Xs.Ignore)return i[0]=255,i[1]=255,i[2]=255,void(i[3]=255);const r=_e(Math.round(t[3]*jz),0,jz),n=r===0||e===Xs.Tint?0:e===Xs.Replace?ERt:CRt;i[0]=_e(Math.round(t[0]*jE),0,jE),i[1]=_e(Math.round(t[1]*jE),0,jE),i[2]=_e(Math.round(t[2]*jE),0,jE),i[3]=r+n}(function(t){t[t.Multiply=1]="Multiply",t[t.Ignore=2]="Ignore",t[t.Replace=3]="Replace",t[t.Tint=4]="Tint"})(Xs||(Xs={}));const jE=255,jz=85,ERt=jz,CRt=2*jz;function Nke(t){t.vertex.code.add(S`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${S.int(Xs.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${S.int(Xs.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${S.int(Xs.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${S.int(Xs.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}function Fke(t,e){e.hasSymbolColors?(t.include(Nke),t.attributes.add(M.SYMBOLCOLOR,"vec4"),t.varyings.add("colorMixMode","mediump float"),t.vertex.code.add(S`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(t.fragment.uniforms.add(new oF("colorMixMode",i=>T4e[i.colorMixMode])),t.vertex.code.add(S`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function eE(t,e){e.hasVertexColors?(t.attributes.add(M.COLOR,"vec4"),t.varyings.add("vColor","vec4"),t.vertex.code.add(S`void forwardVertexColor() { vColor = color; }`),t.vertex.code.add(S`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):t.vertex.code.add(S`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function ARt(t){t.fragment.code.add(S`
    #define discardOrAdjustAlpha(color) { if (color.a < ${S.float(za)}) { discard; } }
  `)}let GS=class extends Fn{constructor(e,i){super(e,"float",br.Draw,(r,n,s)=>r.setUniform1f(e,i(n,s)))}};function HS(t,e){kke(t,e,new Ie("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function RRt(t,e){kke(t,e,new GS("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function kke(t,e,i){const r=t.fragment;switch(e.alphaDiscardMode!==_r.Mask&&e.alphaDiscardMode!==_r.MaskBlend||r.uniforms.add(i),e.alphaDiscardMode){case _r.Blend:return t.include(ARt);case _r.Opaque:r.code.add(S`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case _r.Mask:r.code.add(S`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case _r.MaskBlend:t.fragment.code.add(S`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function Uke(t,e){const{vertex:i,fragment:r}=t,n=e.hasModelTransformation;n&&i.uniforms.add(new on("model",o=>v(o.modelTransformation)?o.modelTransformation:ld));const s=e.hasColorTexture&&e.alphaDiscardMode!==_r.Opaque;switch(e.output){case z.Depth:case z.Shadow:case z.ShadowHighlight:case z.ShadowExcludeHighlight:case z.ObjectAndLayerIdColor:Yu(i,e),t.include(Gc,e),t.include(iy,e),t.include(ZR,e),t.include(N_,e),t.include(fs,e),t.include(x7,e),S2(t),t.varyings.add("depth","float"),s&&r.uniforms.add(new Dt("tex",o=>o.texture)),i.code.add(S`
          void main(void) {
            vpos = calculateVPos();
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPositionWithDepth(proj, view, ${n?"model,":""} vpos, nearFar, depth);
            forwardTextureCoordinates();
            forwardObjectAndLayerIdColor();
          }
        `),t.include(HS,e),r.code.add(S`
          void main(void) {
            discardBySlice(vpos);
            ${s?S`
                    vec4 texColor = texture2D(tex, ${e.hasColorTextureTransform?S`colorUV`:S`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${e.output===z.ObjectAndLayerIdColor?S`outputObjectAndLayerIdColor();`:S`outputDepth(depth);`}
          }
        `);break;case z.Normal:Yu(i,e),t.include(Gc,e),t.include(sF,e),t.include(I7,e),t.include(iy,e),t.include(ZR,e),s&&r.uniforms.add(new Dt("tex",o=>o.texture)),t.varyings.add("vPositionView","vec3"),i.code.add(S`
          void main(void) {
            vpos = calculateVPos();
            vpos = subtractOrigin(vpos);
            ${e.normalType===hr.Attribute?S`
            vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:""}
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, ${n?"model,":""} vpos);
            forwardTextureCoordinates();
          }
        `),t.include(fs,e),t.include(HS,e),r.code.add(S`
          void main() {
            discardBySlice(vpos);
            ${s?S`
                    vec4 texColor = texture2D(tex, ${e.hasColorTextureTransform?S`colorUV`:S`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${e.normalType===hr.ScreenDerivative?S`
                vec3 normal = screenDerivativeNormal(vPositionView);`:S`
                vec3 normal = normalize(vNormalWorld);
                if (gl_FrontFacing == false) normal = -normal;`}
            gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
          }
        `);break;case z.Highlight:Yu(i,e),t.include(Gc,e),t.include(iy,e),t.include(ZR,e),s&&r.uniforms.add(new Dt("tex",o=>o.texture)),i.code.add(S`
          void main(void) {
            vpos = calculateVPos();
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, ${n?"model,":""} vpos);
            forwardTextureCoordinates();
          }
        `),t.include(fs,e),t.include(HS,e),t.include(Q_,e),r.code.add(S`
          void main() {
            discardBySlice(vpos);
            ${s?S`
                    vec4 texColor = texture2D(tex, ${e.hasColorTextureTransform?S`colorUV`:S`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}}function Vke(t,e){const i=t.fragment;if(e.hasVertexTangents?(t.attributes.add(M.TANGENT,"vec4"),t.varyings.add("vTangent","vec4"),e.doubleSidedMode===Cn.WindingOrder?i.code.add(S`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):i.code.add(S`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):(t.extensions.add("GL_OES_standard_derivatives"),i.code.add(S`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`)),e.textureCoordinateType!==ds.None){t.include(kae,e);const r=e.supportsTextureAtlas?e.hasWebGL2Context?lr.None:lr.Size:lr.None;i.uniforms.add(e.pbrTextureBindType===br.Pass?cm("normalTexture",n=>n.textureNormal,r):Gb("normalTexture",n=>n.textureNormal,r)),i.code.add(S`
    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
      vtc.uv = uv;
      ${e.supportsTextureAtlas?S`vtc.size = ${Tp(e,"normalTexture")};`:""}
      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;
      return tangentSpace * rawNormal;
    }
  `)}}function aF(t,e){const i=t.fragment;e.receiveAmbientOcclusion?(i.uniforms.add(cm("ssaoTex",(r,n)=>n.ssaoHelper.colorTexture,e.hasWebGL2Context?lr.None:lr.InvSize)),i.constants.add("blurSizePixelsInverse","float",1/GI),i.code.add(S`
      float evaluateAmbientOcclusionInverse() {
        vec2 ssaoTextureSizeInverse = ${Tp(e,"ssaoTex",!0)};
        return texture2D(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).a;
      }

      float evaluateAmbientOcclusion() {
        return 1.0 - evaluateAmbientOcclusionInverse();
      }
    `)):i.code.add(S`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)}function lF(t){t.constants.add("ambientBoostFactor","float",nNe)}function ZO(t){t.uniforms.add(new Ie("lightingGlobalFactor",(e,i)=>i.lighting.globalFactor))}function P2(t,e){const i=t.fragment;switch(t.include(aF,e),e.pbrMode!==_t.Disabled&&t.include(cce,e),t.include(zae,e),t.include(qN),i.code.add(S`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${e.pbrMode===_t.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),lF(i),ZO(i),H_(i),i.code.add(S`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${e.spherical?S`normalize(vPosWorld)`:S`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),Ey(i),i.code.add(S`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),e.pbrMode){case _t.Disabled:case _t.WaterOnIntegratedMesh:case _t.Water:t.include(oz,e),i.code.add(S`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case _t.Normal:case _t.Schematic:i.code.add(S`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),i.code.add(S`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),e.useFillLights?i.uniforms.add(new h_("hasFillLights",(r,n)=>n.enableFillLights)):i.constants.add("hasFillLights","bool",!1),i.code.add(S`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),i.uniforms.add([new Ie("lightingSpecularStrength",(r,n)=>n.lighting.mainLight.specularStrength),new Ie("lightingEnvironmentStrength",(r,n)=>n.lighting.mainLight.environmentStrength)]),i.code.add(S`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),i.code.add(S`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${e.pbrMode===_t.Schematic?S`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:S`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case _t.Terrain:case _t.TerrainWithWater:t.include(oz,e),i.code.add(S`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluateTerrainLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:e.pbrMode;case _t.COUNT:}}function MRt(t){t.vertex.uniforms.add(new Ay("colorTextureTransformMatrix",e=>v(e.colorTextureTransformMatrix)?e.colorTextureTransformMatrix:qc())),t.varyings.add("colorUV","vec2"),t.vertex.code.add(S`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function ORt(t){t.vertex.uniforms.add(new Ay("normalTextureTransformMatrix",e=>v(e.normalTextureTransformMatrix)?e.normalTextureTransformMatrix:qc())),t.varyings.add("normalUV","vec2"),t.vertex.code.add(S`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function PRt(t){t.vertex.uniforms.add(new Ay("emissiveTextureTransformMatrix",e=>v(e.emissiveTextureTransformMatrix)?e.emissiveTextureTransformMatrix:qc())),t.varyings.add("emissiveUV","vec2"),t.vertex.code.add(S`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function IRt(t){t.vertex.uniforms.add(new Ay("occlusionTextureTransformMatrix",e=>v(e.occlusionTextureTransformMatrix)?e.occlusionTextureTransformMatrix:qc())),t.varyings.add("occlusionUV","vec2"),t.vertex.code.add(S`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function $Rt(t){t.vertex.uniforms.add(new Ay("metallicRoughnessTextureTransformMatrix",e=>v(e.metallicRoughnessTextureTransformMatrix)?e.metallicRoughnessTextureTransformMatrix:qc())),t.varyings.add("metallicRoughnessUV","vec2"),t.vertex.code.add(S`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function BD(t){t.include(Cy),t.code.add(S`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${S.int(Xs.Multiply)}) {
        return allMixed;
      }
      if (mode == ${S.int(Xs.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${S.int(Xs.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${S.int(Xs.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${S.int(Xs.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function LRt(t){const e=new ji,{vertex:i,fragment:r,varyings:n}=e;return Yu(i,t),e.include(WN),n.add("vpos","vec3"),e.include(ZR,t),e.include(Lke,t),e.include(f4e,t),t.hasColorTextureTransform&&e.include(MRt),t.output!==z.Color&&t.output!==z.Alpha||(t.hasNormalTextureTransform&&e.include(ORt),t.hasEmissionTextureTransform&&e.include(PRt),t.hasOcclusionTextureTransform&&e.include(IRt),t.hasMetallicRoughnessTextureTransform&&e.include($Rt),xm(i,t),e.include(sF,t),e.include(Gc,t),t.normalType===hr.Attribute&&t.offsetBackfaces&&e.include($ke),e.include(Vke,t),e.include(I7,t),t.instancedColor&&e.attributes.add(M.INSTANCECOLOR,"vec4"),n.add("localvpos","vec3"),e.include(iy,t),e.include(UO,t),e.include(Fke,t),e.include(eE,t),i.uniforms.add(new bi("externalColor",s=>s.externalColor)),n.add("vcolorExt","vec4"),t.hasMultipassTerrain&&n.add("depth","float"),t.hasModelTransformation&&i.uniforms.add(new on("model",s=>v(s.modelTransformation)?s.modelTransformation:ld)),i.code.add(S`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${t.instancedColor?"vcolorExt *= instanceColor;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${S.float(za)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = calculateVPos();
          localvpos = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${t.normalType===hr.Attribute?S`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${t.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, ${t.hasModelTransformation?"model,":""} vpos);
          ${t.normalType===hr.Attribute&&t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        ${t.hasColorTextureTransform?S`forwardColorUV();`:""}
        ${t.hasNormalTextureTransform?S`forwardNormalUV();`:""}
        ${t.hasEmissionTextureTransform?S`forwardEmissiveUV();`:""}
        ${t.hasOcclusionTextureTransform?S`forwardOcclusionUV();`:""}
        ${t.hasMetallicRoughnessTextureTransform?S`forwardMetallicRoughnessUV();`:""}
      }
    `)),t.output===z.Alpha&&(e.include(fs,t),e.include(HS,t),e.include(hd,t),r.uniforms.add([new Ie("opacity",s=>s.opacity),new Ie("layerOpacity",s=>s.layerOpacity)]),t.hasColorTexture&&r.uniforms.add(new Dt("tex",s=>s.texture)),r.include(BD),r.code.add(S`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${t.hasColorTexture?S`
                vec4 texColor = texture2D(tex, ${t.hasColorTextureTransform?S`colorUV`:S`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:S`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?S`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:S`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        gl_FragColor = vec4(opacity_);
      }
    `)),t.output===z.Color&&(e.include(fs,t),e.include(P2,t),e.include(aF,t),e.include(HS,t),e.include(t.instancedDoublePrecision?$7:O2,t),e.include(hd,t),xm(r,t),r.uniforms.add([i.uniforms.get("localOrigin"),new Jt("ambient",s=>s.ambient),new Jt("diffuse",s=>s.diffuse),new Ie("opacity",s=>s.opacity),new Ie("layerOpacity",s=>s.layerOpacity)]),t.hasColorTexture&&r.uniforms.add(new Dt("tex",s=>s.texture)),e.include(Vae,t),e.include(cce,t),r.include(BD),e.include(Ike,t),lF(r),ZO(r),Ey(r),r.code.add(S`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${t.hasColorTexture?S`
                vec4 texColor = texture2D(tex, ${t.hasColorTextureTransform?S`colorUV`:S`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:S`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${t.normalType===hr.ScreenDerivative?S`
                vec3 normal = screenDerivativeNormal(localvpos);`:S`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${t.pbrMode===_t.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${t.receiveShadows?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?S`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:S`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.hasNormalTexture?S`
                mat3 tangentSpace = ${t.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`:S`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${t.spherical?S`normalize(posWorld);`:S`vec3(0.0, 0.0, 1.0);`}

        ${t.snowCover?S`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${t.pbrMode===_t.Normal||t.pbrMode===_t.Schematic?S`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?S`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:S`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===At.Color?S`gl_FragColor = premultiplyAlpha(gl_FragColor);`:""}
      }
    `)),e.include(Uke,t),e}const DRt=Object.freeze(Object.defineProperty({__proto__:null,build:LRt},Symbol.toStringTag,{value:"Module"}));let NRt=class extends cke{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=Ue(0,1,.5),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=Dr.Back,this.emissiveFactor=Ue(0,0,0),this.instancedDoublePrecision=!1,this.normalType=hr.Attribute,this.receiveSSAO=!0,this.receiveShadows=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=Ue(.2,.2,.2),this.diffuse=Ue(.8,.8,.8),this.externalColor=Zt(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=P(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvSizeValue=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=wr(),this.vvOpacityEnabled=!1,this.vvOpacityValues=[],this.vvOpacityOpacities=[],this.transparent=!1,this.writeDepth=!0,this.customDepthTest=b2.Less,this.textureAlphaMode=_r.Blend,this.textureAlphaCutoff=Lz,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=xn.Occlude}},FRt=class extends uke{constructor(){super(...arguments),this.origin=P(),this.slicePlaneLocalOrigin=this.origin}},yce=class zke extends Yi{initializeConfiguration(e,i){i.hasWebGL2Context=e.rctx.type===Et.WEBGL2,i.spherical=e.viewingMode===qe.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result,i.textureCoordinateType=i.hasColorTexture||i.hasMetallicRoughnessTexture||i.hasEmissionTexture||i.hasOcclusionTexture||i.hasNormalTexture?ds.Default:ds.None,i.objectAndLayerIdColorInstanced=i.instanced}initializeProgram(e){return this._initializeProgram(e,zke.shader)}_initializeProgram(e,i){return new Hi(e.rctx,i.get().build(this.configuration),Di)}_convertDepthTestFunction(e){return e===b2.Lequal?Gr.LEQUAL:Gr.LESS}_makePipeline(e,i){const r=this.configuration,n=e===At.NONE,s=e===At.FrontFace;return Ht({blending:r.output!==z.Color&&r.output!==z.Alpha||!r.transparent?null:n?nd:ev(e),culling:kRt(r)?KB(r.cullFace):null,depthTest:{func:jw(e,this._convertDepthTestFunction(r.customDepthTest))},depthWrite:(n||s)&&r.writeDepth?Kc:null,colorWrite:si,stencilWrite:r.hasOccludees?by:null,stencilTest:r.hasOccludees?i?Cw:Gw:null,polygonOffset:n||s?null:A7(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0),this._makePipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,i){return i?this._occludeePipelineState:super.getPipelineState(e,i)}};function kRt(t){return t.cullFace!==Dr.None||!t.hasSlicePlane&&!t.transparent&&!t.doubleSidedMode}yce.shader=new Gi(DRt,()=>Q(()=>import("./DefaultMaterial.glsl-1d8cda8e.js"),[]));let ti=class extends Do{constructor(){super(...arguments),this.output=z.Color,this.alphaDiscardMode=_r.Opaque,this.doubleSidedMode=Cn.None,this.pbrMode=_t.Disabled,this.cullFace=Dr.None,this.transparencyPassType=At.NONE,this.normalType=hr.Attribute,this.textureCoordinateType=ds.None,this.customDepthTest=b2.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.objectAndLayerIdColorInstanced=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1}};u([j({count:z.COUNT})],ti.prototype,"output",void 0),u([j({count:_r.COUNT})],ti.prototype,"alphaDiscardMode",void 0),u([j({count:Cn.COUNT})],ti.prototype,"doubleSidedMode",void 0),u([j({count:_t.COUNT})],ti.prototype,"pbrMode",void 0),u([j({count:Dr.COUNT})],ti.prototype,"cullFace",void 0),u([j({count:At.COUNT})],ti.prototype,"transparencyPassType",void 0),u([j({count:hr.COUNT})],ti.prototype,"normalType",void 0),u([j({count:ds.COUNT})],ti.prototype,"textureCoordinateType",void 0),u([j({count:b2.COUNT})],ti.prototype,"customDepthTest",void 0),u([j()],ti.prototype,"spherical",void 0),u([j()],ti.prototype,"hasVertexColors",void 0),u([j()],ti.prototype,"hasSymbolColors",void 0),u([j()],ti.prototype,"hasVerticalOffset",void 0),u([j()],ti.prototype,"hasSlicePlane",void 0),u([j()],ti.prototype,"hasSliceHighlight",void 0),u([j()],ti.prototype,"hasColorTexture",void 0),u([j()],ti.prototype,"hasMetallicRoughnessTexture",void 0),u([j()],ti.prototype,"hasEmissionTexture",void 0),u([j()],ti.prototype,"hasOcclusionTexture",void 0),u([j()],ti.prototype,"hasNormalTexture",void 0),u([j()],ti.prototype,"hasScreenSizePerspective",void 0),u([j()],ti.prototype,"hasVertexTangents",void 0),u([j()],ti.prototype,"hasOccludees",void 0),u([j()],ti.prototype,"hasMultipassTerrain",void 0),u([j()],ti.prototype,"hasModelTransformation",void 0),u([j()],ti.prototype,"offsetBackfaces",void 0),u([j()],ti.prototype,"vvSize",void 0),u([j()],ti.prototype,"vvColor",void 0),u([j()],ti.prototype,"receiveShadows",void 0),u([j()],ti.prototype,"receiveAmbientOcclusion",void 0),u([j()],ti.prototype,"textureAlphaPremultiplied",void 0),u([j()],ti.prototype,"instanced",void 0),u([j()],ti.prototype,"instancedColor",void 0),u([j()],ti.prototype,"objectAndLayerIdColorInstanced",void 0),u([j()],ti.prototype,"instancedDoublePrecision",void 0),u([j()],ti.prototype,"doublePrecisionRequiresObfuscation",void 0),u([j()],ti.prototype,"writeDepth",void 0),u([j()],ti.prototype,"transparent",void 0),u([j()],ti.prototype,"enableOffset",void 0),u([j()],ti.prototype,"cullAboveGround",void 0),u([j()],ti.prototype,"snowCover",void 0),u([j()],ti.prototype,"hasColorTextureTransform",void 0),u([j()],ti.prototype,"hasEmissionTextureTransform",void 0),u([j()],ti.prototype,"hasNormalTextureTransform",void 0),u([j()],ti.prototype,"hasOcclusionTextureTransform",void 0),u([j()],ti.prototype,"hasMetallicRoughnessTextureTransform",void 0),u([j({constValue:!0})],ti.prototype,"hasVvInstancing",void 0),u([j({constValue:!1})],ti.prototype,"useCustomDTRExponentForWater",void 0),u([j({constValue:!1})],ti.prototype,"supportsTextureAtlas",void 0),u([j({constValue:!0})],ti.prototype,"useFillLights",void 0);function URt(t){const e=new ji,{vertex:i,fragment:r,varyings:n}=e;return Yu(i,t),e.include(WN),n.add("vpos","vec3"),e.include(ZR,t),e.include(Lke,t),e.include(f4e,t),t.output!==z.Color&&t.output!==z.Alpha||(xm(e.vertex,t),e.include(sF,t),e.include(Gc,t),t.offsetBackfaces&&e.include($ke),t.instancedColor&&e.attributes.add(M.INSTANCECOLOR,"vec4"),n.add("vNormalWorld","vec3"),n.add("localvpos","vec3"),t.hasMultipassTerrain&&n.add("depth","float"),e.include(iy,t),e.include(UO,t),e.include(Fke,t),e.include(eE,t),i.uniforms.add(new bi("externalColor",s=>s.externalColor)),n.add("vcolorExt","vec4"),i.code.add(S`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${t.instancedColor?"vcolorExt *= instanceColor;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${S.float(za)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${t.hasMultipassTerrain?S`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),t.output===z.Alpha&&(e.include(fs,t),e.include(HS,t),e.include(hd,t),r.uniforms.add([new Ie("opacity",s=>s.opacity),new Ie("layerOpacity",s=>s.layerOpacity)]),t.hasColorTexture&&r.uniforms.add(new Dt("tex",s=>s.texture)),r.include(BD),r.code.add(S`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?S`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${t.hasColorTexture?S`
                vec4 texColor = texture2D(tex, ${t.hasColorTextureTransform?S`colorUV`:S`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:S`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?S`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:S`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        gl_FragColor = vec4(opacity_);
      }
    `)),t.output===z.Color&&(e.include(fs,t),e.include(P2,t),e.include(aF,t),e.include(HS,t),e.include(t.instancedDoublePrecision?$7:O2,t),e.include(hd,t),xm(e.fragment,t),H_(r),lF(r),ZO(r),r.uniforms.add([i.uniforms.get("localOrigin"),i.uniforms.get("view"),new Jt("ambient",s=>s.ambient),new Jt("diffuse",s=>s.diffuse),new Ie("opacity",s=>s.opacity),new Ie("layerOpacity",s=>s.layerOpacity)]),t.hasColorTexture&&r.uniforms.add(new Dt("tex",s=>s.texture)),e.include(Vae,t),e.include(cce,t),r.include(BD),e.extensions.add("GL_OES_standard_derivatives"),Ey(r),r.code.add(S`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?S`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${t.hasColorTexture?S`
                vec4 texColor = texture2D(tex, ${t.hasColorTextureTransform?S`colorUV`:S`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:S`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${t.pbrMode===_t.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?S`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:S`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.snowCover?S`albedo = mix(albedo, vec3(1), 0.9);`:S``}
        ${S`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${t.pbrMode===_t.Normal||t.pbrMode===_t.Schematic?t.spherical?S`vec3 normalGround = normalize(vpos + localOrigin);`:S`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:S``}
        ${t.pbrMode===_t.Normal||t.pbrMode===_t.Schematic?S`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?S`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:S`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===At.Color?S`gl_FragColor = premultiplyAlpha(gl_FragColor);`:S``}
      }
    `)),e.include(Uke,t),e}const VRt=Object.freeze(Object.defineProperty({__proto__:null,build:URt},Symbol.toStringTag,{value:"Module"}));let Bke=class jke extends yce{initializeConfiguration(e,i){super.initializeConfiguration(e,i),i.hasMetallicRoughnessTexture=!1,i.hasEmissionTexture=!1,i.hasOcclusionTexture=!1,i.hasNormalTexture=!1,i.hasModelTransformation=!1,i.normalType=hr.Attribute,i.doubleSidedMode=Cn.WindingOrder,i.hasVertexTangents=!1}initializeProgram(e){return this._initializeProgram(e,jke.shader)}};Bke.shader=new Gi(VRt,()=>Q(()=>import("./RealisticTree.glsl-d51a452b.js"),[]));let F_=class extends Bw{constructor(e){super(e,jRt),this.supportsEdges=!0,this._configuration=new ti,this._vertexBufferLayout=GRt(this.parameters)}isVisibleForOutput(e){return e!==z.Shadow&&e!==z.ShadowExcludeHighlight&&e!==z.ShadowHighlight||this.parameters.castShadows}isVisible(){const e=this.parameters;if(!super.isVisible()||e.layerOpacity===0)return!1;const{instanced:i,hasVertexColors:r,hasSymbolColors:n,vvColorEnabled:s}=e,o=v(i)&&i.includes("color"),a=e.colorMixMode==="replace",l=e.opacity>0,c=e.externalColor&&e.externalColor[3]>0;return r&&(o||s||n)?!!a||l:r?a?c:l:o||s||n?!!a||l:a?c:l}getConfiguration(e,i){return this._configuration.output=e,this._configuration.hasNormalTexture=!!this.parameters.normalTextureId,this._configuration.hasColorTexture=!!this.parameters.textureId,this._configuration.hasVertexTangents=this.parameters.hasVertexTangents,this._configuration.instanced=!!this.parameters.instanced,this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.hasVerticalOffset=v(this.parameters.verticalOffset),this._configuration.hasScreenSizePerspective=v(this.parameters.screenSizePerspective),this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight,this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode,this._configuration.normalType=this.parameters.normalType,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,v(this.parameters.customDepthTest)&&(this._configuration.customDepthTest=this.parameters.customDepthTest),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.cullFace=this.parameters.hasSlicePlane?Dr.None:this.parameters.cullFace,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.hasModelTransformation=v(this.parameters.modelTransformation),e!==z.Color&&e!==z.Alpha||(this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this._configuration.doubleSidedMode=Cn.WindingOrder:this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Cn.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Cn.WindingOrder:Cn.None,this._configuration.instancedColor=v(this.parameters.instanced)&&this.parameters.instanced.includes("color"),this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=!!i.ssaoHelper.active&&this.parameters.receiveSSAO,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?_t.Schematic:_t.Normal:_t.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<E7,this._configuration.snowCover=this.hasSnowCover(i),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix),this._configuration}hasSnowCover(e){return v(e.weather)&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}intersect(e,i,r,n,s,o){if(v(this.parameters.verticalOffset)){const a=r.camera;he(eW,i[12],i[13],i[14]);let l=null;switch(r.viewingMode){case qe.Global:l=we(_ve,eW);break;case qe.Local:l=ce(_ve,WRt)}let c=0;const h=ge(XRt,eW,a.eye),p=Pe(h),f=le(h,h,1/p);let m=null;this.parameters.screenSizePerspective&&(m=be(l,f)),c+=w4e(a,p,this.parameters.verticalOffset,m??0,this.parameters.screenSizePerspective),le(l,l,c),Wl(Qq,l,r.transform.inverseRotation),n=ge(HRt,n,Qq),s=ge(qRt,s,Qq)}y4e(e,r,n,s,lte(r.verticalOffset),o)}requiresSlot(e,i){return i===z.Color||i===z.Alpha||i===z.Depth||i===z.Normal||i===z.Shadow||i===z.ShadowHighlight||i===z.ShadowExcludeHighlight||i===z.Highlight||i===z.ObjectAndLayerIdColor?e===(this.parameters.transparent?this.parameters.writeDepth?Ee.TRANSPARENT_MATERIAL:Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:Ee.OPAQUE_MATERIAL)||e===Ee.DRAPED_MATERIAL:!1}createGLMaterial(e){return new zRt(e)}createBufferWriter(){return new YO(this._vertexBufferLayout)}},zRt=class extends Uae{constructor(e){super({...e,...e.material.parameters})}_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:e.shadowMap.enabled})}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==z.Color&&this._output!==z.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e));const i=this._material.parameters;this.updateTexture(i.textureId);const r=e.camera.viewInverseTransposeMatrix;return he(i.origin,r[3],r[7],r[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(i.treeRendering?Bke:yce,e)}},BRt=class extends NRt{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}};const jRt=new BRt;function GRt(t){const e=_n().vec3f(M.POSITION).vec3f(M.NORMAL),i=t.textureId||t.normalTextureId||t.metallicRoughnessTextureId||t.emissiveTextureId||t.occlusionTextureId;return t.hasVertexTangents&&e.vec4f(M.TANGENT),i&&e.vec2f(M.UV0),t.hasVertexColors&&e.vec4u8(M.COLOR),t.hasSymbolColors&&e.vec4u8(M.SYMBOLCOLOR),ue("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(M.OBJECTANDLAYERIDCOLOR),e}const HRt=P(),qRt=P(),WRt=Ue(0,0,1),_ve=P(),Qq=P(),eW=P(),XRt=P(),YRt=["polygon","extent"];let ZRt=class extends My{constructor(e,i,r,n){super(e,i,r,n),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const a=R7(this._getSymbolSize());if(a)throw new H("graphics3dextrudesymbollayer:invalid-size",a)}const e=Js(this.symbolLayer,"material","color"),i=this._getCombinedOpacityAndColor(e),r=Fc(i),n=i[3],s=n<1||this.needsDrivenTransparentPass,o={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:r,ambient:r,opacity:n,transparent:s,cullFace:s?Dr.None:Dr.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0};this._material=new F_(o),this._bottomMaterial=new F_({...o,cullFace:Dr.Back}),this._context.stage.add(this._material),this._context.stage.add(this._bottomMaterial)}destroy(){super.destroy(),this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,YRt,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(e.renderingInfo,255),n=this.setGraphicElevationContext(i,new Om);return this._createAs3DShape(i,e.renderingInfo,r,n,i.uid)}layerOpacityChanged(e,i){const r=Js(this.symbolLayer,"material","color"),n=this._getCombinedOpacity(r),s=n<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:n,transparent:s}),this._bottomMaterial.setParameters({opacity:n,transparent:s});const o=this._getLayerOpacity();e.forEach(a=>{const l=i(a);v(l)&&l.layerOpacityChanged(o,this._context.isAsync)})}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,Tw)}slicePlaneEnabledChanged(e,i){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._bottomMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),e.forEach(r=>{const n=i(r);v(n)&&n.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_getExtrusionSize(e){let i;return i=e.size&&this._drivenProperties.size?OCt(e.size,2)??0:this._getSymbolSize(),i/=this._context.renderCoordsHelper.unitInMeters,i}applyRendererDiff(e,i){return this._drivenPropertiesChanged(i)?Ks.Recreate_Symbol:Ks.Recreate_Graphics}async queryForSnapping(e,i,r,n){const s=this._getExtrusionSize(r)*this._context.renderCoordsHelper.unitInMeters/r2(i),{objectId:o,target:a}=e,l=se(a);switch(l.z=(l.z??0)+s,e.type){case"edge":{const{start:c,end:h}=e,p=se(c),f=se(h);return p.z=(p.z??0)+s,f.z=(f.z??0)+s,[U_e(o,l,1/0,p,f)]}case"vertex":return[ACt(o,l,1/0),U_e(o,a,1/0,a,l)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(e,i,r,n,s){const o=UD(e.geometry);if(R(o))return null;if(o.rings.length===0||!o.rings.some(ee=>ee.length>0))return this._logGeometryValidationWarnings(o.rings,"rings","ExtrudeSymbol3DLayer"),null;const a=mce(o,this._context.elevationProvider,this._context.renderCoordsHelper,n);this._logGeometryCreationWarnings(a,o.rings,"rings","ExtrudeSymbol3DLayer");const l=qle(o);if(R(l))return null;const c=new Array,h=to(),p=$e(),f=P(),m=this._context.renderCoordsHelper.viewingMode===qe.Global;m||this._context.renderCoordsHelper.worldUpAtPosition(null,f),ym(o.spatialReference,[l.x,l.y,0],p,this._context.renderCoordsHelper.spatialReference);const g=$e();wa(g,p);const _=wr();jM(_,g);const{polygons:b,mapPositions:w,position:x}=a,T=x.length/3,E=new Float64Array(3*T*6),C=new Float64Array(3*T*6),A=new Float64Array(3*T*6),I=new Float64Array(1*T*6);let O=0;for(let ee=0;ee<b.length;++ee){const ie=b[ee],J=ie.count;if(this._context.clippingExtent&&(Br(h),Kh(h,ie.mapPositions),!Zf(h,this._context.clippingExtent)))continue;const q=Sw(ie.mapPositions,ie.holeIndices,3);if(q.length===0)continue;const N=3*J*2+q.length,L=new Array(N),F=new Array(q.length),G=6*J,W=3*E.BYTES_PER_ELEMENT,Z=new _l(E.buffer,O*W,W,(O+G)*W),X=3*C.BYTES_PER_ELEMENT,oe=new _l(C.buffer,O*X,X,(O+G)*X),pe=new Float64Array(A.buffer,3*O*A.BYTES_PER_ELEMENT,3*G),ye=new Float64Array(I.buffer,1*O*I.BYTES_PER_ELEMENT,1*G),Se=this._getExtrusionSize(i);JRt(x,w,q,ie,Z.typedBuffer,pe,oe.typedBuffer,ye,L,F,Se,f,m),rF(Z,Z,g),Ew(oe,oe,_),O+=6*J;const He=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:this._context.layer.uid}),De=new iMt(Z.typedBuffer,pe,oe.typedBuffer,ye);c.push(vve(this._material,L,L.length-F.length,De,r,He)),c.push(vve(this._bottomMaterial,F,0,De,r,He))}if(c.length===0)return null;const D=new iv({geometries:c,metadata:{layerUid:this._context.layer.uid,graphicUid:s,isElevationSource:!0}});D.transformation=p;const U=R5e(this.symbolLayer,{opacity:this._getLayerOpacity()}),V=v(U)?{baseMaterial:this._material,edgeMaterials:[U],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,B=new Ry(this,D,c,null,null,eMt,n,V);return B.alignedSampledElevation=a.sampledElevation,B.needsElevationUpdates=Tw(n.mode),B}};function vve(t,e,i,r,n,s){const o=new Array(e.length).fill(0),a=[[M.POSITION,new Qe(r.positions,3,!0)],[M.NORMAL,new Qe(r.normals,3,!0)],[M.COLOR,new Qe(n,4,!0)],[M.SIZE,new Qe(r.heights,1,!0)]],l=[[M.POSITION,e],[M.NORMAL,e],[M.COLOR,o]];return new Os(t,a,l,r.elevation,Zn.Mesh,s,i)}function JRt(t,e,i,r,n,s,o,a,l,c,h,p,f){const m=i.length/3;let g=0,_=2*r.count;KRt(t,e,r.index,r.count,i,0,m,n,s,o,a,l,c,_,h,p,f);let b=2*r.count;_=0,bve(n,s,a,o,g,r.pathLengths[0],r.count,b,l,_,h),b+=4*r.pathLengths[0],_+=2*r.pathLengths[0],g+=r.pathLengths[0];for(let w=1;w<r.pathLengths.length;++w)bve(n,s,a,o,g,r.pathLengths[w],r.count,b,l,_,h),b+=4*r.pathLengths[w],_+=2*r.pathLengths[w],g+=r.pathLengths[w]}function KRt(t,e,i,r,n,s,o,a,l,c,h,p,f,m,g,_,b){ce(gc,_);const w=g>0?1:-1;let x=3*i,T=0,E=3*T,C=r,A=3*C;for(let D=0;D<r;++D)b&&(gc[0]=t[x+0],gc[1]=t[x+1],gc[2]=t[x+2],we(gc,gc)),a[E+0]=t[x+0],a[E+1]=t[x+1],a[E+2]=t[x+2],l[E+0]=e[x+0],l[E+1]=e[x+1],l[E+2]=e[x+2],c[E+0]=-w*gc[0],c[E+1]=-w*gc[1],c[E+2]=-w*gc[2],h[T]=0,a[A+0]=t[x+0]+g*gc[0],a[A+1]=t[x+1]+g*gc[1],a[A+2]=t[x+2]+g*gc[2],l[A+0]=e[x+0],l[A+1]=e[x+1],l[A+2]=e[x+2],c[A+0]=w*gc[0],c[A+1]=w*gc[1],c[A+2]=w*gc[2],h[C]=g,E+=3,A+=3,x+=3,T+=1,C+=1;x=3*s,E=0,A=3*m;const I=g<0?Cve:Eve,O=g<0?Eve:Cve;for(let D=0;D<o;++D)f[E+0]=n[x+I[0]],f[E+1]=n[x+I[1]],f[E+2]=n[x+I[2]],p[A+0]=n[x+O[0]]+r,p[A+1]=n[x+O[1]]+r,p[A+2]=n[x+O[2]]+r,E+=3,A+=3,x+=3}function j5(t,e,i,r,n,s,o){r[s]=r[o],o*=3,t[(s*=3)+0]=t[o+0],t[s+1]=t[o+1],t[s+2]=t[o+2],e[s+0]=e[o+0],e[s+1]=e[o+1],e[s+2]=e[o+2],i[s+0]=n[0],i[s+1]=n[1],i[s+2]=n[2]}const Z3=P();function bve(t,e,i,r,n,s,o,a,l,c,h){let p=n,f=n+1,m=n+o,g=n+o+1,_=a,b=a+1,w=a+2*s,x=a+2*s+1;h<0&&(p=n+o+1,g=n),c*=3;for(let T=0;T<s;++T)T===s-1&&(h>0?(f=n,g=n+o):(f=n,p=n+o)),QRt(t,p,f,m,Z3),j5(t,e,r,i,Z3,_,p),j5(t,e,r,i,Z3,b,f),j5(t,e,r,i,Z3,w,m),j5(t,e,r,i,Z3,x,g),l[c++]=_,l[c++]=w,l[c++]=x,l[c++]=_,l[c++]=x,l[c++]=b,p++,f++,m++,g++,_+=2,b+=2,w+=2,x+=2}const tW=P(),wve=P(),xve=P(),Tve=P(),Sve=P();function QRt(t,e,i,r,n){e*=3,i*=3,r*=3,he(tW,t[e++],t[e++],t[e++]),he(wve,t[i++],t[i++],t[i++]),he(xve,t[r++],t[r++],t[r++]),ge(Tve,wve,tW),ge(Sve,xve,tW),vt(n,Sve,Tve),we(n,n)}const GE=P();function eMt(t,e,i,r,n){const s=t.stageObject,o=s.geometries,a=o.length,l=e.mode!=="absolute-height";let c=0;const h=s.transformation,p=TO($e(),h);for(let f=0;f<a;f+=2){const m=o[f];if(!Xle(m))continue;const g=m.getMutableAttribute(M.POSITION).data,_=m.vertexAttributes.get(M.SIZE).data,b=new DFe(m.mapPositions),w=g.length/3;let x=0,T=!1,E=0;for(let C=0;C<w;C++){GE[0]=g[x],GE[1]=g[x+1],GE[2]=g[x+2],r(b,G5),l&&(E+=G5.sampledElevation),tr.TESTS_DISABLE_OPTIMIZATIONS?(he(ou,b.array[b.offset+0],b.array[b.offset+1],G5.z+_[x/3]),v(i)&&n.toRenderCoords(ou,i,ou),Ke(ou,ou,p)):(he(ou,g[x+0],g[x+1],g[x+2]),Ke(ou,ou,h),n.setAltitude(ou,G5.z+_[x/3]),Ke(ou,ou,p)),g[x]=ou[0],g[x+1]=ou[1],g[x+2]=ou[2];const A=tMt/n.unitInMeters;(Math.abs(GE[0]-g[x])>=A||Math.abs(GE[1]-g[x+1])>=A||Math.abs(GE[2]-g[x+2])>=A)&&(T=!0),b.offset+=3,x+=3}T&&(m.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(o[f]),o[f+1].invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(o[f+1])),c+=E/w}return c/a}const ou=P(),gc=P(),G5=new iF,Eve=[0,2,1],Cve=[0,1,2],tMt=.01;let iMt=class{constructor(e,i,r,n){this.positions=e,this.elevation=i,this.normals=r,this.heights=n}};function rMt(t,e,i,r,n){if(R(t))return null;const s=t.referencesGeometry()&&n?nMt(e,r,n):e,o=t.repurposeFeature(s);try{return t.evaluate({...i,$feature:o})}catch(a){return re.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}}const iW=new Map;function nMt(t,e,i){const{transform:r,hasZ:n,hasM:s}=i;iW.has(e)||iW.set(e,sMt(e));const o=iW.get(e)(t.geometry,r,n,s);return{...t,geometry:o}}function sMt(t){const e={};switch(t){case"esriGeometryPoint":return(i,r,n,s)=>r5e(r,e,i,n,s);case"esriGeometryPolygon":return(i,r,n,s)=>n5e(r,e,i,n,s);case"esriGeometryPolyline":return(i,r,n,s)=>s5e(r,e,i,n,s);case"esriGeometryMultipoint":return(i,r,n,s)=>i5e(r,e,i,n,s);default:return re.getLogger("esri.views.2d.support.arcadeOnDemand").error(new H("mapview-arcade",`Unable to handle geometryType: ${t}`)),i=>i}}const xJt=1.2,oMt=Qg;let D7=class{constructor(e,i,r,n){this.graphics3DSymbolLayer=e,this.renderGeometries=i,this.boundingBox=r,this._drapeSourceRenderer=n,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(e){this.stage=e}setVisibility(e){if(this.stage!=null&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,wn.ADD);if(e||this._addedToStage){for(const i of this.renderGeometries)i.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,co.VISIBILITY)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,wn.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(e=P()){return he(e,0,0,0)}getBoundingBoxObjectSpace(e=to()){return Br(e)}addObjectState(e,i){e===$_.Highlight&&(this.renderGeometries.forEach(r=>{const n=r.geometry.addHighlight();i.addRenderGeometry(r,n,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,co.HIGHLIGHT))}removeObjectState(e){this.renderGeometries.forEach(i=>{e.removeRenderGeometry(i)})}removeRenderGeometryObjectState(e,i){e.geometry.removeHighlight(i),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,co.HIGHLIGHT)}computeAttachmentOrigin(e){for(const i of this.renderGeometries)i.geometry.computeAttachmentOrigin(HE)&&(e.draped.origin[0]+=HE[0],e.draped.origin[1]+=HE[1],e.draped.num++)}async getProjectedBoundingBox(e,i,r,n,s){Br(s);for(let o=0;o<this.renderGeometries.length;o++){const a=this.renderGeometries[o];this._getRenderGeometryProjectedBoundingRect(a,e,Ave,r),vWe(s,Ave)}if(i){let o;Yf(s,HE);const a=Wle(s,i.service.spatialReference,i);try{o=await i.service.queryElevation(HE[0],HE[1],n,a,"ground")}catch{}v(o)&&(s[2]=Math.min(s[2],o),s[5]=Math.max(s[5],o))}return s}_getRenderGeometryProjectedBoundingRect(e,i,r,n){if(this.boundingBox)X9(Bm,this.boundingBox);else{const s=e.boundingSphere,o=s[3];Bm[0]=s[0]-o,Bm[1]=s[1]-o,Bm[2]=s[2]-o,Bm[3]=s[0]+o,Bm[4]=s[1]+o,Bm[5]=s[2]+o}return i(Bm,0,2),this.calculateRelativeScreenBounds&&n.push({location:Yf(Bm),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),Une(Bm,r)}};const Ave=Kt(),Bm=to(),HE=P();let Gke=class{constructor(e,i,r,n=2048){this.text=e,this._alignment=i,this._parameters=r,this._maxSize=n,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${e}`,this._lines=e.split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._backgroundHorizontalPadding)}get displayHeight(){const e=this._lineSpacing*(this._lines.length-1),i=this._lineHeight;return Math.ceil(e+i+2*this._haloSize+this._backgroundTopPadding+this._backgroundBottomPadding)}get renderedWidth(){return Math.ceil(this._toRenderUnit(this.displayWidth))}get renderedHeight(){return Math.ceil(this._toRenderUnit(this.displayHeight))}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._baselinePosition)}get _firstLineYOffset(){return this._backgroundTopPadding+this._haloSize}get _metrics(){if(R(this._metricsCached)){const e=Nte(Rve,H5,H5).getContext("2d");this._setFontProperties(e,this._fontSize);let i=2*this._haloSize;const r=this._parameters.definition.font;r.style!=="italic"&&r.style!=="oblique"&&r.weight!=="bold"&&r.weight!=="bolder"||(i+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let n,s,o=0,a=0,l=0;this._lines.forEach((g,_)=>{const b=e.measureText(g),w=b.width,x=w+i;this._textWidths.push(w),this._lineWidths.push(x),o=Math.max(o,x),a=Math.max(a,b.actualBoundingBoxAscent),l=Math.max(l,b.actualBoundingBoxDescent),_===0&&(n=b),_===this._lines.length-1&&(s=b)});const c=e.font;let h=Ove.get(c);if(!h){const g=e.measureText(lMt);h=new uMt(g.actualBoundingBoxAscent,g.actualBoundingBoxDescent),Ove.set(c,h)}a=Math.max(a,h.actualBoundingBoxAscent),l=Math.max(l,h.actualBoundingBoxDescent);const p=a+l,f=this._hasBackground?n.actualBoundingBoxAscent:a,m=this._hasBackground?s.actualBoundingBoxDescent:l;this._metricsCached=new cMt(a-f,l-m,p,o,a)}return this._metricsCached}get _lineSpacing(){return(this._lineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _lineHeight(){return this._metrics.lineHeight}get _linePadding(){return this._lineHeight*aMt}get _baselinePosition(){return this._metrics.baselinePosition}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _backgroundHorizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _backgroundVerticalPadding(){return this._hasBackground?this._parameters.definition.background.padding[1]:0}get _backgroundTopPadding(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingTop)}get _backgroundBottomPadding(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingBottom)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(R(this._renderPixelRatio)){const e=this._parameters.definition.pixelRatio;this._maxSize>0?this._renderPixelRatio=Math.min(e,Math.min(this._maxSize/this.displayWidth,this._maxSize/this.displayHeight)):this._renderPixelRatio=e}return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case Wb.Left:return this._backgroundHorizontalPadding;case Wb.Center:return(this.displayWidth-this._lineWidths[e])/2;case Wb.Right:return this.displayWidth-this._backgroundHorizontalPadding-this._lineWidths[e]}}render(e,i=0,r=0){e.save();const n=i/=this.renderPixelRatio,s=r/=this.renderPixelRatio,o=this._haloSize,a=this._firstLineYOffset;i+=o,r+=a+this._baselinePosition;const l=this._haloSize>0;l&&this._renderHalo(e,n,s,o,a),this._setFontProperties(e,this._renderedFontSize);for(let c=0;c<this._lines.length;++c){const h=this._lines[c],p=this._getLineXOffset(c);l&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,h,i+p,r),this._renderLineDecoration(e,i+p,r,this._textWidths[c])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,h,i+this._getLineXOffset(c),r),this._renderLineDecoration(e,i+p,r,this._textWidths[c]),r+=this._lineSpacing}if(tr.TEXT_SHOW_BASELINE){e.strokeStyle=Mve,e.setLineDash([2,2]),e.lineWidth=1;let c=s+a;for(let h=0;h<this._lines.length;++h){const p=c+this._baselinePosition;this._drawLine(e,[n,p],[n+this.displayWidth,p]),c+=this._lineSpacing}}if(tr.TEXT_SHOW_BORDER&&(e.strokeStyle=Mve,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[n,s],[this.displayWidth,this.displayHeight])),this._hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,n,s,c),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,i,r,n,s=!1){if(this._parameters.definition.font.decoration==="none"||n===0)return;const o=1,a=Math.max(this._parameters.definition.size/16,o);switch(this._parameters.definition.font.decoration){case"underline":r+=2*a;break;case"line-through":r-=.33*this._baselinePosition}const l=s?this._haloSize:0;e.strokeStyle=s?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(a+2*l),e.beginPath(),e.moveTo(this._toRenderUnit(i-l),this._toRenderUnit(r)),e.lineTo(this._toRenderUnit(i+n+l),this._toRenderUnit(r)),e.stroke()}_roundedRect(e,i,r,n){i=this._toRenderUnit(i),r=this._toRenderUnit(r);const s=this.renderedWidth,o=this.renderedHeight;n!==0?(n=_e(n,0,Math.floor(o/2)),e.beginPath(),e.moveTo(i,r+n),e.arcTo(i,r,i+n,r,n),e.lineTo(i+s-n,r),e.arcTo(i+s,r,i+s,r+n,n),e.lineTo(i+s,r+o-n),e.arcTo(i+s,r+o,i+s-n,r+o,n),e.lineTo(i+n,r+o),e.arcTo(i,r+o,i,r+o-n,n),e.closePath()):e.rect(i,r,s,o)}_renderHalo(e,i,r,n,s){const o=this.renderedWidth,a=this.renderedHeight,l=Nte(Rve,Math.max(o,H5),Math.max(a,H5)),c=l.getContext("2d");c.clearRect(0,0,o,a),this._setFontProperties(c,this._renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const h=this._renderedHaloSize<3;c.lineJoin=h?"miter":"round",h?this._renderHaloEmulated(c,n,s):this._renderHaloNative(c,n,s);let p=s+this._baselinePosition;for(let f=0;f<this._lines.length;++f){const m=this._getLineXOffset(f);this._renderLineDecoration(c,n+m,p,this._textWidths[f],!0),p+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(l,0,0,o,a,this._toRenderUnit(i),this._toRenderUnit(r),o,a),e.globalAlpha=1}_renderHaloEmulated(e,i,r){r+=this._baselinePosition;for(let n=0;n<this._lines.length;++n){const s=this._lines[n],o=this._getLineXOffset(n);for(const[a,l]of Hke)this._fillText(e,s,i+o+this._haloSize*a,r+this._haloSize*l);r+=this._lineSpacing}}_renderHaloNative(e,i,r){const n=2*this._haloSize;r+=this._baselinePosition;for(let s=0;s<this._lines.length;++s){const o=this._lines[s],a=this._getLineXOffset(s),l=5,c=.1;for(let h=0;h<l;h++){const p=1-(l-1)*c+h*c;e.lineWidth=this._toRenderUnit(p*n),this._strokeText(e,o,i+a,r)}r+=this._lineSpacing}}_setFontProperties(e,i){e.font=this._parameters.fontString(i),e.textAlign="left",e.textBaseline="alphabetic"}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,i,r,n){e.fillText(i,this._toRenderUnit(r),this._toRenderUnit(n))}_strokeText(e,i,r,n){e.strokeText(i,this._toRenderUnit(r),this._toRenderUnit(n))}_drawLine(e,i,r){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),e.lineTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),e.stroke()}_drawBox(e,i,r){const n=this._toRenderUnit(i[0]),s=this._toRenderUnit(i[1]),o=this._toRenderUnit(r[0]),a=this._toRenderUnit(r[1]),l=Math.floor(n)+.5,c=Math.ceil(n+o)-.5,h=Math.floor(s)+.5,p=Math.ceil(s+a)-.5;e.beginPath(),e.moveTo(l,h),e.lineTo(c,h),e.lineTo(c,p),e.lineTo(l,p),e.lineTo(l,h),e.stroke()}};const Hke=[];for(let e=0;e<360;e+=360/16)Hke.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);var Wb;function Nte(t,e,i){return t.canvas||(t.canvas=document.createElement("canvas")),t.canvas.width=e,t.canvas.height=i,t.canvas}(function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"})(Wb||(Wb={}));const Rve={canvas:null},aMt=.2,H5=512,Mve="rgb(255, 0, 255, 0.5)",lMt=(()=>{let t="";for(let e=32;e<127;e++)t+=String.fromCharCode(e);return t})();let cMt=class{constructor(e,i,r,n,s){this.paddingTop=e,this.paddingBottom=i,this.lineHeight=r,this.displayWidth=n,this.baselinePosition=s}},uMt=class{constructor(e,i){this.actualBoundingBoxAscent=e,this.actualBoundingBoxDescent=i}};const Ove=new Map,hMt=Object.freeze({left:0,center:.5,right:1}),BU=Object.freeze({"bottom-left":Mi(0,0),bottom:Mi(.5,0),"bottom-right":Mi(1,0),left:Mi(0,.5),center:Mi(.5,.5),right:Mi(1,.5),"top-left":Mi(0,1),top:Mi(.5,1),"top-right":Mi(1,1)});function qke(t){switch(t){case"left":return Wb.Left;case"right":return Wb.Right;default:return Wb.Center}}function Pve(t){switch(t){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function dMt(t){switch(t){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function pMt(t,e){switch(e){case"bottom":return t==="left"?"bottom-left":t==="right"?"bottom-right":"bottom";case"center":return t;case"top":return t==="left"?"top-left":t==="right"?"top-right":"top"}}function fMt(t){return t==="middle"?"center":t}var ol,Ive;function J3(t){return t!=null}function qE(t){return typeof t=="number"}function N7(t){return typeof t=="string"}function mMt(t){return t==null||N7(t)}function Ys(t,e){t&&t.push(e)}function gMt(t,e,i,r=$e()){const n=t||0,s=e||0,o=i||0;return n!==0&&RM(r,r,-n/180*Math.PI),s!==0&&AM(r,r,s/180*Math.PI),o!==0&&nB(r,r,o/180*Math.PI),r}function Dv(t,e,i,r,n){const s=t.minSize,o=t.maxSize;if(t.expression)return Ys(n,"Could not convert size info: expression not supported"),!1;if(t.useSymbolValue){const a=r.symbolSize[i];return e.minSize[i]=a,e.maxSize[i]=a,e.offset[i]=e.minSize[i],e.factor[i]=0,e.type[i]=ol.DefinedSize,!0}if(J3(t.field))return J3(t.stops)?t.stops.length===2&&qE(t.stops[0].size)&&qE(t.stops[1].size)?($ve(t.stops[0].size,t.stops[1].size,t.stops[0].value,t.stops[1].value,e,i),e.type[i]=ol.DefinedSize,!0):(Ys(n,"Could not convert size info: stops only supported with 2 elements"),!1):qE(s)&&qE(o)&&J3(t.minDataValue)&&J3(t.maxDataValue)?($ve(s,o,t.minDataValue,t.maxDataValue,e,i),e.type[i]=ol.DefinedSize,!0):LM[t.valueUnit]!=null?(e.minSize[i]=-1/0,e.maxSize[i]=1/0,e.offset[i]=0,e.factor[i]=1/LM[t.valueUnit],e.type[i]=ol.DefinedSize,!0):t.valueUnit==="unknown"?(Ys(n,"Could not convert size info: proportional size not supported"),!1):(Ys(n,"Could not convert size info: scale-dependent size not supported"),!1);if(!J3(t.field)){if(t.stops&&t.stops[0]&&qE(t.stops[0].size))return e.minSize[i]=t.stops[0].size,e.maxSize[i]=t.stops[0].size,e.offset[i]=e.minSize[i],e.factor[i]=0,e.type[i]=ol.DefinedSize,!0;if(qE(s))return e.minSize[i]=s,e.maxSize[i]=s,e.offset[i]=s,e.factor[i]=0,e.type[i]=ol.DefinedSize,!0}return Ys(n,"Could not convert size info: unsupported variant of sizeInfo"),!1}function $ve(t,e,i,r,n,s){const o=Math.abs(r-i)>0?(e-t)/(r-i):0;n.minSize[s]=o>0?t:e,n.maxSize[s]=o>0?e:t,n.offset[s]=t-i*o,n.factor[s]=o}function yMt(t,e,i,r){if(t.normalizationField||t.valueRepresentation)return Ys(r,"Could not convert size info: unsupported property"),null;if(!mMt(t.field))return Ys(r,"Could not convert size info: field is not a string"),null;if(e.size){if(t.field)if(e.size.field){if(t.field!==e.size.field)return Ys(r,"Could not convert size info: multiple fields in use"),null}else e.size.field=t.field}else e.size={field:t.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[ol.Undefined,ol.Undefined,ol.Undefined]};let n;switch(t.axis){case"width":return n=Dv(t,e.size,0,i,r),n?e:null;case"height":return n=Dv(t,e.size,2,i,r),n?e:null;case"depth":return n=Dv(t,e.size,1,i,r),n?e:null;case"width-and-depth":return n=Dv(t,e.size,0,i,r),n&&Dv(t,e.size,1,i,r),n?e:null;case null:case void 0:case"all":return n=Dv(t,e.size,0,i,r),n=n&&Dv(t,e.size,1,i,r),n=n&&Dv(t,e.size,2,i,r),n?e:null;default:return Ys(r,`Could not convert size info: unknown axis "${t.axis}""`),null}}function _Mt(t,e,i){for(let n=0;n<3;++n){let s=e.unitInMeters;t.type[n]===ol.DefinedSize&&(s*=e.modelSize[n],t.type[n]=ol.DefinedScale),t.minSize[n]=t.minSize[n]/s,t.maxSize[n]=t.maxSize[n]/s,t.offset[n]=t.offset[n]/s,t.factor[n]=t.factor[n]/s}let r;if(t.type[0]!==ol.Undefined)r=0;else if(t.type[1]!==ol.Undefined)r=1;else{if(t.type[2]===ol.Undefined)return Ys(i,"No size axis contains a valid size or scale"),!1;r=2}for(let n=0;n<3;++n)t.type[n]===ol.Undefined&&(t.minSize[n]=t.minSize[r],t.maxSize[n]=t.maxSize[r],t.offset[n]=t.offset[r],t.factor[n]=t.factor[r],t.type[n]=t.type[r]);return!0}function Lve(t,e,i){t[4*e+0]=i.r/255,t[4*e+1]=i.g/255,t[4*e+2]=i.b/255,t[4*e+3]=i.a}function vMt(t,e,i){if(t.normalizationField)return Ys(i,"Could not convert color info: unsupported property"),null;if(N7(t.field)){if(!t.stops)return Ys(i,"Could not convert color info: missing stops or colors"),null;{if(t.stops.length>8)return Ys(i,"Could not convert color info: too many color stops"),null;e.color={field:t.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};const r=t.stops;for(let n=0;n<8;++n){const s=r[Math.min(n,r.length-1)];e.color.values[n]=s.value,Lve(e.color.colors,n,s.color)}}}else{if(!(t.stops&&t.stops.length>=0))return Ys(i,"Could not convert color info: no field and no colors/stops"),null;{const r=t.stops&&t.stops.length>=0&&t.stops[0].color;e.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let n=0;n<8;n++)e.color.values[n]=1/0,Lve(e.color.colors,n,r)}}return e}function bMt(t,e,i){if(t.normalizationField)return Ys(i,"Could not convert opacity info: unsupported property"),null;if(N7(t.field)){if(!t.stops)return Ys(i,"Could not convert opacity info: missing stops or opacities"),null;{if(t.stops.length>8)return Ys(i,"Could not convert opacity info: too many opacity stops"),null;e.opacity={field:t.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};const r=t.stops;for(let n=0;n<8;++n){const s=r[Math.min(n,r.length-1)];e.opacity.values[n]=s.value,e.opacity.opacityValues[n]=s.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return Ys(i,"Could not convert opacity info: no field and no opacities/stops"),null;{const r=t.stops&&t.stops.length>=0?t.stops[0].opacity:0;e.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let n=0;n<8;n++)e.opacity.values[n]=1/0,e.opacity.opacityValues[n]=r}}return e}function rW(t,e,i){const r=i===2&&t.rotationType==="arithmetic";e.offset[i]=r?90:0,e.factor[i]=r?-1:1,e.type[i]=1}function wMt(t,e,i){if(!N7(t.field))return Ys(i,"Could not convert rotation info: field is not a string"),null;if(e.rotation){if(t.field)if(e.rotation.field){if(t.field!==e.rotation.field)return Ys(i,"Could not convert rotation info: multiple fields in use"),null}else e.rotation.field=t.field}else e.rotation={field:t.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(t.axis){case"tilt":return rW(t,e.rotation,0),e;case"roll":return rW(t,e.rotation,1),e;case null:case void 0:case"heading":return rW(t,e.rotation,2),e;default:return Ys(i,`Could not convert rotation info: unknown axis "${t.axis}""`),null}}function Wke(t,e,i){if(!t)return null;const r=!e.supportedTypes||!!e.supportedTypes.size,n=!e.supportedTypes||!!e.supportedTypes.color,s=!e.supportedTypes||!!e.supportedTypes.rotation,o=!!e.supportedTypes&&!!e.supportedTypes.opacity,a=t.reduce((l,c)=>{if(!l)return l;if(c.valueExpression)return Ys(i,"Could not convert visual variables: arcade expressions not supported"),null;switch(c.type){case"size":return r?yMt(c,l,e,i):l;case"color":return n?vMt(c,l,i):l;case"opacity":return o?bMt(c,l,i):null;case"rotation":return s?wMt(c,l,i):l;default:return null}},{size:null,color:null,opacity:null,rotation:null});return!(t.length>0&&a)||a.size||a.color||a.opacity||a.rotation?a&&a.size&&!_Mt(a.size,e,i)?null:a:null}function _ce(t){return t&&t.size!=null}function jD(t,e){if(!t)return{enabled:!1};if(tr.TESTS_DISABLE_FAST_UPDATES)return{enabled:!1};const i=Wke(t.visualVariables,e);return i?{enabled:!0,visualVariables:i,materialParameters:Xke(i,e),requiresShaderTransformation:_ce(i)}:{enabled:!1}}function GD(t,e,i){if(!e||!t.enabled)return!1;const r=t.visualVariables,n=Wke(e.visualVariables,i);return!!n&&!!(q5(r.size,n.size,"size")&&q5(r.color,n.color,"color")&&q5(r.rotation,n.rotation,"rotation")&&q5(r.opacity,n.opacity,"opacity"))&&(t.visualVariables=n,t.materialParameters=Xke(n,i),t.requiresShaderTransformation=_ce(n),!0)}function q5(t,e,i){if(!!t!=!!e||t&&t.field!==e.field)return!1;if(t&&i==="rotation"){const r=t,n=e;for(let s=0;s<3;s++)if(r.type[s]!==n.type[s]||r.offset[s]!==n.offset[s]||r.factor[s]!==n.factor[s])return!1}return!0}function Xke(t,e){const i={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},r=_ce(t);return t&&t.size?(i.vvSizeEnabled=!0,i.vvSizeMinSize=t.size.minSize,i.vvSizeMaxSize=t.size.maxSize,i.vvSizeOffset=t.size.offset,i.vvSizeFactor=t.size.factor):t&&r&&(i.vvSizeValue=e.transformation.scale),t&&r&&(i.vvSymbolAnchor=e.transformation.anchor,i.vvSymbolRotationMatrix=wr(),Lp(sL),gMt(e.transformation.rotation[2],e.transformation.rotation[0],e.transformation.rotation[1],sL),Dp(i.vvSymbolRotationMatrix,sL)),t&&t.color&&(i.vvColorEnabled=!0,i.vvColorValues=t.color.values,i.vvColorColors=t.color.colors),t&&t.opacity&&(i.vvOpacityEnabled=!0,i.vvOpacityValues=t.opacity.values,i.vvOpacityOpacities=t.opacity.opacityValues),i}function Fte(t,e,i){if(!t.vvSizeEnabled)return i;go(Nv,i);const r=t.vvSymbolRotationMatrix;Sy(sL,r[0],r[1],r[2],0,r[3],r[4],r[5],0,r[6],r[7],r[8],0,0,0,0,1),$n(Nv,Nv,sL);for(let n=0;n<3;++n){const s=t.vvSizeOffset[n]+e[0]*t.vvSizeFactor[n];Dve[n]=_e(s,t.vvSizeMinSize[n],t.vvSizeMaxSize[n])}return rB(Nv,Nv,Dve),Yc(Nv,Nv,t.vvSymbolAnchor),Nv}function xMt(t,e,i){if(!e.vvSizeEnabled)return he(t,1,1,1);for(let r=0;r<3;++r){const n=e.vvSizeOffset[r]+i[0]*e.vvSizeFactor[r];t[r]=_e(n,e.vvSizeMinSize[r],e.vvSizeMaxSize[r])}return t}(function(t){t[t.Undefined=0]="Undefined",t[t.DefinedSize=1]="DefinedSize",t[t.DefinedScale=2]="DefinedScale"})(ol||(ol={})),function(t){t[t.Undefined=0]="Undefined",t[t.DefinedAngle=1]="DefinedAngle"}(Ive||(Ive={}));const Nv=$e(),Dve=P(),sL=$e();let nO=class{constructor(e,i={}){this.geometry=e,this.boundingSphere=pi(),this.screenToWorldRatio=1,this._transformation=$e(),this._shaderTransformationDirty=!0,this.id=qu(),this.layerUid=i.layerUid,this.graphicUid=i.graphicUid,this.boundingInfo=i.boundingInfo,this.shaderTransformer=i.shaderTransformer,this.castShadow=!!i.castShadow&&i.castShadow}get transformation(){return this._transformation}updateTransformation(e){e(this._transformation),this._shaderTransformationDirty=!0,this.computeBoundingSphere(this._transformation,this.boundingSphere)}shaderTransformationChanged(){this._shaderTransformationDirty=!0}computeBoundingSphere(e,i,r=v2(e)){R(this.boundingInfo)||(Ke(i,this.boundingInfo.center,e),i[3]=this.boundingInfo.radius*r)}get hasShaderTransformation(){return v(this.shaderTransformer)}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return R(this.shaderTransformer)?this.transformation:(this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=$e()),go(this._shaderTransformation,this.shaderTransformer(this.transformation)),this._shaderTransformationDirty=!1),this._shaderTransformation)}get indices(){return this.geometry.indices}get vertexAttributes(){return this.geometry.vertexAttributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}};const TMt=$e(),Nve=Ue(0,0,1),SMt=16,EMt=1.5,CS=jle,CMt=[CS/2,CS/2,1-CS/2,1-CS/2],AMt=[$D*CS,$D*CS];let kte=class Yke extends My{getCachedSize(){return{size:this._getIconSize()}}constructor(e,i,r,n){super(e,i,r,n),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}async doLoad(e){this._validateOrThrow();const i=this._prepareMaterialParameters(),r=this._getPrimitive();if(v(r))this._prepareResourcesPrimitive(i,r);else{const n=$tt(this.symbolLayer),s=vO(n);s&&s.mediaType==="application/json"?await this._prepareResourcesCIM(i,JSON.parse(s.data),e):await this._prepareResourcesHref(i,n,e)}}_validateOrThrow(){if(this._drivenProperties.size)return;const e=R7(this._getIconSize());if(e)throw new H("graphics3diconsymbollayer:invalid-size",e)}_getIconSize(){const e=this.symbolLayer,i=Math.round(e.size!=null?ga(e.size):SMt);return this._drivenProperties.size?Math.max(i,64):i}_generateTextureCIM(e){const i=this._getGraphicHash(e);let r=i===""?null:this._cimSymbolTextures.get(i);if(!r){const n={scaleFactor:this._cimScaleFactorOrFunction},s=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol3D(this._cimLayers,e,"esriGeometryPoint",n,void 0,void 0);this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",s.anchorPosition);const o={width:s.imageData.width,height:s.imageData.height,powerOfTwoResizeMode:jb.PAD};r=new Q2(s.imageData,o),this._cimSymbolTextures.set(i,r),this._context.stage.add(r)}return r}_computeSize(e,i){const r=e.width/e.height;return r>1?[i,Math.round(i/r)]:[Math.round(i*r),i]}_prepareMaterialParameters(){const e={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},i=this.symbol;if(RMt(i)){const{screenLength:r,minWorldLength:n,maxWorldLength:s}=i.verticalOffset;e.verticalOffset={screenLength:ga(r),minWorldLength:n||0,maxWorldLength:v(s)?s:1/0}}return this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),e.occlusionTest=!0,e.hasSlicePlane=this._context.slicePlaneEnabled,e}_prepareResourcesPrimitive(e,i){const r=this._getOutlineSize();if(nW(i)&&r===0)throw new Error("Nothing to render");if(this._outlineSize=r,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,v(this._context.sharedResources.textures)){const s=this._context.sharedResources.textures.fromData(`${i}-icon`,()=>L4e(i));this._texture=s.texture,this._releaseTexture=s,e.textureId=this._texture.id}e.textureIsSignedDistanceField=!0,e.distanceFieldBoundingBox=CMt;const n=this._getIconSize();this._size=[n,n],this._symbolTextureRatio=1/CS,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesHref(e,i,r){this._outlineSize=this._getOutlineSize(),e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,e.textureIsSignedDistanceField=!1;const n=this._getIconSize(),s=n*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;if(v(this._context.sharedResources.textures)){const o=await _m(this._context.sharedResources.textures.fromUrl(i,s,{signal:r}));if(o.ok===!1)throw Du(o.error),new H("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${i})`);this._releaseTexture=o.value;const a=o.value.texture,l=a.params;this._size=this._computeSize(l,n),e.textureId=a.id}this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesCIM(e,i,r){const n=new yO({data:i});if(!this._context.sharedResources.cimSymbolRasterizer){const h=(await Q(()=>import("./CIMSymbolRasterizer-bf912d31.js"),["assets/CIMSymbolRasterizer-bf912d31.js","assets/cimAnalyzer-163ac770.js","assets/BidiEngine-836b7ef6.js","assets/GeometryUtils-53652037.js","assets/enums-4b2a86a0.js","assets/alignmentUtils-ae955d28.js","assets/definitions-3ddd14a8.js","assets/number-b10bd8f5.js","assets/Rect-ea14f53a.js","assets/CIMResourceManager-5b9a3e6a.js","assets/Rasterizer-a13839c4.js","assets/_commonjsHelpers-2f3e7994.js","assets/rasterizingUtils-37f0f33e.js","assets/imageutils-58ee6580.js"])).CIMSymbolRasterizer;ui(r),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new h(this._context.renderCoordsHelper.spatialReference,!0))}const s=this._context.layer.fields?this._context.layer.fields.map(h=>h.toJSON()):null;let o,a;if(this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(n,s,this._context.renderer&&this._context.renderer.type==="dictionary"?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:r}),this._context.renderer&&this._context.renderer.type==="dictionary"&&this._context.renderer.scaleExpression){const h=this._context.renderer;if(isNaN(h.scaleExpression)){const p=h.scaleExpression,f=await mHe(p,this._context.layer.spatialReference,s);a=(m,g,_)=>{const b=rMt(f,m,{$view:_},"esriGeometryPoint",g);return b!==null?b:1}}else o=Number(h.scaleExpression)}this._cimScaleFactorOrFunction=o||a||1;const l=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];ui(r);const c=this._context.layer.fieldsIndex;this._cimRequiredFields=l.map(h=>c.get(h).name),this._cimMaterialParametersInfo=e,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||_Xe}_getOutlineSize(){let e=0;const i=this.symbolLayer;return v(i.outline)&&i.outline.size!=null?Math.max(ga(i.outline.size),0):(e=nW(this._getPrimitive())?EMt:0,Math.max(e,0))}_getOutlineColor(){const e=this._getLayerOpacity(),i=this.symbolLayer,r=Js(i,"outline","color");if(v(r)){const n=Xe.toUnitRGB(r),s=r.a*e;return[n[0],n[1],n[2],s]}return[0,0,0,0]}_getFillColor(){if(nW(this._getPrimitive()))return oMt;const e=R(this._getPrimitive()),i=Js(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(i,{hasIntrinsicColor:e})}_getAnchorPos(e,i){return e==="relative"?Mi((i.x||0)+.5,.5-(i.y||0)):e in BU?BU[e]:BU.center}_createMaterialAndAddToStage(e,i){if(this._cimLayers?this._fastUpdates={enabled:!1}:this._fastUpdates=jD(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled&&Object.assign(e,this._fastUpdates.materialParameters),this._cimLayers){let r=v(e.textureId)?this._cimSymbolMaterials.get(e.textureId):null;return r||(r=new iO(e),this._cimSymbolMaterials.set(Nt(e.textureId,0),r),i.add(r)),r}return this._material=new iO(e),i.add(this._material),this._material}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(e=>{e.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._material=null,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(e=>this._context.stage.remove(e)),this._cimSymbolTextures.clear(),this._releaseTexture=nn(this._releaseTexture)}_getScaleFactor(e,i){if(this._drivenProperties.size&&e.size){for(let r=0;r<3;r++){const n=e.size[r];n&&n!=="symbol-value"&&n!=="proportional"&&(e.size[r]=ga(n))}if(e.size[0]==="symbol-value")return 1;if(isFinite(+e.size[0]))return+e.size[0]/i;if(isFinite(+e.size[2]))return+e.size[2]/i}return 1}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry))return null;let r,n=[0,0];if(this._cimLayers){if(!this._cimLayers.length)return null;const p=this._generateTextureCIM(i),f={textureId:p.id,...this._cimMaterialParametersInfo};r=this._createMaterialAndAddToStage(f,this._context.stage),n=[p.params.width,p.params.height]}else n=this._size,r=this._material;const s=kD(i.geometry);if(R(s))return this.logger.warn(`unsupported geometry type for icon symbol: ${i.geometry.type}`),null;const o=e.renderingInfo,a=this._getVertexOpacityAndColor(o);let l=1;if(!this._fastUpdates.enabled||!this._fastUpdates.visualVariables.size){const p=n[0]>n[1]?n[0]:n[1];l=this._getScaleFactor(o,p)}l*=this._symbolTextureRatio;const c=Mi(n[0]*l,n[1]*l),h=this.setGraphicElevationContext(i,new Om);return this.ensureDrapedStatus(h.mode==="on-the-ground")&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(i,s,r,a,c,e.layer.uid):this._createAs3DShape(i,s,r,a,c,h,i.uid)}layerOpacityChanged(){const e=this._getFillColor(),i=this._getOutlineColor();this._forEachMaterial(r=>{r.setParameters({color:e}),r.setParameters({outlineColor:i})})}layerElevationInfoChanged(e,i,r){const n=this._elevationContext.mode,s=tF(Yke.elevationModeChangeTypes,r,n);if(s!==Ln.UPDATE)return s;const o=Up(n)||n==="absolute-height";return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(e=>{e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!!this._getPrimitive()}skipHighSymbolLodsChanged(){return!0}applyRendererDiff(e,i){for(const r in e.diff){if(r!=="visualVariables"||!GD(this._fastUpdates,i,this._fastVisualVariableConvertOptions()))return Ks.Recreate_Symbol;v(this._material)&&this._material.setParameters(this._fastUpdates.materialParameters)}return Ks.Fast_Update}_defaultElevationInfoNoZ(){return MMt}_createAs3DShape(e,i,r,n,s,o,a){const l=this.getFastUpdateAttrValues(e),c=l?_=>Fte(this._fastUpdates.materialParameters,l,_):void 0,h=this._context.layer.uid,p=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:h}),f=rte(r,Nve,null,n,s,OMt,null,l,p),m=ece(this._context,i,f,o,a,c);if(R(m))return null;const g=new Ry(this,m.object,[f],null,null,ND,o);return g.alignedSampledElevation=m.sampledElevation,g.needsElevationUpdates=Up(o.mode)||o.mode==="absolute-height",g.getScreenSize=this._createScreenSizeGetter(s,c),g.calculateRelativeScreenBounds=_=>r.calculateRelativeScreenBounds(g.getScreenSize(),1,_),FD(g,i,this._context.elevationProvider),g}_createAsOverlay(e,i,r,n,s,o){r.renderPriority=this._renderPriority;const a=pi();qa(i,a,this._context.overlaySR),a[2]=fce;const l=this._context.clippingExtent;if(v(l)&&!kne(l,a))return null;const c=this.getFastUpdateAttrValues(e),h=c?_=>Fte(this._fastUpdates.materialParameters,c,_):void 0,p=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:e.uid,layerUid:this._context.layer.uid}),f=rte(r,Nve,a,n,s,null,null,c,p),m=new nO(f,{layerUid:o,graphicUid:e.uid,shaderTransformer:h});a[3]=0,Xf(m.boundingSphere,a);const g=new D7(this,[m],null,this._context.drapeSourceRenderer);return g.getScreenSize=this._createScreenSizeGetter(s,h),g.calculateRelativeScreenBounds=_=>r.calculateRelativeScreenBounds(g.getScreenSize(),1,_),g}_createScreenSizeGetter(e,i){const r=this._outlineSize+2;if(this._fastUpdates.enabled){const n=e[0]/this._symbolTextureRatio,s=e[1]/this._symbolTextureRatio;return(o=Fe())=>{const a=i(TMt);return o[0]=a[0]*n+r,o[1]=a[5]*s+r,o}}{const n=e[0]/this._symbolTextureRatio+r,s=e[1]/this._symbolTextureRatio+r;return(o=Fe())=>(o[0]=n,o[1]=s,o)}}_fastVisualVariableConvertOptions(){const e=this._size[0]>this._size[1]?this._size[0]:this._size[1],i=Ue(e,e,e),r=Ip(1),n=e*r;return{modelSize:i,symbolSize:Ue(n,n,n),unitInMeters:r,transformation:{anchor:dl,scale:Vg,rotation:dl}}}_getGraphicHash(e){let i="";for(const r of this._cimRequiredFields)i+=r+e.attributes[r];return i}_forEachMaterial(e){v(this._material)&&e(this._material),this._cimSymbolMaterials.forEach(e)}test(){return{...super.test(),material:this._material}}};function RMt(t){return t&&t.type==="point-3d"&&t.hasVisibleVerticalOffset()}function nW(t){return!R(t)&&(t==="cross"||t==="x")}kte.PRIMITIVE_SIZE=AMt,kte.elevationModeChangeTypes={definedChanged:Ln.UPDATE,staysOnTheGround:Ln.NONE,onTheGroundChanged:Ln.RECREATE};const MMt={mode:"relative-to-ground",offset:0},OMt=Zt(0,0,0,1);function Ute(t){switch(t){case"butt":return Cp.BUTT;case"square":return Cp.SQUARE;case"round":return Cp.ROUND;default:return null}}function PMt(t){return t==="diamond"?"kite":t}function Vte(t,e,i=null){const r=[],n=[],s=e.mapPositions;IMt(e,n,r);const o=n[0][1].data,a=r[0][1].length,l=new Array(a).fill(0);return $Mt(e,n,r,l),NMt(e,n,r,l),LMt(e,n,r,l),DMt(e,n,r,l),FMt(e,n,r,l),kMt(e,n,r,l),UMt(e,n,r,o),new Os(t,n,r,s,Zn.Line,i)}function IMt(t,e,i){const{attributeData:{position:r},removeDuplicateStartEnd:n}=t,s=VMt(r)&&n,o=r.length/3-(s?1:0),a=new Array(2*(o-1)),l=s?r.slice(0,r.length-3):r;let c=0;for(let h=0;h<o-1;h++)a[c++]=h,a[c++]=h+1;e.push([M.POSITION,new Qe(l,3,s)]),i.push([M.POSITION,a])}function $Mt(t,e,i,r){if(v(t.attributeData.colorFeature))return;const n=t.attributeData.color;e.push([M.COLOR,new Qe(Nt(n,dp),4)]),i.push([M.COLOR,r])}function LMt(t,e,i,r){if(!v(t.attributeData.normal))return;const n=t.attributeData.normal;e.push([M.NORMAL,new Qe(n,3)]),i.push([M.NORMAL,r])}function DMt(t,e,i,r){const n=t.attributeData.colorFeature;R(n)||(e.push([M.COLORFEATUREATTRIBUTE,new Qe([n],1,!0)]),i.push([M.COLOR,r]))}function NMt(t,e,i,r){if(v(t.attributeData.sizeFeature))return;const n=t.attributeData.size;e.push([M.SIZE,new Qe([Nt(n,1)],1,!0)]),i.push([M.SIZE,r])}function FMt(t,e,i,r){const n=t.attributeData.sizeFeature;R(n)||(e.push([M.SIZEFEATUREATTRIBUTE,new Qe([n],1,!0)]),i.push([M.SIZEFEATUREATTRIBUTE,r]))}function kMt(t,e,i,r){const n=t.attributeData.opacityFeature;R(n)||(e.push([M.OPACITYFEATUREATTRIBUTE,new Qe([n],1,!0)]),i.push([M.OPACITYFEATUREATTRIBUTE,r]))}function UMt(t,e,i,r){if(R(t.overlayInfo)||t.overlayInfo.renderCoordsHelper.viewingMode!==qe.Global||!t.overlayInfo.spatialReference.isGeographic)return;const n=th(r.length),s=sr(t.overlayInfo.spatialReference);for(let f=0;f<n.length;f+=3)pse(r,f,n,f,s);const o=r.length/3,a=ps(o+1);let l=zMt,c=BMt,h=0,p=0;he(l,n[p++],n[p++],n[p++]),a[0]=0;for(let f=1;f<o+1;++f)f===o&&(p=0),he(c,n[p++],n[p++],n[p++]),h+=BIe(l,c),a[f]=h,[l,c]=[c,l];e.push([M.DISTANCETOSTART,new Qe(a,1,!0)]),i.push([M.DISTANCETOSTART,i[0][1]])}function VMt(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}const zMt=P(),BMt=P();function RJt(t,e){if(R(t)||t.length===0)return[];const i=[];return t.forEach(r=>{const n=r.length,s=th(3*n);r.forEach((a,l)=>{s[3*l+0]=a[0],s[3*l+1]=a[1],s[3*l+2]=a[2]});const o={attributeData:{position:s,normal:e},removeDuplicateStartEnd:!1};i.push(o)}),i}function jMt(t,e,i,r){const n=t.type==="polygon"?vy.CCW_IS_HOLE:vy.NONE,s=t.type==="polygon"?t.rings:t.paths,{position:o,outlines:a}=nF(s,!!t.hasZ,n),l=th(o.length),c=f5e(o,t.spatialReference,0,l,0,o,0,o.length/3,e,i,r),h=c!=null;return{lines:h?Zke(a,o,l):[],projectionSuccess:h,sampledElevation:c}}function GMt(t,e){const i=t.type==="polygon"?vy.CCW_IS_HOLE:vy.NONE,r=t.type==="polygon"?t.rings:t.paths,{position:n,outlines:s}=nF(r,!1,i),o=Nn(n,t.spatialReference,0,n,e,0,n.length/3);for(let a=2;a<n.length;a+=3)n[a]=fce;return{lines:o?Zke(s,n):[],projectionSuccess:o}}function Zke(t,e,i=null){const r=new Array;for(const{index:n,count:s}of t){if(s<=1)continue;const o=3*n,a=3*s;r.push({position:Sp(e,3*n,3*s),mapPositions:v(i)?Sp(i,o,a):void 0})}return r}function HMt(t){const e=new ji,i=t.hasMultipassTerrain&&(t.output===z.Color||t.output===z.Alpha),r=t.space===Ep.World;t.hasTip&&r&&e.extensions.add("GL_OES_standard_derivatives"),e.include(j5e,t),e.include(Z5e,t),t.output===z.Depth&&e.include(N_,t);const{vertex:n,fragment:s}=e;return s.include(nh),Yu(n,t),e.attributes.add(M.POSITION,"vec3"),e.attributes.add(M.UV0,"vec2"),e.attributes.add(M.AUXPOS1,"vec3"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),e.varyings.add("vUV","vec2"),e.varyings.add("vSize","float"),_w(e),i&&e.varyings.add("depth","float"),t.hasTip&&e.varyings.add("vLineWidth","float"),n.uniforms.add([new Wi("nearFar",(o,a)=>a.camera.nearFar),new bi("viewport",(o,a)=>a.camera.fullViewport)]),n.code.add(S`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),n.code.add(S`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`),r?(e.attributes.add(M.NORMAL,"vec3"),eO(n),n.constants.add("tiltThreshold","float",.7),n.code.add(S`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):n.code.add(S`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`),n.code.add(S`
      #define vecN ${r?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${r?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${t.anchor===M2.Tip?"pos -= 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `),t.space===Ep.Screen&&(n.uniforms.add(new on("inverseProjectionMatrix",(o,a)=>a.camera.inverseProjectionMatrix)),n.code.add(S`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),n.code.add(S`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),n.uniforms.add(new Ie("perScreenPixelRatio",(o,a)=>a.camera.perScreenPixelRatio)),n.code.add(S`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${t.hasCap?`
                if(prev.z > posLeft.z) {
                  vec2 diff = posLeft.xy - posRight.xy;
                  planeOrigin.xy += perpendicular(diff) / 2.0;
                }
              `:""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),n.uniforms.add(new Ie("pixelRatio",(o,a)=>a.camera.pixelRatio)),t7(e),n.code.add(S`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position.xyz, 1.0);
vec4 prev = view * vec4(auxpos1.xyz, 1.0);
clip(pos, prev);`),r?(t.hideOnShortSegments&&n.code.add(S`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),n.code.add(S`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(n.code.add(S`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),t.space===Ep.Screen&&n.code.add(S`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`)),n.code.add(S`
        ${i?"depth = pos.z;":""}
        linearDepth = calculateLinearDepth(nearFar,pos.z);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${r?"":"vUV *= displacedPosScreen.w;"}

        ${t.hasTip?"vLineWidth = lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),i&&e.include(hd,t),e.include(fs,t),s.uniforms.add([new bi("intrinsicColor",o=>o.color),new Dt("tex",o=>o.texture)]),s.include(Cy),e.constants.add("texelSize","float",1/VD),s.code.add(S`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture2D(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`),t.hasTip&&(e.constants.add("relativeMarkerSize","float",nce/VD),e.constants.add("relativeTipLineWidth","float",aAt),s.code.add(S`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${r?"halfTipLineWidth *= fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `)),e.constants.add("symbolAlphaCutoff","float",za),s.code.add(S`
  void main() {
    discardBySlice(vpos);
    ${i?"terrainDepthTest(gl_FragCoord, depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${r?"vec2 samplePos = vUV;":"vec2 samplePos = vUV * gl_FragCoord.w;"}

    ${t.hasTip?"finalColor.a *= max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *= markerAlpha(samplePos);"}

    ${t.output===z.ObjectAndLayerIdColor?S`finalColor.a = 1.0;`:""}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${t.output===z.Alpha?S`gl_FragColor = vec4(finalColor.a);`:""}
    ${t.output===z.Color?S`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===z.Color&&t.transparencyPassType===At.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${t.output===z.Highlight?S`gl_FragColor = vec4(1.0);`:""}
    ${t.output===z.Depth?S`outputDepth(linearDepth);`:""}
  }
  `),e}const qMt=Object.freeze(Object.defineProperty({__proto__:null,build:HMt},Symbol.toStringTag,{value:"Module"})),Jke=new Map([[M.POSITION,0],[M.UV0,2],[M.AUXPOS1,3],[M.NORMAL,4],[M.COLOR,5],[M.COLORFEATUREATTRIBUTE,5],[M.SIZE,6],[M.SIZEFEATUREATTRIBUTE,6],[M.OPACITYFEATUREATTRIBUTE,7]]);let Kke=class Qke extends Yi{initializeProgram(e){return new Hi(e.rctx,Qke.shader.get().build(this.configuration),Jke)}_makePipelineState(e,i){const r=this.configuration,n=e===At.NONE;return Ht({blending:r.output===z.Color||r.output===z.Alpha?n?nd:ev(e):null,depthTest:{func:jw(e)},depthWrite:n?r.writeDepth?Kc:null:S7(e),colorWrite:si,stencilWrite:r.hasOccludees?by:null,stencilTest:r.hasOccludees?i?Cw:Gw:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=Ht({blending:nd,depthTest:Vz,depthWrite:null,colorWrite:si,stencilWrite:null,stencilTest:Q5e}),this._occluderPipelineOpaque=Ht({blending:nd,depthTest:Vz,depthWrite:null,colorWrite:si,stencilWrite:J5e,stencilTest:K5e}),this._occluderPipelineMaskWrite=Ht({blending:null,depthTest:sce,depthWrite:null,colorWrite:null,stencilWrite:by,stencilTest:Cw})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,i){return i?this._occludeePipelineState:this.configuration.occluder?e===Ee.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===Ee.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,i)}};Kke.shader=new Gi(qMt,()=>Q(()=>import("./LineMarker.glsl-5c2cefff.js"),[]));let WMt=class extends Bw{constructor(e){super(e,new YMt),this._vertexAttributeLocations=Jke,this._configuration=new ra,this._layout=this.createLayout()}dispose(){}getConfiguration(e,i){return this._configuration.output=e,this._configuration.space=i.slot===Ee.DRAPED_MATERIAL?Ep.Draped:this.parameters.worldSpace?Ep.World:Ep.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==Cp.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.occluder=this.parameters.renderOccluded===xn.OccludeAndTransparentStencil,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}intersect(){}createLayout(){const e=_n().vec3f(M.POSITION).vec2f(M.UV0).vec3f(M.AUXPOS1);return this.parameters.worldSpace&&e.vec3f(M.NORMAL),this.parameters.vvSizeEnabled?e.f32(M.SIZEFEATUREATTRIBUTE):e.f32(M.SIZE),this.parameters.vvColorEnabled?e.f32(M.COLORFEATUREATTRIBUTE):e.vec4f(M.COLOR),this.parameters.vvOpacityEnabled&&e.f32(M.OPACITYFEATUREATTRIBUTE),e}createBufferWriter(){return new ZMt(this._layout,this.parameters)}requiresSlot(e,i){return i===z.Color||i===z.Alpha||i===z.Highlight||i===z.Depth?e===Ee.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===xn.OccludeAndTransparentStencil?e===Ee.OPAQUE_MATERIAL||e===Ee.OCCLUDER_MATERIAL||e===Ee.TRANSPARENT_OCCLUDER_MATERIAL:i===z.Color||i===z.Alpha?e===(this.parameters.writeDepth?Ee.TRANSPARENT_MATERIAL:Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===Ee.OPAQUE_MATERIAL:!1}createGLMaterial(e){return new XMt(e)}},XMt=class extends Uae{_updateParameters(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(Kke,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==z.Color&&this._output!==z.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},YMt=class extends Gle{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.placement="end",this.cap=Cp.BUTT,this.anchor=M2.Center,this.hasTip=!1,this.worldSpace=!1,this.hideOnShortSegments=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1}},ZMt=class{constructor(e,i){this.vertexBufferLayout=e,this._parameters=i}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(){return this._parameters.placement==="begin-end"?12:6}write(e,i,r,n,s){const o=r.vertexAttributes.get(M.POSITION).data,a=o.length/3;let l=[1,0,0];const c=r.vertexAttributes.get(M.NORMAL);this._parameters.worldSpace&&v(c)&&(l=c.data);let h=1,p=0;this._parameters.vvSizeEnabled?p=r.vertexAttributes.get(M.SIZEFEATUREATTRIBUTE).data[0]:r.vertexAttributes.has(M.SIZE)&&(h=r.vertexAttributes.get(M.SIZE).data[0]);let f=[1,1,1,1],m=0;this._parameters.vvColorEnabled?m=r.vertexAttributes.get(M.COLORFEATUREATTRIBUTE).data[0]:r.vertexAttributes.has(M.COLOR)&&(f=r.vertexAttributes.get(M.COLOR).data);let g=0;this._parameters.vvOpacityEnabled&&(g=r.vertexAttributes.get(M.OPACITYFEATUREATTRIBUTE).data[0]);const _=new Float32Array(n.buffer);let b=s*(this.vertexBufferLayout.stride/4);const w=(C,A,I,O)=>{if(_[b++]=C[0],_[b++]=C[1],_[b++]=C[2],_[b++]=I[0],_[b++]=I[1],_[b++]=A[0],_[b++]=A[1],_[b++]=A[2],this._parameters.worldSpace&&(_[b++]=l[0],_[b++]=l[1],_[b++]=l[2]),this._parameters.vvSizeEnabled?_[b++]=p:_[b++]=h,this._parameters.vvColorEnabled)_[b++]=m;else{const D=Math.min(4*O,f.length-4);_[b++]=f[D+0],_[b++]=f[D+1],_[b++]=f[D+2],_[b++]=f[D+3]}this._parameters.vvOpacityEnabled&&(_[b++]=g)};let x;(function(C){C[C.ASCENDING=1]="ASCENDING",C[C.DESCENDING=-1]="DESCENDING"})(x||(x={}));const T=(C,A)=>{const I=he(JMt,o[3*C],o[3*C+1],o[3*C+2]),O=KMt;let D=C+A;do he(O,o[3*D],o[3*D+1],o[3*D+2]),D+=A;while(Qb(I,O)&&D>=0&&D<a);e&&(Ke(I,I,e),Ke(O,O,e)),w(I,O,[-1,-1],C),w(I,O,[1,-1],C),w(I,O,[1,1],C),w(I,O,[-1,-1],C),w(I,O,[1,1],C),w(I,O,[-1,1],C)},E=this._parameters.placement;E!=="begin"&&E!=="begin-end"||T(0,x.ASCENDING),E!=="end"&&E!=="begin-end"||T(a-1,x.DESCENDING)}};const JMt=P(),KMt=P(),Qa={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},QMt={dash:Qa.dash,"dash-dot":[...Qa.dash,...Qa.dot],dot:Qa.dot,"long-dash":Qa["long-dash"],"long-dash-dot":[...Qa["long-dash"],...Qa.dot],"long-dash-dot-dot":[...Qa["long-dash"],...Qa.dot,...Qa.dot],none:null,"short-dash":Qa["short-dash"],"short-dash-dot":[...Qa["short-dash"],...Qa["short-dot"]],"short-dash-dot-dot":[...Qa["short-dash"],...Qa["short-dot"],...Qa["short-dot"]],"short-dot":Qa["short-dot"],solid:null},eOt=8;function tOt(t,e=2){return R(t)?t:{pattern:t.slice(),pixelRatio:e}}function $Jt(t,e=2){return{pattern:[t,t],pixelRatio:e}}function e6e(t){return v(t)&&t.type==="style"?iOt(t.style):null}function iOt(t){return v(t)?tOt(QMt[t],eOt):null}const rOt=["polyline","polygon","extent"];let t6e=class i6e extends My{constructor(e,i,r,n){super(e,i,r,n)}async doLoad(){if(this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=jD(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1},!this._drivenProperties.size&&(this.symbolLayer.size!=null?this.symbolLayer.size:Ip(1))<0)throw new H("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._markerTexture=v(this.symbolLayer.marker)&&v(this._context.sharedResources.textures)?lAt(this._context.sharedResources.textures,PMt(this.symbolLayer.marker.style)):null}_getMaterialParameters(e,i=!1){var s;const r=this._getCombinedOpacityAndColor(i&&this._markerColor||this._materialColor);this._patternHidesLine&&!i&&(r[3]=0);const n={width:this._computeMaterialWidth((s=this.symbolLayer)==null?void 0:s.size),color:r,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:Ute(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:e,stipplePattern:e6e(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};return this._fastUpdates&&this._fastUpdates.visualVariables?{...n,...this._fastUpdates.materialParameters}:n}get _materialColor(){return Vo(this.symbolLayer.material,e=>e.color)}get _markerColor(){return Vo(this.symbolLayer.marker,e=>e.color)}get _lineMaterial(){return R(this._lineMaterialCached)&&(this._lineMaterialCached=new fR(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterialCached)),this._lineMaterialCached}get _ringMaterial(){return R(this._ringMaterialCached)&&(this._ringMaterialCached=new fR(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterialCached)),this._ringMaterialCached}get _wireframeLineMaterial(){return R(this._wireframeLineMaterialCached)&&(this._wireframeLineMaterialCached=new fR({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._wireframeLineMaterialCached)),this._wireframeLineMaterialCached}get _wireframeRingMaterial(){return R(this._wireframeRingMaterialCached)&&(this._wireframeRingMaterialCached=new fR({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._wireframeRingMaterialCached)),this._wireframeRingMaterialCached}get _markerMaterial(){return R(this._markerMaterialCached)&&v(this.symbolLayer.marker)&&v(this._markerTexture)&&(this._markerMaterialCached=new WMt({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,textureId:this._markerTexture.texture.id}),this._context.stage.add(this._markerMaterialCached)),this._markerMaterialCached}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._lineMaterialCached=null,this._ringMaterialCached=null,this._wireframeLineMaterialCached=null,this._wireframeRingMaterialCached=null,this._markerMaterialCached=null,this._markerTexture=nn(this._markerTexture)}_getDrivenSize(e){return this._drivenProperties.size&&e.size?ga(PCt(e.size)):1}_getSizeFeatureAttributeData(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?p_(this._fastUpdates.visualVariables.size.field,e):null}_getDrivenColor(e){const i=Zt(1,1,1,1);return this._drivenProperties.color&&e.color&&(i[0]=e.color[0],i[1]=e.color[1],i[2]=e.color[2],e.color.length>0&&(i[3]=e.color[3])),this._drivenProperties.opacity&&e.opacity&&(i[3]=e.opacity),i}_getColorFeatureAttributeData(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?p_(this._fastUpdates.visualVariables.color.field,e):null}_getOpacityFeatureAttributeData(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?p_(this._fastUpdates.visualVariables.opacity.field,e):null}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,rOt,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i,new Om);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.draped?this._createAsOverlay(e,this._context.layer.uid):this._createAs3DShape(e,r,i.uid)}applyRendererDiff(e,i){for(const r in e.diff){if(r!=="visualVariables"||!GD(this._fastUpdates,i,this._vvConvertOptions))return Ks.Recreate_Symbol;this._forEachMaterial(n=>n.setParameters(this._fastUpdates.materialParameters))}return Ks.Fast_Update}prepareSymbolLayerPatch(e){var s,o;if(e.diff.type!=="partial")return;const i=e.diff.diff,r={};((s=i.size)==null?void 0:s.type)==="complete"&&(r.width=this._computeMaterialWidth(i.size.newValue),delete i.size),((o=i.cap)==null?void 0:o.type)==="complete"&&(r.cap=Ute(Nt(i.cap.newValue,"butt")),delete i.cap);const n=this._prepareMarkerPatch(e,i);this._prepareMaterialPatch(e,i,n),e.symbolLayerStatePatches.push(()=>this._forEachMaterial(a=>a.setParameters(r)))}layerOpacityChanged(){this._forEachMaterial((e,i)=>this._updateMaterialLayerOpacity(e,i))}_forEachMaterial(e){v(this._lineMaterialCached)&&e(this._lineMaterialCached),v(this._ringMaterialCached)&&e(this._ringMaterialCached),v(this._wireframeLineMaterialCached)&&e(this._wireframeLineMaterialCached),v(this._wireframeRingMaterialCached)&&e(this._wireframeRingMaterialCached),v(this._markerMaterialCached)&&e(this._markerMaterialCached,!0)}_updateMaterialLayerOpacity(e,i=!1){const r=e.parameters.color,n=Js(this.symbolLayer,"material","color"),s=this._patternHidesLine&&!i?0:this._getCombinedOpacity(n),o=Zt(r[0],r[1],r[2],s);e.setParameters({color:o})}layerElevationInfoChanged(e,i,r){const n=this._elevationContext.mode,s=tF(i6e.elevationModeChangeTypes,r,n);if(s!==Ln.UPDATE)return s;const o=Up(n);return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){const e={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(i=>i.setParameters(e)),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_getGeometryAsPolygonOrPolyline(e){switch(e.type){case"extent":if(e instanceof ni)return ec.fromExtent(e);break;case"polygon":case"polyline":return e}return null}_createAs3DShape(e,i,r){const n=e.graphic,s=this._getGeometryAsPolygonOrPolyline(n.geometry),o=s.type==="polygon"?s.rings:s.paths,a=new Array,l=to(),c=jMt(s,this._context.elevationProvider,this._context.renderCoordsHelper,i),h=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(c,o,h,"LineSymbol3DLayer");for(let m=0;m<c.lines.length;m++){const g=c.lines[m],_=g.position,b=g.mapPositions;if(v(this._context.clippingExtent)&&(Br(l),Kh(l,b),!Zf(l,this._context.clippingExtent)))continue;const w=this._createGeometry(s.type==="polygon"?this._ringMaterial:this._lineMaterial,e,_,b,s.type,oL.ELEVATED,r);a.push(w),tr.LINE_WIREFRAMES&&a.push(w.instantiate({material:s.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial})),v(this._markerMaterial)&&a.push(w.instantiate({material:this._markerMaterial}))}if(a.length===0)return null;const p=new iv({geometries:a,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:r}}),f=new Ry(this,p,a,null,null,zEt,i);return f.alignedSampledElevation=c.sampledElevation,f.needsElevationUpdates=Up(i.mode),f}_createGeometry(e,i,r,n,s,o,a){const l=s==="polygon",c=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color,h=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size,p=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:this._context.layer.uid});return Vte(e,{overlayInfo:o===oL.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,removeDuplicateStartEnd:l,mapPositions:n,attributeData:{position:r,size:h?null:this._getDrivenSize(i.renderingInfo),color:c?null:this._getDrivenColor(i.renderingInfo),sizeFeature:this._getSizeFeatureAttributeData(i.graphic),colorFeature:this._getColorFeatureAttributeData(i.graphic),opacityFeature:this._getOpacityFeatureAttributeData(i.graphic)}},p)}_createAsOverlay(e,i){const r=e.graphic,n=this._getGeometryAsPolygonOrPolyline(r.geometry),s=n.type==="polygon"?n.rings:n.paths,o=n.type==="polygon"?this._ringMaterial:this._lineMaterial;o.renderPriority=this._renderPriority;const a=tr.LINE_WIREFRAMES?n.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial:null,l=this._markerMaterial;v(a)&&(a.renderPriority=this._renderPriority-.001),v(l)&&(l.renderPriority=this._renderPriority-.002);const c=new Array,h=to(),p=Br(),f=GMt(n,this._context.overlaySR),m=n.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(f,s,m,"LineSymbol3DLayer");for(const g of f.lines){if(Br(h),Kh(h,g.position),!Zf(h,this._context.clippingExtent))continue;wM(p,h);const _=w=>{const x=this._createGeometry(w,e,g.position,void 0,n.type,oL.DRAPED,r.uid),T=new nO(x,{layerUid:i,graphicUid:r.uid});return c.push(T),T};if(v(l)){const w=_(l),x=this.symbolLayer.marker.placement;x!=="begin"&&x!=="begin-end"||Kh(h,g.position,0,1),x!=="end"&&x!=="begin-end"||Kh(h,g.position,g.position.length-3,1),this._updateBoundingSphere(w,h)}const b=_(o);if(this._updateBoundingSphere(b,h),tr.LINE_WIREFRAMES){const w=_(a);this._updateBoundingSphere(w,h)}}return new D7(this,c,p,this._context.drapeSourceRenderer)}_updateBoundingSphere(e,i){cr(e.boundingSphere,.5*(i[0]+i[3]),.5*(i[1]+i[4]),0,.5*Math.sqrt((i[3]-i[0])*(i[3]-i[0])+(i[4]-i[1])*(i[4]-i[1])))}get _patternHidesLine(){const e=this.symbolLayer.pattern;return v(e)&&e.type==="style"&&e.style==="none"}_computeMaterialWidth(e){return e=Nt(e,Ip(1)),this._drivenProperties.size?this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?ga(1):1:ga(e)}_prepareMaterialPatch(e,i,r){var a;const n=i.material;if(R(n))return void(r.changed&&r.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._markerMaterialCached,e));if(n.type==="collection")return;const s=n.type==="complete"?Vo(n.newValue,l=>l.color):((a=n.diff.color)==null?void 0:a.type)==="complete"?n.diff.color.newValue:null,o=this._getCombinedOpacityAndColor(s);r.useMaterialColor&&this._patchMaterialColor(DN(o),this._markerMaterialCached,e),this._patternHidesLine&&(o[3]=0),this._patchMaterialColor(o,this._lineMaterialCached,e),delete i.material}_prepareMarkerPatch(e,i){const r=i.marker;if(R(r)||r.type!=="partial"||v(r.diff.style)||v(r.diff.placement)||v(r.diff.color)&&r.diff.color.type!=="complete")return{changed:!1,useMaterialColor:R(this._markerColor)};const n=r.diff.color;if(R(n))return delete i.marker,{changed:!1,useMaterialColor:R(this._markerColor)};const s=n.newValue;return R(s)?(delete i.marker,{changed:!0,useMaterialColor:!0}):(this._patchMaterialColor(this._getCombinedOpacityAndColor(s),this._markerMaterialCached,e),delete i.marker,{changed:!0,useMaterialColor:!1})}_patchMaterialColor(e,i,r){R(i)||r.symbolLayerStatePatches.push(()=>i.setParameters({color:e}))}};var oL;t6e.elevationModeChangeTypes={definedChanged:Ln.RECREATE,staysOnTheGround:Ln.NONE,onTheGroundChanged:Ln.RECREATE},function(t){t[t.DRAPED=0]="DRAPED",t[t.ELEVATED=1]="ELEVATED"}(oL||(oL={}));var _A;const sW=new WeakMap;let nOt=0,yg=_A=class extends fe{constructor(t){super(t),this.wrap="repeat"}get url(){return this._get("url")||null}set url(t){this._set("url",t),t&&this._set("data",null)}get data(){return this._get("data")||null}set data(t){this._set("data",t),t&&this._set("url",null)}writeData(t,e,i,r){if(t instanceof HTMLImageElement){const n={type:"image-element",src:R_(t.src,r),crossOrigin:t.crossOrigin};e[i]=n}else if(t instanceof HTMLCanvasElement){const n=t.getContext("2d").getImageData(0,0,t.width,t.height),s={type:"canvas-element",imageData:this._encodeImageData(n)};e[i]=s}else if(t instanceof HTMLVideoElement){const n={type:"video-element",src:R_(t.src,r),autoplay:t.autoplay,loop:t.loop,muted:t.muted,crossOrigin:t.crossOrigin,preload:t.preload};e[i]=n}else if(t instanceof ImageData){const n={type:"image-data",imageData:this._encodeImageData(t)};e[i]=n}}readData(t){switch(t.type){case"image-element":{const e=new Image;return e.src=t.src,e.crossOrigin=t.crossOrigin,e}case"canvas-element":{const e=this._decodeImageData(t.imageData),i=document.createElement("canvas");return i.width=e.width,i.height=e.height,i.getContext("2d").putImageData(e,0,0),i}case"image-data":return this._decodeImageData(t.imageData);case"video-element":{const e=document.createElement("video");return e.src=t.src,e.crossOrigin=t.crossOrigin,e.autoplay=t.autoplay,e.loop=t.loop,e.muted=t.muted,e.preload=t.preload,e}default:return}}get transparent(){const t=this.data,e=this.url;if(t instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(t.getContext("2d").getImageData(0,0,t.width,t.height));if(t instanceof ImageData)return this._imageDataContainsTransparent(t);if(e){const i=e.substr(e.length-4,4).toLowerCase(),r=e.substr(0,15).toLocaleLowerCase();if(i===".png"||r==="data:image/png;")return!0}return!1}set transparent(t){this._overrideIfSome("transparent",t)}get contentHash(){const t=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",e=(i="")=>`d:${i},t:${this.transparent},w:${t}`;return this.url!=null?e(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?e(this.data.src):(sW.has(this.data)||sW.set(this.data,++nOt),e(sW.get(this.data))):e()}clone(){const t={url:this.url,data:this.data,wrap:this._cloneWrap()};return new _A(t)}cloneWithDeduplication(t){const e=t.get(this);if(e)return e;const i=this.clone();return t.set(this,i),i}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(t){let e="";for(let i=0;i<t.data.length;i++)e+=String.fromCharCode(t.data[i]);return{data:btoa(e),width:t.width,height:t.height}}_decodeImageData(t){const e=atob(t.data),i=new Uint8ClampedArray(e.length);for(let r=0;r<e.length;r++)i[r]=e.charCodeAt(r);return uft(i,t.width,t.height)}_imageDataContainsTransparent(t){for(let e=3;e<t.data.length;e+=4)if(t.data[e]!==255)return!0;return!1}static from(t){return typeof t=="string"?new _A({url:t}):t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData||t instanceof HTMLVideoElement?new _A({data:t}):uM(_A,t)}};u([d({type:String,json:{write:iw}})],yg.prototype,"url",null),u([d({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),d()],yg.prototype,"data",null),u([Ne("data")],yg.prototype,"writeData",null),u([Oe("data")],yg.prototype,"readData",null),u([d({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],yg.prototype,"transparent",null),u([d({json:{write:!0}})],yg.prototype,"wrap",void 0),u([d({readOnly:!0})],yg.prototype,"contentHash",null),yg=_A=u([$("esri.geometry.support.MeshTexture")],yg);const aL=yg;var zte;let Ef=zte=class extends fe{constructor(t){super(t),this.color=null,this.colorTexture=null,this.normalTexture=null,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const i=v(t)?t.get(this):null;if(i)return i;const r=new zte(this.clonePropertiesWithDeduplication(e));return v(t)&&t.set(this,r),r}clonePropertiesWithDeduplication(t){return{color:v(this.color)?this.color.clone():null,colorTexture:v(this.colorTexture)?this.colorTexture.cloneWithDeduplication(t):null,normalTexture:v(this.normalTexture)?this.normalTexture.cloneWithDeduplication(t):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:v(this.colorTextureTransform)?this.colorTextureTransform:null,normalTextureTransform:v(this.normalTextureTransform)?this.normalTextureTransform:null}}};u([d({type:Xe,json:{write:!0}})],Ef.prototype,"color",void 0),u([d({type:aL,json:{write:!0}})],Ef.prototype,"colorTexture",void 0),u([d({type:aL,json:{write:!0}})],Ef.prototype,"normalTexture",void 0),u([d({nonNullable:!0,json:{write:!0}})],Ef.prototype,"alphaMode",void 0),u([d({nonNullable:!0,json:{write:!0}})],Ef.prototype,"alphaCutoff",void 0),u([d({nonNullable:!0,json:{write:!0}})],Ef.prototype,"doubleSided",void 0),u([d()],Ef.prototype,"colorTextureTransform",void 0),u([d()],Ef.prototype,"normalTextureTransform",void 0),Ef=zte=u([$("esri.geometry.support.MeshMaterial")],Ef);const vce=Ef;var Bte;let zd=Bte=class extends vce{constructor(t){super(t),this.emissiveColor=null,this.emissiveTexture=null,this.occlusionTexture=null,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const i=v(t)?t.get(this):null;if(i)return i;const r=new Bte(this.clonePropertiesWithDeduplication(e));return v(t)&&t.set(this,r),r}clonePropertiesWithDeduplication(t){return{...super.clonePropertiesWithDeduplication(t),emissiveColor:v(this.emissiveColor)?this.emissiveColor.clone():null,emissiveTexture:v(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(t):null,occlusionTexture:v(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(t):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:v(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.cloneWithDeduplication(t):null,occlusionTextureTransform:v(this.occlusionTextureTransform)?this.occlusionTextureTransform:null,emissiveTextureTransform:v(this.emissiveTextureTransform)?this.emissiveTextureTransform:null,metallicRoughnessTextureTransform:v(this.metallicRoughnessTextureTransform)?this.metallicRoughnessTextureTransform:null}}};u([d({type:Xe,json:{write:!0}})],zd.prototype,"emissiveColor",void 0),u([d({type:aL,json:{write:!0}})],zd.prototype,"emissiveTexture",void 0),u([d({type:aL,json:{write:!0}})],zd.prototype,"occlusionTexture",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],zd.prototype,"metallic",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],zd.prototype,"roughness",void 0),u([d({type:aL,json:{write:!0}})],zd.prototype,"metallicRoughnessTexture",void 0),u([d()],zd.prototype,"occlusionTextureTransform",void 0),u([d()],zd.prototype,"emissiveTextureTransform",void 0),u([d()],zd.prototype,"metallicRoughnessTextureTransform",void 0),zd=Bte=u([$("esri.geometry.support.MeshMaterialMetallicRoughness")],zd);const r6e=zd;var jU;const n6e="esri.geometry.support.MeshVertexAttributes",WE=re.getLogger(n6e);let Td=jU=class extends fe{constructor(t){super(t),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(t){return vA(t,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},WE)}castPosition(t){return t&&t instanceof Float32Array&&WE.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),vA(t,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},WE)}castUv(t){return vA(t,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},WE)}castNormal(t){return vA(t,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},WE)}castTangent(t){return vA(t,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},WE)}clone(){const t={position:se(this.position),uv:se(this.uv),normal:se(this.normal),tangent:se(this.tangent),color:se(this.color)};return new jU(t)}clonePositional(){const t={position:se(this.position),normal:se(this.normal),tangent:se(this.tangent),uv:this.uv,color:this.color};return new jU(t)}};function oW(t,e,i,r){const{loggerTag:n,stride:s}=e;return t.length%s!=0?(r.error(n,`Invalid array length, expected a multiple of ${s}`),new i([])):t}function vA(t,e,i,r,n){if(!t)return t;if(t instanceof e)return oW(t,r,e,n);for(const s of i)if(t instanceof s)return oW(new e(t),r,e,n);if(Array.isArray(t))return oW(new e(t),r,e,n);{const s=i.map(o=>`'${o.name}'`);return n.error(`Failed to set property, expected one of ${s}, but got ${t.constructor.name}`),new e([])}}function K3(t,e,i){e[i]=sOt(t)}function sOt(t){const e=new Array(t.length);for(let i=0;i<t.length;i++)e[i]=t[i];return e}u([d({json:{write:K3}})],Td.prototype,"color",void 0),u([ri("color")],Td.prototype,"castColor",null),u([d({nonNullable:!0,json:{write:K3}})],Td.prototype,"position",void 0),u([ri("position")],Td.prototype,"castPosition",null),u([d({json:{write:K3}})],Td.prototype,"uv",void 0),u([ri("uv")],Td.prototype,"castUv",null),u([d({json:{write:K3}})],Td.prototype,"normal",void 0),u([ri("normal")],Td.prototype,"castNormal",null),u([d({json:{write:K3}})],Td.prototype,"tangent",void 0),u([ri("tangent")],Td.prototype,"castTangent",null),Td=jU=u([$(n6e)],Td);var HI;const s6e="esri.geometry.support.MeshComponent",oOt=re.getLogger(s6e);let S0=HI=class extends fe{static from(t){return uM(HI,t)}constructor(t){super(t),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}castFaces(t){return vA(t,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},oOt)}castMaterial(t){return uM(t&&typeof t=="object"&&("metallic"in t||"roughness"in t||"metallicRoughnessTexture"in t)?r6e:vce,t)}clone(){return new HI({faces:se(this.faces),shading:this.shading,material:se(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(t,e){const i={faces:se(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(t,e):null,trustSourceNormals:this.trustSourceNormals};return new HI(i)}};u([d({json:{write:!0}})],S0.prototype,"faces",void 0),u([ri("faces")],S0.prototype,"castFaces",null),u([d({type:vce,json:{write:!0}})],S0.prototype,"material",void 0),u([ri("material")],S0.prototype,"castMaterial",null),u([d({type:String,json:{write:!0}})],S0.prototype,"shading",void 0),u([d({type:Boolean})],S0.prototype,"trustSourceNormals",void 0),S0=HI=u([$(s6e)],S0);const aOt=S0,F7=re.getLogger("esri.geometry.support.meshUtils.normalProjection");function lOt(t,e,i,r,n){return U7(r)?(k7(f_.TO_PCPF,jr.fromTypedArray(t),_l.fromTypedArray(e),_l.fromTypedArray(i),r,jr.fromTypedArray(n)),n):(F7.error("Cannot convert spatial reference to PCPF"),n)}function LJt(t,e,i,r,n){return U7(r)?(k7(f_.FROM_PCPF,jr.fromTypedArray(t),_l.fromTypedArray(e),_l.fromTypedArray(i),r,jr.fromTypedArray(n)),n):(F7.error("Cannot convert to spatial reference from PCPF"),n)}function DJt(t,e,i){return Nn(t,e,0,i,XB(e),0,t.length/3),i}function NJt(t,e,i){return Nn(t,XB(i),0,e,i,0,t.length/3),e}function cOt(t,e,i){if(R(t))return e;const r=_l.fromTypedArray(t),n=_l.fromTypedArray(e);return rF(n,r,i),e}function uOt(t,e,i){if(R(t))return e;jM(Oo,i);const r=jr.fromTypedArray(t),n=jr.fromTypedArray(e);return Ew(n,r,Oo),Zoe(Oo)||tce(n,n),e}function hOt(t,e,i){if(R(t))return e;jM(Oo,i);const r=jr.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),n=jr.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT);if(Ew(n,r,Oo),Zoe(Oo)||tce(n,n),t!==e)for(let s=3;s<t.length;s+=4)e[s]=t[s];return e}function dOt(t,e,i,r,n){if(!U7(r))return F7.error("Cannot convert spatial reference to PCPF"),n;k7(f_.TO_PCPF,jr.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),_l.fromTypedArray(e),_l.fromTypedArray(i),r,jr.fromTypedArray(n,4*Float32Array.BYTES_PER_ELEMENT));for(let s=3;s<t.length;s+=4)n[s]=t[s];return n}function FJt(t,e,i,r,n){if(!U7(r))return F7.error("Cannot convert to spatial reference from PCPF"),n;k7(f_.FROM_PCPF,jr.fromTypedArray(t,16),_l.fromTypedArray(e),_l.fromTypedArray(i),r,jr.fromTypedArray(n,16));for(let s=3;s<t.length;s+=4)n[s]=t[s];return n}function k7(t,e,i,r,n,s){if(!e)return;const o=i.count,a=XB(n);if(o6e(n))for(let l=0;l<o;l++)r.getVec(l,W5),e.getVec(l,jm),ym(a,W5,X5,a),Dp(Oo,X5),t===f_.FROM_PCPF&&Qu(Oo,Oo),Wl(jm,jm,Oo),s.setVec(l,jm);else for(let l=0;l<o;l++){r.getVec(l,W5),e.getVec(l,jm),ym(a,W5,X5,a),Dp(Oo,X5);const c=J8(i.get(l,1));let h=Math.cos(c);t===f_.TO_PCPF&&(h=1/h),Oo[0]*=h,Oo[1]*=h,Oo[2]*=h,Oo[3]*=h,Oo[4]*=h,Oo[5]*=h,t===f_.FROM_PCPF&&Qu(Oo,Oo),Wl(jm,jm,Oo),we(jm,jm),s.setVec(l,jm)}return s}function U7(t){return o6e(t)||pOt(t)}function o6e(t){return t.isWGS84||F2e(t)||wy(t)||xy(t)}function pOt(t){return t.isWebMercator}var f_;(function(t){t[t.TO_PCPF=0]="TO_PCPF",t[t.FROM_PCPF=1]="FROM_PCPF"})(f_||(f_={}));const W5=P(),jm=P(),X5=$e(),Oo=wr();let a6e=class{constructor(e){this.data=e,this.type="encoded-mesh-texture",this.encoding=j0.KTX2_ENCODING}};function qS(t){return(t==null?void 0:t.type)==="encoded-mesh-texture"}async function fOt(t){return new Promise((e,i)=>{const r=new Blob([t]),n=new FileReader;n.onload=()=>{const s=n.result;e(JSON.parse(s))},n.onerror=s=>{i(s)},n.readAsText(r)})}async function mOt(t,e){return e===j0.KTX2_ENCODING?new a6e(t):new Promise((i,r)=>{const n=new Blob([t],{type:e}),s=URL.createObjectURL(n),o=new Image,a=()=>{URL.revokeObjectURL(s),"decode"in o?o.decode().then(()=>i(o),()=>i(o)).then(c):(i(o),c())},l=h=>{URL.revokeObjectURL(s),r(h),c()},c=()=>{o.removeEventListener("load",a),o.removeEventListener("error",l)};o.addEventListener("load",a),o.addEventListener("error",l),o.src=s})}function kg(t){if(R(t))return null;const e=v(t.offset)?t.offset:f$e,i=v(t.rotation)?t.rotation:0,r=v(t.scale)?t.scale:m$e,n=dU(1,0,0,0,1,0,e[0],e[1],1),s=dU(Math.cos(i),-Math.sin(i),0,Math.sin(i),Math.cos(i),0,0,0,1),o=dU(r[0],0,0,0,r[1],0,0,0,1),a=qc();return pw(a,s,o),pw(a,n,a),a}function gOt(t){const e=new ji,{vertex:i,fragment:r}=e;return e.include(Gc,t),e.include(eE,t),e.include(X5e,t),Yu(i,t),t.stippleEnabled&&(e.attributes.add(M.UV0,"vec2"),e.attributes.add(M.AUXPOS1,"vec3"),i.uniforms.add(new bi("viewport",(n,s)=>s.camera.fullViewport))),e.attributes.add(M.POSITION,"vec3"),e.varyings.add("vpos","vec3"),i.code.add(S`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),t.stippleEnabled&&(i.code.add(S`vec4 vpos2 = transformPosition(proj, view, auxpos1);
vec2 ndcToPixel = viewport.zw * 0.5;
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),t.draped?i.uniforms.add(new Ie("worldToScreenRatio",(n,s)=>1/s.screenToPCSRatio)):i.code.add(S`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),i.code.add(S`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),t.draped?i.code.add(S`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):i.code.add(S`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),i.uniforms.add(new Ie("stipplePatternPixelSize",n=>rce(n))),i.code.add(S`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`)),i.code.add(S`}`),t.output===z.Highlight&&e.include(Q_,t),e.include(fs,t),r.uniforms.add(new Ie("alphaCoverage",(n,s)=>Math.min(1,n.width*s.camera.pixelRatio))),t.hasVertexColors||r.uniforms.add(new bi("constantColor",n=>n.color)),r.code.add(S`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${t.hasVertexColors?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    ${t.output===z.ObjectAndLayerIdColor?S`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${S.float(za)}) {
      discard;
    }

    ${t.output===z.Color?S`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===z.Highlight?S`outputHighlight();`:""}
  }
  `),e}const yOt=Object.freeze(Object.defineProperty({__proto__:null,build:gOt},Symbol.toStringTag,{value:"Module"}));let l6e=class c6e extends Yi{get _stippleEnabled(){return this.configuration.stippleEnabled&&this.configuration.output!==z.Highlight}initializeConfiguration(e,i){i.hasWebGL2Context=e.rctx.type===Et.WEBGL2}initializeProgram(e){return new Hi(e.rctx,c6e.shader.get().build(this.configuration),Di)}initializePipeline(){const e=this.configuration,i=_o(Ce.SRC_ALPHA,Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA,Ce.ONE_MINUS_SRC_ALPHA),r=(n,s=null,o=null)=>Ht({blending:s,depthTest:sce,depthWrite:o,colorWrite:si,stencilWrite:e.hasOccludees?by:null,stencilTest:e.hasOccludees?n?Cw:Gw:null});return e.output===z.Color?(this._occludeePipelineState=r(!0,e.transparent||this._stippleEnabled?i:null,Kc),r(!1,e.transparent||this._stippleEnabled?i:null,Kc)):r(!1)}get primitiveType(){return Ft.LINES}getPipelineState(e,i){return i?this._occludeePipelineState:super.getPipelineState(e,i)}};l6e.shader=new Gi(yOt,()=>Q(()=>import("./NativeLine.glsl-c2cfabb3.js"),[]));let Sh=class extends Do{constructor(){super(...arguments),this.output=z.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}};u([j({count:z.COUNT})],Sh.prototype,"output",void 0),u([j()],Sh.prototype,"hasSlicePlane",void 0),u([j()],Sh.prototype,"hasVertexColors",void 0),u([j()],Sh.prototype,"transparent",void 0),u([j()],Sh.prototype,"draped",void 0),u([j()],Sh.prototype,"stippleEnabled",void 0),u([j()],Sh.prototype,"stippleOffColorEnabled",void 0),u([j()],Sh.prototype,"stipplePreferContinuous",void 0),u([j()],Sh.prototype,"hasOccludees",void 0),u([j({constValue:!1})],Sh.prototype,"stippleRequiresClamp",void 0),u([j({constValue:!1})],Sh.prototype,"stippleScaleWithLineWidth",void 0),u([j({constValue:!1})],Sh.prototype,"stippleRequiresStretchMeasure",void 0);var Gz;(function(t){t[t.START=0]="START",t[t.END=1]="END"})(Gz||(Gz={}));let Fve=class extends Bw{constructor(e){super(e,new bOt),this._configuration=new Sh}getConfiguration(e,i){this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.draped=i.slot===Ee.DRAPED_MATERIAL;const r=v(this.parameters.stipplePattern);return this._configuration.stippleEnabled=r,this._configuration.stippleOffColorEnabled=r&&v(this.parameters.stippleOffColor),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._configuration}intersect(e,i,r,n,s,o){if(!r.options.selectionMode||!e.visible)return;if(!RNe(i))return void re.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix");const a=e.vertexAttributes.get(M.POSITION).data,l=r.camera,c=xOt;io(c,r.point);const h=2;he(Q3[0],c[0]-h,c[1]+h,0),he(Q3[1],c[0]+h,c[1]+h,0),he(Q3[2],c[0]+h,c[1]-h,0),he(Q3[3],c[0]-h,c[1]-h,0);for(let _=0;_<4;_++)if(!l.unprojectFromRenderScreen(Q3[_],Xy[_]))return;sl(l.eye,Xy[0],Xy[1],aW),sl(l.eye,Xy[1],Xy[2],lW),sl(l.eye,Xy[2],Xy[3],cW),sl(l.eye,Xy[3],Xy[0],uW);let p=Number.MAX_VALUE,f=0;for(let _=0;_<a.length-5;_+=3){if(Nl[0]=a[_]+i[12],Nl[1]=a[_+1]+i[13],Nl[2]=a[_+2]+i[14],Fl[0]=a[_+3]+i[12],Fl[1]=a[_+4]+i[13],Fl[2]=a[_+5]+i[14],Pr(aW,Nl)<0&&Pr(aW,Fl)<0||Pr(lW,Nl)<0&&Pr(lW,Fl)<0||Pr(cW,Nl)<0&&Pr(cW,Fl)<0||Pr(uW,Nl)<0&&Pr(uW,Fl)<0)continue;if(l.projectToRenderScreen(Nl,Tx),l.projectToRenderScreen(Fl,Sx),Tx[2]<0&&Sx[2]>0){ge(Gm,Nl,Fl);const w=l.frustum,x=-Pr(w[Or.NEAR],Nl)/be(Gm,w[Or.NEAR]);le(Gm,Gm,x),me(Nl,Nl,Gm),l.projectToRenderScreen(Nl,Tx)}else if(Tx[2]>0&&Sx[2]<0){ge(Gm,Fl,Nl);const w=l.frustum,x=-Pr(w[Or.NEAR],Fl)/be(Gm,w[Or.NEAR]);le(Gm,Gm,x),me(Fl,Fl,Gm),l.projectToRenderScreen(Fl,Sx)}else if(Tx[2]<0&&Sx[2]<0)continue;Tx[2]=0,Sx[2]=0;const b=_ae(zS(Tx,Sx,Vve),c);b<p&&(p=b,ce(kve,Nl),ce(Uve,Fl),f=_/3)}const m=r.rayBegin,g=r.rayEnd;if(p<h*h){let _=Number.MAX_VALUE;if(ELe(zS(kve,Uve,Vve),zS(m,g,wOt),xx)){ge(xx,xx,m);const b=Pe(xx);le(xx,xx,1/b),_=b/Lr(m,g)}o(_,xx,f,!1)}}intersectDraped(e,i,r,n,s,o){if(!r.options.selectionMode)return;const a=e.vertexAttributes.get(M.POSITION).data,l=e.vertexAttributes.get(M.SIZE),c=l?l.data[0]:0,h=n[0],p=n[1],f=((c+1)/2+4)*e.screenToWorldRatio;let m=Number.MAX_VALUE,g=0;for(let _=0;_<a.length-5;_+=3){const b=a[_],w=a[_+1],x=h-b,T=p-w,E=a[_+3]-b,C=a[_+4]-w,A=_e((E*x+C*T)/(E*E+C*C),0,1),I=E*A-x,O=C*A-T,D=I*I+O*O;D<m&&(m=D,g=_/3)}m<f*f&&s(o.dist,o.normal,g,!1)}requiresSlot(e,i){return!(i!==z.Color&&i!==z.Highlight&&i!==z.ObjectAndLayerIdColor||e!==Ee.OPAQUE_MATERIAL&&e!==Ee.DRAPED_MATERIAL)}createGLMaterial(e){return new _Ot(e)}createBufferWriter(){const e=this.parameters.hasVertexColors?hke:LAt;return R(this.parameters.stipplePattern)?new YO(e):new vOt(e.clone().vec3f(M.AUXPOS1).vec2f(M.UV0))}},_Ot=class extends zw{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output===z.Color&&this._updateOccludeeState(e);const i=this._material.parameters.stipplePattern;return this._stipplePattern!==i&&(this._material.setParameters(this._stippleTextureRepository.swap(this._stipplePattern,i)),this._stipplePattern=i),this.ensureTechnique(l6e,e)}},vOt=class{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(M.POSITION).length}write(e,i,r,n,s){R4e(r,this.vertexBufferLayout,e,i,n,s),this._writeAuxpos1(e,r,n,s),this._writeUV0(e,r,n,s)}_writeAuxpos1(e,i,r,n){const s=r.getField(M.AUXPOS1,jr),o=i.indices.get(M.POSITION),a=i.vertexAttributes.get(M.POSITION).data,l=e,c=s.typedBufferStride,h=s.typedBuffer;n*=c;for(let p=0;p<o.length-1;p+=2)for(const f of[1,0]){const m=3*o[p+f],g=a[m],_=a[m+1],b=a[m+2],w=l[0]*g+l[4]*_+l[8]*b+l[12],x=l[1]*g+l[5]*_+l[9]*b+l[13],T=l[2]*g+l[6]*_+l[10]*b+l[14];h[n]=w,h[n+1]=x,h[n+2]=T,n+=c}}_writeUV0(e,i,r,n){var T;const s=r.getField(M.UV0,K_),o=i.indices.get(M.POSITION),a=i.vertexAttributes.get(M.POSITION).data,l=(T=i.vertexAttributes.get(M.DISTANCETOSTART))==null?void 0:T.data,c=s.typedBufferStride,h=s.typedBuffer;let p=0;h[n*=c]=Gz.START,h[n+1]=p,n+=c;const f=3*o[0],m=he(Nl,a[f],a[f+1],a[f+2]);e&&Ke(m,m,e);const g=Fl,_=o.length-1;let b=1;const w=l?(E,C,A)=>p=l[A]:(E,C,A)=>p+=Lr(E,C);for(let E=1;E<_;E+=2){const C=3*o[E];he(g,a[C],a[C+1],a[C+2]),e&&Ke(g,g,e),w(m,g,b++);for(let A=0;A<2;++A)h[n]=1-A,h[n+1]=p,n+=c;ce(m,g)}const x=3*o[_];he(g,a[x],a[x+1],a[x+2]),e&&Ke(g,g,e),w(m,g,b),h[n]=Gz.END,h[n+1]=p}},bOt=class extends HO{constructor(){super(...arguments),this.color=dp,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.stipplePreferContinuous=!0,this.hasOccludees=!1,this.stippleTexture=null}};const Nl=P(),Fl=P(),Gm=P(),xx=P(),Tx=ka(),Sx=ka(),kve=P(),Uve=P(),Vve=Cm(),wOt=Cm(),xOt=P(),Q3=[ka(),ka(),ka(),ka()],Xy=[P(),P(),P(),P()],aW=Ji(),lW=Ji(),cW=Ji(),uW=Ji(),TOt=["mesh"];class SOt extends My{constructor(e,i,r,n){super(e,i,r,n),this._materials=new Map,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){tr.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new Fve({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new Fve({color:[0,1,1,1]}))}destroy(){super.destroy(),this._context.stage.removeMany(Array.from(this._materials.values(),e=>e.material)),this._context.stage.removeMany(Array.from(this._textures.values())),this._materials.clear(),this._textures.clear()}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,TOt,"fill on mesh-3d"))return null;const r=this.setGraphicElevationContext(i,new Om),n=e.renderingInfo;return this._createAs3DShape(i,n,r,i.uid)}layerOpacityChanged(e,i){const r=this._getLayerOpacity();this._materials.forEach(n=>{n.material.setParameters({layerOpacity:r});const s=n.material.parameters;this._setMaterialTransparentParameter(s,n),n.material.setParameters({transparent:s.transparent})}),e.forEach(n=>{const s=i(n);v(s)&&s.layerOpacityChanged(r,this._context.isAsync)})}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,Tw)}slicePlaneEnabledChanged(e,i){return this._materials.forEach(r=>{r.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),e.forEach(r=>{const n=i(r);v(n)&&n.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const e=this._usePBR();return this._materials.forEach(i=>i.material.setParameters({usePBR:e})),!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(e){return R(e)?"-":e instanceof Xe?e.toHex():e.contentHash}_materialPropertiesDefault(e,i){const r=this._requiresSymbolVertexColors(),n=!!e.vertexAttributes.color,s=!!e.vertexAttributes.tangent;return{hasSymbolVertexColors:r,hasVertexColors:n,hasVertexTangents:s,uid:`vc:${n},vt:${s},vct${i},svc:${r}`}}_materialProperties(e,i,r){const n=this._materialPropertiesDefault(e,r);if(!i.material)return n;const{color:s,colorTexture:o,normalTexture:a,doubleSided:l,alphaCutoff:c,alphaMode:h}=i.material,p=this._colorOrTextureUid(s),f=this._colorOrTextureUid(o),m=this._colorOrTextureUid(a);if(n.color=s,n.colorTexture=o,n.normalTexture=a,n.uid=`${n.uid},cmuid:${p},ctmuid:${f},ntmuid:${m},ds:${l},ac:${c},am:${h}`,i.material instanceof r6e){const{metallic:g,roughness:_,metallicRoughnessTexture:b,emissiveColor:w,emissiveTexture:x,occlusionTexture:T}=i.material,E=this._colorOrTextureUid(b),C=this._colorOrTextureUid(w),A=this._colorOrTextureUid(x),I=this._colorOrTextureUid(T);n.metallic=g,n.roughness=_,n.metallicRoughnessTexture=b,n.emissiveColor=w,n.emissiveTexture=x,n.occlusionTexture=T,n.colorTextureTransform=i.material.colorTextureTransform,n.normalTextureTransform=i.material.normalTextureTransform,n.emissiveTextureTransform=i.material.emissiveTextureTransform,n.occlusionTextureTransform=i.material.occlusionTextureTransform,n.metallicRoughnessTextureTransform=i.material.metallicRoughnessTextureTransform,n.uid=`${n.uid},mrm:${g},mrr:${_},mrt:${E},emuid:${C},etmuid:${A},otmuid:${I}`}return n}_setInternalColorValueParameters(e,i){i.diffuse=Xe.toUnitRGB(e),i.opacity=e.a}_getLoadableTextureResource(e){return e.data?e.data:e.url}_getInternalTextureId(e){const i=this._getInternalTexture(e,_r.Opaque);return v(i)?i.id:null}_getInternalTexture(e,i){const r=this._getLoadableTextureResource(e);if(!r)return null;const n=`${e.contentHash}/${i}`;let s=this._textures.get(n);return s||(s=new Q2(qS(r)?r.data:r,{mipmap:!0,wrap:this._castTextureWrap(e.wrap),noUnpackFlip:!0,preMultiplyAlpha:!qS(r)&&i!==_r.Opaque,encoding:qS(r)&&v(r.encoding)?r.encoding:void 0}),this._textures.set(n,s),this._context.stage.add(s),this._context.stage.loadImmediate(s)),s}_castTextureWrap(e="repeat"){if(typeof e=="string"){const i=this._castTextureWrapIndividual(e);return{s:i,t:i}}return{s:this._castTextureWrapIndividual(e.horizontal),t:this._castTextureWrapIndividual(e.vertical)}}_castTextureWrapIndividual(e){switch(e){case"clamp":return $t.CLAMP_TO_EDGE;case"mirror":return $t.MIRRORED_REPEAT;default:return $t.REPEAT}}_setInternalMaterialParameters(e,i){if(v(e.color)&&this._setInternalColorValueParameters(e.color,i),v(e.colorTexture)){const r=this._getInternalTexture(e.colorTexture,i.textureAlphaMode);v(r)?(i.textureId=r.id,i.textureAlphaPremultiplied=!!r.params.preMultiplyAlpha):i.textureId=void 0}v(e.normalTexture)&&(i.normalTextureId=this._getInternalTextureId(e.normalTexture)),v(e.emissiveColor)&&(i.emissiveFactor=Xe.toUnitRGB(e.emissiveColor)),v(e.emissiveTexture)&&(i.emissiveTextureId=this._getInternalTextureId(e.emissiveTexture)),v(e.occlusionTexture)&&(i.occlusionTextureId=this._getInternalTextureId(e.occlusionTexture)),v(e.metallicRoughnessTexture)&&(i.metallicRoughnessTextureId=this._getInternalTextureId(e.metallicRoughnessTexture)),i.colorTextureTransformMatrix=kg(e.colorTextureTransform),i.normalTextureTransformMatrix=kg(e.normalTextureTransform),i.occlusionTextureTransformMatrix=kg(e.occlusionTextureTransform),i.emissiveTextureTransformMatrix=kg(e.emissiveTextureTransform),i.metallicRoughnessTextureTransformMatrix=kg(e.metallicRoughnessTextureTransform)}_setExternalMaterialParameters(e){const i=this._drivenProperties.color;let r=v(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;if(i)e.externalColor=dp;else{const n=v(this.symbolLayer.material)?this.symbolLayer.material.color:null;v(n)?e.externalColor=Xe.toUnitRGBA(n):(r=null,e.externalColor=dp)}r&&(e.colorMixMode=r),e.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(e){const i=e.vertexAttributes.color;if(R(i))return!1;for(let r=3;r<i.length;r+=4)if(i[r]!==255)return!0;return!1}_getOrCreateMaterial(e,i){var g,_,b;const r=(g=i.material)==null?void 0:g.color,n=(_=i.material)==null?void 0:_.colorTexture,s=(b=i.material)==null?void 0:b.alphaMode,o=s==="blend",a=s!=="opaque"&&(this._hasTransparentVertexColors(e)||v(r)&&r.a<1||v(n)&&n.transparent||o),l=this._materialProperties(e,i,a),c=this._materials.get(l.uid);if(c)return c.material;const h={material:null,isComponentTransparent:a,alphaMode:i.material?i.material.alphaMode:"opaque"},p=l.metallicRoughnessTexture==null&&l.metallic==null&&l.roughness==null,f={usePBR:this._usePBR(),isSchematic:p,hasVertexColors:l.hasVertexColors,hasSymbolColors:l.hasSymbolVertexColors,hasVertexTangents:l.hasVertexTangents,ambient:dl,diffuse:Vg,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:Dr.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};p||(f.mrrFactors=[l.metallic!=null?l.metallic:1,l.roughness!=null?l.roughness:1,.5]),i.material&&(f.doubleSided=i.material.doubleSided,f.cullFace=i.material.doubleSided?Dr.None:Dr.Back,f.textureAlphaCutoff=i.material.alphaCutoff),this._setExternalMaterialParameters(f),this._setMaterialTransparentParameter(f,h),this._setInternalMaterialParameters(l,f);const m=new F_(f);return h.material=m,this._materials.set(l.uid,h),this._context.stage.add(m),m}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(e,i){e.transparent=this.needsDrivenTransparentPass||i.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,i.alphaMode==="auto"?e.textureAlphaMode=e.transparent?_r.MaskBlend:_r.Opaque:e.textureAlphaMode=i.alphaMode==="opaque"?_r.Opaque:i.alphaMode==="mask"?_r.Mask:_r.Blend}_addDebugNormals(e,i){const r=i.length,n=e.spatialReference.isGeographic?20015077/180:1,s=.1*Math.max(e.extent.width*n,e.extent.height*n,e.extent.zmax-e.extent.zmin),o=[],a=[],l=[],c=[];for(let m=0;m<r;m++){const g=i[m],_=g.vertexAttributes.get(M.POSITION),b=g.vertexAttributes.get(M.NORMAL),w=g.indices.get(M.POSITION),x=g.indices.get(M.NORMAL),T=_.data,E=b.data;for(let C=0;C<w.length;C++){const A=3*w[C],I=3*x[C];for(let O=0;O<3;O++)o.push(T[A+O]);for(let O=0;O<3;O++)o.push(T[A+O]+E[I+O]*s);if(a.push(a.length),a.push(a.length),C%3==0){this._calculateFaceNormal(T,w,C,ZE),this._getFaceVertices(T,w,C,Ma,XE,YE),me(Ma,Ma,XE),me(Ma,Ma,YE),le(Ma,Ma,1/3);for(let O=0;O<3;O++)l.push(Ma[O]);for(let O=0;O<3;O++)l.push(Ma[O]+ZE[O]*s);c.push(c.length),c.push(c.length)}}}const h=i[0].transformation,p=new Os(this._debugVertexNormalMaterial,[[M.POSITION,new Qe(o,3,!0)]],[[M.POSITION,a]],null,Zn.Line);i.push(p),p.transformation=h;const f=new Os(this._debugFaceNormalMaterial,[[M.POSITION,new Qe(l,3,!0)]],[[M.POSITION,c]],null,Zn.Line);f.transformation=h,i.push(f)}_createAs3DShape(e,i,r,n){const s=e.geometry;if(s.type!=="mesh")return null;const o=this._createGeometryInfo(s,i,n);if(R(o))return null;const{geometries:a,objectTransformation:l}=o;tr.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(s,a);const c=new iv({geometries:a,metadata:{layerUid:this._context.layer.uid,graphicUid:n}});c.transformation=l;const h=R5e(this.symbolLayer,{opacity:this._getLayerOpacity()}),p=v(h)?new XEt(a[0].material,[h],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null,f=new Ry(this,c,a,null,null,ND,r,p);f.needsElevationUpdates=Tw(r.mode),f.useObjectOriginAsAttachmentOrigin=!0,r.centerPointInElevationSR=this._getCenterPointInElevationSR(c);const{elevationProvider:m,renderCoordsHelper:g}=this._context,_=(b,w)=>XO(b,m,r,g,w);return f.alignedSampledElevation=ND(f,r,m.spatialReference,_,g),f}_getCenterPointInElevationSR(e){const i=tv(0,0,0,v(this._context.elevationProvider.spatialReference)?this._context.elevationProvider.spatialReference:null);return JAe([e.transformation[12],e.transformation[13],e.transformation[14]],this._context.renderCoordsHelper.spatialReference,i),i}_createComponentNormals(e,i,r,n){switch(r.shading||"flat"){default:case"source":return this._createComponentNormalsSource(e,i,r,n);case"flat":return this._createComponentNormalsFlat(e,n);case"smooth":return this._createComponentNormalsSmooth(e,n)}}_createComponentNormalsSource(e,i,r,n){if(R(i))return this._createComponentNormalsFlat(e,n);let s=!1;if(!r.trustSourceNormals)for(let o=0;o<n.length;o+=3){this._calculateFaceNormal(e,n,o,ZE);for(let a=0;a<3;a++){const l=3*n[o+a];Ma[0]=i[l+0],Ma[1]=i[l+1],Ma[2]=i[l+2],be(ZE,Ma)<0&&(i[l+0]=-i[l+0],i[l+1]=-i[l+1],i[l+2]=-i[l+2],s=!0)}}return new hW(i,n,s)}_createComponentNormalsFlat(e,i){const r=ps(i.length),n=new Array(3*i.length);for(let s=0;s<i.length;s+=3){const o=this._calculateFaceNormal(e,i,s,ZE);for(let a=0;a<3;a++)r[s+a]=o[a],n[s+a]=s/3}return new hW(r,n,!1)}_createComponentNormalsSmooth(e,i){const r={};for(let o=0;o<i.length;o+=3){const a=this._calculateFaceNormal(e,i,o,ZE);for(let l=0;l<3;l++){const c=i[o+l];let h=r[c];h||(h={normal:P(),count:0},r[c]=h),me(h.normal,h.normal,a),h.count++}}const n=ps(3*i.length),s=new Array(3*i.length);for(let o=0;o<i.length;o++){const a=r[i[o]];a.count!==1&&(we(a.normal,a.normal),a.count=1);for(let l=0;l<3;l++)n[3*o+l]=a.normal[l];s[o]=o}return new hW(n,s,!1)}_getFaceVertices(e,i,r,n,s,o){const a=3*i[r+0],l=3*i[r+1],c=3*i[r+2];n[0]=e[a+0],n[1]=e[a+1],n[2]=e[a+2],s[0]=e[l+0],s[1]=e[l+1],s[2]=e[l+2],o[0]=e[c+0],o[1]=e[c+1],o[2]=e[c+2]}_calculateFaceNormal(e,i,r,n){return this._getFaceVertices(e,i,r,Ma,XE,YE),ge(XE,XE,Ma),ge(YE,YE,Ma),vt(Ma,XE,YE),we(n,Ma),n}_getOrCreateComponents(e){return Nt(e.components,EOt)}_createPositionBuffer(e,i){let r=e.vertexAttributes.position;const n=i.reprojection===Mh.ECEF?i.transformBeforeProject:null;if(v(n)&&(r=cOt(r,new Float64Array(r.length),n)),i.reprojection===Mh.NONE)return i.needsBufferCopy?new Float64Array(r):r;const s=v(n)?r:new Float64Array(r.length);return Nn(r,e.spatialReference,0,s,this._context.renderCoordsHelper.spatialReference,0,r.length/3),s}_createNormalBuffer(e,i,r){let n=e.vertexAttributes.normal;if(R(n))return null;const s=r.reprojection===Mh.ECEF?r.transformBeforeProject:null;if(v(s)&&(n=uOt(n,new Float32Array(n.length),s)),this._context.graphicsCoreOwner.view.viewingMode==="local"||r.reprojection===Mh.NONE)return r.needsBufferCopy&&e.vertexAttributes.normal===n?new Float32Array(n):n;const o=e.vertexAttributes.position,a=v(s)?n:new Float32Array(n.length);return lOt(n,o,i,e.spatialReference,a)}_createTangentBuffer(e,i,r){let n=e.vertexAttributes.tangent;if(R(n))return null;const s=r.reprojection===Mh.ECEF?r.transformBeforeProject:null;if(v(s)&&(n=hOt(n,new Float32Array(n.length),s)),this._context.graphicsCoreOwner.view.viewingMode==="local"||r.reprojection===Mh.NONE)return r.needsBufferCopy&&e.vertexAttributes.normal===n?new Float32Array(n):n;const o=e.vertexAttributes.position,a=v(s)?n:new Float32Array(n.length);return dOt(n,o,i,e.spatialReference,a)}_createColorBuffer(e){return e.vertexAttributes.color}_createSymbolColorBuffer(e){if(this._requiresSymbolVertexColors()){const i=this._getVertexOpacityAndColor(e),r=SRt(Js(this.symbolLayer,"material","colorMixMode")),n=new Uint8Array(4);return Dke(i,r,n),n}return null}_createBuffers(e,i){const r=e.vertexAttributes&&e.vertexAttributes.position;if(!r)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const n=e.vertexAttributes.normal,s=e.vertexAttributes.uv,o=e.vertexAttributes.tangent;if(v(n)&&n.length!==r.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(v(o)&&o.length/4!=r.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(v(s)&&s.length/2!=r.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const a=this._computeReprojectionInfo(e),l=this._createPositionBuffer(e,a),c=this._createColorBuffer(e),h=this._createSymbolColorBuffer(i),p=this._createNormalBuffer(e,l,a),f=this._createTangentBuffer(e,l,a);return{positionBuffer:l,normalBuffer:p,tangentBuffer:f,uvBuffer:s,colorBuffer:c,symbolColorBuffer:h,objectTransformation:a.reprojection===Mh.NONE&&v(a.objectTransformation)?a.objectTransformation:this._transformOriginLocal(e,l,p,f),geometryTransformation:a.reprojection===Mh.NONE&&v(a.geometryTransformation)?a.geometryTransformation:$e()}}_computeReprojectionInfo(e){const i=v(e.transform),r=i&&e.transform.geographic||this._context.renderCoordsHelper.viewingMode===qe.Local?Mh.NONE:Mh.ECEF;if(i){if(r===Mh.NONE){const s=$e();return ym(e.spatialReference,e.transform.origin,s,this._context.renderCoordsHelper.spatialReference),{reprojection:r,objectTransformation:s,geometryTransformation:HM(e.transform.localMatrix),needsBufferCopy:!1}}const n=sB($e(),e.transform.origin);return $n(n,n,e.transform.localMatrix),{reprojection:r,transformBeforeProject:n,needsBufferCopy:!0}}return{reprojection:r,needsBufferCopy:!0}}_transformOriginLocal(e,i,r,n){const s=this._context.renderCoordsHelper.spatialReference,o=e.anchor;Y5[0]=o.x,Y5[1]=o.y,Y5[2]=o.z;const a=$e();ym(e.spatialReference,Y5,a,s);const l=_l.fromTypedArray(i);if(wa(zve,a),rF(l,l,zve),v(r)||v(n)){if(Dp(eP,a),Qu(eP,eP),v(r)){const c=jr.fromTypedArray(r);Ew(c,c,eP)}if(v(n)){const c=jr.fromTypedArray(n,4*n.BYTES_PER_ELEMENT);Ew(c,c,eP)}}return a}_validateFaces(e,i){const r=e.vertexAttributes.position.length/3,n=i.faces;if(n){let s=-1;for(let o=0;o<n.length;o++){const a=n[o];a>s&&(s=a)}if(r<=s)return this.logger.warn(`Vertex index ${s} is out of bounds of the mesh position buffer`),!1}else if(r%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(e,i){return i.faces?i.faces:ZM(e.vertexAttributes.position.length/3)}_isOutsideClippingArea(e){if(!this._context.clippingExtent)return!1;const i=e.vertexAttributes&&e.vertexAttributes.position;if(!i)return!1;const r=this._context.elevationProvider.spatialReference;let n;const s=i.length/3;return v(r)&&!e.spatialReference.equals(r)?(n=new Float64Array(i.length),Nn(e.vertexAttributes.position,e.spatialReference,0,n,r,0,s)):n=i,Br(dW),Kh(dW,n,0,s),!Zf(dW,this._context.clippingExtent)}_createGeometryInfo(e,i,r){if(!my(e.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(e))return null;const n=this._createBuffers(e,i);if(R(n))return null;const{positionBuffer:s,uvBuffer:o,colorBuffer:a,symbolColorBuffer:l,normalBuffer:c,tangentBuffer:h,objectTransformation:p,geometryTransformation:f}=n,m=this._getOrCreateComponents(e),g=new Array;let _=!1;for(const b of m){if(!this._validateFaces(e,b))return null;const w=this._getOrCreateFaces(e,b);if(w.length===0)continue;const x=this._createComponentNormals(s,c,b,w);x.didFlipNormals&&(_=!0);const T=[[M.POSITION,new Qe(s,3,!0)],[M.NORMAL,new Qe(x.normals,3,!0)]],E=[[M.POSITION,w],[M.NORMAL,x.indices]];v(a)&&(T.push([M.COLOR,new Qe(a,4,!0)]),E.push([M.COLOR,w])),v(l)&&(T.push([M.SYMBOLCOLOR,new Qe(l,4,!0)]),E.push([M.SYMBOLCOLOR,new Array(w.length).fill(0)])),v(o)&&(T.push([M.UV0,new Qe(o,2,!0)]),E.push([M.UV0,w])),v(h)&&(T.push([M.TANGENT,new Qe(h,4,!0)]),E.push([M.TANGENT,w]));const C=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:r,layerUid:this._context.layer.uid}),A=this._getOrCreateMaterial(e,b),I=new Os(A,T,E,null,Zn.Mesh,C);I.transformation=f,g.push(I)}return _&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:g,objectTransformation:p}}}let hW=class{constructor(e,i,r){this.normals=e,this.indices=i,this.didFlipNormals=r}};const Y5=P(),Ma=P(),XE=P(),YE=P(),ZE=P(),zve=$e(),eP=wr(),dW=to(),EOt=[new aOt];var Mh;(function(t){t[t.NONE=0]="NONE",t[t.ECEF=1]="ECEF"})(Mh||(Mh={}));let COt=class{constructor(e,i,r,n){this.graphics3DSymbolLayer=e,this.instanceIndex=i,this.elevationAligner=r,this.elevationContext=n,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(e){const i=this._lodRenderer.instanceData;e!==i.getVisible(this.instanceIndex)&&i.setVisible(this.instanceIndex,e)}destroy(){this.instanceIndex!=null&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(e,i,r){if(this.elevationAligner){Zle(this.elevationContext.featureExpressionInfoContext,r);const n=(o,a)=>XO(o,e,this.elevationContext,i,a),s=this.elevationAligner(this,this.elevationContext,e.spatialReference,n,i);v(s)&&(this.alignedSampledElevation=s)}}getCenterObjectSpace(e=P()){return this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Hm),Ke(e,this._lodRenderer.baseBoundingSphere.center,Hm)}getBoundingBoxObjectSpace(e=to()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Hm);const i=this._lodRenderer.baseBoundingBox;Br(e);for(let r=0;r<8;++r)he(Sd,1&r?i[3]:i[0],2&r?i[4]:i[1],4&r?i[5]:i[2]),Ke(Sd,Sd,Hm),py(e,Sd);return e}computeAttachmentOrigin(e){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Hm),e.render.origin[0]+=Hm[12],e.render.origin[1]+=Hm[13],e.render.origin[2]+=Hm[14],e.render.num++}async getProjectedBoundingBox(e,i,r,n,s){const o=this.getBoundingBoxObjectSpace(s),a=AOt,l=Vne(o)?1:a.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Hm);for(let h=0;h<l;h++){const p=a[h];Sd[0]=o[p[0]],Sd[1]=o[p[1]],Sd[2]=o[p[2]],Ke(Sd,Sd,Hm),Ex[3*h+0]=Sd[0],Ex[3*h+1]=Sd[1],Ex[3*h+2]=Sd[2]}if(!e(Ex,0,l))return null;Br(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let p=0;p<3;p++)o[p]=Math.min(o[p],Ex[h+p]),o[p+3]=Math.max(o[p+3],Ex[h+p]);c&&r.push({location:Ex.slice(h,h+3),screenSpaceBoundingRect:c})}if(i&&(Yf(o,pW),this.elevationContext.mode!=="absolute-height")){let h;const p=Wle(o,i.service.spatialReference,i);try{h=await i.service.queryElevation(pW[0],pW[1],n,p,"ground")}catch{}v(h)&&ECe(o,0,0,-this.alignedSampledElevation+h)}return o}addObjectState(e,i){if(e===$_.Highlight){const r=new pz(e);this._addHighlightId(r),i.addExternal(n=>{this._removeHighlightId(n)},r)}}removeObjectState(e){this._highlights.forEach(i=>e.remove(i))}_addHighlightId(e){this._highlights.add(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(e){this._highlights.delete(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get _lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}};const Ex=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Sd=P(),pW=P(),AOt=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],Hm=$e();function ROt(t){const e=new Array;return t.stageResources.geometries.forEach(i=>{const r=t.stageResources.textures;e.push(new E5e(i,r))}),{components:e,minScreenSpaceRadius:Nt(t.lodThreshold,0),pivotOffset:t.pivotOffset}}function MOt(t){return{levels:t.map(e=>ROt(e))}}function OOt(t,e,i){if(t.count!==e.count)return void M7.error("source and destination buffers need to have the same number of elements");const r=t.count,n=i[0],s=i[1],o=i[2],a=i[3],l=i[4],c=i[5],h=i[6],p=i[7],f=i[8],m=i[9],g=i[10],_=i[11],b=i[12],w=i[13],x=i[14],T=i[15],E=t.typedBuffer,C=t.typedBufferStride,A=e.typedBuffer,I=e.typedBufferStride;for(let O=0;O<r;O++){const D=O*C,U=O*I,V=A[U],B=A[U+1],ee=A[U+2],ie=A[U+3];E[D]=n*V+l*B+f*ee+b*ie,E[D+1]=s*V+c*B+m*ee+w*ie,E[D+2]=o*V+h*B+g*ee+x*ie,E[D+3]=a*V+p*B+_*ee+T*ie}}function u6e(t,e,i){if(t.count!==e.count)return void M7.error("source and destination buffers need to have the same number of elements");const r=t.count,n=i[0],s=i[1],o=i[2],a=i[3],l=i[4],c=i[5],h=i[6],p=i[7],f=i[8],m=t.typedBuffer,g=t.typedBufferStride,_=e.typedBuffer,b=e.typedBufferStride;for(let w=0;w<r;w++){const x=w*g,T=w*b,E=_[T],C=_[T+1],A=_[T+2],I=_[T+3];m[x]=n*E+a*C+h*A,m[x+1]=s*E+l*C+p*A,m[x+2]=o*E+c*C+f*A,m[x+3]=I}}function POt(t,e){const i=Math.min(t.count,e.count),r=t.typedBuffer,n=t.typedBufferStride,s=e.typedBuffer,o=e.typedBufferStride;for(let a=0;a<i;a++){const l=a*n,c=a*o,h=s[c],p=s[c+1],f=s[c+2],m=h*h+p*p+f*f;if(m>0){const g=1/Math.sqrt(m);r[l]=g*h,r[l+1]=g*p,r[l+2]=g*f}}}function jte(t,e,i){const r=Math.min(t.count,e.count),n=t.typedBuffer,s=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;for(let l=0;l<r;l++){const c=l*s,h=l*a;n[c]=i*o[h],n[c+1]=i*o[h+1],n[c+2]=i*o[h+2],n[c+3]=i*o[h+3]}}function IOt(t,e,i){const r=Math.min(t.count,e.count),n=t.typedBuffer,s=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;for(let l=0;l<r;l++){const c=l*s,h=l*a;n[c]=o[h]>>i,n[c+1]=o[h+1]>>i,n[c+2]=o[h+2]>>i,n[c+3]=o[h+3]>>i}}Object.freeze(Object.defineProperty({__proto__:null,normalize:POt,scale:jte,shiftRight:IOt,transformMat3:u6e,transformMat4:OOt},Symbol.toStringTag,{value:"Module"}));function $Ot(t,e,i){const r=t.typedBuffer,n=t.typedBufferStride,s=e.typedBuffer,o=e.typedBufferStride,a=i?i.count:e.count;let l=(i&&i.dstIndex?i.dstIndex:0)*n,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h){for(let p=0;p<9;++p)r[l+p]=s[c+p];l+=n,c+=o}}Object.freeze(Object.defineProperty({__proto__:null,copy:$Ot},Symbol.toStringTag,{value:"Module"}));function LOt(t,e,i){const r=t.typedBuffer,n=t.typedBufferStride,s=e.typedBuffer,o=e.typedBufferStride,a=i?i.count:e.count;let l=(i&&i.dstIndex?i.dstIndex:0)*n,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h){for(let p=0;p<16;++p)r[l+p]=s[c+p];l+=n,c+=o}}Object.freeze(Object.defineProperty({__proto__:null,copy:LOt},Symbol.toStringTag,{value:"Module"}));function DOt(t,e,i){const r=t.typedBuffer,n=t.typedBufferStride,s=e.typedBuffer,o=e.typedBufferStride,a=i?i.count:e.count;let l=(i&&i.dstIndex?i.dstIndex:0)*n,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=s[c],l+=n,c+=o}function GU(t,e){const i=t.count;e||(e=new t.TypedArrayConstructor(i));for(let r=0;r<i;r++)e[r]=t.get(r);return e}Object.freeze(Object.defineProperty({__proto__:null,copy:DOt,makeDense:GU},Symbol.toStringTag,{value:"Module"}));function h6e(t,e,i){const r=t.typedBuffer,n=t.typedBufferStride,s=e.typedBuffer,o=e.typedBufferStride,a=i?i.count:e.count;let l=(i&&i.dstIndex?i.dstIndex:0)*n,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=s[c],r[l+1]=s[c+1],l+=n,c+=o}function d6e(t,e,i){const r=t.typedBuffer,n=t.typedBufferStride,s=e.typedBuffer,o=e.typedBufferStride,a=i?i.count:e.count;let l=(i&&i.dstIndex?i.dstIndex:0)*n,c=(i&&i.srcIndex?i.srcIndex:0)*o;if(wvt(e.elementType)){const h=xvt(e.elementType);if(bvt(e.elementType))for(let p=0;p<a;++p)r[l]=Math.max(s[c]/h,-1),r[l+1]=Math.max(s[c+1]/h,-1),l+=n,c+=o;else for(let p=0;p<a;++p)r[l]=s[c]/h,r[l+1]=s[c+1]/h,l+=n,c+=o}else h6e(t,e,i);return t}function NOt(t,e,i,r){const n=t.typedBuffer,s=t.typedBufferStride,o=(r==null?void 0:r.count)??t.count;let a=((r==null?void 0:r.dstIndex)??0)*s;for(let l=0;l<o;++l)n[a]=e,n[a+1]=i,a+=s}Object.freeze(Object.defineProperty({__proto__:null,copy:h6e,fill:NOt,normalizeIntegerBuffer:d6e},Symbol.toStringTag,{value:"Module"}));function V7(t,e,i){const r=t.typedBuffer,n=t.typedBufferStride,s=e.typedBuffer,o=e.typedBufferStride,a=i?i.count:e.count;let l=(i&&i.dstIndex?i.dstIndex:0)*n,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=s[c],r[l+1]=s[c+1],r[l+2]=s[c+2],l+=n,c+=o}function FOt(t,e,i,r,n){const s=t.typedBuffer,o=t.typedBufferStride,a=(n==null?void 0:n.count)??t.count;let l=((n==null?void 0:n.dstIndex)??0)*o;for(let c=0;c<a;++c)s[l]=e,s[l+1]=i,s[l+2]=r,l+=o}Object.freeze(Object.defineProperty({__proto__:null,copy:V7,fill:FOt},Symbol.toStringTag,{value:"Module"}));function p6e(t,e,i){const r=t.typedBuffer,n=t.typedBufferStride,s=e.typedBuffer,o=e.typedBufferStride,a=i?i.count:e.count;let l=(i&&i.dstIndex?i.dstIndex:0)*n,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=s[c],r[l+1]=s[c+1],r[l+2]=s[c+2],r[l+3]=s[c+3],l+=n,c+=o}function f6e(t,e,i,r,n,s){const o=t.typedBuffer,a=t.typedBufferStride,l=(s==null?void 0:s.count)??t.count;let c=((s==null?void 0:s.dstIndex)??0)*a;for(let h=0;h<l;++h)o[c]=e,o[c+1]=i,o[c+2]=r,o[c+3]=n,c+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:p6e,fill:f6e},Symbol.toStringTag,{value:"Module"}));function aS(t,e){return new t(new ArrayBuffer(e*t.ElementCount*ENe(t.ElementType)))}let m6e=class{constructor(e){this._streamDataRequester=e}async loadJSON(e,i){return this._load("json",e,i)}async loadBinary(e,i){return fd(e)?(ui(i),Wne(e)):this._load("binary",e,i)}async loadImage(e,i){return this._load("image",e,i)}async _load(e,i,r){if(R(this._streamDataRequester))return(await ir(i,{responseType:kOt[e]})).data;const n=await _m(this._streamDataRequester.request(i,e,r));if(n.ok===!0)return n.value;throw Du(n.error),new H("",`Request for resource failed: ${n.error}`)}};const kOt={image:"image",binary:"array-buffer",json:"json"};function UOt(t={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...t}}function VOt(t,e={}){return{data:t,parameters:{wrap:{s:$t.REPEAT,t:$t.REPEAT,...e.wrap},noUnpackFlip:!0,mipmap:!1,...e}}}let I2=class{constructor(e,i,r=""){this.major=e,this.minor=i,this._context=r}lessThan(e,i){return this.major<e||e===this.major&&this.minor<i}since(e,i){return!this.lessThan(e,i)}validate(e){if(this.major!==e.major){const i=this._context&&this._context+":",r=this._context&&this._context+" ";throw new H(i+"unsupported-version",`Required major ${r}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new I2(this.major,this.minor,this._context)}static parse(e,i=""){const[r,n]=e.split("."),s=/^\s*\d+\s*$/;if(!r||!r.match||!r.match(s))throw new H((i&&i+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!n||!n.match||!n.match(s))throw new H((i&&i+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});const o=parseInt(r,10),a=parseInt(n,10);return new I2(o,a,i)}},Bve=class{constructor(e){this._data=e,this._offset4=0,this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const e=this._offset4;return this._offset4+=1,this._dataUint32[e]}readUint8Array(e){const i=4*this._offset4;return this._offset4+=e/4,new Uint8Array(this._data,i,e)}remainingBytes(){return this._data.byteLength-4*this._offset4}};var lL,jve;(function(t){t.SCALAR="SCALAR",t.VEC2="VEC2",t.VEC3="VEC3",t.VEC4="VEC4",t.MAT2="MAT2",t.MAT3="MAT3",t.MAT4="MAT4"})(lL||(lL={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(jve||(jve={}));const g6e={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},zOt={pbrMetallicRoughness:g6e,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},BOt={ESRI_externalColorMixMode:"tint"},Gve=(t={})=>{const e={...g6e,...t.pbrMetallicRoughness},i=jOt({...BOt,...t.extras});return{...zOt,...t,pbrMetallicRoughness:e,extras:i}};function jOt(t){switch(t.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:t.ESRI_externalColorMixMode,t.ESRI_externalColorMixMode="tint"}return t}const GOt={magFilter:nt.LINEAR,minFilter:nt.LINEAR_MIPMAP_LINEAR,wrapS:$t.REPEAT,wrapT:$t.REPEAT},HOt=t=>({...GOt,...t});function qOt(t){let e,i;return t.replace(/^(.*\/)?([^/]*)$/,(r,n,s)=>(e=n||"",i=s||"","")),{dirPart:e,filePart:i}}const Z5={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};let WOt=class P1{constructor(e,i,r,n){if(this._context=e,this.uri=i,this.json=r,this._glbBuffer=n,this._bufferLoaders=new Map,this._textureLoaders=new Map,this._textureCache=new Map,this._materialCache=new Map,this._nodeParentMap=new Map,this._nodeTransformCache=new Map,this._supportedExtensions=["KHR_texture_basisu"],this._baseUri=qOt(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),r.scenes==null)throw new H("gltf-loader-unsupported-feature","Scenes must be defined.");if(r.meshes==null)throw new H("gltf-loader-unsupported-feature","Meshes must be defined");if(r.nodes==null)throw new H("gltf-loader-unsupported-feature","Nodes must be defined.");this._computeNodeParents()}static async load(e,i,r){if(fd(i)){const o=vO(i);if(o&&o.mediaType!=="model/gltf-binary")try{const l=JSON.parse(o.isBase64?atob(o.data):o.data);return new P1(e,i,l)}catch{}const a=Wne(i);if(P1._isGLBData(a))return this._fromGLBData(e,i,a)}if(i.endsWith(".gltf")){const o=await e.loadJSON(i,r);return new P1(e,i,o)}const n=await e.loadBinary(i,r);if(P1._isGLBData(n))return this._fromGLBData(e,i,n);const s=await e.loadJSON(i,r);return new P1(e,i,s)}static _isGLBData(e){if(e==null)return!1;const i=new Bve(e);return i.remainingBytes()>=4&&i.readUint32()===Z5.MAGIC}static async _fromGLBData(e,i,r){const n=await P1._parseGLBData(r);return new P1(e,i,n.json,n.binaryData)}static async _parseGLBData(e){const i=new Bve(e);if(i.remainingBytes()<12)throw new H("gltf-loader-error","GLB binary data is insufficiently large.");const r=i.readUint32(),n=i.readUint32(),s=i.readUint32();if(r!==Z5.MAGIC)throw new H("gltf-loader-error","Magic first 4 bytes do not fit to expected GLB value.");if(e.byteLength<s)throw new H("gltf-loader-error","GLB binary data is smaller than header specifies.");if(n!==2)throw new H("gltf-loader-unsupported-feature","An unsupported GLB container version was detected. Only version 2 is supported.");let o,a,l=0;for(;i.remainingBytes()>=8;){const c=i.readUint32(),h=i.readUint32();if(l===0){if(h!==Z5.CHUNK_TYPE_JSON)throw new H("gltf-loader-error","First GLB chunk must be JSON.");if(c<0)throw new H("gltf-loader-error","No JSON data found.");o=await fOt(i.readUint8Array(c))}else if(l===1){if(h!==Z5.CHUNK_TYPE_BIN)throw new H("gltf-loader-unsupported-feature","Second GLB chunk expected to be BIN.");a=i.readUint8Array(c)}else re.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 GLB chunks detected. Skipping.");l+=1}if(!o)throw new H("gltf-loader-error","No GLB JSON chunk detected.");return{json:o,binaryData:a}}async getBuffer(e,i){const r=this.json.buffers[e];if(r.uri==null){if(this._glbBuffer==null)throw new H("gltf-loader-error","GLB buffer not present");return this._glbBuffer}const n=await this._getBufferLoader(e,i);if(n.byteLength!==r.byteLength)throw new H("gltf-loader-error","Buffer byte lengths should match.");return n}async _getBufferLoader(e,i){const r=this._bufferLoaders.get(e);if(r)return r;const n=this.json.buffers[e].uri,s=this._context.loadBinary(this._resolveUri(n),i).then(o=>new Uint8Array(o));return this._bufferLoaders.set(e,s),s}async getAccessor(e,i){if(!this.json.accessors)throw new H("gltf-loader-unsupported-feature","Accessors missing.");const r=this.json.accessors[e];if((r==null?void 0:r.bufferView)==null)throw new H("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(r.type in[lL.MAT2,lL.MAT3,lL.MAT4])throw new H("gltf-loader-unsupported-feature",`AttributeType ${r.type} is not supported`);const n=this.json.bufferViews[r.bufferView],s=await this.getBuffer(n.buffer,i),o=ZOt[r.type],a=JOt[r.componentType],l=o*a,c=n.byteStride||l;return{raw:s.buffer,byteStride:c,byteOffset:s.byteOffset+(n.byteOffset||0)+(r.byteOffset||0),entryCount:r.count,isDenselyPacked:c===l,componentCount:o,componentByteSize:a,componentType:r.componentType,min:r.min,max:r.max,normalized:!!r.normalized}}async getIndexData(e,i){if(e.indices==null)return;const r=await this.getAccessor(e.indices,i);if(r.isDenselyPacked)switch(r.componentType){case ft.UNSIGNED_BYTE:return new Uint8Array(r.raw,r.byteOffset,r.entryCount);case ft.UNSIGNED_SHORT:return new Uint16Array(r.raw,r.byteOffset,r.entryCount);case ft.UNSIGNED_INT:return new Uint32Array(r.raw,r.byteOffset,r.entryCount)}else switch(r.componentType){case ft.UNSIGNED_BYTE:return GU(this._wrapAccessor(YM,r));case ft.UNSIGNED_SHORT:return GU(this._wrapAccessor(n7,r));case ft.UNSIGNED_INT:return GU(this._wrapAccessor(o7,r))}}async getPositionData(e,i){if(e.attributes.POSITION==null)throw new H("gltf-loader-unsupported-feature","No POSITION vertex data found.");const r=await this.getAccessor(e.attributes.POSITION,i);if(r.componentType!==ft.FLOAT)throw new H("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+ft[r.componentType]);if(r.componentCount!==3)throw new H("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+r.componentCount.toFixed());return this._wrapAccessor(jr,r)}async getNormalData(e,i){if(e.attributes.NORMAL==null)throw new H("gltf-loader-error","No NORMAL vertex data found.");const r=await this.getAccessor(e.attributes.NORMAL,i);if(r.componentType!==ft.FLOAT)throw new H("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+ft[r.componentType]);if(r.componentCount!==3)throw new H("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+r.componentCount.toFixed());return this._wrapAccessor(jr,r)}async getTangentData(e,i){if(e.attributes.TANGENT==null)throw new H("gltf-loader-error","No TANGENT vertex data found.");const r=await this.getAccessor(e.attributes.TANGENT,i);if(r.componentType!==ft.FLOAT)throw new H("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+ft[r.componentType]);if(r.componentCount!==4)throw new H("gltf-loader-unsupported-feature","TANGENT vertex attribute must have 4 components, but found "+r.componentCount.toFixed());return new eh(r.raw,r.byteOffset,r.byteStride,r.byteOffset+r.byteStride*r.entryCount)}async getTextureCoordinates(e,i){if(e.attributes.TEXCOORD_0==null)throw new H("gltf-loader-error","No TEXCOORD_0 vertex data found.");const r=await this.getAccessor(e.attributes.TEXCOORD_0,i);if(r.componentCount!==2)throw new H("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+r.componentCount.toFixed());if(r.componentType===ft.FLOAT)return this._wrapAccessor(K_,r);if(!r.normalized)throw new H("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return KOt(r)}async getVertexColors(e,i){if(e.attributes.COLOR_0==null)throw new H("gltf-loader-error","No COLOR_0 vertex data found.");const r=await this.getAccessor(e.attributes.COLOR_0,i);if(r.componentCount!==4&&r.componentCount!==3)throw new H("gltf-loader-unsupported-feature","COLOR_0 attribute must have 3 or 4 components, but found "+r.componentCount.toFixed());if(r.componentCount===4){if(r.componentType===ft.FLOAT)return this._wrapAccessor(eh,r);if(r.componentType===ft.UNSIGNED_BYTE)return this._wrapAccessor(vl,r);if(r.componentType===ft.UNSIGNED_SHORT)return this._wrapAccessor(XN,r)}else if(r.componentCount===3){if(r.componentType===ft.FLOAT)return this._wrapAccessor(jr,r);if(r.componentType===ft.UNSIGNED_BYTE)return this._wrapAccessor(ED,r);if(r.componentType===ft.UNSIGNED_SHORT)return this._wrapAccessor(s7,r)}throw new H("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+ft[r.componentType])}hasPositions(e){return e.attributes.POSITION!==void 0}hasNormals(e){return e.attributes.NORMAL!==void 0}hasVertexColors(e){return e.attributes.COLOR_0!==void 0}hasTextureCoordinates(e){return e.attributes.TEXCOORD_0!==void 0}hasTangents(e){return e.attributes.TANGENT!==void 0}async getMaterial(e,i,r){var s,o,a,l,c,h,p,f,m,g;let n=e.material?this._materialCache.get(e.material):void 0;if(!n){const _=e.material!=null?Gve(this.json.materials[e.material]):Gve(),b=_.pbrMetallicRoughness,w=this.hasVertexColors(e),x=this.getTexture(b.baseColorTexture,i),T=this.getTexture(_.normalTexture,i),E=r?this.getTexture(_.occlusionTexture,i):void 0,C=r?this.getTexture(_.emissiveTexture,i):void 0,A=r?this.getTexture(b.metallicRoughnessTexture,i):void 0,I=e.material!=null?e.material:-1;n={alphaMode:_.alphaMode,alphaCutoff:_.alphaCutoff,color:b.baseColorFactor,doubleSided:!!_.doubleSided,colorTexture:await x,normalTexture:await T,name:_.name,id:I,occlusionTexture:await E,emissiveTexture:await C,emissiveFactor:_.emissiveFactor,metallicFactor:b.metallicFactor,roughnessFactor:b.roughnessFactor,metallicRoughnessTexture:await A,hasVertexColors:w,ESRI_externalColorMixMode:_.extras.ESRI_externalColorMixMode,colorTextureTransform:(o=(s=b==null?void 0:b.baseColorTexture)==null?void 0:s.extensions)==null?void 0:o.KHR_texture_transform,normalTextureTransform:(l=(a=_.normalTexture)==null?void 0:a.extensions)==null?void 0:l.KHR_texture_transform,occlusionTextureTransform:(h=(c=_.occlusionTexture)==null?void 0:c.extensions)==null?void 0:h.KHR_texture_transform,emissiveTextureTransform:(f=(p=_.emissiveTexture)==null?void 0:p.extensions)==null?void 0:f.KHR_texture_transform,metallicRoughnessTextureTransform:(g=(m=b==null?void 0:b.metallicRoughnessTexture)==null?void 0:m.extensions)==null?void 0:g.KHR_texture_transform}}return n}async getTexture(e,i){if(!e)return;if((e.texCoord||0)!==0)throw new H("gltf-loader-unsupported-feature","Only TEXCOORD with index 0 is supported.");const r=e.index,n=this.json.textures[r],s=HOt(n.sampler!=null?this.json.samplers[n.sampler]:{}),o=this._getTextureSourceId(n),a=this.json.images[o],l=await this._loadTextureImageData(r,n,i);return qre(this._textureCache,r,()=>{const c=p=>p===33071||p===33648||p===10497,h=p=>{throw new H("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${p}`)};return{data:l,wrapS:c(s.wrapS)?s.wrapS:h(s.wrapS),wrapT:c(s.wrapT)?s.wrapT:h(s.wrapT),minFilter:s.minFilter,name:a.name,id:r}})}getNodeTransform(e){if(e===void 0)return XOt;let i=this._nodeTransformCache.get(e);if(!i){const r=this.getNodeTransform(this._getNodeParent(e)),n=this.json.nodes[e];n.matrix?i=$n($e(),r,n.matrix):n.translation||n.rotation||n.scale?(i=HM(r),n.translation&&Yc(i,i,n.translation),n.rotation&&(J5[3]=sle(J5,n.rotation),Vu(i,i,J5[3],J5)),n.scale&&rB(i,i,n.scale)):i=HM(r),this._nodeTransformCache.set(e,i)}return i}_wrapAccessor(e,i){return new e(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*(i.entryCount-1)+i.componentByteSize*i.componentCount)}_resolveUri(e){return zc(e,this._baseUri)}_getNodeParent(e){return this._nodeParentMap.get(e)}_checkVersionSupported(){const e=I2.parse(this.json.asset.version,"glTF");YOt.validate(e)}_checkRequiredExtensionsSupported(){const e=this.json;if(e.extensionsRequired&&!e.extensionsRequired.every(i=>this._supportedExtensions.includes(i)))throw new H("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+e.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((e,i)=>{e.children&&e.children.forEach(r=>{this._nodeParentMap.set(r,i)})})}async _loadTextureImageData(e,i,r){const n=this._textureLoaders.get(e);if(n)return n;const s=this._createTextureLoader(i,r);return this._textureLoaders.set(e,s),s}_getTextureSourceId(e){if(e.extensions!==void 0&&e.extensions.KHR_texture_basisu!==null)return e.extensions.KHR_texture_basisu.source;if(e.source!==null)return e.source;throw new H("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.")}async _createTextureLoader(e,i){const r=this._getTextureSourceId(e),n=this.json.images[r];if(n.uri){if(n.uri.endsWith(".ktx2")){const l=await this._context.loadBinary(this._resolveUri(n.uri),i);return new a6e(new Uint8Array(l))}return this._context.loadImage(this._resolveUri(n.uri),i)}if(n.bufferView==null)throw new H("gltf-loader-unsupported-feature","Image bufferView must be defined.");if(n.mimeType==null)throw new H("gltf-loader-unsupported-feature","Image mimeType must be defined.");const s=this.json.bufferViews[n.bufferView],o=await this.getBuffer(s.buffer,i);if(s.byteStride!=null)throw new H("gltf-loader-unsupported-feature","byteStride not supported for image buffer");const a=o.byteOffset+(s.byteOffset||0);return mOt(new Uint8Array(o.buffer,a,s.byteLength),n.mimeType)}async getLoadedBuffersSize(){if(this._glbBuffer)return this._glbBuffer.byteLength;const e=await mY(Array.from(this._bufferLoaders.values())),i=await mY(Array.from(this._textureLoaders.values()));return e.reduce((r,n)=>r+((n==null?void 0:n.byteLength)??0),0)+i.reduce((r,n)=>r+(n?qS(n)?n.data.byteLength:n.width*n.height*4:0),0)}};const XOt=IAe($e(),Math.PI/2),YOt=new I2(2,0,"glTF"),J5=zp(),ZOt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},JOt={[ft.BYTE]:1,[ft.UNSIGNED_BYTE]:1,[ft.SHORT]:2,[ft.UNSIGNED_SHORT]:2,[ft.FLOAT]:4,[ft.UNSIGNED_INT]:4};function KOt(t){switch(t.componentType){case ft.BYTE:return new a7(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case ft.UNSIGNED_BYTE:return new r7(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case ft.SHORT:return new l7(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case ft.UNSIGNED_SHORT:return new tle(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case ft.UNSIGNED_INT:return new ile(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case ft.FLOAT:return new K_(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount)}}let QOt=0;async function y6e(t,e,i={},r=!0){const n=await WOt.load(t,e,i),s="gltf_"+QOt++,o={lods:[],materials:new Map,textures:new Map,meta:e3t(n)},a=!(!n.json.asset.extras||n.json.asset.extras.ESRI_type!=="symbolResource"),l=new Map;await t3t(n,async(h,p,f,m)=>{const g=l.get(f)??0;l.set(f,g+1);const _=h.mode!==void 0?h.mode:Ft.TRIANGLES,b=_===Ft.TRIANGLES||_===Ft.TRIANGLE_STRIP||_===Ft.TRIANGLE_FAN?_:null;if(R(b))return void re.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+Ft[_]+"). Skipping primitive.");if(!n.hasPositions(h))return void re.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.");const w=n.getPositionData(h,i),x=n.getMaterial(h,i,r),T=n.hasNormals(h)?n.getNormalData(h,i):null,E=n.hasTangents(h)?n.getTangentData(h,i):null,C=n.hasTextureCoordinates(h)?n.getTextureCoordinates(h,i):null,A=n.hasVertexColors(h)?n.getVertexColors(h,i):null,I=n.getIndexData(h,i),O={transform:HM(p),attributes:{position:await w,normal:T?await T:null,texCoord0:C?await C:null,color:A?await A:null,tangent:E?await E:null},indices:await I,primitiveType:b,material:r3t(o,await x,s)};let D=null;v(o.meta)&&v(o.meta.ESRI_lod)&&o.meta.ESRI_lod.metric==="screenSpaceRadius"&&(D=o.meta.ESRI_lod.thresholds[f]),o.lods[f]=o.lods[f]||{parts:[],name:m,lodThreshold:D},o.lods[f].parts[g]=O});for(const h of o.lods)h.parts=h.parts.filter(p=>!!p);const c=await n.getLoadedBuffersSize();return{model:o,meta:{isEsriSymbolResource:a,uri:n.uri},customMeta:{},size:c}}function e3t(t){const e=t.json;let i=null;return e.nodes.forEach(r=>{const n=r.extras;v(n)&&(n.ESRI_proxyEllipsoid||n.ESRI_lod)&&(i=n)}),i}async function t3t(t,e){const i=t.json,r=i.scenes[i.scene||0].nodes,n=r.length>1,s=[];for(const a of r){const l=i.nodes[a];s.push(o(a,0)),i3t(l)&&!n&&l.extensions.MSFT_lod.ids.forEach((c,h)=>o(c,h+1))}async function o(a,l){const c=i.nodes[a],h=t.getNodeTransform(a);if(c.weights!=null&&re.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported."),c.mesh!=null){const p=i.meshes[c.mesh];for(const f of p.primitives)s.push(e(f,h,l,p.name))}for(const p of c.children||[])s.push(o(p,l))}await Promise.all(s)}function i3t(t){return t.extensions&&t.extensions.MSFT_lod&&Array.isArray(t.extensions.MSFT_lod.ids)}function r3t(t,e,i){const r=s=>{const o=`${i}_tex_${s&&s.id}${s&&s.name?"_"+s.name:""}`;if(s&&!t.textures.has(o)){const a=VOt(s.data,{wrap:{s:s.wrapS,t:s.wrapT},mipmap:n3t.includes(s.minFilter),noUnpackFlip:!0});t.textures.set(o,a)}return o},n=`${i}_mat_${e.id}_${e.name}`;if(!t.materials.has(n)){const s=UOt({color:[e.color[0],e.color[1],e.color[2]],opacity:e.color[3],alphaMode:e.alphaMode,alphaCutoff:e.alphaCutoff,doubleSided:e.doubleSided,colorMixMode:e.ESRI_externalColorMixMode,textureColor:e.colorTexture?r(e.colorTexture):void 0,textureNormal:e.normalTexture?r(e.normalTexture):void 0,textureOcclusion:e.occlusionTexture?r(e.occlusionTexture):void 0,textureEmissive:e.emissiveTexture?r(e.emissiveTexture):void 0,textureMetallicRoughness:e.metallicRoughnessTexture?r(e.metallicRoughnessTexture):void 0,emissiveFactor:[e.emissiveFactor[0],e.emissiveFactor[1],e.emissiveFactor[2]],colorTextureTransform:e.colorTextureTransform,normalTextureTransform:e.normalTextureTransform,occlusionTextureTransform:e.occlusionTextureTransform,emissiveTextureTransform:e.emissiveTextureTransform,metallicRoughnessTextureTransform:e.metallicRoughnessTextureTransform,metallicFactor:e.metallicFactor,roughnessFactor:e.roughnessFactor});t.materials.set(n,s)}return n}const n3t=[nt.LINEAR_MIPMAP_LINEAR,nt.LINEAR_MIPMAP_NEAREST];function s3t(t,e=ZM){return typeof t=="number"?e(t):Vre(t)||qT(t)?new Uint32Array(t):t}function o3t(t){const e=typeof t=="number"?t:t.length;if(e<3)return[];const i=e-2,r=PNe(i);if(typeof t=="number"){let n=0;for(let s=0;s<i;s+=1)s%2==0?(r[n++]=s,r[n++]=s+1,r[n++]=s+2):(r[n++]=s+1,r[n++]=s,r[n++]=s+2)}else{let n=0;for(let s=0;s<i;s+=1)if(s%2==0){const o=t[s],a=t[s+1],l=t[s+2];r[n++]=o,r[n++]=a,r[n++]=l}else{const o=t[s+1],a=t[s],l=t[s+2];r[n++]=o,r[n++]=a,r[n++]=l}}return r}function a3t(t){const e=typeof t=="number"?t:t.length;if(e<3)return new Uint16Array(0);const i=e-2,r=i<=65536?new Uint16Array(3*i):new Uint32Array(3*i);if(typeof t=="number"){let n=0;for(let s=0;s<i;++s)r[n++]=0,r[n++]=s+1,r[n++]=s+2;return r}{const n=t[0];let s=t[1],o=0;for(let a=0;a<i;++a){const l=t[a+2];r[o++]=n,r[o++]=s,r[o++]=l,s=l}return r}}let l3t=class{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}},c3t=class{constructor(e,i,r){this.name=e,this.lodThreshold=i,this.pivotOffset=r,this.stageResources=new l3t,this.numberOfVertices=0}};const E0=re.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function _6e(t,e){const i=await u3t(t,e),r=await m3t(i.textureDefinitions??{},e);let n=0;for(const s in r)if(r.hasOwnProperty(s)){const o=r[s];n+=o!=null&&o.image?o.image.width*o.image.height*4:0}return{resource:i,textures:r,size:n+vMe(i)}}async function u3t(t,e){const i=v(e)&&e.streamDataRequester;if(i)return h3t(t,i,e);const r=await _m(ir(t,e));if(r.ok===!0)return r.value.data;Du(r.error),v6e(r.error)}async function h3t(t,e,i){const r=await _m(e.request(t,"json",i));if(r.ok===!0)return r.value;Du(r.error),v6e(r.error.details.url)}function v6e(t){throw new H("",`Request for object resource failed: ${t}`)}function d3t(t){const e=t.params,i=e.topology;let r=!0;switch(e.vertexAttributes||(E0.warn("Geometry must specify vertex attributes"),r=!1),e.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const s=e.faces;if(s){if(e.vertexAttributes)for(const o in e.vertexAttributes){const a=s[o];a&&a.values?(a.valueType!=null&&a.valueType!=="UInt32"&&(E0.warn(`Unsupported indexed geometry indices type '${a.valueType}', only UInt32 is currently supported`),r=!1),a.valuesPerElement!=null&&a.valuesPerElement!==1&&(E0.warn(`Unsupported indexed geometry values per element '${a.valuesPerElement}', only 1 is currently supported`),r=!1)):(E0.warn(`Indexed geometry does not specify face indices for '${o}' attribute`),r=!1)}}else E0.warn("Indexed geometries must specify faces"),r=!1;break}default:E0.warn(`Unsupported topology '${i}'`),r=!1}t.params.material||(E0.warn("Geometry requires material"),r=!1);const n=t.params.vertexAttributes;for(const s in n)n[s].values||(E0.warn("Geometries with externally defined attributes are not yet supported"),r=!1);return r}function p3t(t,e){const i=new Array,r=new Array,n=new Array,s=new VO,o=t.resource,a=I2.parse(o.version||"1.0","wosr");y3t.validate(a);const l=o.model.name,c=o.model.geometries,h=o.materialDefinitions??{},p=t.textures;let f=0;const m=new Map;for(let g=0;g<c.length;g++){const _=c[g];if(!d3t(_))continue;const b=g3t(_),w=_.params.vertexAttributes,x=[];for(const V in w){const B=w[V],ee=B.values;x.push([V,new Qe(ee,B.valuesPerElement,!0)])}const T=[];if(_.params.topology!=="PerAttributeArray"){const V=_.params.faces;for(const B in V)T.push([B,V[B].values])}const E=b.texture,C=p&&p[E];if(C&&!m.has(E)){const{image:V,params:B}=C,ee=new Q2(V,B);r.push(ee),m.set(E,ee)}const A=m.get(E),I=A?A.id:void 0,O=b.material;let D=s.get(O,E);if(R(D)){const V=h[O.substring(O.lastIndexOf("/")+1)].params;V.transparency===1&&(V.transparency=0);const B=C&&C.alphaChannelUsage,ee=V.transparency>0||B==="transparency"||B==="maskAndTransparency",ie=C?b6e(C.alphaChannelUsage):void 0,J={ambient:Fc(V.diffuse),diffuse:Fc(V.diffuse),opacity:1-(V.transparency||0),transparent:ee,textureAlphaMode:ie,textureAlphaCutoff:.33,textureId:I,initTextureTransparent:!0,doubleSided:!0,cullFace:Dr.None,colorMixMode:V.externalColorMixMode||"tint",textureAlphaPremultiplied:!!C&&!!C.params.preMultiplyAlpha};v(e)&&e.materialParamsMixin&&Object.assign(J,e.materialParamsMixin),D=new F_(J),s.set(O,E,D)}n.push(D);const U=new Os(D,x,T);f+=T.position?T.position.length:0,i.push(U)}return{engineResources:[{name:l,stageResources:{textures:r,materials:n,geometries:i},pivotOffset:o.model.pivotOffset,numberOfVertices:f,lodThreshold:null}],referenceBoundingBox:f3t(i)}}function f3t(t){const e=Br();return t.forEach(i=>{const r=i.boundingInfo;v(r)&&(py(e,r.bbMin),py(e,r.bbMax))}),e}async function m3t(t,e){const i=[];for(const s in t){const o=t[s],a=o.images[0].data;if(!a){E0.warn("Externally referenced texture data is not yet supported");continue}const l=o.encoding+";base64,"+a,c="/textureDefinitions/"+s,h=o.channels==="rgba"?o.alphaChannelUsage||"transparency":"none",p={noUnpackFlip:!0,wrap:{s:$t.REPEAT,t:$t.REPEAT},preMultiplyAlpha:b6e(h)!==_r.Opaque},f=v(e)&&e.disableTextures?Promise.resolve(null):D_(l,e);i.push(f.then(m=>({refId:c,image:m,params:p,alphaChannelUsage:h})))}const r=await Promise.all(i),n={};for(const s of r)n[s.refId]=s;return n}function b6e(t){switch(t){case"mask":return _r.Mask;case"maskAndTransparency":return _r.MaskBlend;case"none":return _r.Opaque;default:return _r.Blend}}function g3t(t){const e=t.params;return{id:1,material:e.material,texture:e.texture,region:e.texture}}const y3t=new I2(1,2,"wosr"),JE=2.1;async function w6e(t,e){const i=x6e(kut(t));if(i.fileType==="wosr"){const p=await(e.cache?e.cache.loadWOSR(i.url,e):_6e(i.url,e)),{engineResources:f,referenceBoundingBox:m}=p3t(p,e);return{lods:f,referenceBoundingBox:m,isEsriSymbolResource:!1,isWosr:!0}}const r=await(e.cache?e.cache.loadGLTF(i.url,e,!!e.usePBR):y6e(new m6e(e.streamDataRequester),i.url,e,e.usePBR)),n=Js(r.model.meta,"ESRI_proxyEllipsoid"),s=r.meta.isEsriSymbolResource&&v(n)&&r.meta.uri.includes("/RealisticTrees/");s&&!r.customMeta.esriTreeRendering&&(r.customMeta.esriTreeRendering=!0,x3t(r,n));const o=!!e.usePBR,a=r.meta.isEsriSymbolResource?{usePBR:o,isSchematic:!1,treeRendering:s,mrrFactors:[0,1,.2]}:{usePBR:o,isSchematic:!1,treeRendering:!1,mrrFactors:[0,1,.5]},l={...e.materialParamsMixin,treeRendering:s},{engineResources:c,referenceBoundingBox:h}=T6e(r,a,l,e.skipHighLods&&i.specifiedLodIndex==null?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:i.specifiedLodIndex});return{lods:c,referenceBoundingBox:h,isEsriSymbolResource:r.meta.isEsriSymbolResource,isWosr:!1}}function x6e(t){const e=t.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return e?{fileType:"gltf",url:e[1],specifiedLodIndex:e[4]!=null?Number(e[4]):null}:t.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:t,specifiedLodIndex:null}:{fileType:"unknown",url:t,specifiedLodIndex:null}}function T6e(t,e,i,r){const n=t.model,s=new Array,o=new Map,a=new Map,l=n.lods.length,c=Br();return n.lods.forEach((h,p)=>{const f=r.skipHighLods===!0&&(l>1&&p===0||l>3&&p===1)||r.skipHighLods===!1&&r.singleLodIndex!=null&&p!==r.singleLodIndex;if(f&&p!==0)return;const m=new c3t(h.name,h.lodThreshold,[0,0,0]);h.parts.forEach(g=>{const _=f?new F_({}):_3t(n,g,m,e,i,o,a),{geometry:b,vertexCount:w}=v3t(g,v(_)?_:new F_({})),x=b.boundingInfo;v(x)&&p===0&&(py(c,x.bbMin),py(c,x.bbMax)),v(_)&&(m.stageResources.geometries.push(b),m.numberOfVertices+=w)}),f||s.push(m)}),{engineResources:s,referenceBoundingBox:c}}function _3t(t,e,i,r,n,s,o){const a=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),l=t.materials.get(e.material),c=v(e.attributes.texCoord0),h=v(e.attributes.normal);if(R(l))return null;const p=b3t(l.alphaMode);if(!s.has(a)){if(c){const E=(C,A=!1)=>{if(v(C)&&!o.has(C)){const I=t.textures.get(C);if(v(I)){const O=I.data;o.set(C,new Q2(qS(O)?O.data:O,{...I.parameters,preMultiplyAlpha:!qS(O)&&A,encoding:qS(O)&&v(O.encoding)?O.encoding:void 0}))}}};E(l.textureColor,p!==_r.Opaque),E(l.textureNormal),E(l.textureOcclusion),E(l.textureEmissive),E(l.textureMetallicRoughness)}const m=l.color[0]**(1/JE),g=l.color[1]**(1/JE),_=l.color[2]**(1/JE),b=l.emissiveFactor[0]**(1/JE),w=l.emissiveFactor[1]**(1/JE),x=l.emissiveFactor[2]**(1/JE),T=v(l.textureColor)&&c?o.get(l.textureColor):null;s.set(a,new F_({...r,transparent:p===_r.Blend,customDepthTest:b2.Lequal,textureAlphaMode:p,textureAlphaCutoff:l.alphaCutoff,diffuse:[m,g,_],ambient:[m,g,_],opacity:l.opacity,doubleSided:l.doubleSided,doubleSidedType:"winding-order",cullFace:l.doubleSided?Dr.None:Dr.Back,hasVertexColors:!!e.attributes.color,hasVertexTangents:!!e.attributes.tangent,normalType:h?hr.Attribute:hr.ScreenDerivative,castShadows:!0,receiveSSAO:!0,textureId:v(T)?T.id:void 0,colorMixMode:l.colorMixMode,normalTextureId:v(l.textureNormal)&&c?o.get(l.textureNormal).id:void 0,textureAlphaPremultiplied:v(T)&&!!T.params.preMultiplyAlpha,occlusionTextureId:v(l.textureOcclusion)&&c?o.get(l.textureOcclusion).id:void 0,emissiveTextureId:v(l.textureEmissive)&&c?o.get(l.textureEmissive).id:void 0,metallicRoughnessTextureId:v(l.textureMetallicRoughness)&&c?o.get(l.textureMetallicRoughness).id:void 0,emissiveFactor:[b,w,x],mrrFactors:[l.metallicFactor,l.roughnessFactor,r.mrrFactors[2]],isSchematic:!1,colorTextureTransformMatrix:kg(l.colorTextureTransform),normalTextureTransformMatrix:kg(l.normalTextureTransform),occlusionTextureTransformMatrix:kg(l.occlusionTextureTransform),emissiveTextureTransformMatrix:kg(l.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:kg(l.metallicRoughnessTextureTransform),...n}))}const f=s.get(a);if(i.stageResources.materials.push(f),c){const m=g=>{v(g)&&i.stageResources.textures.push(o.get(g))};m(l.textureColor),m(l.textureNormal),m(l.textureOcclusion),m(l.textureEmissive),m(l.textureMetallicRoughness)}return f}function v3t(t,e){const i=t.attributes.position.count,r=w3t(t.indices||i,t.primitiveType),n=aS(jr,i);rF(n,t.attributes.position,t.transform);const s=[[M.POSITION,new Qe(n.typedBuffer,n.elementCount,!0)]],o=[[M.POSITION,r]];if(v(t.attributes.normal)){const a=aS(jr,i);jM(K5,t.transform),Ew(a,t.attributes.normal,K5),s.push([M.NORMAL,new Qe(a.typedBuffer,a.elementCount,!0)]),o.push([M.NORMAL,r])}if(v(t.attributes.tangent)){const a=aS(eh,i);jM(K5,t.transform),u6e(a,t.attributes.tangent,K5),s.push([M.TANGENT,new Qe(a.typedBuffer,a.elementCount,!0)]),o.push([M.TANGENT,r])}if(v(t.attributes.texCoord0)){const a=aS(K_,i);d6e(a,t.attributes.texCoord0),s.push([M.UV0,new Qe(a.typedBuffer,a.elementCount,!0)]),o.push([M.UV0,r])}if(v(t.attributes.color)){const a=aS(vl,i);if(t.attributes.color.elementCount===4)t.attributes.color instanceof eh?jte(a,t.attributes.color,255):t.attributes.color instanceof vl?p6e(a,t.attributes.color):t.attributes.color instanceof XN&&jte(a,t.attributes.color,1/256);else{f6e(a,255,255,255,255);const l=new ED(a.buffer,0,4);t.attributes.color instanceof jr?Rte(l,t.attributes.color,255):t.attributes.color instanceof ED?V7(l,t.attributes.color):t.attributes.color instanceof s7&&Rte(l,t.attributes.color,1/256)}s.push([M.COLOR,new Qe(a.typedBuffer,a.elementCount,!0)]),o.push([M.COLOR,r])}return{geometry:new Os(e,s,o),vertexCount:i}}const K5=wr();function b3t(t){switch(t){case"BLEND":return _r.Blend;case"MASK":return _r.Mask;case"OPAQUE":case null:case void 0:return _r.Opaque}}function w3t(t,e){switch(e){case Ft.TRIANGLES:return s3t(t);case Ft.TRIANGLE_STRIP:return o3t(t);case Ft.TRIANGLE_FAN:return a3t(t)}}function x3t(t,e){for(let i=0;i<t.model.lods.length;++i){const r=t.model.lods[i];for(const n of r.parts){const s=n.attributes.normal;if(R(s))return;const o=n.attributes.position,a=o.count,l=P(),c=P(),h=P(),p=aS(vl,a),f=aS(jr,a),m=wa($e(),n.transform);for(let g=0;g<a;g++){o.getVec(g,c),s.getVec(g,l),Ke(c,c,n.transform),ge(h,c,e.center),rV(h,h,e.radius);const _=h[2],b=Pe(h),w=Math.min(.45+.55*b*b,1);rV(h,h,e.radius),m!==null&&Ke(h,h,m),we(h,h),i+1!==t.model.lods.length&&t.model.lods.length>1&&ys(h,h,l,_>-1?.2:Math.min(-4*_-3.8,1)),f.setVec(g,h),p.set(g,0,255*w),p.set(g,1,255*w),p.set(g,2,255*w),p.set(g,3,255)}n.attributes.normal=f,n.attributes.color=p}}}const JJt=Object.freeze(Object.defineProperty({__proto__:null,fetch:w6e,gltfToEngineResources:T6e,parseUrl:x6e},Symbol.toStringTag,{value:"Module"}));var tn;function T3t(t){let e=_n().mat4f64(M.LOCALTRANSFORM).mat4f64(M.GLOBALTRANSFORM).vec4f64(M.BOUNDINGSPHERE).vec3f64(M.MODELORIGIN).mat3f(M.MODEL).mat3f(M.MODELNORMAL).vec2f(M.MODELSCALEFACTORS);return t.includes("color")&&(e=e.vec4f(M.COLOR)),t.includes("featureAttribute")&&(e=e.vec4f(M.FEATUREATTRIBUTE)),e=e.u8(M.STATE).u8(M.LODLEVEL),t.includes(M.OBJECTANDLAYERIDCOLOR)&&(e=e.vec4u8(M.OBJECTANDLAYERIDCOLOR)),e.alignTo(8),e}(function(t){t[t.ALLOCATED=1]="ALLOCATED",t[t.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",t[t.VISIBLE=4]="VISIBLE",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",t[t.REMOVE=32]="REMOVE",t[t.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",t[t.ACTIVE=18]="ACTIVE"})(tn||(tn={}));let S3t=class{constructor(e){this.localTransform=e.getField(M.LOCALTRANSFORM,SD),this.globalTransform=e.getField(M.GLOBALTRANSFORM,SD),this.modelOrigin=e.getField(M.MODELORIGIN,_l),this.model=e.getField(M.MODEL,vw),this.modelNormal=e.getField(M.MODELNORMAL,vw),this.modelScaleFactors=e.getField(M.MODELSCALEFACTORS,K_),this.boundingSphere=e.getField(M.BOUNDINGSPHERE,i7),this.color=e.getField(M.COLOR,eh),this.featureAttribute=e.getField(M.FEATUREATTRIBUTE,eh),this.state=e.getField(M.STATE,YM),this.lodLevel=e.getField(M.LODLEVEL,YM),this.objectAndLayerIdColor=e.getField(M.OBJECTANDLAYERIDCOLOR,vl)}},bA=class extends ve{constructor(e,i){super(e),this.events=new An,this._capacity=0,this._size=0,this._next=0,this._buffer=null,this._view=null,this._layout=T3t(i)}get capacity(){return this._capacity}get size(){return this._size}get buffer(){return this._buffer.buffer}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const e=this._findSlot();return this._view.state.set(e,tn.ALLOCATED),this._size++,this.events.emit("instances-changed"),e}removeInstance(e){const i=this._view.state;wt(e>=0&&e<this._capacity&&(i.get(e)&tn.ALLOCATED)!=0,"invalid instance handle"),this._getStateFlag(e,tn.ACTIVE)?this._setStateFlags(e,tn.REMOVE):this.freeInstance(e),this.events.emit("instances-changed")}freeInstance(e){const i=this._view.state;wt(e>=0&&e<this._capacity&&(i.get(e)&tn.ALLOCATED)!=0,"invalid instance handle"),i.set(e,0),this._size--}setLocalTransform(e,i,r=!0){this._view.localTransform.setMat(e,i),r&&this.updateModelTransform(e)}getLocalTransform(e,i){this._view.localTransform.getMat(e,i)}setGlobalTransform(e,i,r=!0){this._view.globalTransform.setMat(e,i),r&&this.updateModelTransform(e)}getGlobalTransform(e,i){this._view.globalTransform.getMat(e,i)}updateModelTransform(e){const i=this._view,r=Fv,n=tf;i.localTransform.getMat(e,Hve),i.globalTransform.getMat(e,fW);const s=$n(fW,fW,Hve);he(r,s[12],s[13],s[14]),i.modelOrigin.setVec(e,r),Dp(n,s),i.model.setMat(e,n);const o=hyt(Fv,s);o.sort(),i.modelScaleFactors.set(e,0,o[1]),i.modelScaleFactors.set(e,1,o[2]),Uw(n,n),Qu(n,n),i.modelNormal.setMat(e,n),this._setStateFlags(e,tn.TRANSFORM_CHANGED),this.events.emit("instance-transform-changed",{index:e})}getModelTransform(e,i){const r=this._view;r.model.getMat(e,tf),r.modelOrigin.getVec(e,Fv),i[0]=tf[0],i[1]=tf[1],i[2]=tf[2],i[3]=0,i[4]=tf[3],i[5]=tf[4],i[6]=tf[5],i[7]=0,i[8]=tf[6],i[9]=tf[7],i[10]=tf[8],i[11]=0,i[12]=Fv[0],i[13]=Fv[1],i[14]=Fv[2],i[15]=1}applyShaderTransformation(e,i){v(this.shaderTransformation)&&this.shaderTransformation.applyTransform(this,e,i)}getCombinedModelTransform(e,i){return this.getModelTransform(e,i),v(this.shaderTransformation)&&this.shaderTransformation.applyTransform(this,e,i),i}getCombinedLocalTransform(e,i){return this._view.localTransform.getMat(e,i),v(this.shaderTransformation)&&this.shaderTransformation.applyTransform(this,e,i),i}getCombinedMaxScaleFactor(e){let i=this._view.modelScaleFactors.get(e,1);if(v(this.shaderTransformation)){const r=this.shaderTransformation.scaleFactor(Fv,this,e);i*=Math.max(r[0],r[1],r[2])}return i}getCombinedMedianScaleFactor(e){let i=this._view.modelScaleFactors.get(e,0);if(v(this.shaderTransformation)){const r=this.shaderTransformation.scaleFactor(Fv,this,e);i*=E3t(r[0],r[1],r[2])}return i}getModel(e,i){this._view.model.getMat(e,i)}setFeatureAttribute(e,i){this._view.featureAttribute.setVec(e,i)}getFeatureAttribute(e,i){this._view.featureAttribute.getVec(e,i)}setColor(e,i){this._view.color.setVec(e,i)}setObjectAndLayerIdColor(e,i){this._view.objectAndLayerIdColor.setVec(e,i)}getColor(e,i){this._view.color.getVec(e,i)}setVisible(e,i){i!==this.getVisible(e)&&(this._setStateFlag(e,tn.VISIBLE,i),this.events.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this._getStateFlag(e,tn.VISIBLE)}setHighlight(e,i){i!==this.getHighlight(e)&&(this._setStateFlag(e,tn.HIGHLIGHT,i),this.events.emit("instance-highlight-changed"))}getHighlight(e){return this._getStateFlag(e,tn.HIGHLIGHT)}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let i=0;for(let r=0;r<this._capacity;++r)this.getState(r)&e&&++i;return i}_setStateFlags(e,i){const r=this._view.state;i=r.get(e)|i,r.set(e,i)}_clearStateFlags(e,i){const r=this._view.state;i=r.get(e)&~i,r.set(e,i)}_setStateFlag(e,i,r){r?this._setStateFlags(e,i):this._clearStateFlags(e,i)}_getStateFlag(e,i){return!!(this._view.state.get(e)&i)}_grow(){const e=Math.max(C3t,Math.floor(this._capacity*A3t)),i=this._layout.createBuffer(e);if(this._buffer){const r=new Uint8Array(this._buffer.buffer);new Uint8Array(i.buffer).set(r)}this._capacity=e,this._buffer=i,this._view=new S3t(this._buffer)}_findSlot(){const e=this._view.state;let i=this._next;for(;e.get(i)&tn.ALLOCATED;)i=i+1===this._capacity?0:i+1;return this._next=i+1===this._capacity?0:i+1,i}};function E3t(t,e,i){return Math.max(Math.min(t,e),Math.min(Math.max(t,e),i))}u([d({constructOnly:!0})],bA.prototype,"shaderTransformation",void 0),u([d()],bA.prototype,"_size",void 0),u([d({readOnly:!0})],bA.prototype,"size",null),bA=u([$("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],bA);const C3t=1024,A3t=2,Fv=P(),tf=wr(),Hve=$e(),fW=$e();let R3t=class extends tm{constructor(e,i){super(r=>this._instanceData.view.boundingSphere.getVec(r,this._tmpSphere),{maximumDepth:25}),this._tmpSphere=Is(),this._tmpMat4=$e(),this._instanceData=e,this._boundingSphere=i}addInstance(e){const i=this._instanceData.view.boundingSphere,r=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);Ke(this._tmpSphere,this._boundingSphere.center,r),this._tmpSphere[3]=this._boundingSphere.radius*v2(r),i.setVec(e,this._tmpSphere),this.add([e])}removeInstance(e){this.remove([e])}},M3t=class{constructor(e,i){this._worldSpaceRadius=e,this._minScreenSpaceRadii=i}selectLevel(e,i,r){const n=r.computeScreenPixelSizeAt(e),s=this._worldSpaceRadius*i/n;let o=0;for(let a=1;a<this._minScreenSpaceRadii.length;++a)s>=this._minScreenSpaceRadii[a]&&(o=a);return o}},O3t=class extends c7{constructor(e,i,r,n,s,o){super(e,i),this.layerUid=e,this.graphicUid=i,this.geometryId=r,this.triangleNr=n,this.baseBoundingSphere=s,this.numLodLevels=o}};function bce(t){return Mm(t)&&t.intersector===gn.LOD&&!!t.target}let P3t=class{constructor(e,i){const r=e.renderContext.rctx,n=i.geometry;this._materialRepository=e.materialRepository,n.material.setParameters({instancedDoublePrecision:!0});const s=n.material.createBufferWriter(),o=s.vertexBufferLayout,a=s.elementCount(n),l=s.allocate(a);s.write(null,null,n,l,0),this.geometry=n,this.material=n.material,this.glMaterials=new lke(n.material,this._materialRepository),this.vertexBufferLayout=o,this.vbo=er.createVertex(r,zi.STATIC_DRAW,l.buffer),this.vao=new Rm(r,Di,{geometry:sh(o)},{geometry:this.vbo}),this.vertexCount=a}destroy(){this.glMaterials.destroy(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(e,i,r,n,s,o,a,l){const c=this.geometry.id;this.material.intersect(this.geometry,e.transform.transform,e,r,n,(h,p,f,m,g)=>{if(h>=0){if(i!=null&&!i(e.rayBegin,e.rayEnd,h))return;const _=new O3t(o.layerUid,o.graphicUid(s),c,f,a,l);if((e.results.min.drapedLayerOrder==null||g>=e.results.min.drapedLayerOrder)&&(e.results.min.dist==null||h<e.results.min.dist)&&e.results.min.set(gn.LOD,_,h,p,e.transform.transform,g),e.options.store!==Ta.MIN&&(e.results.max.drapedLayerOrder==null||g>=e.results.max.drapedLayerOrder)&&(e.results.max.dist==null||h>e.results.max.dist)&&e.results.max.set(gn.LOD,_,h,p,e.transform.transform,g),e.options.store===Ta.ALL){const b=dle(e.results.min.ray);b.set(gn.LOD,_,h,p,e.transform.transform,g),e.results.all.push(b)}}})}},I3t=class S6e{static async create(e,i,r){const n=await Promise.allSettled(i.components.map(o=>e.controller.schedule(()=>new P3t(e,o),r))),s=n.map(o=>o.status==="fulfilled"?o.value:null).filter(v);if(fo(r)||s.length!==n.length){s.forEach(o=>o.destroy()),ui(r);for(const o of n)if(o.status==="rejected")throw o.reason}return new S6e(i.minScreenSpaceRadius,s)}constructor(e,i){this.minScreenSpaceRadius=e,this.components=i}destroy(){this.components.forEach(e=>e.destroy())}intersect(e,i,r,n,s,o,a){this.components.forEach(l=>l.intersect(e,i,r,n,s,o,this.boundingSphere,a))}get boundingBox(){if(R(this._boundingBox)){const e=Br();this.components.forEach(i=>{v(i.boundingInfo)&&(py(e,i.boundingInfo.bbMin),py(e,i.boundingInfo.bbMax))}),this._boundingBox=e}return this._boundingBox}get boundingSphere(){if(R(this._boundingSphere)){const e=this.boundingBox,i=P();Yf(e,i),this._boundingSphere={center:i,radius:.5*SCe(e)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((e,i)=>e+i.triangleCount,0)}},$3t=class{constructor(e,i,r){this._elementSize=i,this._buffer=er.createVertex(e,zi.STATIC_DRAW),this.resize(r)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get memoryUsage(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}copyRange(e,i,r,n=0){const s=new Uint8Array(this.array,e*this.elementSize,(i-e)*this.elementSize);new Uint8Array(r.array,n*this.elementSize).set(s)}transferAll(){this._buffer.setData(this._array)}transferRange(e,i){const r=e*this._elementSize,n=i*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),r,r,n)}resize(e){const i=e*this._elementSize,r=new ArrayBuffer(i);this._array&&(e>=this._capacity?new Uint8Array(r).set(new Uint8Array(this._array)):new Uint8Array(r).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=r,this._buffer.setSize(i),this._capacity=e}},L3t=class{constructor(e){this.modelOriginHi=e.getField(M.MODELORIGINHI,jr),this.modelOriginLo=e.getField(M.MODELORIGINLO,jr),this.model=e.getField(M.MODEL,vw),this.modelNormal=e.getField(M.MODELNORMAL,vw),this.color=e.getField(M.INSTANCECOLOR,eh),this.featureAttribute=e.getField(M.INSTANCEFEATUREATTRIBUTE,eh),this.objectAndLayerIdColor=e.getField(M.OBJECTANDLAYERIDCOLOR_INSTANCED,vl)}},qve=class{constructor(e,i){this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=e,this._instanceBufferLayout=i,this._elementSize=i.stride,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const e=this._headIndex,i=this._tailIndex;return e>=i?e-i:e+this._capacity-i}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get memoryUsage(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){wt(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){wt(this._updating,"not updating"),this.size<N3t*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){wt(this._updating,"not updating"),this.isFull&&this._grow();const e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this._incrementHead(),wt(this._headIndex!==this._tailIndex,"invalid pointers"),e}freeTail(){wt(this._updating,"not updating"),wt(this.size>0,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}_grow(){const e=Math.max(Wve,Math.floor(this._capacity*D3t));this._resize(e)}_shrink(){const e=Math.max(Wve,Math.floor(this._capacity*F3t));this._resize(e)}_resize(e){if(wt(this._updating,"not updating"),e===this._capacity)return;const i=new $3t(this._rctx,this._elementSize,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const r=this.size,n=this._compactInstances(i);wt(n===r,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=n,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=i,this._view=new L3t(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(e){const i=this._headIndex,r=this._tailIndex;return r<i?(this._buffer.copyRange(r,i,e),i-r):r>i?(this._buffer.copyRange(r,this._capacity,e),i>0&&this._buffer.copyRange(0,i,e,this._capacity-r),i+(this._capacity-r)):0}_incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}_incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}_transferRange(e,i){e<i?this._buffer.transferRange(e,i):e>i&&(i>0&&this._buffer.transferRange(0,i),this._buffer.transferRange(e,this._capacity))}};const Wve=1024,D3t=2,N3t=.3,F3t=.5,k3t=t=>{const e=t.baseBoundingSphere.radius,i=t.levels.map(r=>r.minScreenSpaceRadius);return new M3t(e,i)};let Bd=class extends ve{constructor(e,i){super(e),this.type=gn.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=[],this._highlightRenderInstanceData=[],this._instanceIndex=0,this._cycleStartIndex=0,this._slicePlane=!1,this._camera=new Pt,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.slots=[Ee.OPAQUE_MATERIAL,Ee.TRANSPARENT_MATERIAL],this.canRender=!0,this._instanceData=new bA({shaderTransformation:e.shaderTransformation},e.optionalFields),this._frameTask=i.registerTask(St.LOD_RENDERER,this)}initialize(){this._instanceBufferLayout=V3t(this.optionalFields),this._glInstanceBufferLayout=sh(this._instanceBufferLayout,1),this._instanceData.events.on("instances-changed",()=>this._requestUpdateCycle()),this._instanceData.events.on("instance-transform-changed",({index:e})=>{this._requestUpdateCycle(),this.metadata.notifyGraphicGeometryChanged(e)}),this._instanceData.events.on("instance-visibility-changed",({index:e})=>{this._requestUpdateCycle(!0),this.metadata.notifyGraphicVisibilityChanged(e)}),this._instanceData.events.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0))}destroy(){this._frameTask.remove()}get _enableLevelSelection(){return this.symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get memoryUsage(){const e={cpu:0,gpu:0};return this._defaultRenderInstanceData.forEach(i=>{const r=i.memoryUsage;e.cpu+=r.cpu,e.gpu+=r.gpu}),this._highlightRenderInstanceData.forEach(i=>{const r=i.memoryUsage;e.cpu+=r.cpu,e.gpu+=r.gpu}),e}get renderStats(){const e=this._instanceData.size,i=[];return this._levels.forEach((r,n)=>{const s=this._defaultRenderInstanceData[n],o=this._highlightRenderInstanceData[n],a=s.size+o.size,l=r.triangleCount;i.push({renderedInstances:a,renderedTriangles:a*l,trianglesPerInstance:l})}),{totalInstances:e,renderedInstances:i.reduce((r,n)=>r+n.renderedInstances,0),renderedTriangles:i.reduce((r,n)=>r+n.renderedTriangles,0),levels:i}}async initializeRenderContext(e,i){this._context=e;const r=e.renderContext.rctx,n=await Promise.allSettled(this.symbol.levels.map(o=>(this._defaultRenderInstanceData.push(new qve(r,this._instanceBufferLayout)),this._highlightRenderInstanceData.push(new qve(r,this._instanceBufferLayout)),I3t.create(e,o,i)))),s=n.map(o=>o.status==="fulfilled"?o.value:null).filter(v);if(fo(i)||s.length!==n.length){s.forEach(o=>o.destroy()),ui(i);for(const o of n)if(o.status==="rejected")throw o.reason}this._levels=s,this._levelSelector=k3t(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(e=>e.destroy()),this._defaultRenderInstanceData.forEach(e=>e.destroy()),this._highlightRenderInstanceData.forEach(e=>e.destroy())}get needsTransparentPass(){return this._levels.some(e=>e.components.some(i=>i.material.requiresSlot(Ee.TRANSPARENT_MATERIAL,z.Color)))}get needsHighlight(){return this._highlightRenderInstanceData.some(e=>e.size>0)}prepareRender(e){if(!tr.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const i=e.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(e.bindParameters.contentCamera),i||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(ql),this._needFullCycle=!1)}}render(e){!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleForOutput(e.output)||(e.rctx.bindVAO(),e.output!==z.Highlight&&e.output!==z.ShadowHighlight&&this._renderComponents(e,this._defaultRenderInstanceData),e.output!==z.ShadowExcludeHighlight&&this._renderComponents(e,this._highlightRenderInstanceData))}intersect(e,i,r,n){if(!this.baseMaterial.isVisible()||R(this._octree))return;const s=P();ge(s,n,r);const o=a=>{this._instanceData.getCombinedModelTransform(a,Zve),e.transform.set(Zve),Ke(Jve,r,e.transform.inverse),Ke(Kve,n,e.transform.inverse);const l=this._instanceData.getState(a),c=this._instanceData.getLodLevel(a),h=this._levels.length;wt((l&tn.ACTIVE)!=0,"invalid instance state"),wt(c>=0&&c<h,"invaid lod level"),this._levels[c].intersect(e,i,Jve,Kve,a,this.metadata,h)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(o):this._octree.forEachAlongRay(r,s,o)}queryDepthRange(e){return this._queryDepthRangeOctree(e)}notifyShaderTransformationChanged(){this._invalidateOctree(),this._requestUpdateCycle()}get _octree(){var e;if(R(this._octreeCached)){const i=this._instanceData,r=(e=i.view)==null?void 0:e.state;if(!r)return null;this._octreeCached=new R3t(i,this.baseBoundingSphere);for(let n=0;n<i.capacity;++n)r.get(n)&tn.ACTIVE&&this._octreeCached.addInstance(n)}return this._octreeCached}_invalidateOctree(){this._octreeCached=Ve(this._octreeCached)}_queryDepthRangeOctree(e){if(R(this._octree))return{near:1/0,far:-1/0};const i=e.viewForward,r=this._octree.findClosest(i,tm.DepthOrder.FRONT_TO_BACK,e.frustum),n=this._octree.findClosest(i,tm.DepthOrder.BACK_TO_FRONT,e.frustum);if(r==null||n==null)return{near:1/0,far:-1/0};const s=e.eye,o=this._instanceData.view;o.boundingSphere.getVec(r,qm),ge(qm,qm,s);const a=be(qm,i)-qm[3];o.boundingSphere.getVec(n,qm),ge(qm,qm,s);const l=be(qm,i)+qm[3];return{near:Math.max(e.near,a),far:Math.min(e.far,l)}}_requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,e&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._defaultRenderInstanceData.forEach(e=>e.startUpdateCycle()),this._highlightRenderInstanceData.forEach(e=>e.startUpdateCycle())}get running(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}runTask(e){const{_enableLevelSelection:i,_camera:r,_levelSelector:n}=this;this._defaultRenderInstanceData.forEach(h=>h.beginUpdate()),this._highlightRenderInstanceData.forEach(h=>h.beginUpdate());const s=this._instanceData,o=s.view;let a=s.size;const l=s.capacity;let c=this._instanceIndex;for(let h=0;h<a&&!e.done;++h){c===this._cycleStartIndex&&this._startUpdateCycle();const p=o.state.get(c);let f=0;if(!(p&tn.ALLOCATED)){c=c+1===l?0:c+1,a++;continue}const m=o.lodLevel.get(c);if(p&tn.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[m].freeTail(),p&tn.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[m].freeTail(),p&tn.REMOVE)s.freeInstance(c);else if(p&tn.VISIBLE){let g=0;i&&(o.modelOrigin.getVec(c,Yve),g=n.selectLevel(Yve,s.getCombinedMedianScaleFactor(c),r)),f=p&~(tn.ACTIVE|tn.TRANSFORM_CHANGED),g>=0&&(p&tn.HIGHLIGHT?(Xve(this._highlightRenderInstanceData[g],o,c),f|=tn.HIGHLIGHT_ACTIVE):(Xve(this._defaultRenderInstanceData[g],o,c),f|=tn.DEFAULT_ACTIVE)),o.state.set(c,f),o.lodLevel.set(c,g)}else f=p&~(tn.ACTIVE|tn.TRANSFORM_CHANGED),o.state.set(c,f);if(v(this._octreeCached)){const g=!!(p&tn.ACTIVE),_=!!(f&tn.ACTIVE);!g&&_?this._octreeCached.addInstance(c):g&&!_?this._octreeCached.removeInstance(c):g&&_&&p&tn.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(c),this._octreeCached.addInstance(c))}c=c+1===l?0:c+1,e.madeProgress()}this._instanceIndex=c,this._defaultRenderInstanceData.forEach(h=>h.endUpdate()),this._highlightRenderInstanceData.forEach(h=>h.endUpdate()),this._context.requestRender()}_renderComponents(e,i){this.levels.forEach((r,n)=>{const s=r.components.map(o=>this._beginComponent(e,i[n],o));r.components.forEach((o,a)=>this._renderComponent(e,s[a],i[n],o,n))})}_beginComponent(e,i,r){const{bindParameters:n,rctx:s,output:o}=e;if(i.size===0||!r.material.requiresSlot(n.slot,e.output))return null;const a=r.glMaterials.load(s,n.slot,o);return v(a)?a.beginSlot(n):null}_renderComponent(e,i,r,n,s){if(R(i))return;const{bindParameters:o,rctx:a}=e,l=a.bindTechnique(i,n.material.parameters,o);a.bindVAO(n.vao),i.ensureAttributeLocations(n.vao),l.bindDraw(z3t,o,n.material.parameters),tr.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.output===z.Color&&(l.setUniform4fv("externalColor",Qve[Math.min(s,Qve.length-1)]),l.setUniform1i("colorMixMode",T4e.replace));const c=a.capabilities.instancing,h=r.capacity,p=r.headIndex,f=r.tailIndex,m=r.firstIndex,g=this._glInstanceBufferLayout,_=(b,w)=>{Dae(a,Di,r.buffer,g,b),c.drawArraysInstanced(i.primitiveType,0,n.vertexCount,w-b),Nae(a,Di,r.buffer,g)};n.material.parameters.transparent&&m!=null?p>f?(wt(m>=f&&m<=p,"invalid firstIndex"),_(m,p),_(f,m)):p<f&&(m<=p?(wt(m>=0&&m<=p,"invalid firstIndex"),_(m,p),_(f,h),_(0,m)):(wt(m>=f&&m<=h,"invalid firstIndex"),_(m,h),_(0,p),_(f,m))):p>f?_(f,p):p<f&&(_(0,p),_(f,h)),a.bindVAO(null)}};function Xve(t,e,i){const r=t.allocateHead();U3t(e,i,t.view,r)}function U3t(t,e,i,r){Nvt(t.modelOrigin,e,i.modelOriginHi,i.modelOriginLo,r),i.model.copyFrom(r,t.model,e),i.modelNormal.copyFrom(r,t.modelNormal,e),t.color&&i.color&&i.color.copyFrom(r,t.color,e),t.objectAndLayerIdColor&&i.objectAndLayerIdColor&&i.objectAndLayerIdColor.copyFrom(r,t.objectAndLayerIdColor,e),t.featureAttribute&&i.featureAttribute&&i.featureAttribute.copyFrom(r,t.featureAttribute,e)}function V3t(t){let e=_n().vec3f(M.MODELORIGINHI).vec3f(M.MODELORIGINLO).mat3f(M.MODEL).mat3f(M.MODELNORMAL);return v(t)&&t.includes("color")&&(e=e.vec4f(M.INSTANCECOLOR)),v(t)&&t.includes("featureAttribute")&&(e=e.vec4f(M.INSTANCEFEATUREATTRIBUTE)),v(t)&&t.includes("objectAndLayerIdColor")&&(e=e.vec4u8(M.OBJECTANDLAYERIDCOLOR_INSTANCED)),e}u([d({constructOnly:!0})],Bd.prototype,"symbol",void 0),u([d({constructOnly:!0})],Bd.prototype,"optionalFields",void 0),u([d({constructOnly:!0})],Bd.prototype,"metadata",void 0),u([d({constructOnly:!0})],Bd.prototype,"shaderTransformation",void 0),u([d()],Bd.prototype,"_instanceData",void 0),u([d()],Bd.prototype,"_cycleStartIndex",void 0),u([d({readOnly:!0})],Bd.prototype,"_enableLevelSelection",null),u([d()],Bd.prototype,"_updateCyclesWithStaticCamera",void 0),u([d({readOnly:!0})],Bd.prototype,"running",null),Bd=u([$("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],Bd);const Yve=P(),qm=pi(),Zve=$e(),Jve=P(),Kve=P(),Qve=[Zt(1,0,1,1),Zt(0,0,1,1),Zt(0,1,0,1),Zt(1,1,0,1),Zt(1,0,0,1)],z3t=new FRt;let e1e=class{constructor(e,i,r,n,s,o,a,l,c,h,p,f){this.lodResources=e,this.lodRenderer=i,this.stageResources=r,this.originalMaterialParameters=n,this.resourceSize=s,this.isEsriSymbolResource=o,this.isWosr=a,this.resourceBoundingBox=l,this.symbolSize=c,this.extentPadding=h,this.physicalBasedRenderingEnabled=p,this.pivotOffset=f}},B3t=class extends My{getCachedSize(){const[e,i,r]=v(this._resources)?this._resources.symbolSize:[1,1,1];return{width:e,depth:i,height:r}}constructor(e,i,r,n){super(e,i,r,n),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this._hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.ensureDrapedStatus(!1),this._hasLoadedPBRTextures=r.physicalBasedRenderingEnabled}async doLoad(e){if(!this._drivenProperties.size&&R7(this.symbolLayer))throw new Error;const i=this.symbolLayer;if(this._isPrimitive){const r=i.resource?i.resource.primitive:iAe;this._resources=await this._createResourcesForPrimitive(r,e)}else this._resources=await this._createResourcesForUrl(i.resource.href,e);this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return v(this._resources)?this._resources.extentPadding:0}get _isPrimitive(){return!(this.symbolLayer.resource&&this.symbolLayer.resource.href)}get lodRenderer(){return v(this._resources)?this._resources.lodRenderer:null}_setMaterialTransparencyParams(e,i=Js(this.symbolLayer,"material","color")){const r=this._getCombinedOpacity(i),n=r<1||this.needsDrivenTransparentPass;return e.transparent=n,e.opacity=r,e.cullFace=n?Dr.None:Dr.Back,e}async _createResourcesForPrimitive(e,i){if(!ZEt(e))throw new Error(`Unknown object symbol primitive: ${e}`);const r=this.symbolLayer,n=to(RWe(e)),s=Fc(VF(n)),o=Fc(Wj(s,r)),a=Pe(o),l=!1,c=!1,h={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,ambient:Vg,diffuse:Vg,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},p=!!h.usePBR;this._setMaterialTransparencyParams(h);const f=this.symbol;if(f.type==="point-3d"&&f.verticalOffset){const{screenLength:x,minWorldLength:T,maxWorldLength:E}=f.verticalOffset;h.verticalOffset={screenLength:ga(x),minWorldLength:T||0,maxWorldLength:v(E)?E:1/0},h.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(h.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)h.externalColor=dp;else{const x=v(r.material)?r.material.color:null,T=v(x)?Xe.toUnitRGBA(x):dp;h.externalColor=T}this._fastUpdates=jD(this._context.renderer,this._fastVisualVariableConvertOptions(n,o,s,kx)),h.instanced=["transformation"],this._fastUpdates.enabled?(Object.assign(h,this._fastUpdates.materialParameters),h.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(h.instanced.push("color"),this._optionalFields.push("color")),ue("enable-feature:objectAndLayerId-rendering")&&(h.instanced.push("objectAndLayerIdColor"),this._optionalFields.push("objectAndLayerIdColor"));const m=new F_(h),g=A5e(e,m);if(!g)throw new Error(`Unknown object symbol primitive: ${e}`);const _=O5(g).map(x=>({opacity:1,transparent:x.parameters.transparent})),b=await this._createStageResources(g,p,i),w=await this._createLodRenderer(g,i);return new e1e(g,w,b,_,s,l,c,n,o,a,p,kx)}async _createResourcesForUrl(e,i){const r=["transformation"],n={materialParamsMixin:{instanced:r,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=jD(this._context.renderer,this._fastVisualVariableConvertOptions(kx,kx,kx,kx)),this._fastUpdates.enabled?(Object.assign(n.materialParamsMixin,this._fastUpdates.materialParameters),r.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(r.push("color"),this._optionalFields.push("color")),ue("enable-feature:objectAndLayerId-rendering")&&(r.push("objectAndLayerIdColor"),this._optionalFields.push("objectAndLayerIdColor"));const s=this.symbol;if(s.type==="point-3d"&&s.verticalOffset){const{screenLength:U,minWorldLength:V,maxWorldLength:B}=s.verticalOffset;n.materialParamsMixin.verticalOffset={screenLength:ga(U),minWorldLength:V||0,maxWorldLength:v(B)?B:1/0},n.materialParamsMixin.castShadows=!1}n.signal=i,n.usePBR=this._context.physicalBasedRenderingEnabled,n.skipHighLods=this._context.skipHighSymbolLods;const o=n.usePBR,a=await w6e(e,n),l=a.isEsriSymbolResource,c=a.isWosr,h=MOt(a.lods);h.levels.sort((U,V)=>U.minScreenSpaceRadius-V.minScreenSpaceRadius);const p=this._context,f=this.symbolLayer.material,m=this._getExternalColorParameters(f),g=Js(this.symbolLayer,"material","color"),_=this._getCombinedOpacity(g,{hasIntrinsicColor:!0}),b=this.needsDrivenTransparentPass,w=O5(h),x=O5(h).map(U=>({opacity:U.parameters.opacity||1,transparent:U.parameters.transparent}));w.forEach(U=>{const V=U.parameters;U.setParameters(m);const B=V.opacity*_,ee=B<1||b||V.transparent;U.setParameters({opacity:B,transparent:ee}),p.screenSizePerspectiveEnabled&&U.setParameters({screenSizePerspective:p.sharedResources.screenSizePerspectiveSettings})});const T=a.referenceBoundingBox,E=Fc(VF(T)),C=Fc(h.levels[0].pivotOffset),A=Fc(Wj(E,this.symbolLayer)),I=Pe(A);GD(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions(T,A,E,C))&&w.forEach(U=>U.setParameters(this._fastUpdates.materialParameters));const O=await this._createStageResources(h,o,i),D=await this._createLodRenderer(h,i);return new e1e(h,D,O,x,E,l,c,T,A,I,o,C)}_addDisposeResource(e){this._disposeResourceHandles.push(e)}async _createStageResources(e,i,r){const n=this._context.stage,s=O5(e);i!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),n.addMany(s),this._addDisposeResource(()=>n.removeMany(s));const o=S_e(e);n.addMany(o),this._addDisposeResource(()=>n.removeMany(o)),await n.load(o,r),ui(r);const a=E_e(e);return n.addMany(a),this._addDisposeResource(()=>n.removeMany(a)),{materials:s,textures:o,geometries:a}}async _createLodRenderer(e,i){const r=this._context.stage,n={layerUid:this._context.layer.uid,graphicUid:a=>this._instanceIndexToGraphicUid.get(a),notifyGraphicGeometryChanged:a=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(a)),notifyGraphicVisibilityChanged:a=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(a))},s=this._fastUpdates.enabled?{applyTransform:(a,l,c)=>{a.getFeatureAttribute(l,Q5),go(c,Fte(this._fastUpdates.materialParameters,Q5,c))},scaleFactor:(a,l,c)=>(l.getFeatureAttribute(c,Q5),xMt(a,this._fastUpdates.materialParameters,Q5))}:null,o=new Bd({symbol:e,optionalFields:this._optionalFields,metadata:n,shaderTransformation:s},this._context.scheduler);return o.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource(()=>{r.removeRenderPlugin(o),o.destroy()}),await r.addRenderPlugin(o.slots,o,i),o}_getExternalColorParameters(e){const i={};return this._drivenProperties.color?i.externalColor=dp:v(e)&&v(e.color)?i.externalColor=Xe.toUnitRGBA(e.color):(i.externalColor=dp,i.colorMixMode="ignore"),i}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(e=>e()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry))return null;const r=kD(i.geometry);if(R(r))return this.logger.warn(`unsupported geometry type for icon symbol: ${i.geometry.type}`),null;const n=this.setGraphicElevationContext(i,new Om),s=e.renderingInfo;return this._createAs3DShape(i,r,s,n,i.uid,e.layer.uid)}notifyDestroyGraphicLayer(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(R(this._resources))return;const e=this._drivenProperties.opacity,i=!this._isPrimitive,r=this._resources.stageResources.materials,n=this._resources.originalMaterialParameters;for(let s=0;s<r.length;s++){const o=r[s],a=Js(this.symbolLayer,"material","color"),l=n[s],c=this._getCombinedOpacity(a,{hasIntrinsicColor:i})*l.opacity,h=c<1||e||l.transparent;o.setParameters({opacity:c,transparent:h}),this._isPrimitive&&o.setParameters({cullFace:h?Dr.None:Dr.Back})}}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,Tw)}slicePlaneEnabledChanged(){if(R(this._resources))return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const e of this._resources.stageResources.materials)e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(R(this._resources))return!0;const{stageResources:e,isWosr:i}=this._resources;for(const r of e.materials)this._isPrimitive?r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):i||r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return this._hasLoadedPBRTextures!==!1||this._context.physicalBasedRenderingEnabled!==!0||(this._hasLoadedPBRTextures=!0,!1)}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!1}applyRendererDiff(e,i){if(R(this._resources))return Ks.Recreate_Symbol;const{stageResources:{materials:r},lodRenderer:n,resourceBoundingBox:s,symbolSize:o,resourceSize:a,pivotOffset:l}=this._resources;for(const c in e.diff){if(c!=="visualVariables"||!GD(this._fastUpdates,i,this._fastVisualVariableConvertOptions(s,o,a,l)))return Ks.Recreate_Symbol;for(const h of r)h.setParameters(this._fastUpdates.materialParameters);n.notifyShaderTransformationChanged()}return Ks.Fast_Update}computeComplexity(){if(R(this._resources))return super.computeComplexity();const e=this._resources.lodResources,i=C5e(e.levels[0]).reduce((s,o)=>s+o.indices.get(M.POSITION).length,0)/3,r=s=>Array.from(s.vertexAttributes.values()).reduce((o,a)=>{var l;return o+(((l=a.data.buffer)==null?void 0:l.byteLength)??0)},0)+Array.from(s.indices.values()).reduce((o,a)=>o+(Array.isArray(a)?12*a.length:a.buffer.byteLength),0),n=S_e(e).reduce((s,o)=>s+(o.params.encoding&&o.params.encoding==="image/ktx2"?o.estimatedTexMemRequired:o.estimatedTexMemRequired/4),0)+E_e(e).reduce((s,o)=>s+r(o),0);return{primitivesPerFeature:i,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:{...O5e(this.symbol,this.symbolLayer),resourceBytes:n}}}_hasLodRenderer(){return v(this._resources)}_createAs3DShape(e,i,r,n,s,o){if(!this._hasLodRenderer()||R(this._resources))return null;const a=this.getFastUpdateAttrValues(e),l=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?tL(r.color,r.opacity):null,c=this._context.clippingExtent;if(qa(i,KE,this._context.elevationProvider.spatialReference),v(c)&&!kne(c,KE))return null;const h=this._requiresTerrainElevation(n),p=this._computeGlobalTransform(i,n,mW,ek),f=this._computeLocalTransform(this._resources,this.symbolLayer,r,t1e),m=this._resources.lodRenderer.instanceData,g=m.addInstance();this._instanceIndexToGraphicUid.set(g,s),m.setLocalTransform(g,f,!1),m.setGlobalTransform(g,p),a&&m.setFeatureAttribute(g,a),l&&m.setColor(g,l),v(this._context.stage.renderView.objectAndLayerIdRenderHelper)&&m.setObjectAndLayerIdColor(g,this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:s,layerUid:o}));const _=new COt(this,g,VEt,n);return h&&(_.alignedSampledElevation=ek.sampledElevation),_.needsElevationUpdates=Tw(n.mode),FD(_,i,this._context.elevationProvider),_}_computeGlobalTransform(e,i,r,n){return XO(e,this._context.elevationProvider,i,this._context.renderCoordsHelper,n),KE[0]=e.x,KE[1]=e.y,KE[2]=n.z,ym(e.spatialReference,KE,r,this._context.renderCoordsHelper.spatialReference),r}_computeLocalTransform(e,i,r,n){return Lp(n),this._applyObjectRotation(r,!1,n),this._applyObjectRotation(i,!0,n),this._applyObjectScale(e,r,n),this._applyAnchor(e,i,n),n}_applyObjectScale(e,i,r){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const n=this._drivenProperties.size&&i.size?i.size:e.symbolSize,s=x_e(n,e.symbolSize,e.resourceSize,this._context.renderCoordsHelper.unitInMeters);s[0]===1&&s[1]===1&&s[2]===1||rB(r,r,s)}prepareSymbolLayerPatch(e){if(e.diff.type!=="partial")return;const i=e.diff.diff;this._preparePatchTransform(e,i),this._preparePatchColor(e,i)}updateGeometry(e,i){if(R(this._resources))return!0;const r=i&&kD(i);if(R(r))return!1;const n=this.getGeometryElevationMode(i);return e.elevationContext.mode===n&&(this._computeGlobalTransform(r,e.elevationContext,mW,ek),this._requiresTerrainElevation(e.elevationContext)&&(e.alignedSampledElevation=ek.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,mW,!0),FD(e,r,this._context.elevationProvider),!0)}_preparePatchTransform(e,i){if(!(i.heading||i.tilt||i.roll||i.width||i.height||i.depth||i.anchor||i.anchorPosition)||R(this._resources))return;const r=(g,_,b)=>Nt(g!=null&&g.type==="complete"?g.newValue:_,b),n=r(i.heading,this.symbolLayer.heading,0),s=r(i.tilt,this.symbolLayer.tilt,0),o=r(i.roll,this.symbolLayer.roll,0),a=r(i.width,this.symbolLayer.width,void 0),l=r(i.height,this.symbolLayer.height,void 0),c=r(i.depth,this.symbolLayer.depth,void 0),h=r(i.anchor,this.symbolLayer.anchor,void 0),p=r(i.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete i.heading,delete i.tilt,delete i.roll,delete i.width,delete i.height,delete i.depth,delete i.anchor,delete i.anchorPosition;const f={heading:n,tilt:s,roll:o,anchor:h,anchorPosition:p},m=this._resources;this.loadStatus===Bh.LOADED&&e.symbolLayerStatePatches.push(()=>{m.symbolSize=Fc(Wj(m.resourceSize,{width:a,height:l,depth:c,isPrimitive:this.symbolLayer.isPrimitive}))}),e.graphics3DGraphicPatches.push((g,_)=>{const b=this._computeLocalTransform(m,f,_,t1e),w=g.instanceIndex;m.lodRenderer.instanceData.setLocalTransform(w,b,!0)})}_preparePatchColor(e,i){if(!i.material||i.material.type!=="partial")return;const r=i.material.diff;if(!r.color||r.color.type!=="complete"||r.color.newValue==null||r.color.oldValue==null)return;const n=r.color.newValue,s=v(n)?Xe.toUnitRGBA(n):dp;delete r.color;const o=this._resources;R(o)||e.graphics3DGraphicPatches.push(a=>{let l;this._hasPerInstanceColor()?(o.lodRenderer.instanceData.setColor(a.instanceIndex,s),l=this._setMaterialTransparencyParams({},n)):l=this._setMaterialTransparencyParams({externalColor:s},n);for(const c of o.stageResources.materials)c.setParameters(l)})}_requiresTerrainElevation(e){return e.mode!=="absolute-height"}_applyObjectRotation(e,i,r){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&i))return MEt(e.heading,e.tilt,e.roll,r)}_computeAnchor(e,i,r){const n=P();switch(r.anchor){case"center":ce(n,Yf(e)),pl(n,n);break;case"top":{const s=Yf(e);he(n,-s[0],-s[1],-e[5]);break}case"bottom":{const s=Yf(e);he(n,-s[0],-s[1],-e[2]);break}case"relative":{const s=Yf(e),o=VF(e),a=r.anchorPosition,l=a?Ue(a.x,a.y,a.z):dl;B9(n,o,l),me(n,n,s),pl(n,n);break}default:v(i)?pl(n,i):ce(n,dl)}return n}_applyAnchor(e,i,r){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const n=this._computeAnchor(e.resourceBoundingBox,e.pivotOffset,i);n&&Yc(r,r,n)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(e,i,r,n){const s=v(e)?Fc(VF(e)):Vg,o=v(e)?this._computeAnchor(e,n,this.symbolLayer):dl,a=this._context.renderCoordsHelper.unitInMeters,l=x_e(v(i)?i:void 0,i,r,a),c=Ue(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:s,symbolSize:v(i)?i:Vg,unitInMeters:a,transformation:{anchor:o,scale:l,rotation:c}}}};const KE=P(),t1e=$e(),mW=$e(),Q5=pi(),ek=new iF;function j3t(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function G3t(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function Gte(t,e,i,r,n){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t}function H3t(t,e){if(t===e){const i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function q3t(t,e){const i=e[0],r=e[1],n=e[2],s=e[3];let o=i*s-n*r;return o?(o=1/o,t[0]=s*o,t[1]=-r*o,t[2]=-n*o,t[3]=i*o,t):null}function W3t(t,e){const i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t}function X3t(t){return t[0]*t[3]-t[2]*t[1]}function E6e(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=i[0],l=i[1],c=i[2],h=i[3];return t[0]=r*a+s*l,t[1]=n*a+o*l,t[2]=r*c+s*h,t[3]=n*c+o*h,t}function Y3t(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+s*a,t[1]=n*l+o*a,t[2]=r*-a+s*l,t[3]=n*-a+o*l,t}function Z3t(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=i[0],l=i[1];return t[0]=r*a,t[1]=n*a,t[2]=s*l,t[3]=o*l,t}function J3t(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t}function K3t(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function Q3t(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function ePt(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2)}function tPt(t,e,i,r){return t[2]=r[2]/r[0],i[0]=r[0],i[1]=r[1],i[3]=r[3]-t[2]*i[1],[t,e,i]}function iPt(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t}function C6e(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function rPt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function nPt(t,e){const i=t[0],r=t[1],n=t[2],s=t[3],o=e[0],a=e[1],l=e[2],c=e[3],h=bl();return Math.abs(i-o)<=h*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=h*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-l)<=h*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-c)<=h*Math.max(1,Math.abs(s),Math.abs(c))}function sPt(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function oPt(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t}const aPt=E6e,lPt=C6e;Object.freeze(Object.defineProperty({__proto__:null,LDU:tPt,add:iPt,adjoint:W3t,copy:j3t,determinant:X3t,equals:nPt,exactEquals:rPt,frob:ePt,fromRotation:J3t,fromScaling:K3t,identity:G3t,invert:q3t,mul:aPt,multiply:E6e,multiplyScalar:sPt,multiplyScalarAndAdd:oPt,rotate:Y3t,scale:Z3t,set:Gte,str:Q3t,sub:lPt,subtract:C6e,transpose:H3t},Symbol.toStringTag,{value:"Module"}));let cPt=class extends Os{constructor(e,i,r,n,s,o,a,l){super(e,i,r,null,Zn.Mesh,l),this.path=n,this.geometrySR=s,this.upVectorAlignment=o,this.stencilWidth=a}};var Xb;function A6e(t){return"upVectorAlignment"in t}(function(t){t[t.World=0]="World",t[t.Path=1]="Path"})(Xb||(Xb={}));function R6e(){return[1,0,0,1]}function uPt(t){return[t[0],t[1],t[2],t[3]]}function hPt(t,e,i,r){return[t,e,i,r]}function dPt(t,e){return new Float64Array(t,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:uPt,create:R6e,createView:dPt,fromValues:hPt},Symbol.toStringTag,{value:"Module"}));function M6e(){return{up:P(),right:P()}}function pPt(t,e,i){Ke(t.up,e.up,i),Ke(t.right,e.right,i)}function fPt(t,e,i){dt(t,be(i,e.right),be(i,e.up))}let mPt=class{constructor(){this.pos=P(),this.posES=P(),this.vLeft=P(),this.vRight=P(),this.vMinSiblingLength=0,this.frame=M6e(),this.rotationFrameUp=P(),this.rotationRight=Fe(),this.rotationAngle=0,this.miterStretch=R6e(),this.maxStretchDistance=0}setFrameFromUpVector(e){ce(this.frame.up,e),me(wA,this.vLeft,this.vRight),we(wA,wA),le(Hte,this.frame.up,be(wA,this.frame.up)),ge(ik,wA,Hte),we(ik,ik),vt(this.frame.right,ik,this.frame.up)}},O6e=class{constructor(){this.vertices=[],this.vertexIndices=[],this.vertexNormals=[],this.poles=[],this.poleIndices=[]}addVertex(e,i){return this.vertices.push(gI(e)),this.vertexNormals.push(gI(i)),this.vertices.length-1}addPole(e,i=null){return this.poles.push({position:gI(e),normal:i?gI(i):null}),this.poles.length-1}addSegment(e,i=null){this.vertexIndices.push(e.v0),this.vertexIndices.push(e.v1),i&&(this.poleIndices.push(i.v0),this.poleIndices.push(i.v1))}get numSegments(){return this.vertexIndices.length/2}translate(e,i){for(const r of this.vertices)r[0]+=e,r[1]+=i;for(const r of this.poles)r.position[0]+=e,r.position[1]+=i}};function gPt(t=20){const i=new O6e,r={v0:0,v1:0};i.addPole(Mi(0,0));for(let s=0;s<t;++s){const o=2*s*Math.PI/t,a=Math.cos(o),l=Math.sin(o),c=Mi(a*.5,l*.5),h=Mi(a,l);i.addVertex(c,h)}for(let s=0;s<t-1;++s){const o={v0:s,v1:s+1};i.addSegment(o,r)}const n={v0:t-1,v1:0};return i.addSegment(n,r),i}function yPt(){const i=new O6e,r=Mi(.5*-1,.5*-1),n=Mi(.5*1,.5*-1),s=Mi(.5*1,.5*1),o=Mi(.5*-1,.5*1),a=Mi(0,-1),l=Mi(1,0),c=Mi(0,1),h=Mi(-1,0);return i.addPole(Mi(0,.5*1),c),i.addPole(Mi(0,.5*1)),i.addPole(Mi(0,.5*-1)),i.addPole(Mi(0,.5*-1),a),i.addVertex(r,a),i.addVertex(n,a),i.addSegment({v0:0,v1:1},{v0:3,v1:3}),i.addVertex(n,l),i.addVertex(s,l),i.addSegment({v0:2,v1:3},{v0:2,v1:1}),i.addVertex(s,c),i.addVertex(o,c),i.addSegment({v0:4,v1:5},{v0:0,v1:0}),i.addVertex(o,h),i.addVertex(r,h),i.addSegment({v0:6,v1:7},{v0:1,v1:2}),i}let _Pt=class{constructor(e){this.vertices=e,this.offset=P(),this.xform=$e();const i=Math.floor((e.length-1)/2);ce(this.offset,this.vertices[i].pos);for(const r of this.vertices)ge(r.pos,r.pos,this.offset);Yc(this.xform,this.xform,this.offset),this.updatePathVertexInformation()}updatePathVertexInformation(){const e=this.vertices.length,i=this.vertices[0];i.index=0,i.vLeft=P(),ge(i.vRight,this.vertices[1].pos,i.pos);let r=Pe(i.vRight);i.vMinSiblingLength=r,we(i.vRight,i.vRight);let n=i;for(let s=1;s<e;++s){const o=this.vertices[s];if(o.index=s,o.vLeft=n.vRight,s<e-1){ge(o.vRight,this.vertices[s+1].pos,o.pos);const a=Pe(o.vRight);o.vMinSiblingLength=Math.min(r,a),r=a,we(o.vRight,o.vRight)}else ce(o.vRight,o.vLeft),o.vMinSiblingLength=r;n=o}}};function vPt(t,e){let i=null;const r=t.vertices.length,n=.99619469809,s=P(),o=P(),a=P(),l=P(),c=P(),h=P(),p=Ji();let f=t.vertices[0];ce(o,e),he(s,0,1,0),fz(f.vRight,o,s,s,a,o,n),ce(f.frame.up,o),ce(f.frame.right,a),i=f;for(let m=1;m<r;++m){f=t.vertices[m],me(c,f.vLeft,f.vRight);let g=Pe(c);g>0?(g=1/Math.sqrt(g),c[0]=c[0]*g,c[1]=c[1]*g,c[2]=c[2]*g):(c[0]=f.vRight[0],c[1]=f.vRight[1],c[2]=f.vRight[2]),me(h,i.pos,i.frame.up),GN(f.pos,c,p),Y2(p,cd(h,f.vLeft),l)?(ge(l,l,f.pos),we(o,l),vt(a,c,o),we(a,a)):fz(c,i.frame.up,i.frame.right,s,a,o,n),ce(f.frame.up,o),ce(f.frame.right,a),i=f}}let bPt=class{numProfilesPerJoin(){return 1}extrude(e,i,r){for(let n=0;n<i.vertices.length;++n)r(e.index,e.frame,i.vertices[n],i.vertexNormals[n],!1)}},gW=class{constructor(e=.8*Math.PI,i=1){this.cutoffAngle=e,this.numBendSubdivisions=i}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(e,i,r){const n=APt;if(Math.abs(e.rotationAngle)>=this.cutoffAngle)for(let s=0;s<this.numBendSubdivisions+1;++s){ad(n1e,.5*-e.rotationAngle+s*e.rotationAngle/this.numBendSubdivisions,e.rotationFrameUp),pPt(n,e.frame,n1e);for(let o=0;o<i.vertices.length;++o)As(i.vertices[o],e.rotationRight)*e.rotationAngle>=0?r(e.index,n,i.vertices[o],i.vertexNormals[o],!1):(vQ(AS,i.vertices[o],e.miterStretch),r(e.index,e.frame,AS,i.vertexNormals[o],!0))}else for(let s=0;s<this.numBendSubdivisions+1;++s)for(let o=0;o<i.vertices.length;++o){const a=As(i.vertices[o],e.rotationRight)*e.rotationAngle>=0;vQ(AS,i.vertices[o],e.miterStretch),r(e.index,e.frame,AS,i.vertexNormals[o],!a)}}},wce=class{rebuildConnectingProfileGeometry(e,i,r){for(let n=0;n<i.vertices.length;++n)r(e.index,e.frame,i.vertices[n],i.vertexNormals[n],0,0)}},i1e=class extends wce{constructor(){super()}getNumVertices(){return 0}getNumIndices(){return 0}rebuildCapGeometry(){}buildTopology(){}},tk=class extends wce{constructor(e,i=0,r=!1){super(),this.profile=e,this.profilePlaneOffset=i,this.flip=r}getNumVertices(){return this.profile.vertices.length}getNumIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(e,i,r){for(let n=0;n<i.vertices.length;++n)r(e.index,e.frame,i.vertices[n],i.vertexNormals[n],this.profilePlaneOffset,0)}rebuildCapGeometry(e,i){const r=xce;dt(r,0,0);const n=this.flip?1:-1;for(let s=0;s<this.profile.vertices.length;++s)i(e.index,e.frame,this.profile.vertices[s],r,this.profilePlaneOffset,n)}buildTopology(e,i){const r=this.vertexBufferStart+this.profile.vertexIndices[0];for(let n=1;n<this.profile.numSegments;++n){const s=this.profile.vertexIndices[2*n+0],o=this.profile.vertexIndices[2*n+1],a=this.vertexBufferStart+s,l=this.vertexBufferStart+o;this.flip?i(l,a,r):i(r,a,l)}}},r1e=class extends wce{constructor(e){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=e.profile,this.flip=e.flip,this.sign=this.flip?1:-1,this.breakNormals=e.breakNormals,this.numSegments=e.subdivisions}getNumVertices(){let e=0;return e=this.profile.vertices.length*(this.numSegments-1),this.breakNormals&&(e+=this.profile.vertices.length),e+=this.profile.poles.length,e}getNumIndices(){let e=0;e+=2*this.profile.numSegments*(this.numSegments-1);for(let i=0;i<this.profile.numSegments;++i){const r=this.profile.vertexIndices[2*i+0],n=this.profile.vertexIndices[2*i+1];this.profile.poleIndices[r]===this.profile.poleIndices[n]?e+=1:e+=2}return 3*e}rebuildCapGeometry(e,i){const r=e.frame,n=.5*this.sign,s=AS,o=xce;dt(o,0,0);for(let a=0;a<this.profile.poles.length;++a){const l=this.profile.poles[a];l.normal?i(e.index,r,l.position,l.normal,n,0):i(e.index,r,l.position,o,n,this.sign)}if(this.breakNormals)for(let a=0;a<this.profile.vertices.length;++a)i(e.index,r,this.profile.vertices[a],this.profile.vertexNormals[a],0,0);for(let a=0;a<this.numSegments-1;++a){const l=(1-(a+1)/this.numSegments)*Math.PI*.5,c=Math.sin(l),h=Math.cos(l);for(let p=0;p<this.profile.vertices.length;++p){const f=this.profile.poles[this.profile.poleIndices[p]];Xh(s,this.profile.vertices[p],f.position),ll(s,s,c),f.normal?(Jd(s,s,f.position),i(e.index,r,s,f.normal,n*h,0)):(_2(o,s),ll(o,o,c),Jd(s,s,f.position),i(e.index,r,s,o,n*h,this.sign*h))}}}buildTopology(e,i){const r=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex,n=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length;for(let s=0;s<this.profile.numSegments;++s){const o=this.profile.vertexIndices[2*s+0],a=this.profile.vertexIndices[2*s+1],l=this.vertexBufferStart+this.profile.poleIndices[o],c=this.vertexBufferStart+this.profile.poleIndices[a];let h=r+o,p=r+a;for(let f=0;f<this.numSegments-1;++f){const m=n+f*this.profile.vertices.length+o,g=n+f*this.profile.vertices.length+a;this.flip?(i(m,p,h),i(p,m,g)):(i(h,p,m),i(g,m,p)),h=m,p=g}this.flip?(i(l,p,h),l!==c&&i(l,c,p)):(i(h,p,l),l!==c&&i(p,c,l))}}},wPt=class{constructor(e,i,r,n,s,o={}){this.options=o,this._extrusionVertexCount=0,this.numExtrusionProfiles=0,this.numVerticesTotal=0,this.numNormalsTotal=0,this.profile=i,this.path=e,this.extruder=r,this.startCap=n,this.endCap=s;const a=this.path.vertices.length-2;this.numExtrusionProfiles=r.numProfilesPerJoin()*a+2,this.numVerticesTotal=i.vertices.length*this.numExtrusionProfiles,this.numNormalsTotal=this.numVerticesTotal,this.startCap.vertexBufferStart=this.numVerticesTotal;const l=this.startCap.getNumVertices();this.numVerticesTotal+=l,this.numNormalsTotal+=l,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.getNumVertices();this.numVerticesTotal+=c,this.numNormalsTotal+=c,this.pathVertexData=ps(1*this.numVerticesTotal),this.profileRightAxisData=ps(4*this.numVerticesTotal),this.profileUpAxisData=ps(4*this.numVerticesTotal),this.profileVertexAndNormalData=ps(4*this.numVerticesTotal),this.originData=ps(3*this.path.vertices.length),this._rebuildGeometry(),this.buildTopology()}emitVertex(e,i,r,n,s){if(this.profileRightAxisData[4*this._extrusionVertexCount+0]=i.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=i.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=i.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=i.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=i.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=i.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=r[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=r[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=n[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=n[1],this.pathVertexData[this._extrusionVertexCount]=e,s){const o=this.path.vertices[e];this.profileRightAxisData[4*this._extrusionVertexCount+3]=o.rotationRight[0]*o.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=o.rotationRight[1]*o.maxStretchDistance}else this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0;++this._extrusionVertexCount}emitCapVertex(e,i,r,n,s,o){this.profileRightAxisData[4*this._extrusionVertexCount+0]=i.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=i.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=i.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=i.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=i.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=i.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=r[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=r[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=n[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=n[1],this.pathVertexData[this._extrusionVertexCount]=e,this.profileRightAxisData[4*this._extrusionVertexCount+3]=s,this.profileUpAxisData[4*this._extrusionVertexCount+3]=o,++this._extrusionVertexCount}_rebuildGeometry(){const e=(r,n,s,o,a)=>this.emitVertex(r,n,s,o,a),i=(r,n,s,o,a,l)=>this.emitCapVertex(r,n,s,o,a,l);this._extrusionVertexCount=0;for(const r of this.path.vertices)this.originData[3*r.index+0]=r.pos[0],this.originData[3*r.index+1]=r.pos[1],this.originData[3*r.index+2]=r.pos[2];this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,i);for(let r=1;r<this.path.vertices.length-1;++r)this.extruder.extrude(this.path.vertices[r],this.profile,e);this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,i),this.startCap.rebuildCapGeometry(this.path.vertices[0],i),this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],i)}buildTopology(){const e=this.profile.vertices.length,i=this.profile.numSegments,r=this.numExtrusionProfiles-1;let n=3*(2*(i*r));this.startCap.indexBufferStart=n,this.startCap.firstProfileVertexIndex=0,n+=this.startCap.getNumIndices(),this.endCap.indexBufferStart=n,this.endCap.firstProfileVertexIndex=e*(this.numExtrusionProfiles-1);const s=new Array,o=new Array,a=new Array,l=(c,h,p)=>{s.push(c),s.push(h),s.push(p),o.push(c),o.push(h),o.push(p),a.push(this.pathVertexData[c]),a.push(this.pathVertexData[h]),a.push(this.pathVertexData[p])};for(let c=0;c<i;++c){const h=this.profile.vertexIndices[2*c],p=this.profile.vertexIndices[2*c+1];for(let f=0;f<r;++f){const m=f*e+h,g=(f+1)*e+p,_=f*e+p;l(m,(f+1)*e+h,g),l(m,g,_)}}this.startCap.buildTopology(this.path.vertices[0],l),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],l),this.vertexIndices=BR(s),this.normalIndices=BR(o),this.pathVertexIndices=BR(a)}onPathChanged(){this._rebuildGeometry()}},P6e=class{constructor(e){this.builder=e}get xform(){return this.builder.path.xform}onPathChanged(){this.builder.onPathChanged()}},I6e=class extends P6e{constructor(e){super(e),this.vertexAttributePosition=null,this.vertexAttributeNormal=null,this.vertexAttributeColor=null,this.vertexAttributePosition=ps(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=ps(3*this.builder.numNormalsTotal),this.vertexAttributeColor=new Uint8Array(4),this.vertexAttributeColor[0]=255,this.vertexAttributeColor[1]=255,this.vertexAttributeColor[2]=255,this.vertexAttributeColor[3]=255}bakeVertexColors(e){this.vertexAttributeColor[0]=255*e[0],this.vertexAttributeColor[1]=255*e[1],this.vertexAttributeColor[2]=255*e[2],this.vertexAttributeColor[3]=255*(e.length>3?e[3]:1)}bake(e){this.size=e;for(let i=0;i<this.builder.numVerticesTotal;++i){let r=this.builder.pathVertexData[i];const n=r===0||r===this.builder.path.vertices.length-1;r*=3;const s=TPt;he(s,this.builder.originData[r++],this.builder.originData[r++],this.builder.originData[r]);const o=4*i,a=Hte,l=AS,c=wA,h=EPt,p=CPt;let f=0,m=0;if(he(h,this.builder.profileRightAxisData[o],this.builder.profileRightAxisData[o+1],this.builder.profileRightAxisData[o+2]),he(p,this.builder.profileUpAxisData[o],this.builder.profileUpAxisData[o+1],this.builder.profileUpAxisData[o+2]),dt(l,this.builder.profileVertexAndNormalData[o]*e[0],this.builder.profileVertexAndNormalData[o+1]*e[1]),n)vt(c,p,h),f=this.builder.profileRightAxisData[o+3]*e[0],m=this.builder.profileUpAxisData[o+3];else{const _=xce,b=SPt;dt(_,this.builder.profileRightAxisData[o+3],this.builder.profileUpAxisData[o+3]);const w=pD(_);_2(_,_);const x=As(l,_);if(Math.abs(x)>w){dt(b,-_[1],_[0]);const T=As(l,b);ll(_,_,w*Math.sign(x)),ll(b,b,T),Jd(l,_,b)}he(c,0,0,0)}he(a,h[0]*l[0]+p[0]*l[1],h[1]*l[0]+p[1]*l[1],h[2]*l[0]+p[2]*l[1]),this.vertexAttributePosition[3*i+0]=s[0]+a[0]+c[0]*f,this.vertexAttributePosition[3*i+1]=s[1]+a[1]+c[1]*f,this.vertexAttributePosition[3*i+2]=s[2]+a[2]+c[2]*f;const g=AS;dt(g,this.builder.profileVertexAndNormalData[o+2],this.builder.profileVertexAndNormalData[o+3]),this.vertexAttributeNormal[3*i+0]=h[0]*g[0]+p[0]*g[1]+c[0]*m,this.vertexAttributeNormal[3*i+1]=h[1]*g[0]+p[1]*g[1]+c[1]*m,this.vertexAttributeNormal[3*i+2]=h[2]*g[0]+p[2]*g[1]+c[2]*m}}createGeometryData(){const e=[[M.POSITION,this.builder.vertexIndices],[M.NORMAL,this.builder.normalIndices]],i=[[M.POSITION,new Qe(this.vertexAttributePosition,3,!0)],[M.NORMAL,new Qe(this.vertexAttributeNormal,3,!0)]];if(this.vertexAttributeColor){const r=this.builder.vertexIndices.length;e.push([M.COLOR,new Array(r).fill(0)]),i.push([M.COLOR,new Qe(this.vertexAttributeColor,4)])}return{vertexAttributes:i,indices:e}}onPathChanged(){super.onPathChanged(),this.bake(this.size)}intersect(e,i,r){const n=this.builder.vertexIndices,s=new Qe(this.vertexAttributePosition,3),o=n.length/3;QN(e,i,0,o,n,s,void 0,void 0,r)}},xPt=class extends P6e{constructor(e,i,r,n){super(e),this.sizeAttributeValue=i,this.colorAttributeValue=r,this.opacityAttributeValue=n,this.vvData=null,this.baked=new I6e(e),this.vvData=ps(4*this.builder.path.vertices.length);for(let s=0;s<this.builder.path.vertices.length;++s){this.vvData[4*s+0]=i,this.vvData[4*s+1]=r,this.vvData[4*s+2]=n;const o=s===0||s===this.builder.path.vertices.length-1;this.vvData[4*s+3]=o?1:0}}createGeometryData(){return{vertexAttributes:[[M.POSITION,new Qe(this.builder.originData,3,!0)],[M.PROFILERIGHT,new Qe(this.builder.profileRightAxisData,4,!0)],[M.PROFILEUP,new Qe(this.builder.profileUpAxisData,4,!0)],[M.PROFILEVERTEXANDNORMAL,new Qe(this.builder.profileVertexAndNormalData,4,!0)],[M.FEATUREVALUE,new Qe(this.vvData,4,!0)]],indices:[[M.POSITION,this.builder.pathVertexIndices],[M.PROFILERIGHT,this.builder.vertexIndices],[M.PROFILEUP,this.builder.vertexIndices],[M.PROFILEVERTEXANDNORMAL,this.builder.vertexIndices],[M.FEATUREVALUE,this.builder.pathVertexIndices]]}}};const TPt=P(),AS=Fe(),xce=Fe(),SPt=Fe(),Hte=P(),wA=P(),EPt=P(),CPt=P(),ik=P(),APt=M6e(),n1e=$e(),yW=8;function RPt(t,e){const i=M.FEATUREVALUE;t.attributes.add(i,"vec4");const r=t.vertex;r.code.add(S`
  bool isCapVertex() {
    return ${i}.w == 1.0;
  }
  `),r.uniforms.add(new Wi("size",n=>n.size)),e.vvSize?(r.uniforms.add(new Jt("vvSizeMinSize",n=>n.vvSizeMinSize)),r.uniforms.add(new Jt("vvSizeMaxSize",n=>n.vvSizeMaxSize)),r.uniforms.add(new Jt("vvSizeOffset",n=>n.vvSizeOffset)),r.uniforms.add(new Jt("vvSizeFactor",n=>n.vvSizeFactor)),r.code.add(S`
    vec2 getSize() {
      return size * clamp(vvSizeOffset + ${i}.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):r.code.add(S`vec2 getSize(){
return size;
}`),e.vvOpacity?(r.constants.add("vvOpacityNumber","int",yW),r.uniforms.add([new cl("vvOpacityValues",n=>n.vvOpacityValues,yW),new cl("vvOpacityOpacities",n=>n.vvOpacityOpacities,yW)]),r.code.add(S`
    vec4 applyOpacity(vec4 color) {
      float value = ${i}.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):r.code.add(S`vec4 applyOpacity(vec4 color){
return color;
}`),e.vvColor?(r.constants.add("vvColorNumber","int",hm),r.uniforms.add([new cl("vvColorValues",n=>n.vvColorValues,hm),new T7("vvColorColors",n=>n.vvColorColors,hm)]),r.code.add(S`
    vec4 getColor() {
      float value = ${i}.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):r.code.add(S`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),t.include(WN),t.attributes.add(M.PROFILERIGHT,"vec4"),t.attributes.add(M.PROFILEUP,"vec4"),t.attributes.add(M.PROFILEVERTEXANDNORMAL,"vec4"),r.code.add(S`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),r.code.add(S`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),r.code.add(S`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),r.code.add(S`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}let MPt=class extends Gle{constructor(){super(...arguments),this.size=Mi(1,1)}};function OPt(t){const e=new ji,{vertex:i,fragment:r}=e;switch(Yu(i,t),e.varyings.add("vpos","vec3"),e.include(RPt,t),t.output!==z.Color&&t.output!==z.Alpha||(e.include(Gc,t),e.include(O2,t),e.include(UO,t),e.varyings.add("vnormal","vec3"),e.varyings.add("vcolor","vec4"),t.hasMultipassTerrain&&e.varyings.add("depth","float"),i.code.add(S`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${t.output===z.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),e.include(hd,t),t.output){case z.Alpha:e.include(fs,t),r.uniforms.add(new Ie("opacity",n=>n.opacity)),r.code.add(S`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        gl_FragColor = vec4(combinedOpacity);
      }
    `);break;case z.Color:e.include(fs,t),e.include(P2,t),e.include(aF,t),e.include(O2,t),e.include(Ike,t),xm(r,t),lF(r),ZO(r),r.uniforms.add([i.uniforms.get("localOrigin"),new Jt("ambient",n=>n.ambient),new Jt("diffuse",n=>n.diffuse),new Jt("specular",n=>n.specular),new Ie("opacity",n=>n.opacity)]),r.include(Cy),Ey(r),r.code.add(S`
        void main() {
          discardBySlice(vpos);
          ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          gl_FragColor = vec4(shadedColor, combinedOpacity);
          gl_FragColor = highlightSlice(gl_FragColor, vpos);
          ${t.transparencyPassType===At.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
        }
      `);break;case z.Depth:case z.Shadow:case z.ShadowHighlight:case z.ShadowExcludeHighlight:e.include(Gc,t),S2(e),e.varyings.add("depth","float"),i.code.add(S`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),e.include(fs,t),e.include(N_,t),r.code.add(S`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case z.Normal:e.include(Gc,t),e.include(zD,t),eO(i),e.varyings.add("vnormal","vec3"),i.code.add(S`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(fs,t),r.code.add(S`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case z.Highlight:e.include(Gc,t),e.include(zD,t),e.varyings.add("vnormal","vec3"),i.code.add(S`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(fs,t),e.include(Q_,t),r.code.add(S`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return e}const PPt=Object.freeze(Object.defineProperty({__proto__:null,build:OPt},Symbol.toStringTag,{value:"Module"})),$6e=new Map([[M.POSITION,0],[M.PROFILERIGHT,1],[M.PROFILEUP,2],[M.PROFILEVERTEXANDNORMAL,3],[M.FEATUREVALUE,4]]);let IPt=class extends MPt{constructor(){super(...arguments),this.ambient=Ue(.2,.2,.2),this.diffuse=Ue(.8,.8,.8),this.specular=Ue(0,0,0),this.opacity=1}},L6e=class D6e extends Yi{initializeConfiguration(e,i){i.hasWebGL2Context=e.rctx.type===Et.WEBGL2,i.spherical=e.viewingMode===qe.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Hi(e.rctx,D6e.shader.get().build(this.configuration),$6e)}initializePipeline(){const e=this.configuration.transparencyPassType,i=this.configuration,r=e===At.NONE,n=e===At.FrontFace;return Ht({blending:i.output!==z.Color&&i.output!==z.Alpha||!i.transparent?null:r?nd:ev(e),culling:i.hasSlicePlane&&!i.transparent&&i.doubleSidedMode!==Cn.None?mDe:null,depthTest:{func:jw(e)},depthWrite:r||n?Kc:null,colorWrite:si,stencilWrite:i.hasOccludees?by:null,stencilTest:i.hasOccludees?Gw:null,polygonOffset:r||n?null:C7})}};L6e.shader=new Gi(PPt,()=>Q(()=>import("./Path.glsl-a795c0e6.js"),[]));let Ao=class extends Do{constructor(){super(...arguments),this.output=z.Color,this.doubleSidedMode=Cn.None,this.transparencyPassType=At.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1}};u([j({count:z.COUNT})],Ao.prototype,"output",void 0),u([j({count:Cn.COUNT})],Ao.prototype,"doubleSidedMode",void 0),u([j({count:At.COUNT})],Ao.prototype,"transparencyPassType",void 0),u([j()],Ao.prototype,"spherical",void 0),u([j()],Ao.prototype,"receiveShadows",void 0),u([j()],Ao.prototype,"receiveAmbientOcclusion",void 0),u([j()],Ao.prototype,"vvSize",void 0),u([j()],Ao.prototype,"vvColor",void 0),u([j()],Ao.prototype,"vvOpacity",void 0),u([j()],Ao.prototype,"hasSlicePlane",void 0),u([j()],Ao.prototype,"transparent",void 0),u([j()],Ao.prototype,"hasOccludees",void 0),u([j()],Ao.prototype,"hasMultipassTerrain",void 0),u([j()],Ao.prototype,"cullAboveGround",void 0),u([j()],Ao.prototype,"doublePrecisionRequiresObfuscation",void 0),u([j({constValue:_t.Disabled})],Ao.prototype,"pbrMode",void 0),u([j({constValue:!0})],Ao.prototype,"hasVvInstancing",void 0),u([j({constValue:!1})],Ao.prototype,"useCustomDTRExponentForWater",void 0),u([j({constValue:!1})],Ao.prototype,"useFillLights",void 0);let $Pt=class N6e extends Bw{constructor(e){super(e,new DPt),this.supportsEdges=!0,this._vertexAttributeLocations=$6e,this._configuration=new Ao,this._vertexBufferLayout=N6e.getVertexBufferLayout()}getConfiguration(e,i){return this._configuration.output=e,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,e!==z.Color&&e!==z.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Cn.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Cn.WindingOrder:Cn.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=!!i.ssaoHelper.active&&this.parameters.receiveSSAO),this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}isVisibleForOutput(e){return e!==z.Shadow&&e!==z.ShadowExcludeHighlight&&e!==z.ShadowHighlight||this.parameters.castShadows}isVisible(){return super.isVisible()&&this.parameters.opacity>0}intersect(e,i,r,n,s,o){const a=e;if(!A6e(a))return;const l=a.path,c=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSizeEnabled){const b=this.parameters.vvSizeOffset,w=this.parameters.vvSizeFactor,x=this.parameters.vvSizeMinSize,T=this.parameters.vvSizeMaxSize,E=l.sizeAttributeValue;c[0]*=_e(b[0]+E*w[0],x[0],T[0]),c[1]*=_e(b[2]+E*w[2],x[2],T[2])}const h=Math.max(c[0],c[1]),p=e.boundingInfo;if(R(p))return void this._intersectTriangles(l,c,n,s,o);const f=l2(p.bbMin[0]-h,p.bbMin[1]-h,p.bbMin[2]-h,p.bbMax[0]+h,p.bbMax[1]+h,p.bbMax[2]+h),m=[s[0]-n[0],s[1]-n[1],s[2]-n[2]],g=Math.sqrt(m[0]*m[0]+m[1]*m[1]+m[2]*m[2]),_=[g/m[0],g/m[1],g/m[2]];Nle(f,n,_,r.tolerance)&&this._intersectTriangles(l,c,n,s,o)}_intersectTriangles(e,i,r,n,s){e.baked.size&&e.baked.size[0]===i[0]&&e.baked.size[1]===i[1]||e.baked.bake(i),e.baked.intersect(r,n,s)}createBufferWriter(){return new YO(this._vertexBufferLayout)}requiresSlot(e,i){switch(i){case z.Shadow:case z.ShadowHighlight:case z.ShadowExcludeHighlight:if(!this.parameters.castShadows)return!1;case z.Color:case z.Alpha:case z.Depth:case z.Normal:case z.Highlight:case z.ObjectAndLayerIdColor:return e===(this.parameters.transparent?Ee.TRANSPARENT_MATERIAL:Ee.OPAQUE_MATERIAL)||e===Ee.DRAPED_MATERIAL;default:return!1}}createGLMaterial(e){return new LPt(e)}static getVertexBufferLayout(){return _n().vec3f(M.POSITION).vec4f(M.PROFILERIGHT).vec4f(M.PROFILEUP).vec4f(M.PROFILEVERTEXANDNORMAL).vec4f(M.FEATUREVALUE)}},LPt=class extends zw{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}_updateShadowState(e){(R(this.technique)||e.shadowMap.enabled!==this.technique.configuration.receiveShadows)&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}beginSlot(e){return this._output!==z.Color&&this._output!==z.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e)),this.ensureTechnique(L6e,e)}},DPt=class extends IPt{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveSSAO=!0,this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}};const NPt=["polyline"];let FPt=class extends My{constructor(e,i,r,n){super(e,i,r,n),this._intrinsicSize=Mi(1,1),this._upVectorAlignment=Xb.Path,this._stencilWidth=.1,this.ensureDrapedStatus(!1)}async doLoad(){const e=v(this.symbolLayer.width)?this.symbolLayer.width:this.symbolLayer.height,i=v(this.symbolLayer.height)?this.symbolLayer.height:e;this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[e,1,i],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=jD(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1};const r=this.symbolLayer.anchor||"center";this._upVectorAlignment=this.symbolLayer.profileRotation==="heading"?Xb.World:Xb.Path;const n=this.symbolLayer.profile||"circle";switch(n){default:case"circle":this._profile=gPt(S5e);break;case"quad":this._profile=yPt()}let s=[0,0];switch(r!=="center"&&(s={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[r],this._profile.translate(s[0],s[1])),this.symbolLayer.join){case"round":this._extruder=new gW(0,T5e);break;case"bevel":this._extruder=new gW(0,1);break;case"miter":this._extruder=new gW(.8*Math.PI,1);break;default:this._extruder=new bPt}const o=this.symbolLayer.cap||"butt";switch(o){case"none":this._startCap=new i1e,this._endCap=new i1e;break;case"butt":default:this._startCap=new tk(this._profile,0),this._endCap=new tk(this._profile,0,!0);break;case"square":this._startCap=new tk(this._profile,-.5),this._endCap=new tk(this._profile,.5,!0);break;case"round":{const m=n==="quad";this._startCap=new r1e({profile:this._profile,flip:!1,breakNormals:m,subdivisions:Cte}),this._endCap=new r1e({profile:this._profile,flip:!0,breakNormals:m,subdivisions:Cte});break}}const a=Js(this.symbolLayer,"material","color"),l=this._getCombinedOpacityAndColor(a),c=Fc(l),h=l[3],p=h<1||this.needsDrivenTransparentPass,f={diffuse:c,ambient:c,opacity:h,transparent:p,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:p||o==="none"?Dr.None:Dr.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(dt(this._intrinsicSize,e,i),!Nz(this._intrinsicSize[0])||!Nz(this._intrinsicSize[1])))throw new H("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if(this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||ll(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates.enabled){const m={...f,...this._fastUpdates.materialParameters,size:jIe(this._intrinsicSize)};this._material=new $Pt(m)}else f.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new F_(f);this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,NPt,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i,new Om),n=e.renderingInfo;return this._createAs3DShape(i,n,r,i.uid)}layerOpacityChanged(){const e=Js(this.symbolLayer,"material","color"),i=this._getCombinedOpacity(e),r=i<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:i,transparent:r})}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,Tw)}slicePlaneEnabledChanged(){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}applyRendererDiff(e,i){for(const r in e.diff){if(r!=="visualVariables"||!GD(this._fastUpdates,i,this._vvConvertOptions))return Ks.Recreate_Symbol;this._material.setParameters(this._fastUpdates.materialParameters)}return Ks.Fast_Update}_getVertexData(e){let i=0;const r=e.paths,n=[],s=e.spatialReference,o=this._context.elevationProvider.spatialReference,a=this._context.renderCoordsHelper.spatialReference;for(const f of r)i+=f.length;const l=th(3*i),c=th(3*i);let h=0;for(const f of r){n.push({index:h,numVertices:f.length});for(const m of f)l[h++]=m[0],l[h++]=m[1],l[h++]=e.hasZ?m[2]:0}let p=!0;return v(o)&&!s.equals(o)&&(p=Nn(l,s,0,l,o,0,i)),v(o)&&!o.equals(a)?Nn(l,o,0,c,a,0,i):this._copyVertices(l,0,c,0,i),{pathVertexDataInfos:n,vertexDataES:l,vertexDataRS:c,projectionSuccess:p,terrainElevation:0}}_copyVertices(e,i,r,n,s){i*=3,n*=3;for(let o=0;o<s;++o)r[n++]=e[i++],r[n++]=e[i++],r[n++]=e[i++]}_createAs3DShape(e,i,r,n){const s=e.geometry,o=new Array,a=s.spatialReference,l=to(),c=this._context.renderCoordsHelper;k6e.spatialReference=a;const h=this._getVertexData(s);if(!h.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(h.pathVertexDataInfos.length===0)return s.paths.length!==0&&s.paths.some(g=>g.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;for(const g of h.pathVertexDataInfos){const _=g.index,b=g.numVertices;if(b<2||v(this._context.clippingExtent)&&(Br(l),Kh(l,h.vertexDataES,3*_,b),!Zf(l,this._context.clippingExtent)))continue;const w=[];for(let D=_;D<_+3*b;){const U=D++,V=D++,B=D++,ee=new mPt;he(ee.posES,h.vertexDataES[U],h.vertexDataES[V],h.vertexDataES[B]);const ie=OEt(ee.posES,this._context.elevationProvider,r,c);he(en,h.vertexDataRS[U],h.vertexDataRS[V],h.vertexDataRS[B]),c.setAltitude(en,ie),ce(ee.pos,en),w.push(ee)}const x=new _Pt(w);F6e(x,this._upVectorAlignment,this._context.renderCoordsHelper);const T=new wPt(x,this._profile,this._extruder,this._startCap,this._endCap);let E=null;if(this._fastUpdates.enabled){const D=this._fastUpdates.visualVariables,U=D.size?p_(D.size.field,e):0,V=D.color?p_(D.color.field,e):0,B=D.opacity?p_(D.opacity.field,e):0;E=new xPt(T,U,V,B)}else{const D=[this._intrinsicSize[0],this._intrinsicSize[1]];if(this._drivenProperties.size){const B=i.size;D[0]*=s1e(B[0],B[2]==="symbol-value"?this.symbolLayer.height||0:B[2],this.symbolLayer.width||0),D[1]*=s1e(B[2],B[0]==="symbol-value"?this.symbolLayer.width||0:B[0],this.symbolLayer.height||0)}let U;this._drivenProperties.color&&(U=i.color),this._drivenProperties.opacity&&i.opacity!=null&&(U=U?[U[0],U[1],U[2],i.opacity]:[1,1,1,i.opacity]);const V=new I6e(T);V.bake(D),U&&V.bakeVertexColors(U),E=V}const{vertexAttributes:C,indices:A}=E.createGeometryData(),I=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:this._context.layer.uid}),O=new cPt(this._material,C,A,E,a,this._upVectorAlignment,this._stencilWidth,I);O.transformation=E.xform,o.push(O)}if(o.length===0)return null;const p={layerUid:this._context.layer.uid,graphicUid:n},f=new iv({geometries:o,metadata:p}),m=new Ry(this,f,o,null,null,UPt,r);return m.alignedSampledElevation=h.terrainElevation,m.needsElevationUpdates=Tw(r.mode),m}};function F6e(t,e,i){switch(e){default:case Xb.World:for(const r of t.vertices){me(en,r.pos,t.offset),i.worldUpAtPosition(en,en),r.setFrameFromUpVector(en),r.rotationFrameUp=r.frame.up,dt(r.rotationRight,1,0),le(en,r.frame.up,be(r.frame.up,r.vLeft)),ge(en,r.vLeft,en),pl(en,en),we(en,en),le(kv,r.frame.up,be(r.frame.up,r.vRight)),ge(kv,r.vRight,kv),we(kv,kv),vt(o1e,r.rotationFrameUp,r.vLeft);const n=Math.sign(be(o1e,r.vRight));if(r.rotationAngle=n*(Math.PI-eo(be(en,kv))),Math.abs(r.rotationAngle)>0){const o=Bj(Math.cos(.5*r.rotationAngle));Gte(r.miterStretch,o-1+1,0,0,1)}const s=Math.PI-r.rotationAngle;r.maxStretchDistance=Math.abs(r.vMinSiblingLength/Math.cos(.5*s))}break;case Xb.Path:me(en,t.vertices[0].pos,t.offset),i.worldUpAtPosition(en,en),vPt(t,en);for(const r of t.vertices){const n=Math.sign(be(r.frame.right,r.vRight));vt(r.rotationFrameUp,r.vRight,r.vLeft),le(r.rotationFrameUp,r.rotationFrameUp,n),we(r.rotationFrameUp,r.rotationFrameUp);const s=be(r.rotationFrameUp,r.frame.up),o=be(r.rotationFrameUp,r.frame.right);if(le(en,r.frame.up,-o),le(kv,r.frame.right,s),me(en,en,kv),we(en,en),fPt(r.rotationRight,r.frame,en),pl(en,r.vLeft),r.rotationAngle=-n*(Math.PI-eo(be(en,r.vRight))),Math.abs(r.rotationAngle)>0){const l=Bj(Math.cos(.5*r.rotationAngle));Gte(r.miterStretch,1+(l-1)*r.rotationRight[0]*r.rotationRight[0],(l-1)*r.rotationRight[0]*r.rotationRight[1],(l-1)*r.rotationRight[0]*r.rotationRight[1],1+(l-1)*r.rotationRight[1]*r.rotationRight[1])}const a=Math.PI-r.rotationAngle;r.maxStretchDistance=Math.abs(r.vMinSiblingLength*Bj(Math.cos(.5*a)))}}}function s1e(t,e,i){switch(t){case"symbol-value":return i;case"proportional":return e;default:return t}}function kPt(t,e,i,r){let n=0;for(const s of t.vertices)i(s.posES,_W),n+=_W.sampledElevation,me(en,s.pos,t.offset),r.setAltitude(en,_W.z),ge(s.pos,en,t.offset);return t.updatePathVertexInformation(),n/t.vertices.length}function UPt(t,e,i,r,n){const s=t.stageObject,o=s.geometries;let a=0;VPt.spatialReference=n.spatialReference;for(const l of o){if(!A6e(l))continue;const c=l.path,h=c.builder.path,p=l.geometrySR;k6e.spatialReference=p,a+=kPt(h,e,r,n),l.upVectorAlignment!==Xb.World&&F6e(h,l.upVectorAlignment,n),c.onPathChanged(),l.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(l)}return a/o.length}const VPt=tv(0,0,0,null),k6e=tv(0,0,0,null),en=P(),kv=P(),o1e=P(),_W=new iF;function zPt(t,e,i,r,n=1){if(i.isGeographic&&r===qe.Global){const c=th(e.length),h=e.length,p=sr(i);for(let f=0;f<h;f+=3)pse(e,f,c,f,p);e=c}dt(js,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let c=0;c<e.length;c+=3)js[0]=Math.min(js[0],e[c]),js[1]=Math.min(js[1],e[c+1]);const s=js[0]%n,o=js[1]%n,a=js[0]-s,l=js[1]-o;for(let c=0;c<e.length;c+=3){const h=c/3*4;t[h]=(e[c]-a)/n,t[h+1]=(e[c+1]-l)/n,t[h+2]=a/n,t[h+3]=l/n}}function U6e(t,e,i,r,n=1){he(Cx,1,0,0),he(Ax,0,1,0),he(eC,0,0,1),GPt(vW,i),BPt(i,a1e)&&jPt(a1e,Cx,Ax,eC,r,vW),dt(js,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),dt(Rx,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let h=0;h<i.length;h+=3){he(QE,i[h],i[h+1],i[h+2]);const p=be(Cx,QE),f=be(Ax,QE);js[0]=Math.min(js[0],p),js[1]=Math.min(js[1],f),Rx[0]=Math.max(Rx[0],p),Rx[1]=Math.max(Rx[1],f)}const s=be(eC,vW);wW(Uv,js[0],js[1],s,Cx,Ax,eC),wW(Mx,Rx[0],js[1],s,Cx,Ax,eC),wW(Ox,js[0],Rx[1],s,Cx,Ax,eC),ge(Mx,Mx,Uv),le(Mx,Mx,.5),ge(Ox,Ox,Uv),le(Ox,Ox,.5),me(Uv,Uv,Mx),me(Uv,Uv,Ox);const o=js[0]%n,a=js[1]%n,l=js[0]-o,c=js[1]-a;for(let h=0;h<i.length;h+=3){he(QE,i[h],i[h+1],i[h+2]);const p=h/3,f=4*p;t[f]=(be(Cx,QE)-l)/n,t[f+1]=(be(Ax,QE)-c)/n,t[f+2]=l/n,t[f+3]=c/n;const m=9*p;for(let g=0;g<3;g++)e[m+g]=Uv[g],e[m+g+3]=Mx[g],e[m+g+6]=Ox[g]}}const vW=P(),QE=P(),a1e=Ji(),Cx=P(),Ax=P(),eC=P(),js=Fe(),Rx=Fe(),Uv=P(),Mx=P(),Ox=P();function BPt(t,e){const i=t.length/3-1;return kLe(t,e,0,Math.floor(i/3),Math.floor(i*(2/3)))}function jPt(t,e,i,r,n,s){v(n)?(n.basisMatrixAtPosition(s,Wm),he(rk,Wm[0],Wm[1],Wm[2]),he(nk,Wm[4],Wm[5],Wm[6]),he(bW,Wm[8],Wm[9],Wm[10])):(he(rk,1,0,0),he(nk,0,1,0),he(bW,0,0,1));const o=t;be(o,bW)<0&&le(o,o,-1),ce(r,o);const a=be(o,nk),l=be(o,rk);Math.abs(a)<Math.abs(l)?(gS(e,rk,o,-l),we(e,e),vt(i,e,o),we(i,i),le(i,i,-1)):(gS(i,nk,o,-a),we(i,i),vt(e,i,o),we(e,e))}const Wm=$e(),rk=P(),nk=P(),bW=P();function GPt(t,e){he(tP,0,0,0);for(let i=0;i<e.length-3;i+=3)tP[0]+=e[i],tP[1]+=e[i+1],tP[2]+=e[i+2];le(t,tP,1/(e.length/3-1))}const tP=P();function wW(t,e,i,r,n,s,o){he(t,e*n[0]+i*s[0]+r*o[0],e*n[1]+i*s[1]+r*o[1],e*n[2]+i*s[2]+r*o[2])}function HPt(t){const e=new ji,{vertex:i,fragment:r}=e,n=t.output===z.Depth,s=t.hasMultipassTerrain&&(t.output===z.Color||t.output===z.Alpha);return Yu(i,t),e.include(Gc,t),e.include(eE,t),e.include(x7,t),e.attributes.add(M.POSITION,"vec3"),e.varyings.add("vpos","vec3"),s&&e.varyings.add("depth","float"),n&&(e.include(N_,t),S2(e),_w(e)),i.code.add(S`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();
      ${s?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${n?S`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:S`transformPosition(proj, view, vpos);`}
    }
  `),e.include(fs,t),s&&e.include(hd,t),r.include(Cy),r.uniforms.add(new bi("eColor",o=>o.color)),t.output===z.Highlight&&e.include(Q_,t),r.code.add(S`
  void main() {
    discardBySlice(vpos);
    ${s?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = ${t.hasVertexColors?"vColor * eColor;":"eColor;"}

    ${t.output===z.ObjectAndLayerIdColor?S`fColor.a = 1.0;`:""}

    if (fColor.a < ${S.float(za)}) {
      discard;
    }

    ${t.output===z.Alpha?S`gl_FragColor = vec4(fColor.a);`:""}

    ${t.output===z.Color?S`gl_FragColor = highlightSlice(fColor, vpos); ${t.transparencyPassType===At.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    ${t.output===z.Highlight?S`outputHighlight();`:""};
    ${t.output===z.Depth?S`outputDepth(linearDepth);`:""};
    ${t.output===z.ObjectAndLayerIdColor?S`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const qPt=Object.freeze(Object.defineProperty({__proto__:null,build:HPt},Symbol.toStringTag,{value:"Module"}));let V6e=class z6e extends Yi{initializeConfiguration(e,i){i.hasWebGL2Context=e.rctx.type===Et.WEBGL2}initializeProgram(e){return new Hi(e.rctx,z6e.shader.get().build(this.configuration),Di)}_createPipeline(e,i){const r=this.configuration,n=e===At.NONE,s=e===At.FrontFace;return Ht({blending:r.output!==z.Color&&r.output!==z.Alpha||!r.transparent?null:n?nd:ev(e),culling:KB(r.cullFace),depthTest:{func:jw(e)},depthWrite:(n||s)&&r.writeDepth?Kc:null,colorWrite:si,stencilWrite:r.hasOccludees?by:null,stencilTest:r.hasOccludees?i?Cw:Gw:null,polygonOffset:n||s?r.polygonOffset?WPt:null:A7(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,i){return i?this._occludeePipelineState:super.getPipelineState(e,i)}};V6e.shader=new Gi(qPt,()=>Q(()=>import("./ColorMaterial.glsl-dbe762aa.js"),[]));const WPt={factor:1,units:1};let wu=class extends Do{constructor(){super(...arguments),this.output=z.Color,this.cullFace=Dr.None,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=At.NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1}};u([j({count:z.COUNT})],wu.prototype,"output",void 0),u([j({count:Dr.COUNT})],wu.prototype,"cullFace",void 0),u([j()],wu.prototype,"hasSlicePlane",void 0),u([j()],wu.prototype,"hasVertexColors",void 0),u([j()],wu.prototype,"transparent",void 0),u([j()],wu.prototype,"polygonOffset",void 0),u([j()],wu.prototype,"enableOffset",void 0),u([j()],wu.prototype,"writeDepth",void 0),u([j()],wu.prototype,"hasOccludees",void 0),u([j({count:At.COUNT})],wu.prototype,"transparencyPassType",void 0),u([j()],wu.prototype,"hasMultipassTerrain",void 0),u([j()],wu.prototype,"cullAboveGround",void 0),u([j()],wu.prototype,"objectAndLayerIdColorInstanced",void 0);let l1e=class extends lce{constructor(e){super(e,new YPt),this.supportsEdges=!0,this._configuration=new wu}getConfiguration(e,i){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<E7,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}requiresSlot(e,i){return i===z.Color||i===z.Alpha||i===z.Highlight||i===z.Depth&&this.parameters.writeLinearDepth||i===z.ObjectAndLayerIdColor?e===Ee.DRAPED_MATERIAL?!0:i===z.Highlight?e===Ee.OPAQUE_MATERIAL:e===(this.parameters.transparent?this.parameters.writeDepth?Ee.TRANSPARENT_MATERIAL:Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:Ee.OPAQUE_MATERIAL):!1}createGLMaterial(e){return new XPt(e)}createBufferWriter(){return new YO(ue("enable-feature:objectAndLayerId-rendering")?NAt:hke)}},XPt=class extends zw{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==z.Color&&this._output!==z.Alpha||this._updateOccludeeState(e),this.ensureTechnique(V6e,e)}},YPt=class extends HO{constructor(){super(...arguments),this.color=Qg,this.transparent=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Dr.None,this.hasOccludees=!1}};var da;(function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.Cross=2]="Cross",t[t.ForwardDiagonal=3]="ForwardDiagonal",t[t.BackwardDiagonal=4]="BackwardDiagonal",t[t.DiagonalCross=5]="DiagonalCross",t[t.COUNT=6]="COUNT"})(da||(da={}));const qte=.70710678118,c1e=qte,ZPt=.08715574274;function JPt(t){const e=new ji,i=t.hasMultipassTerrain&&(t.output===z.Color||t.output===z.Alpha);t.draped||e.extensions.add("GL_OES_standard_derivatives");const{vertex:r,fragment:n}=e;Yu(r,t),e.include(Gc,t),e.include(eE,t),t.draped?r.uniforms.add(new Ie("worldToScreenRatio",(a,l)=>1/l.screenToPCSRatio)):e.attributes.add(M.BOUNDINGRECT,"mat3"),e.attributes.add(M.POSITION,"vec3"),e.attributes.add(M.UVMAPSPACE,"vec4"),e.varyings.add("vpos","vec3"),e.varyings.add("vuv","vec2"),i&&e.varyings.add("depth","float");const s=t.style===da.ForwardDiagonal||t.style===da.BackwardDiagonal||t.style===da.DiagonalCross;s&&r.code.add(S`
      const mat2 rotate45 = mat2(${S.float(qte)}, ${S.float(-c1e)},
                                 ${S.float(c1e)}, ${S.float(qte)});
    `),t.draped||(xm(r,t),r.uniforms.add(new Ie("worldToScreenPerDistanceRatio",(a,l)=>1/l.camera.perScreenPixelRatio)),r.code.add(S`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),r.code.add(S`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),r.code.add(S`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${S.float(ZPt)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),r.code.add(S`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${s?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${s?" * rotate45":""};

      ${t.draped?"":S`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${S.float(t.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `);const o=t.output===z.Depth;return o&&(e.include(N_,t),S2(e),_w(e)),r.code.add(S`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${i?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      gl_Position = ${o?S`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:S`transformPosition(proj, view, vpos);`}
    }
  `),e.include(fs,t),n.include(Cy),t.draped&&n.uniforms.add(new Ie("texelSize",(a,l)=>1/l.camera.pixelRatio)),t.output===z.Highlight&&e.include(Q_,t),i&&e.include(hd,t),t.output!==z.Highlight&&(n.code.add(S`
      const float lineWidth = ${S.float(t.lineWidth)};
      const float spacing = ${S.float(t.patternSpacing)};
      const float spacingINV = ${S.float(1/t.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),t.draped||n.code.add(S`const int maxSamples = 5;
float sample(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),n.uniforms.add(new bi("uColor",a=>a.color)),n.code.add(S`
    void main() {
      discardBySlice(vpos);
      ${i?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = ${t.hasVertexColors?"vColor * uColor;":"uColor;"}
      color = highlightSlice(color, vpos);

      ${t.output!==z.Highlight?S`color.a *= ${KPt(t)};`:""}

      ${t.output===z.ObjectAndLayerIdColor?S`color.a = 1.0;`:""}

      if (color.a < ${S.float(za)}) {
        discard;
      }

      ${t.output===z.Alpha?S`gl_FragColor = vec4(color.a);`:""}

      ${t.output===z.Color?S`gl_FragColor = color; ${t.transparencyPassType===At.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
      ${t.output===z.Highlight?S`outputHighlight();`:""}
      ${t.output===z.Depth?S`outputDepth(linearDepth);`:""};
    }
  `),e}function KPt(t){function e(i){return t.draped?S`coverage(vuv.${i}, texelSize)`:S`sample(vuv.${i})`}switch(t.style){case da.ForwardDiagonal:case da.Horizontal:return e("y");case da.BackwardDiagonal:case da.Vertical:return e("x");case da.DiagonalCross:case da.Cross:return S`
        1.0 - (1.0 - ${e("x")}) * (1.0 - ${e("y")})
      `;default:return"0.0"}}const QPt=Object.freeze(Object.defineProperty({__proto__:null,build:JPt},Symbol.toStringTag,{value:"Module"}));let B6e=class j6e extends Yi{initializeConfiguration(e,i){i.hasWebGL2Context=e.rctx.type===Et.WEBGL2}initializeProgram(e){return new Hi(e.rctx,j6e.shader.get().build(this.configuration),G6e)}_setPipelineState(e,i){const r=this.configuration,n=e===At.NONE,s=e===At.FrontFace;return Ht({blending:r.output===z.Color||r.output===z.Alpha?n?nd:ev(e):null,culling:KB(r.cullFace),depthTest:{func:jw(e)},depthWrite:n?r.writeDepth?Kc:null:S7(e),colorWrite:si,stencilWrite:r.hasOccludees?by:null,stencilTest:r.hasOccludees?i?Cw:Gw:null,polygonOffset:n||s?r.polygonOffset?eIt:null:A7(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,i){return i?this._occludeePipelineState:super.getPipelineState(e,i)}};B6e.shader=new Gi(QPt,()=>Q(()=>import("./Pattern.glsl-c59c107a.js"),[]));const eIt={factor:1,units:1};let kl=class extends Do{constructor(){super(...arguments),this.output=z.Color,this.cullFace=Dr.None,this.transparencyPassType=At.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.writeDepth=!0,this.hasOccludees=!1,this.enableOffset=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}};u([j({count:z.COUNT})],kl.prototype,"output",void 0),u([j({count:Dr.COUNT})],kl.prototype,"cullFace",void 0),u([j({count:da.COUNT})],kl.prototype,"style",void 0),u([j({count:At.COUNT})],kl.prototype,"transparencyPassType",void 0),u([j()],kl.prototype,"hasSlicePlane",void 0),u([j()],kl.prototype,"hasVertexColors",void 0),u([j()],kl.prototype,"polygonOffset",void 0),u([j()],kl.prototype,"writeDepth",void 0),u([j()],kl.prototype,"hasOccludees",void 0),u([j()],kl.prototype,"patternSpacing",void 0),u([j()],kl.prototype,"lineWidth",void 0),u([j()],kl.prototype,"enableOffset",void 0),u([j()],kl.prototype,"draped",void 0),u([j()],kl.prototype,"hasMultipassTerrain",void 0),u([j()],kl.prototype,"cullAboveGround",void 0);const G6e=new Map([[M.POSITION,0],[M.COLOR,3],[M.UVMAPSPACE,4],[M.BOUNDINGRECT,5]]);let Tce=class extends lce{constructor(e){super(e,new rIt),this.supportsEdges=!0,this._vertexAttributeLocations=G6e,this._configuration=new kl}getConfiguration(e,i){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.style=this.parameters.style,this._configuration.patternSpacing=this.parameters.patternSpacing,this._configuration.lineWidth=this.parameters.lineWidth,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<E7,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}requiresSlot(e,i){return i===z.Color||i===z.Alpha||i===z.Highlight||i===z.Depth&&this.parameters.writeLinearDepth?e===Ee.DRAPED_MATERIAL?!0:i===z.Highlight?e===Ee.OPAQUE_MATERIAL:e===(this.parameters.writeDepth?Ee.TRANSPARENT_MATERIAL:Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):!1}createGLMaterial(e){return new tIt(e)}createBufferWriter(){const e=_n().vec3f(M.POSITION).vec4u8(M.COLOR).vec4f(M.UVMAPSPACE);return this.parameters.draped||e.mat3f(M.BOUNDINGRECT),new iIt(e)}},tIt=class extends zw{_updateParameters(e){return this.ensureTechnique(B6e,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==z.Color&&this._output!==z.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},iIt=class extends YO{write(e,i,r,n,s){for(const o of this.vertexBufferLayout.fieldNames){const a=r.vertexAttributes.get(o),l=r.indices.get(o);if(a&&l)switch(o){case M.POSITION:{wt(a.size===3);const c=n.getField(o,jr);c&&w7(l,a.data,e,c,s);break}case M.COLOR:{wt(a.size===3||a.size===4);const c=n.getField(o,vl);c&&Ule(l,a.data,a.size,c,s);break}case M.UVMAPSPACE:{wt(a.size===4);const c=n.getField(o,eh);c&&tO(l,a.data,c,s);break}case M.BOUNDINGRECT:{wt(a.size===9);const c=n.getField(o,vw);c&&this.writeBoundingRect(l,a.data,e,c,s);break}}}}writeBoundingRect(e,i,r,n,s){const o=r,a=n.typedBuffer,l=n.typedBufferStride,c=e.length;s*=l;for(let h=0;h<c;++h){const p=9*e[h],f=i[p],m=i[p+1],g=i[p+2];a[s]=o[0]*f+o[4]*m+o[8]*g+o[12],a[s+1]=o[1]*f+o[5]*m+o[9]*g+o[13],a[s+2]=o[2]*f+o[6]*m+o[10]*g+o[14];for(let _=3;_<9;++_)a[s+_]=i[p+_];s+=l}}},rIt=class extends HO{constructor(){super(...arguments),this.color=Zt(1,1,1,1),this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Dr.None,this.hasOccludees=!1,this.style=da.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}};function nIt(t,e,i){return oIt(sIt(t),e,i)}function sIt(t){return t&&t.pattern||null}function oIt(t,e,i){return v(t)?t.style==="none"||t.style==="solid"?(t.style==="none"&&(e.color=Zt(0,0,0,0),e.transparent=!0),new l1e(e)):(e.style=aIt(t.style),e.draped=i.isDraped,new Tce(e)):new l1e(e)}function aIt(t){switch(t){case"horizontal":return da.Horizontal;case"vertical":return da.Vertical;case"cross":return da.Cross;case"forward-diagonal":return da.ForwardDiagonal;case"backward-diagonal":return da.BackwardDiagonal;case"diagonal-cross":return da.DiagonalCross;default:return}}function lIt(t){return t.material instanceof Tce&&!t.material.parameters.draped}function cIt(t,e){if(lIt(t)){const i=t.vertexAttributes.get(M.POSITION).data,r=t.getMutableAttribute(M.UVMAPSPACE).data,n=t.getMutableAttribute(M.BOUNDINGRECT).data;U6e(r,n,i,e)}}function uIt(t,e,i,r,n){const s=m5e(t,e,i,r,n),o=t.stageObject.geometries;for(const a of o)cIt(a,n);return s}const hIt=["polyline","polygon","extent"];let H6e=class q6e extends My{constructor(e,i,r,n){super(e,i,r,n),this._needsUV=!1,this._hasOutline=!1}async doLoad(){}_ensureMaterials(){this._ensureFillMaterial(),this._ensureOutlineMaterial()}_ensureFillMaterial(){if(v(this._material))return;const e=Js(this.symbolLayer,"material","color"),i=this._getCombinedOpacityAndColor(e);this._material=nIt(this.symbolLayer,{color:i,transparent:i[3]<1||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,hasSlicePlane:this._context.slicePlaneEnabled},{isDraped:this.draped}),this._needsUV=this._material instanceof Tce,this._context.stage.add(this._material)}_ensureOutlineMaterial(){const e=this.symbolLayer.outline;if(v(this._outlineMaterial)||!this._isValidOutline(e))return;this._hasOutline=!0;const i=r=>{const n=e6e(e.pattern);return new fR({width:r,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:n,stippleScaleWithLineWidth:!0,cap:Ute(e.patternCap||"butt")})};this._outlineMaterial=i(ga(e.size)),this._context.stage.add(this._outlineMaterial)}_isValidOutline(e){return v(e)&&e.size!=null&&e.size>0&&v(e.color)&&(R(e.pattern)||e.pattern.type!=="style"||e.pattern.style!=="none")}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null,this._context.stage.remove(this._outlineMaterial),this._outlineMaterial=null}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,hIt,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(e.renderingInfo,255),n=this.setGraphicElevationContext(i,new Om);return this.ensureDrapedStatus(n.mode==="on-the-ground"),this._ensureMaterials(),this.draped?this._createAsOverlay(i,r):this._createAs3DShape(i,r,n)}layerOpacityChanged(){if(v(this._material)){const e=this._material.parameters.color,i=Js(this.symbolLayer,"material","color"),r=this._getCombinedOpacity(i);this._material.setParameters({color:[e[0],e[1],e[2],r],transparent:r<1||this.needsDrivenTransparentPass})}if(v(this._outlineMaterial)){const e=this._outlineMaterial.parameters.color;this._outlineMaterial.setParameters({color:[e[0],e[1],e[2],this._getOutlineOpacity()]})}}layerElevationInfoChanged(e,i,r){const n=this._elevationContext.mode,s=tF(q6e.elevationModeChangeTypes,r,n);if(s!==Ln.UPDATE)return s;const o=Up(n);return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){if(v(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),v(this._outlineMaterial)){const e={hasSlicePlane:this._context.slicePlaneEnabled};this._outlineMaterial.setParameters(e)}return!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_createAs3DShape(e,i,r){var h;const n=UD(e.geometry);if(R(n))return null;const s=mce(n,this._context.elevationProvider,this._context.renderCoordsHelper,r),o=new dIt(s,i,this._context.layer.uid,e.uid),a=o.renderData.position.length/3;if(this._needsUV&&(o.uvMapSpace=ps(4*a,!0),o.boundingRect=th(9*a,!0),U6e(o.uvMapSpace,o.boundingRect,o.renderData.position,this._context.renderCoordsHelper)),o.objectAndLayerIdColor=(h=this._context.stage.renderView)==null?void 0:h.getObjectAndLayerIdColor(o),this._createAs3DShapeFill(o),this._hasOutline&&this._createAs3DShapeOutline(o),this._logGeometryCreationWarnings(o.renderData,n.rings,"rings","FillSymbol3DLayer"),o.outGeometries.length===0)return null;const l=new iv({geometries:o.outGeometries,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:e.uid}}),c=new Ry(this,l,o.outGeometries,null,null,uIt,r);return c.alignedSampledElevation=o.renderData.sampledElevation,c.needsElevationUpdates=Up(r.mode),c}_createAs3DShapeFill(e){const i=e.renderData.polygons;for(const{position:r,mapPositions:n,holeIndices:s,index:o,count:a}of i){if(v(this._context.clippingExtent)&&(Br(Ed),Kh(Ed,n),!Zf(Ed,this._context.clippingExtent)))continue;const l=Sw(n,s,3);if(l.length===0)continue;const c=V_e({material:this._material,indices:l,mapPositions:n,attributeData:{position:r,color:e.color,uvMapSpace:this._needsUV?zye(e.uvMapSpace,4*o,4*a):null,boundingRect:this._needsUV?Sp(e.boundingRect,9*o,9*a):null,objectAndLayerIdColor:e.objectAndLayerIdColor}});e.outGeometries.push(c)}}_createAs3DShapeOutline(e){if(!this._hasOutline)return;const i=e.renderData.outlines;for(let r=0;r<i.length;++r){const{mapPositions:n,position:s}=i[r];if(v(this._context.clippingExtent)&&(Br(Ed),Kh(Ed,n),!Zf(Ed,this._context.clippingExtent)))continue;const o=Vte(this._outlineMaterial,{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:n,attributeData:{position:s}},e.objectAndLayerIdColor),a=o.vertexAttributes.get(M.POSITION);a.data===s&&(a.data=Svt(s)),e.outGeometries.push(o)}}_createAsOverlay(e,i){var a;const r=UD(e.geometry);if(R(r))return null;this._material.renderPriority=this._renderPriority+this._renderPriorityStep/2,v(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority);const n=Rke(r,this._context.overlaySR),s=new pIt(n,i,this._context.layer.uid,e.uid),o=s.renderData.position.length/3;return this._needsUV&&(s.uvMapSpace=ps(4*o,!0),zPt(s.uvMapSpace,s.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode)),s.outBoundingBox=Br(),s.objectAndLayerIdColor=(a=this._context.stage.renderView)==null?void 0:a.getObjectAndLayerIdColor(s),this._createAsOverlayFill(s),this._hasOutline&&this._createAsOverlayOutline(s),this._logGeometryCreationWarnings(s.renderData,r.rings,"rings","FillSymbol3DLayer"),s.outGeometries.length===0?null:new D7(this,s.outGeometries,s.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayFill(e){const i=e.renderData.polygons;for(const{position:r,holeIndices:n,index:s,count:o}of i){const a=Br(Ed);if(Kh(a,r),!Zf(a,this._context.clippingExtent))continue;const l=Sw(r,n,3);if(l.length===0)continue;wM(e.outBoundingBox,a);const c=V_e({material:this._material,indices:l,attributeData:{position:r,color:e.color,uvMapSpace:this._needsUV?zye(e.uvMapSpace,4*s,4*o):null,objectAndLayerIdColor:e.objectAndLayerIdColor}}),h=new nO(c,e);cr(h.boundingSphere,.5*(a[0]+a[3]),.5*(a[1]+a[4]),0,.5*Math.sqrt((a[3]-a[0])*(a[3]-a[0])+(a[4]-a[1])*(a[4]-a[1]))),e.outGeometries.push(h)}}_createAsOverlayOutline(e){if(!this._hasOutline)return;const i=e.renderData.outlines;for(let r=0;r<i.length;++r){const{position:n}=i[r];if(Br(Ed),Kh(Ed,n),!Zf(Ed,this._context.clippingExtent))continue;wM(e.outBoundingBox,Ed);const s=Vte(this._outlineMaterial,{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:n}},e.objectAndLayerIdColor),o=new nO(s,e),a=Ed;cr(o.boundingSphere,.5*(a[0]+a[3]),.5*(a[1]+a[4]),0,.5*Math.sqrt((a[3]-a[0])*(a[3]-a[0])+(a[4]-a[1])*(a[4]-a[1]))),e.outGeometries.push(o)}}_getOutlineOpacity(){const e=Js(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*(v(e)?e.a:0)}_getOutlineColor(){const e=Js(this.symbolLayer,"outline","color"),i=this._getOutlineOpacity();return tL(v(e)?Xe.toUnitRGB(e):null,i)}test(){return{...super.test(),createAsOverlay:(e,i)=>this._createAsOverlay(e,i),createAs3DShape:(e,i,r)=>this._createAs3DShape(e,i,r)}}};H6e.elevationModeChangeTypes={definedChanged:Ln.RECREATE,staysOnTheGround:Ln.NONE,onTheGroundChanged:Ln.RECREATE};const Ed=to();let dIt=class extends P7{constructor(e,i,r,n){super(e,r,n),this.color=i}},pIt=class extends P7{constructor(e,i,r,n){super(e,r,n),this.color=i}},W6e=class X6e{constructor(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.textStyle=this._colorToRGBA(e.color),this.haloStyle=this._colorToRGB(e.halo.color),this.backgroundStyle=e.background.color[3]!==0?this._colorToRGBA(e.background.color):null}fontString(e){const i=this.definition.font;return`${i.style} ${i.weight} ${e}px ${i.family}, sans-serif`}_colorToRGB(e){return`rgb(${e.slice(0,3).map(i=>Math.floor(255*i)).toString()})`}_colorToRGBA(e){return`rgba(${e.slice(0,3).map(i=>Math.floor(255*i)).toString()},${e[3]})`}static async fromSymbol(e,i){const r=Js(e,"material","color"),n=jh(r,Qg,Xe.toUnitRGBA),s=jh(e.size,12,ga),o=e.lineHeight,a=v(e.background)?Xe.toUnitRGBA(e.background.color):Qg,l={family:jh(e.font,"sans-serif",m=>m.family),decoration:jh(e.font,"none",m=>m.decoration),weight:jh(e.font,"normal",m=>m.weight),style:jh(e.font,"normal",m=>m.style)},c=e.halo,h=v(c)&&v(c.color)&&c.size>0?{size:ga(c.size),color:Xe.toUnitRGBA(c.color)}:{size:0,color:Qg},p=new X6e({color:n,size:s,background:{color:a,padding:v(e.background)?[.65*s,.5*s]:[0,0],borderRadius:v(e.background)?s*(6/16):0},lineSpacingFactor:o,font:l,halo:h,pixelRatio:i}),f=p.fontString(s);try{await document.fonts.load(f)}catch{re.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${f}'. Some text symbology may be rendered using the default browser font.`)}return p}},fIt=class{constructor(e,i,r){this._renderer=new Gke(e,i,r)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const e=Nte(mIt,this._renderer.renderedWidth,this._renderer.renderedHeight),i=e.getContext("2d");return i.save(),this._renderer.render(i,0,0),i.restore(),new Q2(e,{wrap:{s:$t.CLAMP_TO_EDGE,t:$t.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0,powerOfTwoResizeMode:jb.PAD})}};const mIt={canvas:null},gIt=[0,0,1];let yIt=class extends My{constructor(e,i,r,n){super(e,i,r,n),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=R7(this.symbolLayer.size);if(e)throw new H("graphics3dtextsymbollayer:invalid-size",e)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const e=this._context.graphicsCoreOwner.view.state.rasterPixelRatio;this._textRenderParameters=await W6e.fromSymbol(this.symbolLayer,e)}destroy(){super.destroy()}createGraphics3DGraphic(e){const i=e.graphic,r=kD(i.geometry);if(R(r))return this.logger.warn(`unsupported geometry type for text symbol: ${i.geometry.type}`),null;const n=this.symbolLayer.text;if(R(n)||n==="")return null;const s=nse(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(v(s)&&!lAe(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const o=new d5e(s,this.symbolLayer.horizontalAlignment,fMt(this.symbolLayer.verticalAlignment));return this._createAs3DShape(i,r,n,o)}createLabel(e,i,r,n){const s=e.graphic,o=kD(s.geometry);if(R(o))return this.logger.warn(`unsupported geometry type for label: ${s.geometry.type}`),null;const a=i.text;return!a||/^\s+$/.test(a)?null:this._createAs3DShape(s,o,a,i,r,n)}setGraphicElevationContext(e,i,r=0){const n=super.setGraphicElevationContext(e,i);return n.addOffsetRenderUnits(r),n}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(e,i){return u1e(e,i,(r,n)=>{this.updateGraphicElevationContext(n,r)}),Ln.UPDATE}slicePlaneEnabledChanged(e,i){return u1e(e,i,r=>{for(const n of r.stageObject.geometries)n.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!1}skipHighSymbolLodsChanged(){return!0}updateGraphicElevationContext(e,i){const r=i.elevationContext;this.setGraphicElevationContext(e,r,v(i.metadata)?i.metadata.elevationOffset:0),i.needsElevationUpdates=Up(r.mode)||r.mode==="absolute-height"}_defaultElevationInfoNoZ(){return vIt}_createAs3DShape(e,i,r,n,s,o){const a=this.setGraphicElevationContext(e,new Om,n.elevationOffset),l=Js(e.geometry,"type")==="polyline",c=e.uid;let h=null,p=null;if(R(o)){const O=qke(n.horizontalPlacement);h=new fIt(r,O,this._textRenderParameters);let D=null;if(v(this._context.sharedResources.textures)){p=this._context.sharedResources.textures.fromData(h.key,()=>h.create(),()=>{v(D)&&D.release()});const U=this._context.stage.renderView.textureRepository.acquire(p.texture.id);if(R(U)||ih(U))return p.release(),null;D=U}}const f=_It(h,n),m={occlusionTest:!0,screenOffset:n.screenOffset,anchorPosition:f,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:n.centerOffsetUnits,drawInSecondSlot:!0};if(v(o)?m.textureId=o.id:v(p)&&(m.textureId=p.texture.id),v(n.verticalOffset)){const{screenLength:O,minWorldLength:D,maxWorldLength:U}=n.verticalOffset;m.verticalOffset={screenLength:ga(O),minWorldLength:D||0,maxWorldLength:v(U)?U:1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:O,screenSizePerspectiveSettingsLabels:D}=this._context.sharedResources;m.screenSizePerspective=D.overridePadding(this._textRenderParameters.haloSize+this._textRenderParameters.definition.background.padding[0]),m.screenSizePerspectiveAlignment=O}let g;if(l&&(m.shaderPolygonOffset=1e-4),m.hasSlicePlane=this._context.slicePlaneEnabled,v(s)){const O=JSON.stringify(m);g=s.get(O),R(g)&&(g=new iO(m),s.add(O,g))}else g=new iO(m);const _=n.translation,b=v(h)?Mi(h.displayWidth,h.displayHeight):Jc,w=n.centerOffset,x=rte(g,gIt,_,null,b,w,[0,0],null),T=ece(this._context,i,x,a,c);if(R(T))return null;const E=new Ry(this,T.object,[x],R(s)?[g]:null,p,ND,a);E.alignedSampledElevation=T.sampledElevation,E.needsElevationUpdates=Up(a.mode)||a.mode==="absolute-height";const{displayWidth:C,displayHeight:A}=v(h)?h:n;E.getScreenSize=(O=Fe())=>(O[0]=C,O[1]=A,O);const I=new x5e(n.elevationOffset,r);return E.metadata=I,FD(E,i,this._context.elevationProvider),E}};function u1e(t,e,i){t&&t.forEach(r=>{const n=e(r);v(n)&&i(n,r.graphic)})}function _It(t,e){if(e.verticalPlacement==="baseline"){const r=hMt[e.horizontalPlacement],n=v(t)?t.baselineAnchorY:0;return Mi(r,n)}const i=pMt(e.horizontalPlacement,e.verticalPlacement);return BU[i]}const vIt={mode:"relative-to-ground",offset:0},bIt={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},wIt=["polyline","polygon","extent"];let Wte=class LT extends My{constructor(e,i,r,n){super(e,i,r,n)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,wIt,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i,new Om);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.ensureMaterial(),this.draped?this._createAsOverlay(i):this._createAs3DShape(i,r,i.uid)}ensureMaterial(){if(v(this._material))return;const e=new _ke,i=this.symbolLayer.color;v(i)&&(e.color=Xe.toUnitRGBA(i));const r=this._getCombinedOpacity(i,{hasIntrinsicColor:!0});e.color=[e.color[0],e.color[1],e.color[2],r],e.transparent=r<1||this.needsDrivenTransparentPass,e.waveDirection=v(this.symbolLayer.waveDirection)?LT.headingVectorFromAngle(this.symbolLayer.waveDirection):Mi(0,0);const n=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,s=bIt[n];e.waveStrength=s.waveStrength,e.waveTextureRepeat=s.textureRepeat,e.waveVelocity=s.waveVelocity,e.flowStrength=s.perturbationStrength,e.hasSlicePlane=this._context.slicePlaneEnabled,e.isDraped=this.draped,this._material=new yke(e),this._context.stage.add(this._material)}layerOpacityChanged(){if(R(this._material))return;const e=this._material.parameters.color,i=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),r=i<1||this.needsDrivenTransparentPass;this._material.setParameters({color:[e[0],e[1],e[2],i],transparent:r})}layerElevationInfoChanged(e,i,r){const n=this._elevationContext.mode,s=tF(LT.elevationModeChangeTypes,r,n);if(s!==Ln.UPDATE)return s;const o=Up(n);return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){return v(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_createAs3DShape(e,i,r){const n=UD(e.geometry);if(R(n))return null;const s=mce(n,this._context.elevationProvider,this._context.renderCoordsHelper,i),o=s.position.length/3,a=th(2*o);this._createUVCoordsFromVertices(a,s.mapPositions,o,this._context.elevationProvider.spatialReference);const l=new xIt(s,a);if(this._create3DShapeGeometries(l),this._logGeometryCreationWarnings(l.renderData,n.rings,"rings","WaterSymbol3DLayer"),l.outGeometries.length===0)return null;const c=new iv({geometries:l.outGeometries,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:r}}),h=new Ry(this,c,l.outGeometries,null,null,m5e,i);return h.alignedSampledElevation=l.renderData.sampledElevation,h.needsElevationUpdates=Up(i.mode),h}_createUVCoordsFromVertices(e,i,r,n){const s=tc(n);od(Vv);for(let l=0;l<r;l++)dt(h1e,i[3*l],i[3*l+1]),Nne(Vv,h1e);gO(Vv,Vv,s);const o=Vv[0]%LT.unitSizeOfTexture,a=Vv[1]%LT.unitSizeOfTexture;sk[0]=Vv[0]-o,sk[1]=Vv[1]-a;for(let l=0;l<r;l++)e[2*l]=(i[3*l]*s-sk[0])/LT.unitSizeOfTexture,e[2*l+1]=(i[3*l+1]*s-sk[1])/LT.unitSizeOfTexture}_create3DShapeGeometries(e){const i=e.renderData.polygons,r=e.uvCoords;for(const{count:n,index:s,position:o,mapPositions:a,holeIndices:l}of i){if(v(this._context.clippingExtent)&&(Br(zv),Kh(zv,a),!Zf(zv,this._context.clippingExtent)))continue;const c=Sw(a,l,3);if(c.length===0)continue;const h=Sp(r,2*s,2*n),p=z_e({material:this._material,indices:c,mapPositions:a,attributeData:{position:o,uv0:h}});e.outGeometries.push(p)}}_createAsOverlay(e){const i=UD(e.geometry);if(R(i))return null;this._material.renderPriority=this._renderPriority;const r=Rke(i,this._context.overlaySR),n=r.position.length/3,s=th(2*n);this._createUVCoordsFromVertices(s,r.position,n,this._context.overlaySR);const o=new TIt(r,s,this._context.layer.uid,e.uid);return o.outBoundingBox=Br(),this._createAsOverlayWater(o),this._logGeometryCreationWarnings(o.renderData,i.rings,"rings","WaterSymbol3DLayer"),o.outGeometries.length===0?null:new D7(this,o.outGeometries,o.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayWater(e){const i=e.uvCoords,r=e.renderData.polygons;for(const{position:n,holeIndices:s,index:o,count:a}of r){if(Br(zv),Kh(zv,n),!Zf(zv,this._context.clippingExtent))continue;wM(e.outBoundingBox,zv);const l=Sw(n,s,3);if(l.length===0)continue;const c=Sp(i,2*o,2*a),h=z_e({material:this._material,indices:l,attributeData:{position:n,uv0:c}}),p=new nO(h,e),f=zv;cr(p.boundingSphere,.5*(f[0]+f[3]),.5*(f[1]+f[4]),0,.5*Math.sqrt((f[3]-f[0])*(f[3]-f[0])+(f[4]-f[1])*(f[4]-f[1]))),e.outGeometries.push(p)}}static headingVectorFromAngle(e){const i=Fe(),r=wN(e);return i[0]=Math.sin(r),i[1]=Math.cos(r),i}test(){return{...super.test(),create3DShape:e=>this._createAs3DShape(e.graphic,e.elevationContext,e.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}};Wte.unitSizeOfTexture=100,Wte.elevationModeChangeTypes={definedChanged:Ln.RECREATE,staysOnTheGround:Ln.NONE,onTheGroundChanged:Ln.RECREATE};const sk=Fe(),Vv=Kt(),h1e=Fe(),zv=to();let xIt=class extends P7{constructor(e,i){super(e,null,null),this.uvCoords=i}},TIt=class extends P7{constructor(e,i,r,n){super(e,r,n),this.uvCoords=i}};function SIt(t,e,i,r){const n=d1e[t.type]&&d1e[t.type][e.type]||EIt[e.type];return n?new n(t,e,i,r):(re.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",`unknown symbol type ${e.type}`),null)}const EIt={icon:kte,object:B3t,line:t6e,path:FPt,fill:H6e,extrude:ZRt,text:yIt,water:Wte},d1e={"mesh-3d":{fill:SOt}};let CIt=class extends Jle{set symbol(e){this._symbol=e,e.symbolLayers.forEach((i,r)=>{const n=this.symbolLayers[r];v(n)&&(n.symbol=e,n.symbolLayer=i)})}get symbol(){return this._symbol}constructor(e,i,r){super(i.schedule),this._symbol=e,this._context=i,this._backgroundLayers=r,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(e){let i=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(i=this._backgroundLayers.concat(i));const r=i.length;for(;this.symbolLayers.length<i.length;)this.symbolLayers.push(null);this.symbolLayers.length=i.length;const n=[];for(let s=0;s<r;s++){const o=i.getItemAt(s);if(o.enabled===!1)continue;ok.renderPriority=1-(1+s)/r,ok.renderPriorityStep=1/r,ok.ignoreDrivers=o._ignoreDrivers;const a=SIt(this.symbol,o,this._context,ok),l=P9(e,()=>{this.symbolLayers[s]=null,a.destroy()});l&&n.push(l),this.symbolLayers[s]=a}if(await vB(this.symbolLayers,async(s,o)=>{if(v(s))try{await s.load(),this._extentPadding+=Math.max(this._extentPadding,s.extentPadding)}catch{this.symbolLayers[o]=null}}),n.forEach(s=>s.remove()),ui(e),this.symbolLayers.length&&!this.symbolLayers.some(s=>!!s))throw new Error}getSymbolLayerSize(e){const i=this.symbolLayers[e];return v(i)?i.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(e=>v(e)&&e.queryForSnapping)}createGraphics3DGraphic(e,i){const r=e.graphic,n=new Array(this.symbolLayers.length);for(let o=0;o<this.symbolLayers.length;o++){const a=this.symbolLayers[o];n[o]=v(a)?a.createGraphics3DGraphic(e):null}const s=this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null;return new TCt(r,i||this,n,e.layer,s)}get complexity(){return Qle(this.symbolLayers.map(e=>Js(e,"complexity")))}globalPropertyChanged(e,i){const r=this.symbolLayers.length;for(let n=0;n<r;n++){const s=this.symbolLayers[n],o=a=>{const l=a.layers[n];return l instanceof Ry?l:null};if(v(s)&&!s.globalPropertyChanged(e,i,o))return!1}return!0}applyRendererDiff(e,i){return this.loadStatus!==Bh.LOADED?Ks.Recreate_Symbol:this.symbolLayers.reduce((r,n)=>r!==Ks.Recreate_Symbol&&v(n)?Math.min(r,n.applyRendererDiff(e,i)):r,Ks.Fast_Update)}prepareSymbolPatch(e){if(this.loadStatus===Bh.FAILED||e.diff.type!=="partial")return;const i=e.diff.diff;if(!i.symbolLayers||i.symbolLayers.type!=="partial")return;const r=i.symbolLayers.diff;this.symbolLayers.forEach((n,s)=>{if(R(n))return;const o=r[s];if(o){const a={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};n.prepareSymbolLayerPatch(a),e.symbolStatePatches.push(...a.symbolLayerStatePatches),a.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((l,c)=>{const h=l.layers[s];v(h)&&a.graphics3DGraphicPatches.forEach(p=>p(h,c))})}})}updateGeometry(e,i){for(let r=0;r<this.symbolLayers.length;r++){const n=this.symbolLayers[r];if(R(n))continue;const s=e.layers[r];if(R(s)||!n.updateGeometry(s,i))return!1}return!0}onRemoveGraphic(e){for(let i=0;i<this.symbolLayers.length;i++){const r=this.symbolLayers[i];if(R(r))continue;const n=e.layers[i];v(n)&&r.onRemoveGraphic(n)}}getFastUpdateStatus(){let e=0,i=0,r=0;return this.symbolLayers.forEach(n=>{R(n)||(n.loadStatus===Bh.LOADING?e++:n.isFastUpdatesEnabled()?r++:i++)}),{loading:e,slow:i,fast:r}}async queryForSnapping(e,i,r,n){const s=this.symbolLayers.filter(v).filter(a=>v(a.queryForSnapping)).map(a=>a.queryForSnapping(e,i,r,n)),o=await Promise.all(s);return ui(n),o.flat()}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const e of this.symbolLayers)v(e)&&e.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}};const ok={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1};let AIt=class extends Jle{constructor(e,i,r){super(i),this.symbol=e,this._convert=r,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return v(this.graphics3DSymbol)?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return v(this.graphics3DSymbol)?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return v(this.graphics3DSymbol)?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const i=await this.symbol.fetchSymbol({signal:e});i.id=this.symbol.id,this.graphics3DSymbol=this._convert(i),v(this.graphics3DSymbol)&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return v(this.graphics3DSymbol)?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return v(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:Kle}globalPropertyChanged(e,i){return!!v(this.graphics3DSymbol)&&this.graphics3DSymbol.globalPropertyChanged(e,i)}applyRendererDiff(e,i){return v(this.graphics3DSymbol)?this.graphics3DSymbol.applyRendererDiff(e,i):Ks.Recreate_Symbol}prepareSymbolPatch(e){v(this.graphics3DSymbol)&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,i){return!!v(this.graphics3DSymbol)&&this.graphics3DSymbol.updateGeometry(e,i)}onRemoveGraphic(){}getFastUpdateStatus(){return v(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){v(this.graphics3DSymbol)&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}};function Sce(t){return t instanceof AIt?t.graphics3DSymbol:t instanceof CIt?t:null}const HD=re.getLogger("esri.views.3d.layers.graphics.labelPlacement");function RIt(t){const e=FIt(t);if(R(e))return null;const i=MIt(t,e);if(R(i))return null;const r=i.anchor,n=!!e.hasLabelVerticalOffset;return PIt({anchor:r,verticalOffset:e.verticalOffset,screenOffset:Fe(),centerOffset:Zt(0,0,0,-1),centerOffsetUnits:"world",translation:P(),elevationOffset:0,hasLabelVerticalOffset:n},i,t)}function MIt(t,e){if(e.anchor)return e;const i=t.labelClass.labelPlacement,r=im[i],n=r||Hz(t);return i&&!r&&HD.warnOncePerTick(`the requested label placement '${i}' is currently unsupported in SceneView.`),OIt(n,t)}function Ece(t){const e=t.graphics3DGraphic.graphics3DSymbol,i=Sce(e);return v(i)?i.symbol.symbolLayers.getItemAt(0):null}function OIt(t,e){const i=e.graphics3DGraphic.graphic.geometry;if(R(i))return null;if(v(e.disablePlacement))return e.labelClass.labelPlacement?(HD.warnOncePerTick(p1e(t.placement,e.disablePlacement.logEntityDescription)),Hz(e)):t;const r=i.type;switch(r){case"polyline":case"polygon":case"extent":case"multipoint":if(e.labelClass.labelPlacement)return HD.warnOncePerTick(p1e(t.placement,`'${r}' geometries`)),Hz(e);break;case"point":case"mesh":return t}return t}function p1e(t,e){return`the requested label placement '${t}' is currently unsupported for ${e} in SceneView.`}function Hz(t){const e=t.graphics3DGraphic.graphic.geometry;if(R(e))return null;switch(e.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case"polygon":{const i=Ece(t);return v(i)&&i.type==="extrude"?im["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"}}case"point":case"mesh":return im["above-center"];default:return}}function PIt(t,e,i){const r=i.graphics3DGraphic.graphic.geometry;if(R(r))return null;switch(r.type){case"point":$It(t,e,i);break;case"polygon":IIt(t,e,i);break;case"mesh":Cce(t,e,i.graphics3DGraphic.layers[0])}return t}function IIt(t,e,i){const r=Ece(i);if(!R(r))switch(r.type){case"extrude":{const n=i.graphics3DGraphic.layers[0];v(n)?(n.getBoundingBoxObjectSpace(cL),Yf(cL,t.translation),t.translation[2]=Lw(cL)/2):he(t.translation,0,0,0),Cce(t,e,n);break}}}function $It(t,e,i){const r=Ece(i);if(R(r))return;const n=i.graphics3DGraphic.layers[0];switch(v(n)?n.getCenterObjectSpace(t.translation):he(t.translation,0,0,0),r.type){case"icon":case"text":LIt(t,e,i,n);break;case"object":Cce(t,e,n)}}function LIt(t,e,i,r){const{graphics3DGraphic:n}=i,s=v(r)?r.getScreenSize():null;if(!n.isDraped&&v(s)){const o=DIt(i);iP[0]=s[0]/2*(e.normalizedOffset[0]-o[0]),iP[1]=s[1]/2*(e.normalizedOffset[1]-o[1]),t.screenOffset[0]=iP[0],t.hasLabelVerticalOffset?(t.centerOffset[1]=iP[1],t.centerOffsetUnits="screen"):t.screenOffset[1]=iP[1]}else t.hasLabelVerticalOffset||t.anchor==="center"||(im[i.labelClass.labelPlacement]&&HD.warnOncePerTick(`the requested placement '${e.placement}' is currently unsupported for draped graphics`),t.anchor="center")}function DIt(t,e=kIt){const{graphics3DGraphic:i}=t,r=i.layers[0],n=v(r)?r.stageObject.geometries[0].material:null;if(n&&n instanceof iO){const s=n.parameters.anchorPosition;e[0]=2*(s[0]-.5),e[1]=2*(s[1]-.5)}else e[0]=0,e[1]=0;return e}function Cce(t,e,i){const r=v(i)?i.getBoundingBoxObjectSpace(cL):cL,n=Ue(r[3]-r[0],r[4]-r[1],r[5]-r[2]),s=Math.sqrt(n[0]*n[0]+n[1]*n[1]);t.centerOffset[0]=s/2*e.normalizedOffset[0];const o=t.translation[2],a=n[2]/2*e.normalizedOffset[1];t.translation[2]=0,t.elevationOffset=o+a;const l=Pe(n);t.centerOffset[2]=l/2*e.normalizedOffset[2]}function NIt(t){return t==="above-center"}function FIt(t){const e=t.labelClass.labelPlacement,{labelSymbol:i,graphics3DGraphic:r}=t,n=Sce(r.graphics3DSymbol),s=Vo(n,a=>a.symbol.type==="point-3d"?a.symbol:null),o=im[e]||Hz(t);return v(s)&&s.supportsCallout()&&s.hasVisibleVerticalOffset()&&!r.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:f1e(s.verticalOffset),anchor:null,normalizedOffset:null}:i&&i.hasVisibleVerticalOffset()&&(R(s)||!s.supportsCallout()||!s.verticalOffset||r.isDraped)?NIt(o.placement)?{placement:"above-center",verticalOffset:f1e(i.verticalOffset),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(HD.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+e+" placement)"),null):{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function f1e(t){const{screenLength:e,minWorldLength:i,maxWorldLength:r}=t;return{screenLength:e,minWorldLength:i,maxWorldLength:r}}const im={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},m1e={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const t in m1e){const e=m1e[t],i=im[t];e.forEach(r=>{im[r]=i})}Object.freeze&&(Object.freeze(im),Object.keys(im).forEach(t=>{Object.freeze(im[t]),Object.freeze(im[t].normalizedOffset)}));const iP=[0,0],kIt=[0,0],cL=to();let g1e=class{constructor(e){this._stage=e,this._materials=new Map}get(e){return this._materials.get(e)}add(e,i){this._materials.set(e,i),this._stage.add(i)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}};const xW=512,TW=4096,UIt=.85,VIt=.95;let zIt=class{constructor(){this.offset={x:0,y:0},this.uvMinMax=pi()}},BIt=class{constructor(e,i){this.textId=e,this.textRenderer=i,this.placement=new zIt,this.rendered=!1}},qI=class extends ve{constructor(e){super(e),this.type=Zn.Texture,this.id=qu(),this.events=new An,this._glTexture=null,this._needsClear=!1,this._elementsToAddOrUpdate=new Map,this._elementsToRemove=new Map,this._elementsToRender=new Map,this._elements=new Map,this._stageObjects=new Map,this.updating=!1}initialize(){this._stage=this.view._stage,this._canvas=this._create2DCanvas(),this._ctx=this._canvas.getContext("2d"),this._stage.add(this);const e=this._computeAtlasResolution(this.view.width,this.view.height);this._createAtlasRegion(e),this._update2DCanvasSize(),this._resetAtlasCursor()}unload(){this._glTexture=rt(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get width(){return this._atlas.size.width}get height(){return this._atlas.size.height}get requiresFrameUpdates(){return!1}_createDescriptor(e){return{target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE,flipped:!0,samplingMode:nt.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:e.parameters.maxMaxAnisotropy}}get glTexture(){return this._glTexture}load(e){return v(this._glTexture)||(this._glTexture=new mt(e,this._createDescriptor(e),this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(St.TEXT_TEXTURE_ATLAS,this),this.setDirty()),this._glTexture}dispose(){this._elements=null,this._elementsToAddOrUpdate=null,this._elementsToRemove=null,this._elementsToRender=null,this._frameWorker=Nr(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=rt(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_create2DCanvas(){const e=document.createElement("canvas");return e.setAttribute("id","canvas2d"),e.setAttribute("style","display:none"),e.setAttribute("width",xW.toString()),e.setAttribute("height",xW.toString()),e}_update2DCanvasSize(){this._canvas.setAttribute("width",this._atlas.size.width.toString()),this._canvas.setAttribute("height",this._atlas.size.height.toString())}_createAtlasRegion(e=xW){this._atlas={size:{width:e,height:e},cursor:{x:0,y:0},lineHeight:0}}_computeAtlasResolution(e,i){let r=Math.max(e,i);return r+=256,r=vM(r),r=Math.min(r,TW),r}_resizeAtlas(e,i){i=i||e;const r=this._atlas;r.size.width=e,r.size.height=i,v(this._glTexture)&&this._glTexture.resize(e,i),this._update2DCanvasSize()}_resetAtlasCursor(){const e=this._atlas;e.cursor.x=rP,e.cursor.y=rP+y1e,e.lineHeight=0,this._needsClear=!0}_getAtlasUsage(){const e=this._atlas;return(e.cursor.x+e.cursor.y*e.size.width)/(e.size.width*e.size.height)}_getExpectedAtlasUsage(){const e=this._elementsToRemove.size,i=this._elementsToAddOrUpdate.size,r=this._elements.size;return this._getAtlasUsage()/r*(r+i-e)}_addAtlasElement(e,i,r,n){const s=this._atlas,{renderedWidth:o,renderedHeight:a}=e.textRenderer;e.placement.offset.x=s.cursor.x,e.placement.offset.y=s.cursor.y,cr(e.placement.uvMinMax,e.placement.offset.x/s.size.width,1-(e.placement.offset.y+a)/s.size.height,(e.placement.offset.x+o)/s.size.width,1-e.placement.offset.y/s.size.height),s.cursor.x+=r,s.lineHeight=Math.max(s.lineHeight,n),this._elements.set(i,e)}_removeAtlasElement(e){if(e&&this._elements.has(e.textId)){const i=e.placement.offset;this._ctx.clearRect(i.x,i.y,e.textRenderer.renderedWidth,e.textRenderer.renderedHeight),this._elements.delete(e.textId)}}_ensureStageObjects(e){const i=this._stageObjects.get(e);if(i)return i;const r=new Set;return this._stageObjects.set(e,r),r}_addStageObject(e,i){this._ensureStageObjects(e).add(i)}_removeStageObject(e,i){const r=this._stageObjects.get(e);r&&r.delete(i)&&(i.geometries[0].vertexAttributes.get(M.SIZE).data=[0,0],i.geometryVertexAttrsUpdated(i.geometries[0]))}_processAddition(e,i){const r=this._atlas,n=e.textId,s=e.textRenderer.renderedWidth,o=e.textRenderer.renderedHeight,a=s+rP,l=o+rP+y1e;if(r.cursor.x+a<r.size.width&&r.cursor.y+l<r.size.height)this._addAtlasElement(e,n,a,l),this._elementsToRender.set(n,e),this._elementsToAddOrUpdate.delete(n);else{if(!(r.cursor.y+l+r.lineHeight<r.size.height)){const c=this._getExpectedAtlasUsage(),h=c>UIt&&r.size.width<TW;return h&&this._resizeAtlas(2*r.size.width,2*r.size.height),!i||!h&&c>VIt&&r.size.width===TW?(this._processRemovals(),mR.OK):(this._repack(),mR.REPACK)}r.cursor.x=rP,r.cursor.y+=r.lineHeight,r.lineHeight=0,this._addAtlasElement(e,n,a,l),this._elementsToRender.set(n,e),this._elementsToAddOrUpdate.delete(n)}return mR.OK}_processRemovals(){this._elementsToRemove.forEach((e,i)=>{const r=this._stageObjects.get(i);r&&r.size!==0||this._removeAtlasElement(e),r&&r.size===0&&this._stageObjects.delete(i)}),this._elementsToRemove.clear()}_repack(){this._processRemovals(),this._elements.forEach((e,i)=>{e.rendered=!1,this._elementsToAddOrUpdate.set(i,e)}),this._elements.clear(),this._resetAtlasCursor(),this._elementsToRender.clear()}_processRenderingRequest(e){this._ctx.clearRect(e.placement.offset.x,e.placement.offset.y,e.textRenderer.renderedWidth,e.textRenderer.renderedHeight),e.textRenderer.render(this._ctx,e.placement.offset.x,e.placement.offset.y);const i=this._stageObjects.get(e.textId);i&&i.forEach(r=>{r.geometries[0].vertexAttributes.get(M.UV0).data=new Float32Array(e.placement.uvMinMax),r.geometries[0].vertexAttributes.get(M.SIZE).data=[e.textRenderer.displayWidth,e.textRenderer.displayHeight],r.geometryVertexAttrsUpdated(r.geometries[0])}),e.rendered=!0}get running(){return this.updating}runTask(e,i=!0){if(R(this._glTexture))return Ga.YIELD;let r=!1;if(pa(this._elementsToAddOrUpdate,(s,o)=>{const a=this._elements.get(o);if(a&&a.rendered){const l=this._stageObjects.get(o);return l&&l.forEach(c=>{const h=c.geometries[0].vertexAttributes,p=this._elements.get(o);h.get(M.UV0).data=p.placement.uvMinMax,h.get(M.SIZE).data=[p.textRenderer.displayWidth,p.textRenderer.displayHeight],c.geometryVertexAttrsUpdated(c.geometries[0])}),this._elementsToAddOrUpdate.delete(o),e.madeProgress(),!1}return this._processAddition(this._elementsToAddOrUpdate.get(o),i)===mR.REPACK&&(r=!0,!0)}),r)return this.runTask(ql,!1),void e.madeProgress();let n=!1;this._elementsToRender.size>0&&this._needsClear&&(this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._needsClear=!1),pa(this._elementsToRender,(s,o)=>(this._processRenderingRequest(s),this._elementsToRender.delete(o),n=!0,e.madeProgress(),e.done)),n&&this._glTexture.setData(this._canvas),this.updating=this._elementsToRender.size>0,!this.updating&&GCt.orderedRepackingEnabled&&(this.repackOrdered(),e.madeProgress())}addTextTexture(e,i){const r=e.key;this._elementsToAddOrUpdate.has(r)||this._elementsToAddOrUpdate.set(r,new BIt(r,e)),this._addStageObject(r,i),this._elementsToRemove.delete(r),this.setDirty()}removeTextTexture(e,i){const r=e.key;this._elementsToRemove.set(r,this._elements.get(r)),this._removeStageObject(r,i)}setDirty(){this._glTexture&&(this.updating=!0)}repackOrdered(){if(this._elements.size===0)return;const e=[];this._elements.forEach((r,n)=>e.push({element:r,key:n}));let i=!0;for(let r=0;r<e.length-1;r++)if(e[r].key.localeCompare(e[r+1].key)>0){i=!1;break}if(!i||this._elementsToRemove.size){e.sort((r,n)=>r.key.localeCompare(n.key)),this._elements.clear();for(const{element:r,key:n}of e)this._elements.set(n,r);this._repack(),this.setDirty()}}get test(){const{_elements:e,_stageObjects:i,_elementsToRemove:r,_atlas:n}=this,s=this;return{elements:e,stageObjects:i,elementsToRemove:r,atlas:n,resizeAtlas:(o,a)=>s._resizeAtlas(o,a),run:(o,a)=>s.runTask(o,a)}}};u([d({constructOnly:!0})],qI.prototype,"view",void 0),u([d({type:Boolean})],qI.prototype,"updating",void 0),qI=u([$("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],qI);const rP=2,y1e=2;var mR;(function(t){t[t.OK=0]="OK",t[t.REPACK=1]="REPACK"})(mR||(mR={}));let _1e=class{constructor(e,i){this.labelingContext=e,this.graphics3DGraphic=i,this.hasGraphics3DResources=!1,this.visible=!1,this.rendered=!1,this.textInitialized=!1,this.textRenderers=new Array,this.textLabelPlacements=new Array}},jIt=class{constructor(e,i,r,n,s){this.labelClass=e,this.graphics3DSymbol=i,this.graphics3DCalloutSymbolLayer=r,this.textRenderParameters=n,this.labelFunction=s,this.calloutSymbolLayerIndex=0}},GIt=class{constructor(e,i,r,n,s,o,a){this.layer=e,this.graphics3DCore=i,this.scaleVisibility=r,this.emptySymbolLabelSupported=n,this.elevationInfoOverride=s,this.disablePlacement=o,this.active=a,this.labelClassAbortController=new AbortController,this.labelClassContexts=new Array,this.graphics=new Map,this.labelsToInitialize=new Map,this.stageLayer=new B5e({pickable:!0,disableOctree:!0},e.uid)}},DT=class extends ve{constructor(e){super(e),this._dirty=!1,this._labels=new Map,this._labelsToAdd=new Map,this._labelsToRemove=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this._handles=new Xi,this._handles.add([ne(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this.setDirty()),ne(()=>{var e;return(e=this.view.state)==null?void 0:e.rasterPixelRatio},()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(St.LABELER,this)]),this._textTextureAtlas=new qI({view:this.view}),this._hudMaterialCollection=new g1e(this.view._stage),this._calloutMaterialCollection=new g1e(this.view._stage)}dispose(){this._handles=Ve(this._handles),this._textTextureAtlas=rt(this._textTextureAtlas),this._hudMaterialCollection=rt(this._hudMaterialCollection),this._calloutMaterialCollection=rt(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear(),this._labelsToAdd.clear(),this._labelsToRemove.clear()}_activateLabelingContext(e){e.graphics.forEach((i,r)=>{const n=new _1e(e,i);this._labels.set(r,n),e.labelsToInitialize.set(r,n),i.setVisibilityFlag(Fu.USER_SETTING,!0,ha.LABEL)}),e.active=!0}_deactivateLabelingContext(e){e.graphics.forEach((i,r)=>{i.setVisibilityFlag(Fu.USER_SETTING,!1,ha.LABEL),this.setLabelGraphicVisibility(i,!1),this._labels.delete(r)}),e.active=!1}_addLabelTextureToAtlas(e){for(const i of e.graphics3DGraphic.labelLayers){if(!i._labelClass)continue;const r=e.textRenderers[i._labelIndex];v(r)&&this._textTextureAtlas.addTextTexture(r,i.stageObject)}e.rendered=!0}_removeLabelTextureFromAtlas(e){for(const i of e.graphics3DGraphic.labelLayers){if(!i._labelClass)continue;const r=e.textRenderers[i._labelIndex];v(r)&&this._textTextureAtlas.removeTextTexture(r,i.stageObject)}e.rendered=!1}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(e){return this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e),Ga.YIELD}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const i of this._labelingContexts)if(i.active){if(!v1e(i)){if(HIt(i)){this._deactivateLabelingContext(i);continue}if(this._createLabelClassContext(i),SW(i)){this._dirty=!0;continue}if(!v1e(i))continue}pa(i.labelsToInitialize,(r,n)=>(this._ensureGraphics3DResources(r)&&(this._labels.set(n,r),this.deconflictor.setDirty(),e.madeProgress()),(r.visible&&r.textInitialized||!r.visible&&r.hasGraphics3DResources)&&(i.labelsToInitialize.delete(n),e.madeProgress()),e.done))&&(this._dirty=!0)}this._labelsToRemove.forEach(i=>this._removeLabelTextureFromAtlas(i)),this._labelsToAdd.forEach(i=>this._addLabelTextureToAtlas(i)),this._labelsToRemove.clear(),this._labelsToAdd.clear(),this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){var o,a,l;const i=(o=e.labelClassAbortController)==null?void 0:o.signal;await((l=(a=e.layer).when)==null?void 0:l.call(a)),ui(i),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive();const r=e.graphics3DCore,n=r.layer,s=n.labelingInfo&&n.labelingInfo.filter(c=>!!c.symbol);!s||s.length===0||(await vB(s,async(c,h)=>{const p=c.symbol,f=Sce(r.getOrCreateGraphics3DSymbol(p));if(R(f))return void re.getLogger(this.declaredClass).error("Failed to create Graphics3DSymbol for label");await f.load(),ui(i);let m=null;nse(p)&&p.hasVisibleCallout()&&(m=bCt(p,r.symbolCreationContext),await m.load(),ui(i));const g=await _m(u5e(c,e.layer.fieldsIndex,this.view.spatialReference));if(ui(i),g.ok===!0){const _=await this._createTextRenderParameters(f.symbol);ui(i),e.labelClassContexts[h]=new jIt(c,f,m,_,g.value)}else re.getLogger(this.declaredClass).error(`Label expression failed to evaluate: ${g.error}`)}),ui(i))}async _createLabelClassContext(e){return R(e.labelClassPromise)&&(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(i=>{if(gs(i))throw i;e.labelClassContexts.length=0}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const i=e.symbolLayers.getItemAt(0);return i&&i.type==="text"?W6e.fromSymbol(i,this.view.state.rasterPixelRatio):null}_destroyLabelClassContext(e){for(const r of e.labelClassContexts)--r.graphics3DSymbol.referenced;const i=e.labelClassAbortController;e.labelClassAbortController=new AbortController,Mp(i),e.labelClassContexts.length=0,e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,i,r,n,s){const o=new d5e(r.verticalOffset,Pve(r.anchor),dMt(r.anchor),e.text,r.translation,r.elevationOffset,r.centerOffset,r.screenOffset,r.centerOffsetUnits,e.displayWidth,e.displayHeight);return Bv.graphic=i,Bv.renderingInfo=null,Bv.layer=n,s.createLabel(Bv,o,this._hudMaterialCollection,this._textTextureAtlas)}_createLineCalloutGraphic(e,i,r,n,s){return Bv.graphic=e,Bv.layer=s,Bv.renderingInfo=new _Ct(null,i,n.translation,n.centerOffset,n.screenOffset,n.centerOffsetUnits,n.elevationOffset,this._calloutMaterialCollection),r.createGraphics3DGraphic(Bv)}_ensureGraphics3DResources(e){if(e.hasGraphics3DResources)return!1;const i=e.graphics3DGraphic;if(i.destroyed)return!1;this._ensureTextTextureResources(e);const r=e.labelingContext,n=r.labelClassContexts;if(!n||n.length===0||!r.emptySymbolLabelSupported&&i.layers.length===0)return!1;let s=!1;const o=i.graphic,a=r.layer,l=ak(r.layer),c=this.view._stage;for(let h=0;h<n.length;h++){const p=e.textRenderers[h],f=e.textLabelPlacements[h];if(R(p)||R(f))continue;const m=n[h],g=m.graphics3DSymbol,_=g.symbol&&g.symbol.type==="label-3d"?g.symbol:null,b=g.symbolLayers[0];if(!b)continue;b.setElevationInfoOverride(r.elevationInfoOverride);const w=this._createTextSymbolGraphic(p,o,f,a,b);if(R(w))return!1;w._labelClass=m.labelClass,w._labelIndex=h,i.addLabelGraphic(w,c,r.stageLayer),i.setVisibilityFlag(Fu.USER_SETTING,l,ha.LABEL),i.clearVisibilityFlag(Fu.SCALE_RANGE,ha.LABEL),i.setVisibilityFlag(Fu.DECONFLICTION,!1,ha.LABEL),s=!0;const x=m.graphics3DCalloutSymbolLayer;if(x&&f.hasLabelVerticalOffset){x.setElevationInfoOverride(r.elevationInfoOverride);const T=this._createLineCalloutGraphic(o,_,x,f,a);v(T)&&(m.calloutSymbolLayerIndex=i.labelLayers.length,i.addLabelGraphic(T,c,r.stageLayer))}break}return r.scaleVisibility&&s&&r.scaleVisibility.updateGraphicLabelScaleVisibility(i),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const i=e.labelingContext.labelClassContexts;for(const r of e.graphics3DGraphic.labelLayers){if(r._labelClass==null)continue;const n=i[r._labelIndex].graphics3DSymbol.symbolLayers[0];n!=null&&n.onRemoveGraphic(r)}e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){var s;if(e.textInitialized)return;const i=e.labelingContext,r=i.labelClassContexts;if(!r||r.length===0)return;const n=e.graphics3DGraphic.graphic;for(let o=0;o<r.length;o++){const a=r[o];if(e.textRenderers[o]=null,e.textLabelPlacements[o]=null,!a.textRenderParameters)continue;const l=a.labelFunction;let c;if(l.type==="arcade")try{const x=l.needsHydrationToEvaluate()?wEt(n,i.layer):n;c=l.evaluate(x)}catch{c=null}else c=l.evaluate(n);if(R(c)||c===""||/^\s+$/.test(c))continue;const h=a.graphics3DSymbol,p=((s=h.symbol)==null?void 0:s.type)==="label-3d"?h.symbol:null;if(!h.symbolLayers[0])continue;const f=e.graphics3DGraphic,m=a.labelClass,g=i.disablePlacement,_=RIt({graphics3DGraphic:f,labelSymbol:p,labelClass:m,disablePlacement:g});if(R(_))continue;const b=Pve(_.anchor),w=qke(b);e.textRenderers[o]=new Gke(c,w,a.textRenderParameters),e.textLabelPlacements[o]=_}e.textInitialized=!0}_destroyTextTextureResources(e){e.textInitialized=!1,e.textRenderers.length=0,e.textLabelPlacements.length=0}_addGraphic(e,i){const r=i.graphic.uid;if(e.graphics.set(r,i),e.active){const n=new _1e(e,i);this._labels.set(r,n),e.labelsToInitialize.set(r,n)}this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(e,i){const r=i.graphic.uid,n=this._labels.get(r);e.graphics.delete(r),n&&(this._destroyGraphic(n,r),e.labelsToInitialize.delete(r),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,i){this._labels.has(i)&&(this._labels.delete(i),this._labelsToAdd.delete(i),this._labelsToRemove.delete(i)),e.textInitialized&&(this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e)),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,i){if(!i)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const r of i){const n=e.graphics.get(r);n&&(this._removeGraphic(e,n),this._addGraphic(e,n))}}_globalPropertyChanged(e,i){for(const r of i.labelClassContexts){const n=new Map;i.graphics.forEach(o=>n.set(o.graphic.uid,o));const s=o=>o.labelLayers[0];if(r.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,n,s),r.graphics3DCalloutSymbolLayer){const o=a=>a.labelLayers[r.calloutSymbolLayerIndex];r.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,n,o)}}}_visibilityInfoChange(e){const i=ak(e.layer);i&&!e.active&&this._activateLabelingContext(e),!i&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.graphics.forEach((i,r)=>{const n=this._labels.get(r);n&&(this._destroyGraphic(n,r),n.visible=!1,n.rendered=!1,e.labelsToInitialize.set(r,n))}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const i of this._labelingContexts)if(i.graphics3DCore===e)return i;return null}addGraphicsOwner(e,i,r){const n=r&&r.emptySymbolLabelSupported||!1,s=r&&r.elevationInfoOverride||null,o=r&&r.disablePlacement||null;if(this._findLabelingContext(e))return;const a=e.layer,l=new GIt(a,e,i,n,s,o,ak(a));return this.view._stage.add(l.stageLayer),this._labelingContexts.push(l),this.setDirty(),{addGraphic:c=>this._addGraphic(l,c),removeGraphic:c=>this._removeGraphic(l,c),featureReductionChange:()=>{},layerLabelsEnabled:()=>ak(l.layer),labelingInfoChange:c=>this._labelingInfoChange(l,c),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",l),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",l),visibilityInfoChange:()=>this._visibilityInfoChange(l),reset:()=>this._resetLabels(l),clear:()=>{}}}removeGraphicsOwner(e){const i=this._findLabelingContext(e);if(!i)return;const r=this._labelingContexts.indexOf(i);this._labelingContexts.splice(r,1),i.graphics.forEach(n=>this._removeGraphic(i,n)),this.view._stage.remove(i.stageLayer),this.setDirty()}setLabelGraphicVisibility(e,i){const r=e.graphic.uid,n=this._labels.get(r);n&&n.visible!==i&&(i&&!n.rendered?(this._labelsToAdd.set(r,n),this._labelsToRemove.delete(r),n.textInitialized||n.labelingContext.labelsToInitialize.set(r,n)):!i&&n.rendered&&(this._labelsToRemove.set(r,n),this._labelsToAdd.delete(r)),n.visible=i,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){var e;return this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.updating||this._labelingContexts.some(i=>SW(i))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((i,r)=>i+(SW(r)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function SW(t){return!!t.labelClassPromise&&!!t.labelClassAbortController}function v1e(t){return t.labelClassContexts&&t.labelClassContexts.length}function HIt(t){return t.labelClassContexts===null}function ak(t){var e;return t.labelsVisible===!0&&!!((e=t.labelingInfo)!=null&&e.some(i=>!!i.symbol))}u([d({constructOnly:!0})],DT.prototype,"view",void 0),u([d({constructOnly:!0})],DT.prototype,"deconflictor",void 0),u([d()],DT.prototype,"_textTextureAtlas",void 0),u([d({type:Boolean,readOnly:!0})],DT.prototype,"updating",null),DT=u([$("esri.views.3d.layers.graphics.Labeler")],DT);const Bv=new vCt(null,null,null);let WI=class xA{constructor(e,i,r,n=null){this.lij=[0,0,0],this.extent=Kt(),this.resolution=0,this.loadPriority=0,this.measures={visibility:rl.VISIBLE_ON_SURFACE,screenRect:Kt(),distance:0,shouldSplit:!1},this.used=!1,n&&this.acquire(e,i,r,n)}acquire(e,i,r,n){this.tilingScheme=n,this.id=xA.id(e,i,r),this.lij[0]=e,this.lij[1]=i,this.lij[2]=r,n.getExtent(e,i,r,this.extent),this.resolution=n.resolutionAtLevel(e)}release(){this.tilingScheme=null}getChildren(e){const i=this.lij[0]+1,r=2*this.lij[1],n=2*this.lij[2];return e?(e[0].acquire(i,r,n,this.tilingScheme),e[1].acquire(i,r+1,n,this.tilingScheme),e[2].acquire(i,r,n+1,this.tilingScheme),e[3].acquire(i,r+1,n+1,this.tilingScheme),e):[new xA(i,r,n,this.tilingScheme),new xA(i,r+1,n,this.tilingScheme),new xA(i,r,n+1,this.tilingScheme),new xA(i,r+1,n+1,this.tilingScheme)]}copyMeasurementsFrom(e){this.measures.visibility=e.measures.visibility,this.measures.shouldSplit=e.measures.shouldSplit,this.measures.distance=e.measures.distance,A_(e.measures.screenRect,this.measures.screenRect)}static id(e,i,r){return`${e}/${i}/${r}`}};var rl;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",t[t.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(rl||(rl={}));const Y6e=.5*Math.PI,qIt=Y6e/Math.PI*180;let WIt=class{constructor(e){this._renderCoordsHelper=e.renderCoordsHelper,this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:P(),direction:P()};for(let i=0;i<4;i++)this._extent[i]={origin:P(),direction:P(),cap:{next:null,direction:P()}},this._planes[i]=Ji();this._planes[Or.NEAR]=Ji(),this._planes[Or.FAR]=Ji(),this._planesWithoutFar=this._planes.slice(0,5)}update(e,i,r,n=!0){const s=this._extent;this._toRenderBoundingExtent(e,i,r),me(this._center.origin,s[0].origin,s[2].origin),le(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),n||le(this._center.direction,this._center.direction,-1);for(let o=0;o<4;o++){const a=s[o];this._renderCoordsHelper.worldUpAtPosition(a.origin,a.direction);const l=s[o===3?0:o+1];a.cap.next=l.origin,V_(a.cap.direction,a.origin,l.origin),yD(a.direction,a.cap.direction,a.origin,this._planes[o]),n||le(a.direction,a.direction,-1)}yD(s[0].cap.direction,s[1].cap.direction,s[0].origin,this._planes[Or.NEAR]),n?HQ(this._planes[Or.NEAR],this._planes[Or.FAR]):(GB(this._planes[Or.FAR],this._planes[Or.NEAR]),HQ(this._planes[Or.NEAR],this._planes[Or.NEAR])),this._maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this._maxSpanSpatialReference=i,this._minGlobalAltitude=.9*sr(this._maxSpanSpatialReference).radius}isVisibleInFrustum(e,i,r=!1){if(e==null)return!1;if(this._renderCoordsHelper.viewingMode===qe.Global){const s=this._maxSpanSpatialReference.isGeographic?qIt:Y6e*i;if(this._maxSpan>s)return!0;if(e.altitude!=null&&e.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(e)}if(this._maxSpan===0){const s=this._extent[0];return!(r||!e.intersectsRay(cd(s.origin,s.direction)))}for(let s=0;s<this._extent.length;s++){const o=this._extent[s];if(!r&&e.intersectsRay(cd(o.origin,o.direction))||e.intersectsLineSegment(zS(o.origin,o.cap.next,YIt),o.cap.direction))return!0}const n=r?this._planes:this._planesWithoutFar;for(let s=0;s<e.lines.length;s++){const o=e.lines[s];if($bt(n,o.origin,o.endpoint,o.direction))return!0}return!1}_toRenderBoundingExtentGlobal(e,i,r){Fne(e,rf),rf[2]=r,ym(i,rf,EW,this._renderCoordsHelper.spatialReference),wa(b1e,EW),Br(au);for(const{x0:s,x1:o,y0:a,y1:l}of XIt)for(let c=0;c<5;c++){const h=c/4;rf[0]=Bt(e[s],e[o],h),rf[1]=Bt(e[a],e[l],h),rf[2]=r,jo(rf,i,rf,this._renderCoordsHelper.spatialReference),Ke(rf,rf,b1e),py(au,rf)}he(this._extent[0].origin,au[0],au[1],au[2]),he(this._extent[1].origin,au[3],au[1],au[2]),he(this._extent[2].origin,au[3],au[4],au[2]),he(this._extent[3].origin,au[0],au[4],au[2]);for(let s=0;s<4;++s)Ke(this._extent[s].origin,this._extent[s].origin,EW)}_toRenderBoundingExtentLocal(e,i,r){lB(e,i,Yy,this._renderCoordsHelper.spatialReference),he(this._extent[0].origin,Yy[0],Yy[1],r),he(this._extent[1].origin,Yy[2],Yy[1],r),he(this._extent[2].origin,Yy[2],Yy[3],r),he(this._extent[3].origin,Yy[0],Yy[3],r)}_toRenderBoundingExtent(e,i,r){switch(this._renderCoordsHelper.viewingMode){case qe.Global:this._toRenderBoundingExtentGlobal(e,i,r);break;case qe.Local:this._toRenderBoundingExtentLocal(e,i,r);break;default:this._renderCoordsHelper.viewingMode}}_isVisibleInFrustumGlobal(e){if(Pr(e.planes[Or.NEAR],this._center.origin)<0&&be(this._center.direction,e.direction)<0)return!0;for(let i=0;i<4;i++){const r=this._extent[i];if(Pr(e.planes[Or.NEAR],r.origin)<0&&be(r.direction,e.direction)<0)return!0}return!1}};const XIt=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],rf=P(),EW=$e(),b1e=$e(),au=to(),Yy=Kt(),YIt=Cm();let ZIt=class{constructor(e){this._renderCoordsHelper=e,this._surfaceElevation=0,this._cache=new Map,this._frustum=new ib(e),this._extendedFrustum=new ib(e),this._intersector=new WIt({renderCoordsHelper:e}),this._renderCoordsHelper=e}begin(e,i){this._surfaceElevation=i,this._aboveGround=this._renderCoordsHelper.getAltitude(e.eye)>i,this._frustum.update(e),this._shortenFrustumFarPlane(this._frustum),this._updateExtendedFrustum(e)}end(){this._cache.clear()}calculate(e){if(this._allTilesInvisible)return rl.INVISIBLE;const i=this._renderCoordsHelper.viewingMode===qe.Global&&e.lij[0]>=JIt&&e.lij[0]<KIt,r=this._getOrCalculateSingleTileVisibility(e,!i);return r!==rl.INVISIBLE&&i?this._calculateAggregatedChildrenVisibility(e):r}_shortenFrustumFarPlane(e){const i=ib.nearFarLineIndices,r=e.mutablePoints;for(const n of i){const[s,o]=n,a=r[s],l=r[o];ge(gh,l,a),le(gh,gh,e$t),me(r[o],a,gh)}e.updatePoints(r)}_calculateAggregatedChildrenVisibility(e){let i=rl.INVISIBLE;const r=this._cache.get(e.id);if(r!=null)return r;const n=S1e.acquire();e.getChildren(n);for(const s of n){const o=this.calculate(s);if(o!==rl.INVISIBLE&&(i=o,o===rl.VISIBLE_ON_SURFACE))break}return S1e.release(n),this._cache.set(e.id,i),i}_getOrCalculateSingleTileVisibility(e,i){const r=this._cache.get(e.id);if(r!=null)return r;const n=this._calculateSingleTileVisibility(e);return i&&this._cache.set(e.id,n),n}_calculateSingleTileVisibility(e){return!this._aboveGround&&this._renderCoordsHelper.viewingMode===qe.Global&&e.lij[0]<QIt?this._calculateSingleTileVisibilitySided(e,!1)===rl.INVISIBLE?this._calculateSingleTileVisibilitySided(e,!0):void 0:this._calculateSingleTileVisibilitySided(e,this._aboveGround)}_calculateSingleTileVisibilitySided(e,i){this._intersector.update(e.extent,e.tilingScheme.spatialReference,this._surfaceElevation,i);const r=sr(e.tilingScheme.spatialReference).radius;return this._intersector.isVisibleInFrustum(this._extendedFrustum,r)?this._intersector.isVisibleInFrustum(this._frustum,r,!0)?rl.VISIBLE_ON_SURFACE:rl.VISIBLE_WHEN_EXTENDED:rl.INVISIBLE}_updateExtendedFrustum(e){this._extendedFrustum.update(e),this._shortenFrustumFarPlane(this._extendedFrustum);const i=this._renderCoordsHelper.worldUpAtPosition(e.eye,gh);this._aboveGround||pl(i,i);const r=eo(-be(i,e.viewForward));if(this._allTilesInvisible=r>(Math.PI+e.fovY)/2,this._allTilesInvisible||(this._hasExtendedFrustum=r>e.fovY/2,!this._hasExtendedFrustum))return;const n=this._extendedFrustumParameters(),s=this._extendedFrustum.mutablePoints;for(let o=0;o<4;o++){const a=n.pointIndices[o],l=s[a],c=this._renderCoordsHelper.getAltitude(l);if(n.needsAltitudeAdjustment(c)){switch(this._renderCoordsHelper.worldUpAtPosition(l,gh),a){case ct.FAR_BOTTOM_LEFT:case ct.FAR_TOP_LEFT:case ct.NEAR_BOTTOM_LEFT:case ct.NEAR_TOP_LEFT:qQ(this._extendedFrustum.planes[Or.LEFT],gh,gh);break;case ct.FAR_BOTTOM_RIGHT:case ct.FAR_TOP_RIGHT:case ct.NEAR_BOTTOM_RIGHT:case ct.NEAR_TOP_RIGHT:qQ(this._extendedFrustum.planes[Or.RIGHT],gh,gh)}le(gh,gh,n.direction),this._renderCoordsHelper.intersectInfiniteManifold(cd(l,gh),n.zWithMargin,l)}}if(this._extendedFrustum.updatePoints(s),sl(s[ct.NEAR_BOTTOM_LEFT],s[ct.NEAR_BOTTOM_RIGHT],s[ct.NEAR_TOP_RIGHT],x1e),sl(s[ct.NEAR_BOTTOM_RIGHT],s[ct.NEAR_TOP_RIGHT],s[ct.NEAR_TOP_LEFT],T1e),be(x1e,T1e)<0){const o=this._extendedFrustum.mutablePoints;this._aboveGround?[o[ct.NEAR_BOTTOM_LEFT],o[ct.NEAR_BOTTOM_RIGHT]]=[o[ct.NEAR_BOTTOM_RIGHT],o[ct.NEAR_BOTTOM_LEFT]]:[o[ct.NEAR_TOP_LEFT],o[ct.NEAR_TOP_RIGHT]]=[o[ct.NEAR_TOP_RIGHT],o[ct.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(o)}}_extendedFrustumParameters(){return this._aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const e=this._surfaceElevation-w1e;return{zWithMargin:e,pointIndices:ib.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:i=>i>e}}_extendedFrustumParametersBelowSurface(){const e=this._surfaceElevation+w1e;return{zWithMargin:e,pointIndices:ib.planePointIndices.top,direction:1,needsAltitudeAdjustment:i=>i<e}}};const JIt=2,KIt=6,QIt=12,e$t=.95,w1e=1,gh=P(),x1e=Ji(),T1e=Ji(),S1e=new zo(Array,t=>{t.length!==4&&(t[0]=new WI,t[1]=new WI,t[2]=new WI,t[3]=new WI)},t=>{t[0].release(),t[1].release(),t[2].release(),t[3].release()});let t$t=class{constructor(e){this._camera=new Pt,this._focusOnMap=[0,0],this._screenRect=Kt(),this._tileSize=e.tileSize,this._renderCoordsHelper=e.renderCoordsHelper,this._tilingScheme=e.tilingScheme,this._visibility=new ZIt(e.renderCoordsHelper)}begin(e,i,r){this._camera.copyFrom(e),this._surfaceElevation=r,this._focusOnMap[0]=i.x,this._focusOnMap[1]=i.y,Dne(0,0,e.fullWidth,e.fullHeight,this._screenRect),this._visibility.begin(this._camera,r)}end(){this._visibility.end()}updateTile(e){e.measures.visibility=this._visibility.calculate(e),e.measures.distance=gWe(e.extent,this._focusOnMap),e.measures.visibility!==rl.INVISIBLE&&this._updateScreenMeasure(e)}_updateScreenMeasure(e){const i=i$t,r=1<<i,n=e.measures.screenRect;od(n);let s=0;const o=e.lij[0]+i,a=e.lij[1]<<i,l=e.lij[2]<<i,c=this._tileSizeWithBias(e),h=c*c;for(let p=0;p<r;p++)for(let f=0;f<r;f++)if(s+=this._computeScreenArea(e,o,a+p,l+f,n),s>h)return void(e.measures.shouldSplit=!0);e.measures.shouldSplit=!1}_tileSizeWithBias(e){return e.measures.visibility===rl.VISIBLE_WHEN_EXTENDED?this._tileSize*r$t:this._tileSize}_computeScreenArea(e,i,r,n,s){const o=e.measures.visibility===rl.VISIBLE_WHEN_EXTENDED;this._projectToScreen(i,r,n,o,jv),od(CW);for(let a=0;a<4;a++)Nne(CW,jv[a]);return kb(s,CW,s),Gye(jv[0],jv[1],jv[2])+Gye(jv[0],jv[2],jv[3])}_projectToScreen(e,i,r,n,s){this._tilingScheme.ensureMaxLod(e),this._tilingScheme.getExtent(e,i,r,nP),this._toRenderCoords(nP,0,3,Gv[0]),this._toRenderCoords(nP,2,3,Gv[1]),this._toRenderCoords(nP,2,1,Gv[2]),this._toRenderCoords(nP,0,1,Gv[3]),n&&(this._projectToPlane(Gv,this._camera.frustum[Or.NEAR]),this._projectToPlane(Gv,this._camera.frustum[Or.TOP]),this._projectToPlane(Gv,this._camera.frustum[Or.BOTTOM]));for(let o=0;o<4;o++)this._camera.projectToRenderScreen(Gv[o],E1e),this._camera.renderToScreen(E1e,s[o])}_projectToPlane(e,i){for(let n=0;n<4;n++)oP[n]=Pr(i,e[n]);const r=Math.max(oP[0],oP[1],oP[2],oP[3]);if(r>0){const n=le(sP,i,-r);for(let s=0;s<4;s++)me(e[s],e[s],n)}}_toRenderCoords(e,i,r,n){return sP[0]=e[i],sP[1]=e[r],sP[2]=this._surfaceElevation,this._renderCoordsHelper.toRenderCoords(sP,this._tilingScheme.spatialReference,n),n}};const CW=Kt(),i$t=2,r$t=5,jv=[Sn(),Sn(),Sn(),Sn()],nP=Kt(),sP=P(),Gv=[P(),P(),P(),P()],oP=[0,0,0,0],E1e=ka();function nQt(t,e,i){if(R(t)||R(i))return!1;let r=!0;return Bs[0]=t.xmin!=null?t.xmin:0,Bs[1]=t.ymin!=null?t.ymin:0,Bs[2]=t.zmin!=null?t.zmin:0,r=r&&Nn(Bs,t.spatialReference,0,e,i,0,1),Bs[0]=t.xmax!=null?t.xmax:0,Bs[1]=t.ymax!=null?t.ymax:0,Bs[2]=t.zmax!=null?t.zmax:0,r=r&&Nn(Bs,t.spatialReference,0,e,i,3,1),t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.zmin==null&&(e[2]=-1/0),t.xmax==null&&(e[3]=1/0),t.ymax==null&&(e[4]=1/0),t.zmax==null&&(e[5]=1/0),r}function Z6e(t,e,i){if(R(t)||R(i))return!1;let r=!0;return Bs[0]=t.xmin!=null?t.xmin:0,Bs[1]=t.ymin!=null?t.ymin:0,Bs[2]=t.zmin!=null?t.zmin:0,r=r&&Nn(Bs,t.spatialReference,0,Bs,i,0,1),e[0]=Bs[0],e[1]=Bs[1],Bs[0]=t.xmax!=null?t.xmax:0,Bs[1]=t.ymax!=null?t.ymax:0,Bs[2]=t.zmax!=null?t.zmax:0,r=r&&Nn(Bs,t.spatialReference,0,Bs,i,0,1),e[2]=Bs[0],e[3]=Bs[1],t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.xmax==null&&(e[2]=1/0),t.ymax==null&&(e[3]=1/0),r}const Bs=P();let la=class extends ve{get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(v(e)&&!e.spatialReference.equals(this.viewState.spatialReference))return void re.getLogger(this.declaredClass).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const i=this._get("filterExtent");if(i===e||v(i)&&e&&i.equals(e))return;const r=v(e)?e.clone():null;this._set("filterExtent",r),this._setDirty()}get _filterExtentRect(){if(R(this.filterExtent))return null;const e=Kt();return Z6e(this.filterExtent,e,this.tilingScheme.spatialReference),e}get _rootTileIds(){const{tilingScheme:e}=this;return this._filterExtentRect&&e?e.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}constructor(e){super(e),this.tiles=new tt,this.tileSize=512,this._idToTile=new Map,this._handles=new Xi,this._clients=new Set,this._dirty=!1,this._pendingTiles=null,this._newTiles=new Wt}initialize(){this._handles.add([ne(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),Ki),ne(()=>{var e,i,r;return[this.tileSize,(e=this.cameraOnSurface)==null?void 0:e.location,this.tilingScheme,(i=this.viewState)==null?void 0:i.contentCamera,(r=this.focus)==null?void 0:r.location]},()=>this._setDirty(),Jr)]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(St.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=Nr(this._frameWorker),this._handles=Ve(this._handles)}addClient(){const e=s$t();return this._clients.add(e),this._clients.size===1&&this._setDirty(),{remove:()=>this._removeClient(e)}}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(ql))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),v(this._frameWorker)&&(this._frameWorker.priority=St.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),!this._pendingTiles&&v(this._frameWorker)&&(this._frameWorker.priority=St.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new t$t({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){const{tilingScheme:e}=this;return this._rootTileIds.map(i=>new WI(i[0],i[1],i[2],e))}_purgeHorizonTiles(e){e.sort((i,r)=>{const n=i.measures.screenRect,s=r.measures.screenRect;return n[1]+n[3]-(s[1]+s[3])}),od(lk);for(let i=0;i<e.length;i++)if(kb(lk,e.data[i].measures.screenRect,lk),gm(lk)>o$t)return e.data.slice(i,e.length);return[]}_subdivideTilesForView(e){if(!this._pendingTiles)return;const{tilingScheme:i}=this;for(;this._pendingTiles.length>0&&!e.done;){const r=this._pendingTiles.pop();e.madeProgress(),this._filterExtentRect&&!W9(this._filterExtentRect,r.extent)||(this._tileMeasurements.updateTile(r),r.measures.visibility!==rl.INVISIBLE&&(r.measures.shouldSplit?(i.ensureMaxLod(r.lij[0]+1),this._pendingTiles.push(...r.getChildren())):this._newTiles.push(r)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}_updateTiles(e){for(const n of this.tiles.items)n.used=!1;const i=e.filter(n=>{const s=this._idToTile.get(n.id);return s?(s.copyMeasurementsFrom(n),s.used=!0):this._idToTile.set(n.id,n),!s}),r=this.tiles.items.filter(n=>!n.used&&(this._idToTile.delete(n.id),!0));this.tiles.removeMany(r),this.tiles.addMany(i),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,i)=>e.measures.visibility!==i.measures.visibility?e.measures.visibility===rl.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-i.measures.distance),this.tiles.forEach((e,i)=>e.loadPriority=i)}};u([d({constructOnly:!0})],la.prototype,"scheduler",void 0),u([d({constructOnly:!0})],la.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],la.prototype,"tilingSchemeOwner",void 0),u([d({constructOnly:!0})],la.prototype,"cameraOnSurface",void 0),u([d({constructOnly:!0})],la.prototype,"focus",void 0),u([d({constructOnly:!0})],la.prototype,"viewState",void 0),u([d({constructOnly:!0})],la.prototype,"terrain",void 0),u([d()],la.prototype,"tiles",void 0),u([d()],la.prototype,"tileSize",void 0),u([d({readOnly:!0})],la.prototype,"tilingScheme",null),u([d()],la.prototype,"filterExtent",null),u([d({readOnly:!0})],la.prototype,"_filterExtentRect",null),u([d({readOnly:!0})],la.prototype,"_rootTileIds",null),u([d({value:!1})],la.prototype,"suspended",null),u([d({readOnly:!0})],la.prototype,"updating",null),la=u([$("esri.views.3d.layers.support.FeatureTileTree3D")],la);let n$t=0;function s$t(){return n$t++}const lk=Kt(),o$t=10;let Us=class extends ve{constructor(){super(...arguments),this._propertiesPool=new O_({camera:Pt},this),this._lastSeenCameraProjectionValues=new Pt,this.mode=Pi.ANIMATING,this.rasterPixelRatio=1,this.contentPixelRatio=1,this.events=new An,this.viewingMode=qe.Global,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}init(e,i){this._set("viewingMode",e),this._set("spatialReference",i),this._set("constraints",new x0({mode:this.viewingMode}))}exit(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new O_({camera:Pt},this)}createInitialCamera(){if(this.viewingMode===qe.Global){const e=sr(this.spatialReference).radius;this.camera=new Pt({eye:Ue(4*e,0,0),center:Ue(e,0,0),up:Ue(0,0,1)})}else this.camera=new Pt({eye:Ue(0,0,100),center:Ue(0,0,0),up:Ue(0,1,0)})}get animation(){return this.cameraController instanceof RD&&v(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null}get camera(){return this._get("camera")}set camera(e){e!==Cd&&Cd.copyFrom(e),Cd.computeUp(this.viewingMode),this.events.emit("before-camera-change",Cd);const i=this._get("camera");if(this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,Cd)&&(this._lastSeenCameraProjectionValues.copyFrom(Cd),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues)),(!i||!i.equals(Cd))&&(this._set("camera",this._propertiesPool.get("camera").copyFrom(Cd)),this._cameraChanged=!i||!i.almostEquals(Cd),this._cameraChanged)){const r=S2e(()=>{this._cameraChanged=!1,r.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get contentCamera(){return Nt(this._contentCamera,this.camera)}set contentCamera(e){this._contentCamera=v(e)?e.clone():null}get fixedContentCamera(){return v(this._contentCamera)}get isGlobal(){return this.viewingMode===qe.Global}get isLocal(){return this.viewingMode===qe.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){this.stopActiveCameraController()?(e&&(this.removeHandles(C1e),this.addHandles(yo(()=>e.state===Tn.Finished||e.state===Tn.Stopped,()=>{this._set("cameraController",null),this.updateCamera(i=>e.onControllerEnd(i))},{sync:!0,once:!0}),C1e),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=Tn.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==Tn.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this._updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this._updateQueue.length===0||this._processingUpdates)return;this._processingUpdates=!0;const e=this._updateQueue.shift();Cd.copyFrom(this._get("camera")),e(Cd),this.camera=Cd,this._processingUpdates=!1,this._processUpdateQueue()}_cameraProjectionChanged(e,i){return e.fov!==i.fov||e.fullViewport[0]!==i.fullViewport[0]||e.fullViewport[1]!==i.fullViewport[1]||e.fullViewport[2]!==i.fullViewport[2]||e.fullViewport[3]!==i.fullViewport[3]||e.padding[yi.TOP]!==i.padding[yi.TOP]||e.padding[yi.RIGHT]!==i.padding[yi.RIGHT]||e.padding[yi.BOTTOM]!==i.padding[yi.BOTTOM]||e.padding[yi.LEFT]!==i.padding[yi.LEFT]}};u([d()],Us.prototype,"mode",void 0),u([d({readOnly:!0,type:P_})],Us.prototype,"animation",null),u([d({type:Pt})],Us.prototype,"camera",null),u([d({readOnly:!0})],Us.prototype,"pixelRatio",null),u([d()],Us.prototype,"rasterPixelRatio",void 0),u([d()],Us.prototype,"contentPixelRatio",void 0),u([d({})],Us.prototype,"_contentCamera",void 0),u([d({type:Pt})],Us.prototype,"contentCamera",null),u([d({readOnly:!0})],Us.prototype,"fixedContentCamera",null),u([d({readOnly:!0})],Us.prototype,"constraints",void 0),u([d({readOnly:!0})],Us.prototype,"events",void 0),u([d({readOnly:!0})],Us.prototype,"isGlobal",null),u([d({readOnly:!0})],Us.prototype,"isLocal",null),u([d({readOnly:!0})],Us.prototype,"viewingMode",void 0),u([d({readOnly:!0})],Us.prototype,"spatialReference",void 0),u([d()],Us.prototype,"navigating",null),u([d()],Us.prototype,"stationary",null),u([d()],Us.prototype,"_cameraChanged",void 0),u([d()],Us.prototype,"cameraController",null),Us=u([$("esri.views.3d.state.ViewState")],Us);const a$t=Us,Cd=new Pt,C1e="ViewStateHandles";let l$t=class{constructor(e,i,r){this.viewingMode=e,this._forEachLayer=i,this._view=r,this._externalIntersectionHandlers=new Wt,this._tolerance=JM,this._tmpRay=ko(),this._tmpRegion=Kt(),this._validateHUDIntersector=Fp(this.viewingMode),this._validateHUDIntersector.options.hud=!1}intersectScreen(e,i,r){return this.intersectRay(this._getPickRay(e,this._tmpRay),A1e(this.viewingMode),i,r)}intersectScreenFreePointFallback(e,i,r){return this.intersectRayFreePointFallback(this._getPickRay(e,this._tmpRay),i,r)}intersectRayFreePointFallback(e,i,r){return this.intersectRay(e,A1e(this.viewingMode),i,r)||this._intersectRayFreePointLocal(e,i)}intersectRay(e,i,r,n){return i.options.selectionMode=!1,i.options.store=Ta.MIN,this.computeIntersection(e,i,n),!!i.results.min&&i.results.min.getIntersectionPoint(r)}getCenterRayWithSubpixelOffset(e,i,r=.5,n=.5){return e.getRenderCenter(hk,r,n),hk[0]+=.0466,hk[1]-=.0123,xle(e,hk,i)}intersectIntersectorScreen(e,i,r){this.computeIntersection(this._getPickRay(e,this._tmpRay),i,r)}intersectToolIntersectorScreen(e,i,r){const n=this._getPickRay(e,this._tmpRay);this.intersectToolIntersectorRay(n,i,r)}intersectToolIntersectorRay(e,i,r){i.options.selectionMode=!0,this.computeIntersection(e,i,r);const n=i.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||Mm(n)&&n.intersector!==gn.TERRAIN||(i.options.selectionMode=!1,this.computeIntersection(e,i,r))}setTolerance(e=JM){this._tolerance=e}addIntersectionHandler(e){this._externalIntersectionHandlers.push(e),this._externalIntersectionHandlers.sort((i,r)=>i.type===gn.TERRAIN?1:r.type===gn.TERRAIN?-1:0)}removeIntersectionHandler(e){this._externalIntersectionHandlers.removeUnordered(e)!=null&&this._externalIntersectionHandlers.sort((i,r)=>i.type===gn.TERRAIN?1:r.type===gn.TERRAIN?-1:0)}_getPickRay(e,i){const r=this._view.state.camera;return lFe(r,e,i)}_intersectRayFreePointLocal(e,i){return this.viewingMode!==qe.Local||R(e)||me(i,e.origin,we(Ye.get(),e.direction)),!1}intersectElevationFromScreen(e,i,r=0,n=null){return this._intersectElevation(this._getPickRay(e,this._tmpRay),i,r,n)}_intersectElevation(e,i,r=0,n=null){if(R(e))return null;const s=v(i)?i.mode:"absolute-height",o=v(i)?Nt(i.offset,0):0,a=s!=="on-the-ground"?o+r:0,l=a/this._view.renderCoordsHelper.unitInMeters;if(s==="absolute-height"){if(this._view.renderCoordsHelper.intersectInfiniteManifold(e,a,uk)){const x=this._view.computeMapPointFromVec3d(uk);return x.z??(x.z=0),x.z-=o,x}return null}const c=this._view.state.camera,h=Ye.get();c.projectToRenderScreen(e.origin,h);const p=new R1e(null,this._forEachLayer),f=this._view.slicePlane,m=v(f)?S0e(f):null,g=Fp(this.viewingMode);g.options.store=Ta.MIN,g.options.verticalOffset=l;const _=e.origin,b=me(Ye.get(),_,e.direction);g.reset(_,b,c),g.point=h;const w=v(n)?"type"in n&&n.type==="graphics"?x=>{var T;return((T=x.metadata)==null?void 0:T.layerUid)!==n.uid}:x=>{var T;return((T=x.metadata)==null?void 0:T.graphicUid)!==n.uid}:null;switch(s){case"relative-to-scene":{const x=T=>{var E;return(R(w)||w(T))&&!!((E=T.metadata)!=null&&E.isElevationSource)};g.intersect(p.layers,h,this._tolerance,null,x),this._externalIntersectionHandlers.forAll(T=>{if(T.type===gn.I3S||T.type===gn.TERRAIN){const E=T.slicePlaneEnabled?m:null;T.intersect(g,E,g.rayBegin,g.rayEnd,h)}});break}case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll(x=>{if(x.isGround){const T=x.slicePlaneEnabled?m:null;x.intersect(g,T,g.rayBegin,g.rayEnd,h)}})}if(g.results.min.getIntersectionPoint(uk)){const x=this._view.computeMapPointFromVec3d(uk);return x.z=r,x}return null}computeIntersection(e,i,r){var g;if(R(e))return;const n=this._view.state.camera,s=Ye.get();n.projectToRenderScreen(e.origin,s);const o=new R1e(r,this._forEachLayer);i.options.selectOpaqueTerrainOnly=!r||!("include"in r||"exclude"in r);const a=e.origin,l=me(Ye.get(),e.origin,e.direction);i.reset(a,l,n),i.intersect(o.layers,s,this._tolerance);const c=this._view.slicePlane,h=v(c)?S0e(c):null;i.intersect(o.sliceableLayers,s,this._tolerance,h);const p=r&&(r.requiresGroundFeedback||r.enableDraped);this._externalIntersectionHandlers.forAll(_=>{const b=_.layerUid,w=Array.isArray(b),x=w?b:[b];w&&(i.options.filteredLayerUids=[]);let T=!1;for(const E of x)o.filterLayerUid(E)?T=!0:w&&i.options.filteredLayerUids.push(E);if(i.options.isFiltered=!T,_.isGround&&p||!i.options.isFiltered){const E=_.slicePlaneEnabled?h:null;_.intersect(i,E,a,l,s)}});const f=Ye.get(),m=this._view.basemapTerrain;if(r&&r.enableDraped&&v(m.spatialReference)&&i.results.ground.getIntersectionPoint(f)){const _=m.overlayManager.renderer,b=this._view.renderCoordsHelper.spatialReference,w=Ye.get();this._view.renderCoordsHelper.fromRenderCoords(f,w,m.spatialReference),w[2]=Nt((g=this._view.elevationProvider)==null?void 0:g.getElevation(f[0],f[1],f[2],b,"ground"),0),_.intersect(i,w,i.results.ground,x=>o.filterRenderGeometry(x))}i.sortResults(),this._processHUDResults(i)}_processHUDResults(e){const i=e.results.hud;A_(this._tmpRegion,_Z);const r=this._view.state.camera,n=[],s=this._tmpRegion,o=w=>{const x=new u$t(w);r.projectToRenderScreen(w.target.center,x.screenPoint),x.screenPoint[0]=Math.floor(x.screenPoint[0]),x.screenPoint[1]=Math.floor(x.screenPoint[1]),n.push(x),Nne(s,x.screenPoint)};e.sortResults(i.all),v(i.min.dist)&&o(i.min);for(const w of i.all)i.min.target.object!==w.target.object&&i.max.target.object!==w.target.object&&o(w);if(v(i.max.dist)&&i.max.target.object!==i.min.target.object&&o(i.max),!n.length)return;s[0]===s[2]&&(s[2]+=1),s[1]===s[3]&&(s[3]+=1);const a=r.fullWidth,l=r.fullHeight,c=Math.max(0,s[0]-XI),h=Math.max(0,s[1]-XI),p=Math.min(Wh(s)+2*XI,a-c),f=Math.min(gm(s)+2*XI,l-h),m=new Uint8Array(p*f*4);this._view._stage.renderer.readHUDVisibility(c,h,p,f,m);let g=!0;const _=R(e.results.max.dist);let b=0;for(const w of n)for(const x of c$t)if(m[4*(Math.min(w.screenPoint[0]+x[0],a)-s[0]+(Math.min(w.screenPoint[1]+x[1],l)-s[1])*p)]){g&&(e.results.min.copy(w.result),g=!1),_&&e.results.max.copy(w.result),e.options.store===Ta.ALL&&e.results.all.splice(b++,0,w.result);break}}};const XI=1,c$t=(()=>{const t=[],e=XI;for(let i=-e;i<=e;i++)for(let r=-e;r<=e;r++)t.push([r+e,i+e]);return t})();let u$t=class{constructor(e){this.result=e,this.screenPoint=ka()}},ck;function A1e(t){return ck&&ck.viewingMode===t||(ck=Fp(t)),ck}let R1e=class{constructor(e,i){this.layers=new Array,this.sliceableLayers=new Array,this.include=e==null?void 0:e.include,this.exclude=e==null?void 0:e.exclude,i(r=>{r.pickable&&this.filterLayerUid(r.apiLayerUid)&&(r.sliceable?this.sliceableLayers:this.layers).push(r)})}filterLayerUid(e){const{include:i,exclude:r}=this;return R(e)?i==null&&r==null:(i==null||i.has(e))&&(r==null||!r.has(e))}filterRenderGeometry(e){return this.filterLayerUid(e.layerUid)}};function M1e(t){return typeof t=="object"&&"intersect"in t}const uk=P(),hk=ka();let uQt=class{constructor(e,i){this.spatialReference=e,this._view=i}getElevation(e,i,r){return this._view.elevationProvider.getElevation(e,i,0,this.spatialReference,r)}async queryElevation(e,i,r,n,s){return this._view.elevationProvider.queryElevation(e,i,0,this.spatialReference,s,r,n)}},h$t=class{constructor(e,i,r,n){this.spatialReference=i,this._getElevationQueryProvider=r,this._queries=new Array,this._queryOptions={...n,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(St.ELEVATION_QUERY,this)}destroy(){this._frameTask.remove()}queryElevation(e,i,r,n=0){return new Promise((s,o)=>{const a={x:e,y:i,minDemResolution:n,result:{resolve:s,reject:o},signal:r};this._queries.push(a),ja(r,()=>{Ure(this._queries,a),o(Bi())})})}get running(){return this._queries.length>0}runTask(e){const i=this._queries;this._queries=[];const r=this._getElevationQueryProvider();if(!r)return i.forEach(h=>h.result.reject()),void e.madeProgress();const n=i.map(h=>[h.x,h.y]),s=i.reduce((h,p)=>Math.min(h,p.minDemResolution),1/0),o=new mN({points:n,spatialReference:this.spatialReference}),a=i.length>1&&i.some(h=>!!h.signal)?new AbortController:null,l=v(a)?a.signal:i[0].signal;if(v(a)){let h=0;i.forEach(p=>ja(p.signal,()=>{h++,p.result.reject(Bi()),h===i.length&&a.abort()}))}const c={...this._queryOptions,minDemResolution:s,signal:l};r.queryElevation(o,c).then(h=>{i.forEach((p,f)=>{v(p.signal)&&p.signal.aborted?p.result.reject(Bi()):p.result.resolve(h.geometry.points[f][2])})}).catch(h=>{i.forEach(p=>p.result.reject(h))}),e.madeProgress()}get test(){const e=this;return{update:()=>e._queries.length>0&&e.runTask(ql)}}},YI=class extends An.EventedMixin(ve){get spatialReference(){var e,i;return(i=(e=this.view)==null?void 0:e.basemapTerrain)==null?void 0:i.spatialReference}constructor(e){super(e),this._im=new Array,this._ground=new Array,this._scene=new Array,this._handles=new Map,this.lastElevationQuery=null,this.elevationCacheEnabled=!1}destroy(){this._elevationQueryCached=Ve(this._elevationQueryCached)}get _elevationQuery(){return R(this._elevationQueryCached)&&(this._elevationQueryCached=new h$t(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4})),this._elevationQueryCached}enableElevationCache(e){e||(this.lastElevationQuery=null),this.elevationCacheEnabled=e}getElevation(e,i,r,n,s){if(this.elevationCacheEnabled&&this.lastElevationQuery!=null){const a=this.lastElevationQuery;if(e===a.x&&i===a.y&&r===a.z&&Dn(n,a.spatialReference)&&s===a.queryContext)return a.result}let o=null;return o=dk(o,this._im,e,i,r,n,s),R(o)&&(o=dk(o,this._ground,e,i,r,n,s)),s==="scene"&&(o=dk(o,this._scene,e,i,r,n,s)),this.elevationCacheEnabled&&(this.lastElevationQuery={x:e,y:i,z:r,spatialReference:n,queryContext:s,result:o}),o}queryElevation(e,i,r,n,s,o=null,a=0){const l=Jb();return this._elevationQuery.queryElevation(e,i,o,a).then(c=>{s==="scene"&&(c=dk(c,this._scene,e,i,r,n,s)),l.resolve(c)}).catch(c=>{gs(c)?l.reject(c):l.resolve(this.getElevation(e,i,r,n,s))}),l.promise}register(e,i){this._handles.set(i,i.on("elevation-change",r=>this.emit("elevation-change",r))),this._providersFromContext(e).push(i)}unregister(e){var i;this._handles.has(e)&&((i=this._handles.get(e))==null||i.remove(),this._handles.delete(e));for(const r of[this._im,this._ground,this._scene]){const n=r.indexOf(e);n>-1&&r.splice(n,1)}}_providersFromContext(e){switch(e){case"ground":return this._ground;case"im":return this._im;case"scene":return this._scene}}};function dk(t,e,i,r,n,s,o){for(const a of e){const l=a.getElevation(i,r,n,s,o);v(l)&&(t=v(t)?Math.max(l,t):l)}return t}u([d({constructOnly:!0})],YI.prototype,"view",void 0),u([d()],YI.prototype,"spatialReference",null),YI=u([$("esri.views.3d.support.CombinedElevationProvider")],YI);let ZI=class Xte{static isValidProfile(e){return e in Xte.profiles}static getDefaultProfile(){return ue("esri-iPhone")?"low":"medium"}static apply(e,i){const r=Xte.profiles[e];i.graphics3D.maxTotalNumberOfFeatures=r.graphics3D.maxTotalNumberOfFeatures,i.graphics3D.maxTotalNumberOfPrimitives=r.graphics3D.maxTotalNumberOfPrimitives,i.graphics3D.polygonLodFactor=r.graphics3D.polygonLodFactor,i.graphics3D.polylineLodFactor=r.graphics3D.polylineLodFactor,i.graphics3D.snapshotAvailable=r.graphics3D.snapshotAvailable,i.graphics3D.skipHighSymbolLods=r.graphics3D.skipHighSymbolLods;const n=i.sceneService.object,s=r.sceneService.object;n.lodFactor=s.lodFactor,n.lodCrossfadeinDuration=s.lodCrossfadeinDuration,n.lodCrossfadeoutDuration=s.lodCrossfadeoutDuration,n.lodCrossfadeUncoveredDuration=s.lodCrossfadeUncoveredDuration,i.sceneService.point.lodFactor=r.sceneService.point.lodFactor,i.sceneService.integratedMesh.lodFactor=r.sceneService.integratedMesh.lodFactor,i.sceneService.pointCloud.lodFactor=r.sceneService.pointCloud.lodFactor,i.sceneService.uncompressedTextureDownsamplingEnabled=r.sceneService.uncompressedTextureDownsamplingEnabled,i.tiledSurface.lodBias=r.tiledSurface.lodBias,i.tiledSurface.angledSplitBias=r.tiledSurface.angledSplitBias,i.tiledSurface.reduceTileLevelDifferences=r.tiledSurface.reduceTileLevelDifferences,i.tiledSurface.textureFadeDuration=r.tiledSurface.textureFadeDuration,i.heatmap.pixelRatio=r.heatmap.pixelRatio,i.heatmap.maxTotalNumberOfFeatures=r.heatmap.maxTotalNumberOfFeatures,i.fadeDuration=r.fadeDuration,i.antialiasingEnabled=r.antialiasingEnabled,i.physicallyBasedRenderingEnabled=r.physicalBasedRenderingEnabled,i.highQualityTransparency=r.highQualityTransparency,i.memoryLimit=r.memoryLimit,i.additionalCacheMemory=r.additionalCacheMemory,i.frameRate=r.frameRate,i.maximumPixelRatio=r.maximumPixelRatio}};function O1e(){const t=!!ue("esri-mobile"),e=!!ue("ios"),i=400;return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxTotalNumberOfPrimitives:85e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25e3},sceneService:{object:{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},fadeDuration:0,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:t?.8:1,polylineLodFactor:t?1.2:1.5,snapshotAvailable:!e,skipHighSymbolLods:!1},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:i},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:t},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!ue("disable-feature:reduce-map-tile-levels"),textureFadeDuration:i},fadeDuration:i,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:t?600:750,additionalCacheMemory:t?0:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:t?1.2:2,polylineLodFactor:t?1.2:2,snapshotAvailable:!e,skipHighSymbolLods:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:i},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!ue("disable-feature:reduce-map-tile-levels"),textureFadeDuration:i},fadeDuration:i,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:t?900:1500,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:t?1:1/0}}}ZI.test={reset(){const t=O1e();for(const e in t)ZI.profiles[e]=t[e]}},function(t){t.profiles=O1e()}(ZI||(ZI={}));const HU=ZI;function J6e(){return new Float32Array(4)}function d$t(t){const e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Tm(t,e,i,r){const n=new Float32Array(4);return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n}function p$t(t,e){return new Float32Array(t,e,4)}function K6e(){return J6e()}function Q6e(){return Tm(1,1,1,1)}function eUe(){return Tm(1,0,0,0)}function tUe(){return Tm(0,1,0,0)}function iUe(){return Tm(0,0,1,0)}function rUe(){return Tm(0,0,0,1)}const f$t=K6e(),m$t=Q6e(),g$t=eUe(),y$t=tUe(),_$t=iUe(),v$t=rUe();Object.freeze(Object.defineProperty({__proto__:null,ONES:m$t,UNIT_W:v$t,UNIT_X:g$t,UNIT_Y:y$t,UNIT_Z:_$t,ZEROS:f$t,clone:d$t,create:J6e,createView:p$t,fromValues:Tm,ones:Q6e,unitW:rUe,unitX:eUe,unitY:tUe,unitZ:iUe,zeros:K6e},Symbol.toStringTag,{value:"Module"}));const P1e=new Xe([0,255,255]),I1e=new Xe([0,0,0]),$1e=1,L1e=.25,D1e=.4,N1e=.2;let _g=class extends ve{constructor(){super(...arguments),this.color=P1e.clone(),this.haloColor=null,this.haloOpacity=$1e,this.fillOpacity=L1e,this.shadowOpacity=D1e,this.shadowColor=I1e.clone(),this.shadowDifference=N1e}static toEngineOptions(e){const i=Xe.toUnitRGBA(e.color??P1e),r=v(e.haloColor)?Xe.toUnitRGBA(e.haloColor):i,n=Xe.toUnitRGBA(e.shadowColor??I1e),s=e.haloOpacity??$1e,o=e.fillOpacity??L1e,a=e.shadowOpacity??D1e,l=e.shadowDifference??N1e;return{color:Tm(i[0],i[1],i[2],i[3]),haloColor:Tm(r[0],r[1],r[2],r[3]),haloOpacity:s,haloOpacityOccluded:.25*s,fillOpacity:o,fillOpacityOccluded:.25*o,shadowOpacity:a,shadowColor:Zt(n[0],n[1],n[2],n[3]),occludedShadowOpacity:a*(1-l)}}};u([d({type:Xe})],_g.prototype,"color",void 0),u([d({type:Xe})],_g.prototype,"haloColor",void 0),u([d()],_g.prototype,"haloOpacity",void 0),u([d()],_g.prototype,"fillOpacity",void 0),u([d()],_g.prototype,"shadowOpacity",void 0),u([d({type:Xe})],_g.prototype,"shadowColor",void 0),u([d()],_g.prototype,"shadowDifference",void 0),_g=u([$("esri.views.3d.support.HighlightOptions")],_g);const Yte=_g;let NT=class extends fe{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(n=>n.toJSON()),i=this.geometries[0],r={};return r.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),r.inSR=i.spatialReference.wkid||JSON.stringify(i.spatialReference.toJSON()),r.geometries=JSON.stringify({geometryType:pO(i),geometries:e}),this.transformation&&(r.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(r.transformForward=this.transformForward),r}};u([d()],NT.prototype,"geometries",void 0),u([d({json:{read:{source:"outSR"}}})],NT.prototype,"outSpatialReference",void 0),u([d()],NT.prototype,"transformation",void 0),u([d()],NT.prototype,"transformForward",void 0),NT=u([$("esri.rest.support.ProjectParameters")],NT);const qD=NT,b$t=Ts(qD);async function qz(t,e,i){e=b$t(e);const r=qse(t),n={...r.query,f:"json",...e.toJSON()},s=e.outSpatialReference,o=pO(e.geometries[0]),a=lit(n,i);return ir(r.path+"/project",a).then(({data:{geometries:l}})=>aOe(l,o,s))}async function Ace(t=null,e){var n,s;if(nr.geometryServiceUrl)return nr.geometryServiceUrl;if(!t)throw new H("internal:geometry-service-url-not-configured");let i;i="portal"in t?t.portal||ya.getDefault():t,await i.load({signal:e});const r=(s=(n=i.helperServices)==null?void 0:n.geometry)==null?void 0:s.url;if(!r)throw new H("internal:geometry-service-url-not-configured");return r}async function w$t(t,e,i=null,r){const n=await Ace(i,r),s=new qD;s.geometries=[t],s.outSpatialReference=e;const o=await qz(n,s,{signal:r});if(o&&Array.isArray(o)&&o.length===1)return o[0];throw new H("internal:geometry-service-projection-failed")}const Zte=Object.freeze(Object.defineProperty({__proto__:null,getGeometryServiceURL:Ace,projectGeometry:w$t},Symbol.toStringTag,{value:"Module"}));let x$t=class{constructor(e,i){this.spatialReference=i,this.unitInMeters=tc(this.spatialReference,sr(this.spatialReference).metersPerDegree),this._geometryServiceURLPromise=Ace(e&&e.get("portalItem")).catch(()=>{throw new H("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(e){const i=await this._geometryServiceURLPromise;let r,n=!0;Array.isArray(e[0])&&typeof e[0]!="number"?r=e:(r=[e],n=!1);const s=r.map(l=>l instanceof Le?l:new Le(l,this.spatialReference)),o=new qD({geometries:s,outSpatialReference:Je.WGS84}),a=(await qz(i,o)).map(l=>l.type==="point"?[l.x,l.y]:void 0).filter(l=>!!l);return n?a:a[0]}},If=class extends ve{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxTotalNumberOfPrimitives=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1}};u([d()],If.prototype,"minTotalNumberOfFeatures",void 0),u([d()],If.prototype,"maxTotalNumberOfFeatures",void 0),u([d()],If.prototype,"maxTotalNumberOfPrimitives",void 0),u([d()],If.prototype,"snapshotAvailable",void 0),u([d()],If.prototype,"polygonLodFactor",void 0),u([d()],If.prototype,"polylineLodFactor",void 0),u([d()],If.prototype,"skipHighSymbolLods",void 0),If=u([$("esri.views.3d.support.QualitySettings.Graphics3DSettings")],If);let ry=class extends ve{constructor(){super(...arguments),this.lodFactor=1}};u([d()],ry.prototype,"lodFactor",void 0),ry=u([$("esri.views.3d.support.QualitySettings.LoDFactorSettings")],ry);let Wz=class extends ry{constructor(){super(...arguments),this.lodCrossfadeinDuration=0,this.lodCrossfadeoutDuration=0,this.lodCrossfadeUncoveredDuration=0}};Wz=u([$("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],Wz);let D0=class extends ve{constructor(){super(...arguments),this.object=new Wz,this.point=new ry,this.integratedMesh=new ry,this.pointCloud=new ry,this.uncompressedTextureDownsamplingEnabled=!1}};u([d({type:Wz})],D0.prototype,"object",void 0),u([d({type:ry})],D0.prototype,"point",void 0),u([d({type:ry})],D0.prototype,"integratedMesh",void 0),u([d({type:ry})],D0.prototype,"pointCloud",void 0),u([d()],D0.prototype,"uncompressedTextureDownsamplingEnabled",void 0),D0=u([$("esri.views.3d.support.QualitySettings.SceneServiceSettings")],D0);let q1=class extends ve{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.reduceTileLevelDifferences=!0,this.textureFadeDuration=400}};u([d()],q1.prototype,"lodBias",void 0),u([d()],q1.prototype,"angledSplitBias",void 0),u([d()],q1.prototype,"reduceTileLevelDifferences",void 0),u([d()],q1.prototype,"textureFadeDuration",void 0),q1=u([$("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],q1);let gR=class extends ve{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};u([d()],gR.prototype,"pixelRatio",void 0),u([d()],gR.prototype,"maxTotalNumberOfFeatures",void 0),gR=u([$("esri.views.3d.support.QualitySettings.HeatmapSettings")],gR);let Cc=class extends ve{constructor(){super(...arguments),this.graphics3D=new If,this.sceneService=new D0,this.tiledSurface=new q1,this.heatmap=new gR,this.fadeDuration=400,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.memoryLimit=void 0,this.additionalCacheMemory=void 0,this.frameRate=void 0,this.maximumPixelRatio=1/0}};u([d({type:If})],Cc.prototype,"graphics3D",void 0),u([d({type:D0})],Cc.prototype,"sceneService",void 0),u([d({type:q1})],Cc.prototype,"tiledSurface",void 0),u([d({type:gR})],Cc.prototype,"heatmap",void 0),u([d()],Cc.prototype,"fadeDuration",void 0),u([d()],Cc.prototype,"antialiasingEnabled",void 0),u([d()],Cc.prototype,"physicallyBasedRenderingEnabled",void 0),u([d()],Cc.prototype,"highQualityTransparency",void 0),u([d()],Cc.prototype,"memoryLimit",void 0),u([d()],Cc.prototype,"additionalCacheMemory",void 0),u([d()],Cc.prototype,"frameRate",void 0),u([d()],Cc.prototype,"maximumPixelRatio",void 0),Cc=u([$("esri.views.3d.support.QualitySettings.QualitySettings")],Cc);const F1e=Cc;function T$t(t){return Bre(t)&&t.length>=3}function S$t(t){return(jre(t)||Array.isArray(t))&&t.length>=3}function E$t(t){return T$t(t)||S$t(t)}let C$t=class Jte{constructor(e,i,r,n){this.viewingMode=e,this.spatialReference=i,this.unitInMeters=r,this._coordinateSystem=n,this._tmpCoordinateSystem=Uyt(n)}set extent(e){e&&Vyt(this._coordinateSystem,e,this._coordinateSystem)}getAltitude(e){return Xyt(this._coordinateSystem,e)}setAltitude(e,i,r=e){return QLe(this._coordinateSystem,r,i,e)}setAltitudeOfTransformation(e,i){Yyt(this._coordinateSystem,i,e,i)}worldUpAtPosition(e,i){return Gyt(this._coordinateSystem,e,i)}worldBasisAtPosition(e,i,r){return Hyt(this._coordinateSystem,e,i,r)}basisMatrixAtPosition(e,i){const r=this.worldBasisAtPosition(e,zu.X,Ye.get()),n=this.worldBasisAtPosition(e,zu.Y,Ye.get()),s=this.worldBasisAtPosition(e,zu.Z,Ye.get());return Sy(i,r[0],r[1],r[2],0,n[0],n[1],n[2],0,s[0],s[1],s[2],0,0,0,0,1),i}headingAtPosition(e,i){const r=this.worldUpAtPosition(e,Ye.get()),n=this.worldBasisAtPosition(e,zu.Y,Ye.get()),s=RLe(i,n,r);return ml(s)}intersectManifoldClosestSilhouette(e,i,r){return NH(this._coordinateSystem,i,this._tmpCoordinateSystem),Wyt(this._tmpCoordinateSystem,e,r),r}intersectManifold(e,i,r){NH(this._coordinateSystem,i,this._tmpCoordinateSystem);const n=Ye.get();return qyt(this._tmpCoordinateSystem,e,n)?ce(r,n):null}intersectInfiniteManifold(e,i,r){if(this.viewingMode===qe.Global)return this.intersectManifold(e,i,r);NH(this._coordinateSystem,i,this._tmpCoordinateSystem);const n=this._tmpCoordinateSystem.value,s=Ye.get();return Y2(n.plane,e,s)?ce(r,s):null}toRenderCoords(e,i,r){return Ez(e)?qa(e,i,this.spatialReference):jo(e,i,r,this.spatialReference)}fromRenderCoords(e,i,r=null){return Ez(i)?(v(r)&&(i.spatialReference=r),JAe(e,this.spatialReference,i)):E$t(i)?jo(e,this.spatialReference,i,r)?i:null:lw(e,this.spatialReference,i)}static create(e,i){switch(e){case qe.Local:return new Jte(qe.Local,i,tc(i),jyt());case qe.Global:return new Jte(qe.Global,i,1,Byt(i))}}static renderUnitScaleFactor(e,i){return k1e(e)/k1e(i)}};function k1e(t){if(Cz(t,qe.Global))return 1;const e=eDe(!1,t);return tc(e)}var Ug;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.BASEMAP=1]="BASEMAP",t[t.I3S_INDEX=2]="I3S_INDEX",t[t.I3S_DATA=3]="I3S_DATA",t[t.SYMBOLOGY=4]="SYMBOLOGY"})(Ug||(Ug={}));const A$t=(()=>{const t=new Array;return t[Ug.ELEVATION]=10,t[Ug.BASEMAP]=10,t[Ug.I3S_INDEX]=10,t[Ug.I3S_DATA]=10,t[Ug.SYMBOLOGY]=5,t})(),R$t=30;function nUe(t){return typeof t.getUsedMemory=="function"}function M$t(t){return new Ac({view:t})}const pk=1,AW=1,O$t=.75,P$t=.6,U1e=1.3;let Ac=class extends ve{constructor(e){super(e),this._quality=1,this._memoryUsed=0,this._updating=!1,this.minQuality=.1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new jse,this._warnMemoryUsage=null,this._numQualityChanges=0,this._maxMemory=500,this._additionalCacheMemory=100}destroy(){this._cacheStorage.destroy()}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(pk),this._maxMemory=e)}get maxMemory(){return this._maxMemory}set additionalCacheMemory(e){e!=null&&e>=0&&(this._additionalCacheMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._memoryUsed}newCache(e,i){return new Ott(e,this._cacheStorage,i)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._updateMemory(),this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();if(this._memoryPredicted<P$t&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(pk);else if(e)(this._memoryPredicted>1.1*AW||this._memoryUsed>AW)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/U1e),this._downscaleMemoryUsed=this._memoryUsed,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._memoryUsed>AW)this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/U1e),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._memoryUsed<O$t&&this._quality<pk){this._stableQuality=this._quality;const i=.05;e=this._updateQuality(this._quality+i)}else this._quality<1&&(this._canFastRecover=!0);this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,this.minQuality),pk))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){let e=0,i=0;this.view.basemapTerrain&&this.view.basemapTerrain.getUsedMemory&&(e+=this.view.basemapTerrain.getUsedMemory());const r=this.view._stage&&this.view._stage.renderView&&this.view._stage.renderer.edgeView;v(r)&&(e+=r.usedMemory),this.view.allLayerViews&&this.view.allLayerViews.forEach(a=>{if(nUe(a)){const l=a.ignoresMemoryFactor()?this._quality:1;e+=a.getUsedMemory()*l,i+=a.getUnloadedMemory()*l}});const n=R(this._warnMemoryUsage)||Math.round(10*e)!==Math.round(10*this._warnMemoryUsage),s=1048576*this.maxMemory;if(e>s&&n){this._warnMemoryUsage=e;const a=c=>(c/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",l=Math.round(100*this._quality);re.getLogger(this.declaredClass).warn(`Memory Limit exceeded! Limit: ${a(s)} Current: ${a(e)} Projected: ${a(e+i)} Quality: ${l}%`)}this._memoryUsed=e/s,this._memoryPredicted=(e+i)/s;const o=s-e;this._cacheStorage.maxSize=Math.max(0,o+1048576*this.additionalCacheMemory)}get test(){const e=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const i=e._numQualityChanges;return e._numQualityChanges=0,i}}}};u([d({constructOnly:!0})],Ac.prototype,"view",void 0),u([d()],Ac.prototype,"maxMemory",null),u([d()],Ac.prototype,"additionalCacheMemory",null),u([d()],Ac.prototype,"memoryFactor",null),u([d()],Ac.prototype,"updating",null),u([d()],Ac.prototype,"usedMemory",null),u([d()],Ac.prototype,"_quality",void 0),u([d()],Ac.prototype,"_memoryUsed",void 0),u([d()],Ac.prototype,"_updating",void 0),u([d()],Ac.prototype,"_stableQuality",void 0),u([d()],Ac.prototype,"_maxMemory",void 0),u([d()],Ac.prototype,"_additionalCacheMemory",void 0),Ac=u([$("esri.views.3d.support.MemoryController")],Ac);let I$t=class{constructor(e){this.client=e,this._cancelled=!1,this.size=0,this.duration=0}},$$t=class{constructor(e){this.typeWorkerQuota=e,this.tasks=new Array,this.numWorkers=0,this.statistics=new L$t}},L$t=class{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}},D$t=class{constructor(e,i,r,n){this._workerFunc=e,this._callbackFunc=i,this._maxTotalNumWorkers=r,this._totalNumWorkers=0,this._clients=n.map(s=>new $$t(s))}destroy(){this._clients.length=0}hasQuota(e){const i=this._clients[e];return!!i&&(this._totalNumWorkers<this._maxTotalNumWorkers||i.numWorkers+i.tasks.length<i.typeWorkerQuota)}push(e){const i=this._clients[e.client];i&&(this._totalNumWorkers<this._maxTotalNumWorkers?(i.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,(r,n)=>this._taskCallback(r,n))):i.tasks.push(e))}cancel(e){this._taskFinished(e),e._cancelled=!0}_taskFinished(e){const i=this._clients[e.client];this._totalNumWorkers--,i.numWorkers--,i.statistics.requests++,i.statistics.size+=e.size||0,i.statistics.duration+=e.duration||0,i.statistics.speed=i.statistics.duration>0?i.statistics.size/i.statistics.duration:0,wt(i.numWorkers>=0),this._next()}_next(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))return}_processQueue(e){for(;e.tasks.length>0;)if(this._workerFunc(e.tasks.shift(),(i,r)=>this._taskCallback(i,r)))return e.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(e,i){e._cancelled||(this._callbackFunc(e,i),this._taskFinished(e))}getStatsForType(e){const i=this._clients[e];return i?{quota:i.typeWorkerQuota,workers:i.numWorkers,queueSize:i.tasks.length,requestStats:i.statistics}:null}get test(){const e=this;return{set workerFunc(i){e._workerFunc=i}}}},qU=class extends ve{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,i,r){this._loadQueue=new D$t((n,s)=>this._startLoading(n,s),(n,s)=>this._doneLoadingCB(n,s),e,i),r&&(this._frameTask=r.registerTask(St.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=Nr(this._frameTask),this._tasks.forEach(e=>Mp(e.abortController)),this._loadQueue=Ve(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,i,r,n={}){const s=Jb();s.__signal=v(n)?n.signal:null;const o=this._createOrUpdateTask(e,i,r,n,s);return ja(n,()=>this._cancelRequest(o,s)),s.promise}_createTask(e,i,r,n,s,o){const a=new k$t(e,i,r,n,s);return this._updateTask(a,o),this._tasks.set(s,a),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(a),a}_cancelRequest(e,i){var r;NL(e.resolvers,i),i.reject(Bi()),e.resolvers.length===0&&(e.status===Hd.DOWNLOADING&&(e.status=Hd.CANCELLED,this._loadQueue.cancel(e),(r=e.abortController)==null||r.abort(),e.request=null,e.abortController=null),e.status=Hd.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,i){e.resolvers.push(i)}_createOrUpdateTask(e,i,r,n,s){const o=U$t(v(n)&&n.uid||e,i,r),a=this._tasks.get(o);return a?(this._updateTask(a,s),a):this._createTask(e,n,i,r,o,s)}_doneLoadingCB(e,i){this._loadQueue&&(wt(e.status===Hd.DOWNLOADING),e.status=Hd.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:i}):this._doneLoading(e,i))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const i=this._onLoadQueue.shift();ui(i.task.abortController),i.task.abortController=null,i.callback(i.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const i=this._doneQueue.shift();i.task.status!==Hd.DOWNLOADED&&(i.err=i.err||Bi()),this._doneLoading(i.task,i.err),e.madeProgress()}}_doneLoading(e,i){if(i&&!gs(i)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let r=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const n of e.resolvers)if(i)gs(i)?n.reject(i):n.reject(new H("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${i}`,{url:e.url,error:i}));else{--r;const s=r<=0?e.result:se(e.result);n.resolve(s)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,i){if(e.status===Hd.CANCELLED)return!1;let r,n;switch(e.startTime=performance.now(),e.status=Hd.DOWNLOADING,e.docType){case"binary":n="array-buffer",r=0;break;case"image":n="image";break;case"image+type":n="array-buffer";break;default:n="json"}e.abortController=new AbortController;const s=e.abortController.signal;e.request=ir(e.url,{...e.options,responseType:n,timeout:r,signal:s});let o=()=>{};const a=c=>{e.duration=performance.now()-e.startTime,e.size=c instanceof ArrayBuffer?c.byteLength:e.size||0,e.result=c,this._frameTask?this._onLoadQueue.push({callback:i,task:e}):(e.abortController=null,i(e))},l=c=>{e.status===Hd.DOWNLOADING&&i(e,c),o()};return e.docType!=="image+type"?(e.request.then(c=>a(c.data),l),!0):(e.request.then(c=>{const h=c.data,p=F$t(h);if(n="image",e.size=h.byteLength,p==="unknown")return e.request=ir(e.url,{responseType:n,timeout:r,signal:s}),void e.request.then(g=>a(g.data),l);const f=new Blob([h],{type:p}),m=window.URL.createObjectURL(f);o=()=>window.URL.revokeObjectURL(m),e.request=ir(m,{responseType:n,timeout:r,signal:s}),e.request.then(g=>a(new z7(g.data,p,o)),l)},l),!0)}get test(){return{loadQueue:this._loadQueue}}};u([d({readOnly:!0})],qU.prototype,"updating",void 0),qU=u([$("esri.views.3d.support.StreamDataLoader")],qU);const N$t={numRetries:0};function F$t(t){if(t.byteLength<2)return"unknown";const e=new Uint8Array(t,0,t.byteLength);return e[0]===137&&e[1]===80?"image/png":e[0]===71&&e[1]===73?"image/gif":e[0]===66&&e[1]===77?"image/bmp":e[0]===255&&e[1]===216?"image/jpeg":"unknown"}let z7=class{constructor(e,i,r){this.image=e,this.type=i,this.release=r}get isOpaque(){return this.type==="image/jpeg"}},k$t=class extends I$t{constructor(e,i,r,n,s){super(n),this.url=e,this.options=i,this.docType=r,this.key=s,this.result=null,this.status=Hd.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=N$t.numRetries}};function U$t(t,e,i){return`${t}:${e}:${i}`}var Hd;(function(t){t[t.QUEUED=1]="QUEUED",t[t.DOWNLOADING=2]="DOWNLOADING",t[t.DOWNLOADED=3]="DOWNLOADED",t[t.CANCELLED=4]="CANCELLED"})(Hd||(Hd={}));let WU=class extends ve{constructor(){super(...arguments),this.updating=!1}};function V$t(t){return new vg({view:t})}u([d({readOnly:!0})],WU.prototype,"updating",void 0),WU=u([$("esri.views.3d.support.ResourceControllerMain")],WU);let vg=class extends WU{constructor(){super(...arguments),this._immediateTask=zM,this._normalTask=zM,this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=Dht(),this._memoryController=M$t(this.view),this._streamDataLoader=new qU,this._streamDataLoader.setup(R$t,A$t,this._scheduler),this.addHandles([ne(()=>{var e;return(e=this.view.state)==null?void 0:e.mode},e=>{e!=null&&(this._scheduler.state=e)},Ki),ne(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=E_({update:e=>this._frame(e)}),this._immediateTask=this._scheduler.registerTask(St.RESOURCE_CONTROLLER_IMMEDIATE),this._normalTask=this._scheduler.registerTask(St.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove(),this._normalTask.remove(),this._frameTask=Nr(this._frameTask),this._streamDataLoader=Ve(this._streamDataLoader),this._memoryController=Ve(this._memoryController),this._scheduler=Ve(this._scheduler)}get updating(){var e,i,r;return!!((e=this._memoryController)!=null&&e.updating||(i=this._streamDataLoader)!=null&&i.updating||(r=this._immediateTask)!=null&&r.updating)}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(e){const i=this._streamDataLoader;return{request:(r,n,s)=>i.request(r,n,e,s),get busy(){return!i.hasDownloadSlots(e)}}}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(ene(e.deltaTime)),!this._scheduler)||(this._scheduler.updateBudget(e)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update())}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){return{getQueueStats:e=>this._streamDataLoader.test.loadQueue.getStatsForType(e)}}};u([d({constructOnly:!0})],vg.prototype,"view",void 0),u([d()],vg.prototype,"_scheduler",void 0),u([d()],vg.prototype,"_memoryController",void 0),u([d()],vg.prototype,"_streamDataLoader",void 0),u([d()],vg.prototype,"_immediateTask",void 0),u([d()],vg.prototype,"_normalTask",void 0),u([d({readOnly:!0})],vg.prototype,"updating",null),vg=u([$("esri.views.3d.support.ResourceControllerImpl")],vg);function z$t(t){return"performanceInfo"in t}const tC=P(),B$t=P(),Zy=P(),Jy=P();function j$t(t,e,i=0){const r=t.extent;if(R(r))return!1;if(i===0)return TCe(r,e);const n=Math.min(r[2]-r[0],r[3]-r[1]);return mWe(r,e,i*n)}function fk(t,e,i,r){ce(tC,i),tC[r]=e[r];const n=ge(tC,tC,e),s=ge(B$t,t,e),o=be(s,n),a=be(n,n);let l;l=o<=0?e:a<=o?i:me(tC,e,le(n,n,o/a));const c=ge(tC,t,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function G$t(t,e,i){const r=t.extent;if(R(r))return 0;Zy[0]=r[0],Zy[1]=r[1],Zy[2]=i,Jy[0]=r[2],Jy[1]=r[3],Jy[2]=i;let n=1/0,s=1/0;return e[0]<Zy[0]?n=fk(e,Zy,Jy,0):e[0]>Jy[0]&&(n=fk(e,Jy,Zy,0)),e[1]<Zy[1]?s=fk(e,Zy,Jy,1):e[1]>Jy[1]&&(s=fk(e,Jy,Zy,1)),Math.min(n,s)}function H$t(t,e,i){if(R(t))return Oae();if(t.spatialReference.isGeographic&&!d2(t.spatialReference))return new H("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const r=Nu.checkUnsupported(t);if(v(r))return r;if(R(i))return new H("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const n=q$t(t,i);if(n)return n;const s=t.spatialReference;return v(e)&&!(s.equals(e)||e.isWGS84&&s.isWebMercator)?new H("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}function q$t(t,e){const i=t.lods,r=i[0].resolution*2**i[0].level,n=[r*t.size[0],r*t.size[1]],s=[t.origin.x,t.origin.y],o=ZL(e),a=Kt();Nu.computeRowColExtent(o,n,s,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>oR){const c=i[0].scale*2**i[0].level;let h=Math.max((o[3]-o[1])/t.size[1],(o[2]-o[0])/t.size[0])*c/r;const p=Math.floor(Math.log(h)/Math.log(10));return h=Math.ceil(h/10**p)*10**p,new H("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+h.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:h,requiredNumRootTiles:l,allowedNumRootTiles:oR})}return null}const W$t=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:H$t,isInsideExtent:j$t,tiltToExtentEdge:G$t},Symbol.toStringTag,{value:"Module"}));function X$t(){return!0}function Y$t(){return 0}function Z$t(t,e){if(R(t))return Oae();const i=t.lods.length-1,r=t.spatialReference,n=d2(r)||wy(r)||xy(r);if(r.isWebMercator){if(!Nu.makeWebMercatorAuxiliarySphere(i).compatibleWith(t))return new H("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!n)return new H("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!Nu.makeGCSWithTileSize(t.spatialReference,t.size[0],i).compatibleWith(t))return t.spatialReference.isWGS84?new H("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new H("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return v(e)&&!t.spatialReference.equals(e)?new H("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene"):void 0}const J$t=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:Z$t,isInsideExtent:X$t,tiltToExtentEdge:Y$t},Symbol.toStringTag,{value:"Module"})),K$t={[qe.Global]:J$t,[qe.Local]:W$t};function Ig(t,e){t||console.warn("Terrain: "+e)}let Qs=!1,Xz=!1;function Q$t(t){Xz=t,Qs=Qs||t}function eLt(t){Qs=t}function Re(t,e){var i;if(Qs&&!t){const r=(i=new Error().stack)==null?void 0:i.slice(5);throw console.warn("Terrain internal: "+(e||"")+" at "+r),new Error("Assertion failed"+(e?": "+e:""))}}function Kte(t){return B7(t)?{fullExtent:t.fullExtent,minScale:t.layer.minScale,maxScale:t.layer.maxScale,tilemapCache:null}:t.layer}function Yz(t){return(t==null?void 0:t.type)==="imagery-tile"||(t==null?void 0:t.type)==="wcs"}function B7(t){return(t==null?void 0:t.type)==="imagery-tile-3d"}function Rce(t){return(t==null?void 0:t.type)==="tile-3d"}function WD(t){return(t==null?void 0:t.type)==="vector-tile-3d"}function sUe(t){return(t==null?void 0:t.type)==="wmts-3d"}function Qte(t){return(t==null?void 0:t.type)==="elevation-3d"}function aP(t){return(t==null?void 0:t.type)==="group"}function Zz(t){return t&&(Rce(t)||sUe(t)||B7(t)||WD(t))}function eie(t){return t&&(Rce(t)||B7(t)||WD(t)||sUe(t))}function XD(t){return eie(t)||Qte(t)}function tLt(t){var i;const e=(i=t==null?void 0:t.sourceLayerInfo)==null?void 0:i.data;return v(e)&&"type"in e&&e.type==="raster-tile"}function iLt(t){var i;const e=(i=t==null?void 0:t.sourceLayerInfo)==null?void 0:i.data;return v(e)&&"type"in e&&e.type==="vector-tile"}function rLt(t){var i;const e=(i=t==null?void 0:t.sourceLayerInfo)==null?void 0:i.data;return v(e)&&"type"in e&&e.type==="tile-texture"}function nLt(t){var i;const e=(i=t==null?void 0:t.sourceLayerInfo)==null?void 0:i.data;return e instanceof HTMLImageElement||e instanceof z7||e instanceof HTMLCanvasElement||e instanceof ImageData}function JR(t){return v(t)&&"release"in t&&t.release(),null}function V1e(t){return t.fetchTile&&t.hasOverriddenFetchTile!==!1}function Mce(t,e,i,r){return K$t[r].checkIfTileInfoSupportedForViewSR(t,i,e)}function j7(t,e,i){let r=null,n=null;if((t==null?void 0:t.type)==="wmts"){const s=sLt(t,e,i);r=s.tileInfo,n=s.fullExtent}else{n=Yz(t)?t.getCompatibleFullExtent(e):t.fullExtent;const s=i===qe.Local;if(Yz(t))r=t.getCompatibleTileInfo(e,n,s);else if((t==null?void 0:t.type)==="vector-tile"){const o=s&&!oLt(e)||aLt.force512VTL,a=t.tileInfo.spatialReference.isGeographic;r=o?t.tileInfo:t.tileInfo.getOrCreateCompatible(256,a?1:2)}else r=t.tileInfo}return v(r)&&v(n)&&Mce(r,n,e,i)==null?{tileInfo:r,fullExtent:n}:null}function sLt(t,e,i){const r=VQe(t);if(v(r)){if(!tt.isCollection(r))return{tileInfo:r.tileInfo,fullExtent:r.fullExtent};{const n=r.find(s=>Mce(s.tileInfo,s.fullExtent,e,i)==null);if(n)return{tileInfo:n.tileInfo,fullExtent:n.fullExtent}}}return{tileInfo:null,fullExtent:null}}function oLt(t){return t.isWGS84||t.isWebMercator||F2e(t)||!zL(t)}const aLt={force512VTL:!1};function z1e(t){return"["+t[0]+","+t[1]+","+t[2]+"]"}function Ky(t){return"("+t[0]+","+t[1]+","+t[2]+")"}function ap(t,e,i=uLt){return Math.abs(t-e)<i}function tie(t){return t===It.NORTH_EAST?It.SOUTH_WEST:t===It.NORTH_WEST?It.SOUTH_EAST:t===It.SOUTH_WEST?It.NORTH_EAST:It.NORTH_WEST}function Jz(t){return t===It.NORTH?It.SOUTH:t===It.EAST?It.WEST:t===It.SOUTH?It.NORTH:It.EAST}function lLt(t){return t===It.NORTH_WEST||t===It.SOUTH_WEST}function cLt(t){return t===It.NORTH_WEST||t===It.NORTH_EAST}function B1e(t){return t===It.NORTH_WEST||t===It.WEST||t===It.SOUTH_WEST}function j1e(t){return t===It.NORTH_EAST||t===It.EAST||t===It.SOUTH_EAST}function G1e(t){return t===It.SOUTH_EAST||t===It.SOUTH||t===It.SOUTH_WEST}function H1e(t){return t===It.NORTH_EAST||t===It.NORTH||t===It.NORTH_WEST}const Hg=[It.NORTH,It.EAST,It.SOUTH,It.WEST],Kz=[It.NORTH_EAST,It.SOUTH_EAST,It.SOUTH_WEST,It.NORTH_WEST],uLt=1e-5;let hLt=class{constructor(e,i){if(this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=e.layer,this.memory=XD(e)?i.basemapTerrain.getUsedMemoryForLayerView(e):e.getUsedMemory(),z$t(e)){const r=e.performanceInfo;this.displayedNumberOfFeatures=r.displayedNumberOfFeatures,this.maximumNumberOfFeatures=r.maximumNumberOfFeatures,this.totalNumberOfFeatures=r.totalNumberOfFeatures}}},dLt=class{constructor(e){var r;if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,v(e.resourceController)){const n=e.resourceController.memoryController;this.totalMemory=(n.maxMemory??0)*PM.MEGABYTES,this.usedMemory=Math.round(n.usedMemory*this.totalMemory),this.quality=n.memoryFactor,this.load=e.resourceController.scheduler.load}this.terrainMemory=((r=e.basemapTerrain)==null?void 0:r.getUsedMemory())??0;const i=e._stage&&e._stage.renderView&&e._stage.renderer.edgeView;this.edgesMemory=v(i)?i.usedMemory:0,e.allLayerViews.items.forEach(n=>{(nUe(n)||XD(n))&&this.layerPerformanceInfos.push(new hLt(n,e))}),this.layerPerformanceInfos.sort((n,s)=>s.memory-n.memory)}},pLt=class{constructor(e){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=e("gltf-resources",()=>{}),this._wosrMemCache=e("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(e=>e.abortController.abort()),this._wosrLoading.forEach(e=>e.abortController.abort()),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()}loadGLTF(e,i,r){const n=r?`gltfPBR:${e}`:`gltf:${e}`,s=this._gltfMemCache.get(n);return v(s)?Promise.resolve(s):this._loadOnce(this._gltfLoading,this._gltfMemCache,n,o=>y6e(new m6e(o.streamDataRequester),e,o,r),i)}loadWOSR(e,i){const r=`wosr:${e}:${i.disableTextures}`,n=this._wosrMemCache.get(r);return v(n)?Promise.resolve(n):this._loadOnce(this._wosrLoading,this._wosrMemCache,r,s=>_6e(e,s),i)}async _loadOnce(e,i,r,n,s){ui(s);const o=ja(s,()=>this._abortLoad(e,r));let a=e.get(r);if(a)a.refCount++;else{const l=new AbortController;a={refCount:1,abortController:l,promise:n({...s,signal:l.signal})},e.set(r,a)}try{const l=await a.promise;return i.put(r,l,l.size),e.delete(r),ui(s),l}finally{Nr(o)}}_abortLoad(e,i){const r=e.get(i);v(r)&&--r.refCount>0||(e.delete(i),v(r)&&r.abortController.abort())}},fLt=class extends nR{constructor(e,i,r,n){super(i,n),this._streamDataRequester=e,this._parameters=r}async fromUrl(e,i,r){ui(r);const n=v(r)?r.signal:null,s=this.makeUid(e,i);let o=this._textureRequests.get(s);if(!o){const a=new AbortController,l=this._streamDataRequester.request(e,"image",{uid:s,signal:a.signal});o={referenceCount:0,texture:null,textureAsync:null,abortController:a};const c=o;this._textureRequests.set(s,o),o.textureAsync=l.then(async h=>{const p=this._createTexture(e,h,i);return c.texture=p,c.abortController=null,this._stage.add(p),await this._stage.load(p),{uid:s,texture:p,release:()=>this._release(s)}},h=>{throw c.abortController=null,h})}o.referenceCount++;try{return await Qre(o.textureAsync,n)}catch(a){throw this._release(s),a}}_createTexture(e,i,r){var s;const n={...this._parameters,powerOfTwoResizeMode:jb.PAD};if(zCe(e)){if(r||i.width===0&&i.height===0){const o=i.width?i.height/i.width:1;r=r||64,o>1?(i.width=Math.round(r/o),i.height=r):(i.width=r,i.height=Math.round(r*o))}(s=this._stage.renderView)!=null&&s.renderingContext.driverTest.svgPremultipliesAlpha.result&&(n.preMultiplyAlpha=!1)}return n.width=i.width,n.height=i.height,new Q2(i,n)}},mLt=class{constructor(e){this.textures=null,this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=e.viewState,this._view=e.view,this._pointsOfInterest=e.pointsOfInterest,this.streamDataRequester=e.resourceController.createStreamDataRequester(Ug.SYMBOLOGY),this.objectResourceCache=new pLt((r,n)=>e.resourceController.memoryController.newCache(r,n)),this.textures=new fLt(this.streamDataRequester,e.view._stage,{preMultiplyAlpha:!0,wrap:{s:$t.CLAMP_TO_EDGE,t:$t.CLAMP_TO_EDGE}},e.resourceController.scheduler);const i=sr(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=n4e(e.viewingMode,i),this.screenSizePerspectiveSettingsLabels=vSt(e.viewingMode,i)}destroy(){Ve(this.textures),this.textures=null,this.streamDataRequester=null}addGraphicsOwner(e){if(!e)return fm();this._graphicsOwners.push(e);const i=ne(()=>{var r;return(r=e.layer)==null?void 0:r.screenSizePerspectiveEnabled},()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),fm(()=>{i.remove(),NL(this._graphicsOwners,e),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const e=this._graphicsOwners.some(i=>{var r;return((r=i.layer)==null?void 0:r.screenSizePerspectiveEnabled)===!0});if(e&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new Xi;const i=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([ne(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,i,Ki),this._viewState.events.on("camera-projection-changed",i)]),this._updateScreenSizePerspectiveSettings()}else e||(this._screenSizePerspectiveHandles=Ve(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){const e=this._pointsOfInterest;mk.distance=e.centerOnSurfaceInfrequent.distance,mk.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(mk),this.screenSizePerspectiveSettingsLabels.update(mk),this._view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this._screenSizePerspectiveHandles}}};const mk={distance:0,fovY:0};let TA=class{constructor(e,i,r=""){this.graphics=e,this._symbol=new pb({symbolLayers:[new db({material:{color:i},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new H2({text:r,halo:{color:"white",size:1/.75},material:{color:i},size:12})]})}show(e,i){if(R(i))return;this.hide();const r=new Le({x:e[0],y:e[1],z:e[2],spatialReference:i});this._graphic=new Ha({geometry:r,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){v(this._graphic)&&(this.graphics.remove(this._graphic),this._graphic=null)}},nb=class extends ve{constructor(e){super(e),this.handles=new Xi}destroy(){this.handles.destroy()}};u([d({constructOnly:!0})],nb.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],nb.prototype,"surface",void 0),u([d({constructOnly:!0})],nb.prototype,"state",void 0),nb=u([$("esri.views.3d.support.PointOfInterest")],nb);const gLt=Array;let Cf=class extends nb{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new O_({location:Le,renderLocation:gLt},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.renderLocation=P(),this._tmpPoint=new Le}initialize(){if(this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.handles.add(Kn(()=>{var i,r;return(r=(i=this.map)==null?void 0:i.ground)==null?void 0:r.layers},"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool=Ve(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get scale(){const e=this._camera,i=Lr(e.eye,this.renderLocation),r={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return A2(r,i,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map||!this.map.ground)return this._updateSurfaceAltitude(0),Ga.YIELD;const e=this.state.spatialReference;this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint,e);const i=(this._tmpPoint.z??0)>yLt&&this.renderCoordsHelper.viewingMode===qe.Global&&(e.isWGS84||e.isWebMercator);let r=new AbortController;return this.map.ground.queryElevation(this._tmpPoint,{signal:r.signal,cache:this.cache,minDemResolution:i?_Lt:0}).then(n=>this._updateSurfaceAltitude(n.geometry.z??0)).catch(n=>{gs(n)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===r&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),r=null}),this._pendingElevationQueryController=r,Ga.YIELD}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(RW,this._estimatedSurfaceAltitude,this._camera.eye),Xl(this._get("renderLocation"),RW)||(this._set("renderLocation",ce(this._propertiesPool.get("renderLocation"),RW)),this.notifyChange("renderLocation"))}};u([d({constructOnly:!0})],Cf.prototype,"scheduler",void 0),u([d({constructOnly:!0})],Cf.prototype,"cache",void 0),u([d({constructOnly:!0})],Cf.prototype,"task",void 0),u([d({readOnly:!0})],Cf.prototype,"location",null),u([d({constructOnly:!0})],Cf.prototype,"map",void 0),u([d({readOnly:!0})],Cf.prototype,"renderLocation",void 0),u([d({readOnly:!0})],Cf.prototype,"scale",null),u([d({readOnly:!0})],Cf.prototype,"updating",null),Cf=u([$("esri.views.3d.support.CameraOnSurface")],Cf);const RW=P(),yLt=1e5,_Lt=1e6,vLt=Array;let qd=class extends nb{constructor(e){super(e),this._propertiesPool=new O_({location:Le,renderLocation:vLt},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=P(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=Nr(this._frameWorker),this._propertiesPool=Ve(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){return this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1,Ga.YIELD}_updateRenderLocation(){const e=wLt;let i=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const r=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!i&&r&&(i=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),i&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const n=xLt;i&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,n)&&(ce(e,n),this._currentSurfaceAltitude=this._latestSurfaceAltitude),i?this.distance=Lr(this._camera.eye,e):(le(e,this._camera.viewForward,this._get("distance")),me(e,e,this._camera.eye)),Xl(this._get("renderLocation"),e)||this._set("renderLocation",ce(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,i){var n,s;const r=this._camera;if(!this.renderCoordsHelper.intersectManifold(r.ray,e,i))return!1;if(this.state.isGlobal){const o=sr(this.renderCoordsHelper.spatialReference).radius,a=o+e,l=al(r.eye),c=l<a*a,h=Lr(r.eye,i);if(c&&h>o/4){const p=a-Math.sqrt(l);return le(i,r.viewForward,p),me(i,i,r.eye),!0}}else{const o=(n=this.surface)!=null&&n.ready?this.surface.extent:null;v(o)&&lB(o,(s=this.surface)==null?void 0:s.spatialReference,lP,this.renderCoordsHelper.spatialReference)&&(i[0]=_e(i[0],lP[0],lP[2]),i[1]=_e(i[1],lP[1],lP[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,i){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,i)){if(tr.TESTS_DISABLE_OPTIMIZATIONS)return!0;const r=this._camera.eye,n=Lr(r,e),s=Lr(r,i);if(Math.abs(s-n)/n>bLt)return!0}return!1}};u([d({constructOnly:!0})],qd.prototype,"scheduler",void 0),u([d({constructOnly:!0})],qd.prototype,"task",void 0),u([d()],qd.prototype,"distance",void 0),u([d({constructOnly:!0})],qd.prototype,"estimateSurfaceAltitudeAtCenter",void 0),u([d({readOnly:!0})],qd.prototype,"location",null),u([d({readOnly:!0})],qd.prototype,"renderLocation",void 0),u([d()],qd.prototype,"updating",void 0),qd=u([$("esri.views.3d.support.CenterOnSurface")],qd);const bLt=.05,wLt=P(),xLt=P(),lP=Kt();let TLt=class{constructor(e){this._handles=new Xi,this.events=new An,this._contentLayerViews=e.contentLayerViews,this._handles.add(this._contentLayerViews.on("change",i=>this._layerViewsChanged(i))),this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=Ve(this._handles)}_layerViewsChanged(e){e.added.forEach(i=>{i.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this._handles.add(i.on("visible-geometry-changed",()=>this._contentChanged()),i.uid)}),e.removed.forEach(i=>this._handles.remove(i.uid))}_contentChanged(){this.events.emit("request-update",SLt)}};const SLt={},ELt=Array;let bg=class extends nb{constructor(e){super(e),this._propertiesPool=new O_({location:Le,renderLocation:ELt},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.handles.add([ne(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),ne(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.handles.add(this.scheduler.registerTask(St.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool=Ve(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),i=this.centerOnSurface.renderLocation,r=this.renderCoordsHelper,n=this.state.contentCamera;this._dirty=!1,r.worldUpAtPosition(i,q1e);const s=Math.max(0,(Math.acos(be(q1e,n.viewForward))-.5*Math.PI)*(n.aboveGround?1:-1));if(Number.isNaN(s)){if(!e||!Qb(e,i)){const c=this._propertiesPool.get("renderLocation");ce(c,i),this._set("renderLocation",c)}return Ga.YIELD}const o=1-_e(s/(.5*Math.PI),0,1),a=o*o*o;this._calculateScreenHorizontalEdgeOnSurface(W1e);const l=this._propertiesPool.get("renderLocation");return ys(l,i,W1e,a),e&&Qb(e,l)||this._set("renderLocation",l),Ga.YIELD}_calculateScreenHorizontalEdgeOnSurface(e){const i=this.state.contentCamera,r=i.getRenderCenter(ka());if(r[1]=i.aboveGround?i.padding[yi.BOTTOM]:i.fullHeight-i.padding[yi.TOP],this.estimateSurfaceIntersectionAtRenderPoint(r,e))return e;const n=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(i.unprojectFromRenderScreen(r,cP)){ge(cP,cP,i.eye);const s=we(cP,cP);if(this.renderCoordsHelper.intersectManifold(cd(i.eye,s),n,e))return e}return this.renderCoordsHelper.setAltitude(e,n,i.eye)}updateRenderLocation(){this._dirty=!0}};u([d()],bg.prototype,"_dirty",void 0),u([d({constructOnly:!0})],bg.prototype,"scheduler",void 0),u([d({constructOnly:!0})],bg.prototype,"centerOnSurface",void 0),u([d({constructOnly:!0})],bg.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),u([d({readOnly:!0})],bg.prototype,"updating",null),u([d({readOnly:!0})],bg.prototype,"location",null),u([d({readOnly:!0})],bg.prototype,"renderLocation",void 0),bg=u([$("esri.views.3d.support.pointsOfInterest.Focus")],bg);const q1e=P(),cP=P(),W1e=P();let C0=class extends ve{get surface(){var e;return(e=this.view.map)==null?void 0:e.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const e=P();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}constructor(e){super(e),this.location=null,this._updateController=null,this._handles=new Xi}initialize(){this.view.state.isLocal&&(this._handles.add([ne(()=>{var e,i;return[(e=this.surfaceView)==null?void 0:e.spatialReference,(i=this.surfaceView)==null?void 0:i.extent]},()=>this._update()),Kn(()=>{var e;return(e=this.surface)==null?void 0:e.layers},"change",()=>this._update())]),this._update())}destroy(){this._handles.destroy()}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),!this.surfaceView||R(this.surfaceView.extent)||R(this.surfaceView.spatialReference))return void this._set("location",null);const e=Fne(this.surfaceView.extent),i=new Le({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(i,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(r=>{this._updateController=null,this._set("location",r.geometry)}).catch(r=>{gs(r)||r&&r.name==="elevation-query:invalid-layer"||console.error("StableSurfaceCenter failed to update: ",r)})):this._set("location",i)}};u([d({constructOnly:!0})],C0.prototype,"view",void 0),u([d({constructOnly:!0})],C0.prototype,"cache",void 0),u([d()],C0.prototype,"surface",null),u([d()],C0.prototype,"surfaceView",null),u([d({readOnly:!0})],C0.prototype,"location",void 0),u([d({readOnly:!0})],C0.prototype,"renderLocation",null),C0=u([$("esri.views.3d.terrain.StableSurfaceCenter")],C0);let A0=class extends ve{constructor(e){super(e),this._tileGeometryUpdateExtent=od(),this._tileGeometryUpdateSpatialReference=null,this.events=new An,this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(St.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){return this.updating&&(this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",CLt),od(this._tileGeometryUpdateExtent),this._set("updating",!1)),Ga.YIELD}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,kb(this._tileGeometryUpdateExtent,e.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let i=1;i<this.centerOnSurfaces.length;i++){const r=this.centerOnSurfaces[i];r.distance>e.distance&&(e=r)}return e}_centerIntersectsExtent(e,i){const r=this.state.contentCamera.eye,n=ALt,s=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(r,Px,i),this.renderCoordsHelper.fromRenderCoords(s.renderLocation,Ix,i),Px[0]<Ix[0]?(n[0]=Px[0],n[2]=Ix[0]):(n[0]=Ix[0],n[2]=Px[0]),Px[1]<Ix[1]?(n[1]=Px[1],n[3]=Ix[1]):(n[1]=Ix[1],n[3]=Px[1]),W9(n,e)}};u([d({constructOnly:!0})],A0.prototype,"state",void 0),u([d({constructOnly:!0})],A0.prototype,"centerOnSurfaces",void 0),u([d({constructOnly:!0})],A0.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],A0.prototype,"scheduler",void 0),u([d({constructOnly:!0})],A0.prototype,"surface",void 0),u([d({readOnly:!0})],A0.prototype,"updating",void 0),A0=u([$("esri.views.3d.support.SurfaceGeometryUpdates")],A0);const CLt={},Px=P(),Ix=P(),ALt=od();let Pc=class extends ve{constructor(e){super(e),this._handles=new Xi,this._tmpRay=ko(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new O_({renderPointOfView:RLt},this),this.renderPointOfView=P(),this._pois=new Array,this._debugCenters=new Map}initialize(){var h;const{state:e,basemapTerrain:i,renderCoordsHelper:r,map:n}=this.view;this._surfaceIntersector=Fp(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=Ta.MIN,this._contentIntersector=Fp(e.viewingMode);const s=()=>this._estimateSurfaceAltitudeAtCenter(),o=this.view.resourceController.scheduler,a=(h=this.view.basemapTerrain)==null?void 0:h.elevationQueryCache,l={state:e,scheduler:o,surface:i,renderCoordsHelper:r};this._set("centerOnSurfaceInfrequent",new qd({...l,task:St.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:s})),this._set("centerOnSurfaceFrequent",new qd({...l,task:St.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:s})),this._set("centerOnContent",new qd({...l,task:St.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new Cf({...l,cache:a,task:St.POINT_OF_INTEREST_INFREQUENT,map:n})),this._set("surfaceGeometryUpdates",new A0({...l,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new TLt({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:r})),this._set("surfaceOrigin",new C0({cache:a,view:this.view})),this._set("focus",new bg({state:e,scheduler:o,surface:i,renderCoordsHelper:r,centerOnSurface:this.centerOnSurfaceInfrequent,estimateSurfaceIntersectionAtRenderPoint:(p,f)=>this._estimateSurfaceIntersectionAtRenderPoint(p,this.view.state.contentCamera,f)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus);const c=this.view.graphics;this._debugCenters.set(this.centerOnContent,new TA(c,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new TA(c,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new TA(c,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new TA(c,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new TA(c,"green","Focus")),this._handles.add([ne(()=>e.contentCamera,p=>this._cameraChanged(p),Ki),ne(()=>i.extent,()=>this._updateCenterPointsOfInterest()),yo(()=>!i.updating,()=>this._updateCenterPointsOfInterest(),Ki),Kn(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),Kn(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),yo(()=>tr.SHOW_POI,p=>this._setDebug(p),zt)]),this._cameraChanged(this.view.state.contentCamera);for(const p of this._pois)p.runTask()}destroy(){this._setDebug(!1),this._handles.destroy(),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){var e;return!(!((e=this.surfaceGeometryUpdates)!=null&&e.updating)&&!this._pois.some(i=>i.updating))}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this._centerRay;return R(e)||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,iC,OLt)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(iC):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this._centerRay;if(R(e))return this._surfaceAltitudeAtCenter;const i=e.origin,r=me(iC,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.contentCamera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,i,r),this._surfaceIntersector.results.min.getIntersectionPoint(iC)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(iC)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,i,r){const n=xle(i,e,MLt);if(R(n))return null;const s=n.origin,o=me(iC,n.origin,n.direction);return this._surfaceIntersector.resetWithRay(n,i),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,s,o),this._surfaceIntersector.results.min.getIntersectionPoint(r)?r:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const i=e.eye;Xl(this.renderPointOfView,i)||this._set("renderPointOfView",ce(this._propertiesPool.get("renderPointOfView"),i))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(i=>i.hide()),void this._handles.remove("debug");for(const i of this._pois)this._handles.add(ne(()=>i.renderLocation,r=>{var n;return(n=this._debugCenters.get(i))==null?void 0:n.show(r,i.renderCoordsHelper.spatialReference)},zt),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};u([d({readOnly:!0})],Pc.prototype,"centerOnContent",void 0),u([d({readOnly:!0})],Pc.prototype,"centerOnSurfaceFrequent",void 0),u([d({readOnly:!0})],Pc.prototype,"centerOnSurfaceInfrequent",void 0),u([d({readOnly:!0})],Pc.prototype,"cameraOnSurface",void 0),u([d({readOnly:!0})],Pc.prototype,"focus",void 0),u([d({readOnly:!0})],Pc.prototype,"renderPointOfView",void 0),u([d({readOnly:!0})],Pc.prototype,"surfaceOrigin",void 0),u([d({readOnly:!0})],Pc.prototype,"contentGeometryUpdates",void 0),u([d({readOnly:!0})],Pc.prototype,"surfaceGeometryUpdates",void 0),u([d({constructOnly:!0})],Pc.prototype,"view",void 0),u([d({readOnly:!0})],Pc.prototype,"updating",null),Pc=u([$("esri.views.3d.support.PointsOfInterest")],Pc);const RLt=Array,iC=P(),MLt=ko(),OLt={exclude:new Set([eb])};let PLt=class{constructor(e){this._store=e}destroy(){this._store.destroy()}get(e){return this._store.get(e)}put(e,i){this._store.put(e,i,i.values.byteLength+256)}},ILt=class{constructor(e,i,r,n){this._hasNoDataValues=null,this._minValue=null,this._maxValue=null,"pixelData"in e?(this.values=e.pixelData,this.width=e.width,this.height=e.height,this.noDataValue=e.noDataValue):(this.values=e,this.width=i,this.height=r,this.noDataValue=n)}get hasNoDataValues(){if(R(this._hasNoDataValues)){const e=this.noDataValue;this._hasNoDataValues=this.values.includes(e)}return this._hasNoDataValues}get minValue(){return this._ensureBounds(),this._minValue}get maxValue(){return this._ensureBounds(),this._maxValue}_ensureBounds(){if(v(this._minValue))return;const{noDataValue:e,values:i}=this;let r=1/0,n=-1/0,s=!0;for(const o of i)o===e?this._hasNoDataValues=!0:(r=o<r?o:r,n=o>n?o:n,s=!1);s?(this._minValue=0,this._maxValue=0):(this._minValue=r,this._maxValue=n>-3e38?n:0)}},oUe=class{constructor(e,i,r,n,s={}){this._mainMethod=i,this._transferLists=r,this._listeners=[],this._promise=OAe(e,{...s,schedule:n}).then(o=>{if(this._thread===void 0){this._thread=o,this._promise=null,s.hasInitialize&&this.broadcast({},"initialize");for(const a of this._listeners)this._connectListener(a)}else o.close()}),this._promise.catch(o=>re.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${e} worker: ${o}`))}on(e,i){const r={removed:!1,eventName:e,callback:i,threadHandle:null};return this._listeners.push(r),this._connectListener(r),fm(()=>{r.removed=!0,Ure(this._listeners,r),this._thread&&v(r.threadHandle)&&r.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null}invoke(e,i){return this.invokeMethod(this._mainMethod,e,i)}invokeMethod(e,i,r){if(this._thread){const n=this._transferLists[e],s=n?n(i):[];return this._thread.invoke(e,i,{transferList:s,signal:r})}return this._promise?this._promise.then(()=>(ui(r),this.invokeMethod(e,i,r))):Promise.reject(null)}broadcast(e,i){return this._thread?Promise.all(this._thread.broadcast(i,e)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(e,i)):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then(i=>{e.removed||(e.threadHandle=i)})}},X1e=class extends oUe{constructor(e=null){super("LercWorker","_decode",{_decode:i=>[i.buffer]},e,{strategy:"dedicated"}),this.schedule=e,this.ref=0}decode(e,i,r){return e&&e.byteLength!==0?this.invoke({buffer:e,options:i},r):Promise.resolve(null)}release(){--this.ref<=0&&(uL.forEach((e,i)=>{e===this&&uL.delete(i)}),this.destroy())}};const uL=new Map;function $Lt(t=null){let e=uL.get(t);return e||(v(t)?(e=new X1e(i=>t.immediate.schedule(i)),uL.set(t,e)):(e=new X1e,uL.set(null,e))),++e.ref,e}var $u,Y1e,Z1e;(function(t){t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})($u||($u={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.OUTLINE=2]="OUTLINE",t[t.LINE=3]="LINE",t[t.ICON=4]="ICON",t[t.CIRCLE=5]="CIRCLE",t[t.TEXT=6]="TEXT",t[t.TILEINFO=7]="TILEINFO"}(Y1e||(Y1e={})),function(t){t[t.PAINTER_CHANGED=0]="PAINTER_CHANGED",t[t.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",t[t.LAYER_CHANGED=2]="LAYER_CHANGED",t[t.LAYER_REMOVED=3]="LAYER_REMOVED",t[t.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(Z1e||(Z1e={}));let LLt=class{constructor(e){this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}},QQt=class{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}};function tei(t,e,i,r,n,s){const o=i-n;if(o>=0)return(e>>o)+(r-(s<<o))*(t>>o);const a=-o;return e-(s-(r<<a))*(t>>a)<<a}let iei=class{constructor(e,i,r){this._rows=Math.ceil(i/r),this._columns=Math.ceil(e/r),this._cellSize=r,this.cells=new Array(this._rows);for(let n=0;n<this._rows;n++){this.cells[n]=new Array(this._columns);for(let s=0;s<this._columns;s++)this.cells[n][s]=[]}}getCell(e,i){const r=Math.min(Math.max(Math.floor(i/this._cellSize),0),this._rows-1),n=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[r]&&this.cells[r][n]||null}getCellSpan(e,i,r,n){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(n/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}};function DLt(t,e,i,r,n,s){const o=e[r++];for(let a=0;a<o;a++){const l=new LLt(s);l.xTile=e[r++],l.yTile=e[r++],l.hash=e[r++],l.priority=e[r++];const c=e[r++];for(let f=0;f<c;f++){const m=e[r++],g=e[r++],_=e[r++],b=e[r++],w=!!e[r++],x=e[r++],T=i[r++],E=i[r++],C=e[r++],A=e[r++];l.colliders.push({xTile:m,yTile:g,dxPixels:_,dyPixels:b,hard:w,partIndex:x,width:C,height:A,minLod:T,maxLod:E})}const h=t[r++];for(let f=0;f<h;f++)l.textVertexRanges.push([t[r++],t[r++]]);const p=t[r++];for(let f=0;f<p;f++)l.iconVertexRanges.push([t[r++],t[r++]]);n.push(l)}return r}function nei(t,e,i){for(const[r,n]of t.symbols)NLt(t,e,i,n,r)}function NLt(t,e,i,r,n){const s=t.layerData.get(n);if(s.type===$u.SYMBOL){for(const o of r){const a=o.unique;let l;if(o.selectedForRendering){const c=a.parts[0],h=c.startOpacity,p=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&p===0;const f=i?Math.floor(127*h)|p<<7:p?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of o.iconVertexRanges)for(let p=c;p<c+h;p+=4)s.iconOpacity[p/4]=l;if(o.selectedForRendering){const c=a.parts[1],h=c.startOpacity,p=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&p===0;const f=i?Math.floor(127*h)|p<<7:p?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of o.textVertexRanges)for(let p=c;p<c+h;p+=4)s.textOpacity[p/4]=l}s.lastOpacityUpdate=e,s.opacityChanged=!0}}let G7=class{constructor(e,i){this.layerUIDs=[],this.isDestroyed=!1,this._data=e,this.memoryUsed=e.byteLength;let r=1;const n=new Uint32Array(e);this.layerUIDs=[];const s=n[r++];for(let o=0;o<s;o++)this.layerUIDs[o]=n[r++];this.bufferDataOffset=r,i&&(this.layer=i.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return R(this._data)}get offset(){return this.bufferDataOffset}destroy(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}prepareForRendering(e){R(this._data)||(this.doPrepareForRendering(e,this._data,this.bufferDataOffset),this._data=null)}},FLt=class extends G7{constructor(e,i){super(e,i),this.type=$u.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const r=new Uint32Array(e);let n=this.bufferDataOffset;this.lineIndexStart=r[n++],this.lineIndexCount=r[n++];const s=r[n++];if(s>0){const o=new Map;for(let a=0;a<s;a++){const l=r[n++],c=r[n++],h=r[n++];o.set(l,[c,h])}this.patternMap=o}this.bufferDataOffset=n}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){v(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose(),v(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose(),v(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose(),this.lineVertexArrayObject=null,this.lineVertexBuffer=null,this.lineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(e,i,r){const n=new Uint32Array(i),s=new Int32Array(n.buffer),o=n[r++];this.lineVertexBuffer=er.createVertex(e,zi.STATIC_DRAW,new Int32Array(s.buffer,4*r,o)),r+=o;const a=n[r++];this.lineIndexBuffer=er.createIndex(e,zi.STATIC_DRAW,new Uint32Array(n.buffer,4*r,a)),r+=a;const l=this.layer.lineMaterial;this.lineVertexArrayObject=new Np(e,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)}},kLt=class extends G7{constructor(e,i){super(e,i),this.type=$u.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const r=new Uint32Array(e);let n=this.bufferDataOffset;this.fillIndexStart=r[n++],this.fillIndexCount=r[n++],this.outlineIndexStart=r[n++],this.outlineIndexCount=r[n++];const s=r[n++];if(s>0){const o=new Map;for(let a=0;a<s;a++){const l=r[n++],c=r[n++],h=r[n++];o.set(l,[c,h])}this.patternMap=o}this.bufferDataOffset=n}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){v(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose(),v(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose(),v(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose(),this.fillVertexArrayObject=null,this.fillVertexBuffer=null,this.fillIndexBuffer=null,v(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose(),v(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose(),v(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose(),this.outlineVertexArrayObject=null,this.outlineVertexBuffer=null,this.outlineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(e,i,r){const n=new Uint32Array(i),s=new Int32Array(n.buffer),o=n[r++];this.fillVertexBuffer=er.createVertex(e,zi.STATIC_DRAW,new Int32Array(s.buffer,4*r,o)),r+=o;const a=n[r++];this.fillIndexBuffer=er.createIndex(e,zi.STATIC_DRAW,new Uint32Array(n.buffer,4*r,a)),r+=a;const l=n[r++];this.outlineVertexBuffer=er.createVertex(e,zi.STATIC_DRAW,new Int32Array(s.buffer,4*r,l)),r+=l;const c=n[r++];this.outlineIndexBuffer=er.createIndex(e,zi.STATIC_DRAW,new Uint32Array(n.buffer,4*r,c)),r+=c;const h=this.layer,p=h.fillMaterial,f=h.outlineMaterial;this.fillVertexArrayObject=new Np(e,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer),this.outlineVertexArrayObject=new Np(e,f.getAttributeLocations(),f.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)}},ULt=class extends G7{constructor(e,i,r){super(e,i),this.type=$u.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const n=new Uint32Array(e),s=new Int32Array(e),o=new Float32Array(e);let a=this.bufferDataOffset;this.isIconSDF=!!n[a++];const l=n[a++];for(let f=0;f<l;f++){const m=n[a++],g=n[a++],_=n[a++];this.iconPerPageElementsMap.set(m,[g,_])}const c=n[a++];for(let f=0;f<c;f++){const m=n[a++],g=n[a++],_=n[a++];this.glyphPerPageElementsMap.set(m,[g,_])}const h=n[a++],p=n[a++];this.iconOpacity=new Int32Array(h),this.textOpacity=new Int32Array(p),a=DLt(n,s,o,a,this.symbols,r),this.bufferDataOffset=a}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let e=0;for(const[i,r]of this.iconPerPageElementsMap)e+=r[1];for(const[i,r]of this.glyphPerPageElementsMap)e+=r[1];return e/3}doDestroy(){v(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose(),v(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose(),v(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose(),v(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose(),this.iconVertexArrayObject=null,this.iconVertexBuffer=null,this.iconOpacityBuffer=null,this.iconIndexBuffer=null,v(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose(),v(this.textVertexBuffer)&&this.textVertexBuffer.dispose(),v(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose(),v(this.textIndexBuffer)&&this.textIndexBuffer.dispose(),this.textVertexArrayObject=null,this.textVertexBuffer=null,this.textOpacityBuffer=null,this.textIndexBuffer=null,this.memoryUsed=0}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const e=this.iconOpacity,i=this.iconOpacityBuffer;e.length>0&&e.byteLength===i.size&&i.setSubData(e,0,0,e.length);const r=this.textOpacity,n=this.textOpacityBuffer;r.length>0&&r.byteLength===n.size&&n.setSubData(r,0,0,r.length)}doPrepareForRendering(e,i,r){const n=new Uint32Array(i),s=new Int32Array(n.buffer),o=n[r++];this.iconVertexBuffer=er.createVertex(e,zi.STATIC_DRAW,new Int32Array(s.buffer,4*r,o)),r+=o;const a=n[r++];this.iconIndexBuffer=er.createIndex(e,zi.STATIC_DRAW,new Uint32Array(n.buffer,4*r,a)),r+=a;const l=n[r++];this.textVertexBuffer=er.createVertex(e,zi.STATIC_DRAW,new Int32Array(s.buffer,4*r,l)),r+=l;const c=n[r++];this.textIndexBuffer=er.createIndex(e,zi.STATIC_DRAW,new Uint32Array(n.buffer,4*r,c)),r+=c,this.iconOpacityBuffer=er.createVertex(e,zi.STATIC_DRAW,this.iconOpacity.buffer),this.textOpacityBuffer=er.createVertex(e,zi.STATIC_DRAW,this.textOpacity.buffer);const h=this.layer,p=h.iconMaterial,f=h.textMaterial;this.iconVertexArrayObject=new Np(e,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer),this.textVertexArrayObject=new Np(e,f.getAttributeLocations(),f.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)}},VLt=class extends G7{constructor(e,i){super(e,i),this.type=$u.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const r=new Uint32Array(e);let n=this.bufferDataOffset;this.circleIndexStart=r[n++],this.circleIndexCount=r[n++],this.bufferDataOffset=n}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){v(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose(),v(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose(),v(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose(),this.circleVertexArrayObject=null,this.circleVertexBuffer=null,this.circleIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(e,i,r){const n=new Uint32Array(i),s=new Int32Array(n.buffer),o=n[r++];this.circleVertexBuffer=er.createVertex(e,zi.STATIC_DRAW,new Int32Array(s.buffer,4*r,o)),r+=o;const a=n[r++];this.circleIndexBuffer=er.createIndex(e,zi.STATIC_DRAW,new Uint32Array(n.buffer,4*r,a)),r+=a;const l=this.layer.circleMaterial;this.circleVertexArrayObject=new Np(e,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)}};const uei=!0,hei=32,dei=1.5,J1e=200,zLt=1/ue("mapview-transitions-duration");let BLt=class extends An{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}get stage(){return this._stage}set stage(e){var r;if(this._stage===e)return;const i=this._stage;this._stage=e,e?(r=this._stage)!=null&&r.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):i==null||i.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return R(this._transforms)&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.requestRender())}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.opacity=1,this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=Jb(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=Jb(),this.requestRender()),this._fadeOutResolver.promise}endTransitions(){var e,i;(e=this._fadeInResolver)==null||e.call(this),this._fadeInResolver=null,(i=this._fadeOutResolver)==null||i.call(this),this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0,this.requestRender()}beforeRender(e){this.updateTransitionProperties(e.deltaTime,e.state.scale)}afterRender(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var e;(e=this.parent)==null||e.removeChild(this)}setTransform(e){}processRender(e){this.stage&&this.computedVisible&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(e,i){if(this.fadeTransitionEnabled){const r=this._fadeOutResolver||!this.visible?0:this.opacity,n=this.computedOpacity;if(n===r)this.computedVisible=this.visible;else{const s=e*zLt;this.computedOpacity=n>r?Math.max(r,n-s):Math.min(r,n+s),this.computedVisible=this.computedOpacity>0;const o=r===this.computedOpacity;this.inFadeTransition=!o,o||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}},jLt=class extends BLt{constructor(e,i,r,n,s,o,a=s,l=o){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new fw(e),this.resolution=i,this.x=r,this.y=n,this.width=s,this.height=o,this.rangeX=a,this.rangeY=l}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(e){const i=this.resolution/(e.resolution*e.pixelRatio),r=this.transforms.tileMat3,[n,s]=e.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*i,a=this.height/this.rangeY*i;fD(r,o,0,0,0,a,0,n,s,1),pw(this.transforms.dvs,e.displayViewMat3,r)}},MW=class aUe extends jLt{constructor(e,i,r,n,s,o,a,l=null){super(e,i,r,n,s,o,4096,4096),this._memCache=l,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.layerCount=0,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.invalidating=!1,this.parentTile=null,this.childrenTiles=new Set,this._processed=!1,this._referenced=1,this.styleRepository=a,this.id=e.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<J1e}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<J1e)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}deleteLayerData(e){let i=!1;for(const r of e)if(this.layerData.has(r)){const n=this.layerData.get(r);this._memoryUsedByLayerData-=n.memoryUsed,n.type===$u.SYMBOL&&this.symbols.has(r)&&(this.symbols.delete(r),i=!0),n.destroy(),this.layerData.delete(r),this.layerCount--}v(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData),i&&this.emit("symbols-changed"),this.requestRender()}processed(){return this._processed}hasData(){return this.layerCount>0}dispose(){this.status!=="unloaded"&&(lUe.delete(this),aUe._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return--this._referenced==0&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsage(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}changeDataImpl(e){let i=!1;if(e){const{bucketsWithData:r,emptyBuckets:n}=e,s=this._createRenderBuckets(r);if(n&&n.byteLength>0){const o=new Uint32Array(n);for(const a of o)this._deleteLayerData(a)}for(const[o,a]of s)this._deleteLayerData(o),a.type===$u.SYMBOL&&(this.symbols.set(o,a.symbols),i=!0),this._memoryUsedByLayerData+=a.memoryUsed,this.layerData.set(o,a),this.layerCount++;v(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=!1;for(const[r,n]of this.layerData)n.type===$u.SYMBOL&&(this._hasSymbolBuckets=!0);i&&this.emit("symbols-changed")}attachWithContext(e){this.stage={context:e,trashDisplayObject(i){i.processDetach()},untrashDisplayObject:()=>!1}}setTransform(e){super.setTransform(e);const i=this.resolution/(e.resolution*e.pixelRatio),r=this.width/this.rangeX*i,n=this.height/this.rangeY*i,s=[0,0];e.toScreen(s,[this.x,this.y]);const o=this.transforms.tileUnitsToPixels;Hoe(o),YV(o,o,s),Woe(o,o,Math.PI*e.rotation/180),Xoe(o,o,[r,n,1])}_createTransforms(){return{dvs:qc(),tileMat3:qc(),tileUnitsToPixels:qc()}}static _destroyRenderBuckets(e){if(!e)return;const i=new Set;e.forEach(r=>{i.has(r)||(r.destroy(),i.add(r))}),e.clear()}_createRenderBuckets(e){const i=new Map,r=new Map;for(const n of e){const s=this._deserializeBucket(n,r);for(const o of s.layerUIDs)i.set(o,s)}return i}_deserializeBucket(e,i){let r=i.get(e);if(r)return r;switch(new Uint32Array(e)[0]){case $u.FILL:r=new kLt(e,this.styleRepository);break;case $u.LINE:r=new FLt(e,this.styleRepository);break;case $u.SYMBOL:r=new ULt(e,this.styleRepository,this);break;case $u.CIRCLE:r=new VLt(e,this.styleRepository)}return i.set(e,r),r}_deleteLayerData(e){if(!this.layerData.has(e))return;const i=this.layerData.get(e);this._memoryUsedByLayerData-=i.memoryUsed,i.destroy(),this.layerData.delete(e),this.layerCount--}};const lUe=new Map;function GLt(){lUe.forEach((t,e)=>{console.log(`
${e.key}:`),t[0].forEach(i=>console.log(i)),console.log("========"),t[1].forEach(i=>console.log(i))})}const mei={value:.5,readOnly:!0},HLt={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};let yR=class{constructor(e=0,i=0){this.min=e,this.max=i,this.level=0,this.hasNoDataValues=!1}copyFrom(e){this.min=e.min,this.max=e.max,this.level=e.level,this.hasNoDataValues=e.hasNoDataValues}},qLt=class{constructor(e,i){this.data=e,this.safeWidth=.99999999*(e.width-1),this.dx=(e.width-1)/(i[2]-i[0]),this.dy=(e.width-1)/(i[3]-i[1]),this.x0=i[0],this.y1=i[3]}},WLt=class{constructor(e,i,r){this.type="elevation",this.level=e[0],this.i=e[1],this.j=e[2],this.extent=i,this.samplerData=new qLt(r,i)}computeMinMaxValue(e,i,r,n){n.min=1/0,n.max=-1/0,n.hasNoDataValues=!1;const s=e-this.level;if(s<=0)return n;const o=2**s;if(!(Math.floor(i/o)===this.i&&Math.floor(r/o)===this.j))return n;let a=1/0,l=-1/0;const c=this.samplerData.data.width,h=this.samplerData.data.values,p=.5*_D;let f=(c-1)/o,m=(r-this.j*o)*f,g=(i-this.i*o)*f;if(f<1){const _=Math.floor(m),b=Math.floor(g),w=_+b*c,x=h[w],T=h[w+1],E=h[w+c],C=h[w+c+1];if(x+T+E+C<p){const A=m-_,I=g-b,O=B4(x,T,E,C,A,I),D=B4(x,T,E,C,A+f,I),U=B4(x,T,E,C,A,I+f),V=B4(x,T,E,C,A+f,I+f);return n.min=Math.min(O,D,U,V),n.max=Math.max(O,D,U,V),n}m=_,g=b,f=1}else m=Math.floor(m),g=Math.floor(g),f=Math.ceil(f);for(let _=m;_<=m+f;_++)for(let b=g;b<=g+f;b++){const w=h[_+b*c];w<p?(a=Math.min(a,w),l=Math.max(l,w)):n.hasNoDataValues=!0}return n.min=a,n.max=l,n}};const XLt=.5*_D;function sn(t,e,i){if(R(i))return null;for(const r of i){if(!r)continue;const n=r.safeWidth;let s=_e(r.dy*(r.y1-e),0,n),o=_e(r.dx*(t-r.x0),0,n);const a=Math.floor(s),l=Math.floor(o),c=r.data.width,h=a*c+l,p=r.data.values,f=p[h],m=p[h+1],g=h+c,_=p[g],b=p[g+1];if(f+_+m+b<XLt){s-=a,o-=l;const w=f+(m-f)*o;return w+(_+(b-_)*o-w)*s}}return null}let Gd=class extends ve{constructor(e){super(e),this._handles=new Xi}initialize(){this._handles.add([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){this._handles=Ve(this._handles)}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(i=>{const r=i.layer;if(r.operationalLayerType==="IntegratedMeshLayer"&&this.viewSpatialReference!=null){const n=cUe(r.fullExtent,this.viewSpatialReference);v(n)&&e.push(ZL(n))}}),e}};function YLt(t,e){return t===qe.Global?new iie(e):new rie(e)}u([d({readOnly:!0})],Gd.prototype,"layerViewsExtent",null),u([d({readOnly:!0})],Gd.prototype,"tiledLayersExtent",null),u([d({readOnly:!0})],Gd.prototype,"stencilEnabledExtents",null),u([d()],Gd.prototype,"viewSpatialReference",void 0),u([d()],Gd.prototype,"tilingScheme",void 0),u([d()],Gd.prototype,"defaultTiledLayersExtent",void 0),u([d({constructOnly:!0})],Gd.prototype,"layers",void 0),u([d({constructOnly:!0})],Gd.prototype,"layerViews",void 0),Gd=u([$("esri.views.3d.terrain.ExtentHelper")],Gd);let iie=class extends Gd{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?sDe:s0t}};iie=u([$("esri.views.3d.terrain.ExtentHelperGlobal")],iie);let rie=class extends Gd{_computeLayerViewsExtent(){const e=od(),i=this.viewSpatialReference;this.layerViews.forEach(s=>{const o=s.layer;if(s.isResolved()&&(o.type!=="graphics"||!o.internal)){const a=cUe("fullExtentInLocalViewSpatialReference"in s&&s.fullExtentInLocalViewSpatialReference||s.layer.fullExtent,i);kb(e,a,e)}});const r=fZ(e)?e:null,n=this._get("layerViewsExtent");return $S(r,n)?n:r}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const i=this.viewSpatialReference,r=od();this.layers.forEach(o=>{if(o.loaded&&O$(o)){const a=j7(o,i,qe.Local);if(R(a))return;const{tileInfo:l,fullExtent:c}=a;v(l)&&v(c)&&(Yz(o)||e.compatibleWith(l)&&c.spatialReference.equals(e.spatialReference))&&kb(r,c,r)}}),kb(r,this.defaultTiledLayersExtent,r);const n=fZ(r)?r:null,s=this._get("tiledLayersExtent");return $S(n,s)?s:n}};function cUe(t,e){return v(t)&&!t.spatialReference.equals(e)?XAe(t,t.spatialReference,e):t}rie=u([$("esri.views.3d.terrain.ExtentHelperLocal")],rie);var vi;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.MAP=1]="MAP"})(vi||(vi={}));const FT=[vi.ELEVATION,vi.MAP];function uUe(){var e;const t=(e=globalThis.require)==null?void 0:e.modules;if(t){const i=Object.keys(t);for(const r of i)r.search(".glsl")!==-1&&delete t[r]}}const ZLt=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let Hv,Rc=class extends ve{get running(){return this._placementDirty&&(this._drapeSources.size>0||this._view.graphics.length>0||tr.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this._view.state.isGlobal}get _worldToPCSRatio(){return v(this._spatialReference)&&this._spatialReference.isGeographic&&!this._view.state.isLocal?sr(this._spatialReference).metersPerDegree:1}get _view(){return this.surface.view}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get hasHighlights(){return this.renderer.hasHighlights}get rendersOccluded(){return this.renderer.rendersOccluded}constructor(e){super(e),this._handles=new Xi,this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._hasUnusedRenderTargets=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=ue("esri-mobile")?2048:4096,this._animationTimeLast=0}initialize(){var i;const e=this._view;this.renderer=new Sf({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference}),this._groundIntersector=Fp(this._view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this._handles.add([this.renderer.events.on("has-highlights",()=>{this.setDrawTexturesDirty(),this.notifyChange("hasHighlights")}),this.renderer.events.on("has-water",r=>{var n;return(n=e._stage)==null?void 0:n.renderer.setParameters({hasOverlayWater:r})}),this.renderer.events.on("renders-occluded",()=>{this.setDrawTexturesDirty(),this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",()=>this.setDrawTexturesDirty()),this.renderer.events.on("textures-disposed",()=>this.updateOverlayResult()),ne(()=>{var r,n,s;return[(r=e.pointsOfInterest)==null?void 0:r.renderPointOfView,(s=(n=e.pointsOfInterest)==null?void 0:n.centerOnSurfaceFrequent)==null?void 0:s.location]},()=>this.setPlacementDirty()),ne(()=>{var r,n;return[(r=e.state)==null?void 0:r.pixelRatio,(n=e.state)==null?void 0:n.contentPixelRatio]},()=>this.setPlacementDirty(),Ki),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),e.resourceController.scheduler.registerTask(St.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",r=>{this._updateOverlays(ql,r,Wn.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays,Wn.BACKGROUND,r.pixelRatio)})]),(i=e._stage)==null||i.renderer.setParameters({renderOverlay:r=>{this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays&&(this._dispatchAnimationUpdate(r),this._drawOverlayTextures(this.renderer.overlays,Wn.UPDATE)),this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}})}destroy(){this._handles=Ve(this._handles),v(Hv)&&(Hv.hide(),Hv=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const i=this._view.renderSpatialReference;v(e)&&v(i)?(this._renderSR=i,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new nw(-20037508342787e-6,20037508342787e-6):new nw(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}get gpuMemoryUsage(){return this.renderer.gpuMemoryUsage}registerDrapeSource(e,i,r){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const n=this.renderer.createDrapeSourceRenderer(e,i,r);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),n}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,Rh)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&v(e.setDrapingExtent)&&v(this._spatialReference)&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}updateOverlayResult(){var e;(e=this._view._stage)==null||e.renderer.setParameters({overlays:this.renderer.overlays})}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(e){return this._updateOverlays(e,this._view.state.contentCamera,Wn.UPDATE)}_updateOverlays(e,i,r){if(!this._spatialReference)return Ga.YIELD;const n=this._computeOverlayResolution(i);this._computeOverlayExtents(i,n,Qy);const s=Wh(Qy.inner)/Wh(Qy.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const o=this._updateOverlay(mn.INNER,Qy.inner,n,1*Qy.pixelRatioAdjustment,Qy.mapUnitsPerPixel),a=this._updateOverlay(mn.OUTER,Qy.outer,n,s*Qy.pixelRatioAdjustment,Qy.mapUnitsPerPixel);o!==Mg.EXTENT&&a!==Mg.EXTENT||(this._drapeSources.forEach(l=>this._updateDrapeSourceExtent(l)),this.surface.updateTileOverlayParams(r)),o===Mg.NONE&&a===Mg.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1,e.madeProgress()}_computeOverlayResolution(e){const i=this._view.state.contentPixelRatio,r=e.fullWidth/e.pixelRatio*i,n=e.fullHeight/e.pixelRatio*i;return Math.min(vM(Math.max(r,n)+256),this._maxResolution)}_updateOverlay(e,i,r,n,s){if(this.renderer.overlays.length===0)return Mg.NONE;const o=this.renderer.overlays[e],a=o.mapUnitsPerPixel;if(o.mapUnitsPerPixel=s,o.pixelRatio=n,JLt(i,o.extent)&&r===o.resolution)return a===s?Mg.NONE:Mg.RERENDER_ONLY;A_(o.extent,i),o.resolution=r;const l=Fne(o.extent);return o.renderLocalOrigin=nL(l[0],l[1],0,"OV_"+this._latestOriginId++),Mg.EXTENT}setTileParameters(e){const i=e.renderData.overlay;if(this.renderer.overlays.length>0){const r=this.renderer.overlays[mn.INNER],n=this.renderer.overlays[mn.OUTER],s=e.extent;this._rectInsideRect(r.extent,s)||this._rectanglesOverlap(s,r.extent)||this._rectanglesOverlap(s,n.extent)?(this._setTileOverlayData(s,mn.INNER,i),this._setTileOverlayData(s,mn.OUTER,i)):(this._clearTileOverlayData(mn.INNER,i),this._clearTileOverlayData(mn.OUTER,i))}else this._clearTileOverlayData(mn.INNER,i),this._clearTileOverlayData(mn.OUTER,i)}overlayPixelSizeInMapUnits(e){if(this.renderer.overlays.length===0)return 0;const i=this.renderer.overlays[mn.INNER],r=this.renderer.overlays[mn.OUTER],n=this._pointIsInExtent(e,i.extent)?i:r;return(n.extent[2]-n.extent[0])/n.resolution}_setTileOverlayData(e,i,r){if(this.renderer.overlays.length===0)return;const n=this.renderer.overlays[i].extent,s=Wh(n),o=gm(n);let a=e[0];if(this._longitudeCyclical){a=this._longitudeCyclical.minimalMonotonic(n[0],a);const l=this._longitudeCyclical.minimalMonotonic(n[0],e[2]);a>l&&(a=l-(e[2]-e[0]))}r.setScale(i,Wh(e)/s,gm(e)/o),r.setOffset(i,(a-n[0])/s,(e[1]-n[1])/o)}_clearTileOverlayData(e,i){i.setScale(e,-1,-1),i.setOffset(e,-1,-1)}async reloadShaders(){uUe(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask(ql)}_dispatchAnimationUpdate(e){const i=e-this._animationTimeLast;if(i>=this.surface.view._stage.renderer.animationTimestep||v(this._view.state.forcedAnimationTime)||this._drawTexturesDirty||this._drawTexturesAnimateDirty){const r=i/this.surface.view._stage.renderer.animationTimeDilation,n=new S4e(this._view.state.camera,r,this._view.state.forcedAnimationTime);this.renderer.updateAnimation(n)&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e}}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0,this._view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(e,i,r,n){const s=this._view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,eDt,i,r);if(R(s))return!1;const o=s.origin,a=me(gk,s.origin,s.direction);return this._groundIntersector.reset(o,a,e),this._groundIntersector.intersect([]),this._view.basemapTerrain.intersect(this._groundIntersector,null,o,a),this._groundIntersector.results.min.getIntersectionPoint(n)}_findHorizonBasedPointOfInterest(e,i){let r=.5;const n=.55,s=this._view.renderCoordsHelper.getAltitude(e.eye),o=this._view.pointsOfInterest.centerOnSurfaceFrequent,a=1e-5,l=_e(o.estimatedSurfaceAltitude,e.aboveGround?-1/0:s+a,e.aboveGround?s-a:1/0),c=e.aboveGround;if(this._view.viewingMode==="global"){const h=gk;FO(BB(jB,sr(this._view.spatialReference).radius+l),cd(e.eye,e.viewForward),h),ge(h,h,e.eye);const p=sw.normalize(RLe(e.viewForward,h,e.viewRight))/e.fovY+.5,f=p<=0||p>=1?.5:n;r=c?f*p:p+f*(1-p)}else{const h=.5*Math.PI-Math.acos(-e.viewForward[2]),p=Math.tan(h),f=Zt(0,p,1,0),m=Jh(f,f,e.projectionMatrix)[1],g=_e(.5+.5*m,0,1);r=g===1||g===0?.5:c?g*n:1-(1-g)*n}return!!this._intersectGroundFromView(e,.5,r,i)&&Rne(i,e.eye)<o.distance*o.distance}_computeOverlayExtents(e,i,r){const n=this._view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s=P();this._findHorizonBasedPointOfInterest(e,s)||ce(s,n);const o=Math.max(.1,Lr(e.eye,s)),a=ww(this._view.renderCoordsHelper,n,e.eye),l=Math.PI/2-Math.abs(a-Math.PI/2);tr.OVERLAY_SHOW_CENTER?(R(Hv)&&(Hv=new TA(this._view.graphics,"red")),Hv.show(s,this._renderSR)):v(Hv)&&Hv.hide(),this._overlaySREqualsRenderSR||jo(s,this._renderSR,s,this._spatialReference);const c=this.surface.extent,h=!this._isSpherical&&v(this._spatialReference)&&this._spatialReference.isGeographic,p=h&&v(this._spatialReference)?1/sr(this._spatialReference).metersPerDegree:1,f=this._view.state.contentPixelRatio,m=e.perScreenPixelRatio/f*o*p;r.mapUnitsPerPixel=m/this._worldToPCSRatio;let g=i*m/2,_=!1,b=h?90:1/0;this._isSpherical&&v(c)&&v(this._spatialReference)&&(this._spatialReference.isWebMercator?(g/=Math.cos(J8(s[1])),b=c[3]):(_=!0,g/=sr(this._spatialReference).metersPerDegree,b=90),g>=b&&(g=b,s[1]=0,this._spatialReference.isWebMercator&&(s[0]=0)));let w=1;_&&(w=1/Math.max(.2,Math.cos(Math.abs(Xt(s[1])))),g*w>180&&(w=180/g),r.mapUnitsPerPixel*=w);const x=Math.log(2)/12;g=Math.exp(Math.round(Math.log(g)/x)*x);const T=g*w,E=32,C=.5*i/(E*T),A=.5*i/(E*g);s[0]=Math.round(s[0]*C)/C,s[1]=Math.round(s[1]*A)/A;const I=r.inner;I[0]=s[0]-T,I[1]=s[1]-g,I[2]=s[0]+T,I[3]=s[1]+g,this._isSpherical&&this._shiftExtentToFitBounds(I,1/0,b);const O=r.outer;if(6*T>Wh(c))A_(O,c);else if(l<=.25*Math.PI)O[0]=I[0]-T,O[1]=I[1]-g,O[2]=I[2]+T,O[3]=I[3]+g;else{jo(e.eye,this._renderSR,gk,this._spatialReference),Xh($x,s,gk);let U=-Math.atan2($x[1],$x[0])+.125*Math.PI;U<0&&(U+=2*Math.PI);const V=Math.floor(U/(.25*Math.PI));gO($x,ZLt[V],2*g),$x[0]*=w,$x[2]*=w,Mne(O,I,$x)}if(this._isSpherical)O[0]=this._longitudeCyclical.clamp(O[0]),O[2]=this._longitudeCyclical.clamp(O[2]),O[1]=Math.max(O[1],-b),O[3]=Math.min(O[3],b);else{const U=gZ(I,c,KLt),V=gZ(O,c,QLt);mZ(U,V)&&(O[2]=O[0],O[3]=O[1])}const D=Math.abs(I[2]-I[0])/i;r.mapUnitsPerPixel=Math.max(r.mapUnitsPerPixel,D),r.pixelRatioAdjustment=r.mapUnitsPerPixel/D}_drawOverlayTextures(e,i,r=this._view.state.contentPixelRatio){if(e.length===0||!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return;const n=this._drawTexturesDirty;this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1;const s=this._drawOverlay(e[mn.INNER],r),o=this._drawOverlay(e[mn.OUTER],r);s!==XM.CHANGED&&o!==XM.CHANGED||this.surface.updateTileOverlayParams(Wn.UPDATE),this._collectUnusedRenderTargetMemory(),this.updateOverlayResult(),n?(this.surface.requestRender(i),i===Wn.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(Wn.BACKGROUND)}_drawOverlay(e,i){return this._longitudeCyclical?e.setupGeometryViewsCyclical(this._longitudeCyclical):e.setupGeometryViewsDirect(),e.draw(this.renderer,i)}_collectUnusedRenderTargetMemory(){if(this._hasUnusedRenderTargets=!1,this.renderer.hasOverlays){const e=performance.now();this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory(e)}}_rectanglesOverlap(e,i){return!R(e)&&(this._longitudeCyclical?(this._longitudeCyclical.contains(i[0],i[2],e[0])||this._longitudeCyclical.contains(i[0],i[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],i[0]))&&!(e[1]>i[3]||e[3]<i[1]):W9(e,i))}_rectInsideRect(e,i){return!R(i)&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],i[0])&&this._longitudeCyclical.contains(e[0],e[2],i[2])&&i[1]>e[1]&&i[3]<e[3]:mZ(e,i))}_pointIsInExtent(e,i){if(this._longitudeCyclical)return this._longitudeCyclical.contains(i[0],i[2],e.x)&&e.y>=i[1]&&e.y<=i[3];const r=e.x,n=e.y;return r>i[0]&&r<i[2]&&n>i[1]&&n<i[3]}_shiftExtentToFitBounds(e,i,r){let n=0,s=0;e[0]<-i?n=e[0]+i:e[2]>i&&(n=i-e[2]),e[1]<-r?s=e[1]+r:e[3]>r&&(s=r-e[3]),oV(e,n,s)}get test(){return{renderer:this.renderer,update:()=>this.runTask(ql)}}};function JLt(t,e){const r=tr.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(t[2]-t[0],t[3]-t[1],e[2]-e[0],e[3]-e[1]);return Math.abs(e[0]-t[0])<=r&&Math.abs(e[1]-t[1])<=r&&Math.abs(e[2]-t[2])<=r&&Math.abs(e[3]-t[3])<=r}u([d()],Rc.prototype,"_spatialReference",void 0),u([d({readOnly:!0})],Rc.prototype,"running",null),u([d()],Rc.prototype,"_placementDirty",void 0),u([d()],Rc.prototype,"_contentUpdated",void 0),u([d()],Rc.prototype,"_isSpherical",null),u([d()],Rc.prototype,"_worldToPCSRatio",null),u([d({autoDestroy:!0})],Rc.prototype,"renderer",void 0),u([d({constructOnly:!0})],Rc.prototype,"surface",void 0),u([d()],Rc.prototype,"suspended",null),u([d()],Rc.prototype,"updating",null),u([d({type:Boolean})],Rc.prototype,"hasHighlights",null),u([d({type:Boolean})],Rc.prototype,"rendersOccluded",null),Rc=u([$("esri.views.3d.terrain.OverlayManager")],Rc);const $x=pi(),gk=P(),Qy={inner:Kt(),outer:Kt(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},KLt=Kt(),QLt=Kt(),eDt=ko();var Mg;(function(t){t[t.NONE=0]="NONE",t[t.EXTENT=1]="EXTENT",t[t.RERENDER_ONLY=2]="RERENDER_ONLY"})(Mg||(Mg={}));let hUe=class nie{constructor(e,i){this._factoryCallback=e,this._lengthCallback=i,this._pool=new Map}acquire(e){if(!nie.test.disabled){const i=this._pool.get(e);if(i&&i.length!==0)return i.pop()}try{return this._factoryCallback(e)}catch(i){const r=window.performance&&window.performance.memory;let n="";throw r&&(n=`
  totalJSHeapSize: ${r.totalJSHeapSize}, usedJSHeapSize: ${r.usedJSHeapSize}, jsHeapSizeLimit: ${r.jsHeapSizeLimit}`),console.log("Array allocation of size "+e+" failed: "+i+n),i}}release(e){if(nie.test.disabled)return;const i=this._lengthCallback(e);let r=this._pool.get(i);r||(r=new Wt({shrink:!0}),this._pool.set(i,r)),r.push(e)}clear(){this._pool.clear()}get test(){return{size:this._pool.size}}};hUe.test={disabled:!1};let tDt=class{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=Br(),this.indexCount=0,this.numVerticesPerSide=0,this.uvRange=[0,0,1,1],this.outerEdges=[null,null,null,null],this.innerEdges=[null,null,null,null]}},K1e=class{constructor(e,i,r,n,s){this.attributes=e,this.localOrigin=i,this.index0=r,this.stride=n,this.count=s}getVertexIndex(e){return this.getAttributeIndex(e)}getAttributeIndex(e){return Re(0<=e&&e<this.count),this.index0+this.stride*e}_getVertexRaw(e,i){this.attributes.position.getVec(e,i)}_getNormalRaw(e,i){this.attributes.normalCompressed.getVec(e,i)}getVertexPos(e,i){this._getVertexRaw(this.getAttributeIndex(i),e),me(e,e,this.localOrigin)}getNormal(e,i){const r=Fe();this._getNormalRaw(this.getAttributeIndex(i),r),sDt(e,r)}_setNormal(e,i,r,n){YD(this.attributes.normalCompressed,e,i,r,n)}_setUV(e,i,r){Zu(this.attributes.uv0,e,i,r)}setNormalFromValues(e,i,r,n){this._setNormal(this.getAttributeIndex(e),i,r,n)}setVertexFromValuesRawPositionUV(e,i,r,n,s,o){const a=this.getAttributeIndex(e);this.attributes.position.setValues(a,i,r,n),this._setUV(a,s,o)}setVertexFromValuesRawPositionUVNormal(e,i,r,n,s,o,a,l,c){const h=this.getAttributeIndex(e);this.attributes.position.setValues(h,i,r,n),this._setUV(h,s,o),this._setNormal(h,a,l,c)}};const iDt=_n().vec3f(M.POSITION).vec2i16(M.UV0).vec2i16(M.NORMALCOMPRESSED,{glNormalized:!0}),Oce=new hUe(t=>iDt.createBuffer(t),t=>t.count);function rDt(){Oce.clear()}function dUe(t){return Oce.acquire(t)}function nDt(t){Oce.release(t.vertexAttributes),t.vertexAttributes=null,t.indices=null}function YD(t,e,i,r,n){const s=1/(Math.abs(i)+Math.abs(r)+Math.abs(n)),o=i*s,a=r*s,l=n<=0?(o>=0?1:-1)*(1-Math.abs(a)):o,c=n<=0?(a>=0?1:-1)*(1-Math.abs(o)):a;t.setValues(e,ebe(l),ebe(c))}function sDt(t,e){const i=tbe(e[0]),r=tbe(e[1]),n=1-Math.abs(i)-Math.abs(r);t[2]=n,n<0?(t[0]=(i>=0?1:-1)*(1-Math.abs(r)),t[1]=(r>=0?1:-1)*(1-Math.abs(i))):(t[0]=i,t[1]=r),we(t,t)}const Q1e=16384;function Zu(t,e,i,r){t.setValues(e,i*Q1e,r*Q1e)}function ebe(t){return _e(Math.round(32767*t),-32767,32767)}function tbe(t){return _e(t/32767,-1,1)}function Jl(t,e,i,r){t<r[0]?r[0]=t:t>r[3]&&(r[3]=t),e<r[1]?r[1]=e:e>r[4]&&(r[4]=e),i<r[2]?r[2]=i:i>r[5]&&(r[5]=i)}let oDt=class{constructor(){this.sinLonLUT=new Array(AI+1),this.cosLonLUT=new Array(AI+1),this.sinLatLUT=new Array(AI+1),this.cosLatLUT=new Array(AI+1)}update(e,i,r){const n=i[0],s=i[2];for(let o=0;o<=e;o++){const a=o/e,l=n*(1-a)+s*a;this.sinLonLUT[o]=Math.sin(l),this.cosLonLUT[o]=Math.cos(l);const c=r(a);this.sinLatLUT[o]=Math.sin(c),this.cosLatLUT[o]=Math.cos(c)}}},yk=class{constructor(){this.cornerTiles=[null,null,null,null],this.cornerTileSamplerVersions=[-1,-1,-1,-1]}},aDt=class{constructor(){this.cornerNeighborData=[new yk,new yk,new yk,new yk],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1],this.cornerPeerNeighbors=[null,null,null,null]}},lDt=class{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.clippingArea=null,this.wireframe=!1,this.shading=!1,this.samplerDataVersion=0,this.neighborData=new aDt}},pUe=class XU{constructor(e){this._getFadeDuration=e,this._fadeStart=0,this._delayedTime=0}clear(){this._current=Ve(this._current),this._next=Ve(this._next),this._waiting=Ve(this._waiting),this._delayed=Ve(this._delayed)}get current(){if(R(this._current))return null;if(!this._isFadingEnabled){const i=this._delayed||this._waiting||this._next||this._current;i!==this._current&&(this._current=null,this.clear(),this._current=i)}let e=XU.test.fadeMoment;if(v(this._delayed)&&(e=e||performance.now(),e>=this._delayedTime&&(this._push(this._delayed,m_.Immediate),this._delayed=null)),v(this._next)){e=e||performance.now();const i=this._fadeDuration,r=v(this._current)&&this._next.texture===this._current.texture,n=this._next.type!==qs.FADING,s=e-this._fadeStart>=i;(r||n||s)&&(Ve(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(e))}return this._current}get next(){return this._next}get fadeFactor(){if(R(this._next))return 1;const e=XU.test.fadeMoment||performance.now(),i=Math.max(0,e-this._fadeStart),r=this._fadeDuration;return i>r?0:1-i/r}get isFading(){return v(this._next)||v(this._delayed)}push(e,i=m_.Immediate){this._delayed=Ve(this._delayed),this._push(e,i)}_push(e,i){if(this._isFadingEnabled||this.clear(),R(this._current))return void(this._current=e);const r=XU.test.fadeMoment||performance.now();return i!==m_.Immediate?(this._delayed=e,void(this._delayedTime=r+i)):R(this._next)?(this._next=e,void(this._fadeStart=this._alignFadeStart(r))):void(R(e)||(Ve(this._waiting),this._waiting=e))}get _fadeDuration(){return R(this._waiting)?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(e){const i=this._getFadeDuration();return e+i-e%i}get _isFadingEnabled(){return this._getFadeDuration()>0}};var m_;pUe.test={fadeMoment:0},function(t){t[t.Immediate=0]="Immediate",t[t.Delayed=5e3]="Delayed"}(m_||(m_={}));var sO;(function(t){t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT",t[t.NONE=0]="NONE",t[t.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(sO||(sO={}));let fUe=class{constructor(){this._queue=new Wt,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(e){this._queue.clear(),this._queue.push(e),this._last=void 0}reset(e=null){this._queue.clear(),v(e)&&this._queue.pushArray(e),this._last=void 0}skipSubtree(){this._last=void 0}next(){var i;const e=(i=this._last)==null?void 0:i.children;return e&&e[0]&&this._queue.pushArray(e),this._last=this._queue.pop(),this._last}},cDt=class{constructor(){this._q=new Wt}get done(){return this._q.length===0}reset(e){if(this._q.clear(),!R(e)){this._q.pushArray(e);for(let i=0;i<this._q.length;++i){const r=this._q.data[i];r.isLeaf||this._q.pushArray(r.children)}}}next(){return this._q.pop()}};function hL(t,e,i){if(R(e)||R(e.fullExtent))return!1;const r=e.fullExtent,n=t.extent;if(i){if(n[0]<r.xmin||n[1]<r.ymin||n[2]>r.xmax||n[3]>r.ymax)return!1}else if(r.xmin>n[2]||r.ymin>n[3]||r.xmax<n[0]||r.ymax<n[1])return!1;const s=t.surface.tilingScheme.levels[t.level].scale,o=e.minScale;if(o>0&&s>1.00000001*o)return!1;const a=e.maxScale;return!(a>0&&s<.99999999*a)}function g_(t,e){const i=t.lij,r=e.lij;return i[0]-r[0]||i[1]-r[1]||i[2]-r[2]}function mUe(t,e,i=null){R(i)||i.length===0?t===sO.BACK_TO_FRONT?e.sort(uDt):e.sort(hDt):e.sort((r,n)=>dDt(r,n,t,i))}function uDt(t,e){const i=e.screenDepth-t.screenDepth;if(i!==0)return i;const r=t.lij,n=e.lij;return r[0]-n[0]||r[1]-n[1]||r[2]-n[2]}function hDt(t,e){const i=t.screenDepth-e.screenDepth;if(i!==0)return i;const r=t.lij,n=e.lij;return r[0]-n[0]||r[1]-n[1]||r[2]-n[2]}function gUe(t,e,i){const r=t.screenDepth,n=e.screenDepth;return r<n?-i:r>n?i:g_(t,e)}function dDt(t,e,i,r){return ibe(t,r)===ibe(e,r)?gUe(t,e,i):t?i:-i}function ibe(t,e){for(const i of e)if(t.intersectsExtent(i))return!0;return!1}function pDt(t,e){const i=t.distanceToPOI-e.distanceToPOI;if(i!==0)return i;const r=t.lij,n=e.lij;return r[0]-n[0]||r[1]-n[1]||r[2]-n[2]}function fDt(t,e){const i=t.length;for(let r=0;r<i;++r)t.getItemAt(r).updateDistanceToPOI(e);t.sort(pDt)}function mDt(t,e,i){let r=1,n=0,s=0;for(;t!==e;)if(r*=.5,n*=.5,s*=.5,1&t.lij[2]&&(n+=.5),!(1&t.lij[1])&&(s+=.5),(t=t.parent)==null)throw new Error("tile was not a descendant of upsampleTile");i.init(e,n,s,r)}function gDt(t){for(let e=0;e<t.length;e++){const i=t[e],r=i.parent;if(r)for(let n=0;n<4;n++){const s=r.children[n];if(s&&s!==i)return!0}}return!1}function Pei(t,e){if(!t||!e||t[0]===e[0])return!1;const i=t[0]<e[0],r=i?t:e,n=i?e:t,s=1<<n[0]-r[0];return Math.floor(n[1]/s)===r[1]&&Math.floor(n[2]/s)===r[2]}let Pce=class{get updating(){return!!this._tileRequested}init(e,i,r,n){this.tile=e,this._layerIdx=i,this._layerClass=r,this._suspended=n,this._tileLayerInfo=e.getLayerInfo(i,r),this._tileRequested=null;const s=this._findAncestorWithData();this._setUpsampleTile(s)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(e){e!==this._suspended&&(this._suspended=e,e?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const e=this._findAncestorWithData();return this._setUpsampleTile(e),this._requestNext()}dataArrived(e){this._setUpsampleTile(e),this._tileRequested=null,e===this.tile?this.tile.updateRenderData(this._layerClass,qs.FADING):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return v(e)?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone(),!!this._tileRequested}_findNextDownload(){const e=this._layerIdx,i=this._layerClass,r=this.tile.surface.layerViewByIndex(e,i),n=Kte(r),{minLevel:s,maxLevel:o}=r.dataLevelRange,a=this._desiredMinLevelDelta,l=this._progressiveLevelModulo+a,c=this._scaleRangeEnabled?hL:()=>!0;let h=this.tile;const p=h.level;let f;const m=this._tileLayerInfo.upsampleInfo,g=v(m)?m.tile.level:-1,_=!!v(m)&&g-p>=a,b=Js(n,"tilemapCache");for(;h&&c(h,n,!1)&&h.level>=s;){const w=h.level,x=p-w,T=h.layerInfo[i][e];if(T.data&&x>=a){(!_||w>g)&&this._setUpsampleTile(h),T.dataInvalidated&&(f=h);break}if((R(b)||b.getAvailability(h.lij[0],h.lij[1],h.lij[2])!=="unavailable")&&w<=o&&!T.data&&!T.dataMissing&&((R(f)||h.level===s||w%nDe==0||p-f.level<a)&&(f=h),x>=l))break;h=h.parent}return v(f)&&p-f.level<a&&this._tileLayerInfo.upsampleInfo&&(f=null),f}_findAncestorWithData(){const e=this.tile.vlevel,i=this._desiredMinLevelDelta;let r;for(let n=this.tile;n;n=n.parent)if(n.hasLayerData(this._layerIdx,this._layerClass)){if(e-n.level>=i)return n;r=n}return r}_setUpsampleTile(e){this._tileLayerInfo.setUpsampleInfo(this.tile,e),this.tile.updateRenderData(this._layerClass,qs.FADING)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}},yDt=class extends Pce{get _desiredMinLevelDelta(){throw rbe}get _progressiveLevelModulo(){throw rbe}dispose(){}};const rbe=new Error("Abstract method called on TileAgent"),lu=new yDt;let yUe=class extends Pce{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return XQ(this.tile.level)-(this.tile.vlevel-this.tile.level)}get _progressiveLevelModulo(){return 0}},_Ue=class extends Pce{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return nDe}};var WS,$2;(function(t){t[t.Stretch=0]="Stretch",t[t.Lut=1]="Lut",t[t.Hillshade=2]="Hillshade",t[t.COUNT=3]="COUNT"})(WS||(WS={})),function(t){t[t.Noop=0]="Noop",t[t.PerBand=1]="PerBand",t[t.COUNT=2]="COUNT"}($2||($2={}));function _Dt(t,e){t.fragment.uniforms.add([new Dt("u_colormap",i=>i.u_colormap),new Ie("u_colormapOffset",i=>i.colormap.u_colormapOffset),new Ie("u_colormapMaxIndex",i=>i.colormap.u_colormapMaxIndex),new Ie("u_opacity",i=>i.common.u_opacity)]),t.fragment.code.add(S`
    vec4 colormap(vec4 currentPixel, bool isFloat) {
      float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
      vec4 result;
      // handle no data and out of range pixels
      if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
        result = vec4(0.0, 0.0, 0.0, 0.0);
      } else {
        // colormap lookup
        vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
        result = ${Zl(e,"u_colormap","texelCoordinates","(1.0 / vec2(u_colormapMaxIndex + 1.0, 1.0))")};
      }
      return result;
    }
  `)}function vDt(t,e){t.fragment.uniforms.add(cm("u_transformGrid",i=>i.u_transformGrid,e.hasWebGL2Context?lr.None:lr.InvSize)),t.fragment.uniforms.add(new Wi("u_transformSpacing",i=>i.common.u_transformSpacing)),t.fragment.uniforms.add(new Wi("u_targetImageSize",i=>i.common.u_targetImageSize)),t.fragment.code.add(S`
    vec2 projectPixelLocation(vec2 coords) {
      // Pixel index in row/column, corresponds to upperleft corner, e.g. [100, 20]
      vec2 index_image = floor(coords * u_targetImageSize);

      // Pixel's corresponding cell index in transform grid
      // Each transform cell corresponds to 4 pixels: 6 coefficients from lowerleft triangle followed by 6 coefficients from upperright triangle
      vec2 oneTransformPixel = vec2(4.0, 1.0);
      vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;

      // Correspoding position in transform grid cell, cell center coordinates
      vec2 pos = fract((index_image + 0.5) / u_transformSpacing);

      // Pixel's corresponding transform cell location, cell center coordinates
      vec2 transform_location = index_transform + 0.5;

      vec2 srcLocation;

      // Use lower triangle or upper triangle
      if (pos.s <= pos.t) {
        vec3 ll_abc = ${Zl(e,"u_transformGrid","transform_location")}.rgb;
        vec3 ll_def = ${Zl(e,"u_transformGrid","vec2(transform_location.s + 1.0, transform_location.t)")}.rgb;
        srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
        srcLocation.t = dot(ll_def, vec3(pos, 1.0));
      } else {
        vec3 ur_abc = ${Zl(e,"u_transformGrid","vec2(transform_location.s + 2.0, transform_location.t)")}.rgb;
        vec3 ur_def = ${Zl(e,"u_transformGrid","vec2(transform_location.s + 3.0, transform_location.t)")}.rgb;
        srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
        srcLocation.t = dot(ur_def, vec3(pos, 1.0));
      }

      return srcLocation;
    }
  `)}let vUe=class extends Tr{constructor(){super(...arguments),this.scale=1,this.offset=Jc}};function bUe(t){t.attributes.add(M.POSITION,"vec2"),t.attributes.add(M.UV0,"vec2"),t.vertex.uniforms.add(new Ie("scale",e=>e.scale)),t.vertex.uniforms.add(new Wi("offset",e=>e.offset)),t.varyings.add("uv","vec2"),t.varyings.add("vuv","vec2"),t.vertex.code.add(S`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}let bDt=class extends vUe{constructor(e,i,r){super(),this.common=e,this.u_image=i,this.u_transformGrid=r}};function wDt(t,e){t.include(vDt,e),t.fragment.uniforms.add([new Dt("u_image",i=>i.u_image),new h_("u_flipY",i=>i.common.u_flipY),new h_("u_applyTransform",i=>i.common.u_applyTransform)]),t.fragment.code.add(S`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}
vec4 getPixel(vec2 pixelLocation) {
return texture2D(u_image, pixelLocation);
}`)}var Be;(function(t){t[t.Normal=0]="Normal",t[t.Average=1]="Average",t[t.Lighten=2]="Lighten",t[t.Lighter=3]="Lighter",t[t.Plus=4]="Plus",t[t.Screen=5]="Screen",t[t.ColorDodge=6]="ColorDodge",t[t.Darken=7]="Darken",t[t.Multiply=8]="Multiply",t[t.ColorBurn=9]="ColorBurn",t[t.Overlay=10]="Overlay",t[t.SoftLight=11]="SoftLight",t[t.HardLight=12]="HardLight",t[t.VividLight=13]="VividLight",t[t.Hue=14]="Hue",t[t.Saturation=15]="Saturation",t[t.Luminosity=16]="Luminosity",t[t.Color=17]="Color",t[t.DestinationOver=18]="DestinationOver",t[t.DestinationAtop=19]="DestinationAtop",t[t.DestinationIn=20]="DestinationIn",t[t.DestinationOut=21]="DestinationOut",t[t.SourceAtop=22]="SourceAtop",t[t.SourceIn=23]="SourceIn",t[t.SourceOut=24]="SourceOut",t[t.Xor=25]="Xor",t[t.Difference=26]="Difference",t[t.Exclusion=27]="Exclusion",t[t.Minus=28]="Minus",t[t.Invert=29]="Invert",t[t.Reflect=30]="Reflect",t[t.COUNT=31]="COUNT"})(Be||(Be={}));const sie={normal:Be.Normal,average:Be.Average,lighten:Be.Lighten,lighter:Be.Lighter,screen:Be.Screen,plus:Be.Plus,"color-dodge":Be.ColorDodge,darken:Be.Darken,multiply:Be.Multiply,"color-burn":Be.ColorBurn,overlay:Be.Overlay,"soft-light":Be.SoftLight,"hard-light":Be.HardLight,"vivid-light":Be.VividLight,hue:Be.Hue,saturation:Be.Saturation,luminosity:Be.Luminosity,color:Be.Color,difference:Be.Difference,exclusion:Be.Exclusion,minus:Be.Minus,invert:Be.Invert,reflect:Be.Reflect,"destination-over":Be.DestinationOver,"destination-atop":Be.DestinationAtop,"destination-in":Be.DestinationIn,"destination-out":Be.DestinationOut,"source-atop":Be.SourceAtop,"source-in":Be.SourceIn,"source-out":Be.SourceOut,xor:Be.Xor};function xDt(t){return t===Be.DestinationOver||t===Be.DestinationAtop||t===Be.DestinationIn||t===Be.DestinationOut||t===Be.SourceAtop||t===Be.SourceIn||t===Be.SourceOut||t===Be.Xor}function Ice(t){t.code.add(S`
    float lineFactorAtPosition(float value) {
      float pos = value * ${S.float(257)};
      if(pos < 0.5 || pos > ${S.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)}function TDt(t,e){const i=e.blendMode;i!==Be.Normal&&(i===Be.Reflect&&t.code.add(S`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),i!==Be.ColorDodge&&i!==Be.VividLight||t.code.add(S`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),i!==Be.ColorBurn&&i!==Be.VividLight||t.code.add(S`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),i===Be.Overlay&&t.code.add(S`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),i===Be.HardLight&&t.code.add(S`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),i===Be.SoftLight&&t.code.add(S`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),i===Be.VividLight&&t.code.add(S`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),i!==Be.Hue&&i!==Be.Saturation&&i!==Be.Color&&i!==Be.Luminosity||(t.code.add(S`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),i!==Be.Hue&&i!==Be.Saturation||t.code.add(S`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),t.code.add(S`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${i===Be.Multiply?S`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Be.Average?S`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Be.Lighten?S`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Be.Darken?S`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Be.Lighter?S`return vec4(cl * ol + cb * ob, ol + ob);`:i===Be.Plus?S`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:i===Be.Minus?S`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:i===Be.Screen?S`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Be.Difference?S`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Be.Invert?S`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:i===Be.DestinationOver?S`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:i===Be.DestinationAtop?S`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:i===Be.DestinationOut?S`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:i===Be.SourceAtop?S`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:i===Be.SourceOut?S`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:i===Be.Xor?S`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:i===Be.DestinationIn?S`return vec4(cb * ob * ol, ol * ob);`:i===Be.SourceIn?S`return vec4(cl * ol * ob, ol * ob);`:i===Be.Hue?S`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Be.Saturation?S`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Be.Color?S`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Be.Luminosity?S`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Be.Exclusion?S`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Be.Reflect?S`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Be.ColorDodge?S`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Be.ColorBurn?S`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Be.Overlay?S`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Be.SoftLight?S`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Be.HardLight?S`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Be.VividLight?S`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:S``}
    }
  `))}var uo,rm,zf;(function(t){t[t.Composite=0]="Composite",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.GroupBackgroundComposite=3]="GroupBackgroundComposite",t[t.COUNT=4]="COUNT"})(uo||(uo={})),function(t){t[t.NotRequired=0]="NotRequired",t[t.Required=1]="Required",t[t.COUNT=2]="COUNT"}(rm||(rm={})),function(t){t[t.Off=0]="Off",t[t.On=1]="On",t[t.COUNT=2]="COUNT"}(zf||(zf={}));function wUe(t,e){const i=e.output===uo.GridComposite,r=e.output===uo.ColorComposite,n=e.output===uo.GroupBackgroundComposite,s=e.output===uo.Composite;i&&(t.extensions.add("GL_OES_standard_derivatives"),t.fragment.include(Ice)),r&&t.fragment.uniforms.add(new Jt("backgroundColor",c=>c.backgroundColor));const o=e.baseOpacityMode===rm.Required;if(o&&t.fragment.uniforms.add(new Ie("baseOpacity",c=>c.baseOpacity)),s){const c=e.hasWebGL2Context?lr.None:lr.InvSize;t.fragment.uniforms.add(cm("fboColor",h=>h.fboTexture,c))}const a=e.blendMode!==Be.Normal,l=e.premultipliedSource===zf.On;t.fragment.include(TDt,e),t.fragment.code.add(S`
    vec4 getBackground(vec2 uv) {
      return ${o?S`baseOpacity *`:""} ${n?S`vec4(0.0, 0.0, 0.0, 0.0)`:r?S`vec4(backgroundColor, 1.0)`:i?S`vec4(gridColor(uv), 1.0)`:S`${Zl(e,"fboColor","gl_FragCoord.xy")}`};
    }

    vec4 blendLayers(vec4 bgColor, vec4 colorLayer, float opacity) {
      ${a?S`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:S`
          float composeAlpha = colorLayer.a * opacity;
          return ${!l&&(s&&!o||n)?S`colorLayer * opacity;`:S`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)}let H7=class extends bDt{constructor(e,i,r,n,s,o){super(e,n,s),this.colormap=i,this.symbolizer=r,this.u_colormap=o,this.backgroundColor=dl,this.fboTexture=null,this.baseOpacity=1}},SDt=class extends H7{},EDt=class extends H7{};function CDt(t){const e=new ji;return e.include(bUe),e.include(wDt,t),e.include(_Dt,t),e.include(wUe,t),e.fragment.code.add(S`vec4 applyBackgroundBlend(vec4 layerColor) {
vec4 bgColor = getBackground(vuv);
return blendLayers(bgColor, layerColor, u_opacity);
}`),t.colorizerType===WS.Stretch?RDt(e,t):t.colorizerType===WS.Lut?ADt(e):t.colorizerType===WS.Hillshade&&MDt(e,t),e}function ADt(t){t.fragment.code.add(S`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
gl_FragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}function RDt(t,e){t.fragment.uniforms.add([new oF("u_bandCount",r=>r.symbolizer.u_bandCount),new cl("u_minCutOff",r=>r.symbolizer.u_minCutOff,3),new cl("u_maxCutOff",r=>r.symbolizer.u_maxCutOff,3),new cl("u_factor",r=>r.symbolizer.u_factor,3),new Ie("u_minOutput",r=>r.symbolizer.u_minOutput),new Ie("u_maxOutput",r=>r.symbolizer.u_maxOutput),new h_("u_useGamma",r=>r.symbolizer.u_useGamma),new cl("u_gamma",r=>r.symbolizer.u_gamma,3),new cl("u_gammaCorrection",r=>r.symbolizer.u_gammaCorrection,3),new Ie("u_opacity",r=>r.common.u_opacity)]),t.fragment.code.add(S`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const i=e.applyColormap?S`gl_FragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:S`gl_FragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;t.fragment.code.add(S`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${e.stretchType===$2.Noop?S`
        gl_FragColor = applyBackgroundBlend(currentPixel);`:S`
        if (currentPixel.a == 0.0) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${i}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          gl_FragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function MDt(t,e){const i=t.fragment;i.uniforms.add([new Dt("u_image",n=>n.u_image),new oF("u_hillshadeType",n=>n.symbolizer.u_hillshadeType),new cl("u_sinZcosAs",n=>n.symbolizer.u_sinZcosAs,6),new cl("u_sinZsinAs",n=>n.symbolizer.u_sinZsinAs,6),new cl("u_cosZs",n=>n.symbolizer.u_cosZs,6),new cl("u_weights",n=>n.symbolizer.u_weights,6),new Wi("u_factor",n=>n.symbolizer.u_factor),new Ie("u_minValue",n=>n.symbolizer.u_minValue),new Ie("u_maxValue",n=>n.symbolizer.u_maxValue),new Wi("u_srcImageSize",n=>n.common.u_srcImageSize)]),i.include(Cy),i.code.add(S`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`),i.code.add(S`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const r=e.applyColormap?S`gl_FragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:S`hillshade *= alpha;
gl_FragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;i.code.add(S`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture2D(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture2D(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture2D(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture2D(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture2D(u_image, pixelLocation);
      vec4 vf = texture2D(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture2D(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture2D(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture2D(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${r}
    }
  `)}const ODt=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:EDt,ColorizerStretchUniforms:SDt,ColorizerUniforms:H7,build:CDt},Symbol.toStringTag,{value:"Module"}));function PDt(t,e,i="nearest",r=!1){var c;const n=!(r&&e.pixelType==="u8"),s=n?kt.FLOAT:kt.UNSIGNED_BYTE,o=e.pixels==null||e.pixels.length===0?null:n?e.getAsRGBAFloat():e.getAsRGBA(),a=(c=t.capabilities.textureFloat)==null?void 0:c.textureFloatLinear,l={width:e.width,height:e.height,target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,internalFormat:t.type===Et.WEBGL2&&n?Mt.RGBA32F:Ge.RGBA,samplingMode:!a||i!=="bilinear"&&i!=="cubic"?nt.NEAREST:nt.LINEAR,dataType:s,wrapMode:$t.CLAMP_TO_EDGE,flipped:!1};return new mt(t,l,o)}function IDt(t,e){const{spacing:i,offsets:r,coefficients:n,size:[s,o]}=e,a=i[0]>1,l={width:a?4*s:s,height:o,target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,internalFormat:t.type===Et.WEBGL2?Mt.RGBA32F:Ge.RGBA,dataType:kt.FLOAT,samplingMode:nt.NEAREST,wrapMode:$t.CLAMP_TO_EDGE,flipped:!1},c=new Float32Array(a?s*o*16:2*r.length);if(a&&n!=null)for(let h=0,p=0;h<n.length;h++)c[p++]=n[h],h%3==2&&(c[p++]=1);else for(let h=0;h<o;h++)for(let p=0;p<s;p++){const f=4*(h*s+p),m=2*(p*o+h);c[f]=r[m],c[f+1]=r[m+1],c[f+3]=r[m]===-1?0:1}return new mt(t,l,c)}function nbe(t,e){const i={width:e.length/4,height:1,target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,internalFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:nt.NEAREST,wrapMode:$t.CLAMP_TO_EDGE,flipped:!1};return new mt(t,i,e)}function $Dt(t,e,i,r=1,n=!0){return{u_flipY:n,u_applyTransform:!!t,u_opacity:r,u_transformSpacing:t?t.spacing:Jc,u_transformGridSize:t?t.size:Jc,u_targetImageSize:e,u_srcImageSize:i}}function LDt(t,e){return{u_colormapOffset:e||0,u_colormapMaxIndex:t?t.length/4-1:0}}function zei(t,e){return{u_scale:t,u_offset:e}}function DDt(t){return{u_bandCount:t.bandCount,u_minOutput:t.outMin,u_maxOutput:t.outMax,u_minCutOff:t.minCutOff,u_maxCutOff:t.maxCutOff,u_factor:t.factor,u_useGamma:t.useGamma,u_gamma:t.gamma,u_gammaCorrection:t.gammaCorrection}}function NDt(t){return{u_hillshadeType:t.hillshadeType,u_sinZcosAs:t.sinZcosAs,u_sinZsinAs:t.sinZsinAs,u_cosZs:t.cosZs,u_weights:t.weights,u_factor:t.factor,u_minValue:t.minValue,u_maxValue:t.maxValue}}function Bei(t,e){const i=t.gl,r=e.glName,n=new Map;if(R(r))return n;const s=i.getProgramParameter(r,i.ACTIVE_UNIFORMS);let o;for(let a=0;a<s;a++)o=i.getActiveUniform(r,a),o&&n.set(o.name,{location:i.getUniformLocation(r,o.name),info:o});return n}function jei(t,e,i){Object.keys(i).forEach(r=>{const n=e.get(r)||e.get(r+"[0]");n&&FDt(t,r,i[r],n)})}function Gei(t,e,i,r){i.length===r.length&&(r.some(n=>n==null)||i.some(n=>n==null)||i.forEach((n,s)=>{e.setUniform1i(n,s),t.bindTexture(r[s],s)}))}function FDt(t,e,i,r){if(r===null||i==null)return!1;const{info:n}=r;switch(n.type){case Ul.FLOAT:n.size>1?t.setUniform1fv(e,i):t.setUniform1f(e,i);break;case Ul.FLOAT_VEC2:t.setUniform2fv(e,i);break;case Ul.FLOAT_VEC3:t.setUniform3fv(e,i);break;case Ul.FLOAT_VEC4:t.setUniform4fv(e,i);break;case Ul.FLOAT_MAT3:t.setUniformMatrix3fv(e,i);break;case Ul.FLOAT_MAT4:t.setUniformMatrix4fv(e,i);break;case Ul.INT:n.size>1?t.setUniform1iv(e,i):t.setUniform1i(e,i);break;case Ul.BOOL:t.setUniform1i(e,i?1:0);break;case Ul.INT_VEC2:case Ul.BOOL_VEC2:t.setUniform2iv(e,i);break;case Ul.INT_VEC3:case Ul.BOOL_VEC3:t.setUniform3iv(e,i);break;case Ul.INT_VEC4:case Ul.BOOL_VEC4:t.setUniform4iv(e,i);break;default:return!1}return!0}const sbe={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};let kDt=class{constructor(e,i,r=null,n=null){this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.opacity=1,this.lij=e,this.source=i,this.width=r||i.width,this.height=n||i.height}get source(){return this._source}set source(e){this._source=e,this._rasterTexture=rt(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?{...sbe,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||sbe}set symbolizerParameters(e){this._symbolizerParameters=e}get bandIds(){return this._bandIds}set bandIds(e){v(e)&&e.length>0?this._bandIds&&e.every((i,r)=>{var n;return!!((n=this._bandIds)!=null&&n[r])&&i===this._bandIds[r]})||(this._bandIds=e,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(e){if(this._interpolation=e,v(this._rasterTexture)){const i=this._getRasterTextureInterpolation(e);this._rasterTexture.setSamplingMode(i==="bilinear"?nt.LINEAR:nt.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(e){this._transformGrid=e,this._transformGridTexture=rt(this._transformGridTexture),this._memoryUsed=null}bind(e){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&((R(this._rasterTexture)||this._dirty)&&this._updateRasterTexture(e,this.bandIds),v(this._rasterTexture)&&(this._updateColormapTexture(e),this.transformGrid&&R(this._transformGridTexture)&&(this._transformGridTexture=IDt(e,this.transformGrid))),!0)}getUniforms(){const{symbolizerParameters:e,transformGrid:i,width:r,height:n,opacity:s}=this,o=$Dt(i,[r,n],[this.source.width,this.source.height],s),a=LDt(e.colormap,e.colormapOffset),l=this.symbolizerParameters.type==="stretch"?DDt(this.symbolizerParameters):null,c=this.symbolizerParameters.type==="hillshade"?NDt(this.symbolizerParameters):null;return new H7(o,a,l||c,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get memoryUsage(){if(R(this._memoryUsed)){const e=[this._rasterTexture,this._transformGridTexture,this._colormapTexture];this._memoryUsed=e.map(i=>v(i)?i.descriptor.width*i.descriptor.height*4:0).reduce((i,r)=>i+r,0)}return this._memoryUsed}release(){return this._rasterTexture=rt(this._rasterTexture),this._transformGridTexture=rt(this._transformGridTexture),this._colormapTexture=rt(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(e,i){const r=this.source?this.source.extractBands(i):null;if(!(r&&r.pixels&&r.pixels.length>0))return void(this._rasterTexture=rt(this._rasterTexture));const n=R(i)&&R(this.bandIds)||v(i)&&v(this.bandIds)&&i.join("")===this.bandIds.join("");if(v(this._rasterTexture)&&n)return;this._rasterTexture=rt(this._rasterTexture);const s=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=PDt(e,r,s,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&this.symbolizerParameters.stretchType==="none"&&!this.symbolizerParameters.useGamma&&this.source.pixelType==="u8"}_getRasterTextureInterpolation(e){return this.symbolizerParameters.type==="lut"||e==="nearest"||e==="majority"?"nearest":"bilinear"}_updateColormapTexture(e){const i=this._colormap,r=this.symbolizerParameters.colormap;return r?i?r.length!==i.length||r.some((n,s)=>n!==i[s])?(this._colormapTexture=rt(this._colormapTexture),this._colormapTexture=nbe(e,r),void(this._colormap=r)):void 0:(this._colormapTexture=nbe(e,r),void(this._colormap=r)):(this._colormapTexture=rt(this._colormapTexture),void(this._colormap=null))}},YU=class{constructor(){this.waitingAgents=new Wt,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(e){const i=OW.acquire();return i._init(e),i}release(){this.dispose(),ZU.delete(this),OW.release(this)}dispose(){this.loadingAgent=rt(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=JR(this._data)}static prune(){OW.prune(0)}_init(e){this.waitingAgents.clear(),this._data=JR(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=e,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=Mp(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){v(this._upsampleInfo)&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(e,i){if(e===i||R(i))this._unsetUpsampleInfo();else{if(R(this._upsampleInfo))this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===i)return;this._upsampleInfo.tile.unrefMapData()}i.refMapData(),mDt(e,i,this._upsampleInfo)}}get data(){return this._data}set data(e){JR(this._data),this._data=e}};const OW=new zo(YU,null,()=>{}),ZU=new Map;function UDt(){ZU.size>0&&(console.log(`${ZU.size} live TilePerLayerInfo allocations:`),ZU.forEach(t=>console.log(t,`
`)))}let SA=class{constructor(e){this._texture=e,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){--this._refCount,this._refCount===0&&this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}};var Ot;(function(t){t[t.NONE=0]="NONE",t[t.NONE_HIT_MAXLOD=1]="NONE_HIT_MAXLOD",t[t.SPLIT=2]="SPLIT",t[t.VSPLITMERGE=4]="VSPLITMERGE",t[t.MERGE=8]="MERGE",t[t.RENDERDATA=16]="RENDERDATA",t[t.GEOMETRY=32]="GEOMETRY",t[t.TEXTURE_NOFADING=64]="TEXTURE_NOFADING",t[t.TEXTURE_FADING=128]="TEXTURE_FADING"})(Ot||(Ot={}));const PW=P(),rC=P(),Xo=P(),VDt=.1;let $ce=class{constructor(){this.lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this.renderData=null,this._dirty=!0,this._previouslyRendered=!1,this.extent=Kt(),this._elevationBounds=Fe(),this.layerInfo=[[],[]],this.extentInRadians=Kt(),this.centerAtSeaLevel=P(),this._center=[P(),Is(),P()],this.up=Cne(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemoryInternal=0,this._mapDataRefCount=0,this.screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.extentMidX=0,this.extentMidY=0,this.distanceToPOI=-1,this._lastPOI=P()}static prune(){Lce.prune(0),Dce.prune(0),YU.prune()}get _isCached(){return!this.shouldLoad&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get key(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[bs.MIDDLE][3]}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){var r;this._dirty=!1;const e=((r=this.parent)==null?void 0:r.frustumVisibility)??nl.INTERSECTS;this._frustumVisibility=e===nl.INSIDE?nl.INSIDE:e===nl.OUTSIDE?nl.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);const i=this._frustumVisibility!==nl.OUTSIDE&&this._intersectsClippingArea;i!==this._visible&&(this._visible=i,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const e=!!this.renderData;return e!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=e,this._surface.renderer.setDirty()),e}get shouldLoad(){const e=this._surface.snapLevel;if(v(e)){const i=this.level-e;if(i===0)return!0;if(i===1)return!1}return this.isLeaf}init(e,i,r){this.lij[0]=e[0],this.lij[1]=e[1],this.lij[2]=e[2],this.ellipsoid=sr(r.tilingScheme.spatialReference),r.tilingScheme.getExtent(e[0],e[1],e[2],this.extent),r.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,r.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[bs.MIDDLE][3]=0,this.vlevel=e?e[0]:0,i&&i.elevationBounds?io(this._elevationBounds,i.elevationBounds):dt(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this.screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=i,this.unsetChildren(),this._surface=r,this.updateVisibility();for(const n of FT){const s=r.numLayers(n),o=this.layerInfo[n];for(const a of o)a.release();o.length=s;for(let a=0;a<s;a++)o[a]=YU.acquire(this._surface.upsampleInfoPool),n===vi.ELEVATION&&this.findElevationBoundsForLayer(a,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(r.tilingScheme.pixelSize,AI)}release(){Ig(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const e of FT){for(const i of this.layerInfo[e])i.release();this.layerInfo[e].length=0}this._parent=null;for(let e=0;e<4;++e)this._children[e]=null;this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this._isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this._isCached){this.setMemoryDirty();const e=this._cachedMemory;e>0&&this._surface.upsampleMapCache.put(this.key,this,e)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}get _cachedMemory(){return this._isCached?this._mapTileMemory:0}get _mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[vi.MAP].reduce((e,i)=>e+(i instanceof MW?i.memoryUsage:0),this._mapTileMemoryInternal)}get _cpuImageMemorySize(){const i=this._surface.tilingScheme.pixelSize;return i*i*4}_ensureUsedMemory(){if(v(this._usedMemory))return this._usedMemory;this._usedMemory=0,this._mapTileMemoryInternal=0;let e=0;for(const{data:r}of this.layerInfo[vi.MAP])r instanceof MW?e+=this._getTerrainDataMemory(r):this._mapTileMemoryInternal+=this._getTerrainDataMemory(r);const i=this._cpuImageMemorySize;for(const r of this.layerInfo[vi.ELEVATION])this._usedMemory+=r.data?i:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemoryInternal+=x2(this.renderData.textureDescriptor)),this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+e),this._usedMemory}getUsedMemoryForLayer(e,i){const r=this.layerInfo[e][i];return r!=null&&r.data?e===vi.MAP?this._isCached?0:this._getTerrainDataMemory(r.data):e===vi.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(e){return e instanceof SA?x2(e.texture):e instanceof HTMLImageElement||e instanceof z7?this._cpuImageMemorySize:e instanceof MW||e instanceof kDt?e.memoryUsage:0}updateScreenDepth(e){const i=this._center[bs.MIDDLE],r=e,n=i[0],s=i[1],o=i[2],a=r[2]*n+r[6]*s+r[10]*o+r[14];this.screenDepth=a<0?0:a/(r[3]*n+r[7]*s+r[11]*o+r[15])}shouldSplit(e,i,r){if(!this.visible||v(e.frustum)&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(e.frustum)===nl.OUTSIDE))return Ot.NONE;const n=this.level;ge(PW,this._center[bs.MIDDLE],i);let s=al(PW),o=bs.MIDDLE;ge(rC,this._center[bs.TOP],i);const a=al(rC);a<s&&(s=a,o=bs.TOP),ge(rC,this._center[bs.BOTTOM],i);const l=al(rC);if(l<s&&(s=l,o=bs.BOTTOM),this._edgeLen2>s&&n<e.maxLod)return Ot.SPLIT;const c=Math.sqrt(s),h=e.fovX*c*2,p=this._edgeLen/h,f=()=>{const b=n+Math.ceil(-Math.log2(e.relativeWidthLimit/p));return b!==this.vlevel?(this.vlevel=b,Ot.VSPLITMERGE):Ot.NONE_HIT_MAXLOD};if(v(r)&&r-n===1)return n>=e.maxLod?f():Ot.SPLIT;const m=be(this.up,PW),g=this._elevationBounds[1]-this._elevationBounds[0],_=g/this.edgeLen;if(e.aboveGround&&m>0&&_<.001&&m/c-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-_>0)return Ot.NONE;if(p<e.relativeWidthLimit)return this.vlevel!==this.level?(this.vlevel=this.level,Ot.VSPLITMERGE):Ot.NONE;if(n>=e.maxLod)return f();if(n>6){ge(rC,this._center[o],i),le(Xo,this.up,m),ge(Xo,Xo,rC);const b=al(Xo);if(b>this.radius*this.radius){le(Xo,Xo,this.radius/Math.sqrt(b)),me(Xo,Xo,this._center[o]),ge(Xo,i,Xo);const w=Math.min(1,(Math.abs(be(Xo,this.up))+.5*g+this._curvatureHeight)/Pe(Xo)),x=VDt/e.angledSplitBias,T=e.fovY*c*2;if(w*(this._edgeLen/T)<x*e.relativeHeightLimit)return Ot.NONE}}return Ot.SPLIT}setChildren(e,i,r,n){Ig(!!(e&&i&&r&&n),"Null child passed"),this._children[0]=e,this._children[1]=i,this._children[2]=r,this._children[3]=n}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){var e;return((e=this.renderData)==null?void 0:e.hasGeometry)??!1}load(){this.refMapData();for(const e of FT)this._createOrUpdateAgents(0,e);this.surface.renderer.loadTile(this)}unload(e){e.unloadTile(this);for(const i of FT){const r=this.layerInfo[i];for(const n of r)n.loadingAgent&&n.loadingAgent!==lu&&(_k(n.loadingAgent),n.loadingAgent=null),n.pendingUpdates=0}this.resetPendingUpdate(Ot.GEOMETRY),this.resetPendingUpdate(Ot.TEXTURE_NOFADING),this.resetPendingUpdate(Ot.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const e=this.layerInfo[vi.MAP];for(const i of e)i.loadingAgent&&i.loadingAgent!==lu&&(_k(i.loadingAgent),i.loadingAgent=null),i.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(e){if($S(e,this._clippingArea))return!1;const i=this._intersectsClippingArea,r=this._isWithinClippingArea;v(e)?(this._intersectsClippingArea=this.intersectsExtent(e),this._isWithinClippingArea=this._isWithinExtent(e)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=e,this.updateVisibility();const n=r&&this._isWithinClippingArea,s=!(r||i||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||n||s||this.setPendingUpdate(Ot.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(e,i){return this.layerInfo[i][e]}hasLayerData(e,i){const r=this.layerInfo[i][e];return!(!r||!r.data||r.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const e of FT){const i=this.layerInfo[e];for(const r of i)if(r.loadingAgent&&r.loadingAgent!==lu&&r.loadingAgent.updating)return!0}return!1}_isSuspended(e){return!!this.hasPendingUpdate(Ot.SPLIT)||e!==vi.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(e){return(this._pendingUpdates&e)===e}setPendingUpdate(e){this._pendingUpdates|=e,e===Ot.SPLIT||e===Ot.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(e){return!!this.hasPendingUpdate(e)&&(this._pendingUpdates&=~e,!0)}requestLayerData(e,i,r){const n=this.layerInfo[i][e];if(n.waitingAgents.has(r))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),r.tile.lij.toString(),i,e),!0;if(n.waitingAgents.push(r),n.data&&!n.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),r.tile.lij.toString(),i,e),r.dataArrived(this),!0;if(n.requestPromise)return!0;Mp(n.requestAbort),n.requestAbort=new AbortController;const s=this._surface.requestTileData(this,e,i,n.requestAbort);if(!s)return n.requestAbort=null,!1;const o=()=>{n.requestPromise===s&&(n.requestPromise=null,n.requestAbort=null)};return n.requestPromise=s,s.then(o,o),!0}get isLeaf(){return this._children[0]==null}hasLij(e){return this.lij[0]===e[0]&&this.lij[1]===e[1]&&this.lij[2]===e[2]}findByLij(e){if(this.hasLij(e))return this;const i=this._children;return i[0]?i[0].findByLij(e)||i[1].findByLij(e)||i[2].findByLij(e)||i[3].findByLij(e):null}distanceToSquared(e){return al(ge(Xo,this._center[bs.MIDDLE],e))}containsPoint(e){const i=this.extent;return e[0]>=i[0]&&e[1]>=i[1]&&e[0]<=i[2]&&e[1]<=i[3]}containsPointXY(e,i){const r=this.extent;return e>=r[0]&&i>=r[1]&&e<=r[2]&&i<=r[3]}unrequestLayerData(e,i,r){const n=this.layerInfo[i][e],s=n.waitingAgents,o=s.removeUnordered(r)!=null;Ig(o,"agent has not requested this piece of map data"),s.length<1&&(n.abortRequest(),this.setMemoryDirty())}dataArrived(e,i,r){const n=this.layerInfo[i][e];n.data=r,n.dataInvalidated=!1,n.waitingAgents.forAll(s=>s.dataArrived(this)),n.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(e,i,r){r.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${i}/${e} error ${r}`);const n=this.layerInfo[i][e];n.dataMissing=!0,n.waitingAgents.forAll(s=>s.dataMissing()),n.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(e,i){switch(e){case vi.MAP:return this._updateTexture(i);case vi.ELEVATION:return this._updateGeometry()}}_updateTexture(e){this.renderData&&(this.resetPendingUpdate(e===qs.FADING?Ot.TEXTURE_NOFADING:Ot.TEXTURE_FADING),this.setPendingUpdate(e===qs.FADING?Ot.TEXTURE_FADING:Ot.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(Ot.GEOMETRY);for(const e of this.layerInfo[vi.ELEVATION])e.pendingUpdates|=Ot.GEOMETRY}invalidateLayerData(e,i){this.layerInfo[i][e].invalidateSourceData(),this.restartAgents(i)}computeElevationBounds(){const e=this._elevationBounds,i=e[0],r=e[1];dt(e,1/0,-1/0);const n=this.layerInfo[vi.ELEVATION];let s=!0;for(const o of n)v(o.elevationBounds)&&(e[0]=Math.min(e[0],o.elevationBounds.min),e[1]=Math.max(e[1],o.elevationBounds.max),o.elevationBounds.hasNoDataValues||(s=!1));s&&(e[0]=Math.min(e[0],0),e[1]=Math.max(e[1],0)),i===e[0]&&r===e[1]||(this.updateRadiusAndCenter(),this._surface.setTileTreeDirty())}_updateCenter(){const e=this._elevationBounds,i=.5*(e[0]+e[1]),r=this._center;le(Xo,this.up,i),me(r[bs.MIDDLE],this.centerAtSeaLevel,Xo),le(Xo,this.up,e[0]),me(r[bs.TOP],this.centerAtSeaLevel,Xo),le(Xo,this.up,e[1]),me(r[bs.BOTTOM],this.centerAtSeaLevel,Xo)}findElevationBoundsForLayer(e,i){const r=this.layerInfo[vi.ELEVATION][e],n=XQ(this.level),s=Math.max(this.vlevel-n,0),o=r.elevationBounds;if(v(o)&&o.level>=i&&o.level<=s)return;const a=this._surface.layerViewByIndex(e,vi.ELEVATION),l=Kte(a);if(!hL(this,l,!1))return;const c=BDt;let h=!1;const p=r.data;if(p&&p.level<=s){const f=r.data;c.min=f.samplerData.data.minValue,c.max=f.samplerData.data.maxValue,c.hasNoDataValues=f.samplerData.data.hasNoDataValues,c.level=this.level,h=!0}else{let f,m,g=0;for(let _=this._parent;_&&(!m||g<n)&&(g=this.vlevel-_.level,f=m||f,m=_.layerInfo[vi.ELEVATION][e].data,!(!m&&f&&_.level<=s));_=_.parent);m=m||f,m&&(m.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],c),c.min!==1/0&&(c.level=m.level,h=!0))}h&&(R(r.elevationBounds)&&(r.elevationBounds=new yR),r.elevationBounds.copyFrom(c))}modifyLayers(e,i,r){const n=this.layerInfo[r];for(const a of n)a.loadingAgent&&a.loadingAgent!==lu&&(_k(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<n.length;++a)e[a]===void 0&&n[a].release();const s=new Array(...n),o=i.length;n.length=o;for(let a=0;a<o;a++){const l=i[a];n[a]=l>-1?s[l]:YU.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(e){this.renderData&&(this._createOrUpdateAgents(0,e),this.updateRenderData(e,qs.FADING))}updateAgents(e){if(this.renderData){const i=this.layerInfo[e];for(const r of i)r.loadingAgent===lu&&(r.loadingAgent=null);this._createOrUpdateAgents(0,e)}}updateAgentSuspension(){for(const e of FT){const i=this._isSuspended(e);for(const r of this.layerInfo[e])r.loadingAgent&&r.loadingAgent!==lu&&(r.loadingAgent.setSuspension(i),r.loadingAgent===lu&&this.updateRenderData(e,qs.FADING))}}removeLayerAgent(e,i){const r=this.layerInfo[i][e];r.loadingAgent&&r.loadingAgent!==lu&&r.loadingAgent.dispose(),r.loadingAgent=null}agentDone(e,i){const r=this.layerInfo[i][e];r.loadingAgent=lu,!r.data&&R(r.upsampleInfo)&&this._createOrUpdateAgents(e+1,i)}_hasBlendableAncestor(e){return e.blendMode!=="normal"||IM(e.parent)&&this._hasBlendableAncestor(e.parent)}_hasBlendModes(e,i,r){var n,s,o;for(let a=e;a<i;++a){const l=this._surface.layerViewByIndex(a,r);if(Zz(l)&&((n=l==null?void 0:l.layer)==null?void 0:n.blendMode)!=="normal"||IM((s=l==null?void 0:l.layer)==null?void 0:s.parent)&&this._hasBlendableAncestor((o=l==null?void 0:l.layer)==null?void 0:o.parent))return!0}return!1}_createOrUpdateAgents(e,i){const r=this.layerInfo[i];if(r.length===0)return;const n=this._isSuspended(i);for(let s=e;s<r.length;++s){const o=r[s];let a=!1;const l=this._surface.layerViewByIndex(s,i),c=Kte(l);if(o.loadingAgent?hL(this,c,!1)?(o.loadingAgent!==lu&&o.loadingAgent.setSuspension(n),o.loadingAgent!==lu&&(a=o.loadingAgent.update())):o.dispose():hL(this,c,!1)&&(o.loadingAgent=zDt(this,s,i,n),a=o.loadingAgent.startLoading(),a?o.loadingAgent===lu&&this.setPendingUpdate(Ot.GEOMETRY):(_k(o.loadingAgent),o.loadingAgent=lu)),o.loadingAgent===lu&&this.updateRenderData(i,qs.FADING),!this._hasBlendModes(e,r.length,i)&&a&&l.isOpaque)return}}_isWithinExtent(e){const i=this.extent;return i[0]>=e[0]&&e[2]>=i[2]&&i[1]>=e[1]&&e[3]>=i[3]}intersectsExtent(e){const i=this.extent;return i[2]>=e[0]&&e[2]>=i[0]&&i[3]>=e[1]&&e[3]>=i[1]}getElevationVerticesPerSide(e){const i=this.vlevel-this.level,r=Math.max(this.level-e,XQ(this.level)-i),n=_e(1+(this.maxTesselation>>r),2,this.maxTesselation+1),s=this.getDefaultVerticesPerSide();return Math.max(n,s)}get test(){return{cachedMemory:this._cachedMemory}}_findLIJ(e,i){if(!e)return null;const r=this.surface.rootTiles;if(v(r)){for(const n of r)if(jDt(n,e)){let s=n,o=e[0]-s.level-1;for(;o>=0&&!s.isLeaf&&!i(s);){const a=e[1]>>o&1,l=e[2]>>o&1;s=s.children[2*a+l],o--}return i(s)?s:null}}return null}findNeighborTile(e,i){const r=this.lij,n=this.getNeighborLIJ(r,e);return n?GDt(r,n)?i(this)?this:null:this._findLIJ(n,i):null}findCorner(e,i){const r=e===It.NORTH_EAST?1:e===It.NORTH_WEST?0:e===It.SOUTH_WEST?2:3;let n=this;for(;n.children[0]&&(!i||!i(n));)n=n.children[r];return n}findNeighborCornerTileExact(e,i){var r;return((r=this.findNeighborTile(e,n=>i(n)||n.level===this.level))==null?void 0:r.findCorner(tie(e),i))||null}forAllSubtreeOnSide(e,i){const r=e===It.NORTH?[0,1]:e===It.NORTH_EAST?[1]:e===It.EAST?[1,3]:e===It.SOUTH_EAST?[3]:e===It.SOUTH?[2,3]:e===It.SOUTH_WEST?[2]:e===It.WEST?[0,2]:[0],n=s=>{const o=s.children;!i(s)&&o[0]&&r.forEach(a=>n(o[a]))};n(this)}forallNeighbors(e){Kz.forEach(i=>this.findNeighborCornerTileExact(i,e)),Hg.forEach(i=>{var r;return(r=this.findNeighborTile(i,n=>n.level===this.level||e(n)))==null?void 0:r.forAllSubtreeOnSide(Jz(i),e)})}getNeighborEdgeStartVertexIndex(e,i){if(!i)return 0;const r=this.level-i.level;if(Re(!Qs||r>=0),r===0)return 0;const n=2**r,s=(1&e)==1,o=s?0:1,a=i.lij[o+1]*n,l=this.lij[o+1],c=l-a,h=s?n-1-c:c;return Qs&&(Re(a<=l&&l<a+n),Re(0<=h&&h<n)),h}forEachLoadedNeighbor(e){const i=this.level,r=n=>n.level===i||n.isLoaded;Hg.forEach(n=>{const s=this.findNeighborTile(n,r);s!=null&&s!==this&&s.forAllSubtreeOnSide(Jz(n),o=>!!o.isLoaded&&(e(o,n),!0))}),Kz.forEach(n=>{var o;const s=(o=this.findNeighborTile(n,r))==null?void 0:o.findCorner(tie(n),a=>a.isLoaded);Re(!s||oie(this,s,n)),s!=null&&s.isLoaded&&e(s,n)})}getNeighborLIJ(e,i){const r=H1e(i)?-1:G1e(i)?1:0,n=B1e(i)?-1:j1e(i)?1:0,s=[e[0],e[1]+r,e[2]+n];return s[1]<0?null:this.surface.isGlobal?this.wrapLIJ(s):s[2]<0?null:s}wrapLIJ(e){return!e||e[1]<0||e[1]>=2**e[0]?null:this.surface.wrapEastWest(e)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return this.lij[2]===0}get isNorthEnd(){return this.lij[1]===0}get isSouthEnd(){return this.extent[1]+bl()>=this.surface.extent[1]}checkGeometryWaterproofness(){var e;Xz&&(Re(this.isLoaded),(e=this.renderData)==null||e.checkGeometryWaterproofness())}shouldHaveNeighbor(e){const i=this.extent,r=this.surface.rootTilesExtent,n=.25*(i[2]-i[0]);if(H1e(e)&&i[3]+n>=r[3]||G1e(e)&&i[1]-n<=r[1])return!1;const s=this.surface.isGlobal;return!(!s&&B1e(e)&&i[0]-n<=r[0])&&!(!s&&j1e(e)&&i[2]+n>=r[2])}updateDistanceToPOI(e){const i=this._lastPOI;if(this.distanceToPOI>=0&&i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2])return;ce(this._lastPOI,e);const r=this._center[bs.MIDDLE],n=e[0]-r[0],s=e[1]-r[1],o=e[2]-r[2];this.distanceToPOI=n*n+s*s+o*o}};function zDt(t,e,i,r){const n=i===vi.ELEVATION?Dce.acquire():Lce.acquire();return n.init(t,e,i,r),n}function _k(t){t.dispose(),t instanceof yUe?Dce.release(t):t instanceof _Ue&&Lce.release(t)}const Lce=new zo(_Ue),Dce=new zo(yUe),BDt=new yR;var bs;function jDt(t,e){const i=t.level,r=e[0];if(i>r)return!1;const n=r-i,s=Math.floor(e[1]/2**n),o=Math.floor(e[2]/2**n);return s===t.lij[1]&&o===t.lij[2]}function GDt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function HDt(t,e,i){if(R(t)||R(e))return!1;if(t.level===0&&e.level===0&&(t.isEastEnd&&e.isWestEnd&&i===It.EAST||t.isWestEnd&&e.isEastEnd&&i===It.WEST))return!0;const r=Math.max(1e-6*(t.extent[2]-t.extent[0]),1);switch(i){case It.NORTH:return ap(t.extent[3],e.extent[1],r);case It.SOUTH:return ap(t.extent[1],e.extent[3],r);case It.EAST:return ap(t.extent[2],e.extent[0],r)||ap(t.extent[2],-e.extent[0],r);case It.WEST:return ap(t.extent[0],e.extent[2],r)||ap(t.extent[0],-e.extent[2],r)}}function oie(t,e,i){return!R(t)&&!R(e)&&e!==t&&(t.level>=e.level?obe(t,e,i):obe(e,t,tie(i)))}function obe(t,e,i){Re(t.level>=e.level);const r=lLt(i),n=cLt(i),s=t.extent,o=e.extent,a=[r?s[0]:s[2],n?s[3]:s[1]],l=[r?o[2]:o[0],n?o[1]:o[3]],c=1e-5*(s[2]-s[0]),h=ap(a[0],l[0],c)||t.surface.isGlobal&&ap(a[0],-l[0],c),p=ap(a[1],l[1],c);if(h&&p)return!0;if(t.level===e.level||!h&&!p)return Re(!1),!1;const f=h?abe(o[1],o[3],s[1],s[3],c):abe(o[0],o[2],s[0],s[2],c);return Re(f),f}function abe(t,e,i,r,n=bl()){return t-n<=i&&i<=r&&r<=e+n}(function(t){t[t.TOP=0]="TOP",t[t.MIDDLE=1]="MIDDLE",t[t.BOTTOM=2]="BOTTOM"})(bs||(bs={}));let qDt=class{constructor(){this._scales=Zt(-1,-1,-1,-1),this._offsets=Zt(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(e,i,r){this._scales[2*e]=i,this._scales[2*e+1]=r}setOffset(e,i,r){this._offsets[2*e]=i,this._offsets[2*e+1]=r}get scales(){return this._scales}get offsets(){return this._offsets}};function WDt(t,e){t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),e.spherical?t.vertex.code.add(S`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):t.vertex.code.add(S`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),t.fragment.code.add(S`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}let Nce=class extends cke{constructor(){super(...arguments),this.slicePlaneLocalOrigin=P(),this.origin=this.slicePlaneLocalOrigin}};var ku;(function(t){t[t.Material=0]="Material",t[t.ShadowMap=1]="ShadowMap",t[t.Highlight=2]="Highlight"})(ku||(ku={}));let XDt=class extends Nce{constructor(){super(...arguments),this.identifier=ku.Material,this.output=z.Color,this.transparent=!1,this.integratedMesh=!1}},YDt=class extends Nce{constructor(){super(...arguments),this.identifier=ku.ShadowMap}},ZDt=class extends Nce{constructor(){super(...arguments),this.identifier=ku.Highlight}},Qz=class extends Fn{constructor(e,i){super(e,"vec4",br.Draw,(r,n,s)=>r.setUniform4fv(e,i(n,s)))}};var y_;function JDt(t,e){const{vertex:i,fragment:r}=t;i.uniforms.add([new Qz("overlayTexOffset",(n,s)=>KDt(n,s)),new Qz("overlayTexScale",(n,s)=>QDt(n,s))]),r.constants.add("overlayOpacity","float",1),r.uniforms.add(new Dt("ovColorTex",(n,s)=>aie(n,s))),xUe(t,e)}function xUe(t,e){t.extensions.add("GL_OES_standard_derivatives"),e.pbrMode!==_t.Water&&e.pbrMode!==_t.WaterOnIntegratedMesh&&e.pbrMode!==_t.TerrainWithWater||t.include(fke,e);const{vertex:i,fragment:r}=t;t.varyings.add("vtcOverlay","vec4"),i.code.add(S`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),r.code.add(S`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture2D(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture2D(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),r.code.add(S`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),r.code.add(S`
    vec4 getOverlayColorTexel(vec4 texCoords) {
          vec2 texDim =  ${Tp(e,"ovColorTex")};

          vec4 color0 = ${Zl(e,"ovColorTex","vec2(texCoords.x * 0.5, texCoords.y)*texDim")};
          vec4 color1 = ${Zl(e,"ovColorTex","vec2(texCoords.z * 0.5 + 0.5, texCoords.w)*texDim")};

          bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
          bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));

          return mix(color1 * float(isValid1), color0, float(isValid0));
    }
  `),e.pbrMode!==_t.Water&&e.pbrMode!==_t.WaterOnIntegratedMesh&&e.pbrMode!==_t.TerrainWithWater||(H_(r),Ey(r),r.code.add(S`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function aie(t,e){return e.overlays.length===0?null:t.identifier===ku.Material&&t.output===z.Color?e.overlays[mn.INNER].getColorTextureNoRasterImage():t.identifier===ku.Material&&t.output===z.ObjectAndLayerIdColor?e.overlays[mn.INNER].getColorTexture(Dc.ObjectAndLayerIdColor):t.identifier===ku.Highlight?e.overlays[mn.INNER].getValidTexture(Pn.Highlight):null}function KDt(t,e){for(const i of e.overlays){const{index:r,extent:n}=i;xCe(n)>0&&(KR[2*r]=t.toMapSpace[0]/Wh(n)-n[0]/Wh(n),KR[2*r+1]=t.toMapSpace[1]/gm(n)-n[1]/gm(n))}return KR}function QDt(t,e){for(const i of e.overlays){const{index:r,extent:n}=i;xCe(n)>0&&(KR[2*r]=t.toMapSpace[2]/Wh(n),KR[2*r+1]=t.toMapSpace[3]/gm(n))}return KR}(function(t){t[t.Disabled=0]="Disabled",t[t.Enabled=1]="Enabled",t[t.EnabledWithWater=2]="EnabledWithWater",t[t.COUNT=3]="COUNT"})(y_||(y_={}));const KR=pi();var qg;(function(t){t[t.LayerOnly=0]="LayerOnly",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.COUNT=3]="COUNT"})(qg||(qg={}));let eNt=class extends Tr{constructor(){super(...arguments),this.overlayOpacity=1}};function uP(t,e){t.vertex.uniforms.add([new e9("overlayTexOffset"),new e9("overlayTexScale")]),t.fragment.uniforms.add([new Ie("overlayOpacity",i=>i.overlayOpacity),new Dt("ovColorTex",(i,r)=>r.overlays.length===0?null:r.overlays[mn.INNER].getColorTexture(i.overlaySource))]),xUe(t,e)}function tNt(t,e){const{vertex:i,fragment:r,varyings:n}=t;n.add("vtc","vec2"),i.uniforms.add(new e9("texOffsetAndScale")),r.uniforms.add(new lbe("tex")),r.uniforms.add(new IW("textureOpacities"));const s=e.textureFadingEnabled&&!e.renderOccluded;s&&(i.uniforms.add(new e9("nextTexOffsetAndScale")),n.add("nvtc","vec2"),r.uniforms.add(new lbe("texNext")),r.uniforms.add(new IW("nextTexOpacities")),r.uniforms.add(new iNt("fadeFactor")));const o=e.tileBlendInput===qg.ColorComposite,a=e.tileBlendInput===qg.GridComposite;a&&r.include(Ice),o&&r.uniforms.add(new IW("backgroundColor")),i.code.add(S`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${s?S`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:S``}
  }`),r.code.add(S`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${a||o?S`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${o?S`backgroundColor`:S`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:S`return color;`}
    }`),s?r.code.add(S`vec4 getTileColor() {
vec4 color = getColor(texture2D(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture2D(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):r.code.add(S`vec4 getTileColor() {
return getColor(texture2D(tex, vtc), vtc, textureOpacities);
}`)}let iNt=class extends Fn{constructor(e){super(e,"float")}},IW=class extends Fn{constructor(e){super(e,"vec3")}},e9=class extends Fn{constructor(e){super(e,"vec4")}},lbe=class extends Fn{constructor(e){super(e,"sampler2D")}},TUe=class extends eNt{};function rNt(t){const e=new ji,{vertex:i,fragment:r,varyings:n}=e;e.include(WN),e.include(sF,t),e.include(iy,t);const s=()=>{e.include(zD,t),i.code.add(S`
      vec3 decodeNormalTerrain(vec2 e) {
        float z = 1.0 - abs(e.x) - abs(e.y);
        vec3 n = vec3(e + vec2(e.x >= 0.0 ? 1.0 : -1.0, e.y >= 0.0 ? 1.0 : -1.0) * min(z,0.0),z);
        return normalize(n);
      }

      vec3 getNormal() {
        return  ${t.shading?S`decodeNormalTerrain(normalCompressed)`:S`getLocalUp(position, localOrigin)`};
      }
  `)};Yu(i,t),e.include(Gc,t);const o=t.overlayMode!==y_.Disabled;switch(t.output){case z.Color:{e.include(tNt,t),e.include(P2,t),o&&e.include(uP,{...t,pbrMode:t.pbrMode===_t.Terrain?_t.TerrainWithWater:_t.Water});const a=t.overlayMode===y_.EnabledWithWater;a&&e.include(WDt,t),n.add("vnormal","vec3"),n.add("vpos","vec3"),n.add("vup","vec3"),s(),(t.atmosphere||t.screenSizePerspective)&&eO(i);const l=t.receiveShadows&&!t.renderOccluded;l&&e.include(UO,t),t.atmosphere&&n.add("wnormal","vec3"),t.screenSizePerspective&&(n.add("screenSizeDistanceToCamera","float"),n.add("screenSizeCosAngle","float")),i.code.add(S`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          //Up
          vup = getLocalUp(position, localOrigin);

          ${a?S`forwardVertexTangent(vnormal);`:S``}

          ${t.atmosphere?S`wnormal = normalize((viewNormal * vec4(normalize(positionWorld), 1.0)).xyz);`:""}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${o?S`setOverlayVTC(uv);`:""}
          ${t.tileBorders?S`forwardTextureCoordinates();`:""}

          ${t.screenSizePerspective?S`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${l?S`forwardLinearDepth();`:""}

        }
      `),e.extensions.add("GL_OES_standard_derivatives"),e.extensions.add("GL_EXT_shader_texture_lod"),e.include(fs,t),e.include(P2,t),e.include(aF,t),e.include(O2,t),xm(r,t),lF(r),ZO(r),r.uniforms.add([i.uniforms.get("localOrigin"),new Jt("viewDirection",(c,h)=>we(cbe,he(cbe,h.camera.viewMatrix[12],h.camera.viewMatrix[13],h.camera.viewMatrix[14])))]),a&&r.uniforms.add([new Dt("ovWaterTex",(c,h)=>h.overlays.length===0?null:h.overlays[mn.INNER].getNormalTexture(c.overlaySource)),new d4e("view",(c,h)=>Yc(nNt,h.camera.viewMatrix,c.origin))]),r.code.add(S`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),H_(r),Ey(r),r.code.add(S`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${t.receiveShadows&&!t.renderOccluded?"readShadowMap(vpos, linearDepth)":t.spherical&&t.shading?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${o?S`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${t.invisible?S`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a <= 0.0) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= sliceOpacity;
          }
          ${t.atmosphere?S`
              float ndotl = clamp(vndl, 0.0, 1.0);
              vec3 atm = vec3(clamp(1.0 - dot(-viewDirection, wnormal), 0.0, 1.0));
              atm *= clamp(1.0 - lum(tileColor.rgb) * 1.5, 0.0, 1.0); // avoid atmosphere on bright base maps
              atm *= clamp(ndotl * 2.0, 0.0, 1.0); // avoid atmosphere on dark side of the globe
              atm *= tileColor.a; // premultiply with tile alpha`:""}

          vec3 albedo = ${t.atmosphere?S`atm + tileColor.rgb;`:S`tileColor.rgb;`}

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${t.pbrMode===_t.Terrain||t.pbrMode===_t.TerrainWithWater?S`gl_FragColor = vec4(evaluateTerrainLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:S`gl_FragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${a?S`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                float opacity = sliced ? sliceOpacity : 1.0;
                // un-gamma the ground color to mix in linear space
                gl_FragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
              }`:""}
          ${t.screenSizePerspective?S`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              gl_FragColor = mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${t.visualizeNormals?t.spherical?S`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  gl_FragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:S`
                  vec3 tNormal = normalize(normal);
                  gl_FragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:""}
          ${t.tileBorders?S`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          gl_FragColor = highlightSlice(gl_FragColor, vpos);
        }
      `)}break;case z.Depth:o&&e.include(uP,t),e.include(N_,t),_w(e),S2(e),i.code.add(S`
              void main(void) {
                ${o?S`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
              }
          `),r.code.add(S`
              void main() {
                ${o&&t.invisible?S`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
                outputDepth(linearDepth);
              }
          `);break;case z.Shadow:case z.ShadowHighlight:case z.ShadowExcludeHighlight:e.include(N_,t),_w(e),S2(e),i.code.add(S`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),r.code.add(S`void main() {
outputDepth(linearDepth);
}`);break;case z.Normal:o&&e.include(uP,t),n.add("vnormal","vec3"),eO(i),s(),i.code.add(S`
            void main(void) {
              ${o?S`setOverlayVTC(getUV0());`:""}
              gl_Position = transformPosition(proj, view, position);
              vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);
            }
        `),r.code.add(S`
            void main() {
              ${o&&t.invisible?S`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
              vec3 normal = normalize(vnormal);
              if (gl_FrontFacing == false) {
                normal = -normal;
              }
              gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
            }
        `);break;case z.Highlight:o&&e.include(uP,t),i.code.add(S`
          void main() {
            ${o?S`setOverlayVTC(getUV0());`:""}
            gl_Position = transformPosition(proj, view, position);
          }
        `),e.include(Q_,t),r.code.add(S`
          void main() {
            ${o?S`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
            outputHighlight();
          }
        `)}return t.output===z.ObjectAndLayerIdColor&&(e.include(uP,{...t,pbrMode:_t.Disabled}),i.code.add(S`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),r.code.add(S`void main() {
gl_FragColor = getOverlayColorTexel(vtcOverlay);
}`)),e}const nNt=$e(),cbe=P(),sNt=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:TUe,build:rNt},Symbol.toStringTag,{value:"Module"}));let SUe=class EUe extends Yi{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(e,i){i.hasWebGL2Context=e.rctx.type===Et.WEBGL2,i.spherical=e.viewingMode===qe.Global}initializeProgram(e){return new Hi(e.rctx,EUe.shader.get().build(this.configuration),CUe)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(e){const i=this.configuration,r=i.backfaceCullingEnabled&&!i.renderOccluded;return Ht({blending:i.renderOccluded?Am(Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA):null,culling:r?$ae:null,depthTest:i.renderOccluded?null:{func:Gr.LESS},depthWrite:i.renderOccluded?null:Kc,colorWrite:si,stencilTest:e?hAt(Wc.IntegratedMeshMaskExcluded):null})}getPipelineState(e,i){return this.useStencil?this._stencilPipelineState:super.getPipelineState(e,i)}};SUe.shader=new Gi(sNt,()=>Q(()=>import("./Terrain.glsl-c8bb04e5.js"),[]));const CUe=new Map([[M.POSITION,0],[M.UV0,1],[M.NORMALCOMPRESSED,2]]);let oNt=class{constructor(){this.geometryInfo=new tDt,this.intersectionData=null,this.geometryState=null,this._textureRef=new pUe(()=>this.tile.surface.textureFadeDuration),this.overlay=new qDt,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1,this._shadingChanged=!1,this._dirtyEdgeResolutions=15,this._dirtyEdges=15,this._dirtyCorners=15}get tile(){return this._tile}init(e){this.clear(),this._tile=e;const i=this.geometryInfo;i.indices=null,i.vertexAttributes=null,Br(i.boundingBox),i.indexCount=0,i.numVerticesPerSide=0,this.intersectionData=null,this.geometryState=new lDt,this.localOrigin=null,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(e){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this._wireframeChanged||this._shadingChanged||this._clippingAreaChanged||this._samplerDataChanged||this._numVerticesPerSideChanged||this._dirtyCorners||this._dirtyEdgeResolutions||this._dirtyEdges)&&(this._updateGeometry(e),this._geometryStateChangedSinceLastUpdate=!1),Qs&&this.tile.intersectsClippingArea)for(let i=0;i<4;++i)Re(this.geometryInfo.outerEdges[i].count===this.geometryState.neighborData.edgeResolutions[i]+1)}_calculateEdgeResolution(e,i){var l;const r=this.tile,n=this.geometryState.numVerticesPerSide-1;if(!r.surface.isGlobal){const c=r.surface.extent;if(v(c)&&(e===0&&r.extent[3]>c[3]||e===1&&r.extent[2]>c[2]||e===2&&r.extent[1]<c[1]||e===3&&r.extent[0]<c[0]))return n}const s=r.level,o=Hg[e];if(!i)return Re(R((l=r.surface)==null?void 0:l.rootTiles)||r.surface.updatingRootTiles||!r.shouldHaveNeighbor(o)),n;if(i.isLoaded){const c=i,h=c.renderData.geometryState,p=s-c.level;if(Re(p>=0),p===0){const g=h.numVerticesPerSide-1;return Math.max(g,n)}const f=2**p,m=h.neighborData.edgeResolutions[(e+2)%4]/f;return Math.max(1,m)}Re(!i.isLeaf);let a=n;return i.forAllSubtreeOnSide(Jz(o),c=>c===r||(c.isLoaded?(a=Math.max(a,2**(c.level-s)),!0):(Re(!c.isLeaf),!1))),a}updateNeighborData(){var a;const e=this.tile;if(!e.intersectsClippingArea)return;const i=e.renderData.geometryState.neighborData,r=l=>(l.isLoaded||l.level===e.level)&&(l==null?void 0:l.intersectsClippingArea),n=i.edgePeerNeighbors,s=i.edgePeerNeighborSamplerVersions;for(let l=0;l<4;++l){const c=e.findNeighborTile(Hg[l],r),h=lS(e,c),p=((a=h==null?void 0:h.renderData)==null?void 0:a.geometryState.samplerDataVersion)??-1,f=n[l],m=h!==lS(e,f),g=s[l]!==p;n[l]=c,(m||g)&&(s[l]=p,this._markEdgeDirty(l));const _=i.edgeResolutions[l],b=this._calculateEdgeResolution(l,c);Re(mm(b)),Re(b>=1),i.edgeResolutions[l]=b,_!==b&&this._markEdgeResolutionDirty(l)}const o=i.cornerPeerNeighbors;for(let l=0;l<4;++l){const c=e.findNeighborTile(Kz[l],r);o[l]=c;const h=lS(e,n[l]),p=lS(e,n[(l+1)%4]),f=lS(e,c);nf[l]=f,nf[(l+1)%4]=p,nf[(l+2)%4]=e,nf[(l+3)%4]=h,Re(nf.some(b=>(b==null?void 0:b.isLoaded)||b===e));const m=nf.reduce((b,w)=>Math.min(b,(w==null?void 0:w.level)??1/0),1/0);nf.forEach((b,w)=>{b&&(b==null?void 0:b.level)>m&&(nf[w]=null)}),Re(nf.some(b=>(b==null?void 0:b.isLoaded)||b===e));const g=i.cornerNeighborData[l].cornerTiles,_=i.cornerNeighborData[l].cornerTileSamplerVersions;for(let b=0;b<4;++b){const w=nf[b],x=(w==null?void 0:w.renderData.geometryState.samplerDataVersion)??-1,T=g[b]!==w,E=!T&&_[b]!==x;(T||E)&&(g[b]=w,_[b]=x,this._markCornerDirty(l))}Re(g.some(b=>(b==null?void 0:b.isLoaded)||b===e))}Qs&&Re(this.geometryState.neighborData.edgeResolutions.every(l=>l>0));for(let l=0;l<4;++l)nf[l]=null}_updateGeometry(e){if(!this.tile.intersectsClippingArea)return;Qs&&Re(!this.tile.intersectsClippingArea||this.geometryState.neighborData.edgeResolutions.every(l=>l>0)),this.intersectionData=null;const i=this.tile,r=this._vao,n=this.geometryInfo.vertexAttributes,s=!r||!n||this._wireframeChanged||this._shadingChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||this._dirtyEdgeResolutions,o=!s&&(this._dirtyEdges!==0||this._dirtyEdgeResolutions!==0),a=!o&&this._dirtyCorners!==0;s?(this.releaseGeometry(),this._createGeometry(e)):o||a?i.updateEdgeElevations():a?i.updateCornerElevations():console.warn("Update for no reason?"),this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._dirtyEdgeResolutions=0,this._dirtyEdges=0,this._dirtyCorners=0,this._clippingAreaChanged=!1,this._wireframeChanged=!1,this._shadingChanged=!1}get hasGeometry(){return this._hasGeometry}releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao.dispose(),this._vao=null,nDt(this.geometryInfo),!0)}ensureTexture(e,i){return v(this._texture)&&this._texture.descriptor.width!==e&&this.releaseTexture(),R(this._texture)&&(this._texture=i(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){v(this._texture)&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}_markCornerDirty(e){const i=1<<e;this._dirtyCorners|=i}_markEdgeDirty(e){const i=1<<e;this._dirtyEdges|=i}_markEdgeResolutionDirty(e){const i=1<<e;this._dirtyEdgeResolutions|=i,this._dirtyEdges|=i}_markAllEdgesAndCornersDirty(){this._dirtyCorners=15,this._dirtyEdges=15,this._dirtyEdgeResolutions=15}updateGeometryState(){const e=this._getElevationInfo(),i=this.tile,r=e.samplerData?i.getElevationVerticesPerSide(e.maxTileLevel):i.getDefaultVerticesPerSide(),n=Math.max(r,5);let s=i.clippingArea;i.intersectsClippingArea&&!i.isWithinClippingArea||(s=null);const o=this.geometryState;let a=!1;o.numVerticesPerSide!==n&&(this._numVerticesPerSideChanged=!0,o.numVerticesPerSide=n,o.samplerDataVersion++,a=!0),e.changed&&(this._samplerDataChanged=!0,o.samplerData=e.samplerData,o.samplerDataVersion++,a=!0),x_(o.clippingArea,s)||(this._clippingAreaChanged=!0,o.clippingArea=s,a=!0);const l=i.surface,c=l.wireframe;o.wireframe!==c&&(this._wireframeChanged=!0,o.wireframe=c,a=!0);const h=l.shading;return o.shading!==h&&(this._shadingChanged=h,o.shading=h,a=h),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=a),a&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(e){this.tile.createGeometry();const i=this.geometryInfo.vertexAttributes,r=this.geometryInfo.indices,n=e.gl;this._vao=new Rm(e,CUe,{geometry:sh(i.layout)},{geometry:er.createVertex(e,n.STATIC_DRAW,i.buffer)},er.createIndex(e,n.STATIC_DRAW,r)),this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(e,i=m_.Immediate){v(e)&&e.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(e,i)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const e=this.geometryState.samplerData,i=this.tile.layerInfo[vi.ELEVATION],r=i.length,n=new Array(r);let s=0,o=0,a=!1;for(let h=0;h<r;h++){const p=i[h];if(v(p.upsampleInfo)){const f=p.upsampleInfo.tile,m=f.layerInfo[vi.ELEVATION][h].data,g=m&&m.samplerData;e&&e[s]===g||(a=!0),n[s++]=g,o=Math.max(o,f.lij[0])}else if(p.data){const f=this.tile.surface.layerViewByIndex(h,vi.ELEVATION);if(hL(this.tile,f.layer,!1)){const m=p.data;e&&e[s]===m.samplerData||(a=!0),n[s++]=m.samplerData,o=this.tile.level}}}v(e)&&e.length!==s&&(a=!0);const l=s>0,c=l?n:null;return l&&(n.length=s),{changed:a,samplerData:c,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){var i,r;const e=jh(this.intersectionData,0,n=>n.estimatedMemoryUsage);return(((i=this.geometryInfo.indices)==null?void 0:i.byteLength)??0)+(((r=this.geometryInfo.vertexAttributes)==null?void 0:r.byteLength)??0)+e}get textureDescriptor(){return v(this._texture)?this._texture.descriptor:null}get test(){return{hasTexture:this._texture!=null}}checkGeometryWaterproofness(){if(!Qs)return;const e=this.tile;if(Re(e==null?void 0:e.isLoaded),!e.isLoaded||!e.intersectsClippingArea)return;const i=e.renderData;if(e.level===0)return;const r=e.surface.extent;if(v(r)&&!e.intersectsExtent(r))return;const n=Hg.map((l,c)=>!!v(r)&&(c<2?-1:1)*(e.extent[3-c]-r[3-c])<0),s=e.level;Re(this._dirtyCorners===0),Re(this._dirtyEdges===0),Re(this._dirtyEdgeResolutions===0),Re(!this._numVerticesPerSideChanged),Re(!this._samplerDataChanged),Re(!this._clippingAreaChanged),Re(!this._wireframeChanged);const o=Kz.map(l=>e.findNeighborCornerTileExact(l,c=>!c.intersectsClippingArea||c.isLoaded||c.level===e.level)??null).map(l=>l!=null&&l.intersectsClippingArea?l:null),a=this.geometryState.neighborData;for(let l=0;l<4;++l){const c=a.cornerPeerNeighbors[l],h=o[l];Re(h===c,`Tile[${e.lij}].corner[${l}] out of date: cur=[${c==null?void 0:c.lij}] exp=[${h==null?void 0:h.lij}]`)}Hg.forEach((l,c)=>{if(n[c])return;const h=e.findNeighborTile(l,L=>(L.level===s||(L==null?void 0:L.isLoaded))&&(L==null?void 0:L.intersectsClippingArea));if(!h){const L=!e.surface.updatingRootTiles&&v(e.surface.rootTiles)&&e.surface.rootTiles.length>0&&e.shouldHaveNeighbor(l);return void Re(!L)}Re(h.isLoaded||h.level===e.level),Re(h===this.geometryState.neighborData.edgePeerNeighbors[c]);const p=s-h.level;if(!h.isLoaded)return Re(!h.isLeaf),void Re(p===0);const f=h.renderData;Re(HDt(e,h,l)),Re(p>=0);const m=2**p;if(p<0)return void Re(!1);const g=i.geometryInfo,_=g.outerEdges[c],b=g.numVerticesPerSide-1,w=f.geometryInfo;if(!w)return void Re(!1);{const L=this.geometryState.neighborData.edgePeerNeighbors[c];if(L!=null&&L.isLoaded){const F=L.renderData;Re(L==L),Re(i.geometryState.neighborData.edgePeerNeighborSamplerVersions[c]===F.geometryState.samplerDataVersion),Re(this.geometryState.neighborData.edgePeerNeighborSamplerVersions[c]===F.geometryState.samplerDataVersion)}}const x=(c+2)%4,T=w.outerEdges[x],E=_.count-1,C=T.count-1;Re(E*m===C,`Tile[${e.lij}]:e${c},res=${E} edgeRes mismatch with Neighbor[${h.lij}]:e${x},res=${C} (expected:${E*m})`);const A=e.extent,I=l===It.NORTH||l===It.SOUTH,O=T.count-1,D=O/2**p,U=_.count-1;if(D<1)return void Re(U===1);Re(D===U),Re(mm(D));const V=w.numVerticesPerSide-1;Re(p>0||D===Math.max(V,b));const B=e.getNeighborEdgeStartVertexIndex(c,h);Re(0<=B&&B<m);const ee=B*D;Re(0<=ee&&ee<=O-D);let ie=0,J=ee;_.getVertexPos(Xm,0),_.getVertexPos(Ym,_.count-1);const q=Lr(Xm,Ym),N=Math.max(aNt,1e-4*q);for(let L=0;L<=D;++L){_.getVertexPos(Xm,ie),T.getVertexPos(Ym,J);const F=L/D,G=I?A[0]+F*(A[2]-A[0]):l===It.WEST?A[0]:A[2],W=I?l===It.SOUTH?A[1]:A[3]:A[1]+F*(A[3]-A[1]),Z=e.surface.extent;if(R(Z)||q9(Z,G,W)){const X=xN(Xm,Ym),oe=Ru(Xm)-Ci.radius,pe=Ru(Ym)-Ci.radius,ye=X<N;if(!ye){console.warn(`Tile edge vertex position mismatch: between [${e.lij}].edge${c}[${ie}/${_.count}] and [${h.lij}].edge${x}[${J}/${T.count}]`),v(Z)&&console.warn("  surface extent= ",Z," x,y=",G,",",W);const Se=P();ge(Se,i.localOrigin,f.localOrigin),Ru(Se)>0&&console.warn(`   localOrigins: ${i.localOrigin} vs ${f.localOrigin} d=${Ru(Se)} [${Se}]`),(()=>{const He=In(Xm),De=In(Ym);e.updateEdgeElevations(),h.updateEdgeElevations(),_.getVertexPos(Xm,ie),T.getVertexPos(Ym,J);const Te=P();Fo(Te,Xm,He),Ru(Te)>0&&console.warn(`  XXX Tile[${e.lij}] edge out of date: ${He} vs ${Xm} d=${Ru(Te)} [${Te}]`),Fo(Te,Ym,De),Ru(Te)>0&&console.warn(`  XXX Neighbor[${h.lij}] edge out of date: ${De} vs ${Ym} d=${Ru(Te)} [${Te}]`)})(),Re(ye,`Mismatch in tile [${e.lij}].edge[${c}][${ie}/${_.count}] vs neighbor [${h.lij}].edge[${x}][${J}/${T.count}] ${Ky(Xm)} vs ${Ky(Ym)}  dist=${X} h(t|n|d)=${oe}|${pe}|${pe-oe}`)}if(e.surface.shading){_.getNormal(nC,ie),T.getNormal(sC,J),we(ube,nC),we(hbe,sC);const Se=be(ube,hbe),He=1-Se<.01||!1||e===h;if(!He){const De=P();Fo(De,nC,sC);const Te=()=>`Mismatch in tile edge normal ${z1e(e.lij)} (${ie}/${_.count-1}) edge ${c} vs neighbor ${z1e(h.lij)}  (${J}/${T.count-1}) nedge ${x} :${Ky(nC)} vs ${Ky(sC)}  dot = ${Se} : ${Ky(De)}`;console.warn("Mismatch in tile edge normal: ",Te());{e.updateEdgeElevations(),h.updateEdgeElevations();const ke=P(),ze=P();_.getNormal(ke,ie),T.getNormal(ze,J),Qb(nC,ke)||console.warn("Missing update in tile normal: ",Ky(nC)," => ",Ky(ke)),Qb(sC,ze)||console.warn("Missing update in neighbor normal: ",Ky(sC)," => ",Ky(ze))}Re(He,Te())}}}ie+=1,J+=1}})}};const Xm=P(),Ym=P(),nC=P(),sC=P(),ube=P(),hbe=P(),aNt=1,nf=[null,null,null,null];function lS(t,e){return e!=null&&e.isLoaded||e===t?e:null}const lNt=65536;function cNt(t,e){const i=t.tile,{extent:r,extentInRadians:n,surface:s}=i,o=t.localOrigin,a=t.geometryState,l=s.isWebMercator,c=s.shading||L2,h=a.numVerticesPerSide,p=h-1,f=(h-2)**2,m=l&&(e===op.HAS_SOUTH_POLE||e===op.HAS_BOTH_POLES),g=l&&(e===op.HAS_NORTH_POLE||e===op.HAS_BOTH_POLES),_=6,b=((m?1:0)+(g?1:0))*_*(p+1),w=a.neighborData,x=w.edgeResolutions.reduce((O,D)=>O+D+1,0),T=dUe(f+b+x),E=t.geometryInfo;E.numVerticesPerSide=a.numVerticesPerSide,E.vertexAttributes=T;const C=E.boundingBox;Br(C);const A=Fce(t);Cs.update(p,n,A),uNt(t),DUe(t,f),AUe(t);const I=[];if((()=>{let O=f+x;const D=o[0],U=o[1],V=o[2],B=i.ellipsoid.radius,ee=r[1],ie=r[3],J=(q,N)=>{const L=N*h;Jl(-D,-U,q*B-V,C),I.push({connectedRowOffset:L,connectedOuterEdgeOffset:q===1?0:2,rowOffset:O,latitudeResolution:_});const F=OUe(q===-1?ee:ie,B),G=q*Math.PI/2-F,W=.99*(q===1?1:-1),Z=B+0,X=T.position,oe=T.uv0,pe=T.normalCompressed;for(let ye=1;ye<=_;++ye){const Se=F+G*(ye/_),He=Math.cos(Se),De=Math.sin(Se);for(let Te=0;Te<=p;Te++){const ke=Te/p,ze=Cs.sinLonLUT[Te],bt=Cs.cosLonLUT[Te]*He,it=ze*He,jt=De,Qt=bt*Z-D,oi=it*Z-U,ei=jt*Z-V;Jl(Qt,oi,ei,C),X.setValues(O,Qt,oi,ei),Zu(oe,O,ke,W),c&&YD(pe,O,bt,it,jt),++O}}};m&&J(-1,0),g&&J(1,p)})(),LUe(E,a.numVerticesPerSide,I,[0,h-1],[0,h-1],a.wireframe),t.intersectionData=null,Qs)for(let O=0;O<4;++O)Re(E.outerEdges[O].count===w.edgeResolutions[O]+1)}function uNt(t){const e=t.tile;e.intersectsClippingArea&&(e.surface.shading||L2?dNt(t):hNt(t))}function hNt(t){const e=t.geometryState,i=e.numVerticesPerSide,r=i-2,n=i-1,s=t.geometryInfo,o=s.vertexAttributes,a=o.position,l=o.uv0,c=t.tile,h=c.extent,p=h[0],f=h[2],m=h[1],g=h[3],_=c.ellipsoid.radius,b=e.samplerData,w=t.localOrigin,x=w[0],T=w[1],E=w[2],C=s.boundingBox,A=a.typedBuffer,I=a.typedBufferStride;let O=0;for(let D=1;D<=r;D++){const U=D/n,V=m*(1-U)+g*U,B=Cs.sinLatLUT[D],ee=Cs.cosLatLUT[D];for(let ie=1;ie<=r;ie++){const J=ie/n,q=p*(1-J)+f*J,N=Cs.sinLonLUT[ie],L=Cs.cosLonLUT[ie],F=_+sn(q,V,b),G=L*ee*F-x,W=N*ee*F-T,Z=B*F-E;Jl(G,W,Z,C);const X=O*I;A[X]=G,A[X+1]=W,A[X+2]=Z,Zu(l,O,J,U),++O}}}function dNt(t){const e=t.geometryState,i=e.numVerticesPerSide,r=i-2,n=i-1,s=t.geometryInfo,o=s.vertexAttributes,a=o.position,l=o.uv0,c=o.normalCompressed,h=t.tile,p=h.extent,f=p[0],m=p[2],g=p[1],_=p[3],b=h.ellipsoid.radius,w=e.samplerData,x=t.localOrigin,T=x[0],E=x[1],C=x[2],A=a.typedBuffer,I=a.typedBufferStride,O=1/n,D=s.boundingBox;let U=0;if(1<=r){const V=O,B=g*(1-V)+_*V,ee=Cs.sinLatLUT[1],ie=Cs.cosLatLUT[1];for(let J=1;J<=r;J++){const q=J*O,N=f*(1-q)+m*q,L=Cs.sinLonLUT[J],F=Cs.cosLonLUT[J],G=b+sn(N,B,w),W=G*F*ie-T,Z=G*L*ie-E,X=G*ee-C;Jl(W,Z,X,D);const oe=(J-1)*I;A[oe]=W,A[oe+1]=Z,A[oe+2]=X,Zu(l,J-1,q,V)}}for(let V=1;V<=r;V++){const B=V*O,ee=g*(1-B)+_*B,ie=Cs.sinLatLUT[V],J=Cs.cosLatLUT[V],q=V+1,N=q*O,L=g*(1-N)+_*N,F=Cs.sinLatLUT[q],G=Cs.cosLatLUT[q],W=Cs.sinLonLUT[0],Z=Cs.cosLonLUT[0],X=b+sn(f,ee,w);let oe=Z*J*X-T,pe=W*J*X-E,ye=ie*X-C;const Se=U*I;let He=A[Se],De=A[Se+1],Te=A[Se+2];for(let ke=1;ke<=r;ke++){const ze=ke*O,bt=f*(1-ze)+m*ze,it=Cs.sinLonLUT[ke],jt=Cs.cosLonLUT[ke];let Qt=jt*J,oi=it*J,ei=ie,wi=0,or=0,Ii=0;{let at=0,et=0,pt=0;if(ke<r){const Ni=(U+1)*I;at=A[Ni],et=A[Ni+1],pt=A[Ni+2]}else{const Ni=Cs.sinLonLUT[n],Fi=Cs.cosLonLUT[n],ki=b+sn(m,ee,w);at=Fi*J*ki-T,et=Ni*J*ki-E,pt=ie*ki-C}const gt=oe,Rt=pe,Yt=ye;oe=He,pe=De,ye=Te,He=at,De=et,Te=pt,wi=at-gt,or=et-Rt,Ii=pt-Yt}{let at=0,et=0,pt=0;if(V>1){const gt=(U-r)*I;at=A[gt],et=A[gt+1],pt=A[gt+2]}else{const gt=Cs.sinLatLUT[0],Rt=Cs.cosLatLUT[0],Yt=b+sn(bt,g,w);at=jt*Rt*Yt-T,et=it*Rt*Yt-E,pt=gt*Yt-C}{const gt=b+sn(bt,L,w),Rt=jt*G*gt-T,Yt=it*G*gt-E,Ni=F*gt-C;if(V<r){const Fr=U+r,hi=Fr*I;A[hi]=Rt,A[hi+1]=Yt,A[hi+2]=Ni,Jl(Rt,Yt,Ni,D),Zu(l,Fr,ze,N)}const Fi=at-Rt,ki=et-Yt,Ui=pt-Ni;ei*ei<.999&&(Qt=Ii*ki-or*Ui,oi=wi*Ui-Ii*Fi,ei=or*Fi-wi*ki)}}const Oi=1/Math.sqrt(Qt*Qt+oi*oi+ei*ei);YD(c,U,Qt*Oi,oi*Oi,ei*Oi),++U}}}function pNt(t){t.tile.intersectsClippingArea&&(AUe(t),q7(t))}function fNt(t){t.tile.intersectsClippingArea&&(MUe(t),RUe(t,!0),q7(t))}function AUe(t){t.tile.intersectsClippingArea&&(MUe(t),RUe(t))}function RUe(t,e=!1){const i=t.geometryState,r=t.geometryInfo,n=i.neighborData,s=t.tile,o=s.level,a=s.extent,l=s.ellipsoid.radius,c=s.extentInRadians,h=c[0],p=c[2],f=c[1],m=c[3],g=i.samplerData,_=a[0],b=a[2],w=a[1],x=a[3],T=Fce(t),E=r.boundingBox,C=t.localOrigin,A=C[0],I=C[1],O=C[2],D=s.surface.shading||L2,U=r.vertexAttributes,V=U.position,B=V.typedBuffer,ee=V.typedBufferStride,ie=U.uv0;for(let J=0;J<4;++J){const q=J===1||J===3,N=n.edgeResolutions[J];Re(mm(N));const L=N+1,F=lS(s,n.edgePeerNeighbors[J]);if(kUe(s,F,J)){NUe(t,J,F);continue}const G=v(F);Re(!G||F.level===s.level),Re(!G||g_(s,F)<=0);const W=F==null?void 0:F.renderData,Z=W==null?void 0:W.geometryState;if(Qs){const et=s.surface;if(!F&&et&&!et.updatingRootTiles){const pt=Hg[J],gt=s.findNeighborTile(pt,Rt=>Rt.isLoaded||Rt.isLeaf||Rt.level===s.level);gt?gt.intersectsClippingArea&&(Re(!gt.isLoaded),Re(!gt.isLeaf),Re(gt.level===o)):Re(R(et==null?void 0:et.rootTiles)||!s.shouldHaveNeighbor(pt))}}const X=J===1?a[2]:a[0],oe=F==null?void 0:F.extent,pe=oe&&q?J===1?oe[0]:oe[2]:X,ye=J===0?a[3]:a[1],Se=J===1?1:0,He=J===0?1:0,De=J===1?p:h,Te=J===0?m:f,ke=Math.sin(De),ze=Math.cos(De),bt=Math.sin(Te),it=Math.cos(Te),jt=Z==null?void 0:Z.samplerData,Qt=G?(et,pt,gt)=>.5*(sn(et,pt,g)+sn(gt,pt,jt)):(et,pt,gt)=>sn(et,pt,g),oi=r.outerEdges[J],ei=e&&L>3?L-3:1,wi=v(g)&&g.some(et=>et!=null),or=v(jt)&&jt.some(et=>et!=null),Ii=wi||or,Oi=1/N,at=oi.index0;D?(Re(!oe||ap(oe[2]-oe[0],a[2]-a[0])),(()=>{const et=J===1?-1:J===3?1:0,pt=J===0?-1:J===2?1:0,gt=(a[2]-a[0])*Oi,Rt=et*gt,Yt=pt*gt,Ni=q?et*((p-h)*Oi):0,Fi=q?0:pt*Oi,ki=He,Ui=q?De+Ni:De,Fr=q?Math.sin(Ui):ke,hi=q?Math.cos(Ui):ze,Ai=q?De-Ni:De,xi=q?Math.sin(Ai):ke,kn=q?Math.cos(Ai):ze,pr=q?Te:T(ki+Fi),ln=q?bt:Math.sin(pr),kr=q?it:Math.cos(pr),Qr=q?Te:T(ki-Fi),Rn=q?bt:Math.sin(Qr),ts=q?it:Math.cos(Qr);let qo=0,vo=0,Un=0;{const fr=0*Oi,Ea=q?X:_*(1-fr)+b*fr,ic=q?pe:Ea,de=q?w*(1-fr)+x*fr:ye,Ar=q?De:h*(1-fr)+p*fr,Hp=q?ke:Math.sin(Ar),Xa=q?ze:Math.cos(Ar),oh=q?T(fr):Te,yt=q?Math.sin(oh):bt,tu=q?Math.cos(oh):it,vn=l+Qt(Ea,de,ic);qo=Xa*tu*vn,vo=Hp*tu*vn,Un=yt*vn}let cn=0,un=0,Vn=0;{const fr=1*Oi,Ea=q?X:_*(1-fr)+b*fr,ic=q?pe:Ea,de=q?w*(1-fr)+x*fr:ye,Ar=q?De:h*(1-fr)+p*fr,Hp=q?ke:Math.sin(Ar),Xa=q?ze:Math.cos(Ar),oh=q?T(fr):Te,yt=q?Math.sin(oh):bt,tu=q?Math.cos(oh):it,vn=l+Qt(Ea,de,ic);cn=Xa*tu*vn,un=Hp*tu*vn,Vn=yt*vn}for(let fr=1;fr<L-1;fr+=ei){let Ea=0,ic=0,de=0;{const Ca=(fr+1)*Oi,md=q?X:_*(1-Ca)+b*Ca,gd=q?pe:md,mr=q?w*(1-Ca)+x*Ca:ye,Pm=q?De:h*(1-Ca)+p*Ca,$y=q?ke:Math.sin(Pm),tE=q?ze:Math.cos(Pm),qw=q?T(Ca):Te,iE=q?Math.sin(qw):bt,Ww=q?Math.cos(qw):it,ov=l+Qt(md,mr,gd);Ea=tE*Ww*ov,ic=$y*Ww*ov,de=iE*ov}const Ar=Ea,Hp=ic,Xa=de,oh=cn,yt=un,tu=Vn;cn=Ar,un=Hp,Vn=Xa;{const Ca=at+fr,md=Ca*ee,gd=oh-A,mr=yt-I,Pm=tu-O;B[md]=gd,B[md+1]=mr,B[md+2]=Pm,Jl(gd,mr,Pm,E);const $y=fr*Oi;Zu(ie,Ca,q?Se:$y,q?$y:He)}const vn=qo,Hw=vo,K7=Un;qo=oh,vo=yt,Un=tu;const rc=oh,rv=yt,Py=tu,ai=1/Math.sqrt(rc*rc+rv*rv+Py*Py),hF=Py*ai;let Iy=0,nv=0,sv=0;if(Ii&&hF*hF<.999){let Ca=0,md=0,gd=0;{const mr=J===0?-1:1;Ca=mr*(Ar-vn),md=mr*(Hp-Hw),gd=mr*(Xa-K7)}{const mr=fr*Oi,Pm=q?X:_*(1-mr)+b*mr,$y=q?pe:Pm,tE=q?w*(1-mr)+x*mr:ye,qw=q?De:h*(1-mr)+p*mr,iE=q?ke:Math.sin(qw),Ww=q?ze:Math.cos(qw),ov=q?T(mr):Te,nc=q?Math.sin(ov):bt,dF=q?Math.cos(ov):it;let JO=rc,Y=rv,xe=Py;if(G){const Me=l+sn($y-Rt,tE-Yt,jt),_i=q?dF:ts;JO=(q?kn:Ww)*_i*Me,Y=(q?xi:iE)*_i*Me,xe=(q?nc:Rn)*Me}{const Me=l+sn(Pm+Rt,tE+Yt,g),_i=q?dF:kr,bo=(q?hi:Ww)*_i*Me,zn=(q?Fr:iE)*_i*Me,sc=(q?nc:ln)*Me;G||(JO=2*rc-bo,Y=2*rv-zn,xe=2*Py-sc);const av=J===3?-1:1,Wce=av*(JO-bo),Xce=av*(Y-zn),Yce=av*(xe-sc);Iy=gd*Xce-md*Yce,nv=Ca*Yce-gd*Wce,sv=md*Wce-Ca*Xce;const Q7=1/Math.sqrt(Iy*Iy+nv*nv+sv*sv);Iy*=Q7,nv*=Q7,sv*=Q7}}}else Iy=rc*ai,nv=rv*ai,sv=Py*ai;oi.setNormalFromValues(fr,Iy,nv,sv)}})()):(()=>{for(let et=1;et<L-1;et+=ei){const pt=et*Oi,gt=q?Se:pt,Rt=q?pt:He,Yt=q?X:_*(1-pt)+b*pt,Ni=q?w*(1-pt)+x*pt:ye,Fi=q?pe:Yt,ki=q?De:h*(1-pt)+p*pt,Ui=q?ke:Math.sin(ki),Fr=q?ze:Math.cos(ki),hi=q?T(pt):Te,Ai=q?Math.sin(hi):bt,xi=q?Math.cos(hi):it,kn=Qt(Yt,Ni,Fi),pr=l+kn,ln=Fr*xi*pr-A,kr=Ui*xi*pr-I,Qr=Ai*pr-O;Jl(ln,kr,Qr,E);const Rn=at+et,ts=Rn*ee;B[ts]=ln,B[ts+1]=kr,B[ts+2]=Qr,Zu(ie,Rn,gt,Rt)}})()}}function MUe(t){FUe(t)}function OUe(t,e){return Math.PI/2-2*Math.atan(Math.exp(-t/e))}function mNt(t,e,i,r){return OUe(t*(1-r)+e*r,i)}function gNt(t,e,i){return t*(1-i)+e*i}function Fce(t){const e=t.tile;if(e.surface.isWebMercator){const r=e.extent,n=e.ellipsoid.radius;return s=>mNt(r[1],r[3],n,s)}const i=e.extentInRadians;return r=>gNt(i[1],i[3],r)}function yNt(t,e){const i=t.tile.extent,r=t.geometryState,n=i[0],s=i[1],o=i[2]-n,a=i[3]-s,l=r.clippingArea,c=v(l)?Math.max(0,(l[0]-n)/o):0,h=v(l)?Math.max(0,(l[1]-s)/a):0,p=v(l)?Math.min(1,(l[2]-n)/o):1,f=v(l)?Math.min(1,(l[3]-s)/a):1,m=r.numVerticesPerSide,g=(m-2)**2,_=r.neighborData.edgeResolutions.reduce((T,E)=>T+E+1,0),b=dUe(g+_),w=t.geometryInfo,x=w.boundingBox;Br(x),w.numVerticesPerSide=r.numVerticesPerSide,w.vertexAttributes=b,cr(w.uvRange,c,h,p,f),_Nt(t),DUe(t,g),PUe(t),LUe(w,r.numVerticesPerSide,[],[0,m-1],[0,m-1],r.wireframe),t.intersectionData=null}function _Nt(t){const e=t.tile;e.intersectsClippingArea&&(e.surface.shading?bNt(t):vNt(t))}function vNt(t){const e=t.geometryState,i=e.samplerData,r=t.tile,n=r.surface,s=t.localOrigin,o=n.isWebMercatorOnPlateeCarree,a=e.clippingArea,l=v(a)?a:W7,c=r.extent,h=c[0],p=c[1],f=c[2],m=c[3],g=Math.max(h,l[0]),_=Math.min(f,l[2]),b=Math.max(p,l[1]),w=Math.min(m,l[3]),x=s[0],T=s[1],E=s[2],C=r.ellipsoid.radius,A=r.horizontalScale,I=kce(o,C,A),O=e.numVerticesPerSide,D=O-1,U=O-2,V=t.geometryInfo,B=V.uvRange,ee=B[0],ie=B[1],J=B[2],q=B[3],N=V.boundingBox,L=V.vertexAttributes,F=L.position,G=L.uv0;let W=0;for(let Z=1;Z<=U;Z++){const X=Z/D,oe=_e(p*(1-X)+m*X,b,w),pe=_e(X,ie,q),ye=I(oe)-T;for(let Se=1;Se<=U;Se++){const He=Se/D,De=_e(h*(1-He)+f*He,g,_),Te=_e(He,ee,J),ke=De*A-x,ze=sn(De,oe,i)-E;Jl(ke,ye,ze,N),F.setValues(W,ke,ye,ze),Zu(G,W,Te,pe),++W}}}function bNt(t){const e=t.tile,i=e.surface;if(!(i.shading||L2))return;const r=t.geometryState,n=r.samplerData,s=t.localOrigin,o=i.isWebMercatorOnPlateeCarree,a=r.clippingArea,l=v(a)?a:W7,c=e.extent,h=c[0],p=c[1],f=c[2],m=c[3],g=Math.max(h,l[0]),_=Math.min(f,l[2]),b=Math.max(p,l[1]),w=Math.min(m,l[3]),x=e.ellipsoid.radius,T=e.horizontalScale,E=r.numVerticesPerSide,C=E-1,A=E-2,I=t.geometryInfo,O=I.vertexAttributes,D=O.position,U=O.uv0,V=O.normalCompressed,B=I.uvRange,ee=B[0],ie=B[1],J=B[2],q=B[3],N=I.boundingBox,L=s[0],F=s[1],G=s[2],W=D.typedBuffer,Z=D.typedBufferStride;let X=0;const oe=_e(p,b,w),pe=o?(Math.PI/2-2*Math.atan(Math.exp(-oe/x)))*x:oe*T,ye=1/C,Se=_e(p*(1-ye)+m*ye,b,w);let He=pe,De=o?(Math.PI/2-2*Math.atan(Math.exp(-Se/x)))*x:Se*T;for(let Te=1;Te<=A;Te++){const ke=Te/C,ze=_e(p*(1-ke)+m*ke,b,w),bt=_e(ke,ie,q),it=De,jt=(Te-1)/C,Qt=_e(p*(1-jt)+m*jt,b,w),oi=He,ei=(Te+1)/C,wi=_e(p*(1-ei)+m*ei,b,w),or=o?(Math.PI/2-2*Math.atan(Math.exp(-wi/x)))*x:wi*T,Ii=_e(ei,ie,q);He=De,De=or;const Oi=_e(h,g,_);let at=Oi*T,et=sn(Oi,ze,n);const pt=1/C,gt=_e(pt,ee,J),Rt=_e(h*(1-gt)+f*gt,g,_);let Yt=gt,Ni=Rt,Fi=Rt*T,ki=sn(Rt,ze,n);if(Te===1){const Ui=Fi-L,Fr=He-F,hi=ki-G,Ai=0*Z;W[Ai]=Ui,W[Ai+1]=Fr,W[Ai+2]=hi,Jl(Ui,Fr,hi,N);const xi=_e(pt,ee,J);Zu(U,X,xi,bt)}for(let Ui=1;Ui<=A;Ui++){const Fr=Fi,hi=ki,Ai=(Ui+1)/C,xi=_e(Ai,ee,J),kn=_e(h*(1-Ai)+f*Ai,g,_),pr=Ni;Ni=kn;{const Un=X+1,cn=Un*Z;if(Te===1||Ui===A){const un=kn*T,Vn=sn(kn,ze,n);if(Te===1&&Ui<A){const fr=un-L,Ea=it-F,ic=Vn-G;W[cn]=fr,W[cn+1]=Ea,W[cn+2]=ic,Jl(fr,Ea,ic,N),Zu(U,Un,xi,bt)}Fi=un,ki=Vn}else Fi=W[cn]+L,ki=W[cn+2]+G}const ln=Fi,kr=ki,Qr=at,Rn=et;at=Fr,et=hi;const ts=(X-A)*Z,qo=Te===1?sn(pr,Qt,n):W[ts+2]+G,vo=sn(pr,wi,n);if(Te<A){const Un=X+A,cn=Un*Z,un=Fr-L,Vn=or-F,fr=vo-G;W[cn]=un,W[cn+1]=Vn,W[cn+2]=fr,Jl(un,Vn,fr,N);const Ea=Yt;Yt=xi,Zu(U,Un,Ea,Ii)}{const Un=ln-Qr,cn=oi-or,un=cn*(kr-Rn),Vn=Un*(qo-vo),fr=-cn*Un,Ea=un*un+Vn*Vn+fr*fr;if(Ea===0)YD(V,X,0,0,1);else{const ic=1/Math.sqrt(Ea);YD(V,X,un*ic,Vn*ic,fr*ic)}}++X}}}function wNt(t,e){t.tile.intersectsClippingArea&&($Ue(t),IUe(t,!0),q7(t))}function xNt(t,e){t.tile.intersectsClippingArea&&(PUe(t),q7(t))}function PUe(t,e){t.tile.intersectsClippingArea&&($Ue(t),IUe(t,!1))}function IUe(t,e){const i=t.geometryState,r=i.neighborData,n=t.tile,s=n.surface,o=s.shading||L2,a=n.extent,l=i.clippingArea,c=v(l)?l:W7,h=a[0],p=a[2],f=a[1],m=a[3],g=[m>c[3],p>c[2],f<c[1],h<c[0]],_=t.geometryInfo,b=n.horizontalScale,w=kce(s.isWebMercatorOnPlateeCarree,n.ellipsoid.radius,b),x=_.boundingBox,T=_.uvRange[0],E=_.uvRange[1],C=_.uvRange[2],A=_.uvRange[3],I=Math.max(h,c[0]),O=Math.min(p,c[2]),D=Math.max(f,c[1]),U=Math.min(m,c[3]),V=t.localOrigin,B=V[0],ee=V[1],ie=V[2],J=i.samplerData;for(let q=0;q<4;++q){const N=q===1||q===3,L=r.edgeResolutions[q];Re(mm(L));const F=L+1,G=g[q],W=lS(n,r.edgePeerNeighbors[q]);if(!G&&kUe(n,W,q)){NUe(t,q,W);continue}const Z=v(W)&&!G,X=W==null?void 0:W.renderData,oe=X==null?void 0:X.geometryState;if(Qs&&(Re(!Z||W.level===n.level),Re(!Z||g_(n,W)<=0),n&&!W&&!s.updatingRootTiles)){const bt=Hg[q],it=n.findNeighborTile(bt,jt=>jt.isLoaded||jt.isLeaf||jt.level===n.level);s.updatingRootTiles||(it?it.intersectsClippingArea&&(Re(!it.isLoaded),Re(!it.isLeaf),Re(it.level===n.level)):Re(R(s==null?void 0:s.rootTiles)||!n.shouldHaveNeighbor(bt)))}const pe=_e(q===1?p:h,I,O),ye=_e(q===0?m:f,D,U),Se=oe==null?void 0:oe.samplerData,He=_.outerEdges[q],De=e&&F>3?F-3:1,Te=_e(q===1?1:0,T,C),ke=_e(q===0?1:0,E,A),ze=Z?(bt,it)=>.5*(sn(bt,it,Se)+sn(bt,it,J)):(bt,it)=>sn(bt,it,J);if(o){const bt=(p-h)/L,it=N?q===1?bt:-bt:0,jt=N?0:q===0?bt:-bt,Qt=-it,oi=-jt;let ei=0,wi=0,or=0;{const et=0/L,pt=N?pe:_e(h*(1-et)+p*et,I,O),gt=N?_e(f*(1-et)+m*et,D,U):ye,Rt=ze(pt,gt);ei=pt*b,wi=w(gt),or=Rt}let Ii=0,Oi=0,at=0;{const et=1/L,pt=N?pe:_e(h*(1-et)+p*et,I,O),gt=N?_e(f*(1-et)+m*et,D,U):ye,Rt=ze(pt,gt);Ii=pt*b,Oi=w(gt),at=Rt}for(let et=1;et<F-1;et+=De){const pt=et/L,gt=Ii,Rt=Oi,Yt=at;{const pr=N?Te:_e(pt,T,C),ln=N?_e(pt,E,A):ke,kr=gt-B,Qr=Rt-ee,Rn=Yt-ie;Jl(gt,Qr,Rn,x),He.setVertexFromValuesRawPositionUV(et,kr,Qr,Rn,pr,ln)}{const pr=(et+1)/L,ln=N?pe:_e(h*(1-pr)+p*pr,I,O),kr=N?_e(f*(1-pr)+m*pr,D,U):ye,Qr=ze(ln,kr);Ii=ln*b,Oi=w(kr),at=Qr}const Ni=Ii,Fi=at,ki=ei,Ui=wi,Fr=or;ei=gt,wi=Rt,or=Yt;let hi=0,Ai=0,xi=0;if(N){const pr=Oi-Rt,ln=Fi-Yt,kr=Ui-Rt,Qr=Fr-Yt,Rn=_e(f*(1-pt)+m*pt,D,U),ts=pe+Qt,qo=ts*b-gt,vo=sn(ts,Rn,J)-Yt,Un=q===3?-1:1;if(hi=Un*(-kr+pr)*vo,Ai=Un*qo*(-Qr+ln),xi=-Un*qo*(-kr+pr),Z){const cn=pe+it,un=cn*b-gt;hi=(-kr+pr)*(vo-(sn(cn,Rn,Se)-Yt)),Ai=(qo-un)*(-Qr+ln),xi=-(qo-un)*(-kr+pr)}}else{const pr=Ni-gt,ln=Fi-Yt,kr=ki-gt,Qr=Fr-Yt,Rn=_e(h*(1-pt)+p*pt,I,O),ts=ye+oi,qo=sn(Rn,ts,J)-Yt,vo=w(ts)-Rt,Un=q===2?-1:1;if(hi=Un*vo*(-Qr+ln),Ai=Un*(-kr+pr)*qo,xi=-Un*vo*(-kr+pr),Z){const cn=Rn,un=ye+jt,Vn=w(un)-Rt;hi=(-vo+Vn)*(-Qr+ln),Ai=(-kr+pr)*(-qo+(sn(cn,un,Se)-Yt)),xi=-(-vo+Vn)*(-kr+pr)}}const kn=1/Math.sqrt(hi*hi+Ai*Ai+xi*xi);He.setNormalFromValues(et,hi*kn,Ai*kn,xi*kn)}}else for(let bt=1;bt<F-1;bt+=De){const it=bt/L,jt=N?pe:_e(h*(1-it)+p*it,I,O),Qt=N?_e(f*(1-it)+m*it,D,U):ye,oi=N?Te:_e(it,T,C),ei=N?_e(it,E,A):ke,wi=ze(jt,Qt),or=jt*b-B,Ii=w(Qt)-ee,Oi=wi-ie;Jl(or,Ii,Oi,x),He.setVertexFromValuesRawPositionUV(bt,or,Ii,Oi,oi,ei)}}}function $Ue(t,e){FUe(t)}function TNt(t,e){return(Math.PI/2-2*Math.atan(Math.exp(-t/e)))*e}function SNt(t,e){return t*e}function kce(t,e,i){return t?r=>TNt(r,e):r=>SNt(r,i)}function LUe(t,e,i,r,n,s){const o=e-1,a=t.vertexAttributes.count,l=2*(Math.min(e-2,r[1])-Math.max(1,r[0]))*(Math.min(e-2,n[1])-Math.max(1,n[0])),c=Hg.map((T,E)=>E===0&&n[1]<e-2||E===1&&r[1]<e-2||E===2&&n[0]>1||E===3&&r[0]>1),h=t.outerEdges.reduce((T,E,C)=>T+(c[C]?0:o-2+E.count-1),0),p=i.reduce((T,E)=>T+o*(2*(E.latitudeResolution-1)+1),0),f=s?2:1,m=3*(l+h+p)*f,g=a>=lNt?new Uint32Array(m):new Uint16Array(m);let _=0;const b=e-2,w=o-2;Re(w>=0);const x=(T,E,C,A,I,O)=>{const D=T*I,U=O[D],V=O[D+1],B=O[D+2],ee=E*I,ie=O[ee],J=O[ee+1],q=O[ee+2],N=C*I,L=O[N],F=O[N+1],G=O[N+2],W=A*I,Z=O[W],X=O[W+1],oe=O[W+2];return(ie-Z)*(ie-Z)+(J-X)*(J-X)+(q-oe)*(q-oe)>(U-L)*(U-L)+(V-F)*(V-F)+(B-G)*(B-G)};if(s){const T=(C,A,I)=>{g[_++]=C,g[_++]=A,g[_++]=A,g[_++]=I,g[_++]=I,g[_++]=C,Qs&&(Re(C<a),Re(A<a),Re(I<a),Re(_<=m))};(()=>{for(let C=Math.max(n[0],1)-1;C<Math.min(n[1],e-2)-1;++C){const A=C*b;for(let I=Math.max(r[0],1)-1;I<Math.min(r[1],e-2)-1;++I){const O=C*b+I,D=O+1,U=D+b,V=U-1,B=A+I,ee=B+1,ie=ee+b,J=ie-1,q=t.vertexAttributes.position.typedBuffer,N=t.vertexAttributes.position.typedBufferStride;x(B,ee,ie,J,N,q)?(T(O,D,U),T(U,V,O)):(T(O,D,V),T(V,U,D))}}})(),Re(_===3*l*f),(()=>{for(let C=0;C<4;++C){const A=_;if(c[C])continue;const I=t.outerEdges[C],O=t.innerEdges[C];let D=0,U=0;const V=I.count,B=O.count;Re(B===o-1);let ee=0;const ie=C===1||C===2?(J,q,N)=>T(J,q,N):(J,q,N)=>T(J,N,q);for(;D<V-1||U<B-1;){const J=O.getVertexIndex(U),q=I.getVertexIndex(D),N=D<V-1,L=U<B-1;N&&(!L||(N?0+o*(D+.5)/(V-1):0)<=(L?1+w*(U+.5)/(B-1):0))?(++D,Qs&&Re(D<V),ie(J,q,I.getVertexIndex(D)),ee++):(++U,Qs&&Re(U<B),ie(J,q,O.getVertexIndex(U)),ee++)}Qs&&(Re(D===V-1),Re(U===B-1),Re(ee===V+B-2),Re(ee===o-2+I.count-1),Re(_===A+3*ee*f))}})(),Re(_===3*(l+h)*f);const E=C=>{const A=t.outerEdges[C.connectedOuterEdgeOffset];let I=A.getVertexIndex(0),O=A.stride;for(let D=0;D<C.latitudeResolution;++D){const U=D===0?C.rowOffset:I+e;for(let V=0;V<o;V++)T(I,I+1,U+V),D<C.latitudeResolution-1&&T(I+1,U+V+1,U+V),I+=O;I=U,O=1}};i.forEach(E)}else{(()=>{const E=Math.max(n[0],1)-1,C=Math.min(n[1],e-2)-1,A=Math.max(r[0],1)-1,I=Math.min(r[1],e-2)-1;for(let O=E;O<C;++O){const D=O*b;for(let U=A;U<I;++U){const V=D+U,B=V+1,ee=B+b,ie=ee-1,J=t.vertexAttributes.position.typedBuffer,q=t.vertexAttributes.position.typedBufferStride;x(V,B,ee,ie,q,J)?(g[_]=V,g[_+1]=B,g[_+2]=ee,g[_+3]=ee,g[_+4]=ie,g[_+5]=V):(g[_]=V,g[_+1]=B,g[_+2]=ie,g[_+3]=ie,g[_+4]=B,g[_+5]=ee),_+=6}}})(),Re(_===3*l*f),(()=>{for(let E=0;E<4;++E){if(c[E])continue;const C=t.outerEdges[E],A=t.innerEdges[E];let I=0,O=0;const D=C.count,U=A.count;Re(U===o-1);const V=E===1||E===2,B=V?1:2,ee=V?2:1,ie=C.index0,J=C.stride,q=A.index0,N=A.stride;for(;I<D-1||O<U-1;){const L=q+O*N,F=ie+I*J,G=I<D-1,W=O<U-1,Z=G&&(!W||(G?0+o*(I+.5)/(D-1):0)<=(W?1+w*(O+.5)/(U-1):0));Z?++I:++O;const X=Z?F+J:L+N;g[_]=L,g[_+B]=F,g[_+ee]=X,_+=3}}})(),Re(_===3*(l+h)*f);const T=E=>{const C=t.outerEdges[E.connectedOuterEdgeOffset];let A=C.getVertexIndex(0),I=C.stride;for(let O=0;O<E.latitudeResolution;++O){const D=O===0?E.rowOffset:A+e;for(let U=0;U<o;U++){const V=D+U;g[_]=A,g[_+1]=A+1,g[_+2]=V,O<E.latitudeResolution-1?(g[_+3]=A+1,g[_+4]=V+1,g[_+5]=V,_+=6):_+=3,A+=I}A=D,I=1}};i.forEach(T)}Re(_===m),t.indices=g,t.indexCount=m}function DUe(t,e){const i=t.localOrigin,r=t.geometryInfo,n=t.geometryState.neighborData.edgeResolutions,s=r.numVerticesPerSide-2,o=r.vertexAttributes;let a=e;for(let l=0;l<4;++l){{const c=l===0||l===2,h=(l===0?s-1:0)*s+(l===1?s-1:0),p=(c?0:1)*s+(c?1:0);r.innerEdges[l]=new K1e(o,i,h,p,s)}{const c=a,h=n[l]+1;r.outerEdges[l]=new K1e(o,i,c,1,h),a+=h}}}function NUe(t,e,i){const r=(e+2)%4,n=t.geometryState,s=t.tile,o=n.neighborData,a=s.level-i.level,l=e===1||e===3,c=o.edgeResolutions[e];Re(mm(c));const h=c+1,p=t.geometryInfo,f=p.boundingBox,m=p.outerEdges[e],g=p.uvRange[0],_=p.uvRange[1],b=p.uvRange[2],w=p.uvRange[3],x=_e(e===1?1:0,g,b),T=_e(e===0?1:0,_,w),E=i.renderData,C=E.geometryState,A=E.geometryInfo.outerEdges[r],I=s.getNeighborEdgeStartVertexIndex(e,i)*c,O=c*2**a;Re(C.neighborData.edgeResolutions[r]===O),Re(A.count-1===O);const D=E.localOrigin[0]-t.localOrigin[0],U=E.localOrigin[1]-t.localOrigin[1],V=E.localOrigin[2]-t.localOrigin[2],B=m.attributes,ee=m.index0,ie=m.stride,J=B.position.typedBuffer,q=B.position.typedBufferStride,N=B.normalCompressed.typedBuffer,L=B.normalCompressed.typedBufferStride,F=B.uv0,G=A.attributes,W=A.index0,Z=A.stride,X=G.position.typedBuffer,oe=G.position.typedBufferStride,pe=G.normalCompressed.typedBuffer,ye=G.normalCompressed.typedBufferStride;for(let Se=1;Se<h-1;++Se){const He=ee+ie*Se,De=W+Z*(I+Se),Te=He*q,ke=De*oe,ze=X[ke]+D,bt=X[ke+1]+U,it=X[ke+2]+V;J[Te]=ze,J[Te+1]=bt,J[Te+2]=it,Jl(ze,bt,it,f);const jt=He*L,Qt=De*ye;N[jt]=pe[Qt],N[jt+1]=pe[Qt+1];const oi=Se/c,ei=l?x:_e(oi,g,b),wi=l?_e(oi,_,w):T;Zu(F,He,ei,wi)}}function FUe(t){var ke;const e=t.geometryState,i=e.neighborData,r=t.localOrigin,n=i.cornerNeighborData,s=t.geometryInfo,o=s.outerEdges,a=s.boundingBox,l=t.tile,c=((ke=t.tile.surface.view)==null?void 0:ke.viewingMode)==="local",h=l.ellipsoid.radius,p=l.extentInRadians,f=l.horizontalScale;let m=0,g=0,_=0;const b=(ze,bt,it)=>{const jt=p[bt===0?1:3],Qt=p[ze===0?0:2],oi=Math.cos(jt),ei=Math.sin(jt),wi=Math.sin(Qt),or=Math.cos(Qt),Ii=h+it;m=or*oi*Ii,g=wi*oi*Ii,_=ei*Ii},w=c?(()=>{const ze=t.geometryState.clippingArea,bt=l.extent,it=v(ze)&&(bt[3]>ze[3]||bt[2]>ze[2]||bt[1]<ze[1]||bt[0]<ze[0]),jt=kce(l.surface.isWebMercatorOnPlateeCarree,l.ellipsoid.radius,f);return(Qt,oi,ei)=>{const wi=Qt===0?ee[0]:ee[2],or=oi===0?ee[1]:ee[3],Ii=it?_e(wi,ze[0],ze[2]):wi,Oi=it?_e(or,ze[1],ze[3]):or,at=ei;m=Ii*f,g=jt(Oi),_=at}})():b;let x=0,T=0,E=0,C=0,A=0,I=0,O=0,D=0,U=0;const V=c&&t.tile.surface.isWebMercatorOnPlateeCarree,B=(ze,bt,it,jt,Qt)=>{let oi=0,ei=0,wi=0;if(c){const or=bt*f,Ii=V?(Math.PI/2-2*Math.atan(Math.exp(-it/h)))*h:it*f;oi=or-m,ei=Ii-g,wi=jt-_}else{const or=Fce(ze),Ii=ze.tile,Oi=Ii.extent,at=Ii.extentInRadians,et=(bt-Oi[0])/(Oi[2]-Oi[0]),pt=(it-Oi[1])/(Oi[3]-Oi[1]),gt=at[0]*(1-et)+at[2]*et,Rt=or(pt),Yt=Math.cos(Rt),Ni=Math.sin(Rt),Fi=Math.sin(gt),ki=Math.cos(gt),Ui=h+jt;oi=ki*Yt*Ui-m,ei=Fi*Yt*Ui-g,wi=Ni*Ui-_}switch(Qt){case 0:O+=oi,D+=ei,U+=wi;break;case 1:C-=oi,A-=ei,I-=wi;break;case 2:O-=oi,D-=ei,U-=wi;break;case 3:C+=oi,A+=ei,I+=wi}},ee=l.extent,ie=e.clippingArea,J=v(ie)?ie:W7,q=ee[0],N=ee[2],L=ee[1],F=ee[3],G=[F>J[3],N>J[2],L<J[1],q<J[0]],W=Math.max(q,J[0]),Z=Math.min(N,J[2]),X=Math.max(L,J[1]),oe=Math.min(F,J[3]),pe=s.uvRange[0],ye=s.uvRange[1],Se=s.uvRange[2],He=s.uvRange[3],De=l.surface.shading||L2,Te=ze=>{var Oi;const bt=n[ze].cornerTiles;x=0,T=0,E=1;let it=1/0;for(let at=0;at<4;++at)it=Math.min(it,((Oi=bt[at])==null?void 0:Oi.level)??1/0);for(let at=0;at<4;++at){const et=bt[at];hP[at]=(et==null?void 0:et.level)===it?et:null}let jt=1,Qt=0;for(let at=0;at<4;++at){const et=hP[at];et&&(jt=Math.max(jt,et==null?void 0:et.renderData.geometryState.numVerticesPerSide),Qt=et.extent[2]-et.extent[0])}const oi=Qt,ei=jt;Re(ei>1);const wi=oi/ei;for(let at=0;at<4;++at){const et=hP[(at+3)%4],pt=hP[at%4];if(!et&&!pt)continue;const gt=at===0?1:at===1?2:at===2?3:0,Rt=at===0?2:at===1?3:at===2?0:1;if(et&&pt){const Yt=$W[at][0]*wi,Ni=$W[at][1]*wi,Fi=et.extent,ki=Fi[gt===0||gt===1?2:0]+Yt,Ui=Fi[gt===0||gt===3?3:1]+Ni,Fr=pt.extent,hi=Fr[Rt===0||Rt===1?2:0]+Yt,Ai=Fr[Rt===0||Rt===3?3:1]+Ni,xi=et.renderData,kn=pt.renderData,pr=sn(ki,Ui,xi.geometryState.samplerData),ln=sn(hi,Ai,kn.geometryState.samplerData);B(xi,ki,Ui,.5*(pr+ln),at)}else{const Yt=et??pt,Ni=et?gt:Rt,Fi=Yt.extent,ki=$W[at],Ui=Fi[Ni===0||Ni===1?2:0]+ki[0]*wi,Fr=Fi[Ni===0||Ni===3?3:1]+ki[1]*wi,hi=Yt.renderData,Ai=sn(Ui,Fr,hi.geometryState.samplerData);B(hi,Ui,Fr,Ai,at)}}if(!c){const at=Math.sqrt(m*m+g*g+_*_);x=m/at,T=g/at,E=_/at}const or=Math.sqrt(C*C+A*A+I*I);C/=or,A/=or,I/=or;const Ii=Math.sqrt(O*O+D*D+U*U);if(O/=Ii,D/=Ii,U/=Ii,c||E*E<.999){x=I*D-A*U,T=C*U-I*O,E=A*O-C*D;const at=1/Math.sqrt(x*x+T*T+E*E);x*=at,T*=at,E*=at}};for(let ze=0;ze<4;++ze){const bt=ze,it=(ze+1)%4,jt=ze===0||ze===1?1:0,Qt=ze===0||ze===3?1:0,oi=_e(jt,pe,Se),ei=_e(Qt,ye,He),wi=o[bt],or=ze===0||ze===3?wi.count-1:0,Ii=o[it],Oi=ze===0||ze===1?Ii.count-1:0,at=n[ze].cornerTiles;let et=-1;for(let Rt=0;Rt<4;++Rt){const Yt=at[Rt];Yt&&(et===-1||g_(at[et],Yt)>0)&&(et=Rt)}const pt=et,gt=at[pt];if(x=0,T=0,E=1,gt!==l){const Rt=l.level-gt.level,Yt=2**Rt,Ni=[gt.lij[0]+Rt,gt.lij[1]*Yt,gt.lij[2]*Yt],Fi=[Ni[1]+Yt===l.lij[1],ze===0&&(pt===1||pt===0&&gt!==at[3])||ze===1&&(pt===0||pt===1&&gt!==at[2]),Ni[1]===l.lij[1]+1,ze===2&&(pt===3||pt===2&&gt!==at[1])||ze===3&&(pt===2||pt===3&&gt!==at[0])],ki=Fi.reduce((xi,kn)=>xi+(kn?1:0),0);Re(ki===1||ki===2);let Ui=-1,Fr=-1;const hi=gt.renderData;if(ki===1){const xi=Fi.findIndex(pr=>pr);Re(0<=xi&&xi<=3),Ui=(xi+2)%4;const kn=t.geometryState.neighborData.edgeResolutions[xi];Fr=l.getNeighborEdgeStartVertexIndex(xi,gt)*kn+kn*(xi===0&&ze===0||xi===1&&ze===0||xi===2&&ze===1||xi===3&&ze===3?1:0)}else{Re(Fi[1]||Fi[3]),Ui=Fi[1]?3:1;const xi=hi.geometryState.neighborData.edgeResolutions[Ui];Fr=ze===0||ze===3?0:xi}const Ai=hi.geometryInfo.outerEdges[Ui];{const xi=wi.index0+or*wi.stride,kn=Ii.index0+Oi*Ii.stride,pr=Ai.index0+Fr*Ai.stride;{const ln=Ai.attributes.position,kr=ln.typedBuffer,Qr=pr*ln.typedBufferStride,Rn=t.localOrigin,ts=Ai.localOrigin,qo=kr[Qr]+ts[0]-Rn[0],vo=kr[Qr+1]+ts[1]-Rn[1],Un=kr[Qr+2]+ts[2]-Rn[2];Jl(qo,vo,Un,a);{const cn=wi.attributes.position,un=cn.typedBuffer,Vn=xi*cn.typedBufferStride;un[Vn]=qo,un[Vn+1]=vo,un[Vn+2]=Un}{const cn=Ii.attributes.position,un=cn.typedBuffer,Vn=kn*cn.typedBufferStride;un[Vn]=qo,un[Vn+1]=vo,un[Vn+2]=Un}}Zu(wi.attributes.uv0,xi,oi,ei),Zu(Ii.attributes.uv0,kn,oi,ei);{const ln=Ai.attributes.normalCompressed.typedBuffer,kr=pr*Ai.attributes.normalCompressed.typedBufferStride;{const Qr=wi.attributes.normalCompressed,Rn=Qr.typedBuffer,ts=xi*Qr.typedBufferStride;Rn[ts]=ln[kr],Rn[ts+1]=ln[kr+1]}{const Qr=Ii.attributes.normalCompressed,Rn=Qr.typedBuffer,ts=kn*Qr.typedBufferStride;Rn[ts]=ln[kr],Rn[ts+1]=ln[kr+1]}}}}else{const Rt=G[bt],Yt=G[it];let Ni;if(Rt||Yt){const Fr=_e(q*(1-jt)+N*jt,W,Z),hi=_e(L*(1-Qt)+F*Qt,X,oe),Ai=e.samplerData;Ni=sn(Fr,hi,Ai)}else Ni=ENt(at);w(jt,Qt,Ni),(De||L2)&&Te(ze);const Fi=m-r[0],ki=g-r[1],Ui=_-r[2];Jl(Fi,ki,Ui,a),wi.setVertexFromValuesRawPositionUVNormal(or,Fi,ki,Ui,oi,ei,x,T,E),Ii.setVertexFromValuesRawPositionUVNormal(Oi,Fi,ki,Ui,oi,ei,x,T,E)}}for(let ze=0;ze<4;++ze)hP[ze]=null}function ENt(t){var s,o;const e=t.reduce((a,l)=>Math.min(a,(l==null?void 0:l.level)??1/0),1/0);Qs&&(Re(!t[0]||!t[2]||oie(t[0],t[2],It.SOUTH_WEST)),Re(!t[1]||!t[3]||oie(t[1],t[3],It.NORTH_WEST)));let i=0,r=0;for(let a=0;a<4;++a){const l=t[a];if(l&&l.level===e){const c=a===0||a===1,h=a===0||a===3,p=l.extent,f=p[c?0:2],m=p[h?1:3],g=(o=(s=l.renderData)==null?void 0:s.geometryState)==null?void 0:o.samplerData;r+=sn(f,m,g),i++}}const n=i?r/i:0;return Re(n!=null),n}function q7(t){const e=t.vao,i=t.geometryInfo.vertexAttributes.position.typedBuffer;e.vertexBuffers.geometry.setSubData(i,0,0,i.length)}const $W=[[0,1],[1,0],[0,-1],[-1,0]],Cs=new oDt,W7=Dne(-1/0,-1/0,1/0,1/0),hP=[null,null,null,null];function kUe(t,e,i){if(!e)return!1;const r=g_(t,e);return r>0||r===0&&i>=2}const L2=!0;let CNt=class extends $ce{get horizontalScale(){return this._horizontalScaleFactor}constructor(e,i,r){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=Kt(),e!==void 0&&this.init(e,i,r)}init(e,i,r){super.init(e,i,r);const n=r.view.renderSpatialReference,s=r.spatialReference,o=v(n)&&ine(n)&&v(s)&&s.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=o;const a=this.surface.isWebMercatorOnPlateeCarree,l=this._extentInRenderSR,c=this.extent;if(a){const h=Ue(c[0],c[1],0);jo(h,Je.WebMercator,h,Je.PlateCarree);const p=Ue(c[2],c[3],0);jo(p,Je.WebMercator,p,Je.PlateCarree),l[0]=h[0],l[1]=h[1],l[2]=p[0],l[3]=p[1]}else for(let h=0;h<4;++h)l[h]=c[h]*o;this.centerAtSeaLevel[0]=.5*(l[0]+l[2]),this.centerAtSeaLevel[1]=.5*(l[1]+l[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(l[2]-l[0],l[3]-l[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const e=this._extentInRenderSR,i=.5*(e[2]-e[0]),r=.5*(e[3]-e[1]),n=Math.sqrt(i*i+r*r),s=.5*(this.elevationBounds[0]-this.elevationBounds[1]),o=Math.max(n,s);this._center[bs.MIDDLE][3]=o}_calculateFrustumVisibilityStatus(e){const i=this._aabb(),r=i[0],n=i[1],s=i[2],o=i[3],a=i[4],l=i[5];let c=!0;for(let h=0;h<6;h++){const p=e[h],f=p[0],m=p[1],g=p[2],_=p[3];if(f*(f>0?r:o)+m*(m>0?n:a)+g*(g>0?s:l)+_>=0)return nl.OUTSIDE;c=c&&f*(f<0?r:o)+m*(m<0?n:a)+g*(g<0?s:l)+_<=0}return c?nl.INSIDE:nl.INTERSECTS}_aabb(){const e=this._extentInRenderSR;return TWe(e[0],e[1],this.elevationBounds[0],e[2],e[3],this.elevationBounds[1])}intersectsRay(e,i,r,n){return vk[0]=1/i[0],vk[1]=1/i[1],vk[2]=1/i[2],Fle(this._aabb(),e,vk,r,n)}createGeometry(){yNt(this.renderData,this._horizontalScaleFactor),this.setMemoryDirty()}getDefaultVerticesPerSide(){return this.level<9?3:2}updateCornerElevations(){wNt(this.renderData,this._horizontalScaleFactor)}updateEdgeElevations(){xNt(this.renderData,this._horizontalScaleFactor)}};const vk=P();let ANt=class{constructor(){this.extent=pi(),this.minLevel=0,this.maxLevel=0,this.callback=null}},JU=class extends ve{constructor(){super(...arguments),this._queries=new Wt({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new Wt({initialSize:30}),this._queryPool=new zo(ANt)}queryVisibleLevelRange(e,i,r,n){const s=this._queryPool.acquire();Xf(s.extent,e),s.minLevel=i??-Number.MAX_VALUE,s.maxLevel=r??Number.MAX_VALUE,s.callback=n,this._queryQueue.push(s),this.notifyChange("updating")}get updating(){return this._queryQueue.length!==0}prepare(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}process(){for(let e=0;e<this._queries.length;e++){const i=this._queries.data[e];this._queryPool.release(i),i.callback(e>=this._queriesInvPtr),i.callback=null}this._queries.clear(),this.notifyChange("updating")}queriesForTile(e){const i=e.level;let r=0;for(;r<this._queriesInvPtr;){const n=this._queries.data[r],s=n.extent;i>=n.minLevel&&i<=n.maxLevel&&s[0]<=e.extent[2]&&s[2]>=e.extent[0]&&s[1]<=e.extent[3]&&s[3]>=e.extent[1]?(this._queries.swapElements(r,this._queriesInvPtr-1),this._queriesInvPtr--):r++}}};u([d()],JU.prototype,"updating",null),JU=u([$("esri.views.3d.terrain.ScaleRangeQueries")],JU);let RNt=class extends $ce{get convexHull(){return this._convexHull}constructor(e,i,r){super(),this._convexHull=new Array(24),this._boundingSphere=Is(),e!==void 0&&this.init(e,i,r)}init(e,i,r){super.init(e,i,r);const n=this.ellipsoid.radius,s=this.extentInRadians[0],o=this.extentInRadians[1],a=this.extentInRadians[2],l=this.extentInRadians[3],c=e[0],h=Bt(o,l,.5),p=Bt(s,a,.5),f=c===0?0:Math.min(Math.abs(o),Math.abs(l));this._edgeLen=(a-s)*Math.cos(f)*n,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=n-Math.sqrt(n*n-this._edgeLen2/4),DZe(this.centerAtSeaLevel,p,h,this.ellipsoid.radius);const m=Fc(this.centerAtSeaLevel);we(m,m),this.up=m,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const e=this._center;if(this.lij[0]===0)he(e[bs.MIDDLE],0,0,0),he(e[bs.TOP],0,0,0),he(e[bs.BOTTOM],0,0,0),e[bs.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const i=e[bs.MIDDLE],r=this.convexHull;let n=0;for(let s=0;s<8;++s)n=Math.max(n,MNt(i,r,3*s));e[bs.MIDDLE][3]=Math.sqrt(n)}}_calculateFrustumVisibilityStatus(e){if(!Eb(e,this._boundingSphere))return nl.OUTSIDE;if(this.lij[0]<10)return nl.INTERSECTS;const i=this.convexHull,r=this.surface.view.state.camera.near;let n=!0;for(let s=0;s<yw.NUM;s++){const o=s===Or.NEAR,a=e[s],l=a[0],c=a[1],h=a[2],p=a[3]-(o?r:0);let f=!1;for(let m=0;m<8;++m){const g=3*m;if(l*i[g+0]+c*i[g+1]+h*i[g+2]+p<0){if(f=!0,!n)break}else n=!1}if(!f)return nl.OUTSIDE}return n?nl.INSIDE:nl.INTERSECTS}computeElevationBounds(){super.computeElevationBounds(),this._updateBoundingVolumes()}createGeometry(){cNt(this.renderData,this._getPatchType()),this._updateBoundingVolumes(),this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull(),this._updateBoundingSphere(),Qs&&this._checkBVs()}_updateBoundingSphere(){const e=this._boundingSphere,i=e,r=this.elevationBounds,n=this.ellipsoid.radius,s=r[1];if(this.level===0)he(i,0,0,0),e[3]=n+s;else{const o=this.extentInRadians,a=.5*(o[0]+o[2]),l=o[1],c=o[3];Lx(fbe,a,l,n),Lx(mbe,a,c,n),me(i,fbe,mbe);const h=.5*(r[0]+r[1]);le(i,i,(n+h)/Ru(i));const p=this.convexHull;let f=0;const m=(_,b)=>{const w=_[0]-p[3*b+0],x=_[1]-p[3*b+1],T=_[2]-p[3*b+2];return Math.sqrt(w*w+x*x+T*T)};for(let _=0;_<8;++_){const b=m(i,_);f=Math.max(f,b)}const g=f;e[3]=g+2}}_updateConvexHull(){const e=this.extentInRadians,i=this.ellipsoid.radius;if(this.level===0)return;const r=this.elevationBounds,n=this._getPatchType(),s=this.surface.isWebMercator,o=s&&n===op.HAS_NORTH_POLE,a=s&&n===op.HAS_SOUTH_POLE,l=a||o,c=Math.PI/2,h=e[0],p=e[2],f=a?-c:e[1],m=o?c:e[3],g=.5*(h+p),_=r[0],b=i+(l?Math.min(0,_-1):_),w=(q,N,L)=>Lx(q,N,L,b),x=P(),T=P(),E=P(),C=P();w(x,h,f),w(T,h,m),w(E,p,m),w(C,p,f);const A=(q,N)=>{for(let L=0;L<3;++L)this._convexHull[3*N+L]=q[L]};A(x,0),A(T,1),A(E,2),A(C,3);const I=r[1],O=i+(l?Math.max(0,I+1):I),D=P(),U=P(),V=P();Lx(U,g,m,b),Lx(V,g,f,b),me(D,U,V),we(D,D);const B=P(),ee=P(),ie=(q,N)=>{Fo(ee,q,N),we(ee,ee);const L=-be(q,B)/be(ee,B);Re(L>=0),le(ee,ee,L),me(q,q,ee)};if(2**this.lij[0]>2*this.lij[1]){const q=V,N=P();vt(N,pbe,q),we(N,N),vt(B,q,N),we(B,B),Re(ap(be(B,q)/Ru(q),0)),ie(x,T),ie(C,E),A(x,0),A(C,3)}else if(2**this.lij[0]!==2*this.lij[1]){const q=U,N=P();vt(N,pbe,q),we(N,N),vt(B,N,q),we(B,B),ie(T,x),ie(E,C),A(T,1),A(E,2)}const J=(q,N)=>{const L=O/be(N,D);for(let F=0;F<3;++F)this._convexHull[3*q+F]=N[F]*L};J(4,x),J(5,T),J(6,E),J(7,C)}_getPatchType(){const e=this.lij[1],i=e===0,r=e===(1<<this.level)-1;return i?r?op.HAS_BOTH_POLES:op.HAS_NORTH_POLE:r?op.HAS_SOUTH_POLE:op.REGULAR}intersectsRay(e,i,r,n){const s=this._boundingSphere,o=s[3]+r,a=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],l=s[0]-e[0],c=s[1]-e[1],h=s[2]-e[2],p=(l*i[0]+c*i[1]+h*i[2])/a,f=i[0]*p-l,m=i[1]*p-c,g=i[2]*p-h;return f*f+m*m+g*g<o*o}getDefaultVerticesPerSide(){return this.level<dbe.length?dbe[this.level]+1:2}updateCornerElevations(){fNt(this.renderData),this._updateBoundingVolumes()}updateEdgeElevations(){pNt(this.renderData),this._updateBoundingVolumes()}_checkBVs(){var oe;if(!Qs||this.level<=2)return;const e=this._boundingSphere,i=e[3],r=e,n=P(),s=this.ellipsoid.radius,o=this.elevationBounds;o[1],o[0];const a=s+o[0],l=1,c=0,h=this._center[bs.MIDDLE][3],p=this.convexHull,f=(pe,ye)=>{for(let Se=0;Se<3;++Se)pe[Se]=p[3*ye+Se]};{const pe=P(),ye=P(),Se=P(),He=P(),De=P(),Te=(ke,ze,bt,it)=>{f(ye,ke),f(Se,ze),f(He,bt),Fo(ye,ye,Se),Fo(He,He,Se),vt(pe,ye,He),we(pe,pe);const jt=be(pe,Se);f(De,it);const Qt=be(pe,De),oi=Math.abs(Qt-jt);Re(ap(oi,0),`Non coplanar ${ke},${ze},${bt},${it} diff = ${oi}`)};Te(0,1,2,3),Te(4,5,6,7),Te(0,1,4,5),Te(1,2,5,6),Te(2,3,6,7),Te(3,0,7,4)}const m=th(24),g=(pe,ye,Se)=>{const He=4*pe;for(let De=0;De<3;++De)m[He+De]=ye[De];m[He+3]=Se},_=P(),b=P(),w=P(),x=P(),T=(pe,ye,Se,He)=>{f(_,ye),f(b,Se),f(w,He),Fo(_,_,b),we(_,_),Fo(w,w,b),we(w,w),vt(x,_,w),we(x,x);const De=be(x,b);g(pe,x,De)};T(0,0,1,2),T(1,1,0,4),T(2,1,5,2),T(3,3,2,6),T(4,4,0,3),T(5,4,6,5);const E=1,C=(pe,ye,Se,He)=>{const De=4*pe;return m[De+0]*ye+m[De+1]*Se+m[De+2]*He-m[De+3]},A=(pe,ye,Se,He)=>C(pe,ye,Se,He)>=-E,I=(pe,ye)=>A(pe,ye[0],ye[1],ye[2]),O=2**this.lij[0]>2*this.lij[1],D=(pe,ye,Se)=>Math.sqrt(UUe(pe,ye,Se,r[0],r[1],r[2]))<i,U=pe=>D(pe[0],pe[1],pe[2]),V=(pe,ye)=>D(pe[ye+0],pe[ye+1],pe[ye+2]),B=this.extentInRadians,ee=.5*(B[0]+B[2]),ie=B[1],J=B[3],q=P(),N=P();Lx(q,ee,J,a),Lx(N,ee,ie,a);const L=O?"Upper":"Lower";let F=!0;for(let pe=0;pe<6;++pe){for(let ye=0;ye<8;++ye){const Se=3*ye,He=A(pe,p[Se+0],p[Se+1],p[Se+2]);F&&(F=He),Re(He,`Tile[${this.lij}] Convex hull point ${ye} outside of plane ${pe}`)}Re(I(pe,N),`Tile[${this.lij}] (${L}) bottom mid outside of plane ${pe}`),Re(I(pe,q),`Tile[${this.lij}] (${L}) top mid outside of plane ${pe}`)}Re(F,"Not all convex hull points are inside  convex hull polyhedron"),Re(U(N),`Tile[${this.lij}] (${L}) bottom mid outside of bounding sphere`),Re(U(q),`Tile[${this.lij}] (${L}) top mid outside of bounding sphere`);for(let pe=0;pe<8;++pe){const ye=V(p,3*pe);Re(ye,`Tile[${this.lij}] Convex hull point ${pe} outside of bounding sphere`)}for(let pe=0;pe<6;++pe)for(let ye=0;ye<8;++ye){const Se=3*ye;A(pe,p[Se+0],p[Se+1],p[Se+2])||console.error(`Tile[${this.lij}] Convex hull point ${ye} outside of plane ${pe}`)}const G=this.extentInRadians,W=Math.max(G[2]-G[0],G[3]-G[1]),Z=Math.round(W*s),X=this.renderData;if(X){const pe=X.geometryInfo,ye=X.localOrigin,Se=(oe=pe.vertexAttributes)==null?void 0:oe.position;if(!Se)return;const He=Se.count,De=P(),Te=pe.numVerticesPerSide-2,ke=Te*Te,ze=X.geometryState.neighborData,bt=ze.edgeResolutions.reduce((it,jt)=>it+jt+1,0);for(let it=0;it<He;++it){const jt=it<ke,Qt=!jt&&it<ke+bt;let oi=!1,ei=-1;if(Qt){let hi=ke;for(let Ai=0;Ai<4;++Ai){const xi=ze.edgeResolutions[Ai];if(it===hi||it===hi+xi-1){oi=!0;break}if(hi+=xi,it<hi){ei=Ai;break}}}const wi=ei,or=oi,Ii=Qt&&!or,Oi=Qt?ze.edgePeerNeighbors[wi]:null,at=Qt&&Oi&&g_(this,Oi)>0,et=jt?"internal":Ii?"edge":or?"corner":"pole";Se.getVec(it,n),me(De,n,ye);const pt=Ru(De)-s;let gt=0,Rt=!1;const Yt=o[0]-pt,Ni=pt-o[1],Fi=Yt>l,ki=Ni>l,Ui=Fi||ki,Fr=`Tile[${this.lij}].vertex[${it}]:${et}`+(Fi?"(below)":ki?"(above)":"")+(at?"(Neighbor)":"");{const hi=xN(De,r);if(hi>=i+c){const Ai=hi-i;Ui||(console.error(`${Fr} is out of the bounding sphere by ${Ai.toFixed(0)} / ${i.toFixed(0)}[tol=${c}] h=${pt.toFixed(0)} / [${o[0].toFixed(0)}..${o[1].toFixed(0)}] (${(Ai/i).toFixed(0)})`),Rt=!0)}}for(let hi=0;hi<6;++hi)if(!A(hi,De[0],De[1],De[2])){const Ai=C(hi,De[0],De[1],De[2]),xi=it%Te,kn=(it-xi)/Te;hi===0&&Yt||hi===5&&Ni||(console.error(`${Fr} (${xi},${kn})|${Te}] is out of the bounding trapezoid plane ${hi} h=${Math.round(pt)} / [${Math.round(o[0])}..${Math.round(o[1])}] dist=${Math.round(Ai)} radii = ${Math.round(i)}/${Math.round(h)}} : maxL = ${Z}`),++gt)}if(Rt||gt>0)break}}}};const dbe=[128,64,64,32,16,8,8,4];function MNt(t,e,i){return UUe(t[0],t[1],t[2],e[i+0],e[i+1],e[i+2])}function UUe(t,e,i,r,n,s){const o=r-t,a=n-e,l=s-i;return o*o+a*a+l*l}const Lx=(t,e,i,r)=>{const n=Math.cos(e),s=Math.sin(e),o=Math.cos(i),a=Math.sin(i);t[0]=r*o*n,t[1]=r*o*s,t[2]=r*a},pbe=[0,0,1],fbe=P(),mbe=P();let ONt=class{constructor(){this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}},VUe=class extends wl{constructor(){super(...arguments),this.blendMode=Be.Normal}};u([j({count:Be.COUNT})],VUe.prototype,"blendMode",void 0);let _R=class extends VUe{constructor(){super(...arguments),this.output=uo.Composite,this.baseOpacityMode=rm.NotRequired,this.premultipliedSource=zf.Off,this.hasWebGL2Context=!1}};u([j({count:uo.COUNT})],_R.prototype,"output",void 0),u([j({count:rm.COUNT})],_R.prototype,"baseOpacityMode",void 0),u([j()],_R.prototype,"premultipliedSource",void 0),u([j()],_R.prototype,"hasWebGL2Context",void 0);var D2;function PNt(t){const e=new ji;if(e.include(bUe),t.background===D2.Only){const i=t.output===uo.ColorComposite;return i?e.fragment.uniforms.add(new Jt("backgroundColor",r=>r.backgroundColor)):(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.include(Ice)),e.fragment.code.add(S`
    void main() {
      gl_FragColor = vec4(${i?S`backgroundColor`:S`gridColor(uv)`}, 1.0);
    }
  `),e}return e.include(wUe,t),e.fragment.uniforms.add(new Dt("tex",i=>i.texture)),e.fragment.uniforms.add(new Ie("opacity",i=>i.opacity)),e.fragment.code.add(S`void main() {
vec4 bgColor = getBackground(uv);
gl_FragColor = blendLayers(bgColor, texture2D(tex, uv), opacity);
}`),e}(function(t){t[t.BelowLayer=0]="BelowLayer",t[t.Only=1]="Only",t[t.COUNT=2]="COUNT"})(D2||(D2={}));const INt=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return D2},build:PNt},Symbol.toStringTag,{value:"Module"}));let $Nt=class extends vUe{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=dl}},zUe=class BUe extends Yi{initializeConfiguration(e,i){i.hasWebGL2Context=e.rctx.type===Et.WEBGL2}initializeProgram(e){return new Hi(e.rctx,BUe.shader.get().build(this.configuration),Di)}initializePipeline(){return Ht({blending:Am(Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA),colorWrite:si})}};zUe.shader=new Gi(INt,()=>Q(()=>import("./BlendLayers.glsl-83a61b23.js"),[]));let jUe=class extends _R{constructor(){super(...arguments),this.background=D2.BelowLayer}};u([j()],jUe.prototype,"background",void 0);let LW=class{constructor(e,i,r,n,s,o){this.texture=e,this.type=i,e.retain(),this.offsetAndScale=Zt(r.offset[0],r.offset[1],r.scale,r.scale),this.opacities=Ue(n,s,o)}destroy(){this.texture.release()}};const LNt=.125;let DNt=class{constructor(){this._renderParams={context:null,drawPhase:1,state:new EQ({viewpoint:new Jn({targetGeometry:new Le(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null}}dispose(){this._renderParams=null}render(e,i,r,n,s,o,a,l,c,h){const p=o.adjustLevel(i[0]),f=this._renderParams;f.context=e,f.painter=n,f.glyphMosaic=n.glyphMosaic,f.spriteMosaic=n.spriteMosaic,f.pixelRatio=h,f.displayLevel=p,f.requiredLevel=p;const m=o.getScale(i[0]),[g,_]=o.getShift(i,a*m),b=LNt*a*m/c,w=r.transforms.dvs;w[0]=b,w[4]=-b,w[6]=-1-g-l[0]*a*2,w[7]=1+_+(1-l[1])*a*2-2,f.state.size[0]=c,f.state.size[1]=c,r.stage||r.attachWithContext(e),r.triangleCount=0,n.drawTile(f,r,s)}},GUe=class HUe extends Yi{initializeConfiguration(e,i){i.hasWebGL2Context=e.rctx.type===Et.WEBGL2}initializeProgram(e){return new Hi(e.rctx,HUe.shader.get().build(this.configuration),Di)}initializePipeline(){return Ht({blending:Am(Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA),colorWrite:si})}};GUe.shader=new Gi(ODt,()=>Q(()=>import("./RasterColorizer.glsl-b71b76d0.js"),[]));let KU=class extends _R{constructor(){super(...arguments),this.colorizerType=WS.Stretch,this.stretchType=$2.Noop,this.applyColormap=!0}};u([j({count:WS.COUNT})],KU.prototype,"colorizerType",void 0),u([j({count:$2.COUNT})],KU.prototype,"stretchType",void 0),u([j()],KU.prototype,"applyColormap",void 0);let gbe=class{constructor(e){this._rctx=e,this._fbos=new Map}get(e){return this._getPool(e)}dispose(){this._fbos.forEach(e=>e.dispose()),this._fbos.clear()}_getPool(e){const i=this._fbos.get(e);if(i)return i;const r=new es(this._rctx,{colorTarget:En.TEXTURE,depthStencilTarget:Vi.DEPTH_RENDER_BUFFER,width:e,height:e});return this._fbos.set(e,r),r}};const NNt=re.getLogger("esri.views.3d.terrain");let FNt=class{constructor(e,i){this._rctx=e,this._techniqueRepository=i,this._fbos=[],this._vectorTileHelper=new DNt,this._bindParameters=new e7(null,null,null),this._blendLayersTechniqueConfig=new jUe,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vaoQuad=xl(this._rctx,kO)}dispose(){this._fbos.forEach(rt),this._fbos=null,this._vtFBO=rt(this._vtFBO),this._vaoQuad=rt(this._vaoQuad),this._vectorTileHelper=rt(this._vectorTileHelper),this._backgroundTechnique=nn(this._backgroundTechnique),this._applyOpacityTechnique=nn(this._applyOpacityTechnique),this._blendLayersTechnique=nn(this._blendLayersTechnique)}_getBlendLayersTechnique(e,i,r,n=zf.Off,s=D2.BelowLayer){return this._blendLayersTechniqueConfig.output=i,this._blendLayersTechniqueConfig.blendMode=e,this._blendLayersTechniqueConfig.baseOpacityMode=r,this._blendLayersTechniqueConfig.premultipliedSource=n,this._blendLayersTechniqueConfig.background=s,this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(zUe,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(e,i){const r=this._getBlendLayersTechnique(Be.Normal,i?uo.ColorComposite:uo.GridComposite,rm.NotRequired,zf.Off,D2.Only),n=this._rctx.bindTechnique(r,e,this._bindParameters);this._render(n)}_render(e){this._rctx.bindVAO(this._vaoQuad),e.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(Ft.TRIANGLE_STRIP,0,Ua(this._vaoQuad,"geometry"))}drawGroup(e,i,r,n,s,o=zf.On){i===uo.Composite&&(e.fboTexture=this._fbos[this.getLastOnHoldId()].get(r).colorTexture),e.texture=this.currentFBO(r).colorTexture,this.closeGroup(r);const a=this._getBlendLayersTechnique(n,i,s,o),l=this._rctx.bindTechnique(a,e,this._bindParameters);this._render(l)}drawRasterData(e,i,r,n,s,o=zf.Off){if(R(e.texture))return;e.fboTexture=i===uo.GroupBackgroundComposite||n===Be.Normal&&s===rm.NotRequired&&o===zf.Off?null:this.switch(r).colorTexture;const a=this._getBlendLayersTechnique(n,i,s,o),l=this._rctx.bindTechnique(a,e,this._bindParameters);this._render(l)}drawImageryTileData(e,i,r,n,s,o){const a=o.sourceLayerInfo.data;if(!a.source||(o.tile.surface.layerViewByIndex(o.layerIndex,vi.MAP).ensureSymbolizerParameters(a),!a.bind(this._rctx)))return;e.fboTexture=n===Be.Normal&&s===rm.NotRequired?null:this.switch(r).colorTexture;const l=this._getRasterColorizerTechnique(a,i,n,s);a.opacity=e.opacity;const c=a.getUniforms();c.scale=o.scale,c.offset=o.offset,c.backgroundColor=e.backgroundColor,c.fboTexture=e.fboTexture,c.baseOpacity=e.baseOpacity;const h=this._rctx.bindTechnique(l,c,null);this._render(h)}_getRasterColorizerTechnique(e,i,r,n){const s=e.symbolizerParameters,o=["stretch","lut","hillshade"].indexOf(s.type);return R(this._rasterColorizerConfig)&&(this._rasterColorizerConfig=new KU,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.output=i,this._rasterColorizerConfig.blendMode=r,this._rasterColorizerConfig.baseOpacityMode=n,this._rasterColorizerConfig.colorizerType=o,this._rasterColorizerConfig.applyColormap=!!s.colormap,this._rasterColorizerConfig.stretchType=e.hasStretchTypeNone()?$2.Noop:$2.PerBand,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(GUe,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(e,i,r,n,s,o,a,l,c){const h=this._rctx,p=o.sourceLayerInfo.data,f=o.tile.surface.layerViewByIndex(o.layerIndex,vi.MAP),m=s===rm.Required||e.opacity<1||n!==Be.Normal||i!==uo.Composite,g=m?zf.On:zf.Off;this._getBlendLayersTechnique(n,i,s,g).bindPipelineState(h);let _=null,b=null;m?(b=this.currentFBO(r),R(this._vtFBO)&&(this._vtFBO=new gbe(this._rctx)),_=this._vtFBO.get(r),h.bindFramebuffer(_),this._clearCurrentFBO()):c&&h.clearSafe(Yr.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.render(h,o.sourceLod,p,f.painter,f.layer.styleRepository,f.schemaHelper,Math.round(1/o.scale),o.offset,l,a)}catch(w){NNt.warnOnce("A render call containing vector tiles did not resolve correctly.",w)}return!v(_)||(h.bindFramebuffer(b),e.texture=_.colorTexture,e.offset=Jc,e.scale=1,this.drawRasterData(e,i,r,n,s,g),c)}copyFBOToTexture(e){const i=this._rctx,r=i.bindTexture(e.texture,mt.TEXTURE_UNIT_FOR_UPDATES),n=e.descriptor;i.gl.copyTexImage2D(Ct.TEXTURE_2D,0,n.pixelFormat,0,0,n.width,n.height,0),e.generateMipmap(),i.bindTexture(r,mt.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.clearSafe(Yr.COLOR_BUFFER_BIT|Yr.DEPTH_BUFFER_BIT)}_initFBO(e,i,r){this._rctx.bindFramebuffer(e),r&&(this._rctx.setViewport(0,0,i,i),this._clearCurrentFBO())}ensureBuffer(e){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(e)}bind(e,i=0,r=!0){if(this._current=i,i>=this._fbos.length)for(let n=this._fbos.length;n<=i;n++)this._fbos.push(new gbe(this._rctx));this._initFBO(this._fbos[i].get(e),e,r)}_bindNextFreeBuffer(e){this._lastUsedIds.length>0?this.bind(e,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(e,this._lastCreatedBufferId))}openGroup(e){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(e)}switch(e){const i=this.currentFBO(e),r=this._current;return this._bindNextFreeBuffer(e),this._lastUsedIds.push(r),i}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(e){const i=this._current;this._bindNextFreeBuffer(e),this._lastUsedIds.push(i),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(e){return this._fbos[this._current].get(e)}},kNt=class{constructor(e,i,r,n){this.start=e,this.end=i,this.blendMode=r,this.opacity=n}},UNt=class{constructor(e,i,r){this._rctx=e,this.tileSize=i,this._techniqueRepository=r,this._passParameters=new $Nt,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._blackTex=null,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._composition=new FNt(this._rctx,this._techniqueRepository),this._blackTex=new SA(m_t(this._rctx,[0,0,0,1])),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=rt(this._composition),this._backgroundTexture=nn(this._backgroundTexture),this._blackTex=nn(this._blackTex)}get backgroundIsGrid(){return R(this._backgroundColor)}get backgroundColor(){return this._backgroundColor}updateTileTexture(e,i){if(!e.renderData)return;const r=e.surface,n=r.baseOpacity;let s=0,o=0,a=this.tileSize,l=!1;const c=r.view.state.contentPixelRatio;let h=!1;t9.clear(),oC.length=0;const p=e.layerInfo[vi.MAP];let f=p.length,m=0;for(;m<p.length;m++){const b=r.layerViewByIndex(m,vi.MAP),w=b.layer.opacity;ybe[m]=w;const x=b.fullOpacity;if(_be[m]=x,SMe(b.layer)&&f>=p.length&&(f=m),Zz(b)){vbe[m]=b.layer.blendMode;let E=b.layer.blendMode!=="normal";if(IM(b.layer.parent)){const C=lie(b.layer.parent);v(C)&&C!==""&&(E=qUe(b.layer.parent)||E)}E&&(h=E,l=!1)}if(w===0&&!h){p[m].pendingUpdates&=~(Ot.TEXTURE_NOFADING&Ot.TEXTURE_FADING);continue}++o;const T=DW(e,m);if(T){if(p[m].pendingUpdates&=~(Ot.TEXTURE_NOFADING&Ot.TEXTURE_FADING),IM(b.layer.parent)){const E=lie(b.layer.parent);v(E)&&E!==""&&WUe(b.layer.parent,m)}WD(b)?a=Math.max(a,this.tileSize*c):n===1&&x===1&&(b.isOpaque||this._dataToTexture(T)&&T.sourceLayerInfo.data.descriptor.isOpaque)&&(l=!0),++s}}this._rctx.type===Et.WEBGL1&&(a=VNt(a));const g=a/this.tileSize,_=m-1;this._ensureBackgroundTexture(this.tileSize),s!==0?s===1&&!h&&this._useLayerTexture(e,_,f,_be[_])||this._composeMapLayers(e,i,_,f,ybe,vbe,a,g,!l||h,t9,h):this._useBackgroundTexture(e,o)}_ensureBackgroundTexture(e){R(this._backgroundTexture)&&(this._backgroundTexture=this._buildTexture(e),this._backgroundDirty=!0),this._backgroundDirty&&(this._composition.bind(e),this._passParameters.offset=Jc,this._passParameters.scale=1,this._passParameters.opacity=1,v(this.backgroundColor)&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,v(this.backgroundColor)),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.unbind(),this._backgroundDirty=!1)}_useBackgroundTexture(e,i){let r=m_.Immediate;(e.surface.view.layerViewManager.updating||i>0)&&(r=m_.Delayed);const n=e.renderData;this._backgroundTexture&&R(n.textureReference)&&(r=m_.Immediate),n.setTextureReference(v(this._backgroundTexture)?new LW(this._backgroundTexture,qs.FADING,bbe,e.surface.baseOpacity,0,1):null,r)}_useLayerTexture(e,i,r,n){const s=i<r,o=s?1:e.surface.baseOpacity,a=s?e.surface.baseOpacity:1,l=DW(e,i);return!!this._dataToTexture(l)&&(e.renderData.setTextureReference(new LW(l.sourceLayerInfo.data,qs.FADING,l,o,a,n)),!0)}_composeMapLayers(e,i,r,n,s,o,a,l,c,h,p){this._composition.ensureBuffer(a);const f=e.surface.baseOpacity;let m=!1,g=nt.LINEAR_MIPMAP_LINEAR,_=!1,b=0;for(let T=r;T>=0;T--){const E=DW(e,T);if(!E||s[T]===0&&!p)continue;const C=T<n&&f<1&&!m;this._passParameters.baseOpacity=C?f:1;const A=this._passParameters.baseOpacity<1?rm.Required:rm.NotRequired;C&&(m=!0);let I=!1;h.forEach(V=>{V.start===T&&(oC.push(V),this._composition.openGroup(a),I=!0)});const O=b===0,D=I?uo.GroupBackgroundComposite:c&&O?this.backgroundIsGrid?uo.GridComposite:uo.ColorComposite:uo.Composite,U=sie[o[T]];for(iLt(E)?(this._passParameters.opacity=s[T],_=this._composition.drawVectorData(this._passParameters,D,a,U,A,E,l,this.tileSize,_)):tLt(E)?(this._passParameters.opacity=s[T],this._composition.drawImageryTileData(this._passParameters,D,a,U,A,E),this._hasNearestInterpolation(E)&&(g=nt.NEAREST)):this._dataToTexture(E)&&(this._passParameters.texture=E.sourceLayerInfo.data.texture,this._passParameters.offset=E.offset,this._passParameters.scale=E.scale,this._passParameters.opacity=s[T],this._composition.drawRasterData(this._passParameters,D,a,U,A));oC.length>0&&oC[oC.length-1].end===T;){const V=oC.pop();this._passParameters.opacity=V.opacity,this._passParameters.offset=Jc,this._passParameters.scale=1;const B=c&&O?this.backgroundIsGrid?uo.GridComposite:uo.ColorComposite:uo.Composite;this._composition.drawGroup(this._passParameters,B,a,sie[V.blendMode],A)}b++}const w=e.renderData,x=w.ensureTexture(a,()=>this._buildTexture(a,g));this._composition.copyFBOToTexture(x),this._composition.unbind(),w.setTextureReference(new LW(x,i,bbe,m?1:f,0,1))}_hasNearestInterpolation(e){const i=e.sourceLayerInfo.data;return!!i.source&&i.interpolation==="nearest"}_dataToTexture(e){if(nLt(e)){const i=e.sourceLayerInfo;i.data=this._buildTexture(i.data),e.tile.setMemoryDirty()}return rLt(e)}setBackground(e){this._backgroundColor!==e&&(this._backgroundColor=e,this._backgroundDirty=!0)}_buildTexture(e,i=nt.LINEAR_MIPMAP_LINEAR){if(R(e))return null;const r={target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE,samplingMode:i,maxAnisotropy:this._maxAnisotropy,preMultiplyAlpha:!0,flipped:!0,hasMipmap:!0},n=this._rctx;let s;if(typeof e=="number")r.width=r.height=e,s=new SA(new mt(n,r));else if(e instanceof z7)r.isOpaque=e.isOpaque,s=new SA(new mt(n,r,e.image)),e.release();else try{r.width=e.width,r.height=e.height,s=new SA(new mt(n,r,e))}catch{s=new SA(RDe(n)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const o=n.bindTexture(s.texture,mt.TEXTURE_UNIT_FOR_UPDATES);return s.generateMipmap(),n.bindTexture(o,mt.TEXTURE_UNIT_FOR_UPDATES),s}get test(){return{backgroundTexture:this._backgroundTexture}}};function VNt(t){const e=vM(t),i=e*e,r=t*t;if(i===r)return t;const n=e/2;return i-r<r-n*n?e:n}function DW(t,e){yh.layerIndex=e;const i=t.layerInfo[vi.MAP][e];if(v(i.data))return dt(yh.offset,0,0),yh.tile=t,yh.scale=1,yh.sourceLod=t.lij,yh.sourceLayerInfo=i,yh;const r=i.upsampleInfo;if(v(r)){const n=r.tile.layerInfo[vi.MAP][e];return yh.tile=r.tile,io(yh.offset,r.offset),yh.scale=r.scale,yh.sourceLod=r.tile.lij,yh.sourceLayerInfo=n,yh}return null}function lie(t){return t.get("uid")}function qUe(t){let e=t.blendMode!=="normal";return IM(t.parent)&&(e=qUe(t.parent)||e),e}function WUe(t,e){IM(t.parent)&&WUe(t.parent,e);const i=lie(t);if(v(i)&&i!==""){const r=t9.get(i);r?r.start=e:t9.set(i,new kNt(e,e,t.blendMode,t.opacity))}}const ybe=new Array,_be=new Array,vbe=new Array,t9=new Map,oC=new Array,yh={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIndex:0},bbe={offset:[0,0],scale:1},XUe=200,NW=40,zNt=.8,BNt=10,JI=1e-6;function jNt(t,e,i){const r=e,n=i;let s=0,o=1/0;for(let a=0;a<3;++a){{const l=t[a];if(r[a]<l){if(n[a]<=JI)return!1;const c=(l-r[a])/n[a];s=Math.max(s,c)}else if(n[a]<=-JI){const c=(l-r[a])/n[a];o=Math.min(o,c)}if(s>o)return!1}{const l=t[a+3];if(r[a]>l){if(n[a]>=-JI)return!1;const c=(l-r[a])/n[a];s=Math.max(s,c)}else if(n[a]>=JI){const c=(l-r[a])/n[a];o=Math.min(o,c)}if(s>o)return!1}}return!0}let wbe=class{constructor(e,i,r,n,s){this.aabb=e,this.axis=i,this.d=r,this.midStartIndex=n,this.rightStartIndex=s}},Uce=class cie{constructor(e,i,r,n){this.globalTriangleVertexIndices=e,this.firstTriangleIndex=i,this.positionAttribute=n,this._rayDirection=P(),this.bspNodeTree=new Array;const s=r-i,o=s<=YUe?new Uint16Array(s):new Uint32Array(s);this.indices=o;for(let a=0;a<s;++a)o[a]=a;{const a=XNt(e,i,r,n.data,n.stride),l=_e(Math.log2(s/NW),2,BNt),c=(h,p,f)=>{const m=qNt(o,a,h,p),g=p-h;if(g<=NW){const E=new wbe(m,void 0,0,h,p);return this.bspNodeTree.push(E),E}const{axis:_,midValue:b}=WNt(m),w=HNt(o,a,h,p,_,b),x=(E,C)=>{if(f>l)return;const A=C-E;return A<NW||A>=zNt*g?void 0:c(E,C,f+1)},T=new wbe(m,_,b,w.next,w.mid);return this.bspNodeTree.push(T),T.leftNode=x(h,w.next),T.rightNode=x(w.mid,p),T};c(0,s,0),this.triangleVertexIndices=YNt(o,e,i,r)}}intersectRayTriangleRange(e,i){{if(e>=i)return;const r=this.triangleVertexIndices,n=this.positionAttribute.data,s=this.positionAttribute.stride,o=this._rayOrigin,a=o[0],l=o[1],c=o[2],h=this._rayDirection,p=h[0],f=h[1],m=h[2];for(let g=e,_=3*e;g<i;++g){let b=r[_++]*s;const w=n[b++],x=n[b++],T=n[b];b=r[_++]*s;const E=n[b++],C=n[b++],A=n[b];b=r[_++]*s;const I=E-w,O=C-x,D=A-T,U=n[b++]-w,V=n[b++]-x,B=n[b]-T,ee=f*B-V*m,ie=m*U-B*p,J=p*V-U*f,q=I*ee+O*ie+D*J;if(Math.abs(q)<=Number.EPSILON)continue;const N=a-w,L=l-x,F=c-T,G=N*ee+L*ie+F*J;if(q>0){if(G<0||G>q)continue}else if(G>0||G<q)continue;const W=L*D-O*F,Z=F*I-D*N,X=N*O-I*L,oe=p*W+f*Z+m*X;if(q>0){if(oe<0||G+oe>q)continue}else if(oe>0||G+oe<q)continue;const pe=(U*W+V*Z+B*X)/q;if(pe>=0){const ye=this.indices[g]+this.firstTriangleIndex,Se=Dle(I,O,D,U,V,B,GNt);this._callback(pe,Se,ye,!1)}}}cie.numFacesTested+=i-e}intersectRay(e,i){cie.numFacesTested=0;const r=Ue(e.r0[0],e.r0[1],e.r0[2]),n=Ue(e.r1[0],e.r1[1],e.r1[2]),s=n[0]-r[0],o=n[1]-r[1],a=n[2]-r[2];if(s*s+o*o+a*a<JI)return;this._rayOrigin=r;const l=this._rayDirection;l[0]=s,l[1]=o,l[2]=a;const c=this.triangleVertexIndices.length/3;this._callback=i;const h=this.bspNodeTree[0];this.intersectRayBSP(h,0,c)}intersectRayBSP(e,i,r){const n=this._rayOrigin,s=this._rayDirection;if(!jNt(e.aabb,n,s))return;const o=e.axis,a=e.d;if(n[o]<a||s[o]<0){const l=i,c=e.midStartIndex;if(l<c){const h=e.leftNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(e.midStartIndex,e.rightStartIndex),n[o]>a||s[o]>0){const l=e.rightStartIndex,c=r;if(l<c){const h=e.rightNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}};Uce.numFacesTested=0;const GNt=P(),aC=[1/0,1/0,1/0],lC=[-1/0,-1/0,-1/0];function HNt(t,e,i,r,n,s){let o=i,a=r;for(;o<a;){const c=t[o];e[6*c+n+3]<=s?++o:(--a,t[o]=t[a],t[a]=c)}let l=o;for(a=r;l<a;){const c=t[a-1];e[6*c+n]>=s?--a:(t[a-1]=t[l],t[l]=c,++l)}return{next:o,mid:l}}function qNt(t,e,i,r){if(r<=i)return l2(NaN,NaN,NaN,NaN,NaN,NaN);{const n=6*t[i];for(let s=0;s<3;++s)aC[s]=e[n+0+s],lC[s]=e[n+3+s]}for(let n=i+1;n<r;++n){const s=6*t[n];for(let o=0;o<3;++o)aC[o]=Math.min(aC[o],e[s+0+o]),lC[o]=Math.max(lC[o],e[s+3+o])}return l2(aC[0],aC[1],aC[2],lC[0],lC[1],lC[2])}function WNt(t){const e=t[3]-t[0],i=t[4]-t[1],r=t[5]-t[2],n=e>i?e>r?0:i>r?1:2:i>r?1:r>e?2:0;return{axis:n,midValue:(t[n]+t[n+3])/2}}function XNt(t,e,i,r,n){const s=i-e,o=new Float32Array(6*s);for(let a=0;a<s;++a){const l=3*(a+e),c=t[l+0]*n,h=t[l+1]*n,p=t[l+2]*n;for(let f=0;f<3;++f){const m=r[c+f],g=r[h+f],_=r[p+f];o[6*a+f]=Math.min(m,g,_),o[6*a+3+f]=Math.max(m,g,_)}}return o}function YNt(t,e,i,r){const n=r-i;let s=0;for(let a=i;a<r;++a)for(let l=0;l<3;++l)s=Math.max(e[3*a+l],s);const o=s<=YUe?new Uint16Array(3*n):new Uint32Array(3*n);for(let a=0;a<n;++a){const l=3*(t[a]+i);for(let c=0;c<3;++c){const h=e[l+c];o[3*a+c]=h}}return o}const YUe=65535;let bn=class extends Do{constructor(){super(...arguments),this.output=z.Color,this.overlayMode=y_.Disabled,this.tileBlendInput=qg.LayerOnly,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.atmosphere=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.stencilEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.shading=!tr.TERRAIN_USE_LEGACY_SHADING,this.useLegacyTerrainShading=tr.TERRAIN_USE_LEGACY_SHADING,this.invisible=!1,this.tileBorders=!1,this.visualizeNormals=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.pbrMode=_t.Terrain}};u([j({count:z.COUNT})],bn.prototype,"output",void 0),u([j({count:y_.COUNT})],bn.prototype,"overlayMode",void 0),u([j({count:qg.COUNT})],bn.prototype,"tileBlendInput",void 0),u([j()],bn.prototype,"spherical",void 0),u([j()],bn.prototype,"doublePrecisionRequiresObfuscation",void 0),u([j()],bn.prototype,"atmosphere",void 0),u([j()],bn.prototype,"receiveShadows",void 0),u([j()],bn.prototype,"hasSlicePlane",void 0),u([j()],bn.prototype,"backfaceCullingEnabled",void 0),u([j()],bn.prototype,"stencilEnabled",void 0),u([j()],bn.prototype,"textureFadingEnabled",void 0),u([j()],bn.prototype,"renderOccluded",void 0),u([j()],bn.prototype,"hasScreenSpaceReflections",void 0),u([j()],bn.prototype,"hasCloudsReflections",void 0),u([j()],bn.prototype,"shading",void 0),u([j()],bn.prototype,"useLegacyTerrainShading",void 0),u([j()],bn.prototype,"invisible",void 0),u([j()],bn.prototype,"tileBorders",void 0),u([j()],bn.prototype,"visualizeNormals",void 0),u([j()],bn.prototype,"screenSizePerspective",void 0),u([j()],bn.prototype,"receiveAmbientOcclusion",void 0),u([j({count:_t.COUNT})],bn.prototype,"pbrMode",void 0),u([j({constValue:hr.CompressedAttribute})],bn.prototype,"normalType",void 0),u([j({constValue:ds.Compressed})],bn.prototype,"textureCoordinateType",void 0),u([j({constValue:!1})],bn.prototype,"highStepCount",void 0),u([j({constValue:!1})],bn.prototype,"useCustomDTRExponentForWater",void 0),u([j({constValue:!1})],bn.prototype,"useFillLights",void 0);const FW=7,ZNt=10,kW=to();var ao;(function(t){t[t.Opaque=0]="Opaque",t[t.Semitransparent=1]="Semitransparent",t[t.TransparentWithDraped=2]="TransparentWithDraped",t[t.Empty=3]="Empty"})(ao||(ao={}));let xu=class extends ve{get _isGlobal(){return this._stage.viewingMode===qe.Global}get shading(){return this._techniqueConfiguration.shading}set shading(e){this._techniqueConfiguration.shading=e}constructor(e){super(e),this.type=gn.TERRAIN,this.isGround=!0,this._tileSize=256,this._techniqueConfiguration=new bn,this._passParameters=new TUe,this._rctx=null,this._renderDataPool=new zo(oNt),this._patchGroups=new Map,this._patchGroupsDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new fUe,this._highestVisibleLODTile=null,this._visible=!0,this._transparencyState=ao.Opaque,this._velvetOverground=!0,this._castShadows=!0,this._emptyTex=null,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.needsHighlight=!1,this.renderOccludedFlags=xn.Occlude}initialize(){const e=[Ee.OPAQUE_TERRAIN,Ee.TRANSPARENT_TERRAIN,Ee.OCCLUDED_TERRAIN];this._stage.addRenderPlugin(e,this)}destroy(){this._stage.removeRenderPlugin(this),rDt()}get canRender(){return this._visible&&!!this._rootTiles&&!this.renderingDisabled}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setDirty()}set transparency(e){this._transparencyState!==e&&(this._techniqueConfiguration.invisible=e===ao.TransparentWithDraped||e===ao.Empty,this._transparencyState=e,this.setNeedsRender())}get transparency(){return this._transparencyState}get needsLinearDepth(){return this._overlayRenderer.hasWater}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return!!this._techniqueConfiguration.visualizeNormals}set visualizeNormals(e){this._techniqueConfiguration.visualizeNormals!==e&&(this._techniqueConfiguration.visualizeNormals=e,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this._setSortingDirty()}set velvetOverground(e){this._velvetOverground!==e&&(this._velvetOverground=e,this.setNeedsRender())}get layerUid(){return eb}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender())}set pbrMode(e){this._techniqueConfiguration.pbrMode!==e&&(this._techniqueConfiguration.pbrMode=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender())}setRootTiles(e){this._rootTiles=e,this.setDirty()}setNeedsHighlight(e){this.needsHighlight=e,this.setNeedsRender()}setRenderOccludedOverlay(e){this.renderOccludedFlags=e?Bz:xn.Occlude,this.setNeedsRender()}setStencilEnabledLayerExtents(e){this._stencilEnabledLayerExtents=e,this._setSortingDirty()}setTileSize(e){this._tileSize=e,v(this._tileRenderer)&&(this._tileRenderer.tileSize=e),this.setDirty()}_prepareTileForLoading(e){e.renderData||(e.renderData=this._renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e))}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometryState(e),this.updateTileTexture(e,Ot.TEXTURE_FADING)}updateTileTexture(e,i){v(this._tileRenderer)&&(this._tileRenderer.updateTileTexture(e,i===Ot.TEXTURE_FADING?qs.FADING:qs.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(i))}updateTileGeometryState(e){for(const r of e.layerInfo[vi.ELEVATION])r.pendingUpdates&=~Ot.GEOMETRY;e.resetPendingUpdate(Ot.GEOMETRY);const i=e.renderData.updateGeometryState();return i&&this.setDirty(),i}updateGeometryIfNeeded(e){e.isLoaded&&e.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(e){const i=e.renderData;i&&(i.releaseGeometry(),this._renderDataPool.release(i),i.clear(),e.renderData=null,e.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(e){const i=ZNt-FW,r=Math.max(0,Math.floor((e.level-i)/FW)*FW);if(this._isGlobal&&r===0)return dl;for(;e.parent&&e.level>r;)e=e.parent;return e.centerAtSeaLevel}setVisibility(e){this._visible=e,this.setDirty()}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.setNeedsRender())}setDirty(e=Wn.UPDATE){this._patchGroupsDirty=!0,this._context.requestRender(e)}_setSortingDirty(e=Wn.UPDATE){this._patchSortingDirty=!0,this._context.requestRender(e)}setNeedsRender(e=Wn.UPDATE){this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this._rctx=e.renderContext.rctx,this._techniqueRepository=e.techniqueRepository,this._tileRenderer=new UNt(this._rctx,this._tileSize,this._techniqueRepository),this.updateTileBackground(),this._emptyTex=RDe(this._rctx)}uninitializeRenderContext(){this._emptyTex=rt(this._emptyTex),this._tileRenderer=rt(this._tileRenderer)}intersect(e,i,r,n){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&this.transparency!==ao.Opaque)return;const s=JNt,o=KNt;ge(s,n,r),he(o,1/s[0],1/s[1],1/s[2]);const a=e.results.min,l=e.results.max,c=e.results.ground,h=e.options.store===Ta.MIN,p=!!e.results.ground.target,f=cwt(e.verticalOffset),m=e.tolerance;let g,_=h&&v(a.dist)?a.dist:1/0;const b=x=>{const T=x.renderData;if(!(T!=null&&T.vao))return;const E=T.geometryInfo;X9(kW,E.boundingBox);const C=T.localOrigin;v(f)&&(f.localOrigin=C,f.applyToAabb(kW));const A=kW;if(cC[0]=r[0]-C[0],cC[1]=r[1]-C[1],cC[2]=r[2]-C[2],!Fle(A,cC,o,m,_))return;const I=(J,q,N)=>{J.set(this.type,x,q,N,ld),_=h&&v(a.dist)?a.dist:1/0},O=(J,q)=>{if(v(q)&&J>=0&&(e.options.backfacesTerrain||be(q,s)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||i==null||i(r,n,J))){if((c.dist==null||J<c.dist)&&I(c,J,q),e.options.isFiltered)return;e.options.store===Ta.ALL&&(R(g)?(g=dle(e.ray),I(g,J,q),e.results.all.push(g)):J<g.dist&&I(g,J,q)),(a.dist==null||J<a.dist)&&I(a,J,q),e.options.store!==Ta.MIN&&(l.dist==null||J>l.dist)&&I(l,J,q)}},D=QNt;ge(D,n,C);const U=E.indices,V=E.vertexAttributes,B=V.getField(M.POSITION,jr),ee=new Qe(B.typedBuffer,3,!1,V.stride/4),ie=E.indexCount/3;if(R(f)&&ie>XUe){const J=x.renderData;R(J.intersectionData)&&(J.intersectionData=new Uce(U,0,ie,ee)),J.intersectionData.intersectRay({r0:cC,r1:D},O)}else QN(cC,D,0,ie,U,ee,null,f,O)},w=this._rootTiles;v(w)&&(()=>{const x=this._tileIterator;x.reset(w);const T=e.options.invisibleTerrain;for(let E=x.next();E;E=x.next())!(E.visible||T&&E.intersectsClippingArea)||!v(f)&&!E.intersectsRay(r,s,m,_)||p&&this._useStencilForTile(E)?x.skipSubtree():b(E)})()}processScaleRangeQueries(e,i){var r;if(!i.done)for(this._updatePatchGroups();e.updating&&!i.done;){e.prepare();for(const n of this._patchGroups.values())for(const s of n)v((r=s.renderData)==null?void 0:r.textureReference)&&e.queriesForTile(s);e.process(),i.madeProgress()}}prepareTechnique(e){if(e.bindParameters.slot===Ee.OCCLUDED_TERRAIN){if(!(e.renderOccludedMask&Bz))return null}else{const i=this.transparency===ao.Opaque?Ee.OPAQUE_TERRAIN:Ee.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==i)return null}switch(e.output){case z.Color:return this.transparency===ao.Empty?null:(this._techniqueConfiguration.hasScreenSpaceReflections=e.bindParameters.ssr.enabled,this._techniqueConfiguration.hasCloudsReflections=v(e.bindParameters.cloudsFade.data),this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=e.bindParameters.ssaoHelper.active,this._techniqueConfiguration.overlayMode=this._overlayRenderer.isEmpty?y_.Disabled:this._overlayRenderer.hasWater?y_.EnabledWithWater:y_.Enabled,this._updateTechnique(z.Color,e.bindParameters.slot===Ee.OCCLUDED_TERRAIN));case z.Shadow:case z.ShadowExcludeHighlight:return this._castShadows&&e.bindParameters.lighting.globalFactor===1?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(z.Shadow,!1)):null;case z.Depth:return this.transparency===ao.Empty?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(z.Depth,!1));case z.Normal:return this.transparency===ao.Empty?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(z.Normal,!1));case z.ObjectAndLayerIdColor:return this.transparency===ao.Empty?null:this._updateTechnique(z.ObjectAndLayerIdColor,!1);case z.Highlight:return this.transparency!==ao.Empty&&this.needsHighlight?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(z.Highlight,!1)):null}return null}render(e,i){const r=e.bindParameters.lighting.globalFactor===1;switch(this._updatePatchGroups(),i.useStencil=!1,e.output){case z.Color:{const n=e.bindParameters.slot===Ee.OCCLUDED_TERRAIN?Dc.Occluded:Dc.ColorAndWater;this.transparency===ao.Opaque?this._renderMaterialPass(e,i,n):e.offscreenRenderingHelper.renderToTargets(()=>this._renderMaterialPass(e,i,n),e.offscreenRenderingHelper.tmpColor,e.offscreenRenderingHelper.mainDepth,[0,0,0,0]);break}case z.Depth:case z.Normal:this._renderAuxiliaryPass(e,i,Dc.None);break;case z.Highlight:this.needsHighlight&&this._renderAuxiliaryPass(e,i,Dc.Highlight);break;case z.Shadow:case z.ShadowExcludeHighlight:this._castShadows&&r&&this._renderAuxiliaryPass(e,i,Dc.None);break;case z.ObjectAndLayerIdColor:this._renderAuxiliaryPass(e,i,Dc.ObjectAndLayerIdColor)}}_renderMaterialPass(e,i,r){const{rctx:n}=e;this._passParameters.overlaySource=r,n.bindTechnique(i,this._passParameters,e.bindParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this._renderPatchGroups(e,i,r)}_renderAuxiliaryPass(e,i,r){const n=e.rctx;this._passParameters.overlaySource=r,n.bindTechnique(i,this._passParameters,e.bindParameters),this._renderPatchGroupsAuxiliary(e,i,r)}updateTileBackground(e=null){if(R(this._tileRenderer))return;const i=this._tileRenderer;let r=null;if(v(e)){const n=Xe.toUnitRGBA(e);r=Ue(n[0]||0,n[1]||0,n[2]||0)}i.setBackground(r),this._allTiles.forAll(n=>i.updateTileTexture(n,qs.FADING)),this._techniqueConfiguration.tileBlendInput=i.backgroundIsGrid?qg.GridComposite:v(i.backgroundColor)?qg.ColorComposite:qg.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this._patchGroupsDirty&&(this._highestVisibleLODTile=null,this._rebuildPatchGroups(),this._patchGroupsDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty&&this.renderOrder!==sO.NONE){const e=Array.from(this._patchGroups.values()),i=this._stencilEnabledLayerExtents;for(const r of e)mUe(this.renderOrder,r,i);e.sort((r,n)=>gUe(r[0],n[0],this.renderOrder)),this._patchGroups=new Map(e.map(r=>[r[0].renderData.localOrigin,r])),this._patchSortingDirty=!1}}_rebuildPatchGroups(){var i;const e=this._rootTiles;if(!R(e)){(i=e[0])==null||i.surface.checkAllTilesWaterproofness(),this._patchGroups.clear();for(const r of e)this._rebuildPatchGroupsForRootTile(r)}}_rebuildPatchGroupsForRootTile(e){const i=this._tileIterator;for(i.resetOne(e);!i.done;){const r=i.next(),n=r.renderData;if(!n){this._numTilesCulled++;continue}if(!r.visible){this._numTilesCulled++,i.skipSubtree();continue}const s=n.localOrigin;let o=this._patchGroups.get(s);o||(o=new Array,this._patchGroups.set(s,o)),o.push(r),(!this._highestVisibleLODTile||r.vlevel>this._highestVisibleLODTile.vlevel)&&(this._highestVisibleLODTile=r),i.skipSubtree()}}_useStencilForTile(e){for(const i of this._stencilEnabledLayerExtents)if(e.intersectsExtent(i))return!0;return!1}_renderPatchGroupsAuxiliary(e,i,r){const n=this._stencilEnabledLayerExtents.length>0;this._patchGroups.forEach(s=>{const o=s[0].renderData.localOrigin;i.program.bindDraw(new Dte(o),e.bindParameters,this._passParameters);for(let a=0;a<s.length;a++)this._renderPatch(e,i,s[a],Ft.TRIANGLES,n,r)}),e.rctx.bindVAO(null)}_renderPatchGroups(e,i,r){const n=e.bindParameters.camera,s=i.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const p=n4e(this._stage.viewingMode,this._ellipsoidRadius),f=this.pointsOfInterest.centerOnSurfaceFrequent.distance;p.update({distance:f,fovY:n.fovY})}const o=this._stencilEnabledLayerExtents.length>0,a=r===Dc.Occluded;a&&(s.bindTexture("tex",this._emptyTex),s.setUniform3fv("textureOpacities",dl),s.setUniform4fv("texOffsetAndScale",Qg));const l=v(this._tileRenderer)&&v(this._tileRenderer.backgroundColor)?this._tileRenderer.backgroundColor:dl;this._techniqueConfiguration.tileBlendInput===qg.ColorComposite&&s.setUniform3fv("backgroundColor",l);const c=this.wireframe?Ft.LINES:Ft.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&s.bindTexture("texNext",this._emptyTex);const h=this._patchGroups;for(const p of h.values()){const f=p[0].renderData.localOrigin;i.program.bindDraw(new Dte(f),e.bindParameters,this._passParameters),this._numOriginsRendered++;for(const m of p){const g=m.renderData,_=g.textureReference;if(!R(_)){if(!a){s.setUniform4fv("texOffsetAndScale",_.offsetAndScale),s.bindTexture("tex",_.texture.texture);const b=g.textureFadeFactor,w=b<1?g.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&v(w)&&b<1?(s.setUniform1f("fadeFactor",b),s.setUniform4fv("nextTexOffsetAndScale",w.offsetAndScale),s.setUniform3fv("nextTexOpacities",w.opacities),s.bindTexture("texNext",w.texture.texture)):s.setUniform1f("fadeFactor",1),g.textureIsFading&&this.setNeedsRender(),s.setUniform3fv("textureOpacities",_.opacities)}this._renderPatch(e,i,m,c,o,r),m.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}e.rctx.bindVAO(null)}_renderPatch(e,i,r,n,s,o){const a=r.renderData,l=a.vao,c=l.indexBuffer;if(R(c))return void(Qs&&console.error("Rendered tile with no indices: ",r.lij," : ",a));const h=i.program;o===Dc.None||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(h,a.overlay),s&&(i.useStencil=this._useStencilForTile(r),i.bindPipelineState(e.rctx,e.bindParameters.slot));const p=a.geometryInfo.indexCount;e.rctx.bindVAO(l),h.assertCompatibleVertexAttributeLocations(l),e.rctx.drawElements(n,p,c.indexType,0)}_bindOverlayPatchData(e,i){e.setUniform4fv("overlayTexOffset",i.offsets),e.setUniform4fv("overlayTexScale",i.scales)}_updateTechnique(e,i){return this._techniqueConfiguration.output=e,e===z.Color&&(this._techniqueConfiguration.atmosphere=this._isGlobal&&this._velvetOverground),this._techniqueConfiguration.renderOccluded=i,this._techniqueConfiguration.stencilEnabled=!1,this._shaderTechnique=this._techniqueRepository.releaseAndAcquire(SUe,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){return{tileRenderer:this._tileRenderer}}};u([d({constructOnly:!0})],xu.prototype,"_overlayRenderer",void 0),u([d({constructOnly:!0})],xu.prototype,"_stage",void 0),u([d({readOnly:!0})],xu.prototype,"_isGlobal",null),u([d({constructOnly:!0})],xu.prototype,"_allTiles",void 0),u([d({constructOnly:!0})],xu.prototype,"_ellipsoidRadius",void 0),u([d({value:!1})],xu.prototype,"renderingDisabled",null),u([d()],xu.prototype,"renderPatchBorders",null),u([d()],xu.prototype,"visualizeNormals",null),u([d()],xu.prototype,"cullBackFaces",null),u([d({value:sO.FRONT_TO_BACK})],xu.prototype,"renderOrder",null),u([d()],xu.prototype,"wireframe",null),xu=u([$("esri.views.3d.terrain.TerrainRenderer")],xu);const JNt=P(),KNt=P(),cC=P(),QNt=P();let eFt=class{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}},wg=class extends ve{constructor(e){super(e),this._handles=new Xi}initialize(){this._handles.add(this.layers.on("change",()=>this._update())),this._handles.add(ne(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._handles=Ve(this._handles),this._waitTask=null}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(i=>!(!O$(i)||i.isRejected())&&!(i.isFulfilled()&&!tFt(i,this.viewSpatialReference,this.viewingMode))&&(e=i,!((i==null?void 0:i.type)==="vector-tile"||Yz(i)))),e)if(e.isResolved()){const i=j7(e,this.viewSpatialReference,this.viewingMode);if(v(i)){const r=new Nu(i.tileInfo);this._lockTilingScheme(r)}}else this._updateWhen(e)}_updateWhen(e){const i=e.when().catch(()=>{}).then(()=>{i!==this._waitTask||this.destroyed||this._update()});this._waitTask=i}_lockTilingScheme(e){if(this.viewingMode===qe.Global){const i=e.levels.length-1;e.spatialReference.isWebMercator?e=Nu.makeWebMercatorAuxiliarySphere(i):d2(e.spatialReference)&&(e=Nu.makeGCSWithTileSize(e.spatialReference,e.pixelSize,i))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this._handles.removeAll(),this._handles.add(ne(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===qe.Global){const e=this.extentHelper.viewSpatialReference,i=d2(e)||wy(e)||xy(e);e.isWebMercator?this.tilingScheme=Nu.WebMercatorAuxiliarySphere:i&&(this.tilingScheme=Nu.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;v(e)&&!$S(e,this.extent)&&(this.tilingScheme=Nu.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){return{lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};function tFt(t,e,i){return v(j7(t,e,i))}u([d()],wg.prototype,"tilingScheme",void 0),u([d({readOnly:!0})],wg.prototype,"extent",void 0),u([d({value:!1})],wg.prototype,"tilingSchemeLocked",void 0),u([d({constructOnly:!0})],wg.prototype,"viewSpatialReference",void 0),u([d({constructOnly:!0})],wg.prototype,"layers",void 0),u([d({constructOnly:!0})],wg.prototype,"extentHelper",void 0),u([d({constructOnly:!0})],wg.prototype,"viewingMode",void 0),wg=u([$("esri.views.3d.terrain.TilingSchemeLogic")],wg);let iFt=class{constructor(){this.offset=Fe(),this.scale=0,this.tile=null}init(e,i,r,n){this.tile=e,this.offset[0]=i,this.offset[1]=r,this.scale=n}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}},li=class extends An.EventedMixin(ve){constructor(e){var i,r;super(e),this._scaleRangeQueries=new JU,this._iteratorPool=new zo(fUe,n=>n.remove=()=>this._iteratorPool.release(n)),this._postorderIterator=new cDt,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._visibleCached=!1,this._usedMemory=null,this._performanceInfo=new eFt,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=P(),this._eyePosSurfaceSR=P(),this._splitLimits=new ONt,this._frustum=TD(),this._viewProjectionMatrix=$e(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._handles=new Xi,this._watchUpdatingTracking=new Jg,this._frameTask=zM,this._allTiles=new Wt,this._upsampleInfoPool=new zo(iFt),this._rootTilesExtent=Kt(),this.updatingProgress=0,this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=Je.WebMercator,this.visibleElevationBounds=new yR(1/0,-1/0),this.rootTileElevationBounds=new yR(1/0,-1/0),this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this.oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this._shading=!0,this._isWebMercator=!1,this._isWebMercatorOnPlateeCarree=!1,this._isGlobal=!((r=(i=e.view)==null?void 0:i.state)!=null&&r.isLocal)}initialize(){this._lercDecoder=$Lt(this.view.resourceController),this._tilePool=this.view.state.isLocal?new zo(CNt):new zo(RNt);const e=this.view.resourceController.memoryController;this._upsampleMapCache=e.newCache("esri.views.3d.terrain.upsample",o=>o.unloadMapData()),this._elevationQueryCache=new PLt(e.newCache("elevation-query")),this._set("overlayManager",new Rc({surface:this})),this._handles.add([ne(()=>this.overlayManager.hasHighlights,o=>this._renderer.setNeedsHighlight(o)),ne(()=>this.overlayManager.rendersOccluded,o=>this._renderer.setRenderOccludedOverlay(o)),ne(()=>this.overlayManager.renderer.isEmpty,()=>this._evaluateTransparency())],"overlayManager"),this._renderer=new xu({_overlayRenderer:this.overlayManager.renderer,_ellipsoidRadius:sr(this.view.spatialReference).radius,_stage:this.view._stage,_allTiles:this._allTiles}),this._handles.add([ne(()=>this.baseOpacity,()=>{this._handleLayerViewChanges(),this._updateTileTextures(this._evaluateTransparency()?qs.UNFADED:qs.IMMEDIATE)},Jr),ne(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?qs.UNFADED:qs.IMMEDIATE),Jr),ne(()=>this.renderingDisabled,()=>{var o,a;return(a=(o=this.view)==null?void 0:o._stage)==null?void 0:a.renderer.setParameters({terrainRenderingEnabled:!this.renderingDisabled})},Ki),ne(()=>this.backgroundColor,o=>{this._handleLayerViewChanges(),this._renderer.updateTileBackground(o)},Jr),ne(()=>this.snapLevel,()=>this._viewChanged=!0,Ki),ne(()=>this.view.pointsOfInterest,o=>{this._renderer.pointsOfInterest=o,this._watchUpdatingTracking.removeAll(),o&&this._watchUpdatingTracking.add(()=>o.focus.renderLocation,()=>this._allTilesSorted=!1)}),ne(()=>tr.TERRAIN_TILE_TREE_SHOW_TILES,o=>{o&&!this._treeDebugger?Q(()=>import("./TerrainTileTree3DDebugger-c4853222.js"),["assets/TerrainTileTree3DDebugger-c4853222.js","assets/TileTreeDebugger-64338e09.js"]).then(({TerrainTileTree3DDebugger:a})=>{!this._treeDebugger&&tr.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new a({view:this.view}))}):o||(this._treeDebugger=Ve(this._treeDebugger))},zt)]);const{spatialReference:i}=this.view;this._extentHelper=YLt(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:i});const r=new CM({getCollections:()=>{var o,a,l;return(l=(a=(o=this.view)==null?void 0:o.defaultsFromMap)==null?void 0:a.mapCollections)==null?void 0:l.map(({layers:c})=>c)},getChildrenFunction:o=>o&&"layers"in o?o.layers:null}),n=new wg({layers:r,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:i});this._set("tilingSchemeLogic",n),this._updateTilingScheme(),this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(Ug.ELEVATION),this._mapDataRequester=this.view.resourceController.createStreamDataRequester(Ug.BASEMAP);const s=this.view.resourceController.scheduler;this._frameTask=s.registerTask(St.TERRAIN_SURFACE,this),this._handles.add([ne(()=>this._extentHelper.stencilEnabledExtents,o=>this._renderer.setStencilEnabledLayerExtents(o),zt),ne(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),Ki),ne(()=>this.extent,()=>this._updateRootTiles(),zt),this.view.on("resize",()=>this._viewChangeUpdate()),ne(()=>{var l,c;const o=this.view,a=o.state;return[this._lodBias,this.lodSnapping,(c=(l=o.resourceController)==null?void 0:l.memoryController)==null?void 0:c.memoryFactor,a.camera,a.contentCamera,a.fixedContentCamera]},()=>this._viewChangeUpdate(),Jr),ne(()=>{var o,a;return(a=(o=this.view.qualitySettings)==null?void 0:o.tiledSurface)==null?void 0:a.textureFadeDuration},o=>this._renderer.textureFadingEnabled=o>0,zt),ne(()=>{var o;return(o=this.view.qualitySettings)==null?void 0:o.physicallyBasedRenderingEnabled},o=>this._renderer.pbrMode=o?_t.Terrain:_t.Disabled,zt),ne(()=>this._userClippingExtent,()=>this._updateClippingExtent(),Ki)]),this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._handles.add([ne(()=>{var o;return(o=this.view)==null?void 0:o.map.ground.shading},()=>{this._updateShadingIfChanged()})]),this._updateShading(),this._layerViewsDirty=!0,this._handleLayerViewChanges()}destroy(){this._frameTask.remove(),this._handles.destroy(),this._watchUpdatingTracking.destroy(),this._lercDecoder=nn(this._lercDecoder),this._removeAllTiles(),this._upsampleMapCache=Ve(this._upsampleMapCache),this._elevationQueryCache=Ve(this._elevationQueryCache);const e=this.tilingSchemeLogic.layers;this._set("tilingSchemeLogic",Ve(this.tilingSchemeLogic)),e.destroy(),this._basemapLayerViewHandles.forEach((i,r)=>this._unregisterTiledLayerView(r)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",Ve(this.overlayManager)),this._tilePool=Ve(this._tilePool),$ce.prune(),this._treeDebugger=Ve(this._treeDebugger),this._renderer=Ve(this._renderer),this._iteratorPool=Ve(this._iteratorPool),this._set("view",null),this._upsampleInfoPool=Ve(this._upsampleInfoPool),GLt(),UDt()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){var e,i;if(this.lodSnapping===rL.ON){const r=this.view,n=this.tilingScheme,s=(i=(e=r.pointsOfInterest)==null?void 0:e.cameraOnSurface)==null?void 0:i.scale;if(s&&n){const o=r.state.contentCamera;let a=y7(r,o.eye,o.viewForward,o.up).tilt;a>90&&(a=180-a);const l=2*(a/90)**2,c=n.levelAtScale(s)-l;return Math.round(c)}}return null}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?rL.ON:rL.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:e}=this,{clippingArea:i}=this.view;if(R(i)||R(e))return null;const r=Kt(),n=Z6e(i,r,e)?r:null,s=this._get("extent");return $S(n,s)?s:n}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const e=gZ(this.groundExtent,this._userClippingExtent,Kt()),i=this._get("extent");return $S(e,i)?i:e}get groundExtent(){return v(this._tilingSchemeExtent)?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){var e;return(e=this.tilingSchemeLogic)==null?void 0:e.extent}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this.running||this._watchUpdatingTracking.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||this.overlayManager.updating)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){return this.view.map.ground.opacity}set baseOpacity(e){this.view.map.ground.opacity=e}get viewingMode(){return this.view.state.viewingMode}get ready(){return v(this._rootTiles)}set renderOrder(e){this._renderer.renderOrder=e,this._set("renderOrder",e)}get rootTiles(){return this._rootTiles}get spatialReference(){var e;return((e=this.tilingScheme)==null?void 0:e.spatialReference)??null}get backgroundColor(){return this.view.map.ground.surfaceColor}set backgroundColor(e){this.view.map.ground.surfaceColor=e}set slicePlaneEnabled(e){this._renderer.slicePlaneEnabled=e,this._set("slicePlaneEnabled",e),this._evaluateTransparency()}get tilingSchemeLocked(){var e;return((e=this.tilingSchemeLogic)==null?void 0:e.tilingSchemeLocked)??!1}set velvetOverground(e){this._renderer.velvetOverground=e,this._set("velvetOverground",e)}get wireframe(){return this._renderer.wireframe}set wireframe(e){e!==this._renderer.wireframe&&(this._renderer.wireframe=e,this._updateAllTileGeometries())}set _visible(e){e!==this._visibleCached&&(this._visibleCached=e,this._renderer.setVisibility(e),this.suspended=!e)}get opaque(){return this._renderer.transparency===ao.Opaque}set suspended(e){this._set("suspended",e),this._viewChangeUpdate()}get textureFadeDuration(){return this.view.qualitySettings.tiledSurface.textureFadeDuration??0}intersect(e,i,r,n){this._renderer.intersect(e,i,r,n)}getElevation(e,i,r,n){const s=this._rootTiles;if(R(s)||!s.length||s[0].layerInfo[vi.ELEVATION].length===0)return null;const o=yc;return o[0]=e,o[1]=i,o[2]=r,jo(o,n,o,this._spatialReference)?Tbe(s,o[0],o[1]):(re.getLogger(this.declaredClass).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null)}getElevations(e,i,r){const n=this._rootTiles,s=n?n[0].layerInfo[vi.ELEVATION].length:0;if(!R(n)&&n.length&&s!==0)for(let o=0;o<i;++o){const a=3*o;r(o,Tbe(n,e[a+0],e[a+1]))}else for(let o=0;o<i;++o)r(o,null)}getScale(e){if(!this.tilingScheme)return null;if(!qa(e,yc,this.spatialReference))return re.getLogger(this.declaredClass).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const i=this._rootTiles;if(v(i)){for(const r of i)if(r!=null&&r.containsPoint(yc)){let n=r;for(;n.children[0]&&!n.rendered;){const s=n.children[0].extent;let o=0;yc[0]>s[2]&&(o+=1),yc[1]<s[1]&&(o+=2),n=n.children[o]}return this._getLodBiasCorrectedScale(n.level)}}return 1/0}getSphereElevationBounds(e,i,r,n,s){var h;if(yc[0]=e,yc[1]=i,yc[2]=r,yc[3]=n,!jo(yc,s,yc,(h=this.tilingScheme)==null?void 0:h.spatialReference))return re.getLogger(this.declaredClass).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let o=1/0,a=-1/0;const l=p=>{if(p&&nde(p.extent,yc))if(p.isLeaf||p.rendered)o=Math.min(o,p.elevationBounds[0]),a=Math.max(a,p.elevationBounds[1]);else for(const f of p.children)l(f)},c=this._rootTiles;if(v(c))for(const p of c)l(p);return{min:o,max:a}}getSphereScale(e,i){if(!this.tilingScheme)return null;if(!qa(e,yc,this.spatialReference))return re.getLogger(this.declaredClass).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;yc[3]=i;let r=null;const n=o=>{if(o&&nde(o.extent,yc)){const a=o.children;if(a[0]&&!o.rendered)for(const l of a)n(l);else{const l=this._getLodBiasCorrectedScale(o.level);r=r==null?l:Math.min(r,l)}}},s=this._rootTiles;if(v(s))for(const o of s)n(o);return r}queryVisibleScaleRange(e,i,r,n){const s=i?this.tilingScheme.levelAtScale(i):0,o=r?this.tilingScheme.levelAtScale(r):1/0,a=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(e,s+a,o+a,n)}_evaluateTransparency(){var o,a;const e=this.baseOpacity,i=this.overlayManager.renderer.isEmpty,r=this._renderer.transparency,n=this._allSurfaceLayersTransparent()?i?ao.Empty:ao.TransparentWithDraped:e>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?ao.Opaque:ao.Semitransparent,s=r!==n;return s&&(this._renderer.transparency=n,(a=(o=this.view)==null?void 0:o._stage)==null||a.renderer.setParameters({terrainTransparency:this._renderer.transparency})),s}_updateTilingScheme(){var r,n,s;const e=this.tilingSchemeLogic.tilingScheme;if(e===this.tilingScheme)return;Ig(!!e,"tiling scheme cannot be reset to undefined"),this._isGlobal=!((n=(r=this.view)==null?void 0:r.state)!=null&&n.isLocal),this.tilingScheme&&this._removeAllTiles();const i=(e==null?void 0:e.spatialReference)??Je.WebMercator;this._spatialReference=i,this._isWebMercator=!!(i!=null&&i.isWebMercator),this._isWebMercatorOnPlateeCarree=this._isWebMercator&&ine((s=this.view)==null?void 0:s.renderSpatialReference),this._set("tilingScheme",e),this._updateClippingExtent(),e&&(this._updateTiledLayers(),this._renderer.setTileSize(e.pixelSize),this.overlayManager.setSpatialReference(e.spatialReference),this._updateRootTiles())}_acquireTile(e,i,r,n){const s=this._tilePool.acquire();return bk[0]=e,bk[1]=i,bk[2]=r,s.init(bk,n,this),s}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:e,tilingScheme:i}=this;if(!i)return;const r=sFt;let n=i.rootTilesInExtent(e,r,5*oR);if(v(this._rootTiles)){if(n.length>oR)return void re.getLogger(this.declaredClass).warn(o0t);const s=this._rootTiles.map(a=>a.lij),o=QBe(s,n,xbe);if(this._updatingRootTiles=!0,o.removed.length>0||o.added.length>0){const a=this._rootTiles.filter(l=>!(o.removed.findIndex(c=>xbe(c,l.lij))>-1)||(this._purgeTile(l),!1));o.added.forEach(l=>a.push(this._newRootTile(l))),this._setRootTiles(a)}}else this._updatingRootTiles=!0,n.length>oR&&(re.getLogger(this.declaredClass).warn(a0t),n=i.rootTilesInExtent(e,r,oR)),this._setRootTiles(n.map(s=>this._newRootTile(s)));$S(r,this._rootTilesExtent)||(this._rootTilesExtent=Kt(r)),this._visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){const e=this._allTiles.filter(i=>i.isLoaded&&i.intersectsClippingArea);e.forEach(i=>this._renderer.updateTileGeometryState(i)),e.forEach(i=>i.renderData.updateNeighborData()),this._updateTilesGeometries(e),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(e){if(e.length===0)return;e.sort(g_);const i=this.renderer;e.forEach(r=>i.updateGeometryIfNeeded(r)),e.forEach(r=>this._pendingTilesForElevationUpdateEvent.add(r))}_shouldSplit(e){return e.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===Ot.SPLIT}_newRootTile(e){const i=this._acquireTile(0,e[1],e[2],null);return this._shouldSplit(i)&&i.setPendingUpdate(Ot.SPLIT),this._loadTile(i),this._markTileToUpdate(i),this._updateRootTileElevationBounds(),i}_setRootTiles(e){if(this._rootTiles=e,this._allTiles.clear(),v(e)){const i=this._iteratorPool.acquire();for(i.reset(e);!i.done;)this._allTiles.push(i.next());i.remove()}this._renderer.setRootTiles(this._rootTiles),this._updateTilesVisibility(e)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this._visibleCached&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(e){e.updateClippingStatus(this.extent)&&e.resetPendingUpdate(Ot.GEOMETRY)&&this._updateTileGeometryState(e)}_updateTilesVisibility(e){if(R(e))return;const i=gDt(e),r=this.visibleElevationBounds;let n=i?r.min:1/0,s=i?r.max:-1/0;const o=this.extent,a=this._viewProjectionMatrix;this.setTileTreeDirty();const l=this._iteratorPool.acquire();for(l.reset(e);!l.done;){const c=l.next();c.updateClippingStatus(o)&&c.resetPendingUpdate(Ot.GEOMETRY)&&this._updateTileGeometryState(c),c.setPendingUpdate(Ot.RENDERDATA),c.computeVisibility(),c.updateScreenDepth(a),c.renderData&&(n=Math.min(c.elevationBounds[0],n),s=Math.max(c.elevationBounds[1],s))}l.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._batchUpdatePendingTileGeometries(),isFinite(n)&&isFinite(s)&&(r.min!==n||r.max!==s)&&(this.visibleElevationBounds=new yR(n,s))}_updateRootTileElevationBounds(){let e=1/0,i=-1/0;const r=this._rootTiles;v(r)&&r.forEach(({elevationBounds:s})=>{e=Math.min(e,s[0]),i=Math.max(i,s[1])});const n=this.rootTileElevationBounds;n.min===e&&n.max===i||(this.rootTileElevationBounds=new yR(e,i))}_updateViewDependentParameters(){const{camera:e,contentCamera:i}=this.view.state,r=Math.tan(.5*i.fovX),n=Math.tan(.5*i.fovY),s=this.tilingScheme.pixelSize,o=2**-this._lodBias*e.pixelRatio;this._splitLimits.aboveGround=e.aboveGround,this._splitLimits.fovX=r,this._splitLimits.fovY=n,this._splitLimits.relativeWidthLimit=s/e.width*this.maxTextureScale*o,this._splitLimits.relativeHeightLimit=s/e.height*this.maxTextureScale*o,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?(R(this._splitLimits.frustum)&&(this._splitLimits.frustum=TD()),cz(this._splitLimits.frustum,i.frustum)):this._splitLimits.frustum=null,cz(this._frustum,e.frustum),$n(this._viewProjectionMatrix,i.projectionMatrix,i.viewMatrix),ce(this._eyePosRenderSR,i.eye),jo(e.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateRenderData(e){e.rendered&&!e.shouldLoad&&(ZUe(e)?this._loadChildren(e):nFt(e)&&this._loadParent(e))}_updateTileGeometryState(e){e.updateVisibility(),this._renderer.updateTileGeometryState(e)&&this._markTileToUpdate(e),this._usedMemory=null}_markAllTileNeighborsForGeometryUpdate(e){const i=this._pendingTilesToUpdate;e.forEachLoadedNeighbor(r=>{i.add(r)})}_updateTileTexture(e,i){const r=e.resetPendingUpdate(Ot.TEXTURE_FADING)?Ot.TEXTURE_FADING:!!e.resetPendingUpdate(Ot.TEXTURE_NOFADING)&&Ot.TEXTURE_NOFADING;r&&(this._renderer.updateTileTexture(e,r),this._usedMemory=null,i.madeProgress())}_emitElevationUpdateEventForTiles(){const e=VW.extent;od(e),this._pendingTilesForElevationUpdateEvent.forEach(i=>kb(e,i.extent,e)),this._pendingTilesForElevationUpdateEvent.clear(),VW.spatialReference=this.spatialReference,this.emit("elevation-change",VW)}runTask(e){this._handleLayerViewChanges(e),this._frameTask.processQueue(e),this.renderer.processScaleRangeQueries(this._scaleRangeQueries,e),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(e),this._sortTiles(e);const i=!this.view.state.fixedContentCamera;this._mergeAndSplit(e,i),this._updateElevation(e),this._updateTextures(e),i||this._mergeAndSplit(e,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._batchUpdatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),e.done&&e.hasProgressed?this.requestUpdate():this.getUsedMemory(),this.notifyChange("updatingProgressValue")}_updateAllTilesStatus(e){if(!this._viewChanged||!this._rootTiles||e.done)return;this._viewChanged=!1;const i=this._iteratorPool.acquire();i.reset(this._rootTiles);const r=this.snapLevel,n=this._splitLimits,s=this._eyePosRenderSR;for(;!i.done;){const o=i.next(),a=o.shouldSplit(n,s,r);if(a!==Ot.SPLIT){if(o.resetPendingUpdate(Ot.SPLIT)&&o.updateAgentSuspension(),a===Ot.VSPLITMERGE&&o.updateAgents(vi.ELEVATION),i.skipSubtree(),!o.isLeaf){o.setPendingUpdate(Ot.MERGE),o.resetPendingUpdate(Ot.SPLIT);const l=this._iteratorPool.acquire();l.resetOne(o);const c=this._viewProjectionMatrix;for(let h=l.next();!l.done;h=l.next())this._updateClippingStatus(h),h.updateVisibility(),h.updateScreenDepth(c);l.remove()}}else o.resetPendingUpdate(Ot.MERGE),o.isLeaf&&(o.setPendingUpdate(Ot.SPLIT),i.skipSubtree()),o.rendered&&o.setPendingUpdate(Ot.RENDERDATA)}i.remove(),this.requestUpdate(),(this.shortBatches||!this.oneBatchPerFrameTask)&&this._batchUpdatePendingTileGeometries(),e.madeProgress()}_sortTiles(e){e.done||this._allTilesSorted||(fDt(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),e.madeProgress())}_markTileToUpdate(e){Re(e.isLoaded),e.intersectsClippingArea&&(this._pendingTilesToUpdate.add(e),this._markAllTileNeighborsForGeometryUpdate(e))}_batchUpdatePendingTileGeometries(){const e=this._pendingTilesToUpdate;if(e.size===0)return;const i=Array.from(this._pendingTilesToUpdate.keys()).filter(s=>s.isLoaded&&s.intersectsClippingArea),r=(s,o)=>{!(o!=null&&o.isLoaded)||!o.intersectsClippingArea||o.level<s.level||e.has(o)||(e.add(o),i.push(o),o.renderData.updateNeighborData())};i.sort(g_);const n=i.length;for(let s=0;s<n;++s){const o=i[s];Re(o.isLoaded),Re(o.intersectsClippingArea);const a=o.renderData;a.updateNeighborData();const l=a._dirtyEdgeResolutions,c=a.geometryState.neighborData;for(let h=0;h<4;++h)if(l&1<<h){const p=a.geometryState.neighborData.edgePeerNeighbors[h];p&&(p==null?void 0:p.level)>=o.level&&p.forAllSubtreeOnSide(Jz(Hg[h]),f=>!(!f.isLoaded||!f.intersectsClippingArea)&&(Re(e.has(f)||g_(o,f)<0),r(o,f),!0)),r(o,c.cornerPeerNeighbors[h]),r(o,c.cornerPeerNeighbors[(h+1)%4])}}e.clear(),this._updateTilesGeometries(i),Qs&&Xz&&this.checkAllTilesWaterproofness()}_mergeAndSplit(e,i){if(this.suspended||e.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let r=!1;const n=this.view.state.fixedContentCamera;let s=!1;for(;!e.done;){s=!0;let o=!1;const a=!this._allTiles.some(l=>{var h;if(!r&&!n&&!l.visible)return e.done;let c=l;if(l.resetPendingUpdate(Ot.MERGE)){if(!i)return l.setPendingUpdate(Ot.MERGE),e.done;for(;(h=c.parent)!=null&&h.resetPendingUpdate(Ot.MERGE);)c=c.parent;this._mergeTile(c),o=!0,e.madeProgress()}else l.resetPendingUpdate(Ot.SPLIT)&&(this._splitTile(l),o=!0,e.madeProgress());return!e.done&&c===l&&l.resetPendingUpdate(Ot.RENDERDATA)&&(this._updateRenderData(l),e.madeProgress()),e.done});if(o&&(this._allTilesSorted=!1,this._allTilesDirty=!0),a){if(!r){r=!0;continue}if(!o)break}else this._allTilesDirty=!0}s?e.madeProgress():this._allTilesDirty=!0,!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries(),this._sortTiles(e)}_updateElevation(e){e.done||(this._allTiles.some(i=>(i.resetPendingUpdate(Ot.GEOMETRY)&&(this._updateTileGeometryState(i),this._updateTileTexture(i,e),this.shortBatches&&this._batchUpdatePendingTileGeometries(),e.madeProgress()),e.done)),!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries())}_updateTextures(e){e.done||this._allTiles.some(i=>(this._updateTileTexture(i,e),e.done))}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(Wn.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){const e=this.view.resourceController.memoryController.memoryFactor;return this.view.qualitySettings.tiledSurface.lodBias-(1-e)*n0t}_getLodBiasCorrectedScale(e){const i=this.tilingScheme.levels,r=_e(e-this._lodBias,0,i.length-1),n=r-Math.floor(r);return i[Math.floor(r)].scale*(1-n)+i[Math.ceil(r)].scale*n}_removeAllTiles(){v(this._rootTiles)&&(this._rootTiles.forEach(e=>this._purgeTile(e)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this._visible=!1}_purgeDescendantTiles(e){if(!e.children[0])return!1;let i=!1;for(let r=0;r<4;++r)i=this._purgeTile(e.children[r])||i;return e.unsetChildren(),i}_purgeTile(e){const i=this._purgeDescendantTiles(e)||e.rendered;return this._allTiles.removeUnordered(e),this._unloadTile(e),this._tilePool.release(e),i}_unloadTile(e){this._pendingTilesToUpdate.delete(e),this._pendingTilesForElevationUpdateEvent.delete(e),e.unload(this._renderer)}_splitTile(e){Ig(e.isLeaf,"tile that is already split should not be split again!");const i=e.level+1,r=2*e.lij[1],n=2*e.lij[2];e.setChildren(this._createTile(i,r,n,e),this._createTile(i,r,n+1,e),this._createTile(i,r+1,n,e),this._createTile(i,r+1,n+1,e)),e.setPendingUpdate(Ot.RENDERDATA),e.updateAgentSuspension(),this._allTiles.pushArray(e.children),this._allTilesDirty=!0,++this._performanceInfo.numSplit}_emitTileScaleChange(e,i=e.level){wk.spatialReference=this.spatialReference,wk.extent=e.extent,wk.scale=this._getLodBiasCorrectedScale(i),this.emit("scale-change",wk)}_createTile(e,i,r,n){Ig(!!n,"_createTile sanity check");const s=this._acquireTile(e,i,r,n);return s.updateClippingStatus(this.extent),s.updateScreenDepth(this._viewProjectionMatrix),this._shouldSplit(s)&&s.setPendingUpdate(Ot.SPLIT),s}get shortBatches(){return this.view.state.mode!==Pi.IDLE}_mergeTile(e){Ig(!e.hasPendingUpdate(Ot.SPLIT),"_mergeTile sanity check"),this._purgeDescendantTiles(e)&&(Ig(!e.renderData,"_mergeTile sanity check"),this._loadTile(e),this._markTileToUpdate(e),this._emitTileScaleChange(e),this.shortBatches&&this._batchUpdatePendingTileGeometries()),this._allTilesDirty=!0,++this._performanceInfo.numMerged}_loadChildren(e){Ig(e.rendered,"parent should be rendered"),this._unloadTile(e);const i=e.children;i.forEach(r=>this._loadTile(r)),i.forEach(r=>this._pendingTilesToUpdate.add(r)),this._markAllTileNeighborsForGeometryUpdate(e),this._emitTileScaleChange(e,e.level+1),this.shortBatches&&this._batchUpdatePendingTileGeometries()}_loadParent(e){const i=e.parent;this._unloadChildren(i),this._loadTile(i),this._markTileToUpdate(i),this._emitTileScaleChange(i,i.level),this.shortBatches&&this._batchUpdatePendingTileGeometries()}_unloadChildren(e){const i=e.children;if(i[0])for(let r=0;r<4;++r){const n=i[r];this._unloadChildren(n),this._unloadTile(n)}}_loadTile(e){e.load(),e.setPendingUpdate(Ot.RENDERDATA),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(e)}_elevationDataArrived(e,i,r){const n=new WLt(e.lij,e.extent,r);e.dataArrived(i,vi.ELEVATION,n);const s=[e],o=e.level,a=this._iteratorPool.acquire();for(a.reset(s);!a.done;){const l=a.next();l.findElevationBoundsForLayer(i,o),l.computeElevationBounds()}o===0&&this._updateRootTileElevationBounds(),a.remove(),this._updateTilesVisibility(s)}_handleLayerViewChanges(e=ql){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let i=!1;const r=new Set;let n=-1;for(const s of this.view.allLayerViews.items)if(r.add(s.uid),XD(s)||aP(s))if(this._basemapLayerViewHandles.has(s.uid)&&!aP(s)){const o=this._layerClassFromLayerView(s),a=this._getLayerIdxByUID(o,s.uid);v(a)&&((a<n||R(n))&&(i=!0),n=a)}else this._registerTiledLayerView(s),s.layer.loaded&&(i=!0);this._basemapLayerViewHandles.forEach((s,o)=>{r.has(o)||(this._unregisterTiledLayerView(o),i=!0)}),i&&this._updateTiledLayers(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._evaluateTransparency(),e.madeProgress()}_allSurfaceLayersTransparent(){var i,r;let e=((r=(i=this.view.map)==null?void 0:i.ground)==null?void 0:r.opacity)===0;for(const n of this.view.allLayerViews.items)if(eie(n)&&!SMe(n.layer)&&n.fullOpacity!==0)return e=!1,e;return e}_hasCompositeBlendMode(){for(const e of this.view.allLayerViews.items)if((Zz(e)||aP(e))&&xDt(sie[e.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(e){return Qte(e)?vi.ELEVATION:vi.MAP}_registerTiledLayerView(e){const i=[];if((Zz(e)||aP(e))&&i.push(ne(()=>e.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(qs.UNFADED)})),aP(e))return;const r=this._layerClassFromLayerView(e);i.push(ne(()=>e.suspended,()=>this._updateTiledLayers())),i.push(ne(()=>e.fullOpacity,()=>this._updateTileTextures(qs.UNFADED))),i.push(ne(()=>"effectiveScaleRange"in e.layer?e.layer.effectiveScaleRange:null,()=>this._restartAllAgents(r))),e.on("data-changed",()=>{const n=this._getLayerIdxByUID(r,e.uid);v(n)&&this._invalidateLayerData(n,r)}),this._basemapLayerViewHandles.set(e.uid,i)}_unregisterTiledLayerView(e){const i=this._basemapLayerViewHandles.get(e);if(i){for(let r=0;r<i.length;r++)i[r].remove();this._basemapLayerViewHandles.delete(e)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const e=this.view.allLayerViews,i=[[],[]];let r=null;e.forEach(n=>{if(!n.layer||n.suspended||!XD(n)||!n.fullExtent)return;const s=this._layerClassFromLayerView(n);if(s===vi.MAP){const o=n.displayLevelRange.maxLevel;o!==1/0&&(r===null||o>r)&&(r=o)}i[s].push(n)});for(const n of FT){const s=this._layerViews[n],o=i[n];o.reverse();const a=o.length;let l=s.length!==a;const c=new Array(a),h=new Array(s.length);this._layerIndexByUid[n].clear();for(let p=0;p<a;p++){const f=o[p].uid;this._layerIndexByUid[n].set(f,p);const m=s.indexOf(o[p]);c[p]=m,p!==m&&(l=!0),m>-1&&(h[m]=p)}if(l){const p=this._postorderIterator;for(p.reset(this._rootTiles);!p.done;)p.next().modifyLayers(h,c,n);this._layerViews[n]=o,this._restartAllAgents(n),this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(r)&&this._viewChangeUpdate()}_restartAllAgents(e){const i=this._postorderIterator;for(i.reset(this._rootTiles);!i.done;){const r=i.next();r.restartAgents(e),e===vi.ELEVATION&&r.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(e,i){return this._layerViews[i][e]}numLayers(e){return this._layerViews[e].length}_updateTileTextures(e){this._allTiles.forAll(i=>{i.updateAgents(vi.MAP),e===qs.IMMEDIATE?this.renderer.updateTileTexture(i,Ot.TEXTURE_NOFADING):i.updateRenderData(vi.MAP,e)}),this._evaluateTransparency()}_invalidateLayerData(e,i){this._allTiles.forAll(r=>r.removeLayerAgent(e,i)),this._allTiles.forAll(r=>r.invalidateLayerData(e,i))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(e=Wn.UPDATE){this.renderer.setNeedsRender(e)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(e,i,r,n){const s=this.layerViewByIndex(i,r),o=s.layer;return!o.tilemapCache||WD(s)?this._requestTileData(e,r,s,n):(++this._asyncWorkItems,o.tilemapCache.fetchAvailability(e.lij[0],e.lij[1],e.lij[2],{...n,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(a=>{throw--this._asyncWorkItems,ui(n),gs(a)||this._dataMissing(e,r,s,{notInTilemap:!0}),a}).then(()=>this._frameTask.schedule(()=>this._requestTileData(e,r,s,n),n.signal)))}_requestTileData(e,i,r,n){return i===vi.ELEVATION?Qte(r)?this._requestElevationTileData(e,r,n):Promise.reject():eie(r)?this._requestMapTileData(e,r,n):Promise.reject()}_requestElevationTileData(e,i,r){++this._asyncWorkItems;const n=a=>{if(fo(r))return;const l=this._layerIndexByUid[vi.ELEVATION].get(i.uid);l!=null?(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(e,l,a)):re.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer %d %s",vi.ELEVATION,e.lij.toString())},s=a=>{gs(a)||(this._dataMissing(e,vi.ELEVATION,i,a),this.requestUpdate())};if(V1e(i.layer))return i.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],{noDataValue:_D,signal:r.signal}).then(a=>{if(!fo(r))return this._frameTask.schedule(()=>n(a),r.signal,s);re.getLogger(this.declaredClass).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.")},s).finally(()=>{--this._asyncWorkItems});const o=i.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);return this._elevationDataRequester.request(o,"binary",r).then(a=>this._lercDecoder.decode(a,{noDataValue:_D},r.signal)).then(a=>{a?n(new ILt(a)):s(new Error("LERC decoding failed"))},s).finally(()=>{--this._asyncWorkItems})}_requestMapTileData(e,i,r){++this._asyncWorkItems;const n=(h,p)=>{--this._asyncWorkItems,JR(p),fo(r)||(this._dataMissing(e,vi.MAP,i,h),this.requestUpdate())},s=h=>p=>n(p,h),o=h=>this._frameTask.schedule(()=>{--this._asyncWorkItems,this.requestUpdate(),fo(r)?JR(h):this._mapTileDataArrived(e,i,h)},r.signal,s(h)).catch(s(h)),a=(h,p=null)=>this._frameTask.schedule(()=>n(h,p));if(WD(i)){const h=i.schemaHelper.getLevelRowColumn(e.lij);return i.fetchTile(h[0],h[1],h[2],r).then(o,a)}if(B7(i))return i.fetchTile(e.lij[0],e.lij[1],e.lij[2],r).then(o,a);if(Rce(i)&&V1e(i.layer))return i.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],r).then(h=>{if(fo(r))return re.getLogger(this.declaredClass).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void a(Bi());o(h)},a);let l=i.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);Tct(i.layer)&&i.layer.refreshTimestamp&&(l+=`${l.includes("?")?"&":"?"}_ts=${i.layer.refreshTimestamp}`);const c=i.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(l,c,r).then(o,a)}_mapTileDataArrived(e,i,r){const n=this._getLayerIdxByUID(vi.MAP,i.uid);v(n)?e.dataArrived(n,vi.MAP,r):(JR(r),re.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(e,i){return this._layerIndexByUid[e].get(i)}_dataMissing(e,i,r,n){const s=this._getLayerIdxByUID(i,r.uid);v(s)?e.dataMissing(s,i,n):re.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(e){this._rootTiles&&this.overlayManager&&(this._allTiles.forAll(i=>{i.renderData&&this.overlayManager.setTileParameters(i)}),this._renderer.setNeedsRender(e))}get performanceInfo(){const e=this._performanceInfo;return e.numNodes=this._allTiles.length,e.numLeaves=e.numVisible=e.numRendered=e.numLoadedPerLevel.length=e.numRenderedPerLevel.length=0,this._allTiles.forAll(i=>{i.isLeaf&&e.numLeaves++;const r=i.level;i.renderData&&(e.numLoadedPerLevel[r]=(e.numLoadedPerLevel[r]||0)+1),i.visible&&(e.numVisible++,i.rendered&&(e.numRenderedPerLevel[r]=(e.numRenderedPerLevel[r]||0)+1,e.numRendered++))}),e}getUsedMemory(){return this.tilingScheme?(R(this._usedMemory)&&(this._usedMemory=this._recalculateUsedMemory()),v(this._usedMemory)?this._usedMemory:0):0}_recalculateUsedMemory(){return this.tilingScheme?this._allTiles.reduce((e,i)=>e+i.usedMemory,0):null}getUsedMemoryForLayerView(e){let i=0;const r=this._layerClassFromLayerView(e),n=this._getLayerIdxByUID(r,e.uid);return v(n)&&this._allTiles.forAll(s=>i+=s.getUsedMemoryForLayer(r,n)),i}getTile(e){if(R(e)||R(this._rootTiles))return null;const i=e.split("/").map(a=>+a);if(i[0]===0)return this._rootTiles.find(a=>a.lij[1]===i[1]&&a.lij[2]===i[2]);const r=2**i[0],n=Math.floor(i[1]/r),s=Math.floor(i[2]/r);let o;if(this._rootTiles.some(a=>a.lij[1]===n&&a.lij[2]===s&&(o=a,!0)),o){let a=1<<i[0]-1;for(;o.lij[0]<i[0];){let l=i[1]&a?2:0;if((i[2]&a)>0&&l++,!o.children[l])return null;o=o.children[l],a>>=1}return Ig(o.lij[0]===i[0]&&o.lij[1]===i[1]&&o.lij[2]===i[2],"not the right tile?"),o}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(e){this._renderer.renderPatchBorders=e}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(e){this._renderer.visualizeNormals=e}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(e){this._renderer.renderingDisabled=e}get test(){const e=this;return{renderer:e._renderer,lercDecoder:e._lercDecoder,forceReload:()=>{v(e._rootTiles)&&e._rootTiles.length>0&&(e._mergeTile(e._rootTiles[0]),e._viewChangeUpdate())},getTiles:()=>e._allTiles.toArray(),getRenderedTiles(){UW.clear(),e._allTiles.forAll(r=>{r.visible&&r.rendered&&UW.push(r)});const i=UW.toArray();return mUe(e.renderOrder,i),i},lockTilingScheme(i,r){e._extentHelper.defaultTiledLayersExtent=r,e.tilingSchemeLogic.test.lockTilingScheme(i)}}}checkAllTilesWaterproofness(){if(!Xz)return;const e=this._rootTiles;if(R(e))return;const i=o=>{var a,l,c;return((c=(l=(a=o==null?void 0:o.renderData)==null?void 0:a.geometryInfo)==null?void 0:l.indices)==null?void 0:c.length)>0},r=(o,a)=>{i(o)&&console.error("Tile[",o.lij,"] has geometry although parent[",a.lij,"] has geom")},n=o=>{var a,l;if(o.intersectsClippingArea)if(o.renderData&&!o.renderData.geometryState&&console.error("Tile[",o.lij,"] has renderData but not geometryState"),o.renderData&&!o.renderData.geometryInfo&&console.error("Tile[",o.lij,"] has renderData but not geometryInfo"),!((a=o.renderData)!=null&&a.geometryInfo)||(((l=o.renderData.geometryInfo.indices)==null?void 0:l.length)??0)>0||console.error("Tile[",o.lij,"] has renderData but no indices - geometryInfo: ",o.renderData.geometryInfo),i(o)){o.checkGeometryWaterproofness();for(const c of o.children)r(c,o)}else if(o.isLeaf)console.error("Tile[",o.lij,"] has no geometry and no children, from root to leaf");else for(const c of o.children)n(c)},s=o=>{var h;const a=((h=o.parent)==null?void 0:h.visible)??!0,l=o.visible;o.computeVisibility();const c=o.visible;if(l!==c&&a&&console.error(" Tile[",o.lij,"] has out of date visibility: ",l," instead of ",c),!o.isLeaf)for(const p of o.children)s(p)};for(const o of e)n(o),s(o)}get isGlobal(){return this._isGlobal}get shading(){return this._shading}_updateShadingIfChanged(){var i,r,n;((n=(r=(i=this.view)==null?void 0:i.map)==null?void 0:r.ground)==null?void 0:n.shading)!==this._shading&&this._updateShading()}_updateShading(){var i,r,n;const e=(n=(r=(i=this.view)==null?void 0:i.map)==null?void 0:r.ground)==null?void 0:n.shading;this._shading=e,this.renderer&&(this.renderer.shading=e,this.renderer.setNeedsRender()),this._updateAllTileGeometries()}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateeCarree(){return this._isWebMercatorOnPlateeCarree}isEastEndWrap(e){return this.isGlobal&&e[2]===this.lijEastEnd(e[0])-1}isWestEndWrap(e){return this.isGlobal&&e[2]===0}lijEastEnd(e){return 2**(e+(v(this.spatialReference)&&this.spatialReference.isGeographic?1:0))}wrapEastWest(e){const i=this.lijEastEnd(e[0]),r=e[2];if(0<=r&&r<i)return e;if(!this.isGlobal)return null;const n=(r+(r<0?i:0))%i;return[e[0],e[1],n]}enableInternalChecks(e){eLt(e)}enableWaterproofnessChecks(e){Q$t(e)}};u([d()],li.prototype,"_renderer",void 0),u([d({constructOnly:!0})],li.prototype,"_scaleRangeQueries",void 0),u([d()],li.prototype,"_hasPendingUpdates",void 0),u([d()],li.prototype,"_asyncWorkItems",void 0),u([d()],li.prototype,"_allTilesDirty",void 0),u([d()],li.prototype,"_allTilesSorted",void 0),u([d()],li.prototype,"_viewChanged",void 0),u([d({readOnly:!0})],li.prototype,"_watchUpdatingTracking",void 0),u([d()],li.prototype,"_frameTask",void 0),u([d({readOnly:!0})],li.prototype,"snapLevel",null),u([d({readOnly:!0})],li.prototype,"lodSnapping",null),u([d({constructOnly:!0})],li.prototype,"view",void 0),u([d()],li.prototype,"_userClippingExtent",null),u([d()],li.prototype,"_rootTilesExtent",void 0),u([d({readOnly:!0})],li.prototype,"extent",null),u([d({readOnly:!0})],li.prototype,"groundExtent",null),u([d({readOnly:!0})],li.prototype,"_tilingSchemeExtent",null),u([d({readOnly:!0})],li.prototype,"updating",null),u([d({readOnly:!0})],li.prototype,"running",null),u([d(HLt)],li.prototype,"updatingProgress",void 0),u([d({readOnly:!0})],li.prototype,"updatingProgressValue",null),u([d()],li.prototype,"_maxNumUpdating",void 0),u([d()],li.prototype,"baseOpacity",null),u([d()],li.prototype,"hasCompositeBlendMode",void 0),u([d({readOnly:!0})],li.prototype,"overlayManager",void 0),u([d({readOnly:!0})],li.prototype,"viewingMode",null),u([d()],li.prototype,"maxTextureScale",void 0),u([d({readOnly:!0})],li.prototype,"ready",null),u([d({value:sO.FRONT_TO_BACK})],li.prototype,"renderOrder",null),u([d({readOnly:!0})],li.prototype,"rootTiles",null),u([d()],li.prototype,"_rootTiles",void 0),u([d({readOnly:!0})],li.prototype,"spatialReference",null),u([d({type:Xe})],li.prototype,"backgroundColor",null),u([d({value:!1})],li.prototype,"slicePlaneEnabled",null),u([d({readOnly:!0})],li.prototype,"tilingScheme",void 0),u([d({readOnly:!0})],li.prototype,"tilingSchemeLocked",null),u([d({readOnly:!0})],li.prototype,"tilingSchemeLogic",void 0),u([d({value:!0})],li.prototype,"velvetOverground",null),u([d()],li.prototype,"wireframe",null),u([d({value:!1})],li.prototype,"suspended",null),u([d()],li.prototype,"textureFadeDuration",null),u([d()],li.prototype,"visibleElevationBounds",void 0),u([d()],li.prototype,"rootTileElevationBounds",void 0),u([d()],li.prototype,"_layerViewsDirty",void 0),u([d()],li.prototype,"renderPatchBorders",null),u([d()],li.prototype,"visualizeNormals",null),u([d()],li.prototype,"renderingDisabled",null),li=u([$("esri.views.3d.terrain.TerrainSurface")],li);const rFt=li;function xbe(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function ZUe(t){const e=t.children;if(!e[0])return!1;for(const i of e)if(i.shouldLoad)return!0;for(const i of e)if(ZUe(i))return!0;return!1}function nFt(t){var e;return t.isLeaf&&(((e=t.parent)==null?void 0:e.shouldLoad)??!1)}const yc=pi(),sFt=Kt(),bk=[0,0,0],UW=new Wt,VW={spatialReference:null,extent:Kt(),context:"ground"},wk={spatialReference:null,extent:null,scale:0};function Tbe(t,e,i){var r;for(const n of t){if(!n.containsPointXY(e,i))continue;let s=n;for(;s&&!s.renderData;){const a=(e>s.extentMidX?1:0)+(i<s.extentMidY?2:0);s=s.children[a]}const o=((r=s==null?void 0:s.renderData)==null?void 0:r.geometryState.samplerData)??null;return sn(e,i,o)}return null}let oFt=class{constructor(e,i,r){this.operation=e,this.geometry=i,this.states=r}},KI=class extends ve{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commitLayer(e,i){const r=this._dirtyGeomRecords.get(e);r&&(r.forEach((n,s)=>{const o=this._ensureGeomRecord(e,s);n.forEach(({geometry:a,operation:l,states:c},h)=>{let p=!1;if(l===wn.UPDATE){const f=o.get(h);if(f){if(c&co.TRANSFORMATION){const m=this.model.getObject(s);this.model.updateRenderGeometryTransformation(m,a,f)&&(p=!0)}p||i.updates.push({renderGeometry:f,updateType:c})}else wt(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(l===wn.REMOVE||p){const f=o.get(h);f?(i.removes.push(f),o.delete(h)):l===wn.REMOVE&&wt(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove")}if(l===wn.ADD||p){const f=this.model.getObject(s);if(v(f)){const m=this.model.getRenderGeometry(f,a);i.adds.push(m),o.set(h,m)}}}),o.size===0&&this._residentGeomRecords.get(e).delete(s)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e),this.dirty=this._hasDirtyGeometryRecords)}getResidentRenderGeometries(e,i){const r=this._residentGeomRecords.get(e);r&&r.forEach(n=>n.forEach(s=>i.push(s)))}_objectStateChanged(e,i){for(const r of i.geometries)this._updateOrCreateDirtyRecord(i,r,null,wn.UPDATE,e)}visibilityChanged(e){this._objectStateChanged(co.VISIBILITY,e)}highlightChanged(e){this._objectStateChanged(co.HIGHLIGHT,e)}occlusionChanged(e){this._objectStateChanged(co.OCCLUDEE,e)}objectGeometryUpdated(e){this._updateOrCreateDirtyRecord(e.object,e.geometry,null,wn.UPDATE,co.GEOMETRY)}layerAdded(e){e.objects.forAll(i=>this._layerObjectAdded(e,i))}layerRemoved(e){e.objects.forAll(i=>this._layerObjectRemoved(e,i))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,i){const r=e.id;for(const n of i.geometries)this._objectGeometryAdded(i,n,r)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const i of e.objects)this._layerObjectAdded(e.layer,i)}layerObjectsRemoved(e){for(const i of e.objects)this._layerObjectRemoved(e.layer,i)}_layerObjectRemoved(e,i){const r=e.id;for(const n of i.geometries)this._objectGeometryRemoved(i,n,r)}shaderTransformationChanged(e){const i=this._residentGeomRecords.get(e.id);i&&i.forEach((r,n)=>{const s=this.model.getObject(n);s&&s.hasVolativeTransformation()&&r.forEach(o=>o.shaderTransformationChanged())})}objectTransformation(e){const i=this._getParentLayerId(e),r=e.id;this._ensureGeomRecord(i,r).forEach(n=>{this._updateOrCreateDirtyRecord(e,n.geometry,i,wn.UPDATE,co.TRANSFORMATION)})}objectGeometryAdded(e){this._objectGeometryAdded(e.object,e.geometry)}_objectGeometryAdded(e,i,r=null){this._updateOrCreateDirtyRecord(e,i,r,wn.ADD)}objectGeometryRemoved(e){this._objectGeometryRemoved(e.object,e.geometry)}_objectGeometryRemoved(e,i,r=null){this._updateOrCreateDirtyRecord(e,i,r,wn.REMOVE)}_updateOrCreateDirtyRecord(e,i,r,n,s=co.NONE){r=Nt(r,this._getParentLayerId(e));const o=e.id,a=i.id,l=this._ensureDirtyRecord(r,o),c=l.get(a);if(c){const h=c.operation;h===wn.REMOVE&&n===wn.ADD&&c.states!==co.NONE?c.operation=wn.UPDATE:h===wn.REMOVE&&n===wn.ADD||h===wn.ADD&&n===wn.REMOVE?l.delete(a):h!==wn.UPDATE||n!==wn.REMOVE&&n!==wn.UPDATE?(wt((h===wn.REMOVE||h===wn.ADD)&&n===wn.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"),c.states|=s):(c.operation=n,c.states|=s)}else l.set(a,new oFt(n,i,s));this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(e,i){let r=this._residentGeomRecords.get(e);r||(r=new Map,this._residentGeomRecords.set(e,r));let n=r.get(i);return n||(n=new Map,r.set(i,n)),n}get _hasDirtyGeometryRecords(){return pa(this._dirtyGeomRecords,e=>pa(e,i=>i&&i.size>0))}_ensureDirtyRecord(e,i){let r=this._dirtyGeomRecords.get(e);r||(r=new Map,this._dirtyGeomRecords.set(e,r));let n=r.get(i);return n||(n=new Map,r.set(i,n)),n}_getParentLayerId(e){return v(e.parentLayer)?e.parentLayer.id:Aje}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let i="";return this._dirtyGeomRecords.forEach((r,n)=>{r.forEach((s,o)=>{i.length>0&&(i+=`
`),i+=n+"."+o;const a=[];s.forEach(l=>{const c=l.operation;a[c]||(a[c]=[]),a[c].push(l.geometry.id)});for(let l=0;l<a.length;l++)if(a[l]){i+=" "+e[l-1]+": ";for(let c=0;c<a[l].length;c++)i+=a[l][c]+", "}})}),i}get test(){const e=this;return{get residentLayerCount(){return e._residentGeomRecords.size},get residentObjectCount(){return Array.from(e._residentGeomRecords.values()).reduce((i,r)=>i+r.size,0)},commit:i=>e._dirtyGeomRecords.forEach((r,n)=>e.commitLayer(n,i))}}};u([d({constructOnly:!0})],KI.prototype,"model",void 0),u([d()],KI.prototype,"dirty",void 0),KI=u([$("esri.views.3d.webgl-engine.lib.ModelDirtySet")],KI);const aFt=KI;let QU=class extends ve{constructor(){super(...arguments),this.dirtySet=new aFt({model:this}),this._content=new Map,this._originFactory=new oce(null)}getObject(e){return this._content.get(e)}add(e){const i=e.id;wt(!this._content.has(i),"Model/Stage already contains object to be added"),this._content.set(i,e),kz(e)&&this.dirtySet.layerAdded(e)}remove(e){wt(this._content.has(e.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(e.id),e.unload(),kz(e)&&this.dirtySet.layerRemoved(e)}addMany(e){for(const i of e)v(i)&&(wt(!this._content.has(i.id),"Model/Stage already contains object to be added"),this._content.set(i.id,i))}removeMany(e){for(const i of e)wt(this._content.has(i.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(i.id),i.unload()}has(e){return this._content.has(e.id)}forEachOfType(e,i){this._content.forEach(r=>{r.type===e&&i(r)})}getRenderGeometry(e,i){const{shaderTransformer:r,localOrigin:n}=i,s=new nO(i,{boundingInfo:i.boundingInfo,shaderTransformer:r,castShadow:e.castShadow});return s.updateTransformation(o=>e.getCombinedStaticTransformation(i,o)),s.localOrigin=v(n)?n:this._originFactory.getOrigin(s.boundingSphere),s}updateRenderGeometryTransformation(e,i,r){if(R(e))return!1;r.updateTransformation(s=>e.getCombinedStaticTransformation(i,s));const n=this._originFactory.getOrigin(r.boundingSphere);return r.localOrigin!==n}getStats(){const e={},i=Array.from(this._content.values());for(let r=0;r<Zn.COUNT;++r)e[r]=i.filter(n=>n.type===r).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};u([d({constructOnly:!0})],QU.prototype,"dirtySet",void 0),QU=u([$("esri.views.3d.webgl-engine.parts.Model")],QU);function lFt(){const t=new Float32Array(4);return t[3]=1,t}function JUe(t){const e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function cFt(t,e,i,r){const n=new Float32Array(4);return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n}function KUe(t,e){return new Float32Array(t,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:JUe,create:lFt,createView:KUe,fromValues:cFt},Symbol.toStringTag,{value:"Module"}));const oO=1e-6,dP=[0,0,0],xk=[0,0,0];function uFt(t,e){const{data:i,size:r}=t,n=i.length/r;if(n<=0)return;const s=new vFt(t);e8(dP,s.minProj,s.maxProj),cS(dP,dP,.5),lp(xk,s.maxProj,s.minProj);const o=uie(xk),a=new bFt;a.quality=o,n<14&&(t=new Qe(new Float64Array(s.buffer,112,42),3));const l=[0,0,0],c=[0,0,0],h=[0,0,0],p=[0,0,0],f=[0,0,0],m=[0,0,0],g=[0,0,0];switch(hFt(s,t,g,l,c,h,p,f,m,a)){case 1:return void Abe(dP,xk,e);case 2:return void _Ft(t,p,e)}dFt(t,g,l,c,h,p,f,m,a),QUe(t,a.b0,a.b1,a.b2,eM,tM);const _=[0,0,0];lp(_,tM,eM),a.quality=uie(_),a.quality<o?e8e(a.b0,a.b1,a.b2,eM,tM,_,e):Abe(dP,xk,e)}function hFt(t,e,i,r,n,s,o,a,l,c){return pFt(t,r,n),hie(r,n)<oO?1:(lp(o,r,n),Ia(o,o),fFt(e,r,o,s)<oO?2:(lp(a,n,s),Ia(a,a),lp(l,s,r),Ia(l,l),cp(i,a,o),Ia(i,i),kT(e,i,o,a,l,c),0))}const pP=[0,0,0],fP=[0,0,0],Ad=[0,0,0],Rd=[0,0,0],Md=[0,0,0],qv=[0,0,0],Wv=[0,0,0],Xv=[0,0,0];function dFt(t,e,i,r,n,s,o,a,l){mFt(t,e,i,pP,fP),pP[0]!==void 0&&(lp(Ad,pP,i),Ia(Ad,Ad),lp(Rd,pP,r),Ia(Rd,Rd),lp(Md,pP,n),Ia(Md,Md),cp(qv,Rd,s),Ia(qv,qv),cp(Wv,Md,o),Ia(Wv,Wv),cp(Xv,Ad,a),Ia(Xv,Xv),kT(t,qv,s,Rd,Ad,l),kT(t,Wv,o,Md,Rd,l),kT(t,Xv,a,Ad,Md,l)),fP[0]!==void 0&&(lp(Ad,fP,i),Ia(Ad,Ad),lp(Rd,fP,r),Ia(Rd,Rd),lp(Md,fP,n),Ia(Md,Md),cp(qv,Rd,s),Ia(qv,qv),cp(Wv,Md,o),Ia(Wv,Wv),cp(Xv,Ad,a),Ia(Xv,Xv),kT(t,qv,s,Rd,Ad,l),kT(t,Wv,o,Md,Rd,l),kT(t,Xv,a,Ad,Md,l))}function pFt(t,e,i){let r=hie(t.maxVert[0],t.minVert[0]),n=0;for(let s=1;s<7;++s){const o=hie(t.maxVert[s],t.minVert[s]);o>r&&(r=o,n=s)}Bu(e,t.minVert[n]),Bu(i,t.maxVert[n])}const Od=[0,0,0];function fFt(t,e,i,r){const{data:n,size:s}=t;let o=Number.NEGATIVE_INFINITY,a=0;for(let l=0;l<n.length;l+=s){Od[0]=n[l]-e[0],Od[1]=n[l+1]-e[1],Od[2]=n[l+2]-e[2];const c=i[0]*Od[0]+i[1]*Od[1]+i[2]*Od[2],h=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],p=Od[0]*Od[0]+Od[1]*Od[1]+Od[2]*Od[2]-c*c/h;p>o&&(o=p,a=l)}return Bu(r,n,a),o}const lo=[0,0];function mFt(t,e,i,r,n){yFt(t,e,lo,n,r);const s=i8e(i,e);lo[1]-oO<=s&&(r[0]=void 0),lo[0]+oO>=s&&(n[0]=void 0)}const Sbe=[0,0,0],Ebe=[0,0,0],Cbe=[0,0,0],uC=[0,0,0],hC=[0,0,0],Tk=[0,0,0];function kT(t,e,i,r,n,s){if(t8e(e)<oO)return;cp(Sbe,i,e),cp(Ebe,r,e),cp(Cbe,n,e),QR(t,e,lo),hC[1]=lo[0],uC[1]=lo[1],Tk[1]=uC[1]-hC[1];const o=[i,r,n],a=[Sbe,Ebe,Cbe];for(let l=0;l<3;++l){QR(t,o[l],lo),hC[0]=lo[0],uC[0]=lo[1],QR(t,a[l],lo),hC[2]=lo[0],uC[2]=lo[1],Tk[0]=uC[0]-hC[0],Tk[2]=uC[2]-hC[2];const c=uie(Tk);c<s.quality&&(Bu(s.b0,o[l]),Bu(s.b1,e),Bu(s.b2,a[l]),s.quality=c)}}const gFt=[0,0,0];function QR(t,e,i){const{data:r,size:n}=t;i[0]=Number.POSITIVE_INFINITY,i[1]=Number.NEGATIVE_INFINITY;for(let s=0;s<r.length;s+=n){const o=r[s]*e[0]+r[s+1]*e[1]+r[s+2]*e[2];i[0]=Math.min(i[0],o),i[1]=Math.max(i[1],o)}}function yFt(t,e,i,r,n){const{data:s,size:o}=t;Bu(r,s),Bu(n,r),i[0]=i8e(gFt,e),i[1]=i[0];for(let a=o;a<s.length;a+=o){const l=s[a]*e[0]+s[a+1]*e[1]+s[a+2]*e[2];l<i[0]&&(i[0]=l,Bu(r,s,a)),l>i[1]&&(i[1]=l,Bu(n,s,a))}}function Abe(t,e,i){Bu(i.center,t),cS(i.halfSize,e,.5),i.quaternion[0]=0,i.quaternion[1]=0,i.quaternion[2]=0,i.quaternion[3]=1}const e0=[0,0,0],dC=[0,0,0],mP=[0,0,0],eM=[0,0,0],tM=[0,0,0],Rbe=[0,0,0];function _Ft(t,e,i){Bu(e0,e),Math.abs(e[0])>Math.abs(e[1])&&Math.abs(e[0])>Math.abs(e[2])?e0[0]=0:Math.abs(e[1])>Math.abs(e[2])?e0[1]=0:e0[2]=0,t8e(e0)<oO&&(e0[0]=e0[1]=e0[2]=1),cp(dC,e,e0),Ia(dC,dC),cp(mP,e,dC),Ia(mP,mP),QUe(t,e,dC,mP,eM,tM),lp(Rbe,tM,eM),e8e(e,dC,mP,eM,tM,Rbe,i)}function QUe(t,e,i,r,n,s){QR(t,e,lo),n[0]=lo[0],s[0]=lo[1],QR(t,i,lo),n[1]=lo[0],s[1]=lo[1],QR(t,r,lo),n[2]=lo[0],s[2]=lo[1]}const Sk=[0,0,0],Zm=[1,0,0,0,1,0,0,0,1],pC=[0,0,0];function e8e(t,e,i,r,n,s,o){Zm[0]=t[0],Zm[1]=t[1],Zm[2]=t[2],Zm[3]=e[0],Zm[4]=e[1],Zm[5]=e[2],Zm[6]=i[0],Zm[7]=i[1],Zm[8]=i[2],wFt(o.quaternion,Zm),e8(pC,r,n),cS(pC,pC,.5),cS(o.center,t,pC[0]),cS(Sk,e,pC[1]),e8(o.center,o.center,Sk),cS(Sk,i,pC[2]),e8(o.center,o.center,Sk),cS(o.halfSize,s,.5)}const _h=7;let vFt=class{constructor(e){this.minVert=new Array(_h),this.maxVert=new Array(_h);const i=64*_h;this.buffer=new ArrayBuffer(i);let r=0;this.minProj=new Float64Array(this.buffer,r,_h),r+=8*_h,this.maxProj=new Float64Array(this.buffer,r,_h),r+=8*_h;for(let l=0;l<_h;++l)this.minVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<_h;++l)this.maxVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<_h;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const n=new Array(_h),s=new Array(_h),{data:o,size:a}=e;for(let l=0;l<o.length;l+=a){let c=o[l];c<this.minProj[0]&&(this.minProj[0]=c,n[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,s[0]=l),c=o[l+1],c<this.minProj[1]&&(this.minProj[1]=c,n[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,s[1]=l),c=o[l+2],c<this.minProj[2]&&(this.minProj[2]=c,n[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,s[2]=l),c=o[l]+o[l+1]+o[l+2],c<this.minProj[3]&&(this.minProj[3]=c,n[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,s[3]=l),c=o[l]+o[l+1]-o[l+2],c<this.minProj[4]&&(this.minProj[4]=c,n[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,s[4]=l),c=o[l]-o[l+1]+o[l+2],c<this.minProj[5]&&(this.minProj[5]=c,n[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,s[5]=l),c=o[l]-o[l+1]-o[l+2],c<this.minProj[6]&&(this.minProj[6]=c,n[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,s[6]=l)}for(let l=0;l<_h;++l){let c=n[l];Bu(this.minVert[l],o,c),c=s[l],Bu(this.maxVert[l],o,c)}}},bFt=class{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}};function uie(t){return t[0]*t[1]+t[0]*t[2]+t[1]*t[2]}function e8(t,e,i){t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2]}function lp(t,e,i){t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2]}function cS(t,e,i){t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}function Bu(t,e,i=0){t[0]=e[i+0],t[1]=e[i+1],t[2]=e[i+2]}function cp(t,e,i){const r=e[0],n=e[1],s=e[2],o=i[0],a=i[1],l=i[2];t[0]=n*l-s*a,t[1]=s*o-r*l,t[2]=r*a-n*o}function Ia(t,e){const i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(i>0){const r=1/Math.sqrt(i);t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r}}function t8e(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function hie(t,e){const i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return i*i+r*r+n*n}function i8e(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function wFt(t,e){const i=e[0]+e[4]+e[8];if(i>0){let r=Math.sqrt(i+1);t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r}else{let r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);const n=(r+1)%3,s=(r+2)%3;let o=Math.sqrt(e[3*r+r]-e[3*n+n]-e[3*s+s]+1);t[r]=.5*o,o=.5/o,t[3]=(e[3*n+s]-e[3*s+n])*o,t[n]=(e[3*n+r]+e[3*r+n])*o,t[s]=(e[3*s+r]+e[3*r+s])*o}}const dL=zp(),RS=P(),xFt=P(),TFt=wr();let Nti=class{constructor(e){const o=e*56;this.buffer=new ArrayBuffer(o),this.obbs=new Array(e);for(let a=0;a<e;a++)this.obbs[a]={center:Ene(this.buffer,56*a+0),halfSize:ODe(this.buffer,56*a+24),quaternion:KUe(this.buffer,56*a+36)}}};function r8e(t=[0,0,0],e=[-1,-1,-1],i=zp()){return{center:In(t),halfSize:lz(e),quaternion:JUe(i)}}function Mbe(t){return r8e(t.center,t.halfSize,t.quaternion)}function kti(t,e){ce(e.center,t.center),ce(e.halfSize,t.halfSize),ale(e.quaternion,t.quaternion)}function Uti(t,e){return e=e||r8e(),uFt(t,e),e}function UT(t,e){const i=Pr(e,t.center),r=X7(t,e);return i>r?1:i<-r?-1:0}function Vti(t,e){e||(e=to());const i=Yoe(TFt,t.quaternion),r=t.halfSize[0]*Math.abs(i[0])+t.halfSize[1]*Math.abs(i[3])+t.halfSize[2]*Math.abs(i[6]),n=t.halfSize[0]*Math.abs(i[1])+t.halfSize[1]*Math.abs(i[4])+t.halfSize[2]*Math.abs(i[7]),s=t.halfSize[0]*Math.abs(i[2])+t.halfSize[1]*Math.abs(i[5])+t.halfSize[2]*Math.abs(i[8]);return e[0]=t.center[0]-r,e[1]=t.center[1]-n,e[2]=t.center[2]-s,e[3]=t.center[0]+r,e[4]=t.center[1]+n,e[5]=t.center[2]+s,e}function zti(t,e){return Pr(e,t.center)-X7(t,e)}function Bti(t,e){return Pr(e,t.center)+X7(t,e)}function jti(t,e){return UT(t,e[0])<=0&&UT(t,e[1])<=0&&UT(t,e[2])<=0&&UT(t,e[3])<=0&&UT(t,e[4])<=0&&UT(t,e[5])<=0}function Gti(t,e,i,r=0){E2(dL,t.quaternion),ge(RS,e,t.center);const n=om(RS,RS,dL),s=om(xFt,i,dL);let o=-1/0,a=1/0;for(let l=0;l<3;l++)if(Math.abs(s[l])>1e-6){const c=(r+t.halfSize[l]-n[l])/s[l],h=(-r-t.halfSize[l]-n[l])/s[l];o=Math.max(o,Math.min(c,h)),a=Math.min(a,Math.max(c,h))}else if(n[l]>t.halfSize[l]+r||n[l]<-t.halfSize[l]-r)return!1;return o<=a}(()=>{const t=new Int8Array(162);let e=0;const i=r=>{for(let n=0;n<r.length;n++)t[e+n]=r[n];e+=6};return i([6,2,3,1,5,4]),i([0,2,3,1,5,4]),i([0,2,3,7,5,4]),i([0,1,3,2,6,4]),i([0,1,3,2,0,0]),i([0,1,5,7,3,2]),i([0,1,3,7,6,4]),i([0,1,3,7,6,2]),i([0,1,5,7,6,2]),i([0,1,5,4,6,2]),i([0,1,5,4,0,0]),i([0,1,3,7,5,4]),i([0,2,6,4,0,0]),i([0,0,0,0,0,0]),i([1,3,7,5,0,0]),i([2,3,7,6,4,0]),i([2,3,7,6,0,0]),i([2,3,1,5,7,6]),i([0,1,5,7,6,2]),i([0,1,5,7,6,4]),i([0,1,3,7,6,4]),i([4,5,7,6,2,0]),i([4,5,7,6,0,0]),i([4,5,1,3,7,6]),i([0,2,3,7,5,4]),i([6,2,3,7,5,4]),i([6,2,3,1,5,4]),t})();function X7(t,e){E2(dL,t.quaternion),om(RS,e,dL);const i=t.halfSize;return Math.abs(RS[0]*i[0])+Math.abs(RS[1]*i[1])+Math.abs(RS[2]*i[2])}function Hti(t,e){for(let i=0;i<8;++i){const r=e[i];r[0]=1&i?-t.halfSize[0]:t.halfSize[0],r[1]=2&i?-t.halfSize[1]:t.halfSize[1],r[2]=4&i?-t.halfSize[2]:t.halfSize[2],om(r,r,t.quaternion),me(r,r,t.center)}}function SFt(t){return Ru(t.halfSize)}function EFt(t,e,i,r,n){if(ale(n.quaternion,t.quaternion),r===qe.Global){E2(Ek,t.quaternion),om(Yv,t.center,Ek),tZ(fC,Yv),iCe(mC,fC,t.halfSize),Fo(mC,fC,mC);const s=Pe(mC);me(mC,fC,t.halfSize);const o=Pe(mC);if(s<i)ce(n.center,t.center),he(Yv,i,i,i),me(n.halfSize,t.halfSize,Yv);else{const a=o>0?1+e/o:1,l=s>0?1+i/s:1,c=(l+a)/2,h=(l-a)/2;le(n.halfSize,fC,h),gS(n.halfSize,n.halfSize,t.halfSize,c),le(n.center,fC,c),gS(n.center,n.center,t.halfSize,h),tCe(Yv,Yv),B9(n.center,n.center,Yv),om(n.center,n.center,n.quaternion)}}else{const s=he(Yv,0,0,1);gS(n.center,t.center,s,(i+e)/2),E2(Ek,t.quaternion),om(s,s,Ek),tZ(s,s),gS(n.halfSize,t.halfSize,s,(i-e)/2)}return n}const Yv=P(),fC=P(),mC=P(),Ek=zp();let CFt=class{constructor(e){this._totalCount=e,this._indexRanges=[0,e]}allVisible(){return this.componentCount()===this._totalCount}allInvisible(){return this._indexRanges.length===0}componentCount(){const e=this._indexRanges;let i=0;for(let r=0;r<e.length;r+=2)i+=e[r+1];return i}reset(e){e==="all"||e.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=AFt(e)}forEachComponent(e){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const n=i[r],s=n+i[r+1];for(let o=n;o<s;o++)if(!e(o))return!1}return!0}forEachComponentRange(e){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const n=i[r];if(!e(n,n+i[r+1]))return!1}return!0}computeOffsetRanges(e){const i=new Array(this._indexRanges.length),r=this._indexRanges;for(let n=0;n<r.length;n+=2){const s=r[n],o=s+r[n+1],a=e[s],l=e[o];i[n]=a,i[n+1]=l-a}return i}};function AFt(t){const e=new Array;if(t.length===0)return e;let i=t[0],r=1;for(let n=1;n<t.length;n++){const s=t[n];i+r===s?r+=1:(e.push(i),e.push(r),i=s,r=1)}return e.push(i),e.push(r),e}let RFt=class{constructor(e,i){this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null,this.offsets=i.slice();const r=this.count;this.visibility=new CFt(r),this.materialDataBuffer=e.getBuffer(r),this.materialDataIndices=new Uint16Array(r);for(let n=0;n<r;n++)this.materialDataIndices[n]=this.materialDataBuffer.acquireIndex()}destroy(){for(let e=0;e<this.count;e++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[e])}get count(){return this.offsets.length-1}get geometryRanges(){return R(this.cachedGeometryRanges)&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return R(this.highlightCounts)?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return R(this.highlightCounts)?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((R(this.cachedHighlightRanges)||R(this.cachedDefaultRanges))&&v(this.highlightCounts)){const{highlightRanges:e,defaultRanges:i}=MFt(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=e,this.cachedDefaultRanges=i}}};function MFt(t,e,i){const r=[],n=[];let s=i.length,o=i.length;return e.forEachComponent(a=>(t[a]>0?(s!==a-1&&(r.length&&r.push(i[s+1]-r[r.length-1]),r.push(i[a])),s=a):(o!==a-1&&(n.length&&n.push(i[o+1]-n[n.length-1]),n.push(i[a])),o=a),!0)),r.length&&r.push(i[s+1]-r[r.length-1]),n.length&&n.push(i[o+1]-n[n.length-1]),{highlightRanges:r,defaultRanges:n}}let QI=class extends ve{constructor(){super(...arguments),this.visible=iM.Hidden}};var iM;u([d({autoDestroy:!0})],QI.prototype,"renderable",void 0),u([d({autoDestroy:!0})],QI.prototype,"components",void 0),QI=u([$("esri.views.3d.webgl-engine.collections.Component.ComponentObject")],QI),function(t){t[t.Hidden=0]="Hidden",t[t.Visible=1]="Visible"}(iM||(iM={}));function OFt(t,e,i,r){if(i>=e)return t;t==null&&(t=PFt());const n=t.isVisibleBit;let s=t.data;const o=s8e(s),a=i/o|0,l=i-o*a,c=(e-1)/o|0,h=s,p=r===n;if(!(i<h.length*o)&&p){const m=a+1,g=Math.ceil(h.length*1.5),_=c+1;let b=Math.max(m,g);b=Math.min(b,_),s=new Uint32Array(b),s.set(h)}return a<s.length&&(s[a]=$Ft(s[a],l,p)),t.data=s,t}function n8e(t,e){if(t==null)return!0;const{isVisibleBit:i,data:r}=t,n=s8e(r);return e<r.length*n?IFt(i,r,e,n):!t.isVisibleBit}function PFt(t=!0){return{isVisibleBit:!t,data:new Uint32Array(0)}}function IFt(t,e,i,r){const n=i/r|0,s=i-n*r;return LFt(e[n],s)===t}function s8e(t){return t.BYTES_PER_ELEMENT*8}function $Ft(t,e,i){return t&~(1<<e)|(i?1:0)<<e}function LFt(t,e){return(t&1<<e)!=0}let DFt=class{constructor(e,i){this._indices=v(e.indices)?e.indices:ZM(e.positions.length/3),this._positions=new jr(e.positions),this._components=i,this._componentIntersectionData=new Array(i.count)}getComponentAabb(e,i){if(v(this._perComponentAabbs)){for(let r=0;r<6;r++)i[r]=this._perComponentAabbs[6*e+r];return i}return this._computePerComponentAabbs(),this.getComponentAabb(e,i)}getComponentPositions(e,i){i.indices=this._indices,i.data=this._positions.typedBuffer,i.stride=this._positions.typedBufferStride,i.startIndex=this._components.offsets[e],i.endIndex=this._components.offsets[e+1]}intersect(e,i,r,n,s,o,a){const l=new Qe(this._positions.typedBuffer,3,!1,this._positions.typedBufferStride),c=this._indices,h=this._components.offsets,p=b4e(e,i,NFt),f=e[2],m=i[2];this._components.visibility.forEachComponent(g=>{if(!n8e(this._components.pickability,g))return!0;const _=this.getComponentAabb(g,FFt);if(v(o)){const E=o[g];v(s)?s.componentOffset=E:(e[2]=f-E,i[2]=m-E)}if(v(s)&&s.applyToAabb(_),!Nle(_,e,p,r))return!0;const b=h[g]/3,w=h[g+1]/3,x=w-b,T=(E,C,A)=>a(g,E,Wl(C,C,n),A);return R(s)&&x>XUe?(this._componentIntersectionData[g]==null&&(this._componentIntersectionData[g]=new Uce(this._indices,b,w,l)),this._componentIntersectionData[g].intersectRay({r0:e,r1:i},T)):QN(e,i,b,w,c,l,void 0,s,T),!0})}_computePerComponentAabbs(){const e=this._components.count;this._perComponentAabbs=new Float32Array(6*e);const i=this._indices,r=this._positions.typedBuffer,n=this._positions.typedBufferStride,s=this._components.offsets;let o=0;for(let a=0;a<e;a++){const l=s[a],c=s[a+1];let h=1/0,p=1/0,f=1/0,m=-1/0,g=-1/0,_=-1/0;for(let b=l;b<c;b++){const w=i[b]*n,x=r[w],T=r[w+1],E=r[w+2];h=Math.min(h,x),p=Math.min(p,T),f=Math.min(f,E),m=Math.max(m,x),g=Math.max(g,T),_=Math.max(_,E)}this._perComponentAabbs[o++]=h,this._perComponentAabbs[o++]=p,this._perComponentAabbs[o++]=f,this._perComponentAabbs[o++]=m,this._perComponentAabbs[o++]=g,this._perComponentAabbs[o++]=_}}get positions(){return this._positions}get indices(){return this._indices}};const NFt=P(),FFt=to();let kFt=class{constructor(e,i,r){this.material=e,this.geometry=i,this.meta=r}destroy(){this.material.dispose(),this.geometry.dispose()}},UFt=class{constructor(e,i,r,n){this.vao=e,this.primitiveType=i,this.parameters=r,this.indexed=n}dispose(){this.vao.dispose()}},VFt=class{constructor(){this.near=Number.MAX_VALUE,this.far=-Number.MAX_VALUE}};function zFt(t,e){return{near:t,far:e}}function cF(t){return t?ZD(t,1/0,-1/0):zFt(1/0,-1/0)}function ZD(t,e,i){return t.near=e,t.far=i,t}function aO(t,e,i=t){return e!=null&&(i.near=Math.min(t.near,e.near),i.far=Math.max(t.far,e.far)),i}function Ck(t,e){return t.near<=e&&e<=t.far}const die={near:0,far:0};function BFt(t,e){const i=cF(),{eye:r,frustum:n,viewForward:s}=t;e.forAll(o=>{const a=v(o.offsetObb)?o.offsetObb:o.obb,l=be(Fo(Eh,a.center,r),s),c=X7(a,s);if(Ck(i,l-c)&&Ck(i,l+c))return;const h=WFt(a,n);if(h===-1)return;if(h===0)return t0.far=l+c,t0.near=l-c,void aO(i,t0);const p=Ak.pushNew();p.near=l-c,p.far=l+c,p.mask=h,p.object=o});for(let o=0;o<Ak.length;o++){const a=Ak.data[o];if(Ck(i,a.near)&&Ck(i,a.far))continue;t0.far=a.far,t0.near=1/0,qFt(v(a.object.offsetObb)?a.object.offsetObb:a.object.obb,r,jFt,c=>{let h=GFt;for(let p=0;p<o8e&&c.length>0;p++){if(!(a.mask&1<<p))continue;HFt(n[p],c,h);const f=c;c=h,h=f}for(let p=0;p<c.length;p+=3){he(Ic,c.data[p+0],c.data[p+1],c.data[p+2]);const f=be(Fo(Ic,Ic,r),s);t0.near=Math.min(t0.near,f)}})===0&&(t0.near=0),aO(i,t0)}return Ak.length=0,i}const Ak=new Wt({allocator:t=>t||{near:1/0,far:-1/0,mask:0,object:null},deallocator:t=>(t.object=e2(t.object),t)}),t0=cF(),Ic=P(),Dx=P(),jFt=new Wt({deallocator:null}),GFt=new Wt({deallocator:null});function HFt(t,e,i){i.length=0;const r=e.length-3;zW(Ic,e,r);const n=Pr(t,Ic);n<=0&&(i.push(Ic[0]),i.push(Ic[1]),i.push(Ic[2]));let s=0,o=n;for(;s<r;s+=3){zW(Dx,e,s);const a=Pr(t,Dx);o*a<0&&(ys(Ic,Dx,Ic,a/(a-o)),$c(i,Ic)),a<=0&&$c(i,Dx),o=a,ce(Ic,Dx)}o*n<0&&(zW(Dx,e,r),ys(Ic,Dx,Ic,n/(n-o)),$c(i,Ic))}function zW(t,e,i){return he(t,e.data[i+0],e.data[i+1],e.data[i+2])}function $c(t,e){t.push(e[0]),t.push(e[1]),t.push(e[2])}function qFt(t,e,i,r){E2(Pbe,t.quaternion),Fo(Eh,e,t.center),om(Eh,Eh,Pbe);const n=8*((Eh[0]<-t.halfSize[0]?-1:Eh[0]>t.halfSize[0]?1:0)+3*(Eh[1]<-t.halfSize[1]?-1:Eh[1]>t.halfSize[1]?1:0)+9*(Eh[2]<-t.halfSize[2]?-1:Eh[2]>t.halfSize[2]?1:0)+13),s=Obe[n];if(s===0)return s;Yoe(Rk,t.quaternion),Xoe(Rk,Rk,t.halfSize);const o=(a,l)=>{const c=Obe[n+l+1];return he(a,((1&c)<<1)-1,(2&c)-1,((4&c)>>1)-1),Wl(a,a,Rk),me(a,t.center,a)};return i.length=0,$c(i,o(BW,0)),$c(i,o(Ibe,1)),$c(i,o(Eh,2)),$c(i,o($be,3)),r(i),s===1||(i.length=0,$c(i,BW),$c(i,$be),$c(i,o(Eh,4)),$c(i,o(Lbe,5)),r(i),s===2||(i.length=0,$c(i,BW),$c(i,Lbe),$c(i,o(Eh,6)),$c(i,Ibe),r(i))),s}const Obe=(()=>{const t=new Int8Array(216);let e=0;const i=r=>{for(let n=0;n<r.length;n++)t[e+n]=r[n];e+=8};return i([3,0,6,2,3,1,5,4]),i([2,0,2,3,1,5,4,0]),i([3,1,0,2,3,7,5,4]),i([2,0,1,3,2,6,4,0]),i([1,0,1,3,2,0,0,0]),i([2,1,5,7,3,2,0,0]),i([3,2,0,1,3,7,6,4]),i([2,2,0,1,3,7,6,0]),i([3,3,0,1,5,7,6,2]),i([2,0,1,5,4,6,2,0]),i([1,0,1,5,4,0,0,0]),i([2,1,3,7,5,4,0,0]),i([1,0,2,6,4,0,0,0]),i([0,0,0,0,0,0,0,0]),i([1,1,3,7,5,0,0,0]),i([2,2,3,7,6,4,0,0]),i([1,2,3,7,6,0,0,0]),i([2,3,1,5,7,6,2,0]),i([3,4,0,1,5,7,6,2]),i([2,5,7,6,4,0,1,0]),i([3,5,0,1,3,7,6,4]),i([2,4,5,7,6,2,0,0]),i([1,4,5,7,6,0,0,0]),i([2,5,1,3,7,6,4,0]),i([3,6,0,2,3,7,5,4]),i([2,6,2,3,7,5,4,0]),i([3,7,6,2,3,1,5,4]),t})(),o8e=4;function WFt(t,e){let i=0;for(let r=0;r<o8e;r++){const n=UT(t,e[r]);if(n>0)return-1;n===0&&(i|=1<<r)}return i}const Rk=wr(),Pbe=zp(),Eh=P(),BW=P(),Ibe=P(),$be=P(),Lbe=P();let XFt=class{constructor(e){this._objects=e}submit(e,i){this._objects.preSubmit(i),this._objects.visibleObjects.forAll(r=>r.renderable.material.submit(e,i,r))}queryShadowCasterDepthRange(e){return this._objects.visibleObjects.length?BFt(e,this._objects.visibleObjects):null}};function YFt(t){const e=_n().vec3f(M.POSITION);return t.normals&&e.vec2i16(M.NORMALCOMPRESSED,{glNormalized:!0}),t.textureCoordinates===ds.Default?e.vec2f(M.UV0):t.textureCoordinates===ds.Atlas&&(e.vec2f(M.UV0),e.vec4u16(M.UVREGION,{glNormalized:!0})),t.colors&&e.vec4u8(M.COLOR,{glNormalized:!0}),e.alignTo(4)}let ZFt=class{constructor(){this.externalColor=pi(),this.externalColorMixMode=Xs.Multiply,this.castShadows=!0,this.pickable=!0,this.elevationOffset=0}},JFt=class extends Fn{constructor(e,i){super(e,"int",br.Draw,(r,n,s)=>r.setUniform1i(e,i(n,s)))}};var ny;(function(t){t[t.Uniform=0]="Uniform",t[t.Varying=1]="Varying",t[t.COUNT=2]="COUNT"})(ny||(ny={}));const Vce=429496.7296;function a8e(t,e){ID(t/Vce*.5+.5,e)}function KFt(t,e){switch(e.componentData){case ny.Varying:return QFt(t,e);case ny.Uniform:return e4t(t);case ny.COUNT:return;default:e.componentData}}function QFt(t,e){const{vertex:i,fragment:r}=t;i.include(nh),i.uniforms.add(Gb("componentColorTex",s=>s.componentParameters.texture.texture,e.hasWebGL2Context?lr.None:lr.Size)),t.attributes.add(M.COMPONENTINDEX,"float"),t.varyings.add("vExternalColorMixMode","mediump float"),t.varyings.add("vExternalColor","vec4");const n=e.output===z.ObjectAndLayerIdColor;n&&t.varyings.add("vObjectAndLayerIdColor","vec4"),t.include(Nke),i.constants.add("elevationScale","float",2*Vce),i.constants.add("stride","float",ue("enable-feature:objectAndLayerId-rendering")?3:2),i.code.add(S`
  vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
    vec2 textureSize = ${Tp(e,"componentColorTex")};

    float index = componentIndex * stride + typeOffset;
    float coordX = mod(index, textureSize.x);
    float coordY = floor(index / textureSize.x);

    return vec2(coordX, coordY) + 0.5;
  }
  `),i.code.add(S`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return ${Zl(e,"componentColorTex","textureCoordinates","1.0 / componentColorTexSize")};
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = ${Zl(e,"componentColorTex","textureCoordinates","1.0 / componentColorTexSize")};
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${n?S`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = ${Zl(e,"componentColorTex","textureCoordinates","1.0 / componentColorTexSize")};
          }`:S`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),r.code.add(S`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${n?S`gl_FragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function e4t(t){const{vertex:e,fragment:i}=t;e.uniforms.add(new Qz("externalColor",r=>r.componentParameters.externalColor)),i.uniforms.add(new JFt("externalColorMixMode",r=>r.componentParameters.externalColorMixMode)),t.varyings.add("vExternalColor","vec4"),e.code.add(S`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`),i.code.add(S`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}
void outputObjectAndLayerIdColor() {
gl_FragColor = vec4(1.0,0.0,0.0,0.0);
}`)}var pp;function t4t(t,e){const i=t.vertex;switch(i.code.add(S`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),e.vertexDiscardMode){case pp.None:i.code.add(S`#define vertexDiscardByOpacity(_opacity_) {}`);break;case pp.Opaque:i.code.add(S`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case pp.Transparent:i.code.add(S`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}}(function(t){t[t.None=0]="None",t[t.Transparent=1]="Transparent",t[t.Opaque=2]="Opaque",t[t.COUNT=3]="COUNT"})(pp||(pp={}));var sy;function iii(t){return t&&wy(t)?sy.Mars:t&&xy(t)?sy.Moon:sy.Earth}(function(t){t[t.Earth=1]="Earth",t[t.Mars=2]="Mars",t[t.Moon=3]="Moon",t[t.COUNT=4]="COUNT"})(sy||(sy={}));var Hh;(function(t){t[t.None=0]="None",t[t.NoOverlay=1]="NoOverlay",t[t.ColorOverlay=2]="ColorOverlay",t[t.ColorOverlayWithWater=3]="ColorOverlayWithWater",t[t.COUNT=4]="COUNT"})(Hh||(Hh={}));let Si=class extends wl{constructor(){super(...arguments),this.output=z.Color,this.textureCoordinateType=ds.None,this.componentData=ny.Uniform,this.cullFace=Dr.Back,this.vertexDiscardMode=pp.None,this.doubleSidedMode=Cn.WindingOrder,this.alphaDiscardMode=_r.Opaque,this.integratedMeshMode=Hh.None,this.transparencyPassType=At.NONE,this.ellipsoidMode=sy.Earth,this.pbrMode=_t.Disabled,this.normalType=hr.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasBaseColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.useLegacyTerrainShading=!1,this.hasCloudsReflections=!0,this.snowCover=!1,this.objectAndLayerIdColor=!1,this.hasWebGL2Context=!1}};u([j({count:z.COUNT})],Si.prototype,"output",void 0),u([j({count:ds.COUNT})],Si.prototype,"textureCoordinateType",void 0),u([j({count:ny.COUNT})],Si.prototype,"componentData",void 0),u([j({count:Dr.COUNT})],Si.prototype,"cullFace",void 0),u([j({count:pp.COUNT})],Si.prototype,"vertexDiscardMode",void 0),u([j({count:Cn.COUNT})],Si.prototype,"doubleSidedMode",void 0),u([j({count:_r.COUNT})],Si.prototype,"alphaDiscardMode",void 0),u([j({count:Hh.COUNT})],Si.prototype,"integratedMeshMode",void 0),u([j({count:At.COUNT})],Si.prototype,"transparencyPassType",void 0),u([j({count:sy.COUNT})],Si.prototype,"ellipsoidMode",void 0),u([j({count:_t.COUNT})],Si.prototype,"pbrMode",void 0),u([j({count:hr.COUNT})],Si.prototype,"normalType",void 0),u([j()],Si.prototype,"spherical",void 0),u([j()],Si.prototype,"doublePrecisionRequiresObfuscation",void 0),u([j()],Si.prototype,"hasVertexColors",void 0),u([j()],Si.prototype,"hasNormals",void 0),u([j()],Si.prototype,"hasSlicePlane",void 0),u([j()],Si.prototype,"hasBaseColorTexture",void 0),u([j()],Si.prototype,"receiveAmbientOcclusion",void 0),u([j()],Si.prototype,"receiveShadows",void 0),u([j()],Si.prototype,"blendingEnabled",void 0),u([j()],Si.prototype,"hasScreenSpaceReflections",void 0),u([j()],Si.prototype,"hasPolygonOffset",void 0),u([j()],Si.prototype,"hasMetallicRoughnessTexture",void 0),u([j()],Si.prototype,"hasEmissionTexture",void 0),u([j()],Si.prototype,"hasOcclusionTexture",void 0),u([j()],Si.prototype,"hasNormalTexture",void 0),u([j()],Si.prototype,"hasOccludees",void 0),u([j()],Si.prototype,"hasMultipassTerrain",void 0),u([j()],Si.prototype,"cullAboveGround",void 0),u([j()],Si.prototype,"useLegacyTerrainShading",void 0),u([j()],Si.prototype,"hasCloudsReflections",void 0),u([j()],Si.prototype,"snowCover",void 0),u([j()],Si.prototype,"objectAndLayerIdColor",void 0),u([j()],Si.prototype,"hasWebGL2Context",void 0),u([j({constValue:br.Draw})],Si.prototype,"pbrTextureBindType",void 0),u([j({constValue:!0})],Si.prototype,"hasSliceHighlight",void 0),u([j({constValue:!1})],Si.prototype,"hasSliceInVertexProgram",void 0),u([j({constValue:!1})],Si.prototype,"useCustomDTRExponentForWater",void 0),u([j({constValue:!1})],Si.prototype,"hasVertexTangents",void 0),u([j({constValue:!0})],Si.prototype,"supportsTextureAtlas",void 0),u([j({constValue:!1})],Si.prototype,"highStepCount",void 0),u([j({constValue:!1})],Si.prototype,"instancedDoublePrecision",void 0),u([j({constValue:!0})],Si.prototype,"useFillLights",void 0),u([j({constValue:!1})],Si.prototype,"objectAndLayerIdColorInstanced",void 0);function Dbe(t,e){t.include(eE,e),t.fragment.include(BD);const i=t.fragment;i.uniforms.add(new Qz("baseColor",r=>r.baseColor)),i.uniforms.add(new GS("objectOpacity",r=>r.objectOpacity)),e.hasVertexColors?i.code.add(S`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):i.code.add(S`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),i.code.add(S`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function Nbe(t,e){const i=t.fragment;switch(e.doubleSidedMode){case Cn.None:i.code.add(S`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case Cn.View:t.include(zR,e),i.code.add(S`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case Cn.WindingOrder:i.code.add(S`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:e.doubleSidedMode;case Cn.COUNT:}switch(e.normalType){case hr.Attribute:case hr.CompressedAttribute:t.include(I7,e),i.code.add(S`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case hr.ScreenDerivative:t.extensions.add("GL_OES_standard_derivatives"),t.include(zR,e),i.code.add(S`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case hr.Ground:e.spherical?(t.include(zR,e),i.code.add(S`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):i.code.add(S`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),t.extensions.add("GL_OES_standard_derivatives"),i.code.add(S`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:e.normalType;case hr.COUNT:}}function i4t(t,e){const i=t.fragment;if(e.hasBaseColorTexture&&(e.output===z.Color||e.alphaDiscardMode!==_r.Opaque)){t.include(kae,e);const r=e.textureCoordinateType===ds.Atlas;i.uniforms.add(Gb("baseColorTexture",n=>n.texture,r?e.hasWebGL2Context?lr.None:lr.Size:lr.None)),r?(t.include(DDe),i.code.add(S`
        vec4 readBaseColorTexture() {
          vec2 textureSize = ${Tp(e,"baseColorTexture")};
          return textureAtlasLookup(baseColorTexture, textureSize, vuv0, vuvRegion);
        }
      `)):i.code.add(S`vec4 readBaseColorTexture() {
return texture2D(baseColorTexture, vuv0);
}`)}else i.code.add(S`vec4 readBaseColorTexture() { return vec4(1.0); }`)}function r4t(t){const e=new ji;e.include(zR,t),e.include(I7,t),e.include(eE,t),e.include(iy,t),e.include(UO,t),e.include(KFt,t),e.include(RRt,t),e.include(b2t,t),e.include(i4t,t),e.include(t4t,t);const{vertex:i,fragment:r}=e;t.pbrMode!==_t.Normal&&t.pbrMode!==_t.Schematic||(e.include(Vae,t),t.hasNormalTexture&&e.include(Vke,t));const n=t.output===z.Shadow||t.output===z.ShadowHighlight||t.output===z.ShadowExcludeHighlight;n&&t.componentData===ny.Varying?i.code.add(S`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):i.code.add(S`#define discardShadows(castShadows) {}`);const s=t.integratedMeshMode===Hh.ColorOverlay||t.integratedMeshMode===Hh.ColorOverlayWithWater,o=s&&t.output===z.Color&&t.pbrMode===_t.WaterOnIntegratedMesh;return s&&(e.include(P2,t),e.include(JDt,t),t.spherical?i.code.add(S`
      const float invEllipsoidRadius = ${S.float(1/(t.ellipsoidMode===sy.Earth?Ci.radius:t.ellipsoidMode===sy.Mars?Yg.radius:C_.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):i.code.add(S`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),o&&(e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),e.varyings.add("groundNormal","vec3")),i.code.add(S`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      ${t.output===z.ObjectAndLayerIdColor?S`externalColor.a = 1.0;`:""}

      if (externalColor.a < ${S.float(za)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${t.output===z.ObjectAndLayerIdColor?S`forwardObjectAndLayerIdColor();`:""}
      ${o?t.spherical?S`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:S`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${s?S`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),t.output===z.Alpha&&(r.include(ud),e.include(hd,t),e.include(Dbe,t),s&&r.uniforms.add(new Dt("ovColorTex",(a,l)=>aie(a,l))),r.code.add(S`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.hasMultipassTerrain?S`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${s?S`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        gl_FragColor = vec4(materialColor.a);
      }
    `)),t.output===z.Color&&(r.include(ud),e.include(hd,t),e.include(Dbe,t),e.include(Nbe,t),e.include(P2,t),t.receiveShadows?(e.include($7,t),r.code.add(S`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):r.code.add(S`float evaluateShadow() { return 0.0; }`),s&&r.uniforms.add(new Dt("ovColorTex",(a,l)=>aie(a,l))),r.code.add(S`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.hasMultipassTerrain?S`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${s?S`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),t.pbrMode===_t.Normal||t.pbrMode===_t.Schematic?(Ey(r),r.code.add(S`
        ${t.pbrMode===_t.Normal?S`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),t.hasNormalTexture?r.code.add(S`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):r.code.add(S`vec3 shadingNormal = normalVertex;`),r.code.add(S`${t.spherical?S`vec3 normalGround = normalize(positionWorld());`:S`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),r.code.add(S`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());

        ${t.snowCover?S`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${s?S` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(t.receiveShadows?r.code.add(S`float shadow = evaluateShadow();`):t.spherical?(ZO(r),r.code.add(S`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):r.code.add(S`float shadow = 0.0;`),o&&r.uniforms.add(new Dt("ovNormalTex",(a,l)=>zce(l))),t.snowCover&&(e.extensions.add("GL_OES_standard_derivatives"),r.code.add(S`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`)),r.code.add(S`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${s?S` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${o?S`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),r.code.add(S`
        gl_FragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${t.transparencyPassType===At.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),(t.output===z.Depth||n)&&(e.include(N_,t),r.code.add(S`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),t.output===z.Normal&&(e.include(Nbe,t),r.code.add(S`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${t.normalType===hr.Ground?"0.0":"1.0"};
        gl_FragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),t.output===z.ObjectAndLayerIdColor&&e.fragment.code.add(S`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${s?S`gl_FragColor = getOverlayColorTexel(vtcOverlay);`:"outputObjectAndLayerIdColor();"}
      }
    `),t.output===z.Highlight&&(e.include(Q_,t),r.code.add(S`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${s?S`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  gl_FragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),e}function zce(t){return t.overlays.length===0?null:t.overlays[mn.INNER].getValidTexture(Pn.Water)}const n4t=Object.freeze(Object.defineProperty({__proto__:null,build:r4t,getOverlayNormalTexture:zce},Symbol.toStringTag,{value:"Module"}));let l8e=class c8e extends Yi{initializeConfiguration(e,i){i.hasWebGL2Context=e.rctx.type===Et.WEBGL2,i.spherical=e.viewingMode===qe.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Hi(e.rctx,c8e.shader.get().build(this.configuration),u8e)}_setPipelineState(e){const i=this.configuration,r=i.integratedMeshMode!==Hh.None,n=e===At.NONE,s=e===At.FrontFace;return Ht({blending:i.output!==z.Color&&i.output!==z.Alpha||!i.blendingEnabled?null:n?nd:ev(e),culling:KB(i.cullFace),depthTest:{func:jw(e)},depthWrite:n||s?Kc:null,colorWrite:si,stencilWrite:r||i.hasOccludees?by:null,stencilTest:r?dAt(Wc.IntegratedMeshMaskExcluded):i.hasOccludees?Gw:null,polygonOffset:n||s?i.hasPolygonOffset?{factor:2,units:2}:null:C7})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};l8e.shader=new Gi(n4t,()=>Q(()=>import("./ComponentShader.glsl-640fd3ff.js"),[]));const u8e=new Map([[M.POSITION,0],[M.NORMAL,1],[M.NORMALCOMPRESSED,1],[M.COLOR,2],[M.UV0,3],[M.UVREGION,4],[M.COMPONENTINDEX,5]]);let s4t=class extends Tr{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const e of this._parameterBlocks)this[e]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const e of this._parameterBlocks)if(this[e].dirty)return!0;return!1}},Bce=class{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}};function Mn(t={}){return(e,i)=>{const r=e._parameterCount??0;if(e._parameterCount=r+1,t.vectorOps){const n=t.vectorOps;Object.defineProperty(e,i,{get(){return this[r]},set(s){const o=this[r];if(o==null)this[r]=s;else{if(n.equals(o,s))return;n.copy(o,s)}this._setDirty()}})}else Object.defineProperty(e,i,{get(){return this[r]},set(n){this[r]!==n&&(t.dispose&&this[r]&&this[r].dispose(),this[r]=n,this._setDirty())}})}}function Fbe(){return(t,e)=>{const i=t._parameterCount??0;t._parameterCount=i+1,t._parameterBlocks=t._parameterBlocks||[],t._parameterBlocks.push(i),Object.defineProperty(t,e,{get(){return this[i]},set(r){this[i]!==r&&(this[i]=r,this._setDirty())}})}}let Y7=class{constructor(e){this._low=rn(),this._high=rn(),e&&this.set(e)}get low(){return this._low}get high(){return this._high}set(e){const i=this._low,r=this._high;ce(i,e),Fo(r,e,i)}setElements(e,i,r){he(kbe,e,i,r),this.set(kbe)}get(e){return me(e,this._low,this._high)}getLowScaled(e){return le(e,this._low,1)}};const kbe=P();let Ro=class extends s4t{constructor(e,i){super(),this.toMapSpace=i,this.baseColor=Tm(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=rr(1,1,.5),this.emissiveFactor=rr(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new t8,this.componentParameters=new pL,this.textureAlphaCutoff=Lz,this.alphaDiscardMode=_r.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=sy.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new Si;const r=new Y7(e.position),n=c$e(e.rotationScale);Uw(n,n),this.transformNormalGlobalFromModel=Qu(n,n),this.transformWorldFromModelTL=r.low,this.transformWorldFromModelTH=r.high,this.transformWorldFromModelRS=e.rotationScale}dispose(){this._technique=nn(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return v(this.baseColorTexture)?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return v(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return v(this.emissionTexture)?this.emissionTexture.glTexture:null}get textureOcclusion(){return v(this.occlusionTexture)?this.occlusionTexture.glTexture:null}get textureNormal(){return v(this.normalTexture)?this.normalTexture.glTexture:null}prepareTechnique(e,i,r,n){const s=this._techniqueConfiguration;s.hasVertexColors=n.colors,s.hasNormals=n.normals,s.textureCoordinateType=n.textureCoordinates,s.hasMetallicRoughnessTexture=v(this.metallicRoughnessTexture),s.hasEmissionTexture=v(this.emissionTexture),s.hasOcclusionTexture=v(this.occlusionTexture),s.hasNormalTexture=v(this.normalTexture),s.transparencyPassType=i.identifier===ku.Material&&r.transparencyPassType!=null?r.transparencyPassType:At.NONE,s.hasMultipassTerrain=i.identifier===ku.Material&&r.multipassTerrain!=null&&r.multipassTerrain.enabled,s.cullAboveGround=i.identifier===ku.Material&&r.multipassTerrain!=null&&r.multipassTerrain.cullAboveGround,s.ellipsoidMode=this.ellipsoidMode,s.componentData=this.componentParameters.type,s.cullFace=this.commonMaterialParameters.cullFace,s.doubleSidedMode=this.commonMaterialParameters.doubleSided?Cn.View:Cn.None,s.hasBaseColorTexture=v(this.baseColorTexture);const o=this._computeWhichMaterialPass();s.blendingEnabled=o===Vl.Transparent||o===Vl.OpaqueAndTransparent,s.alphaDiscardMode=this.alphaDiscardMode,s.integratedMeshMode=this.isIntegratedMesh?a4t(r)?zce(r)?Hh.ColorOverlayWithWater:Hh.ColorOverlay:Hh.NoOverlay:Hh.None,s.useLegacyTerrainShading=this.isIntegratedMesh&&tr.TERRAIN_USE_LEGACY_SHADING,s.hasPolygonOffset=this.polygonOffsetEnabled;const a=this.hasParametersFromSource&&R(this.baseColorTexture);if(s.pbrMode=s.integratedMeshMode===Hh.ColorOverlayWithWater?_t.WaterOnIntegratedMesh:this.usePBR?a?_t.Schematic:_t.Normal:_t.Disabled,s.normalType=s.integratedMeshMode===Hh.None?s.hasNormals?hr.CompressedAttribute:hr.ScreenDerivative:hr.Ground,s.hasSlicePlane=v(r.slicePlane)&&this.commonMaterialParameters.hasSlicePlane,i.identifier===ku.ShadowMap)s.output=z.Shadow,s.vertexDiscardMode=pp.None;else if(i.identifier===ku.Highlight)s.output=z.Highlight,s.vertexDiscardMode=pp.None;else{switch(this._computeWhichMaterialPass()===Vl.OpaqueAndTransparent?s.vertexDiscardMode=i.transparent?pp.Opaque:pp.Transparent:s.vertexDiscardMode=pp.None,s.output=i.output,s.receiveAmbientOcclusion=!1,s.receiveShadows=!1,i.output){case z.Color:s.receiveAmbientOcclusion=r.ssaoHelper.active,s.hasOccludees=r.hasOccludees,s.receiveShadows=r.shadowMap.ready,s.hasScreenSpaceReflections=r.ssr.enabled,s.hasCloudsReflections=v(r.cloudsFade.data);break;case z.Alpha:s.hasOccludees=r.hasOccludees;break;case z.ObjectAndLayerIdColor:s.objectAndLayerIdColor=!0}s.snowCover=this.hasSnowCover(r)}return this._technique=e.releaseAndAcquire(l8e,s,this._technique),this._setClean(),this._technique}hasSnowCover(e){return v(e.weather)&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}submit(e,i,r){if(this.objectOpacity===0)return;const n=r.renderable.geometry,s=r.components,o=r.renderable.meta.cameraDepthSquared,a=s.geometryRanges,l=s.highlightRanges,c=s.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case Vl.Opaque:e.materialOpaque.submitDraw(this,n,a,o);break;case Vl.Transparent:e.materialTransparent.submitDraw(this,n,a,o);break;case Vl.OpaqueAndTransparent:e.materialOpaque.submitDraw(this,n,a,o),e.materialTransparent.submitDraw(this,n,a,o);break;case Vl.IntegratedMesh:e.materialIntegratedMesh.submitDraw(this,n,a,o),o4t(i)&&e.highlightIntegratedMesh.submitDraw(this,n,a,o)}const h=this.componentParameters.castShadows!==ho.None;h&&e.shadowMap.submitDraw(this,n,a,o),v(l)&&(e.highlight.submitDraw(this,n,l,o),h&&e.highlightShadowMap.submitDraw(this,n,l,o)),h&&v(c)&&e.defaultShadowMap.submitDraw(this,n,c,o)}_computeWhichMaterialPass(){return this.isIntegratedMesh?Vl.IntegratedMesh:this.objectOpacity<1?Vl.Transparent:this.componentParameters.opaqueOverride===ho.All?Vl.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===_r.Blend||this.alphaDiscardMode===_r.MaskBlend?Vl.Transparent:this.componentParameters.transparent===ho.None?Vl.Opaque:this.componentParameters.transparent===ho.All?Vl.Transparent:Vl.OpaqueAndTransparent}};var Vl,ho;u([Mn({vectorOps:uCe})],Ro.prototype,"baseColor",void 0),u([Mn()],Ro.prototype,"usePBR",void 0),u([Mn()],Ro.prototype,"hasParametersFromSource",void 0),u([Mn({vectorOps:ede})],Ro.prototype,"mrrFactors",void 0),u([Mn({vectorOps:ede})],Ro.prototype,"emissiveFactor",void 0),u([Mn({dispose:!0})],Ro.prototype,"baseColorTexture",void 0),u([Mn({dispose:!0})],Ro.prototype,"metallicRoughnessTexture",void 0),u([Mn({dispose:!0})],Ro.prototype,"emissionTexture",void 0),u([Mn({dispose:!0})],Ro.prototype,"occlusionTexture",void 0),u([Mn({dispose:!0})],Ro.prototype,"normalTexture",void 0),u([Mn()],Ro.prototype,"objectOpacity",void 0),u([Fbe()],Ro.prototype,"commonMaterialParameters",void 0),u([Fbe()],Ro.prototype,"componentParameters",void 0),u([Mn()],Ro.prototype,"textureAlphaCutoff",void 0),u([Mn()],Ro.prototype,"alphaDiscardMode",void 0),u([Mn()],Ro.prototype,"isIntegratedMesh",void 0),u([Mn()],Ro.prototype,"polygonOffsetEnabled",void 0),u([Mn()],Ro.prototype,"ellipsoidMode",void 0),u([Mn()],Ro.prototype,"hasOccludees",void 0),function(t){t[t.Opaque=0]="Opaque",t[t.Transparent=1]="Transparent",t[t.OpaqueAndTransparent=2]="OpaqueAndTransparent",t[t.IntegratedMesh=3]="IntegratedMesh"}(Vl||(Vl={}));let t8=class extends Bce{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=Dr.Back,this.hasSlicePlane=!0}};u([Mn()],t8.prototype,"doubleSided",void 0),u([Mn()],t8.prototype,"cullFace",void 0),u([Mn()],t8.prototype,"hasSlicePlane",void 0);let pL=class extends Bce{constructor(){super(...arguments),this.externalColor=Zt(1,1,1,1),this.externalColorMixMode=Xs.Multiply,this.castShadows=ho.All}get transparent(){return this.externalColor[3]<1?ho.All:ho.None}get opaqueOverride(){return this.externalColorMixMode===Xs.Replace&&this.externalColor[3]===1?ho.All:ho.None}get visible(){return this.externalColor[3]>0?ho.All:ho.None}get type(){return ny.Uniform}};u([Mn({vectorOps:uCe})],pL.prototype,"externalColor",void 0),u([Mn()],pL.prototype,"externalColorMixMode",void 0),u([Mn()],pL.prototype,"castShadows",void 0),function(t){t[t.All=0]="All",t[t.Some=1]="Some",t[t.None=2]="None"}(ho||(ho={}));let e$=class extends Bce{constructor(){super(...arguments),this.texture=null,this.transparent=ho.None,this.opaqueOverride=ho.None,this.castShadows=ho.None}get type(){return ny.Varying}};function o4t(t){return t.overlays.length!==0&&v(t.overlays[mn.INNER].getValidTexture(Pn.Highlight))}function a4t(t){return t.overlays.length!==0&&v(t.overlays[mn.INNER].getColorTextureNoRasterImage())}u([Mn()],e$.prototype,"texture",void 0),u([Mn()],e$.prototype,"transparent",void 0),u([Mn()],e$.prototype,"opaqueOverride",void 0),u([Mn()],e$.prototype,"castShadows",void 0);const i9=_n().vec3f(M.POSITION).u16(M.COMPONENTINDEX).u16(M.U16PADDING),h8e=_n().vec2u8(M.SIDENESS),l4t=sh(h8e),d8e=_n().vec3f(M.POSITION0).vec3f(M.POSITION1).u16(M.COMPONENTINDEX).u8(M.VARIANTOFFSET,{glNormalized:!0}).u8(M.VARIANTSTROKE).u8(M.VARIANTEXTENSION,{glNormalized:!0}).u8(M.U8PADDING,{glPadding:!0}).u16(M.U16PADDING,{glPadding:!0}),pie=d8e.clone().vec3f(M.NORMAL),fie=d8e.clone().vec3f(M.NORMALA).vec3f(M.NORMALB),p8e=new Map([[M.POSITION0,0],[M.POSITION1,1],[M.COMPONENTINDEX,2],[M.VARIANTOFFSET,3],[M.VARIANTSTROKE,4],[M.VARIANTEXTENSION,5],[M.NORMAL,6],[M.NORMALA,6],[M.NORMALB,7],[M.SIDENESS,8]]);function Ube(t,e,i){const r=e/3,n=new Uint32Array(i+1),s=new Uint32Array(i+1),o=(w,x)=>{w<x?n[w+1]++:s[x+1]++};for(let w=0;w<r;w++){const x=t[3*w],T=t[3*w+1],E=t[3*w+2];o(x,T),o(T,E),o(E,x)}let a=0,l=0;for(let w=0;w<i;w++){const x=n[w+1],T=s[w+1];n[w+1]=a,s[w+1]=l,a+=x,l+=T}const c=new Uint32Array(6*r),h=n[i],p=(w,x,T)=>{if(w<x){const E=n[w+1]++;c[2*E]=x,c[2*E+1]=T}else{const E=s[x+1]++;c[2*h+2*E]=w,c[2*h+2*E+1]=T}};for(let w=0;w<r;w++){const x=t[3*w],T=t[3*w+1],E=t[3*w+2];p(x,T,w),p(T,E,w),p(E,x,w)}const f=(w,x)=>{const T=2*w,E=x-w;for(let C=1;C<E;C++){const A=c[T+2*C],I=c[T+2*C+1];let O=C-1;for(;O>=0&&c[T+2*O]>A;O--)c[T+2*O+2]=c[T+2*O],c[T+2*O+3]=c[T+2*O+1];c[T+2*O+2]=A,c[T+2*O+3]=I}};for(let w=0;w<i;w++)f(n[w],n[w+1]),f(h+s[w],h+s[w+1]);const m=new Int32Array(3*r),g=(w,x)=>w===t[3*x]?0:w===t[3*x+1]?1:w===t[3*x+2]?2:-1,_=(w,x)=>{const T=g(w,x);m[3*x+T]=-1},b=(w,x,T,E)=>{const C=g(w,x);m[3*x+C]=E;const A=g(T,E);m[3*E+A]=x};for(let w=0;w<i;w++){let x=n[w];const T=n[w+1];let E=s[w];const C=s[w+1];for(;x<T&&E<C;){const A=c[2*x],I=c[2*h+2*E];A===I?(b(w,c[2*x+1],I,c[2*h+2*E+1]),x++,E++):A<I?(_(w,c[2*x+1]),x++):(_(I,c[2*h+2*E+1]),E++)}for(;x<T;)_(w,c[2*x+1]),x++;for(;E<C;)_(c[2*h+2*E],c[2*h+2*E+1]),E++}return m}let f8e=class{updateSettings(e){this.settings=e,this._edgeHashFunction=e.reducedPrecision?u4t:c4t}write(e,i,r){const n=this._edgeHashFunction(r);Ok.seed=n;const s=Ok.getIntRange(0,255),o=Ok.getIntRange(0,this.settings.variants-1),a=.7,l=Ok.getFloat(),c=255*(.5*h4t(-(1-Math.min(l/a,1))+Math.max(0,l-a)/(1-a),1.2)+.5);e.position0.setVec(i,r.position0),e.position1.setVec(i,r.position1),e.componentIndex.set(i,r.componentIndex),e.variantOffset.set(i,s),e.variantStroke.set(i,o),e.variantExtension.set(i,c)}trim(e,i){return e.slice(0,i)}};const jce=new Float32Array(6),r9=new Uint32Array(jce.buffer),Ab=new Uint32Array(1);function c4t(t){const e=jce;e[0]=t.position0[0],e[1]=t.position0[1],e[2]=t.position0[2],e[3]=t.position1[0],e[4]=t.position1[1],e[5]=t.position1[2],Ab[0]=5381;for(let i=0;i<r9.length;i++)Ab[0]=31*Ab[0]+r9[i];return Ab[0]}function u4t(t){const e=jce;e[0]=gC(t.position0[0]),e[1]=gC(t.position0[1]),e[2]=gC(t.position0[2]),e[3]=gC(t.position1[0]),e[4]=gC(t.position1[1]),e[5]=gC(t.position1[2]),Ab[0]=5381;for(let i=0;i<r9.length;i++)Ab[0]=31*Ab[0]+r9[i];return Ab[0]}const Vbe=1e4;function gC(t){return Math.round(t*Vbe)/Vbe}function h4t(t,e){const i=t<0?-1:1;return Math.abs(t)**e*i}let n9=class{constructor(){this._commonWriter=new f8e}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return pie.createBuffer(e)}write(e,i,r){this._commonWriter.write(e,i,r),me(Mk,r.faceNormal0,r.faceNormal1),we(Mk,Mk),e.normal.setVec(i,Mk)}trim(e,i){return this._commonWriter.trim(e,i)}};n9.Layout=pie,n9.glLayout=sh(pie,1);let s9=class{constructor(){this._commonWriter=new f8e}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return fie.createBuffer(e)}write(e,i,r){this._commonWriter.write(e,i,r),e.normalA.setVec(i,r.faceNormal0),e.normalB.setVec(i,r.faceNormal1)}trim(e,i){return this._commonWriter.trim(e,i)}};s9.Layout=fie,s9.glLayout=sh(fie,1);const Mk=P(),Ok=new _$,VT=-1;var o9;function d4t(t,e,i,r=_4t){const n=t.vertices.position,s=t.vertices.componentIndex,o=Xt(r.anglePlanar),a=Xt(r.angleSignificantEdge),l=Math.cos(a),c=Math.cos(o),h=mie.edge,p=h.position0,f=h.position1,m=h.faceNormal0,g=h.faceNormal1,_=y4t(t),b=g4t(t),w=b.length/4,x=e.allocate(w);let T=0;const E=w,C=i.allocate(E);let A=0,I=0,O=0;const D=i7e(0,w),U=new Float32Array(w);U.forEach((J,q,N)=>{n.getVec(b[4*q+0],p),n.getVec(b[4*q+1],f),N[q]=Lr(p,f)}),D.sort((J,q)=>U[q]-U[J]);const V=new Array,B=new Array;for(let J=0;J<w;J++){const q=D[J],N=U[q],L=b[4*q+0],F=b[4*q+1],G=b[4*q+2],W=b[4*q+3],Z=W===VT;if(n.getVec(L,p),n.getVec(F,f),Z)he(m,_[3*G+0],_[3*G+1],_[3*G+2]),ce(g,m),h.componentIndex=s.get(L),h.cosAngle=be(m,g);else{if(he(m,_[3*G+0],_[3*G+1],_[3*G+2]),he(g,_[3*W+0],_[3*W+1],_[3*W+2]),h.componentIndex=s.get(L),h.cosAngle=be(m,g),f4t(h,c))continue;h.cosAngle<-.9999&&ce(g,m)}I+=N,O++,Z||p4t(h,l)?(e.write(x,T++,h),V.push(N)):m4t(h,o)&&(i.write(C,A++,h),B.push(N))}const ee=new Float32Array(V.reverse()),ie=new Float32Array(B.reverse());return{regular:{instancesData:e.trim(x,T),lodInfo:{lengths:ee}},silhouette:{instancesData:i.trim(C,A),lodInfo:{lengths:ie}},averageEdgeLength:I/O}}function p4t(t,e){return t.cosAngle<e}function f4t(t,e){return t.cosAngle>e}function m4t(t,e){const i=eo(t.cosAngle),r=mie.fwd,n=mie.ortho;return V_(r,t.position1,t.position0),i*(be(vt(n,t.faceNormal0,t.faceNormal1),r)>0?-1:1)>e}function g4t(t){const e=t.faces.length/3,i=t.faces,r=t.neighbors;let n=0;for(let a=0;a<e;a++){const l=r[3*a+0],c=r[3*a+1],h=r[3*a+2],p=i[3*a+0],f=i[3*a+1],m=i[3*a+2];n+=l===VT||p<f?1:0,n+=c===VT||f<m?1:0,n+=h===VT||m<p?1:0}const s=new Int32Array(4*n);let o=0;for(let a=0;a<e;a++){const l=r[3*a+0],c=r[3*a+1],h=r[3*a+2],p=i[3*a+0],f=i[3*a+1],m=i[3*a+2];(l===VT||p<f)&&(s[o++]=p,s[o++]=f,s[o++]=a,s[o++]=l),(c===VT||f<m)&&(s[o++]=f,s[o++]=m,s[o++]=a,s[o++]=c),(h===VT||m<p)&&(s[o++]=m,s[o++]=p,s[o++]=a,s[o++]=h)}return s}function y4t(t){const e=t.faces.length/3,i=t.vertices.position,r=t.faces,n=jW.v0,s=jW.v1,o=jW.v2,a=new Float32Array(3*e);for(let l=0;l<e;l++){const c=r[3*l+0],h=r[3*l+1],p=r[3*l+2];i.getVec(c,n),i.getVec(h,s),i.getVec(p,o),ge(s,s,n),ge(o,o,n),vt(n,s,o),we(n,n),a[3*l+0]=n[0],a[3*l+1]=n[1],a[3*l+2]=n[2]}return a}(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH"})(o9||(o9={}));const mie={edge:{position0:P(),position1:P(),faceNormal0:P(),faceNormal1:P(),componentIndex:0,cosAngle:0},ortho:P(),fwd:P()},jW={v0:P(),v1:P(),v2:P()},_4t={anglePlanar:4,angleSignificantEdge:35};function v4t(t){const e=b4t(t.data,t.skipDeduplicate,t.indices,t.indicesLength);return zbe.updateSettings(t.writerSettings),Bbe.updateSettings(t.writerSettings),d4t(e,zbe,Bbe)}function b4t(t,e,i,r){if(e){const o=Ube(i,r,t.count);return new w4t(i,r,o,t)}const n=Mte(t.buffer,t.stride/4,{originalIndices:i,originalIndicesLength:r}),s=Ube(n.indices,r,n.uniqueCount);return{faces:n.indices,facesLength:n.indices.length,neighbors:s,vertices:i9.createView(n.buffer)}}let w4t=class{constructor(e,i,r,n){this.faces=e,this.facesLength=i,this.neighbors=r,this.vertices=n}};const zbe=new n9,Bbe=new s9,mii=_n().vec3f(M.POSITION0).vec3f(M.POSITION1),x4t=_n().vec3f(M.POSITION0).vec3f(M.POSITION1).u16(M.COMPONENTINDEX).u16(M.U16PADDING,{glPadding:!0});let T4t=class{constructor(e){this._maxCount=e,this._nextIndex=0,this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){return this._recycledIndices.length>0?this._recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(e){this._recycledIndices.push(e)}},S4t=class{constructor(e,i=1){this._rctx=e,this._fieldCount=i,this.textureWidth=4096,this._dirty=!0,this._texture=new mt(this._rctx,{target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:nt.NEAREST,wrapMode:$t.CLAMP_TO_EDGE,width:this.textureWidth,height:1,flipped:!1}),this._data=new vl(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose(),this._texture=void 0,this._data=void 0}setData(e,i,r,n,s,o){const a=e*this._fieldCount+i;this._dirty=!0,this._data.set(a,0,r),this._data.set(a,1,n),this._data.set(a,2,s),this._data.set(a,3,o)}setDataElement(e,i,r,n){const s=e*this._fieldCount+i;this._dirty=!0,this._data.set(s,r,n)}resizeToFit(e){const i=e*this._fieldCount;if(i>=this._data.count){const r=Math.ceil((i+1)/this.textureWidth)*this.textureWidth,n=new vl(new ArrayBuffer(4*r));n.typedBuffer.set(this._data.typedBuffer),this._data=n}}updateTexture(){if(!this._dirty)return;const e=this._texture.descriptor.width,i=this._texture.descriptor.height;this._data.count>e*i&&this._texture.resize(e,this._data.count/e),this._texture.setData(this._data.typedBuffer),this._dirty=!1}get texture(){return this._texture}};const m8e=65536;let E4t=class{constructor(e,i=1){this.textureBuffer=new S4t(e,i),this._indexManager=new T4t(m8e)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const e=this._indexManager.acquire();return this.textureBuffer.resizeToFit(e),e}releaseIndex(e){this._indexManager.release(e)}},g8e=class{constructor(e,i=1){this._rctx=e,this._fieldCount=i,this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(e=>e.activeCount!==0||(e.dispose(),!1))}destroy(){this._buffers.forEach(e=>e.dispose()),this._buffers=[]}getBuffer(e){for(const r of this._buffers)if(r.availableCount>=e)return r;if(e>m8e)return null;const i=new E4t(this._rctx,this._fieldCount);return this._buffers.push(i),i}updateTextures(){for(const e of this._buffers)e.textureBuffer.updateTexture()}};const jbe=re.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");class C4t{constructor(e,i){this._renderManager=e,this._viewingMode=i,this._objects=[new Wt,new Wt],this._renderSubmit=new XFt(this),this._renderManager.register(this._renderSubmit),this._hasObjectAndLayerId=ue("enable-feature:objectAndLayerId-rendering"),this._componentBufferManager=new g8e(e.rctx,2+(this._hasObjectAndLayerId?1:0))}destroy(){wt(this._objects[iM.Hidden].length===0&&this._objects[iM.Visible].length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy()}createObject(e){const i=new QI;return i.toMapSpace=e.toMapSpace,i.transform=e.transform,i.obb=Mbe(e.obb),i.components=new RFt(this._componentBufferManager,e.geometry.componentOffsets),i.renderable=this._createRenderable(e,i.components),i.intersectionGeometry=new DFt(e.geometry.positionData,i.components),this._objects[i.visible].push(i),i}destroyObject(e){const i=e;this._objects[i.visible].removeUnordered(i),i.destroy(),this._notifyDirty()}setObjectVisibility(e,i){const r=e;i!==r.visible&&(this._objects[r.visible].removeUnordered(r),this._objects[i].push(r),r.visible=i,this._notifyDirty())}preSubmit(e){const i=e.camera.eye;this.visibleObjects.forAll(r=>r.renderable.meta.cameraDepthSquared=ba(i,r.obb.center))}getMaterial(e){return e.renderable.material}updateMaterial(e,i){const r=e.renderable.material;i(r),r.dirty&&this._notifyDirty()}setAllComponentVisibilities(e,i){const r=e;r.components.visibility.reset(i),r.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(e,i){return e.components.visibility.forEachComponent(i)}getComponentCount(e){const i=e,r=i.components.visibility.componentCount();return{visible:r,invisible:i.components.count-r}}setComponentData(e,i){const r=e,n=r.renderable.material,s=r.components,o=s.materialDataBuffer,a=s.materialDataIndices,l=new ZFt,c=o.textureBuffer,h=new Uint8Array(4),p=new Uint32Array(h.buffer);let f=0,m=0,g=0,_=s.verticalOffsets,b=1/0,w=-1/0,x=!1,T=!1,E=0;for(let C=0;C<s.count;C++){i(C,l),f+=+(l.externalColor[3]<1),m+=+(l.externalColorMixMode===Xs.Replace&&l.externalColor[3]===1),g+=+l.castShadows,Dke(l.externalColor,l.externalColorMixMode,h),h[2]=254&h[2]|+l.castShadows,c.setData(a[C],0,h[0],h[1],h[2],h[3]),x||(x=C>0&&E!==p[0]),E=p[0],T||(T=l.elevationOffset!==0),T&&R(_)&&(_=new Array(C).fill(0)),v(_)&&(_[C]=l.elevationOffset),b=Math.min(b,l.elevationOffset),w=Math.max(w,l.elevationOffset),a8e(l.elevationOffset,h),c.setData(a[C],1,h[0],h[1],h[2],h[3]);const A=l.objectAndLayerIdColor;v(A)&&c.setData(a[C],2,A[0],A[1],A[2],A[3]),l.pickable!==n8e(s.pickability,C)&&(s.pickability=OFt(s.pickability,s.count,C,l.pickable))}s.verticalOffsets=T?_:null,r.offsetObb=T?EFt(r.obb,b,w,this._viewingMode,v(r.offsetObb)?r.offsetObb:Mbe(r.obb)):null,x||T||this._hasObjectAndLayerId?(n.componentParameters=new e$,n.componentParameters.castShadows=GW(g,s.count),n.componentParameters.transparent=GW(f,s.count),n.componentParameters.opaqueOverride=GW(m,s.count),n.componentParameters.texture=c,c.updateTexture()):(n.componentParameters=new pL,n.componentParameters.castShadows=l.castShadows?ho.All:ho.None,n.componentParameters.externalColor=l.externalColor,n.componentParameters.externalColorMixMode=l.externalColorMixMode),this._notifyDirty()}getComponentAabb(e,i,r,n=!1){e.intersectionGeometry.getComponentAabb(i,r);const s=e,o=s.components.verticalOffsets;if(n||R(o))return r;const a=o[i];if(this._viewingMode===qe.Local||a===0)return r[2]+=a,r[5]+=a,r;const l=lwt(a);return l.localOrigin=s.transform.position,l.applyToAabb(r)}getComponentObb(e){return e.obb}getObjectTransform(e){return e.transform}getComponentPositions(e,i,r){return e.intersectionGeometry.getComponentPositions(i,r)}intersect(e,i,r,n,s,o){const a=e;v(s)&&(s.localOrigin=a.transform.position);const l=Uw(Gbe,a.transform.rotationScale);Fo(Pk,i,a.transform.position),Fo(Ik,r,a.transform.position),Wl(Pk,Pk,l),Wl(Ik,Ik,l);const c=Qu(Gbe,l);return a.intersectionGeometry.intersect(Pk,Ik,n,c,s,a.components.verticalOffsets,o)}addEdges(e,i,r,n){const s=e,{indices:o,positions:a}=s.intersectionGeometry,l=s.components.offsets;return i.addComponentObject(e,s.transform,{center:s.obb.center,radius:SFt(s.obb)},a,o,l,r,n)}async extractEdgeInformation(e,i,r){const n=e,s=n.components.visibility;if(s.allInvisible())return{buffer:x4t.createBuffer(0),origin:[0,0,0]};const{indices:o,positions:a}=n.intersectionGeometry,l=n.components.offsets,c=i9.createBuffer(a.count);V7(c.position,a),Ew(c.position,c.position,n.transform.rotationScale),this._setComponentIndices(c.componentIndex,o,l);const h=c.count,p=this._computeVisibilityIndices(o,s,l,h);return{origin:In(n.transform.position),buffer:await i.extractComponentsEdgeLocations({indices:p,indicesLength:p.length,skipDeduplicate:!0,data:c,writerSettings:{reducedPrecision:!1,variants:0}},r)}}_setComponentIndices(e,i,r){let n=0;for(let s=0;s<r.length-1;s++){const o=r[s],a=r[s+1];for(let l=o;l<a;l++){const c=i?i[l]:l;e.set(c,n)}n++}}_computeVisibilityIndices(e,i,r,n){if(e&&i.allVisible())return e;let s=0;i.forEachComponentRange((l,c)=>(s+=r[c]-r[l],!0));const o=Array.isArray(e)?new Array(s):(e==null?void 0:e.BYTES_PER_ELEMENT)===2||n<=65536?new Uint16Array(s):new Uint32Array(s);let a=0;return i.forEachComponentRange((l,c)=>{const h=r[l],p=r[c];for(let f=h;f<p;f++)o[a++]=e?e[f]:f;return!0}),o}addComponentHighlight(e,i){const r=e.components;R(r.highlightCounts)&&(r.highlightCounts=new Uint32Array(r.count+1)),r.highlightCounts[i]++===0&&(r.highlightsDirty(),this._notifyDirty()),r.highlightCounts[r.count]++}removeComponentHighlight(e,i){const r=e.components;if(R(r.highlightCounts))return void jbe.warn("Removing non-existing highlight.");const n=r.highlightCounts[i],s=r.highlightCounts[r.count];if(n!==0){if(n>1)return r.highlightCounts[i]=n-1,void(r.highlightCounts[r.count]=s-1);r.highlightCounts[i]=0,r.highlightsDirty(),this._notifyDirty(),s===1?r.highlightCounts=null:r.highlightCounts[r.count]=s-1}else jbe.warn("Removing non-existing highlight.")}clearHighlights(e){const i=e.components;v(i.highlightCounts)&&(i.highlightCounts=null,i.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(e){return e.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects[iM.Visible]}_createRenderable(e,i){const r=this._renderManager.rctx,n=e.geometry,s=n.vertices.layoutParameters,o=er.createVertex(r,zi.STATIC_DRAW,n.vertices.data),a=Vo(n.indices,_=>er.createIndex(r,zi.STATIC_DRAW,_)),l=sh(YFt(s)),c=new Uint16Array(n.vertices.count);for(let _=0;_<i.count;_++){const b=i.offsets[_],w=i.offsets[_+1],x=i.materialDataIndices[_];if(v(n.indices))for(let T=b;T<w;T++)c[n.indices[T]]=x;else for(let T=b;T<w;T++)c[T]=x}const h=er.createVertex(r,zi.STATIC_DRAW,c.buffer),p=new Ro(e.transform,e.toMapSpace),f=new Np(r,u8e,{data:l,componentIndices:A4t},{data:o,componentIndices:h},a),m=new UFt(f,Ft.TRIANGLES,s,v(a)),g={cameraDepthSquared:.5,gpuMemoryEstimate:o.byteSize+h.byteSize+(v(a)?a.byteSize:0)};return new kFt(p,m,g)}_notifyDirty(){this._renderManager.notifyDirty()}}const A4t=sh(_n().u16(M.COMPONENTINDEX));function GW(t,e){return t===e?ho.All:t===0?ho.None:ho.Some}const Gbe=qc(),Pk=P(),Ik=P();let y8e=class extends Tr{constructor(){super(...arguments),this.opacity=1}};function R4t(t){const e=new ji;return e.include(Bp),e.fragment.uniforms.add(new Dt("tex",i=>i.texture)),t.hasOpacityFactor&&e.fragment.uniforms.add(new Ie("opacity",i=>i.opacity)),e.fragment.code.add(S`
    void main() {
      gl_FragColor = texture2D(tex, uv) ${t.hasOpacityFactor?"* opacity":""};
    }`),e}const M4t=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:y8e,build:R4t},Symbol.toStringTag,{value:"Module"}));var ul;(function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.PremultipliedAlpha=2]="PremultipliedAlpha",t[t.COUNT=3]="COUNT"})(ul||(ul={}));let gie=class extends wl{constructor(){super(...arguments),this.alphaMode=ul.None,this.hasOpacityFactor=!1}};u([j({count:ul.COUNT})],gie.prototype,"alphaMode",void 0),u([j()],gie.prototype,"hasOpacityFactor",void 0);let _8e=class v8e extends Yi{initializeProgram(e){return new Hi(e.rctx,v8e.shader.get().build(this.configuration),Di)}initializePipeline(){switch(this.configuration.alphaMode){case ul.None:return Ht({colorWrite:si});case ul.Alpha:return Ht({blending:_o(Ce.SRC_ALPHA,Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA,Ce.ONE_MINUS_SRC_ALPHA),colorWrite:si});case ul.PremultipliedAlpha:case ul.COUNT:return Ht({blending:Am(Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA),colorWrite:si})}}};_8e.shader=new Gi(M4t,()=>Q(()=>import("./Compositing.glsl-ff49d264.js"),[]));let b8e=class extends Tr{};function O4t(){const t=new ji;return t.include(Bp),t.fragment.uniforms.add(new Dt("tex",e=>e.texture)),t.fragment.code.add(S`void main() {
gl_FragColor = vec4(1.0 - texture2D(tex, uv).a);
}`),t}const P4t=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:b8e,build:O4t},Symbol.toStringTag,{value:"Module"}));let w8e=class x8e extends Yi{initializeProgram(e){return new Hi(e.rctx,x8e.shader.get().build(),Di)}initializePipeline(){return Ht({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}};w8e.shader=new Gi(P4t,()=>Q(()=>import("./HUDCompositing.glsl-4d5eea90.js"),[]));let T8e=class extends Tr{};function I4t(){const t=new ji;return t.include(Bp),t.fragment.uniforms.add([new Dt("colorTexture",e=>e.colorTexture),new Dt("alphaTexture",e=>e.alphaTexture),new Dt("frontFaceTexture",e=>e.frontFaceTexture)]),t.fragment.code.add(S`void main() {
vec4 srcColor = texture2D(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture2D(alphaTexture, uv).r;
vec4 frontFace = texture2D(frontFaceTexture, uv);
gl_FragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`),t}const $4t=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:T8e,build:I4t},Symbol.toStringTag,{value:"Module"}));let S8e=class E8e extends Yi{initializeProgram(e){return new Hi(e.rctx,E8e.shader.get().build(),Di)}initializePipeline(){return Ht({blending:_o(Ce.SRC_ALPHA,Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA,Ce.ONE_MINUS_SRC_ALPHA),colorWrite:si})}};S8e.shader=new Gi($4t,()=>Q(()=>import("./OITCompositing.glsl-da04d065.js"),[]));let C8e=class extends Tr{constructor(){super(...arguments),this.overlayIndex=mn.INNER,this.opacity=1}};function L4t(){const t=new ji;return t.include(Bp),t.fragment.uniforms.add(new Dt("tex",e=>e.texture)),t.fragment.uniforms.add(new oF("overlayIdx",e=>e.overlayIndex)),t.fragment.uniforms.add(new Ie("opacity",e=>e.opacity)),t.fragment.code.add(S`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
gl_FragColor = texture2D(tex, overlayUV) * opacity;
}`),t}const D4t=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:C8e,build:L4t},Symbol.toStringTag,{value:"Module"}));let A8e=class R8e extends Yi{initializeProgram(e){return new Hi(e.rctx,R8e.shader.get().build(),Di)}initializePipeline(){return Ht({blending:Am(Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA),colorWrite:si})}};A8e.shader=new Gi(D4t,()=>Q(()=>import("./OverlayCompositing.glsl-282cdd73.js"),[]));let N4t=class{constructor(e,i){this._rctx=e,this._techniqueRepository=i,this._configuration=new gie,this._passParameters=new y8e,this._oitParameters=new T8e,this._hudParameters=new b8e,this._overlayParameters=new C8e}destroy(){this._vao=rt(this._vao)}compositeOIT(e,i,r,n){this._oitParameters.colorTexture=i,this._oitParameters.alphaTexture=r,this._oitParameters.frontFaceTexture=n;const s=this._rctx,o=this._techniqueRepository.acquire(S8e);s.bindTechnique(o,this._oitParameters,e);const a=this._ensureVAO();s.bindVAO(a),s.drawArrays(Ft.TRIANGLE_STRIP,0,Ua(a,"geometry")),o.release()}compositeHUD(e,i){this._hudParameters.texture=i;const r=this._rctx,n=this._techniqueRepository.acquire(w8e);r.bindTechnique(n,this._hudParameters,e);const s=this._ensureVAO();r.bindVAO(s),r.drawArrays(Ft.TRIANGLE_STRIP,0,Ua(s,"geometry")),n.release()}compositeOverlay(e,i,r,n){this._overlayParameters.texture=i,this._overlayParameters.opacity=r,this._overlayParameters.overlayIndex=n;const s=this._rctx,o=this._techniqueRepository.acquire(A8e);s.bindTechnique(o,this._overlayParameters,e);const a=this._ensureVAO();s.bindVAO(a),s.drawArrays(Ft.TRIANGLE_STRIP,0,Ua(a,"geometry")),o.release()}composite(e,i,r=ul.None,n=1){const s=this._rctx;this._configuration.alphaMode=r,this._configuration.hasOpacityFactor=n!==1,this._passParameters.texture=i,this._passParameters.opacity=n;const o=this._techniqueRepository.acquire(_8e,this._configuration);s.bindTechnique(o,this._passParameters,e);const a=this._ensureVAO();s.bindVAO(a),s.drawArrays(Ft.TRIANGLE_STRIP,0,Ua(a,"geometry")),o.release()}_ensureVAO(){return R(this._vao)&&(this._vao=xl(this._rctx)),this._vao}};const F4t=1e4,yie=100,k4t=500,U4t=500,V4t=.1;function z4t(t,e,i){return Vle(e,t)*(i[1]-i[0])+i[0]}function B4t(t,e,i){let r=0;if(!e.some(s=>(r+=s.numGeometries,r>=F4t)))return Z4t.compute(t,e);const n=cF();return i.forAll(s=>{s.visible&&aO(n,j4t(t,s))}),n}function j4t(t,e){if(!e.visible)return;const i=cF(),r=e.getSpatialQueryAccelerator();return v(r)?G4t(i,t,r):H4t(i,t,e.objects),i}function G4t(t,e,i){const r=e.eye,n=e.viewForward,s=e.frustum,o=l=>l.visible,a=i.objectCount;if(a<k4t)ZD(Zd,e.near,Math.min(t.near,e.far)),i.forEachInDepthRange(r,n,tm.DepthOrder.FRONT_TO_BACK,Zd,(l,c)=>{_ie(t,e,l),Zd.far=t.near,c.setRange(Zd)},s,o),ZD(Zd,Math.max(t.far,e.near),e.far),i.forEachInDepthRange(r,n,tm.DepthOrder.BACK_TO_FRONT,Zd,(l,c)=>{_ie(t,e,l),Zd.near=t.far,c.setRange(Zd)},s,o);else{const l=Math.max(Math.min(a,U4t),Math.ceil(a*V4t)),c=i.findClosest(n,tm.DepthOrder.FRONT_TO_BACK,s,o,l),h=i.findClosest(n,tm.DepthOrder.BACK_TO_FRONT,s,o,l);c&&h&&(Hbe(t,e,c.boundingVolumeWorldSpace.bounds),Hbe(t,e,h.boundingVolumeWorldSpace.bounds))}}function H4t(t,e,i){yC.clear(),i.forAll(r=>{r.visible&&r.geometries.length!==0&&yC.add(r)}),yC.empty||(yC.sort(e),ZD(Zd,e.near,Math.min(t.near,e.far)),yC.forEachInDepthRange(Zd,tm.DepthOrder.FRONT_TO_BACK,(r,n)=>{n<t.near&&_ie(t,e,r)}),ZD(Zd,Math.max(t.far,e.near),e.far),yC.forEachInDepthRange(Zd,tm.DepthOrder.BACK_TO_FRONT,(r,n,s)=>{t.far=Math.max(t.far,s)}))}function _ie(t,e,i){if(!i.visible||!Eb(e.frustum,i.boundingVolumeWorldSpace.bounds))return;const r=i.transformation,n=Y4t;i.geometries.forEach(s=>{$n(n,r,s.shaderTransformation);const o=v2(n);M8e(t,e,s.boundingInfo,n,o)})}function M8e(t,e,i,r,n){if(R(i))return;Ke($a,i.center,r);const{eye:s,viewForward:o}=e,a=o[0]*($a[0]-s[0])+o[1]*($a[1]-s[1])+o[2]*($a[2]-s[2]);if($a[3]=i.radius*n,!(a-$a[3]>t.near&&a+$a[3]<t.far)&&Eb(e.frustum,$a))if(i.radius>yie&&i.getChildren())for(const l of i.getChildren())M8e(t,e,l,r,n);else vie.unionDepthRangeWithAABB(t,e.viewProjectionMatrix,r,i.bbMin,i.bbMax)}function Hbe(t,e,i){const r=e.eye,n=e.viewForward,s=(i[0]-r[0])*n[0]+(i[1]-r[1])*n[1]+(i[2]-r[2])*n[2];t.near=Math.min(t.near,s-i[3]),t.far=Math.max(t.far,s+i[3])}class q4t{constructor(){this._items=new Wt({allocator:e=>e||{obj:null,distance:0,near:0,far:0},deallocator:e=>(e.obj=null,e.distance=0,e.near=0,e.far=0,e)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(e){this._items.pushNew().obj=e}sort(e){const i=e.eye,r=e.viewForward;this._items.forAll(n=>{const s=n.obj.boundingVolumeWorldSpace.bounds,o=(s[0]-i[0])*r[0]+(s[1]-i[1])*r[1]+(s[2]-i[2])*r[2];n.distance=o,n.near=o-s[3],n.far=o+s[3]}),this._items.sort((n,s)=>n.distance-s.distance)}forEachInDepthRange(e,i,r){if(i===tm.DepthOrder.FRONT_TO_BACK)for(let n=0;n<this._items.length;++n){const s=this._items.data[n];s.far<e.near||s.near>e.far||r(s.obj,s.near,s.far)}else for(let n=this._items.length-1;n>=0;--n){const s=this._items.data[n];s.far<e.near||s.near>e.far||r(s.obj,s.near,s.far)}}}let W4t=class{constructor(){this._view=$e(),this._viewProj=$e(),this._frustum=TD(),this._geometries=new Array,this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._looseRange={near:0,far:0}}compute(e,i){this._reset(),go(this._view,e.viewMatrix),$n(this._viewProj,e.projectionMatrix,this._view),cz(this._frustum,e.frustum);const r=this._view,n=r[2],s=r[6],o=r[10],a=r[14];i.forAll(f=>f.forEachGeometry(m=>{if(!m.visible||!m.castShadow)return;let g;m.hasShaderTransformation?(m.computeBoundingSphere(m.shaderTransformation,$a,1),g=$a):g=m.boundingSphere;const _=n*g[0]+s*g[1]+o*g[2]+a,b=_-g[3],w=_+g[3];this._geometries.push(m),this._near.push(-w),this._far.push(-b)}));const l=new VFt;if(this._geometries.length===0)return l;for(let f=0;f<this._geometries.length;++f)this._near[f]>l.far&&(l.far=this._near[f]),this._near[f]>2&&this._far[f]<l.near&&(l.near=this._far[f]);const c=this._looseRange;c.near=Math.max(.5*l.near,2),c.far=2*l.far;let h=0,p=0;for(let f=0;f<this._geometries.length;++f)this._near[f]<l.near&&(this._near[f]>=c.near?l.near=this._near[f]:this._nearCandidates[h++]=f),this._far[f]>l.far&&(this._far[f]<=c.far?l.far=this._far[f]:this._farCandidates[p++]=f);if(this._nearCandidates.length===0&&this._farCandidates.length===0)return l;this._nearCandidates.sort((f,m)=>this._near[f]<this._near[m]?-1:this._near[f]>this._near[m]?1:0),this._farCandidates.sort((f,m)=>this._far[f]<this._far[m]?1:this._far[f]>this._far[m]?-1:0);for(let f=0;f<this._nearCandidates.length;++f){const m=this._nearCandidates[f];if(this._near[m]<l.near){const g=this._geometries[m],_=g.boundingInfo;this._includeNearBoundingInfoRec(_,g.shaderTransformation,l)}}for(let f=0;f<this._farCandidates.length;++f){const m=this._farCandidates[f];if(this._far[m]>l.far){const g=this._geometries[m],_=g.boundingInfo;this._includeFarBoundingInfoRec(_,g.shaderTransformation,l)}}return this._reset(),l}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0}_includeNearBoundingInfoRec(e,i,r){if(R(e))return;const n=e.center;Ke($a,n,i);const s=v2(i),o=$a[0],a=$a[1],l=$a[2],c=e.radius*s,h=this._frustum;if(h[0][0]*o+h[0][1]*a+h[0][2]*l+h[0][3]>c||h[1][0]*o+h[1][1]*a+h[1][2]*l+h[1][3]>c||h[2][0]*o+h[2][1]*a+h[2][2]*l+h[2][3]>c||h[3][0]*o+h[3][1]*a+h[3][2]*l+h[3][3]>c)return;const p=this._view[2]*o+this._view[6]*a+this._view[10]*l+this._view[14],f=p+c;if(!(-(p-c)<2||-f>=r.near))if(-f>this._looseRange.near)r.near=-f;else{if(c>yie){const m=e.getChildren();if(m!==void 0){for(const g of m)this._includeNearBoundingInfoRec(g,i,r);return}}vie.unionDepthRangeWithAABB(r,this._viewProj,i,e.bbMin,e.bbMax)}}_includeFarBoundingInfoRec(e,i,r){if(R(e))return;let n=e.radius;const s=e.center;Ke($a,s,i);const o=v2(i),a=$a[0],l=$a[1],c=$a[2];n*=o;const h=this._frustum;if(h[0][0]*a+h[0][1]*l+h[0][2]*c+h[0][3]>n||h[1][0]*a+h[1][1]*l+h[1][2]*c+h[1][3]>n||h[2][0]*a+h[2][1]*l+h[2][2]*c+h[2][3]>n||h[3][0]*a+h[3][1]*l+h[3][2]*c+h[3][3]>n)return;const p=this._view[2]*a+this._view[6]*l+this._view[10]*c+this._view[14]-n;if(!(-p<=r.far))if(-p<this._looseRange.far)r.far=-p;else{if(n>yie){const f=e.getChildren();if(f!==void 0){for(const m of f)this._includeFarBoundingInfoRec(m,i,r);return}}vie.unionDepthRangeWithAABB(r,this._viewProj,i,e.bbMin,e.bbMax)}}},X4t=class{constructor(){this._modelViewProj=$e(),this._clipPosition=[pi(),pi(),pi(),pi(),pi(),pi(),pi(),pi()]}unionDepthRangeWithAABB(e,i,r,n,s){const o=this._modelViewProj;$n(o,i,r);let a=!1;for(let l=0;l<8;++l){const c=this._clipPosition[l],h=l===0||l===3||l===4||l===7?n[0]:s[0],p=l===0||l===1||l===4||l===5?n[1]:s[1],f=l<4?n[2]:s[2];c[0]=o[0]*h+o[4]*p+o[8]*f+o[12],c[1]=o[1]*h+o[5]*p+o[9]*f+o[13],c[2]=o[2]*h+o[6]*p+o[10]*f+o[14],c[3]=o[3]*h+o[7]*p+o[11]*f+o[15]}for(let l=0;l<12;++l){const c=this._clipPosition[HW[l][0]],h=this._clipPosition[HW[l][1]],p=this._clipPosition[HW[l][2]],f=this._clipTriangle(c,h,p);let m=!0;for(let g=0;g<f.length;++g)if(f[g][3]>=2){m=!1;break}if(!m){a=!0;for(let g=0;g<f.length;++g){const _=f[g][3];Number.isFinite(_)&&(e.near=Math.min(_,e.near),e.far=Math.max(_,e.far))}}}return a}_inside(e,i){return i===0?e[0]>=-e[3]:i===1?e[1]>=-e[3]:i===2?e[0]<=e[3]:i===3?e[1]<=e[3]:void wt(!1)}_intersect(e,i,r){let n=0;return r===0?n=(-e[3]-e[0])/(i[0]-e[0]+i[3]-e[3]):r===1?n=(-e[3]-e[1])/(i[1]-e[1]+i[3]-e[3]):r===2?n=(e[3]-e[0])/(i[0]-e[0]-i[3]+e[3]):r===3&&(n=(e[3]-e[1])/(i[1]-e[1]-i[3]+e[3])),j9(pi(),e,i,n)}_clipTriangle(e,i,r){let n=[e,i,r];for(let s=0;s<4;++s){const o=n;n=[];for(let a=0;a<o.length;++a){const l=o[a],c=o[(a+1)%o.length];this._inside(c,s)?(this._inside(l,s)||n.push(this._intersect(l,c,s)),n.push(c)):this._inside(l,s)&&n.push(this._intersect(l,c,s))}}return n}};const HW=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],$a=Is(),Y4t=$e(),Zd=cF(),yC=new q4t,Z4t=new W4t,vie=new X4t;let J4t=class{},K4t=class extends Tr{constructor(){super(...arguments),this.textures=new J4t}};function Q4t(){const t=new ji;return t.attributes.add(M.POSITION,"vec2"),t.vertex.uniforms.add(new bi("drawPosition",(e,i)=>e5t(e,i))),t.varyings.add("vUV","vec2"),t.vertex.code.add(S`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),t.fragment.uniforms.add(new Dt("textureInput",e=>e.textures.input)),t.fragment.uniforms.add(new Dt("textureMask",e=>e.textures.mask)),t.fragment.uniforms.add(new Dt("textureOverlay",e=>e.textures.overlay)),t.fragment.uniforms.add(new h_("maskEnabled",e=>e.magnifier.maskEnabled)),t.fragment.uniforms.add(new h_("overlayEnabled",e=>e.magnifier.overlayEnabled)),t.fragment.code.add(S`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture2D(textureMask, vUV).a : 1.0;
vec4 inputColor = texture2D(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture2D(textureOverlay, vUV) : vec4(0);
gl_FragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),t}function e5t(t,e){const i=e.camera.pixelRatio,r=t.magnifier.offset.x*i,n=t.magnifier.offset.y*i;Dg(t.magnifier.position,qbe);const s=e.camera.screenToRender(qbe,t5t),o=Math.ceil(i*t.magnifier.size),a=e.camera.fullWidth,l=e.camera.fullHeight;return cr(i5t,(s[0]+r)/a*2-1,(s[1]-n)/l*2-1,o/a*2,o/l*2)}const qbe=Sn(),t5t=pCe(),i5t=pi();async function r5t(t){const e=Q(()=>import("./mask-svg-023bbc42.js"),[]),i=Q(()=>import("./overlay-svg-d62383f3.js"),[]),r=D_((await e).default,{signal:t}),n=D_((await i).default,{signal:t}),s={mask:await r,overlay:await n};return ui(t),s}let EA=class extends ve{constructor(){super(...arguments),this._handles=new Xi,this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this._passParameters=new K4t,this.events=new An,this.attributeLocations=new Map([[M.POSITION,0]]),this._tmpScreenPoint=Sn(),this._tmpRenderPoint=pCe()}get updating(){return R(this._imageSources)&&v(this._imageLoadTask)&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(e){if(e===this._magnifier)return;this._handles.removeAll(),this._magnifier=e;const i=()=>{this._updateResourceLoading(),this.events.emit("request-render")};v(this._magnifier)&&this._handles.add(ne(()=>Vo(this._magnifier,r=>r.version),i)),i()}get enabled(){return v(this._validMagnifier)}get _validMagnifier(){return v(this._magnifier)&&this._magnifier.visible&&v(this._magnifier.position)&&this._magnifier.size>0?this._magnifier:null}get _factor(){return v(this._magnifier)&&this._magnifier.factor||1}destroy(){this._magnifier=null,this._handles.destroy(),v(this._imageLoadTask)&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeResources()}render(e,i){const r=this._validMagnifier;if(R(r))return;const n=i.camera.pixelRatio,s=Math.ceil(n*r.size);if(this._updateResources(e,s),R(this._resources))return;const o=this._passParameters.textures,a=Math.ceil(1/this._factor*s);o.input.resize(a,a),Dg(r.position,this._tmpScreenPoint);const l=i.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),c=i.camera.fullWidth,h=i.camera.fullHeight,p=.5*a,f=.5*a;l[0]=_e(l[0],p,c-p-1),l[1]=_e(l[1],f,h-f-1);const m=Math.floor(l[0]-p),g=Math.floor(l[1]-f),_=this._resources.program;_.bindTexture("textureInput",o.input),e.gl.copyTexImage2D(o.input.descriptor.target,0,o.input.descriptor.pixelFormat,m,g,a,a,0),this._passParameters.magnifier=r,e.useProgram(_),_.bindPass(this._passParameters,i),e.bindVAO(this._resources.vao),e.setPipelineState(this._resources.pipelineState),e.drawArrays(Ft.TRIANGLE_STRIP,0,4)}_updateResourceLoading(){const e=this._validMagnifier;if(R(e))return;const i=e.maskUrl,r=e.overlayUrl;!v(this._imageLoadTask)||this._imageLoadTask.maskUrl===i&&this._imageLoadTask.overlayUrl===r||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),v(this._imageSources)||v(this._imageLoadTask)||(this._imageLoadTask={maskUrl:i,overlayUrl:r,task:ON(async n=>{const s=R(i)||R(r)?r5t(n):null,o=v(i)?D_(i,{signal:n}):s.then(l=>l.mask),a=v(r)?D_(r,{signal:n}):s.then(l=>l.overlay);this._imageSources={mask:await o,overlay:await a},this._disposeResources(),this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}_updateResources(e,i){if(!this.enabled)return void this._disposeResources();if(v(this._resources)){if(this._passParameters.textures.size!==i){const n=this._createTextureResources(e,i);if(R(n))return void this._disposeResources();this._disposeTextureResources(this._passParameters.textures),this._passParameters.textures=n}return}const r=this._createTextureResources(e,i);R(r)||(this._resources={program:this._createProgram(e),vao:xl(e,Lae,this.attributeLocations,0,1),pipelineState:Ht({blending:Am(Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:si})},this._passParameters.textures=r)}_disposeResources(){R(this._resources)||(this._disposeTextureResources(this._passParameters.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(e){e.mask.dispose(),e.overlay.dispose(),e.input.dispose()}_createTextureResources(e,i){if(R(this._imageSources))return null;this._imageSources.overlay.width=i,this._imageSources.overlay.height=i,this._imageSources.mask.width=i,this._imageSources.mask.height=i;const r=new mt(e,{target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,internalFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE,samplingMode:nt.LINEAR,flipped:!0,preMultiplyAlpha:!zCe(this._imageSources.overlay.src)||!e.driverTest.svgPremultipliesAlpha.result},this._imageSources.overlay),n=new mt(e,{target:Ct.TEXTURE_2D,pixelFormat:Ge.ALPHA,internalFormat:Ge.ALPHA,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE,samplingMode:nt.LINEAR,flipped:!0},this._imageSources.mask);return{input:new mt(e,{target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,internalFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE,samplingMode:nt.LINEAR,flipped:!1}),mask:n,overlay:r,size:i}}_createProgram(e){return new Hi(e,Q4t(),this.attributeLocations)}};u([d()],EA.prototype,"_imageSources",void 0),u([d()],EA.prototype,"_imageLoadTask",void 0),u([d({readOnly:!0})],EA.prototype,"updating",null),EA=u([$("esri/views/3d/webgl-engine/lib/MagnifierHelper")],EA);let n5t=class{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new vl(new ArrayBuffer(4)),this._uidToRenderColor=new Map,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new Map,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(e,i,r,n,s,o=null,a=null,l=null){if(!(e&&i&&r&&n)||(this._layerUidToId.set(n,r),this._layerUidToPopupEnabled.set(n,s),!s))return;let c=this._layerUidToGraphicsUidToObjectId.get(n);c||(c=new Map,this._layerUidToGraphicsUidToObjectId.set(n,c)),c.set(i,{objectId:e,attributeNodeId:o,attributeIndex:a,subLayerId:l})}getObjectAndLayerIdColor(e){const i=this.getObjectAndLayerIdColorArray(e);return Zt(i.get(0,1),i.get(0,2),i.get(0,3),255)}getObjectAndLayerIdColorArray(e){if(!e.layerUid||!e.graphicUid)return this.colorZero;const i=this._layerUidToPopupEnabled.get(e.layerUid);if(i===void 0)return re.getLogger(this.declaredClass).warn("popupEnabled is undefined for layerUid "+e.layerUid),this.colorZero;if(i===!1)return this.colorZero;let r=this._uidToRenderColor.get(e.layerUid);r||(r=new Map,this._uidToRenderColor.set(e.layerUid,r));let n=r.get(e.graphicUid);if(!n){for(;!n;){const o=Math.floor(16777214*Math.random())+1;this._colorToUID.has(o)||(n=o)}if(n>16777215)throw new Error("Object ID Overflow");r.set(e.graphicUid,n),this._colorToUID.set(n,e)}const s=new ArrayBuffer(4);return new DataView(s).setUint32(0,n,!1),new vl(s)}getColorToObjectAndLayerIdMapping(){const e=new Map;for(const[i,r]of this._colorToUID.entries()){const n=this._layerUidToGraphicsUidToObjectId.get(r.layerUid);let s=null;n?(s=n.get(r.graphicUid),s||re.getLogger(this.declaredClass).warn("getColorMapping: no entry found for graphicsId "+r.graphicUid)):re.getLogger(this.declaredClass).warn("getColorMapping: no entry found for layerUid "+r.layerUid);const o=this._layerUidToId.get(r.layerUid);o||re.getLogger(this.declaredClass).warn("no layerId found for uid "+r.layerUid),s&&o&&e.set(i,s.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:s.objectId,lid:o,attrId:s.attributeNodeId,attrIdx:s.attributeIndex,subLayerId:s.subLayerId}:{type:"object-and-layer-id",oid:s.objectId,lid:o})}return e}};var JD;(function(t){t[t.FrontToBack=0]="FrontToBack",t[t.BackToFront=1]="BackToFront"})(JD||(JD={}));let Zv=class{constructor(e,i,r=JD.FrontToBack){this._rctx=e,this._techniqueRepository=i,this._sorting=r,this._draws=new Wt({initialSize:32,allocator:n=>n||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(e,i,r,n){const s=this._draws.pushNew();s.geometry=i,s.geometryRanges=r,s.material=e,s.depthSquaredHint=n,s.indexType=(i.indexed?i.vao.indexBuffer.indexType:null)??0}dispatch(e,i){const r=this._rctx;this._previouslyBoundDraw.clear();let n=null;const s=this._draws.map(a=>a.material.prepareTechnique(this._techniqueRepository,e,i,a.geometry.parameters)),o=this._draws.length;for(let a=0;a<o;a++){const l=s[a];l===n&&l.configuration.transparencyPassType===At.NONE||(r.bindTechnique(l,e,i),n=l);const c=this._draws.data[a],h=c.geometry;r.bindVAO(h.vao),this._previouslyBoundDraw.get(l)!==c.material&&(l.program.bindDraw(c.material,i,e),this._previouslyBoundDraw.set(l,c.material));const p=c.geometryRanges,f=p.length;if(c.indexType!==0){const m=i8.get(c.indexType);for(let g=0;g<f;g+=2){const _=p[g],b=p[g+1];r.drawElements(h.primitiveType,b,c.indexType,_*m)}}else for(let m=0;m<f;m+=2){const g=p[m],_=p[m+1];r.drawArrays(h.primitiveType,g,_)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const e=this._sorting===JD.FrontToBack?1:-1;this._draws.sort((i,r)=>{const n=e*(i.depthSquaredHint-r.depthSquaredHint);return n!==0?n:i.geometry.vao.size-r.geometry.vao.size})}get count(){return this._draws.length}};const i8=new Map;i8.set(ft.UNSIGNED_BYTE,1),i8.set(ft.UNSIGNED_SHORT,2),i8.set(ft.UNSIGNED_INT,4);let s5t=class{constructor(e,i){this.rctx=e,this.shaderTechniqueRepository=i,this.canRender=!0,this._materialPassParameters=new XDt,this._shadowPassParameters=new YDt,this._highlightPassParameters=new ZDt,this._systems=new Set,this._passes={materialOpaque:new Zv(e,i),materialTransparent:new Zv(e,i,JD.BackToFront),materialIntegratedMesh:new Zv(e,i),shadowMap:new Zv(e,i),highlight:new Zv(e,i),highlightIntegratedMesh:new Zv(e,i),highlightShadowMap:new Zv(e,i),defaultShadowMap:new Zv(e,i)}}register(e){this._systems.add(e)}prepareRender(e){if(this._systems.size!==0){for(const i of Object.values(this._passes))i.prepareSubmit();this._systems.forEach(i=>i.submit(this._passes,e.bindParameters));for(const i of Object.values(this._passes))i.finishSubmit();this.shaderTechniqueRepository.frameUpdate()}}render(e){if(this._systems.size!==0)switch(this._configure(e),this._materialPassParameters.output=e.output,e.bindParameters.slot){case Ee.OPAQUE_MATERIAL:switch(e.output){case z.Color:case z.Depth:case z.Normal:return this._passes.materialOpaque.dispatch(this._materialPassParameters,e.bindParameters);case z.Highlight:return this._passes.highlight.dispatch(this._highlightPassParameters,e.bindParameters);case z.Shadow:return this._passes.shadowMap.dispatch(this._shadowPassParameters,e.bindParameters);case z.ShadowHighlight:return this._passes.highlightShadowMap.dispatch(this._shadowPassParameters,e.bindParameters);case z.ShadowExcludeHighlight:return this._passes.defaultShadowMap.dispatch(this._shadowPassParameters,e.bindParameters);case z.ObjectAndLayerIdColor:return this._passes.materialOpaque.dispatch(this._materialPassParameters,e.bindParameters)}return;case Ee.TRANSPARENT_MATERIAL:switch(e.output){case z.Color:case z.Alpha:case z.Depth:case z.Normal:case z.ObjectAndLayerIdColor:return this._passes.materialTransparent.dispatch(this._materialPassParameters,e.bindParameters)}return;case Ee.INTEGRATED_MESH:switch(e.output){case z.Color:case z.Depth:case z.Normal:return this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,e.bindParameters);case z.Highlight:return this._passes.highlightIntegratedMesh.dispatch(this._highlightPassParameters,e.bindParameters);case z.ObjectAndLayerIdColor:return this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,e.bindParameters)}return}}notifyDirty(){this._context.requestRender()}slots(){return[Ee.OPAQUE_MATERIAL,Ee.TRANSPARENT_MATERIAL,Ee.INTEGRATED_MESH]}initializeRenderContext(e){this._context=e}uninitializeRenderContext(){}queryDepthRange(e){const i={near:1/0,far:-1/0};return this._systems.forEach(r=>{const n=r.queryShadowCasterDepthRange(e);v(n)&&aO(i,n,i)}),i}_configure(e){const i=e.output===z.Shadow||e.output===z.ShadowHighlight||e.output===z.ShadowExcludeHighlight?this._shadowPassParameters:e.output===z.Highlight?this._highlightPassParameters:this._materialPassParameters;this._updateParameters(e,i)}_updateParameters(e,i){const r=e.bindParameters.camera,n=r.viewInverseTransposeMatrix;he(qW,n[3],n[7],n[11]),WW.set(qW),ce(i.transformWorldFromViewTH,WW.high),ce(i.transformWorldFromViewTL,WW.low),ce(i.slicePlaneLocalOrigin,qW),Dp(i.transformViewFromCameraRelativeRS,r.viewMatrix),go(i.transformProjFromView,r.projectionMatrix),i.identifier===ku.Material&&(this._materialPassParameters.transparent=e.bindParameters.slot===Ee.TRANSPARENT_MATERIAL,this._materialPassParameters.integratedMesh=e.bindParameters.slot===Ee.INTEGRATED_MESH,Qu(Wbe,i.transformViewFromCameraRelativeRS),Uw(i.transformNormalViewFromGlobal,Wbe))}get needsHighlight(){return this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0}get needsTransparentPass(){return this._passes.materialTransparent.count>0}};const qW=P(),Wbe=wr(),WW=new Y7;let o5t=class{constructor(){this._step=Zbe,this._dilation=1,this._firstIdleTime=0}frame(e,i){if(i?this._firstIdleTime===0&&(this._firstIdleTime=performance.now()):this._firstIdleTime=0,ue("enable-feature:high-quality-idle")){const n=i?performance.now()-this._firstIdleTime:0;if(n>=Xbe+l5t)return this._step=1/0,void(this._dilation=1);this._dilation=n>=Xbe?c5t:1}else this._dilation=1;const r=_e(e/a5t,Zbe,h5t);this._step===1/0?this._step=r:this._step=this._step*Ybe+r*(1-Ybe)}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=0}};const a5t=.5,Xbe=6e4,l5t=5e3,c5t=10,Ybe=.9,u5t=30,Zbe=1e3/1,h5t=1e3/u5t,d5t=8.6,p5t=.4;function f5t(){const t=new ji,{vertex:e,fragment:i}=t,r=e.code,n=i.code;return t.attributes.add(M.POSITION,"vec2"),t.varyings.add("uv","vec2"),t.attributes.add(M.UV0,"vec2"),e.uniforms.add(new Dt("coverageTex",s=>s.coverageTexture)),r.add(S`void main() {
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),i.uniforms.add(new Dt("tex",s=>s.blurColorTexture)),i.uniforms.add(new Dt("origin",s=>s.highlightColorTexture)),i.uniforms.add(new bi("uColor",s=>s.color)),i.uniforms.add(new bi("haloColor",s=>s.haloColor)),i.uniforms.add(new bi("opacities",s=>cr(m5t,s.haloOpacity,s.haloOpacityOccluded,s.fillOpacity,s.fillOpacityOccluded))),i.constants.add("outlineSize","float",d5t),i.constants.add("blurSize","float",p5t),n.add(S`void main() {
vec4 blurredHighlightValue = texture2D(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture2D(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
gl_FragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),t}const m5t=pi(),g5t=Object.freeze(Object.defineProperty({__proto__:null,build:f5t},Symbol.toStringTag,{value:"Module"}));let O8e=class P8e extends Yi{initializeProgram(e){return new Hi(e.rctx,P8e.shader.get().build(),Di)}initializePipeline(){return Ht({blending:_o(Ce.SRC_ALPHA,Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA,Ce.ONE_MINUS_SRC_ALPHA),colorWrite:si})}};O8e.shader=new Gi(g5t,()=>Q(()=>import("./HighlightApply.glsl-6f5b82d1.js"),[]));let I8e=class extends Tr{constructor(){super(...arguments),this.blurSize=Fe()}};function y5t(){const t=new ji,{vertex:e,fragment:i}=t,r=e.code,n=i.code;return t.attributes.add(M.POSITION,"vec2"),t.attributes.add(M.UV0,"vec2"),t.varyings.add("blurCoordinate","vec3"),e.uniforms.add(new Dt("coverageTex",s=>s.coverageTexture)),i.uniforms.add(new wD("blurSize",s=>s.blurSize)),r.add(S`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
}`),i.uniforms.add(new HN("tex",s=>s.blurInputTexture)),n.add(S`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture2D(tex, uv);
if (blurCoordinate.z == 1.0) {
gl_FragColor = center;
} else {
vec4 sum = vec4(0.0);
sum += center * 0.204164;
sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;
gl_FragColor = sum;
}
}`),t}const _5t=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:I8e,build:y5t},Symbol.toStringTag,{value:"Module"}));let $8e=class L8e extends Yi{initializeProgram(e){return new Hi(e.rctx,L8e.shader.get().build(),Di)}initializePipeline(){return Ht({colorWrite:si})}};$8e.shader=new Gi(_5t,()=>Q(()=>import("./HighlightBlur.glsl-5107f79d.js"),[]));let D8e=class extends Tr{constructor(){super(...arguments),this.invFramebufferDim=Fe()}};function v5t(){const t=new ji,{vertex:e,fragment:i}=t,r=e.code,n=i.code;return t.attributes.add(M.POSITION,"vec2"),r.add(S`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`),i.uniforms.add(new HN("tex",s=>s.inputTexture)),i.uniforms.add(new wD("invFramebufferDim",s=>s.invFramebufferDim)),n.add(S`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture2D(tex, coord);
float mx = floor(max(value.g, value.b));
gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`),t}const b5t=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:D8e,build:v5t},Symbol.toStringTag,{value:"Module"}));let N8e=class F8e extends Yi{initializeProgram(e){return new Hi(e.rctx,F8e.shader.get().build(),Di)}initializePipeline(){return Ht({colorWrite:si})}};N8e.shader=new Gi(b5t,()=>Q(()=>import("./HighlightDownsample.glsl-9819da92.js"),[]));let Jbe=class extends Tr{constructor(){super(...arguments),this.color=Tm(1,0,1,1),this.haloColor=Tm(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.shadowColor=Zt(1,0,1,1),this.shadowOpacity=.15,this.occludedShadowOpacity=.075}};const w5t=32;let x5t=class{constructor(e,i){this._techniqueRep=e,this._rctx=i,this._viewportToRestore=pi(),this._passParameters=new Jbe,this._downsampleDrawParameters=new D8e,this._blurDrawParameters=new I8e,this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0}}_assertResources(){if(this._quadVAO)return;this._quadVAO=xl(this._rctx);const e={colorTarget:En.TEXTURE,depthStencilTarget:Vi.NONE,width:0,height:0},i={target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:nt.LINEAR,wrapMode:$t.CLAMP_TO_EDGE,width:0,height:0};this._blur0Fbo=new es(this._rctx,e,i),this._blur1Fbo=new es(this._rctx,e,i),this._blurTechnique=this._techniqueRep.acquire($8e),this._downsampleTechnique=this._techniqueRep.acquire(N8e),this._applyTechnique=this._techniqueRep.acquire(O8e)}dispose(){if(this._blurTechnique=nn(this._blurTechnique),this._downsampleTechnique=nn(this._downsampleTechnique),this._applyTechnique=nn(this._applyTechnique),this._grid.coverageMipmap)for(let e=1;e<this._grid.coverageMipmap.length;e++)this._grid.coverageMipmap[e].dispose();this._grid.vao&&this._grid.vao.dispose(!0),this._quadVAO&&(this._quadVAO.dispose(!0),this._quadVAO=null),this._blur0Fbo=rt(this._blur0Fbo),this._blur1Fbo=rt(this._blur1Fbo)}setDefaultOptions(e){this._passParameters={...new Jbe,...e}}render(e,i,r){this._passParameters.highlightColorTexture=i.colorTexture,this._assertResources();const n=e.camera;Xf(this._viewportToRestore,n.fullViewport);const s=n.fullWidth,o=n.fullHeight,a=n.pixelRatio,l=Math.ceil(s/a),c=Math.ceil(o/a);this._blur0Fbo.resize(l,c),this._blur1Fbo.resize(l,c);const h=this._rctx;h.bindVAO(this._quadVAO);let p=null;this._gridUpdateResources(i,w5t),this._gridComputeMipmap(e),this._passParameters.coverageTexture=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,p=this._grid.vao;const f=h.bindTechnique(this._blurTechnique,this._passParameters,e);h.bindVAO(p),h.bindFramebuffer(this._blur0Fbo),h.setViewport(0,0,l,c),h.setClearColor(0,0,0,0),h.clear(Yr.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=i.colorTexture,dt(this._blurDrawParameters.blurSize,1/l,0),f.bindDraw(this._blurDrawParameters,e,this._passParameters),h.drawArrays(this._blurTechnique.primitiveType,0,Ua(p,"geometry")),h.bindFramebuffer(this._blur1Fbo),h.clear(Yr.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=this._blur0Fbo.colorTexture,dt(this._blurDrawParameters.blurSize,0,1/c),f.bindDraw(this._blurDrawParameters,e,this._passParameters),h.drawArrays(this._blurTechnique.primitiveType,0,Ua(p,"geometry")),h.bindFramebuffer(r),h.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3]),this._passParameters.blurColorTexture=this._blur1Fbo.colorTexture,h.bindTechnique(this._applyTechnique,this._passParameters,e),h.drawArrays(this._applyTechnique.primitiveType,0,Ua(p,"geometry")),h.bindVAO(null)}_gridUpdateResources(e,i){const r=this._rctx,n=this._grid;let s=!1;if(n.coverageMipmap===null&&(n.coverageMipmap=[e],s=!0),n.viewportWidth===e.width&&n.viewportHeight===e.height||(s=!0,n.viewportWidth=e.width,n.viewportHeight=e.height),n.coverageMipmap[0]=e,n.cellPixelSize!==i&&(n.cellPixelSize=i,s=!0),s){for(let l=1;l<n.coverageMipmap.length;l++)n.coverageMipmap[l].dispose();n.mipmapLevels=Math.ceil(Math.log(n.cellPixelSize)*Math.LOG2E),n.coverageMipmap.length=n.mipmapLevels+1;for(let l=0;l<n.mipmapLevels;l++){const c=n.coverageMipmap[l],h={target:Ct.TEXTURE_2D,pixelFormat:Ge.RGB,dataType:kt.UNSIGNED_SHORT_5_6_5,samplingMode:nt.LINEAR,wrapMode:$t.CLAMP_TO_EDGE,width:Math.ceil(c.width/2),height:Math.ceil(c.height/2)},p={colorTarget:En.TEXTURE,depthStencilTarget:Vi.NONE,width:Math.ceil(c.width/2),height:Math.ceil(c.height/2)};n.coverageMipmap[l+1]=new es(r,p,h)}}const o=Math.ceil(e.height/n.cellPixelSize),a=Math.ceil(e.width/n.cellPixelSize);if(!n.vao||n.verticalCellCount!==o||n.horizontalCellCount!==a){n.verticalCellCount=o,n.horizontalCellCount=a;const l=o+1,c=a+1,h=1/o,p=1/a,f=6,m=4,g=new Float32Array(f*m*l*c);let _=0;for(let b=0;b<l;b++)for(let w=0;w<c;w++)g[_+0]=(w-.5)*p*2-1,g[_+1]=(b-.5)*h*2-1,g[_+2]=w*p,g[_+3]=b*h,g[_+4]=(w+.5)*p*2-1,g[_+5]=(b-.5)*h*2-1,g[_+6]=w*p,g[_+7]=b*h,g[_+8]=(w-.5)*p*2-1,g[_+9]=(b+.5)*h*2-1,g[_+10]=w*p,g[_+11]=b*h,g[_+12]=(w-.5)*p*2-1,g[_+13]=(b+.5)*h*2-1,g[_+14]=w*p,g[_+15]=b*h,g[_+16]=(w+.5)*p*2-1,g[_+17]=(b-.5)*h*2-1,g[_+18]=w*p,g[_+19]=b*h,g[_+20]=(w+.5)*p*2-1,g[_+21]=(b+.5)*h*2-1,g[_+22]=w*p,g[_+23]=b*h,_+=f*m;n.vao&&n.vao.dispose(!0),n.vao=new Rm(r,Di,{geometry:kO},{geometry:er.createVertex(r,zi.STATIC_DRAW,g)})}}_gridComputeMipmap(e){const i=this._rctx,r=this._grid,n=i.bindTechnique(this._downsampleTechnique,this._passParameters,e);i.bindVAO(this._quadVAO);for(let s=0;s<r.mipmapLevels;s++){i.bindFramebuffer(r.coverageMipmap[s+1]);const o=r.coverageMipmap[s+1].width,a=r.coverageMipmap[s+1].height;this._downsampleDrawParameters.inputTexture=r.coverageMipmap[s].colorTexture,dt(this._downsampleDrawParameters.invFramebufferDim,1/o,1/a),n.bindDraw(this._downsampleDrawParameters,e,this._passParameters),i.setViewport(0,0,o,a),i.drawArrays(Ft.TRIANGLE_STRIP,0,Ua(this._quadVAO,"geometry"))}}get gpuMemoryUsage(){let e=(v(this._blur0Fbo)?this._blur0Fbo.gpuMemoryUsage:0)+(v(this._blur1Fbo)?this._blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const i of this._grid.coverageMipmap)e+=i.gpuMemoryUsage;return e}get test(){return{coverage:this._grid.coverageMipmap,blur:[this._blur0Fbo,this._blur1Fbo]}}};const T5t={dataType:kt.UNSIGNED_BYTE,internalFormat:Ge.RGBA},S5t={};let E5t=class{constructor(e){this._rctx=e,this._activeTargets=new Set,this._depthTextures=new Map,this._depthBuffers=new Map,this._colorTextures=new Map,this._framebuffers=new Map,this.depthTextureSupported=e.capabilities.depthTexture}dispose(){this._depthBuffers.forEach(e=>e.dispose()),this._depthBuffers.clear(),this._depthTextures.forEach(e=>e.dispose()),this._depthTextures.clear(),this._colorTextures.forEach(e=>e.dispose()),this._colorTextures.clear(),this._framebuffers.forEach(e=>e.dispose()),this._framebuffers.clear(),this._activeTargets.clear()}disposeTargetResource(e){const i=e.id;this._activeTargets.has(i)&&(this._activeTargets.delete(i),this._disposeWithFramebuffers(this._depthTextures,i),this._disposeWithFramebuffers(this._depthBuffers,i),this._disposeWithFramebuffers(this._colorTextures,i))}_disposeWithFramebuffers(e,i){const r=e.get(i);r&&(this._framebuffers.forEach((n,s)=>{n.colorAttachment!==r&&n.depthStencilAttachment!==r||(n.detachAll(),n.dispose(),this._framebuffers.delete(s))}),r.dispose(),e.delete(i))}getDepthTexture(e,i){if(!this.depthTextureSupported)return null;let r=this._depthTextures.get(e.id);return!r||r.descriptor.width===i.width&&r.descriptor.height===i.height||(r.dispose(),r=e2()),r||(r=new mt(this._rctx,{target:Ct.TEXTURE_2D,pixelFormat:Ge.DEPTH_STENCIL,dataType:kt.UNSIGNED_INT_24_8,samplingMode:nt.NEAREST,wrapMode:$t.CLAMP_TO_EDGE,width:i.width,height:i.height}),this._depthTextures.set(e.id,r),this._activeTargets.add(e.id)),r}getAllocatedDepthTexture(e){return this._depthTextures.get(e.id)}getDepthBuffer(e,i){if(this.depthTextureSupported)return null;let r=this._depthBuffers.get(e.id);return r?r.descriptor.width===i.width&&r.descriptor.height===i.height||r.resize(i.width,i.height):(r=new mA(this._rctx,{internalFormat:Bl.DEPTH_STENCIL,...i}),this._depthBuffers.set(e.id,r),this._activeTargets.add(e.id)),r}getColorTexture(e,i){let r=this._colorTextures.get(e.id);return r&&(r.descriptor.width===i.width&&r.descriptor.height===i.height||(r.dispose(),r=e2())),r||(r=new mt(this._rctx,{target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,internalFormat:e.internalFormat,dataType:e.dataType,samplingMode:e.samplingMode!=null?e.samplingMode:nt.LINEAR,wrapMode:$t.CLAMP_TO_EDGE,width:i.width,height:i.height}),this._colorTextures.set(e.id,r),this._activeTargets.add(e.id)),r}getAllocatedColorTexture(e){return this._colorTextures.get(e.id)}registerDepthTarget(e={}){return{id:qu(),...S5t,...e}}registerColorTarget(e={}){return{id:qu(),...T5t,...e}}getFramebuffer(e,i,r){const n=this._getKey(i,r);let s=this._framebuffers.get(n);const o=this.getColorTexture(i,e);if(this.depthTextureSupported){const l=r?this.getDepthTexture(r,e):void 0;return s?((s.width!==e.width||s.height!==e.height||s.colorTexture!==o||s.depthStencilTexture!==l)&&(s.detachAll(),s.resize(e.width,e.height),s.attachColorTexture(o),s.attachDepthStencilTexture(l)),s):(s=v(r)?new es(this._rctx,{colorTarget:En.TEXTURE,depthStencilTarget:Vi.DEPTH_STENCIL_TEXTURE},o,l):new es(this._rctx,{colorTarget:En.TEXTURE,depthStencilTarget:Vi.NONE},o),this._framebuffers.set(n,s),s)}const a=r?this.getDepthBuffer(r,e):void 0;return s?((s.width!==e.width||s.height!==e.height||s.colorTexture!==o)&&(s.detachAll(),s.resize(e.width,e.height),s.attachColorTexture(o),s.attachDepthStencilBuffer(a)),s):(s=new es(this._rctx,{colorTarget:En.TEXTURE,depthStencilTarget:r?Vi.DEPTH_STENCIL_RENDER_BUFFER:Vi.NONE},o,a),this._framebuffers.set(n,s),s)}_getKey(e,i){return`${e.id}_${i?i.id:"X"}_${e.name}${i?"_"+i.name:""}`}get gpuMemoryUsage(){let e=0;const i=new Set,r=n=>{i.has(n)||(i.add(n),e+=x2(n))};return this._depthTextures.forEach(r),this._colorTextures.forEach(r),this._depthBuffers.forEach(r),e}},C5t=class{constructor(e,i){this._rctx=e,this._compositingHelper=i,this._mainColorTarget=0,this._dimensions={width:4,height:4},this._background={type:"color",color:[0,0,0,1]};const r=e.type===Et.WEBGL2;this._renderTargetHelper=new E5t(e);const n=this._renderTargetHelper;this._mainColorTargets=[n.registerColorTarget({name:"mainColorTarget0"}),n.registerColorTarget({name:"mainColorTarget1"})],this.frontFaceTarget=n.registerColorTarget({name:"frontFaceTarget"});const s=o=>n.registerColorTarget({name:o,dataType:kt.FLOAT,internalFormat:r?Mt.RGBA32F:Ge.RGBA,samplingMode:nt.NEAREST});this.colorFloatTarget=s("colorFloatTarget"),this.alphaFloatTarget=s("alphaFloatTarget"),this.mainDepth=n.registerDepthTarget({name:"mainDepth"}),this.linearDepth=n.registerColorTarget({name:"linearDepth",samplingMode:nt.NEAREST}),this.terrainLinearDepth=n.registerColorTarget({name:"terrainLinearDepth"}),this.geometryLinearDepth=n.registerColorTarget({name:"geometryLinearDepth"}),this.normal=n.registerColorTarget({name:"normal"}),this.highlight=n.registerColorTarget({name:"highlight",internalFormat:r?Mt.RGBA4:Ge.RGBA,dataType:kt.UNSIGNED_SHORT_4_4_4_4}),this.hudVisibility=n.registerColorTarget({name:"hudVisibility",internalFormat:r?Mt.RGBA4:Ge.RGBA,dataType:kt.UNSIGNED_SHORT_4_4_4_4}),this.tmpColor=n.registerColorTarget({name:"tmpColor"}),this.tmpDepth=n.registerDepthTarget({name:"tmpDepth"}),this.hudColor=n.registerColorTarget({name:"hudColor"})}dispose(){this._renderTargetHelper.dispose()}get width(){return this._dimensions.width}get height(){return this._dimensions.height}set background(e){this._background=e}get background(){return this._background}get currentColorTarget(){return this._mainColorTargets[this._mainColorTarget]}get previousColorTarget(){return this._mainColorTargets[1-this._mainColorTarget]}get framebuffer(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}getFramebuffer(e,i){return this._renderTargetHelper.getFramebuffer(this._dimensions,e,i)}get colorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}get depthTexture(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}get linearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}get terrainLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}get geometryLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}get lastFrameColorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}get normalTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}get highlightTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}get hudVisibilityTexture(){return this._getColorTexture(this.hudVisibility)}get tmpColorTexture(){return this._getColorTexture(this.tmpColor)}get hudColorTexture(){return this._getColorTexture(this.hudColor)}get mainColorTexture(){return this._getColorTexture(this.currentColorTarget)}setupRenderTarget(e){e||(this._mainColorTarget=0,this.disposeTarget(this._mainColorTargets[1])),this._mainColorTarget=this._mainColorTarget===0&&e?1:0}initializeFrame(e){const i=this._rctx;this._dimensions.width=e.fullWidth,this._dimensions.height=e.fullHeight,this.bindTarget(this.currentColorTarget,this.mainDepth),i.setClearStencil(0);const r=this._background.color;i.setClearColor(r[0]*r[3],r[1]*r[3],r[2]*r[3],r[3]),i.clearSafe(Yr.COLOR_BUFFER_BIT|Yr.DEPTH_BUFFER_BIT|Yr.STENCIL_BUFFER_BIT)}composite(e){v(this.colorTexture)&&this._compositingHelper.composite(e,this.colorTexture,ul.None)}renderTmpAndCompositeToMain(e,i,r,n=!1){this.renderToTargets(e,this.tmpColor,n?this.tmpDepth:this.mainDepth,A5t),this._compositingHelper.composite(i,this._getColorTexture(this.tmpColor),r)}renderHUDVisibility(e,i=!1){this.renderToTargets(e,this.hudVisibility,i?this.tmpDepth:this.mainDepth,R5t)}compositeTransparentTerrainOntoHUDVisibility(e){this.renderToTargets(()=>this._compositingHelper.compositeHUD(e,this._getColorTexture(this.tmpColor)),this.hudVisibility,this.tmpDepth)}renderOITPass(e,i,r){let n,s;switch(i){case At.Color:n=this.colorFloatTarget,s=[0,0,0,0];break;case At.Alpha:n=this.alphaFloatTarget,s=[1,1,1,1];break;case At.FrontFace:n=this.frontFaceTarget,s=[0,0,0,0]}r?this.renderToTargets(e,n,this.tmpDepth,s,!0,!0):this.renderToTargets(e,n,this.mainDepth,s,!1)}compositeTransparentTerrainOntoMain(e){this.bindFramebuffer(),this._compositingHelper.composite(e,this._getColorTexture(this.tmpColor),ul.PremultipliedAlpha)}compositeOccludedOntoMain(e,i){this.bindFramebuffer(),this._compositingHelper.composite(e,this._getColorTexture(this.tmpColor),ul.PremultipliedAlpha,i)}compositeTransparentOntoOpaque(e,i){i?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clearSafe(Yr.COLOR_BUFFER_BIT)):this.bindFramebuffer(),this._compositingHelper.compositeOIT(e,this._getColorTexture(this.colorFloatTarget),this._getColorTexture(this.alphaFloatTarget),this._getColorTexture(this.frontFaceTarget))}bindFramebuffer(){this._rctx.bindFramebuffer(this.framebuffer)}renderDepthDetached(e){this.bindTarget(this.currentColorTarget),e(),this.bindTarget(this.currentColorTarget,this.mainDepth)}disposeTarget(e){this._renderTargetHelper.disposeTargetResource(e)}renderToFBO(e,i,r=!1,n=!1){const s=this._rctx;let o=0;if(i){const l=Math.max(1e-13,i[3]);s.setClearColor(i[0],i[1],i[2],l),o|=Yr.COLOR_BUFFER_BIT}r&&(o|=Yr.DEPTH_BUFFER_BIT),n===!1?n=0:(n===!0&&(n=255),o|=Yr.STENCIL_BUFFER_BIT),o&&s.clearSafe(o,n),e(),s.gl.flush(),this.bindTarget(this.currentColorTarget,this.mainDepth)}renderToTargets(e,i,r,n,s=!1,o=!1){const a=this.bindTarget(i,r);return this.renderToFBO(e,n,s,o),a}bindTarget(e,i){const r=this._renderTargetHelper.getFramebuffer(this._dimensions,e,i);return this._rctx.bindFramebuffer(r),r}_getColorTexture(e){return this._renderTargetHelper.getColorTexture(e,this._dimensions)}get gpuMemoryUsage(){let e=0;return this._renderTargetHelper&&(e+=this._renderTargetHelper.gpuMemoryUsage),e}};const A5t=[0,0,0,0],R5t=[0,1,0,1];let M5t=class{constructor(e){this._context=e,this._renderPlugins=new Wt,this._slots=[];for(let i=0;i<Ee.MAX_SLOTS;++i)this._slots[i]=[]}add(e,i,r){const n=()=>{if(r!=null&&r.aborted)throw i.uninitializeRenderContext(),Bi();this._renderPlugins.push(i);for(const o of e)this._slots[o].push(i);this._context.requestRender()},s=i.initializeRenderContext(this._context,r);if(ih(s))return s.then(n);n()}remove(e){if(this._renderPlugins.removeUnordered(e)!=null){for(let i=0;i<this._slots.length;++i)this._slots[i]=this._slots[i].filter(r=>r!==e);e.uninitializeRenderContext(),this._context.requestRender()}}prepareRender(){this._renderPlugins.forAll(e=>{e.prepareRender&&e.prepareRender(this._context.renderContext)})}updateAnimation(e){let i=!1;return this._renderPlugins.forAll(r=>{r.updateAnimation&&(i=r.updateAnimation(e)||i)}),i}render(){const e=this._slots[this._context.renderContext.bindParameters.slot],i=new Array;e.filter(r=>{if(!r.canRender)return!1;if(O5t(r)){const n=r.prepareTechnique(this._context.renderContext);return!!n&&(i.push(n),!0)}return i.push(null),!0}).forEach((r,n)=>r.render(this._context.renderContext,i[n]))}queryDepthRange(e){const i=P5t;return i.near=1/0,i.far=-1/0,this._renderPlugins.forAll(r=>{if(r.queryDepthRange){const n=r.queryDepthRange(e);n&&aO(i,n,i)}}),i}get needsTransparentPass(){return this._renderPlugins.some(e=>!!e.needsTransparentPass)}get needsHighlight(){return this._renderPlugins.some(e=>!!e.needsHighlight)}get needsLinearDepth(){return this._renderPlugins.some(e=>!!e.needsLinearDepth)}get needsLaserlineWithContrastControl(){const e=this._slots[Ee.LASERLINES_CONTRAST_CONTROL];return!!e&&e.length>0}get renderOccludedFlags(){return this._renderPlugins.reduce((e,i)=>e|i.renderOccludedFlags,0)}};function O5t(t){return"prepareTechnique"in t}const P5t={near:0,far:0};let k8e=class extends dke{};const Z7=255,I5t=1/Z7;function $5t(t){const e=new ji,i=e.fragment;return i.include(nh),i.include(ud),e.include(L7),e.include(Bp),e.include($7,t),i.uniforms.add([new Dt("depthMap",r=>r.linearDepthTexture),new on("inverseViewMatrix",(r,n)=>wa(Kbe,Yc(Kbe,n.camera.viewMatrix,n.camera.center))),new Wi("nearFar",(r,n)=>n.camera.nearFar)]),i.constants.add("sampleValue","float",I5t),i.code.add(S`void main(void) {
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
gl_FragColor = vec4(sampleValue);
}`),e}const Kbe=$e(),L5t=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastAccumulatePassParameters:k8e,ShadowCastMaxSamples:Z7,build:$5t},Symbol.toStringTag,{value:"Module"}));var N2;(function(t){t[t.Gradient=0]="Gradient",t[t.Threshold=1]="Threshold",t[t.COUNT=2]="COUNT"})(N2||(N2={}));let bie=class extends wl{constructor(){super(...arguments),this.visualization=N2.Gradient,this.bandsEnabled=!1}};u([j({count:N2.COUNT})],bie.prototype,"visualization",void 0),u([j()],bie.prototype,"bandsEnabled",void 0);let U8e=class extends Tr{constructor(e){super(),this.shadowCastMap=e,this.sampleScale=0,this.opacityFromElevation=1,this.color=DN(D5t),this.bandSize=.1,this.threshold=.5}};const D5t=Zt(.01,0,.25,1);function N5t(t){const e=new ji,i=e.fragment;i.include(nh),i.include(ud),e.include(L7),e.include(Bp);const{visualization:r,bandsEnabled:n}=t;i.constants.add("inverseSampleValue","float",Z7),i.uniforms.add([new Dt("shadowCastMap",a=>a.shadowCastMap),new Ie("sampleScale",a=>a.sampleScale),new Ie("opacityFromElevation",a=>a.opacityFromElevation),new bi("uColor",a=>a.color)]);const s=r===N2.Gradient,o=r===N2.Threshold;return s&&n?i.uniforms.add(new Ie("bandSize",a=>a.bandSize)):o&&i.uniforms.add(new Ie("threshold",a=>a.threshold)),i.code.add(S`
      void main(void) {
        vec4 record = texture2D(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${o?S`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${s&&n?S`strength = ceil(strength / bandSize) * bandSize;`:""}

        gl_FragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${s?S`* strength`:""});
      }
    `),e}const F5t=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:U8e,build:N5t},Symbol.toStringTag,{value:"Module"}));let V8e=class z8e extends Yi{constructor(e,i){super(e,i,()=>this.destroy())}initializeProgram(e){return new Hi(e.rctx,z8e.shader.get().build(this.configuration),Di)}initializePipeline(){return Ht({blending:nd,colorWrite:si,depthTest:null,depthWrite:null})}get primitiveType(){return Ft.TRIANGLE_STRIP}};V8e.shader=new Gi(F5t,()=>Q(()=>import("./ShadowCastVisualize.glsl-100d1f02.js"),[]));const k5t=4e4,U5t=5e4,B8e=1/512;let r8=class extends ve{constructor(e,i,r,n){super({}),this._techniqueRepository=e,this._rctx=i,this._data=r,this._requestRender=n,this._passParameters=new U8e(this._data.shadowCastTexture),this._techniqueConfig=new bie,this._enabled=!1,this._vao=xl(i),this._techniqueConfig.visualization=N2.Gradient}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=rt(this._vao),this._techniqueRepository.release(this._technique),this._technique=null}get _visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(V8e,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._showVisualization)return;this._passParameters.sampleScale=1/this._data.computedSamples;const i=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(i,this._passParameters,e),this._rctx.drawArrays(i.primitiveType,0,Ua(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&this._data.computedSamples>0&&this.opacityFromElevation>B8e}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const i=this._passParameters.color;RR(e,i)||(Xf(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};u([d()],r8.prototype,"opacityFromElevation",null),r8=u([$("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],r8);let a9=class extends wl{constructor(){super(...arguments),this.receiveShadows=!0,this.hasWebGL2Context=!1}};u([j()],a9.prototype,"receiveShadows",void 0),u([j()],a9.prototype,"hasWebGL2Context",void 0);let j8e=class G8e extends Yi{constructor(e){super(e,new a9,()=>this.destroy())}initializeConfiguration(e,i){i.hasWebGL2Context=e.rctx.type===Et.WEBGL2}initializeProgram(e){return new Hi(e.rctx,G8e.shader.get().build(this.configuration),Di)}initializePipeline(){return Ht({blending:_o(Ce.ONE,Ce.ONE,Ce.ONE,Ce.ONE),colorWrite:si,depthTest:null,depthWrite:null})}get primitiveType(){return Ft.TRIANGLE_STRIP}};j8e.shader=new Gi(L5t,()=>Q(()=>import("./ShadowCastAccumulate.glsl-6152380e.js"),[]));let Mc=class extends ve{constructor(e,i,r,n,s,o){super({}),this._rctx=e,this._stage=r,this._prepareForShadowMapPass=n,this._renderToShadowMap=s,this._requestRender=o,this._progress=0,this._sampleCount=0,this._passParameters=new k8e,this._enabledInternal=!1,this._cachedLightDirections=[],this._depthRange=die,this._previewing=!1,this._handles=new Xi,this._cameraForcedForScreenshot=!1,this._bindParameters=new e7(new ace(e,r.viewingMode),null,null),this._bindParameters.shadowMap.enabled=!0,this._vao=xl(e);const a={colorTarget:En.TEXTURE,depthStencilTarget:Vi.NONE,width:0,height:0},l={target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:nt.LINEAR,wrapMode:$t.CLAMP_TO_EDGE,width:0,height:0};this._fbo=new es(e,a,l),this._accumulationRenderer=new r8(i,e,this,o);const c=this._stage.view.resourceController.scheduler;this._handles.add([c.registerTask(St.SHADOW_ACCUMULATOR,this),ne(()=>r.renderView,h=>{this._handles.remove(Qbe),v(h)&&this._handles.add(h.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),Qbe)},Jr),ne(()=>this._previewing,()=>this._requestRenderIfEnabled(),Ki)])}normalizeCtorArgs(){return{}}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _accumulationTechnique(){if(R(this._accumulationTechniqueCached)){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechniqueCached=new j8e(e)}return this._accumulationTechniqueCached}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._enabledInternal&&this._sampleCount>0}get canAccumulate(){return this._passParameters.linearDepthTexture!==null&&this._depthRange!==die&&this._opacityFromElevation>B8e}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const i=this._cachedLightDirections;if(x_(i,e,Qb))return;const r=Math.min(Z7,e.length);i.length=r,this._sampleCount=r;for(let n=0;n<r;++n)i[n]=ce(i[n]??P(),e[n]);this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,i,r,n){if(this._depthRange=i,this._updateCamera(r),this._bindParameters.contentCamera=n,this._passParameters.linearDepthTexture=e,this._passParameters.origin=this._bindParameters.camera.center,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const s=this._cameraForcedForScreenshot?this._sampleCount:Math.min(V5t,this._sampleCount-this._progress);for(let o=0;o<s;++o)this._accumulateShadow();this._cameraForcedForScreenshot=!1,this._requestRender()}render(e){this._accumulationRenderer.render(e)}dispose(){this._stop(),this._handles.destroy(),this._accumulationRenderer=rt(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=rt(this._fbo),this._vao=rt(this._vao),this._accumulationTechniqueCached=nn(this._accumulationTechniqueCached),this._cachedLightDirections.length=0,this._sampleCount=0}setOptions(e){e.enabled!==void 0&&(this._enabled=e.enabled),e.previewing!==void 0&&(this._previewing=e.previewing),e.lightDirections!==void 0&&(this._lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}readAccumulatedShadow(e,i){return!this._isActive||this._progress<1||e<0||e>this._fbo.width||i<0||i>this._fbo.height?0:(this._fbo.readPixels(e,i,1,1,Ge.RGBA,kt.UNSIGNED_BYTE,ewe),ewe[0]/this._progress)}_start(){this._progress=0,this._enabledInternal=!0}_stop(){this._enabledInternal=!1}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(Yr.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._sampleLightDirection(),this._depthRange);const e=this._accumulationTechnique;this._rctx.bindFramebuffer(this._fbo),this._rctx.bindTechnique(e,this._passParameters,this._bindParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(e.primitiveType,0,Ua(this._vao,"geometry"))}_sampleLightDirection(){return this._progress++,this._lightDirections[this._progress*z5t%this._lightDirections.length]}_updateCamera(e){e.equals(this._bindParameters.camera)||(this._bindParameters.camera.copyFrom(e),this._fbo.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-bM(k5t,U5t,e.relativeElevation))}set _enabled(e){e!==this._enabledInternal&&(e?this._start():this._stop())}_requestRenderIfEnabled(){this._enabledInternal&&this._requestRender()}get test(){const e=this;return{lightDirections:this._lightDirections,get isDone(){return e._isDoneAccumulating},get isActive(){return e._isActive}}}};u([d()],Mc.prototype,"_progress",void 0),u([d()],Mc.prototype,"_sampleCount",void 0),u([d()],Mc.prototype,"_enabledInternal",void 0),u([d()],Mc.prototype,"_depthRange",void 0),u([d()],Mc.prototype,"_previewing",void 0),u([d()],Mc.prototype,"_accumulationRenderer",void 0),u([d()],Mc.prototype,"_isRefining",null),u([d()],Mc.prototype,"_isActive",null),u([d()],Mc.prototype,"canAccumulate",null),u([d()],Mc.prototype,"_isDoneAccumulating",null),u([d()],Mc.prototype,"_opacityFromElevation",null),u([d()],Mc.prototype,"running",null),Mc=u([$("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],Mc);const V5t=6,Qbe="renderView",z5t=104729,ewe=new Uint8Array(4),twe={highlightedThreshold:.99999,selfShadowThreshold:.025};function B5t(t){const e=new ji;e.include(O2,t);const i=e.fragment;return i.include(nh),i.include(ud),e.include(L7),e.include(Bp),i.uniforms.add([new Dt("defaultDepthTex",(r,n)=>n.shadowMap.getSnapshot(rO.Default)),new Dt("highlightDepthTex",(r,n)=>n.shadowMap.getSnapshot(rO.Highlight)),new Dt("depthMap",(r,n)=>n.linearDepthTexture),new Dt("highlightMap",(r,n)=>n.highlightColorTexture),new bi("uColor",r=>r.shadowColor),new Wi("nearFar",(r,n)=>n.camera.nearFar),new Ie("opacity",r=>r.shadowOpacity),new Ie("occludedOpacity",r=>r.occludedShadowOpacity),new Ie("terminationFactor",r=>r.opacityElevation*r.dayNightTerminator),new Jt("lightingMainDirectionView",(r,n)=>we(rwe,Ke(rwe,n.lighting.mainLight.direction,n.camera.viewInverseTransposeMatrix))),new Wi("texelSize",(r,n)=>v(n.linearDepthTexture)?dt(j5t,1/n.linearDepthTexture.descriptor.width,1/n.linearDepthTexture.descriptor.height):Jc),new on("inverseViewMatrix",(r,n)=>wa(iwe,Yc(iwe,n.camera.viewMatrix,n.camera.center)))]),i.constants.add("unoccludedHighlightFlag","vec4",G4e).add("highlightedThreshold","float",twe.highlightedThreshold).add("selfShadowThreshold","float",twe.selfShadowThreshold),i.code.add(S`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`),i.code.add(S`void main(void) {
vec4 highlightInfo = texture2D(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
gl_FragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
}`),e}const iwe=$e(),rwe=P(),j5t=Fe(),G5t=Object.freeze(Object.defineProperty({__proto__:null,build:B5t},Symbol.toStringTag,{value:"Module"}));let H5t=class extends Tr{constructor(){super(...arguments),this.shadowColor=Zt(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}},H8e=class q8e extends Yi{constructor(e){super(e,new a9,()=>this.destroy())}initializeConfiguration(e,i){i.hasWebGL2Context=e.rctx.type===Et.WEBGL2}initializeProgram(e){return new Hi(e.rctx,q8e.shader.get().build(this.configuration),Di)}initializePipeline(){return Ht({blending:_o(Ce.SRC_ALPHA,Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA,Ce.ONE_MINUS_SRC_ALPHA),colorWrite:si,depthTest:null,depthWrite:null})}get primitiveType(){return Ft.TRIANGLE_STRIP}};H8e.shader=new Gi(G5t,()=>Q(()=>import("./ShadowHighlight.glsl-d4b32e2f.js"),[]));const q5t=.001953125,W5t=4e4,X5t=5e4;let Y5t=class{constructor(e,i){this._rctx=e,this._viewingMode=i,this._maxOpacity=1,this._passParameters=new H5t,this._drawParameters=new dke,this._vao=xl(this._rctx)}get _technique(){return R(this._techniqueCached)&&(this._techniqueCached=new H8e({rctx:this._rctx,viewingMode:this._viewingMode})),this._techniqueCached}render(e,i){if(!e.shadowMap.enabled||!e.linearDepthTexture||!this.isVisible)return;const r=this._technique;this._drawParameters.origin=e.camera.center,this._rctx.bindFramebuffer(i),this._rctx.bindTechnique(r,this._passParameters,e).bindDraw(this._drawParameters,e,this._passParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(r.primitiveType,0,Ua(this._vao,"geometry"))}get gpuMemoryUsage(){var e;return((e=this._vao)==null?void 0:e.size)??0}setDefaultOptions(e){this._passParameters={...this._passParameters,...e},this._updateMaxOpacity()}updateParameters(e,i){this._passParameters.opacityElevation=1-bM(W5t,X5t,e.relativeElevation);const r=this._viewingMode===qe.Global?we(nwe,e.center):he(nwe,0,0,1),n=be(r,i);this._passParameters.dayNightTerminator=bM(0,1,_e(30*n,0,1))}dispose(){this._vao=rt(this._vao),this._techniqueCached=nn(this._techniqueCached)}get isVisible(){const{opacityElevation:e,dayNightTerminator:i}=this._passParameters;return this._maxOpacity*e*i>=q5t}_updateMaxOpacity(){const e=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=e*this._passParameters.shadowColor[3]}};const nwe=P(),swe=G_();let Z5t=class{constructor(){this._plane=G_()}get isEnabled(){return!WLe(this.plane,swe)}get plane(){return this._plane}set plane(e){Z2(e||swe,this._plane)}},J5t=class extends Tr{};function KD(t){t.uniforms.add(new bi("resolution",e=>{const{descriptor:i}=e.colorTexture,r=i.width,n=i.height;return cr(K5t,1/r,1/n,r,n)}))}const K5t=pi(),_C={maxSearchSteps:8,maxDistanceAreaTex:16};function Q5t(){const t=new ji,{attributes:e,varyings:i,vertex:r,fragment:n}=t;return e.add(M.POSITION,"vec2"),i.add("uv","vec2"),i.add("offsets[2]","vec4"),i.add("maxOffset","vec4"),i.add("pixelCoord","vec2"),KD(r),r.code.add(S`
      void main() {
        uv = position * 0.5 + vec2(0.5);
        gl_Position = vec4(position, 0, 1);

        pixelCoord = uv * resolution.zw;
        offsets[0] = uv.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        offsets[1] = uv.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        maxOffset = vec4( offsets[0].xz, offsets[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${S.int(_C.maxSearchSteps)} );
      }
    `),n.uniforms.add(new Dt("edgesTexture",s=>s.edges.colorTexture)),n.uniforms.add(new Dt("areaTexture",s=>s.areaTexture)),n.uniforms.add(new Dt("searchTexture",s=>s.searchTexture)),KD(n),n.code.add(S`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 sampleLevelZeroOffset(sampler2D texture, vec2 coord, vec2 offset) {
        return texture2D(texture, coord + offset.x * resolution.xy, 0.0);
      }

      vec2 round( vec2 x ) {
        return sign(x) * floor(abs(x) + 0.5);
      }

      float searchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
        e.r = bias + e.r * scale;
        return 255.0 * texture2D( searchTex, e, 0.0 ).r;
      }

      float searchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${S.int(_C.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * searchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float searchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${S.int(_C.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * searchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float searchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${S.int(_C.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * searchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float searchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${S.int(_C.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * searchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 getArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${S.int(_C.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture2D( areaTex, texcoord, 0.0 ).rg;
      }

      void main() {
        ivec4 subsampleIndices = ivec4(0.0);
        vec4 weights = vec4(0.0);
        vec2 e = texture2D( edgesTexture, uv ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = searchXLeft( edgesTexture, searchTexture, offsets[0].xy, maxOffset.x );
          coords.y = offsets[1].y;
          d.x = coords.x;
          float e1 = texture2D( edgesTexture, coords, 0.0 ).r;
          coords.x = searchXRight( edgesTexture, searchTexture, offsets[0].zw, maxOffset.y );
          d.y = coords.x;
          d = d * resolution.z - pixelCoord.x;
          vec2 sqrt_d = sqrt( abs(d) );
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = searchYUp( edgesTexture, searchTexture, offsets[1].xy, maxOffset.z );
          coords.x = offsets[0].x;
          d.x = coords.y;
          float e1 = texture2D( edgesTexture, coords, 0.0 ).g;
          coords.y = searchYDown( edgesTexture, searchTexture, offsets[1].zw, maxOffset.w );
          d.y = coords.y;
          d = d * resolution.w - pixelCoord.y;
          vec2 sqrt_d = sqrt(abs(d));
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2(0.0, 1.0)).g;
          weights.ba = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
        }
        gl_FragColor = weights;
      }
    `),t}const ekt=Object.freeze(Object.defineProperty({__proto__:null,build:Q5t},Symbol.toStringTag,{value:"Module"}));let W8e=class X8e extends Yi{initializeProgram(e){return new Hi(e.rctx,X8e.shader.get().build(),Di)}initializePipeline(){return Ht({colorWrite:si})}};W8e.shader=new Gi(ekt,()=>Q(()=>import("./BlendWeights.glsl-b46e96cd.js"),[]));function tkt(){const t=new ji,{attributes:e,varyings:i,vertex:r,fragment:n}=t;return e.add(M.POSITION,"vec2"),i.add("uv","vec2"),i.add("offsets[2]","vec4"),KD(r),r.code.add(S`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}`),n.uniforms.add(new Dt("blendWeightsTexture",s=>s.blend.colorTexture)),n.uniforms.add(new Dt("colorTexture",s=>s.colorTexture)),KD(n),n.code.add(S`void main() {
vec4 a;
a.rb = texture2D(blendWeightsTexture, uv).rb;
a.g = texture2D(blendWeightsTexture, offsets[1].zw).g;
a.a = texture2D(blendWeightsTexture, offsets[1].xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
gl_FragColor = texture2D( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture2D( colorTexture, uv, 0.0 );
vec4 Cop = texture2D( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
gl_FragColor = mix(C, Cop, s);
}
}`),t}const ikt=Object.freeze(Object.defineProperty({__proto__:null,build:tkt},Symbol.toStringTag,{value:"Module"}));let Y8e=class Z8e extends Yi{initializeProgram(e){return new Hi(e.rctx,Z8e.shader.get().build(),Di)}initializePipeline(){return Ht({colorWrite:si})}};Y8e.shader=new Gi(ikt,()=>Q(()=>import("./Blur.glsl-161bd28b.js"),[]));const owe={threshold:.05,localConstrastAdaption:2};function rkt(){const t=new ji,{attributes:e,varyings:i,vertex:r,fragment:n}=t;return e.add(M.POSITION,"vec2"),KD(r),i.add("uv","vec2"),i.add("offsets[3]","vec4"),r.code.add(S`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
offsets[2] = uv.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}`),n.uniforms.add(new Dt("colorTexture",s=>s.colorTexture)),n.code.add(S`
    float absMax3(vec3 v) {
      vec3 t = abs(v);
      return max(max(t.r, t.g), t.b);
    }

    void main() {
      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture2D(colorTexture, uv).rgb;

      vec3 Cleft = texture2D(colorTexture, offsets[0].xy).rgb;
      delta.x = absMax3(C - Cleft);

      vec3 Ctop = texture2D(colorTexture, offsets[0].zw).rgb;
      delta.y = absMax3(C - Ctop);

      vec2 edges = step(vec2(${S.float(owe.threshold)}), delta.xy);

      // discard if there is no edge:
      if (dot(edges, vec2(1.0)) == 0.0) {
        discard;
      }

      // Calculate right and bottom deltas:
      vec3 Cright = texture2D(colorTexture, offsets[1].xy).rgb;
      delta.z = absMax3(C - Cright);

      vec3 Cbottom  = texture2D(colorTexture, offsets[1].zw).rgb;
      delta.w = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture2D(colorTexture, offsets[2].xy).rgb;
      delta.z = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture2D(colorTexture, offsets[2].zw).rgb;
      delta.w = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, delta.z), delta.w);

      // Local contrast adaptation in action:
      edges.xy *= step(maxDelta, float(${S.float(owe.localConstrastAdaption)}) * delta.xy);

      gl_FragColor = vec4(edges, 0.0, 0.0);
    }
  `),t}const nkt=Object.freeze(Object.defineProperty({__proto__:null,build:rkt},Symbol.toStringTag,{value:"Module"}));let J8e=class K8e extends Yi{initializeProgram(e){return new Hi(e.rctx,K8e.shader.get().build(),Di)}initializePipeline(){return Ht({colorWrite:si})}};J8e.shader=new Gi(nkt,()=>Q(()=>import("./EdgeDetect.glsl-3ac5f4cd.js"),[]));let t$=class extends ve{constructor(e,i){super({}),this._rctx=e,this._techniqueRep=i,this._passParameters=new J5t,this._isEnabled=!1}normalizeCtorArgs(){return{}}dispose(){this._abortController=Mp(this._abortController),this.disable()}_loadResources(e){if(v(this._abortController))return!1;if(v(this._passParameters.searchTexture))return!0;this._abortController=new AbortController;const i=this._abortController.signal;return Q(()=>import("./SmaaRenderPassData-660b7d34.js"),[]).then(r=>this._loadTextures(r,i)).then(()=>e()).finally(()=>this._abortController=null),!1}_loadTextures(e,i){return ui(i),Promise.all([this._loadTextureFromBase64(e.areaTexture,nt.LINEAR,Ge.RGB),this._loadTextureFromBase64(e.searchTexure,nt.NEAREST,Ge.LUMINANCE)]).then(([r,n])=>{fo(i)?(r.dispose(),n.dispose(),ui(i)):(this._passParameters.areaTexture=r,this._passParameters.searchTexture=n)})}get updating(){return v(this._abortController)}enable(e){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const i=new wl;this._edgeDetectTechnique=this._techniqueRep.releaseAndAcquire(J8e,i,this._edgeDetectTechnique),this._blendWeightsTechnique=this._techniqueRep.releaseAndAcquire(W8e,i,this._blendWeightsTechnique),this._blurTechnique=this._techniqueRep.releaseAndAcquire(Y8e,i,this._blurTechnique)}return!!this._loadResources(e)&&(this._vao=f_t(this._rctx),this._passParameters.edges=new es(this._rctx,{colorTarget:En.TEXTURE,depthStencilTarget:Vi.NONE},{target:Ct.TEXTURE_2D,pixelFormat:Ge.RGB,dataType:kt.UNSIGNED_BYTE,samplingMode:nt.LINEAR,wrapMode:$t.CLAMP_TO_EDGE,width:4,height:4}),this._passParameters.blend=new es(this._rctx,{colorTarget:En.TEXTURE,depthStencilTarget:Vi.NONE},{target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:nt.LINEAR,wrapMode:$t.CLAMP_TO_EDGE,width:4,height:4}),this._isEnabled=!0,!0)}disable(){this._isEnabled&&(this._vao=rt(this._vao),this._passParameters.areaTexture=rt(this._passParameters.areaTexture),this._passParameters.searchTexture=rt(this._passParameters.searchTexture),this._passParameters.blend=rt(this._passParameters.blend),this._passParameters.edges=rt(this._passParameters.edges),this._isEnabled=!1)}get _validPassParameters(){return this._isEnabled?this._passParameters:null}render(e){const i=this._validPassParameters;if(R(i))return;i.colorTexture=e;const r=this._rctx,n=r.getBoundFramebufferObject(),s=e.descriptor.width,o=e.descriptor.height;r.bindVAO(this._vao),r.setViewport(0,0,s,o),i.edges.resize(s,o),r.bindFramebuffer(i.edges),r.setClearColor(0,0,0,1),r.clear(Yr.COLOR_BUFFER_BIT),r.bindTechnique(this._edgeDetectTechnique,i,null),r.drawArrays(Ft.TRIANGLES,0,3),i.blend.resize(s,o),r.bindFramebuffer(i.blend),r.setClearColor(0,0,1,1),r.clear(Yr.COLOR_BUFFER_BIT),r.bindTechnique(this._blendWeightsTechnique,i,null),r.drawArrays(Ft.TRIANGLES,0,3),r.bindFramebuffer(n),r.setClearColor(0,1,0,1),r.clear(Yr.COLOR_BUFFER_BIT),r.bindTechnique(this._blurTechnique,i,null),r.drawArrays(Ft.TRIANGLES,0,3)}_loadTextureFromBase64(e,i,r){return D_(e).then(n=>new mt(this._rctx,{pixelFormat:r,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.CLAMP_TO_EDGE,width:n.width,height:n.height,samplingMode:i},n))}};u([d()],t$.prototype,"_abortController",void 0),u([d({readOnly:!0})],t$.prototype,"updating",null),t$=u([$("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],t$);function skt(t,e){const i=-t[0],r=-t[1],n=-t[2],s=e[3],o=e[7],a=e[11],l=e[15];e[0]+=s*i,e[1]+=s*r,e[2]+=s*n,e[4]+=o*i,e[5]+=o*r,e[6]+=o*n,e[8]+=a*i,e[9]+=a*r,e[10]+=a*n,e[12]+=l*i,e[13]+=l*r,e[14]+=l*n}function okt(t,e){const i=t[0],r=t[1],n=t[2];e[12]+=i*e[0]+r*e[4]+n*e[8],e[13]+=i*e[1]+r*e[5]+n*e[9],e[14]+=i*e[2]+r*e[6]+n*e[10],e[14]+=i*e[3]+r*e[7]+n*e[11]}let akt=class{constructor(e){this._factory=e,this._originData=new Map}acquire(e){return this.register(this._factory.getOrigin(e))}register(e){const i=this._originData.get(e.id)||new lkt(e);return i.refCount++,this._originData.has(i.origin.id)||this._originData.set(i.origin.id,i),i}release(e){e.refCount--,e.refCount===0&&this._originData.delete(e.origin.id)}updateViewMatrices(e){this._originData.forEach(i=>{go(i.viewMatrix,e),okt(i.origin.vec3,i.viewMatrix)})}},lkt=class{constructor(e){this.origin=e,this.refCount=0,this.viewMatrix=$e()}},ckt=class extends lNe{constructor(e,i){super(),this.distanceFalloffFactor=e,this.transparency=i,this.transformNormalViewFromGlobal=wr()}},ukt=class extends cNe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=wr(),this.slicePlaneLocalOrigin=P(),this.transformNormalGlobalFromModel=wr()}};function hkt(t){const e=S`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;t.code.add(e)}const dkt=Mi(.5,-4e-4);function pkt(t,e){const i=t.vertex;i.include(hkt),i.constants.add("depthBias","vec2",dkt),i.uniforms.add(new Wi("inverseViewport",(r,n)=>n.inverseViewport)),e.legacy?(i.uniforms.add(new on("proj",(r,n)=>n.camera.projectionMatrix)),i.code.add(S`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(i.uniforms.add(new Ay("transformNormalViewFromGlobal",r=>r.transformNormalViewFromGlobal)),i.uniforms.add(new on("transformProjFromView",r=>r.transformProjFromView)),i.code.add(S`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)),i.code.add(S`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}function fkt(t,e){const i=t.fragment;i.constants.add("coverageTestThreshold","float",.01),e.antialiasing?i.code.add(S`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):i.code.add(S`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)}function mkt(t,e){const i=t.vertex;e.silhouette?(i.code.add(S`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),e.legacy?i.code.add(S`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):i.code.add(S`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):i.code.add(S`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)}function gkt(t,e){const i=t.vertex;i.include(nh),i.uniforms.add(new Ie("distanceFalloffFactor",r=>r.distanceFalloffFactor)),i.code.add(S`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),i.uniforms.add(Gb("componentDataTex",r=>r.componentDataTexture,e.hasWebGL2Context?lr.None:lr.InvSize)),t.attributes.add(M.COMPONENTINDEX,"float"),i.constants.add("componentColorFieldOffset","float",0),i.constants.add("componentOtherFieldOffset","float",1),i.constants.add("componentVerticalOffsetFieldOffset","float",2),i.constants.add("componentFieldCount","float",3),i.constants.add("lineWidthFractionFactor","float",8),i.constants.add("extensionLengthOffset","float",128),i.constants.add("verticalOffsetScale","float",2*Vce),i.code.add(S`
    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
      float fieldIndex = componentFieldCount * componentIndex + fieldOffset;

      vec2 textureSizeInverse = ${Tp(e,"componentDataTex",!0)};

      float colIndex = mod(fieldIndex, 1.0 / textureSizeInverse.x);
      float rowIndex = floor(fieldIndex * textureSizeInverse.x);

      return vec2(colIndex, rowIndex) + 0.5;
    }

    struct ComponentData {
      vec4 color;
      float lineWidth;
      float extensionLength;
      float type;
      float verticalOffset;
    };

    ComponentData readComponentData() {
      vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
      vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
      vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);

      vec4 colorValue = ${Zl(e,"componentDataTex","colorIndex")};
      vec4 otherValue = ${Zl(e,"componentDataTex","otherIndex")};
      float verticalOffset = (rgba2float(${Zl(e,"componentDataTex","verticalOffsetIndex")}) - 0.5) * verticalOffsetScale;

      return ComponentData(
        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity
        otherValue.x * (255.0 / lineWidthFractionFactor),
        otherValue.y * 255.0 - extensionLengthOffset,
        -(otherValue.z * 255.0) + 0.5, // SOLID (=0/255) needs to be > 0.0, SKETCHY (=1/255) needs to be <= 0;
        verticalOffset
      );
    }
  `),e.legacy?i.code.add(S`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(i.uniforms.add(new xD("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel)),i.code.add(S`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),e.silhouette?(t.attributes.add(M.NORMALA,"vec3"),t.attributes.add(M.NORMALB,"vec3"),i.code.add(S`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(t.attributes.add(M.NORMAL,"vec3"),i.code.add(S`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`)),e.legacy?i.code.add(S`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(i.include(hz,e),i.include(hz,e),i.uniforms.add([new Ay("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new xD("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new rd("transformWorldFromModelTL",r=>r.transformWorldFromModelTL),new rd("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new Jt("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new Jt("transformWorldFromViewTH",r=>r.transformWorldFromViewTH)]),i.code.add(S`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${e.spherical?S`normalize(transformWorldFromModelTL + rotatedModelPosition);`:S`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),i.uniforms.add(new on("transformProjFromView",(r,n)=>n.camera.projectionMatrix)),i.code.add(S`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),i.code.add(S`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function ykt(t){return t.mode===Zs.SKETCH||t.mode===Zs.MIXED}var Zs,uS;(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH",t[t.MIXED=2]="MIXED",t[t.COUNT=3]="COUNT"})(Zs||(Zs={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.SILHOUETTE=1]="SILHOUETTE"}(uS||(uS={}));function Gce(t,e){const i=t.vertex;switch(t.attributes.add(M.SIDENESS,"vec2"),e.mode===Zs.MIXED?i.code.add(S`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):i.code.add(S`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),e.mode){case Zs.MIXED:i.code.add(S`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case Zs.SKETCH:i.code.add(S`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case Zs.SOLID:i.code.add(S`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case Zs.COUNT:break;default:e.mode}}function _kt(t,e){const i=t.vertex;switch(t.include(Gce,e),e.mode){case Zs.SOLID:i.code.add(S`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case Zs.SKETCH:i.uniforms.add(new GS("strokesAmplitude",r=>r.strokesTexture.amplitude)),i.code.add(S`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case Zs.MIXED:i.uniforms.add(new GS("strokesAmplitude",r=>r.strokesTexture.amplitude)),i.code.add(S`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}}function vkt(t,e){t.include(Gce,e);const{vertex:i,fragment:r}=t;switch(ykt(e)&&(i.uniforms.add(Gb("strokesTexture",n=>n.strokesTexture.texture,e.hasWebGL2Context?lr.None:lr.InvSize)),i.uniforms.add([new GS("strokesLog2Resolution",n=>Math.log2(n.strokesTexture.resolution)),new GS("strokeVariants",n=>n.strokesTexture.variants)]),t.varyings.add("vStrokeUV","vec2"),r.uniforms.add([new HN("strokesTexture",n=>n.strokesTexture.texture),new GS("strokesNormalizationScale",n=>n.strokesTexture.normalizationScale)]),i.code.add(S`
      void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
        vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

        float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);

        vec2 textureSizeInverse = ${Tp(e,"strokesTexture",!0)};
        vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) * textureSizeInverse;
        vStrokeUV.x += variantOffset;
      }
    `),t.fragment.include(nh),r.code.add(S`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture2D(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture2D(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),e.mode){case Zs.SOLID:i.code.add(S`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),r.code.add(S`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case Zs.SKETCH:i.code.add(S`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),r.code.add(S`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case Zs.MIXED:t.varyings.add("vType","float"),i.code.add(S`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),r.code.add(S`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}function bkt(t){const e=new ji,{vertex:i,fragment:r}=e;return t.legacy&&i.uniforms.add([new awe("model"),new awe("localView")]),e.include(pkt,t),e.include(gkt,t),e.include(_kt,t),e.include(Gce,t),e.include(vkt,t),e.include(fs,t),e.include(mkt,t),e.include(fkt,t),e.include(hd,t),e.varyings.add("vColor","vec4"),e.varyings.add("vRadius","float"),e.varyings.add("vPosition","vec3"),e.varyings.add("vWorldPosition","vec3"),e.varyings.add("vViewPos","vec3"),e.varyings.add("vLineLengthPixels","float"),e.varyings.add("vSizeFalloffFactor","float"),i.uniforms.add([new Wi("pixelToNDC",(n,s)=>dt(wkt,2/s.camera.fullViewport[2],2/s.camera.fullViewport[3])),new bi("viewport",(n,s)=>s.camera.fullViewport),new Ie("pixelRatio",(n,s)=>s.camera.pixelRatio)]),e.attributes.add(M.POSITION0,"vec3"),e.attributes.add(M.POSITION1,"vec3"),e.attributes.add(M.VARIANTOFFSET,"float"),e.attributes.add(M.VARIANTSTROKE,"float"),e.attributes.add(M.VARIANTEXTENSION,"float"),i.code.add(S`
    const float opaqueCutoff = 1.0 / 255.0;

    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
      vec2 sideness = unpackedAttributes.sideness;
      vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

      vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;

      vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
      vViewPos = viewPos;

      vec4 projPosV0 = projFromViewPosition(viewPosV0);
      vec4 projPosV1 = projFromViewPosition(viewPosV1);
      vec4 projPos = projFromViewPosition(viewPos);

      vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
      vec2 ndcToPixel = viewport.zw * 0.5;
      vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
      float lineLengthPixels = length(screenSpaceLinePixels);

      float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
      vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;

      float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
      float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;

      float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
      float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;

      vSizeFalloffFactor = falloffFactor;

      float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
      float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;

      ${t.antialiasing?S`
        const float aaPaddingPixels = 1.0;

        // Line size with padding
        float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
        float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;`:S`
        float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
        float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;`}

      // Half line width in NDC including padding for anti aliasing
      vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
      vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
      vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;

      // Compute screen space position of vertex, offsetting for line size and end caps
      vec2 ndcOffset = (
          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
      );

      projPos.xy += ndcOffset * projPos.w;
      projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;

      projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));

      // Line length with end caps
      float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;

      float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;

      // Position in pixels with origin at first vertex of line segment
      vPosition = vec3(
        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
        pixelPositionAlongLine,
        pixelPositionAlongLine / extendedLineLengthPixels
      );

      // The line width radius in pixels
      vRadius = lineWidthPixels * 0.5;
      vLineLengthPixels = extendedLineLengthPixels;

      // discard short edges below a certain length threshold
      ${t.mode===Zs.SKETCH?S`
        if (lineLengthPixels <= 3.0) {
          gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
          return;
        }`:t.mode===Zs.MIXED?S`
        if (lineLengthPixels <= 3.0 && unpackedAttributes.type <= 0.0) {
           gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
           return;
        }`:""}
      gl_Position = projPos;
    }

    void main() {
      ComponentData component = readComponentData();
      UnpackedAttributes unpackedAttributes = unpackAttributes(component);

      vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
      worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
      worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);

      // Component color
      vColor = component.color;

      // Discard fully transparent edges
      if (vColor.a < opaqueCutoff) {
        gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
        return;
      }

      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
        return;
      }

      // General geometric computation for all types of edges
      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);

      // Specific computation for different edge styles
      calculateStyleOutputs(unpackedAttributes);
    }
  `),r.code.add(S`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float positionX = position.x - calculateLineOffset();

      if (radius < 1.0) {
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);
        return vec2(0.5 - min(coverageX, coverageY), 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      gl_FragColor = vec4(vColor.rgb, vColor.a * coverage);
    }
  `),e}const wkt=Fe();let awe=class extends Fn{constructor(e){super(e,"mat4")}};const xkt=Object.freeze(Object.defineProperty({__proto__:null,build:bkt},Symbol.toStringTag,{value:"Module"}));let Q8e=class eVe extends Yi{initializeConfiguration(e,i){i.hasWebGL2Context=e.rctx.type===Et.WEBGL2}initializeProgram(e){return new Hi(e.rctx,eVe.shader.get().build(this.configuration),p8e)}initializePipeline(e){return e.blendMinMax?Ht({blending:_o(Ce.ONE,Ce.ONE,Ce.ZERO,Ce.ONE,yy.ADD,e.blendMinMax.MAX),depthTest:{func:Gr.LEQUAL},colorWrite:si}):Ht({depthTest:{func:Gr.LEQUAL},depthWrite:Kc,colorWrite:si})}};Q8e.shader=new Gi(xkt,()=>Q(()=>import("./EdgeShader.glsl-d5797a46.js"),[]));let xg=class extends Do{constructor(){super(...arguments),this.mode=Zs.SOLID,this.hasSlicePlane=!1,this.silhouette=!1,this.legacy=!1,this.antialiasing=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.spherical=!1}};u([j({count:Zs.COUNT})],xg.prototype,"mode",void 0),u([j()],xg.prototype,"hasSlicePlane",void 0),u([j()],xg.prototype,"silhouette",void 0),u([j()],xg.prototype,"legacy",void 0),u([j()],xg.prototype,"antialiasing",void 0),u([j()],xg.prototype,"doublePrecisionRequiresObfuscation",void 0),u([j()],xg.prototype,"hasMultipassTerrain",void 0),u([j()],xg.prototype,"cullAboveGround",void 0),u([j()],xg.prototype,"spherical",void 0);const Tkt=8,XW=128,Skt={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0},Ekt={solid:Zs.SOLID,sketch:Zs.SKETCH,uber:Zs.MIXED};let YW=class tVe{constructor(e,i,r){this._rctx=e,this._shaderTechniqueRepository=i,this._configuration=new xg,this.refCount=0,this._renderables=new Set,this._sortedRenderables={[ci.TRANSPARENT]:{[ci.TRANSPARENT]:new Wt,[ci.OPAQUE]:new Wt},[ci.OPAQUE]:{[ci.TRANSPARENT]:new Wt,[ci.OPAQUE]:new Wt}},this._renderablesDirty=!1,this._drawParameters=new ukt,this._settings={...Skt,...r},this.key=tVe.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);const n=this._settings.strokesTexture.variants;this.writerSettings={variants:n,reducedPrecision:tr.TESTS_DISABLE_OPTIMIZATIONS},this._configuration.legacy=this._settings.legacy,this._configuration.mode=Ekt[this._settings.type],this._configuration.silhouette=!1,this._configuration.antialiasing=!!this._rctx.capabilities.blendMinMax,this._configuration.hasSlicePlane=this._settings.hasSlicePlane,this._configuration.doublePrecisionRequiresObfuscation=e.driverTest.doublePrecisionRequiresObfuscation.result,this._configuration.spherical=r.spherical}dispose(){this._technique=nn(this._technique)}addRenderable(e){this._renderables.add(e),this._renderablesDirty=!0}removeRenderable(e){this._renderables.delete(e),this._renderablesDirty=!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(e,i){this._renderablesDirty&&this._sortRenderables(),this._sortedRenderables[i][ci.TRANSPARENT].forAll(e),this._sortedRenderables[i][ci.OPAQUE].forAll(e)}updateTechnique(e,i){return this._configuration.hasMultipassTerrain=!!e.multipassTerrain.enabled,this._configuration.cullAboveGround=!!e.multipassTerrain.cullAboveGround,this._configuration.silhouette=i,this._technique=this._shaderTechniqueRepository.releaseAndAcquire(Q8e,this._configuration,this._technique),this._technique}bindRegularEdges(e,i){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(i,!1),e,i)}bindSilhouetteEdges(e,i){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(i,!0),e,i)}renderRegularEdges(e,i,r,n,s){this._render(e,i,i.regular.vao,r,n,s)}renderSilhouetteEdges(e,i,r,n,s){this._render(e,i,i.silhouette.vao,r,n,s)}_render(e,i,r,n,s,o){o>0&&(this._bindDraw(e,i,n,s),this._rctx.bindVAO(r),this._rctx.capabilities.instancing.drawArraysInstanced(Ft.TRIANGLE_FAN,0,4,o))}_bindDraw(e,i,r,n){if(this._drawParameters.componentDataTexture=i.components.buffer.textureBuffer.texture,this._drawParameters.strokesTexture=this._settings.strokesTexture,"origin"in i.transform)this._lastOriginId!==i.transform.origin.origin.id&&(e.setUniformMatrix4fv("localView",i.transform.origin.viewMatrix),this._lastOriginId=i.transform.origin.origin.id),e.setUniformMatrix4fv("model",i.transform.modelMatrix),this._drawParameters.slicePlaneLocalOrigin=i.transform.origin.origin.vec3;else{const s=new Y7(i.transform.position),o=Qu(lwe,Uw(lwe,i.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=s.low,this._drawParameters.transformWorldFromModelTH=s.high,this._drawParameters.transformWorldFromModelRS=i.transform.rotationScale,this._drawParameters.transformNormalGlobalFromModel=o;const a=n.camera.viewInverseTransposeMatrix;he(this._drawParameters.slicePlaneLocalOrigin,a[3],a[7],a[11])}e.bindDraw(this._drawParameters,n,r)}_sortRenderables(){this._renderablesDirty=!1,this._sortedRenderables[ci.TRANSPARENT][ci.TRANSPARENT].clear(),this._sortedRenderables[ci.TRANSPARENT][ci.OPAQUE].clear(),this._sortedRenderables[ci.OPAQUE][ci.TRANSPARENT].clear(),this._sortedRenderables[ci.OPAQUE][ci.OPAQUE].clear(),this._renderables.forEach(i=>{i.objectTransparency!==ci.INVISIBLE&&i.edgeTransparency!==ci.INVISIBLE&&this._sortedRenderables[i.objectTransparency][i.edgeTransparency].push(i)});const e=(i,r)=>"origin"in i.transform?"origin"in r.transform?i.transform.origin.origin.id<r.transform.origin.origin.id?-1:i.transform.origin.origin.id>r.transform.origin.origin.id?1:0:1:0;this._sortedRenderables[ci.TRANSPARENT][ci.TRANSPARENT].sort(e),this._sortedRenderables[ci.TRANSPARENT][ci.OPAQUE].sort(e),this._sortedRenderables[ci.OPAQUE][ci.TRANSPARENT].sort(e),this._sortedRenderables[ci.OPAQUE][ci.OPAQUE].sort(e)}static getKey(e,i,r){return`edges-t:${e}:${i}:${r}`}};const lwe=qc();function sri(t,e){return e.push(t.buffer),{buffer:t.buffer,layout:Ckt(t.layout)}}function $k(t){return Akt(t.layout).createView(t.buffer)}function Ckt(t){const e=new Array;return t.fields.forEach((i,r)=>{const n={...i,constructor:iVe(i.constructor)};e.push([r,n])}),{stride:t.stride,fields:e,fieldNames:t.fieldNames}}function Akt(t){const e=_n();return e.stride=t.stride,e.fieldNames=t.fieldNames,t.fields.forEach(i=>e.fields.set(i[0],{...i[1],constructor:Mkt(i[1].constructor)})),e}const Rkt=[Zae,K_,jr,eh,vw,Kae,Qae,ele,_l,i7,Jae,SD,YM,r7,ED,vl,n7,tle,s7,XN,o7,ile,fNe,mNe,rle,a7,gNe,yNe,_Ne,l7,vNe,bNe,wNe,xNe,TNe,SNe];function iVe(t){return`${t.ElementType}_${t.ElementCount}`}function Mkt(t){return rVe.get(t)}const rVe=new Map;Rkt.forEach(t=>rVe.set(iVe(t),t));let Okt=class extends oUe{constructor(e){super("EdgeProcessingWorker","extract",{extract:i=>[i.dataBuffer],extractComponentsEdgeLocations:i=>[i.dataBuffer],extractEdgeLocations:i=>[i.dataBuffer]},e)}async process(e,i,r){if(r)return v4t(e);const n=await this.invoke(new ZW(e),i);return this._unpackOutput(n)}async extractEdgeLocations(e,i){const r=await this.invokeMethod("extractEdgeLocations",new ZW(e),i);return $k(r)}async extractComponentsEdgeLocations(e,i){const r=await this.invokeMethod("extractComponentsEdgeLocations",new ZW(e),i);return $k(r)}_unpackOutput(e){return{regular:{instancesData:$k(e.regular.instancesData),lodInfo:{lengths:new Float32Array(e.regular.lodInfo.lengths)}},silhouette:{instancesData:$k(e.silhouette.instancesData),lodInfo:{lengths:new Float32Array(e.silhouette.lodInfo.lengths)}},averageEdgeLength:e.averageEdgeLength}}},ZW=class{constructor(e){this.dataBuffer=e.data.buffer,this.writerSettings=e.writerSettings,this.skipDeduplicate=e.skipDeduplicate,this.indices=Array.isArray(e.indices)?e.indices:e.indices.buffer,this.indicesType=Array.isArray(e.indices)?"Array":zre(e.indices)?"Uint32Array":"Uint16Array",this.indicesLength=e.indicesLength}};function Pkt(t){const i=gP.resolution,r=i/2,n=new Uint8Array(4*i*i),s=4*i*r,o=gP.amplitude,a=2*o,l=4*i,c=Math.log2(i)+1,h=gP.strokes.length;let p=(c-1)*h*l;for(const{distance:m,pressure:g}of gP.strokes){let _=m,b=g,w=p;for(let x=0;x<c;x++){x!==0&&(_=cwe(_,QD.DISTANCE),b=cwe(b,QD.PRESSURE));for(let T=0;T<gP.resolution;T++){const E=.5+(_?_[T%_.length]/a:0),C=b?b[T%b.length]:1;ID(E,n,w),ID(C,n,w+s),w+=4}w-=l*(h+1)}p+=l}const f=new mt(t,{pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,hasMipmap:!1,samplingMode:nt.LINEAR,width:i,height:i,wrapMode:$t.REPEAT},n);return new $kt(i,a,o,h,f)}function cwe(t,e){if(!t)return null;const i=t.length/2,r=Ikt*i,n=new Array(i);let s=0;const o=e===QD.PRESSURE;for(let a=0;a<t.length;a+=2){const l=(t[a]+t[a+1])/2;n[s++]=o?Math.min(r,1-(1-l)*uwe):Math.min(r,l*uwe)}return n}var QD;(function(t){t[t.DISTANCE=0]="DISTANCE",t[t.PRESSURE=1]="PRESSURE"})(QD||(QD={}));const Ikt=.1,uwe=.5;let $kt=class{constructor(e,i,r,n,s){this.resolution=e,this.normalizationScale=i,this.amplitude=r,this.variants=n,this.texture=s}dispose(){this.texture=rt(this.texture)}};const gP={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};function hwe(t){let e=null;for(const i of t){const r=i.type;if(Lkt(i)){if(R(e))e=r;else if(e!==r)return"uber"}}return v(e)?e:"uber"}function dwe(t){let e=ci.INVISIBLE;for(const{material:i}of t)if(nVe(i)){if(i.color[3]*i.opacity<1)return ci.TRANSPARENT;e=ci.OPAQUE}return e}function pwe(t){let e=ci.INVISIBLE;for(const{material:i}of t)if(nVe(i)){switch(i.objectTransparency){case ci.TRANSPARENT:case ci.INVISIBLE:return ci.TRANSPARENT;case ci.OPAQUE:if(i.opacity<1)return ci.TRANSPARENT}e=ci.OPAQUE}return e}function nVe(t){return t.size*t.color[3]*t.opacity>0}function Lkt(t){return t.size*t.color[3]>0}function fwe(t,e,i,r){for(let n=0;n<t.length;n++){const s=t[n].index,o=e[n],a=e[n+1];if(r)for(let l=o;l<a;l++){const c=r[l];i.set(c,s)}else for(let l=o;l<a;l++)i.set(l,s)}}let Af=class extends ve{constructor(e){super(e),this._updatingHandles=new Jg,this._perObjectData=new Map,this._perObjectDataEvictionCache=new Set,this._renderers=new Map,this._gpuMemoryUsage=0,this._workerAbort=new AbortController,this._tmpModelPosition=P(),this._localOrigins=new akt(new oce(e.renderSR))}initialize(){this._worker=new Okt(this.schedule),this._componentColorManager=new g8e(this.rctx,3);const e=h8e.createBuffer(4);for(let i=0;i<4;i++)e.sideness.set(i,0,i===0||i===3?0:1),e.sideness.set(i,1,i===0||i===1?0:1);this._verticesBufferObject=er.createVertex(this.rctx,zi.STATIC_DRAW,e.buffer)}destroy(){this.destroyed||(this._perObjectData.forEach(e=>this._discardObjectEntry(e)),this._perObjectData.clear(),this._strokesTexture=rt(this._strokesTexture),this._componentColorManager=Ve(this._componentColorManager),this._workerAbort.abort(),this._worker.destroy(),this._verticesBufferObject=rt(this._verticesBufferObject),this._renderers.clear(),this._updatingHandles.destroy())}get updating(){return this._updatingHandles.updating}get usedMemory(){return this._gpuMemoryUsage}shouldRender(){return this._renderers.size>0}async addComponentObject(e,i,r,n,s,o,a,l){if(this.hasObject(e))return this.getObjectMemoryUsage(e);let c;const h=new gwe(new Promise(f=>c=f),r.center,r.radius);this._perObjectData.set(e,h);const p=await this._updatingHandles.addPromise(this._addComponentGeometry(i,h,n,s,o,a,l));return this.setNeedsRender(),c(),p}async addOrUpdateObject3D(e,i,r,n){if(this.destroyed)return void re.getLogger(this.declaredClass).warn("Attempt to add an object to a destroyed instance");const s=this._perObjectData.get(e);let o;(s==null?void 0:s.renderables.length)>0&&this._perObjectDataEvictionCache.add(s);const a=e.boundingVolumeWorldSpace.bounds,l=new gwe(new Promise(h=>o=h),a,c_(a));this._perObjectData.set(e,l);const c=new Array;if(r.mergeGeometries&&e.geometries.length>1&&Dkt(e))c.push(this._addObjectMergedGeometries(e,l,i,r,n));else for(let h=0;h<e.geometries.length;h++){const p=e.geometries[h];p.material.supportsEdges&&c.push(this._addGeometry(e,l,p,i[0],r,n))}await this._updatingHandles.addPromise(Promise.all(c)),this._perObjectDataEvictionCache.delete(l),this._discardObjectEntry(s),this.setNeedsRender(),o()}_discardObjectEntry(e){e&&(e.renderables.length&&(e.renderables.forEach(i=>this._removeRenderable(i)),this.setNeedsRender()),e.loaded=null)}hasObject(e){return this._perObjectData.has(e)}async updateAllComponentOpacities(e,i){const r=await this._updatingHandles.addPromise(this._getObjectEntry(e));if(R(r))return;const n=i instanceof Array?s=>i[s]:()=>i;r.renderables.forEach(s=>{const o=s.components.meta.length;for(let a=0;a<o;a++){const l=n(a),c=s.components.meta[a],h=c.index;c.material.opacity=l,s.components.buffer.textureBuffer.setDataElement(h,1,3,255*l)}this._updateTransparency(s)}),this.setNeedsRender()}async getObjectMemoryUsage(e){const i=await this._getObjectEntry(e);return v(i)?i.renderables.reduce((r,n)=>r+n.statistics.gpuMemoryUsage,0):0}async updateAllComponentMaterials(e,i,r,n){const s=e instanceof iv,o=!!r.hasSlicePlane,a=hwe(i),l=YW.getKey(a,o,s),c=await this._updatingHandles.addPromise(this._getObjectEntry(e));R(c)||(c.renderables.forEach(h=>{if(l!==h.rendererKey){const p=this._renderers.get(h.rendererKey),f=this._acquireRenderer(a,o,s);p.removeRenderable(h),--p.refCount,h.rendererKey=l,f.addRenderable(h)}for(let p=0;p<i.length;p++)h.components.meta[p].material=i[p];n&&this._updateComponentBuffer(h.components),this._updateTransparency(h)}),this.setNeedsRender())}async updateAllVerticalOffsets(e,i){const r=await this._updatingHandles.addPromise(this._getObjectEntry(e));R(r)||(r.renderables.forEach(n=>{const s=n.components.meta;for(let o=0;o<s.length;o++)n.components.meta[o].verticalOffset=(i==null?void 0:i[o])??0;this._updateComponentBuffer(n.components)}),this.setNeedsRender())}async updateObjectVisibility(e,i){const r=await this._updatingHandles.addPromise(this._getObjectEntry(e));v(r)&&(r.renderables.forEach(n=>n.visible=i),this.setNeedsRender())}removeObject(e){const i=this._perObjectData.get(e);i&&(this._perObjectData.delete(e),this._discardObjectEntry(i))}async _getObjectEntry(e){const i=this._perObjectData.get(e);if(!i)throw new Error("no object");return await i.loaded,i.loaded==null?null:i}render(e,i){if(R(this._componentColorManager))return;this._localOrigins.updateViewMatrices(e.camera.viewMatrix);const r=e.camera.viewInverseTransposeMatrix,n=P(),s=new Y7;let o=0,a=0;if(this._renderers.forEach(c=>{if(c.refCount===0)this._renderers.delete(c.key),c.dispose();else{let h=!0,p=!0;c.forEachRenderable(f=>{f.visible&&(o+=f.statistics.averageEdgeLength,a++,h&&f.regular&&(c.updateTechnique(e,!1),h=!1),p&&f.silhouette&&(c.updateTechnique(e,!0),p=!1))},i)}}),this._componentColorManager.garbageCollect(),this._componentColorManager.updateTextures(),a===0)return;const l=new ckt(40*o/a,i);he(n,r[3],r[7],r[11]),s.set(n),ce(l.transformWorldFromViewTH,s.high),ce(l.transformWorldFromViewTL,s.low),Dp(l.transformViewFromCameraRelativeRS,e.camera.viewMatrix),Qu(bwe,l.transformViewFromCameraRelativeRS),Uw(l.transformNormalViewFromGlobal,bwe),l.transformProjFromView=e.camera.projectionMatrix,this._updateObjectCameraDistances(e),this._renderers.forEach(c=>{this._renderRegularEdges(c,e,l),this._renderSilhouetteEdges(c,e,l)})}_updateTransparency(e){const i=dwe(e.components.meta),r=pwe(e.components.meta);i===e.edgeTransparency&&r===e.objectTransparency||(e.edgeTransparency=i,e.objectTransparency=r,this._renderers.get(e.rendererKey).setRenderablesDirty())}_computeModelTransformWithLocalOrigin(e,i,r){e.getCombinedStaticTransformation(i,r);const n=v(i.localOrigin)?this._localOrigins.register(i.localOrigin):this._localOrigins.acquire(he(this._tmpModelPosition,r[12],r[13],r[14]));return i.localOrigin=n.origin,skt(n.origin.vec3,r),n}_updateComponentBuffer(e){const{meta:i,buffer:r}=e,n=new Uint8Array(4);for(let s=0;s<i.length;s++){const o=i[s].material,a=i[s].index,l=_e(Math.round(o.size*Tkt),0,255),c=_e(o.extensionLength,-XW,255-XW)+XW,h=o.type==="solid"?o9.SOLID:o9.SKETCH,p=255*o.opacity,f=o.color,m=255*f[0],g=255*f[1],_=255*f[2],b=255*f[3];r.textureBuffer.setData(a,0,m,g,_,b),r.textureBuffer.setData(a,1,l,c,h,p),a8e(i[s].verticalOffset,n),r.textureBuffer.setData(a,2,n[0],n[1],n[2],n[3])}}_createComponentBuffers(e){if(R(this._componentColorManager))return null;const i=new Array,r=this._componentColorManager.getBuffer(e.length);for(let s=0;s<e.length;s++){const o=e[s],a=r.acquireIndex();i.push({index:a,verticalOffset:0,material:o})}const n=new Nkt(r,i);return this._updateComponentBuffer(n),n}_extractEdges(e,i,r,n,s,o=s.length){return this._worker.process({data:i,indices:s,indicesLength:o,writerSettings:e,skipDeduplicate:r},this._workerAbort.signal,n)}_createRenderable(e,i,r,n,s){const o=h=>v(this._verticesBufferObject)?new Fkt(new Rm(this.rctx,p8e,{vertices:l4t,instances:h===uS.REGULAR?n9.glLayout:s9.glLayout},{vertices:this._verticesBufferObject,instances:er.createVertex(this.rctx,zi.STATIC_DRAW,h===uS.REGULAR?e.regular.instancesData.buffer:e.silhouette.instancesData.buffer)}),h===uS.REGULAR?e.regular.lodInfo:e.silhouette.lodInfo):null,a=e.regular.lodInfo.lengths.length>0?o(uS.REGULAR):null,l=e.silhouette.lodInfo.lengths.length>0?o(uS.SILHOUETTE):null,c=(v(a)?a.vao.size:0)+(v(l)?l.vao.size:0);return new Ukt(a,l,{gpuMemoryUsage:c,externalMemoryUsage:s,averageEdgeLength:e.averageEdgeLength},r,dwe(i.meta),pwe(i.meta),i,n)}async _addGeometry(e,i,r,n,s,o){const a=r.vertexAttributes.get(M.POSITION),l=r.indices.get(M.POSITION),c=$e(),h=this._computeModelTransformWithLocalOrigin(e,r,c),p=new vwe(a,l,c,h);return this._addPositionData(i,p,r.edgeIndicesLength,n,s,o)}async _addPositionData(e,i,r,n,s,o=!1){if(e.loaded==null)return;const a=this._createComponentBuffers([n]);if(R(a)||r<=0)return;const l=this._acquireRenderer(n.type,!!s.hasSlicePlane,!0),{modelTransform:c,origin:h}=i,p=i.indices,f=i.position,m=f.data.length/f.size,g=i9.createBuffer(m);for(let w=0;w<m;w++)g.position.set(w,0,f.data[w*f.size+0]),g.position.set(w,1,f.data[w*f.size+1]),g.position.set(w,2,f.data[w*f.size+2]);fwe(a.meta,[0,g.componentIndex.count],g.componentIndex);const _=await this._updatingHandles.addPromise(this._extractEdges(l.writerSettings,g,!1,o,p,r));if(e.loaded==null)return;const b=this._createRenderable(_,a,new kkt(c,h),l.key,!1);e.renderables.push(b),l.addRenderable(b),this._gpuMemoryUsage+=b.statistics.gpuMemoryUsage}async _addComponentGeometry(e,i,r,n,s,o,a){if(i.loaded==null)return 0;const l=this._createComponentBuffers(o);if(R(l))return 0;const c=hwe(o),h=this._acquireRenderer(c,a.hasSlicePlane||!1,!1),p=i9.createBuffer(r.count);V7(p.position,r),fwe(l.meta,s,p.componentIndex,n);const f=!0,m=h.writerSettings,g=await this._updatingHandles.addPromise(this._extractEdges(m,p,f,!1,n));if(i.loaded==null)return 0;const _=this._createRenderable(g,l,e,h.key,!0);return i.renderables.push(_),h.addRenderable(_),_.statistics.gpuMemoryUsage}async _addObjectMergedGeometries(e,i,r,n,s){const o=new Map;let a=0,l=null,c=0;for(let x=0;x<e.geometries.length;x++){const T=e.geometries[x];if(!T.material.supportsEdges)continue;!l&&T.localOrigin&&(l=T);const E=T.vertexAttributes.get(M.POSITION);c+=E.data.length/E.size,a+=T.edgeIndicesLength}const h=c>=65536?Uint32Array:Uint16Array,p=a?new h(a):null,f=[];let m=0;for(let x=0;x<e.geometries.length;x++){const T=e.geometries[x];if(!T.material.supportsEdges)continue;const E=T.vertexAttributes.get(M.POSITION),C=T.indices.get(M.POSITION);let A=o.get(E.data);if(A==null){A=f.length/3;for(let I=0;I<E.data.length;I+=E.size)f.push(E.data[I+0]),f.push(E.data[I+1]),f.push(E.data[I+2]);o.set(E.data,A)}if(C)for(let I=0;I<T.edgeIndicesLength;I++)p[m++]=A+C[I]}const g=l||e.geometries[0],_=$e(),b=this._computeModelTransformWithLocalOrigin(e,g,_);for(let x=0;x<e.geometries.length;x++)e.geometries[x].localOrigin=b.origin;const w=new vwe({data:f,size:3},p,_,b);await this._updatingHandles.addPromise(this._addPositionData(i,w,p.length,r[0],n,s))}_acquireRenderer(e,i,r){const n=YW.getKey(e,i,r);let s=this._renderers.get(n);return R(this._strokesTexture)&&(this._strokesTexture=Pkt(this.rctx)),s||(s=new YW(this.rctx,this.techniqueRepository,{type:e,hasSlicePlane:i,strokesTexture:this._strokesTexture,legacy:r,spherical:this.viewingMode===qe.Global}),this._renderers.set(n,s)),++s.refCount,s}_removeRenderable(e){mwe(e.regular),mwe(e.silhouette);const i=this._renderers.get(e.rendererKey);if(i){i.removeRenderable(e),--i.refCount,"origin"in e.transform&&this._localOrigins.release(e.transform.origin),this._gpuMemoryUsage-=e.statistics.externalMemoryUsage?0:e.statistics.gpuMemoryUsage;for(const r of e.components.meta)e.components.buffer.releaseIndex(r.index)}}_updateObjectCameraDistances(e){const i=e.camera.eye,r=e.camera.viewForward,n=P(),s=o=>{Fo(n,o.center,i);const a=be(n,r),l=o.radius,c=a<-l?1/0:a<l?0:a-l;o.renderables.forEach(h=>h.distanceToCamera=c)};this._perObjectData.forEach(s),this._perObjectDataEvictionCache.forEach(s)}_renderRegularEdges(e,i,r){const n=e.bindRegularEdges(r,i),s=r.transparency,o=i.camera.perScreenPixelRatio;e.forEachRenderable(a=>{if(!ywe(a)||!a.visible)return;const l=Lk(a.regular.lod.lengths,a.distanceToCamera,o);e.renderRegularEdges(n,a,r,i,l)},s)}_renderSilhouetteEdges(e,i,r){const n=e.bindSilhouetteEdges(r,i),s=r.transparency,o=i.camera.perScreenPixelRatio;e.forEachRenderable(a=>{if(!_we(a)||!a.visible)return;const l=Lk(a.silhouette.lod.lengths,a.distanceToCamera,o);e.renderSilhouetteEdges(n,a,r,i,l)},s)}get test(){return{hasRenderedPrimitives:e=>{let i=!1;const r=e.perScreenPixelRatio,n=(s,o)=>s.forEachRenderable(a=>{a.visible&&!i&&(ywe(a)&&(i=Lk(a.regular.lod.lengths,a.distanceToCamera,r)>0),!i&&_we(a)&&(i=Lk(a.silhouette.lod.lengths,a.distanceToCamera,r)>0))},o);return this._renderers.forEach(s=>{i||(n(s,ci.OPAQUE),n(s,ci.TRANSPARENT))}),i}}}};function mwe(t){v(t)&&(t.vao.vertexBuffers.instances.dispose(),t.vao.dispose(!1),t.vao=null)}function Dkt(t){let e=null,i=null;for(let r=0;r<t.geometries.length;r++){const n=t.geometries[r];if(n.material.supportsEdges){if(e){if(!x_(e,n.transformation))return!1}else e=n.transformation;if(!i&&v(n.localOrigin))i=n;else if(i&&v(i.localOrigin)&&v(n.localOrigin)&&i.localOrigin.id!==n.localOrigin.id)return!1}}return!0}u([d({constructOnly:!0})],Af.prototype,"rctx",void 0),u([d({constructOnly:!0})],Af.prototype,"renderSR",void 0),u([d({constructOnly:!0})],Af.prototype,"viewingMode",void 0),u([d({constructOnly:!0})],Af.prototype,"techniqueRepository",void 0),u([d({constructOnly:!0})],Af.prototype,"setNeedsRender",void 0),u([d({constructOnly:!0})],Af.prototype,"schedule",void 0),u([d({readOnly:!0})],Af.prototype,"_updatingHandles",void 0),u([d({readOnly:!0})],Af.prototype,"updating",null),Af=u([$("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],Af);let gwe=class{constructor(e,i,r){this.center=i,this.radius=r,this.renderables=new Array,this.loaded=e,this.loaded.then(()=>{this.loaded!=null&&(this.loaded=!0)})}},Nkt=class{constructor(e,i){this.buffer=e,this.meta=i}},Fkt=class{constructor(e,i){this.vao=e,this.lod=i}},kkt=class{constructor(e,i){this.modelMatrix=e,this.origin=i}},Ukt=class{constructor(e,i,r,n,s,o,a,l){this.regular=e,this.silhouette=i,this.statistics=r,this.transform=n,this.edgeTransparency=s,this.objectTransparency=o,this.components=a,this.rendererKey=l,this.distanceToCamera=0,this.visible=!0}};function ywe(t){return v(t.regular)}function _we(t){return v(t.silhouette)}function Lk(t,e,i){const r=e*i,n=r7e(t,r,!0);return n===-1?r<t[0]?t.length:0:t.length-n}let vwe=class{constructor(e,i,r,n){this.position=e,this.indices=i,this.modelTransform=r,this.origin=n}};const bwe=wr();function Oy(t){return window.WebGL2RenderingContext&&t instanceof window.WebGL2RenderingContext}let wwe=class{constructor(e,i,r,n,s,o,a,l,c){this.createQuery=e,this.deleteQuery=i,this.resultAvailable=r,this.getResult=n,this.disjoint=s,this.beginTimeElapsed=o,this.endTimeElapsed=a,this.createTimestamp=l,this.timestampBits=c}},R0=!1;function Vkt(t,e){if(e.disjointTimerQuery)return null;let i=t.getExtension("EXT_disjoint_timer_query_webgl2");return i&&Oy(t)?new wwe(()=>t.createQuery(),r=>{t.deleteQuery(r),R0=!1},r=>t.getQueryParameter(r,t.QUERY_RESULT_AVAILABLE),r=>t.getQueryParameter(r,t.QUERY_RESULT),()=>t.getParameter(i.GPU_DISJOINT_EXT),r=>{R0||(R0=!0,t.beginQuery(i.TIME_ELAPSED_EXT,r))},()=>{t.endQuery(i.TIME_ELAPSED_EXT),R0=!1},r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>t.getQuery(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):(i=t.getExtension("EXT_disjoint_timer_query"),i?new wwe(()=>i.createQueryEXT(),r=>{i.deleteQueryEXT(r),R0=!1},r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_AVAILABLE_EXT),r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_EXT),()=>t.getParameter(i.GPU_DISJOINT_EXT),r=>{R0||(R0=!0,i.beginQueryEXT(i.TIME_ELAPSED_EXT,r))},()=>{i.endQueryEXT(i.TIME_ELAPSED_EXT),R0=!1},r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>i.getQueryEXT(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):null)}function zkt(t,e){const i=t.capabilities.disjointTimerQuery;return R(i)?null:new Bkt(i,e)}let Bkt=class{constructor(e,i){this._timer=e,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,i.forEach(r=>{const n=this._timer.createQuery(),s=this._timer.createQuery();this._queryPool.push(n,s),this._queryResults.set(r,null)})}start(){R0||(this._currentQuery=this._queryPool.pop(),R(this._currentQuery)||(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(e){if(this._timer.disjoint()||R(this._currentQuery)||!this._queryResults.has(e))return this.abort(),null;this._timer.endTimeElapsed();const i=this._queryResults.get(e);if(R(i))return this._queryResults.set(e,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(i))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;const r=this._timer.getResult(i)/1e6;return this._queryPool.unshift(i),this._queryResults.set(e,this._currentQuery),this._currentQuery=null,r}abort(){v(this._currentQuery)&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){v(this._currentQuery)&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach(e=>{this._timer.deleteQuery(e)}),this._queryResults.forEach(e=>{R(e)||this._timer.deleteQuery(e)})}};var zr;(function(t){t.OVERLAY="overlay",t.PREPARE="prepare",t.SHADOW_MAP="shadow map",t.LINEAR_DEPTH="linear depth",t.ACCUMULATED_SHADOWS="accumulated shadows",t.NORMALS="normals",t.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",t.SSAO="SSAO",t.OPAQUE="opaque",t.OPAQUE_EDGES="opaque edges",t.VOXEL="voxel",t.TRANSPARENT="transparent",t.TRANSPARENT_EDGES="transparent edges",t.HUD_VISIBILITY="HUD visibility",t.TRANSPARENT_TERRAIN="transparent terrain",t.ENVIRONMENT="environment",t.LASER_LINE="laser line",t.OCCLUDED="occluded",t.ANTIALIASING="antialiasing",t.HIGHLIGHTS="highlights",t.HUD="HUD",t.HUD_OCCLUDED="HUD occluded",t.FINISH="finish"})(zr||(zr={}));const xwe="Total";let jkt=class{constructor(e){this._rctx=e,this._startTimeStampCPU=0,this._lastTimeStampCPU=0,this._totalCPUTime=new X0(xwe),this._cpuTimeSamplers=new Map(Object.values(zr).map(i=>[i,new X0(i)])),this._enableGPUTimer=0,this._totalGPUTime=new X0("GPU"),this._gpuTimeSamplers=new Map(Object.values(zr).map(i=>[i,new X0(i)])),this._totalTime=0,this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return v(this._gpuTimerPool)}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return performance.now()-this._startTimeStampCPU}enableGPUPerformanceInfo(){if(R(this._gpuTimerPool)){const e=[...Object.values(zr),xwe];this._gpuTimerPool=zkt(this._rctx,e)}return R(this._gpuTimerPool)?{hasGPUTimerSupport:!1,remove:()=>{}}:(++this._enableGPUTimer,{hasGPUTimerSupport:!0,remove:Xre(()=>{--this._enableGPUTimer,this._enableGPUTimer===0&&(this._gpuTimerPool=rt(this._gpuTimerPool))})})}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=performance.now(),v(this._gpuTimerPool)&&this._gpuTimerPool.start()}advance(e){const i=performance.now();if(this._cpuTimeSamplers.get(e).record(i-this._lastTimeStampCPU),this._lastTimeStampCPU=i,v(this._gpuTimerPool)){const r=this._gpuTimerPool.stop(e);this._gpuTimeSamplers.get(e).record(r),this._gpuTimerPool.start()}}finishFrame(){if(v(this._gpuTimerPool)){const i=this._gpuTimerPool.stop(zr.FINISH);this._gpuTimeSamplers.get(zr.FINISH).record(i)}const e=performance.now()-this._startTimeStampCPU;this._totalTime=this._totalTime+e,this._totalCPUTime.record(e),v(this._gpuTimerPool)&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce((i,r)=>i+(r.last||0),0)),++this._totalFrameCount}},Ch=class extends ve{get _bindParameters(){return this._renderContext.bindParameters}isFeatureEnabled(e,i=this._state){return Nt(this._renderStateFeatures.get(i,e),!1)}setFeatureEnabled(e,i,r){this._renderStateFeatures.set(i,e,r),this.notifyChange("_renderStateFeatures"),this._requestRender()}get _antialiasing(){return this._antialiasingEnabled||this.isFeatureEnabled(ls.Antialiasing)}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(ls.HighQualityTransparency)}get hasWaterReflection(){return this.hasWater&&(this._waterReflectionEnabled||this.isFeatureEnabled(ls.WaterReflection))}get hasWater(){return this._hasWater||this._hasOverlayWater}constructor(e,i,r,n,s,o,a,l){super({}),this._stage=e,this._materialRepository=i,this._shaderTechniqueRepository=n,this._rctx=s,this._compositingHelper=o,this._magnifierHelper=a,this._requestRender=l,this._materialRenderers=new Wt,this._needsTransparentPass=!1,this._hasHUDElements=!1,this._hasHighlights=!1,this._hasWater=!1,this._hasOverlayWater=!1,this._renderOverlay=c=>{},this._isRendering=!1,this._fallbackDepthStencilTexture=null,this._sliceHelper=new Z5t,this._state=Pi.IDLE,this._renderStateFeatures=p0e(),this._antialiasingEnabled=!0,this._highQualityTransparencyEnabled=!0,this._terrainRenderingEnabled=!0,this._terrainTransparency=ao.Opaque,this._waterReflectionEnabled=!1,this._ssaoEnabled=!1,this._hasAnimations=!1,this._animationTimestep=new o5t,this._handles=new Xi,this._renderHiddenTransparentEdges=()=>{},this._oitUsed=!1,this._smaaPass=new t$(this._rctx,n),l(),this._offscreen=new C5t(this._rctx,this._compositingHelper),this.performanceInfo=new jkt(this._rctx),this._shadowMap=new ace(this._rctx,e.viewingMode),this._ssaoHelper=new Cke(e.view,n,this._rctx,l),this._highlight=new x5t(n,this._rctx),this._shadowHighlight=new Y5t(this._rctx,e.viewingMode),this._shadowAccumulator=new Mc(this._rctx,n,e,c=>{const h=this.shadowsEnabled;this._shadowMap.enabled=!0,this._prepare(c.camera,c.contentCamera),this._renderPlugins.prepareRender(),this._shadowMap.enabled=h},(c,h,p)=>{c.shadowMap.start(c.camera,h,p),this._renderShadowCascades(z.Shadow,c.shadowMap),c.camera.setGLViewport(this._rctx),this._prepare(c.camera,c.contentCamera)},l),this._renderContext=new xAt(this._rctx,this._offscreen,this._shadowMap,this._ssaoHelper,this._sliceHelper),this._renderPlugins=new M5t({renderContext:this._renderContext,techniqueRepository:n,textureRepository:r,materialRepository:this._materialRepository,requestRender:l,controller:e}),this.renderPassManager=new s5t(this._rctx,this._shaderTechniqueRepository),this._renderPlugins.add(this.renderPassManager.slots(),this.renderPassManager),this._handles.add([ne(()=>this._stage.view.state.camera,()=>l(),Jr),ne(()=>tr.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,c=>{this._renderHiddenTransparentEdges=c?()=>this._renderEdges(ci.TRANSPARENT):()=>{},l()},zt),ne(()=>this._ssaoEnabled||this.isFeatureEnabled(ls.SSAO),c=>this._ssaoHelper.enabled=c,Jr)])}normalizeCtorArgs(){return{}}destroy(){this._handles.destroy(),this._smaaPass.dispose(),this._gpuTimerHandle=Nr(this._gpuTimerHandle),this._materialRenderers.forAll(e=>e.dispose()),this._materialRenderers.clear(),this._offscreen.dispose(),this._fallbackDepthStencilTexture=rt(this._fallbackDepthStencilTexture),this._shadowMap.dispose(),this._ssaoHelper.dispose(),this._highlight.dispose(),this._shadowHighlight.dispose(),this._shadowAccumulator.dispose(),MNe.prune()}disposeOffscreenBuffers(){this._offscreen.dispose(),this._shadowMap.disposeOffscreenBuffers(),this._smaaPass.disable(),this._ssaoHelper.disposeOffscreenBuffers()}get updating(){return this._antialiasing&&this._smaaPass.updating||v(this._edgeView)&&this._edgeView.updating||this._shadowAccumulator.running||!this.isCameraFinal}ensureEdgeView(){return R(this._edgeView)&&(this._edgeView=new Af({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniqueRepository:this._shaderTechniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:e=>this._stage.view.resourceController.immediate.schedule(e)}),this._handles.add(ne(()=>Vo(this._edgeView,e=>e.updating),()=>this._requestRender(),Ki)),this._requestRender()),this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return use(this._bindParameters.ssr.reprojectionMatrix,ld)}set _reprojectionMatrix(e){Fre(this._bindParameters.ssr.reprojectionMatrix,e)&&this.notifyChange("isCameraFinal")}get shadowsEnabled(){var e;return!!((e=this._shadowMap)!=null&&e.enabled)}setParameters(e){const{_shadowMap:i,_bindParameters:r}=this;if(e.screenSpaceReflectionsEnabled!==void 0&&r.ssr.enabled!==e.screenSpaceReflectionsEnabled&&(r.ssr.enabled=e.screenSpaceReflectionsEnabled,this._requestRender()),e.shadowMap!==void 0&&this._shadowMap.enabled!==e.shadowMap&&(this._shadowMap.enabled=e.shadowMap,this._requestRender()),e.shadowMapMaxCascades!==void 0&&i.maxCascades!==e.shadowMapMaxCascades&&(i.maxCascades=e.shadowMapMaxCascades,this._requestRender()),v(e.environment)){v(e.environment.weather)&&(this._bindParameters.weather=e.environment.weather,this._bindParameters.weatherVisible=!!e.weatherVisible),e.environment.lighting.ambientOcclusionEnabled!==void 0&&this._ssaoEnabled!==e.environment.lighting.ambientOcclusionEnabled&&(this._ssaoEnabled=e.environment.lighting.ambientOcclusionEnabled,this._requestRender()),e.environment.lighting.waterReflectionEnabled!==void 0&&this._waterReflectionEnabled!==e.environment.lighting.waterReflectionEnabled&&(this._waterReflectionEnabled=e.environment.lighting.waterReflectionEnabled,this._requestRender());const n=e.environment.lighting.type!=="virtual";r.enableFillLights!==n&&(r.enableFillLights=n,this._requestRender())}e.background&&this._offscreen.background!==e.background&&(this._offscreen.background=e.background,this._requestRender()),e.antialiasingEnabled!==void 0&&this._antialiasingEnabled!==e.antialiasingEnabled&&(this._antialiasingEnabled=e.antialiasingEnabled,this._requestRender()),e.highQualityTransparency!==void 0&&this._highQualityTransparencyEnabled!==e.highQualityTransparency&&(this._highQualityTransparencyEnabled=e.highQualityTransparency,this._requestRender()),e.defaultHighlightOptions!==void 0&&(this._highlight.setDefaultOptions(e.defaultHighlightOptions),this._shadowHighlight.setDefaultOptions(e.defaultHighlightOptions),this._requestRender()),e.overlays!==void 0&&this._bindParameters.overlays!==e.overlays&&(this._bindParameters.overlays=e.overlays,this._requestRender()),e.hasOverlayWater!==void 0&&this._hasOverlayWater!==e.hasOverlayWater&&(this._hasOverlayWater=e.hasOverlayWater,this._requestRender()),e.renderOverlay!==void 0&&this._renderOverlay!==e.renderOverlay&&(this._renderOverlay=e.renderOverlay,this._requestRender()),e.slicePlane!==void 0&&this._sliceHelper.plane!==e.slicePlane&&(this._sliceHelper.plane=e.slicePlane,this._requestRender()),e.terrainRenderingEnabled!==void 0&&this._terrainRenderingEnabled!==e.terrainRenderingEnabled&&(this._terrainRenderingEnabled=e.terrainRenderingEnabled,this._requestRender()),e.terrainTransparency!==void 0&&this._terrainTransparency!==e.terrainTransparency&&(this._terrainTransparency=e.terrainTransparency,this._requestRender()),e.shadowCastOptions!==void 0&&this._shadowAccumulator.setOptions(e.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&this._hasOITSupport}modify(e,i){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:r,removes:n,updates:s}=e;if(r.length===0&&n.length===0&&s.length===0)return;const o=ake(e);let a=!1;o.forEach((l,c)=>{if(i.done)return;let h=this._materialRenderers.find(p=>p.material===c);R(h)&&l.adds.length>0&&(h=new vke(this._rctx,this._materialRepository,c),this._materialRenderers.push(h)),h&&(h.modify(l),h.isEmpty&&(a=!0)),l.removes.forEach(p=>e.removes.removeUnordered(p)),l.adds.forEach(p=>e.adds.removeUnordered(p)),l.updates.forEach(p=>e.updates.removeUnordered(p)),i.madeProgress()}),a&&this._materialRenderers.filterInPlace(l=>!l.isEmpty||(l.dispose(),!1)),this._hasHighlights=this._materialRenderers.some(l=>l.hasHighlights),this._bindParameters.hasOccludees=this._materialRenderers.some(l=>l.hasOccludees),this._hasWater=this._materialRenderers.some(l=>l.hasWater),this._hasHUDElements=this._materialRenderers.some(l=>l.requiresSlot(Ee.LINE_CALLOUTS_HUD_DEPTH,z.Color)||l.requiresSlot(Ee.HUD_MATERIAL,z.Color)||l.requiresSlot(Ee.LABEL_MATERIAL,z.Color)),this._requestRender()}updateAnimation(e){const i=this._hasAnimations;return this._hasAnimations=!1,this._materialRenderers.forAll(r=>this._hasAnimations=r.updateAnimation(e)||this._hasAnimations),this._hasAnimations=this._renderPlugins.updateAnimation(e)||this._hasAnimations,this._hasAnimations!==i&&(this._gpuTimerHandle=i?Nr(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo()),this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}render(e,i,r,n,s){this._isRendering=!0,this.performanceInfo.startFrame();const{camera:o,contentCamera:a,mode:l}=r;this._state=l,this._renderOverlay(s),this.performanceInfo.advance(zr.OVERLAY),this._renderContext.time=s,this._bindParameters.transparencyPassType=At.NONE;const c=this._offscreen;c.setupRenderTarget(this.hasWaterReflection);const h=G_(this._sliceHelper.plane);n===w2.OFF&&(this._sliceHelper.plane=null),this._rctx.bindFramebuffer(e),o.setGLViewport(this._rctx),this._prepare(o,a),this._renderPlugins.prepareRender(),this.performanceInfo.advance(zr.PREPARE);const p=this._computeDepthRange(o);this._renderShadowMap(e,o,this._bindParameters.lighting.mainLight.direction,p),this.performanceInfo.advance(zr.SHADOW_MAP),c.initializeFrame(o),this._ensureBindParameters(o,a),this._renderLinearDepth(),this.performanceInfo.advance(zr.LINEAR_DEPTH),this._accumulateShadows(p,o,a),this.performanceInfo.advance(zr.ACCUMULATED_SHADOWS),this._renderNormal(),this.performanceInfo.advance(zr.NORMALS),this._ensureBindParametersSSR(s),this._renderSSAO(s),this.performanceInfo.advance(zr.SSAO),this._renderContext.output=z.Color,c.bindFramebuffer(),this._renderOpaqueGeometry(),this.performanceInfo.advance(zr.OPAQUE);const f=this._terrainRenderingEnabled&&(this._terrainTransparency===ao.Semitransparent||this._terrainTransparency===ao.TransparentWithDraped),m=this._highQualityTransparency&&f;this._renderTerrainLinearDepth(m),this._setMultipassEnabled(m),this._setTerrainCulling(m),this._renderEdges(ci.OPAQUE),this.performanceInfo.advance(zr.OPAQUE_EDGES),this._offscreen.bindTarget(this._offscreen.currentColorTarget,this._offscreen.mainDepth),this._renderSlot(Ee.VOXEL),this.performanceInfo.advance(zr.VOXEL),this._renderHiddenTransparentEdges();const g=this._needsTransparentPass||this._renderPlugins.needsTransparentPass;g&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(zr.TRANSPARENT),this._renderGeometryLinearDepth(m);const _=this._renderHUDVisibility(m);m||this._renderInternalSlot(Ee.LINE_CALLOUTS),this.performanceInfo.advance(zr.HUD_VISIBILITY),this._renderObjectAndLayerIdColor(i),this.performanceInfo.advance(zr.OBJECT_AND_LAYER_ID_COLOR),this._renderEdges(ci.TRANSPARENT,m),this.performanceInfo.advance(zr.TRANSPARENT_EDGES),this._renderTransparentTerrain(),f&&_&&(m?this._renderLineCallouts($h.Occluded):c.compositeTransparentTerrainOntoHUDVisibility(this._bindParameters),this._renderHUD($h.Occluded,c.framebuffer),this.performanceInfo.advance(zr.HUD_OCCLUDED)),this.performanceInfo.advance(zr.TRANSPARENT_TERRAIN),this._setTerrainCulling(!1),f&&(c.compositeTransparentTerrainOntoMain(this._bindParameters),m&&(this._renderEdges(ci.OPAQUE),this.performanceInfo.advance(zr.OPAQUE_EDGES),g&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(zr.TRANSPARENT),this._renderEdges(ci.TRANSPARENT),this.performanceInfo.advance(zr.TRANSPARENT_EDGES))),m&&this._renderLineCallouts($h.NotOccluded),this._setMultipassEnabled(!1),this._shadowAccumulator.render(this._bindParameters),c.renderToTargets(()=>{this._renderInternalSlot(Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderSlot(Ee.POSTPROCESSING_ENVIRONMENT_TRANSPARENT),this._renderSlot(Ee.LASERLINES)},c.currentColorTarget,c.mainDepth),this.performanceInfo.advance(zr.ENVIRONMENT),this._renderPlugins.needsLaserlineWithContrastControl&&c.renderTmpAndCompositeToMain(()=>this._renderSlot(Ee.LASERLINES_CONTRAST_CONTROL),this._bindParameters,ul.PremultipliedAlpha),this.performanceInfo.advance(zr.LASER_LINE),this._renderOccluded(),this.performanceInfo.advance(zr.OCCLUDED);const b=n===w2.ON&&this._magnifierHelper.enabled,w=b&&R(e)?this._offscreen.getFramebuffer(this._offscreen.tmpColor,this._offscreen.tmpDepth):e;this._rctx.bindFramebuffer(w);const x=this._offscreen.colorTexture;!this._renderAntiAliasing(x)&&v(x)&&this._compositingHelper.composite(this._bindParameters,x,ul.None),this.performanceInfo.advance(zr.ANTIALIASING),this._renderHUD($h.NotOccluded,w),this.performanceInfo.advance(zr.HUD),this._renderHighlights(w,this._bindParameters),this.performanceInfo.advance(zr.HIGHLIGHTS),b&&this._magnifierHelper.render(this._rctx,this._bindParameters),w!==e&&(this._rctx.bindFramebuffer(e),this._compositingHelper.composite(this._bindParameters,this._offscreen.tmpColorTexture,ul.None)),this._disposeOITBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=h,this._isRendering=!1,this.onPostRender&&this.onPostRender(),this.performanceInfo.finishFrame()}_renderObjectAndLayerIdColor(e){if(v(e)&&ue("enable-feature:objectAndLayerId-rendering")){const i=this._renderContext.output;this._rctx.bindFramebuffer(e),this._offscreen.renderToFBO(()=>this._renderGeometryAndTransparentTerrainPass(z.ObjectAndLayerIdColor),[0,0,0,0],!0,!0),this._rctx.bindFramebuffer(e),this._offscreen.renderToFBO(()=>{this._bindParameters.renderTransparentlyOccludedHUD=$h.NotOccluded,this._renderInternalSlot(Ee.HUD_MATERIAL)},void 0,!0,!0),this._renderContext.output=i}}finish(e){this._hasAnimations||this._animationTimestep.clear();const i=this.performanceInfo.gpuSamplingEnabled,r=e===Wn.BACKGROUND;if(r||i){const n=r?this.performanceInfo.elapsedTime:0,s=i?this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError(),o=Math.max(n,s);this._animationTimestep.frame(o,r)}}readDepthPixels(e,i,r){const n=this._offscreen.bindTarget(this._offscreen.linearDepth,this._offscreen.tmpDepth);if(!this._needsLinearDepth){this._ensureBindParameters(e,e),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const s=Yr.COLOR_BUFFER_BIT|Yr.DEPTH_BUFFER_BIT|Yr.STENCIL_BUFFER_BIT;this._rctx.clearSafe(s),this._renderGeometryAndTransparentTerrainPass(z.Depth)}n.readPixels(i[0],i[1],i[2],i[3],Ge.RGBA,kt.UNSIGNED_BYTE,r)}readHUDVisibility(e,i,r,n,s){this._offscreen.bindTarget(this._offscreen.hudVisibility).readPixels(e,i,r,n,Ge.RGBA,kt.UNSIGNED_BYTE,s)}readAccumulatedShadow(e){return this._shadowAccumulator.readAccumulatedShadow(e[0],e[1])}_setMultipassEnabled(e){this._bindParameters.multipassTerrain.enabled=this._bindParameters.multipassGeometry.enabled=e}_setTerrainCulling(e){this._bindParameters.multipassTerrain.cullAboveGround=e}_renderSlot(e){this._bindParameters.slot=e,this._renderPlugins.render()}_renderEdges(e,i=!1){const r=this._edgeView;v(r)&&r.shouldRender()&&this._offscreen.renderTmpAndCompositeToMain(()=>r.render(this._bindParameters,e),this._bindParameters,ul.Alpha,i)}_renderShadowMap(e,i,r,n){const s=this._shadowMap;s.enabled&&this.isFeatureEnabled(ls.ShadowMapUpdate)&&(s.start(i,r,n),this._shadowHighlight.updateParameters(i,r),this._needsShadowHighlight?(this._renderShadowCascades(z.ShadowHighlight,this._shadowMap,o=>s.takeCascadeSnapshotTo(o,rO.Highlight)),s.clear(),this._renderShadowCascades(z.ShadowExcludeHighlight,this._shadowMap,o=>{s.takeCascadeSnapshotTo(o,rO.Default),this._renderGeometryAndTransparentTerrainPass(z.ShadowHighlight)})):this._renderShadowCascades(z.Shadow),s.finish(e),i.setGLViewport(this._rctx))}_renderShadowCascades(e,i=this._shadowMap,r=n=>{}){for(const n of i.cascades)n.camera.setGLViewport(this._rctx),this._prepare(n.camera,n.camera),this._renderGeometryAndTransparentTerrainPass(e),r(n)}get _needsLinearDepth(){return this._ssaoHelper.active||this._renderPlugins.needsLinearDepth||this.hasWaterReflection||this._needsShadowHighlight||this._needsShadowCast}_renderLinearDepth(){this._needsLinearDepth?this._offscreen.renderToTargets(()=>this._renderGeometryAndTransparentTerrainPass(z.Depth),this._offscreen.linearDepth,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.linearDepth),this._bindParameters.linearDepthTexture=this._offscreen.linearDepthTexture}_renderTerrainLinearDepth(e){if(e){const i=this._renderContext.output;this._renderContext.output=z.Depth,this._offscreen.renderToTargets(()=>this._renderTransparentTerrain(),this._offscreen.terrainLinearDepth,this._offscreen.tmpDepth,[-1e10,-1e10,-1e10,1],!0,!0),this._renderContext.output=i}else this._offscreen.disposeTarget(this._offscreen.terrainLinearDepth);this._bindParameters.multipassTerrain.linearDepthTexture=this._offscreen.terrainLinearDepthTexture}_renderGeometryLinearDepth(e){if(e){const i=this._renderContext.output;this._offscreen.renderToTargets(()=>this._renderGeometryPass(z.Depth),this._offscreen.geometryLinearDepth,this._offscreen.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.output=i}else this._offscreen.disposeTarget(this._offscreen.geometryLinearDepth);this._bindParameters.multipassGeometry.linearDepthTexture=this._offscreen.geometryLinearDepthTexture}get _needsNormal(){return this._ssaoHelper.active}_renderNormal(){this._needsNormal?this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(z.Normal)},this._offscreen.normal,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.normal)}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowCast}_computeDepthRange(e){if(!this._needsDepthRange)return die;const i=B4t(e,this._materialRenderers,this._stage.layers);return aO(i,this.renderPlugins.queryDepthRange(e)),i.near=Math.max(e.near,i.near),i.far=Math.min(e.far,i.far),i}_renderGeometryAndTransparentTerrainPass(e){this._renderContext.output=e,this._renderGeometryPass(e),this._renderTransparentTerrain()}_renderGeometryPass(e){this._renderContext.output=e,this._renderOpaqueGeometry(),this._renderTransparentGeometry()}_renderSSAO(e){this._ssaoHelper.render(this._bindParameters,e,this._offscreen.linearDepthTexture,this._offscreen.normalTexture)}_renderOpaqueGeometry(){this._renderSlot(Ee.INTEGRATED_MESH),this._renderSlot(Ee.OPAQUE_TERRAIN),this._renderInternalSlot(Ee.OPAQUE_MATERIAL),this._renderSlot(Ee.OPAQUE_MATERIAL),this._renderSlot(Ee.POSTPROCESSING_ENVIRONMENT_OPAQUE)}_renderTransparentGeometry(){this._renderInternalSlot(Ee.TRANSPARENT_MATERIAL),this._renderSlot(Ee.TRANSPARENT_MATERIAL)}_renderTransparentTerrain(){this._renderSlot(Ee.TRANSPARENT_TERRAIN)}_renderHUDVisibility(e){let i=!1;return this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper.hudVisibilityTexture,i=this._renderInternalSlot(Ee.OCCLUSION_PIXELS)},e),i}_renderLineCallouts(e){this._bindParameters.renderTransparentlyOccludedHUD=e,e===$h.Occluded?this._offscreen.renderToTargets(()=>this._renderInternalSlot(Ee.LINE_CALLOUTS),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderInternalSlot(Ee.LINE_CALLOUTS)}_renderHUD(e,i){this._hasHUDElements&&(this._oitEnabled?(this._renderOrderIndependentTransparency(()=>this._renderHUDElements(e),!0),this._rctx.bindFramebuffer(i),this._compositingHelper.composite(this._bindParameters,this._offscreen.hudColorTexture,ul.PremultipliedAlpha)):e===$h.Occluded?this._offscreen.renderToTargets(()=>this._renderHUDElements($h.Occluded),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderHUDElements(e))}_renderHUDElements(e){this._bindParameters.renderTransparentlyOccludedHUD=e,this._renderInternalSlot(Ee.LINE_CALLOUTS_HUD_DEPTH),this._renderInternalSlot(Ee.HUD_MATERIAL),this._renderInternalSlot(Ee.LABEL_MATERIAL)}get _needsHighlight(){return this._hasHighlights||this._renderPlugins.needsHighlight}get _needsShadowHighlight(){return this._shadowMap.enabled&&this._shadowHighlight.isVisible&&this._needsHighlight}_renderHighlights(e,i){if(!this._needsHighlight)return void this._offscreen.disposeTarget(this._offscreen.highlight);const r=this._highlight,n=this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(z.Highlight),this._rctx.clearSafe(Yr.DEPTH_BUFFER_BIT),this._renderHUDElements($h.Both)},this._offscreen.highlight,this._offscreen.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=n.colorTexture,this._needsShadowHighlight&&this._shadowHighlight.render(i,e),r.render(this._bindParameters,n,e)}get _needsShadowCast(){return this._shadowAccumulator.isAccumulating}_accumulateShadows(e,i,r){this._needsShadowCast&&v(this._offscreen.linearDepthTexture)&&this._shadowAccumulator.renderAccumulation(this._offscreen.linearDepthTexture,e,i,r)}_renderOrderIndependentTransparency(e,i){const r=s=>{this._bindParameters.transparencyPassType=s,this._offscreen.renderOITPass(()=>e(),s,i)},n=this._renderContext.output;this._renderContext.output=z.Alpha,r(At.Alpha),this._renderContext.output=z.Color,r(At.Color),r(At.FrontFace),this._offscreen.compositeTransparentOntoOpaque(this._bindParameters,i),this._bindParameters.transparencyPassType=At.NONE,this._renderContext.output=n,this._oitUsed=!0}_disposeOITBuffers(){this._oitUsed||(this._offscreen.disposeTarget(this._offscreen.alphaFloatTarget),this._offscreen.disposeTarget(this._offscreen.colorFloatTarget),this._offscreen.disposeTarget(this._offscreen.frontFaceTarget)),this._oitUsed=!1}_renderOccluded(){let e=0;sf.clear(),this._materialRenderers.forAll(o=>{o.material&&o.material.isVisible()&&o.material.renderOccluded===xn.OccludeAndTransparentStencil&&(e|=o.material.renderOccluded,sf.push(o))});const i=this._offscreen,r=(o,a,l,c,h)=>{e&a&&(i.renderToTargets(l,i.tmpColor,i.mainDepth,[0,0,0,0],c,h),i.compositeOccludedOntoMain(this._bindParameters,o))};sf.length!==0&&(this._renderInternalSlot(Ee.OCCLUDER_MATERIAL,sf),r(.5,xn.OccludeAndTransparentStencil,()=>this._renderInternalSlot(Ee.TRANSPARENT_OCCLUDER_MATERIAL,sf),!1,!1)),sf.clear(),this._materialRenderers.forAll(o=>{o.material&&o.material.isVisible()&&(o.material.renderOccluded===xn.OccludeAndTransparent||o.material.renderOccluded===xn.Transparent||o.material.renderOccluded===xn.Opaque)&&(e|=o.material.renderOccluded,sf.push(o))});const n=this._renderPlugins.renderOccludedFlags;if(e|=n,!e)return;const s=o=>{this._renderContext.renderOccludedMask=o,n>xn.Occlude&&this._renderSlot(Ee.OCCLUDED_TERRAIN),this._renderInternalSlot(Ee.OPAQUE_MATERIAL,sf),this._renderInternalSlot(Ee.TRANSPARENT_MATERIAL,sf),this._renderInternalSlot(Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,sf),this._renderContext.resetRenderOccludedMask()};this._renderContext.output=z.Color,r(.5,xn.OccludeAndTransparent,()=>s(xn.OccludeAndTransparent),!0,Wc.OutlineVisualElementMask),r(.5,xn.Transparent,()=>s(xn.Transparent),!0,Wc.OutlineVisualElementMask),r(1,xn.Opaque,()=>s(xn.Opaque),!0,Wc.OutlineVisualElementMask),sf.clear()}_renderAntiAliasing(e){if(this._antialiasing){if(this._smaaPass.enable(()=>this._requestRender())&&v(e))return this._smaaPass.render(e),!0}else this._smaaPass.disable();return!1}_prepare(e,i){this._needsTransparentPass=this._materialRenderers.some(r=>r.requiresSlot(Ee.TRANSPARENT_MATERIAL,z.Color)),this._bindParameters.camera=e,this._bindParameters.contentCamera=i}_ensureBindParameters(e,i){this._bindParameters.camera=e,this._bindParameters.contentCamera=i;const r=this._renderContext.offscreenRenderingHelper;this._bindParameters.hudVisibilityTexture=r.hudVisibilityTexture,this._bindParameters.mainColorTexture=r.mainColorTexture,this._bindParameters.highlightDepthTexture=r.depthTexture??this._getFallbackDepthTexture()}_ensureBindParametersSSR(e){if(this._bindParameters.ssr.enabled=this.hasWaterReflection,this._bindParameters.ssr.enabled){R(this._waterReflectionEnableTime)&&(this._waterReflectionEnableTime=e),this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=ld:(wa(Swe,this._bindParameters.camera.viewMatrix),wa(Twe,this._bindParameters.camera.projectionMatrix),$n(vC,Swe,Twe),$n(vC,this._renderContext.lastFrameCamera.viewMatrix,vC),$n(vC,this._renderContext.lastFrameCamera.projectionMatrix,vC),this._reprojectionMatrix=vC),this._bindParameters.ssr.lastFrameColorTexture=this._offscreen.lastFrameColorTexture;const i=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=i>0?Math.min(i,e-this._waterReflectionEnableTime)/i:1,this._bindParameters.ssr.fadeFactor<1&&this._requestRender()}else this._bindParameters.ssr.lastFrameColorTexture=null,this._waterReflectionEnableTime=null}_renderInternalSlot(e,i=this._materialRenderers){let r=!1;return this._bindParameters.slot=e,i.forAll(n=>{n.material.shouldRender(this._renderContext)&&n.render(this._renderContext.output,this._bindParameters)&&(r=!0)}),r}_getFallbackDepthTexture(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=MDe(this._rctx)),this._fallbackDepthStencilTexture}get gpuMemoryUsage(){var e,i,r,n,s;return{offscreen:((e=this._offscreen)==null?void 0:e.gpuMemoryUsage)??0,highlights:(((i=this._highlight)==null?void 0:i.gpuMemoryUsage)??0)+(((r=this._shadowHighlight)==null?void 0:r.gpuMemoryUsage)??0),shadows:((n=this._shadowMap)==null?void 0:n.gpuMemoryUsage)??0,ssao:((s=this._ssaoHelper)==null?void 0:s.gpuMemoryUsage)??0}}get test(){const e=this;return{offscreen:this._offscreen,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,weatherIsFading:this._bindParameters.cloudsFade.isFading,resetRenderStateFeatures:()=>{e._renderStateFeatures=p0e()},getFramebufferTexture:i=>{switch(i){case W1.Color:return e._offscreen.colorTexture;case W1.LinearDepth:return e._offscreen.linearDepthTexture;case W1.Normals:return e._offscreen.normalTexture;case W1.ShadowMap:return e._shadowMap.depthTexture;case W1.HudVisibility:return e._offscreen.hudVisibilityTexture;case W1.Highlight:return e._offscreen.highlightTexture}}}}};var W1;u([d()],Ch.prototype,"_shadowAccumulator",void 0),u([d()],Ch.prototype,"_state",void 0),u([d()],Ch.prototype,"_renderStateFeatures",void 0),u([d()],Ch.prototype,"_antialiasingEnabled",void 0),u([d({readOnly:!0})],Ch.prototype,"_antialiasing",null),u([d()],Ch.prototype,"_ssaoEnabled",void 0),u([d()],Ch.prototype,"_smaaPass",void 0),u([d({autoDestroy:!0})],Ch.prototype,"_edgeView",void 0),u([d()],Ch.prototype,"updating",null),u([d()],Ch.prototype,"isCameraFinal",null),Ch=u([$("esri.views.3d.webgl-engine.lib.Renderer")],Ch),function(t){t[t.Color=0]="Color",t[t.LinearDepth=1]="LinearDepth",t[t.Normals=2]="Normals",t[t.ShadowMap=3]="ShadowMap",t[t.HudVisibility=4]="HudVisibility",t[t.Highlight=5]="Highlight"}(W1||(W1={}));const sf=new Wt,Twe=$e(),Swe=$e(),vC=$e();let Ewe=class{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:Ce.ONE,dstRGB:Ce.ZERO,srcAlpha:Ce.ONE,dstAlpha:Ce.ZERO},this.blendEquation={mode:yy.ADD,modeAlpha:yy.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=em.BACK,this.frontFace=WM.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=Gr.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:em.FRONT_AND_BACK,func:Gr.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:em.FRONT_AND_BACK,fail:Qn.KEEP,zFail:Qn.KEEP,zPass:Qn.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.uniformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}},Gkt=class{constructor(e){this._allocations=new Map,e?Error.stackTraceLimit=1/0:(this.add=()=>{},this.remove=()=>{})}add(e){this._allocations.set(e,new Error().stack)}remove(e){this._allocations.delete(e)}get information(){let e="";if(this._allocations.size>0){e+=`${this._allocations.size} live object allocations:
`;const i=new Map;this._allocations.forEach(r=>{i.set(r,(i.get(r)??0)+1)}),i.forEach((r,n)=>{const s=n.split(`
`);s.shift(),s.shift(),e+=`${r}: ${s.shift()}
`,s.forEach(o=>e+=`   ${o}
`)})}return e}};const Hkt={RECORD_ALLOCATIONS:!1};let qkt=class{constructor(){for(this._current=new Array,this._max=new Array,this._allocations=new Gkt(Hkt.RECORD_ALLOCATIONS);this._current.length<mo.COUNT;)this._current.push(0),this._max.push(0)}resetMax(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)}increment(e,i){const r=++this._current[e];this._max[e]=Math.max(r,this._max[e]),this._allocations.add(i)}decrement(e,i){--this._current[e],this._allocations.remove(i)}get max(){return this._max}get current(){return this._current}get total(){return this.current.reduce((e,i)=>e+i,0)}get resourceInformation(){let e="";if(this.total>0){e+=`Live objects:
`;for(let i=0;i<mo.COUNT;++i){const r=this._current[i];r>0&&(e+=`${mo[i]}: ${r}
`)}}return e+=this._allocations.information,e}};const Wkt=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var Cwe,wie={},Xkt={get exports(){return wie},set exports(t){wie=t}};(Cwe=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(Xkt.exports=Cwe);const Ykt=wie;var Awe,xie={},Zkt={get exports(){return xie},set exports(t){xie=t}};Awe=Zkt,function(t){var e=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];e!==void 0&&(Awe.exports=e)}();const Rwe=xie;var Tie={},Jkt={get exports(){return Tie},set exports(t){Tie=t}};(function(t){(function(e){var i=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"]}();i!==void 0&&(t.exports=i)})()})(Jkt);const Kkt=Tie;var of=999,Mwe=9999,JW=0,KW=1,Owe=2,Pwe=3,Iwe=4,Dk=5,Qkt=6,e6t=7,t6t=8,$we=9,i6t=10,Lwe=11,r6t=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function n6t(){var t,e,i,r=0,n=0,s=of,o=[],a=[],l=1,c=0,h=0,p=!1,f=!1,m="";return function(B){return a=[],B!==null?_(B.replace?B.replace(/\r\n/g,`
`):B):b()};function g(B){B.length&&a.push({type:r6t[s],data:B,position:h,line:l,column:c})}function _(B){var ee;for(r=0,i=(m+=B).length;t=m[r],r<i;){switch(ee=r,s){case JW:r=C();break;case KW:r=E();break;case Owe:r=T();break;case Pwe:r=A();break;case Iwe:r=D();break;case Lwe:r=O();break;case Dk:r=U();break;case Mwe:r=V();break;case $we:r=x();break;case of:r=w()}ee!==r&&(m[ee]===`
`?(c=0,++l):++c)}return n+=r,m=m.slice(r),a}function b(B){return o.length&&g(o.join("")),s=i6t,g("(eof)"),a}function w(){return o=o.length?[]:o,e==="/"&&t==="*"?(h=n+r-1,s=JW,e=t,r+1):e==="/"&&t==="/"?(h=n+r-1,s=KW,e=t,r+1):t==="#"?(s=Owe,h=n+r,r):/\s/.test(t)?(s=$we,h=n+r,r):(p=/\d/.test(t),f=/[^\w_]/.test(t),h=n+r,s=p?Iwe:f?Pwe:Mwe,r)}function x(){return/[^\s]/g.test(t)?(g(o.join("")),s=of,r):(o.push(t),e=t,r+1)}function T(){return t!=="\r"&&t!==`
`||e==="\\"?(o.push(t),e=t,r+1):(g(o.join("")),s=of,r)}function E(){return T()}function C(){return t==="/"&&e==="*"?(o.push(t),g(o.join("")),s=of,r+1):(o.push(t),e=t,r+1)}function A(){if(e==="."&&/\d/.test(t))return s=Dk,r;if(e==="/"&&t==="*")return s=JW,r;if(e==="/"&&t==="/")return s=KW,r;if(t==="."&&o.length){for(;I(o););return s=Dk,r}if(t===";"||t===")"||t==="("){if(o.length)for(;I(o););return g(t),s=of,r+1}var B=o.length===2&&t!=="=";if(/[\w_\d\s]/.test(t)||B){for(;I(o););return s=of,r}return o.push(t),e=t,r+1}function I(B){for(var ee,ie,J=0;;){if(ee=Rwe.indexOf(B.slice(0,B.length+J).join("")),ie=Rwe[ee],ee===-1){if(J--+B.length>0)continue;ie=B.slice(0,1).join("")}return g(ie),h+=ie.length,(o=o.slice(ie.length)).length}}function O(){return/[^a-fA-F0-9]/.test(t)?(g(o.join("")),s=of,r):(o.push(t),e=t,r+1)}function D(){return t==="."||/[eE]/.test(t)?(o.push(t),s=Dk,e=t,r+1):t==="x"&&o.length===1&&o[0]==="0"?(s=Lwe,o.push(t),e=t,r+1):/[^\d]/.test(t)?(g(o.join("")),s=of,r):(o.push(t),e=t,r+1)}function U(){return t==="f"&&(o.push(t),e=t,r+=1),/[eE]/.test(t)||t==="-"&&/[eE]/.test(e)?(o.push(t),e=t,r+1):/[^\d]/.test(t)?(g(o.join("")),s=of,r):(o.push(t),e=t,r+1)}function V(){if(/[^\d\w_]/.test(t)){var B=o.join("");return s=Ykt.indexOf(B)>-1?t6t:Kkt.indexOf(B)>-1?e6t:Qkt,g(o.join("")),s=of,r}return o.push(t),e=t,r+1}}function s6t(t){var e=n6t(),i=[];return i=(i=i.concat(e(t))).concat(e(null))}function o6t(t){return s6t(t)}function a6t(t){return t.map(e=>e.type!=="eof"?e.data:"").join("")}const QW=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];function l6t(t,e="100",i="300 es"){const r=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const n of t)if(n.type==="preprocessor"){const s=r.exec(n.data);if(s){const o=s[1].replace(/\s\s+/g," ");if(o===i)return o;if(o===e)return n.data="#version "+i,e;throw new Error("unknown glsl version: "+o)}}return t.splice(0,0,{type:"preprocessor",data:"#version "+i},{type:"whitespace",data:`
`}),null}function c6t(t,e){for(let i=e-1;i>=0;i--){const r=t[i];if(r.type!=="whitespace"&&r.type!=="block-comment"){if(r.type!=="keyword")break;if(r.data==="attribute"||r.data==="in")return!0}}return!1}function i$(t,e,i,r){r=r||i;for(const n of t)if(n.type==="ident"&&n.data===i)return r in e?e[r]++:e[r]=0,i$(t,e,r+"_"+e[r],r);return i}function sVe(t,e,i="afterVersion"){function r(l,c){for(let h=c;h<l.length;h++){const p=l[h];if(p.type==="operator"&&p.data===";")return h}return null}function n(l){let c=-1,h=0,p=-1;for(let f=0;f<l.length;f++){const m=l[f];if(m.type==="preprocessor"&&(m.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++h:m.data.match(/\#endif\s*.*/)&&--h),i!=="afterVersion"&&i!=="afterPrecision"||m.type==="preprocessor"&&/^#version/.test(m.data)&&(p=Math.max(p,f)),i==="afterPrecision"&&m.type==="keyword"&&m.data==="precision"){const g=r(l,f);if(g===null)throw new Error("precision statement not followed by any semicolons!");p=Math.max(p,g)}c<p&&h===0&&(c=f)}return c+1}const s={data:`
`,type:"whitespace"},o=l=>l<t.length&&/[^\r\n]$/.test(t[l].data);let a=n(t);o(a-1)&&t.splice(a++,0,s);for(const l of e)t.splice(a++,0,l);o(a-1)&&o(a)&&t.splice(a,0,s)}function u6t(t,e,i,r="lowp"){sVe(t,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function h6t(t,e,i,r,n="lowp"){sVe(t,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:r.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:n},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function d6t(t,e){let i,r,n=-1;for(let s=e;s<t.length;s++){const o=t[s];if(o.type==="operator"&&(o.data==="["&&(i=s),o.data==="]")){r=s;break}o.type==="integer"&&(n=parseInt(o.data,10))}return i&&r&&t.splice(i,r-i+1),n}function Dwe(t,e){const i=p6t();if(v(i))return i;const r=o6t(t);if(l6t(r,"100","300 es")==="300 es")return t;let n=null,s=null;const o={},a={};for(let l=0;l<r.length;++l){const c=r[l];switch(c.type){case"keyword":e===Gh.VERTEX_SHADER&&c.data==="attribute"?c.data="in":c.data==="varying"&&(c.data=e===Gh.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(c.data.trim())&&(c.data=c.data.replace(/(2D|Cube|EXT)/g,"")),e===Gh.FRAGMENT_SHADER&&c.data==="gl_FragColor"&&(n||(n=i$(r,o,"fragColor"),u6t(r,n,"vec4")),c.data=n),e===Gh.FRAGMENT_SHADER&&c.data==="gl_FragData"){const h=d6t(r,l+1),p=i$(r,o,"fragData");h6t(r,p,"vec4",h,"mediump"),c.data=p}else e===Gh.FRAGMENT_SHADER&&c.data==="gl_FragDepthEXT"&&(s||(s=i$(r,o,"gl_FragDepth")),c.data=s);break;case"ident":if(Wkt.includes(c.data)){if(e===Gh.VERTEX_SHADER&&c6t(r,l))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");c.data in a||(a[c.data]=i$(r,o,c.data)),c.data=a[c.data]}}}for(let l=r.length-1;l>=0;--l){const c=r[l];if(c.type==="preprocessor"){const h=c.data.match(/\#extension\s+(.*)\:/);if(h&&h[1]&&QW.includes(h[1].trim())){const m=r[l+1];r.splice(l,m&&m.type==="whitespace"?2:1)}const p=c.data.match(/\#ifdef\s+(.*)/);p&&p[1]&&QW.includes(p[1].trim())&&(c.data="#if 1");const f=c.data.match(/\#ifndef\s+(.*)/);f&&f[1]&&QW.includes(f[1].trim())&&(c.data="#if 0")}}return f6t(t,a6t(r))}function p6t(t){return null}function f6t(t,e){return e}const m6t=4294967295;let g6t=class{constructor(e,i,r,n,s=new Map){this._context=e,this._locations=n,this._uniformBlockBindings=s,this._refCount=1,this._compiled=!1,this._nameToUniformLocation={},this._nameToUniform1={},this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,e||console.error("RenderingContext isn't initialized!"),i.length===0&&console.error("Shaders source should not be empty!"),this._context.type===Et.WEBGL2&&(i=Dwe(i,Gh.VERTEX_SHADER),r=Dwe(r,Gh.FRAGMENT_SHADER)),this._vShader=Nwe(this._context,Gh.VERTEX_SHADER,i),this._fShader=Nwe(this._context,Gh.FRAGMENT_SHADER,r),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(mo.Shader,this),hee()&&(this.vertexShader=i,this.fragmentShader=r);const o=this._context.gl,a=o.createProgram();if(o.attachShader(a,this._vShader),o.attachShader(a,this._fShader),this._locations.forEach((l,c)=>o.bindAttribLocation(a,l,c)),o.linkProgram(a),hee()&&!o.getProgramParameter(a,o.LINK_STATUS)&&console.error(`Could not link shader
validated: ${o.getProgramParameter(a,o.VALIDATE_STATUS)}, gl error ${o.getError()}, vertex: ${o.getShaderParameter(this._vShader,o.COMPILE_STATUS)}, fragment: ${o.getShaderParameter(this._fShader,o.COMPILE_STATUS)}, info log: ${o.getProgramInfoLog(a)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`),this._context.type===Et.WEBGL2){const l=o;for(const[c,h]of this._uniformBlockBindings){const p=l.getUniformBlockIndex(a,c);p<m6t&&l.uniformBlockBinding(a,p,h)}}this._glName=a,this._context.instanceCounter.increment(mo.Program,this)}get glName(){return this._glName}get hasGLName(){return v(this._glName)}get compiled(){if(this._compiled)return!0;const e=this._context.gl.getExtension("KHR_parallel_shader_compile");return e==null||R(this.glName)?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,e.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const e=this._context.gl;this._vShader&&(e.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(mo.Shader,this)),this._fShader&&(e.deleteShader(this._fShader),this._fShader=null),this._glName&&(e.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(mo.Program,this))}ref(){++this._refCount}_getUniformLocation(e){return this._nameToUniformLocation[e]===void 0&&v(this.glName)&&(this._nameToUniformLocation[e]=this._context.gl.getUniformLocation(this.glName,e)),this._nameToUniformLocation[e]}hasUniform(e){return this._getUniformLocation(e)!==null}setUniform1i(e,i){const r=this._nameToUniform1[e];r!==void 0&&i===r||(this._context.gl.uniform1i(this._getUniformLocation(e),i),this._nameToUniform1[e]=i)}setUniform1iv(e,i){Jm(this._nameToUniform1v,e,i)&&this._context.gl.uniform1iv(this._getUniformLocation(e),i)}setUniform2iv(e,i){Jm(this._nameToUniform2,e,i)&&this._context.gl.uniform2iv(this._getUniformLocation(e),i)}setUniform3iv(e,i){Jm(this._nameToUniform3,e,i)&&this._context.gl.uniform3iv(this._getUniformLocation(e),i)}setUniform4iv(e,i){Jm(this._nameToUniform4,e,i)&&this._context.gl.uniform4iv(this._getUniformLocation(e),i)}setUniform1f(e,i){const r=this._nameToUniform1[e];r!==void 0&&i===r||(this._context.gl.uniform1f(this._getUniformLocation(e),i),this._nameToUniform1[e]=i)}setUniform1fv(e,i){Jm(this._nameToUniform1v,e,i)&&this._context.gl.uniform1fv(this._getUniformLocation(e),i)}setUniform2f(e,i,r){const n=this._nameToUniform2.get(e);n===void 0?(this._context.gl.uniform2f(this._getUniformLocation(e),i,r),this._nameToUniform2.set(e,[i,r])):i===n[0]&&r===n[1]||(this._context.gl.uniform2f(this._getUniformLocation(e),i,r),n[0]=i,n[1]=r)}setUniform2fv(e,i){Jm(this._nameToUniform2,e,i)&&this._context.gl.uniform2fv(this._getUniformLocation(e),i)}setUniform3f(e,i,r,n){const s=this._nameToUniform3.get(e);s===void 0?(this._context.gl.uniform3f(this._getUniformLocation(e),i,r,n),this._nameToUniform3[e]=[i,r,n]):i===s[0]&&r===s[1]&&n===s[2]||(this._context.gl.uniform3f(this._getUniformLocation(e),i,r,n),s[0]=i,s[1]=r,s[2]=n)}setUniform3fv(e,i){Jm(this._nameToUniform3,e,i)&&this._context.gl.uniform3fv(this._getUniformLocation(e),i)}setUniform4f(e,i,r,n,s){const o=this._nameToUniform4.get(e);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(e),i,r,n,s),this._nameToUniform4.set(e,[i,r,n,s])):o!==void 0&&i===o[0]&&r===o[1]&&n===o[2]&&s===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(e),i,r,n,s),o[0]=i,o[1]=r,o[2]=n,o[3]=s)}setUniform4fv(e,i){Jm(this._nameToUniform4,e,i)&&this._context.gl.uniform4fv(this._getUniformLocation(e),i)}setUniformMatrix3fv(e,i,r=!1){Jm(this._nameToUniformMatrix3,e,i)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(e),r,i)}setUniformMatrix4fv(e,i,r=!1){Jm(this._nameToUniformMatrix4,e,i)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(e),r,i)}stop(){}};function Nwe(t,e,i){const r=t.gl,n=r.createShader(e);return r.shaderSource(n,i),r.compileShader(n),hee()&&!r.getShaderParameter(n,r.COMPILE_STATUS)&&(console.error("Compile error in ".concat(e===Gh.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(r.getShaderInfoLog(n)),console.error(y6t(i))),n}function y6t(t){let e=2;return t.replace(/\n/g,()=>`
`+_6t(e++)+":")}function _6t(t){return t>=1e3?t.toString():("  "+t).slice(-3)}function Jm(t,e,i){const r=t.get(e);return r?Fre(r,i):(t.set(e,Array.from(i)),!0)}let v6t=class{constructor(e){this._rctx=e,this._store=new VO}dispose(){this._store.forEach(e=>e.forEach(i=>i.dispose())),this._store.clear()}acquire(e,i,r,n){const s=this._store.get(e,i);if(v(s))return s.ref(),s;const o=new g6t(this._rctx,e,i,r,n);return o.ref(),this._store.set(e,i,o),o}get test(){let e=0;return this._store.forEach(i=>i.forEach(r=>e+=r.hasGLName?2:1)),{cachedWebGLObjects:e}}},uF=class{constructor(){this._result=!1}dispose(){this._program=rt(this._program)}get result(){return v(this._program)&&(this._result=this._test(this._program),this.dispose()),this._result}},b6t=class extends uF{constructor(e){super(),this._rctx=e,this._dummyProgram=null,this._rctx.type===Et.WEBGL2&&ue("mac")&&ue("chrome")&&(this._program=this._prepareProgram(),this._dummyProgram=this._prepareDummyProgram())}dispose(){var e;super.dispose(),(e=this._dummyProgram)==null||e.dispose(),this._dummyProgram=null}_test(e){const i=this._rctx;i.resetState();const r=new es(i,{colorTarget:En.TEXTURE,depthStencilTarget:Vi.NONE},{target:Ct.TEXTURE_2D,wrapMode:$t.CLAMP_TO_EDGE,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:nt.NEAREST,width:1,height:1}),n=er.createIndex(this._rctx,zi.STATIC_DRAW,new Uint8Array([0]));i.bindFramebuffer(r),i.setViewport(0,0,1,1),i.useProgram(this._dummyProgram),i.bindBuffer(n,Lt.ELEMENT_ARRAY_BUFFER),i.drawElements(Ft.POINTS,1,ft.UNSIGNED_BYTE,0),i.useProgram(e),i.bindVAO(null),i.drawArrays(Ft.TRIANGLES,0,258);const s=new Uint8Array(4);return r.readPixels(0,0,1,1,Ge.RGBA,kt.UNSIGNED_BYTE,s),r.dispose(),n.dispose(),s[0]===255}_prepareProgram(){const i=`
    precision highp float;

    varying float triangleId;

    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));

    void main(void) {
      triangleId = floor(float(gl_VertexID)/3.0);

      vec3 position = triangleVertices[gl_VertexID % 3];
      float offset = triangleId / ${S.float(85)};
      position.z = 0.5 - offset;

      gl_Position = vec4(position, 1.0);
    }
    `,r=`
    precision highp float;

    varying float triangleId;

    void main(void) {
      gl_FragColor = triangleId == ${S.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);
    }
    `;return this._rctx.programCache.acquire(i,r,new Map([]))}_prepareDummyProgram(){const e=`
    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,i=`
    void main(void) {
      gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`;return this._rctx.programCache.acquire(e,i,new Map([]))}},w6t=class extends uF{constructor(e){super(),this._rctx=e,this._program=Fwe(this._rctx,!1),this._obfuscated=Fwe(this._rctx,!0)}dispose(){super.dispose(),this._obfuscated=rt(this._obfuscated)}_test(e){if(ue("force-double-precision-obfuscation"))return!0;if(R(this._obfuscated))return!1;const i=this._runProgram(e),r=this._runProgram(this._obfuscated);return i!==0&&(r===0||i/r>5)}_runProgram(e){const i=this._rctx;i.resetState();const r=new es(i,{colorTarget:En.TEXTURE,depthStencilTarget:Vi.NONE},{target:Ct.TEXTURE_2D,wrapMode:$t.CLAMP_TO_EDGE,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:nt.NEAREST,width:1,height:1}),n=er.createVertex(i,zi.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),s=new Np(i,new Map([["position",0]]),{geometry:[new xa("position",2,ft.UNSIGNED_SHORT,0,4)]},{geometry:n}),o=Ue(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),a=Ue(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),l=new Float32Array(6);ete(o,l,3);const c=new Float32Array(6);ete(a,c,3),i.useProgram(e),e.setUniform3f("u_highA",l[0],l[2],l[4]),e.setUniform3f("u_lowA",l[1],l[3],l[5]),e.setUniform3f("u_highB",c[0],c[2],c[4]),e.setUniform3f("u_lowB",c[1],c[3],c[5]),i.bindFramebuffer(r),i.setViewport(0,0,1,1),i.bindVAO(s),i.drawArrays(Ft.TRIANGLE_STRIP,0,4);const h=new Uint8Array(4);r.readPixels(0,0,1,1,Ge.RGBA,kt.UNSIGNED_BYTE,h),s.dispose(!1),n.dispose(),r.dispose();const p=(o[2]-a[2])/25,f=Vle(h);return Math.abs(p-f)}};function Fwe(t,e){const i=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${e?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `,r=`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `;return t.programCache.acquire(i,r,new Map([["position",0]]))}var kwe,Uwe,Sie={},x6t={get exports(){return Sie},set exports(t){Sie=t}};kwe=x6t,(Uwe=function(){var t=function(_){window.console&&window.console.log&&window.console.log(_)},e=function(_){window.console&&window.console.error?window.console.error(_):t(_)},i={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},r=null,n=null;function s(_){if(r==null)for(var b in r={},n={},_)typeof _[b]=="number"&&(r[_[b]]=b,n[b]=_[b])}function o(){if(r==null)throw"WebGLDebugUtils.init(ctx) not called"}function a(_){return o(),r[_]!==void 0}function l(_){o();var b=r[_];return b!==void 0?"gl."+b:"/*UNKNOWN WebGL ENUM*/ 0x"+_.toString(16)}function c(_,b,w,x){var T;if((T=i[_])!==void 0&&(T=T[b])!==void 0&&T[w]){if(typeof T[w]=="object"&&T[w].enumBitwiseOr!==void 0){for(var E=T[w].enumBitwiseOr,C=0,A=[],I=0;I<E.length;++I){var O=n[E[I]];x&O&&(C|=O,A.push(l(O)))}return C===x?A.join(" | "):l(x)}return l(x)}return x===null?"null":x===void 0?"undefined":x.toString()}function h(_,b){for(var w="",x=b.length,T=0;T<x;++T)w+=(T==0?"":", ")+c(_,x,T,b[T]);return w}function p(_,b,w){_.__defineGetter__(w,function(){return b[w]}),_.__defineSetter__(w,function(x){b[w]=x})}function f(_,b,w,x){x=x||_,s(_),b=b||function(O,D,U){for(var V="",B=U.length,ee=0;ee<B;++ee)V+=(ee==0?"":", ")+c(D,B,ee,U[ee]);e("WebGL error "+l(O)+" in "+D+"("+V+")")};var T={};function E(O,D){return function(){w&&w(D,arguments);var U=O[D].apply(O,arguments),V=x.getError();return V!=0&&(T[V]=!0,b(V,D,arguments)),U}}var C={};for(var A in _)if(typeof _[A]=="function")if(A!="getExtension")C[A]=E(_,A);else{var I=E(_,A);C[A]=function(){return f(I.apply(_,arguments),b,w,x)}}else p(C,_,A);return C.getError=function(){for(var O in T)if(T.hasOwnProperty(O)&&T[O])return T[O]=!1,O;return _.NO_ERROR},C}function m(_){var b=_.getParameter(_.MAX_VERTEX_ATTRIBS),w=_.createBuffer();_.bindBuffer(_.ARRAY_BUFFER,w);for(var x=0;x<b;++x)_.disableVertexAttribArray(x),_.vertexAttribPointer(x,4,_.FLOAT,!1,0,0),_.vertexAttrib1f(x,0);_.deleteBuffer(w);var T=_.getParameter(_.MAX_TEXTURE_IMAGE_UNITS);for(x=0;x<T;++x)_.activeTexture(_.TEXTURE0+x),_.bindTexture(_.TEXTURE_CUBE_MAP,null),_.bindTexture(_.TEXTURE_2D,null);for(_.activeTexture(_.TEXTURE0),_.useProgram(null),_.bindBuffer(_.ARRAY_BUFFER,null),_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,null),_.bindFramebuffer(_.FRAMEBUFFER,null),_.bindRenderbuffer(_.RENDERBUFFER,null),_.disable(_.BLEND),_.disable(_.CULL_FACE),_.disable(_.DEPTH_TEST),_.disable(_.DITHER),_.disable(_.SCISSOR_TEST),_.blendColor(0,0,0,0),_.blendEquation(_.FUNC_ADD),_.blendFunc(_.ONE,_.ZERO),_.clearColor(0,0,0,0),_.clearDepth(1),_.clearStencil(-1),_.colorMask(!0,!0,!0,!0),_.cullFace(_.BACK),_.depthFunc(_.LESS),_.depthMask(!0),_.depthRange(0,1),_.frontFace(_.CCW),_.hint(_.GENERATE_MIPMAP_HINT,_.DONT_CARE),_.lineWidth(1),_.pixelStorei(_.PACK_ALIGNMENT,4),_.pixelStorei(_.UNPACK_ALIGNMENT,4),_.pixelStorei(_.UNPACK_FLIP_Y_WEBGL,!1),_.pixelStorei(_.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),_.UNPACK_COLORSPACE_CONVERSION_WEBGL&&_.pixelStorei(_.UNPACK_COLORSPACE_CONVERSION_WEBGL,_.BROWSER_DEFAULT_WEBGL),_.polygonOffset(0,0),_.sampleCoverage(1,!1),_.scissor(0,0,_.canvas.width,_.canvas.height),_.stencilFunc(_.ALWAYS,0,4294967295),_.stencilMask(4294967295),_.stencilOp(_.KEEP,_.KEEP,_.KEEP),_.viewport(0,0,_.canvas.width,_.canvas.height),_.clear(_.COLOR_BUFFER_BIT|_.DEPTH_BUFFER_BIT|_.STENCIL_BUFFER_BIT);_.getError(););}function g(_){var b,w,x=[],T=[],E={},C=1,A=!1,I=[],O=0,D=0,U=!1,V=0,B={};function ee(X){return typeof X=="function"?X:function(oe){X.handleEvent(oe)}}_.getContext=(w=_.getContext,function(){var X=w.apply(_,arguments);if(X instanceof WebGLRenderingContext){if(X!=b){if(b)throw"got different context";E=Z(b=X)}return E}return X});var ie=function(X){x.push(ee(X))},J=function(X){T.push(ee(X))};function q(X){var oe=X.addEventListener;X.addEventListener=function(pe,ye,Se){switch(pe){case"webglcontextlost":ie(ye);break;case"webglcontextrestored":J(ye);break;default:oe.apply(X,arguments)}}}function N(){for(var X=Object.keys(B),oe=0;oe<X.length;++oe)delete B[X]}function L(){++D,A||O==D&&_.loseContext()}function F(X,oe){var pe=X[oe];return function(){if(L(),!A)return pe.apply(X,arguments)}}function G(){for(var X=0;X<I.length;++X){var oe=I[X];oe instanceof WebGLBuffer?b.deleteBuffer(oe):oe instanceof WebGLFramebuffer?b.deleteFramebuffer(oe):oe instanceof WebGLProgram?b.deleteProgram(oe):oe instanceof WebGLRenderbuffer?b.deleteRenderbuffer(oe):oe instanceof WebGLShader?b.deleteShader(oe):oe instanceof WebGLTexture&&b.deleteTexture(oe)}}function W(X){return{statusMessage:X,preventDefault:function(){U=!0}}}return q(_),_.loseContext=function(){if(!A){for(A=!0,O=0,++C;b.getError(););N(),B[b.CONTEXT_LOST_WEBGL]=!0;var X=W("context lost"),oe=x.slice();setTimeout(function(){for(var pe=0;pe<oe.length;++pe)oe[pe](X);V>=0&&setTimeout(function(){_.restoreContext()},V)},0)}},_.restoreContext=function(){A&&T.length&&setTimeout(function(){if(!U)throw"can not restore. webglcontestlost listener did not call event.preventDefault";G(),m(b),A=!1,D=0,U=!1;for(var X=T.slice(),oe=W("context restored"),pe=0;pe<X.length;++pe)X[pe](oe)},0)},_.loseContextInNCalls=function(X){if(A)throw"You can not ask a lost contet to be lost";O=D+X},_.getNumCalls=function(){return D},_.setRestoreTimeout=function(X){V=X},_;function Z(X){for(var oe in X)typeof X[oe]=="function"?E[oe]=F(X,oe):p(E,X,oe);E.getError=function(){if(L(),!A)for(;Te=b.getError();)B[Te]=!0;for(var Te in B)if(B[Te])return delete B[Te],Te;return E.NO_ERROR};for(var pe=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],ye=0;ye<pe.length;++ye){var Se=pe[ye];E[Se]=function(Te){return function(){if(L(),A)return null;var ke=Te.apply(X,arguments);return ke.__webglDebugContextLostId__=C,I.push(ke),ke}}(X[Se])}var He=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(ye=0;ye<He.length;++ye)Se=He[ye],E[Se]=function(Te){return function(){return L(),A?null:Te.apply(X,arguments)}}(E[Se]);var De=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(ye=0;ye<De.length;++ye)Se=De[ye],E[Se]=function(Te){return function(){return L(),!A&&Te.apply(X,arguments)}}(E[Se]);return E.checkFramebufferStatus=function(Te){return function(){return L(),A?E.FRAMEBUFFER_UNSUPPORTED:Te.apply(X,arguments)}}(E.checkFramebufferStatus),E.getAttribLocation=function(Te){return function(){return L(),A?-1:Te.apply(X,arguments)}}(E.getAttribLocation),E.getVertexAttribOffset=function(Te){return function(){return L(),A?0:Te.apply(X,arguments)}}(E.getVertexAttribOffset),E.isContextLost=function(){return A},E}}return{init:s,mightBeEnum:a,glEnumToString:l,glFunctionArgToString:c,glFunctionArgsToString:h,makeDebugContext:f,makeLostContextSimulatingCanvas:g,resetToInitialState:m}}())!==void 0&&(kwe.exports=Uwe);let T6t=class extends uF{constructor(e){var n,s,o,a,l;if(super(),this._rctx=e,!e.gl)return;if(e.type===Et.WEBGL1)return void(this._result=!(!((n=e.capabilities.textureFloat)!=null&&n.textureFloat)||!((s=e.capabilities.colorBufferFloat)!=null&&s.textureFloat)));if(!((o=e.capabilities.textureFloat)!=null&&o.textureFloat&&((a=e.capabilities.colorBufferFloat)!=null&&a.textureFloat)&&((l=e.capabilities.colorBufferFloat)!=null&&l.floatBlend)))return;const i=`
    precision highp float;
    attribute vec2 a_pos;

    void main() {
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,r=`
     precision highp float;

     void main() {
      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
     }
    `;this._program=e.programCache.acquire(i,r,new Map([["a_pos",0]]))}_test(e){const i=this._rctx,r=new es(i,{colorTarget:En.TEXTURE,depthStencilTarget:Vi.NONE},{target:Ct.TEXTURE_2D,wrapMode:$t.CLAMP_TO_EDGE,pixelFormat:Ge.RGBA,dataType:kt.FLOAT,internalFormat:Mt.RGBA32F,samplingMode:nt.NEAREST,width:1,height:1}),n=er.createVertex(i,zi.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),s=new Np(i,new Map([["a_pos",0]]),{geometry:[new xa("a_pos",2,ft.UNSIGNED_SHORT,0,4)]},{geometry:n});i.useProgram(e);const o=i.getBoundFramebufferObject(),{x:a,y:l,width:c,height:h}=i.getViewport();i.bindFramebuffer(r),i.setViewport(0,0,1,1),i.bindVAO(s),i.drawArrays(Ft.TRIANGLE_STRIP,0,4);const p=Ht({blending:q4e});i.setPipelineState(p),i.drawArrays(Ft.TRIANGLE_STRIP,0,4),Sie.init(i);const f=i.gl.getError();return i.setViewport(a,l,c,h),i.bindFramebuffer(o),s.dispose(!1),n.dispose(),r.dispose(),f!==1282||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}},S6t=class extends uF{constructor(e){super(),this._rctx=e;const i=`
      precision highp float;
      attribute vec2 a_pos;
      uniform highp sampler2D u_texture;
      varying vec4 v_color;

      float getBit(in float bitset, in int bitIndex) {
        float offset = pow(2.0, float(bitIndex));
        return mod(floor(bitset / offset), 2.0);
      }

      void main() {
        vec4 value = texture2D(u_texture, vec2(0.0));
        float bit = getBit(value.x * 255.0, 1);

        v_color = bit * vec4(1.0);
        gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
      }
      `,r=`
      precision highp float;
      varying vec4 v_color;

      void main() {
        gl_FragColor = v_color;
      }
      `;this._program=e.programCache.acquire(i,r,new Map([["a_pos",0]]))}_test(e){const i=this._rctx,r=new es(i,{colorTarget:En.TEXTURE,depthStencilTarget:Vi.NONE},{target:Ct.TEXTURE_2D,wrapMode:$t.CLAMP_TO_EDGE,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:nt.NEAREST,width:1,height:1}),n=new Uint8Array(4),s=er.createVertex(i,zi.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new Np(i,new Map([["a_position",0]]),{geometry:[new xa("a_position",2,ft.SHORT,0,4)]},{geometry:s});i.useProgram(e);const a=new mt(i,{target:Ct.TEXTURE_2D,wrapMode:$t.CLAMP_TO_EDGE,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:nt.NEAREST,width:1,height:1},new Uint8Array([2,255,0,0]));e.setUniform1i("u_texture",0),i.bindTexture(a,0);const l=i.getBoundFramebufferObject();i.bindFramebuffer(r),i.useProgram(e);const{x:c,y:h,width:p,height:f}=i.getViewport();i.setViewport(0,0,1,1),i.bindVAO(o),i.drawArrays(Ft.TRIANGLE_STRIP,0,4),i.setViewport(c,h,p,f),r.readPixels(0,0,1,1,Ge.RGBA,kt.UNSIGNED_BYTE,n),o.dispose(!1),s.dispose(),r.dispose();const m=n[0]!==255||n[1]!==255||n[2]!==255||n[3]!==255;return m&&re.getLogger("esri.views.webgl.testSamplerPrecision").warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${n[0]}.${n[1]}.${n[2]}.${n[3]}]`),i.bindFramebuffer(l),m}};const Ori={geometry:[new xa("a_pos",2,ft.BYTE,0,2)]},Pri={geometry:[new xa("a_pos",2,ft.BYTE,0,4),new xa("a_tex",2,ft.BYTE,2,4)]},E6t={geometry:[new xa("a_pos",2,ft.UNSIGNED_SHORT,0,4)]};let C6t=class extends uF{constructor(e){super(),this._rctx=e,this._image=new Image,this._image.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",this._image.width=5,this._image.height=5,this._image.decode();const i=`
    precision highp float;

    attribute vec2 a_pos;
    varying vec2 v_uv;

    void main() {
      v_uv = a_pos;
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,r=`
    precision highp float;

    varying vec2 v_uv;
    uniform sampler2D u_texture;

    void main() {
      gl_FragColor = texture2D(u_texture, v_uv);
    }
    `;this._program=e.programCache.acquire(i,r,new Map([["a_pos",0]]))}dispose(){super.dispose(),this._image.src=""}_test(e){const i=this._rctx;if(!i.gl)return e.dispose(),!0;const r=new es(i,{colorTarget:En.TEXTURE,depthStencilTarget:Vi.NONE},{target:Ct.TEXTURE_2D,wrapMode:$t.CLAMP_TO_EDGE,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:nt.NEAREST,width:1,height:1}),n=er.createVertex(i,zi.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),s=new Np(i,new Map([["a_pos",0]]),E6t,{geometry:n}),o=new mt(i,{dataType:kt.UNSIGNED_BYTE,pixelFormat:Ge.RGBA,preMultiplyAlpha:!1,wrapMode:$t.CLAMP_TO_EDGE,samplingMode:nt.LINEAR},this._image);i.useProgram(e),i.bindTexture(o,0),e.setUniform1i("u_texture",0);const a=i.getBoundFramebufferObject(),{x:l,y:c,width:h,height:p}=i.getViewport();i.bindFramebuffer(r),i.setViewport(0,0,1,1),i.setClearColor(0,0,0,0),i.setBlendingEnabled(!1),i.clearSafe(Yr.COLOR_BUFFER_BIT),i.bindVAO(s),i.drawArrays(Ft.TRIANGLE_STRIP,0,4);const f=new Uint8Array(4);return r.readPixels(0,0,1,1,Ge.RGBA,kt.UNSIGNED_BYTE,f),s.dispose(!1),n.dispose(),r.dispose(),o.dispose(),i.setViewport(l,c,h,p),i.bindFramebuffer(a),f[0]!==255}},A6t=class{constructor(e){this.rctx=e,this.floatBufferBlend=new T6t(e),this.svgPremultipliesAlpha=new C6t(e),this.doublePrecisionRequiresObfuscation=new w6t(e),this.ignoresSamplerPrecision=new S6t(e),this.drawArraysRequiresIndicesTypeReset=new b6t(e)}dispose(){this.ignoresSamplerPrecision.dispose(),this.doublePrecisionRequiresObfuscation.dispose(),this.svgPremultipliesAlpha.dispose(),this.floatBufferBlend.dispose(),this.drawArraysRequiresIndicesTypeReset.dispose()}};function R6t(t,e){if(e.disjointTimerQuery)return null;if(Oy(t))return{drawBuffers:t.drawBuffers.bind(t),MAX_DRAW_BUFFERS:t.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:t.MAX_COLOR_ATTACHMENTS};if(e.drawBuffers)return null;const i=t.getExtension("WEBGL_draw_buffers");return i?{drawBuffers:i.drawBuffersWEBGL.bind(i),MAX_DRAW_BUFFERS:i.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:i.MAX_COLOR_ATTACHMENTS_WEBGL}:null}function M6t(t){if(Oy(t))return t;const e=t.getExtension("ANGLE_instanced_arrays");return e?{drawArraysInstanced:e.drawArraysInstancedANGLE.bind(e),drawElementsInstanced:e.drawElementsInstancedANGLE.bind(e),vertexAttribDivisor:e.vertexAttribDivisorANGLE.bind(e)}:null}function O6t(t,e){if(e.compressedTextureETC)return null;const i=t.getExtension("WEBGL_compressed_texture_etc");return i?{COMPRESSED_R11_EAC:i.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:i.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:i.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:i.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:i.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:i.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function P6t(t,e){if(e.compressedTextureS3TC)return null;const i=t.getExtension("WEBGL_compressed_texture_s3tc");return i?{COMPRESSED_RGB_S3TC_DXT1:i.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:i.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:i.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:i.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function I6t(t,e){if(Oy(t))return{MIN:t.MIN,MAX:t.MAX};if(e.blendMinMax)return null;{const i=t.getExtension("EXT_blend_minmax");return i?{MIN:i.MIN_EXT,MAX:i.MAX_EXT}:null}}function $6t(t,e){if(e.textureFilterAnisotropic)return null;const i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return i?{MAX_TEXTURE_MAX_ANISOTROPY:i.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:i.TEXTURE_MAX_ANISOTROPY_EXT}:null}function L6t(t,e){if(Oy(t))return{textureFloat:!0,textureFloatLinear:!e.textureFloatLinear&&!!t.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:t.HALF_FLOAT,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F};if(t instanceof WebGLRenderingContext){const i=!e.textureHalfFloat&&t.getExtension("OES_texture_half_float");return{textureFloat:!e.textureFloat&&!!t.getExtension("OES_texture_float"),textureFloatLinear:!e.textureFloatLinear&&!!t.getExtension("OES_texture_float_linear"),textureHalfFloat:!!i,textureHalfFloatLinear:!e.textureHalfFloatLinear&&!!t.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:i?i.HALF_FLOAT_OES:void 0}}return null}function D6t(t,e){if(Oy(t)){const i=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float")||!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),r=!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),n=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return i||r||n?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!n,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F}:null}if(t instanceof WebGLRenderingContext){const i=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float"),r=!e.colorBufferFloat&&t.getExtension("WEBGL_color_buffer_float"),n=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return i||r||n?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!n,RGBA16F:i?i.RGBA16F_EXT:void 0,RGB16F:i?i.RGB16F_EXT:void 0,RGBA32F:r?r.RGBA32F_EXT:void 0}:null}return null}function yP(t,e,i,r,n){if(r&&Oy(t))return!0;if(e[i])return!1;for(const s of n)if(t.getExtension(s))return!0;return!1}function N6t(t,e){if(!Oy(t)||e.textureNorm16)return null;const i=t.getExtension("EXT_texture_norm16");return i?{R16:i.R16_EXT,RG16:i.RG16_EXT,RGB16:i.RGB16_EXT,RGBA16:i.RGBA16_EXT,R16_SNORM:i.R16_SNORM_EXT,RG16_SNORM:i.RG16_SNORM_EXT,RGB16_SNORM:i.RGB16_SNORM_EXT,RGBA16_SNORM:i.RGBA16_SNORM_EXT}:null}function F6t(t,e){const i=e.loseContext&&t.getExtension("WEBGL_lose_context");return i?{loseRenderingContext:()=>i.loseContext()}:null}function k6t(t,e){if(Oy(t))return{createVertexArray:t.createVertexArray.bind(t),deleteVertexArray:t.deleteVertexArray.bind(t),bindVertexArray:t.bindVertexArray.bind(t)};if(e.vao)return null;const i=t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object");return i?{createVertexArray:i.createVertexArrayOES.bind(i),deleteVertexArray:i.deleteVertexArrayOES.bind(i),bindVertexArray:i.bindVertexArrayOES.bind(i)}:null}class U6t{constructor(e,i){this._gl=e,this._instancing=null,this._vertexArrayObject=null,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._textureFloat=null,this._colorBufferFloat=null,this._minMaxBlending=null,this._loseContext=null,this._drawBuffers=null,this._textureNorm16=null,this._depthTexture=null,this._standardDerivatives=null,this._shaderTextureLOD=null,this._fragDepth=null,this._textureFloatLinear=null,this._disabledExtensions=i.disabledExtensions||{},this._debugWebGLExtensions=i.debugWebGLExtensions||{}}get drawBuffers(){return this._drawBuffers||(this._drawBuffers=R6t(this._gl,this._disabledExtensions)),this._drawBuffers}get instancing(){return this._instancing||(this._instancing=M6t(this._gl)),this._instancing}get vao(){return this._vertexArrayObject||(this._vertexArrayObject=k6t(this._gl,this._disabledExtensions)),this._vertexArrayObject}get compressedTextureETC(){return this._compressedTextureETC||(this._compressedTextureETC=O6t(this._gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC||(this._compressedTextureS3TC=P6t(this._gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic||(this._textureFilterAnisotropic=$6t(this._gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery||(this._disjointTimerQuery=Vkt(this._gl,this._disabledExtensions)),this._disjointTimerQuery}get textureFloat(){return this._textureFloat||(this._textureFloat=L6t(this._gl,this._disabledExtensions)),this._textureFloat}get colorBufferFloat(){return this._colorBufferFloat||(this._colorBufferFloat=D6t(this._gl,this._disabledExtensions)),this._colorBufferFloat}get blendMinMax(){return this._minMaxBlending||(this._minMaxBlending=I6t(this._gl,this._disabledExtensions)),this._minMaxBlending}get depthTexture(){return this._depthTexture===null&&(this._depthTexture=yP(this._gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),this._depthTexture}get standardDerivatives(){return this._standardDerivatives===null&&(this._standardDerivatives=yP(this._gl,this._disabledExtensions,"standardDerivatives",!0,["OES_standard_derivatives"])),this._standardDerivatives}get shaderTextureLOD(){return this._shaderTextureLOD===null&&(this._shaderTextureLOD=yP(this._gl,this._disabledExtensions,"shaderTextureLOD",!0,["EXT_shader_texture_lod"])),this._shaderTextureLOD}get fragDepth(){return this._fragDepth===null&&(this._fragDepth=yP(this._gl,this._disabledExtensions,"fragDepth",!0,["EXT_frag_depth"])),this._fragDepth}get loseContext(){return this._loseContext||(this._loseContext=F6t(this._gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16||(this._textureNorm16=N6t(this._gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear===null&&(this._textureFloatLinear=yP(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(e){return this[e]}}let V6t=class{constructor(e,i){this.gl=e,this.instanceCounter=new qkt,this.programCache=new v6t(this),this._state=new Ewe,this._numOfDrawCalls=0,this._numOfTriangles=0,this.type=Oy(e)?Et.WEBGL2:Et.WEBGL1,this._loadExtensions(),this.configure(i)}get gl2(){return this.type===Et.WEBGL1?null:this.gl}configure(e){this._capabilities=new U6t(this.gl,e),this._parameters=this._loadParameters(e);const i=this.gl.getParameter(this.gl.VIEWPORT);this._state=new Ewe,this._state.viewport={x:i[0],y:i[1],width:i[2],height:i[3]},this._stateTracker=new a_t({setBlending:r=>{if(r){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(r.opRgb,r.opAlpha),this.setBlendFunctionSeparate(r.srcRgb,r.dstRgb,r.srcAlpha,r.dstAlpha);const n=r.color;this.setBlendColor(n.r,n.g,n.b,n.a)}else this.setBlendingEnabled(!1)},setCulling:r=>{r?(this.setFaceCullingEnabled(!0),this.setCullFace(r.face),this.setFrontFace(r.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:r=>{r?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(r.factor,r.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:r=>{r?(this.setDepthTestEnabled(!0),this.setDepthFunction(r.func)):this.setDepthTestEnabled(!1)},setStencilTest:r=>{if(r){this.setStencilTestEnabled(!0);const n=r.function;this.setStencilFunction(n.func,n.ref,n.mask);const s=r.operation;this.setStencilOp(s.fail,s.zFail,s.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:r=>{r?(this.setDepthWriteEnabled(!0),this.setDepthRange(r.zNear,r.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:r=>{r?this.setColorMask(r.r,r.g,r.b,r.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:r=>{r?this.setStencilWriteMask(r.mask):this.setStencilWriteMask(0)}}),this.enforceState(),rt(this._driverTest),this._driverTest=new A6t(this)}dispose(){rt(this._driverTest),this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(Lt.ARRAY_BUFFER),this.unbindBuffer(Lt.ELEMENT_ARRAY_BUFFER),this.type===Et.WEBGL2&&(this.unbindBuffer(Lt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Lt.PIXEL_PACK_BUFFER),this.unbindBuffer(Lt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Lt.COPY_READ_BUFFER),this.unbindBuffer(Lt.COPY_WRITE_BUFFER)),this._state.textureUnitMap.length=0,Fh()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._state.blend!==e&&(e===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=e,this._stateTracker.invalidateBlending())}externalProgramUpdate(){var e;(e=this._state.program)==null||e.stop(),this._state.program=null}externalTextureUnitUpdate(e,i){for(let r=0;r<e.length;++r)this._state.textureUnitMap[e[r]]=null;i>=0&&(this._state.activeTexture=i)}externalVertexArrayObjectUpdate(){const e=this.capabilities.vao;e&&(e.bindVertexArray(null),this._state.vertexArrayObject=null),this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(e,i,r,n){e===this._state.blendColor.r&&i===this._state.blendColor.g&&r===this._state.blendColor.b&&n===this._state.blendColor.a||(this.gl.blendColor(e,i,r,n),this._state.blendColor.r=e,this._state.blendColor.g=i,this._state.blendColor.b=r,this._state.blendColor.a=n,this._stateTracker.invalidateBlending())}setBlendFunction(e,i){e===this._state.blendFunction.srcRGB&&i===this._state.blendFunction.dstRGB||(this.gl.blendFunc(e,i),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=e,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=i,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,i,r,n){this._state.blendFunction.srcRGB===e&&this._state.blendFunction.srcAlpha===r&&this._state.blendFunction.dstRGB===i&&this._state.blendFunction.dstAlpha===n||(this.gl.blendFuncSeparate(e,i,r,n),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=r,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=n,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._state.blendEquation.mode!==e&&(this.gl.blendEquation(e),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,i){this._state.blendEquation.mode===e&&this._state.blendEquation.modeAlpha===i||(this.gl.blendEquationSeparate(e,i),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=i,this._stateTracker.invalidateBlending())}setColorMask(e,i,r,n){this._state.colorMask.r===e&&this._state.colorMask.g===i&&this._state.colorMask.b===r&&this._state.colorMask.a===n||(this.gl.colorMask(e,i,r,n),this._state.colorMask.r=e,this._state.colorMask.g=i,this._state.colorMask.b=r,this._state.colorMask.a=n,this._stateTracker.invalidateColorWrite())}setClearColor(e,i,r,n){this._state.clearColor.r===e&&this._state.clearColor.g===i&&this._state.clearColor.b===r&&this._state.clearColor.a===n||(this.gl.clearColor(e,i,r,n),this._state.clearColor.r=e,this._state.clearColor.g=i,this._state.clearColor.b=r,this._state.clearColor.a=n)}setFaceCullingEnabled(e){this._state.faceCulling!==e&&(e===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._state.polygonOffsetFill!==e&&(e===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,i){this._state.polygonOffset[0]===e&&this._state.polygonOffset[1]===i||(this._state.polygonOffset[0]=e,this._state.polygonOffset[1]=i,this.gl.polygonOffset(e,i),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._state.cullFace!==e&&(this.gl.cullFace(e),this._state.cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._state.frontFace!==e&&(this.gl.frontFace(e),this._state.frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._state.scissorTest!==e&&(e===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=e)}setScissorRect(e,i,r,n){this._state.scissorRect.x===e&&this._state.scissorRect.y===i&&this._state.scissorRect.width===r&&this._state.scissorRect.height===n||(this.gl.scissor(e,i,r,n),this._state.scissorRect.x=e,this._state.scissorRect.y=i,this._state.scissorRect.width=r,this._state.scissorRect.height=n)}setDepthTestEnabled(e){this._state.depthTest!==e&&(e===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._state.clearDepth!==e&&(this.gl.clearDepth(e),this._state.clearDepth=e)}setDepthFunction(e){this._state.depthFunction!==e&&(this.gl.depthFunc(e),this._state.depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._state.depthWrite!==e&&(this.gl.depthMask(e),this._state.depthWrite=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,i){this._state.depthRange.zNear===e&&this._state.depthRange.zFar===i||(this.gl.depthRange(e,i),this._state.depthRange.zNear=e,this._state.depthRange.zFar=i,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._state.stencilTest!==e&&(e===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._state.clearStencil&&(this.gl.clearStencil(e),this._state.clearStencil=e)}setStencilFunction(e,i,r){this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===r||(this.gl.stencilFunc(e,i,r),this._state.stencilFunction.face=em.FRONT_AND_BACK,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=r,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,i,r,n){this._state.stencilFunction.face===e&&this._state.stencilFunction.func===i&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===n||(this.gl.stencilFuncSeparate(e,i,r,n),this._state.stencilFunction.face=e,this._state.stencilFunction.func=i,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=n,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._state.stencilWriteMask!==e&&(this.gl.stencilMask(e),this._state.stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,i,r){this._state.stencilOperation.face===em.FRONT_AND_BACK&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===r||(this.gl.stencilOp(e,i,r),this._state.stencilOperation.face=em.FRONT_AND_BACK,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=r,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,i,r,n){this._state.stencilOperation.face===e&&this._state.stencilOperation.fail===i&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===n||(this.gl.stencilOpSeparate(e,i,r,n),this._state.stencilOperation.face=e,this._state.stencilOperation.fail=i,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=n,this._stateTracker.invalidateStencilTest())}setActiveTexture(e,i=!1){const r=this._state.activeTexture;return e>=0&&(i||e!==this._state.activeTexture)&&(this.gl.activeTexture(zH+e),this._state.activeTexture=e),r}clear(e){e&&this.gl.clear(e)}clearSafe(e,i=255){e&&(e&Yr.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),e&Yr.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),e&Yr.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(i),this.gl.clear(e))}drawArrays(e,i,r){if(Fh()&&(this._numOfDrawCalls++,this._numOfTriangles+=Vwe(e,r)),this.gl.drawArrays(e,i,r),Fh()){const n=Cye(this);n&&console.error("drawArrays:",n)}}drawElements(e,i,r,n){if(Fh()&&(this._numOfDrawCalls++,this._numOfTriangles+=Vwe(e,i)),this.gl.drawElements(e,i,r,n),Fh()){const s=Cye(this);if(s){const o=this.getBoundVAO(),a=o==null?void 0:o.indexBuffer,l=o==null?void 0:o.vertexBuffers,c={indexBuffer:a,vertexBuffers:l},h={mode:e,count:i,type:r,offset:n},p=Vo(a,g=>g.size)??0,f=n+i,m=p<f?`. Buffer is too small. Attempted to draw index ${f} of ${p}`:"";console.error(`drawElements: ${s}${m}`,{args:h,vao:c})}}}logInfo(){Fh()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){Fh()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(e,i,r,n){r=Math.max(Math.round(r),1),n=Math.max(Math.round(n),1);const s=this._state.viewport;s.x===e&&s.y===i&&s.width===r&&s.height===n||(s.x=e,s.y=i,s.width=r,s.height=n,this.gl.viewport(e,i,r,n))}getViewport(){const e=this._state.viewport;return{x:e.x,y:e.y,width:e.width,height:e.height}}useProgram(e){var i;this._state.program!==e&&((i=this._state.program)==null||i.stop(),this._state.program=e,this.gl.useProgram((e==null?void 0:e.glName)??null))}bindTexture(e,i,r=!1){(i>=this.parameters.maxTextureImageUnits||i<0)&&console.error("Input texture unit is out of range of available units!");const n=this._state.textureUnitMap[i];return R(e)||e.glName==null?(v(n)&&(this.setActiveTexture(i,r),this.gl.bindTexture(n.descriptor.target,null)),this._state.textureUnitMap[i]=null,n):r||n!==e?(this.setActiveTexture(i,r),this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._state.textureUnitMap[i]=e,n):(e.isDirty&&(this.setActiveTexture(i,r),e.applyChanges()),n)}unbindTexture(e){if(!R(e))for(let i=0;i<this.parameters.maxTextureImageUnits;i++)this._state.textureUnitMap[i]===e&&(this.bindTexture(null,i),this._state.textureUnitMap[i]=null)}bindFramebuffer(e,i=!1){if(i||this._state.readFramebuffer!==e||this._state.drawFramebuffer!==e){if(R(e))return this.gl.bindFramebuffer(Po.FRAMEBUFFER,null),this._state.readFramebuffer=null,void(this._state.drawFramebuffer=null);e.initializeAndBind(Po.FRAMEBUFFER),this._state.readFramebuffer=e,this._state.drawFramebuffer=e}}bindFramebufferSeparate(e,i,r=!1){const n=i===Po.READ_FRAMEBUFFER,s=n?this._state.readFramebuffer:this._state.drawFramebuffer;(r||s!==e)&&(R(e)?this.gl.bindFramebuffer(i,null):e.initializeAndBind(i),n?this._state.readFramebuffer=Nt(e,null):this._state.drawFramebuffer=Nt(e,null))}blitFramebuffer(e,i,r=0,n=0,s=e.width,o=e.height,a=0,l=0,c=i.width,h=i.height,p=Yr.COLOR_BUFFER_BIT,f=nt.NEAREST){this.bindFramebufferSeparate(e,Po.READ_FRAMEBUFFER),this.bindFramebufferSeparate(i,Po.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(r,n,s,o,a,l,c,h,p,f)}bindBuffer(e,i){if(e)switch(i??(i=e.bufferType),i){case Lt.ARRAY_BUFFER:this._state.vertexBuffer=cu(this.gl,e,i,this._state.vertexBuffer);break;case Lt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=cu(this.gl,e,i,this._state.indexBuffer);break;case Lt.UNIFORM_BUFFER:this._state.uniformBuffer=cu(this.gl,e,i,this._state.uniformBuffer);break;case Lt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=cu(this.gl,e,i,this._state.pixelPackBuffer);break;case Lt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=cu(this.gl,e,i,this._state.pixelUnpackBuffer);break;case Lt.COPY_READ_BUFFER:this._state.copyReadBuffer=cu(this.gl,e,i,this._state.copyReadBuffer);break;case Lt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=cu(this.gl,e,i,this._state.copyWriteBuffer)}}bindRenderbuffer(e){const i=this.gl;e||(i.bindRenderbuffer(i.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==e&&(i.bindRenderbuffer(i.RENDERBUFFER,e.glName),this._state.renderbuffer=e)}_getBufferBinding(e,i){if(i>=this.parameters.maxUniformBufferBindings||i<0)return console.error("Uniform buffer binding point is out of range!"),null;const r=this._state.uniformBufferBindingPoints;let n=r[i];return R(n)&&(n={buffer:null,offset:0,size:0},r[i]=n),n}bindBufferBase(e,i,r){const n=this._getBufferBinding(e,i);R(n)||n.buffer===r&&n.offset===0&&n.size===0||(this.gl.bindBufferBase(e,i,r?r.glName:null),n.buffer=r,n.offset=0,n.size=0)}bindBufferRange(e,i,r,n,s){const o=this._getBufferBinding(e,i);if(!R(o)&&!(o.buffer===r&&o.offset===n&&o.size===s)){if(n%this._parameters.uniformBufferOffsetAlignment!=0)return void console.error("Uniform buffer binding offset is not a multiple of the context offset alignment");this.gl.bindBufferRange(e,i,r.glName,n,s),o.buffer=r,o.offset=n,o.size=s}}bindUBO(e,i,r,n){R(i)?this.bindBufferBase(Lt.UNIFORM_BUFFER,e,null):(Fh()&&(n??i.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),i.initialize(),r!==void 0&&n!==void 0?this.bindBufferRange(Lt.UNIFORM_BUFFER,e,i.buffer,r,n):this.bindBufferBase(Lt.UNIFORM_BUFFER,e,i.buffer))}unbindUBO(e){for(let i=0,r=this._state.uniformBufferBindingPoints.length;i<r;i++){const n=this._state.uniformBufferBindingPoints[i];v(n)&&n.buffer===e.buffer&&this.bindBufferBase(Lt.UNIFORM_BUFFER,i,null)}}unbindBuffer(e){switch(e){case Lt.ARRAY_BUFFER:this._state.vertexBuffer=cu(this.gl,null,e,this._state.vertexBuffer);break;case Lt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=cu(this.gl,null,e,this._state.indexBuffer);break;case Lt.UNIFORM_BUFFER:this._state.uniformBuffer=cu(this.gl,null,e,this._state.uniformBuffer);break;case Lt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=cu(this.gl,null,e,this._state.pixelPackBuffer);break;case Lt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=cu(this.gl,null,e,this._state.pixelUnpackBuffer);break;case Lt.COPY_READ_BUFFER:this._state.copyReadBuffer=cu(this.gl,null,e,this._state.copyReadBuffer);break;case Lt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=cu(this.gl,null,e,this._state.copyWriteBuffer)}}bindVAO(e=null){R(e)?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null):this._state.vertexArrayObject!==e&&(e.bind(),this._state.vertexArrayObject=e)}async clientWaitAsync(e=10){const i=this.gl,r=i.fenceSync(uee.SYNC_GPU_COMMANDS_COMPLETE,0);if(!r)throw new Error("Client wait failed, could not create sync object");let n;this.instanceCounter.increment(mo.Sync,r),i.flush();do await t2(e),n=i.clientWaitSync(r,0,0);while(n===az.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(mo.Sync,r),i.deleteSync(r),n===az.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(e=Po.FRAMEBUFFER){return e===Po.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(Lt.ARRAY_BUFFER),this.unbindBuffer(Lt.ELEMENT_ARRAY_BUFFER),this.type===Et.WEBGL2&&(this.unbindBuffer(Lt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Lt.PIXEL_PACK_BUFFER),this.unbindBuffer(Lt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Lt.COPY_READ_BUFFER),this.unbindBuffer(Lt.COPY_WRITE_BUFFER));for(let e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(Ce.ONE,Ce.ZERO),this.setBlendEquation(yy.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(em.BACK),this.setFrontFace(WM.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(Gr.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(Gr.ALWAYS,0,0),this.setStencilOp(Qn.KEEP,Qn.KEEP,Qn.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var s,o,a;const e=this.capabilities.vao;e&&e.bindVertexArray(null);const{gl:i,gl2:r}=this;for(let l=0;l<this.parameters.maxVertexAttributes;l++)i.disableVertexAttribArray(l);if(this._state.vertexBuffer?i.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):i.bindBuffer(Lt.ARRAY_BUFFER,null),this._state.indexBuffer?i.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):i.bindBuffer(Lt.ELEMENT_ARRAY_BUFFER,null),v(r)){this._state.uniformBuffer?r.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):r.bindBuffer(Lt.UNIFORM_BUFFER,null);for(let l=0;l<this._parameters.maxUniformBufferBindings;l++){const c=this._state.uniformBufferBindingPoints[l];if(v(c)){const{buffer:h,offset:p,size:f}=c;h!==null?p===0&&f===0?r.bindBufferBase(Lt.UNIFORM_BUFFER,l,h.glName):r.bindBufferRange(Lt.UNIFORM_BUFFER,l,h.glName,p,f):r.bindBufferBase(Lt.UNIFORM_BUFFER,l,null)}}this._state.pixelPackBuffer?r.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):r.bindBuffer(Lt.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?r.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):r.bindBuffer(Lt.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?r.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):r.bindBuffer(Lt.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?r.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):r.bindBuffer(Lt.COPY_WRITE_BUFFER,null),r.bindFramebuffer(Po.READ_FRAMEBUFFER,null),r.readBuffer(r.BACK),this._state.readFramebuffer&&(r.bindFramebuffer(Po.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),r.readBuffer(Ih.COLOR_ATTACHMENT0)),r.bindFramebuffer(Po.DRAW_FRAMEBUFFER,((s=this._state.drawFramebuffer)==null?void 0:s.glName)??null)}else this._state.readFramebuffer=this._state.drawFramebuffer,i.bindFramebuffer(Po.FRAMEBUFFER,((o=this._state.drawFramebuffer)==null?void 0:o.glName)??null);if(e&&this._state.vertexArrayObject){const l=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(l)}i.useProgram(((a=this._state.program)==null?void 0:a.glName)??null),i.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),i.bindRenderbuffer(i.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null),this._state.blend===!0?i.enable(this.gl.BLEND):i.disable(this.gl.BLEND),i.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),i.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),i.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),i.clearDepth(this._state.clearDepth),i.clearStencil(this._state.clearStencil),i.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),i.cullFace(this._state.cullFace),i.depthFunc(this._state.depthFunction),i.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST),i.depthMask(this._state.depthWrite),i.frontFace(this._state.frontFace),i.lineWidth(1),this._state.faceCulling===!0?i.enable(i.CULL_FACE):i.disable(i.CULL_FACE),i.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?i.enable(i.POLYGON_OFFSET_FILL):i.disable(i.POLYGON_OFFSET_FILL),i.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?i.enable(i.SCISSOR_TEST):i.disable(i.SCISSOR_TEST),i.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),i.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?i.enable(i.STENCIL_TEST):i.disable(i.STENCIL_TEST),i.stencilMask(this._state.stencilWriteMask);for(let l=0;l<this.parameters.maxTextureImageUnits;l++){i.activeTexture(zH+l),i.bindTexture(Ct.TEXTURE_2D,null),i.bindTexture(Ct.TEXTURE_CUBE_MAP,null),this.type===Et.WEBGL2&&(i.bindTexture(Ct.TEXTURE_3D,null),i.bindTexture(Ct.TEXTURE_2D_ARRAY,null));const c=this._state.textureUnitMap[l];v(c)&&i.bindTexture(c.descriptor.target,c.glName)}i.activeTexture(zH+this._state.activeTexture);const n=this._state.viewport;i.viewport(n.x,n.y,n.width,n.height),this.resetInfo()}_loadExtensions(){this.type===Et.WEBGL1&&this.gl.getExtension("OES_element_index_uint"),this.gl.getExtension("KHR_parallel_shader_compile")}_loadParameters(e){const i=this.capabilities.textureFilterAnisotropic,r=e.maxAnisotropy??1/0,n=this.type===Et.WEBGL2,s=this.gl,o={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:i?Math.min(this.gl.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY),r):1,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE),maxUniformBufferBindings:n?s.getParameter(s.MAX_UNIFORM_BUFFER_BINDINGS):0,maxVertexUniformBlocks:n?s.getParameter(s.MAX_VERTEX_UNIFORM_BLOCKS):0,maxFragmentUniformBlocks:n?s.getParameter(s.MAX_FRAGMENT_UNIFORM_BLOCKS):0,maxUniformBlockSize:n?s.getParameter(s.MAX_UNIFORM_BLOCK_SIZE):0,uniformBufferOffsetAlignment:n?s.getParameter(s.UNIFORM_BUFFER_OFFSET_ALIGNMENT):1,maxArrayTextureLayers:n?s.getParameter(s.MAX_ARRAY_TEXTURE_LAYERS):1,maxSamples:n?s.getParameter(s.MAX_SAMPLES):1};return mt.TEXTURE_UNIT_FOR_UPDATES=o.maxTextureImageUnits-1,o}};function cu(t,e,i,r){return e?r!==e&&t.bindBuffer(i,e.glName):t.bindBuffer(i,null),e}function Vwe(t,e){switch(t){case Ft.POINTS:return 2*e;case Ft.TRIANGLES:return e/3;case Ft.TRIANGLE_STRIP:case Ft.TRIANGLE_FAN:return e-2;default:return 0}}let z6t=class extends V6t{constructor(e,i,r){super(e,i),this.newCache=r,this._refCount=1}destroy(){--this._refCount>0||this.dispose()}ref(){++this._refCount}bindTechnique(e,i,r,n){return this.useProgram(e.program),e.bindPipelineState(this,r==null?void 0:r.slot,!!n),e.program.bindPass(i,r),e.program}get test(){return this.programCache.test}},CA=class extends ve{constructor(e,i,r){super({}),this._stage=e,this._techniqueRepository=i,this._rctx=r,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new An,this._frameTask=e.view.resourceController.scheduler.registerTask(St.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this._stage.forEachOfType(Zn.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return R(this._textureTechnique)&&(this._textureTechnique=this._techniqueRepository.acquire(dce,new pce)),this._textureTechnique}acquire(e){const i=this._textures.get(e);return i?(i.ref(),Nt(i.loadingPromise,i)):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(i=>{const r=i.texture.frameUpdate(this._rctx,this.textureTechnique,i.previousToken);r>=0&&r!==i.previousToken&&(i.previousToken=r,e=!0)}),e&&this.events.emit("changed",Wn.BACKGROUND)}_createNewRef(e){const i=this._stage.getObject(e);if(R(i))return wt(i!==void 0),null;const r=i.events.on("unloaded",()=>{r.remove(),this._onTextureUnloaded(e)}),n=new B6t(e,()=>{this._frameTask.schedule(()=>{n.isUnreferenced&&i.unload()})});return this._textures.set(e,n),n.ref(),v(i.glTexture)?(this._updateGLTexture(n,i.glTexture),i.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:i,previousToken:-1}),n):(this._loadingCount++,n.loadingPromise=this._stage.schedule(()=>{const s=i.load(this._rctx,()=>this.textureTechnique),o=l=>(this._loadingCount--,n.loadingPromise=null,this._updateGLTexture(n,l),i.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:i,previousToken:-1}),n),a=l=>(this._loadingCount--,n.loadingPromise=null,gs(l)||re.getLogger(this.declaredClass).error(l),null);return ih(s)?s.then(o,a):o(s)}),n.loadingPromise)}_updateGLTexture(e,i){e.glTexture=i,this.events.emit("changed",Wn.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};u([d()],CA.prototype,"_loadingCount",void 0),u([d()],CA.prototype,"_frameTask",void 0),u([d()],CA.prototype,"updating",null),CA=u([$("esri.views.3d.webgl-engine.lib.TextureRepository")],CA);let B6t=class{constructor(e,i){this.id=e,this._release=i,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(re.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}},r$=class extends ve{constructor(){super(...arguments),this._passParameters=new j6t,this._loading=0}get passParameters(){return this._passParameters}destroy(){this._passParameters.waveNormal=rt(this._passParameters.waveNormal),this._passParameters.wavePertubation=rt(this._passParameters.wavePertubation)}get updating(){return this._loading>0}ensureResources(e){if(this._loading>0)return u_.LOADING;if(v(this._passParameters.waveNormal)&&v(this._passParameters.wavePertubation))return u_.LOADED;const i={target:Ct.TEXTURE_2D,pixelFormat:Ge.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:$t.REPEAT,samplingMode:nt.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,maxAnisotropy:8};return++this._loading,D_(ar("esri/images/materials/water/normals.jpg")).then(r=>this._passParameters.waveNormal=new mt(e,{...i,width:r.width,height:r.height},r)).catch(r=>re.getLogger(this.declaredClass).error("Failed to load water material normal texture.",r)).finally(()=>--this._loading),++this._loading,D_(ar("esri/images/materials/water/perturbation.jpg")).then(r=>this._passParameters.wavePertubation=new mt(e,{...i,width:r.width,height:r.height},r)).catch(r=>re.getLogger(this.declaredClass).error("Failed to load water material pertubation texture.",r)).finally(()=>--this._loading),u_.LOADING}};u([d()],r$.prototype,"_loading",void 0),u([d({type:Boolean,readOnly:!0})],r$.prototype,"updating",null),r$=u([$("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],r$);let j6t=class extends Tr{},G6t=class{constructor(e,i){this.viewCamera=e,this.frameHasDecorations=i}},H6t=class{constructor(e,i,r,n){this._rctx=e,this._renderFunctions=i,this._forceCameraHook=r,this._disposeOffscreenBuffers=n,this.supersample=!0,this._screenshotQueue=new Array}destroy(){this._rctx=null}async takeScreenshot(e){await this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene(Wn.BACKGROUND);const i=Jb();return this._screenshotQueue.push({settings:e,resolver:i}),i.promise}update(e,i){for(const r of this._screenshotQueue){if(this._rctx==null){r.resolver.reject();continue}const n={...r.settings,pixelRatio:r.settings.pixelRatio*e.viewCamera.pixelRatio},s=this._renderScreenshot(e,n,i);r.resolver(s)}this._screenshotQueue.length=0}_renderScreenshotOverlay(e,i,r){e.width=i.width,e.height=i.height;const n=e.getContext("2d"),s=r.pixelRatio;return n.save(),n.translate(0,i.height),n.scale(1,-1),r.region&&n.translate(-r.region.x,-r.region.y),n.scale(s,s),i=this._renderFunctions.renderOverlay(e,i),n.restore(),i}_readbackScreenshot(e,i){return e.resample?this._readbackScreenshotResampled({...e,resample:e.resample},i):this._readbackScreenshotImmediate(e,i)}_readbackScreenshotResampled(e,i){const{framebufferWidth:r,framebufferHeight:n,region:s,resample:o}=e,a=this._ensureScreenshotEncodeCanvas();let l=mH(r,n,a);this._rctx.gl.readPixels(0,0,r,n,Ge.RGBA,ft.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),i(),l=this._renderScreenshotOverlay(a,l,{...e,region:void 0});const c=mH(s.width,s.height,a);return bft(l,c,!0,o.region.x,n-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(e,i){const{framebufferHeight:r,region:n}=e,s=this._ensureScreenshotEncodeCanvas(),o=mH(n.width,n.height,s);return this._rctx.gl.readPixels(n.x,r-(n.y+n.height),n.width,n.height,Ge.RGBA,ft.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),i(),this._renderScreenshotOverlay(s,o,e)}_renderScreenshot(e,i,r){let n=null,s=null;const o=e.viewCamera,{framebufferWidth:a,framebufferHeight:l}=i;let c=!1;const h=i.disableDecorations&&e.frameHasDecorations,p=a!==o.fullWidth||l!==o.fullHeight,f=i.ignorePadding&&o.pixelRatio!==i.pixelRatio,m=p||h||f||i.objectAndLayerIdColor;if(i.objectAndLayerIdColor&&(s=new es(this._rctx,{width:a,height:l,colorTarget:En.TEXTURE,depthStencilTarget:Vi.DEPTH_STENCIL_RENDER_BUFFER})),m){const w=o.clone();if(i.ignorePadding){const E=DN(w.padding);for(let C=0;C<4;C++)E[C]=Math.round(E[C]/w.pixelRatio*i.pixelRatio);w.padding=E}w.fullWidth=a,w.fullHeight=l,w.pixelRatio=i.pixelRatio;const x=o.fovX-w.fovX,T=o.fovY-w.fovY;x<0&&x<T?w.fovX=o.fovX:T<0&&T<x&&(w.fovY=o.fovY),this._forceCameraHook(w),c=!0,n=new es(this._rctx,{width:w.fullWidth,height:w.fullHeight,colorTarget:En.TEXTURE,depthStencilTarget:Vi.DEPTH_STENCIL_RENDER_BUFFER}),this._renderFunctions.renderScene(n,s,w,i.disableDecorations?w2.OFF:w2.ON,r),this._disposeOffscreenBuffers()}const g=()=>{this._rctx.bindFramebuffer(null),rt(n)},_=this._readbackScreenshot(i,g);g();let b=null;if(i.objectAndLayerIdColor){const w=()=>{this._rctx.bindFramebuffer(null),rt(s)};this._rctx.bindFramebuffer(s),b=this._readbackScreenshot(i,w),this._rctx.bindFramebuffer(null),w()}if(m&&!this._rctx.contextAttributes.alpha)for(let w=3;w<_.data.length;w+=4)_.data[w]=255;if(b&&!this._rctx.contextAttributes.alpha)for(let w=3;w<b.data.length;w+=4)b.data[w]=255;return c&&this._forceCameraHook(o),[_,b]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}},sa=class extends ve{constructor(e){super({}),this.events=new An,this.waterTextureRepository=new r$,this._magnifierHelper=new EA,this.objectAndLayerIdRenderHelper=ue("enable-feature:objectAndLayerId-rendering")?new n5t:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode,this._initializeContext(e),ne(()=>{var r;return(r=this.waterTextureRepository)==null?void 0:r.updating},()=>this.requestRender(),zt),this._magnifierHelper.events.on("request-render",()=>this.requestRender()),this._stippleTextureRepository=new G5e(this._rctx),this._shaderTechniqueRepository=new k5e({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:this.waterTextureRepository}),this._textureRepository=new CA(e,this._shaderTechniqueRepository,this._rctx),this._textureRepository.events.on("changed",r=>this.requestRender(r)),this._materialRepository=new U5e(this._textureRepository,this._shaderTechniqueRepository,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new N4t(this._rctx,this._shaderTechniqueRepository),this.renderer=new Ch(e,this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,r=>this.requestRender(r));const i={renderScene:(r,n,s,o,a)=>this.renderer.render(r,n,{camera:s,contentCamera:s,mode:Pi.IDLE},o,a),requestRenderScene:r=>this.requestRender(r),prepareOverlay:()=>e.options.screenshot.prepareOverlay(),renderOverlay:(r,n)=>e.options.screenshot.renderOverlay(r,n)};this._screenshotManager=new H6t(this._rctx,i,r=>this.events.emit("force-camera-for-screenshot",r),()=>this.renderer.disposeOffscreenBuffers()),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}destroy(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=Nr(this._frameTask),this._shaderTechniqueRepository=Ve(this._shaderTechniqueRepository)}get performanceInfo(){const e=this._rctx.gl;return{renderer:this.renderer.performanceInfo,textureMemory:e.getUsedTextureMemory!==void 0?e.getUsedTextureMemory():void 0,renderbufferMemory:e.getUsedRenderbufferMemory!==void 0?e.getUsedRenderbufferMemory():void 0,VBOMemory:e.getUsedVBOMemory!==void 0?e.getUsedVBOMemory():void 0}}requestRender(e=Wn.UPDATE){this._needsRender=!0,e===Wn.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(e){this._magnifierHelper.magnifier=e}setIdleSuspend(e){this._idleSuspend!==e&&(this._idleSuspend=e,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e).then(i=>i[0])}takeScreenshotWithOID(e){return e.objectAndLayerIdColor=!0,this._screenshotManager.takeScreenshot(e)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(e,i,r,n,s,o=s){const a=n.constrainWindowSize(i,r,s*n.pixelRatio,o*n.pixelRatio),l=this._ensureDepthBuffer(a);this.renderer.readDepthPixels(n,a,l);let c=Number.MAX_VALUE;for(let h=0;h<a[2]*a[3];h++){const p=z4t(4*h,l,n.nearFar);c>p&&p!==n.nearFar[0]&&p!==n.nearFar[1]&&(c=p)}if(v(e)){const h=e.pickDepth(i*n.pixelRatio,r*n.pixelRatio,n);v(h)&&c>h&&h!==n.nearFar[0]&&h!==n.nearFar[1]&&(c=h)}return c===Number.MAX_VALUE?void 0:c}_ensureDepthBuffer(e){const i=4*e[2]*e[3];return(R(this._tmpDepthBuffer)||this._tmpDepthBuffer.byteLength<i)&&(this._tmpDepthBuffer=new Uint8Array(i)),this._tmpDepthBuffer}async reloadShaders(){uUe(),await this._shaderTechniqueRepository.reloadAll(),this.requestRender()}_registerFrameTask(e){const i=e.view.state;let r=!1,n=Wn.BACKGROUND,s=!1;const o={preRender:({time:a})=>{r=this.updating,n=this._needsUpdate?Wn.UPDATE:Wn.BACKGROUND,e.commitSyncLayers();const l=a-this._lastAnimationUpdate;if(l>this.renderer.animationTimestep||v(i.forcedAnimationTime)||r||this._needsRender){const c=l/this.renderer.animationTimeDilation,h=new S4e(i.camera,c,i.forcedAnimationTime);this.renderer.updateAnimation(h)&&this.requestRender(Wn.BACKGROUND),this._lastAnimationUpdate=a}},render:({time:a})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&i.camera.fullWidth>0&&i.camera.fullHeight>0){const l=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this.renderer.render(null,null,i,w2.ON,a),s=!0,l&&this.renderer.hasWaterReflection&&(this.requestRender(Wn.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:a})=>{const l=new G6t(i.camera,this.renderer.hasSlicePlane||this._magnifierHelper.enabled);this._textureRepository.update(),this._screenshotManager.update(l,a)},finish:()=>{s&&(this.renderer.finish(i.mode===Pi.IDLE?n:Wn.UPDATE),s=!1)}};this._frameTask=E_(o)}_initializeContext(e){const i=e.options;this._canvas=i.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const r={alpha:i.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:i.stencil==null||i.stencil,powerPreference:"high-performance",preserveDrawingBuffer:i.preserveDrawingBuffer??!1},n=Pft("3d",this._canvas,r);if(R(n)){const s=ue("esri-force-webgl");re.getLogger(this.declaredClass).error(s)}else this._rctx=this._newRenderingContext(n,e),this._loadShaderOnlyExtensions(),!i.alpha&&this._rctx.contextAttributes.alpha&&re.getLogger(this.declaredClass).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&ue("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)}_newRenderingContext(e,i){const r={disabledExtensions:i.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:i.options.debugWebGLExtensions||{},maxAnisotropy:8},n=(s,o)=>i.view.resourceController.memoryController.newCache(s,o);return new z6t(e,r,n)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("standardDerivatives"),this._rctx.capabilities.enable("shaderTextureLOD"),this._rctx.capabilities.enable("textureFloat")}getObjectAndLayerIdColor(e){return v(this.objectAndLayerIdRenderHelper)?this.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(e):null}get componentObjectCollection(){return R(this._componentObjectCollection)&&(this._componentObjectCollection=new C4t(this.renderer.renderPassManager,this._viewingMode)),this._componentObjectCollection}set componentObjectCollection(e){this._componentObjectCollection=e}};u([d({type:Boolean,readOnly:!0})],sa.prototype,"updating",null),u([d({autoDestroy:!0})],sa.prototype,"_rctx",void 0),u([d({autoDestroy:!0})],sa.prototype,"_container",void 0),u([d({autoDestroy:!0})],sa.prototype,"_canvas",void 0),u([d({autoDestroy:!0})],sa.prototype,"_stippleTextureRepository",void 0),u([d({autoDestroy:!0})],sa.prototype,"waterTextureRepository",void 0),u([d({autoDestroy:!0})],sa.prototype,"_magnifierHelper",void 0),u([d({readOnly:!0})],sa.prototype,"objectAndLayerIdRenderHelper",void 0),u([d({autoDestroy:!0})],sa.prototype,"_textureRepository",void 0),u([d({autoDestroy:!0})],sa.prototype,"_compositingHelper",void 0),u([d({autoDestroy:!0,readOnly:!0})],sa.prototype,"renderer",void 0),u([d({autoDestroy:!0})],sa.prototype,"_screenshotManager",void 0),u([d()],sa.prototype,"componentObjectCollection",null),u([d({autoDestroy:!0})],sa.prototype,"_componentObjectCollection",void 0),u([d()],sa.prototype,"_needsUpdate",void 0),u([d()],sa.prototype,"_needsWaterReflectionUpdate",void 0),sa=u([$("esri.views.3d.webgl-engine.parts.RenderView")],sa);let Tu=class extends ve{constructor(e){super(e),this._handles=new Xi,this._model=new QU,this._layers=new Wt,this._asyncChangeSet=new Lte,this._syncChangeSet=new Lte,this._layerSyncSet=new Set}initialize(){this._set("renderView",new sa(this)),this._frameTask=this.view.resourceController.scheduler.registerTask(St.STAGE,this),this._handles.add(this._frameTask)}destroy(){this._handles.destroy()}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||this.renderView.updating||this._frameTask.updating}get renderer(){var e;return(e=this.renderView)==null?void 0:e.renderer}add(e){this._model.add(e),kz(e)&&(e.attachStage(this),this._addLayer(e)),this.renderView.requestRender()}remove(e){R(e)||(this.renderView.requestRender(),this._model.remove(e),kz(e)&&(this._removeLayer(e),e.detachStage()))}addMany(e){v(e)&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){v(e)&&(this._model.removeMany(e),this.renderView.requestRender())}async load(e,i){R(e)||(Array.isArray(e)||(e=[e]),await Promise.all(e.filter(r=>R(r.glTexture)).map(r=>this.schedule(()=>this._model.has(r)?r.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique):null),i)))}loadImmediate(e){return e.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique)}forEachOfType(e,i){this._model.forEachOfType(e,i)}handleEvent(e,i){this.destroyed||(this._model.dirtySet[e](i),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(e){this._frameTask.processQueue(e),this._commit(e)}_commit(e){const i=this._model.dirtySet;this._asyncChangeSet.empty||e.done||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(r=>{if(e.done)return;const n=this._layerSyncSet.has(r.id)||r.updatePolicy===qb.SYNC,s=n?this._syncChangeSet:this._asyncChangeSet;i.commitLayer(r.id,s),this._layerSyncSet.delete(r.id),s.empty||(this.renderer.modify(s,n?ql:e),this.renderView.requestRender(),e.madeProgress())}),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,ql),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(r=>{e.done||this._layerSyncSet.has(r.id)||r.updatePolicy!==qb.ASYNC||(i.commitLayer(r.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()))}),this._layerSyncSet.clear(),this.notifyChange("running")}commitSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(i=>{(this._layerSyncSet.has(i.id)||i.updatePolicy===qb.SYNC)&&(e.commitLayer(i.id,this._syncChangeSet),this._layerSyncSet.delete(i.id))});for(const i of this._layerSyncSet)e.commitLayer(i,this._syncChangeSet);this._layerSyncSet.clear(),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,ql),this.renderView.requestRender())}_commitLayer(e){this._model.dirtySet.commitLayer(e.id,this._syncChangeSet),this._layerSyncSet.delete(e.id),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,ql),this.renderView.requestRender())}schedule(e,i){return this._frameTask.schedule(e,i)}reschedule(e,i){return this._frameTask.reschedule(e,i)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commitLayer(e),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,ql))}addRenderPlugin(e,i,r){const n=this.renderer.renderPlugins.add(e,i,r),s=()=>{M1e(i)&&this.view.sceneIntersectionHelper.addIntersectionHandler(i)};if(ih(n))return n.then(s);s()}removeRenderPlugin(e){M1e(e)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderer.renderPlugins.remove(e)}get performanceInfo(){return{renderView:this.renderView.performanceInfo,model:this._model.getStats()}}get test(){const e=this;return{getCount:i=>e._model.test.content.filter(r=>r.type===i).length,model:e._model}}};Tu.DebugSettings={endFrameContentValidation:!1},u([d({constructOnly:!0})],Tu.prototype,"view",void 0),u([d({constructOnly:!0})],Tu.prototype,"options",void 0),u([d({readOnly:!0})],Tu.prototype,"viewingMode",null),u([d({constructOnly:!0})],Tu.prototype,"container",void 0),u([d({constructOnly:!0})],Tu.prototype,"_handles",void 0),u([d({readOnly:!0})],Tu.prototype,"updating",null),u([d({constructOnly:!0})],Tu.prototype,"_model",void 0),u([d({autoDestroy:!0})],Tu.prototype,"renderView",void 0),u([d({readOnly:!0})],Tu.prototype,"renderer",null),u([d({readOnly:!0})],Tu.prototype,"running",null),Tu=u([$("esri.views.3d.webgl-engine.Stage")],Tu);let Gri=class extends c7{constructor(e,i,r,n){super(i,r),this.point=e,this.createGraphic=n}};function oVe(t){return Mm(t)&&t.intersector===gn.PCL&&!!t.target}let qri=class extends ZNe{constructor(e,i,r,n,s){super(e),this.layerUid=e,this.sublayerUid=i,this.nodeIndex=r,this.componentIndex=n,this.triangleNr=s}},Xri=class extends c7{constructor(e,i,r){super(i,null),this.point=e,this.createVoxelGraphic=r}};function J7(t){return Mm(t)&&t.intersector===gn.I3S&&!!t.target}function aVe(t){return Mm(t)&&t.intersector===gn.VOXEL&&!!t.target}function zwe(t,e){var i,r;return u7(t)||h7(t)?eN((i=t.target)==null?void 0:i.object.metadata,e):RAt(t)?(r=e.map)==null?void 0:r.ground:oVe(t)||J7(t)||oke(t)||aVe(t)?eN(t.target,e):null}function Zri(t,e){const i=Eie(t,e);return v(i)&&i.type==="graphic"?i.graphic:null}function Eie(t,e){var i;if(R(t))return null;if(u7(t)||h7(t))return Bwe((i=t.target)==null?void 0:i.object.metadata,e);if(oVe(t)){const r=t.target.createGraphic();return{type:"graphic",graphic:r,layer:r.layer}}if(aVe(t)){const r=t.target.createVoxelGraphic();return{type:"graphic",graphic:r,layer:r.layer}}return oke(t)||bce(t)?Bwe(t.target,e):J7(t)?q6t(t.target,e):null}function Bwe(t,e){if(R(t)||R(t.graphicUid))return null;const i=eN(t,e);if(R(i))return null;if(i===e.graphics)return R(e.graphicsView)||typeof t.graphicUid!="number"?null:e.graphicsView.getHit(t.graphicUid);const r=e.allLayerViews.find(n=>n.layer===i);return!r||r.suspended||R(t.graphicUid)?null:"getHit"in r?r.getHit(t.graphicUid):null}function q6t(t,e){const i=eN(t,e);if(R(i))return null;const r=e.allLayerViews.find(n=>n.layer===i);return r&&!r.suspended&&"getGraphicFromIntersectorTarget"in r?X6t(r.getGraphicFromIntersectorTarget(t)):null}function W6t(t,e){const i=eN(t,e);if(R(i))return null;const r=e.allLayerViews.find(n=>n.layer===i);return r&&!r.suspended&&"getAABBFromIntersectorTarget"in r?r.getAABBFromIntersectorTarget(t):null}function X6t(t){return v(t)?{type:"graphic",graphic:t,layer:t.layer}:null}function eN(t,e){return!t||R(t.layerUid)?null:v(e.graphicsView)&&t.layerUid===e.graphicsView.processor.layer.id?e.graphics:e.map.findLayerByUid(t.layerUid)}function Jri(t,e){if(u7(t)||h7(t))return c_(t.target.object.boundingVolumeWorldSpace.bounds);if(bce(t)){DAe(Nk,t.transformation);const i=Math.max(Nk[0],Nk[1],Nk[2]);return t.target.baseBoundingSphere.radius*i}return J7(t)?Vo(W6t(t.target,e),i=>.5*SCe(i)):null}function Kri(t){return!u7(t)&&!h7(t)&&(bce(t)?t.target.numLodLevels>1:!!J7(t))}const Nk=P();async function Y6t(t,e){if(t.type==="2d")return t.hitTest(e);const i=await t.hitTest(e);if(i.results.length===0)return i;const r=i.results[0],n=(r.distance??0)*(1+Z6t),s=i.results.findIndex(o=>(o.distance??0)>n);return s!==-1&&(i.results=i.results.slice(0,s)),i}const Z6t=.05;let n8=class extends G$e{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};u([d()],n8.prototype,"components",void 0),n8=u([$("esri.views.ui.3d.DefaultUI3D")],n8);const lVe=n8;let ht=class extends cRe(_Ie(vIe(DIe))){constructor(t){super(t),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._defaults={},this._externallySet={environment:!1},this._createGraphicsViewController=null,this._lostWebGLContextHandle=null,this._resolveWhenReady=[],this._propertiesPool=new O_({slicePlane:VLe},this),this._resourceController=V$t(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new Ete({view:this}),this.labeler=new DT({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new VM,this.basemapTerrain=null,this.elevationProvider=null,this.canvas=null,this.constraints=new nS,this.environmentManager=new xf,this.floors=new tt,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new p0t({view:this}),this.groundView=null,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new a$t,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new lVe,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.highlightOptions=new Yte,this.voxelWasm=null,this.voxelWasmPromise=null,MAe(),t&&t.environment||(this._defaults.environment=new pA,this.environment=this._defaults.environment);const e=(i=null)=>{v(i)&&i.type===Sr.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async r=>{try{await r.when()}catch{}this._updatingChanged()}))};this.handles.add([Kn(()=>{var i;return(i=this.map)==null?void 0:i.allLayers},"after-changes",i=>e(i),{onListenerAdd:()=>e(),onListenerRemove:()=>e(),sync:!0}),this.allLayerViews.on("after-changes",i=>this._updateUpdatingMonitors(i)),ne(()=>this.map,i=>{i&&"load"in i&&i.load&&i.load().catch(()=>{})})]),this.inputManager=new fSt({view:this}),this.stateManager=new ks({view:this})}initialize(){this.groundView=new h0t({view:this}),this._updateUpdatingMonitors();const t=()=>this._updateDefaultToMapOptions();this.handles.add(Kn(()=>{var e;return(e=this.map)==null?void 0:e.allLayers},"after-changes",t,{onListenerAdd:t,onListenerRemove:t})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,e=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=e)},zt),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,e=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=e)},zt),this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,e=>xje(e>0?1e3/Math.ceil(e):0),zt),this.updatingHandles.add(()=>{var e;return(e=this.map)==null?void 0:e.ground},t,Jr),this.updatingHandles.add(()=>{var e,i;return(i=(e=this.map)==null?void 0:e.ground)==null?void 0:i.opacity},()=>this._updateDefaultHitTestOptions(),Jr),this.handles.add(ne(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),Ki))}destroy(){this.destroyed||(this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=Ve(this.sharedSymbolResources),this._set("labeler",Ve(this.labeler)),this._set("deconflictor",Ve(this.deconflictor)),this._resourceController=Ve(this._resourceController),this._set("stateManager",Ve(this.stateManager)),this._set("inputManager",Ve(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.handles.remove("updatingMonitors"),this._set("environmentManager",Ve(this.environmentManager)),this.groundView=Ve(this.groundView))}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){var t;return(t=this.basemapTerrain)==null?void 0:t.spatialReference}get animation(){var t;return(t=this.state)==null?void 0:t.animation}get camera(){var t;return(t=this.stateManager)==null?void 0:t.camera}set camera(t){this.stateManager&&(this.stateManager.camera=t)}get contentCamera(){var t;return(t=this.stateManager)==null?void 0:t.contentCamera}set contentCamera(t){this.stateManager&&(this.stateManager.contentCamera=t)}installContentCameraReset(t={sticky:!1}){return this.stateManager.installContentCameraReset(t)}get center(){var t;return(t=this.stateManager)==null?void 0:t.center}set center(t){this.stateManager&&(this.stateManager.center=t)}get clippingArea(){var e;if(this.viewingMode==="global")return null;let t=this._userClippingArea||("clippingArea"in this.map?(e=this.map)==null?void 0:e.clippingArea:void 0);return!(this._userClippingArea||this.get("map.clippingEnabled"))||R(t)?(this._clippingArea=null,null):t instanceof ni?this.spatialReference&&(t=Fk(t,this.spatialReference),R(t))?(re.getLogger(this.declaredClass).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(t=t.clone(),R(t.intersection(this._groundAndLayersExtent))&&(t.xmin=t.xmax,t.ymin=t.ymax),t.zmin=void 0,t.zmax=void 0,t.equals(this._clippingArea)||(this._clippingArea=t),this._clippingArea):(re.getLogger(this.declaredClass).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(t){this.ready&&this.viewingMode==="global"&&v(t)?re.getLogger(this.declaredClass).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=t}get renderDataExtent(){if(this.state.viewingMode===qe.Global)return null;const t=this.renderSpatialReference,e=this.dataExtent;return R(e)||R(t)||e.spatialReference.equals(t)?e:Fk(e,t)}get dataExtent(){let t=this._groundAndLayersExtent;const e=this.spatialReference||Je.WGS84,i=Fk(this.clippingArea,e);v(i)&&(t=v(t)?t.intersection(i):i);const r=this._get("dataExtent");return v(t)&&t.equals(r)?r:t}get _groundAndLayersExtent(){const t=this.spatialReference||Je.WGS84;let e;const i=s=>{const o=Fk(s,t);R(o)||(v(e)?e.union(o):e=o.clone())},r=this.basemapTerrain;if(r!=null&&r.spatialReference){const s=r.groundExtent;i(new ni({xmin:s[0],ymin:s[1],zmin:0,xmax:s[2],ymax:s[3],zmax:0,spatialReference:r.spatialReference}))}if(this.map){const s=o=>{!v(o.fullExtent)||o.type==="graphics"&&o.internal||i(o.fullExtent)};this.map.allLayers.forEach(o=>s(o))}if(R(e))return null;e.hasZ?(e.zmin=Math.min(0,e.zmin??0),e.zmax=Math.max(0,e.zmax??0)):(e.zmin=0,e.zmax=0);const n=this._get("_groundAndLayersExtent");return e.equals(n)?n:e}set environment(t){t!==this._defaults.environment&&(this._externallySet.environment=!0),this._set("environment",t)}castEnvironment(t){return t?t instanceof pA?t:t instanceof uDe?this.environment!=null?this.environment.cloneWithWebsceneEnvironment(t):pA.fromWebsceneEnvironment(t):Ts(pA,t):new pA}get extent(){var t;return(t=this.stateManager)==null?void 0:t.extent}set extent(t){this.stateManager&&(this.stateManager.extent=t)}get screenCenter(){var t;return(t=this.stateManager)==null?void 0:t.screenCenter}get frustum(){var t;return(t=this.stateManager)==null?void 0:t.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||v(this.activeTool)&&this.activeTool.visible}get stationary(){return!this.animation&&!this.resizing&&(R(this.state)||this.state.stationary)}get navigating(){var t;return((t=this.state)==null?void 0:t.navigating)??!1}get padding(){var t;return(t=this.stateManager)==null?void 0:t.padding}set padding(t){this.stateManager&&(this.stateManager.padding=t)}set qualityProfile(t){HU.isValidProfile(t)&&(HU.apply(t,this.qualitySettings),this._set("qualityProfile",t))}get qualityProfile(){return this._get("qualityProfile")||HU.getDefaultProfile()}set slicePlane(t){if(v(this._stage)&&this._stage.renderer.setParameters({slicePlane:t}),R(t))return void this._set("slicePlane",null);const e=this._propertiesPool.get("slicePlane");Z2(t,e),this._set("slicePlane",e)}get typeSpecificPreconditionsReady(){return!!this.viewingMode}get resolution(){return this.spatialReference!=null?Zyt(this.scale,this.spatialReference):0}get scale(){var t;return(t=this.stateManager)==null?void 0:t.scale}set scale(t){this.stateManager&&(this.stateManager.scale=t)}get heightModelInfo(){const t=this.getDefaultHeightModelInfo();return t!=null?OO.deriveUnitFromSR(t,this.spatialReference):null}get updating(){var n,s,o;if(this.destroyed)return!1;let t=0,e=this.layerViewManager.updating,i=e?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(a=>{if(a.isFulfilled()){if(a.updating){if(e=!0,a.suspended||XD(a))return;++i,t+=a.updatingProgress}}else++i});for(const a of[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager])v(a)&&a.updating&&(i+=.1,t+=.5*.1);for(const a of[this.deconflictor,this.labeler,this.basemapTerrain])v(a)&&a.updating&&(++i,t+=a.updatingProgress);const r=this.stateManager.test.updatingIgnoreRenderState?Pi.IDLE:this.state.mode;if(e=!!(e||i>0||this.updatingHandles.updating||!this.ready||!this.stationary||r!==Pi.IDLE||this._createGraphicsViewController||(n=this.inputManager)!=null&&n.hasPendingInputs||(o=(s=this.map)==null?void 0:s.allLayers)!=null&&o.some(a=>!a.isFulfilled())),e?(this._numUpdating=Math.max(i,this._numUpdating),t+=this._numUpdating-i):this._numUpdating=0,this._numUpdating>0?t/=this._numUpdating:t=e?0:1,this._get("updatingProgress")!==t){const a=performance.now();if(t<1){const l=Math.min((a-this._lastUpdateTime)/2e3,1);t=this.updatingProgress*(1-l)+t*l}this._set("updatingProgress",t),this._lastUpdateTime=e&&t<1?a:0}return e}get viewingMode(){var i;const t=this._predeterminedViewingMode;if(v(t))return nH(t);const e=this.spatialReference;return e?v((i=this.defaultsFromMap)==null?void 0:i.viewingMode)&&e.equals(this.defaultsFromMap.spatialReference)?nH(this.defaultsFromMap.viewingMode):Cz(e,qe.Global)?"global":"local":"global"}set viewingMode(t){this.ready?re.getLogger(this.declaredClass).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",t)}get viewpoint(){var t;return(t=this.stateManager)==null?void 0:t.viewpoint}set viewpoint(t){this.stateManager&&(this.stateManager.viewpoint=t)}get zoom(){return this.stateManager.zoom}set zoom(t){this.stateManager&&(this.stateManager.zoom=t)}get resourceController(){return this._resourceController}get performanceInfo(){return new dLt(this)}on(t,e,i,r){return this.viewEvents.on(t,e,i,r)||super.on(t,e)}hasEventListener(t){return super.hasEventListener(t)||this.viewEvents.hasHandler(t)}toMap(t,e){if(!this.ready)return re.getLogger(this.declaredClass).error("#toMap()","Scene view cannot be used before it is ready"),null;const i=e?this.externalToInternalIntersectOptions(e):this._defaultToMapOptions,r=v(i.graphics)&&(v(i.graphics.include)||v(i.graphics.exclude)),n=XV(t)?WV(this,t):t,s=Dg(n);i.enableDraped=i.include&&!i.include.has(eb)||i.exclude&&i.exclude.has(eb);const o=this.sceneIntersectionHelper,a=Fp(this.state.viewingMode);if(a.options.selectionMode=!0,a.options.store=r?Ta.ALL:Ta.MIN,o.intersectIntersectorScreen(s,a,i),r){for(const l of a.results.all){const c=Eie(l,this);if(R(c))return this._intersectResultToMapPoint(l);if(c.type!=="graphic"||this._testGraphicUidFilter(i.graphics,c.graphic))return this._intersectResultToMapPoint(l)}return null}return this._intersectResultToMapPoint(a.results.min)}toScreen(t){if(!this.ready)return re.getLogger(this.declaredClass).error("#toScreen()","Scene view cannot be used before it is ready"),null;const e=Nt(t.z==null?jg(this.elevationProvider,t):null,0);return qa(t,bC,this.renderSpatialReference,e),this.state.camera.projectToScreen(bC,eX),Ws(eX[0],eX[1])}pixelSizeAt(t){return this.ready?t?(qa(t,bC,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(bC)):0:(re.getLogger(this.declaredClass).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(t){const e=this.basemapTerrain.overlayManager;return e?e.overlayPixelSizeInMapUnits(t):1}hitTest(t,e){if(!this.ready)return re.getLogger(this.declaredClass).error("#hitTest()","Scene view cannot be used before it is ready"),null;const i=XV(t)?WV(this,t):t,r=Sn(i.x,i.y),n=e?this.externalToInternalIntersectOptions(e):this._defaultHitTestOptions;n.requiresGroundFeedback=!0,n.enableDraped=!0;const s=Fp(this.state.viewingMode);s.options.selectionMode=!0,s.options.store=Ta.ALL,this.sceneIntersectionHelper.intersectIntersectorScreen(r,s,n);const o=this._intersectResultsToHits(s.results.all,n.graphics),a=s.results.ground,l=zwe(a,this),c=v(l)&&"type"in l&&l.type==="integrated-mesh"?l:null,h={screenPoint:i,results:o,ground:{mapPoint:this._intersectResultToMapPoint(a),distance:Mm(a)?a.distanceInRenderSpace:0,layer:c}};return tr.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(h.intersector=s),Promise.resolve(h)}async popupHitTest(t){const{results:e,ground:i}=await Y6t(this,t);let r=null;return!(e.length===0||Math.abs(Nt(e[0].distance,0)-i.distance)<1e-5)||i.layer&&i.layer.type==="integrated-mesh"||(r=i.mapPoint),{results:e,screenPoint:t,mapPoint:r}}goTo(t,e){return this.updatingHandles.addPromise(this.stateManager.goTo(t,e))}async whenAnalysisView(t){if(R(t.parent))throw new H("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:t});switch(t.parent.type){case"line-of-sight":case"dimension":return(await this.whenLayerView(t.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(t)}}whenLayerView(t){return super.whenLayerView(t)}async takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(e);return mU(i,e,this._pixelFormat())}async _takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(e);return gU(i,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(t){const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshotWithOID(e);return[gU(i[0],this._pixelFormat()),gU(i[1],this._pixelFormat())]}_completeSettings(t){const e=mft(t,this);return e.pixelRatio/=this.state.pixelRatio,wft(e,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:t=>this._takeScreenshot(t),takeScreenshotWithObjectAndLayerId:t=>this._takeScreenshotWithObjectAndLayerId(t)}}async takeScreenshotWithObjectAndLayerId(t){if(!ue("enable-feature:objectAndLayerId-rendering"))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshotWithOID(e),r=mU(i[0],e,this._pixelFormat()),n=this._completeSettings(t);return n.format="png",[r,mU(i[1],n,this._pixelFormat())]}getColorToObjectAndLayerIdMapping(){if(R(this._stage.renderView.objectAndLayerIdRenderHelper))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");return this._stage.renderView.objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()}addUpdatingPromise(t){return this.updatingHandles.addPromise(t)}importLayerView(t){return fye.importLayerView(t)}hasLayerViewModule(t){return fye.hasLayerViewModule(t)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var t,e,i,r;return this.map&&"initialViewProperties"in this.map&&((e=(t=this.map)==null?void 0:t.initialViewProperties)==null?void 0:e.spatialReference)||((i=this.defaultsFromMap)==null?void 0:i.spatialReference)||((r=this.defaultsFromMap)==null?void 0:r.ready)&&this._initialDefaultSpatialReference||null}async validate(){let t=k$e(this.type);const e=ue("safari");if(e&&e<9&&(t=new H("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:e})),v(t))throw re.getLogger(this.declaredClass).warn("#validate()",t.message),t}get _predeterminedViewingMode(){var e;const t=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?(e=this.map.initialViewProperties)==null?void 0:e.viewingMode:null)??null;return v(t)?cge(t):null}getSpatialReferenceSupport({spatialReference:t,layer:e}){const i=this._predeterminedViewingMode;if(v(i))return this._validateSpatialReferenceForViewingMode(t,e,i)?{constraints:this._makeSpatialReferenceConstraints(t,e,i)}:null;const r=this._validateSpatialReferenceForViewingMode(t,e,qe.Local),n=this._validateSpatialReferenceForViewingMode(t,e,qe.Global);return r||n?r&&n?{constraints:this._makeSpatialReferenceConstraints(t,e,null)}:r?{constraints:this._makeSpatialReferenceConstraints(t,e,qe.Local)}:{constraints:this._makeSpatialReferenceConstraints(t,e,qe.Global)}:null}_validateSpatialReferenceForViewingMode(t,e,i){return!!Cz(t,i)&&(!!R(e)||!!fpe(e)||(!O$(e)||!R(j7(e,t,i)))&&(!ppe(e)||i!==qe.Global))}_makeSpatialReferenceConstraints(t,e,i){if(R(e))return[{spatialReference:t,viewingMode:i}];const r=t.isWebMercator,n=t.isWGS84;return fpe(e)&&(r||n)?!n||i===qe.Local||Mce(e.tileInfo,e.fullExtent,t,qe.Global)===null?[{spatialReference:t,viewingMode:i},{spatialReference:Je.WebMercator,viewingMode:i}]:[{spatialReference:r?Je.WGS84:Je.WebMercator,viewingMode:i}]:O$(e)||ppe(e)||!r&&!n?O$(e)&&r&&i!==qe.Global?[{spatialReference:t,viewingMode:i},{spatialReference:Je.WGS84,viewingMode:qe.Local}]:[{spatialReference:t,viewingMode:i}]:[{spatialReference:t,viewingMode:i},{spatialReference:r?Je.WGS84:Je.WebMercator,viewingMode:i}]}_validateSpatialReference(t){const e=v(this.getSpatialReferenceSupport({spatialReference:t})),i=this._predeterminedViewingMode;return e||(v(i)?re.getLogger(this.declaredClass).warnOnce(`Spatial reference defined on view not supported in ${nH(i)} viewing mode.`):t.isGeographic&&re.getLogger(this.declaredClass).warnOnce("Spatial reference is geographic but not supported.")),e}whenReady(){return new Promise(t=>{this.ready?t(this):this._resolveWhenReady.push(t)})}computeMapPointFromVec3d(t,e){let i=this.spatialReference||Je.WGS84;return jo(t,this.renderSpatialReference,t,i)||(i=Je.WGS84,jo(t,this.renderSpatialReference,t,i)),e?(e.x=t[0],e.y=t[1],e.z=t[2],e.spatialReference=i):e=new Le(t,i),e}trackGraphicState(t){if(!t.graphic)return re.getLogger(this.declaredClass).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const e=this.getViewForGraphic(t.graphic);let i=null,r=!1;const n=s=>{var o;!r&&v(s)&&"processor"in s&&((o=s.processor)==null?void 0:o.type)==="graphics-3d"&&s.processor.graphicsCore&&(i=s.processor.graphicsCore.trackGraphicState(t))};return v(e)?n(e):this.whenViewForGraphic(t.graphic,{waitForLayer:!0}).then(s=>n(s),()=>{}).catch(()=>{}),{remove:()=>{r=!0,v(i)&&(i.remove(),i=null)}}}highlight(t){if(Array.isArray(t))return hM(t.map(i=>this.highlight(i)));if(tt.isCollection(t))return hM(t.toArray().map(i=>this.highlight(i)));const e=this.getViewForGraphic(t);return e&&"highlight"in e?e.highlight(t):fm()}maskOccludee(t){if(!t)return re.getLogger(this.declaredClass).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const e=this.getViewForGraphic(t);let i=null,r=!1;const n=s=>{!r&&v(s)&&Kut(s)&&(i=s.maskOccludee(t))};return v(e)?n(e):this.whenViewForGraphic(t,{waitForLayer:!0}).then(s=>n(s),()=>{}).catch(()=>{}),{remove:()=>{r=!0,v(i)&&(i.remove(),i=null)}}}getViewForGraphic(t){return t.layer===this.graphics?this.graphicsView:t.layer?this.allLayerViews.find(e=>e.layer===t.layer):null}graphicChanged(t){v(this.graphicsView)&&this.graphicsView.graphicChanged(t)}async whenViewForGraphic(t,e){if(t.layer===this)return await ow(()=>this.graphicsView),this.graphicsView;if(!t.layer||!this.map)throw new H("no-view-for-graphic");return e&&e.waitForLayer&&!this.map.allLayers.includes(t.layer)?new Promise((i,r)=>{const n=this.map.allLayers.on("change",s=>{s.added.includes(t.layer)&&(n.remove(),this.whenLayerView(t.layer).then(i,r))})}):this.whenLayerView(t.layer)}externalToInternalIntersectOptions(t){const e=this._externalToInternalRenderItems(t.include,fL.INCLUDE),i=this._externalToInternalRenderItems(t.exclude,fL.EXCLUDE);return{include:e.layerUids,exclude:i.layerUids,graphics:{include:e.graphicUids,exclude:i.graphicUids}}}_intersectResultToMapPoint(t,e){return t.getIntersectionPoint(bC)?(e=this.computeMapPointFromVec3d(bC,e),t.intersector===gn.TERRAIN&&this.basemapTerrain&&(e.z=Nt(jg(this.basemapTerrain,e),0)),e):null}_intersectResultsToHits(t,e){const i=new Array;let r=null;for(let n=0;n<t.length;n++){const s=t[n],o=zwe(s,this);if(v(o)&&(o===this.map.ground||"type"in o&&o.type==="integrated-mesh"))break;const a=Eie(s,this);if(R(a))continue;if(a.type==="graphic"){if(R(r)&&n!==t.length-1&&(r=new Set),v(r)){const h=this._getGraphicFilterUid(a.graphic);if(r.has(h))continue;r.add(h)}if(!this._testGraphicUidFilter(e,a.graphic))continue}const l=this._intersectResultToMapPoint(s),c=s.distanceInRenderSpace;i.push({...a,mapPoint:l,distance:c})}return i}_getGraphicFilterUid(t){var n;const e=t.sourceLayer,i=t.layer,r=e&&"objectIdField"in e?e:i&&"objectIdField"in i?i:e;if(r){const s=r.objectIdField??nIe,o=(n=t.attributes)==null?void 0:n[s];if(o)return`o-${r.id}-${o}`}return`u-${t.uid}`}_testGraphicUidFilter(t,e){const i=this._getGraphicFilterUid(e);return R(t)||(R(t.include)||t.include.has(i))&&(R(t.exclude)||!t.exclude.has(i))}_externalToInternalRenderItems(t,e,i={layerUids:void 0,graphicUids:void 0}){if(!t)return i;if(t instanceof Ha)J6t(i,this._getGraphicFilterUid(t)),e===fL.INCLUDE&&(v(this.graphicsView)&&t.layer===this?_P(i,this.graphicsView.processor.layer.id):t.layer&&_P(i,t.layer.uid));else if(UL(t))for(const r of t)r===this.graphics&&v(this.graphicsView)?_P(i,this.graphicsView.processor.layer.id):r===this.map.ground?_P(i,eb):this._externalToInternalRenderItems(r,e,i);else"uid"in t&&_P(i,t.uid);return i}_initBasemapTerrain(){this._set("basemapTerrain",new rFt({view:this})),this._set("elevationProvider",new YI({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new Pc({view:this})),this._set("featureTiles",new la({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const t=()=>{var i;const e=(i=this.basemapTerrain)==null?void 0:i.extent;if(this.clippingArea||e)if(e&&this.basemapTerrain.spatialReference){const r=v(this.basemapTerrain.extent)&&v(this.basemapTerrain.spatialReference)?Sm(H9(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;v(this.clippingArea)?this.featureTiles.filterExtent=this.clippingArea.intersection(r):this.featureTiles.filterExtent=r}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add(()=>tr.FEATURE_TILE_TREE_SHOW_TILES,e=>{e&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(Q(()=>import("./FeatureTileTree3DDebugger-217937df.js"),["assets/FeatureTileTree3DDebugger-217937df.js","assets/TileTreeDebugger-64338e09.js"])).then(({FeatureTileTree3DDebugger:i})=>{!this._featureTreeDebugger&&tr.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new i({view:this}))}):e||!this._featureTreeDebugger||tr.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},Jr),this.updatingHandles.add(()=>this.clippingArea,t,Jr),this.updatingHandles.add(()=>this.basemapTerrain.extent,t,Jr)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.exit(),this.handles.remove("render-coords-helper"),this.handles.remove("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const t=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(t)||this._set("mapCoordsHelper",new x$t(this.map,t));const e=this.state.isGlobal,i=eDe(e,t);i!==this.renderSpatialReference&&(this._set("renderCoordsHelper",C$t.create(this.state.viewingMode,i)),e||this.handles.add(ne(()=>{var r;return(r=this.basemapTerrain)==null?void 0:r.extent},r=>{const n=this.renderCoordsHelper.spatialReference;v(r)&&(r[0]!==0||r[1]!==0||r[2]!==0||r[3]!==0)&&lB(r,this.basemapTerrain.spatialReference,jwe,n)&&(this.renderCoordsHelper.extent=jwe)},Ki),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(JM/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.handles.remove("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(t=null){v(t)&&t.type===Sr.MOVE||(this.handles.remove("updatingMonitors"),this.allLayerViews.forEach(e=>{e.destroyed||(this.handles.add(ne(()=>[e.updating,e.updatingProgress],()=>this._updatingChanged(),Ki),"updatingMonitors"),e.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(t,e){if(!this.overlay||!this.overlay.hasVisibleItems)return e;const i=t.getContext("2d");return i.putImageData(e,0,0),this.overlay.renderCanvas(t),i.getImageData(0,0,e.width,e.height)}_initStage(){const t={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(n,s)=>this._renderScreenshotOverlay(n,s)}},e=new l$t(this.state.viewingMode,n=>this._stage.layers.forAll(n),this);this._set("sceneIntersectionHelper",e);const i=uB(this.surface);this._stage=new Tu({view:this,options:t,container:i}),this._stage.renderer.setParameters({slicePlane:this.slicePlane}),this._lostWebGLContextHandle=fN(this._stage.renderView.canvas,"webglcontextlost",()=>this.fatalError=new H("webgl-context-lost")),this.handles.add([this.updatingHandles.add(()=>this.qualitySettings.antialiasingEnabled,()=>this._stage.renderer.setParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled}),zt),this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,n=>this._stage.renderer.setParameters({highQualityTransparency:n}),zt),ne(()=>this.magnifier,n=>this._stage.renderView.magnifier=n,Jr),this.on("pointer-move",()=>{var n;return(n=this._stage)==null?void 0:n.renderer.resetAnimation()})],"stage");const r=()=>{this._stage.renderer.setParameters({defaultHighlightOptions:Yte.toEngineOptions(this.highlightOptions)})};this.handles.add(this.updatingHandles.add(()=>[this.highlightOptions.color,this.highlightOptions.haloColor,this.highlightOptions.haloOpacity,this.highlightOptions.fillOpacity,this.highlightOptions.shadowOpacity,this.highlightOptions.shadowColor,this.highlightOptions.shadowDifference],r),"stage"),r(),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(JM/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage=Ve(this._stage),this._lostWebGLContextHandle=Nr(this._lostWebGLContextHandle),this.handles.remove("stage"),this._set("canvas",null)}_initSurface(t){this._exitSurface(),this.state.init(t,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new mLt({view:this,viewingMode:t,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.handles.remove("graphics-view"),this._createGraphicsViewController=new AbortController;const t=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(t,t),this._updatingChanged()}async _createGraphicsViewAsync(t){const e=(await Q(()=>import("./GraphicsView3D-cfb6b060.js"),["assets/GraphicsView3D-cfb6b060.js","assets/GraphicsProcessor-9b8e4ce6.js","assets/Graphics3DObjectStates-f17fb3b9.js","assets/optimizedFeatureQueryEngineAdapter-a67931c5.js","assets/centroid-c62179b0.js","assets/GraphicsView-b7bed666.js"])).default;ui(t),await ow(()=>{var i;return(i=this.basemapTerrain)==null?void 0:i.ready},t),this._set("graphicsView",new e({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.handles.remove("graphics-view"),v(this.graphicsView)&&(this.handles.remove(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const t=cge(this.viewingMode);if(t===qe.Global&&(this._clippingArea=null),this._initSurface(t),this._set("ready",!0),this.handles.add(Kn(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded(),!this._externallySet.environment){const i=this.get("map.initialViewProperties.environment");i&&(this.environment=i)}this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect();const e=this._resolveWhenReady;this._resolveWhenReady=[],e.forEach(i=>i(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.handles.remove("graphics-view"),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(eb);for(const t of this.map.allLayers.items)t.type==="integrated-mesh"&&this._defaultToMapOptions.include.add(t.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(eb);for(const t of this.map.allLayers.items)t.type==="integrated-mesh"&&t.opacity<1&&this._defaultHitTestOptions.exclude.add(t.uid)}}addVoxelLayerViewToWasm(t){return R(this.voxelWasm)?(R(this.voxelWasmPromise)&&(this.voxelWasmPromise=Q(()=>import("./VoxelWasmPerSceneView-23939be0.js"),[]).then(e=>(this.voxelWasm=new e.default(this),this.voxelWasm))),this.voxelWasmPromise.then(e=>e.addVoxelLayer(t))):this.voxelWasm.addVoxelLayer(t)}removeVoxelLayerViewFromWasm(t){v(this.voxelWasm)&&this.voxelWasm.removeVoxelLayer(t)<1&&(this.voxelWasm=null,this.voxelWasmPromise=null)}};function _P(t,e){t.layerUids||(t.layerUids=new Set),t.layerUids.add(e)}function J6t(t,e){t.graphicUids||(t.graphicUids=new Set),t.graphicUids.add(e)}function Fk(t,e){return v(t)&&my(t.spatialReference,e)?Sm(t,e):null}var fL;ht.type="3d",u([d()],ht.prototype,"_userClippingArea",void 0),u([d()],ht.prototype,"_resourceController",void 0),u([d()],ht.prototype,"_stage",void 0),u([d({readOnly:!0})],ht.prototype,"deconflictor",void 0),u([d({readOnly:!0})],ht.prototype,"labeler",void 0),u([d(gQ(VM,"analyses"))],ht.prototype,"analyses",void 0),u([d({type:P_,readOnly:!0})],ht.prototype,"animation",null),u([d({readOnly:!0})],ht.prototype,"basemapTerrain",void 0),u([d({readOnly:!0})],ht.prototype,"elevationProvider",void 0),u([d()],ht.prototype,"camera",null),u([d({type:$p})],ht.prototype,"contentCamera",null),u([d({readOnly:!0})],ht.prototype,"canvas",void 0),u([d({type:Le})],ht.prototype,"center",null),u([d({type:ni})],ht.prototype,"clippingArea",null),u([d({type:nS})],ht.prototype,"constraints",void 0),u([d({type:ni,readOnly:!0})],ht.prototype,"renderDataExtent",null),u([d({type:ni,readOnly:!0})],ht.prototype,"dataExtent",null),u([d({type:ni,readOnly:!0})],ht.prototype,"_groundAndLayersExtent",null),u([d({value:null,type:pA})],ht.prototype,"environment",null),u([ri("environment")],ht.prototype,"castEnvironment",null),u([d({readOnly:!0})],ht.prototype,"environmentManager",void 0),u([d({type:ni})],ht.prototype,"extent",null),u([d()],ht.prototype,"floors",void 0),u([d()],ht.prototype,"screenCenter",null),u([d()],ht.prototype,"frustum",null),u([d({type:Number,readOnly:!0})],ht.prototype,"fullOpacity",void 0),u([d({readOnly:!0})],ht.prototype,"graphicsView",void 0),u([d({readOnly:!0})],ht.prototype,"analysisViewManager",void 0),u([d()],ht.prototype,"groundView",void 0),u([d({type:Boolean})],ht.prototype,"initialExtentRequired",null),u([d()],ht.prototype,"_defaultsFromMapSettings",null),u([d()],ht.prototype,"interacting",null),u([d()],ht.prototype,"stationary",null),u([d()],ht.prototype,"navigating",null),u([d()],ht.prototype,"map",void 0),u([d({readOnly:!0})],ht.prototype,"mapCoordsHelper",void 0),u([d()],ht.prototype,"padding",null),u([d({type:Pc,readOnly:!0})],ht.prototype,"pointsOfInterest",void 0),u([d({type:la,readOnly:!0})],ht.prototype,"featureTiles",void 0),u([d()],ht.prototype,"_featureTreeDebugger",void 0),u([d({type:Boolean})],ht.prototype,"screenSizePerspectiveEnabled",void 0),u([d({constructOnly:!0})],ht.prototype,"deactivatedWebGLExtensions",void 0),u([d({constructOnly:!0})],ht.prototype,"debugWebGLExtensions",void 0),u([d({constructOnly:!0})],ht.prototype,"renderCanvas",void 0),u([d({constructOnly:!0})],ht.prototype,"state",void 0),u([d({readOnly:!0})],ht.prototype,"inputManager",void 0),u([d({readOnly:!0})],ht.prototype,"stateManager",void 0),u([d({type:["low","medium","high"]})],ht.prototype,"qualityProfile",null),u([d({type:F1e,get(){let t=this._get("qualitySettings");return t||(t=new F1e,HU.apply(this.qualityProfile,t)),t}})],ht.prototype,"qualitySettings",void 0),u([d()],ht.prototype,"slicePlane",null),u([d({readOnly:!0})],ht.prototype,"typeSpecificPreconditionsReady",null),u([d({readOnly:!0})],ht.prototype,"renderCoordsHelper",void 0),u([d({readOnly:!0})],ht.prototype,"sceneIntersectionHelper",void 0),u([d({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],ht.prototype,"resolution",null),u([d({type:Number})],ht.prototype,"scale",null),u([d()],ht.prototype,"heightModelInfo",null),u([d()],ht.prototype,"spatialReference",void 0),u([d({type:Boolean,constructOnly:!0})],ht.prototype,"alphaCompositingEnabled",void 0),u([d({constructOnly:!0})],ht.prototype,"preserveDrawingBufferEnabled",void 0),u([d({type:Boolean})],ht.prototype,"supersampleScreenshotsEnabled",void 0),u([d({readOnly:!0})],ht.prototype,"type",void 0),u([d({type:lVe})],ht.prototype,"ui",void 0),u([d({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.hasPendingInputs","toolViewManager.updating","analysisViewManager.updating","state.mode"]})],ht.prototype,"updating",null),u([d({type:Number,readOnly:!0,dependsOn:["updating"]})],ht.prototype,"updatingProgress",void 0),u([d({type:["global","local"]})],ht.prototype,"viewingMode",null),u([d({type:Jn})],ht.prototype,"viewpoint",null),u([d({type:Number})],ht.prototype,"zoom",null),u([d({type:Yte})],ht.prototype,"highlightOptions",void 0),ht=u([$("esri.views.SceneView")],ht),function(t){t[t.INCLUDE=0]="INCLUDE",t[t.EXCLUDE=1]="EXCLUDE"}(fL||(fL={}));const bC=P(),eX=Sn(),jwe=Kt(),K6t=ht;let Oc=class extends ve{constructor(e){super(e),this.precision=4,this.thumbsConstrained=!0}set effectiveMax(e){this.setEffectiveMax(e)}set effectiveMin(e){this.setEffectiveMin(e)}set labelFormatFunction(e){this._set("labelFormatFunction",e)}set inputFormatFunction(e){this._set("inputFormatFunction",e)}set inputParseFunction(e){this._set("inputParseFunction",e)}get labels(){const{max:e,min:i,values:r}=this,n=r&&r.length?r.map((s,o)=>this.getLabelForValue(s,"value",o)):[];return{max:this.getLabelForValue(e,"max"),min:this.getLabelForValue(i,"min"),values:n}}set max(e){this.setMax(e)}set min(e){this.setMin(e)}get state(){const{max:e,min:i}=this;return e!=null&&i!=null&&e>i?"ready":"disabled"}set values(e){const{max:i,min:r}=this,n=this.values;n&&e&&n.length===e.length&&n.every((s,o)=>s===e[o])||(this._set("values",null),e&&e.length&&(r!=null&&e.some(s=>s<r)&&(this.min=Math.min(...e)),i!=null&&e.some(s=>s>i)&&(this.max=Math.max(...e))),this._set("values",e))}toPrecision(e){return parseFloat(e.toFixed(this.precision))}defaultLabelFormatFunction(e){const{max:i,min:r,precision:n}=this,s=i!=null&&r!=null&&i-r>10?2:n;return parseFloat(e.toFixed(s)).toString()}defaultInputFormatFunction(e){return e.toString()}defaultInputParseFunction(e){return parseFloat(e)}getBounds(){const{effectiveMax:e,effectiveMin:i,max:r,min:n}=this;return{min:i!=null&&n!=null?Math.max(n,i):n,max:e!=null&&r!=null?Math.min(r,e):r}}getBoundsForValueAtIndex(e){const{thumbsConstrained:i,values:r}=this,{min:n,max:s}=this.getBounds();if(i&&r){const o=e-1,a=e+1;return{min:r[o]!=null?r[o]:n,max:r[a]!=null?r[a]:s}}return{min:n,max:s}}getLabelForValue(e,i,r){return e==null?null:this.labelFormatFunction?this.labelFormatFunction(e,i,r):this.defaultLabelFormatFunction(e)}setMax(e){const{max:i,values:r}=this;if(e==null)return void this._set("max",null);if(isNaN(e))return void this._logError("slider:invalid-value","Supplied value for property 'max' is NaN.");const n=this.toPrecision(e);if(i!==n&&(this._set("max",n),r&&r.length))for(let s=0;s<r.length;s++)n<r[s]&&this.setValue(s,n)}setMin(e){const{min:i,values:r}=this;if(e==null)return void this._set("min",null);if(isNaN(e))return void this._logError("slider:invalid-value","Supplied value for property 'min' is NaN.");const n=this.toPrecision(e);if(i!==n&&(this._set("min",n),r&&r.length))for(let s=0;s<r.length;s++)n>r[s]&&this.setValue(s,n)}setEffectiveMax(e){if(e==null)return void this._set("effectiveMax",null);if(isNaN(e))return void this._logError("slider:invalid-value","Supplied value for property 'effectiveMax' is NaN.");const i=this.toPrecision(e);this.effectiveMax!==i&&this._set("effectiveMax",this._applyBoundsToValue(i))}setEffectiveMin(e){if(e==null)return void this._set("effectiveMin",null);if(isNaN(e))return void this._logError("slider:invalid-value","Supplied value for property 'effectiveMin' is NaN.");const i=this.toPrecision(e);this.effectiveMin!==i&&this._set("effectiveMin",this._applyBoundsToValue(i))}setValue(e,i){if(isNaN(i))return void this._logError("slider:invalid-value","Supplied value for member of property 'values' is NaN.");const{values:r}=this;if(r==null)return void this._logError("slider:invalid-value","Supplied value for member of property 'values' is null.");const n=r[e],s=this.toPrecision(i);if(n===s)return;const o=[...r];o[e]=s,this._set("values",o),this.notifyChange("labels")}_applyBoundsToValue(e){const{max:i,min:r}=this;return r!=null&&e<r?r:i!=null&&e>i?i:e}_logError(e,i,r){re.getLogger(this.declaredClass).error(new H(e,i,r))}};u([d()],Oc.prototype,"effectiveMax",null),u([d()],Oc.prototype,"effectiveMin",null),u([d()],Oc.prototype,"labelFormatFunction",null),u([d()],Oc.prototype,"inputFormatFunction",null),u([d()],Oc.prototype,"inputParseFunction",null),u([d({readOnly:!0})],Oc.prototype,"labels",null),u([d()],Oc.prototype,"max",null),u([d()],Oc.prototype,"min",null),u([d()],Oc.prototype,"precision",void 0),u([d({readOnly:!0})],Oc.prototype,"state",null),u([d()],Oc.prototype,"thumbsConstrained",void 0),u([d()],Oc.prototype,"values",null),Oc=u([$("esri.widgets.Slider.SliderViewModel")],Oc);const Q6t=Oc,Ur="esri-slider",Ri={base:Ur,reversed:`${Ur}--reversed`,horizontalLayout:`${Ur}--horizontal`,verticalLayout:`${Ur}--vertical`,contentElement:`${Ur}__content`,extraContentElement:`${Ur}__extra-content`,trackElement:`${Ur}__track`,ticksContainerElement:`${Ur}__ticks`,tickElement:`${Ur}__tick`,tickLabelElement:`${Ur}__tick-label`,maxElement:`${Ur}__max`,minElement:`${Ur}__min`,maxElementInteractive:`${Ur}__max--interactive`,minElementInteractive:`${Ur}__min--interactive`,rangeElementActive:`${Ur}__range--active`,rangeInput:`${Ur}__range-input`,anchorElement:`${Ur}__anchor`,movingAnchorElement:`${Ur}__anchor--moving`,lastMovedAnchorElement:`${Ur}__anchor--moved`,anchorElementActive:`${Ur}__anchor--active`,anchorElementIndexPrefix:`${Ur}__anchor-`,segmentElement:`${Ur}__segment`,segmentElementIndexPrefix:`${Ur}__segment-`,segmentElementInteractive:`${Ur}__segment--interactive`,segmentElementActive:`${Ur}__segment--active`,effectiveSegmentElement:`${Ur}__effective-segment`,effectiveMaxSegmentElement:`${Ur}__effective-max-segment`,effectiveMinSegmentElement:`${Ur}__effective-min-segment`,thumbElement:`${Ur}__thumb`,labelElement:`${Ur}__label`,labelElementInteractive:`${Ur}__label--interactive`,labelInput:`${Ur}__label-input`,esriWidget:"esri-widget",widgetIcon:"esri-icon-edit",disabled:"esri-disabled",hidden:"esri-hidden"},uu={showInput:"Enter",hideInput1:"Enter",hideInput2:"Escape",hideInput3:"Tab",moveAnchorUp:"ArrowUp",moveAnchorDown:"ArrowDown",moveAnchorLeft:"ArrowLeft",moveAnchorRight:"ArrowRight",moveAnchorToMax:"End",moveAnchorToMin:"Home"},eUt="esri.widgets.Slider",Gwe={labels:!1,rangeLabels:!1};let qi=class extends Sa{constructor(e,i){super(e,i),this._activeLabelInputIndex=null,this._anchorElements=[],this._dragged=!1,this._dragStartInfo=null,this._focusedAnchorIndex=null,this._isMinInputActive=!1,this._isMaxInputActive=!1,this._lastMovedHandleIndex=null,this._positionPrecision=5,this._segmentDragStartInfo=null,this._trackHeight=null,this._trackWidth=null,this._zIndices=null,this._zIndexOffset=3,this.disabled=!1,this.draggableSegmentsEnabled=!0,this.effectiveSegmentElements=new tt,this.extraNodes=[],this.inputCreatedFunction=null,this.labelElements=new tt,this.labelInputsEnabled=!1,this.maxLabelElement=null,this.messages=null,this.minLabelElement=null,this.rangeLabelInputsEnabled=!1,this.segmentElements=new tt,this.snapOnClickEnabled=!0,this.steps=null,this.syncedSegmentsEnabled=!1,this.thumbCreatedFunction=null,this.thumbElements=new tt,this.tickElements=new tt,this.trackElement=null,this.viewModel=new Q6t,this.visibleElements={...Gwe},this._onAnchorPointerDown=this._onAnchorPointerDown.bind(this),this._onAnchorPointerMove=this._onAnchorPointerMove.bind(this),this._onAnchorPointerUp=this._onAnchorPointerUp.bind(this),this._onLabelPointerDown=this._onLabelPointerDown.bind(this),this._onLabelPointerUp=this._onLabelPointerUp.bind(this),this._onSegmentPointerDown=this._onSegmentPointerDown.bind(this),this._onSegmentPointerMove=this._onSegmentPointerMove.bind(this),this._onSegmentPointerUp=this._onSegmentPointerUp.bind(this),this._onTrackPointerDown=this._onTrackPointerDown.bind(this),this._onTrackPointerMove=this._onTrackPointerMove.bind(this),this._onTrackPointerUp=this._onTrackPointerUp.bind(this)}destroy(){document.removeEventListener("pointerup",this._onLabelPointerUp),document.removeEventListener("pointermove",this._onLabelPointerMove),document.removeEventListener("pointerup",this._onAnchorPointerUp),document.removeEventListener("pointermove",this._onAnchorPointerMove),this.labelElements.removeAll(),this.labelElements.destroy(),this.segmentElements.removeAll(),this.segmentElements.destroy(),this.effectiveSegmentElements.removeAll(),this.effectiveSegmentElements.destroy(),this.thumbElements.removeAll(),this.thumbElements.destroy(),this.tickElements.removeAll(),this.tickElements.destroy()}get effectiveMax(){return this.viewModel.effectiveMax}set effectiveMax(e){this.viewModel.effectiveMax=e}get effectiveMin(){return this.viewModel.effectiveMin}set effectiveMin(e){this.viewModel.effectiveMin=e}get inputFormatFunction(){return this.viewModel.inputFormatFunction}set inputFormatFunction(e){this.viewModel.inputFormatFunction=e}get inputParseFunction(){return this.viewModel.inputParseFunction}set inputParseFunction(e){this.viewModel.inputParseFunction=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get labelFormatFunction(){return this.viewModel.labelFormatFunction}set labelFormatFunction(e){this.viewModel.labelFormatFunction=e}get labels(){return this.viewModel.labels}set layout(e){["vertical","vertical-reversed","horizontal","horizontal-reversed"].includes(e)||(e="horizontal"),this._set("layout",e)}get max(){return this.viewModel.max}set max(e){this.viewModel.max=e}get min(){return this.viewModel.min}set min(e){this.viewModel.min=e}get precision(){return this.viewModel.precision}set precision(e){this.viewModel.precision=e}get state(){const{_activeLabelInputIndex:e,_isMaxInputActive:i,_isMinInputActive:r,_dragStartInfo:n,_segmentDragStartInfo:s,disabled:o,viewModel:a}=this,l=v(n)||v(s);return o?"disabled":e===null&&!i&&!r?l?"dragging":a.state:"editing"}get thumbsConstrained(){return this.viewModel.thumbsConstrained}set thumbsConstrained(e){this.viewModel.thumbsConstrained=e}set tickConfigs(e){this._set("tickConfigs",e),this.scheduleRender()}get values(){return this.viewModel.values}set values(e){this.viewModel.values=e}castVisibleElements(e){return{...Gwe,...e}}render(){const{label:e}=this,i=this.classes(Ri.base,Ri.esriWidget,this._isHorizontalLayout()?Ri.horizontalLayout:Ri.verticalLayout,this._isReversedLayout()?Ri.reversed:null,this._isDisabled()?Ri.disabled:null);return this._storeTrackDimensions(),te("div",{"aria-label":e,class:i,"touch-action":"none",bind:this,afterCreate:this._afterContainerCreate},this.renderContent())}toNextStep(e){this._toStep(e,1)}toPreviousStep(e){this._toStep(e,-1)}renderContent(){const{max:e,min:i}=this;if(!(R(i)||R(e)||i>=e))return[this.renderMin(),this.renderSliderContainer(),this.renderMax()]}renderSliderContainer(){return te("div",{key:"slider-container",bind:this,class:Ri.contentElement},this.renderTrackElement(),this.renderTicksContainer(),this.renderExtraContentElements())}renderTrackElement(){return te("div",{afterCreate:this._afterTrackCreate,afterRemoved:this._afterTrackRemoved,bind:this,class:Ri.trackElement,"touch-action":"none"},this.renderEffectiveSegmentElements(),this.renderSegmentElements(),this.renderAnchorElements())}renderEffectiveSegmentElements(){if(!this.trackElement||!this.values||!this.values.length)return;const e=v(this.effectiveMax),i=v(this.effectiveMin);if(!e&&!i)return;const{max:r,min:n,viewModel:s}=this,o=s.getBounds(),a=[];return i&&a.push(this.renderEffectiveSegmentElement(n,o.min,!0)),e&&a.push(this.renderEffectiveSegmentElement(o.max,r,!1)),a}renderSegmentElements(){if(!this.trackElement||!this.values||!this.values.length)return;const e=this.values.length,i=[];for(let r=0;r<=e;r++)i.push(this.renderSegmentElement(r));return i}renderSegmentElement(e){const{_trackHeight:i,_trackWidth:r,draggableSegmentsEnabled:n,id:s,state:o,values:a}=this,l=this._isHorizontalLayout(),c=l?r:i,h=this.viewModel.getBounds(),p=this._positionFromValue(h.max),f=this._positionFromValue(h.min),m=e===a.length?null:e,g=e===0?null:e-1,_=v(m),b=v(g);let w,x;const T=[...a].sort((O,D)=>O-D);this._isReversedLayout()?(w=b?this._positionFromValue(T[g]):f,x=_?this._positionFromValue(T[m]):p):(w=_?this._positionFromValue(T[m]):p,x=b?this._positionFromValue(T[g]):f);const E=this._applyPrecisionToPosition(100*x/c),C=(w-x)/c,A=l?`transform: translate(${E}%, 0px) scale(${C}, 1);`:`transform: translate(0px, ${E}%) scale(1, ${C});`,I=this.classes(Ri.segmentElement,Ri.segmentElementIndexPrefix+e,n&&_&&b&&o!=="disabled"?Ri.segmentElementInteractive:null);return te("div",{afterCreate:this._afterSegmentCreate,afterRemoved:this._afterSegmentRemoved,bind:this,class:I,"data-max-thumb-index":m,"data-min-thumb-index":g,"data-segment-index":e,key:`${s}-segment-${e}`,style:A,"touch-action":"none"})}renderEffectiveSegmentElement(e,i,r){const{_trackHeight:n,_trackWidth:s,layout:o}=this,a=this._positionFromValue(e),l=this._positionFromValue(i),c=this._isHorizontalLayout(),h=c?s:n,p=this._applyPrecisionToPosition(100*a/h);let f=null;if(o==="horizontal"){const _=r?h-l:l,b=a===h?0:p;f=`clip-path: inset(0% ${l===h?0:this._applyPrecisionToPosition(_/h*100)}% 0% ${b}%);`}else{const _=(l-a)/h;f=c?`transform: translate(${p}%, 0px) scale(${_}, 1);`:`transform: translate(0px, ${p}%) scale(1, ${_});`}const m=r?Ri.effectiveMinSegmentElement:Ri.effectiveMaxSegmentElement,g=this.classes(Ri.segmentElement,Ri.effectiveSegmentElement,m);return te("div",{afterCreate:this._afterEffectiveSegmentCreate,afterRemoved:this._afterEffectiveSegmentRemoved,bind:this,class:g,style:f,"touch-action":"none"})}renderAnchorElements(){const{trackElement:e,values:i}=this;if(i&&i.length)return this._zIndices=i.map((r,n)=>{const s=this._positionFromValue(r),o=this._positionToPercent(s),a=(this._isHorizontalLayout()?o>50:o<50)?-1:1;return this._zIndexOffset+(i.length+a*n)}),e&&i&&i.length?i.map((r,n)=>this.renderAnchorElement(r,n)):null}renderAnchorElement(e,i){const r=this._positionFromValue(e),n=this._valueFromPosition(r);if(R(n)||isNaN(n))return;const{_dragStartInfo:s,_lastMovedHandleIndex:o,id:a,layout:l,values:c,visibleElements:{labels:h}}=this,p=s&&s.index===i,f=o===i,m=this.classes(Ri.anchorElement,Ri.anchorElementIndexPrefix+i,p?Ri.movingAnchorElement:null,f?Ri.lastMovedAnchorElement:null),g=this.labels.values[i],_=this._getStyleForAnchor(e,i,p||f),{min:b,max:w}=this.viewModel.getBoundsForValueAtIndex(i),{disabled:x,messages:T}=this,E=c.length===2?Lf(i===0?T.rangeMinimum:T.rangeMaximum,{value:e}):g,C=c.length===1?null:i===0?`${a}-handle-${i+1}`:i===c.length-1?`${a}-handle-${i-1}`:`${a}-handle-${i-1} ${a}-handle-${i+1}`;return te("div",{afterCreate:this._afterAnchorCreate,afterUpdate:this._afterAnchorUpdate,afterRemoved:this._afterAnchorRemoved,"aria-controls":C,"aria-label":T.sliderValue,"aria-labelledby":h?`${a}-label-${i}`:null,"aria-orientation":l,"aria-valuemax":w.toString(),"aria-valuemin":b.toString(),"aria-valuenow":e.toString(),"aria-valuetext":E,bind:this,class:m,"data-thumb-index":i,"data-value":e,id:`${a}-handle-${i}`,key:`${a}-handle-${i}`,onkeydown:this._onAnchorKeyDown,"touch-action":"none",role:"slider",style:_,tabIndex:x?-1:0},te("span",{afterCreate:this._afterThumbCreate,afterRemoved:this._afterThumbRemoved,bind:this,class:Ri.thumbElement,"data-thumb-index":i,"touch-action":"none"}),this.renderThumbLabel(i))}renderThumbLabel(e){const{id:i,labels:r,labelInputsEnabled:n,state:s}=this,o=this.visibleElements.labels,a=r.values[e],l=this.classes(Ri.labelElement,o?null:Ri.hidden,n&&s!=="disabled"?Ri.labelElementInteractive:null);return te("span",{afterCreate:this._afterLabelCreate,afterRemoved:this._afterLabelRemoved,"aria-hidden":(!o).toString(),bind:this,class:l,"data-thumb-index":e,key:`${i}-label-${e}`,id:`${i}-label-${e}`,role:n?"button":null,"touch-action":"none"},this._activeLabelInputIndex===e?this.renderValueInput(e):a)}renderValueInput(e){const{disabled:i,values:r}=this,n=r[e];return te("input",{key:`value-input-${e}`,afterCreate:this._afterInputCreate,"aria-label":this.messages.sliderValue,bind:this,class:Ri.labelInput,"data-input-type":"thumb","data-input-index":e,required:!0,tabIndex:i?-1:0,type:"text",value:this._formatInputValue(n,"value",e),onblur:this._onLabelInputBlur,onkeydown:this._onInputKeyDown})}renderMax(){const{_isMaxInputActive:e,labels:i,rangeLabelInputsEnabled:r,state:n}=this,s=this.visibleElements.rangeLabels,o=this.classes(Ri.maxElement,{[Ri.hidden]:!s,[Ri.maxElementInteractive]:r&&n!=="disabled",[Ri.rangeElementActive]:e});return te("div",{"aria-hidden":(!s).toString(),afterCreate:this._afterMaxLabelCreate,bind:this,class:o,onclick:this._onMaxLabelClick,onkeydown:this._onMaxLabelKeyDown,role:r?"button":null,tabIndex:!this.disabled&&r?0:-1},e?this.renderMaxInput():i.max)}renderMin(){const{_isMinInputActive:e,labels:i,rangeLabelInputsEnabled:r,state:n}=this,s=this.visibleElements.rangeLabels,o=this.classes(Ri.minElement,{[Ri.hidden]:!s,[Ri.minElementInteractive]:r&&n!=="disabled",[Ri.rangeElementActive]:e});return te("div",{"aria-hidden":(!s).toString(),afterCreate:this._afterMinLabelCreate,bind:this,class:o,onclick:this._onMinLabelClick,onkeydown:this._onMinLabelKeyDown,role:r?"button":null,tabIndex:!this.disabled&&r?0:-1},e?this.renderMinInput():i.min)}renderMaxInput(){return te("input",{afterCreate:this._afterInputCreate,"aria-label":this.messages.maximumValue,bind:this,class:Ri.rangeInput,"data-input-type":"max",required:!0,tabIndex:this.disabled?-1:0,type:"text",value:this._formatInputValue(this.max,"max"),onblur:this._onMaxInputBlur,onkeydown:this._onInputKeyDown})}renderMinInput(){return te("input",{afterCreate:this._afterInputCreate,"aria-label":this.messages.minimumValue,bind:this,class:Ri.rangeInput,"data-input-type":"min",required:!0,tabIndex:this.disabled?-1:0,type:"text",value:this._formatInputValue(this.min,"min"),onblur:this._onMinInputBlur,onkeydown:this._onInputKeyDown})}renderExtraContentElements(){return te("div",{bind:this,class:Ri.extraContentElement},this.extraNodes)}renderTicksContainer(){if(this.tickConfigs&&this.trackElement&&(this._trackHeight!==0||this._trackWidth!==0))return this.tickConfigs.map((e,i)=>te("div",{key:"ticks-container",class:this.classes(Ri.ticksContainerElement)},this.renderTicks(e,i)))}renderTicks(e,i){const{mode:r,values:n}=e;if(this.tickElements.getItemAt(i)||this.tickElements.add(new tt,i),r==="position"){const a=Array.isArray(n)?n:[n];return this._calculateTickPositions(a).map((l,c)=>this.renderTickGroup(e,c,i,l))}if(r==="percent"&&Array.isArray(n)){const{max:a,min:l}=this,c=a-l,h=n.map(p=>this._applyPrecisionToPosition(p/100*c+l));return this._calculateTickPositions(h).map((p,f)=>this.renderTickGroup(e,f,i,p))}const s=Array.isArray(n)&&n.length?n[0]:isNaN(n)?null:n,o=this._getTickCounts(s,e);return this._calculateEquidistantTickPositions(o).map((a,l)=>this.renderTickGroup(e,l,i,a))}renderTickGroup(e,i,r,n){const s=e.mode==="position"?Array.isArray(e.values)?e.values[i]:e.values:this._valueFromPosition(n);if(!R(s)&&!isNaN(s))return te("div",{afterCreate:this._afterTickGroupCreate,afterRemoved:this._afterTickGroupRemoved,bind:this,"data-config":e,"data-position":n,"data-tick-config-index":r,"data-tick-group-index":i,"data-value":s,onclick:this._onTickGroupClick,key:`tick-group-${i}`},this.renderTickLine(e,i,r,s),e.labelsVisible?this.renderTickLabel(e,i,r,s):null)}renderTickLine(e,i,r,n){return te("div",{afterCreate:this._afterTickLineCreate,"aria-valuenow":n.toString(),bind:this,class:Ri.tickElement,"data-config":e,"data-tick-config-index":r,"data-tick-group-index":i,"data-value":n,key:`tick-label-${i}`,style:this._getPositionStyleForElement(n)})}renderTickLabel(e,i,r,n){const s=e.labelFormatFunction?e.labelFormatFunction(n,"tick",i):this.viewModel.getLabelForValue(n,"tick",i);return te("div",{afterCreate:this._afterTickLabelCreate,"aria-label":s,"aria-valuenow":n.toString(),"aria-valuetext":s,bind:this,class:Ri.tickLabelElement,"data-config":e,"data-tick-config-index":r,"data-tick-group-index":i,"data-value":n,key:`tick-label-${i}`,style:`transform: translate(-50%); ${this._getPositionStyleForElement(n)}`},s)}_afterContainerCreate(e){this.addHandles(kJe(e,()=>this.scheduleRender()))}_afterTrackCreate(e){this._set("trackElement",e),e.addEventListener("pointerdown",this._onTrackPointerDown),this.scheduleRender()}_afterTrackRemoved(e){e.removeEventListener("pointerdown",this._onTrackPointerDown),document.removeEventListener("pointermove",this._onTrackPointerMove),document.removeEventListener("pointerup",this._onTrackPointerUp)}_afterSegmentCreate(e){this.segmentElements.add(e),e.addEventListener("pointerdown",this._onSegmentPointerDown)}_afterSegmentRemoved(e){this.segmentElements.remove(e),e.removeEventListener("pointerdown",this._onSegmentPointerDown)}_afterEffectiveSegmentCreate(e){this.effectiveSegmentElements.add(e)}_afterEffectiveSegmentRemoved(e){this.effectiveSegmentElements.remove(e)}_afterAnchorCreate(e){if(this._anchorElements.push(e),e.addEventListener("pointerdown",this._onAnchorPointerDown),this.thumbCreatedFunction){const i=e["data-thumb-index"],r=e["data-value"],n=this.thumbElements.getItemAt(i)||null,s=this.labelElements.getItemAt(i)||null;this.thumbCreatedFunction(i,r,n,s)}}_afterAnchorUpdate(e){v(this._focusedAnchorIndex)&&e["data-thumb-index"]===this._focusedAnchorIndex&&(e.focus(),this._focusedAnchorIndex=null)}_afterAnchorRemoved(e){const i=this._anchorElements.indexOf(e,0);i>-1&&this._anchorElements.splice(i,1),e.removeEventListener("pointerdown",this._onAnchorPointerDown)}_afterThumbCreate(e){this.thumbElements.add(e)}_afterThumbRemoved(e){this.thumbElements.remove(e)}_afterLabelCreate(e){this.labelElements.add(e),e.addEventListener("pointerdown",this._onLabelPointerDown),e.addEventListener("pointerup",this._onLabelPointerUp)}_afterLabelRemoved(e){this.labelElements.remove(e),e.removeEventListener("pointerdown",this._onLabelPointerDown),e.removeEventListener("pointerup",this._onLabelPointerUp)}_afterInputCreate(e){if(e.focus(),e.select(),this.inputCreatedFunction){const i=e.getAttribute("data-input-type"),r=i==="thumb"?e["data-input-index"]:null;this.inputCreatedFunction(e,i,r)}}_afterTickLineCreate(e){const i=e["data-tick-config-index"],r=e["data-tick-group-index"],n=this.tickElements.getItemAt(i);n.getItemAt(r)?n.getItemAt(r).tickElement=e:n.add({groupElement:null,tickElement:e,labelElement:null},r)}_afterTickLabelCreate(e){const i=e["data-tick-config-index"],r=e["data-tick-group-index"],n=this.tickElements.getItemAt(i);n.getItemAt(r)?n.getItemAt(r).labelElement=e:n.add({groupElement:null,labelElement:e,tickElement:null},r)}_afterTickGroupRemoved(e){const i=e["data-tick-config-index"],r=this.tickElements.items[i],n=r==null?void 0:r.find(s=>s.groupElement===e);n&&r.remove(n)}_afterTickGroupCreate(e){var r,n;const i=e["data-config"];if(i&&i.tickCreatedFunction){const s=e["data-tick-config-index"],o=e["data-tick-group-index"],a=e["data-value"],l=(n=(r=this.tickElements)==null?void 0:r.getItemAt(s))==null?void 0:n.getItemAt(o);if(l){l.groupElement=e;const c=l.tickElement||null,h=l.labelElement||null;i.tickCreatedFunction(a,c,h)}}}_afterMaxLabelCreate(e){this._set("maxLabelElement",e)}_afterMinLabelCreate(e){this._set("minLabelElement",e)}_onAnchorKeyDown(e){if(this._isDisabled()||this.state==="editing")return;const{target:i}=e,r=up(e),{_anchorElements:n,values:s}=this,o=i["data-thumb-index"],a=n[o],l=s[o],c=[uu.moveAnchorUp,uu.moveAnchorDown,uu.moveAnchorLeft,uu.moveAnchorRight];if(r===uu.showInput&&this.labelInputsEnabled)this._activeLabelInputIndex=o,this.notifyChange("state");else if(c.includes(r)){e.preventDefault();const{steps:h}=this,p=r===uu.moveAnchorUp||r===uu.moveAnchorRight?1:-1;if(v(h))this._toStep(o,this._isReversedLayout()?-1*p:p);else{const{precision:m}=this,g=this._getPositionOfElement(a),_=this._valueFromPosition(g),b=this._isHorizontalLayout()?p:-1*p;let w;w=m===0?this._positionFromValue(_+b):m===1?this._positionFromValue(_+.1*b):g+b,this._toPosition(o,w)}const f=this.values[o];l!==f&&this._emitThumbChangeEvent({index:o,oldValue:l,value:f})}else if(r===uu.moveAnchorToMax||r===uu.moveAnchorToMin){e.preventDefault();const{min:h,max:p}=this._getAnchorBoundsInPixels(o),f=this._isPositionInverted()?r===uu.moveAnchorToMax?h:p:r===uu.moveAnchorToMin?h:p;this._toPosition(o,f);const m=this.values[o];l!==m&&this._emitThumbChangeEvent({index:o,oldValue:l,value:m})}}_onAnchorPointerDown(e){if(this._isDisabled())return;const{target:i,clientX:r,clientY:n}=e,s=i["data-thumb-index"];s!==void 0&&(e.preventDefault(),this._anchorElements[s]&&this._anchorElements[s].focus(),this._storeTrackDimensions(),this._dragStartInfo={clientX:r,clientY:n,index:s,position:this._getPositionOfElement(this._anchorElements[s])},this.notifyChange("state"),document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove))}_onAnchorPointerMove(e){if(this.state==="editing"||!this._dragStartInfo)return;e.preventDefault();const{values:i,_anchorElements:r,_dragged:n,_dragStartInfo:s,_dragStartInfo:{index:o,position:a}}=this,{clientX:l,clientY:c}=e,h=n?"drag":"start",p=r[o],f=this._getPositionOfElement(p),m=this._applyPrecisionToPosition(this._isHorizontalLayout()?a+l-s.clientX:a+c-s.clientY);if(f===m)return;const g=i[o];this._dragged=!0,this._toPosition(o,m);const _=this.values[o];n?g!==_&&this._emitThumbDragEvent({index:o,state:h,value:_}):this._emitThumbDragEvent({index:o,state:h,value:g})}_onAnchorPointerUp(e){if(document.removeEventListener("pointerup",this._onAnchorPointerUp),document.removeEventListener("pointermove",this._onAnchorPointerMove),!this._dragStartInfo)return;e.preventDefault();const{index:i}=this._dragStartInfo,r=this._dragged,n=this.values[i];this._dragged=!1,this._dragStartInfo=null,this._lastMovedHandleIndex=i,this.notifyChange("state"),r?this._emitThumbDragEvent({index:i,state:"stop",value:n}):(this.scheduleRender(),this.state!=="editing"&&this._emitThumbClickEvent({index:i,value:n}))}_onTrackPointerDown(e){const{_dragStartInfo:i,snapOnClickEnabled:r,state:n,values:s}=this;if(this._isDisabled()||n==="editing"||i||(document.addEventListener("pointermove",this._onTrackPointerMove),document.addEventListener("pointerup",this._onTrackPointerUp),!r||!s.length))return;const{steps:o}=this,{clientX:a,clientY:l}=e,c=this._getCursorPositionFromEvent(e),h=this._valueFromPosition(c),p=this._getIndexOfNearestValue(h),f=s[p],m=s.some((w,x)=>w===f&&x!==p)&&h>f?this.values.lastIndexOf(f):p;if(R(m))return;const g=s[m],_=v(o)?this._calculateNearestStepPosition(c):c;this._toPosition(m,_),this._dragged=!0,this._dragStartInfo={clientX:a,clientY:l,index:m,position:_},this._focusedAnchorIndex=m,this.notifyChange("state"),this._emitThumbDragEvent({index:m,state:"start",value:g});const b=this.values[m];g!==b&&this._emitThumbDragEvent({index:m,state:"drag",value:b}),document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove)}_onTrackPointerMove(e){e.preventDefault(),this._dragged=!0}_onTrackPointerUp(e){if(e.preventDefault(),document.removeEventListener("pointermove",this._onTrackPointerMove),document.removeEventListener("pointerup",this._onTrackPointerUp),this.snapOnClickEnabled||(this._dragged=!1),!this._dragged){const i=this._getCursorPositionFromEvent(e),r=this._valueFromPosition(i);this._emitTrackClickEvent({value:r})}}_onSegmentPointerDown(e){var l,c;e.preventDefault();const i=e.target,r=i["data-segment-index"],n=i["data-min-thumb-index"],s=i["data-max-thumb-index"];if(this._isDisabled()||R(n)||R(s))return;e.stopPropagation(),this._storeTrackDimensions(),document.addEventListener("pointerup",this._onSegmentPointerUp);const o=this._getAnchorDetails(n),a=this._getAnchorDetails(s);this.syncedSegmentsEnabled?(this.segmentElements.forEach(h=>h.classList.add(Ri.segmentElementActive)),this._anchorElements.forEach(h=>h.classList.add(Ri.anchorElementActive))):(this.segmentElements.getItemAt(r).classList.add(Ri.segmentElementActive),(l=this._anchorElements[o.index])==null||l.classList.add(Ri.anchorElementActive),(c=this._anchorElements[a.index])==null||c.classList.add(Ri.anchorElementActive)),this._segmentDragStartInfo={cursorPosition:this._getCursorPositionFromEvent(e),index:r,details:this._normalizeSegmentDetails({min:o,max:a})},this.draggableSegmentsEnabled&&(document.addEventListener("pointermove",this._onSegmentPointerMove),this.notifyChange("state"),this._emitSegmentDragEvent({index:r,state:"start",thumbIndices:[n,s]}))}_onSegmentPointerMove(e){if(!this._segmentDragStartInfo)return;e.preventDefault();const{_trackHeight:i,_trackWidth:r,_segmentDragStartInfo:{index:n,cursorPosition:s,details:{min:o,max:a}}}=this,{index:l,position:c,value:h}=o,{index:p,position:f,value:m}=a;this._dragged=!0;const g=this._getCursorPositionFromEvent(e);if(g===s)return;const _=this._positionToPercent(s),b=this._positionToPercent(g)-_,w=this._positionToPercent(c)+b,x=this._positionToPercent(f)+b,{min:T}=this._getAnchorBoundsAsPercents(l),{max:E}=this._getAnchorBoundsAsPercents(p);let C=!1,A=!1;if(w<T?C=!0:x>E&&(A=!0),C){const{min:ie,max:J}=this.viewModel.getBoundsForValueAtIndex(l),q=this._isPositionInverted()?J:ie,N=q,L=m+(q-h),F=L-this.values[p];return void(this.syncedSegmentsEnabled?this._updateAnchorValuesByDifference(F):this._updateAnchorValues([l,p],[N,L]))}if(A){const{min:ie,max:J}=this.viewModel.getBoundsForValueAtIndex(p),q=this._isPositionInverted()?ie:J,N=q,L=h+(q-m),F=L-this.values[l];return void(this.syncedSegmentsEnabled?this._updateAnchorValuesByDifference(F):this._updateAnchorValues([l,p],[L,N]))}const I=this._isHorizontalLayout()?r:i,O=x/100*I,D=w/100*I,U=this.values,V=[U[l],U[p]],B=this._getValueForAnchorAtPosition(l,D),ee=this._getValueForAnchorAtPosition(p,O);this.syncedSegmentsEnabled?this._updateAnchorValuesByDifference(B-V[0]):this._updateAnchorValues([l,p],[B,ee]),[this.values[l],this.values[p]].every((ie,J)=>ie===V[J])||this._emitSegmentDragEvent({index:n,state:"drag",thumbIndices:[l,p]})}_onSegmentPointerUp(e){if(e.preventDefault(),document.removeEventListener("pointerup",this._onSegmentPointerUp),document.removeEventListener("pointermove",this._onSegmentPointerMove),!this._segmentDragStartInfo)return;const{_dragged:i,max:r,min:n,values:s}=this,{index:o,details:{min:{index:a},max:{index:l}}}=this._segmentDragStartInfo;if(this.segmentElements.forEach(c=>c.classList.remove(Ri.segmentElementActive)),this._anchorElements.forEach(c=>c.classList.remove(Ri.anchorElementActive)),this.draggableSegmentsEnabled){const c=r-n,h=s[a],p=s[l];this._lastMovedHandleIndex=h===p?h>c/2?a:l:null,this._dragged=!1,this._segmentDragStartInfo=null,this.notifyChange("state"),this._emitSegmentDragEvent({index:o,state:"stop",thumbIndices:[a,l]})}if(!i){const c=this._getCursorPositionFromEvent(e),h=this._valueFromPosition(c);this._emitSegmentClickEvent({index:o,value:h,thumbIndices:[a,l]})}}_onTickGroupClick(e){const i=e.target;if(i["data-config"]){const r=i["data-tick-config-index"],n=i["data-tick-group-index"],s=i["data-value"];this._emitTickClickEvent({configIndex:r,groupIndex:n,value:s})}}_storeTrackDimensions(){if(this.trackElement){const e=this._getDimensions(this.trackElement);this._trackHeight=e.height,this._trackWidth=e.width}}_onLabelPointerDown(){this._isDisabled()||(this._dragged=!1,document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove))}_onLabelPointerMove(){this._isDisabled()||(this._dragged=!0)}_onLabelPointerUp(e){if(this._isDisabled())return;const i=e.target["data-thumb-index"];this.labelInputsEnabled&&!this._dragged&&v(i)&&(this._activeLabelInputIndex=i),this._dragged=!1,this.notifyChange("state"),document.removeEventListener("pointerup",this._onLabelPointerUp),document.removeEventListener("pointermove",this._onLabelPointerMove)}_onLabelInputBlur(e){const{_activeLabelInputIndex:i,values:r,viewModel:n}=this,s=e.target.value;if(this._activeLabelInputIndex=null,this.notifyChange("state"),!s)return;const o=this._parseInputValue(s,"value",i),a=r[i],{min:l,max:c}=this.viewModel.getBoundsForValueAtIndex(i);if(o<l||o>c)return;n.setValue(i,o);const h=this.values[i];a!==h&&this._emitThumbChangeEvent({index:i,oldValue:a,value:h})}_onInputKeyDown(e){if(this._isDisabled())return;const{target:i}=e,r=up(e),{hideInput1:n,hideInput2:s,hideInput3:o}=uu,{_activeLabelInputIndex:a,_anchorElements:l}=this,c=i;if(r===n||r===s||r===o){e.stopPropagation();const h=a;c.blur(),v(h)?l[h].focus():c.parentElement.focus()}}_onMaxLabelClick(){this._isDisabled()||(this._emitRangeLabelClickEvent({type:"max-click",value:this.max}),this.rangeLabelInputsEnabled&&(this._isMaxInputActive=!0,this.notifyChange("state")))}_onMaxLabelKeyDown(e){this._isDisabled()||up(e)!==uu.showInput||(this._isMaxInputActive=!0,this.notifyChange("state"))}_onMaxInputBlur(e){const i=e.target.value;if(this._isMaxInputActive=!1,this.notifyChange("state"),!i)return;const r=this.max,n=this._parseInputValue(i,"max");n<=this.min||(this.viewModel.set("max",n),this.max!==r&&this._emitMaxChangeEvent({oldValue:r,value:this.max}))}_onMinLabelClick(){this._isDisabled()||(this._emitRangeLabelClickEvent({type:"min-click",value:this.min}),this.rangeLabelInputsEnabled&&(this._isMinInputActive=!0,this.notifyChange("state")))}_onMinLabelKeyDown(e){this._isDisabled()||up(e)!==uu.showInput||(this._isMinInputActive=!0,this.notifyChange("state"))}_onMinInputBlur(e){const i=e.target.value;if(this._isMinInputActive=!1,this.notifyChange("state"),!i)return;const r=this.min,n=this._parseInputValue(i,"min");n>=this.max||(this.viewModel.set("min",n),this.min!==r&&this._emitMinChangeEvent({oldValue:r,value:this.min}))}_isDisabled(){return this.disabled||this.state==="disabled"}_positionFromValue(e){const{max:i,min:r}=this,n=i-r;if(n===0)return 0;const{_trackHeight:s,_trackWidth:o}=this,a=this._isHorizontalLayout();let l=parseFloat(a?(o*(e-r)/n).toFixed(2):(s*(i-e)/n).toFixed(2));return this._isReversedLayout()&&(l=a?o-l:s-l),l}_valueFromPosition(e){const{_trackHeight:i,_trackWidth:r,max:n,min:s,precision:o}=this,a=n-s;let l=this._isHorizontalLayout()?e*a/r+s:a*(1e3-e/i*1e3)/1e3+s;return this._isReversedLayout()&&(l=n+s-l),parseFloat(l.toFixed(o))}_positionToPercent(e){const{_trackHeight:i,_trackWidth:r}=this,n=100*e/(this._isHorizontalLayout()?r:i);return this._applyPrecisionToPosition(n)}_applyPrecisionToPosition(e){return parseFloat(e.toFixed(this._positionPrecision))}_isPositionInverted(){const{layout:e}=this;return e==="horizontal-reversed"||e==="vertical"}_isHorizontalLayout(){return this.layout.includes("horizontal")}_isReversedLayout(){return this.layout.includes("reversed")}_normalizeSegmentDetails(e){if(this._isPositionInverted()){const{min:i,max:r}=e;return{min:r,max:i}}return e}_parseInputValue(e,i,r){return this.inputParseFunction?this.inputParseFunction(e,i,r):this.viewModel.defaultInputParseFunction(e)}_formatInputValue(e,i,r){return this.inputFormatFunction?this.inputFormatFunction(e,i,r):this.viewModel.defaultInputFormatFunction(e)}_getAnchorDetails(e){const i=[...this.values].sort((n,s)=>n-s)[e],r=this.values.indexOf(i);return{index:r,position:this._getPositionOfElement(this._anchorElements[r]),value:i}}_updateAnchorStyle(e,i){const r=this._anchorElements[e];r&&(this._isHorizontalLayout()?r.style.left=`${i}`:r.style.top=`${i}`)}_getStyleForAnchor(e,i,r){const n=this._getPositionStyleForElement(e);if(this.values.length===1)return`${n}`;const s=this._zIndices[i];return`${n}; z-index: ${r?this._zIndexOffset+s:s}`}_getPositionStyleForElement(e){const i=this._positionFromValue(e),r=this._positionToPercent(i);return`${this._isHorizontalLayout()?"left":"top"}: ${r+"%"}`}_getPositionOfElement(e){const i=this._getDimensions(e.offsetParent),r=this._getDimensions(e);return this._isHorizontalLayout()?this._applyPrecisionToPosition(r.left-i.left):this._applyPrecisionToPosition(r.top-i.top)}_updateAnchorValues(e,i){e.forEach((r,n)=>this._toValue(r,i[n]))}_updateAnchorValuesByDifference(e){const{min:i,max:r,values:n}=this;n.forEach((s,o)=>this._toValue(o,Math.max(Math.min(s+e,r),i)))}_toValue(e,i){v(this.steps)&&(i=this._getStepValues()[this._getIndexOfNearestStepValue(i)]),this._updateAnchorStyle(e,this._getPositionStyleForElement(i)),this.viewModel.setValue(e,i)}_toPosition(e,i){const r=v(this.steps)?this._getStepValueForAnchorAtPosition(e,i):this._getValueForAnchorAtPosition(e,i);this._updateAnchorStyle(e,this._getPositionStyleForElement(r)),this.viewModel.setValue(e,r)}_getValueForAnchorAtPosition(e,i){const{min:r,max:n}=this._getAnchorBoundsInPixels(e),{min:s,max:o}=this.viewModel.getBoundsForValueAtIndex(e);let a,l,c=null;return this._isPositionInverted()?(a=s,l=o):(a=o,l=s),c=i>n?a:i<r?l:this._valueFromPosition(i),c>o?c=o:c<s&&(c=s),c}_getStepValueForAnchorAtPosition(e,i){const r=this._getStepValues(),n=this._calculateNearestStepPosition(i),s=this._getValueForAnchorAtPosition(e,n);return r[this._getIndexOfNearestStepValue(s)]}_getAnchorBoundsAsPercents(e){const{min:i,max:r}=this._getAnchorBoundsInPixels(e);return{min:this._positionToPercent(i),max:this._positionToPercent(r)}}_getAnchorBoundsInPixels(e){const{_anchorElements:i,_trackHeight:r,_trackWidth:n,effectiveMax:s,effectiveMin:o,thumbsConstrained:a}=this,l=i[e-1],c=i[e+1],h=this._isHorizontalLayout()?n:r;let p,f;return this._isPositionInverted()?(p=v(o)?this._positionFromValue(o):h,f=v(s)?this._positionFromValue(s):0):(p=v(s)?this._positionFromValue(s):h,f=v(o)?this._positionFromValue(o):0),a?this._isPositionInverted()?{max:l?this._getPositionOfElement(l):p,min:c?this._getPositionOfElement(c):f}:{max:c?this._getPositionOfElement(c):p,min:l?this._getPositionOfElement(l):f}:{max:p,min:f}}_getIndexOfNearestValue(e){return this.values.indexOf(this.values.reduce((i,r)=>Math.abs(r-e)<Math.abs(i-e)?r:i))}_getCursorPositionFromEvent(e){const i=this._getDimensions(this.trackElement);return this._isHorizontalLayout()?e.clientX-i.left:e.clientY-i.top}_getStepValues(){const{steps:e}=this;if(Array.isArray(e))return e;const{max:i,min:r}=this,n=Math.ceil((i-r)/e),s=[];for(let o=0;o<=n;o++){const a=r+e*o;s.push(a>i?i:a)}return s}_toStep(e,i){const{values:r,viewModel:n}=this,s=r[e],o=this._getStepValues(),a=o.indexOf(s);let l=null;if(a>-1){let c=o[a+i];isNaN(c)&&(c=o[a]);const h=this._positionFromValue(c);l=this._getStepValueForAnchorAtPosition(e,h)}else l=o[this._getIndexOfNearestStepValue(s)+i];n.setValue(e,l)}_getIndexOfNearestStepValue(e){const{steps:i}=this;if(R(i))return null;const r=this._getStepValues(),n=r.reduce((s,o)=>Math.abs(o-e)<Math.abs(s-e)?o:s);return r.indexOf(n)}_calculateNearestStepPosition(e){const i=this._valueFromPosition(e),r=this._getIndexOfNearestStepValue(i),n=this._getStepValues();return this._positionFromValue(n[r])}_getTickCounts(e,i){const{mode:r}=i;return r==="count"||r==="position"?e||0:r==="percent"&&100/e||0}_calculateTickPositions(e){return e.map(i=>this._positionFromValue(i))}_calculateEquidistantTickPositions(e){const{_trackWidth:i,_trackHeight:r}=this,n=this._isHorizontalLayout()?i:r,s=n/(e-1),o=[];if(e===1)return[n/2];for(let a=0;a<e;a++){const l=a*s;l<=n&&o.push(l)}return o}_getDimensions(e){try{return e.getBoundingClientRect()}catch(i){if(typeof i=="object"&&i!==null)return new DOMRect(0,0,0,0);throw i}}_emitTrackClickEvent(e){this.emit("track-click",{...e,type:"track-click"})}_emitTickClickEvent(e){this.emit("tick-click",{...e,type:"tick-click"})}_emitMaxChangeEvent(e){this.emit("max-change",{...e,type:"max-change"})}_emitMinChangeEvent(e){this.emit("min-change",{...e,type:"min-change"})}_emitThumbChangeEvent(e){this.emit("thumb-change",{...e,type:"thumb-change"})}_emitThumbClickEvent(e){this.emit("thumb-click",{...e,type:"thumb-click"})}_emitThumbDragEvent(e){this.emit("thumb-drag",{...e,type:"thumb-drag"})}_emitSegmentClickEvent(e){this.emit("segment-click",{...e,type:"segment-click"})}_emitSegmentDragEvent(e){this.emit("segment-drag",{...e,type:"segment-drag"})}_emitRangeLabelClickEvent(e){this.emit(e.type,{...e})}};u([d()],qi.prototype,"disabled",void 0),u([d()],qi.prototype,"draggableSegmentsEnabled",void 0),u([d()],qi.prototype,"effectiveMax",null),u([d()],qi.prototype,"effectiveMin",null),u([d({readOnly:!0})],qi.prototype,"effectiveSegmentElements",void 0),u([d()],qi.prototype,"extraNodes",void 0),u([d()],qi.prototype,"inputCreatedFunction",void 0),u([d()],qi.prototype,"inputFormatFunction",null),u([d()],qi.prototype,"inputParseFunction",null),u([d()],qi.prototype,"label",null),u([d({readOnly:!0})],qi.prototype,"labelElements",void 0),u([d()],qi.prototype,"labelInputsEnabled",void 0),u([d()],qi.prototype,"labelFormatFunction",null),u([d({readOnly:!0})],qi.prototype,"labels",null),u([d({value:"horizontal"})],qi.prototype,"layout",null),u([d()],qi.prototype,"max",null),u([d({readOnly:!0})],qi.prototype,"maxLabelElement",void 0),u([d(),Go("esri/widgets/Slider/t9n/Slider")],qi.prototype,"messages",void 0),u([d()],qi.prototype,"min",null),u([d({readOnly:!0})],qi.prototype,"minLabelElement",void 0),u([d()],qi.prototype,"precision",null),u([d()],qi.prototype,"rangeLabelInputsEnabled",void 0),u([d({readOnly:!0})],qi.prototype,"segmentElements",void 0),u([d()],qi.prototype,"snapOnClickEnabled",void 0),u([d({readOnly:!0})],qi.prototype,"state",null),u([d()],qi.prototype,"steps",void 0),u([d()],qi.prototype,"syncedSegmentsEnabled",void 0),u([d()],qi.prototype,"thumbsConstrained",null),u([d()],qi.prototype,"thumbCreatedFunction",void 0),u([d({readOnly:!0})],qi.prototype,"thumbElements",void 0),u([d()],qi.prototype,"tickConfigs",null),u([d({readOnly:!0})],qi.prototype,"tickElements",void 0),u([d({readOnly:!0})],qi.prototype,"trackElement",void 0),u([d()],qi.prototype,"values",null),u([d()],qi.prototype,"viewModel",void 0),u([d()],qi.prototype,"visibleElements",void 0),u([ri("visibleElements")],qi.prototype,"castVisibleElements",null),qi=u([$(eUt)],qi);const tUt=qi;function iUt(){const t=ut.useRef(null),e=ut.useRef(null),i=ut.useRef(null),[r,n]=ut.useState(null),[s,o]=ut.useState(null);ut.useEffect(()=>{a()},[]);async function a(){if(xLe.highlightAll(),!(t!=null&&t.current))return;nr.portalUrl="http://arcgis.com/";const h=new FB({basemap:{portalItem:{id:"eb303185d14e45e9be8bbbc1c0daf7ab"}}}),p=new K6t({container:t==null?void 0:t.current,map:h,center:[-80,40],constraints:{altitude:{min:2e6}}});p.ui.add([new LQ({view:p,content:e==null?void 0:e.current,expanded:!0,group:"group1",expandTooltip:"MediaLayer"})],"top-left"),n(p)}async function l(){const h=new aae({video:"/aerosol.mp4",georeference:new nae({extent:new ni({xmin:-150,ymin:1,xmax:20,ymax:80,spatialReference:{wkid:4326}})})}),p=new lae({source:[h],title:"2017 Hurricanes and Aerosols Simulation",copyright:"NASA's Goddard Space Flight Center"});r.map.layers.add(p),await r.when(),await p.when(),o(p),new tUt({min:0,max:1,precision:2,values:[1],visibleElements:{labels:!0,rangeLabels:!0},container:i.current}).on("thumb-drag",m=>{const{value:g}=m;p.opacity=g})}return MS("div",{className:"App",children:[Cr("div",{id:"view",ref:t}),MS("div",{ref:e,className:"card",children:[Cr("p",{children:"MediaLayer"}),Cr("pre",{className:"line-numbers",children:Cr("code",{className:"language-js",children:`new MediaLayer({ 
    source: new VideoElement({
      video: "/aerosol.mp4",
      georeference: new ExtentAndRotationGeoreference({
        extent: new Extent({
          xmin: -150, ymin: 1, xmax: 20, ymax: 80,
          spatialReference: { wkid: 4326 }
        })
      })
    }) 
  });`})}),Cr("div",{ref:i,className:"slider"}),Cr(UQ,{className:"btn","icon-start":"play",onClick:l})]})]})}function rUt(t){return t&&"getAtOrigin"in t&&"originOf"in t}function nUt(t){t&&t.writtenProperties&&t.writtenProperties.forEach(({target:e,propName:i,newOrigin:r})=>{rUt(e)&&r&&e.originOf(i)!==r&&e.updateOrigin(i,r)})}async function sUt(t,e,i){e=e.clone(),t.capabilities.query.supportsMaxRecordCountFactor&&(e.maxRecordCountFactor=cVe(t));const r=oUt(t),n=t.capabilities.query.supportsPagination;e.start=0,e.num=r;let s=null;for(;;){const o=await t.source.queryFeaturesJSON(e,i);if(R(s)?s=o:s.features=s.features.concat(o.features),s.exceededTransferLimit=o.exceededTransferLimit,!n||!o.exceededTransferLimit)break;e.start+=r}return s}function oUt(t){return cVe(t)*aUt(t)}function aUt(t){return t.capabilities.query.maxRecordCount||2e3}function cVe(t){return t.capabilities.query.supportsMaxRecordCountFactor?xp.MAX_MAX_RECORD_COUNT_FACTOR:1}let M0=class extends fe{constructor(e){super(e),this.moment=null,this.fullUpdate=!1,this.validateErrorsCreated=!1,this.dirtyAreaCount=null,this.exceededTransferLimit=null,this.serviceEdits=null}};u([d({type:Date,json:{type:Number,write:{writer:(t,e)=>{e.moment=t?t.getTime():null}}}})],M0.prototype,"moment",void 0),u([d({type:Boolean,json:{write:!0}})],M0.prototype,"fullUpdate",void 0),u([d({type:Boolean,json:{write:!0}})],M0.prototype,"validateErrorsCreated",void 0),u([d({type:Number,json:{write:!0}})],M0.prototype,"dirtyAreaCount",void 0),u([d({type:Boolean,json:{write:!0}})],M0.prototype,"exceededTransferLimit",void 0),u([d({type:[Object],json:{write:!0}})],M0.prototype,"serviceEdits",void 0),M0=u([$("esri.rest.networks.support.ValidateNetworkTopologyResult")],M0);const lUt=M0,cUt=Wa()({Pending:"job-waiting",InProgress:"job-executing",Completed:"job-succeeded"});let I1=class extends lUt{constructor(e){super(e),this.featureServiceUrl=null,this.statusUrl=null,this.status=null,this.submissionTime=null,this.lastUpdatedTime=null,this._timer=void 0}destroy(){clearInterval(this._timer)}async checkJobStatus(e){const i={...e,query:{f:"json"}},{data:r}=await ir(this.statusUrl,i);if(this.read(r),(this.serviceEdits||this.exceededTransferLimit)&&this.featureServiceUrl){const n={edits:null,addedFeatures:[],updatedFeatures:[],deletedFeatures:[],addedAttachments:[],updatedAttachments:[],deletedAttachments:[],exceededTransferLimit:!0};doe.emit("edits",{serviceUrl:this.featureServiceUrl??"",layerId:null,event:n})}return this}async waitForJobCompletion(e={}){const{interval:i=1e3,statusCallback:r}=e;return new Promise((n,s)=>{this._clearTimer();const o=setInterval(()=>{this._timer||s(Bi()),this.checkJobStatus().then(a=>{const{status:l}=a;switch(this.status=l,l){case"job-succeeded":this._clearTimer(),n(this);break;case"job-waiting":case"job-executing":r&&r(this)}},a=>{this._clearTimer(),s(a)})},i);this._timer=o})}_clearTimer(){clearInterval(this._timer),this._timer=void 0}};u([d()],I1.prototype,"featureServiceUrl",void 0),u([d({type:String,json:{write:!0}})],I1.prototype,"statusUrl",void 0),u([ot(cUt)],I1.prototype,"status",void 0),u([d({type:Date,json:{type:Number,write:{writer:(t,e)=>{e.submissionTime=t?t.getTime():null}}}})],I1.prototype,"submissionTime",void 0),u([d({type:Date,json:{type:Number,write:{writer:(t,e)=>{e.lastUpdatedTime=t?t.getTime():null}}}})],I1.prototype,"lastUpdatedTime",void 0),I1=u([$("esri.networks.support.TopologyValidationJobInfo")],I1);const uUt=I1;async function Hwe(t,e){if(t==="Utility Network Layer"){const{default:i}=await Q(()=>Promise.resolve().then(()=>bUt),void 0);return new i({layerUrl:e})}return null}async function hUt(t){let e="portalItem"in t?t:{portalItem:t};!e.portalItem||e.portalItem instanceof l_||(e={...e,portalItem:new l_(e.portalItem)});const i=e.portalItem;if(await i.load(),i.type!=="Feature Service")throw new H("portal:unknown-item-type","Unknown item type '${type}'",{type:i.type});const r=i.url,n=await ir(r,{responseType:"json",query:{f:"json"}}),s="Network Layer";if(n.data.type&&n.data.type.includes(s))return Hwe(n.data.type,r);if(n.data.layers){const o=n.data.layers.find(a=>a.type.includes(s));if(o){const a=`${r}/${o.id}`;return Hwe(o.type,a)}}return null}let zT=class extends fe{constructor(e){super(e),this.globalIds=[],this.creators=[],this.tags=[],this.names=[]}};u([d({type:[String],json:{write:!0}})],zT.prototype,"globalIds",void 0),u([d({type:[String],json:{write:!0}})],zT.prototype,"creators",void 0),u([d({type:[String],json:{write:!0}})],zT.prototype,"tags",void 0),u([d({type:[String],json:{write:!0}})],zT.prototype,"names",void 0),zT=u([$("esri.rest.networks.support.QueryNamedTraceConfigurationsParameters")],zT);const dUt=zT;let oa=class extends FN(Ju){static fromPortalItem(t){return hUt(t)}constructor(t){super(t),this.id=null,this.title=null,this.layerUrl=null,this.dataElement=null,this.fullExtent=null,this.spatialReference=null,this.type=null,this.sourceJSON=null}initialize(){this.when().catch(t=>{gs(t)||re.getLogger(this.declaredClass).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:t})})}get datasetName(){var t;return((t=this.dataElement)==null?void 0:t.name)??null}get owner(){var t;return((t=this.dataElement)==null?void 0:t.userIdentity)??null}get schemaGeneration(){var t;return((t=this.dataElement)==null?void 0:t.schemaGeneration)??null}get parsedUrl(){return Bo(this.layerUrl)}get featureServiceUrl(){const t=this.parsedUrl&&dw(this.parsedUrl.path);return v(t)?t.url.path:null}get networkServiceUrl(){return this.featureServiceUrl?this.featureServiceUrl.replace(/\/FeatureServer/i,"/UtilityNetworkServer"):null}get layerId(){const t=this.parsedUrl&&dw(this.parsedUrl.path);return v(t)?t.sublayer:null}get networkSystemLayers(){return null}async load(t){return this.addResolvingPromise(this._fetchDataElement(this.featureServiceUrl,this.layerId.toString(),t)),this.addResolvingPromise(this._fetchLayerMetaData(this.layerUrl,t)),this}getLayerIdBySourceId(t){if(this.dataElement){const e=this.dataElement.domainNetworks;for(const i of e){for(const r of i.edgeSources?i.edgeSources:[])if(r.sourceId===t)return r.layerId;for(const r of i.junctionSources?i.junctionSources:[])if(r.sourceId===t)return r.layerId}return null}return null}async queryNamedTraceConfigurations(t,e){var s;const{queryNamedTraceConfigurations:i}=await Q(()=>import("./queryNamedTraceConfigurations-6181c711.js"),[]),r=this.networkServiceUrl,n=new dUt({...t});return((s=await i(r,n,{...e}))==null?void 0:s.namedTraceConfigurations)??null}async validateTopology(t,e){if(!t.validateArea)throw new H("network:undefined-validateArea","the network must have validateArea defined in the validate network topology parameters.");const{validateNetworkTopology:i}=await Q(()=>import("./validateNetworkTopology-30095cff.js"),[]),r=this.networkServiceUrl,n=await i(r,t,{...e});if(n!=null&&n.serviceEdits){const s={edits:null,addedFeatures:[],updatedFeatures:[],deletedFeatures:[],addedAttachments:[],updatedAttachments:[],deletedAttachments:[],editedFeatures:n.serviceEdits,exceededTransferLimit:!1};doe.emit("edits",{serviceUrl:this.featureServiceUrl??"",layerId:null,event:s})}return n}async submitTopologyValidationJob(t,e){if(!t.validateArea)throw new H("network:undefined-validateArea","the network must have validateArea defined in the validate network topology parameters.");if(!t.gdbVersion)throw new H("network:undefined-gdb-version","version must be defined");const{submitValidateNetworkTopologyJob:i}=await Q(()=>import("./validateNetworkTopology-30095cff.js"),[]),r=this.networkServiceUrl,n=await i(r,t,{...e});return new uUt({statusUrl:n,featureServiceUrl:this.featureServiceUrl})}async _fetchLayerMetaData(t,e){const i=await ir(t,{responseType:"json",query:{f:"json"},...e});this.sourceJSON=i.data,this.read(i.data,{origin:"service"})}async _fetchDataElement(t,e,i){if(this.dataElement)return;const r=await ir(`${t}/queryDataElements`,{responseType:"json",query:{layers:JSON.stringify([e]),f:"json"},...i}).then(n=>{var s;return(s=n.data.layerDataElements)==null?void 0:s[0]});r&&this.read(r,{origin:"service"})}};u([d({type:String,nonNullable:!0,json:{origins:{"web-map":{read:!0,write:{isRequired:!0}},service:{read:!0}},read:!1}})],oa.prototype,"id",void 0),u([d({type:String,nonNullable:!0,json:{origins:{"web-map":{read:!0,write:{isRequired:!0}},service:{read:{source:"name"}}},read:!1}})],oa.prototype,"title",void 0),u([d({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"url"},write:{target:"url",isRequired:!0}}},read:!1}})],oa.prototype,"layerUrl",void 0),u([d({type:Object,json:{origins:{service:{read:!0}},read:!1}})],oa.prototype,"dataElement",void 0),u([d({type:ni,json:{origins:{service:{read:{source:"extent"}}},read:!1}})],oa.prototype,"fullExtent",void 0),u([d({type:Je,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:!1}})],oa.prototype,"spatialReference",void 0),u([d({type:["utility","trace"],readOnly:!0,json:{read:!1,write:!1}})],oa.prototype,"type",void 0),u([d({readOnly:!0})],oa.prototype,"datasetName",null),u([d({readOnly:!0})],oa.prototype,"owner",null),u([d({readOnly:!0})],oa.prototype,"schemaGeneration",null),u([d({readOnly:!0})],oa.prototype,"parsedUrl",null),u([d({readOnly:!0})],oa.prototype,"featureServiceUrl",null),u([d({readOnly:!0})],oa.prototype,"networkServiceUrl",null),u([d({readOnly:!0})],oa.prototype,"layerId",null),u([d()],oa.prototype,"sourceJSON",void 0),u([d({readOnly:!0})],oa.prototype,"networkSystemLayers",null),oa=u([$("esri.networks.Network")],oa);const pUt=oa;var qh;(function(t){t[t.RTJunctionJunctionConnectivity=1]="RTJunctionJunctionConnectivity",t[t.RTContainment=2]="RTContainment",t[t.RTAttachment=3]="RTAttachment",t[t.RTJunctionEdgeConnectivity=4]="RTJunctionEdgeConnectivity",t[t.RTEdgeJunctionEdgeConnectivity=5]="RTEdgeJunctionEdgeConnectivity"})(qh||(qh={}));const kk=new mi({connected:"connected",upstream:"upstream",downstream:"downstream",shortestPath:"shortest-path",subnetwork:"subnetwork",subnetworkController:"subnetwork-controller",loops:"loops",isolation:"isolation"});new mi({connectivity:"connectivity",attachment:"attachment",containment:"containment",junctionEdgeFromConnectivity:"junction-edge-from-connectivity",junctionMidspanConnectivity:"junction-midspan-connectivity",junctionEdgeToConnectivity:"junction-edge-to-connectivity"});new mi({normal:"normal",rebuild:"rebuild",forceRebuild:"force-rebuild"});let BT=class extends Pw(Ju){constructor(e){super(e),this.request=ir}initialize(){}async load(e){const i=this.layer.load(e).then(()=>this._initializeRulesTable());return this.addResolvingPromise(i),this}getFeatureSQL(e,i){var c,h;const r=e.layerId.toString(),n=(c=e.fieldsIndex)==null?void 0:c.normalizeFieldName("assetGroup"),s=(h=e.fieldsIndex)==null?void 0:h.normalizeFieldName("assetType"),o=n?i.attributes[n]:null,a=s?i.attributes[s]:null,l=this.rulesHash[r];if(l){const p=l.assetGroupHash[o];if(p)return p.assetTypeHash[a]||null}return null}async _initializeRulesTable(){var n,s,o,a,l,c,h,p,f,m;const e={};let i;(function(g){g[g.from=0]="from",g[g.to=1]="to",g[g.via=2]="via"})(i||(i={}));const r=[{networkSourceId:"fromNetworkSource",assetGroupId:"fromAssetGroup",assetTypeId:"fromAssetType"},{networkSourceId:"toNetworkSource",assetGroupId:"toAssetGroup",assetTypeId:"toAssetType"},{networkSourceId:"viaNetworkSource",assetGroupId:"viaAssetGroup",assetTypeId:"viaAssetType"}];for(const g of this.rules){if(g.ruleType!==qh.RTJunctionJunctionConnectivity&&g.ruleType!==qh.RTJunctionEdgeConnectivity&&g.ruleType!==qh.RTEdgeJunctionEdgeConnectivity)continue;let _=[[i.from,i.to],[i.to,i.from]];g.ruleType===qh.RTEdgeJunctionEdgeConnectivity&&(_=[[i.from,i.via],[i.via,i.from],[i.to,i.via],[i.via,i.to]]);for(const b of _){const w=b.shift(),x=b.shift();let T=!1;switch(g.ruleType){case qh.RTEdgeJunctionEdgeConnectivity:T=w===i.from||w===i.to;break;case qh.RTJunctionEdgeConnectivity:T=w===i.to}const E=r[w],C=g[E.networkSourceId].layerId.toString(),A=(s=(n=g[E.assetGroupId])==null?void 0:n.assetGroupCode)==null?void 0:s.toString(),I=(a=(o=g[E.assetTypeId])==null?void 0:o.assetTypeCode)==null?void 0:a.toString(),O=r[x],D=g[O.networkSourceId].layerId.toString(),U=(c=(l=g[O.assetGroupId])==null?void 0:l.assetGroupCode)==null?void 0:c.toString(),V=g[O.assetTypeId],B=(h=V==null?void 0:V.assetTypeCode)==null?void 0:h.toString(),ee=e[C]?e[C]:{assetGroupHash:{}};if(!(A&&I&&U&&B))continue;const ie=ee.assetGroupHash[A]?ee.assetGroupHash[A]:{assetTypeHash:{}},J=ie.assetTypeHash[I]?ie.assetTypeHash[I]:{};if(J[D]=J[D]?J[D]:{},T){J[C]=J[C]?J[C]:{};const N=`(assetgroup = ${A} AND assettype = ${I})`;J[C].anyVertex=J[C].anyVertex?`${J[C].anyVertex}`:`${N}`,V.connectivityPolicy==="esriNECPEndVertex"&&(J[C].endVertex=(p=J[C])!=null&&p.endVertex?`${J[C].endVertex}`:`${N}`)}const q=`(assetgroup = ${U} AND assettype = ${B})`;J[D].anyVertex=(f=J[D])!=null&&f.anyVertex?`${J[D].anyVertex} OR ${q}`:`${q}`,V.connectivityPolicy==="esriNECPEndVertex"&&(J[D].endVertex=(m=J[D])!=null&&m.endVertex?`${J[D].endVertex} OR ${q}`:`${q}`),ie.assetTypeHash[I]=J,ee.assetGroupHash[A]=ie,e[C]=ee}}this.rulesHash=e}};u([d({constructOnly:!0})],BT.prototype,"layer",void 0),u([d({constructOnly:!0})],BT.prototype,"rules",void 0),u([d()],BT.prototype,"rulesHash",void 0),u([d({constructOnly:!0})],BT.prototype,"request",void 0),BT=u([$("esri.networks.RulesTable")],BT);const fUt=BT;let jd=class extends fe{constructor(e){super(e),this.conditionBarriers=[],this.outputConditions=[],this.functions=[],this.functionBarriers=[],this.traversabilityScope=null,this.shortestPathNetworkAttributeName=null,this.includeBarriers=null,this.validateConsistency=null,this.ignoreBarriersAtStartingPoints=null}};u([d({type:[Object],json:{write:!0}})],jd.prototype,"conditionBarriers",void 0),u([d({type:[Object],json:{write:!0}})],jd.prototype,"outputConditions",void 0),u([d({type:[Object],json:{write:!0}})],jd.prototype,"functions",void 0),u([d({type:[Object],json:{write:!0}})],jd.prototype,"functionBarriers",void 0),u([d({type:["junctions","edges","junctionsAndEdges"],json:{write:!0}})],jd.prototype,"traversabilityScope",void 0),u([d({type:String,json:{write:!0}})],jd.prototype,"shortestPathNetworkAttributeName",void 0),u([d({type:Boolean,json:{write:!0}})],jd.prototype,"includeBarriers",void 0),u([d({type:Boolean,json:{write:!0}})],jd.prototype,"validateConsistency",void 0),u([d({type:Boolean,json:{write:!0}})],jd.prototype,"ignoreBarriersAtStartingPoints",void 0),jd=u([$("esri.networks.support.TraceConfiguration")],jd);const Hce=jd;let no=class extends Hce{constructor(e){super(e),this.filterBarriers=[],this.domainNetworkName=null,this.filterBitsetNetworkAttributeName=null,this.filterFunctionBarriers=[],this.filterScope=null,this.includeContainers=null,this.includeContent=null,this.includeIsolated=null,this.includeStructures=null,this.includeUpToFirstSpatialContainer=null,this.nearestNeighbor=null,this.outputFilterCategories=[],this.outputFilters=[],this.propagators=[],this.subnetworkName=null,this.targetTierName=null,this.tierName=null,this.validateLocatability=null}};u([d({type:[Object],json:{write:!0}})],no.prototype,"filterBarriers",void 0),u([d({type:String,json:{write:!0}})],no.prototype,"domainNetworkName",void 0),u([d({type:String,json:{write:!0}})],no.prototype,"filterBitsetNetworkAttributeName",void 0),u([d({type:[Object],json:{write:!0}})],no.prototype,"filterFunctionBarriers",void 0),u([d({type:["junctions","edges","junctionsAndEdges"],json:{write:!0}})],no.prototype,"filterScope",void 0),u([d({type:Boolean,json:{write:!0}})],no.prototype,"includeContainers",void 0),u([d({type:Boolean,json:{write:!0}})],no.prototype,"includeContent",void 0),u([d({type:Boolean,json:{write:!0}})],no.prototype,"includeIsolated",void 0),u([d({type:Boolean,json:{write:!0}})],no.prototype,"includeStructures",void 0),u([d({type:Boolean,json:{write:!0}})],no.prototype,"includeUpToFirstSpatialContainer",void 0),u([d({type:Object,json:{write:!0}})],no.prototype,"nearestNeighbor",void 0),u([d({type:[Object],json:{write:!0}})],no.prototype,"outputFilterCategories",void 0),u([d({type:[Object],json:{write:!0}})],no.prototype,"outputFilters",void 0),u([d({type:[Object],json:{write:!0}})],no.prototype,"propagators",void 0),u([d({type:String,json:{write:!0}})],no.prototype,"subnetworkName",void 0),u([d({type:String,json:{write:!0}})],no.prototype,"targetTierName",void 0),u([d({type:String,json:{write:!0}})],no.prototype,"tierName",void 0),u([d({type:Boolean,json:{write:!0}})],no.prototype,"validateLocatability",void 0),no=u([$("esri.networks.support.UNTraceConfiguration")],no);const mUt=no;let Su=class extends DV{constructor(e){super(e),this.globalId=null,this.title=null,this.traceConfiguration=null,this.creationDate=null,this.creator=null,this.description=null,this.minStartingPoints=null,this.resultTypes=[],this.tags=[],this.traceType=null}readTraceConfiguration(e,i){return e.tierName!==void 0?mUt.fromJSON(e):Hce.fromJSON(e)}};u([d({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"id"},write:{target:"id",isRequired:!0}},service:{read:{source:"globalId"},write:{target:"globalId",isRequired:!0}}},read:!1}})],Su.prototype,"globalId",void 0),u([d({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"title"},write:{target:"title",isRequired:!0}},service:{read:{source:"name"},write:{target:"name",isRequired:!0}}},read:!1}})],Su.prototype,"title",void 0),u([d({type:Hce,json:{origins:{service:{read:!0,write:!0}},read:!1}})],Su.prototype,"traceConfiguration",void 0),u([Oe("service","traceConfiguration")],Su.prototype,"readTraceConfiguration",null),u([d({type:Date,json:{origins:{service:{read:!0,write:!0}},read:!1}})],Su.prototype,"creationDate",void 0),u([d({type:String,json:{origins:{service:{read:!0,write:!0}},read:!1}})],Su.prototype,"creator",void 0),u([d({type:String,json:{origins:{service:{read:!0,write:!0}},read:!1}})],Su.prototype,"description",void 0),u([d({type:["none","one","many"],json:{origins:{service:{read:{source:"minNumStartingPoints"},write:{target:"minNumStartingPoints"}}},read:!1}})],Su.prototype,"minStartingPoints",void 0),u([d({type:[Object],json:{origins:{service:{read:!0,write:!0}},read:!1}})],Su.prototype,"resultTypes",void 0),u([d({type:[String],json:{origins:{service:{read:!0,write:!0}},read:!1}})],Su.prototype,"tags",void 0),u([d({type:kk.apiValues,json:{type:kk.jsonValues,origins:{service:{read:kk.read,write:kk.write}},read:!1}})],Su.prototype,"traceType",void 0),Su=u([$("esri.networks.support.NamedTraceConfiguration")],Su);const gUt=Su;let O0=class extends ve{constructor(e){super(e),this.rulesTableId=null,this.rulesTableUrl=null,this.subnetworksTableId=null,this.subnetworksTableUrl=null,this.dirtyAreasLayerId=null,this.dirtyAreasLayerUrl=null}};u([d({constructOnly:!0})],O0.prototype,"rulesTableId",void 0),u([d({constructOnly:!0})],O0.prototype,"rulesTableUrl",void 0),u([d({constructOnly:!0})],O0.prototype,"subnetworksTableId",void 0),u([d({constructOnly:!0})],O0.prototype,"subnetworksTableUrl",void 0),u([d({constructOnly:!0})],O0.prototype,"dirtyAreasLayerId",void 0),u([d({constructOnly:!0})],O0.prototype,"dirtyAreasLayerUrl",void 0),O0=u([$("esri.networks.support.NetworkSystemLayers")],O0);const yUt=O0;let AA=class extends fe{constructor(e){super(e),this.id=null,this.name=null}};u([d({type:Number,json:{read:{source:"terminalId"},write:{target:"terminalId"}}})],AA.prototype,"id",void 0),u([d({type:String,json:{read:{source:"terminalName"},write:{target:"terminalName"}}})],AA.prototype,"name",void 0),u([d({type:Boolean,json:{write:!0}})],AA.prototype,"isUpstreamTerminal",void 0),AA=u([$("esri.networks.support.Terminal")],AA);const _Ut=AA,Uk=new mi({esriUNTMBidirectional:"bidirectional",esriUNTMDirectional:"directional"});let $1=class extends fe{constructor(e){super(e),this.defaultConfiguration=null,this.id=null,this.name=null,this.terminals=[],this.traversabilityModel=null}};u([d({type:String,json:{write:!0}})],$1.prototype,"defaultConfiguration",void 0),u([d({type:Number,json:{read:{source:"terminalConfigurationId"},write:{target:"terminalConfigurationId"}}})],$1.prototype,"id",void 0),u([d({type:String,json:{read:{source:"terminalConfigurationName"},write:{target:"terminalConfigurationName"}}})],$1.prototype,"name",void 0),u([d({type:[_Ut],json:{write:!0}})],$1.prototype,"terminals",void 0),u([d({type:Uk.apiValues,json:{type:Uk.jsonValues,read:Uk.read,write:Uk.write}})],$1.prototype,"traversabilityModel",void 0),$1=u([$("esri.networks.support.TerminalConfiguration")],$1);const qwe=$1,vUt="esri.networks.UtilityNetwork",Vk=re.getLogger(vUt);let Ah=class extends pUt{constructor(e){super(e),this.sharedNamedTraceConfigurations=[],this.type="utility"}get serviceTerritoryFeatureLayerId(){var e;return((e=this.dataElement)==null?void 0:e.serviceTerritoryFeatureLayerId)??null}get networkSystemLayers(){var e,i,r,n,s,o;return new yUt({rulesTableId:(e=this.sourceJSON)==null?void 0:e.systemLayers.rulesTableId,rulesTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${(i=this.sourceJSON)==null?void 0:i.systemLayers.rulesTableId}`:null,subnetworksTableId:(r=this.sourceJSON)==null?void 0:r.systemLayers.subnetworksTableId,subnetworksTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${(n=this.sourceJSON)==null?void 0:n.systemLayers.subnetworksTableId}`:null,dirtyAreasLayerId:(s=this.sourceJSON)==null?void 0:s.systemLayers.dirtyAreasLayerId,dirtyAreasLayerUrl:this.sourceJSON?`${this.featureServiceUrl}/${(o=this.sourceJSON)==null?void 0:o.systemLayers.dirtyAreasLayerId}`:null})}get rulesTableId(){var e;return fS(Vk,"rulesTableId",{replacement:"networkSystemLayers.rulesTableId",version:"4.25"}),(e=this.sourceJSON)==null?void 0:e.systemLayers.rulesTableId}get rulesTableUrl(){return fS(Vk,"rulesTableUrl",{replacement:"networkSystemLayers.rulesTableUrl",version:"4.25"}),this.sourceJSON?`${this.featureServiceUrl}/${this.networkSystemLayers.rulesTableId}`:null}get subnetworksTableId(){var e;return fS(Vk,"subnetworksTableId",{replacement:"networkSystemLayers.subnetworksTableId",version:"4.25"}),(e=this.sourceJSON)==null?void 0:e.systemLayers.subnetworksTableId}get subnetworksTableUrl(){return fS(Vk,"subnetworksTableUrl",{replacement:"networkSystemLayers.subnetworksTableUrl",version:"4.25"}),this.sourceJSON?`${this.featureServiceUrl}/${this.networkSystemLayers.subnetworksTableId}`:null}get terminalConfigurations(){var e;return((e=this.dataElement)==null?void 0:e.terminalConfigurations.map(i=>qwe.fromJSON(i)))||[]}get domainNetworkNames(){var e;return((e=this.dataElement)==null?void 0:e.domainNetworks.map(i=>i.domainNetworkName))||[]}get _utilityLayerList(){var i,r;const e=new Set;return(r=(i=this.dataElement)==null?void 0:i.domainNetworks)==null||r.map(n=>{n.edgeSources.map(s=>{e.add(s.layerId)}),n.junctionSources.map(s=>{e.add(s.layerId)})}),e}async load(e){return this.addResolvingPromise(super.load(e)),this.addResolvingPromise(this._loadNamedTraceConfigurationsFromNetwork(e)),this}getTerminalConfiguration(e){var c,h,p,f;let i=null,r=null;const n=e.layer;let s=null;if((n==null?void 0:n.type)!=="feature"||(s=n.layerId,s===null))return null;const o=e.attributes;if(o==null)return null;for(const m of Object.keys(o))m.toUpperCase()==="ASSETGROUP"&&(i=e.getAttribute(m)),m.toUpperCase()==="ASSETTYPE"&&(r=e.getAttribute(m));if(!this.dataElement)return null;let a=null;const l=this.dataElement.domainNetworks;for(const m of l){const g=(c=m.junctionSources)==null?void 0:c.find(_=>_.layerId===s);if(g){const _=(h=g.assetGroups)==null?void 0:h.find(b=>b.assetGroupCode===i);if(_){const b=(p=_.assetTypes)==null?void 0:p.find(w=>w.assetTypeCode===r);if(b){a=b.terminalConfigurationId;break}}}}if(a!=null){const m=(f=this.dataElement.terminalConfigurations)==null?void 0:f.find(g=>g.terminalConfigurationId===a);return m?qwe.fromJSON(m):null}return null}getTierNames(e){var r;const i=(r=this.dataElement)==null?void 0:r.domainNetworks.find(n=>n.domainNetworkName===e);return(i==null?void 0:i.tiers.map(n=>n.name))||[]}async getRulesTable(){return this._createRulesTable()}isUtilityLayer(e){return this._utilityLayerList.has(e.layerId)}async _loadNamedTraceConfigurationsFromNetwork(e){var n;if(((n=this.sharedNamedTraceConfigurations)==null?void 0:n.length)===0)return;const i=this.sharedNamedTraceConfigurations.map(s=>s.globalId),r=await this.queryNamedTraceConfigurations({globalIds:i},e);for(const s of this.sharedNamedTraceConfigurations){const o=r==null?void 0:r.find(a=>a.globalId===s.globalId);if(o){const a=o.write({},{origin:"service"});s.read(a,{origin:"service"})}}}async _createRulesTable(){var s;const e=new Moe({url:this.rulesTableUrl});await e.load();const i=(s=this.dataElement)==null?void 0:s.domainNetworks;if(!i)return null;const r=i.flatMap(o=>[...o.edgeSources,...o.junctionSources]),n=(await this._queryRulesTable(e)).map(o=>this._hydrateRuleInfo(e,r,o));return new fUt({layer:e,rules:n})}async _queryRulesTable(e){const i=new xp({where:"1=1",outFields:["*"]});return(await sUt(e,i)).features}_hydrateRuleInfo(e,i,r){const n=e.fieldsIndex,s=n.get("RULETYPE"),o=n.get("CREATIONDATE"),a=n.get("FROMNETWORKSOURCEID"),l=n.get("FROMASSETGROUP"),c=n.get("FROMASSETTYPE"),h=n.get("FROMTERMINALID"),p=n.get("TONETWORKSOURCEID"),f=n.get("TOASSETGROUP"),m=n.get("TOASSETTYPE"),g=n.get("TOTERMINALID"),_=n.get("VIANETWORKSOURCEID"),b=n.get("VIAASSETGROUP"),w=n.get("VIAASSETTYPE"),x=n.get("VIATERMINALID"),T=r.attributes[s.name],E=new Date(r.attributes[o.name]),C=[{networkSourceId:r.attributes[a.name],assetGroupId:r.attributes[l.name],assetTypeId:r.attributes[c.name],terminalId:r.attributes[h.name]},{networkSourceId:r.attributes[p.name],assetGroupId:r.attributes[f.name],assetTypeId:r.attributes[m.name],terminalId:r.attributes[g.name]},{networkSourceId:r.attributes[_.name],assetGroupId:r.attributes[b.name],assetTypeId:r.attributes[w.name],terminalId:r.attributes[x.name]}];let A;(function(O){O[O.from=0]="from",O[O.to=1]="to",O[O.via=2]="via"})(A||(A={}));const I={ruleType:T,creationDate:E};for(const O of[A.from,A.to,A.via]){if(T!==qh.RTEdgeJunctionEdgeConnectivity&&O===A.via)continue;const D=C[O],U=i.find(J=>J.sourceId===D.networkSourceId),V=U==null?void 0:U.assetGroups.find(J=>J.assetGroupCode===D.assetGroupId),B=V==null?void 0:V.assetTypes.find(J=>J.assetTypeCode===D.assetTypeId);let ee=this._getTerminal(T,B,D);T!==qh.RTContainment&&T!==qh.RTAttachment||(ee=null);let ie="";switch(O){case A.from:ie="from";break;case A.to:ie="to";break;case A.via:ie="via"}I[`${ie}NetworkSource`]=U,I[`${ie}AssetGroup`]=V,I[`${ie}AssetType`]=B,I[`${ie}Terminal`]=ee}return I}_getTerminal(e,i,r){var o,a;if(e===qh.RTAttachment||e===qh.RTContainment)return null;const n=i==null?void 0:i.terminalConfigurationId,s=(o=this.terminalConfigurations)==null?void 0:o.find(l=>l.id===n);return((a=s==null?void 0:s.terminals)==null?void 0:a.find(l=>l.id===r.terminalId))??null}};u([d({type:[gUt],json:{origins:{"web-map":{read:{source:"traceConfigurations"},write:{target:"traceConfigurations"}},service:{read:{source:"traceConfigurations"}}},read:!1}})],Ah.prototype,"sharedNamedTraceConfigurations",void 0),u([d({type:["utility"],readOnly:!0,json:{read:!1,write:!1}})],Ah.prototype,"type",void 0),u([d({readOnly:!0})],Ah.prototype,"serviceTerritoryFeatureLayerId",null),u([d({readOnly:!0})],Ah.prototype,"networkSystemLayers",null),u([d({readOnly:!0})],Ah.prototype,"rulesTableId",null),u([d({readOnly:!0})],Ah.prototype,"rulesTableUrl",null),u([d({readOnly:!0})],Ah.prototype,"subnetworksTableId",null),u([d({readOnly:!0})],Ah.prototype,"subnetworksTableUrl",null),u([d({readOnly:!0})],Ah.prototype,"terminalConfigurations",null),u([d({readOnly:!0})],Ah.prototype,"domainNetworkNames",null),Ah=u([$("esri.networks.UtilityNetwork")],Ah);const uVe=Ah,bUt=Object.freeze(Object.defineProperty({__proto__:null,default:uVe},Symbol.toStringTag,{value:"Module"}));let L1=class extends fe{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};u([d({type:String,json:{write:!0}})],L1.prototype,"facilityIdField",void 0),u([d({type:String,json:{write:!0}})],L1.prototype,"layerId",void 0),u([d({type:String,json:{write:!0}})],L1.prototype,"nameField",void 0),u([d({type:String,json:{write:!0}})],L1.prototype,"siteIdField",void 0),u([d({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],L1.prototype,"sublayerId",void 0),L1=u([$("esri.layers.support.FacilityLayerInfo")],L1);const wUt=L1;let Rf=class extends fe{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.levelIdField=null,this.levelNumberField=null,this.longNameField=null,this.shortNameField=null,this.sublayerId=null,this.verticalOrderField=null}};u([d({type:String,json:{write:!0}})],Rf.prototype,"facilityIdField",void 0),u([d({type:String,json:{write:!0}})],Rf.prototype,"layerId",void 0),u([d({type:String,json:{write:!0}})],Rf.prototype,"levelIdField",void 0),u([d({type:String,json:{write:!0}})],Rf.prototype,"levelNumberField",void 0),u([d({type:String,json:{write:!0}})],Rf.prototype,"longNameField",void 0),u([d({type:String,json:{write:!0}})],Rf.prototype,"shortNameField",void 0),u([d({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],Rf.prototype,"sublayerId",void 0),u([d({type:String,json:{write:!0}})],Rf.prototype,"verticalOrderField",void 0),Rf=u([$("esri.layers.support.LevelLayerInfo")],Rf);const xUt=Rf;let jT=class extends fe{constructor(e){super(e),this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};u([d({type:String,json:{write:!0}})],jT.prototype,"layerId",void 0),u([d({type:String,json:{write:!0}})],jT.prototype,"nameField",void 0),u([d({type:String,json:{write:!0}})],jT.prototype,"siteIdField",void 0),u([d({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],jT.prototype,"sublayerId",void 0),jT=u([$("esri.layers.support.SiteLayerInfo")],jT);const TUt=jT;let RA=class extends fe{constructor(e){super(e),this.levelLayer=null,this.facilityLayer=null,this.siteLayer=null}};u([d({type:xUt,json:{write:!0}})],RA.prototype,"levelLayer",void 0),u([d({type:wUt,json:{write:!0}})],RA.prototype,"facilityLayer",void 0),u([d({type:TUt,json:{write:!0}})],RA.prototype,"siteLayer",void 0),RA=u([$("esri.support.MapFloorInfo")],RA);const SUt=RA;let MA=class extends xr(fe){constructor(e){super(e),this.expression=null,this.returnType="string",this.title=null}};u([d({type:String,json:{write:{isRequired:!0}}})],MA.prototype,"expression",void 0),u([d({type:["number","string"],json:{write:!0}})],MA.prototype,"returnType",void 0),u([d({type:String,json:{write:!0}})],MA.prototype,"title",void 0),MA=u([$("esri.webdoc.geotriggersInfo.ExpressionInfo")],MA);const hVe=MA,zk=new mi({deviceLocation:"device-location"});let n$=class extends xr(fe){constructor(e){super(e),this.filterExpression=null,this.type="device-location"}};u([d({type:hVe,json:{write:!0}})],n$.prototype,"filterExpression",void 0),u([d({type:zk.apiValues,readOnly:!0,json:{type:zk.jsonValues,read:zk.read,write:zk.write}})],n$.prototype,"type",void 0),n$=u([$("esri.webdoc.geotriggersInfo.DeviceLocationFeed")],n$);const EUt=n$;let s$=class extends xr(fe){constructor(e){super(e),this.geometry=null,this.where=null}};u([d({types:Iw,json:{read:ly,write:!0}})],s$.prototype,"geometry",void 0),u([d({type:String,json:{write:!0}})],s$.prototype,"where",void 0),s$=u([$("esri.webdoc.geotriggersInfo.FeatureFilter")],s$);const CUt=s$;let OA=class extends xr(fe){constructor(e){super(e),this.layerId=null,this.layerUrl=null,this.type="feature-layer"}};u([d({type:String,json:{write:{overridePolicy(){return{isRequired:this.layerUrl===null}}}}})],OA.prototype,"layerId",void 0),u([d({type:String,json:{write:{overridePolicy(){return{isRequired:this.layerId===null}}}}})],OA.prototype,"layerUrl",void 0),u([ot({featureLayer:"feature-layer"},{readOnly:!0})],OA.prototype,"type",void 0),OA=u([$("esri.webdoc.geotriggersInfo.FeatureLayerSource")],OA);const AUt=OA;let GT=class extends xr(fe){constructor(e){super(e),this.fenceSource=null,this.filter=null,this.bufferDistance=null,this.type="features"}};u([d({type:AUt,json:{write:{isRequired:!0}}})],GT.prototype,"fenceSource",void 0),u([d({type:CUt,json:{write:!0}})],GT.prototype,"filter",void 0),u([d({type:Number,json:{write:!0}})],GT.prototype,"bufferDistance",void 0),u([ot({features:"features"},{readOnly:!0})],GT.prototype,"type",void 0),GT=u([$("esri.webdoc.geotriggersInfo.FeatureFenceParameters")],GT);const RUt=GT;let s8=class extends xr(fe){constructor(e){super(e),this.type="fence"}};u([ot({fence:"fence"},{readOnly:!0})],s8.prototype,"type",void 0),s8=u([$("esri.webdoc.geotriggersInfo.Geotrigger")],s8);const dVe=s8;let o$=class extends xr(fe){constructor(e){super(e),this.expressionInfo=null,this.requestedActions=null}};u([d({type:hVe,json:{write:!0}})],o$.prototype,"expressionInfo",void 0),u([d({type:[String],json:{write:!0}})],o$.prototype,"requestedActions",void 0),o$=u([$("esri.webdoc.geotriggersInfo.GeotriggerNotificationOptions")],o$);const MUt=o$,OUt=new mi({enterContainsAndExitDoesNotContain:"enter-contains-and-exit-does-not-contain",enterContainsAndExitDoesNotIntersect:"enter-contains-and-exit-does-not-intersect",enterIntersectsAndExitDoesNotIntersect:"enter-intersects-and-exit-does-not-intersect"}),PUt=new mi({useGeometry:"use-geometry",useGeometryWithAccuracy:"use-geometry-with-accuracy"}),Bk=new mi({enter:"enter",enterOrExit:"enter-or-exit",exit:"exit"});let Mf=class extends dVe{constructor(e){super(e),this.enterExitRule="enter-contains-and-exit-does-not-intersect",this.feed=null,this.feedAccuracyMode="use-geometry",this.fenceNotificationRule=null,this.fenceParameters=null,this.name=null,this.notificationOptions=null,this.type="fence"}};u([ot(OUt)],Mf.prototype,"enterExitRule",void 0),u([d({type:EUt,json:{write:{isRequired:!0}}})],Mf.prototype,"feed",void 0),u([ot(PUt)],Mf.prototype,"feedAccuracyMode",void 0),u([d({type:Bk.apiValues,json:{type:Bk.jsonValues,read:Bk.read,write:{writer:Bk.write,isRequired:!0}}})],Mf.prototype,"fenceNotificationRule",void 0),u([d({type:RUt,json:{write:{isRequired:!0}}})],Mf.prototype,"fenceParameters",void 0),u([d({type:String,json:{write:!0}})],Mf.prototype,"name",void 0),u([d({type:MUt,json:{write:!0}})],Mf.prototype,"notificationOptions",void 0),u([ot({fence:"fence"},{readOnly:!0})],Mf.prototype,"type",void 0),Mf=u([$("esri.webdoc.geotriggersInfo.FenceGeotrigger")],Mf);const IUt=Mf,$Ut={base:dVe,key:"type",typeMap:{fence:IUt}};let o8=class extends xr(fe){constructor(e){super(e),this.geotriggers=null}};u([d({types:[$Ut],json:{write:{isRequired:!0}}})],o8.prototype,"geotriggers",void 0),o8=u([$("esri.webdoc.GeotriggersInfo")],o8);const LUt=o8;var Cie;let PA=Cie=class extends fe{constructor(t){super(t),this.activeRange=null,this.currentRangeExtent=null,this.fullRangeExtent=null}clone(){return new Cie(se({activeRange:this.activeRange,currentRangeExtent:this.currentRangeExtent,fullRangeExtent:this.fullRangeExtent}))}};u([d({type:String,nonNullable:!0,json:{read:{source:"activeRangeName"},write:{target:"activeRangeName",isRequired:!0}}})],PA.prototype,"activeRange",void 0),u([d({type:[Number],json:{write:!0}})],PA.prototype,"currentRangeExtent",void 0),u([d({type:[Number],json:{write:!0}})],PA.prototype,"fullRangeExtent",void 0),PA=Cie=u([$("esri.webdoc.RangeInfo")],PA);const qce=PA;var Aie;let Tg=Aie=class extends fe{constructor(t){super(t),this.enabled=!1,this.longNames=!1,this.minimized=!1,this.pinnedLevels=!1,this.site=null,this.facility=null,this.level=null}clone(){return new Aie(se({enabled:this.enabled,longNames:this.longNames,minimized:this.minimized,pinnedLevels:this.pinnedLevels,site:this.site,facility:this.facility,level:this.level}))}};u([d({type:Boolean,json:{read:{source:"enabled"},write:{target:"enabled"}}})],Tg.prototype,"enabled",void 0),u([d({type:Boolean,json:{read:{source:"longNames"},write:{target:"longNames"}}})],Tg.prototype,"longNames",void 0),u([d({type:Boolean,json:{read:{source:"minimized"},write:{target:"minimized"}}})],Tg.prototype,"minimized",void 0),u([d({type:Boolean,json:{read:{source:"pinnedLevels"},write:{target:"pinnedLevels"}}})],Tg.prototype,"pinnedLevels",void 0),u([d({type:String,json:{read:{source:"site"},write:{target:"site"}}})],Tg.prototype,"site",void 0),u([d({type:String,json:{read:{source:"facility"},write:{target:"facility"}}})],Tg.prototype,"facility",void 0),u([d({type:String,json:{read:{source:"level"},write:{target:"level"}}})],Tg.prototype,"level",void 0),Tg=Aie=u([$("esri.webdoc.widgets.FloorFilter")],Tg);const DUt=Tg;var Rie;const jk=new mi({slider:"slider",picker:"picker"});let IA=Rie=class extends fe{constructor(t){super(t),this.interactionMode=null,this.numStops=null,this.stopInterval=null}clone(){return new Rie({interactionMode:this.interactionMode,numStops:this.numStops,stopInterval:this.stopInterval})}};u([d({type:jk.apiValues,nonNullable:!0,json:{type:jk.jsonValues,default:null,read:{reader:jk.read},write:{isRequired:!0,writer:jk.write}}})],IA.prototype,"interactionMode",void 0),u([d({type:Number,json:{read:{source:"numberOfStops"},write:{target:"numberOfStops",overridePolicy(){const t=this.stopInterval!=null;return{enabled:!t,isRequired:!t}}}}})],IA.prototype,"numStops",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{isRequired:this.numStops==null}}}}})],IA.prototype,"stopInterval",void 0),IA=Rie=u([$("esri.webdoc.widgets.Range")],IA);const NUt=IA;var Mie;let aa=Mie=class extends fe{constructor(t){super(t),this.currentTimeExtent=null,this.fullTimeExtent=null,this.loop=!1,this.numStops=null,this.numThumbs=null,this.stopDelay=null,this.stopInterval=null,this.stops=null}readCurrentTimeExtent(t){if(!t)return;const e=t[0]!=null?new Date(t[0]):null,i=t[1]!=null?new Date(t[1]):null;return new Zc({start:e,end:i})}writeCurrentTimeExtent(t,e,i){t&&va(i,[v(t.start)?t.start.getTime():null,v(t.end)?t.end.getTime():null],e)}readFullTimeExtent(t,e){const i=e.properties;if(!i)return;const r=i.endTime!=null?new Date(i.endTime):null,n=i.startTime!=null?new Date(i.startTime):null;return new Zc({start:n,end:r})}writeFullTimeExtent(t,e){if(!t)return;const i=e.properties=e.properties||{},r=t.end,n=t.start;r&&(i.endTime=v(r)?r.getTime():null),n&&(i.startTime=v(n)?n.getTime():null)}readStopInterval(t,e,i){return t?UM.fromJSON({value:t.interval,unit:t.units},i):null}writeStopInterval(t,e,i,r){if(!t)return;const n=t.toJSON(r);va(i,{interval:n.value,units:n.unit},e)}readStops(t){return t&&t.length?t.map(e=>new Date(e)):null}writeStops(t,e,i){t&&t.length&&va(i,t.map(r=>r.getTime()),e)}clone(){return new Mie(se({currentTimeExtent:this.currentTimeExtent,fullTimeExtent:this.fullTimeExtent,loop:this.loop,numStops:this.numStops,numThumbs:this.numThumbs,stopDelay:this.stopDelay,stopInterval:this.stopInterval,stops:this.stops}))}};u([d({type:Zc,json:{read:{source:"properties.currentTimeExtent"},write:{target:"properties.currentTimeExtent"}}})],aa.prototype,"currentTimeExtent",void 0),u([Oe("currentTimeExtent")],aa.prototype,"readCurrentTimeExtent",null),u([Ne("currentTimeExtent")],aa.prototype,"writeCurrentTimeExtent",null),u([d({type:Zc,json:{read:{source:["properties.endTime","properties.startTime"]},write:{target:{"properties.endTime":{type:Number},"properties.startTime":{type:Number}}}}})],aa.prototype,"fullTimeExtent",void 0),u([Oe("fullTimeExtent")],aa.prototype,"readFullTimeExtent",null),u([Ne("fullTimeExtent")],aa.prototype,"writeFullTimeExtent",null),u([d({type:Boolean,nonNullable:!0,json:{default:!1,read:{source:"properties.loop"},write:{target:"properties.loop"}}})],aa.prototype,"loop",void 0),u([d({type:Number,json:{read:{source:"properties.numberOfStops"},write:{target:"properties.numberOfStops",overridePolicy(){var r;const t=!!this.stopInterval,e=!!((r=this.stops)!=null&&r.length),i=!(t||e);return{enabled:i,isRequired:i}}}}})],aa.prototype,"numStops",void 0),u([d({type:[1,2],nonNullable:!0,json:{read:{source:"properties.thumbCount"},write:{target:"properties.thumbCount",isRequired:!0}}})],aa.prototype,"numThumbs",void 0),u([d({type:Number,nonNullable:!0,json:{read:{source:"properties.thumbMovingRate"},write:{target:"properties.thumbMovingRate",isRequired:!0}}})],aa.prototype,"stopDelay",void 0),u([d({type:UM,json:{read:{source:"properties.timeStopInterval"},write:{target:"properties.timeStopInterval",overridePolicy(){var i;const t=this.numStops!=null,e=!!((i=this.stops)!=null&&i.length);return{enabled:!e,isRequired:!(t||e)}}}}})],aa.prototype,"stopInterval",void 0),u([Oe("stopInterval")],aa.prototype,"readStopInterval",null),u([Ne("stopInterval")],aa.prototype,"writeStopInterval",null),u([d({type:[Date],json:{read:{source:"properties.stops"},write:{target:"properties.stops",overridePolicy(){return{isRequired:this.numStops==null&&!this.stopInterval}}}}})],aa.prototype,"stops",void 0),u([Oe("stops")],aa.prototype,"readStops",null),u([Ne("stops")],aa.prototype,"writeStops",null),aa=Mie=u([$("esri.webdoc.widgets.TimeSlider")],aa);const FUt=aa;var Oie;let $A=Oie=class extends fe{constructor(t){super(t),this.range=null,this.timeSlider=null,this.floorFilter=null}clone(){return new Oie(se({range:this.range,timeSlider:this.timeSlider,floorFilter:this.floorFilter}))}};u([d({type:NUt,json:{write:!0}})],$A.prototype,"range",void 0),u([d({type:FUt,json:{write:!0}})],$A.prototype,"timeSlider",void 0),u([d({type:DUt,json:{write:!0}})],$A.prototype,"floorFilter",void 0),$A=Oie=u([$("esri.webdoc.Widgets")],$A);const kUt=$A,UUt={width:600,height:400},Gk=1.5;function VUt(t,e){e=e||UUt;let{width:i,height:r}=e;const n=i/r;return n<Gk?r=i/Gk:n>Gk&&(i=r*Gk),i>t.width&&(r*=t.width/i,i=t.width),r>t.height&&(i*=t.height/r,r=t.height),{width:Math.round(i),height:Math.round(r)}}function Wwe(t){return{enabled:!!(t!=null&&t.length)}}var Pie;let LA=Pie=class extends fe{constructor(t){super(t),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new Pie({exactMatch:this.exactMatch,type:this.type,name:this.name})}};u([d({type:Boolean,json:{write:!0}})],LA.prototype,"exactMatch",void 0),u([d({type:String,json:{write:!0}})],LA.prototype,"name",void 0),u([ot(Hse)],LA.prototype,"type",void 0),LA=Pie=u([$("esri.webdoc.applicationProperties.SearchLayerField")],LA);const zUt=LA;var Iie;let DA=Iie=class extends fe{constructor(t){super(t),this.field=null,this.id=null,this.subLayer=null}clone(){return new Iie(se({field:this.field,id:this.id,subLayer:this.subLayer}))}};u([d({type:zUt,json:{write:{isRequired:!0}}})],DA.prototype,"field",void 0),u([d({type:String,json:{write:{isRequired:!0}}})],DA.prototype,"id",void 0),u([d({type:Kr,json:{write:!0}})],DA.prototype,"subLayer",void 0),DA=Iie=u([$("esri.webdoc.applicationProperties.SearchLayer")],DA);const BUt=DA;var $ie;let NA=$ie=class extends fe{constructor(t){super(t),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new $ie({exactMatch:this.exactMatch,type:this.type,name:this.name})}};u([d({type:Boolean,json:{write:!0}})],NA.prototype,"exactMatch",void 0),u([d({type:String,json:{write:!0}})],NA.prototype,"name",void 0),u([ot(Hse)],NA.prototype,"type",void 0),NA=$ie=u([$("esri.webdoc.applicationProperties.SearchTableField")],NA);const jUt=NA;var Lie;let a$=Lie=class extends fe{constructor(t){super(t),this.field=null,this.id=null}clone(){return new Lie(se({field:this.field,id:this.id}))}};u([d({type:jUt,json:{write:{isRequired:!0}}})],a$.prototype,"field",void 0),u([d({type:String,json:{write:{isRequired:!0}}})],a$.prototype,"id",void 0),a$=Lie=u([$("esri.webdoc.applicationProperties.SearchTable")],a$);const GUt=a$;var Die;const pVe=tt.ofType(BUt),fVe=tt.ofType(GUt);let Sg=Die=class extends fe{constructor(t){super(t),this.addressSearchEnabled=!0,this.enabled=!0,this.hintText=null,this.layers=new pVe,this.tables=new fVe}readAddressSearchEnabled(t){return!t}writeAddressSearchEnabled(t,e,i){e[i]=!t}clone(){return new Die(se({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers,tables:this.tables}))}};u([d({type:Boolean,nonNullable:!0,json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder",isRequired:!0},origins:{"web-scene":{read:!1,write:!1}}}})],Sg.prototype,"addressSearchEnabled",void 0),u([Oe("addressSearchEnabled")],Sg.prototype,"readAddressSearchEnabled",null),u([Ne("addressSearchEnabled")],Sg.prototype,"writeAddressSearchEnabled",null),u([d({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-map":{write:{isRequired:!0}},"web-scene":{default:!0,write:!0}}}})],Sg.prototype,"enabled",void 0),u([d({type:String,json:{write:!0}})],Sg.prototype,"hintText",void 0),u([d({type:pVe,json:{write:{overridePolicy:Wwe},origins:{"web-scene":{write:{isRequired:!0}}}}})],Sg.prototype,"layers",void 0),u([d({type:fVe,json:{read:!0,write:{overridePolicy:Wwe}}})],Sg.prototype,"tables",void 0),Sg=Die=u([$("esri.webdoc.applicationProperties.Search")],Sg);const HUt=Sg;var Nie;let a8=Nie=class extends fe{constructor(t){super(t),this.search=null}clone(){return new Nie(se({search:this.search}))}};u([d({type:HUt,json:{write:!0}})],a8.prototype,"search",void 0),a8=Nie=u([$("esri.webdoc.applicationProperties.Viewing")],a8);const qUt=a8;var Fie;let FA=Fie=class extends fe{constructor(t){super(t),this.editing=null,this.offline=null,this.viewing=null}clone(){return new Fie(se({editing:this.editing,offline:this.offline,viewing:this.viewing}))}};u([d({json:{write:!0}})],FA.prototype,"editing",void 0),u([d({json:{write:!0}})],FA.prototype,"offline",void 0),u([d({type:qUt,json:{write:!0}})],FA.prototype,"viewing",void 0),FA=Fie=u([$("esri.webmap.ApplicationProperties")],FA);const WUt=FA;var kie;let XS=kie=class extends fe{constructor(){super(...arguments),this.url=""}destroy(){this.url=""}clone(){return new kie({url:this.url})}};u([d({type:String,json:{write:{isRequired:!0}}})],XS.prototype,"url",void 0),XS=kie=u([$("esri.webdoc.support.SlideThumbnail")],XS);var Uie;let Eg=Uie=class extends fO(fe){constructor(t){super(t),this.name=null,this.thumbnail=new XS,this.timeExtent=null}castThumbnail(t){return typeof t=="string"?new XS({url:t}):Ts(XS,t)}set viewpoint(t){const{targetGeometry:e,scale:i}=t;v(e)&&e.type==="point"&&R(i)&&re.getLogger(this.declaredClass).warn("Bookmark.viewpoint should include 'scale' when its targetGeometry is a point.",t),this._set("viewpoint",t)}readViewpoint(t,e){const{extent:i,viewpoint:r}=e;return Jn.fromJSON(r||{targetGeometry:i})}writeViewpoint(t,e,i,r){if(!t)return;const{targetGeometry:n}=t;if(v(n)&&n.type!=="extent"){const s="Bookmark.viewpoint cannot be written to JSON when the viewpoint's targetGeometry is not an extent.";r!=null&&r.messages?r.messages.push(new H("property:unsupported",s)):re.getLogger(this.declaredClass).error(s)}else v(n)&&(e.extent=n.toJSON()),e[i]=t.toJSON()}clone(){return new Uie(se({name:this.name,thumbnail:this.thumbnail,timeExtent:this.timeExtent,viewpoint:this.viewpoint}))}};u([d({type:String,nonNullable:!0,json:{write:{isRequired:!0}}})],Eg.prototype,"name",void 0),u([d({type:XS,json:{write:{overridePolicy:t=>({enabled:!(!t||!t.url)})}}})],Eg.prototype,"thumbnail",void 0),u([ri("thumbnail")],Eg.prototype,"castThumbnail",null),u([d({type:Zc,json:{write:!0}})],Eg.prototype,"timeExtent",void 0),u([d({type:Jn,nonNullable:!0,json:{write:!0}})],Eg.prototype,"viewpoint",null),u([Oe("viewpoint",["extent","viewpoint"])],Eg.prototype,"readViewpoint",null),u([Ne("viewpoint")],Eg.prototype,"writeViewpoint",null),Eg=Uie=u([$("esri.webmap.Bookmark")],Eg);const XUt=Eg;var Vie;let HT=Vie=class extends ve{constructor(t){super(t),this.background=null,this.rangeInfo=null,this.spatialReference=null,this.viewpoint=null}clone(){return new Vie(se({background:this.background,rangeInfo:this.rangeInfo,spatialReference:this.spatialReference,viewpoint:this.viewpoint}))}};u([d({type:VB})],HT.prototype,"background",void 0),u([d({type:qce})],HT.prototype,"rangeInfo",void 0),u([d({type:Je})],HT.prototype,"spatialReference",void 0),u([d({type:Jn})],HT.prototype,"viewpoint",void 0),HT=Vie=u([$("esri.webmap.InitialViewProperties")],HT);const l8=HT;class mL extends I2{constructor(e,i){super(e,i,"webmap")}}const c8=new mL(2,27),tX="Web Map",mVe=tt.ofType(XUt),YUt=tt.ofType(uVe),l$=new Map;l$.set("image/jpeg","jpeg"),l$.set("image/jpg","jpg"),l$.set("image/png","png"),l$.set("image/gif","gif");const ZUt="ArcGIS Pro",Xwe=Aoe.JSAPI,Ywe="CollectorDisabled",Zwe="Collector",Jwe="Data Editing",Kwe="OfflineDisabled",Qwe="Offline",exe="Workforce Project",txe="Workforce Worker",ixe="Workforce Dispatcher",JUt="Offline Map Areas",KUt="FieldMapsDisabled",rxe=Aoe.DEVELOPER_BASEMAP,nxe="UtilityNetwork",QUt=["NatGeo_World_Map","Ocean_Basemap","USA_Topo_Maps","World_Imagery","World_Street_Map","World_Terrain_Base","World_Topo_Map","World_Hillshade","Canvas/World_Light_Gray_Base","Canvas/World_Light_Gray_Reference","Canvas/World_Dark_Gray_Base","Canvas/World_Dark_Gray_Reference","Ocean/World_Ocean_Base","Ocean/World_Ocean_Reference","Reference/World_Boundaries_and_Places","Reference/World_Reference_Overlay","Reference/World_Transportation"].map(t=>t.toLowerCase());let fn=class extends FN(Ju.LoadableMixin(bO(FB))){constructor(t){super(t),this._isAuthoringAppSetByUser=!1,this._isAuthoringAppVersionSetByUser=!1,this._thumbnailFilename=null,this._updateFromPromise=null,this._resourceReferences={portalItem:null,paths:[]},this.applicationProperties=null,this.bookmarks=new mVe,this.floorInfo=null,this.geotriggersInfo=null,this.initialViewProperties=new l8,this.portalItem=null,this.presentation=null,this.sourceVersion=null,this.widgets=null,this.utilityNetworks=null,this.authoringApp=this.authoringAppVersion=null,this._isAuthoringAppSetByUser=this._isAuthoringAppVersionSetByUser=!1}destroy(){const t=this.portalItem;this.portalItem=null,t==null||t.destroy()}initialize(){if(this.when().catch(t=>{re.getLogger(this.declaredClass).error("#load()","Failed to load web map",t)}),this.resourceInfo){let t;try{t=this._validateJSON(this.resourceInfo)}catch(e){return void this.addResolvingPromise(Promise.reject(e))}this.read(t)}}set authoringApp(t){this._isAuthoringAppSetByUser=!0,this._set("authoringApp",t)}writeAuthoringApp(t,e){t&&this._isAuthoringAppSetByUser?e.authoringApp=t:e.authoringApp=Xwe}set authoringAppVersion(t){this._isAuthoringAppVersionSetByUser=!0,this._set("authoringAppVersion",t)}writeAuthoringAppVersion(t,e){t&&this._isAuthoringAppVersionSetByUser?e.authoringAppVersion=t:e.authoringAppVersion=Kne}readInitialViewProperties(t,e){var n;const i=new l8;e.background&&(i.background=VB.fromJSON(e.background));const r=(n=e.initialState)==null?void 0:n.viewpoint;return r&&(r.rotation&&mL.parse(e.version||"","webmap").lessThan(2,20)&&e.authoringApp===ZUt&&(r.rotation*=-1),i.viewpoint=Jn.fromJSON(r)),e.mapRangeInfo&&(i.rangeInfo=qce.fromJSON(e.mapRangeInfo)),e.spatialReference&&(i.spatialReference=Je.fromJSON(e.spatialReference)),i}writeInitialViewProperties(t,e,i,r){if(!t)return;const n=t.background;n&&n.color&&(e.background=n.write({},r)),t.viewpoint&&(e.initialState={viewpoint:t.viewpoint.write({},r)}),t.rangeInfo&&(e.mapRangeInfo=t.rangeInfo.toJSON(r)),t.spatialReference&&(e.spatialReference=t.spatialReference.write({},r))}writeLayers(t,e,i,r){e[i]=this._writeLayers(t,r,"operational-layers")}readSourceVersion(t,e){const[i,r]=e.version.split(".");return new mL(parseInt(i,10),parseInt(r,10))}writeSourceVersion(t,e,i){e[i]=`${c8.major}.${c8.minor}`}writeTables(t,e,i,r){const n=this._writeLayers(t,r,"tables");n.length&&(e[i]=n)}get thumbnailUrl(){return this.portalItem&&this.portalItem.thumbnailUrl||null}set thumbnailUrl(t){t?(this._override("thumbnailUrl",t),this._thumbnailFilename=this._generateCustomThumbnailFilename(t)):this._clearThumbnailOverride()}load(t){return this.addResolvingPromise(this._loadFromSource()),Promise.resolve(this)}loadAll(){return Foe(this,t=>{t(this.ground,this.basemap,this.layers,this.tables)})}read(t,e){e={...e,origin:"web-map"};const i=this._getAuthoringPropsState();I2e(this,t,r=>super.read(t,r),e),this._restoreAuthoringPropsFromState(i)}write(t,e){if(this.loadStatus!=="loaded"){const i=new H("webmap:not-loaded","Web map must be loaded before it can be serialized");throw re.getLogger(this.declaredClass).error("#toJSON()","Web map must be loaded before it can be serialized",this.loadError||this.loadStatus),i}return this._removeDanglingLayerRefs(),e={...e,origin:"web-map",restrictedWebMapWriting:!0,webmap:this},super.write(t,e)}async save(t){t=t||{},this._validateItem();const e=Q(()=>import("./saveUtils-3cf1f639.js"),["assets/saveUtils-3cf1f639.js","assets/resourceUtils-04f3e5fb.js"]);await this._updateFromPromise,await this.load(),await this._loadLayerContainers(),await this._beforeSave(),await this._validateMap();const i=this.portalItem,r=Bo(i.itemUrl),n={origin:"web-map",messages:[],writtenProperties:[],url:r,portal:i.portal||ya.getDefault(),portalItem:i,verifyItemRelativeUrls:r?{rootPath:r.path,writtenUrls:[]}:null,blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},s=this.write({},n);return await Promise.all(n.resources.pendingOperations),this._validateJSONForWriting(n,t),await this._updateItemProperties(i),await this._updateItem(i,s,n),await Promise.all([this._updateItemThumbnail(),e.then(({saveResources:o})=>o(this._resourceReferences,n,null))]),i}async saveAs(t,e){e=e||{};const i=this._getPortalItem(t),r=Q(()=>import("./saveUtils-3cf1f639.js"),["assets/saveUtils-3cf1f639.js","assets/resourceUtils-04f3e5fb.js"]);await this._updateFromPromise,await this.load(),await this._loadLayerContainers(),await this._beforeSave(),await this._validateMap();const n={origin:"web-map",messages:[],writtenProperties:[],url:null,portal:i.portal,portalItem:i,blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},s=this.write({},n);await Promise.all(n.resources.pendingOperations),this._validateJSONForWriting(n,e),await this._updateItemPropertiesForSaveAs(i);const o=this._getThumbnailState();return await this._createItem(i,s,n,e)&&(this._resourceReferences.portalItem=i),this._restoreThumbnailFromState(o),await Promise.all([this._updateItemThumbnail(),r.then(({saveResources:a})=>a(this._resourceReferences,n,null))]),i}async updateFrom(t,e){const i=this._updateFromInternal(t,e);this._updateFromPromise=i,await i,i===this._updateFromPromise&&(this._updateFromPromise=null)}getLayerJSONFromResourceInfo(t){var i,r,n,s;const e=this.resourceInfo;return this._collectAllLayersJSON([...((i=e==null?void 0:e.baseMap)==null?void 0:i.baseMapLayers)||[],...(e==null?void 0:e.operationalLayers)||[],...((s=(n=(r=this.basemap)==null?void 0:r.resourceInfo)==null?void 0:n.data)==null?void 0:s.baseMapLayers)||[]]).find(o=>o.id===t.id)}_collectAllLayersJSON(t){return t.reduce((e,i)=>(e.push(i),i.layerType==="GroupLayer"&&(e=e.concat(this._collectAllLayersJSON(i.layers||[]))),e),[])}_writeLayers(t,e,i){return e={...e,layerContainerType:i},t.map(r=>hQ(r,i==="tables"?null:this.getLayerJSONFromResourceInfo(r),e)).filter(Boolean).toArray()}_loadFromSource(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-map"}):this.portalItem&&this.portalItem.id?this._loadFromItem(this.portalItem):Promise.resolve()}async _loadFromItem(t){if(await t.load().catch(r=>{throw new H("webmap:load-portal-item","Failed to load portal item",{error:r})}),t.type!=="Web Map")throw new H("webmap:invalid-portal-item",`Invalid portal item type '${t.type}', expected 'Web Map'`,{type:t.type});const e=await t.fetchData();this.resourceInfo=e;const i={origin:"web-map",url:Bo(t.itemUrl),portal:t.portal||ya.getDefault(),portalItem:t,readResourcePaths:[]};return await this._readAndLoadFromJSON(e,i),this._resourceReferences={portalItem:t,paths:i.readResourcePaths??[]},this._computeInitialViewpoint()}_readAndLoadFromJSON(t,e){const i=this._validateJSON(t);return this.read(i,e),this._loadFromJSON(i,e)}_validateJSON(t){const e=mL.parse(t.version||"","webmap");return c8.validate(e),t.version=`${e.major}.${e.minor}`,t}_loadFromJSON(t,e){const i={context:{...e,layerContainerType:"operational-layers"}};return this.portalItem&&(i.context.portal=this.portalItem.portal||ya.getDefault()),Q(()=>import("./layersCreator-2ab7566d.js"),["assets/layersCreator-2ab7566d.js","assets/lazyLayerLoader-47b7672a.js","assets/portalLayers-5444e28e.js","assets/layersLoader-2d63a9c9.js","assets/fetchService-990f8c03.js","assets/jsonContext-7f6e363e.js"]).then(({populateOperationalLayers:r})=>{const n=[],s=t.operationalLayers;s&&s.length&&n.push(r(this.layers,s,i));const o={...i,context:{...i.context,layerContainerType:"tables"},defaultLayerType:"ArcGISFeatureLayer"},a=t.tables;return a&&a.length&&n.push(r(this.tables,a,o)),ma(n).then(()=>{})})}async _computeInitialViewpoint(){var r;let t=this.initialViewProperties;if((r=t==null?void 0:t.viewpoint)==null?void 0:r.targetGeometry)return;const i=await this._getExtentFromItem();i&&(t=t?t.clone():new l8,t.viewpoint=new Jn,t.viewpoint.targetGeometry=i,this.initialViewProperties=t)}async _getExtentFromItem(){var i,r;const t=(i=this.initialViewProperties)==null?void 0:i.spatialReference,e=(r=this.portalItem)==null?void 0:r.extent;return t&&e?t.isWGS84?e.clone():t.isWebMercator?Zg(e):(await Q(()=>Promise.resolve().then(()=>Zte),void 0)).getGeometryServiceURL(this.portalItem).then(n=>{const s=new qD;return s.geometries=[e],s.outSpatialReference=t,qz(n,s)}).then(n=>n[0]).catch(n=>(re.getLogger(this.declaredClass).error("Error projecting item's extent:",n),null)):null}_removeDanglingLayerRefs(){const t=this.applicationProperties,e=t&&t.viewing&&t.viewing.search,i=s=>this.allLayers.some(o=>o.id===s);e&&e.layers&&(e.layers=e.layers.filter(s=>i(s.id))),e&&e.tables&&(e.tables=e.tables.filter(s=>this.tables.some(o=>o.id===s.id)));const r=t&&t.editing&&t.editing.locationTracking;r&&r.info&&!i(r.info.layerId)&&(t.editing=null);const n=this.presentation&&this.presentation.slides;n&&n.forEach(s=>{s.visibleLayers&&(s.visibleLayers=s.visibleLayers.filter(o=>i(o.id)))})}async _validateMap(){var e;if(!((e=this.basemap)!=null&&e.baseLayers.length))throw new H("webmap:save","Map does not have a valid basemap with a base layer.");let t=null;if(await ow(()=>{const i=Tht(this.initialViewProperties,this.basemap);return t=i.spatialReference,!i.updating}),!Dn(t,this.initialViewProperties.spatialReference))throw new H("webmap:save","The spatial reference of the basemap is not compatible with the one from the map.",{expected:this.initialViewProperties.spatialReference,actual:t})}_validateItem(){if(!this.portalItem)throw re.getLogger(this.declaredClass).error("save: requires the portalItem property to be set"),new H("webmap:portal-item-not-set","Portal item to save to has not been set on the WebMap");this._validateItemType(this.portalItem)}_validateItemType(t){if(t.type!==tX)throw new H("webmap:portal-item-wrong-type",`Portal item needs to have type "${tX}"`)}_loadLayerContainers(){const t=[];return this.basemap&&t.push(this.basemap.load()),this.ground&&t.push(this.ground.load()),ma(t).then(()=>{})}async _beforeSave(){const t=[];for(const e of this.allLayers)if("beforeSave"in e&&typeof e.beforeSave=="function"){const i=e.beforeSave();i&&t.push(i)}await ma(t)}_loadAllLayers(){const t=this._getAllLayersAndTables().map(e=>e.load());return ma(t).then(()=>{})}_getAllLayersAndTables(){return this.allLayers.concat(this.allTables)}_validateJSONForWriting(t,e){let i=(t.messages?t.messages:[]).filter(r=>r.type==="error").map(r=>new H(r.name,r.message,r.details));if(t.blockedRelativeUrls&&(i=i.concat(t.blockedRelativeUrls.map(r=>new H("url:unsupported",`Relative url '${r}' is not supported in Web Map`)))),e.ignoreUnsupported&&(i=i.filter(r=>r.name!=="layer:unsupported"&&r.name!=="symbol:unsupported"&&r.name!=="symbol-layer:unsupported"&&r.name!=="property:unsupported"&&r.name!=="url:unsupported")),i.length>0)throw new H("webmap:save","Failed to save webmap due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:i})}async _updateItemProperties(t){t.extent=await this._getWGS84Extent(this.initialViewProperties.viewpoint.targetGeometry),await this._updateTypeKeywords(t)}async _updateItemPropertiesForSaveAs(t){lh(t,Ywe),lh(t,KUt),lh(t,Aoe.METADATA),lh(t,Kwe),lh(t,JUt),lh(t,ixe),lh(t,exe),lh(t,txe),await this._updateItemProperties(t)}async _getWGS84Extent(t){const e=t.clone().normalize();let i;if(e.length>1)for(const r of e)i?r.width>i.width&&(i=r):i=r;else i=e[0];return this._projectToWGS84(i)}async _projectToWGS84(t){const e=t.spatialReference;if(e.isWGS84)return t.clone();if(e.isWebMercator)return mS(t);const i=await Q(()=>Promise.resolve().then(()=>Zte),void 0),r=await i.getGeometryServiceURL(this.portalItem),n=new qD;return n.geometries=[t],n.outSpatialReference=Je.WGS84,(await qz(r,n))[0]}async _updateTypeKeywords(t){cE(t,Xwe),await this._loadAllLayers(),this._evalCollectorKeyword(t),this._evalDataEditingKeyword(t),this._evalOfflineKeyword(t),this._evalDeveloperBasemapKeyword(t),this._evalUtilityNetworkKeyword(t),t.typeKeywords&&(t.typeKeywords=t.typeKeywords.filter((e,i,r)=>r.indexOf(e)===i))}_evalCollectorKeyword(t){JC(t,Ywe)||JC(t,exe)||JC(t,txe)||JC(t,ixe)||!this._hasEditableFeatureLayer()?lh(t,Zwe):cE(t,Zwe)}_evalDataEditingKeyword(t){this._hasEditableFeatureLayer()?cE(t,Jwe):lh(t,Jwe)}_evalOfflineKeyword(t){!JC(t,Kwe)&&this._isOfflineCapableMap()?cE(t,Qwe):lh(t,Qwe)}_evalDeveloperBasemapKeyword(t){xht(this.basemap)?cE(t,rxe):lh(t,rxe)}_evalUtilityNetworkKeyword(t){var e;(e=this.utilityNetworks)!=null&&e.length?cE(t,nxe):lh(t,nxe)}_hasEditableFeatureLayer(){return this._getAllLayersAndTables().some(t=>t.loaded&&mpe(t)&&t.capabilities.operations.supportsEditing&&t.editingEnabled)}_isOfflineCapableMap(){return this._getAllLayersAndTables().filter(t=>t.type!=="group").every(t=>t.loaded&&this._isOfflineCapableLayer(t))}_isFeatureCollectionLike(t){return gB(t)||t.type==="map-notes"||t.type==="route"}_isOfflineCapableLayer(t){return mpe(t)&&t.capabilities.operations.supportsSync||this._isFeatureCollectionLike(t)&&!t.portalItem||(t.type==="tile"||t.type==="vector-tile")&&(t.capabilities.operations.supportsExportTiles||this._isExportableAGOLTileLayer(t)||wIe(t))&&t.spatialReference.equals(this.initialViewProperties.spatialReference)}_isExportableAGOLTileLayer(t){return t.type==="tile"&&vst(t.url)&&QUt.some(e=>{var i;return(i=t.url)==null?void 0:i.toLowerCase().includes("/"+e+"/")})}async _updateItem(t,e,i){await t.update({data:e}),this._syncUpInstanceWithItem(t,e,i)}async _createItem(t,e,i,r){const n=this.portalItem,s={item:n,authenticated:!(!(n!=null&&n.id)||!n.portal.user)},o=t.portal;await o.signIn();const{copyAllowed:a,itemReloaded:l}=await this._isCopyAllowed(s,o);if(s.authenticated||(s.authenticated=l),!a)throw new H("webmap:save-as-copy-not-allowed","Owner of this map does not allow others to save a copy");const c=await this._initializeNewItem(t,s,e,r);return this.portalItem=t,this._syncUpInstanceWithItem(t,e,i),c}async _isCopyAllowed(t,e){var n;const{item:i,authenticated:r}=t;return i!=null&&i.id&&((n=i.typeKeywords)!=null&&n.includes("useOnly"))?i.portal.portalHostname!==e.portalHostname?{copyAllowed:!1,itemReloaded:!1}:(r||await i.reload(),{copyAllowed:i.itemControl==="admin"||i.itemControl==="update",itemReloaded:!0}):{copyAllowed:!0,itemReloaded:!1}}async _initializeNewItem(t,e,i,r){var h;const n=t.portal,{item:s,authenticated:o}=e,{folder:a,copyAllResources:l}=r;let c=!1;if(l&&(s!=null&&s.id)&&JWe(s.portal.url,n.url)&&(o||await s.reload(),s.isOrgItem)){const{total:p}=await s.fetchResources();c=!!p}if(c){const p=await s.copy({copyResources:"all",folder:a});t.id=p.id,t.portal=p.portal;const f=t.toJSON();await t.load(),t.read(f),await t.update({data:i})}else await((h=n.user)==null?void 0:h.addItem({item:t,folder:a,data:i}));return c}_syncUpInstanceWithItem(t,e,i){DV.prototype.read.call(this,{version:e.version,authoringApp:e.authoringApp,authoringAppVersion:e.authoringAppVersion},{origin:"web-map",ignoreDefaults:!0,url:t.itemUrl&&Bo(t.itemUrl)}),nUt(i),this.resourceInfo=e}async _updateItemThumbnail(){var t;this.thumbnailUrl&&this._isOverridden("thumbnailUrl")&&(await((t=this.portalItem)==null?void 0:t.updateThumbnail({thumbnail:this.thumbnailUrl,filename:this._thumbnailFilename})),this._clearThumbnailOverride())}_getPortalItem(t){let e=l_.from(t);return e.id&&(e=e.clone(),e.id=null),e.type||(e.type=tX),e.portal||(e.portal=ya.getDefault()),this._validateItemType(e),e}async _updateFromInternal(t,e){if(e=e||{},await ow(()=>t.ready),this._updateInitialViewProperties(t,e),t.map===this)for(const i of t.allLayerViews)for(const r of["visible","featureEffect"])r in i&&r in i.layer&&i._isOverridden(r)&&(i.layer[r]=i[r]);await this._updateThumbnailUrl(t,e)}_updateInitialViewProperties(t,e){var i,r;if(e.backgroundExcluded||(this.initialViewProperties.background=(i=t.background)==null?void 0:i.clone()),this.initialViewProperties.spatialReference=(r=t.spatialReference)==null?void 0:r.clone(),e.viewpointExcluded||(this.initialViewProperties.viewpoint=new Jn({rotation:t.rotation,scale:e.scalePreserved?t.scale:null,targetGeometry:this._getViewExtent(t)})),!e.widgetsExcluded)for(const n of t.persistableViewModels)n.updateWebDocument(this)}_getViewExtent(t){const e=t.center.clone().normalize(),i=t.extent.clone(),r=i.width/2;return i.xmin=e.x-r,i.xmax=e.x+r,i}async _updateThumbnailUrl(t,e){if(e.thumbnailExcluded)return;const i=VUt(t,e.thumbnailSize),r=await t.takeScreenshot({format:"png",width:i.width,height:i.height});this._setAutoGeneratedThumbnail(r.dataUrl)}_setAutoGeneratedThumbnail(t){this.thumbnailUrl=t,this._thumbnailFilename=null}_clearThumbnailOverride(){this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"),this._thumbnailFilename=null}_generateCustomThumbnailFilename(t){if(fd(t)){const e=vO(t),i=e&&e.mediaType,r=i&&l$.get(i.toLowerCase())||null,n=`thumbnail${Date.now()}`;return r?`${n}.${r}`:n}return null}_getThumbnailState(){let t=this.thumbnailUrl;return t&&(t=this._isOverridden("thumbnailUrl")?t:Zne(t,"w","8192")),{thumbnailUrl:t,filename:this._thumbnailFilename}}_restoreThumbnailFromState(t){this.thumbnailUrl=t.thumbnailUrl,this._thumbnailFilename=t.filename}_getAuthoringPropsState(){return{authoringApp:this.authoringApp,authoringAppVersion:this.authoringAppVersion,isAuthoringAppSetByUser:this._isAuthoringAppSetByUser,isAuthoringAppVersionSetByUser:this._isAuthoringAppVersionSetByUser}}_restoreAuthoringPropsFromState(t){t.isAuthoringAppSetByUser?this.authoringApp=t.authoringApp:this._isAuthoringAppSetByUser=!1,t.isAuthoringAppVersionSetByUser?this.authoringAppVersion=t.authoringAppVersion:this._isAuthoringAppVersionSetByUser=!1}static fromJSON(t){const e=t;if(!e)throw new H("webmap:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:e})}};fn.VERSION=c8,u([d({type:WUt,json:{write:!0}})],fn.prototype,"applicationProperties",void 0),u([d({type:String,json:{write:{allowNull:!0,ignoreOrigin:!0}}})],fn.prototype,"authoringApp",null),u([Ne("authoringApp")],fn.prototype,"writeAuthoringApp",null),u([d({type:String,json:{write:{allowNull:!0,ignoreOrigin:!0}}})],fn.prototype,"authoringAppVersion",null),u([Ne("authoringAppVersion")],fn.prototype,"writeAuthoringAppVersion",null),u([d({json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],fn.prototype,"basemap",void 0),u([d({type:mVe,json:{write:{overridePolicy:t=>({enabled:!!(t&&t.length>0),ignoreOrigin:!0})}}})],fn.prototype,"bookmarks",void 0),u([d({type:SUt,json:{read:{source:"mapFloorInfo"},write:{target:"mapFloorInfo"}}})],fn.prototype,"floorInfo",void 0),u([d({type:LUt,json:{write:!0}})],fn.prototype,"geotriggersInfo",void 0),u([d({type:l8,nonNullable:!0,json:{read:{source:["background","initialState.viewpoint","mapRangeInfo","spatialReference"]},write:{ignoreOrigin:!0,target:{background:{type:VB},"initialState.viewpoint":{type:Jn},mapRangeInfo:{type:qce},spatialReference:{type:Je}}}}})],fn.prototype,"initialViewProperties",void 0),u([Oe("initialViewProperties")],fn.prototype,"readInitialViewProperties",null),u([Ne("initialViewProperties")],fn.prototype,"writeInitialViewProperties",null),u([d({json:{read:!1,write:{target:"operationalLayers",ignoreOrigin:!0}}})],fn.prototype,"layers",void 0),u([Ne("layers")],fn.prototype,"writeLayers",null),u([d({type:l_})],fn.prototype,"portalItem",void 0),u([d({json:{write:!0}})],fn.prototype,"presentation",void 0),u([d()],fn.prototype,"resourceInfo",void 0),u([d({readOnly:!0,type:mL,json:{read:{source:"version"},write:{allowNull:!0,ignoreOrigin:!0,target:"version",isRequired:!0}}})],fn.prototype,"sourceVersion",void 0),u([Oe("sourceVersion")],fn.prototype,"readSourceVersion",null),u([Ne("sourceVersion")],fn.prototype,"writeSourceVersion",null),u([d({json:{read:!1,write:{ignoreOrigin:!0}}})],fn.prototype,"tables",void 0),u([Ne("tables")],fn.prototype,"writeTables",null),u([d()],fn.prototype,"thumbnailUrl",null),u([d({type:kUt,json:{write:!0}})],fn.prototype,"widgets",void 0),u([d({type:YUt,json:{read:!0,write:!0}})],fn.prototype,"utilityNetworks",void 0),fn=u([$("esri.WebMap")],fn);const e8t=fn;function t8t(){const t=ut.useRef(null),[e,i]=ut.useState(null);ut.useEffect(()=>{r()},[]);async function r(){if(!(t!=null&&t.current))return;const n=new e8t({portalItem:{id:"769b776b17c4406493b5f96044c26696"}}),s=new K$e({container:t==null?void 0:t.current,map:n});i(s)}return Cr("div",{className:"App",children:Cr("div",{id:"view",ref:t})})}function i8t(){return Cr(HBe,{children:MS(VBe,{children:[Cr(TP,{path:"/",element:Cr(YBe,{})}),Cr(TP,{path:"/media-layer-image",element:Cr(Ggt,{})}),Cr(TP,{path:"/media-layer-video",element:Cr(iUt,{})}),Cr(TP,{path:"/media-layer-webmap",element:Cr(t8t,{})})]})})}VRe(window.location.href);const r8t=rX.createRoot(document.getElementById("root"));r8t.render(Cr(gL.StrictMode,{children:Cr(i8t,{})}));export{BLt as $,$t as A,ga as B,ft as C,Jb as D,er as E,zi as F,kt as G,e7e as H,Gr as I,Bl as J,V6t as K,nt as L,YV as M,n8t as N,Qn as O,Ge as P,ue as Q,Ce as R,M$e as S,E_ as T,fN as U,Vi as V,H as W,Nr as X,En as Y,bft as Z,mH as _,mA as a,nbe as a$,Xi as a0,Ve as a1,Mp as a2,ne as a3,zt as a4,_e as a5,ON as a6,E6t as a7,zCe as a8,r5t as a9,Ha as aA,Xri as aB,ma as aC,Dct as aD,l_ as aE,tt as aF,G$ as aG,Apt as aH,xjt as aI,Sjt as aJ,Dn as aK,fw as aL,Xse as aM,vN as aN,SBt as aO,DM as aP,f2e as aQ,ni as aR,sD as aS,Jr as aT,Ki as aU,Hoe as aV,sp as aW,Kdt as aX,pw as aY,IDt as aZ,PDt as a_,ir as aa,Jg as ab,u as ac,d as ad,ec as ae,$ as af,Khe as ag,ve as ah,Q as ai,ar as aj,re as ak,z as al,Ee as am,gn as an,em as ao,gs as ap,ct as aq,Or as ar,C$t as as,qe as at,eDe as au,ib as av,ls as aw,Lr as ax,Ta as ay,dle as az,mt as b,kB as b$,Gei as b0,jei as b1,LDt as b2,NDt as b3,DDt as b4,Jc as b5,Mt as b6,$Dt as b7,Bei as b8,zei as b9,Ws as bA,E9t as bB,rr as bC,bp as bD,J2e as bE,qre as bF,w0 as bG,Q2e as bH,fY as bI,GJ as bJ,ID as bK,ja as bL,Bi as bM,D8t as bN,g$e as bO,nr as bP,MVt as bQ,Joe as bR,An as bS,Vkt as bT,ua as bU,LM as bV,Fw as bW,PR as bX,ey as bY,JFe as bZ,Jn as b_,jLt as ba,Kt as bb,Fdt as bc,Dft as bd,Le as be,M$ as bf,fD as bg,Xt as bh,Sm as bi,Ih as bj,u2 as bk,Je as bl,Kne as bm,DCe as bn,qse as bo,JL as bp,rw as bq,XCe as br,Yr as bs,Kn as bt,Fe as bu,yo as bv,mm as bw,amt as bx,dt as by,wr as bz,rt as c,Pnt as c$,le as c0,Sn as c1,Ue as c2,QFe as c3,e4e as c4,e$e as c5,Jd as c6,t$e as c7,Rdt as c8,cjt as c9,CGt as cA,nVt as cB,yN as cC,gN as cD,ZBt as cE,JBt as cF,YBt as cG,fO as cH,hM as cI,Tst as cJ,Oe as cK,hV as cL,CR as cM,OAe as cN,GM as cO,Vo as cP,CMe as cQ,se as cR,xp as cS,NPe as cT,FPe as cU,KBt as cV,sct as cW,rct as cX,ow as cY,vr as cZ,Nt as c_,Udt as ca,io as cb,ujt as cc,CM as cd,pO as ce,k9t as cf,s_ as cg,HGe as ch,dEt as ci,mWe as cj,uYt as ck,EOe as cl,G9t as cm,qpe as cn,TOe as co,vm as cp,ZV as cq,W9 as cr,jVt as cs,JGe as ct,Wh as cu,gm as cv,Du as cw,C9 as cx,dO as cy,D9 as cz,Ft as d,Kb as d$,qnt as d0,l7t as d1,mi as d2,unt as d3,QQt as d4,nei as d5,dei as d6,J1e as d7,Z1e as d8,Ont as d9,sEe as dA,dne as dB,qGe as dC,zGe as dD,EY as dE,hne as dF,rVt as dG,oVt as dH,sIe as dI,lIe as dJ,aIe as dK,Sut as dL,$g as dM,hD as dN,DB as dO,Dne as dP,Ip as dQ,zo as dR,Nne as dS,mHe as dT,rMt as dU,Hre as dV,yne as dW,ZA as dX,w$ as dY,Fa as dZ,Fb as d_,MW as da,H9 as db,lBt as dc,Xe as dd,ly as de,U_ as df,Dmt as dg,k4 as dh,R$e as di,QMe as dj,ott as dk,att as dl,qLt as dm,WAe as dn,hHt as dp,ZL as dq,tc as dr,Qre as ds,kZe as dt,_m as du,mN as dv,Wf as dw,mZ as dx,Nc as dy,_$ as dz,ui as e,WBt as e$,Ide as e0,X9t as e1,art as e2,Noe as e3,Nnt as e4,TBt as e5,Fnt as e6,wBt as e7,ya as e8,Bo as e9,dV as eA,fd as eB,vO as eC,M_ as eD,Li as eE,kN as eF,Yl as eG,zat as eH,Dw as eI,pb as eJ,H2 as eK,xO as eL,Bt as eM,iL as eN,qb as eO,YYt as eP,ZYt as eQ,cD as eR,wEt as eS,$_ as eT,fm as eU,SYt as eV,xJt as eW,lnt as eX,w3 as eY,qBt as eZ,K9 as e_,G2 as ea,xBt as eb,v7t as ec,kut as ed,Vlt as ee,zlt as ef,Blt as eg,fo as eh,lrt as ei,MOe as ej,z9t as ek,U9t as el,bit as em,W9t as en,Wpe as eo,a8t as ep,l8t as eq,Rct as er,Tm as es,Ori as et,ort as eu,ROe as ev,Sw as ew,Y1e as ex,Aut as ey,jh as ez,Np as f,JVt as f$,EN as f0,XBt as f1,Q9 as f2,TN as f3,MPe as f4,sWe as f5,HBt as f6,to as f7,bYt as f8,xZe as f9,ql as fA,St as fB,B5e as fC,pa as fD,Ga as fE,y8t as fF,S_ as fG,Js as fH,Yf as fI,jo as fJ,me as fK,Bh as fL,l4 as fM,vYt as fN,$de as fO,pYt as fP,WEt as fQ,J9 as fR,my as fS,q2 as fT,AIt as fU,qle as fV,cy as fW,NN as fX,Ks as fY,V2 as fZ,Z6e as f_,uw as fa,CIt as fb,bCt as fc,_Ct as fd,Ure as fe,wmt as ff,ZVt as fg,Fp as fh,r2 as fi,Ost as fj,Br as fk,Une as fl,ce as fm,py as fn,od as fo,FYt as fp,NYt as fq,O_ as fr,zM as fs,Wt as ft,Fu as fu,ha as fv,uQt as fw,oce as fx,MYt as fy,RYt as fz,Et as g,tei as g$,Nn as g0,lB as g1,P7t as g2,A_ as g3,xCe as g4,kb as g5,TCe as g6,WIt as g7,sr as g8,NRe as g9,mVt as gA,fVt as gB,gVt as gC,GL as gD,ed as gE,jHe as gF,ri as gG,c2 as gH,iJ as gI,as as gJ,tJ as gK,nJ as gL,gV as gM,bZe as gN,v8t as gO,Ir as gP,Xj as gQ,sde as gR,aVt as gS,wM as gT,Wa as gU,xr as gV,LS as gW,ot as gX,iei as gY,hei as gZ,c$e as g_,ew as ga,pXe as gb,JC as gc,o9t as gd,IBt as ge,bO as gf,lHt as gg,Iw as gh,Zc as gi,fe as gj,uM as gk,Ne as gl,Yhe as gm,cOe as gn,cit as go,lit as gp,Nw as gq,Zyt as gr,yVt as gs,SEe as gt,Qi as gu,Sst as gv,NBt as gw,dVt as gx,_Vt as gy,pVt as gz,g6t as h,ev as h$,QT as h0,dw as h1,fst as h2,nzt as h3,Go as h4,Sa as h5,te as h6,Lf as h7,vV as h8,IV as h9,mn as hA,nO as hB,I7t as hC,gZ as hD,z2 as hE,w$t as hF,ji as hG,Yu as hH,Gc as hI,Wi as hJ,YIe as hK,S as hL,fs as hM,hd as hN,Dt as hO,Ie as hP,Lz as hQ,Cy as hR,At as hS,Gi as hT,Am as hU,j as hV,Dr as hW,Yi as hX,Hi as hY,Di as hZ,Ht as h_,OSe as ha,TM as hb,Ub as hc,izt as hd,FWe as he,am as hf,Z9 as hg,cN as hh,zc as hi,ozt as hj,Jht as hk,ojt as hl,HLt as hm,mei as hn,Mce as ho,iWt as hp,th as hq,ps as hr,Os as hs,M as ht,Qe as hu,$S as hv,vB as hw,tr as hx,wn as hy,Q2 as hz,P9 as i,tv as i$,KB as i0,jw as i1,Kc as i2,S7 as i3,si as i4,by as i5,Cw as i6,Gw as i7,A7 as i8,Do as i9,ine as iA,ale as iB,Yoe as iC,Uti as iD,Hti as iE,ole as iF,E2 as iG,Fo as iH,om as iI,SRt as iJ,wa as iK,Ke as iL,Kr as iM,DBt as iN,DV as iO,Ju as iP,Moe as iQ,kct as iR,$st as iS,znt as iT,poe as iU,Mct as iV,m8t as iW,X9 as iX,Kh as iY,RCe as iZ,Wl as i_,lce as ia,E7 as ib,YO as ic,DAt as id,Uae as ie,HO as ig,tCt as ih,Xs as ii,DN as ij,GHe as ik,f8t as il,mY as im,Op as io,oht as ip,ym as iq,$e as ir,iCt as is,lFt as it,r8e as iu,c7e as iv,u7e as iw,r7e as ix,u8t as iy,XB as iz,qc as j,cge as j$,oUe as j0,NL as j1,tZe as j2,lwt as j3,Gti as j4,qri as j5,PM as j6,ak as j7,M4e as j8,sh as j9,BL as jA,Ci as jB,kre as jC,pi as jD,loe as jE,Pe as jF,j0 as jG,rqt as jH,_r as jI,iii as jJ,_9t as jK,L8t as jL,TD as jM,Om as jN,AYt as jO,YDe as jP,Xf as jQ,OEt as jR,EFt as jS,jti as jT,Eb as jU,tyt as jV,ba as jW,be as jX,al as jY,Ug as jZ,$ht as j_,YFt as ja,nIe as jb,qgt as jc,Izt as jd,Mbe as je,iM as jf,HM as jg,$n as jh,JYe as ji,Dp as jj,Nzt as jk,Zt as jl,ds as jm,Dzt as jn,cr as jo,wO as jp,ci as jq,UOe as jr,VOe as js,EYt as jt,o3 as ju,ge as jv,Svt as jw,$9 as jx,Hj as jy,DL as jz,he as k,tw as k$,nde as k0,$7t as k1,R$t as k2,vBt as k3,bBt as k4,oUt as k5,y9t as k6,sUt as k7,hy as k8,gMe as k9,_n as kA,Bw as kB,BM as kC,zw as kD,w7 as kE,YXt as kF,_Me as kG,t9t as kH,N9 as kI,N9t as kJ,o8t as kK,qa as kL,fce as kM,Zn as kN,co as kO,T9t as kP,jse as kQ,Ott as kR,YSe as kS,R9 as kT,Jne as kU,R_ as kV,SM as kW,rUt as kX,cb as kY,Wu as kZ,HCe as k_,yMe as ka,$zt as kb,PLe as kc,_Et as kd,yYt as ke,qVt as kf,p8t as kg,Pei as kh,mOe as ki,_Yt as kj,Nu as kk,gOe as kl,v3e as km,vEe as kn,$8t as ko,Vrt as kp,tBt as kq,Bp as kr,ARt as ks,nd as kt,Tr as ku,Rh as kv,xl as kw,nn as kx,Ua as ky,yy as kz,Qdt as l,Rm as l$,gXe as l0,mmt as l1,szt as l2,ih as l3,Ptt as l4,U_e as l5,ACt as l6,vVt as l7,cYt as l8,yEe as l9,jb as lA,kti as lB,Vti as lC,XVt as lD,wWe as lE,UT as lF,Nti as lG,pz as lH,KVt as lI,JXt as lJ,d4e as lK,sB as lL,on as lM,wD as lN,rd as lO,rZ as lP,S2 as lQ,t7 as lR,nh as lS,Q_ as lT,Ji as lU,pl as lV,ECe as lW,zti as lX,Bti as lY,kne as lZ,Jgt as l_,lVt as la,sVt as lb,IGe as lc,kGe as ld,L9 as le,iVt as lf,N2e as lg,eGe as lh,q9t as li,D9t as lj,COe as lk,bOe as ll,xB as lm,oy as ln,$N as lo,Vit as lp,gYt as lq,a5e as lr,Sr as ls,a6 as lt,XO as lu,iF as lv,Rmt as lw,H9t as lx,Ote as ly,b8t as lz,Xoe as m,TY as m$,Gri as m0,nQt as m1,rOe as m2,YP as m3,FLe as m4,lz as m5,OF as m6,DR as m7,Get as m8,vt as m9,wZe as mA,bi as mB,_o as mC,xn as mD,RR as mE,$Jt as mF,$Ee as mG,OVt as mH,Gs as mI,J8t as mJ,Z8t as mK,G2e as mL,B2e as mM,CAe as mN,Mzt as mO,Pzt as mP,Ozt as mQ,Xh as mR,_2 as mS,ka as mT,go as mU,iv as mV,fR as mW,dl as mX,RJt as mY,Vte as mZ,Q8t as m_,we as ma,I9 as mb,T_ as mc,HAe as md,RGe as me,t2 as mf,kDt as mg,N6 as mh,dU as mi,oLt as mj,aLt as mk,VQe as ml,rHt as mm,CZe as mn,AZe as mo,d2 as mp,zu as mq,Lzt as mr,eHt as ms,tHt as mt,gy as mu,BR as mv,Gye as mw,jg as mx,kyt as my,aHt as mz,P as n,FVt as n$,mB as n0,i9t as n1,r9t as n2,n9t as n3,s9t as n4,ll as n5,Uoe as n6,pD as n7,pCe as n8,ys as n9,K8t as nA,Y8t as nB,X8t as nC,ad as nD,gS as nE,SEt as nF,Rne as nG,nge as nH,nWt as nI,rge as nJ,ose as nK,Xl as nL,Lp as nM,rB as nN,oAt as nO,ml as nP,QB as nQ,Cm as nR,ko as nS,d$t as nT,s8t as nU,zS as nV,z_t as nW,Tqt as nX,wqt as nY,xqt as nZ,JGt as n_,Ye as na,In as nb,iHt as nc,dyt as nd,K1 as ne,jIe as nf,zIe as ng,Fc as nh,Qb as ni,j9 as nj,Ine as nk,x_ as nl,udt as nm,As as nn,kIe as no,V_ as np,vae as nq,GN as nr,Pr as ns,q$ as nt,GB as nu,ULe as nv,sHt as nw,nHt as nx,xS as ny,ydt as nz,Pft as o,jle as o$,Fz as o0,f5e as o1,tWt as o2,Voe as o3,gI as o4,MR as o5,iZ as o6,bl as o7,dM as o8,Gre as o9,wt as oA,jr as oB,YVt as oC,yae as oD,Fve as oE,l1e as oF,dD as oG,Pw as oH,ip as oI,RY as oJ,WGt as oK,eb as oL,ud as oM,L7 as oN,Yc as oO,wl as oP,Jh as oQ,Is as oR,x4e as oS,YGt as oT,ISt as oU,cd as oV,Ygt as oW,L4e as oX,iO as oY,vM as oZ,rte as o_,K7t as oa,pN as ob,WMt as oc,lAt as od,M2 as oe,Qg as of,Pt as og,Xre as oh,wYt as oi,Dg as oj,lFe as ok,Y2 as ol,_ae as om,DVt as on,KGt as oo,HVt as op,Sy as oq,mse as or,QAe as os,xm as ot,eO as ou,Jt as ov,za as ow,C7 as ox,y4e as oy,R4e as oz,Woe as p,_Wt as p$,PVt as p0,KBe as p1,QGt as p2,J7 as p3,nz as p4,RAt as p5,Zri as p6,Kri as p7,Jri as p8,xN as p9,gct as pA,FN as pB,$Lt as pC,ILt as pD,OO as pE,Dst as pF,h8t as pG,U8t as pH,Qje as pI,hBt as pJ,Snt as pK,xHe as pL,PHe as pM,Nlt as pN,Flt as pO,klt as pP,wp as pQ,v4t as pR,b4t as pS,d4t as pT,sri as pU,i9 as pV,mii as pW,x4t as pX,ZN as pY,mz as pZ,c0e as p_,yV as pa,GVt as pb,kx as pc,ige as pd,dg as pe,yD as pf,wae as pg,RM as ph,NVt as pi,Ext as pj,xae as pk,$Ae as pl,AM as pm,RLe as pn,G_ as po,Iyt as pp,I_ as pq,qB as pr,X1t as ps,XGt as pt,qye as pu,rWt as pv,Z2 as pw,WYe as px,bst as py,kPe as pz,Mi as q,Ase as q$,QYe as q0,_l as q1,rF as q2,use as q3,ld as q4,V7 as q5,VAe as q6,zp as q7,jM as q8,NJt as q9,zit as qA,j9t as qB,vYe as qC,mBt as qD,_G as qE,vG as qF,C9t as qG,c8t as qH,aft as qI,xWe as qJ,V9t as qK,dOe as qL,rn as qM,cJ as qN,Drt as qO,Nrt as qP,iyt as qQ,tm as qR,ZGt as qS,cyt as qT,w8t as qU,rXe as qV,Yne as qW,tje as qX,uei as qY,$u as qZ,Vc as q_,Ew as qa,LJt as qb,FJt as qc,DJt as qd,lOt as qe,dOt as qf,cOt as qg,uOt as qh,hOt as qi,$9t as qj,O9t as qk,R9t as ql,B9t as qm,I9t as qn,Hse as qo,F9t as qp,wVt as qq,xVt as qr,bVt as qs,Kqe as qt,fYt as qu,hYt as qv,qu as qw,Fit as qx,Pit as qy,Npe as qz,v as r,jQe as r$,Rse as r0,dae as r1,ws as r2,Xzt as r3,uQe as r4,lQe as r5,Gzt as r6,Hzt as r7,qzt as r8,vLe as r9,Vf as rA,Yit as rB,P9t as rC,nUt as rD,gB as rE,cE as rF,Aoe as rG,QBe as rH,t7t as rI,lh as rJ,mpe as rK,gUt as rL,lUt as rM,lXe as rN,rBt as rO,EM as rP,A$ as rQ,BZ as rR,Jzt as rS,Zzt as rT,une as rU,FCe as rV,bb as rW,TUe as rX,rNt as rY,LBt as rZ,doe as r_,_Le as ra,Vzt as rb,XKe as rc,_Qe as rd,bgt as re,pgt as rf,wgt as rg,vgt as rh,Kmt as ri,Qmt as rj,mgt as rk,xgt as rl,egt as rm,zzt as rn,Yzt as ro,dQe as rp,Sse as rq,BGt as rr,Qzt as rs,Bzt as rt,Gmt as ru,hQe as rv,SO as rw,Rgt as rx,ast as ry,va as rz,v6t as s,f5t as s$,Umt as s0,HGt as s1,pae as s2,jGt as s3,GGt as s4,fLe as s5,Wzt as s6,cLe as s7,UGt as s8,Wmt as s9,r4t as sA,zce as sB,y8e as sC,R4t as sD,b8e as sE,O4t as sF,T8e as sG,I4t as sH,C8e as sI,L4t as sJ,VF as sK,Wj as sL,RWe as sM,GDe as sN,L_t as sO,KA as sP,LRt as sQ,URt as sR,aRt as sS,hRt as sT,hce as sU,EDt as sV,SDt as sW,H7 as sX,CDt as sY,Uz as sZ,cAt as s_,VGt as sa,Xmt as sb,jzt as sc,zGt as sd,dLe as se,Kzt as sf,X$ as sg,k0t as sh,S_t as si,zDe as sj,VDe as sk,P_t as sl,Gae as sm,hvt as sn,uNe as so,Wae as sp,gvt as sq,r1t as sr,x1t as ss,E2t as st,Dz as su,uCt as sv,zle as sw,zSt as sx,D2 as sy,PNt as sz,Pri as t,eVt as t$,I8e as t0,y5t as t1,D8e as t2,v5t as t3,k8e as t4,Z7 as t5,$5t as t6,B5t as t7,Q5t as t8,tkt as t9,hct as tA,wst as tB,act as tC,Est as tD,Cct as tE,Zhe as tF,TEe as tG,foe as tH,IB as tI,Tme as tJ,Nst as tK,HK as tL,CB as tM,Lst as tN,Roe as tO,WPe as tP,rh as tQ,Vp as tR,eB as tS,Rht as tT,Aht as tU,Eht as tV,hQ as tW,Ql as tX,EB as tY,vGe as tZ,_Ge as t_,rkt as ta,HAt as tb,U8e as tc,N5t as td,bkt as te,HMt as tf,gOt as tg,OPt as th,JPt as ti,HPt as tj,b3e as tk,GPe as tl,Sct as tm,rp as tn,fCe as to,hst as tp,Foe as tq,FBt as tr,Fst as ts,Ust as tt,mst as tu,hoe as tv,yst as tw,_st as tx,iw as ty,vZe as tz,wN as u,l7e as u$,yG as u0,D7e as u1,Lct as u2,AO as u3,roe as u4,NOe as u5,Htt as u6,tnt as u7,qtt as u8,zOe as u9,zb as uA,fme as uB,YL as uC,zst as uD,Vst as uE,Ow as uF,iB as uG,Gse as uH,rlt as uI,nst as uJ,B_ as uK,xlt as uL,olt as uM,alt as uN,Hat as uO,qat as uP,Wat as uQ,Xat as uR,Yat as uS,Zat as uT,Jat as uU,Kat as uV,Qat as uW,elt as uX,tlt as uY,ilt as uZ,qPe as u_,WOe as ua,LV as ub,IOe as uc,F$ as ud,gst as ue,Ts as uf,g8t as ug,l2 as uh,WVt as ui,kM as uj,I2 as uk,APe as ul,Wre as um,FC as un,SJ as uo,clt as up,H8 as uq,gQ as ur,_Z as us,fy as ut,ay as uu,GEe as uv,VCe as uw,mhe as ux,lD as uy,xst as uz,R as v,Rte as v$,lm as v0,ezt as v1,aV as v2,qCe as v3,mqe as v4,rV as v5,B9 as v6,kst as v7,$Bt as v8,tzt as v9,q1t as vA,Wgt as vB,Hgt as vC,Vg as vD,r6e as vE,qS as vF,N1t as vG,rzt as vH,m6e as vI,y6e as vJ,aS as vK,aL as vL,IVt as vM,tce as vN,FOt as vO,u6e as vP,POt as vQ,f6e as vR,d6e as vS,NOt as vT,eh as vU,jte as vV,vl as vW,p6e as vX,XN as vY,IOt as vZ,ED as v_,Yje as va,Nhe as vb,k as vc,W8t as vd,uBt as ve,BLe as vf,Ryt as vg,rl as vh,Lht as vi,jV as vj,Okt as vk,cBt as vl,qne as vm,aOt as vn,Td as vo,yWt as vp,gWt as vq,KYt as vr,uOe as vs,$M as vt,azt as vu,UQe as vv,t4 as vw,HJ as vx,DPe as vy,lE as vz,xa as w,s7 as w0,CCt as w1,a3t as w2,o3t as w3,s3t as w4,K_ as w5,Qqt as w6,JE as w7,kXe as w8,Y9t as w9,ooe as wa,oBt as wb,u7t as wc,$Gt as wd,xYt as we,JJt as wf,es as x,e2 as y,Ct as z};
