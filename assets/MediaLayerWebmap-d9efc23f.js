import{_ as H,r as st,a as Rt}from"./index-9a6385f7.js";import{e as r,y as o,a as p,at as d,fR as ar,au as X,ep as Ce,fS as Ht,ae as lr,fT as rt,a1 as f,fU as Yt,bd as pr,p as oe,fV as Ye,fW as Et,R as Y,w as ur,G as Pe,fX as Tt,fY as Z,fZ as dr,ar as Q,f_ as Qt,v as Xt,f$ as Je,g0 as cr,g1 as yr,g2 as se,g3 as hr,cJ as mr,ax as F,as as k,g4 as Fe,g5 as nt,g6 as Zt,g7 as er,g8 as wr,j as it,g9 as gr,fr as vr,$ as fr,bU as ye,ap as br,ga as Sr,gb as Ir,gc as Tr,gd as _r,ge as Me,a3 as jr,gf as Nr,b$ as De,bJ as $r,cb as Ot,da as Ar,gg as R,gh as Rr,gi as me,gj as Re,gk as Er,gl as xt,gm as Or,gn as xr,go as Lr,gp as kr,gq as Ur,dN as Cr,gr as Pr,gs as _t,L as Fr,gt as Vr}from"./calcite-c5ae4991.js";import{i as Jr}from"./originUtils-1469eeaf.js";import{t as Mr}from"./featureQueryAll-5c48871f.js";import{a as Lt,n as kt}from"./project-0e0370f9.js";import{m as jt,_ as Dr}from"./MapView-c3d00f71.js";import{r as Gr}from"./Version-e2fa8281.js";let z=class extends d{constructor(t){super(t),this.moment=null,this.fullUpdate=!1,this.validateErrorsCreated=!1,this.dirtyAreaCount=null,this.exceededTransferLimit=null,this.serviceEdits=null}};r([o({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.moment=e?e.getTime():null}}}})],z.prototype,"moment",void 0),r([o({type:Boolean,json:{write:!0}})],z.prototype,"fullUpdate",void 0),r([o({type:Boolean,json:{write:!0}})],z.prototype,"validateErrorsCreated",void 0),r([o({type:Number,json:{write:!0}})],z.prototype,"dirtyAreaCount",void 0),r([o({type:Boolean,json:{write:!0}})],z.prototype,"exceededTransferLimit",void 0),r([o({type:[Object],json:{write:!0}})],z.prototype,"serviceEdits",void 0),z=r([p("esri.rest.networks.support.ValidateNetworkTopologyResult")],z);const Br=z,Wr=ar()({Pending:"job-waiting",InProgress:"job-executing",Completed:"job-succeeded"});let te=class extends Br{constructor(t){super(t),this.featureServiceUrl=null,this.statusUrl=null,this.status=null,this.submissionTime=null,this.lastUpdatedTime=null,this._timer=void 0}destroy(){clearInterval(this._timer)}async checkJobStatus(t){const i={...t,query:{f:"json"}},{data:s}=await Ce(this.statusUrl,i);if(this.read(s),(this.serviceEdits||this.exceededTransferLimit)&&this.featureServiceUrl){const n={edits:null,addedFeatures:[],updatedFeatures:[],deletedFeatures:[],addedAttachments:[],updatedAttachments:[],deletedAttachments:[],exceededTransferLimit:!0};Ht.emit("edits",{serviceUrl:this.featureServiceUrl??"",layerId:null,event:n})}return this}async waitForJobCompletion(t={}){const{interval:i=1e3,statusCallback:s}=t;return new Promise((n,a)=>{this._clearTimer();const l=setInterval(()=>{this._timer||a(lr()),this.checkJobStatus().then(u=>{const{status:w}=u;switch(this.status=w,w){case"job-succeeded":this._clearTimer(),n(this);break;case"job-waiting":case"job-executing":s&&s(this)}},u=>{this._clearTimer(),a(u)})},i);this._timer=l})}_clearTimer(){clearInterval(this._timer),this._timer=void 0}};r([o()],te.prototype,"featureServiceUrl",void 0),r([o({type:String,json:{write:!0}})],te.prototype,"statusUrl",void 0),r([X(Wr)],te.prototype,"status",void 0),r([o({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.submissionTime=e?e.getTime():null}}}})],te.prototype,"submissionTime",void 0),r([o({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.lastUpdatedTime=e?e.getTime():null}}}})],te.prototype,"lastUpdatedTime",void 0),te=r([p("esri.networks.support.TopologyValidationJobInfo")],te);const qr=te;async function Ut(e,t){if(e==="Utility Network Layer"){const{default:i}=await H(()=>Promise.resolve().then(()=>ri),void 0);return new i({layerUrl:t})}return null}async function zr(e){let t="portalItem"in e?e:{portalItem:e};!t.portalItem||t.portalItem instanceof rt||(t={...t,portalItem:new rt(t.portalItem)});const i=t.portalItem;if(await i.load(),i.type!=="Feature Service")throw new f("portal:unknown-item-type","Unknown item type '${type}'",{type:i.type});const s=i.url,n=await Ce(s,{responseType:"json",query:{f:"json"}}),a="Network Layer";if(n.data.type&&n.data.type.includes(a))return Ut(n.data.type,s);if(n.data.layers){const l=n.data.layers.find(u=>u.type.includes(a));if(l){const u=`${s}/${l.id}`;return Ut(l.type,u)}}return null}let le=class extends d{constructor(t){super(t),this.globalIds=[],this.creators=[],this.tags=[],this.names=[]}};r([o({type:[String],json:{write:!0}})],le.prototype,"globalIds",void 0),r([o({type:[String],json:{write:!0}})],le.prototype,"creators",void 0),r([o({type:[String],json:{write:!0}})],le.prototype,"tags",void 0),r([o({type:[String],json:{write:!0}})],le.prototype,"names",void 0),le=r([p("esri.rest.networks.support.QueryNamedTraceConfigurationsParameters")],le);const Kr=le;let g=class extends Yt(Tt){static fromPortalItem(e){return zr(e)}constructor(e){super(e),this.id=null,this.title=null,this.layerUrl=null,this.dataElement=null,this.fullExtent=null,this.spatialReference=null,this.type=null,this.sourceJSON=null}initialize(){this.when().catch(e=>{pr(e)||oe.getLogger(this.declaredClass).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})})}get datasetName(){var e;return((e=this.dataElement)==null?void 0:e.name)??null}get owner(){var e;return((e=this.dataElement)==null?void 0:e.userIdentity)??null}get schemaGeneration(){var e;return((e=this.dataElement)==null?void 0:e.schemaGeneration)??null}get parsedUrl(){return Ye(this.layerUrl)}get featureServiceUrl(){const e=this.parsedUrl&&Et(this.parsedUrl.path);return Y(e)?e.url.path:null}get networkServiceUrl(){return this.featureServiceUrl?this.featureServiceUrl.replace(/\/FeatureServer/i,"/UtilityNetworkServer"):null}get layerId(){const e=this.parsedUrl&&Et(this.parsedUrl.path);return Y(e)?e.sublayer:null}get networkSystemLayers(){return null}async load(e){return this.addResolvingPromise(this._fetchDataElement(this.featureServiceUrl,this.layerId.toString(),e)),this.addResolvingPromise(this._fetchLayerMetaData(this.layerUrl,e)),this}getLayerIdBySourceId(e){if(this.dataElement){const t=this.dataElement.domainNetworks;for(const i of t){for(const s of i.edgeSources?i.edgeSources:[])if(s.sourceId===e)return s.layerId;for(const s of i.junctionSources?i.junctionSources:[])if(s.sourceId===e)return s.layerId}return null}return null}async queryNamedTraceConfigurations(e,t){var a;const{queryNamedTraceConfigurations:i}=await H(()=>import("./queryNamedTraceConfigurations-9064eefd.js"),["assets/queryNamedTraceConfigurations-9064eefd.js","assets/calcite-c5ae4991.js","assets/index-9a6385f7.js","assets/index-5026a37a.css","assets/calcite-96fa36fd.css","assets/originUtils-1469eeaf.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/featureQueryAll-5c48871f.js","assets/project-0e0370f9.js","assets/MapView-c3d00f71.js","assets/unitBezier-881ac1eb.js","assets/TileStrategy-6e83933b.js","assets/TileStore-bec0a021.js","assets/TileInfoView-c5645cd8.js","assets/Version-e2fa8281.js"]),s=this.networkServiceUrl,n=new Kr({...e});return((a=await i(s,n,{...t}))==null?void 0:a.namedTraceConfigurations)??null}async validateTopology(e,t){if(!e.validateArea)throw new f("network:undefined-validateArea","the network must have validateArea defined in the validate network topology parameters.");const{validateNetworkTopology:i}=await H(()=>import("./validateNetworkTopology-15fec606.js"),["assets/validateNetworkTopology-15fec606.js","assets/calcite-c5ae4991.js","assets/index-9a6385f7.js","assets/index-5026a37a.css","assets/calcite-96fa36fd.css","assets/originUtils-1469eeaf.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/featureQueryAll-5c48871f.js","assets/project-0e0370f9.js","assets/MapView-c3d00f71.js","assets/unitBezier-881ac1eb.js","assets/TileStrategy-6e83933b.js","assets/TileStore-bec0a021.js","assets/TileInfoView-c5645cd8.js","assets/Version-e2fa8281.js"]),s=this.networkServiceUrl,n=await i(s,e,{...t});if(n!=null&&n.serviceEdits){const a={edits:null,addedFeatures:[],updatedFeatures:[],deletedFeatures:[],addedAttachments:[],updatedAttachments:[],deletedAttachments:[],editedFeatures:n.serviceEdits,exceededTransferLimit:!1};Ht.emit("edits",{serviceUrl:this.featureServiceUrl??"",layerId:null,event:a})}return n}async submitTopologyValidationJob(e,t){if(!e.validateArea)throw new f("network:undefined-validateArea","the network must have validateArea defined in the validate network topology parameters.");if(!e.gdbVersion)throw new f("network:undefined-gdb-version","version must be defined");const{submitValidateNetworkTopologyJob:i}=await H(()=>import("./validateNetworkTopology-15fec606.js"),["assets/validateNetworkTopology-15fec606.js","assets/calcite-c5ae4991.js","assets/index-9a6385f7.js","assets/index-5026a37a.css","assets/calcite-96fa36fd.css","assets/originUtils-1469eeaf.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/featureQueryAll-5c48871f.js","assets/project-0e0370f9.js","assets/MapView-c3d00f71.js","assets/unitBezier-881ac1eb.js","assets/TileStrategy-6e83933b.js","assets/TileStore-bec0a021.js","assets/TileInfoView-c5645cd8.js","assets/Version-e2fa8281.js"]),s=this.networkServiceUrl,n=await i(s,e,{...t});return new qr({statusUrl:n,featureServiceUrl:this.featureServiceUrl})}async _fetchLayerMetaData(e,t){const i=await Ce(e,{responseType:"json",query:{f:"json"},...t});this.sourceJSON=i.data,this.read(i.data,{origin:"service"})}async _fetchDataElement(e,t,i){if(this.dataElement)return;const s=await Ce(`${e}/queryDataElements`,{responseType:"json",query:{layers:JSON.stringify([t]),f:"json"},...i}).then(n=>{var a;return(a=n.data.layerDataElements)==null?void 0:a[0]});s&&this.read(s,{origin:"service"})}};r([o({type:String,nonNullable:!0,json:{origins:{"web-map":{read:!0,write:{isRequired:!0}},service:{read:!0}},read:!1}})],g.prototype,"id",void 0),r([o({type:String,nonNullable:!0,json:{origins:{"web-map":{read:!0,write:{isRequired:!0}},service:{read:{source:"name"}}},read:!1}})],g.prototype,"title",void 0),r([o({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"url"},write:{target:"url",isRequired:!0}}},read:!1}})],g.prototype,"layerUrl",void 0),r([o({type:Object,json:{origins:{service:{read:!0}},read:!1}})],g.prototype,"dataElement",void 0),r([o({type:ur,json:{origins:{service:{read:{source:"extent"}}},read:!1}})],g.prototype,"fullExtent",void 0),r([o({type:Pe,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:!1}})],g.prototype,"spatialReference",void 0),r([o({type:["utility","trace"],readOnly:!0,json:{read:!1,write:!1}})],g.prototype,"type",void 0),r([o({readOnly:!0})],g.prototype,"datasetName",null),r([o({readOnly:!0})],g.prototype,"owner",null),r([o({readOnly:!0})],g.prototype,"schemaGeneration",null),r([o({readOnly:!0})],g.prototype,"parsedUrl",null),r([o({readOnly:!0})],g.prototype,"featureServiceUrl",null),r([o({readOnly:!0})],g.prototype,"networkServiceUrl",null),r([o({readOnly:!0})],g.prototype,"layerId",null),r([o()],g.prototype,"sourceJSON",void 0),r([o({readOnly:!0})],g.prototype,"networkSystemLayers",null),g=r([p("esri.networks.Network")],g);const Hr=g;var O;(function(e){e[e.RTJunctionJunctionConnectivity=1]="RTJunctionJunctionConnectivity",e[e.RTContainment=2]="RTContainment",e[e.RTAttachment=3]="RTAttachment",e[e.RTJunctionEdgeConnectivity=4]="RTJunctionEdgeConnectivity",e[e.RTEdgeJunctionEdgeConnectivity=5]="RTEdgeJunctionEdgeConnectivity"})(O||(O={}));const Ge=new Z({connected:"connected",upstream:"upstream",downstream:"downstream",shortestPath:"shortest-path",subnetwork:"subnetwork",subnetworkController:"subnetwork-controller",loops:"loops",isolation:"isolation"});new Z({connectivity:"connectivity",attachment:"attachment",containment:"containment",junctionEdgeFromConnectivity:"junction-edge-from-connectivity",junctionMidspanConnectivity:"junction-midspan-connectivity",junctionEdgeToConnectivity:"junction-edge-to-connectivity"});new Z({normal:"normal",rebuild:"rebuild",forceRebuild:"force-rebuild"});let pe=class extends dr(Tt){constructor(t){super(t),this.request=Ce}initialize(){}async load(t){const i=this.layer.load(t).then(()=>this._initializeRulesTable());return this.addResolvingPromise(i),this}getFeatureSQL(t,i){var b,A;const s=t.layerId.toString(),n=(b=t.fieldsIndex)==null?void 0:b.normalizeFieldName("assetGroup"),a=(A=t.fieldsIndex)==null?void 0:A.normalizeFieldName("assetType"),l=n?i.attributes[n]:null,u=a?i.attributes[a]:null,w=this.rulesHash[s];if(w){const S=w.assetGroupHash[l];if(S)return S.assetTypeHash[u]||null}return null}async _initializeRulesTable(){var n,a,l,u,w,b,A,S,V,T;const t={};let i;(function(y){y[y.from=0]="from",y[y.to=1]="to",y[y.via=2]="via"})(i||(i={}));const s=[{networkSourceId:"fromNetworkSource",assetGroupId:"fromAssetGroup",assetTypeId:"fromAssetType"},{networkSourceId:"toNetworkSource",assetGroupId:"toAssetGroup",assetTypeId:"toAssetType"},{networkSourceId:"viaNetworkSource",assetGroupId:"viaAssetGroup",assetTypeId:"viaAssetType"}];for(const y of this.rules){if(y.ruleType!==O.RTJunctionJunctionConnectivity&&y.ruleType!==O.RTJunctionEdgeConnectivity&&y.ruleType!==O.RTEdgeJunctionEdgeConnectivity)continue;let B=[[i.from,i.to],[i.to,i.from]];y.ruleType===O.RTEdgeJunctionEdgeConnectivity&&(B=[[i.from,i.via],[i.via,i.from],[i.to,i.via],[i.via,i.to]]);for(const W of B){const ee=W.shift(),ot=W.shift();let q=!1;switch(y.ruleType){case O.RTEdgeJunctionEdgeConnectivity:q=ee===i.from||ee===i.to;break;case O.RTJunctionEdgeConnectivity:q=ee===i.to}const $e=s[ee],_=y[$e.networkSourceId].layerId.toString(),I=(a=(n=y[$e.assetGroupId])==null?void 0:n.assetGroupCode)==null?void 0:a.toString(),U=(u=(l=y[$e.assetTypeId])==null?void 0:l.assetTypeCode)==null?void 0:u.toString(),j=s[ot],N=y[j.networkSourceId].layerId.toString(),ne=(b=(w=y[j.assetGroupId])==null?void 0:w.assetGroupCode)==null?void 0:b.toString(),J=y[j.assetTypeId],Ae=(A=J==null?void 0:J.assetTypeCode)==null?void 0:A.toString(),ae=t[_]?t[_]:{assetGroupHash:{}};if(!(I&&U&&ne&&Ae))continue;const x=ae.assetGroupHash[I]?ae.assetGroupHash[I]:{assetTypeHash:{}},h=x.assetTypeHash[U]?x.assetTypeHash[U]:{};if(h[N]=h[N]?h[N]:{},q){h[_]=h[_]?h[_]:{};const At=`(assetgroup = ${I} AND assettype = ${U})`;h[_].anyVertex=h[_].anyVertex?`${h[_].anyVertex}`:`${At}`,J.connectivityPolicy==="esriNECPEndVertex"&&(h[_].endVertex=(S=h[_])!=null&&S.endVertex?`${h[_].endVertex}`:`${At}`)}const Ve=`(assetgroup = ${ne} AND assettype = ${Ae})`;h[N].anyVertex=(V=h[N])!=null&&V.anyVertex?`${h[N].anyVertex} OR ${Ve}`:`${Ve}`,J.connectivityPolicy==="esriNECPEndVertex"&&(h[N].endVertex=(T=h[N])!=null&&T.endVertex?`${h[N].endVertex} OR ${Ve}`:`${Ve}`),x.assetTypeHash[U]=h,ae.assetGroupHash[I]=x,t[_]=ae}}this.rulesHash=t}};r([o({constructOnly:!0})],pe.prototype,"layer",void 0),r([o({constructOnly:!0})],pe.prototype,"rules",void 0),r([o()],pe.prototype,"rulesHash",void 0),r([o({constructOnly:!0})],pe.prototype,"request",void 0),pe=r([p("esri.networks.RulesTable")],pe);const Yr=pe;let L=class extends d{constructor(t){super(t),this.conditionBarriers=[],this.outputConditions=[],this.functions=[],this.functionBarriers=[],this.traversabilityScope=null,this.shortestPathNetworkAttributeName=null,this.includeBarriers=null,this.validateConsistency=null,this.ignoreBarriersAtStartingPoints=null}};r([o({type:[Object],json:{write:!0}})],L.prototype,"conditionBarriers",void 0),r([o({type:[Object],json:{write:!0}})],L.prototype,"outputConditions",void 0),r([o({type:[Object],json:{write:!0}})],L.prototype,"functions",void 0),r([o({type:[Object],json:{write:!0}})],L.prototype,"functionBarriers",void 0),r([o({type:["junctions","edges","junctionsAndEdges"],json:{write:!0}})],L.prototype,"traversabilityScope",void 0),r([o({type:String,json:{write:!0}})],L.prototype,"shortestPathNetworkAttributeName",void 0),r([o({type:Boolean,json:{write:!0}})],L.prototype,"includeBarriers",void 0),r([o({type:Boolean,json:{write:!0}})],L.prototype,"validateConsistency",void 0),r([o({type:Boolean,json:{write:!0}})],L.prototype,"ignoreBarriersAtStartingPoints",void 0),L=r([p("esri.networks.support.TraceConfiguration")],L);const Nt=L;let m=class extends Nt{constructor(t){super(t),this.filterBarriers=[],this.domainNetworkName=null,this.filterBitsetNetworkAttributeName=null,this.filterFunctionBarriers=[],this.filterScope=null,this.includeContainers=null,this.includeContent=null,this.includeIsolated=null,this.includeStructures=null,this.includeUpToFirstSpatialContainer=null,this.nearestNeighbor=null,this.outputFilterCategories=[],this.outputFilters=[],this.propagators=[],this.subnetworkName=null,this.targetTierName=null,this.tierName=null,this.validateLocatability=null}};r([o({type:[Object],json:{write:!0}})],m.prototype,"filterBarriers",void 0),r([o({type:String,json:{write:!0}})],m.prototype,"domainNetworkName",void 0),r([o({type:String,json:{write:!0}})],m.prototype,"filterBitsetNetworkAttributeName",void 0),r([o({type:[Object],json:{write:!0}})],m.prototype,"filterFunctionBarriers",void 0),r([o({type:["junctions","edges","junctionsAndEdges"],json:{write:!0}})],m.prototype,"filterScope",void 0),r([o({type:Boolean,json:{write:!0}})],m.prototype,"includeContainers",void 0),r([o({type:Boolean,json:{write:!0}})],m.prototype,"includeContent",void 0),r([o({type:Boolean,json:{write:!0}})],m.prototype,"includeIsolated",void 0),r([o({type:Boolean,json:{write:!0}})],m.prototype,"includeStructures",void 0),r([o({type:Boolean,json:{write:!0}})],m.prototype,"includeUpToFirstSpatialContainer",void 0),r([o({type:Object,json:{write:!0}})],m.prototype,"nearestNeighbor",void 0),r([o({type:[Object],json:{write:!0}})],m.prototype,"outputFilterCategories",void 0),r([o({type:[Object],json:{write:!0}})],m.prototype,"outputFilters",void 0),r([o({type:[Object],json:{write:!0}})],m.prototype,"propagators",void 0),r([o({type:String,json:{write:!0}})],m.prototype,"subnetworkName",void 0),r([o({type:String,json:{write:!0}})],m.prototype,"targetTierName",void 0),r([o({type:String,json:{write:!0}})],m.prototype,"tierName",void 0),r([o({type:Boolean,json:{write:!0}})],m.prototype,"validateLocatability",void 0),m=r([p("esri.networks.support.UNTraceConfiguration")],m);const Qr=m;let $=class extends Qt{constructor(t){super(t),this.globalId=null,this.title=null,this.traceConfiguration=null,this.creationDate=null,this.creator=null,this.description=null,this.minStartingPoints=null,this.resultTypes=[],this.tags=[],this.traceType=null}readTraceConfiguration(t,i){return t.tierName!==void 0?Qr.fromJSON(t):Nt.fromJSON(t)}};r([o({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"id"},write:{target:"id",isRequired:!0}},service:{read:{source:"globalId"},write:{target:"globalId",isRequired:!0}}},read:!1}})],$.prototype,"globalId",void 0),r([o({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"title"},write:{target:"title",isRequired:!0}},service:{read:{source:"name"},write:{target:"name",isRequired:!0}}},read:!1}})],$.prototype,"title",void 0),r([o({type:Nt,json:{origins:{service:{read:!0,write:!0}},read:!1}})],$.prototype,"traceConfiguration",void 0),r([Q("service","traceConfiguration")],$.prototype,"readTraceConfiguration",null),r([o({type:Date,json:{origins:{service:{read:!0,write:!0}},read:!1}})],$.prototype,"creationDate",void 0),r([o({type:String,json:{origins:{service:{read:!0,write:!0}},read:!1}})],$.prototype,"creator",void 0),r([o({type:String,json:{origins:{service:{read:!0,write:!0}},read:!1}})],$.prototype,"description",void 0),r([o({type:["none","one","many"],json:{origins:{service:{read:{source:"minNumStartingPoints"},write:{target:"minNumStartingPoints"}}},read:!1}})],$.prototype,"minStartingPoints",void 0),r([o({type:[Object],json:{origins:{service:{read:!0,write:!0}},read:!1}})],$.prototype,"resultTypes",void 0),r([o({type:[String],json:{origins:{service:{read:!0,write:!0}},read:!1}})],$.prototype,"tags",void 0),r([o({type:Ge.apiValues,json:{type:Ge.jsonValues,origins:{service:{read:Ge.read,write:Ge.write}},read:!1}})],$.prototype,"traceType",void 0),$=r([p("esri.networks.support.NamedTraceConfiguration")],$);const Xr=$;let K=class extends Xt{constructor(t){super(t),this.rulesTableId=null,this.rulesTableUrl=null,this.subnetworksTableId=null,this.subnetworksTableUrl=null,this.dirtyAreasLayerId=null,this.dirtyAreasLayerUrl=null}};r([o({constructOnly:!0})],K.prototype,"rulesTableId",void 0),r([o({constructOnly:!0})],K.prototype,"rulesTableUrl",void 0),r([o({constructOnly:!0})],K.prototype,"subnetworksTableId",void 0),r([o({constructOnly:!0})],K.prototype,"subnetworksTableUrl",void 0),r([o({constructOnly:!0})],K.prototype,"dirtyAreasLayerId",void 0),r([o({constructOnly:!0})],K.prototype,"dirtyAreasLayerUrl",void 0),K=r([p("esri.networks.support.NetworkSystemLayers")],K);const Zr=K;let we=class extends d{constructor(t){super(t),this.id=null,this.name=null}};r([o({type:Number,json:{read:{source:"terminalId"},write:{target:"terminalId"}}})],we.prototype,"id",void 0),r([o({type:String,json:{read:{source:"terminalName"},write:{target:"terminalName"}}})],we.prototype,"name",void 0),r([o({type:Boolean,json:{write:!0}})],we.prototype,"isUpstreamTerminal",void 0),we=r([p("esri.networks.support.Terminal")],we);const ei=we,Be=new Z({esriUNTMBidirectional:"bidirectional",esriUNTMDirectional:"directional"});let re=class extends d{constructor(t){super(t),this.defaultConfiguration=null,this.id=null,this.name=null,this.terminals=[],this.traversabilityModel=null}};r([o({type:String,json:{write:!0}})],re.prototype,"defaultConfiguration",void 0),r([o({type:Number,json:{read:{source:"terminalConfigurationId"},write:{target:"terminalConfigurationId"}}})],re.prototype,"id",void 0),r([o({type:String,json:{read:{source:"terminalConfigurationName"},write:{target:"terminalConfigurationName"}}})],re.prototype,"name",void 0),r([o({type:[ei],json:{write:!0}})],re.prototype,"terminals",void 0),r([o({type:Be.apiValues,json:{type:Be.jsonValues,read:Be.read,write:Be.write}})],re.prototype,"traversabilityModel",void 0),re=r([p("esri.networks.support.TerminalConfiguration")],re);const Ct=re,ti="esri.networks.UtilityNetwork",We=oe.getLogger(ti);let E=class extends Hr{constructor(t){super(t),this.sharedNamedTraceConfigurations=[],this.type="utility"}get serviceTerritoryFeatureLayerId(){var t;return((t=this.dataElement)==null?void 0:t.serviceTerritoryFeatureLayerId)??null}get networkSystemLayers(){var t,i,s,n,a,l;return new Zr({rulesTableId:(t=this.sourceJSON)==null?void 0:t.systemLayers.rulesTableId,rulesTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${(i=this.sourceJSON)==null?void 0:i.systemLayers.rulesTableId}`:null,subnetworksTableId:(s=this.sourceJSON)==null?void 0:s.systemLayers.subnetworksTableId,subnetworksTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${(n=this.sourceJSON)==null?void 0:n.systemLayers.subnetworksTableId}`:null,dirtyAreasLayerId:(a=this.sourceJSON)==null?void 0:a.systemLayers.dirtyAreasLayerId,dirtyAreasLayerUrl:this.sourceJSON?`${this.featureServiceUrl}/${(l=this.sourceJSON)==null?void 0:l.systemLayers.dirtyAreasLayerId}`:null})}get rulesTableId(){var t;return Je(We,"rulesTableId",{replacement:"networkSystemLayers.rulesTableId",version:"4.25"}),(t=this.sourceJSON)==null?void 0:t.systemLayers.rulesTableId}get rulesTableUrl(){return Je(We,"rulesTableUrl",{replacement:"networkSystemLayers.rulesTableUrl",version:"4.25"}),this.sourceJSON?`${this.featureServiceUrl}/${this.networkSystemLayers.rulesTableId}`:null}get subnetworksTableId(){var t;return Je(We,"subnetworksTableId",{replacement:"networkSystemLayers.subnetworksTableId",version:"4.25"}),(t=this.sourceJSON)==null?void 0:t.systemLayers.subnetworksTableId}get subnetworksTableUrl(){return Je(We,"subnetworksTableUrl",{replacement:"networkSystemLayers.subnetworksTableUrl",version:"4.25"}),this.sourceJSON?`${this.featureServiceUrl}/${this.networkSystemLayers.subnetworksTableId}`:null}get terminalConfigurations(){var t;return((t=this.dataElement)==null?void 0:t.terminalConfigurations.map(i=>Ct.fromJSON(i)))||[]}get domainNetworkNames(){var t;return((t=this.dataElement)==null?void 0:t.domainNetworks.map(i=>i.domainNetworkName))||[]}get _utilityLayerList(){var i,s;const t=new Set;return(s=(i=this.dataElement)==null?void 0:i.domainNetworks)==null||s.map(n=>{n.edgeSources.map(a=>{t.add(a.layerId)}),n.junctionSources.map(a=>{t.add(a.layerId)})}),t}async load(t){return this.addResolvingPromise(super.load(t)),this.addResolvingPromise(this._loadNamedTraceConfigurationsFromNetwork(t)),this}getTerminalConfiguration(t){var b,A,S,V;let i=null,s=null;const n=t.layer;let a=null;if((n==null?void 0:n.type)!=="feature"||(a=n.layerId,a===null))return null;const l=t.attributes;if(l==null)return null;for(const T of Object.keys(l))T.toUpperCase()==="ASSETGROUP"&&(i=t.getAttribute(T)),T.toUpperCase()==="ASSETTYPE"&&(s=t.getAttribute(T));if(!this.dataElement)return null;let u=null;const w=this.dataElement.domainNetworks;for(const T of w){const y=(b=T.junctionSources)==null?void 0:b.find(B=>B.layerId===a);if(y){const B=(A=y.assetGroups)==null?void 0:A.find(W=>W.assetGroupCode===i);if(B){const W=(S=B.assetTypes)==null?void 0:S.find(ee=>ee.assetTypeCode===s);if(W){u=W.terminalConfigurationId;break}}}}if(u!=null){const T=(V=this.dataElement.terminalConfigurations)==null?void 0:V.find(y=>y.terminalConfigurationId===u);return T?Ct.fromJSON(T):null}return null}getTierNames(t){var s;const i=(s=this.dataElement)==null?void 0:s.domainNetworks.find(n=>n.domainNetworkName===t);return(i==null?void 0:i.tiers.map(n=>n.name))||[]}async getRulesTable(){return this._createRulesTable()}isUtilityLayer(t){return this._utilityLayerList.has(t.layerId)}async _loadNamedTraceConfigurationsFromNetwork(t){var n;if(((n=this.sharedNamedTraceConfigurations)==null?void 0:n.length)===0)return;const i=this.sharedNamedTraceConfigurations.map(a=>a.globalId),s=await this.queryNamedTraceConfigurations({globalIds:i},t);for(const a of this.sharedNamedTraceConfigurations){const l=s==null?void 0:s.find(u=>u.globalId===a.globalId);if(l){const u=l.write({},{origin:"service"});a.read(u,{origin:"service"})}}}async _createRulesTable(){var a;const t=new cr({url:this.rulesTableUrl});await t.load();const i=(a=this.dataElement)==null?void 0:a.domainNetworks;if(!i)return null;const s=i.flatMap(l=>[...l.edgeSources,...l.junctionSources]),n=(await this._queryRulesTable(t)).map(l=>this._hydrateRuleInfo(t,s,l));return new Yr({layer:t,rules:n})}async _queryRulesTable(t){const i=new yr({where:"1=1",outFields:["*"]});return(await Mr(t,i)).features}_hydrateRuleInfo(t,i,s){const n=t.fieldsIndex,a=n.get("RULETYPE"),l=n.get("CREATIONDATE"),u=n.get("FROMNETWORKSOURCEID"),w=n.get("FROMASSETGROUP"),b=n.get("FROMASSETTYPE"),A=n.get("FROMTERMINALID"),S=n.get("TONETWORKSOURCEID"),V=n.get("TOASSETGROUP"),T=n.get("TOASSETTYPE"),y=n.get("TOTERMINALID"),B=n.get("VIANETWORKSOURCEID"),W=n.get("VIAASSETGROUP"),ee=n.get("VIAASSETTYPE"),ot=n.get("VIATERMINALID"),q=s.attributes[a.name],$e=new Date(s.attributes[l.name]),_=[{networkSourceId:s.attributes[u.name],assetGroupId:s.attributes[w.name],assetTypeId:s.attributes[b.name],terminalId:s.attributes[A.name]},{networkSourceId:s.attributes[S.name],assetGroupId:s.attributes[V.name],assetTypeId:s.attributes[T.name],terminalId:s.attributes[y.name]},{networkSourceId:s.attributes[B.name],assetGroupId:s.attributes[W.name],assetTypeId:s.attributes[ee.name],terminalId:s.attributes[ot.name]}];let I;(function(j){j[j.from=0]="from",j[j.to=1]="to",j[j.via=2]="via"})(I||(I={}));const U={ruleType:q,creationDate:$e};for(const j of[I.from,I.to,I.via]){if(q!==O.RTEdgeJunctionEdgeConnectivity&&j===I.via)continue;const N=_[j],ne=i.find(h=>h.sourceId===N.networkSourceId),J=ne==null?void 0:ne.assetGroups.find(h=>h.assetGroupCode===N.assetGroupId),Ae=J==null?void 0:J.assetTypes.find(h=>h.assetTypeCode===N.assetTypeId);let ae=this._getTerminal(q,Ae,N);q!==O.RTContainment&&q!==O.RTAttachment||(ae=null);let x="";switch(j){case I.from:x="from";break;case I.to:x="to";break;case I.via:x="via"}U[`${x}NetworkSource`]=ne,U[`${x}AssetGroup`]=J,U[`${x}AssetType`]=Ae,U[`${x}Terminal`]=ae}return U}_getTerminal(t,i,s){var l,u;if(t===O.RTAttachment||t===O.RTContainment)return null;const n=i==null?void 0:i.terminalConfigurationId,a=(l=this.terminalConfigurations)==null?void 0:l.find(w=>w.id===n);return((u=a==null?void 0:a.terminals)==null?void 0:u.find(w=>w.id===s.terminalId))??null}};r([o({type:[Xr],json:{origins:{"web-map":{read:{source:"traceConfigurations"},write:{target:"traceConfigurations"}},service:{read:{source:"traceConfigurations"}}},read:!1}})],E.prototype,"sharedNamedTraceConfigurations",void 0),r([o({type:["utility"],readOnly:!0,json:{read:!1,write:!1}})],E.prototype,"type",void 0),r([o({readOnly:!0})],E.prototype,"serviceTerritoryFeatureLayerId",null),r([o({readOnly:!0})],E.prototype,"networkSystemLayers",null),r([o({readOnly:!0})],E.prototype,"rulesTableId",null),r([o({readOnly:!0})],E.prototype,"rulesTableUrl",null),r([o({readOnly:!0})],E.prototype,"subnetworksTableId",null),r([o({readOnly:!0})],E.prototype,"subnetworksTableUrl",null),r([o({readOnly:!0})],E.prototype,"terminalConfigurations",null),r([o({readOnly:!0})],E.prototype,"domainNetworkNames",null),E=r([p("esri.networks.UtilityNetwork")],E);const tr=E,ri=Object.freeze(Object.defineProperty({__proto__:null,default:tr},Symbol.toStringTag,{value:"Module"}));let ie=class extends d{constructor(t){super(t),this.facilityIdField=null,this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};r([o({type:String,json:{write:!0}})],ie.prototype,"facilityIdField",void 0),r([o({type:String,json:{write:!0}})],ie.prototype,"layerId",void 0),r([o({type:String,json:{write:!0}})],ie.prototype,"nameField",void 0),r([o({type:String,json:{write:!0}})],ie.prototype,"siteIdField",void 0),r([o({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],ie.prototype,"sublayerId",void 0),ie=r([p("esri.layers.support.FacilityLayerInfo")],ie);const ii=ie;let C=class extends d{constructor(t){super(t),this.facilityIdField=null,this.layerId=null,this.levelIdField=null,this.levelNumberField=null,this.longNameField=null,this.shortNameField=null,this.sublayerId=null,this.verticalOrderField=null}};r([o({type:String,json:{write:!0}})],C.prototype,"facilityIdField",void 0),r([o({type:String,json:{write:!0}})],C.prototype,"layerId",void 0),r([o({type:String,json:{write:!0}})],C.prototype,"levelIdField",void 0),r([o({type:String,json:{write:!0}})],C.prototype,"levelNumberField",void 0),r([o({type:String,json:{write:!0}})],C.prototype,"longNameField",void 0),r([o({type:String,json:{write:!0}})],C.prototype,"shortNameField",void 0),r([o({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],C.prototype,"sublayerId",void 0),r([o({type:String,json:{write:!0}})],C.prototype,"verticalOrderField",void 0),C=r([p("esri.layers.support.LevelLayerInfo")],C);const oi=C;let ue=class extends d{constructor(t){super(t),this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};r([o({type:String,json:{write:!0}})],ue.prototype,"layerId",void 0),r([o({type:String,json:{write:!0}})],ue.prototype,"nameField",void 0),r([o({type:String,json:{write:!0}})],ue.prototype,"siteIdField",void 0),r([o({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],ue.prototype,"sublayerId",void 0),ue=r([p("esri.layers.support.SiteLayerInfo")],ue);const si=ue;let ge=class extends d{constructor(t){super(t),this.levelLayer=null,this.facilityLayer=null,this.siteLayer=null}};r([o({type:oi,json:{write:!0}})],ge.prototype,"levelLayer",void 0),r([o({type:ii,json:{write:!0}})],ge.prototype,"facilityLayer",void 0),r([o({type:si,json:{write:!0}})],ge.prototype,"siteLayer",void 0),ge=r([p("esri.support.MapFloorInfo")],ge);const ni=ge;let ve=class extends se(d){constructor(t){super(t),this.expression=null,this.returnType="string",this.title=null}};r([o({type:String,json:{write:{isRequired:!0}}})],ve.prototype,"expression",void 0),r([o({type:["number","string"],json:{write:!0}})],ve.prototype,"returnType",void 0),r([o({type:String,json:{write:!0}})],ve.prototype,"title",void 0),ve=r([p("esri.webdoc.geotriggersInfo.ExpressionInfo")],ve);const rr=ve,qe=new Z({deviceLocation:"device-location"});let Ee=class extends se(d){constructor(t){super(t),this.filterExpression=null,this.type="device-location"}};r([o({type:rr,json:{write:!0}})],Ee.prototype,"filterExpression",void 0),r([o({type:qe.apiValues,readOnly:!0,json:{type:qe.jsonValues,read:qe.read,write:qe.write}})],Ee.prototype,"type",void 0),Ee=r([p("esri.webdoc.geotriggersInfo.DeviceLocationFeed")],Ee);const ai=Ee;let Oe=class extends se(d){constructor(t){super(t),this.geometry=null,this.where=null}};r([o({types:hr,json:{read:mr,write:!0}})],Oe.prototype,"geometry",void 0),r([o({type:String,json:{write:!0}})],Oe.prototype,"where",void 0),Oe=r([p("esri.webdoc.geotriggersInfo.FeatureFilter")],Oe);const li=Oe;let fe=class extends se(d){constructor(t){super(t),this.layerId=null,this.layerUrl=null,this.type="feature-layer"}};r([o({type:String,json:{write:{overridePolicy(){return{isRequired:this.layerUrl===null}}}}})],fe.prototype,"layerId",void 0),r([o({type:String,json:{write:{overridePolicy(){return{isRequired:this.layerId===null}}}}})],fe.prototype,"layerUrl",void 0),r([X({featureLayer:"feature-layer"},{readOnly:!0})],fe.prototype,"type",void 0),fe=r([p("esri.webdoc.geotriggersInfo.FeatureLayerSource")],fe);const pi=fe;let de=class extends se(d){constructor(t){super(t),this.fenceSource=null,this.filter=null,this.bufferDistance=null,this.type="features"}};r([o({type:pi,json:{write:{isRequired:!0}}})],de.prototype,"fenceSource",void 0),r([o({type:li,json:{write:!0}})],de.prototype,"filter",void 0),r([o({type:Number,json:{write:!0}})],de.prototype,"bufferDistance",void 0),r([X({features:"features"},{readOnly:!0})],de.prototype,"type",void 0),de=r([p("esri.webdoc.geotriggersInfo.FeatureFenceParameters")],de);const ui=de;let Qe=class extends se(d){constructor(t){super(t),this.type="fence"}};r([X({fence:"fence"},{readOnly:!0})],Qe.prototype,"type",void 0),Qe=r([p("esri.webdoc.geotriggersInfo.Geotrigger")],Qe);const ir=Qe;let xe=class extends se(d){constructor(t){super(t),this.expressionInfo=null,this.requestedActions=null}};r([o({type:rr,json:{write:!0}})],xe.prototype,"expressionInfo",void 0),r([o({type:[String],json:{write:!0}})],xe.prototype,"requestedActions",void 0),xe=r([p("esri.webdoc.geotriggersInfo.GeotriggerNotificationOptions")],xe);const di=xe,ci=new Z({enterContainsAndExitDoesNotContain:"enter-contains-and-exit-does-not-contain",enterContainsAndExitDoesNotIntersect:"enter-contains-and-exit-does-not-intersect",enterIntersectsAndExitDoesNotIntersect:"enter-intersects-and-exit-does-not-intersect"}),yi=new Z({useGeometry:"use-geometry",useGeometryWithAccuracy:"use-geometry-with-accuracy"}),ze=new Z({enter:"enter",enterOrExit:"enter-or-exit",exit:"exit"});let P=class extends ir{constructor(t){super(t),this.enterExitRule="enter-contains-and-exit-does-not-intersect",this.feed=null,this.feedAccuracyMode="use-geometry",this.fenceNotificationRule=null,this.fenceParameters=null,this.name=null,this.notificationOptions=null,this.type="fence"}};r([X(ci)],P.prototype,"enterExitRule",void 0),r([o({type:ai,json:{write:{isRequired:!0}}})],P.prototype,"feed",void 0),r([X(yi)],P.prototype,"feedAccuracyMode",void 0),r([o({type:ze.apiValues,json:{type:ze.jsonValues,read:ze.read,write:{writer:ze.write,isRequired:!0}}})],P.prototype,"fenceNotificationRule",void 0),r([o({type:ui,json:{write:{isRequired:!0}}})],P.prototype,"fenceParameters",void 0),r([o({type:String,json:{write:!0}})],P.prototype,"name",void 0),r([o({type:di,json:{write:!0}})],P.prototype,"notificationOptions",void 0),r([X({fence:"fence"},{readOnly:!0})],P.prototype,"type",void 0),P=r([p("esri.webdoc.geotriggersInfo.FenceGeotrigger")],P);const hi=P,mi={base:ir,key:"type",typeMap:{fence:hi}};let Xe=class extends se(d){constructor(t){super(t),this.geotriggers=null}};r([o({types:[mi],json:{write:{isRequired:!0}}})],Xe.prototype,"geotriggers",void 0),Xe=r([p("esri.webdoc.GeotriggersInfo")],Xe);const wi=Xe;var lt;let be=lt=class extends d{constructor(e){super(e),this.activeRange=null,this.currentRangeExtent=null,this.fullRangeExtent=null}clone(){return new lt(F({activeRange:this.activeRange,currentRangeExtent:this.currentRangeExtent,fullRangeExtent:this.fullRangeExtent}))}};r([o({type:String,nonNullable:!0,json:{read:{source:"activeRangeName"},write:{target:"activeRangeName",isRequired:!0}}})],be.prototype,"activeRange",void 0),r([o({type:[Number],json:{write:!0}})],be.prototype,"currentRangeExtent",void 0),r([o({type:[Number],json:{write:!0}})],be.prototype,"fullRangeExtent",void 0),be=lt=r([p("esri.webdoc.RangeInfo")],be);const $t=be;var pt;let M=pt=class extends d{constructor(e){super(e),this.enabled=!1,this.longNames=!1,this.minimized=!1,this.pinnedLevels=!1,this.site=null,this.facility=null,this.level=null}clone(){return new pt(F({enabled:this.enabled,longNames:this.longNames,minimized:this.minimized,pinnedLevels:this.pinnedLevels,site:this.site,facility:this.facility,level:this.level}))}};r([o({type:Boolean,json:{read:{source:"enabled"},write:{target:"enabled"}}})],M.prototype,"enabled",void 0),r([o({type:Boolean,json:{read:{source:"longNames"},write:{target:"longNames"}}})],M.prototype,"longNames",void 0),r([o({type:Boolean,json:{read:{source:"minimized"},write:{target:"minimized"}}})],M.prototype,"minimized",void 0),r([o({type:Boolean,json:{read:{source:"pinnedLevels"},write:{target:"pinnedLevels"}}})],M.prototype,"pinnedLevels",void 0),r([o({type:String,json:{read:{source:"site"},write:{target:"site"}}})],M.prototype,"site",void 0),r([o({type:String,json:{read:{source:"facility"},write:{target:"facility"}}})],M.prototype,"facility",void 0),r([o({type:String,json:{read:{source:"level"},write:{target:"level"}}})],M.prototype,"level",void 0),M=pt=r([p("esri.webdoc.widgets.FloorFilter")],M);const gi=M;var ut;const Ke=new Z({slider:"slider",picker:"picker"});let Se=ut=class extends d{constructor(e){super(e),this.interactionMode=null,this.numStops=null,this.stopInterval=null}clone(){return new ut({interactionMode:this.interactionMode,numStops:this.numStops,stopInterval:this.stopInterval})}};r([o({type:Ke.apiValues,nonNullable:!0,json:{type:Ke.jsonValues,default:null,read:{reader:Ke.read},write:{isRequired:!0,writer:Ke.write}}})],Se.prototype,"interactionMode",void 0),r([o({type:Number,json:{read:{source:"numberOfStops"},write:{target:"numberOfStops",overridePolicy(){const e=this.stopInterval!=null;return{enabled:!e,isRequired:!e}}}}})],Se.prototype,"numStops",void 0),r([o({type:Number,json:{write:{overridePolicy(){return{isRequired:this.numStops==null}}}}})],Se.prototype,"stopInterval",void 0),Se=ut=r([p("esri.webdoc.widgets.Range")],Se);const vi=Se;var dt;let v=dt=class extends d{constructor(e){super(e),this.currentTimeExtent=null,this.fullTimeExtent=null,this.loop=!1,this.numStops=null,this.numThumbs=null,this.stopDelay=null,this.stopInterval=null,this.stops=null}readCurrentTimeExtent(e){if(!e)return;const t=e[0]!=null?new Date(e[0]):null,i=e[1]!=null?new Date(e[1]):null;return new Fe({start:t,end:i})}writeCurrentTimeExtent(e,t,i){e&&nt(i,[Y(e.start)?e.start.getTime():null,Y(e.end)?e.end.getTime():null],t)}readFullTimeExtent(e,t){const i=t.properties;if(!i)return;const s=i.endTime!=null?new Date(i.endTime):null,n=i.startTime!=null?new Date(i.startTime):null;return new Fe({start:n,end:s})}writeFullTimeExtent(e,t){if(!e)return;const i=t.properties=t.properties||{},s=e.end,n=e.start;s&&(i.endTime=Y(s)?s.getTime():null),n&&(i.startTime=Y(n)?n.getTime():null)}readStopInterval(e,t,i){return e?Zt.fromJSON({value:e.interval,unit:e.units},i):null}writeStopInterval(e,t,i,s){if(!e)return;const n=e.toJSON(s);nt(i,{interval:n.value,units:n.unit},t)}readStops(e){return e&&e.length?e.map(t=>new Date(t)):null}writeStops(e,t,i){e&&e.length&&nt(i,e.map(s=>s.getTime()),t)}clone(){return new dt(F({currentTimeExtent:this.currentTimeExtent,fullTimeExtent:this.fullTimeExtent,loop:this.loop,numStops:this.numStops,numThumbs:this.numThumbs,stopDelay:this.stopDelay,stopInterval:this.stopInterval,stops:this.stops}))}};r([o({type:Fe,json:{read:{source:"properties.currentTimeExtent"},write:{target:"properties.currentTimeExtent"}}})],v.prototype,"currentTimeExtent",void 0),r([Q("currentTimeExtent")],v.prototype,"readCurrentTimeExtent",null),r([k("currentTimeExtent")],v.prototype,"writeCurrentTimeExtent",null),r([o({type:Fe,json:{read:{source:["properties.endTime","properties.startTime"]},write:{target:{"properties.endTime":{type:Number},"properties.startTime":{type:Number}}}}})],v.prototype,"fullTimeExtent",void 0),r([Q("fullTimeExtent")],v.prototype,"readFullTimeExtent",null),r([k("fullTimeExtent")],v.prototype,"writeFullTimeExtent",null),r([o({type:Boolean,nonNullable:!0,json:{default:!1,read:{source:"properties.loop"},write:{target:"properties.loop"}}})],v.prototype,"loop",void 0),r([o({type:Number,json:{read:{source:"properties.numberOfStops"},write:{target:"properties.numberOfStops",overridePolicy(){var s;const e=!!this.stopInterval,t=!!((s=this.stops)!=null&&s.length),i=!(e||t);return{enabled:i,isRequired:i}}}}})],v.prototype,"numStops",void 0),r([o({type:[1,2],nonNullable:!0,json:{read:{source:"properties.thumbCount"},write:{target:"properties.thumbCount",isRequired:!0}}})],v.prototype,"numThumbs",void 0),r([o({type:Number,nonNullable:!0,json:{read:{source:"properties.thumbMovingRate"},write:{target:"properties.thumbMovingRate",isRequired:!0}}})],v.prototype,"stopDelay",void 0),r([o({type:Zt,json:{read:{source:"properties.timeStopInterval"},write:{target:"properties.timeStopInterval",overridePolicy(){var i;const e=this.numStops!=null,t=!!((i=this.stops)!=null&&i.length);return{enabled:!t,isRequired:!(e||t)}}}}})],v.prototype,"stopInterval",void 0),r([Q("stopInterval")],v.prototype,"readStopInterval",null),r([k("stopInterval")],v.prototype,"writeStopInterval",null),r([o({type:[Date],json:{read:{source:"properties.stops"},write:{target:"properties.stops",overridePolicy(){return{isRequired:this.numStops==null&&!this.stopInterval}}}}})],v.prototype,"stops",void 0),r([Q("stops")],v.prototype,"readStops",null),r([k("stops")],v.prototype,"writeStops",null),v=dt=r([p("esri.webdoc.widgets.TimeSlider")],v);const fi=v;var ct;let Ie=ct=class extends d{constructor(e){super(e),this.range=null,this.timeSlider=null,this.floorFilter=null}clone(){return new ct(F({range:this.range,timeSlider:this.timeSlider,floorFilter:this.floorFilter}))}};r([o({type:vi,json:{write:!0}})],Ie.prototype,"range",void 0),r([o({type:fi,json:{write:!0}})],Ie.prototype,"timeSlider",void 0),r([o({type:gi,json:{write:!0}})],Ie.prototype,"floorFilter",void 0),Ie=ct=r([p("esri.webdoc.Widgets")],Ie);const bi=Ie,Si={width:600,height:400},He=1.5;function Ii(e,t){t=t||Si;let{width:i,height:s}=t;const n=i/s;return n<He?s=i/He:n>He&&(i=s*He),i>e.width&&(s*=e.width/i,i=e.width),s>e.height&&(i*=e.height/s,s=e.height),{width:Math.round(i),height:Math.round(s)}}function Pt(e){return{enabled:!!(e!=null&&e.length)}}var yt;let Te=yt=class extends d{constructor(e){super(e),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new yt({exactMatch:this.exactMatch,type:this.type,name:this.name})}};r([o({type:Boolean,json:{write:!0}})],Te.prototype,"exactMatch",void 0),r([o({type:String,json:{write:!0}})],Te.prototype,"name",void 0),r([X(er)],Te.prototype,"type",void 0),Te=yt=r([p("esri.webdoc.applicationProperties.SearchLayerField")],Te);const Ti=Te;var ht;let _e=ht=class extends d{constructor(e){super(e),this.field=null,this.id=null,this.subLayer=null}clone(){return new ht(F({field:this.field,id:this.id,subLayer:this.subLayer}))}};r([o({type:Ti,json:{write:{isRequired:!0}}})],_e.prototype,"field",void 0),r([o({type:String,json:{write:{isRequired:!0}}})],_e.prototype,"id",void 0),r([o({type:wr,json:{write:!0}})],_e.prototype,"subLayer",void 0),_e=ht=r([p("esri.webdoc.applicationProperties.SearchLayer")],_e);const _i=_e;var mt;let je=mt=class extends d{constructor(e){super(e),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new mt({exactMatch:this.exactMatch,type:this.type,name:this.name})}};r([o({type:Boolean,json:{write:!0}})],je.prototype,"exactMatch",void 0),r([o({type:String,json:{write:!0}})],je.prototype,"name",void 0),r([X(er)],je.prototype,"type",void 0),je=mt=r([p("esri.webdoc.applicationProperties.SearchTableField")],je);const ji=je;var wt;let Le=wt=class extends d{constructor(e){super(e),this.field=null,this.id=null}clone(){return new wt(F({field:this.field,id:this.id}))}};r([o({type:ji,json:{write:{isRequired:!0}}})],Le.prototype,"field",void 0),r([o({type:String,json:{write:{isRequired:!0}}})],Le.prototype,"id",void 0),Le=wt=r([p("esri.webdoc.applicationProperties.SearchTable")],Le);const Ni=Le;var gt;const or=it.ofType(_i),sr=it.ofType(Ni);let D=gt=class extends d{constructor(e){super(e),this.addressSearchEnabled=!0,this.enabled=!0,this.hintText=null,this.layers=new or,this.tables=new sr}readAddressSearchEnabled(e){return!e}writeAddressSearchEnabled(e,t,i){t[i]=!e}clone(){return new gt(F({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers,tables:this.tables}))}};r([o({type:Boolean,nonNullable:!0,json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder",isRequired:!0},origins:{"web-scene":{read:!1,write:!1}}}})],D.prototype,"addressSearchEnabled",void 0),r([Q("addressSearchEnabled")],D.prototype,"readAddressSearchEnabled",null),r([k("addressSearchEnabled")],D.prototype,"writeAddressSearchEnabled",null),r([o({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-map":{write:{isRequired:!0}},"web-scene":{default:!0,write:!0}}}})],D.prototype,"enabled",void 0),r([o({type:String,json:{write:!0}})],D.prototype,"hintText",void 0),r([o({type:or,json:{write:{overridePolicy:Pt},origins:{"web-scene":{write:{isRequired:!0}}}}})],D.prototype,"layers",void 0),r([o({type:sr,json:{read:!0,write:{overridePolicy:Pt}}})],D.prototype,"tables",void 0),D=gt=r([p("esri.webdoc.applicationProperties.Search")],D);const $i=D;var vt;let Ze=vt=class extends d{constructor(e){super(e),this.search=null}clone(){return new vt(F({search:this.search}))}};r([o({type:$i,json:{write:!0}})],Ze.prototype,"search",void 0),Ze=vt=r([p("esri.webdoc.applicationProperties.Viewing")],Ze);const Ai=Ze;var ft;let Ne=ft=class extends d{constructor(e){super(e),this.editing=null,this.offline=null,this.viewing=null}clone(){return new ft(F({editing:this.editing,offline:this.offline,viewing:this.viewing}))}};r([o({json:{write:!0}})],Ne.prototype,"editing",void 0),r([o({json:{write:!0}})],Ne.prototype,"offline",void 0),r([o({type:Ai,json:{write:!0}})],Ne.prototype,"viewing",void 0),Ne=ft=r([p("esri.webmap.ApplicationProperties")],Ne);const Ri=Ne;var bt;let he=bt=class extends d{constructor(){super(...arguments),this.url=""}destroy(){this.url=""}clone(){return new bt({url:this.url})}};r([o({type:String,json:{write:{isRequired:!0}}})],he.prototype,"url",void 0),he=bt=r([p("esri.webdoc.support.SlideThumbnail")],he);var St;let G=St=class extends gr(d){constructor(e){super(e),this.name=null,this.thumbnail=new he,this.timeExtent=null}castThumbnail(e){return typeof e=="string"?new he({url:e}):vr(he,e)}set viewpoint(e){const{targetGeometry:t,scale:i}=e;Y(t)&&t.type==="point"&&fr(i)&&oe.getLogger(this.declaredClass).warn("Bookmark.viewpoint should include 'scale' when its targetGeometry is a point.",e),this._set("viewpoint",e)}readViewpoint(e,t){const{extent:i,viewpoint:s}=t;return ye.fromJSON(s||{targetGeometry:i})}writeViewpoint(e,t,i,s){if(!e)return;const{targetGeometry:n}=e;if(Y(n)&&n.type!=="extent"){const a="Bookmark.viewpoint cannot be written to JSON when the viewpoint's targetGeometry is not an extent.";s!=null&&s.messages?s.messages.push(new f("property:unsupported",a)):oe.getLogger(this.declaredClass).error(a)}else Y(n)&&(t.extent=n.toJSON()),t[i]=e.toJSON()}clone(){return new St(F({name:this.name,thumbnail:this.thumbnail,timeExtent:this.timeExtent,viewpoint:this.viewpoint}))}};r([o({type:String,nonNullable:!0,json:{write:{isRequired:!0}}})],G.prototype,"name",void 0),r([o({type:he,json:{write:{overridePolicy:e=>({enabled:!(!e||!e.url)})}}})],G.prototype,"thumbnail",void 0),r([br("thumbnail")],G.prototype,"castThumbnail",null),r([o({type:Fe,json:{write:!0}})],G.prototype,"timeExtent",void 0),r([o({type:ye,nonNullable:!0,json:{write:!0}})],G.prototype,"viewpoint",null),r([Q("viewpoint",["extent","viewpoint"])],G.prototype,"readViewpoint",null),r([k("viewpoint")],G.prototype,"writeViewpoint",null),G=St=r([p("esri.webmap.Bookmark")],G);const Ei=G;var It;let ce=It=class extends Xt{constructor(e){super(e),this.background=null,this.rangeInfo=null,this.spatialReference=null,this.viewpoint=null}clone(){return new It(F({background:this.background,rangeInfo:this.rangeInfo,spatialReference:this.spatialReference,viewpoint:this.viewpoint}))}};r([o({type:jt})],ce.prototype,"background",void 0),r([o({type:$t})],ce.prototype,"rangeInfo",void 0),r([o({type:Pe})],ce.prototype,"spatialReference",void 0),r([o({type:ye})],ce.prototype,"viewpoint",void 0),ce=It=r([p("esri.webmap.InitialViewProperties")],ce);const et=ce;class Ue extends Gr{constructor(t,i){super(t,i,"webmap")}}const tt=new Ue(2,27),at="Web Map",nr=it.ofType(Ei),Oi=it.ofType(tr),ke=new Map;ke.set("image/jpeg","jpeg"),ke.set("image/jpg","jpg"),ke.set("image/png","png"),ke.set("image/gif","gif");const xi="ArcGIS Pro",Ft=_t.JSAPI,Vt="CollectorDisabled",Jt="Collector",Mt="Data Editing",Dt="OfflineDisabled",Gt="Offline",Bt="Workforce Project",Wt="Workforce Worker",qt="Workforce Dispatcher",Li="Offline Map Areas",ki="FieldMapsDisabled",zt=_t.DEVELOPER_BASEMAP,Kt="UtilityNetwork",Ui=["NatGeo_World_Map","Ocean_Basemap","USA_Topo_Maps","World_Imagery","World_Street_Map","World_Terrain_Base","World_Topo_Map","World_Hillshade","Canvas/World_Light_Gray_Base","Canvas/World_Light_Gray_Reference","Canvas/World_Dark_Gray_Base","Canvas/World_Dark_Gray_Reference","Ocean/World_Ocean_Base","Ocean/World_Ocean_Reference","Reference/World_Boundaries_and_Places","Reference/World_Reference_Overlay","Reference/World_Transportation"].map(e=>e.toLowerCase());let c=class extends Yt(Tt.LoadableMixin(Sr(Fr))){constructor(e){super(e),this._isAuthoringAppSetByUser=!1,this._isAuthoringAppVersionSetByUser=!1,this._thumbnailFilename=null,this._updateFromPromise=null,this._resourceReferences={portalItem:null,paths:[]},this.applicationProperties=null,this.bookmarks=new nr,this.floorInfo=null,this.geotriggersInfo=null,this.initialViewProperties=new et,this.portalItem=null,this.presentation=null,this.sourceVersion=null,this.widgets=null,this.utilityNetworks=null,this.authoringApp=this.authoringAppVersion=null,this._isAuthoringAppSetByUser=this._isAuthoringAppVersionSetByUser=!1}destroy(){const e=this.portalItem;this.portalItem=null,e==null||e.destroy()}initialize(){if(this.when().catch(e=>{oe.getLogger(this.declaredClass).error("#load()","Failed to load web map",e)}),this.resourceInfo){let e;try{e=this._validateJSON(this.resourceInfo)}catch(t){return void this.addResolvingPromise(Promise.reject(t))}this.read(e)}}set authoringApp(e){this._isAuthoringAppSetByUser=!0,this._set("authoringApp",e)}writeAuthoringApp(e,t){e&&this._isAuthoringAppSetByUser?t.authoringApp=e:t.authoringApp=Ft}set authoringAppVersion(e){this._isAuthoringAppVersionSetByUser=!0,this._set("authoringAppVersion",e)}writeAuthoringAppVersion(e,t){e&&this._isAuthoringAppVersionSetByUser?t.authoringAppVersion=e:t.authoringAppVersion=Ir}readInitialViewProperties(e,t){var n;const i=new et;t.background&&(i.background=jt.fromJSON(t.background));const s=(n=t.initialState)==null?void 0:n.viewpoint;return s&&(s.rotation&&Ue.parse(t.version||"","webmap").lessThan(2,20)&&t.authoringApp===xi&&(s.rotation*=-1),i.viewpoint=ye.fromJSON(s)),t.mapRangeInfo&&(i.rangeInfo=$t.fromJSON(t.mapRangeInfo)),t.spatialReference&&(i.spatialReference=Pe.fromJSON(t.spatialReference)),i}writeInitialViewProperties(e,t,i,s){if(!e)return;const n=e.background;n&&n.color&&(t.background=n.write({},s)),e.viewpoint&&(t.initialState={viewpoint:e.viewpoint.write({},s)}),e.rangeInfo&&(t.mapRangeInfo=e.rangeInfo.toJSON(s)),e.spatialReference&&(t.spatialReference=e.spatialReference.write({},s))}writeLayers(e,t,i,s){t[i]=this._writeLayers(e,s,"operational-layers")}readSourceVersion(e,t){const[i,s]=t.version.split(".");return new Ue(parseInt(i,10),parseInt(s,10))}writeSourceVersion(e,t,i){t[i]=`${tt.major}.${tt.minor}`}writeTables(e,t,i,s){const n=this._writeLayers(e,s,"tables");n.length&&(t[i]=n)}get thumbnailUrl(){return this.portalItem&&this.portalItem.thumbnailUrl||null}set thumbnailUrl(e){e?(this._override("thumbnailUrl",e),this._thumbnailFilename=this._generateCustomThumbnailFilename(e)):this._clearThumbnailOverride()}load(e){return this.addResolvingPromise(this._loadFromSource()),Promise.resolve(this)}loadAll(){return Tr(this,e=>{e(this.ground,this.basemap,this.layers,this.tables)})}read(e,t){t={...t,origin:"web-map"};const i=this._getAuthoringPropsState();_r(this,e,s=>super.read(e,s),t),this._restoreAuthoringPropsFromState(i)}write(e,t){if(this.loadStatus!=="loaded"){const i=new f("webmap:not-loaded","Web map must be loaded before it can be serialized");throw oe.getLogger(this.declaredClass).error("#toJSON()","Web map must be loaded before it can be serialized",this.loadError||this.loadStatus),i}return this._removeDanglingLayerRefs(),t={...t,origin:"web-map",restrictedWebMapWriting:!0,webmap:this},super.write(e,t)}async save(e){e=e||{},this._validateItem();const t=H(()=>import("./saveUtils-9ecd0603.js"),["assets/saveUtils-9ecd0603.js","assets/calcite-c5ae4991.js","assets/index-9a6385f7.js","assets/index-5026a37a.css","assets/calcite-96fa36fd.css","assets/resourceUtils-2cc34a9d.js"]);await this._updateFromPromise,await this.load(),await this._loadLayerContainers(),await this._beforeSave(),await this._validateMap();const i=this.portalItem,s=Ye(i.itemUrl),n={origin:"web-map",messages:[],writtenProperties:[],url:s,portal:i.portal||Me.getDefault(),portalItem:i,verifyItemRelativeUrls:s?{rootPath:s.path,writtenUrls:[]}:null,blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},a=this.write({},n);return await Promise.all(n.resources.pendingOperations),this._validateJSONForWriting(n,e),await this._updateItemProperties(i),await this._updateItem(i,a,n),await Promise.all([this._updateItemThumbnail(),t.then(({saveResources:l})=>l(this._resourceReferences,n,null))]),i}async saveAs(e,t){t=t||{};const i=this._getPortalItem(e),s=H(()=>import("./saveUtils-9ecd0603.js"),["assets/saveUtils-9ecd0603.js","assets/calcite-c5ae4991.js","assets/index-9a6385f7.js","assets/index-5026a37a.css","assets/calcite-96fa36fd.css","assets/resourceUtils-2cc34a9d.js"]);await this._updateFromPromise,await this.load(),await this._loadLayerContainers(),await this._beforeSave(),await this._validateMap();const n={origin:"web-map",messages:[],writtenProperties:[],url:null,portal:i.portal,portalItem:i,blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},a=this.write({},n);await Promise.all(n.resources.pendingOperations),this._validateJSONForWriting(n,t),await this._updateItemPropertiesForSaveAs(i);const l=this._getThumbnailState();return await this._createItem(i,a,n,t)&&(this._resourceReferences.portalItem=i),this._restoreThumbnailFromState(l),await Promise.all([this._updateItemThumbnail(),s.then(({saveResources:u})=>u(this._resourceReferences,n,null))]),i}async updateFrom(e,t){const i=this._updateFromInternal(e,t);this._updateFromPromise=i,await i,i===this._updateFromPromise&&(this._updateFromPromise=null)}getLayerJSONFromResourceInfo(e){var i,s,n,a;const t=this.resourceInfo;return this._collectAllLayersJSON([...((i=t==null?void 0:t.baseMap)==null?void 0:i.baseMapLayers)||[],...(t==null?void 0:t.operationalLayers)||[],...((a=(n=(s=this.basemap)==null?void 0:s.resourceInfo)==null?void 0:n.data)==null?void 0:a.baseMapLayers)||[]]).find(l=>l.id===e.id)}_collectAllLayersJSON(e){return e.reduce((t,i)=>(t.push(i),i.layerType==="GroupLayer"&&(t=t.concat(this._collectAllLayersJSON(i.layers||[]))),t),[])}_writeLayers(e,t,i){return t={...t,layerContainerType:i},e.map(s=>jr(Nr(s,i==="tables"?null:this.getLayerJSONFromResourceInfo(s),t))).filter(Boolean).toArray()}_loadFromSource(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-map"}):this.portalItem&&this.portalItem.id?this._loadFromItem(this.portalItem):Promise.resolve()}async _loadFromItem(e){if(await e.load().catch(s=>{throw new f("webmap:load-portal-item","Failed to load portal item",{error:s})}),e.type!=="Web Map")throw new f("webmap:invalid-portal-item",`Invalid portal item type '${e.type}', expected 'Web Map'`,{type:e.type});const t=await e.fetchData();this.resourceInfo=t;const i={origin:"web-map",url:Ye(e.itemUrl),portal:e.portal||Me.getDefault(),portalItem:e,readResourcePaths:[]};return await this._readAndLoadFromJSON(t,i),this._resourceReferences={portalItem:e,paths:i.readResourcePaths??[]},this._computeInitialViewpoint()}_readAndLoadFromJSON(e,t){const i=this._validateJSON(e);return this.read(i,t),this._loadFromJSON(i,t)}_validateJSON(e){const t=Ue.parse(e.version||"","webmap");return tt.validate(t),e.version=`${t.major}.${t.minor}`,e}_loadFromJSON(e,t){const i={context:{...t,layerContainerType:"operational-layers"}};return this.portalItem&&(i.context.portal=this.portalItem.portal||Me.getDefault()),H(()=>import("./layersCreator-1abc0c33.js"),["assets/layersCreator-1abc0c33.js","assets/calcite-c5ae4991.js","assets/index-9a6385f7.js","assets/index-5026a37a.css","assets/calcite-96fa36fd.css","assets/lazyLayerLoader-d64290db.js","assets/portalLayers-6de045ff.js","assets/layersLoader-ab7139cd.js","assets/fetchService-49bd1fc5.js","assets/jsonContext-62894c45.js"]).then(({populateOperationalLayers:s})=>{const n=[],a=e.operationalLayers;a&&a.length&&n.push(s(this.layers,a,i));const l={...i,context:{...i.context,layerContainerType:"tables"},defaultLayerType:"ArcGISFeatureLayer"},u=e.tables;return u&&u.length&&n.push(s(this.tables,u,l)),De(n).then(()=>{})})}async _computeInitialViewpoint(){var s;let e=this.initialViewProperties;if((s=e==null?void 0:e.viewpoint)==null?void 0:s.targetGeometry)return;const i=await this._getExtentFromItem();i&&(e=e?e.clone():new et,e.viewpoint=new ye,e.viewpoint.targetGeometry=i,this.initialViewProperties=e)}async _getExtentFromItem(){var i,s;const e=(i=this.initialViewProperties)==null?void 0:i.spatialReference,t=(s=this.portalItem)==null?void 0:s.extent;return e&&t?e.isWGS84?t.clone():e.isWebMercator?$r(t):(await H(()=>import("./geometryServiceUtils-b1997a16.js"),["assets/geometryServiceUtils-b1997a16.js","assets/calcite-c5ae4991.js","assets/index-9a6385f7.js","assets/index-5026a37a.css","assets/calcite-96fa36fd.css","assets/project-0e0370f9.js"])).getGeometryServiceURL(this.portalItem).then(n=>{const a=new Lt;return a.geometries=[t],a.outSpatialReference=e,kt(n,a)}).then(n=>n[0]).catch(n=>(oe.getLogger(this.declaredClass).error("Error projecting item's extent:",n),null)):null}_removeDanglingLayerRefs(){const e=this.applicationProperties,t=e&&e.viewing&&e.viewing.search,i=a=>this.allLayers.some(l=>l.id===a);t&&t.layers&&(t.layers=t.layers.filter(a=>i(a.id))),t&&t.tables&&(t.tables=t.tables.filter(a=>this.tables.some(l=>l.id===a.id)));const s=e&&e.editing&&e.editing.locationTracking;s&&s.info&&!i(s.info.layerId)&&(e.editing=null);const n=this.presentation&&this.presentation.slides;n&&n.forEach(a=>{a.visibleLayers&&(a.visibleLayers=a.visibleLayers.filter(l=>i(l.id)))})}async _validateMap(){var t;if(!((t=this.basemap)!=null&&t.baseLayers.length))throw new f("webmap:save","Map does not have a valid basemap with a base layer.");let e=null;if(await Ot(()=>{const i=Vr(this.initialViewProperties,this.basemap);return e=i.spatialReference,!i.updating}),!Ar(e,this.initialViewProperties.spatialReference))throw new f("webmap:save","The spatial reference of the basemap is not compatible with the one from the map.",{expected:this.initialViewProperties.spatialReference,actual:e})}_validateItem(){if(!this.portalItem)throw oe.getLogger(this.declaredClass).error("save: requires the portalItem property to be set"),new f("webmap:portal-item-not-set","Portal item to save to has not been set on the WebMap");this._validateItemType(this.portalItem)}_validateItemType(e){if(e.type!==at)throw new f("webmap:portal-item-wrong-type",`Portal item needs to have type "${at}"`)}_loadLayerContainers(){const e=[];return this.basemap&&e.push(this.basemap.load()),this.ground&&e.push(this.ground.load()),De(e).then(()=>{})}async _beforeSave(){const e=[];for(const t of this.allLayers)if("beforeSave"in t&&typeof t.beforeSave=="function"){const i=t.beforeSave();i&&e.push(i)}await De(e)}_loadAllLayers(){const e=this._getAllLayersAndTables().map(t=>t.load());return De(e).then(()=>{})}_getAllLayersAndTables(){return this.allLayers.concat(this.allTables)}_validateJSONForWriting(e,t){let i=(e.messages?e.messages:[]).filter(s=>s.type==="error").map(s=>new f(s.name,s.message,s.details));if(e.blockedRelativeUrls&&(i=i.concat(e.blockedRelativeUrls.map(s=>new f("url:unsupported",`Relative url '${s}' is not supported in Web Map`)))),t.ignoreUnsupported&&(i=i.filter(s=>s.name!=="layer:unsupported"&&s.name!=="symbol:unsupported"&&s.name!=="symbol-layer:unsupported"&&s.name!=="property:unsupported"&&s.name!=="url:unsupported")),i.length>0)throw new f("webmap:save","Failed to save webmap due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:i})}async _updateItemProperties(e){e.extent=await this._getWGS84Extent(this.initialViewProperties.viewpoint.targetGeometry),await this._updateTypeKeywords(e)}async _updateItemPropertiesForSaveAs(e){R(e,Vt),R(e,ki),R(e,_t.METADATA),R(e,Dt),R(e,Li),R(e,qt),R(e,Bt),R(e,Wt),await this._updateItemProperties(e)}async _getWGS84Extent(e){const t=e.clone().normalize();let i;if(t.length>1)for(const s of t)i?s.width>i.width&&(i=s):i=s;else i=t[0];return this._projectToWGS84(i)}async _projectToWGS84(e){const t=e.spatialReference;if(t.isWGS84)return e.clone();if(t.isWebMercator)return Rr(e);const i=await H(()=>import("./geometryServiceUtils-b1997a16.js"),["assets/geometryServiceUtils-b1997a16.js","assets/calcite-c5ae4991.js","assets/index-9a6385f7.js","assets/index-5026a37a.css","assets/calcite-96fa36fd.css","assets/project-0e0370f9.js"]),s=await i.getGeometryServiceURL(this.portalItem),n=new Lt;return n.geometries=[e],n.outSpatialReference=Pe.WGS84,(await kt(s,n))[0]}async _updateTypeKeywords(e){me(e,Ft),await this._loadAllLayers(),this._evalCollectorKeyword(e),this._evalDataEditingKeyword(e),this._evalOfflineKeyword(e),this._evalDeveloperBasemapKeyword(e),this._evalUtilityNetworkKeyword(e),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter((t,i,s)=>s.indexOf(t)===i))}_evalCollectorKeyword(e){Re(e,Vt)||Re(e,Bt)||Re(e,Wt)||Re(e,qt)||!this._hasEditableFeatureLayer()?R(e,Jt):me(e,Jt)}_evalDataEditingKeyword(e){this._hasEditableFeatureLayer()?me(e,Mt):R(e,Mt)}_evalOfflineKeyword(e){!Re(e,Dt)&&this._isOfflineCapableMap()?me(e,Gt):R(e,Gt)}_evalDeveloperBasemapKeyword(e){Er(this.basemap)?me(e,zt):R(e,zt)}_evalUtilityNetworkKeyword(e){var t;(t=this.utilityNetworks)!=null&&t.length?me(e,Kt):R(e,Kt)}_hasEditableFeatureLayer(){return this._getAllLayersAndTables().some(e=>e.loaded&&xt(e)&&e.capabilities.operations.supportsEditing&&e.editingEnabled)}_isOfflineCapableMap(){return this._getAllLayersAndTables().filter(e=>e.type!=="group").every(e=>e.loaded&&this._isOfflineCapableLayer(e))}_isFeatureCollectionLike(e){return Or(e)||e.type==="map-notes"||e.type==="route"}_isOfflineCapableLayer(e){return xt(e)&&e.capabilities.operations.supportsSync||this._isFeatureCollectionLike(e)&&!e.portalItem||(e.type==="tile"||e.type==="vector-tile")&&(e.capabilities.operations.supportsExportTiles||this._isExportableAGOLTileLayer(e)||xr(e))&&e.spatialReference.equals(this.initialViewProperties.spatialReference)}_isExportableAGOLTileLayer(e){return e.type==="tile"&&Lr(e.url)&&Ui.some(t=>{var i;return(i=e.url)==null?void 0:i.toLowerCase().includes("/"+t+"/")})}async _updateItem(e,t,i){await e.update({data:t}),this._syncUpInstanceWithItem(e,t,i)}async _createItem(e,t,i,s){const n=this.portalItem,a={item:n,authenticated:!(!(n!=null&&n.id)||!n.portal.user)},l=e.portal;await l.signIn();const{copyAllowed:u,itemReloaded:w}=await this._isCopyAllowed(a,l);if(a.authenticated||(a.authenticated=w),!u)throw new f("webmap:save-as-copy-not-allowed","Owner of this map does not allow others to save a copy");const b=await this._initializeNewItem(e,a,t,s);return this.portalItem=e,this._syncUpInstanceWithItem(e,t,i),b}async _isCopyAllowed(e,t){var n;const{item:i,authenticated:s}=e;return i!=null&&i.id&&((n=i.typeKeywords)!=null&&n.includes("useOnly"))?i.portal.portalHostname!==t.portalHostname?{copyAllowed:!1,itemReloaded:!1}:(s||await i.reload(),{copyAllowed:i.itemControl==="admin"||i.itemControl==="update",itemReloaded:!0}):{copyAllowed:!0,itemReloaded:!1}}async _initializeNewItem(e,t,i,s){var A;const n=e.portal,{item:a,authenticated:l}=t,{folder:u,copyAllResources:w}=s;let b=!1;if(w&&(a!=null&&a.id)&&kr(a.portal.url,n.url)&&(l||await a.reload(),a.isOrgItem)){const{total:S}=await a.fetchResources();b=!!S}if(b){const S=await a.copy({copyResources:"all",folder:u});e.id=S.id,e.portal=S.portal;const V=e.toJSON();await e.load(),e.read(V),await e.update({data:i})}else await((A=n.user)==null?void 0:A.addItem({item:e,folder:u,data:i}));return b}_syncUpInstanceWithItem(e,t,i){Qt.prototype.read.call(this,{version:t.version,authoringApp:t.authoringApp,authoringAppVersion:t.authoringAppVersion},{origin:"web-map",ignoreDefaults:!0,url:e.itemUrl&&Ye(e.itemUrl)}),Jr(i),this.resourceInfo=t}async _updateItemThumbnail(){var e;this.thumbnailUrl&&this._isOverridden("thumbnailUrl")&&(await((e=this.portalItem)==null?void 0:e.updateThumbnail({thumbnail:this.thumbnailUrl,filename:this._thumbnailFilename})),this._clearThumbnailOverride())}_getPortalItem(e){let t=rt.from(e);return t.id&&(t=t.clone(),t.id=null),t.type||(t.type=at),t.portal||(t.portal=Me.getDefault()),this._validateItemType(t),t}async _updateFromInternal(e,t){if(t=t||{},await Ot(()=>e.ready),this._updateInitialViewProperties(e,t),e.map===this)for(const i of e.allLayerViews)for(const s of["visible","featureEffect"])s in i&&s in i.layer&&i._isOverridden(s)&&(i.layer[s]=i[s]);await this._updateThumbnailUrl(e,t)}_updateInitialViewProperties(e,t){var i,s;if(t.backgroundExcluded||(this.initialViewProperties.background=(i=e.background)==null?void 0:i.clone()),this.initialViewProperties.spatialReference=(s=e.spatialReference)==null?void 0:s.clone(),t.viewpointExcluded||(this.initialViewProperties.viewpoint=new ye({rotation:e.rotation,scale:t.scalePreserved?e.scale:null,targetGeometry:this._getViewExtent(e)})),!t.widgetsExcluded)for(const n of e.persistableViewModels)n.updateWebDocument(this)}_getViewExtent(e){const t=e.center.clone().normalize(),i=e.extent.clone(),s=i.width/2;return i.xmin=t.x-s,i.xmax=t.x+s,i}async _updateThumbnailUrl(e,t){if(t.thumbnailExcluded)return;const i=Ii(e,t.thumbnailSize),s=await e.takeScreenshot({format:"png",width:i.width,height:i.height});this._setAutoGeneratedThumbnail(s.dataUrl)}_setAutoGeneratedThumbnail(e){this.thumbnailUrl=e,this._thumbnailFilename=null}_clearThumbnailOverride(){this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"),this._thumbnailFilename=null}_generateCustomThumbnailFilename(e){if(Ur(e)){const t=Cr(e),i=t&&t.mediaType,s=i&&ke.get(i.toLowerCase())||null,n=`thumbnail${Date.now()}`;return s?`${n}.${s}`:n}return null}_getThumbnailState(){let e=this.thumbnailUrl;return e&&(e=this._isOverridden("thumbnailUrl")?e:Pr(e,"w","8192")),{thumbnailUrl:e,filename:this._thumbnailFilename}}_restoreThumbnailFromState(e){this.thumbnailUrl=e.thumbnailUrl,this._thumbnailFilename=e.filename}_getAuthoringPropsState(){return{authoringApp:this.authoringApp,authoringAppVersion:this.authoringAppVersion,isAuthoringAppSetByUser:this._isAuthoringAppSetByUser,isAuthoringAppVersionSetByUser:this._isAuthoringAppVersionSetByUser}}_restoreAuthoringPropsFromState(e){e.isAuthoringAppSetByUser?this.authoringApp=e.authoringApp:this._isAuthoringAppSetByUser=!1,e.isAuthoringAppVersionSetByUser?this.authoringAppVersion=e.authoringAppVersion:this._isAuthoringAppVersionSetByUser=!1}static fromJSON(e){const t=e;if(!t)throw new f("webmap:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:t})}};c.VERSION=tt,r([o({type:Ri,json:{write:!0}})],c.prototype,"applicationProperties",void 0),r([o({type:String,json:{write:{allowNull:!0,ignoreOrigin:!0}}})],c.prototype,"authoringApp",null),r([k("authoringApp")],c.prototype,"writeAuthoringApp",null),r([o({type:String,json:{write:{allowNull:!0,ignoreOrigin:!0}}})],c.prototype,"authoringAppVersion",null),r([k("authoringAppVersion")],c.prototype,"writeAuthoringAppVersion",null),r([o({json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],c.prototype,"basemap",void 0),r([o({type:nr,json:{write:{overridePolicy:e=>({enabled:!!(e&&e.length>0),ignoreOrigin:!0})}}})],c.prototype,"bookmarks",void 0),r([o({type:ni,json:{read:{source:"mapFloorInfo"},write:{target:"mapFloorInfo"}}})],c.prototype,"floorInfo",void 0),r([o({type:wi,json:{write:!0}})],c.prototype,"geotriggersInfo",void 0),r([o({type:et,nonNullable:!0,json:{read:{source:["background","initialState.viewpoint","mapRangeInfo","spatialReference"]},write:{ignoreOrigin:!0,target:{background:{type:jt},"initialState.viewpoint":{type:ye},mapRangeInfo:{type:$t},spatialReference:{type:Pe}}}}})],c.prototype,"initialViewProperties",void 0),r([Q("initialViewProperties")],c.prototype,"readInitialViewProperties",null),r([k("initialViewProperties")],c.prototype,"writeInitialViewProperties",null),r([o({json:{read:!1,write:{target:"operationalLayers",ignoreOrigin:!0}}})],c.prototype,"layers",void 0),r([k("layers")],c.prototype,"writeLayers",null),r([o({type:rt})],c.prototype,"portalItem",void 0),r([o({json:{write:!0}})],c.prototype,"presentation",void 0),r([o()],c.prototype,"resourceInfo",void 0),r([o({readOnly:!0,type:Ue,json:{read:{source:"version"},write:{allowNull:!0,ignoreOrigin:!0,target:"version",isRequired:!0}}})],c.prototype,"sourceVersion",void 0),r([Q("sourceVersion")],c.prototype,"readSourceVersion",null),r([k("sourceVersion")],c.prototype,"writeSourceVersion",null),r([o({json:{read:!1,write:{ignoreOrigin:!0}}})],c.prototype,"tables",void 0),r([k("tables")],c.prototype,"writeTables",null),r([o()],c.prototype,"thumbnailUrl",null),r([o({type:bi,json:{write:!0}})],c.prototype,"widgets",void 0),r([o({type:Oi,json:{read:!0,write:!0}})],c.prototype,"utilityNetworks",void 0),c=r([p("esri.WebMap")],c);const Ci=c;function Pi(){const e=st.useRef(null),[t,i]=st.useState(null);st.useEffect(()=>{s()},[]);async function s(){if(!(e!=null&&e.current))return;const n=new Ci({portalItem:{id:"4779f8c1002443c68eb4c7fbb9baf88c"}}),a=new Dr({container:e==null?void 0:e.current,map:n});i(a)}return Rt("div",{className:"App",children:Rt("div",{id:"view",ref:e})})}const wo=Object.freeze(Object.defineProperty({__proto__:null,default:Pi},Symbol.toStringTag,{value:"Module"}));export{wo as M,Xr as c,Br as p};
